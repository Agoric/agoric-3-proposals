{"moduleFormat":"endoZipBase64","endoZipBase64":"UEsDBAoAAAAAAAAAAAA4H1kPtgIAALYCAAAUAAAAY29tcGFydG1lbnQtbWFwLmpzb257CiAgInRhZ3MiOiBbXSwKICAiZW50cnkiOiB7CiAgICAiY29tcGFydG1lbnQiOiAiQGFnbG9jYWwvcG9ydGZvbGlvLWRlcGxveS12MC4xLjAiLAogICAgIm1vZHVsZSI6ICIuL2Rpc3QvcG9ydGZvbGlvLmNvbnRyYWN0LmJ1bmRsZS5qcyIKICB9LAogICJjb21wYXJ0bWVudHMiOiB7CiAgICAiQGFnbG9jYWwvcG9ydGZvbGlvLWRlcGxveS12MC4xLjAiOiB7CiAgICAgICJuYW1lIjogIkBhZ2xvY2FsL3BvcnRmb2xpby1kZXBsb3kiLAogICAgICAibGFiZWwiOiAiQGFnbG9jYWwvcG9ydGZvbGlvLWRlcGxveS12MC4xLjAiLAogICAgICAibG9jYXRpb24iOiAiQGFnbG9jYWwvcG9ydGZvbGlvLWRlcGxveS12MC4xLjAiLAogICAgICAibW9kdWxlcyI6IHsKICAgICAgICAiLi9kaXN0L3BvcnRmb2xpby5jb250cmFjdC5idW5kbGUuanMiOiB7CiAgICAgICAgICAibG9jYXRpb24iOiAiZGlzdC9wb3J0Zm9saW8uY29udHJhY3QuYnVuZGxlLmpzIiwKICAgICAgICAgICJwYXJzZXIiOiAicHJlLW1qcy1qc29uIiwKICAgICAgICAgICJzaGE1MTIiOiAiMjZmZTRiZDE0OTU2YjA3ODlmODViZjk2NzNmYzczN2FiOTZjYzYxYjZhNTQ3OWU1ZWVhYjUzZTdkZGNkYmQwM2Q3YzY3ODhmNTEyODMyYjA5OTgwYzM5MzRiYjAyYmVkYjc4NTFhZjc4NGU0ZjUyMDZlZGM4ZmZmOTMxYjk4NGUiCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9UEsDBAoAAAAAAAAAAACn7/4YeyEOAHshDgBCAAAAQGFnbG9jYWwvcG9ydGZvbGlvLWRlcGxveS12MC4xLjAvZGlzdC9wb3J0Zm9saW8uY29udHJhY3QuYnVuZGxlLmpzeyJpbXBvcnRzIjpbXSwiZXhwb3J0cyI6WyJBeGVsYXJDb25maWdTaGFwZSIsImNvbnRyYWN0IiwibWV0YSIsInN0YXJ0Il0sInJlZXhwb3J0cyI6W10sIl9fc3luY01vZHVsZVByb2dyYW1fXyI6Iih7aW1wb3J0czokaM2PX2ltcG9ydHMsbGl2ZVZhcjokaM2PX2xpdmUsb25jZVZhcjokaM2PX29uY2UsaW1wb3J0OiRozY9faW1wb3J0LGltcG9ydE1ldGE6JGjNj19fX19tZXRhfSk9PihmdW5jdGlvbigpeyd1c2Ugc3RyaWN0JzskaM2PX2ltcG9ydHMoW10pOyRozY9fbGl2ZS5BeGVsYXJDb25maWdTaGFwZSgpOyRozY9fbGl2ZS5tZXRhKCk7JGjNj19saXZlLmNvbnRyYWN0KCk7JGjNj19saXZlLnN0YXJ0KCk7dmFyIF9fY3JlYXRlID0gT2JqZWN0LmNyZWF0ZTtcbnZhciBfX2RlZlByb3AgPSBPYmplY3QuZGVmaW5lUHJvcGVydHk7XG52YXIgX19nZXRPd25Qcm9wRGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7XG52YXIgX19nZXRPd25Qcm9wTmFtZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcztcbnZhciBfX2dldFByb3RvT2YgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Y7XG52YXIgX19oYXNPd25Qcm9wID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTtcbnZhciBfX2VzbSA9IChmbiwgcmVzKSA9PiBmdW5jdGlvbiBfX2luaXQoKSB7XG4gIHJldHVybiBmbiAmJiAocmVzID0gKDAsIGZuW19fZ2V0T3duUHJvcE5hbWVzKGZuKVswXV0pKGZuID0gMCkpLCByZXM7XG59O1xudmFyIF9fY29tbW9uSlMgPSAoY2IsIG1vZCkgPT4gZnVuY3Rpb24gX19yZXF1aXJlMigpIHtcbiAgcmV0dXJuIG1vZCB8fCAoMCwgY2JbX19nZXRPd25Qcm9wTmFtZXMoY2IpWzBdXSkoKG1vZCA9IHsgZXhwb3J0czoge30gfSkuZXhwb3J0cywgbW9kKSwgbW9kLmV4cG9ydHM7XG59O1xudmFyIF9fZXhwb3J0ID0gKHRhcmdldCwgYWxsKSA9PiB7XG4gIGZvciAodmFyIG5hbWUgaW4gYWxsKVxuICAgIF9fZGVmUHJvcCh0YXJnZXQsIG5hbWUsIHsgZ2V0OiBhbGxbbmFtZV0sIGVudW1lcmFibGU6IHRydWUgfSk7XG59O1xudmFyIF9fY29weVByb3BzID0gKHRvLCBmcm9tLCBleGNlcHQsIGRlc2MpID0+IHtcbiAgaWYgKGZyb20gJiYgdHlwZW9mIGZyb20gPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGZyb20gPT09IFwiZnVuY3Rpb25cIikge1xuICAgIGZvciAobGV0IGtleSBvZiBfX2dldE93blByb3BOYW1lcyhmcm9tKSlcbiAgICAgIGlmICghX19oYXNPd25Qcm9wLmNhbGwodG8sIGtleSkgJiYga2V5ICE9PSBleGNlcHQpXG4gICAgICAgIF9fZGVmUHJvcCh0bywga2V5LCB7IGdldDogKCkgPT4gZnJvbVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKGZyb20sIGtleSkpIHx8IGRlc2MuZW51bWVyYWJsZSB9KTtcbiAgfVxuICByZXR1cm4gdG87XG59O1xudmFyIF9fdG9FU00gPSAobW9kLCBpc05vZGVNb2RlLCB0YXJnZXQpID0+ICh0YXJnZXQgPSBtb2QgIT0gbnVsbCA/IF9fY3JlYXRlKF9fZ2V0UHJvdG9PZihtb2QpKSA6IHt9LCBfX2NvcHlQcm9wcyhcbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgaXNOb2RlTW9kZSB8fCAhbW9kIHx8ICFtb2QuX19lc01vZHVsZSA/IF9fZGVmUHJvcCh0YXJnZXQsIFwiZGVmYXVsdFwiLCB7IHZhbHVlOiBtb2QsIGVudW1lcmFibGU6IHRydWUgfSkgOiB0YXJnZXQsXG4gIG1vZFxuKSk7XG5cbi8vXG52YXIgcmVxdWlyZV9hc2NpaSA9IF9fY29tbW9uSlMoe1xuICBcIi4uLy4uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL2FzY2lpLmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICBleHBvcnRzLnRvQXNjaWkgPSB0b0FzY2lpO1xuICAgIGV4cG9ydHMuZnJvbUFzY2lpID0gZnJvbUFzY2lpO1xuICAgIGZ1bmN0aW9uIHRvQXNjaWkoaW5wdXQpIHtcbiAgICAgIGNvbnN0IHRvTnVtcyA9IChzdHIpID0+IHN0ci5zcGxpdChcIlwiKS5tYXAoKHgpID0+IHtcbiAgICAgICAgY29uc3QgY2hhckNvZGUgPSB4LmNoYXJDb2RlQXQoMCk7XG4gICAgICAgIGlmIChjaGFyQ29kZSA8IDMyIHx8IGNoYXJDb2RlID4gMTI2KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGVuY29kZSBjaGFyYWN0ZXIgdGhhdCBpcyBvdXQgb2YgcHJpbnRhYmxlIEFTQ0lJIHJhbmdlOiBcIiArIGNoYXJDb2RlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hhckNvZGU7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBVaW50OEFycmF5LmZyb20odG9OdW1zKGlucHV0KSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21Bc2NpaShkYXRhKSB7XG4gICAgICBjb25zdCBmcm9tTnVtcyA9IChsaXN0T2ZOdW1iZXJzKSA9PiBsaXN0T2ZOdW1iZXJzLm1hcCgoeCkgPT4ge1xuICAgICAgICBpZiAoeCA8IDMyIHx8IHggPiAxMjYpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZGVjb2RlIGNoYXJhY3RlciB0aGF0IGlzIG91dCBvZiBwcmludGFibGUgQVNDSUkgcmFuZ2U6IFwiICsgeCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoeCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBmcm9tTnVtcyhBcnJheS5mcm9tKGRhdGEpKS5qb2luKFwiXCIpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8vXG52YXIgcmVxdWlyZV9iYXNlNjRfanMgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvYmFzZTY0LWpzL2luZGV4LmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIGV4cG9ydHMuYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGg7XG4gICAgZXhwb3J0cy50b0J5dGVBcnJheSA9IHRvQnl0ZUFycmF5O1xuICAgIGV4cG9ydHMuZnJvbUJ5dGVBcnJheSA9IGZyb21CeXRlQXJyYXk7XG4gICAgdmFyIGxvb2t1cCA9IFtdO1xuICAgIHZhciByZXZMb29rdXAgPSBbXTtcbiAgICB2YXIgQXJyID0gdHlwZW9mIFVpbnQ4QXJyYXkgIT09IFwidW5kZWZpbmVkXCIgPyBVaW50OEFycmF5IDogQXJyYXk7XG4gICAgdmFyIGNvZGUgPSBcIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky9cIjtcbiAgICBmb3IgKGkzID0gMCwgbGVuID0gY29kZS5sZW5ndGg7IGkzIDwgbGVuOyArK2kzKSB7XG4gICAgICBsb29rdXBbaTNdID0gY29kZVtpM107XG4gICAgICByZXZMb29rdXBbY29kZS5jaGFyQ29kZUF0KGkzKV0gPSBpMztcbiAgICB9XG4gICAgdmFyIGkzO1xuICAgIHZhciBsZW47XG4gICAgcmV2TG9va3VwW1wiLVwiLmNoYXJDb2RlQXQoMCldID0gNjI7XG4gICAgcmV2TG9va3VwW1wiX1wiLmNoYXJDb2RlQXQoMCldID0gNjM7XG4gICAgZnVuY3Rpb24gZ2V0TGVucyhiNjQpIHtcbiAgICAgIHZhciBsZW4yID0gYjY0Lmxlbmd0aDtcbiAgICAgIGlmIChsZW4yICUgNCA+IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzdHJpbmcuIExlbmd0aCBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgNFwiKTtcbiAgICAgIH1cbiAgICAgIHZhciB2YWxpZExlbiA9IGI2NC5pbmRleE9mKFwiPVwiKTtcbiAgICAgIGlmICh2YWxpZExlbiA9PT0gLTEpIHZhbGlkTGVuID0gbGVuMjtcbiAgICAgIHZhciBwbGFjZUhvbGRlcnNMZW4gPSB2YWxpZExlbiA9PT0gbGVuMiA/IDAgOiA0IC0gdmFsaWRMZW4gJSA0O1xuICAgICAgcmV0dXJuIFt2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuXTtcbiAgICB9XG4gICAgZnVuY3Rpb24gYnl0ZUxlbmd0aChiNjQpIHtcbiAgICAgIHZhciBsZW5zID0gZ2V0TGVucyhiNjQpO1xuICAgICAgdmFyIHZhbGlkTGVuID0gbGVuc1swXTtcbiAgICAgIHZhciBwbGFjZUhvbGRlcnNMZW4gPSBsZW5zWzFdO1xuICAgICAgcmV0dXJuICh2YWxpZExlbiArIHBsYWNlSG9sZGVyc0xlbikgKiAzIC8gNCAtIHBsYWNlSG9sZGVyc0xlbjtcbiAgICB9XG4gICAgZnVuY3Rpb24gX2J5dGVMZW5ndGgoYjY0LCB2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuKSB7XG4gICAgICByZXR1cm4gKHZhbGlkTGVuICsgcGxhY2VIb2xkZXJzTGVuKSAqIDMgLyA0IC0gcGxhY2VIb2xkZXJzTGVuO1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b0J5dGVBcnJheShiNjQpIHtcbiAgICAgIHZhciB0bXA7XG4gICAgICB2YXIgbGVucyA9IGdldExlbnMoYjY0KTtcbiAgICAgIHZhciB2YWxpZExlbiA9IGxlbnNbMF07XG4gICAgICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gbGVuc1sxXTtcbiAgICAgIHZhciBhcnIgPSBuZXcgQXJyKF9ieXRlTGVuZ3RoKGI2NCwgdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbikpO1xuICAgICAgdmFyIGN1ckJ5dGUgPSAwO1xuICAgICAgdmFyIGxlbjIgPSBwbGFjZUhvbGRlcnNMZW4gPiAwID8gdmFsaWRMZW4gLSA0IDogdmFsaWRMZW47XG4gICAgICB2YXIgaTQ7XG4gICAgICBmb3IgKGk0ID0gMDsgaTQgPCBsZW4yOyBpNCArPSA0KSB7XG4gICAgICAgIHRtcCA9IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpNCldIDw8IDE4IHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGk0ICsgMSldIDw8IDEyIHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGk0ICsgMildIDw8IDYgfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTQgKyAzKV07XG4gICAgICAgIGFycltjdXJCeXRlKytdID0gdG1wID4+IDE2ICYgMjU1O1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCA+PiA4ICYgMjU1O1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCAmIDI1NTtcbiAgICAgIH1cbiAgICAgIGlmIChwbGFjZUhvbGRlcnNMZW4gPT09IDIpIHtcbiAgICAgICAgdG1wID0gcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGk0KV0gPDwgMiB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpNCArIDEpXSA+PiA0O1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCAmIDI1NTtcbiAgICAgIH1cbiAgICAgIGlmIChwbGFjZUhvbGRlcnNMZW4gPT09IDEpIHtcbiAgICAgICAgdG1wID0gcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGk0KV0gPDwgMTAgfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTQgKyAxKV0gPDwgNCB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpNCArIDIpXSA+PiAyO1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCA+PiA4ICYgMjU1O1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCAmIDI1NTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhcnI7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHRyaXBsZXRUb0Jhc2U2NChudW0pIHtcbiAgICAgIHJldHVybiBsb29rdXBbbnVtID4+IDE4ICYgNjNdICsgbG9va3VwW251bSA+PiAxMiAmIDYzXSArIGxvb2t1cFtudW0gPj4gNiAmIDYzXSArIGxvb2t1cFtudW0gJiA2M107XG4gICAgfVxuICAgIGZ1bmN0aW9uIGVuY29kZUNodW5rKHVpbnQ4LCBzdGFydDIsIGVuZCkge1xuICAgICAgdmFyIHRtcDtcbiAgICAgIHZhciBvdXRwdXQyID0gW107XG4gICAgICBmb3IgKHZhciBpNCA9IHN0YXJ0MjsgaTQgPCBlbmQ7IGk0ICs9IDMpIHtcbiAgICAgICAgdG1wID0gKHVpbnQ4W2k0XSA8PCAxNiAmIDE2NzExNjgwKSArICh1aW50OFtpNCArIDFdIDw8IDggJiA2NTI4MCkgKyAodWludDhbaTQgKyAyXSAmIDI1NSk7XG4gICAgICAgIG91dHB1dDIucHVzaCh0cmlwbGV0VG9CYXNlNjQodG1wKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3V0cHV0Mi5qb2luKFwiXCIpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBmcm9tQnl0ZUFycmF5KHVpbnQ4KSB7XG4gICAgICB2YXIgdG1wO1xuICAgICAgdmFyIGxlbjIgPSB1aW50OC5sZW5ndGg7XG4gICAgICB2YXIgZXh0cmFCeXRlcyA9IGxlbjIgJSAzO1xuICAgICAgdmFyIHBhcnRzID0gW107XG4gICAgICB2YXIgbWF4Q2h1bmtMZW5ndGggPSAxNjM4MztcbiAgICAgIGZvciAodmFyIGk0ID0gMCwgbGVuMjIgPSBsZW4yIC0gZXh0cmFCeXRlczsgaTQgPCBsZW4yMjsgaTQgKz0gbWF4Q2h1bmtMZW5ndGgpIHtcbiAgICAgICAgcGFydHMucHVzaChlbmNvZGVDaHVuayh1aW50OCwgaTQsIGk0ICsgbWF4Q2h1bmtMZW5ndGggPiBsZW4yMiA/IGxlbjIyIDogaTQgKyBtYXhDaHVua0xlbmd0aCkpO1xuICAgICAgfVxuICAgICAgaWYgKGV4dHJhQnl0ZXMgPT09IDEpIHtcbiAgICAgICAgdG1wID0gdWludDhbbGVuMiAtIDFdO1xuICAgICAgICBwYXJ0cy5wdXNoKFxuICAgICAgICAgIGxvb2t1cFt0bXAgPj4gMl0gKyBsb29rdXBbdG1wIDw8IDQgJiA2M10gKyBcIj09XCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoZXh0cmFCeXRlcyA9PT0gMikge1xuICAgICAgICB0bXAgPSAodWludDhbbGVuMiAtIDJdIDw8IDgpICsgdWludDhbbGVuMiAtIDFdO1xuICAgICAgICBwYXJ0cy5wdXNoKFxuICAgICAgICAgIGxvb2t1cFt0bXAgPj4gMTBdICsgbG9va3VwW3RtcCA+PiA0ICYgNjNdICsgbG9va3VwW3RtcCA8PCAyICYgNjNdICsgXCI9XCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXJ0cy5qb2luKFwiXCIpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8vXG52YXIgcmVxdWlyZV9iYXNlNjQgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9idWlsZC9iYXNlNjQuanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgdmFyIF9fY3JlYXRlQmluZGluZyA9IGV4cG9ydHMgJiYgZXhwb3J0cy5fX2NyZWF0ZUJpbmRpbmcgfHwgKE9iamVjdC5jcmVhdGUgPyBmdW5jdGlvbihvMiwgbTIsIGssIGsyKSB7XG4gICAgICBpZiAoazIgPT09IHZvaWQgMCkgazIgPSBrO1xuICAgICAgdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG0yLCBrKTtcbiAgICAgIGlmICghZGVzYyB8fCAoXCJnZXRcIiBpbiBkZXNjID8gIW0yLl9fZXNNb2R1bGUgOiBkZXNjLndyaXRhYmxlIHx8IGRlc2MuY29uZmlndXJhYmxlKSkge1xuICAgICAgICBkZXNjID0geyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiBtMltrXTtcbiAgICAgICAgfSB9O1xuICAgICAgfVxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8yLCBrMiwgZGVzYyk7XG4gICAgfSA6IGZ1bmN0aW9uKG8yLCBtMiwgaywgazIpIHtcbiAgICAgIGlmIChrMiA9PT0gdm9pZCAwKSBrMiA9IGs7XG4gICAgICBvMltrMl0gPSBtMltrXTtcbiAgICB9KTtcbiAgICB2YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gZXhwb3J0cyAmJiBleHBvcnRzLl9fc2V0TW9kdWxlRGVmYXVsdCB8fCAoT2JqZWN0LmNyZWF0ZSA/IGZ1bmN0aW9uKG8yLCB2Mikge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8yLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdjIgfSk7XG4gICAgfSA6IGZ1bmN0aW9uKG8yLCB2Mikge1xuICAgICAgbzJbXCJkZWZhdWx0XCJdID0gdjI7XG4gICAgfSk7XG4gICAgdmFyIF9faW1wb3J0U3RhciA9IGV4cG9ydHMgJiYgZXhwb3J0cy5fX2ltcG9ydFN0YXIgfHwgLyogICAgICAgICAgICovIGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG93bktleXMyMyA9IGZ1bmN0aW9uKG8yKSB7XG4gICAgICAgIG93bktleXMyMyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHx8IGZ1bmN0aW9uKG8zKSB7XG4gICAgICAgICAgdmFyIGFyID0gW107XG4gICAgICAgICAgZm9yICh2YXIgayBpbiBvMykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvMywgaykpIGFyW2FyLmxlbmd0aF0gPSBrO1xuICAgICAgICAgIHJldHVybiBhcjtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIG93bktleXMyMyhvMik7XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKG1vZCkge1xuICAgICAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgICAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgICAgIGlmIChtb2QgIT0gbnVsbCkge1xuICAgICAgICAgIGZvciAodmFyIGsgPSBvd25LZXlzMjMobW9kKSwgaTMgPSAwOyBpMyA8IGsubGVuZ3RoOyBpMysrKSBpZiAoa1tpM10gIT09IFwiZGVmYXVsdFwiKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGtbaTNdKTtcbiAgICAgICAgfVxuICAgICAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfTtcbiAgICB9KCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMudG9CYXNlNjQgPSB0b0Jhc2U2NDtcbiAgICBleHBvcnRzLmZyb21CYXNlNjQgPSBmcm9tQmFzZTY0O1xuICAgIHZhciBiYXNlNjRqcyA9IF9faW1wb3J0U3RhcihyZXF1aXJlX2Jhc2U2NF9qcygpKTtcbiAgICBmdW5jdGlvbiB0b0Jhc2U2NChkYXRhKSB7XG4gICAgICByZXR1cm4gYmFzZTY0anMuZnJvbUJ5dGVBcnJheShkYXRhKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbUJhc2U2NChiYXNlNjRTdHJpbmcpIHtcbiAgICAgIGlmICghYmFzZTY0U3RyaW5nLm1hdGNoKC9eW2EtekEtWjAtOSsvXSo9ezAsMn0kLykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBiYXNlNjQgc3RyaW5nIGZvcm1hdFwiKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBiYXNlNjRqcy50b0J5dGVBcnJheShiYXNlNjRTdHJpbmcpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8vXG52YXIgcmVxdWlyZV9iZWNoMzIgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9ub2RlX21vZHVsZXMvYmVjaDMyL2luZGV4LmpzXCIoZXhwb3J0cywgbW9kdWxlKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgdmFyIEFMUEhBQkVUMiA9IFwicXB6cnk5eDhnZjJ0dmR3MHMzam41NGtoY2U2bXVhN2xcIjtcbiAgICB2YXIgQUxQSEFCRVRfTUFQID0ge307XG4gICAgZm9yICh6ID0gMDsgeiA8IEFMUEhBQkVUMi5sZW5ndGg7IHorKykge1xuICAgICAgeCA9IEFMUEhBQkVUMi5jaGFyQXQoeik7XG4gICAgICBpZiAoQUxQSEFCRVRfTUFQW3hdICE9PSB2b2lkIDApIHRocm93IG5ldyBUeXBlRXJyb3IoeCArIFwiIGlzIGFtYmlndW91c1wiKTtcbiAgICAgIEFMUEhBQkVUX01BUFt4XSA9IHo7XG4gICAgfVxuICAgIHZhciB4O1xuICAgIHZhciB6O1xuICAgIGZ1bmN0aW9uIHBvbHltb2RTdGVwKHByZSkge1xuICAgICAgdmFyIGIzID0gcHJlID4+IDI1O1xuICAgICAgcmV0dXJuIChwcmUgJiAzMzU1NDQzMSkgPDwgNSBeIC0oYjMgPj4gMCAmIDEpICYgOTk2ODI1MDEwIF4gLShiMyA+PiAxICYgMSkgJiA2NDI4MTM1NDkgXiAtKGIzID4+IDIgJiAxKSAmIDUxMzg3NDQyNiBeIC0oYjMgPj4gMyAmIDEpICYgMTAyNzc0ODgyOSBeIC0oYjMgPj4gNCAmIDEpICYgNzA1OTc5MDU5O1xuICAgIH1cbiAgICBmdW5jdGlvbiBwcmVmaXhDaGsocHJlZml4KSB7XG4gICAgICB2YXIgY2hrID0gMTtcbiAgICAgIGZvciAodmFyIGkzID0gMDsgaTMgPCBwcmVmaXgubGVuZ3RoOyArK2kzKSB7XG4gICAgICAgIHZhciBjMiA9IHByZWZpeC5jaGFyQ29kZUF0KGkzKTtcbiAgICAgICAgaWYgKGMyIDwgMzMgfHwgYzIgPiAxMjYpIHJldHVybiBcIkludmFsaWQgcHJlZml4IChcIiArIHByZWZpeCArIFwiKVwiO1xuICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspIF4gYzIgPj4gNTtcbiAgICAgIH1cbiAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoayk7XG4gICAgICBmb3IgKGkzID0gMDsgaTMgPCBwcmVmaXgubGVuZ3RoOyArK2kzKSB7XG4gICAgICAgIHZhciB2MiA9IHByZWZpeC5jaGFyQ29kZUF0KGkzKTtcbiAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIHYyICYgMzE7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2hrO1xuICAgIH1cbiAgICBmdW5jdGlvbiBlbmNvZGUyKHByZWZpeCwgd29yZHMsIExJTUlUKSB7XG4gICAgICBMSU1JVCA9IExJTUlUIHx8IDkwO1xuICAgICAgaWYgKHByZWZpeC5sZW5ndGggKyA3ICsgd29yZHMubGVuZ3RoID4gTElNSVQpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJFeGNlZWRzIGxlbmd0aCBsaW1pdFwiKTtcbiAgICAgIHByZWZpeCA9IHByZWZpeC50b0xvd2VyQ2FzZSgpO1xuICAgICAgdmFyIGNoayA9IHByZWZpeENoayhwcmVmaXgpO1xuICAgICAgaWYgKHR5cGVvZiBjaGsgPT09IFwic3RyaW5nXCIpIHRocm93IG5ldyBFcnJvcihjaGspO1xuICAgICAgdmFyIHJlc3VsdCA9IHByZWZpeCArIFwiMVwiO1xuICAgICAgZm9yICh2YXIgaTMgPSAwOyBpMyA8IHdvcmRzLmxlbmd0aDsgKytpMykge1xuICAgICAgICB2YXIgeDIgPSB3b3Jkc1tpM107XG4gICAgICAgIGlmICh4MiA+PiA1ICE9PSAwKSB0aHJvdyBuZXcgRXJyb3IoXCJOb24gNS1iaXQgd29yZFwiKTtcbiAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIHgyO1xuICAgICAgICByZXN1bHQgKz0gQUxQSEFCRVQyLmNoYXJBdCh4Mik7XG4gICAgICB9XG4gICAgICBmb3IgKGkzID0gMDsgaTMgPCA2OyArK2kzKSB7XG4gICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoayk7XG4gICAgICB9XG4gICAgICBjaGsgXj0gMTtcbiAgICAgIGZvciAoaTMgPSAwOyBpMyA8IDY7ICsraTMpIHtcbiAgICAgICAgdmFyIHYyID0gY2hrID4+ICg1IC0gaTMpICogNSAmIDMxO1xuICAgICAgICByZXN1bHQgKz0gQUxQSEFCRVQyLmNoYXJBdCh2Mik7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBmdW5jdGlvbiBfX2RlY29kZShzdHIsIExJTUlUKSB7XG4gICAgICBMSU1JVCA9IExJTUlUIHx8IDkwO1xuICAgICAgaWYgKHN0ci5sZW5ndGggPCA4KSByZXR1cm4gc3RyICsgXCIgdG9vIHNob3J0XCI7XG4gICAgICBpZiAoc3RyLmxlbmd0aCA+IExJTUlUKSByZXR1cm4gXCJFeGNlZWRzIGxlbmd0aCBsaW1pdFwiO1xuICAgICAgdmFyIGxvd2VyZWQgPSBzdHIudG9Mb3dlckNhc2UoKTtcbiAgICAgIHZhciB1cHBlcmVkID0gc3RyLnRvVXBwZXJDYXNlKCk7XG4gICAgICBpZiAoc3RyICE9PSBsb3dlcmVkICYmIHN0ciAhPT0gdXBwZXJlZCkgcmV0dXJuIFwiTWl4ZWQtY2FzZSBzdHJpbmcgXCIgKyBzdHI7XG4gICAgICBzdHIgPSBsb3dlcmVkO1xuICAgICAgdmFyIHNwbGl0MiA9IHN0ci5sYXN0SW5kZXhPZihcIjFcIik7XG4gICAgICBpZiAoc3BsaXQyID09PSAtMSkgcmV0dXJuIFwiTm8gc2VwYXJhdG9yIGNoYXJhY3RlciBmb3IgXCIgKyBzdHI7XG4gICAgICBpZiAoc3BsaXQyID09PSAwKSByZXR1cm4gXCJNaXNzaW5nIHByZWZpeCBmb3IgXCIgKyBzdHI7XG4gICAgICB2YXIgcHJlZml4ID0gc3RyLnNsaWNlKDAsIHNwbGl0Mik7XG4gICAgICB2YXIgd29yZENoYXJzID0gc3RyLnNsaWNlKHNwbGl0MiArIDEpO1xuICAgICAgaWYgKHdvcmRDaGFycy5sZW5ndGggPCA2KSByZXR1cm4gXCJEYXRhIHRvbyBzaG9ydFwiO1xuICAgICAgdmFyIGNoayA9IHByZWZpeENoayhwcmVmaXgpO1xuICAgICAgaWYgKHR5cGVvZiBjaGsgPT09IFwic3RyaW5nXCIpIHJldHVybiBjaGs7XG4gICAgICB2YXIgd29yZHMgPSBbXTtcbiAgICAgIGZvciAodmFyIGkzID0gMDsgaTMgPCB3b3JkQ2hhcnMubGVuZ3RoOyArK2kzKSB7XG4gICAgICAgIHZhciBjMiA9IHdvcmRDaGFycy5jaGFyQXQoaTMpO1xuICAgICAgICB2YXIgdjIgPSBBTFBIQUJFVF9NQVBbYzJdO1xuICAgICAgICBpZiAodjIgPT09IHZvaWQgMCkgcmV0dXJuIFwiVW5rbm93biBjaGFyYWN0ZXIgXCIgKyBjMjtcbiAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIHYyO1xuICAgICAgICBpZiAoaTMgKyA2ID49IHdvcmRDaGFycy5sZW5ndGgpIGNvbnRpbnVlO1xuICAgICAgICB3b3Jkcy5wdXNoKHYyKTtcbiAgICAgIH1cbiAgICAgIGlmIChjaGsgIT09IDEpIHJldHVybiBcIkludmFsaWQgY2hlY2tzdW0gZm9yIFwiICsgc3RyO1xuICAgICAgcmV0dXJuIHsgcHJlZml4LCB3b3JkcyB9O1xuICAgIH1cbiAgICBmdW5jdGlvbiBkZWNvZGVVbnNhZmUoKSB7XG4gICAgICB2YXIgcmVzID0gX19kZWNvZGUuYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0eXBlb2YgcmVzID09PSBcIm9iamVjdFwiKSByZXR1cm4gcmVzO1xuICAgIH1cbiAgICBmdW5jdGlvbiBkZWNvZGUzKHN0cikge1xuICAgICAgdmFyIHJlcyA9IF9fZGVjb2RlLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAodHlwZW9mIHJlcyA9PT0gXCJvYmplY3RcIikgcmV0dXJuIHJlcztcbiAgICAgIHRocm93IG5ldyBFcnJvcihyZXMpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBjb252ZXJ0KGRhdGEsIGluQml0cywgb3V0Qml0cywgcGFkKSB7XG4gICAgICB2YXIgdmFsdWUgPSAwO1xuICAgICAgdmFyIGJpdHMgPSAwO1xuICAgICAgdmFyIG1heFYgPSAoMSA8PCBvdXRCaXRzKSAtIDE7XG4gICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICBmb3IgKHZhciBpMyA9IDA7IGkzIDwgZGF0YS5sZW5ndGg7ICsraTMpIHtcbiAgICAgICAgdmFsdWUgPSB2YWx1ZSA8PCBpbkJpdHMgfCBkYXRhW2kzXTtcbiAgICAgICAgYml0cyArPSBpbkJpdHM7XG4gICAgICAgIHdoaWxlIChiaXRzID49IG91dEJpdHMpIHtcbiAgICAgICAgICBiaXRzIC09IG91dEJpdHM7XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUgPj4gYml0cyAmIG1heFYpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAocGFkKSB7XG4gICAgICAgIGlmIChiaXRzID4gMCkge1xuICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlIDw8IG91dEJpdHMgLSBiaXRzICYgbWF4Vik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChiaXRzID49IGluQml0cykgcmV0dXJuIFwiRXhjZXNzIHBhZGRpbmdcIjtcbiAgICAgICAgaWYgKHZhbHVlIDw8IG91dEJpdHMgLSBiaXRzICYgbWF4VikgcmV0dXJuIFwiTm9uLXplcm8gcGFkZGluZ1wiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgZnVuY3Rpb24gdG9Xb3Jkc1Vuc2FmZShieXRlczIpIHtcbiAgICAgIHZhciByZXMgPSBjb252ZXJ0KGJ5dGVzMiwgOCwgNSwgdHJ1ZSk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpKSByZXR1cm4gcmVzO1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b1dvcmRzKGJ5dGVzMikge1xuICAgICAgdmFyIHJlcyA9IGNvbnZlcnQoYnl0ZXMyLCA4LCA1LCB0cnVlKTtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlcykpIHJldHVybiByZXM7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbVdvcmRzVW5zYWZlKHdvcmRzKSB7XG4gICAgICB2YXIgcmVzID0gY29udmVydCh3b3JkcywgNSwgOCwgZmFsc2UpO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVzKSkgcmV0dXJuIHJlcztcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbVdvcmRzKHdvcmRzKSB7XG4gICAgICB2YXIgcmVzID0gY29udmVydCh3b3JkcywgNSwgOCwgZmFsc2UpO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVzKSkgcmV0dXJuIHJlcztcbiAgICAgIHRocm93IG5ldyBFcnJvcihyZXMpO1xuICAgIH1cbiAgICBtb2R1bGUuZXhwb3J0cyA9IHtcbiAgICAgIGRlY29kZVVuc2FmZSxcbiAgICAgIGRlY29kZTogZGVjb2RlMyxcbiAgICAgIGVuY29kZTogZW5jb2RlMixcbiAgICAgIHRvV29yZHNVbnNhZmUsXG4gICAgICB0b1dvcmRzLFxuICAgICAgZnJvbVdvcmRzVW5zYWZlLFxuICAgICAgZnJvbVdvcmRzXG4gICAgfTtcbiAgfVxufSk7XG5cbi8vXG52YXIgcmVxdWlyZV9iZWNoMzIyID0gX19jb21tb25KUyh7XG4gIFwiLi4vLi4vbm9kZV9tb2R1bGVzL0Bjb3NtanMvZW5jb2RpbmcvYnVpbGQvYmVjaDMyLmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIHZhciBfX2NyZWF0ZUJpbmRpbmcgPSBleHBvcnRzICYmIGV4cG9ydHMuX19jcmVhdGVCaW5kaW5nIHx8IChPYmplY3QuY3JlYXRlID8gZnVuY3Rpb24obzIsIG0yLCBrLCBrMikge1xuICAgICAgaWYgKGsyID09PSB2b2lkIDApIGsyID0gaztcbiAgICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtMiwgayk7XG4gICAgICBpZiAoIWRlc2MgfHwgKFwiZ2V0XCIgaW4gZGVzYyA/ICFtMi5fX2VzTW9kdWxlIDogZGVzYy53cml0YWJsZSB8fCBkZXNjLmNvbmZpZ3VyYWJsZSkpIHtcbiAgICAgICAgZGVzYyA9IHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbTJba107XG4gICAgICAgIH0gfTtcbiAgICAgIH1cbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvMiwgazIsIGRlc2MpO1xuICAgIH0gOiBmdW5jdGlvbihvMiwgbTIsIGssIGsyKSB7XG4gICAgICBpZiAoazIgPT09IHZvaWQgMCkgazIgPSBrO1xuICAgICAgbzJbazJdID0gbTJba107XG4gICAgfSk7XG4gICAgdmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IGV4cG9ydHMgJiYgZXhwb3J0cy5fX3NldE1vZHVsZURlZmF1bHQgfHwgKE9iamVjdC5jcmVhdGUgPyBmdW5jdGlvbihvMiwgdjIpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvMiwgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYyIH0pO1xuICAgIH0gOiBmdW5jdGlvbihvMiwgdjIpIHtcbiAgICAgIG8yW1wiZGVmYXVsdFwiXSA9IHYyO1xuICAgIH0pO1xuICAgIHZhciBfX2ltcG9ydFN0YXIgPSBleHBvcnRzICYmIGV4cG9ydHMuX19pbXBvcnRTdGFyIHx8IC8qICAgICAgICAgICAqLyBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBvd25LZXlzMjMgPSBmdW5jdGlvbihvMikge1xuICAgICAgICBvd25LZXlzMjMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyB8fCBmdW5jdGlvbihvMykge1xuICAgICAgICAgIHZhciBhciA9IFtdO1xuICAgICAgICAgIGZvciAodmFyIGsgaW4gbzMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobzMsIGspKSBhclthci5sZW5ndGhdID0gaztcbiAgICAgICAgICByZXR1cm4gYXI7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBvd25LZXlzMjMobzIpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBmdW5jdGlvbihtb2QpIHtcbiAgICAgICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgICAgICBpZiAobW9kICE9IG51bGwpIHtcbiAgICAgICAgICBmb3IgKHZhciBrID0gb3duS2V5czIzKG1vZCksIGkzID0gMDsgaTMgPCBrLmxlbmd0aDsgaTMrKykgaWYgKGtbaTNdICE9PSBcImRlZmF1bHRcIikgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrW2kzXSk7XG4gICAgICAgIH1cbiAgICAgICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH07XG4gICAgfSgpO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICBleHBvcnRzLnRvQmVjaDMyID0gdG9CZWNoMzI7XG4gICAgZXhwb3J0cy5mcm9tQmVjaDMyID0gZnJvbUJlY2gzMjM7XG4gICAgZXhwb3J0cy5ub3JtYWxpemVCZWNoMzIgPSBub3JtYWxpemVCZWNoMzI7XG4gICAgdmFyIGJlY2gzMjIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZV9iZWNoMzIoKSk7XG4gICAgZnVuY3Rpb24gdG9CZWNoMzIocHJlZml4LCBkYXRhLCBsaW1pdDIpIHtcbiAgICAgIGNvbnN0IGFkZHJlc3MgPSBiZWNoMzIyLmVuY29kZShwcmVmaXgsIGJlY2gzMjIudG9Xb3JkcyhkYXRhKSwgbGltaXQyKTtcbiAgICAgIHJldHVybiBhZGRyZXNzO1xuICAgIH1cbiAgICBmdW5jdGlvbiBmcm9tQmVjaDMyMyhhZGRyZXNzLCBsaW1pdDIgPSBJbmZpbml0eSkge1xuICAgICAgY29uc3QgZGVjb2RlZEFkZHJlc3MgPSBiZWNoMzIyLmRlY29kZShhZGRyZXNzLCBsaW1pdDIpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJlZml4OiBkZWNvZGVkQWRkcmVzcy5wcmVmaXgsXG4gICAgICAgIGRhdGE6IG5ldyBVaW50OEFycmF5KGJlY2gzMjIuZnJvbVdvcmRzKGRlY29kZWRBZGRyZXNzLndvcmRzKSlcbiAgICAgIH07XG4gICAgfVxuICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZUJlY2gzMihhZGRyZXNzKSB7XG4gICAgICBjb25zdCB7IHByZWZpeCwgZGF0YSB9ID0gZnJvbUJlY2gzMjMoYWRkcmVzcyk7XG4gICAgICByZXR1cm4gdG9CZWNoMzIocHJlZml4LCBkYXRhKTtcbiAgICB9XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfaGV4ID0gX19jb21tb25KUyh7XG4gIFwiLi4vLi4vbm9kZV9tb2R1bGVzL0Bjb3NtanMvZW5jb2RpbmcvYnVpbGQvaGV4LmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICBleHBvcnRzLnRvSGV4ID0gdG9IZXgyO1xuICAgIGV4cG9ydHMuZnJvbUhleCA9IGZyb21IZXgzO1xuICAgIGZ1bmN0aW9uIHRvSGV4MihkYXRhKSB7XG4gICAgICBsZXQgb3V0ID0gXCJcIjtcbiAgICAgIGZvciAoY29uc3QgYnl0ZSBvZiBkYXRhKSB7XG4gICAgICAgIG91dCArPSAoXCIwXCIgKyBieXRlLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbUhleDMoaGV4c3RyaW5nKSB7XG4gICAgICBpZiAoaGV4c3RyaW5nLmxlbmd0aCAlIDIgIT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaGV4IHN0cmluZyBsZW5ndGggbXVzdCBiZSBhIG11bHRpcGxlIG9mIDJcIik7XG4gICAgICB9XG4gICAgICBjb25zdCBvdXQgPSBuZXcgVWludDhBcnJheShoZXhzdHJpbmcubGVuZ3RoIC8gMik7XG4gICAgICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgb3V0Lmxlbmd0aDsgaTMrKykge1xuICAgICAgICBjb25zdCBqID0gMiAqIGkzO1xuICAgICAgICBjb25zdCBoZXhCeXRlQXNTdHJpbmcgPSBoZXhzdHJpbmcuc2xpY2UoaiwgaiArIDIpO1xuICAgICAgICBpZiAoIWhleEJ5dGVBc1N0cmluZy5tYXRjaCgvWzAtOWEtZl17Mn0vaSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJoZXggc3RyaW5nIGNvbnRhaW5zIGludmFsaWQgY2hhcmFjdGVyc1wiKTtcbiAgICAgICAgfVxuICAgICAgICBvdXRbaTNdID0gcGFyc2VJbnQoaGV4Qnl0ZUFzU3RyaW5nLCAxNik7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3V0O1xuICAgIH1cbiAgfVxufSk7XG5cbi8vXG52YXIgcmVxdWlyZV9yZmMzMzM5ID0gX19jb21tb25KUyh7XG4gIFwiLi4vLi4vbm9kZV9tb2R1bGVzL0Bjb3NtanMvZW5jb2RpbmcvYnVpbGQvcmZjMzMzOS5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy5mcm9tUmZjMzMzOSA9IGZyb21SZmMzMzM5O1xuICAgIGV4cG9ydHMudG9SZmMzMzM5ID0gdG9SZmMzMzM5O1xuICAgIHZhciByZmMzMzM5TWF0Y2hlciA9IC9eKFxcZHs0fSktKFxcZHsyfSktKFxcZHsyfSlbVCBdKFxcZHsyfSk6KFxcZHsyfSk6KFxcZHsyfSkoXFwuXFxkezEsOX0pPygoPzpbKy1dXFxkezJ9OlxcZHsyfSl8WikkLztcbiAgICBmdW5jdGlvbiBwYWRkZWQoaW50ZWdlciwgbGVuZ3RoID0gMikge1xuICAgICAgcmV0dXJuIGludGVnZXIudG9TdHJpbmcoKS5wYWRTdGFydChsZW5ndGgsIFwiMFwiKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbVJmYzMzMzkoc3RyKSB7XG4gICAgICBjb25zdCBtYXRjaGVzMiA9IHJmYzMzMzlNYXRjaGVyLmV4ZWMoc3RyKTtcbiAgICAgIGlmICghbWF0Y2hlczIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGF0ZSBzdHJpbmcgaXMgbm90IGluIFJGQzMzMzkgZm9ybWF0XCIpO1xuICAgICAgfVxuICAgICAgY29uc3QgeWVhciA9ICttYXRjaGVzMlsxXTtcbiAgICAgIGNvbnN0IG1vbnRoID0gK21hdGNoZXMyWzJdO1xuICAgICAgY29uc3QgZGF5ID0gK21hdGNoZXMyWzNdO1xuICAgICAgY29uc3QgaG91ciA9ICttYXRjaGVzMls0XTtcbiAgICAgIGNvbnN0IG1pbnV0ZSA9ICttYXRjaGVzMls1XTtcbiAgICAgIGNvbnN0IHNlY29uZCA9ICttYXRjaGVzMls2XTtcbiAgICAgIGNvbnN0IG1pbGxpU2Vjb25kcyA9IG1hdGNoZXMyWzddID8gTWF0aC5mbG9vcigrbWF0Y2hlczJbN10gKiAxZTMpIDogMDtcbiAgICAgIGxldCB0ek9mZnNldFNpZ247XG4gICAgICBsZXQgdHpPZmZzZXRIb3VycztcbiAgICAgIGxldCB0ek9mZnNldE1pbnV0ZXM7XG4gICAgICBpZiAobWF0Y2hlczJbOF0gPT09IFwiWlwiKSB7XG4gICAgICAgIHR6T2Zmc2V0U2lnbiA9IDE7XG4gICAgICAgIHR6T2Zmc2V0SG91cnMgPSAwO1xuICAgICAgICB0ek9mZnNldE1pbnV0ZXMgPSAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHpPZmZzZXRTaWduID0gbWF0Y2hlczJbOF0uc3Vic3RyaW5nKDAsIDEpID09PSBcIi1cIiA/IC0xIDogMTtcbiAgICAgICAgdHpPZmZzZXRIb3VycyA9ICttYXRjaGVzMls4XS5zdWJzdHJpbmcoMSwgMyk7XG4gICAgICAgIHR6T2Zmc2V0TWludXRlcyA9ICttYXRjaGVzMls4XS5zdWJzdHJpbmcoNCwgNik7XG4gICAgICB9XG4gICAgICBjb25zdCB0ek9mZnNldCA9IHR6T2Zmc2V0U2lnbiAqICh0ek9mZnNldEhvdXJzICogNjAgKyB0ek9mZnNldE1pbnV0ZXMpICogNjA7XG4gICAgICBjb25zdCBkYXRlID0gLyogICAgICAgICAgICovIG5ldyBEYXRlKCk7XG4gICAgICBkYXRlLnNldFVUQ0Z1bGxZZWFyKHllYXIsIG1vbnRoIC0gMSwgZGF5KTtcbiAgICAgIGRhdGUuc2V0VVRDSG91cnMoaG91ciwgbWludXRlLCBzZWNvbmQsIG1pbGxpU2Vjb25kcyk7XG4gICAgICByZXR1cm4gbmV3IERhdGUoZGF0ZS5nZXRUaW1lKCkgLSB0ek9mZnNldCAqIDFlMyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHRvUmZjMzMzOShkYXRlKSB7XG4gICAgICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRVVENGdWxsWWVhcigpO1xuICAgICAgY29uc3QgbW9udGggPSBwYWRkZWQoZGF0ZS5nZXRVVENNb250aCgpICsgMSk7XG4gICAgICBjb25zdCBkYXkgPSBwYWRkZWQoZGF0ZS5nZXRVVENEYXRlKCkpO1xuICAgICAgY29uc3QgaG91ciA9IHBhZGRlZChkYXRlLmdldFVUQ0hvdXJzKCkpO1xuICAgICAgY29uc3QgbWludXRlID0gcGFkZGVkKGRhdGUuZ2V0VVRDTWludXRlcygpKTtcbiAgICAgIGNvbnN0IHNlY29uZCA9IHBhZGRlZChkYXRlLmdldFVUQ1NlY29uZHMoKSk7XG4gICAgICBjb25zdCBtcyA9IHBhZGRlZChkYXRlLmdldFVUQ01pbGxpc2Vjb25kcygpLCAzKTtcbiAgICAgIHJldHVybiBgJHt5ZWFyfS0ke21vbnRofS0ke2RheX1UJHtob3VyfToke21pbnV0ZX06JHtzZWNvbmR9LiR7bXN9WmA7XG4gICAgfVxuICB9XG59KTtcblxuLy9cbnZhciByZXF1aXJlX3V0ZjggPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9idWlsZC91dGY4LmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICBleHBvcnRzLnRvVXRmOCA9IHRvVXRmODtcbiAgICBleHBvcnRzLmZyb21VdGY4ID0gZnJvbVV0Zjg7XG4gICAgZnVuY3Rpb24gdG9VdGY4KHN0cikge1xuICAgICAgcmV0dXJuIG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShzdHIpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBmcm9tVXRmOChkYXRhLCBsb3NzeSA9IGZhbHNlKSB7XG4gICAgICBjb25zdCBmYXRhbCA9ICFsb3NzeTtcbiAgICAgIHJldHVybiBuZXcgVGV4dERlY29kZXIoXCJ1dGYtOFwiLCB7IGZhdGFsIH0pLmRlY29kZShkYXRhKTtcbiAgICB9XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYnVpbGQgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9idWlsZC9pbmRleC5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy50b1V0ZjggPSBleHBvcnRzLmZyb21VdGY4ID0gZXhwb3J0cy50b1JmYzMzMzkgPSBleHBvcnRzLmZyb21SZmMzMzM5ID0gZXhwb3J0cy50b0hleCA9IGV4cG9ydHMuZnJvbUhleCA9IGV4cG9ydHMudG9CZWNoMzIgPSBleHBvcnRzLm5vcm1hbGl6ZUJlY2gzMiA9IGV4cG9ydHMuZnJvbUJlY2gzMiA9IGV4cG9ydHMudG9CYXNlNjQgPSBleHBvcnRzLmZyb21CYXNlNjQgPSBleHBvcnRzLnRvQXNjaWkgPSBleHBvcnRzLmZyb21Bc2NpaSA9IHZvaWQgMDtcbiAgICB2YXIgYXNjaWlfMSA9IHJlcXVpcmVfYXNjaWkoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tQXNjaWlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGFzY2lpXzEuZnJvbUFzY2lpO1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9Bc2NpaVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYXNjaWlfMS50b0FzY2lpO1xuICAgIH0gfSk7XG4gICAgdmFyIGJhc2U2NF8xID0gcmVxdWlyZV9iYXNlNjQoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tQmFzZTY0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBiYXNlNjRfMS5mcm9tQmFzZTY0O1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9CYXNlNjRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGJhc2U2NF8xLnRvQmFzZTY0O1xuICAgIH0gfSk7XG4gICAgdmFyIGJlY2gzMl8xID0gcmVxdWlyZV9iZWNoMzIyKCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiZnJvbUJlY2gzMlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYmVjaDMyXzEuZnJvbUJlY2gzMjtcbiAgICB9IH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIm5vcm1hbGl6ZUJlY2gzMlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYmVjaDMyXzEubm9ybWFsaXplQmVjaDMyO1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9CZWNoMzJcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGJlY2gzMl8xLnRvQmVjaDMyO1xuICAgIH0gfSk7XG4gICAgdmFyIGhleF8xID0gcmVxdWlyZV9oZXgoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tSGV4XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBoZXhfMS5mcm9tSGV4O1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9IZXhcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGhleF8xLnRvSGV4O1xuICAgIH0gfSk7XG4gICAgdmFyIHJmYzMzMzlfMSA9IHJlcXVpcmVfcmZjMzMzOSgpO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcImZyb21SZmMzMzM5XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiByZmMzMzM5XzEuZnJvbVJmYzMzMzk7XG4gICAgfSB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJ0b1JmYzMzMzlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHJmYzMzMzlfMS50b1JmYzMzMzk7XG4gICAgfSB9KTtcbiAgICB2YXIgdXRmOF8xID0gcmVxdWlyZV91dGY4KCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiZnJvbVV0ZjhcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHV0ZjhfMS5mcm9tVXRmODtcbiAgICB9IH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcInRvVXRmOFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdXRmOF8xLnRvVXRmODtcbiAgICB9IH0pO1xuICB9XG59KTtcblxuLy9cbmZ1bmN0aW9uIG51bWJlcihuMikge1xuICBpZiAoIU51bWJlci5pc1NhZmVJbnRlZ2VyKG4yKSB8fCBuMiA8IDApXG4gICAgdGhyb3cgbmV3IEVycm9yKGBwb3NpdGl2ZSBpbnRlZ2VyIGV4cGVjdGVkLCBub3QgJHtuMn1gKTtcbn1cbmZ1bmN0aW9uIGlzQnl0ZXMoYTIpIHtcbiAgcmV0dXJuIGEyIGluc3RhbmNlb2YgVWludDhBcnJheSB8fCBhMiAhPSBudWxsICYmIHR5cGVvZiBhMiA9PT0gXCJvYmplY3RcIiAmJiBhMi5jb25zdHJ1Y3Rvci5uYW1lID09PSBcIlVpbnQ4QXJyYXlcIjtcbn1cbmZ1bmN0aW9uIGJ5dGVzKGIzLCAuLi5sZW5ndGhzKSB7XG4gIGlmICghaXNCeXRlcyhiMykpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVWludDhBcnJheSBleHBlY3RlZFwiKTtcbiAgaWYgKGxlbmd0aHMubGVuZ3RoID4gMCAmJiAhbGVuZ3Rocy5pbmNsdWRlcyhiMy5sZW5ndGgpKVxuICAgIHRocm93IG5ldyBFcnJvcihgVWludDhBcnJheSBleHBlY3RlZCBvZiBsZW5ndGggJHtsZW5ndGhzfSwgbm90IG9mIGxlbmd0aD0ke2IzLmxlbmd0aH1gKTtcbn1cbmZ1bmN0aW9uIGV4aXN0cyhpbnN0YW5jZSwgY2hlY2tGaW5pc2hlZCA9IHRydWUpIHtcbiAgaWYgKGluc3RhbmNlLmRlc3Ryb3llZClcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJIYXNoIGluc3RhbmNlIGhhcyBiZWVuIGRlc3Ryb3llZFwiKTtcbiAgaWYgKGNoZWNrRmluaXNoZWQgJiYgaW5zdGFuY2UuZmluaXNoZWQpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSGFzaCNkaWdlc3QoKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZFwiKTtcbn1cbmZ1bmN0aW9uIG91dHB1dChvdXQsIGluc3RhbmNlKSB7XG4gIGJ5dGVzKG91dCk7XG4gIGNvbnN0IG1pbiA9IGluc3RhbmNlLm91dHB1dExlbjtcbiAgaWYgKG91dC5sZW5ndGggPCBtaW4pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYGRpZ2VzdEludG8oKSBleHBlY3RzIG91dHB1dCBidWZmZXIgb2YgbGVuZ3RoIGF0IGxlYXN0ICR7bWlufWApO1xuICB9XG59XG52YXIgaW5pdF9hc3NlcnQgPSBfX2VzbSh7XG4gIFwiLi4vLi4vbm9kZV9tb2R1bGVzL0Bub2JsZS9oYXNoZXMvZXNtL19hc3NlcnQuanNcIigpIHtcbiAgfVxufSk7XG5cbi8vXG5mdW5jdGlvbiBieXRlU3dhcDMyKGFycikge1xuICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgYXJyLmxlbmd0aDsgaTMrKykge1xuICAgIGFycltpM10gPSBieXRlU3dhcChhcnJbaTNdKTtcbiAgfVxufVxuZnVuY3Rpb24gdXRmOFRvQnl0ZXMoc3RyKSB7XG4gIGlmICh0eXBlb2Ygc3RyICE9PSBcInN0cmluZ1wiKVxuICAgIHRocm93IG5ldyBFcnJvcihgdXRmOFRvQnl0ZXMgZXhwZWN0ZWQgc3RyaW5nLCBnb3QgJHt0eXBlb2Ygc3RyfWApO1xuICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkobmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKHN0cikpO1xufVxuZnVuY3Rpb24gdG9CeXRlczIoZGF0YSkge1xuICBpZiAodHlwZW9mIGRhdGEgPT09IFwic3RyaW5nXCIpXG4gICAgZGF0YSA9IHV0ZjhUb0J5dGVzKGRhdGEpO1xuICBieXRlcyhkYXRhKTtcbiAgcmV0dXJuIGRhdGE7XG59XG5mdW5jdGlvbiB3cmFwQ29uc3RydWN0b3IoaGFzaENvbnMpIHtcbiAgY29uc3QgaGFzaEMgPSAobXNnKSA9PiBoYXNoQ29ucygpLnVwZGF0ZSh0b0J5dGVzMihtc2cpKS5kaWdlc3QoKTtcbiAgY29uc3QgdG1wID0gaGFzaENvbnMoKTtcbiAgaGFzaEMub3V0cHV0TGVuID0gdG1wLm91dHB1dExlbjtcbiAgaGFzaEMuYmxvY2tMZW4gPSB0bXAuYmxvY2tMZW47XG4gIGhhc2hDLmNyZWF0ZSA9ICgpID0+IGhhc2hDb25zKCk7XG4gIHJldHVybiBoYXNoQztcbn1cbmZ1bmN0aW9uIHdyYXBYT0ZDb25zdHJ1Y3RvcldpdGhPcHRzKGhhc2hDb25zKSB7XG4gIGNvbnN0IGhhc2hDID0gKG1zZywgb3B0cykgPT4gaGFzaENvbnMob3B0cykudXBkYXRlKHRvQnl0ZXMyKG1zZykpLmRpZ2VzdCgpO1xuICBjb25zdCB0bXAgPSBoYXNoQ29ucyh7fSk7XG4gIGhhc2hDLm91dHB1dExlbiA9IHRtcC5vdXRwdXRMZW47XG4gIGhhc2hDLmJsb2NrTGVuID0gdG1wLmJsb2NrTGVuO1xuICBoYXNoQy5jcmVhdGUgPSAob3B0cykgPT4gaGFzaENvbnMob3B0cyk7XG4gIHJldHVybiBoYXNoQztcbn1cbnZhciB1MzIsIGlzTEUsIGJ5dGVTd2FwLCBIYXNoLCB0b1N0cjtcbnZhciBpbml0X3V0aWxzID0gX19lc20oe1xuICBcIi4uLy4uL25vZGVfbW9kdWxlcy9Abm9ibGUvaGFzaGVzL2VzbS91dGlscy5qc1wiKCkge1xuICAgIGluaXRfYXNzZXJ0KCk7XG4gICAgdTMyID0gKGFycikgPT4gbmV3IFVpbnQzMkFycmF5KGFyci5idWZmZXIsIGFyci5ieXRlT2Zmc2V0LCBNYXRoLmZsb29yKGFyci5ieXRlTGVuZ3RoIC8gNCkpO1xuICAgIGlzTEUgPSBuZXcgVWludDhBcnJheShuZXcgVWludDMyQXJyYXkoWzI4NzQ1NDAyMF0pLmJ1ZmZlcilbMF0gPT09IDY4O1xuICAgIGJ5dGVTd2FwID0gKHdvcmQpID0+IHdvcmQgPDwgMjQgJiA0Mjc4MTkwMDgwIHwgd29yZCA8PCA4ICYgMTY3MTE2ODAgfCB3b3JkID4+PiA4ICYgNjUyODAgfCB3b3JkID4+PiAyNCAmIDI1NTtcbiAgICBIYXNoID0gY2xhc3Mge1xuICAgICAgLy9cbiAgICAgIGNsb25lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2xvbmVJbnRvKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB0b1N0ciA9IHt9LnRvU3RyaW5nO1xuICB9XG59KTtcblxuLy9cbmZ1bmN0aW9uIGZyb21CaWcobjIsIGxlID0gZmFsc2UpIHtcbiAgaWYgKGxlKVxuICAgIHJldHVybiB7IGg6IE51bWJlcihuMiAmIFUzMl9NQVNLNjQpLCBsOiBOdW1iZXIobjIgPj4gXzMybiAmIFUzMl9NQVNLNjQpIH07XG4gIHJldHVybiB7IGg6IE51bWJlcihuMiA+PiBfMzJuICYgVTMyX01BU0s2NCkgfCAwLCBsOiBOdW1iZXIobjIgJiBVMzJfTUFTSzY0KSB8IDAgfTtcbn1cbmZ1bmN0aW9uIHNwbGl0KGxzdCwgbGUgPSBmYWxzZSkge1xuICBsZXQgQWggPSBuZXcgVWludDMyQXJyYXkobHN0Lmxlbmd0aCk7XG4gIGxldCBBbCA9IG5ldyBVaW50MzJBcnJheShsc3QubGVuZ3RoKTtcbiAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IGxzdC5sZW5ndGg7IGkzKyspIHtcbiAgICBjb25zdCB7IGgsIGw6IGwzIH0gPSBmcm9tQmlnKGxzdFtpM10sIGxlKTtcbiAgICBbQWhbaTNdLCBBbFtpM11dID0gW2gsIGwzXTtcbiAgfVxuICByZXR1cm4gW0FoLCBBbF07XG59XG52YXIgVTMyX01BU0s2NCwgXzMybiwgcm90bFNILCByb3RsU0wsIHJvdGxCSCwgcm90bEJMO1xudmFyIGluaXRfdTY0ID0gX19lc20oe1xuICBcIi4uLy4uL25vZGVfbW9kdWxlcy9Abm9ibGUvaGFzaGVzL2VzbS9fdTY0LmpzXCIoKSB7XG4gICAgVTMyX01BU0s2NCA9IC8qICAgICAgICAgICAqLyBCaWdJbnQoMiAqKiAzMiAtIDEpO1xuICAgIF8zMm4gPSAvKiAgICAgICAgICAgKi8gQmlnSW50KDMyKTtcbiAgICByb3RsU0ggPSAoaCwgbDMsIHMzKSA9PiBoIDw8IHMzIHwgbDMgPj4+IDMyIC0gczM7XG4gICAgcm90bFNMID0gKGgsIGwzLCBzMykgPT4gbDMgPDwgczMgfCBoID4+PiAzMiAtIHMzO1xuICAgIHJvdGxCSCA9IChoLCBsMywgczMpID0+IGwzIDw8IHMzIC0gMzIgfCBoID4+PiA2NCAtIHMzO1xuICAgIHJvdGxCTCA9IChoLCBsMywgczMpID0+IGggPDwgczMgLSAzMiB8IGwzID4+PiA2NCAtIHMzO1xuICB9XG59KTtcblxuLy9cbmZ1bmN0aW9uIGtlY2Nha1AoczMsIHJvdW5kcyA9IDI0KSB7XG4gIGNvbnN0IEIyID0gbmV3IFVpbnQzMkFycmF5KDUgKiAyKTtcbiAgZm9yIChsZXQgcm91bmQgPSAyNCAtIHJvdW5kczsgcm91bmQgPCAyNDsgcm91bmQrKykge1xuICAgIGZvciAobGV0IHggPSAwOyB4IDwgMTA7IHgrKylcbiAgICAgIEIyW3hdID0gczNbeF0gXiBzM1t4ICsgMTBdIF4gczNbeCArIDIwXSBeIHMzW3ggKyAzMF0gXiBzM1t4ICsgNDBdO1xuICAgIGZvciAobGV0IHggPSAwOyB4IDwgMTA7IHggKz0gMikge1xuICAgICAgY29uc3QgaWR4MSA9ICh4ICsgOCkgJSAxMDtcbiAgICAgIGNvbnN0IGlkeDAgPSAoeCArIDIpICUgMTA7XG4gICAgICBjb25zdCBCMCA9IEIyW2lkeDBdO1xuICAgICAgY29uc3QgQjEgPSBCMltpZHgwICsgMV07XG4gICAgICBjb25zdCBUaCA9IHJvdGxIKEIwLCBCMSwgMSkgXiBCMltpZHgxXTtcbiAgICAgIGNvbnN0IFRsID0gcm90bEwoQjAsIEIxLCAxKSBeIEIyW2lkeDEgKyAxXTtcbiAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgNTA7IHkgKz0gMTApIHtcbiAgICAgICAgczNbeCArIHldIF49IFRoO1xuICAgICAgICBzM1t4ICsgeSArIDFdIF49IFRsO1xuICAgICAgfVxuICAgIH1cbiAgICBsZXQgY3VySCA9IHMzWzJdO1xuICAgIGxldCBjdXJMID0gczNbM107XG4gICAgZm9yIChsZXQgdDUgPSAwOyB0NSA8IDI0OyB0NSsrKSB7XG4gICAgICBjb25zdCBzaGlmdCA9IFNIQTNfUk9UTFt0NV07XG4gICAgICBjb25zdCBUaCA9IHJvdGxIKGN1ckgsIGN1ckwsIHNoaWZ0KTtcbiAgICAgIGNvbnN0IFRsID0gcm90bEwoY3VySCwgY3VyTCwgc2hpZnQpO1xuICAgICAgY29uc3QgUEkgPSBTSEEzX1BJW3Q1XTtcbiAgICAgIGN1ckggPSBzM1tQSV07XG4gICAgICBjdXJMID0gczNbUEkgKyAxXTtcbiAgICAgIHMzW1BJXSA9IFRoO1xuICAgICAgczNbUEkgKyAxXSA9IFRsO1xuICAgIH1cbiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IDUwOyB5ICs9IDEwKSB7XG4gICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IDEwOyB4KyspXG4gICAgICAgIEIyW3hdID0gczNbeSArIHhdO1xuICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCAxMDsgeCsrKVxuICAgICAgICBzM1t5ICsgeF0gXj0gfkIyWyh4ICsgMikgJSAxMF0gJiBCMlsoeCArIDQpICUgMTBdO1xuICAgIH1cbiAgICBzM1swXSBePSBTSEEzX0lPVEFfSFtyb3VuZF07XG4gICAgczNbMV0gXj0gU0hBM19JT1RBX0xbcm91bmRdO1xuICB9XG4gIEIyLmZpbGwoMCk7XG59XG52YXIgU0hBM19QSSwgU0hBM19ST1RMLCBfU0hBM19JT1RBLCBfMG4sIF8xbiwgXzJuLCBfN24sIF8yNTZuLCBfMHg3MW4sIFNIQTNfSU9UQV9ILCBTSEEzX0lPVEFfTCwgcm90bEgsIHJvdGxMLCBLZWNjYWssIGdlbiwgc2hhM18yMjQsIHNoYTNfMjU2LCBzaGEzXzM4NCwgc2hhM181MTIsIGtlY2Nha18yMjQsIGtlY2Nha18yNTYsIGtlY2Nha18zODQsIGtlY2Nha181MTIsIGdlblNoYWtlLCBzaGFrZTEyOCwgc2hha2UyNTY7XG52YXIgaW5pdF9zaGEzID0gX19lc20oe1xuICBcIi4uLy4uL25vZGVfbW9kdWxlcy9Abm9ibGUvaGFzaGVzL2VzbS9zaGEzLmpzXCIoKSB7XG4gICAgaW5pdF9hc3NlcnQoKTtcbiAgICBpbml0X3U2NCgpO1xuICAgIGluaXRfdXRpbHMoKTtcbiAgICBTSEEzX1BJID0gW107XG4gICAgU0hBM19ST1RMID0gW107XG4gICAgX1NIQTNfSU9UQSA9IFtdO1xuICAgIF8wbiA9IC8qICAgICAgICAgICAqLyBCaWdJbnQoMCk7XG4gICAgXzFuID0gLyogICAgICAgICAgICovIEJpZ0ludCgxKTtcbiAgICBfMm4gPSAvKiAgICAgICAgICAgKi8gQmlnSW50KDIpO1xuICAgIF83biA9IC8qICAgICAgICAgICAqLyBCaWdJbnQoNyk7XG4gICAgXzI1Nm4gPSAvKiAgICAgICAgICAgKi8gQmlnSW50KDI1Nik7XG4gICAgXzB4NzFuID0gLyogICAgICAgICAgICovIEJpZ0ludCgxMTMpO1xuICAgIGZvciAobGV0IHJvdW5kID0gMCwgUiA9IF8xbiwgeCA9IDEsIHkgPSAwOyByb3VuZCA8IDI0OyByb3VuZCsrKSB7XG4gICAgICBbeCwgeV0gPSBbeSwgKDIgKiB4ICsgMyAqIHkpICUgNV07XG4gICAgICBTSEEzX1BJLnB1c2goMiAqICg1ICogeSArIHgpKTtcbiAgICAgIFNIQTNfUk9UTC5wdXNoKChyb3VuZCArIDEpICogKHJvdW5kICsgMikgLyAyICUgNjQpO1xuICAgICAgbGV0IHQ1ID0gXzBuO1xuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCA3OyBqKyspIHtcbiAgICAgICAgUiA9IChSIDw8IF8xbiBeIChSID4+IF83bikgKiBfMHg3MW4pICUgXzI1Nm47XG4gICAgICAgIGlmIChSICYgXzJuKVxuICAgICAgICAgIHQ1IF49IF8xbiA8PCAoXzFuIDw8IC8qICAgICAgICAgICAqLyBCaWdJbnQoaikpIC0gXzFuO1xuICAgICAgfVxuICAgICAgX1NIQTNfSU9UQS5wdXNoKHQ1KTtcbiAgICB9XG4gICAgW1NIQTNfSU9UQV9ILCBTSEEzX0lPVEFfTF0gPSAvKiAgICAgICAgICAgKi8gc3BsaXQoX1NIQTNfSU9UQSwgdHJ1ZSk7XG4gICAgcm90bEggPSAoaCwgbDMsIHMzKSA9PiBzMyA+IDMyID8gcm90bEJIKGgsIGwzLCBzMykgOiByb3RsU0goaCwgbDMsIHMzKTtcbiAgICByb3RsTCA9IChoLCBsMywgczMpID0+IHMzID4gMzIgPyByb3RsQkwoaCwgbDMsIHMzKSA6IHJvdGxTTChoLCBsMywgczMpO1xuICAgIEtlY2NhayA9IGNsYXNzIF9LZWNjYWsgZXh0ZW5kcyBIYXNoIHtcbiAgICAgIC8vXG4gICAgICBjb25zdHJ1Y3RvcihibG9ja0xlbiwgc3VmZml4LCBvdXRwdXRMZW4sIGVuYWJsZVhPRiA9IGZhbHNlLCByb3VuZHMgPSAyNCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmJsb2NrTGVuID0gYmxvY2tMZW47XG4gICAgICAgIHRoaXMuc3VmZml4ID0gc3VmZml4O1xuICAgICAgICB0aGlzLm91dHB1dExlbiA9IG91dHB1dExlbjtcbiAgICAgICAgdGhpcy5lbmFibGVYT0YgPSBlbmFibGVYT0Y7XG4gICAgICAgIHRoaXMucm91bmRzID0gcm91bmRzO1xuICAgICAgICB0aGlzLnBvcyA9IDA7XG4gICAgICAgIHRoaXMucG9zT3V0ID0gMDtcbiAgICAgICAgdGhpcy5maW5pc2hlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmRlc3Ryb3llZCA9IGZhbHNlO1xuICAgICAgICBudW1iZXIob3V0cHV0TGVuKTtcbiAgICAgICAgaWYgKDAgPj0gdGhpcy5ibG9ja0xlbiB8fCB0aGlzLmJsb2NrTGVuID49IDIwMClcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTaGEzIHN1cHBvcnRzIG9ubHkga2VjY2FrLWYxNjAwIGZ1bmN0aW9uXCIpO1xuICAgICAgICB0aGlzLnN0YXRlID0gbmV3IFVpbnQ4QXJyYXkoMjAwKTtcbiAgICAgICAgdGhpcy5zdGF0ZTMyID0gdTMyKHRoaXMuc3RhdGUpO1xuICAgICAgfVxuICAgICAga2VjY2FrKCkge1xuICAgICAgICBpZiAoIWlzTEUpXG4gICAgICAgICAgYnl0ZVN3YXAzMih0aGlzLnN0YXRlMzIpO1xuICAgICAgICBrZWNjYWtQKHRoaXMuc3RhdGUzMiwgdGhpcy5yb3VuZHMpO1xuICAgICAgICBpZiAoIWlzTEUpXG4gICAgICAgICAgYnl0ZVN3YXAzMih0aGlzLnN0YXRlMzIpO1xuICAgICAgICB0aGlzLnBvc091dCA9IDA7XG4gICAgICAgIHRoaXMucG9zID0gMDtcbiAgICAgIH1cbiAgICAgIHVwZGF0ZShkYXRhKSB7XG4gICAgICAgIGV4aXN0cyh0aGlzKTtcbiAgICAgICAgY29uc3QgeyBibG9ja0xlbiwgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgIGRhdGEgPSB0b0J5dGVzMihkYXRhKTtcbiAgICAgICAgY29uc3QgbGVuID0gZGF0YS5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IHBvcyA9IDA7IHBvcyA8IGxlbjsgKSB7XG4gICAgICAgICAgY29uc3QgdGFrZSA9IE1hdGgubWluKGJsb2NrTGVuIC0gdGhpcy5wb3MsIGxlbiAtIHBvcyk7XG4gICAgICAgICAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IHRha2U7IGkzKyspXG4gICAgICAgICAgICBzdGF0ZVt0aGlzLnBvcysrXSBePSBkYXRhW3BvcysrXTtcbiAgICAgICAgICBpZiAodGhpcy5wb3MgPT09IGJsb2NrTGVuKVxuICAgICAgICAgICAgdGhpcy5rZWNjYWsoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIGZpbmlzaCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZmluaXNoZWQpXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB0aGlzLmZpbmlzaGVkID0gdHJ1ZTtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSwgc3VmZml4LCBwb3MsIGJsb2NrTGVuIH0gPSB0aGlzO1xuICAgICAgICBzdGF0ZVtwb3NdIF49IHN1ZmZpeDtcbiAgICAgICAgaWYgKChzdWZmaXggJiAxMjgpICE9PSAwICYmIHBvcyA9PT0gYmxvY2tMZW4gLSAxKVxuICAgICAgICAgIHRoaXMua2VjY2FrKCk7XG4gICAgICAgIHN0YXRlW2Jsb2NrTGVuIC0gMV0gXj0gMTI4O1xuICAgICAgICB0aGlzLmtlY2NhaygpO1xuICAgICAgfVxuICAgICAgd3JpdGVJbnRvKG91dCkge1xuICAgICAgICBleGlzdHModGhpcywgZmFsc2UpO1xuICAgICAgICBieXRlcyhvdXQpO1xuICAgICAgICB0aGlzLmZpbmlzaCgpO1xuICAgICAgICBjb25zdCBidWZmZXJPdXQgPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB7IGJsb2NrTGVuIH0gPSB0aGlzO1xuICAgICAgICBmb3IgKGxldCBwb3MgPSAwLCBsZW4gPSBvdXQubGVuZ3RoOyBwb3MgPCBsZW47ICkge1xuICAgICAgICAgIGlmICh0aGlzLnBvc091dCA+PSBibG9ja0xlbilcbiAgICAgICAgICAgIHRoaXMua2VjY2FrKCk7XG4gICAgICAgICAgY29uc3QgdGFrZSA9IE1hdGgubWluKGJsb2NrTGVuIC0gdGhpcy5wb3NPdXQsIGxlbiAtIHBvcyk7XG4gICAgICAgICAgb3V0LnNldChidWZmZXJPdXQuc3ViYXJyYXkodGhpcy5wb3NPdXQsIHRoaXMucG9zT3V0ICsgdGFrZSksIHBvcyk7XG4gICAgICAgICAgdGhpcy5wb3NPdXQgKz0gdGFrZTtcbiAgICAgICAgICBwb3MgKz0gdGFrZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0O1xuICAgICAgfVxuICAgICAgeG9mSW50byhvdXQpIHtcbiAgICAgICAgaWYgKCF0aGlzLmVuYWJsZVhPRilcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJYT0YgaXMgbm90IHBvc3NpYmxlIGZvciB0aGlzIGluc3RhbmNlXCIpO1xuICAgICAgICByZXR1cm4gdGhpcy53cml0ZUludG8ob3V0KTtcbiAgICAgIH1cbiAgICAgIHhvZihieXRlczIpIHtcbiAgICAgICAgbnVtYmVyKGJ5dGVzMik7XG4gICAgICAgIHJldHVybiB0aGlzLnhvZkludG8obmV3IFVpbnQ4QXJyYXkoYnl0ZXMyKSk7XG4gICAgICB9XG4gICAgICBkaWdlc3RJbnRvKG91dCkge1xuICAgICAgICBvdXRwdXQob3V0LCB0aGlzKTtcbiAgICAgICAgaWYgKHRoaXMuZmluaXNoZWQpXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZGlnZXN0KCkgd2FzIGFscmVhZHkgY2FsbGVkXCIpO1xuICAgICAgICB0aGlzLndyaXRlSW50byhvdXQpO1xuICAgICAgICB0aGlzLmRlc3Ryb3koKTtcbiAgICAgICAgcmV0dXJuIG91dDtcbiAgICAgIH1cbiAgICAgIGRpZ2VzdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlnZXN0SW50byhuZXcgVWludDhBcnJheSh0aGlzLm91dHB1dExlbikpO1xuICAgICAgfVxuICAgICAgZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5kZXN0cm95ZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLnN0YXRlLmZpbGwoMCk7XG4gICAgICB9XG4gICAgICBfY2xvbmVJbnRvKHRvKSB7XG4gICAgICAgIGNvbnN0IHsgYmxvY2tMZW4sIHN1ZmZpeCwgb3V0cHV0TGVuLCByb3VuZHMsIGVuYWJsZVhPRiB9ID0gdGhpcztcbiAgICAgICAgdG8gfHwgKHRvID0gbmV3IF9LZWNjYWsoYmxvY2tMZW4sIHN1ZmZpeCwgb3V0cHV0TGVuLCBlbmFibGVYT0YsIHJvdW5kcykpO1xuICAgICAgICB0by5zdGF0ZTMyLnNldCh0aGlzLnN0YXRlMzIpO1xuICAgICAgICB0by5wb3MgPSB0aGlzLnBvcztcbiAgICAgICAgdG8ucG9zT3V0ID0gdGhpcy5wb3NPdXQ7XG4gICAgICAgIHRvLmZpbmlzaGVkID0gdGhpcy5maW5pc2hlZDtcbiAgICAgICAgdG8ucm91bmRzID0gcm91bmRzO1xuICAgICAgICB0by5zdWZmaXggPSBzdWZmaXg7XG4gICAgICAgIHRvLm91dHB1dExlbiA9IG91dHB1dExlbjtcbiAgICAgICAgdG8uZW5hYmxlWE9GID0gZW5hYmxlWE9GO1xuICAgICAgICB0by5kZXN0cm95ZWQgPSB0aGlzLmRlc3Ryb3llZDtcbiAgICAgICAgcmV0dXJuIHRvO1xuICAgICAgfVxuICAgIH07XG4gICAgZ2VuID0gKHN1ZmZpeCwgYmxvY2tMZW4sIG91dHB1dExlbikgPT4gd3JhcENvbnN0cnVjdG9yKCgpID0+IG5ldyBLZWNjYWsoYmxvY2tMZW4sIHN1ZmZpeCwgb3V0cHV0TGVuKSk7XG4gICAgc2hhM18yMjQgPSAvKiAgICAgICAgICAgKi8gZ2VuKDYsIDE0NCwgMjI0IC8gOCk7XG4gICAgc2hhM18yNTYgPSAvKiAgICAgICAgICAgKi8gZ2VuKDYsIDEzNiwgMjU2IC8gOCk7XG4gICAgc2hhM18zODQgPSAvKiAgICAgICAgICAgKi8gZ2VuKDYsIDEwNCwgMzg0IC8gOCk7XG4gICAgc2hhM181MTIgPSAvKiAgICAgICAgICAgKi8gZ2VuKDYsIDcyLCA1MTIgLyA4KTtcbiAgICBrZWNjYWtfMjI0ID0gLyogICAgICAgICAgICovIGdlbigxLCAxNDQsIDIyNCAvIDgpO1xuICAgIGtlY2Nha18yNTYgPSAvKiAgICAgICAgICAgKi8gZ2VuKDEsIDEzNiwgMjU2IC8gOCk7XG4gICAga2VjY2FrXzM4NCA9IC8qICAgICAgICAgICAqLyBnZW4oMSwgMTA0LCAzODQgLyA4KTtcbiAgICBrZWNjYWtfNTEyID0gLyogICAgICAgICAgICovIGdlbigxLCA3MiwgNTEyIC8gOCk7XG4gICAgZ2VuU2hha2UgPSAoc3VmZml4LCBibG9ja0xlbiwgb3V0cHV0TGVuKSA9PiB3cmFwWE9GQ29uc3RydWN0b3JXaXRoT3B0cygob3B0cyA9IHt9KSA9PiBuZXcgS2VjY2FrKGJsb2NrTGVuLCBzdWZmaXgsIG9wdHMuZGtMZW4gPT09IHZvaWQgMCA/IG91dHB1dExlbiA6IG9wdHMuZGtMZW4sIHRydWUpKTtcbiAgICBzaGFrZTEyOCA9IC8qICAgICAgICAgICAqLyBnZW5TaGFrZSgzMSwgMTY4LCAxMjggLyA4KTtcbiAgICBzaGFrZTI1NiA9IC8qICAgICAgICAgICAqLyBnZW5TaGFrZSgzMSwgMTM2LCAyNTYgLyA4KTtcbiAgfVxufSk7XG5cbi8vXG5mdW5jdGlvbiBleGVjVHlwZWQocmVnZXgsIHN0cmluZykge1xuICBjb25zdCBtYXRjaCA9IHJlZ2V4LmV4ZWMoc3RyaW5nKTtcbiAgcmV0dXJuIG1hdGNoPy5ncm91cHM7XG59XG5mdW5jdGlvbiBmb3JtYXRBYmlQYXJhbWV0ZXIoYWJpUGFyYW1ldGVyKSB7XG4gIGxldCB0eXBlID0gYWJpUGFyYW1ldGVyLnR5cGU7XG4gIGlmICh0dXBsZVJlZ2V4LnRlc3QoYWJpUGFyYW1ldGVyLnR5cGUpICYmIFwiY29tcG9uZW50c1wiIGluIGFiaVBhcmFtZXRlcikge1xuICAgIHR5cGUgPSBcIihcIjtcbiAgICBjb25zdCBsZW5ndGggPSBhYmlQYXJhbWV0ZXIuY29tcG9uZW50cy5sZW5ndGg7XG4gICAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IGxlbmd0aDsgaTMrKykge1xuICAgICAgY29uc3QgY29tcG9uZW50ID0gYWJpUGFyYW1ldGVyLmNvbXBvbmVudHNbaTNdO1xuICAgICAgdHlwZSArPSBmb3JtYXRBYmlQYXJhbWV0ZXIoY29tcG9uZW50KTtcbiAgICAgIGlmIChpMyA8IGxlbmd0aCAtIDEpXG4gICAgICAgIHR5cGUgKz0gXCIsIFwiO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQgPSBleGVjVHlwZWQodHVwbGVSZWdleCwgYWJpUGFyYW1ldGVyLnR5cGUpO1xuICAgIHR5cGUgKz0gYCkke3Jlc3VsdD8uYXJyYXkgPz8gXCJcIn1gO1xuICAgIHJldHVybiBmb3JtYXRBYmlQYXJhbWV0ZXIoe1xuICAgICAgLi4uYWJpUGFyYW1ldGVyLFxuICAgICAgdHlwZVxuICAgIH0pO1xuICB9XG4gIGlmIChcImluZGV4ZWRcIiBpbiBhYmlQYXJhbWV0ZXIgJiYgYWJpUGFyYW1ldGVyLmluZGV4ZWQpXG4gICAgdHlwZSA9IGAke3R5cGV9IGluZGV4ZWRgO1xuICBpZiAoYWJpUGFyYW1ldGVyLm5hbWUpXG4gICAgcmV0dXJuIGAke3R5cGV9ICR7YWJpUGFyYW1ldGVyLm5hbWV9YDtcbiAgcmV0dXJuIHR5cGU7XG59XG5mdW5jdGlvbiBmb3JtYXRBYmlQYXJhbWV0ZXJzKGFiaVBhcmFtZXRlcnMpIHtcbiAgbGV0IHBhcmFtcyA9IFwiXCI7XG4gIGNvbnN0IGxlbmd0aCA9IGFiaVBhcmFtZXRlcnMubGVuZ3RoO1xuICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgbGVuZ3RoOyBpMysrKSB7XG4gICAgY29uc3QgYWJpUGFyYW1ldGVyID0gYWJpUGFyYW1ldGVyc1tpM107XG4gICAgcGFyYW1zICs9IGZvcm1hdEFiaVBhcmFtZXRlcihhYmlQYXJhbWV0ZXIpO1xuICAgIGlmIChpMyAhPT0gbGVuZ3RoIC0gMSlcbiAgICAgIHBhcmFtcyArPSBcIiwgXCI7XG4gIH1cbiAgcmV0dXJuIHBhcmFtcztcbn1cbmZ1bmN0aW9uIGZvcm1hdEFiaUl0ZW0oYWJpSXRlbSkge1xuICBpZiAoYWJpSXRlbS50eXBlID09PSBcImZ1bmN0aW9uXCIpXG4gICAgcmV0dXJuIGBmdW5jdGlvbiAke2FiaUl0ZW0ubmFtZX0oJHtmb3JtYXRBYmlQYXJhbWV0ZXJzKGFiaUl0ZW0uaW5wdXRzKX0pJHthYmlJdGVtLnN0YXRlTXV0YWJpbGl0eSAmJiBhYmlJdGVtLnN0YXRlTXV0YWJpbGl0eSAhPT0gXCJub25wYXlhYmxlXCIgPyBgICR7YWJpSXRlbS5zdGF0ZU11dGFiaWxpdHl9YCA6IFwiXCJ9JHthYmlJdGVtLm91dHB1dHM/Lmxlbmd0aCA/IGAgcmV0dXJucyAoJHtmb3JtYXRBYmlQYXJhbWV0ZXJzKGFiaUl0ZW0ub3V0cHV0cyl9KWAgOiBcIlwifWA7XG4gIGlmIChhYmlJdGVtLnR5cGUgPT09IFwiZXZlbnRcIilcbiAgICByZXR1cm4gYGV2ZW50ICR7YWJpSXRlbS5uYW1lfSgke2Zvcm1hdEFiaVBhcmFtZXRlcnMoYWJpSXRlbS5pbnB1dHMpfSlgO1xuICBpZiAoYWJpSXRlbS50eXBlID09PSBcImVycm9yXCIpXG4gICAgcmV0dXJuIGBlcnJvciAke2FiaUl0ZW0ubmFtZX0oJHtmb3JtYXRBYmlQYXJhbWV0ZXJzKGFiaUl0ZW0uaW5wdXRzKX0pYDtcbiAgaWYgKGFiaUl0ZW0udHlwZSA9PT0gXCJjb25zdHJ1Y3RvclwiKVxuICAgIHJldHVybiBgY29uc3RydWN0b3IoJHtmb3JtYXRBYmlQYXJhbWV0ZXJzKGFiaUl0ZW0uaW5wdXRzKX0pJHthYmlJdGVtLnN0YXRlTXV0YWJpbGl0eSA9PT0gXCJwYXlhYmxlXCIgPyBcIiBwYXlhYmxlXCIgOiBcIlwifWA7XG4gIGlmIChhYmlJdGVtLnR5cGUgPT09IFwiZmFsbGJhY2tcIilcbiAgICByZXR1cm4gYGZhbGxiYWNrKCkgZXh0ZXJuYWwke2FiaUl0ZW0uc3RhdGVNdXRhYmlsaXR5ID09PSBcInBheWFibGVcIiA/IFwiIHBheWFibGVcIiA6IFwiXCJ9YDtcbiAgcmV0dXJuIFwicmVjZWl2ZSgpIGV4dGVybmFsIHBheWFibGVcIjtcbn1cbmZ1bmN0aW9uIHdhbGsyKGVyciwgZm4pIHtcbiAgaWYgKGZuPy4oZXJyKSlcbiAgICByZXR1cm4gZXJyO1xuICBpZiAoZXJyICYmIHR5cGVvZiBlcnIgPT09IFwib2JqZWN0XCIgJiYgXCJjYXVzZVwiIGluIGVyciAmJiBlcnIuY2F1c2UgIT09IHZvaWQgMClcbiAgICByZXR1cm4gd2FsazIoZXJyLmNhdXNlLCBmbik7XG4gIHJldHVybiBmbiA/IG51bGwgOiBlcnI7XG59XG5mdW5jdGlvbiBmb3JtYXRBYmlJdGVtMihhYmlJdGVtLCB7IGluY2x1ZGVOYW1lID0gZmFsc2UgfSA9IHt9KSB7XG4gIGlmIChhYmlJdGVtLnR5cGUgIT09IFwiZnVuY3Rpb25cIiAmJiBhYmlJdGVtLnR5cGUgIT09IFwiZXZlbnRcIiAmJiBhYmlJdGVtLnR5cGUgIT09IFwiZXJyb3JcIilcbiAgICB0aHJvdyBuZXcgSW52YWxpZERlZmluaXRpb25UeXBlRXJyb3IoYWJpSXRlbS50eXBlKTtcbiAgcmV0dXJuIGAke2FiaUl0ZW0ubmFtZX0oJHtmb3JtYXRBYmlQYXJhbXMoYWJpSXRlbS5pbnB1dHMsIHsgaW5jbHVkZU5hbWUgfSl9KWA7XG59XG5mdW5jdGlvbiBmb3JtYXRBYmlQYXJhbXMocGFyYW1zLCB7IGluY2x1ZGVOYW1lID0gZmFsc2UgfSA9IHt9KSB7XG4gIGlmICghcGFyYW1zKVxuICAgIHJldHVybiBcIlwiO1xuICByZXR1cm4gcGFyYW1zLm1hcCgocGFyYW0pID0+IGZvcm1hdEFiaVBhcmFtKHBhcmFtLCB7IGluY2x1ZGVOYW1lIH0pKS5qb2luKGluY2x1ZGVOYW1lID8gXCIsIFwiIDogXCIsXCIpO1xufVxuZnVuY3Rpb24gZm9ybWF0QWJpUGFyYW0ocGFyYW0sIHsgaW5jbHVkZU5hbWUgfSkge1xuICBpZiAocGFyYW0udHlwZS5zdGFydHNXaXRoKFwidHVwbGVcIikpIHtcbiAgICByZXR1cm4gYCgke2Zvcm1hdEFiaVBhcmFtcyhwYXJhbS5jb21wb25lbnRzLCB7IGluY2x1ZGVOYW1lIH0pfSkke3BhcmFtLnR5cGUuc2xpY2UoXCJ0dXBsZVwiLmxlbmd0aCl9YDtcbiAgfVxuICByZXR1cm4gcGFyYW0udHlwZSArIChpbmNsdWRlTmFtZSAmJiBwYXJhbS5uYW1lID8gYCAke3BhcmFtLm5hbWV9YCA6IFwiXCIpO1xufVxuZnVuY3Rpb24gaXNIZXgodmFsdWUsIHsgc3RyaWN0ID0gdHJ1ZSB9ID0ge30pIHtcbiAgaWYgKCF2YWx1ZSlcbiAgICByZXR1cm4gZmFsc2U7XG4gIGlmICh0eXBlb2YgdmFsdWUgIT09IFwic3RyaW5nXCIpXG4gICAgcmV0dXJuIGZhbHNlO1xuICByZXR1cm4gc3RyaWN0ID8gL14weFswLTlhLWZBLUZdKiQvLnRlc3QodmFsdWUpIDogdmFsdWUuc3RhcnRzV2l0aChcIjB4XCIpO1xufVxuZnVuY3Rpb24gc2l6ZTIodmFsdWUpIHtcbiAgaWYgKGlzSGV4KHZhbHVlLCB7IHN0cmljdDogZmFsc2UgfSkpXG4gICAgcmV0dXJuIE1hdGguY2VpbCgodmFsdWUubGVuZ3RoIC0gMikgLyAyKTtcbiAgcmV0dXJuIHZhbHVlLmxlbmd0aDtcbn1cbmZ1bmN0aW9uIHNsaWNlKHZhbHVlLCBzdGFydDIsIGVuZCwgeyBzdHJpY3QgfSA9IHt9KSB7XG4gIGlmIChpc0hleCh2YWx1ZSwgeyBzdHJpY3Q6IGZhbHNlIH0pKVxuICAgIHJldHVybiBzbGljZUhleCh2YWx1ZSwgc3RhcnQyLCBlbmQsIHtcbiAgICAgIHN0cmljdFxuICAgIH0pO1xuICByZXR1cm4gc2xpY2VCeXRlcyh2YWx1ZSwgc3RhcnQyLCBlbmQsIHtcbiAgICBzdHJpY3RcbiAgfSk7XG59XG5mdW5jdGlvbiBhc3NlcnRTdGFydE9mZnNldDIodmFsdWUsIHN0YXJ0Mikge1xuICBpZiAodHlwZW9mIHN0YXJ0MiA9PT0gXCJudW1iZXJcIiAmJiBzdGFydDIgPiAwICYmIHN0YXJ0MiA+IHNpemUyKHZhbHVlKSAtIDEpXG4gICAgdGhyb3cgbmV3IFNsaWNlT2Zmc2V0T3V0T2ZCb3VuZHNFcnJvcjIoe1xuICAgICAgb2Zmc2V0OiBzdGFydDIsXG4gICAgICBwb3NpdGlvbjogXCJzdGFydFwiLFxuICAgICAgc2l6ZTogc2l6ZTIodmFsdWUpXG4gICAgfSk7XG59XG5mdW5jdGlvbiBhc3NlcnRFbmRPZmZzZXQyKHZhbHVlLCBzdGFydDIsIGVuZCkge1xuICBpZiAodHlwZW9mIHN0YXJ0MiA9PT0gXCJudW1iZXJcIiAmJiB0eXBlb2YgZW5kID09PSBcIm51bWJlclwiICYmIHNpemUyKHZhbHVlKSAhPT0gZW5kIC0gc3RhcnQyKSB7XG4gICAgdGhyb3cgbmV3IFNsaWNlT2Zmc2V0T3V0T2ZCb3VuZHNFcnJvcjIoe1xuICAgICAgb2Zmc2V0OiBlbmQsXG4gICAgICBwb3NpdGlvbjogXCJlbmRcIixcbiAgICAgIHNpemU6IHNpemUyKHZhbHVlKVxuICAgIH0pO1xuICB9XG59XG5mdW5jdGlvbiBzbGljZUJ5dGVzKHZhbHVlXywgc3RhcnQyLCBlbmQsIHsgc3RyaWN0IH0gPSB7fSkge1xuICBhc3NlcnRTdGFydE9mZnNldDIodmFsdWVfLCBzdGFydDIpO1xuICBjb25zdCB2YWx1ZSA9IHZhbHVlXy5zbGljZShzdGFydDIsIGVuZCk7XG4gIGlmIChzdHJpY3QpXG4gICAgYXNzZXJ0RW5kT2Zmc2V0Mih2YWx1ZSwgc3RhcnQyLCBlbmQpO1xuICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiBzbGljZUhleCh2YWx1ZV8sIHN0YXJ0MiwgZW5kLCB7IHN0cmljdCB9ID0ge30pIHtcbiAgYXNzZXJ0U3RhcnRPZmZzZXQyKHZhbHVlXywgc3RhcnQyKTtcbiAgY29uc3QgdmFsdWUgPSBgMHgke3ZhbHVlXy5yZXBsYWNlKFwiMHhcIiwgXCJcIikuc2xpY2UoKHN0YXJ0MiA/PyAwKSAqIDIsIChlbmQgPz8gdmFsdWVfLmxlbmd0aCkgKiAyKX1gO1xuICBpZiAoc3RyaWN0KVxuICAgIGFzc2VydEVuZE9mZnNldDIodmFsdWUsIHN0YXJ0MiwgZW5kKTtcbiAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gcGFkMihoZXhPckJ5dGVzLCB7IGRpciwgc2l6ZTogc2l6ZTMgPSAzMiB9ID0ge30pIHtcbiAgaWYgKHR5cGVvZiBoZXhPckJ5dGVzID09PSBcInN0cmluZ1wiKVxuICAgIHJldHVybiBwYWRIZXgoaGV4T3JCeXRlcywgeyBkaXIsIHNpemU6IHNpemUzIH0pO1xuICByZXR1cm4gcGFkQnl0ZXMoaGV4T3JCeXRlcywgeyBkaXIsIHNpemU6IHNpemUzIH0pO1xufVxuZnVuY3Rpb24gcGFkSGV4KGhleF8sIHsgZGlyLCBzaXplOiBzaXplMyA9IDMyIH0gPSB7fSkge1xuICBpZiAoc2l6ZTMgPT09IG51bGwpXG4gICAgcmV0dXJuIGhleF87XG4gIGNvbnN0IGhleCA9IGhleF8ucmVwbGFjZShcIjB4XCIsIFwiXCIpO1xuICBpZiAoaGV4Lmxlbmd0aCA+IHNpemUzICogMilcbiAgICB0aHJvdyBuZXcgU2l6ZUV4Y2VlZHNQYWRkaW5nU2l6ZUVycm9yMih7XG4gICAgICBzaXplOiBNYXRoLmNlaWwoaGV4Lmxlbmd0aCAvIDIpLFxuICAgICAgdGFyZ2V0U2l6ZTogc2l6ZTMsXG4gICAgICB0eXBlOiBcImhleFwiXG4gICAgfSk7XG4gIHJldHVybiBgMHgke2hleFtkaXIgPT09IFwicmlnaHRcIiA/IFwicGFkRW5kXCIgOiBcInBhZFN0YXJ0XCJdKHNpemUzICogMiwgXCIwXCIpfWA7XG59XG5mdW5jdGlvbiBwYWRCeXRlcyhieXRlczIsIHsgZGlyLCBzaXplOiBzaXplMyA9IDMyIH0gPSB7fSkge1xuICBpZiAoc2l6ZTMgPT09IG51bGwpXG4gICAgcmV0dXJuIGJ5dGVzMjtcbiAgaWYgKGJ5dGVzMi5sZW5ndGggPiBzaXplMylcbiAgICB0aHJvdyBuZXcgU2l6ZUV4Y2VlZHNQYWRkaW5nU2l6ZUVycm9yMih7XG4gICAgICBzaXplOiBieXRlczIubGVuZ3RoLFxuICAgICAgdGFyZ2V0U2l6ZTogc2l6ZTMsXG4gICAgICB0eXBlOiBcImJ5dGVzXCJcbiAgICB9KTtcbiAgY29uc3QgcGFkZGVkQnl0ZXMgPSBuZXcgVWludDhBcnJheShzaXplMyk7XG4gIGZvciAobGV0IGkzID0gMDsgaTMgPCBzaXplMzsgaTMrKykge1xuICAgIGNvbnN0IHBhZEVuZCA9IGRpciA9PT0gXCJyaWdodFwiO1xuICAgIHBhZGRlZEJ5dGVzW3BhZEVuZCA/IGkzIDogc2l6ZTMgLSBpMyAtIDFdID0gYnl0ZXMyW3BhZEVuZCA/IGkzIDogYnl0ZXMyLmxlbmd0aCAtIGkzIC0gMV07XG4gIH1cbiAgcmV0dXJuIHBhZGRlZEJ5dGVzO1xufVxuZnVuY3Rpb24gdHJpbTIoaGV4T3JCeXRlcywgeyBkaXIgPSBcImxlZnRcIiB9ID0ge30pIHtcbiAgbGV0IGRhdGEgPSB0eXBlb2YgaGV4T3JCeXRlcyA9PT0gXCJzdHJpbmdcIiA/IGhleE9yQnl0ZXMucmVwbGFjZShcIjB4XCIsIFwiXCIpIDogaGV4T3JCeXRlcztcbiAgbGV0IHNsaWNlTGVuZ3RoID0gMDtcbiAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IGRhdGEubGVuZ3RoIC0gMTsgaTMrKykge1xuICAgIGlmIChkYXRhW2RpciA9PT0gXCJsZWZ0XCIgPyBpMyA6IGRhdGEubGVuZ3RoIC0gaTMgLSAxXS50b1N0cmluZygpID09PSBcIjBcIilcbiAgICAgIHNsaWNlTGVuZ3RoKys7XG4gICAgZWxzZVxuICAgICAgYnJlYWs7XG4gIH1cbiAgZGF0YSA9IGRpciA9PT0gXCJsZWZ0XCIgPyBkYXRhLnNsaWNlKHNsaWNlTGVuZ3RoKSA6IGRhdGEuc2xpY2UoMCwgZGF0YS5sZW5ndGggLSBzbGljZUxlbmd0aCk7XG4gIGlmICh0eXBlb2YgaGV4T3JCeXRlcyA9PT0gXCJzdHJpbmdcIikge1xuICAgIGlmIChkYXRhLmxlbmd0aCA9PT0gMSAmJiBkaXIgPT09IFwicmlnaHRcIilcbiAgICAgIGRhdGEgPSBgJHtkYXRhfTBgO1xuICAgIHJldHVybiBgMHgke2RhdGEubGVuZ3RoICUgMiA9PT0gMSA/IGAwJHtkYXRhfWAgOiBkYXRhfWA7XG4gIH1cbiAgcmV0dXJuIGRhdGE7XG59XG5mdW5jdGlvbiBhc3NlcnRTaXplMihoZXhPckJ5dGVzLCB7IHNpemU6IHNpemUzIH0pIHtcbiAgaWYgKHNpemUyKGhleE9yQnl0ZXMpID4gc2l6ZTMpXG4gICAgdGhyb3cgbmV3IFNpemVPdmVyZmxvd0Vycm9yMih7XG4gICAgICBnaXZlblNpemU6IHNpemUyKGhleE9yQnl0ZXMpLFxuICAgICAgbWF4U2l6ZTogc2l6ZTNcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGhleFRvQmlnSW50KGhleCwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IHsgc2lnbmVkIH0gPSBvcHRzO1xuICBpZiAob3B0cy5zaXplKVxuICAgIGFzc2VydFNpemUyKGhleCwgeyBzaXplOiBvcHRzLnNpemUgfSk7XG4gIGNvbnN0IHZhbHVlID0gQmlnSW50KGhleCk7XG4gIGlmICghc2lnbmVkKVxuICAgIHJldHVybiB2YWx1ZTtcbiAgY29uc3Qgc2l6ZTMgPSAoaGV4Lmxlbmd0aCAtIDIpIC8gMjtcbiAgY29uc3QgbWF4ID0gKDFuIDw8IEJpZ0ludChzaXplMykgKiA4biAtIDFuKSAtIDFuO1xuICBpZiAodmFsdWUgPD0gbWF4KVxuICAgIHJldHVybiB2YWx1ZTtcbiAgcmV0dXJuIHZhbHVlIC0gQmlnSW50KGAweCR7XCJmXCIucGFkU3RhcnQoc2l6ZTMgKiAyLCBcImZcIil9YCkgLSAxbjtcbn1cbmZ1bmN0aW9uIGhleFRvTnVtYmVyKGhleCwgb3B0cyA9IHt9KSB7XG4gIHJldHVybiBOdW1iZXIoaGV4VG9CaWdJbnQoaGV4LCBvcHRzKSk7XG59XG5mdW5jdGlvbiB0b0hleCh2YWx1ZSwgb3B0cyA9IHt9KSB7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwibnVtYmVyXCIgfHwgdHlwZW9mIHZhbHVlID09PSBcImJpZ2ludFwiKVxuICAgIHJldHVybiBudW1iZXJUb0hleCh2YWx1ZSwgb3B0cyk7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gc3RyaW5nVG9IZXgodmFsdWUsIG9wdHMpO1xuICB9XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwiYm9vbGVhblwiKVxuICAgIHJldHVybiBib29sVG9IZXgodmFsdWUsIG9wdHMpO1xuICByZXR1cm4gYnl0ZXNUb0hleCh2YWx1ZSwgb3B0cyk7XG59XG5mdW5jdGlvbiBib29sVG9IZXgodmFsdWUsIG9wdHMgPSB7fSkge1xuICBjb25zdCBoZXggPSBgMHgke051bWJlcih2YWx1ZSl9YDtcbiAgaWYgKHR5cGVvZiBvcHRzLnNpemUgPT09IFwibnVtYmVyXCIpIHtcbiAgICBhc3NlcnRTaXplMihoZXgsIHsgc2l6ZTogb3B0cy5zaXplIH0pO1xuICAgIHJldHVybiBwYWQyKGhleCwgeyBzaXplOiBvcHRzLnNpemUgfSk7XG4gIH1cbiAgcmV0dXJuIGhleDtcbn1cbmZ1bmN0aW9uIGJ5dGVzVG9IZXgodmFsdWUsIG9wdHMgPSB7fSkge1xuICBsZXQgc3RyaW5nID0gXCJcIjtcbiAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IHZhbHVlLmxlbmd0aDsgaTMrKykge1xuICAgIHN0cmluZyArPSBoZXhlc1t2YWx1ZVtpM11dO1xuICB9XG4gIGNvbnN0IGhleCA9IGAweCR7c3RyaW5nfWA7XG4gIGlmICh0eXBlb2Ygb3B0cy5zaXplID09PSBcIm51bWJlclwiKSB7XG4gICAgYXNzZXJ0U2l6ZTIoaGV4LCB7IHNpemU6IG9wdHMuc2l6ZSB9KTtcbiAgICByZXR1cm4gcGFkMihoZXgsIHsgZGlyOiBcInJpZ2h0XCIsIHNpemU6IG9wdHMuc2l6ZSB9KTtcbiAgfVxuICByZXR1cm4gaGV4O1xufVxuZnVuY3Rpb24gbnVtYmVyVG9IZXgodmFsdWVfLCBvcHRzID0ge30pIHtcbiAgY29uc3QgeyBzaWduZWQsIHNpemU6IHNpemUzIH0gPSBvcHRzO1xuICBjb25zdCB2YWx1ZSA9IEJpZ0ludCh2YWx1ZV8pO1xuICBsZXQgbWF4VmFsdWU7XG4gIGlmIChzaXplMykge1xuICAgIGlmIChzaWduZWQpXG4gICAgICBtYXhWYWx1ZSA9ICgxbiA8PCBCaWdJbnQoc2l6ZTMpICogOG4gLSAxbikgLSAxbjtcbiAgICBlbHNlXG4gICAgICBtYXhWYWx1ZSA9IDJuICoqIChCaWdJbnQoc2l6ZTMpICogOG4pIC0gMW47XG4gIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlXyA9PT0gXCJudW1iZXJcIikge1xuICAgIG1heFZhbHVlID0gQmlnSW50KE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKTtcbiAgfVxuICBjb25zdCBtaW5WYWx1ZSA9IHR5cGVvZiBtYXhWYWx1ZSA9PT0gXCJiaWdpbnRcIiAmJiBzaWduZWQgPyAtbWF4VmFsdWUgLSAxbiA6IDA7XG4gIGlmIChtYXhWYWx1ZSAmJiB2YWx1ZSA+IG1heFZhbHVlIHx8IHZhbHVlIDwgbWluVmFsdWUpIHtcbiAgICBjb25zdCBzdWZmaXggPSB0eXBlb2YgdmFsdWVfID09PSBcImJpZ2ludFwiID8gXCJuXCIgOiBcIlwiO1xuICAgIHRocm93IG5ldyBJbnRlZ2VyT3V0T2ZSYW5nZUVycm9yMih7XG4gICAgICBtYXg6IG1heFZhbHVlID8gYCR7bWF4VmFsdWV9JHtzdWZmaXh9YCA6IHZvaWQgMCxcbiAgICAgIG1pbjogYCR7bWluVmFsdWV9JHtzdWZmaXh9YCxcbiAgICAgIHNpZ25lZCxcbiAgICAgIHNpemU6IHNpemUzLFxuICAgICAgdmFsdWU6IGAke3ZhbHVlX30ke3N1ZmZpeH1gXG4gICAgfSk7XG4gIH1cbiAgY29uc3QgaGV4ID0gYDB4JHsoc2lnbmVkICYmIHZhbHVlIDwgMCA/ICgxbiA8PCBCaWdJbnQoc2l6ZTMgKiA4KSkgKyBCaWdJbnQodmFsdWUpIDogdmFsdWUpLnRvU3RyaW5nKDE2KX1gO1xuICBpZiAoc2l6ZTMpXG4gICAgcmV0dXJuIHBhZDIoaGV4LCB7IHNpemU6IHNpemUzIH0pO1xuICByZXR1cm4gaGV4O1xufVxuZnVuY3Rpb24gc3RyaW5nVG9IZXgodmFsdWVfLCBvcHRzID0ge30pIHtcbiAgY29uc3QgdmFsdWUgPSBlbmNvZGVyLmVuY29kZSh2YWx1ZV8pO1xuICByZXR1cm4gYnl0ZXNUb0hleCh2YWx1ZSwgb3B0cyk7XG59XG5mdW5jdGlvbiB0b0J5dGVzMyh2YWx1ZSwgb3B0cyA9IHt9KSB7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwibnVtYmVyXCIgfHwgdHlwZW9mIHZhbHVlID09PSBcImJpZ2ludFwiKVxuICAgIHJldHVybiBudW1iZXJUb0J5dGVzKHZhbHVlLCBvcHRzKTtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJib29sZWFuXCIpXG4gICAgcmV0dXJuIGJvb2xUb0J5dGVzKHZhbHVlLCBvcHRzKTtcbiAgaWYgKGlzSGV4KHZhbHVlKSlcbiAgICByZXR1cm4gaGV4VG9CeXRlcyh2YWx1ZSwgb3B0cyk7XG4gIHJldHVybiBzdHJpbmdUb0J5dGVzKHZhbHVlLCBvcHRzKTtcbn1cbmZ1bmN0aW9uIGJvb2xUb0J5dGVzKHZhbHVlLCBvcHRzID0ge30pIHtcbiAgY29uc3QgYnl0ZXMyID0gbmV3IFVpbnQ4QXJyYXkoMSk7XG4gIGJ5dGVzMlswXSA9IE51bWJlcih2YWx1ZSk7XG4gIGlmICh0eXBlb2Ygb3B0cy5zaXplID09PSBcIm51bWJlclwiKSB7XG4gICAgYXNzZXJ0U2l6ZTIoYnl0ZXMyLCB7IHNpemU6IG9wdHMuc2l6ZSB9KTtcbiAgICByZXR1cm4gcGFkMihieXRlczIsIHsgc2l6ZTogb3B0cy5zaXplIH0pO1xuICB9XG4gIHJldHVybiBieXRlczI7XG59XG5mdW5jdGlvbiBjaGFyQ29kZVRvQmFzZTE2KGNoYXIpIHtcbiAgaWYgKGNoYXIgPj0gY2hhckNvZGVNYXAuemVybyAmJiBjaGFyIDw9IGNoYXJDb2RlTWFwLm5pbmUpXG4gICAgcmV0dXJuIGNoYXIgLSBjaGFyQ29kZU1hcC56ZXJvO1xuICBpZiAoY2hhciA+PSBjaGFyQ29kZU1hcC5BICYmIGNoYXIgPD0gY2hhckNvZGVNYXAuRilcbiAgICByZXR1cm4gY2hhciAtIChjaGFyQ29kZU1hcC5BIC0gMTApO1xuICBpZiAoY2hhciA+PSBjaGFyQ29kZU1hcC5hICYmIGNoYXIgPD0gY2hhckNvZGVNYXAuZilcbiAgICByZXR1cm4gY2hhciAtIChjaGFyQ29kZU1hcC5hIC0gMTApO1xuICByZXR1cm4gdm9pZCAwO1xufVxuZnVuY3Rpb24gaGV4VG9CeXRlcyhoZXhfLCBvcHRzID0ge30pIHtcbiAgbGV0IGhleCA9IGhleF87XG4gIGlmIChvcHRzLnNpemUpIHtcbiAgICBhc3NlcnRTaXplMihoZXgsIHsgc2l6ZTogb3B0cy5zaXplIH0pO1xuICAgIGhleCA9IHBhZDIoaGV4LCB7IGRpcjogXCJyaWdodFwiLCBzaXplOiBvcHRzLnNpemUgfSk7XG4gIH1cbiAgbGV0IGhleFN0cmluZyA9IGhleC5zbGljZSgyKTtcbiAgaWYgKGhleFN0cmluZy5sZW5ndGggJSAyKVxuICAgIGhleFN0cmluZyA9IGAwJHtoZXhTdHJpbmd9YDtcbiAgY29uc3QgbGVuZ3RoID0gaGV4U3RyaW5nLmxlbmd0aCAvIDI7XG4gIGNvbnN0IGJ5dGVzMiA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7XG4gIGZvciAobGV0IGluZGV4ID0gMCwgaiA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgY29uc3QgbmliYmxlTGVmdCA9IGNoYXJDb2RlVG9CYXNlMTYoaGV4U3RyaW5nLmNoYXJDb2RlQXQoaisrKSk7XG4gICAgY29uc3QgbmliYmxlUmlnaHQgPSBjaGFyQ29kZVRvQmFzZTE2KGhleFN0cmluZy5jaGFyQ29kZUF0KGorKykpO1xuICAgIGlmIChuaWJibGVMZWZ0ID09PSB2b2lkIDAgfHwgbmliYmxlUmlnaHQgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgbmV3IEJhc2VFcnJvcjMoYEludmFsaWQgYnl0ZSBzZXF1ZW5jZSAoXCIke2hleFN0cmluZ1tqIC0gMl19JHtoZXhTdHJpbmdbaiAtIDFdfVwiIGluIFwiJHtoZXhTdHJpbmd9XCIpLmApO1xuICAgIH1cbiAgICBieXRlczJbaW5kZXhdID0gbmliYmxlTGVmdCAqIDE2ICsgbmliYmxlUmlnaHQ7XG4gIH1cbiAgcmV0dXJuIGJ5dGVzMjtcbn1cbmZ1bmN0aW9uIG51bWJlclRvQnl0ZXModmFsdWUsIG9wdHMpIHtcbiAgY29uc3QgaGV4ID0gbnVtYmVyVG9IZXgodmFsdWUsIG9wdHMpO1xuICByZXR1cm4gaGV4VG9CeXRlcyhoZXgpO1xufVxuZnVuY3Rpb24gc3RyaW5nVG9CeXRlcyh2YWx1ZSwgb3B0cyA9IHt9KSB7XG4gIGNvbnN0IGJ5dGVzMiA9IGVuY29kZXIyLmVuY29kZSh2YWx1ZSk7XG4gIGlmICh0eXBlb2Ygb3B0cy5zaXplID09PSBcIm51bWJlclwiKSB7XG4gICAgYXNzZXJ0U2l6ZTIoYnl0ZXMyLCB7IHNpemU6IG9wdHMuc2l6ZSB9KTtcbiAgICByZXR1cm4gcGFkMihieXRlczIsIHsgZGlyOiBcInJpZ2h0XCIsIHNpemU6IG9wdHMuc2l6ZSB9KTtcbiAgfVxuICByZXR1cm4gYnl0ZXMyO1xufVxuZnVuY3Rpb24ga2VjY2FrMjU2KHZhbHVlLCB0b18pIHtcbiAgY29uc3QgdG8gPSB0b18gfHwgXCJoZXhcIjtcbiAgY29uc3QgYnl0ZXMyID0ga2VjY2FrXzI1Nihpc0hleCh2YWx1ZSwgeyBzdHJpY3Q6IGZhbHNlIH0pID8gdG9CeXRlczModmFsdWUpIDogdmFsdWUpO1xuICBpZiAodG8gPT09IFwiYnl0ZXNcIilcbiAgICByZXR1cm4gYnl0ZXMyO1xuICByZXR1cm4gdG9IZXgoYnl0ZXMyKTtcbn1cbmZ1bmN0aW9uIGhhc2hTaWduYXR1cmUoc2lnKSB7XG4gIHJldHVybiBoYXNoKHNpZyk7XG59XG5mdW5jdGlvbiBub3JtYWxpemVTaWduYXR1cmUoc2lnbmF0dXJlKSB7XG4gIGxldCBhY3RpdmUgPSB0cnVlO1xuICBsZXQgY3VycmVudCA9IFwiXCI7XG4gIGxldCBsZXZlbCA9IDA7XG4gIGxldCByZXN1bHQgPSBcIlwiO1xuICBsZXQgdmFsaWQgPSBmYWxzZTtcbiAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IHNpZ25hdHVyZS5sZW5ndGg7IGkzKyspIHtcbiAgICBjb25zdCBjaGFyID0gc2lnbmF0dXJlW2kzXTtcbiAgICBpZiAoW1wiKFwiLCBcIilcIiwgXCIsXCJdLmluY2x1ZGVzKGNoYXIpKVxuICAgICAgYWN0aXZlID0gdHJ1ZTtcbiAgICBpZiAoY2hhciA9PT0gXCIoXCIpXG4gICAgICBsZXZlbCsrO1xuICAgIGlmIChjaGFyID09PSBcIilcIilcbiAgICAgIGxldmVsLS07XG4gICAgaWYgKCFhY3RpdmUpXG4gICAgICBjb250aW51ZTtcbiAgICBpZiAobGV2ZWwgPT09IDApIHtcbiAgICAgIGlmIChjaGFyID09PSBcIiBcIiAmJiBbXCJldmVudFwiLCBcImZ1bmN0aW9uXCIsIFwiXCJdLmluY2x1ZGVzKHJlc3VsdCkpXG4gICAgICAgIHJlc3VsdCA9IFwiXCI7XG4gICAgICBlbHNlIHtcbiAgICAgICAgcmVzdWx0ICs9IGNoYXI7XG4gICAgICAgIGlmIChjaGFyID09PSBcIilcIikge1xuICAgICAgICAgIHZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmIChjaGFyID09PSBcIiBcIikge1xuICAgICAgaWYgKHNpZ25hdHVyZVtpMyAtIDFdICE9PSBcIixcIiAmJiBjdXJyZW50ICE9PSBcIixcIiAmJiBjdXJyZW50ICE9PSBcIiwoXCIpIHtcbiAgICAgICAgY3VycmVudCA9IFwiXCI7XG4gICAgICAgIGFjdGl2ZSA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIHJlc3VsdCArPSBjaGFyO1xuICAgIGN1cnJlbnQgKz0gY2hhcjtcbiAgfVxuICBpZiAoIXZhbGlkKVxuICAgIHRocm93IG5ldyBCYXNlRXJyb3IzKFwiVW5hYmxlIHRvIG5vcm1hbGl6ZSBzaWduYXR1cmUuXCIpO1xuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gdG9TaWduYXR1cmVIYXNoKGZuKSB7XG4gIHJldHVybiBoYXNoU2lnbmF0dXJlKHRvU2lnbmF0dXJlKGZuKSk7XG59XG5mdW5jdGlvbiBpc0FkZHJlc3MoYWRkcmVzcywgb3B0aW9ucykge1xuICBjb25zdCB7IHN0cmljdCA9IHRydWUgfSA9IG9wdGlvbnMgPz8ge307XG4gIGNvbnN0IGNhY2hlS2V5ID0gYCR7YWRkcmVzc30uJHtzdHJpY3R9YDtcbiAgaWYgKGlzQWRkcmVzc0NhY2hlLmhhcyhjYWNoZUtleSkpXG4gICAgcmV0dXJuIGlzQWRkcmVzc0NhY2hlLmdldChjYWNoZUtleSk7XG4gIGNvbnN0IHJlc3VsdCA9ICgoKSA9PiB7XG4gICAgaWYgKCFhZGRyZXNzUmVnZXgudGVzdChhZGRyZXNzKSlcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoYWRkcmVzcy50b0xvd2VyQ2FzZSgpID09PSBhZGRyZXNzKVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgaWYgKHN0cmljdClcbiAgICAgIHJldHVybiBjaGVja3N1bUFkZHJlc3MoYWRkcmVzcykgPT09IGFkZHJlc3M7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0pKCk7XG4gIGlzQWRkcmVzc0NhY2hlLnNldChjYWNoZUtleSwgcmVzdWx0KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cbmZ1bmN0aW9uIGNoZWNrc3VtQWRkcmVzcyhhZGRyZXNzXywgY2hhaW5JZCkge1xuICBpZiAoY2hlY2tzdW1BZGRyZXNzQ2FjaGUuaGFzKGAke2FkZHJlc3NffS4ke2NoYWluSWR9YCkpXG4gICAgcmV0dXJuIGNoZWNrc3VtQWRkcmVzc0NhY2hlLmdldChgJHthZGRyZXNzX30uJHtjaGFpbklkfWApO1xuICBjb25zdCBoZXhBZGRyZXNzID0gY2hhaW5JZCA/IGAke2NoYWluSWR9JHthZGRyZXNzXy50b0xvd2VyQ2FzZSgpfWAgOiBhZGRyZXNzXy5zdWJzdHJpbmcoMikudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgaGFzaDIgPSBrZWNjYWsyNTYoc3RyaW5nVG9CeXRlcyhoZXhBZGRyZXNzKSwgXCJieXRlc1wiKTtcbiAgY29uc3QgYWRkcmVzcyA9IChjaGFpbklkID8gaGV4QWRkcmVzcy5zdWJzdHJpbmcoYCR7Y2hhaW5JZH0weGAubGVuZ3RoKSA6IGhleEFkZHJlc3MpLnNwbGl0KFwiXCIpO1xuICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgNDA7IGkzICs9IDIpIHtcbiAgICBpZiAoaGFzaDJbaTMgPj4gMV0gPj4gNCA+PSA4ICYmIGFkZHJlc3NbaTNdKSB7XG4gICAgICBhZGRyZXNzW2kzXSA9IGFkZHJlc3NbaTNdLnRvVXBwZXJDYXNlKCk7XG4gICAgfVxuICAgIGlmICgoaGFzaDJbaTMgPj4gMV0gJiAxNSkgPj0gOCAmJiBhZGRyZXNzW2kzICsgMV0pIHtcbiAgICAgIGFkZHJlc3NbaTMgKyAxXSA9IGFkZHJlc3NbaTMgKyAxXS50b1VwcGVyQ2FzZSgpO1xuICAgIH1cbiAgfVxuICBjb25zdCByZXN1bHQgPSBgMHgke2FkZHJlc3Muam9pbihcIlwiKX1gO1xuICBjaGVja3N1bUFkZHJlc3NDYWNoZS5zZXQoYCR7YWRkcmVzc199LiR7Y2hhaW5JZH1gLCByZXN1bHQpO1xuICByZXR1cm4gcmVzdWx0O1xufVxuZnVuY3Rpb24gY3JlYXRlQ3Vyc29yKGJ5dGVzMiwgeyByZWN1cnNpdmVSZWFkTGltaXQgPSA4MTkyIH0gPSB7fSkge1xuICBjb25zdCBjdXJzb3IgPSBPYmplY3QuY3JlYXRlKHN0YXRpY0N1cnNvcik7XG4gIGN1cnNvci5ieXRlcyA9IGJ5dGVzMjtcbiAgY3Vyc29yLmRhdGFWaWV3ID0gbmV3IERhdGFWaWV3KGJ5dGVzMi5idWZmZXIsIGJ5dGVzMi5ieXRlT2Zmc2V0LCBieXRlczIuYnl0ZUxlbmd0aCk7XG4gIGN1cnNvci5wb3NpdGlvblJlYWRDb3VudCA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGN1cnNvci5yZWN1cnNpdmVSZWFkTGltaXQgPSByZWN1cnNpdmVSZWFkTGltaXQ7XG4gIHJldHVybiBjdXJzb3I7XG59XG5mdW5jdGlvbiBieXRlc1RvQmlnSW50KGJ5dGVzMiwgb3B0cyA9IHt9KSB7XG4gIGlmICh0eXBlb2Ygb3B0cy5zaXplICE9PSBcInVuZGVmaW5lZFwiKVxuICAgIGFzc2VydFNpemUyKGJ5dGVzMiwgeyBzaXplOiBvcHRzLnNpemUgfSk7XG4gIGNvbnN0IGhleCA9IGJ5dGVzVG9IZXgoYnl0ZXMyLCBvcHRzKTtcbiAgcmV0dXJuIGhleFRvQmlnSW50KGhleCwgb3B0cyk7XG59XG5mdW5jdGlvbiBieXRlc1RvQm9vbChieXRlc18sIG9wdHMgPSB7fSkge1xuICBsZXQgYnl0ZXMyID0gYnl0ZXNfO1xuICBpZiAodHlwZW9mIG9wdHMuc2l6ZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGFzc2VydFNpemUyKGJ5dGVzMiwgeyBzaXplOiBvcHRzLnNpemUgfSk7XG4gICAgYnl0ZXMyID0gdHJpbTIoYnl0ZXMyKTtcbiAgfVxuICBpZiAoYnl0ZXMyLmxlbmd0aCA+IDEgfHwgYnl0ZXMyWzBdID4gMSlcbiAgICB0aHJvdyBuZXcgSW52YWxpZEJ5dGVzQm9vbGVhbkVycm9yKGJ5dGVzMik7XG4gIHJldHVybiBCb29sZWFuKGJ5dGVzMlswXSk7XG59XG5mdW5jdGlvbiBieXRlc1RvTnVtYmVyKGJ5dGVzMiwgb3B0cyA9IHt9KSB7XG4gIGlmICh0eXBlb2Ygb3B0cy5zaXplICE9PSBcInVuZGVmaW5lZFwiKVxuICAgIGFzc2VydFNpemUyKGJ5dGVzMiwgeyBzaXplOiBvcHRzLnNpemUgfSk7XG4gIGNvbnN0IGhleCA9IGJ5dGVzVG9IZXgoYnl0ZXMyLCBvcHRzKTtcbiAgcmV0dXJuIGhleFRvTnVtYmVyKGhleCwgb3B0cyk7XG59XG5mdW5jdGlvbiBieXRlc1RvU3RyaW5nKGJ5dGVzXywgb3B0cyA9IHt9KSB7XG4gIGxldCBieXRlczIgPSBieXRlc187XG4gIGlmICh0eXBlb2Ygb3B0cy5zaXplICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgYXNzZXJ0U2l6ZTIoYnl0ZXMyLCB7IHNpemU6IG9wdHMuc2l6ZSB9KTtcbiAgICBieXRlczIgPSB0cmltMihieXRlczIsIHsgZGlyOiBcInJpZ2h0XCIgfSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShieXRlczIpO1xufVxuZnVuY3Rpb24gY29uY2F0KHZhbHVlczgpIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZXM4WzBdID09PSBcInN0cmluZ1wiKVxuICAgIHJldHVybiBjb25jYXRIZXgodmFsdWVzOCk7XG4gIHJldHVybiBjb25jYXRCeXRlcyh2YWx1ZXM4KTtcbn1cbmZ1bmN0aW9uIGNvbmNhdEJ5dGVzKHZhbHVlczgpIHtcbiAgbGV0IGxlbmd0aCA9IDA7XG4gIGZvciAoY29uc3QgYXJyIG9mIHZhbHVlczgpIHtcbiAgICBsZW5ndGggKz0gYXJyLmxlbmd0aDtcbiAgfVxuICBjb25zdCByZXN1bHQgPSBuZXcgVWludDhBcnJheShsZW5ndGgpO1xuICBsZXQgb2Zmc2V0ID0gMDtcbiAgZm9yIChjb25zdCBhcnIgb2YgdmFsdWVzOCkge1xuICAgIHJlc3VsdC5zZXQoYXJyLCBvZmZzZXQpO1xuICAgIG9mZnNldCArPSBhcnIubGVuZ3RoO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiBjb25jYXRIZXgodmFsdWVzOCkge1xuICByZXR1cm4gYDB4JHt2YWx1ZXM4LnJlZHVjZSgoYWNjLCB4KSA9PiBhY2MgKyB4LnJlcGxhY2UoXCIweFwiLCBcIlwiKSwgXCJcIil9YDtcbn1cbmZ1bmN0aW9uIGVuY29kZUFiaVBhcmFtZXRlcnMocGFyYW1zLCB2YWx1ZXM4KSB7XG4gIGlmIChwYXJhbXMubGVuZ3RoICE9PSB2YWx1ZXM4Lmxlbmd0aClcbiAgICB0aHJvdyBuZXcgQWJpRW5jb2RpbmdMZW5ndGhNaXNtYXRjaEVycm9yKHtcbiAgICAgIGV4cGVjdGVkTGVuZ3RoOiBwYXJhbXMubGVuZ3RoLFxuICAgICAgZ2l2ZW5MZW5ndGg6IHZhbHVlczgubGVuZ3RoXG4gICAgfSk7XG4gIGNvbnN0IHByZXBhcmVkUGFyYW1zID0gcHJlcGFyZVBhcmFtcyh7XG4gICAgcGFyYW1zLFxuICAgIHZhbHVlczogdmFsdWVzOFxuICB9KTtcbiAgY29uc3QgZGF0YSA9IGVuY29kZVBhcmFtcyhwcmVwYXJlZFBhcmFtcyk7XG4gIGlmIChkYXRhLmxlbmd0aCA9PT0gMClcbiAgICByZXR1cm4gXCIweFwiO1xuICByZXR1cm4gZGF0YTtcbn1cbmZ1bmN0aW9uIHByZXBhcmVQYXJhbXMoeyBwYXJhbXMsIHZhbHVlczogdmFsdWVzOCB9KSB7XG4gIGNvbnN0IHByZXBhcmVkUGFyYW1zID0gW107XG4gIGZvciAobGV0IGkzID0gMDsgaTMgPCBwYXJhbXMubGVuZ3RoOyBpMysrKSB7XG4gICAgcHJlcGFyZWRQYXJhbXMucHVzaChwcmVwYXJlUGFyYW0oeyBwYXJhbTogcGFyYW1zW2kzXSwgdmFsdWU6IHZhbHVlczhbaTNdIH0pKTtcbiAgfVxuICByZXR1cm4gcHJlcGFyZWRQYXJhbXM7XG59XG5mdW5jdGlvbiBwcmVwYXJlUGFyYW0oeyBwYXJhbSwgdmFsdWUgfSkge1xuICBjb25zdCBhcnJheUNvbXBvbmVudHMgPSBnZXRBcnJheUNvbXBvbmVudHMocGFyYW0udHlwZSk7XG4gIGlmIChhcnJheUNvbXBvbmVudHMpIHtcbiAgICBjb25zdCBbbGVuZ3RoLCB0eXBlXSA9IGFycmF5Q29tcG9uZW50cztcbiAgICByZXR1cm4gZW5jb2RlQXJyYXkodmFsdWUsIHsgbGVuZ3RoLCBwYXJhbTogeyAuLi5wYXJhbSwgdHlwZSB9IH0pO1xuICB9XG4gIGlmIChwYXJhbS50eXBlID09PSBcInR1cGxlXCIpIHtcbiAgICByZXR1cm4gZW5jb2RlVHVwbGUodmFsdWUsIHtcbiAgICAgIHBhcmFtXG4gICAgfSk7XG4gIH1cbiAgaWYgKHBhcmFtLnR5cGUgPT09IFwiYWRkcmVzc1wiKSB7XG4gICAgcmV0dXJuIGVuY29kZUFkZHJlc3ModmFsdWUpO1xuICB9XG4gIGlmIChwYXJhbS50eXBlID09PSBcImJvb2xcIikge1xuICAgIHJldHVybiBlbmNvZGVCb29sKHZhbHVlKTtcbiAgfVxuICBpZiAocGFyYW0udHlwZS5zdGFydHNXaXRoKFwidWludFwiKSB8fCBwYXJhbS50eXBlLnN0YXJ0c1dpdGgoXCJpbnRcIikpIHtcbiAgICBjb25zdCBzaWduZWQgPSBwYXJhbS50eXBlLnN0YXJ0c1dpdGgoXCJpbnRcIik7XG4gICAgY29uc3QgWywgLCBzaXplMyA9IFwiMjU2XCJdID0gaW50ZWdlclJlZ2V4Mi5leGVjKHBhcmFtLnR5cGUpID8/IFtdO1xuICAgIHJldHVybiBlbmNvZGVOdW1iZXIodmFsdWUsIHtcbiAgICAgIHNpZ25lZCxcbiAgICAgIHNpemU6IE51bWJlcihzaXplMylcbiAgICB9KTtcbiAgfVxuICBpZiAocGFyYW0udHlwZS5zdGFydHNXaXRoKFwiYnl0ZXNcIikpIHtcbiAgICByZXR1cm4gZW5jb2RlQnl0ZXModmFsdWUsIHsgcGFyYW0gfSk7XG4gIH1cbiAgaWYgKHBhcmFtLnR5cGUgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gZW5jb2RlU3RyaW5nKHZhbHVlKTtcbiAgfVxuICB0aHJvdyBuZXcgSW52YWxpZEFiaUVuY29kaW5nVHlwZUVycm9yKHBhcmFtLnR5cGUsIHtcbiAgICBkb2NzUGF0aDogXCIvZG9jcy9jb250cmFjdC9lbmNvZGVBYmlQYXJhbWV0ZXJzXCJcbiAgfSk7XG59XG5mdW5jdGlvbiBlbmNvZGVQYXJhbXMocHJlcGFyZWRQYXJhbXMpIHtcbiAgbGV0IHN0YXRpY1NpemUgPSAwO1xuICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgcHJlcGFyZWRQYXJhbXMubGVuZ3RoOyBpMysrKSB7XG4gICAgY29uc3QgeyBkeW5hbWljLCBlbmNvZGVkIH0gPSBwcmVwYXJlZFBhcmFtc1tpM107XG4gICAgaWYgKGR5bmFtaWMpXG4gICAgICBzdGF0aWNTaXplICs9IDMyO1xuICAgIGVsc2VcbiAgICAgIHN0YXRpY1NpemUgKz0gc2l6ZTIoZW5jb2RlZCk7XG4gIH1cbiAgY29uc3Qgc3RhdGljUGFyYW1zID0gW107XG4gIGNvbnN0IGR5bmFtaWNQYXJhbXMgPSBbXTtcbiAgbGV0IGR5bmFtaWNTaXplID0gMDtcbiAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IHByZXBhcmVkUGFyYW1zLmxlbmd0aDsgaTMrKykge1xuICAgIGNvbnN0IHsgZHluYW1pYywgZW5jb2RlZCB9ID0gcHJlcGFyZWRQYXJhbXNbaTNdO1xuICAgIGlmIChkeW5hbWljKSB7XG4gICAgICBzdGF0aWNQYXJhbXMucHVzaChudW1iZXJUb0hleChzdGF0aWNTaXplICsgZHluYW1pY1NpemUsIHsgc2l6ZTogMzIgfSkpO1xuICAgICAgZHluYW1pY1BhcmFtcy5wdXNoKGVuY29kZWQpO1xuICAgICAgZHluYW1pY1NpemUgKz0gc2l6ZTIoZW5jb2RlZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0YXRpY1BhcmFtcy5wdXNoKGVuY29kZWQpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gY29uY2F0KFsuLi5zdGF0aWNQYXJhbXMsIC4uLmR5bmFtaWNQYXJhbXNdKTtcbn1cbmZ1bmN0aW9uIGVuY29kZUFkZHJlc3ModmFsdWUpIHtcbiAgaWYgKCFpc0FkZHJlc3ModmFsdWUpKVxuICAgIHRocm93IG5ldyBJbnZhbGlkQWRkcmVzc0Vycm9yKHsgYWRkcmVzczogdmFsdWUgfSk7XG4gIHJldHVybiB7IGR5bmFtaWM6IGZhbHNlLCBlbmNvZGVkOiBwYWRIZXgodmFsdWUudG9Mb3dlckNhc2UoKSkgfTtcbn1cbmZ1bmN0aW9uIGVuY29kZUFycmF5KHZhbHVlLCB7IGxlbmd0aCwgcGFyYW0gfSkge1xuICBjb25zdCBkeW5hbWljID0gbGVuZ3RoID09PSBudWxsO1xuICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKVxuICAgIHRocm93IG5ldyBJbnZhbGlkQXJyYXlFcnJvcih2YWx1ZSk7XG4gIGlmICghZHluYW1pYyAmJiB2YWx1ZS5sZW5ndGggIT09IGxlbmd0aClcbiAgICB0aHJvdyBuZXcgQWJpRW5jb2RpbmdBcnJheUxlbmd0aE1pc21hdGNoRXJyb3Ioe1xuICAgICAgZXhwZWN0ZWRMZW5ndGg6IGxlbmd0aCxcbiAgICAgIGdpdmVuTGVuZ3RoOiB2YWx1ZS5sZW5ndGgsXG4gICAgICB0eXBlOiBgJHtwYXJhbS50eXBlfVske2xlbmd0aH1dYFxuICAgIH0pO1xuICBsZXQgZHluYW1pY0NoaWxkID0gZmFsc2U7XG4gIGNvbnN0IHByZXBhcmVkUGFyYW1zID0gW107XG4gIGZvciAobGV0IGkzID0gMDsgaTMgPCB2YWx1ZS5sZW5ndGg7IGkzKyspIHtcbiAgICBjb25zdCBwcmVwYXJlZFBhcmFtID0gcHJlcGFyZVBhcmFtKHsgcGFyYW0sIHZhbHVlOiB2YWx1ZVtpM10gfSk7XG4gICAgaWYgKHByZXBhcmVkUGFyYW0uZHluYW1pYylcbiAgICAgIGR5bmFtaWNDaGlsZCA9IHRydWU7XG4gICAgcHJlcGFyZWRQYXJhbXMucHVzaChwcmVwYXJlZFBhcmFtKTtcbiAgfVxuICBpZiAoZHluYW1pYyB8fCBkeW5hbWljQ2hpbGQpIHtcbiAgICBjb25zdCBkYXRhID0gZW5jb2RlUGFyYW1zKHByZXBhcmVkUGFyYW1zKTtcbiAgICBpZiAoZHluYW1pYykge1xuICAgICAgY29uc3QgbGVuZ3RoMiA9IG51bWJlclRvSGV4KHByZXBhcmVkUGFyYW1zLmxlbmd0aCwgeyBzaXplOiAzMiB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGR5bmFtaWM6IHRydWUsXG4gICAgICAgIGVuY29kZWQ6IHByZXBhcmVkUGFyYW1zLmxlbmd0aCA+IDAgPyBjb25jYXQoW2xlbmd0aDIsIGRhdGFdKSA6IGxlbmd0aDJcbiAgICAgIH07XG4gICAgfVxuICAgIGlmIChkeW5hbWljQ2hpbGQpXG4gICAgICByZXR1cm4geyBkeW5hbWljOiB0cnVlLCBlbmNvZGVkOiBkYXRhIH07XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBkeW5hbWljOiBmYWxzZSxcbiAgICBlbmNvZGVkOiBjb25jYXQocHJlcGFyZWRQYXJhbXMubWFwKCh7IGVuY29kZWQgfSkgPT4gZW5jb2RlZCkpXG4gIH07XG59XG5mdW5jdGlvbiBlbmNvZGVCeXRlcyh2YWx1ZSwgeyBwYXJhbSB9KSB7XG4gIGNvbnN0IFssIHBhcmFtU2l6ZV0gPSBwYXJhbS50eXBlLnNwbGl0KFwiYnl0ZXNcIik7XG4gIGNvbnN0IGJ5dGVzU2l6ZSA9IHNpemUyKHZhbHVlKTtcbiAgaWYgKCFwYXJhbVNpemUpIHtcbiAgICBsZXQgdmFsdWVfID0gdmFsdWU7XG4gICAgaWYgKGJ5dGVzU2l6ZSAlIDMyICE9PSAwKVxuICAgICAgdmFsdWVfID0gcGFkSGV4KHZhbHVlXywge1xuICAgICAgICBkaXI6IFwicmlnaHRcIixcbiAgICAgICAgc2l6ZTogTWF0aC5jZWlsKCh2YWx1ZS5sZW5ndGggLSAyKSAvIDIgLyAzMikgKiAzMlxuICAgICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGR5bmFtaWM6IHRydWUsXG4gICAgICBlbmNvZGVkOiBjb25jYXQoW3BhZEhleChudW1iZXJUb0hleChieXRlc1NpemUsIHsgc2l6ZTogMzIgfSkpLCB2YWx1ZV9dKVxuICAgIH07XG4gIH1cbiAgaWYgKGJ5dGVzU2l6ZSAhPT0gTnVtYmVyLnBhcnNlSW50KHBhcmFtU2l6ZSkpXG4gICAgdGhyb3cgbmV3IEFiaUVuY29kaW5nQnl0ZXNTaXplTWlzbWF0Y2hFcnJvcih7XG4gICAgICBleHBlY3RlZFNpemU6IE51bWJlci5wYXJzZUludChwYXJhbVNpemUpLFxuICAgICAgdmFsdWVcbiAgICB9KTtcbiAgcmV0dXJuIHsgZHluYW1pYzogZmFsc2UsIGVuY29kZWQ6IHBhZEhleCh2YWx1ZSwgeyBkaXI6IFwicmlnaHRcIiB9KSB9O1xufVxuZnVuY3Rpb24gZW5jb2RlQm9vbCh2YWx1ZSkge1xuICBpZiAodHlwZW9mIHZhbHVlICE9PSBcImJvb2xlYW5cIilcbiAgICB0aHJvdyBuZXcgQmFzZUVycm9yMyhgSW52YWxpZCBib29sZWFuIHZhbHVlOiBcIiR7dmFsdWV9XCIgKHR5cGU6ICR7dHlwZW9mIHZhbHVlfSkuIEV4cGVjdGVkOiBcXGB0cnVlXFxgIG9yIFxcYGZhbHNlXFxgLmApO1xuICByZXR1cm4geyBkeW5hbWljOiBmYWxzZSwgZW5jb2RlZDogcGFkSGV4KGJvb2xUb0hleCh2YWx1ZSkpIH07XG59XG5mdW5jdGlvbiBlbmNvZGVOdW1iZXIodmFsdWUsIHsgc2lnbmVkLCBzaXplOiBzaXplMyA9IDI1NiB9KSB7XG4gIGlmICh0eXBlb2Ygc2l6ZTMgPT09IFwibnVtYmVyXCIpIHtcbiAgICBjb25zdCBtYXggPSAybiAqKiAoQmlnSW50KHNpemUzKSAtIChzaWduZWQgPyAxbiA6IDBuKSkgLSAxbjtcbiAgICBjb25zdCBtaW4gPSBzaWduZWQgPyAtbWF4IC0gMW4gOiAwbjtcbiAgICBpZiAodmFsdWUgPiBtYXggfHwgdmFsdWUgPCBtaW4pXG4gICAgICB0aHJvdyBuZXcgSW50ZWdlck91dE9mUmFuZ2VFcnJvcjIoe1xuICAgICAgICBtYXg6IG1heC50b1N0cmluZygpLFxuICAgICAgICBtaW46IG1pbi50b1N0cmluZygpLFxuICAgICAgICBzaWduZWQsXG4gICAgICAgIHNpemU6IHNpemUzIC8gOCxcbiAgICAgICAgdmFsdWU6IHZhbHVlLnRvU3RyaW5nKClcbiAgICAgIH0pO1xuICB9XG4gIHJldHVybiB7XG4gICAgZHluYW1pYzogZmFsc2UsXG4gICAgZW5jb2RlZDogbnVtYmVyVG9IZXgodmFsdWUsIHtcbiAgICAgIHNpemU6IDMyLFxuICAgICAgc2lnbmVkXG4gICAgfSlcbiAgfTtcbn1cbmZ1bmN0aW9uIGVuY29kZVN0cmluZyh2YWx1ZSkge1xuICBjb25zdCBoZXhWYWx1ZSA9IHN0cmluZ1RvSGV4KHZhbHVlKTtcbiAgY29uc3QgcGFydHNMZW5ndGggPSBNYXRoLmNlaWwoc2l6ZTIoaGV4VmFsdWUpIC8gMzIpO1xuICBjb25zdCBwYXJ0cyA9IFtdO1xuICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgcGFydHNMZW5ndGg7IGkzKyspIHtcbiAgICBwYXJ0cy5wdXNoKHBhZEhleChzbGljZShoZXhWYWx1ZSwgaTMgKiAzMiwgKGkzICsgMSkgKiAzMiksIHtcbiAgICAgIGRpcjogXCJyaWdodFwiXG4gICAgfSkpO1xuICB9XG4gIHJldHVybiB7XG4gICAgZHluYW1pYzogdHJ1ZSxcbiAgICBlbmNvZGVkOiBjb25jYXQoW1xuICAgICAgcGFkSGV4KG51bWJlclRvSGV4KHNpemUyKGhleFZhbHVlKSwgeyBzaXplOiAzMiB9KSksXG4gICAgICAuLi5wYXJ0c1xuICAgIF0pXG4gIH07XG59XG5mdW5jdGlvbiBlbmNvZGVUdXBsZSh2YWx1ZSwgeyBwYXJhbSB9KSB7XG4gIGxldCBkeW5hbWljID0gZmFsc2U7XG4gIGNvbnN0IHByZXBhcmVkUGFyYW1zID0gW107XG4gIGZvciAobGV0IGkzID0gMDsgaTMgPCBwYXJhbS5jb21wb25lbnRzLmxlbmd0aDsgaTMrKykge1xuICAgIGNvbnN0IHBhcmFtXyA9IHBhcmFtLmNvbXBvbmVudHNbaTNdO1xuICAgIGNvbnN0IGluZGV4ID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyBpMyA6IHBhcmFtXy5uYW1lO1xuICAgIGNvbnN0IHByZXBhcmVkUGFyYW0gPSBwcmVwYXJlUGFyYW0oe1xuICAgICAgcGFyYW06IHBhcmFtXyxcbiAgICAgIHZhbHVlOiB2YWx1ZVtpbmRleF1cbiAgICB9KTtcbiAgICBwcmVwYXJlZFBhcmFtcy5wdXNoKHByZXBhcmVkUGFyYW0pO1xuICAgIGlmIChwcmVwYXJlZFBhcmFtLmR5bmFtaWMpXG4gICAgICBkeW5hbWljID0gdHJ1ZTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGR5bmFtaWMsXG4gICAgZW5jb2RlZDogZHluYW1pYyA/IGVuY29kZVBhcmFtcyhwcmVwYXJlZFBhcmFtcykgOiBjb25jYXQocHJlcGFyZWRQYXJhbXMubWFwKCh7IGVuY29kZWQgfSkgPT4gZW5jb2RlZCkpXG4gIH07XG59XG5mdW5jdGlvbiBnZXRBcnJheUNvbXBvbmVudHModHlwZSkge1xuICBjb25zdCBtYXRjaGVzMiA9IHR5cGUubWF0Y2goL14oLiopXFxbKFxcZCspP1xcXSQvKTtcbiAgcmV0dXJuIG1hdGNoZXMyID8gKFxuICAgIC8vXG4gICAgW21hdGNoZXMyWzJdID8gTnVtYmVyKG1hdGNoZXMyWzJdKSA6IG51bGwsIG1hdGNoZXMyWzFdXVxuICApIDogdm9pZCAwO1xufVxuZnVuY3Rpb24gZGVjb2RlQWJpUGFyYW1ldGVycyhwYXJhbXMsIGRhdGEpIHtcbiAgY29uc3QgYnl0ZXMyID0gdHlwZW9mIGRhdGEgPT09IFwic3RyaW5nXCIgPyBoZXhUb0J5dGVzKGRhdGEpIDogZGF0YTtcbiAgY29uc3QgY3Vyc29yID0gY3JlYXRlQ3Vyc29yKGJ5dGVzMik7XG4gIGlmIChzaXplMihieXRlczIpID09PSAwICYmIHBhcmFtcy5sZW5ndGggPiAwKVxuICAgIHRocm93IG5ldyBBYmlEZWNvZGluZ1plcm9EYXRhRXJyb3IoKTtcbiAgaWYgKHNpemUyKGRhdGEpICYmIHNpemUyKGRhdGEpIDwgMzIpXG4gICAgdGhyb3cgbmV3IEFiaURlY29kaW5nRGF0YVNpemVUb29TbWFsbEVycm9yKHtcbiAgICAgIGRhdGE6IHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiID8gZGF0YSA6IGJ5dGVzVG9IZXgoZGF0YSksXG4gICAgICBwYXJhbXMsXG4gICAgICBzaXplOiBzaXplMihkYXRhKVxuICAgIH0pO1xuICBsZXQgY29uc3VtZWQgPSAwO1xuICBjb25zdCB2YWx1ZXM4ID0gW107XG4gIGZvciAobGV0IGkzID0gMDsgaTMgPCBwYXJhbXMubGVuZ3RoOyArK2kzKSB7XG4gICAgY29uc3QgcGFyYW0gPSBwYXJhbXNbaTNdO1xuICAgIGN1cnNvci5zZXRQb3NpdGlvbihjb25zdW1lZCk7XG4gICAgY29uc3QgW2RhdGEyLCBjb25zdW1lZF9dID0gZGVjb2RlUGFyYW1ldGVyKGN1cnNvciwgcGFyYW0sIHtcbiAgICAgIHN0YXRpY1Bvc2l0aW9uOiAwXG4gICAgfSk7XG4gICAgY29uc3VtZWQgKz0gY29uc3VtZWRfO1xuICAgIHZhbHVlczgucHVzaChkYXRhMik7XG4gIH1cbiAgcmV0dXJuIHZhbHVlczg7XG59XG5mdW5jdGlvbiBkZWNvZGVQYXJhbWV0ZXIoY3Vyc29yLCBwYXJhbSwgeyBzdGF0aWNQb3NpdGlvbiB9KSB7XG4gIGNvbnN0IGFycmF5Q29tcG9uZW50cyA9IGdldEFycmF5Q29tcG9uZW50cyhwYXJhbS50eXBlKTtcbiAgaWYgKGFycmF5Q29tcG9uZW50cykge1xuICAgIGNvbnN0IFtsZW5ndGgsIHR5cGVdID0gYXJyYXlDb21wb25lbnRzO1xuICAgIHJldHVybiBkZWNvZGVBcnJheShjdXJzb3IsIHsgLi4ucGFyYW0sIHR5cGUgfSwgeyBsZW5ndGgsIHN0YXRpY1Bvc2l0aW9uIH0pO1xuICB9XG4gIGlmIChwYXJhbS50eXBlID09PSBcInR1cGxlXCIpXG4gICAgcmV0dXJuIGRlY29kZVR1cGxlKGN1cnNvciwgcGFyYW0sIHsgc3RhdGljUG9zaXRpb24gfSk7XG4gIGlmIChwYXJhbS50eXBlID09PSBcImFkZHJlc3NcIilcbiAgICByZXR1cm4gZGVjb2RlQWRkcmVzcyhjdXJzb3IpO1xuICBpZiAocGFyYW0udHlwZSA9PT0gXCJib29sXCIpXG4gICAgcmV0dXJuIGRlY29kZUJvb2woY3Vyc29yKTtcbiAgaWYgKHBhcmFtLnR5cGUuc3RhcnRzV2l0aChcImJ5dGVzXCIpKVxuICAgIHJldHVybiBkZWNvZGVCeXRlcyhjdXJzb3IsIHBhcmFtLCB7IHN0YXRpY1Bvc2l0aW9uIH0pO1xuICBpZiAocGFyYW0udHlwZS5zdGFydHNXaXRoKFwidWludFwiKSB8fCBwYXJhbS50eXBlLnN0YXJ0c1dpdGgoXCJpbnRcIikpXG4gICAgcmV0dXJuIGRlY29kZU51bWJlcihjdXJzb3IsIHBhcmFtKTtcbiAgaWYgKHBhcmFtLnR5cGUgPT09IFwic3RyaW5nXCIpXG4gICAgcmV0dXJuIGRlY29kZVN0cmluZyhjdXJzb3IsIHsgc3RhdGljUG9zaXRpb24gfSk7XG4gIHRocm93IG5ldyBJbnZhbGlkQWJpRGVjb2RpbmdUeXBlRXJyb3IocGFyYW0udHlwZSwge1xuICAgIGRvY3NQYXRoOiBcIi9kb2NzL2NvbnRyYWN0L2RlY29kZUFiaVBhcmFtZXRlcnNcIlxuICB9KTtcbn1cbmZ1bmN0aW9uIGRlY29kZUFkZHJlc3MoY3Vyc29yKSB7XG4gIGNvbnN0IHZhbHVlID0gY3Vyc29yLnJlYWRCeXRlcygzMik7XG4gIHJldHVybiBbY2hlY2tzdW1BZGRyZXNzKGJ5dGVzVG9IZXgoc2xpY2VCeXRlcyh2YWx1ZSwgLTIwKSkpLCAzMl07XG59XG5mdW5jdGlvbiBkZWNvZGVBcnJheShjdXJzb3IsIHBhcmFtLCB7IGxlbmd0aCwgc3RhdGljUG9zaXRpb24gfSkge1xuICBpZiAoIWxlbmd0aCkge1xuICAgIGNvbnN0IG9mZnNldCA9IGJ5dGVzVG9OdW1iZXIoY3Vyc29yLnJlYWRCeXRlcyhzaXplT2ZPZmZzZXQpKTtcbiAgICBjb25zdCBzdGFydDIgPSBzdGF0aWNQb3NpdGlvbiArIG9mZnNldDtcbiAgICBjb25zdCBzdGFydE9mRGF0YSA9IHN0YXJ0MiArIHNpemVPZkxlbmd0aDtcbiAgICBjdXJzb3Iuc2V0UG9zaXRpb24oc3RhcnQyKTtcbiAgICBjb25zdCBsZW5ndGgyID0gYnl0ZXNUb051bWJlcihjdXJzb3IucmVhZEJ5dGVzKHNpemVPZkxlbmd0aCkpO1xuICAgIGNvbnN0IGR5bmFtaWNDaGlsZCA9IGhhc0R5bmFtaWNDaGlsZChwYXJhbSk7XG4gICAgbGV0IGNvbnN1bWVkMiA9IDA7XG4gICAgY29uc3QgdmFsdWUyID0gW107XG4gICAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IGxlbmd0aDI7ICsraTMpIHtcbiAgICAgIGN1cnNvci5zZXRQb3NpdGlvbihzdGFydE9mRGF0YSArIChkeW5hbWljQ2hpbGQgPyBpMyAqIDMyIDogY29uc3VtZWQyKSk7XG4gICAgICBjb25zdCBbZGF0YSwgY29uc3VtZWRfXSA9IGRlY29kZVBhcmFtZXRlcihjdXJzb3IsIHBhcmFtLCB7XG4gICAgICAgIHN0YXRpY1Bvc2l0aW9uOiBzdGFydE9mRGF0YVxuICAgICAgfSk7XG4gICAgICBjb25zdW1lZDIgKz0gY29uc3VtZWRfO1xuICAgICAgdmFsdWUyLnB1c2goZGF0YSk7XG4gICAgfVxuICAgIGN1cnNvci5zZXRQb3NpdGlvbihzdGF0aWNQb3NpdGlvbiArIDMyKTtcbiAgICByZXR1cm4gW3ZhbHVlMiwgMzJdO1xuICB9XG4gIGlmIChoYXNEeW5hbWljQ2hpbGQocGFyYW0pKSB7XG4gICAgY29uc3Qgb2Zmc2V0ID0gYnl0ZXNUb051bWJlcihjdXJzb3IucmVhZEJ5dGVzKHNpemVPZk9mZnNldCkpO1xuICAgIGNvbnN0IHN0YXJ0MiA9IHN0YXRpY1Bvc2l0aW9uICsgb2Zmc2V0O1xuICAgIGNvbnN0IHZhbHVlMiA9IFtdO1xuICAgIGZvciAobGV0IGkzID0gMDsgaTMgPCBsZW5ndGg7ICsraTMpIHtcbiAgICAgIGN1cnNvci5zZXRQb3NpdGlvbihzdGFydDIgKyBpMyAqIDMyKTtcbiAgICAgIGNvbnN0IFtkYXRhXSA9IGRlY29kZVBhcmFtZXRlcihjdXJzb3IsIHBhcmFtLCB7XG4gICAgICAgIHN0YXRpY1Bvc2l0aW9uOiBzdGFydDJcbiAgICAgIH0pO1xuICAgICAgdmFsdWUyLnB1c2goZGF0YSk7XG4gICAgfVxuICAgIGN1cnNvci5zZXRQb3NpdGlvbihzdGF0aWNQb3NpdGlvbiArIDMyKTtcbiAgICByZXR1cm4gW3ZhbHVlMiwgMzJdO1xuICB9XG4gIGxldCBjb25zdW1lZCA9IDA7XG4gIGNvbnN0IHZhbHVlID0gW107XG4gIGZvciAobGV0IGkzID0gMDsgaTMgPCBsZW5ndGg7ICsraTMpIHtcbiAgICBjb25zdCBbZGF0YSwgY29uc3VtZWRfXSA9IGRlY29kZVBhcmFtZXRlcihjdXJzb3IsIHBhcmFtLCB7XG4gICAgICBzdGF0aWNQb3NpdGlvbjogc3RhdGljUG9zaXRpb24gKyBjb25zdW1lZFxuICAgIH0pO1xuICAgIGNvbnN1bWVkICs9IGNvbnN1bWVkXztcbiAgICB2YWx1ZS5wdXNoKGRhdGEpO1xuICB9XG4gIHJldHVybiBbdmFsdWUsIGNvbnN1bWVkXTtcbn1cbmZ1bmN0aW9uIGRlY29kZUJvb2woY3Vyc29yKSB7XG4gIHJldHVybiBbYnl0ZXNUb0Jvb2woY3Vyc29yLnJlYWRCeXRlcygzMiksIHsgc2l6ZTogMzIgfSksIDMyXTtcbn1cbmZ1bmN0aW9uIGRlY29kZUJ5dGVzKGN1cnNvciwgcGFyYW0sIHsgc3RhdGljUG9zaXRpb24gfSkge1xuICBjb25zdCBbXywgc2l6ZTNdID0gcGFyYW0udHlwZS5zcGxpdChcImJ5dGVzXCIpO1xuICBpZiAoIXNpemUzKSB7XG4gICAgY29uc3Qgb2Zmc2V0ID0gYnl0ZXNUb051bWJlcihjdXJzb3IucmVhZEJ5dGVzKDMyKSk7XG4gICAgY3Vyc29yLnNldFBvc2l0aW9uKHN0YXRpY1Bvc2l0aW9uICsgb2Zmc2V0KTtcbiAgICBjb25zdCBsZW5ndGggPSBieXRlc1RvTnVtYmVyKGN1cnNvci5yZWFkQnl0ZXMoMzIpKTtcbiAgICBpZiAobGVuZ3RoID09PSAwKSB7XG4gICAgICBjdXJzb3Iuc2V0UG9zaXRpb24oc3RhdGljUG9zaXRpb24gKyAzMik7XG4gICAgICByZXR1cm4gW1wiMHhcIiwgMzJdO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gY3Vyc29yLnJlYWRCeXRlcyhsZW5ndGgpO1xuICAgIGN1cnNvci5zZXRQb3NpdGlvbihzdGF0aWNQb3NpdGlvbiArIDMyKTtcbiAgICByZXR1cm4gW2J5dGVzVG9IZXgoZGF0YSksIDMyXTtcbiAgfVxuICBjb25zdCB2YWx1ZSA9IGJ5dGVzVG9IZXgoY3Vyc29yLnJlYWRCeXRlcyhOdW1iZXIucGFyc2VJbnQoc2l6ZTMpLCAzMikpO1xuICByZXR1cm4gW3ZhbHVlLCAzMl07XG59XG5mdW5jdGlvbiBkZWNvZGVOdW1iZXIoY3Vyc29yLCBwYXJhbSkge1xuICBjb25zdCBzaWduZWQgPSBwYXJhbS50eXBlLnN0YXJ0c1dpdGgoXCJpbnRcIik7XG4gIGNvbnN0IHNpemUzID0gTnVtYmVyLnBhcnNlSW50KHBhcmFtLnR5cGUuc3BsaXQoXCJpbnRcIilbMV0gfHwgXCIyNTZcIik7XG4gIGNvbnN0IHZhbHVlID0gY3Vyc29yLnJlYWRCeXRlcygzMik7XG4gIHJldHVybiBbXG4gICAgc2l6ZTMgPiA0OCA/IGJ5dGVzVG9CaWdJbnQodmFsdWUsIHsgc2lnbmVkIH0pIDogYnl0ZXNUb051bWJlcih2YWx1ZSwgeyBzaWduZWQgfSksXG4gICAgMzJcbiAgXTtcbn1cbmZ1bmN0aW9uIGRlY29kZVR1cGxlKGN1cnNvciwgcGFyYW0sIHsgc3RhdGljUG9zaXRpb24gfSkge1xuICBjb25zdCBoYXNVbm5hbWVkQ2hpbGQgPSBwYXJhbS5jb21wb25lbnRzLmxlbmd0aCA9PT0gMCB8fCBwYXJhbS5jb21wb25lbnRzLnNvbWUoKHsgbmFtZSB9KSA9PiAhbmFtZSk7XG4gIGNvbnN0IHZhbHVlID0gaGFzVW5uYW1lZENoaWxkID8gW10gOiB7fTtcbiAgbGV0IGNvbnN1bWVkID0gMDtcbiAgaWYgKGhhc0R5bmFtaWNDaGlsZChwYXJhbSkpIHtcbiAgICBjb25zdCBvZmZzZXQgPSBieXRlc1RvTnVtYmVyKGN1cnNvci5yZWFkQnl0ZXMoc2l6ZU9mT2Zmc2V0KSk7XG4gICAgY29uc3Qgc3RhcnQyID0gc3RhdGljUG9zaXRpb24gKyBvZmZzZXQ7XG4gICAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IHBhcmFtLmNvbXBvbmVudHMubGVuZ3RoOyArK2kzKSB7XG4gICAgICBjb25zdCBjb21wb25lbnQgPSBwYXJhbS5jb21wb25lbnRzW2kzXTtcbiAgICAgIGN1cnNvci5zZXRQb3NpdGlvbihzdGFydDIgKyBjb25zdW1lZCk7XG4gICAgICBjb25zdCBbZGF0YSwgY29uc3VtZWRfXSA9IGRlY29kZVBhcmFtZXRlcihjdXJzb3IsIGNvbXBvbmVudCwge1xuICAgICAgICBzdGF0aWNQb3NpdGlvbjogc3RhcnQyXG4gICAgICB9KTtcbiAgICAgIGNvbnN1bWVkICs9IGNvbnN1bWVkXztcbiAgICAgIHZhbHVlW2hhc1VubmFtZWRDaGlsZCA/IGkzIDogY29tcG9uZW50Py5uYW1lXSA9IGRhdGE7XG4gICAgfVxuICAgIGN1cnNvci5zZXRQb3NpdGlvbihzdGF0aWNQb3NpdGlvbiArIDMyKTtcbiAgICByZXR1cm4gW3ZhbHVlLCAzMl07XG4gIH1cbiAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IHBhcmFtLmNvbXBvbmVudHMubGVuZ3RoOyArK2kzKSB7XG4gICAgY29uc3QgY29tcG9uZW50ID0gcGFyYW0uY29tcG9uZW50c1tpM107XG4gICAgY29uc3QgW2RhdGEsIGNvbnN1bWVkX10gPSBkZWNvZGVQYXJhbWV0ZXIoY3Vyc29yLCBjb21wb25lbnQsIHtcbiAgICAgIHN0YXRpY1Bvc2l0aW9uXG4gICAgfSk7XG4gICAgdmFsdWVbaGFzVW5uYW1lZENoaWxkID8gaTMgOiBjb21wb25lbnQ/Lm5hbWVdID0gZGF0YTtcbiAgICBjb25zdW1lZCArPSBjb25zdW1lZF87XG4gIH1cbiAgcmV0dXJuIFt2YWx1ZSwgY29uc3VtZWRdO1xufVxuZnVuY3Rpb24gZGVjb2RlU3RyaW5nKGN1cnNvciwgeyBzdGF0aWNQb3NpdGlvbiB9KSB7XG4gIGNvbnN0IG9mZnNldCA9IGJ5dGVzVG9OdW1iZXIoY3Vyc29yLnJlYWRCeXRlcygzMikpO1xuICBjb25zdCBzdGFydDIgPSBzdGF0aWNQb3NpdGlvbiArIG9mZnNldDtcbiAgY3Vyc29yLnNldFBvc2l0aW9uKHN0YXJ0Mik7XG4gIGNvbnN0IGxlbmd0aCA9IGJ5dGVzVG9OdW1iZXIoY3Vyc29yLnJlYWRCeXRlcygzMikpO1xuICBpZiAobGVuZ3RoID09PSAwKSB7XG4gICAgY3Vyc29yLnNldFBvc2l0aW9uKHN0YXRpY1Bvc2l0aW9uICsgMzIpO1xuICAgIHJldHVybiBbXCJcIiwgMzJdO1xuICB9XG4gIGNvbnN0IGRhdGEgPSBjdXJzb3IucmVhZEJ5dGVzKGxlbmd0aCwgMzIpO1xuICBjb25zdCB2YWx1ZSA9IGJ5dGVzVG9TdHJpbmcodHJpbTIoZGF0YSkpO1xuICBjdXJzb3Iuc2V0UG9zaXRpb24oc3RhdGljUG9zaXRpb24gKyAzMik7XG4gIHJldHVybiBbdmFsdWUsIDMyXTtcbn1cbmZ1bmN0aW9uIGhhc0R5bmFtaWNDaGlsZChwYXJhbSkge1xuICBjb25zdCB7IHR5cGUgfSA9IHBhcmFtO1xuICBpZiAodHlwZSA9PT0gXCJzdHJpbmdcIilcbiAgICByZXR1cm4gdHJ1ZTtcbiAgaWYgKHR5cGUgPT09IFwiYnl0ZXNcIilcbiAgICByZXR1cm4gdHJ1ZTtcbiAgaWYgKHR5cGUuZW5kc1dpdGgoXCJbXVwiKSlcbiAgICByZXR1cm4gdHJ1ZTtcbiAgaWYgKHR5cGUgPT09IFwidHVwbGVcIilcbiAgICByZXR1cm4gcGFyYW0uY29tcG9uZW50cz8uc29tZShoYXNEeW5hbWljQ2hpbGQpO1xuICBjb25zdCBhcnJheUNvbXBvbmVudHMgPSBnZXRBcnJheUNvbXBvbmVudHMocGFyYW0udHlwZSk7XG4gIGlmIChhcnJheUNvbXBvbmVudHMgJiYgaGFzRHluYW1pY0NoaWxkKHsgLi4ucGFyYW0sIHR5cGU6IGFycmF5Q29tcG9uZW50c1sxXSB9KSlcbiAgICByZXR1cm4gdHJ1ZTtcbiAgcmV0dXJuIGZhbHNlO1xufVxuZnVuY3Rpb24gZ2V0QWJpSXRlbShwYXJhbWV0ZXJzKSB7XG4gIGNvbnN0IHsgYWJpLCBhcmdzID0gW10sIG5hbWUgfSA9IHBhcmFtZXRlcnM7XG4gIGNvbnN0IGlzU2VsZWN0b3IgPSBpc0hleChuYW1lLCB7IHN0cmljdDogZmFsc2UgfSk7XG4gIGNvbnN0IGFiaUl0ZW1zID0gYWJpLmZpbHRlcigoYWJpSXRlbSkgPT4ge1xuICAgIGlmIChpc1NlbGVjdG9yKSB7XG4gICAgICBpZiAoYWJpSXRlbS50eXBlID09PSBcImZ1bmN0aW9uXCIpXG4gICAgICAgIHJldHVybiB0b0Z1bmN0aW9uU2VsZWN0b3IoYWJpSXRlbSkgPT09IG5hbWU7XG4gICAgICBpZiAoYWJpSXRlbS50eXBlID09PSBcImV2ZW50XCIpXG4gICAgICAgIHJldHVybiB0b0V2ZW50U2VsZWN0b3IoYWJpSXRlbSkgPT09IG5hbWU7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBcIm5hbWVcIiBpbiBhYmlJdGVtICYmIGFiaUl0ZW0ubmFtZSA9PT0gbmFtZTtcbiAgfSk7XG4gIGlmIChhYmlJdGVtcy5sZW5ndGggPT09IDApXG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgaWYgKGFiaUl0ZW1zLmxlbmd0aCA9PT0gMSlcbiAgICByZXR1cm4gYWJpSXRlbXNbMF07XG4gIGxldCBtYXRjaGVkQWJpSXRlbSA9IHZvaWQgMDtcbiAgZm9yIChjb25zdCBhYmlJdGVtIG9mIGFiaUl0ZW1zKSB7XG4gICAgaWYgKCEoXCJpbnB1dHNcIiBpbiBhYmlJdGVtKSlcbiAgICAgIGNvbnRpbnVlO1xuICAgIGlmICghYXJncyB8fCBhcmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgaWYgKCFhYmlJdGVtLmlucHV0cyB8fCBhYmlJdGVtLmlucHV0cy5sZW5ndGggPT09IDApXG4gICAgICAgIHJldHVybiBhYmlJdGVtO1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGlmICghYWJpSXRlbS5pbnB1dHMpXG4gICAgICBjb250aW51ZTtcbiAgICBpZiAoYWJpSXRlbS5pbnB1dHMubGVuZ3RoID09PSAwKVxuICAgICAgY29udGludWU7XG4gICAgaWYgKGFiaUl0ZW0uaW5wdXRzLmxlbmd0aCAhPT0gYXJncy5sZW5ndGgpXG4gICAgICBjb250aW51ZTtcbiAgICBjb25zdCBtYXRjaGVkID0gYXJncy5ldmVyeSgoYXJnLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgYWJpUGFyYW1ldGVyID0gXCJpbnB1dHNcIiBpbiBhYmlJdGVtICYmIGFiaUl0ZW0uaW5wdXRzW2luZGV4XTtcbiAgICAgIGlmICghYWJpUGFyYW1ldGVyKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICByZXR1cm4gaXNBcmdPZlR5cGUoYXJnLCBhYmlQYXJhbWV0ZXIpO1xuICAgIH0pO1xuICAgIGlmIChtYXRjaGVkKSB7XG4gICAgICBpZiAobWF0Y2hlZEFiaUl0ZW0gJiYgXCJpbnB1dHNcIiBpbiBtYXRjaGVkQWJpSXRlbSAmJiBtYXRjaGVkQWJpSXRlbS5pbnB1dHMpIHtcbiAgICAgICAgY29uc3QgYW1iaWd1b3VzVHlwZXMgPSBnZXRBbWJpZ3VvdXNUeXBlcyhhYmlJdGVtLmlucHV0cywgbWF0Y2hlZEFiaUl0ZW0uaW5wdXRzLCBhcmdzKTtcbiAgICAgICAgaWYgKGFtYmlndW91c1R5cGVzKVxuICAgICAgICAgIHRocm93IG5ldyBBYmlJdGVtQW1iaWd1aXR5RXJyb3Ioe1xuICAgICAgICAgICAgYWJpSXRlbSxcbiAgICAgICAgICAgIHR5cGU6IGFtYmlndW91c1R5cGVzWzBdXG4gICAgICAgICAgfSwge1xuICAgICAgICAgICAgYWJpSXRlbTogbWF0Y2hlZEFiaUl0ZW0sXG4gICAgICAgICAgICB0eXBlOiBhbWJpZ3VvdXNUeXBlc1sxXVxuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgbWF0Y2hlZEFiaUl0ZW0gPSBhYmlJdGVtO1xuICAgIH1cbiAgfVxuICBpZiAobWF0Y2hlZEFiaUl0ZW0pXG4gICAgcmV0dXJuIG1hdGNoZWRBYmlJdGVtO1xuICByZXR1cm4gYWJpSXRlbXNbMF07XG59XG5mdW5jdGlvbiBpc0FyZ09mVHlwZShhcmcsIGFiaVBhcmFtZXRlcikge1xuICBjb25zdCBhcmdUeXBlID0gdHlwZW9mIGFyZztcbiAgY29uc3QgYWJpUGFyYW1ldGVyVHlwZSA9IGFiaVBhcmFtZXRlci50eXBlO1xuICBzd2l0Y2ggKGFiaVBhcmFtZXRlclR5cGUpIHtcbiAgICBjYXNlIFwiYWRkcmVzc1wiOlxuICAgICAgcmV0dXJuIGlzQWRkcmVzcyhhcmcsIHsgc3RyaWN0OiBmYWxzZSB9KTtcbiAgICBjYXNlIFwiYm9vbFwiOlxuICAgICAgcmV0dXJuIGFyZ1R5cGUgPT09IFwiYm9vbGVhblwiO1xuICAgIGNhc2UgXCJmdW5jdGlvblwiOlxuICAgICAgcmV0dXJuIGFyZ1R5cGUgPT09IFwic3RyaW5nXCI7XG4gICAgY2FzZSBcInN0cmluZ1wiOlxuICAgICAgcmV0dXJuIGFyZ1R5cGUgPT09IFwic3RyaW5nXCI7XG4gICAgZGVmYXVsdDoge1xuICAgICAgaWYgKGFiaVBhcmFtZXRlclR5cGUgPT09IFwidHVwbGVcIiAmJiBcImNvbXBvbmVudHNcIiBpbiBhYmlQYXJhbWV0ZXIpXG4gICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKGFiaVBhcmFtZXRlci5jb21wb25lbnRzKS5ldmVyeSgoY29tcG9uZW50LCBpbmRleCkgPT4ge1xuICAgICAgICAgIHJldHVybiBpc0FyZ09mVHlwZShPYmplY3QudmFsdWVzKGFyZylbaW5kZXhdLCBjb21wb25lbnQpO1xuICAgICAgICB9KTtcbiAgICAgIGlmICgvXnU/aW50KDh8MTZ8MjR8MzJ8NDB8NDh8NTZ8NjR8NzJ8ODB8ODh8OTZ8MTA0fDExMnwxMjB8MTI4fDEzNnwxNDR8MTUyfDE2MHwxNjh8MTc2fDE4NHwxOTJ8MjAwfDIwOHwyMTZ8MjI0fDIzMnwyNDB8MjQ4fDI1Nik/JC8udGVzdChhYmlQYXJhbWV0ZXJUeXBlKSlcbiAgICAgICAgcmV0dXJuIGFyZ1R5cGUgPT09IFwibnVtYmVyXCIgfHwgYXJnVHlwZSA9PT0gXCJiaWdpbnRcIjtcbiAgICAgIGlmICgvXmJ5dGVzKFsxLTldfDFbMC05XXwyWzAtOV18M1swLTJdKT8kLy50ZXN0KGFiaVBhcmFtZXRlclR5cGUpKVxuICAgICAgICByZXR1cm4gYXJnVHlwZSA9PT0gXCJzdHJpbmdcIiB8fCBhcmcgaW5zdGFuY2VvZiBVaW50OEFycmF5O1xuICAgICAgaWYgKC9bYS16XStbMS05XXswLDN9KFxcW1swLTldezAsfVxcXSkrJC8udGVzdChhYmlQYXJhbWV0ZXJUeXBlKSkge1xuICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShhcmcpICYmIGFyZy5ldmVyeSgoeCkgPT4gaXNBcmdPZlR5cGUoeCwge1xuICAgICAgICAgIC4uLmFiaVBhcmFtZXRlcixcbiAgICAgICAgICAvL1xuICAgICAgICAgIHR5cGU6IGFiaVBhcmFtZXRlclR5cGUucmVwbGFjZSgvKFxcW1swLTldezAsfVxcXSkkLywgXCJcIilcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gZ2V0QW1iaWd1b3VzVHlwZXMoc291cmNlUGFyYW1ldGVycywgdGFyZ2V0UGFyYW1ldGVycywgYXJncykge1xuICBmb3IgKGNvbnN0IHBhcmFtZXRlckluZGV4IGluIHNvdXJjZVBhcmFtZXRlcnMpIHtcbiAgICBjb25zdCBzb3VyY2VQYXJhbWV0ZXIgPSBzb3VyY2VQYXJhbWV0ZXJzW3BhcmFtZXRlckluZGV4XTtcbiAgICBjb25zdCB0YXJnZXRQYXJhbWV0ZXIgPSB0YXJnZXRQYXJhbWV0ZXJzW3BhcmFtZXRlckluZGV4XTtcbiAgICBpZiAoc291cmNlUGFyYW1ldGVyLnR5cGUgPT09IFwidHVwbGVcIiAmJiB0YXJnZXRQYXJhbWV0ZXIudHlwZSA9PT0gXCJ0dXBsZVwiICYmIFwiY29tcG9uZW50c1wiIGluIHNvdXJjZVBhcmFtZXRlciAmJiBcImNvbXBvbmVudHNcIiBpbiB0YXJnZXRQYXJhbWV0ZXIpXG4gICAgICByZXR1cm4gZ2V0QW1iaWd1b3VzVHlwZXMoc291cmNlUGFyYW1ldGVyLmNvbXBvbmVudHMsIHRhcmdldFBhcmFtZXRlci5jb21wb25lbnRzLCBhcmdzW3BhcmFtZXRlckluZGV4XSk7XG4gICAgY29uc3QgdHlwZXMgPSBbc291cmNlUGFyYW1ldGVyLnR5cGUsIHRhcmdldFBhcmFtZXRlci50eXBlXTtcbiAgICBjb25zdCBhbWJpZ3VvdXMgPSAoKCkgPT4ge1xuICAgICAgaWYgKHR5cGVzLmluY2x1ZGVzKFwiYWRkcmVzc1wiKSAmJiB0eXBlcy5pbmNsdWRlcyhcImJ5dGVzMjBcIikpXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgaWYgKHR5cGVzLmluY2x1ZGVzKFwiYWRkcmVzc1wiKSAmJiB0eXBlcy5pbmNsdWRlcyhcInN0cmluZ1wiKSlcbiAgICAgICAgcmV0dXJuIGlzQWRkcmVzcyhhcmdzW3BhcmFtZXRlckluZGV4XSwgeyBzdHJpY3Q6IGZhbHNlIH0pO1xuICAgICAgaWYgKHR5cGVzLmluY2x1ZGVzKFwiYWRkcmVzc1wiKSAmJiB0eXBlcy5pbmNsdWRlcyhcImJ5dGVzXCIpKVxuICAgICAgICByZXR1cm4gaXNBZGRyZXNzKGFyZ3NbcGFyYW1ldGVySW5kZXhdLCB7IHN0cmljdDogZmFsc2UgfSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSkoKTtcbiAgICBpZiAoYW1iaWd1b3VzKVxuICAgICAgcmV0dXJuIHR5cGVzO1xuICB9XG4gIHJldHVybjtcbn1cbmZ1bmN0aW9uIGZvcm1hdFVuaXRzKHZhbHVlLCBkZWNpbWFscykge1xuICBsZXQgZGlzcGxheSA9IHZhbHVlLnRvU3RyaW5nKCk7XG4gIGNvbnN0IG5lZ2F0aXZlID0gZGlzcGxheS5zdGFydHNXaXRoKFwiLVwiKTtcbiAgaWYgKG5lZ2F0aXZlKVxuICAgIGRpc3BsYXkgPSBkaXNwbGF5LnNsaWNlKDEpO1xuICBkaXNwbGF5ID0gZGlzcGxheS5wYWRTdGFydChkZWNpbWFscywgXCIwXCIpO1xuICBsZXQgW2ludGVnZXIsIGZyYWN0aW9uXSA9IFtcbiAgICBkaXNwbGF5LnNsaWNlKDAsIGRpc3BsYXkubGVuZ3RoIC0gZGVjaW1hbHMpLFxuICAgIGRpc3BsYXkuc2xpY2UoZGlzcGxheS5sZW5ndGggLSBkZWNpbWFscylcbiAgXTtcbiAgZnJhY3Rpb24gPSBmcmFjdGlvbi5yZXBsYWNlKC8oMCspJC8sIFwiXCIpO1xuICByZXR1cm4gYCR7bmVnYXRpdmUgPyBcIi1cIiA6IFwiXCJ9JHtpbnRlZ2VyIHx8IFwiMFwifSR7ZnJhY3Rpb24gPyBgLiR7ZnJhY3Rpb259YCA6IFwiXCJ9YDtcbn1cbmZ1bmN0aW9uIGZvcm1hdEd3ZWkod2VpLCB1bml0ID0gXCJ3ZWlcIikge1xuICByZXR1cm4gZm9ybWF0VW5pdHMod2VpLCBnd2VpVW5pdHNbdW5pdF0pO1xufVxuZnVuY3Rpb24gcHJlcGFyZUVuY29kZUZ1bmN0aW9uRGF0YShwYXJhbWV0ZXJzKSB7XG4gIGNvbnN0IHsgYWJpLCBhcmdzLCBmdW5jdGlvbk5hbWUgfSA9IHBhcmFtZXRlcnM7XG4gIGxldCBhYmlJdGVtID0gYWJpWzBdO1xuICBpZiAoZnVuY3Rpb25OYW1lKSB7XG4gICAgY29uc3QgaXRlbSA9IGdldEFiaUl0ZW0oe1xuICAgICAgYWJpLFxuICAgICAgYXJncyxcbiAgICAgIG5hbWU6IGZ1bmN0aW9uTmFtZVxuICAgIH0pO1xuICAgIGlmICghaXRlbSlcbiAgICAgIHRocm93IG5ldyBBYmlGdW5jdGlvbk5vdEZvdW5kRXJyb3IoZnVuY3Rpb25OYW1lLCB7IGRvY3NQYXRoOiBkb2NzUGF0aDMgfSk7XG4gICAgYWJpSXRlbSA9IGl0ZW07XG4gIH1cbiAgaWYgKGFiaUl0ZW0udHlwZSAhPT0gXCJmdW5jdGlvblwiKVxuICAgIHRocm93IG5ldyBBYmlGdW5jdGlvbk5vdEZvdW5kRXJyb3Iodm9pZCAwLCB7IGRvY3NQYXRoOiBkb2NzUGF0aDMgfSk7XG4gIHJldHVybiB7XG4gICAgYWJpOiBbYWJpSXRlbV0sXG4gICAgZnVuY3Rpb25OYW1lOiB0b0Z1bmN0aW9uU2VsZWN0b3IoZm9ybWF0QWJpSXRlbTIoYWJpSXRlbSkpXG4gIH07XG59XG5mdW5jdGlvbiBlbmNvZGVGdW5jdGlvbkRhdGEocGFyYW1ldGVycykge1xuICBjb25zdCB7IGFyZ3MgfSA9IHBhcmFtZXRlcnM7XG4gIGNvbnN0IHsgYWJpLCBmdW5jdGlvbk5hbWUgfSA9ICgoKSA9PiB7XG4gICAgaWYgKHBhcmFtZXRlcnMuYWJpLmxlbmd0aCA9PT0gMSAmJiBwYXJhbWV0ZXJzLmZ1bmN0aW9uTmFtZT8uc3RhcnRzV2l0aChcIjB4XCIpKVxuICAgICAgcmV0dXJuIHBhcmFtZXRlcnM7XG4gICAgcmV0dXJuIHByZXBhcmVFbmNvZGVGdW5jdGlvbkRhdGEocGFyYW1ldGVycyk7XG4gIH0pKCk7XG4gIGNvbnN0IGFiaUl0ZW0gPSBhYmlbMF07XG4gIGNvbnN0IHNpZ25hdHVyZSA9IGZ1bmN0aW9uTmFtZTtcbiAgY29uc3QgZGF0YSA9IFwiaW5wdXRzXCIgaW4gYWJpSXRlbSAmJiBhYmlJdGVtLmlucHV0cyA/IGVuY29kZUFiaVBhcmFtZXRlcnMoYWJpSXRlbS5pbnB1dHMsIGFyZ3MgPz8gW10pIDogdm9pZCAwO1xuICByZXR1cm4gY29uY2F0SGV4KFtzaWduYXR1cmUsIGRhdGEgPz8gXCIweFwiXSk7XG59XG52YXIgdHVwbGVSZWdleCwgdW5pdmVyc2FsUmVzb2x2ZXJFcnJvcnMsIHVuaXZlcnNhbFJlc29sdmVyUmVzb2x2ZUFiaSwgdW5pdmVyc2FsUmVzb2x2ZXJSZXZlcnNlQWJpLCB2ZXJzaW9uMywgZXJyb3JDb25maWcsIEJhc2VFcnJvcjMsIEFiaURlY29kaW5nRGF0YVNpemVUb29TbWFsbEVycm9yLCBBYmlEZWNvZGluZ1plcm9EYXRhRXJyb3IsIEFiaUVuY29kaW5nQXJyYXlMZW5ndGhNaXNtYXRjaEVycm9yLCBBYmlFbmNvZGluZ0J5dGVzU2l6ZU1pc21hdGNoRXJyb3IsIEFiaUVuY29kaW5nTGVuZ3RoTWlzbWF0Y2hFcnJvciwgQWJpRnVuY3Rpb25Ob3RGb3VuZEVycm9yLCBBYmlJdGVtQW1iaWd1aXR5RXJyb3IsIEludmFsaWRBYmlFbmNvZGluZ1R5cGVFcnJvciwgSW52YWxpZEFiaURlY29kaW5nVHlwZUVycm9yLCBJbnZhbGlkQXJyYXlFcnJvciwgSW52YWxpZERlZmluaXRpb25UeXBlRXJyb3IsIFNsaWNlT2Zmc2V0T3V0T2ZCb3VuZHNFcnJvcjIsIFNpemVFeGNlZWRzUGFkZGluZ1NpemVFcnJvcjIsIEludGVnZXJPdXRPZlJhbmdlRXJyb3IyLCBJbnZhbGlkQnl0ZXNCb29sZWFuRXJyb3IsIFNpemVPdmVyZmxvd0Vycm9yMiwgaGV4ZXMsIGVuY29kZXIsIGVuY29kZXIyLCBjaGFyQ29kZU1hcCwgaGFzaCwgdG9TaWduYXR1cmUsIHRvRnVuY3Rpb25TZWxlY3RvciwgSW52YWxpZEFkZHJlc3NFcnJvciwgTHJ1TWFwLCBhZGRyZXNzUmVnZXgsIGlzQWRkcmVzc0NhY2hlLCBjaGVja3N1bUFkZHJlc3NDYWNoZSwgTmVnYXRpdmVPZmZzZXRFcnJvciwgUG9zaXRpb25PdXRPZkJvdW5kc0Vycm9yLCBSZWN1cnNpdmVSZWFkTGltaXRFeGNlZWRlZEVycm9yLCBzdGF0aWNDdXJzb3IsIGludGVnZXJSZWdleDIsIHNpemVPZkxlbmd0aCwgc2l6ZU9mT2Zmc2V0LCB0b0V2ZW50U2VsZWN0b3IsIGd3ZWlVbml0cywgZG9jc1BhdGgzLCBFeGVjdXRpb25SZXZlcnRlZEVycm9yLCBGZWVDYXBUb29IaWdoRXJyb3IsIEZlZUNhcFRvb0xvd0Vycm9yLCBOb25jZVRvb0hpZ2hFcnJvciwgTm9uY2VUb29Mb3dFcnJvciwgTm9uY2VNYXhWYWx1ZUVycm9yLCBJbnN1ZmZpY2llbnRGdW5kc0Vycm9yLCBJbnRyaW5zaWNHYXNUb29IaWdoRXJyb3IsIEludHJpbnNpY0dhc1Rvb0xvd0Vycm9yLCBUcmFuc2FjdGlvblR5cGVOb3RTdXBwb3J0ZWRFcnJvciwgVGlwQWJvdmVGZWVDYXBFcnJvciwgbWF4SW50OCwgbWF4SW50MTYsIG1heEludDI0LCBtYXhJbnQzMiwgbWF4SW50NDAsIG1heEludDQ4LCBtYXhJbnQ1NiwgbWF4SW50NjQsIG1heEludDcyLCBtYXhJbnQ4MCwgbWF4SW50ODgsIG1heEludDk2LCBtYXhJbnQxMDQsIG1heEludDExMiwgbWF4SW50MTIwLCBtYXhJbnQxMjgsIG1heEludDEzNiwgbWF4SW50MTQ0LCBtYXhJbnQxNTIsIG1heEludDE2MCwgbWF4SW50MTY4LCBtYXhJbnQxNzYsIG1heEludDE4NCwgbWF4SW50MTkyLCBtYXhJbnQyMDAsIG1heEludDIwOCwgbWF4SW50MjE2LCBtYXhJbnQyMjQsIG1heEludDIzMiwgbWF4SW50MjQwLCBtYXhJbnQyNDgsIG1heEludDI1NiwgbWluSW50OCwgbWluSW50MTYsIG1pbkludDI0LCBtaW5JbnQzMiwgbWluSW50NDAsIG1pbkludDQ4LCBtaW5JbnQ1NiwgbWluSW50NjQsIG1pbkludDcyLCBtaW5JbnQ4MCwgbWluSW50ODgsIG1pbkludDk2LCBtaW5JbnQxMDQsIG1pbkludDExMiwgbWluSW50MTIwLCBtaW5JbnQxMjgsIG1pbkludDEzNiwgbWluSW50MTQ0LCBtaW5JbnQxNTIsIG1pbkludDE2MCwgbWluSW50MTY4LCBtaW5JbnQxNzYsIG1pbkludDE4NCwgbWluSW50MTkyLCBtaW5JbnQyMDAsIG1pbkludDIwOCwgbWluSW50MjE2LCBtaW5JbnQyMjQsIG1pbkludDIzMiwgbWluSW50MjQwLCBtaW5JbnQyNDgsIG1pbkludDI1NiwgbWF4VWludDgsIG1heFVpbnQxNiwgbWF4VWludDI0LCBtYXhVaW50MzIsIG1heFVpbnQ0MCwgbWF4VWludDQ4LCBtYXhVaW50NTYsIG1heFVpbnQ2NCwgbWF4VWludDcyLCBtYXhVaW50ODAsIG1heFVpbnQ4OCwgbWF4VWludDk2LCBtYXhVaW50MTA0LCBtYXhVaW50MTEyLCBtYXhVaW50MTIwLCBtYXhVaW50MTI4LCBtYXhVaW50MTM2LCBtYXhVaW50MTQ0LCBtYXhVaW50MTUyLCBtYXhVaW50MTYwLCBtYXhVaW50MTY4LCBtYXhVaW50MTc2LCBtYXhVaW50MTg0LCBtYXhVaW50MTkyLCBtYXhVaW50MjAwLCBtYXhVaW50MjA4LCBtYXhVaW50MjE2LCBtYXhVaW50MjI0LCBtYXhVaW50MjMyLCBtYXhVaW50MjQwLCBtYXhVaW50MjQ4LCBtYXhVaW50MjU2O1xudmFyIGluaXRfY2h1bmtfNEVGNEsyTUggPSBfX2VzbSh7XG4gIFwiLi4vb3JjaGVzdHJhdGlvbi9zcmMvdmVuZG9yL3ZpZW0vY2h1bmstNEVGNEsyTUguanNcIigpIHtcbiAgICBpbml0X3NoYTMoKTtcbiAgICB0dXBsZVJlZ2V4ID0gL150dXBsZSg/PGFycmF5PihcXFsoXFxkKilcXF0pKikkLztcbiAgICB1bml2ZXJzYWxSZXNvbHZlckVycm9ycyA9IFtcbiAgICAgIHtcbiAgICAgICAgaW5wdXRzOiBbXSxcbiAgICAgICAgbmFtZTogXCJSZXNvbHZlck5vdEZvdW5kXCIsXG4gICAgICAgIHR5cGU6IFwiZXJyb3JcIlxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgaW5wdXRzOiBbXSxcbiAgICAgICAgbmFtZTogXCJSZXNvbHZlcldpbGRjYXJkTm90U3VwcG9ydGVkXCIsXG4gICAgICAgIHR5cGU6IFwiZXJyb3JcIlxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgaW5wdXRzOiBbXSxcbiAgICAgICAgbmFtZTogXCJSZXNvbHZlck5vdENvbnRyYWN0XCIsXG4gICAgICAgIHR5cGU6IFwiZXJyb3JcIlxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgaW5wdXRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogXCJyZXR1cm5EYXRhXCIsXG4gICAgICAgICAgICB0eXBlOiBcImJ5dGVzXCJcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIG5hbWU6IFwiUmVzb2x2ZXJFcnJvclwiLFxuICAgICAgICB0eXBlOiBcImVycm9yXCJcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGlucHV0czogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwic3RhdHVzXCIsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJ1aW50MTZcIlxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCJtZXNzYWdlXCIsXG4gICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgbmFtZTogXCJlcnJvcnNcIixcbiAgICAgICAgICAgIHR5cGU6IFwidHVwbGVbXVwiXG4gICAgICAgICAgfVxuICAgICAgICBdLFxuICAgICAgICBuYW1lOiBcIkh0dHBFcnJvclwiLFxuICAgICAgICB0eXBlOiBcImVycm9yXCJcbiAgICAgIH1cbiAgICBdO1xuICAgIHVuaXZlcnNhbFJlc29sdmVyUmVzb2x2ZUFiaSA9IFtcbiAgICAgIC4uLnVuaXZlcnNhbFJlc29sdmVyRXJyb3JzLFxuICAgICAge1xuICAgICAgICBuYW1lOiBcInJlc29sdmVcIixcbiAgICAgICAgdHlwZTogXCJmdW5jdGlvblwiLFxuICAgICAgICBzdGF0ZU11dGFiaWxpdHk6IFwidmlld1wiLFxuICAgICAgICBpbnB1dHM6IFtcbiAgICAgICAgICB7IG5hbWU6IFwibmFtZVwiLCB0eXBlOiBcImJ5dGVzXCIgfSxcbiAgICAgICAgICB7IG5hbWU6IFwiZGF0YVwiLCB0eXBlOiBcImJ5dGVzXCIgfVxuICAgICAgICBdLFxuICAgICAgICBvdXRwdXRzOiBbXG4gICAgICAgICAgeyBuYW1lOiBcIlwiLCB0eXBlOiBcImJ5dGVzXCIgfSxcbiAgICAgICAgICB7IG5hbWU6IFwiYWRkcmVzc1wiLCB0eXBlOiBcImFkZHJlc3NcIiB9XG4gICAgICAgIF1cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6IFwicmVzb2x2ZVwiLFxuICAgICAgICB0eXBlOiBcImZ1bmN0aW9uXCIsXG4gICAgICAgIHN0YXRlTXV0YWJpbGl0eTogXCJ2aWV3XCIsXG4gICAgICAgIGlucHV0czogW1xuICAgICAgICAgIHsgbmFtZTogXCJuYW1lXCIsIHR5cGU6IFwiYnl0ZXNcIiB9LFxuICAgICAgICAgIHsgbmFtZTogXCJkYXRhXCIsIHR5cGU6IFwiYnl0ZXNcIiB9LFxuICAgICAgICAgIHsgbmFtZTogXCJnYXRld2F5c1wiLCB0eXBlOiBcInN0cmluZ1tdXCIgfVxuICAgICAgICBdLFxuICAgICAgICBvdXRwdXRzOiBbXG4gICAgICAgICAgeyBuYW1lOiBcIlwiLCB0eXBlOiBcImJ5dGVzXCIgfSxcbiAgICAgICAgICB7IG5hbWU6IFwiYWRkcmVzc1wiLCB0eXBlOiBcImFkZHJlc3NcIiB9XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICBdO1xuICAgIHVuaXZlcnNhbFJlc29sdmVyUmV2ZXJzZUFiaSA9IFtcbiAgICAgIC4uLnVuaXZlcnNhbFJlc29sdmVyRXJyb3JzLFxuICAgICAge1xuICAgICAgICBuYW1lOiBcInJldmVyc2VcIixcbiAgICAgICAgdHlwZTogXCJmdW5jdGlvblwiLFxuICAgICAgICBzdGF0ZU11dGFiaWxpdHk6IFwidmlld1wiLFxuICAgICAgICBpbnB1dHM6IFt7IHR5cGU6IFwiYnl0ZXNcIiwgbmFtZTogXCJyZXZlcnNlTmFtZVwiIH1dLFxuICAgICAgICBvdXRwdXRzOiBbXG4gICAgICAgICAgeyB0eXBlOiBcInN0cmluZ1wiLCBuYW1lOiBcInJlc29sdmVkTmFtZVwiIH0sXG4gICAgICAgICAgeyB0eXBlOiBcImFkZHJlc3NcIiwgbmFtZTogXCJyZXNvbHZlZEFkZHJlc3NcIiB9LFxuICAgICAgICAgIHsgdHlwZTogXCJhZGRyZXNzXCIsIG5hbWU6IFwicmV2ZXJzZVJlc29sdmVyXCIgfSxcbiAgICAgICAgICB7IHR5cGU6IFwiYWRkcmVzc1wiLCBuYW1lOiBcInJlc29sdmVyXCIgfVxuICAgICAgICBdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiBcInJldmVyc2VcIixcbiAgICAgICAgdHlwZTogXCJmdW5jdGlvblwiLFxuICAgICAgICBzdGF0ZU11dGFiaWxpdHk6IFwidmlld1wiLFxuICAgICAgICBpbnB1dHM6IFtcbiAgICAgICAgICB7IHR5cGU6IFwiYnl0ZXNcIiwgbmFtZTogXCJyZXZlcnNlTmFtZVwiIH0sXG4gICAgICAgICAgeyB0eXBlOiBcInN0cmluZ1tdXCIsIG5hbWU6IFwiZ2F0ZXdheXNcIiB9XG4gICAgICAgIF0sXG4gICAgICAgIG91dHB1dHM6IFtcbiAgICAgICAgICB7IHR5cGU6IFwic3RyaW5nXCIsIG5hbWU6IFwicmVzb2x2ZWROYW1lXCIgfSxcbiAgICAgICAgICB7IHR5cGU6IFwiYWRkcmVzc1wiLCBuYW1lOiBcInJlc29sdmVkQWRkcmVzc1wiIH0sXG4gICAgICAgICAgeyB0eXBlOiBcImFkZHJlc3NcIiwgbmFtZTogXCJyZXZlcnNlUmVzb2x2ZXJcIiB9LFxuICAgICAgICAgIHsgdHlwZTogXCJhZGRyZXNzXCIsIG5hbWU6IFwicmVzb2x2ZXJcIiB9XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICBdO1xuICAgIHZlcnNpb24zID0gXCIyLjMxLjBcIjtcbiAgICBlcnJvckNvbmZpZyA9IHtcbiAgICAgIGdldERvY3NVcmw6ICh7IGRvY3NCYXNlVXJsLCBkb2NzUGF0aDogZG9jc1BhdGg2ID0gXCJcIiwgZG9jc1NsdWcgfSkgPT4gZG9jc1BhdGg2ID8gYCR7ZG9jc0Jhc2VVcmwgPz8gXCJodHRwczovL3ZpZW0uc2hcIn0ke2RvY3NQYXRoNn0ke2RvY3NTbHVnID8gYCMke2RvY3NTbHVnfWAgOiBcIlwifWAgOiB2b2lkIDAsXG4gICAgICB2ZXJzaW9uOiBgdmllbUAke3ZlcnNpb24zfWBcbiAgICB9O1xuICAgIEJhc2VFcnJvcjMgPSBjbGFzcyBfQmFzZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgICAgY29uc3RydWN0b3Ioc2hvcnRNZXNzYWdlLCBhcmdzID0ge30pIHtcbiAgICAgICAgY29uc3QgZGV0YWlscyA9ICgoKSA9PiB7XG4gICAgICAgICAgaWYgKGFyZ3MuY2F1c2UgaW5zdGFuY2VvZiBfQmFzZUVycm9yKVxuICAgICAgICAgICAgcmV0dXJuIGFyZ3MuY2F1c2UuZGV0YWlscztcbiAgICAgICAgICBpZiAoYXJncy5jYXVzZT8ubWVzc2FnZSlcbiAgICAgICAgICAgIHJldHVybiBhcmdzLmNhdXNlLm1lc3NhZ2U7XG4gICAgICAgICAgcmV0dXJuIGFyZ3MuZGV0YWlscztcbiAgICAgICAgfSkoKTtcbiAgICAgICAgY29uc3QgZG9jc1BhdGg2ID0gKCgpID0+IHtcbiAgICAgICAgICBpZiAoYXJncy5jYXVzZSBpbnN0YW5jZW9mIF9CYXNlRXJyb3IpXG4gICAgICAgICAgICByZXR1cm4gYXJncy5jYXVzZS5kb2NzUGF0aCB8fCBhcmdzLmRvY3NQYXRoO1xuICAgICAgICAgIHJldHVybiBhcmdzLmRvY3NQYXRoO1xuICAgICAgICB9KSgpO1xuICAgICAgICBjb25zdCBkb2NzVXJsID0gZXJyb3JDb25maWcuZ2V0RG9jc1VybD8uKHsgLi4uYXJncywgZG9jc1BhdGg6IGRvY3NQYXRoNiB9KTtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IFtcbiAgICAgICAgICBzaG9ydE1lc3NhZ2UgfHwgXCJBbiBlcnJvciBvY2N1cnJlZC5cIixcbiAgICAgICAgICBcIlwiLFxuICAgICAgICAgIC4uLihhcmdzLm1ldGFNZXNzYWdlcz8gWy4uLmFyZ3MubWV0YU1lc3NhZ2VzLCBcIlwiXSA6IFtdKSxcbiAgICAgICAgICAuLi4oZG9jc1VybD8gW2BEb2NzOiAke2RvY3NVcmx9YF0gOiBbXSksXG4gICAgICAgICAgLi4uKGRldGFpbHM/IFtgRGV0YWlsczogJHtkZXRhaWxzfWBdIDogW10pLFxuICAgICAgICAgIC4uLihlcnJvckNvbmZpZy52ZXJzaW9uPyBbYFZlcnNpb246ICR7ZXJyb3JDb25maWcudmVyc2lvbn1gXSA6IFtdKVxuICAgICAgICBdLmpvaW4oXCJcXG5cIik7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UsIGFyZ3MuY2F1c2UgPyB7IGNhdXNlOiBhcmdzLmNhdXNlIH0gOiB2b2lkIDApO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJkZXRhaWxzXCIsIHtcbiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJkb2NzUGF0aFwiLCB7XG4gICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibWV0YU1lc3NhZ2VzXCIsIHtcbiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJzaG9ydE1lc3NhZ2VcIiwge1xuICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInZlcnNpb25cIiwge1xuICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm5hbWVcIiwge1xuICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgIHZhbHVlOiBcIkJhc2VFcnJvclwiXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmRldGFpbHMgPSBkZXRhaWxzO1xuICAgICAgICB0aGlzLmRvY3NQYXRoID0gZG9jc1BhdGg2O1xuICAgICAgICB0aGlzLm1ldGFNZXNzYWdlcyA9IGFyZ3MubWV0YU1lc3NhZ2VzO1xuICAgICAgICB0aGlzLm5hbWUgPSBhcmdzLm5hbWUgPz8gdGhpcy5uYW1lO1xuICAgICAgICB0aGlzLnNob3J0TWVzc2FnZSA9IHNob3J0TWVzc2FnZTtcbiAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVyc2lvbjM7XG4gICAgICB9XG4gICAgICB3YWxrKGZuKSB7XG4gICAgICAgIHJldHVybiB3YWxrMih0aGlzLCBmbik7XG4gICAgICB9XG4gICAgfTtcbiAgICBBYmlEZWNvZGluZ0RhdGFTaXplVG9vU21hbGxFcnJvciA9IGNsYXNzIGV4dGVuZHMgQmFzZUVycm9yMyB7XG4gICAgICBjb25zdHJ1Y3Rvcih7IGRhdGEsIHBhcmFtcywgc2l6ZTogc2l6ZTMgfSkge1xuICAgICAgICBzdXBlcihbYERhdGEgc2l6ZSBvZiAke3NpemUzfSBieXRlcyBpcyB0b28gc21hbGwgZm9yIGdpdmVuIHBhcmFtZXRlcnMuYF0uam9pbihcIlxcblwiKSwge1xuICAgICAgICAgIG1ldGFNZXNzYWdlczogW1xuICAgICAgICAgICAgYFBhcmFtczogKCR7Zm9ybWF0QWJpUGFyYW1zKHBhcmFtcywgeyBpbmNsdWRlTmFtZTogdHJ1ZSB9KX0pYCxcbiAgICAgICAgICAgIGBEYXRhOiAgICR7ZGF0YX0gKCR7c2l6ZTN9IGJ5dGVzKWBcbiAgICAgICAgICBdLFxuICAgICAgICAgIG5hbWU6IFwiQWJpRGVjb2RpbmdEYXRhU2l6ZVRvb1NtYWxsRXJyb3JcIlxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiZGF0YVwiLCB7XG4gICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicGFyYW1zXCIsIHtcbiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJzaXplXCIsIHtcbiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICB2YWx1ZTogdm9pZCAwXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgICAgICB0aGlzLnBhcmFtcyA9IHBhcmFtcztcbiAgICAgICAgdGhpcy5zaXplID0gc2l6ZTM7XG4gICAgICB9XG4gICAgfTtcbiAgICBBYmlEZWNvZGluZ1plcm9EYXRhRXJyb3IgPSBjbGFzcyBleHRlbmRzIEJhc2VFcnJvcjMge1xuICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCdDYW5ub3QgZGVjb2RlIHplcm8gZGF0YSAoXCIweFwiKSB3aXRoIEFCSSBwYXJhbWV0ZXJzLicsIHtcbiAgICAgICAgICBuYW1lOiBcIkFiaURlY29kaW5nWmVyb0RhdGFFcnJvclwiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgQWJpRW5jb2RpbmdBcnJheUxlbmd0aE1pc21hdGNoRXJyb3IgPSBjbGFzcyBleHRlbmRzIEJhc2VFcnJvcjMge1xuICAgICAgY29uc3RydWN0b3IoeyBleHBlY3RlZExlbmd0aCwgZ2l2ZW5MZW5ndGgsIHR5cGUgfSkge1xuICAgICAgICBzdXBlcihbXG4gICAgICAgICAgYEFCSSBlbmNvZGluZyBhcnJheSBsZW5ndGggbWlzbWF0Y2ggZm9yIHR5cGUgJHt0eXBlfS5gLFxuICAgICAgICAgIGBFeHBlY3RlZCBsZW5ndGg6ICR7ZXhwZWN0ZWRMZW5ndGh9YCxcbiAgICAgICAgICBgR2l2ZW4gbGVuZ3RoOiAke2dpdmVuTGVuZ3RofWBcbiAgICAgICAgXS5qb2luKFwiXFxuXCIpLCB7IG5hbWU6IFwiQWJpRW5jb2RpbmdBcnJheUxlbmd0aE1pc21hdGNoRXJyb3JcIiB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIEFiaUVuY29kaW5nQnl0ZXNTaXplTWlzbWF0Y2hFcnJvciA9IGNsYXNzIGV4dGVuZHMgQmFzZUVycm9yMyB7XG4gICAgICBjb25zdHJ1Y3Rvcih7IGV4cGVjdGVkU2l6ZSwgdmFsdWUgfSkge1xuICAgICAgICBzdXBlcihgU2l6ZSBvZiBieXRlcyBcIiR7dmFsdWV9XCIgKGJ5dGVzJHtzaXplMih2YWx1ZSl9KSBkb2VzIG5vdCBtYXRjaCBleHBlY3RlZCBzaXplIChieXRlcyR7ZXhwZWN0ZWRTaXplfSkuYCwgeyBuYW1lOiBcIkFiaUVuY29kaW5nQnl0ZXNTaXplTWlzbWF0Y2hFcnJvclwiIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgQWJpRW5jb2RpbmdMZW5ndGhNaXNtYXRjaEVycm9yID0gY2xhc3MgZXh0ZW5kcyBCYXNlRXJyb3IzIHtcbiAgICAgIGNvbnN0cnVjdG9yKHsgZXhwZWN0ZWRMZW5ndGgsIGdpdmVuTGVuZ3RoIH0pIHtcbiAgICAgICAgc3VwZXIoW1xuICAgICAgICAgIFwiQUJJIGVuY29kaW5nIHBhcmFtcy92YWx1ZXMgbGVuZ3RoIG1pc21hdGNoLlwiLFxuICAgICAgICAgIGBFeHBlY3RlZCBsZW5ndGggKHBhcmFtcyk6ICR7ZXhwZWN0ZWRMZW5ndGh9YCxcbiAgICAgICAgICBgR2l2ZW4gbGVuZ3RoICh2YWx1ZXMpOiAke2dpdmVuTGVuZ3RofWBcbiAgICAgICAgXS5qb2luKFwiXFxuXCIpLCB7IG5hbWU6IFwiQWJpRW5jb2RpbmdMZW5ndGhNaXNtYXRjaEVycm9yXCIgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBBYmlGdW5jdGlvbk5vdEZvdW5kRXJyb3IgPSBjbGFzcyBleHRlbmRzIEJhc2VFcnJvcjMge1xuICAgICAgY29uc3RydWN0b3IoZnVuY3Rpb25OYW1lLCB7IGRvY3NQYXRoOiBkb2NzUGF0aDYgfSA9IHt9KSB7XG4gICAgICAgIHN1cGVyKFtcbiAgICAgICAgICBgRnVuY3Rpb24gJHtmdW5jdGlvbk5hbWUgPyBgXCIke2Z1bmN0aW9uTmFtZX1cIiBgIDogXCJcIn1ub3QgZm91bmQgb24gQUJJLmAsXG4gICAgICAgICAgXCJNYWtlIHN1cmUgeW91IGFyZSB1c2luZyB0aGUgY29ycmVjdCBBQkkgYW5kIHRoYXQgdGhlIGZ1bmN0aW9uIGV4aXN0cyBvbiBpdC5cIlxuICAgICAgICBdLmpvaW4oXCJcXG5cIiksIHtcbiAgICAgICAgICBkb2NzUGF0aDogZG9jc1BhdGg2LFxuICAgICAgICAgIG5hbWU6IFwiQWJpRnVuY3Rpb25Ob3RGb3VuZEVycm9yXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBBYmlJdGVtQW1iaWd1aXR5RXJyb3IgPSBjbGFzcyBleHRlbmRzIEJhc2VFcnJvcjMge1xuICAgICAgY29uc3RydWN0b3IoeCwgeSkge1xuICAgICAgICBzdXBlcihcIkZvdW5kIGFtYmlndW91cyB0eXBlcyBpbiBvdmVybG9hZGVkIEFCSSBpdGVtcy5cIiwge1xuICAgICAgICAgIG1ldGFNZXNzYWdlczogW1xuICAgICAgICAgICAgYFxcYCR7eC50eXBlfVxcYCBpbiBcXGAke2Zvcm1hdEFiaUl0ZW0yKHguYWJpSXRlbSl9XFxgLCBhbmRgLFxuICAgICAgICAgICAgYFxcYCR7eS50eXBlfVxcYCBpbiBcXGAke2Zvcm1hdEFiaUl0ZW0yKHkuYWJpSXRlbSl9XFxgYCxcbiAgICAgICAgICAgIFwiXCIsXG4gICAgICAgICAgICBcIlRoZXNlIHR5cGVzIGVuY29kZSBkaWZmZXJlbnRseSBhbmQgY2Fubm90IGJlIGRpc3Rpbmd1aXNoZWQgYXQgcnVudGltZS5cIixcbiAgICAgICAgICAgIFwiUmVtb3ZlIG9uZSBvZiB0aGUgYW1iaWd1b3VzIGl0ZW1zIGluIHRoZSBBQkkuXCJcbiAgICAgICAgICBdLFxuICAgICAgICAgIG5hbWU6IFwiQWJpSXRlbUFtYmlndWl0eUVycm9yXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBJbnZhbGlkQWJpRW5jb2RpbmdUeXBlRXJyb3IgPSBjbGFzcyBleHRlbmRzIEJhc2VFcnJvcjMge1xuICAgICAgY29uc3RydWN0b3IodHlwZSwgeyBkb2NzUGF0aDogZG9jc1BhdGg2IH0pIHtcbiAgICAgICAgc3VwZXIoW1xuICAgICAgICAgIGBUeXBlIFwiJHt0eXBlfVwiIGlzIG5vdCBhIHZhbGlkIGVuY29kaW5nIHR5cGUuYCxcbiAgICAgICAgICBcIlBsZWFzZSBwcm92aWRlIGEgdmFsaWQgQUJJIHR5cGUuXCJcbiAgICAgICAgXS5qb2luKFwiXFxuXCIpLCB7IGRvY3NQYXRoOiBkb2NzUGF0aDYsIG5hbWU6IFwiSW52YWxpZEFiaUVuY29kaW5nVHlwZVwiIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgSW52YWxpZEFiaURlY29kaW5nVHlwZUVycm9yID0gY2xhc3MgZXh0ZW5kcyBCYXNlRXJyb3IzIHtcbiAgICAgIGNvbnN0cnVjdG9yKHR5cGUsIHsgZG9jc1BhdGg6IGRvY3NQYXRoNiB9KSB7XG4gICAgICAgIHN1cGVyKFtcbiAgICAgICAgICBgVHlwZSBcIiR7dHlwZX1cIiBpcyBub3QgYSB2YWxpZCBkZWNvZGluZyB0eXBlLmAsXG4gICAgICAgICAgXCJQbGVhc2UgcHJvdmlkZSBhIHZhbGlkIEFCSSB0eXBlLlwiXG4gICAgICAgIF0uam9pbihcIlxcblwiKSwgeyBkb2NzUGF0aDogZG9jc1BhdGg2LCBuYW1lOiBcIkludmFsaWRBYmlEZWNvZGluZ1R5cGVcIiB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIEludmFsaWRBcnJheUVycm9yID0gY2xhc3MgZXh0ZW5kcyBCYXNlRXJyb3IzIHtcbiAgICAgIGNvbnN0cnVjdG9yKHZhbHVlKSB7XG4gICAgICAgIHN1cGVyKFtgVmFsdWUgXCIke3ZhbHVlfVwiIGlzIG5vdCBhIHZhbGlkIGFycmF5LmBdLmpvaW4oXCJcXG5cIiksIHtcbiAgICAgICAgICBuYW1lOiBcIkludmFsaWRBcnJheUVycm9yXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBJbnZhbGlkRGVmaW5pdGlvblR5cGVFcnJvciA9IGNsYXNzIGV4dGVuZHMgQmFzZUVycm9yMyB7XG4gICAgICBjb25zdHJ1Y3Rvcih0eXBlKSB7XG4gICAgICAgIHN1cGVyKFtcbiAgICAgICAgICBgXCIke3R5cGV9XCIgaXMgbm90IGEgdmFsaWQgZGVmaW5pdGlvbiB0eXBlLmAsXG4gICAgICAgICAgJ1ZhbGlkIHR5cGVzOiBcImZ1bmN0aW9uXCIsIFwiZXZlbnRcIiwgXCJlcnJvclwiJ1xuICAgICAgICBdLmpvaW4oXCJcXG5cIiksIHsgbmFtZTogXCJJbnZhbGlkRGVmaW5pdGlvblR5cGVFcnJvclwiIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgU2xpY2VPZmZzZXRPdXRPZkJvdW5kc0Vycm9yMiA9IGNsYXNzIGV4dGVuZHMgQmFzZUVycm9yMyB7XG4gICAgICBjb25zdHJ1Y3Rvcih7IG9mZnNldCwgcG9zaXRpb24sIHNpemU6IHNpemUzIH0pIHtcbiAgICAgICAgc3VwZXIoYFNsaWNlICR7cG9zaXRpb24gPT09IFwic3RhcnRcIiA/IFwic3RhcnRpbmdcIiA6IFwiZW5kaW5nXCJ9IGF0IG9mZnNldCBcIiR7b2Zmc2V0fVwiIGlzIG91dC1vZi1ib3VuZHMgKHNpemU6ICR7c2l6ZTN9KS5gLCB7IG5hbWU6IFwiU2xpY2VPZmZzZXRPdXRPZkJvdW5kc0Vycm9yXCIgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBTaXplRXhjZWVkc1BhZGRpbmdTaXplRXJyb3IyID0gY2xhc3MgZXh0ZW5kcyBCYXNlRXJyb3IzIHtcbiAgICAgIGNvbnN0cnVjdG9yKHsgc2l6ZTogc2l6ZTMsIHRhcmdldFNpemUsIHR5cGUgfSkge1xuICAgICAgICBzdXBlcihgJHt0eXBlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpfSR7dHlwZS5zbGljZSgxKS50b0xvd2VyQ2FzZSgpfSBzaXplICgke3NpemUzfSkgZXhjZWVkcyBwYWRkaW5nIHNpemUgKCR7dGFyZ2V0U2l6ZX0pLmAsIHsgbmFtZTogXCJTaXplRXhjZWVkc1BhZGRpbmdTaXplRXJyb3JcIiB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIEludGVnZXJPdXRPZlJhbmdlRXJyb3IyID0gY2xhc3MgZXh0ZW5kcyBCYXNlRXJyb3IzIHtcbiAgICAgIGNvbnN0cnVjdG9yKHsgbWF4LCBtaW4sIHNpZ25lZCwgc2l6ZTogc2l6ZTMsIHZhbHVlIH0pIHtcbiAgICAgICAgc3VwZXIoYE51bWJlciBcIiR7dmFsdWV9XCIgaXMgbm90IGluIHNhZmUgJHtzaXplMyA/IGAke3NpemUzICogOH0tYml0ICR7c2lnbmVkID8gXCJzaWduZWRcIiA6IFwidW5zaWduZWRcIn0gYCA6IFwiXCJ9aW50ZWdlciByYW5nZSAke21heCA/IGAoJHttaW59IHRvICR7bWF4fSlgIDogYChhYm92ZSAke21pbn0pYH1gLCB7IG5hbWU6IFwiSW50ZWdlck91dE9mUmFuZ2VFcnJvclwiIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgSW52YWxpZEJ5dGVzQm9vbGVhbkVycm9yID0gY2xhc3MgZXh0ZW5kcyBCYXNlRXJyb3IzIHtcbiAgICAgIGNvbnN0cnVjdG9yKGJ5dGVzMikge1xuICAgICAgICBzdXBlcihgQnl0ZXMgdmFsdWUgXCIke2J5dGVzMn1cIiBpcyBub3QgYSB2YWxpZCBib29sZWFuLiBUaGUgYnl0ZXMgYXJyYXkgbXVzdCBjb250YWluIGEgc2luZ2xlIGJ5dGUgb2YgZWl0aGVyIGEgMCBvciAxIHZhbHVlLmAsIHtcbiAgICAgICAgICBuYW1lOiBcIkludmFsaWRCeXRlc0Jvb2xlYW5FcnJvclwiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgU2l6ZU92ZXJmbG93RXJyb3IyID0gY2xhc3MgZXh0ZW5kcyBCYXNlRXJyb3IzIHtcbiAgICAgIGNvbnN0cnVjdG9yKHsgZ2l2ZW5TaXplLCBtYXhTaXplIH0pIHtcbiAgICAgICAgc3VwZXIoYFNpemUgY2Fubm90IGV4Y2VlZCAke21heFNpemV9IGJ5dGVzLiBHaXZlbiBzaXplOiAke2dpdmVuU2l6ZX0gYnl0ZXMuYCwgeyBuYW1lOiBcIlNpemVPdmVyZmxvd0Vycm9yXCIgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBoZXhlcyA9IC8qICAgICAgICAgICAqLyBBcnJheS5mcm9tKHsgbGVuZ3RoOiAyNTYgfSwgKF92LCBpMykgPT4gaTMudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsIFwiMFwiKSk7XG4gICAgZW5jb2RlciA9IC8qICAgICAgICAgICAqLyBuZXcgVGV4dEVuY29kZXIoKTtcbiAgICBlbmNvZGVyMiA9IC8qICAgICAgICAgICAqLyBuZXcgVGV4dEVuY29kZXIoKTtcbiAgICBjaGFyQ29kZU1hcCA9IHtcbiAgICAgIHplcm86IDQ4LFxuICAgICAgbmluZTogNTcsXG4gICAgICBBOiA2NSxcbiAgICAgIEY6IDcwLFxuICAgICAgYTogOTcsXG4gICAgICBmOiAxMDJcbiAgICB9O1xuICAgIGhhc2ggPSAodmFsdWUpID0+IGtlY2NhazI1Nih0b0J5dGVzMyh2YWx1ZSkpO1xuICAgIHRvU2lnbmF0dXJlID0gKGRlZikgPT4ge1xuICAgICAgY29uc3QgZGVmXyA9ICgoKSA9PiB7XG4gICAgICAgIGlmICh0eXBlb2YgZGVmID09PSBcInN0cmluZ1wiKVxuICAgICAgICAgIHJldHVybiBkZWY7XG4gICAgICAgIHJldHVybiBmb3JtYXRBYmlJdGVtKGRlZik7XG4gICAgICB9KSgpO1xuICAgICAgcmV0dXJuIG5vcm1hbGl6ZVNpZ25hdHVyZShkZWZfKTtcbiAgICB9O1xuICAgIHRvRnVuY3Rpb25TZWxlY3RvciA9IChmbikgPT4gc2xpY2UodG9TaWduYXR1cmVIYXNoKGZuKSwgMCwgNCk7XG4gICAgSW52YWxpZEFkZHJlc3NFcnJvciA9IGNsYXNzIGV4dGVuZHMgQmFzZUVycm9yMyB7XG4gICAgICBjb25zdHJ1Y3Rvcih7IGFkZHJlc3MgfSkge1xuICAgICAgICBzdXBlcihgQWRkcmVzcyBcIiR7YWRkcmVzc31cIiBpcyBpbnZhbGlkLmAsIHtcbiAgICAgICAgICBtZXRhTWVzc2FnZXM6IFtcbiAgICAgICAgICAgIFwiLSBBZGRyZXNzIG11c3QgYmUgYSBoZXggdmFsdWUgb2YgMjAgYnl0ZXMgKDQwIGhleCBjaGFyYWN0ZXJzKS5cIixcbiAgICAgICAgICAgIFwiLSBBZGRyZXNzIG11c3QgbWF0Y2ggaXRzIGNoZWNrc3VtIGNvdW50ZXJwYXJ0LlwiXG4gICAgICAgICAgXSxcbiAgICAgICAgICBuYW1lOiBcIkludmFsaWRBZGRyZXNzRXJyb3JcIlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIExydU1hcCA9IGNsYXNzIGV4dGVuZHMgTWFwIHtcbiAgICAgIGNvbnN0cnVjdG9yKHNpemUzKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm1heFNpemVcIiwge1xuICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubWF4U2l6ZSA9IHNpemUzO1xuICAgICAgfVxuICAgICAgZ2V0KGtleSkge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHN1cGVyLmdldChrZXkpO1xuICAgICAgICBpZiAoc3VwZXIuaGFzKGtleSkgJiYgdmFsdWUgIT09IHZvaWQgMCkge1xuICAgICAgICAgIHRoaXMuZGVsZXRlKGtleSk7XG4gICAgICAgICAgc3VwZXIuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH1cbiAgICAgIHNldChrZXksIHZhbHVlKSB7XG4gICAgICAgIHN1cGVyLnNldChrZXksIHZhbHVlKTtcbiAgICAgICAgaWYgKHRoaXMubWF4U2l6ZSAmJiB0aGlzLnNpemUgPiB0aGlzLm1heFNpemUpIHtcbiAgICAgICAgICBjb25zdCBmaXJzdEtleSA9IHRoaXMua2V5cygpLm5leHQoKS52YWx1ZTtcbiAgICAgICAgICBpZiAoZmlyc3RLZXkpXG4gICAgICAgICAgICB0aGlzLmRlbGV0ZShmaXJzdEtleSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG4gICAgfTtcbiAgICBhZGRyZXNzUmVnZXggPSAvXjB4W2EtZkEtRjAtOV17NDB9JC87XG4gICAgaXNBZGRyZXNzQ2FjaGUgPSAvKiAgICAgICAgICAgKi8gbmV3IExydU1hcCg4MTkyKTtcbiAgICBjaGVja3N1bUFkZHJlc3NDYWNoZSA9IC8qICAgICAgICAgICAqLyBuZXcgTHJ1TWFwKDgxOTIpO1xuICAgIE5lZ2F0aXZlT2Zmc2V0RXJyb3IgPSBjbGFzcyBleHRlbmRzIEJhc2VFcnJvcjMge1xuICAgICAgY29uc3RydWN0b3IoeyBvZmZzZXQgfSkge1xuICAgICAgICBzdXBlcihgT2Zmc2V0IFxcYCR7b2Zmc2V0fVxcYCBjYW5ub3QgYmUgbmVnYXRpdmUuYCwge1xuICAgICAgICAgIG5hbWU6IFwiTmVnYXRpdmVPZmZzZXRFcnJvclwiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgUG9zaXRpb25PdXRPZkJvdW5kc0Vycm9yID0gY2xhc3MgZXh0ZW5kcyBCYXNlRXJyb3IzIHtcbiAgICAgIGNvbnN0cnVjdG9yKHsgbGVuZ3RoLCBwb3NpdGlvbiB9KSB7XG4gICAgICAgIHN1cGVyKGBQb3NpdGlvbiBcXGAke3Bvc2l0aW9ufVxcYCBpcyBvdXQgb2YgYm91bmRzIChcXGAwIDwgcG9zaXRpb24gPCAke2xlbmd0aH1cXGApLmAsIHsgbmFtZTogXCJQb3NpdGlvbk91dE9mQm91bmRzRXJyb3JcIiB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIFJlY3Vyc2l2ZVJlYWRMaW1pdEV4Y2VlZGVkRXJyb3IgPSBjbGFzcyBleHRlbmRzIEJhc2VFcnJvcjMge1xuICAgICAgY29uc3RydWN0b3IoeyBjb3VudCwgbGltaXQ6IGxpbWl0MiB9KSB7XG4gICAgICAgIHN1cGVyKGBSZWN1cnNpdmUgcmVhZCBsaW1pdCBvZiBcXGAke2xpbWl0Mn1cXGAgZXhjZWVkZWQgKHJlY3Vyc2l2ZSByZWFkIGNvdW50OiBcXGAke2NvdW50fVxcYCkuYCwgeyBuYW1lOiBcIlJlY3Vyc2l2ZVJlYWRMaW1pdEV4Y2VlZGVkRXJyb3JcIiB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHN0YXRpY0N1cnNvciA9IHtcbiAgICAgIGJ5dGVzOiBuZXcgVWludDhBcnJheSgpLFxuICAgICAgZGF0YVZpZXc6IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoMCkpLFxuICAgICAgcG9zaXRpb246IDAsXG4gICAgICBwb3NpdGlvblJlYWRDb3VudDogLyogICAgICAgICAgICovIG5ldyBNYXAoKSxcbiAgICAgIHJlY3Vyc2l2ZVJlYWRDb3VudDogMCxcbiAgICAgIHJlY3Vyc2l2ZVJlYWRMaW1pdDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLFxuICAgICAgYXNzZXJ0UmVhZExpbWl0KCkge1xuICAgICAgICBpZiAodGhpcy5yZWN1cnNpdmVSZWFkQ291bnQgPj0gdGhpcy5yZWN1cnNpdmVSZWFkTGltaXQpXG4gICAgICAgICAgdGhyb3cgbmV3IFJlY3Vyc2l2ZVJlYWRMaW1pdEV4Y2VlZGVkRXJyb3Ioe1xuICAgICAgICAgICAgY291bnQ6IHRoaXMucmVjdXJzaXZlUmVhZENvdW50ICsgMSxcbiAgICAgICAgICAgIGxpbWl0OiB0aGlzLnJlY3Vyc2l2ZVJlYWRMaW1pdFxuICAgICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIGFzc2VydFBvc2l0aW9uKHBvc2l0aW9uKSB7XG4gICAgICAgIGlmIChwb3NpdGlvbiA8IDAgfHwgcG9zaXRpb24gPiB0aGlzLmJ5dGVzLmxlbmd0aCAtIDEpXG4gICAgICAgICAgdGhyb3cgbmV3IFBvc2l0aW9uT3V0T2ZCb3VuZHNFcnJvcih7XG4gICAgICAgICAgICBsZW5ndGg6IHRoaXMuYnl0ZXMubGVuZ3RoLFxuICAgICAgICAgICAgcG9zaXRpb25cbiAgICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBkZWNyZW1lbnRQb3NpdGlvbihvZmZzZXQpIHtcbiAgICAgICAgaWYgKG9mZnNldCA8IDApXG4gICAgICAgICAgdGhyb3cgbmV3IE5lZ2F0aXZlT2Zmc2V0RXJyb3IoeyBvZmZzZXQgfSk7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5wb3NpdGlvbiAtIG9mZnNldDtcbiAgICAgICAgdGhpcy5hc3NlcnRQb3NpdGlvbihwb3NpdGlvbik7XG4gICAgICAgIHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgIH0sXG4gICAgICBnZXRSZWFkQ291bnQocG9zaXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9zaXRpb25SZWFkQ291bnQuZ2V0KHBvc2l0aW9uIHx8IHRoaXMucG9zaXRpb24pIHx8IDA7XG4gICAgICB9LFxuICAgICAgaW5jcmVtZW50UG9zaXRpb24ob2Zmc2V0KSB7XG4gICAgICAgIGlmIChvZmZzZXQgPCAwKVxuICAgICAgICAgIHRocm93IG5ldyBOZWdhdGl2ZU9mZnNldEVycm9yKHsgb2Zmc2V0IH0pO1xuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHRoaXMucG9zaXRpb24gKyBvZmZzZXQ7XG4gICAgICAgIHRoaXMuYXNzZXJ0UG9zaXRpb24ocG9zaXRpb24pO1xuICAgICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICB9LFxuICAgICAgaW5zcGVjdEJ5dGUocG9zaXRpb25fKSB7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gcG9zaXRpb25fID8/IHRoaXMucG9zaXRpb247XG4gICAgICAgIHRoaXMuYXNzZXJ0UG9zaXRpb24ocG9zaXRpb24pO1xuICAgICAgICByZXR1cm4gdGhpcy5ieXRlc1twb3NpdGlvbl07XG4gICAgICB9LFxuICAgICAgaW5zcGVjdEJ5dGVzKGxlbmd0aCwgcG9zaXRpb25fKSB7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gcG9zaXRpb25fID8/IHRoaXMucG9zaXRpb247XG4gICAgICAgIHRoaXMuYXNzZXJ0UG9zaXRpb24ocG9zaXRpb24gKyBsZW5ndGggLSAxKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXMuc3ViYXJyYXkocG9zaXRpb24sIHBvc2l0aW9uICsgbGVuZ3RoKTtcbiAgICAgIH0sXG4gICAgICBpbnNwZWN0VWludDgocG9zaXRpb25fKSB7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gcG9zaXRpb25fID8/IHRoaXMucG9zaXRpb247XG4gICAgICAgIHRoaXMuYXNzZXJ0UG9zaXRpb24ocG9zaXRpb24pO1xuICAgICAgICByZXR1cm4gdGhpcy5ieXRlc1twb3NpdGlvbl07XG4gICAgICB9LFxuICAgICAgaW5zcGVjdFVpbnQxNihwb3NpdGlvbl8pIHtcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBwb3NpdGlvbl8gPz8gdGhpcy5wb3NpdGlvbjtcbiAgICAgICAgdGhpcy5hc3NlcnRQb3NpdGlvbihwb3NpdGlvbiArIDEpO1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhVmlldy5nZXRVaW50MTYocG9zaXRpb24pO1xuICAgICAgfSxcbiAgICAgIGluc3BlY3RVaW50MjQocG9zaXRpb25fKSB7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gcG9zaXRpb25fID8/IHRoaXMucG9zaXRpb247XG4gICAgICAgIHRoaXMuYXNzZXJ0UG9zaXRpb24ocG9zaXRpb24gKyAyKTtcbiAgICAgICAgcmV0dXJuICh0aGlzLmRhdGFWaWV3LmdldFVpbnQxNihwb3NpdGlvbikgPDwgOCkgKyB0aGlzLmRhdGFWaWV3LmdldFVpbnQ4KHBvc2l0aW9uICsgMik7XG4gICAgICB9LFxuICAgICAgaW5zcGVjdFVpbnQzMihwb3NpdGlvbl8pIHtcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBwb3NpdGlvbl8gPz8gdGhpcy5wb3NpdGlvbjtcbiAgICAgICAgdGhpcy5hc3NlcnRQb3NpdGlvbihwb3NpdGlvbiArIDMpO1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhVmlldy5nZXRVaW50MzIocG9zaXRpb24pO1xuICAgICAgfSxcbiAgICAgIHB1c2hCeXRlKGJ5dGUpIHtcbiAgICAgICAgdGhpcy5hc3NlcnRQb3NpdGlvbih0aGlzLnBvc2l0aW9uKTtcbiAgICAgICAgdGhpcy5ieXRlc1t0aGlzLnBvc2l0aW9uXSA9IGJ5dGU7XG4gICAgICAgIHRoaXMucG9zaXRpb24rKztcbiAgICAgIH0sXG4gICAgICBwdXNoQnl0ZXMoYnl0ZXMyKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0UG9zaXRpb24odGhpcy5wb3NpdGlvbiArIGJ5dGVzMi5sZW5ndGggLSAxKTtcbiAgICAgICAgdGhpcy5ieXRlcy5zZXQoYnl0ZXMyLCB0aGlzLnBvc2l0aW9uKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiArPSBieXRlczIubGVuZ3RoO1xuICAgICAgfSxcbiAgICAgIHB1c2hVaW50OCh2YWx1ZSkge1xuICAgICAgICB0aGlzLmFzc2VydFBvc2l0aW9uKHRoaXMucG9zaXRpb24pO1xuICAgICAgICB0aGlzLmJ5dGVzW3RoaXMucG9zaXRpb25dID0gdmFsdWU7XG4gICAgICAgIHRoaXMucG9zaXRpb24rKztcbiAgICAgIH0sXG4gICAgICBwdXNoVWludDE2KHZhbHVlKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0UG9zaXRpb24odGhpcy5wb3NpdGlvbiArIDEpO1xuICAgICAgICB0aGlzLmRhdGFWaWV3LnNldFVpbnQxNih0aGlzLnBvc2l0aW9uLCB2YWx1ZSk7XG4gICAgICAgIHRoaXMucG9zaXRpb24gKz0gMjtcbiAgICAgIH0sXG4gICAgICBwdXNoVWludDI0KHZhbHVlKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0UG9zaXRpb24odGhpcy5wb3NpdGlvbiArIDIpO1xuICAgICAgICB0aGlzLmRhdGFWaWV3LnNldFVpbnQxNih0aGlzLnBvc2l0aW9uLCB2YWx1ZSA+PiA4KTtcbiAgICAgICAgdGhpcy5kYXRhVmlldy5zZXRVaW50OCh0aGlzLnBvc2l0aW9uICsgMiwgdmFsdWUgJiB+NDI5NDk2NzA0MCk7XG4gICAgICAgIHRoaXMucG9zaXRpb24gKz0gMztcbiAgICAgIH0sXG4gICAgICBwdXNoVWludDMyKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0UG9zaXRpb24odGhpcy5wb3NpdGlvbiArIDMpO1xuICAgICAgICB0aGlzLmRhdGFWaWV3LnNldFVpbnQzMih0aGlzLnBvc2l0aW9uLCB2YWx1ZSk7XG4gICAgICAgIHRoaXMucG9zaXRpb24gKz0gNDtcbiAgICAgIH0sXG4gICAgICByZWFkQnl0ZSgpIHtcbiAgICAgICAgdGhpcy5hc3NlcnRSZWFkTGltaXQoKTtcbiAgICAgICAgdGhpcy5fdG91Y2goKTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmluc3BlY3RCeXRlKCk7XG4gICAgICAgIHRoaXMucG9zaXRpb24rKztcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgfSxcbiAgICAgIHJlYWRCeXRlcyhsZW5ndGgsIHNpemUzKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0UmVhZExpbWl0KCk7XG4gICAgICAgIHRoaXMuX3RvdWNoKCk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5pbnNwZWN0Qnl0ZXMobGVuZ3RoKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiArPSBzaXplMyA/PyBsZW5ndGg7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH0sXG4gICAgICByZWFkVWludDgoKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0UmVhZExpbWl0KCk7XG4gICAgICAgIHRoaXMuX3RvdWNoKCk7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5pbnNwZWN0VWludDgoKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiArPSAxO1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9LFxuICAgICAgcmVhZFVpbnQxNigpIHtcbiAgICAgICAgdGhpcy5hc3NlcnRSZWFkTGltaXQoKTtcbiAgICAgICAgdGhpcy5fdG91Y2goKTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmluc3BlY3RVaW50MTYoKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiArPSAyO1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9LFxuICAgICAgcmVhZFVpbnQyNCgpIHtcbiAgICAgICAgdGhpcy5hc3NlcnRSZWFkTGltaXQoKTtcbiAgICAgICAgdGhpcy5fdG91Y2goKTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmluc3BlY3RVaW50MjQoKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiArPSAzO1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9LFxuICAgICAgcmVhZFVpbnQzMigpIHtcbiAgICAgICAgdGhpcy5hc3NlcnRSZWFkTGltaXQoKTtcbiAgICAgICAgdGhpcy5fdG91Y2goKTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSB0aGlzLmluc3BlY3RVaW50MzIoKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiArPSA0O1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICB9LFxuICAgICAgZ2V0IHJlbWFpbmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnl0ZXMubGVuZ3RoIC0gdGhpcy5wb3NpdGlvbjtcbiAgICAgIH0sXG4gICAgICBzZXRQb3NpdGlvbihwb3NpdGlvbikge1xuICAgICAgICBjb25zdCBvbGRQb3NpdGlvbiA9IHRoaXMucG9zaXRpb247XG4gICAgICAgIHRoaXMuYXNzZXJ0UG9zaXRpb24ocG9zaXRpb24pO1xuICAgICAgICB0aGlzLnBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgIHJldHVybiAoKSA9PiB0aGlzLnBvc2l0aW9uID0gb2xkUG9zaXRpb247XG4gICAgICB9LFxuICAgICAgX3RvdWNoKCkge1xuICAgICAgICBpZiAodGhpcy5yZWN1cnNpdmVSZWFkTGltaXQgPT09IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSlcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5nZXRSZWFkQ291bnQoKTtcbiAgICAgICAgdGhpcy5wb3NpdGlvblJlYWRDb3VudC5zZXQodGhpcy5wb3NpdGlvbiwgY291bnQgKyAxKTtcbiAgICAgICAgaWYgKGNvdW50ID4gMClcbiAgICAgICAgICB0aGlzLnJlY3Vyc2l2ZVJlYWRDb3VudCsrO1xuICAgICAgfVxuICAgIH07XG4gICAgaW50ZWdlclJlZ2V4MiA9IC9eKHU/aW50KSg4fDE2fDI0fDMyfDQwfDQ4fDU2fDY0fDcyfDgwfDg4fDk2fDEwNHwxMTJ8MTIwfDEyOHwxMzZ8MTQ0fDE1MnwxNjB8MTY4fDE3NnwxODR8MTkyfDIwMHwyMDh8MjE2fDIyNHwyMzJ8MjQwfDI0OHwyNTYpPyQvO1xuICAgIHNpemVPZkxlbmd0aCA9IDMyO1xuICAgIHNpemVPZk9mZnNldCA9IDMyO1xuICAgIHRvRXZlbnRTZWxlY3RvciA9IHRvU2lnbmF0dXJlSGFzaDtcbiAgICBnd2VpVW5pdHMgPSB7XG4gICAgICBldGhlcjogLTksXG4gICAgICB3ZWk6IDlcbiAgICB9O1xuICAgIGRvY3NQYXRoMyA9IFwiL2RvY3MvY29udHJhY3QvZW5jb2RlRnVuY3Rpb25EYXRhXCI7XG4gICAgRXhlY3V0aW9uUmV2ZXJ0ZWRFcnJvciA9IGNsYXNzIGV4dGVuZHMgQmFzZUVycm9yMyB7XG4gICAgICBjb25zdHJ1Y3Rvcih7IGNhdXNlLCBtZXNzYWdlIH0gPSB7fSkge1xuICAgICAgICBjb25zdCByZWFzb24gPSBtZXNzYWdlPy5yZXBsYWNlKFwiZXhlY3V0aW9uIHJldmVydGVkOiBcIiwgXCJcIik/LnJlcGxhY2UoXCJleGVjdXRpb24gcmV2ZXJ0ZWRcIiwgXCJcIik7XG4gICAgICAgIHN1cGVyKGBFeGVjdXRpb24gcmV2ZXJ0ZWQgJHtyZWFzb24gPyBgd2l0aCByZWFzb246ICR7cmVhc29ufWAgOiBcImZvciBhbiB1bmtub3duIHJlYXNvblwifS5gLCB7XG4gICAgICAgICAgY2F1c2UsXG4gICAgICAgICAgbmFtZTogXCJFeGVjdXRpb25SZXZlcnRlZEVycm9yXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoRXhlY3V0aW9uUmV2ZXJ0ZWRFcnJvciwgXCJjb2RlXCIsIHtcbiAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgIHZhbHVlOiAzXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEV4ZWN1dGlvblJldmVydGVkRXJyb3IsIFwibm9kZU1lc3NhZ2VcIiwge1xuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgdmFsdWU6IC9leGVjdXRpb24gcmV2ZXJ0ZWQvXG4gICAgfSk7XG4gICAgRmVlQ2FwVG9vSGlnaEVycm9yID0gY2xhc3MgZXh0ZW5kcyBCYXNlRXJyb3IzIHtcbiAgICAgIGNvbnN0cnVjdG9yKHsgY2F1c2UsIG1heEZlZVBlckdhcyB9ID0ge30pIHtcbiAgICAgICAgc3VwZXIoYFRoZSBmZWUgY2FwIChcXGBtYXhGZWVQZXJHYXNcXGAke21heEZlZVBlckdhcyA/IGAgPSAke2Zvcm1hdEd3ZWkobWF4RmVlUGVyR2FzKX0gZ3dlaWAgOiBcIlwifSkgY2Fubm90IGJlIGhpZ2hlciB0aGFuIHRoZSBtYXhpbXVtIGFsbG93ZWQgdmFsdWUgKDJeMjU2LTEpLmAsIHtcbiAgICAgICAgICBjYXVzZSxcbiAgICAgICAgICBuYW1lOiBcIkZlZUNhcFRvb0hpZ2hFcnJvclwiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEZlZUNhcFRvb0hpZ2hFcnJvciwgXCJub2RlTWVzc2FnZVwiLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICB2YWx1ZTogL21heCBmZWUgcGVyIGdhcyBoaWdoZXIgdGhhbiAyXFxeMjU2LTF8ZmVlIGNhcCBoaWdoZXIgdGhhbiAyXFxeMjU2LTEvXG4gICAgfSk7XG4gICAgRmVlQ2FwVG9vTG93RXJyb3IgPSBjbGFzcyBleHRlbmRzIEJhc2VFcnJvcjMge1xuICAgICAgY29uc3RydWN0b3IoeyBjYXVzZSwgbWF4RmVlUGVyR2FzIH0gPSB7fSkge1xuICAgICAgICBzdXBlcihgVGhlIGZlZSBjYXAgKFxcYG1heEZlZVBlckdhc1xcYCR7bWF4RmVlUGVyR2FzID8gYCA9ICR7Zm9ybWF0R3dlaShtYXhGZWVQZXJHYXMpfWAgOiBcIlwifSBnd2VpKSBjYW5ub3QgYmUgbG93ZXIgdGhhbiB0aGUgYmxvY2sgYmFzZSBmZWUuYCwge1xuICAgICAgICAgIGNhdXNlLFxuICAgICAgICAgIG5hbWU6IFwiRmVlQ2FwVG9vTG93RXJyb3JcIlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGZWVDYXBUb29Mb3dFcnJvciwgXCJub2RlTWVzc2FnZVwiLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICB2YWx1ZTogL21heCBmZWUgcGVyIGdhcyBsZXNzIHRoYW4gYmxvY2sgYmFzZSBmZWV8ZmVlIGNhcCBsZXNzIHRoYW4gYmxvY2sgYmFzZSBmZWV8dHJhbnNhY3Rpb24gaXMgb3V0ZGF0ZWQvXG4gICAgfSk7XG4gICAgTm9uY2VUb29IaWdoRXJyb3IgPSBjbGFzcyBleHRlbmRzIEJhc2VFcnJvcjMge1xuICAgICAgY29uc3RydWN0b3IoeyBjYXVzZSwgbm9uY2UgfSA9IHt9KSB7XG4gICAgICAgIHN1cGVyKGBOb25jZSBwcm92aWRlZCBmb3IgdGhlIHRyYW5zYWN0aW9uICR7bm9uY2UgPyBgKCR7bm9uY2V9KSBgIDogXCJcIn1pcyBoaWdoZXIgdGhhbiB0aGUgbmV4dCBvbmUgZXhwZWN0ZWQuYCwgeyBjYXVzZSwgbmFtZTogXCJOb25jZVRvb0hpZ2hFcnJvclwiIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE5vbmNlVG9vSGlnaEVycm9yLCBcIm5vZGVNZXNzYWdlXCIsIHtcbiAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgIHZhbHVlOiAvbm9uY2UgdG9vIGhpZ2gvXG4gICAgfSk7XG4gICAgTm9uY2VUb29Mb3dFcnJvciA9IGNsYXNzIGV4dGVuZHMgQmFzZUVycm9yMyB7XG4gICAgICBjb25zdHJ1Y3Rvcih7IGNhdXNlLCBub25jZSB9ID0ge30pIHtcbiAgICAgICAgc3VwZXIoW1xuICAgICAgICAgIGBOb25jZSBwcm92aWRlZCBmb3IgdGhlIHRyYW5zYWN0aW9uICR7bm9uY2UgPyBgKCR7bm9uY2V9KSBgIDogXCJcIn1pcyBsb3dlciB0aGFuIHRoZSBjdXJyZW50IG5vbmNlIG9mIHRoZSBhY2NvdW50LmAsXG4gICAgICAgICAgXCJUcnkgaW5jcmVhc2luZyB0aGUgbm9uY2Ugb3IgZmluZCB0aGUgbGF0ZXN0IG5vbmNlIHdpdGggYGdldFRyYW5zYWN0aW9uQ291bnRgLlwiXG4gICAgICAgIF0uam9pbihcIlxcblwiKSwgeyBjYXVzZSwgbmFtZTogXCJOb25jZVRvb0xvd0Vycm9yXCIgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTm9uY2VUb29Mb3dFcnJvciwgXCJub2RlTWVzc2FnZVwiLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICB2YWx1ZTogL25vbmNlIHRvbyBsb3d8dHJhbnNhY3Rpb24gYWxyZWFkeSBpbXBvcnRlZHxhbHJlYWR5IGtub3duL1xuICAgIH0pO1xuICAgIE5vbmNlTWF4VmFsdWVFcnJvciA9IGNsYXNzIGV4dGVuZHMgQmFzZUVycm9yMyB7XG4gICAgICBjb25zdHJ1Y3Rvcih7IGNhdXNlLCBub25jZSB9ID0ge30pIHtcbiAgICAgICAgc3VwZXIoYE5vbmNlIHByb3ZpZGVkIGZvciB0aGUgdHJhbnNhY3Rpb24gJHtub25jZSA/IGAoJHtub25jZX0pIGAgOiBcIlwifWV4Y2VlZHMgdGhlIG1heGltdW0gYWxsb3dlZCBub25jZS5gLCB7IGNhdXNlLCBuYW1lOiBcIk5vbmNlTWF4VmFsdWVFcnJvclwiIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE5vbmNlTWF4VmFsdWVFcnJvciwgXCJub2RlTWVzc2FnZVwiLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICB2YWx1ZTogL25vbmNlIGhhcyBtYXggdmFsdWUvXG4gICAgfSk7XG4gICAgSW5zdWZmaWNpZW50RnVuZHNFcnJvciA9IGNsYXNzIGV4dGVuZHMgQmFzZUVycm9yMyB7XG4gICAgICBjb25zdHJ1Y3Rvcih7IGNhdXNlIH0gPSB7fSkge1xuICAgICAgICBzdXBlcihbXG4gICAgICAgICAgXCJUaGUgdG90YWwgY29zdCAoZ2FzICogZ2FzIGZlZSArIHZhbHVlKSBvZiBleGVjdXRpbmcgdGhpcyB0cmFuc2FjdGlvbiBleGNlZWRzIHRoZSBiYWxhbmNlIG9mIHRoZSBhY2NvdW50LlwiXG4gICAgICAgIF0uam9pbihcIlxcblwiKSwge1xuICAgICAgICAgIGNhdXNlLFxuICAgICAgICAgIG1ldGFNZXNzYWdlczogW1xuICAgICAgICAgICAgXCJUaGlzIGVycm9yIGNvdWxkIGFyaXNlIHdoZW4gdGhlIGFjY291bnQgZG9lcyBub3QgaGF2ZSBlbm91Z2ggZnVuZHMgdG86XCIsXG4gICAgICAgICAgICBcIiAtIHBheSBmb3IgdGhlIHRvdGFsIGdhcyBmZWUsXCIsXG4gICAgICAgICAgICBcIiAtIHBheSBmb3IgdGhlIHZhbHVlIHRvIHNlbmQuXCIsXG4gICAgICAgICAgICBcIiBcIixcbiAgICAgICAgICAgIFwiVGhlIGNvc3Qgb2YgdGhlIHRyYW5zYWN0aW9uIGlzIGNhbGN1bGF0ZWQgYXMgYGdhcyAqIGdhcyBmZWUgKyB2YWx1ZWAsIHdoZXJlOlwiLFxuICAgICAgICAgICAgXCIgLSBgZ2FzYCBpcyB0aGUgYW1vdW50IG9mIGdhcyBuZWVkZWQgZm9yIHRyYW5zYWN0aW9uIHRvIGV4ZWN1dGUsXCIsXG4gICAgICAgICAgICBcIiAtIGBnYXMgZmVlYCBpcyB0aGUgZ2FzIGZlZSxcIixcbiAgICAgICAgICAgIFwiIC0gYHZhbHVlYCBpcyB0aGUgYW1vdW50IG9mIGV0aGVyIHRvIHNlbmQgdG8gdGhlIHJlY2lwaWVudC5cIlxuICAgICAgICAgIF0sXG4gICAgICAgICAgbmFtZTogXCJJbnN1ZmZpY2llbnRGdW5kc0Vycm9yXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSW5zdWZmaWNpZW50RnVuZHNFcnJvciwgXCJub2RlTWVzc2FnZVwiLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICB2YWx1ZTogL2luc3VmZmljaWVudCBmdW5kc3xleGNlZWRzIHRyYW5zYWN0aW9uIHNlbmRlciBhY2NvdW50IGJhbGFuY2UvXG4gICAgfSk7XG4gICAgSW50cmluc2ljR2FzVG9vSGlnaEVycm9yID0gY2xhc3MgZXh0ZW5kcyBCYXNlRXJyb3IzIHtcbiAgICAgIGNvbnN0cnVjdG9yKHsgY2F1c2UsIGdhcyB9ID0ge30pIHtcbiAgICAgICAgc3VwZXIoYFRoZSBhbW91bnQgb2YgZ2FzICR7Z2FzID8gYCgke2dhc30pIGAgOiBcIlwifXByb3ZpZGVkIGZvciB0aGUgdHJhbnNhY3Rpb24gZXhjZWVkcyB0aGUgbGltaXQgYWxsb3dlZCBmb3IgdGhlIGJsb2NrLmAsIHtcbiAgICAgICAgICBjYXVzZSxcbiAgICAgICAgICBuYW1lOiBcIkludHJpbnNpY0dhc1Rvb0hpZ2hFcnJvclwiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEludHJpbnNpY0dhc1Rvb0hpZ2hFcnJvciwgXCJub2RlTWVzc2FnZVwiLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICB2YWx1ZTogL2ludHJpbnNpYyBnYXMgdG9vIGhpZ2h8Z2FzIGxpbWl0IHJlYWNoZWQvXG4gICAgfSk7XG4gICAgSW50cmluc2ljR2FzVG9vTG93RXJyb3IgPSBjbGFzcyBleHRlbmRzIEJhc2VFcnJvcjMge1xuICAgICAgY29uc3RydWN0b3IoeyBjYXVzZSwgZ2FzIH0gPSB7fSkge1xuICAgICAgICBzdXBlcihgVGhlIGFtb3VudCBvZiBnYXMgJHtnYXMgPyBgKCR7Z2FzfSkgYCA6IFwiXCJ9cHJvdmlkZWQgZm9yIHRoZSB0cmFuc2FjdGlvbiBpcyB0b28gbG93LmAsIHtcbiAgICAgICAgICBjYXVzZSxcbiAgICAgICAgICBuYW1lOiBcIkludHJpbnNpY0dhc1Rvb0xvd0Vycm9yXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSW50cmluc2ljR2FzVG9vTG93RXJyb3IsIFwibm9kZU1lc3NhZ2VcIiwge1xuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgdmFsdWU6IC9pbnRyaW5zaWMgZ2FzIHRvbyBsb3cvXG4gICAgfSk7XG4gICAgVHJhbnNhY3Rpb25UeXBlTm90U3VwcG9ydGVkRXJyb3IgPSBjbGFzcyBleHRlbmRzIEJhc2VFcnJvcjMge1xuICAgICAgY29uc3RydWN0b3IoeyBjYXVzZSB9KSB7XG4gICAgICAgIHN1cGVyKFwiVGhlIHRyYW5zYWN0aW9uIHR5cGUgaXMgbm90IHN1cHBvcnRlZCBmb3IgdGhpcyBjaGFpbi5cIiwge1xuICAgICAgICAgIGNhdXNlLFxuICAgICAgICAgIG5hbWU6IFwiVHJhbnNhY3Rpb25UeXBlTm90U3VwcG9ydGVkRXJyb3JcIlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUcmFuc2FjdGlvblR5cGVOb3RTdXBwb3J0ZWRFcnJvciwgXCJub2RlTWVzc2FnZVwiLCB7XG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICB2YWx1ZTogL3RyYW5zYWN0aW9uIHR5cGUgbm90IHZhbGlkL1xuICAgIH0pO1xuICAgIFRpcEFib3ZlRmVlQ2FwRXJyb3IgPSBjbGFzcyBleHRlbmRzIEJhc2VFcnJvcjMge1xuICAgICAgY29uc3RydWN0b3IoeyBjYXVzZSwgbWF4UHJpb3JpdHlGZWVQZXJHYXMsIG1heEZlZVBlckdhcyB9ID0ge30pIHtcbiAgICAgICAgc3VwZXIoW1xuICAgICAgICAgIGBUaGUgcHJvdmlkZWQgdGlwIChcXGBtYXhQcmlvcml0eUZlZVBlckdhc1xcYCR7bWF4UHJpb3JpdHlGZWVQZXJHYXMgPyBgID0gJHtmb3JtYXRHd2VpKG1heFByaW9yaXR5RmVlUGVyR2FzKX0gZ3dlaWAgOiBcIlwifSkgY2Fubm90IGJlIGhpZ2hlciB0aGFuIHRoZSBmZWUgY2FwIChcXGBtYXhGZWVQZXJHYXNcXGAke21heEZlZVBlckdhcyA/IGAgPSAke2Zvcm1hdEd3ZWkobWF4RmVlUGVyR2FzKX0gZ3dlaWAgOiBcIlwifSkuYFxuICAgICAgICBdLmpvaW4oXCJcXG5cIiksIHtcbiAgICAgICAgICBjYXVzZSxcbiAgICAgICAgICBuYW1lOiBcIlRpcEFib3ZlRmVlQ2FwRXJyb3JcIlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUaXBBYm92ZUZlZUNhcEVycm9yLCBcIm5vZGVNZXNzYWdlXCIsIHtcbiAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgIHZhbHVlOiAvbWF4IHByaW9yaXR5IGZlZSBwZXIgZ2FzIGhpZ2hlciB0aGFuIG1heCBmZWUgcGVyIGdhc3x0aXAgaGlnaGVyIHRoYW4gZmVlIGNhcC9cbiAgICB9KTtcbiAgICBtYXhJbnQ4ID0gMm4gKiogKDhuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50MTYgPSAybiAqKiAoMTZuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50MjQgPSAybiAqKiAoMjRuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50MzIgPSAybiAqKiAoMzJuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50NDAgPSAybiAqKiAoNDBuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50NDggPSAybiAqKiAoNDhuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50NTYgPSAybiAqKiAoNTZuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50NjQgPSAybiAqKiAoNjRuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50NzIgPSAybiAqKiAoNzJuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50ODAgPSAybiAqKiAoODBuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50ODggPSAybiAqKiAoODhuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50OTYgPSAybiAqKiAoOTZuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50MTA0ID0gMm4gKiogKDEwNG4gLSAxbikgLSAxbjtcbiAgICBtYXhJbnQxMTIgPSAybiAqKiAoMTEybiAtIDFuKSAtIDFuO1xuICAgIG1heEludDEyMCA9IDJuICoqICgxMjBuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50MTI4ID0gMm4gKiogKDEyOG4gLSAxbikgLSAxbjtcbiAgICBtYXhJbnQxMzYgPSAybiAqKiAoMTM2biAtIDFuKSAtIDFuO1xuICAgIG1heEludDE0NCA9IDJuICoqICgxNDRuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50MTUyID0gMm4gKiogKDE1Mm4gLSAxbikgLSAxbjtcbiAgICBtYXhJbnQxNjAgPSAybiAqKiAoMTYwbiAtIDFuKSAtIDFuO1xuICAgIG1heEludDE2OCA9IDJuICoqICgxNjhuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50MTc2ID0gMm4gKiogKDE3Nm4gLSAxbikgLSAxbjtcbiAgICBtYXhJbnQxODQgPSAybiAqKiAoMTg0biAtIDFuKSAtIDFuO1xuICAgIG1heEludDE5MiA9IDJuICoqICgxOTJuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50MjAwID0gMm4gKiogKDIwMG4gLSAxbikgLSAxbjtcbiAgICBtYXhJbnQyMDggPSAybiAqKiAoMjA4biAtIDFuKSAtIDFuO1xuICAgIG1heEludDIxNiA9IDJuICoqICgyMTZuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50MjI0ID0gMm4gKiogKDIyNG4gLSAxbikgLSAxbjtcbiAgICBtYXhJbnQyMzIgPSAybiAqKiAoMjMybiAtIDFuKSAtIDFuO1xuICAgIG1heEludDI0MCA9IDJuICoqICgyNDBuIC0gMW4pIC0gMW47XG4gICAgbWF4SW50MjQ4ID0gMm4gKiogKDI0OG4gLSAxbikgLSAxbjtcbiAgICBtYXhJbnQyNTYgPSAybiAqKiAoMjU2biAtIDFuKSAtIDFuO1xuICAgIG1pbkludDggPSAtKDJuICoqICg4biAtIDFuKSk7XG4gICAgbWluSW50MTYgPSAtKDJuICoqICgxNm4gLSAxbikpO1xuICAgIG1pbkludDI0ID0gLSgybiAqKiAoMjRuIC0gMW4pKTtcbiAgICBtaW5JbnQzMiA9IC0oMm4gKiogKDMybiAtIDFuKSk7XG4gICAgbWluSW50NDAgPSAtKDJuICoqICg0MG4gLSAxbikpO1xuICAgIG1pbkludDQ4ID0gLSgybiAqKiAoNDhuIC0gMW4pKTtcbiAgICBtaW5JbnQ1NiA9IC0oMm4gKiogKDU2biAtIDFuKSk7XG4gICAgbWluSW50NjQgPSAtKDJuICoqICg2NG4gLSAxbikpO1xuICAgIG1pbkludDcyID0gLSgybiAqKiAoNzJuIC0gMW4pKTtcbiAgICBtaW5JbnQ4MCA9IC0oMm4gKiogKDgwbiAtIDFuKSk7XG4gICAgbWluSW50ODggPSAtKDJuICoqICg4OG4gLSAxbikpO1xuICAgIG1pbkludDk2ID0gLSgybiAqKiAoOTZuIC0gMW4pKTtcbiAgICBtaW5JbnQxMDQgPSAtKDJuICoqICgxMDRuIC0gMW4pKTtcbiAgICBtaW5JbnQxMTIgPSAtKDJuICoqICgxMTJuIC0gMW4pKTtcbiAgICBtaW5JbnQxMjAgPSAtKDJuICoqICgxMjBuIC0gMW4pKTtcbiAgICBtaW5JbnQxMjggPSAtKDJuICoqICgxMjhuIC0gMW4pKTtcbiAgICBtaW5JbnQxMzYgPSAtKDJuICoqICgxMzZuIC0gMW4pKTtcbiAgICBtaW5JbnQxNDQgPSAtKDJuICoqICgxNDRuIC0gMW4pKTtcbiAgICBtaW5JbnQxNTIgPSAtKDJuICoqICgxNTJuIC0gMW4pKTtcbiAgICBtaW5JbnQxNjAgPSAtKDJuICoqICgxNjBuIC0gMW4pKTtcbiAgICBtaW5JbnQxNjggPSAtKDJuICoqICgxNjhuIC0gMW4pKTtcbiAgICBtaW5JbnQxNzYgPSAtKDJuICoqICgxNzZuIC0gMW4pKTtcbiAgICBtaW5JbnQxODQgPSAtKDJuICoqICgxODRuIC0gMW4pKTtcbiAgICBtaW5JbnQxOTIgPSAtKDJuICoqICgxOTJuIC0gMW4pKTtcbiAgICBtaW5JbnQyMDAgPSAtKDJuICoqICgyMDBuIC0gMW4pKTtcbiAgICBtaW5JbnQyMDggPSAtKDJuICoqICgyMDhuIC0gMW4pKTtcbiAgICBtaW5JbnQyMTYgPSAtKDJuICoqICgyMTZuIC0gMW4pKTtcbiAgICBtaW5JbnQyMjQgPSAtKDJuICoqICgyMjRuIC0gMW4pKTtcbiAgICBtaW5JbnQyMzIgPSAtKDJuICoqICgyMzJuIC0gMW4pKTtcbiAgICBtaW5JbnQyNDAgPSAtKDJuICoqICgyNDBuIC0gMW4pKTtcbiAgICBtaW5JbnQyNDggPSAtKDJuICoqICgyNDhuIC0gMW4pKTtcbiAgICBtaW5JbnQyNTYgPSAtKDJuICoqICgyNTZuIC0gMW4pKTtcbiAgICBtYXhVaW50OCA9IDJuICoqIDhuIC0gMW47XG4gICAgbWF4VWludDE2ID0gMm4gKiogMTZuIC0gMW47XG4gICAgbWF4VWludDI0ID0gMm4gKiogMjRuIC0gMW47XG4gICAgbWF4VWludDMyID0gMm4gKiogMzJuIC0gMW47XG4gICAgbWF4VWludDQwID0gMm4gKiogNDBuIC0gMW47XG4gICAgbWF4VWludDQ4ID0gMm4gKiogNDhuIC0gMW47XG4gICAgbWF4VWludDU2ID0gMm4gKiogNTZuIC0gMW47XG4gICAgbWF4VWludDY0ID0gMm4gKiogNjRuIC0gMW47XG4gICAgbWF4VWludDcyID0gMm4gKiogNzJuIC0gMW47XG4gICAgbWF4VWludDgwID0gMm4gKiogODBuIC0gMW47XG4gICAgbWF4VWludDg4ID0gMm4gKiogODhuIC0gMW47XG4gICAgbWF4VWludDk2ID0gMm4gKiogOTZuIC0gMW47XG4gICAgbWF4VWludDEwNCA9IDJuICoqIDEwNG4gLSAxbjtcbiAgICBtYXhVaW50MTEyID0gMm4gKiogMTEybiAtIDFuO1xuICAgIG1heFVpbnQxMjAgPSAybiAqKiAxMjBuIC0gMW47XG4gICAgbWF4VWludDEyOCA9IDJuICoqIDEyOG4gLSAxbjtcbiAgICBtYXhVaW50MTM2ID0gMm4gKiogMTM2biAtIDFuO1xuICAgIG1heFVpbnQxNDQgPSAybiAqKiAxNDRuIC0gMW47XG4gICAgbWF4VWludDE1MiA9IDJuICoqIDE1Mm4gLSAxbjtcbiAgICBtYXhVaW50MTYwID0gMm4gKiogMTYwbiAtIDFuO1xuICAgIG1heFVpbnQxNjggPSAybiAqKiAxNjhuIC0gMW47XG4gICAgbWF4VWludDE3NiA9IDJuICoqIDE3Nm4gLSAxbjtcbiAgICBtYXhVaW50MTg0ID0gMm4gKiogMTg0biAtIDFuO1xuICAgIG1heFVpbnQxOTIgPSAybiAqKiAxOTJuIC0gMW47XG4gICAgbWF4VWludDIwMCA9IDJuICoqIDIwMG4gLSAxbjtcbiAgICBtYXhVaW50MjA4ID0gMm4gKiogMjA4biAtIDFuO1xuICAgIG1heFVpbnQyMTYgPSAybiAqKiAyMTZuIC0gMW47XG4gICAgbWF4VWludDIyNCA9IDJuICoqIDIyNG4gLSAxbjtcbiAgICBtYXhVaW50MjMyID0gMm4gKiogMjMybiAtIDFuO1xuICAgIG1heFVpbnQyNDAgPSAybiAqKiAyNDBuIC0gMW47XG4gICAgbWF4VWludDI0OCA9IDJuICoqIDI0OG4gLSAxbjtcbiAgICBtYXhVaW50MjU2ID0gMm4gKiogMjU2biAtIDFuO1xuICB9XG59KTtcblxuLy9cbnZhciBoYXNIZXhCdWlsdGluO1xudmFyIGluaXRfY2h1bmtfWE40TFVPSUggPSBfX2VzbSh7XG4gIFwiLi4vb3JjaGVzdHJhdGlvbi9zcmMvdmVuZG9yL3ZpZW0vY2h1bmstWE40TFVPSUguanNcIigpIHtcbiAgICBoYXNIZXhCdWlsdGluID0gLy9cbiAgICB0eXBlb2YgVWludDhBcnJheS5mcm9tKFtdKS50b0hleCA9PT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiBVaW50OEFycmF5LmZyb21IZXggPT09IFwiZnVuY3Rpb25cIjtcbiAgfVxufSk7XG5cbi8vXG52YXIgaW5pdF9jaHVua180Vk5TNVdQTSA9IF9fZXNtKHtcbiAgXCIuLi9vcmNoZXN0cmF0aW9uL3NyYy92ZW5kb3IvdmllbS9jaHVuay00Vk5TNVdQTS5qc1wiKCkge1xuICB9XG59KTtcblxuLy9cbnZhciByZXF1aXJlX2Rpc3QgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvYmVjaDMyL2Rpc3QvaW5kZXguanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMuYmVjaDMybSA9IGV4cG9ydHMuYmVjaDMyID0gdm9pZCAwO1xuICAgIHZhciBBTFBIQUJFVDIgPSBcInFwenJ5OXg4Z2YydHZkdzBzM2puNTRraGNlNm11YTdsXCI7XG4gICAgdmFyIEFMUEhBQkVUX01BUCA9IHt9O1xuICAgIGZvciAobGV0IHogPSAwOyB6IDwgQUxQSEFCRVQyLmxlbmd0aDsgeisrKSB7XG4gICAgICBjb25zdCB4ID0gQUxQSEFCRVQyLmNoYXJBdCh6KTtcbiAgICAgIEFMUEhBQkVUX01BUFt4XSA9IHo7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHBvbHltb2RTdGVwKHByZSkge1xuICAgICAgY29uc3QgYjMgPSBwcmUgPj4gMjU7XG4gICAgICByZXR1cm4gKHByZSAmIDMzNTU0NDMxKSA8PCA1IF4gLShiMyA+PiAwICYgMSkgJiA5OTY4MjUwMTAgXiAtKGIzID4+IDEgJiAxKSAmIDY0MjgxMzU0OSBeIC0oYjMgPj4gMiAmIDEpICYgNTEzODc0NDI2IF4gLShiMyA+PiAzICYgMSkgJiAxMDI3NzQ4ODI5IF4gLShiMyA+PiA0ICYgMSkgJiA3MDU5NzkwNTk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHByZWZpeENoayhwcmVmaXgpIHtcbiAgICAgIGxldCBjaGsgPSAxO1xuICAgICAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IHByZWZpeC5sZW5ndGg7ICsraTMpIHtcbiAgICAgICAgY29uc3QgYzIgPSBwcmVmaXguY2hhckNvZGVBdChpMyk7XG4gICAgICAgIGlmIChjMiA8IDMzIHx8IGMyID4gMTI2KVxuICAgICAgICAgIHJldHVybiBcIkludmFsaWQgcHJlZml4IChcIiArIHByZWZpeCArIFwiKVwiO1xuICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspIF4gYzIgPj4gNTtcbiAgICAgIH1cbiAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoayk7XG4gICAgICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgcHJlZml4Lmxlbmd0aDsgKytpMykge1xuICAgICAgICBjb25zdCB2MiA9IHByZWZpeC5jaGFyQ29kZUF0KGkzKTtcbiAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIHYyICYgMzE7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2hrO1xuICAgIH1cbiAgICBmdW5jdGlvbiBjb252ZXJ0KGRhdGEsIGluQml0cywgb3V0Qml0cywgcGFkKSB7XG4gICAgICBsZXQgdmFsdWUgPSAwO1xuICAgICAgbGV0IGJpdHMgPSAwO1xuICAgICAgY29uc3QgbWF4ViA9ICgxIDw8IG91dEJpdHMpIC0gMTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgICAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IGRhdGEubGVuZ3RoOyArK2kzKSB7XG4gICAgICAgIHZhbHVlID0gdmFsdWUgPDwgaW5CaXRzIHwgZGF0YVtpM107XG4gICAgICAgIGJpdHMgKz0gaW5CaXRzO1xuICAgICAgICB3aGlsZSAoYml0cyA+PSBvdXRCaXRzKSB7XG4gICAgICAgICAgYml0cyAtPSBvdXRCaXRzO1xuICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlID4+IGJpdHMgJiBtYXhWKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHBhZCkge1xuICAgICAgICBpZiAoYml0cyA+IDApIHtcbiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSA8PCBvdXRCaXRzIC0gYml0cyAmIG1heFYpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoYml0cyA+PSBpbkJpdHMpXG4gICAgICAgICAgcmV0dXJuIFwiRXhjZXNzIHBhZGRpbmdcIjtcbiAgICAgICAgaWYgKHZhbHVlIDw8IG91dEJpdHMgLSBiaXRzICYgbWF4VilcbiAgICAgICAgICByZXR1cm4gXCJOb24temVybyBwYWRkaW5nXCI7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b1dvcmRzKGJ5dGVzMikge1xuICAgICAgcmV0dXJuIGNvbnZlcnQoYnl0ZXMyLCA4LCA1LCB0cnVlKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbVdvcmRzVW5zYWZlKHdvcmRzKSB7XG4gICAgICBjb25zdCByZXMgPSBjb252ZXJ0KHdvcmRzLCA1LCA4LCBmYWxzZSk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpKVxuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH1cbiAgICBmdW5jdGlvbiBmcm9tV29yZHMod29yZHMpIHtcbiAgICAgIGNvbnN0IHJlcyA9IGNvbnZlcnQod29yZHMsIDUsIDgsIGZhbHNlKTtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlcykpXG4gICAgICAgIHJldHVybiByZXM7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZ2V0TGlicmFyeUZyb21FbmNvZGluZyhlbmNvZGluZykge1xuICAgICAgbGV0IEVOQ09ESU5HX0NPTlNUO1xuICAgICAgaWYgKGVuY29kaW5nID09PSBcImJlY2gzMlwiKSB7XG4gICAgICAgIEVOQ09ESU5HX0NPTlNUID0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIEVOQ09ESU5HX0NPTlNUID0gNzM0NTM5OTM5O1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gZW5jb2RlMihwcmVmaXgsIHdvcmRzLCBMSU1JVCkge1xuICAgICAgICBMSU1JVCA9IExJTUlUIHx8IDkwO1xuICAgICAgICBpZiAocHJlZml4Lmxlbmd0aCArIDcgKyB3b3Jkcy5sZW5ndGggPiBMSU1JVClcbiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRXhjZWVkcyBsZW5ndGggbGltaXRcIik7XG4gICAgICAgIHByZWZpeCA9IHByZWZpeC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBsZXQgY2hrID0gcHJlZml4Q2hrKHByZWZpeCk7XG4gICAgICAgIGlmICh0eXBlb2YgY2hrID09PSBcInN0cmluZ1wiKVxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihjaGspO1xuICAgICAgICBsZXQgcmVzdWx0ID0gcHJlZml4ICsgXCIxXCI7XG4gICAgICAgIGZvciAobGV0IGkzID0gMDsgaTMgPCB3b3Jkcy5sZW5ndGg7ICsraTMpIHtcbiAgICAgICAgICBjb25zdCB4ID0gd29yZHNbaTNdO1xuICAgICAgICAgIGlmICh4ID4+IDUgIT09IDApXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb24gNS1iaXQgd29yZFwiKTtcbiAgICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspIF4geDtcbiAgICAgICAgICByZXN1bHQgKz0gQUxQSEFCRVQyLmNoYXJBdCh4KTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgNjsgKytpMykge1xuICAgICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoayk7XG4gICAgICAgIH1cbiAgICAgICAgY2hrIF49IEVOQ09ESU5HX0NPTlNUO1xuICAgICAgICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgNjsgKytpMykge1xuICAgICAgICAgIGNvbnN0IHYyID0gY2hrID4+ICg1IC0gaTMpICogNSAmIDMxO1xuICAgICAgICAgIHJlc3VsdCArPSBBTFBIQUJFVDIuY2hhckF0KHYyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gX19kZWNvZGUoc3RyLCBMSU1JVCkge1xuICAgICAgICBMSU1JVCA9IExJTUlUIHx8IDkwO1xuICAgICAgICBpZiAoc3RyLmxlbmd0aCA8IDgpXG4gICAgICAgICAgcmV0dXJuIHN0ciArIFwiIHRvbyBzaG9ydFwiO1xuICAgICAgICBpZiAoc3RyLmxlbmd0aCA+IExJTUlUKVxuICAgICAgICAgIHJldHVybiBcIkV4Y2VlZHMgbGVuZ3RoIGxpbWl0XCI7XG4gICAgICAgIGNvbnN0IGxvd2VyZWQgPSBzdHIudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgdXBwZXJlZCA9IHN0ci50b1VwcGVyQ2FzZSgpO1xuICAgICAgICBpZiAoc3RyICE9PSBsb3dlcmVkICYmIHN0ciAhPT0gdXBwZXJlZClcbiAgICAgICAgICByZXR1cm4gXCJNaXhlZC1jYXNlIHN0cmluZyBcIiArIHN0cjtcbiAgICAgICAgc3RyID0gbG93ZXJlZDtcbiAgICAgICAgY29uc3Qgc3BsaXQyID0gc3RyLmxhc3RJbmRleE9mKFwiMVwiKTtcbiAgICAgICAgaWYgKHNwbGl0MiA9PT0gLTEpXG4gICAgICAgICAgcmV0dXJuIFwiTm8gc2VwYXJhdG9yIGNoYXJhY3RlciBmb3IgXCIgKyBzdHI7XG4gICAgICAgIGlmIChzcGxpdDIgPT09IDApXG4gICAgICAgICAgcmV0dXJuIFwiTWlzc2luZyBwcmVmaXggZm9yIFwiICsgc3RyO1xuICAgICAgICBjb25zdCBwcmVmaXggPSBzdHIuc2xpY2UoMCwgc3BsaXQyKTtcbiAgICAgICAgY29uc3Qgd29yZENoYXJzID0gc3RyLnNsaWNlKHNwbGl0MiArIDEpO1xuICAgICAgICBpZiAod29yZENoYXJzLmxlbmd0aCA8IDYpXG4gICAgICAgICAgcmV0dXJuIFwiRGF0YSB0b28gc2hvcnRcIjtcbiAgICAgICAgbGV0IGNoayA9IHByZWZpeENoayhwcmVmaXgpO1xuICAgICAgICBpZiAodHlwZW9mIGNoayA9PT0gXCJzdHJpbmdcIilcbiAgICAgICAgICByZXR1cm4gY2hrO1xuICAgICAgICBjb25zdCB3b3JkcyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgd29yZENoYXJzLmxlbmd0aDsgKytpMykge1xuICAgICAgICAgIGNvbnN0IGMyID0gd29yZENoYXJzLmNoYXJBdChpMyk7XG4gICAgICAgICAgY29uc3QgdjIgPSBBTFBIQUJFVF9NQVBbYzJdO1xuICAgICAgICAgIGlmICh2MiA9PT0gdm9pZCAwKVxuICAgICAgICAgICAgcmV0dXJuIFwiVW5rbm93biBjaGFyYWN0ZXIgXCIgKyBjMjtcbiAgICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspIF4gdjI7XG4gICAgICAgICAgaWYgKGkzICsgNiA+PSB3b3JkQ2hhcnMubGVuZ3RoKVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgd29yZHMucHVzaCh2Mik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoayAhPT0gRU5DT0RJTkdfQ09OU1QpXG4gICAgICAgICAgcmV0dXJuIFwiSW52YWxpZCBjaGVja3N1bSBmb3IgXCIgKyBzdHI7XG4gICAgICAgIHJldHVybiB7IHByZWZpeCwgd29yZHMgfTtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIGRlY29kZVVuc2FmZShzdHIsIExJTUlUKSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IF9fZGVjb2RlKHN0ciwgTElNSVQpO1xuICAgICAgICBpZiAodHlwZW9mIHJlcyA9PT0gXCJvYmplY3RcIilcbiAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gZGVjb2RlMyhzdHIsIExJTUlUKSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IF9fZGVjb2RlKHN0ciwgTElNSVQpO1xuICAgICAgICBpZiAodHlwZW9mIHJlcyA9PT0gXCJvYmplY3RcIilcbiAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRlY29kZVVuc2FmZSxcbiAgICAgICAgZGVjb2RlOiBkZWNvZGUzLFxuICAgICAgICBlbmNvZGU6IGVuY29kZTIsXG4gICAgICAgIHRvV29yZHMsXG4gICAgICAgIGZyb21Xb3Jkc1Vuc2FmZSxcbiAgICAgICAgZnJvbVdvcmRzXG4gICAgICB9O1xuICAgIH1cbiAgICBleHBvcnRzLmJlY2gzMiA9IGdldExpYnJhcnlGcm9tRW5jb2RpbmcoXCJiZWNoMzJcIik7XG4gICAgZXhwb3J0cy5iZWNoMzJtID0gZ2V0TGlicmFyeUZyb21FbmNvZGluZyhcImJlY2gzMm1cIik7XG4gIH1cbn0pO1xuXG4vL1xudmFyIEJyaWRnZUlkID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgQkFOSzogXCJiYW5rXCIsXG4gICAgQ09SRTogXCJjb3JlXCIsXG4gICAgRElCQzogXCJkaWJjXCIsXG4gICAgU1RPUkFHRTogXCJzdG9yYWdlXCIsXG4gICAgUFJPVklTSU9OOiBcInByb3Zpc2lvblwiLFxuICAgIFBST1ZJU0lPTl9TTUFSVF9XQUxMRVQ6IFwicHJvdmlzaW9uV2FsbGV0XCIsXG4gICAgVkxPQ0FMQ0hBSU46IFwidmxvY2FsY2hhaW5cIixcbiAgICBWVFJBTlNGRVI6IFwidnRyYW5zZmVyXCIsXG4gICAgV0FMTEVUOiBcIndhbGxldFwiXG4gIH1cbik7XG5oYXJkZW4oQnJpZGdlSWQpO1xudmFyIENvc21vc0luaXRLZXlUb0JyaWRnZUlkID0ge1xuICB2YmFua1BvcnQ6IFwiYmFua1wiLFxuICB2aWJjUG9ydDogXCJkaWJjXCJcbn07XG5oYXJkZW4oQ29zbW9zSW5pdEtleVRvQnJpZGdlSWQpO1xudmFyIFdhbGxldE5hbWUgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBkZXBvc2l0RmFjZXQ6IFwiZGVwb3NpdEZhY2V0XCJcbiAgfVxuKTtcbmhhcmRlbihXYWxsZXROYW1lKTtcbnZhciBWQmFua0FjY291bnQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICByZXNlcnZlOiB7XG4gICAgICBtb2R1bGU6IFwidmJhbmsvcmVzZXJ2ZVwiLFxuICAgICAgYWRkcmVzczogXCJhZ29yaWMxYWUwbG10emxncmNubGE5eGprcGFhcnE1ZDVkZmV6NjNoM251Y2xcIlxuICAgIH0sXG4gICAgcHJvdmlzaW9uOiB7XG4gICAgICBtb2R1bGU6IFwidmJhbmsvcHJvdmlzaW9uXCIsXG4gICAgICBhZGRyZXNzOiBcImFnb3JpYzFtZWd6eXRnNjVjeXJnenM2ZnZ6eGdyY3F2d3dsN3VncHQ2MjM0NlwiXG4gICAgfVxuICB9XG4pO1xuaGFyZGVuKFZCYW5rQWNjb3VudCk7XG5cbi8vXG52YXIgZGVidWdJbnN0YW5jZSA9IDE7XG52YXIgbWFrZVRyYWNlciA9IChuYW1lLCBlbmFibGUgPSB0cnVlKSA9PiB7XG4gIGRlYnVnSW5zdGFuY2UgKz0gMTtcbiAgbGV0IGRlYnVnQ291bnQgPSAxO1xuICBjb25zdCBrZXkgPSBgLS0tLS0gJHtuYW1lfS4ke2RlYnVnSW5zdGFuY2V9IGA7XG4gIHN3aXRjaCAoZW5hYmxlKSB7XG4gICAgY2FzZSBmYWxzZToge1xuICAgICAgY29uc3QgbG9nRGlzYWJsZWQgPSAoLi4uX2FyZ3MpID0+IHtcbiAgICAgIH07XG4gICAgICByZXR1cm4gbG9nRGlzYWJsZWQ7XG4gICAgfVxuICAgIGNhc2UgXCJ2ZXJib3NlXCI6IHtcbiAgICAgIGNvbnN0IGluZm9UaWNrID0gKG9wdExvZywgLi4uYXJncykgPT4ge1xuICAgICAgICBpZiAob3B0TG9nLmxvZykge1xuICAgICAgICAgIGNvbnNvbGUuaW5mbyhrZXksIGRlYnVnQ291bnQgKz0gMSwgLi4uYXJncyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5pbmZvKGtleSwgZGVidWdDb3VudCArPSAxLCBvcHRMb2csIC4uLmFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGluZm9UaWNrO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICBjb25zdCBkZWJ1Z1RpY2sgPSAob3B0TG9nLCAuLi5hcmdzKSA9PiB7XG4gICAgICAgIGlmIChvcHRMb2cubG9nKSB7XG4gICAgICAgICAgb3B0TG9nLmxvZyhrZXksIGRlYnVnQ291bnQgKz0gMSwgLi4uYXJncyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5pbmZvKGtleSwgZGVidWdDb3VudCArPSAxLCBvcHRMb2csIC4uLmFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGRlYnVnVGljaztcbiAgICB9XG4gIH1cbn07XG5oYXJkZW4obWFrZVRyYWNlcik7XG5cbi8vXG52YXIgZ2xvYmFsQXNzZXJ0ID0gZ2xvYmFsVGhpcy5hc3NlcnQ7XG5pZiAoZ2xvYmFsQXNzZXJ0ID09PSB2b2lkIDApIHtcbiAgdGhyb3cgRXJyb3IoXG4gICAgYENhbm5vdCBpbml0aWFsaXplIEBlbmRvL2Vycm9ycywgbWlzc2luZyBnbG9iYWxUaGlzLmFzc2VydCwgaW1wb3J0ICdzZXMnIGJlZm9yZSAnQGVuZG8vZXJyb3JzJ2BcbiAgKTtcbn1cbnZhciBtaXNzaW5nID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBbXG4gICAgXCJ0eXBlb2ZcIixcbiAgICBcImVycm9yXCIsXG4gICAgXCJmYWlsXCIsXG4gICAgXCJlcXVhbFwiLFxuICAgIFwic3RyaW5nXCIsXG4gICAgXCJub3RlXCIsXG4gICAgXCJkZXRhaWxzXCIsXG4gICAgXCJGYWlsXCIsXG4gICAgXCJxdW90ZVwiLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgXCJtYWtlQXNzZXJ0XCJcbiAgXS5maWx0ZXIoKG5hbWUpID0+IGdsb2JhbEFzc2VydFtuYW1lXSA9PT0gdm9pZCAwKVxuKTtcbmlmIChtaXNzaW5nLmxlbmd0aCA+IDApIHtcbiAgdGhyb3cgRXJyb3IoXG4gICAgYENhbm5vdCBpbml0aWFsaXplIEBlbmRvL2Vycm9ycywgbWlzc2luZyBnbG9iYWxUaGlzLmFzc2VydCBtZXRob2RzICR7bWlzc2luZy5qb2luKFxuICAgICAgXCIsIFwiXG4gICAgKX1gXG4gICk7XG59XG52YXIge1xuICBiYXJlLFxuICBkZXRhaWxzOiByZWRhY3RlZCxcbiAgZXJyb3I6IG1ha2VFcnJvcixcbiAgRmFpbDogdGhyb3dSZWRhY3RlZCxcbiAgbWFrZUFzc2VydDogX29taXR0ZWRNYWtlQXNzZXJ0LFxuICBub3RlLFxuICBxdW90ZSxcbiAgLi4uYXNzZXJ0aW9uc1xufSA9IGdsb2JhbEFzc2VydDtcbnZhciBhc3NlcnQyID0gKHZhbHVlLCBvcHREZXRhaWxzLCBlcnJDb250cnVjdG9yLCBvcHRpb25zKSA9PiBnbG9iYWxBc3NlcnQodmFsdWUsIG9wdERldGFpbHMsIGVyckNvbnRydWN0b3IsIG9wdGlvbnMpO1xuT2JqZWN0LmFzc2lnbihhc3NlcnQyLCBhc3NlcnRpb25zKTtcbnZhciBiYXJlT3JRdW90ZSA9IGJhcmUgfHwgcXVvdGU7XG5cbi8vXG52YXIgTm9uTnVsbGlzaCA9ICh2YWwsIG9wdERldGFpbHMgPSBgdW5leHBlY3RlZCAke3F1b3RlKHZhbCl9YCkgPT4ge1xuICBpZiAodmFsICE9IG51bGwpIHtcbiAgICByZXR1cm4gdmFsO1xuICB9XG4gIGFzc2VydC5mYWlsKG9wdERldGFpbHMpO1xufTtcbmhhcmRlbihOb25OdWxsaXNoKTtcblxuLy9cbnZhciB7IGRlZmluZVByb3BlcnR5IH0gPSBPYmplY3Q7XG52YXIgdHlwZWRFbnRyaWVzID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgT2JqZWN0LmVudHJpZXNcbik7XG52YXIgZnJvbVR5cGVkRW50cmllcyA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICBPYmplY3QuZnJvbUVudHJpZXNcbik7XG52YXIgdHlwZWRNYXAgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICovXG4gIEZ1bmN0aW9uLnByb3RvdHlwZS5jYWxsLmJpbmQoQXJyYXkucHJvdG90eXBlLm1hcClcbik7XG52YXIgbG9nTGV2ZWxzID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBbXG4gICAgXCJkZWJ1Z1wiLFxuICAgIFwibG9nXCIsXG4gICAgXCJpbmZvXCIsXG4gICAgXCJ3YXJuXCIsXG4gICAgXCJlcnJvclwiXG4gIF1cbik7XG5PYmplY3QuZnJlZXplKGxvZ0xldmVscyk7XG52YXIgZGVlcE1hcE9iamVjdEludGVybmFsID0gKHZhbHVlLCBuYW1lLCBjb250YWluZXIsIG1hcHBlcikgPT4ge1xuICBpZiAoY29udGFpbmVyICYmIHR5cGVvZiBuYW1lID09PSBcInN0cmluZ1wiKSB7XG4gICAgY29uc3QgbWFwcGVkID0gbWFwcGVyKHZhbHVlLCBuYW1lLCBjb250YWluZXIpO1xuICAgIGlmIChtYXBwZWQgIT09IHZhbHVlKSB7XG4gICAgICByZXR1cm4gbWFwcGVkO1xuICAgIH1cbiAgfVxuICBpZiAodHlwZW9mIHZhbHVlICE9PSBcIm9iamVjdFwiIHx8ICF2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBsZXQgd2FzTWFwcGVkID0gZmFsc2U7XG4gIGNvbnN0IHZhbHVlT2JqID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgdmFsdWVcbiAgKTtcbiAgY29uc3QgbWFwRW50cnkgPSAoW2lubmVyTmFtZSwgaW5uZXJWYWx1ZV0pID0+IHtcbiAgICBjb25zdCBtYXBwZWRJbm5lclZhbHVlID0gZGVlcE1hcE9iamVjdEludGVybmFsKFxuICAgICAgaW5uZXJWYWx1ZSxcbiAgICAgIGlubmVyTmFtZSxcbiAgICAgIHZhbHVlT2JqLFxuICAgICAgbWFwcGVyXG4gICAgKTtcbiAgICB3YXNNYXBwZWQgfHw9IG1hcHBlZElubmVyVmFsdWUgIT09IGlubmVyVmFsdWU7XG4gICAgcmV0dXJuIFtcbiAgICAgIGlubmVyTmFtZSxcbiAgICAgIC8qICAgICAgICAgICAgICAqL1xuICAgICAgbWFwcGVkSW5uZXJWYWx1ZVxuICAgIF07XG4gIH07XG4gIGNvbnN0IG1hcHBlZEVudHJpZXMgPSB0eXBlZEVudHJpZXModmFsdWVPYmopLm1hcChtYXBFbnRyeSk7XG4gIGlmICghd2FzTWFwcGVkKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIGNvbnN0IG1hcHBlZE9iaiA9IGZyb21UeXBlZEVudHJpZXMobWFwcGVkRW50cmllcyk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICovXG4gICAgbWFwcGVkT2JqXG4gICk7XG59O1xudmFyIGRlZXBNYXBPYmplY3QgPSAob2JqLCBtYXBwZXIpID0+IChcbiAgLyogICAgICAgICAgICAgICovXG4gIGRlZXBNYXBPYmplY3RJbnRlcm5hbChvYmosIHZvaWQgMCwgdm9pZCAwLCBtYXBwZXIpXG4pO1xudmFyIHByb3ZpZGVMYXp5TWFwID0gKG1hcCwga2V5LCBtYWtlVmFsdWUpID0+IHtcbiAgY29uc3QgZm91bmQgPSBtYXAuZ2V0KGtleSk7XG4gIGlmIChmb3VuZCAhPT0gdm9pZCAwIHx8IG1hcC5oYXMoa2V5KSkge1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICovXG4gICAgICBmb3VuZFxuICAgICk7XG4gIH1cbiAgY29uc3QgdmFsdWUgPSBtYWtlVmFsdWUoa2V5KTtcbiAgbWFwLnNldChrZXksIHZhbHVlKTtcbiAgcmV0dXJuIHZhbHVlO1xufTtcblxuLy9cbnZhciBsb2NhbFRoaXMgPSBnbG9iYWxUaGlzO1xudmFyIHsgT2JqZWN0OiBPYmplY3QyLCBSZWZsZWN0OiBSZWZsZWN0MiwgQXJyYXk6IEFycmF5MiwgU3RyaW5nOiBTdHJpbmcyLCBKU09OOiBKU09OMiwgRXJyb3I6IEVycm9yMiB9ID0gbG9jYWxUaGlzO1xudmFyIHsgZnJlZXplIH0gPSBPYmplY3QyO1xudmFyIHsgYXBwbHkgfSA9IFJlZmxlY3QyO1xudmFyIHVuY3VycnlUaGlzID0gKGZuKSA9PiAocmVjZWl2ZXIsIC4uLmFyZ3MpID0+IGFwcGx5KGZuLCByZWNlaXZlciwgYXJncyk7XG52YXIgYXJyYXlQdXNoID0gdW5jdXJyeVRoaXMoQXJyYXkyLnByb3RvdHlwZS5wdXNoKTtcbnZhciBhcnJheUluY2x1ZGVzID0gdW5jdXJyeVRoaXMoQXJyYXkyLnByb3RvdHlwZS5pbmNsdWRlcyk7XG52YXIgc3RyaW5nU3BsaXQgPSB1bmN1cnJ5VGhpcyhTdHJpbmcyLnByb3RvdHlwZS5zcGxpdCk7XG52YXIgcSA9IEpTT04yLnN0cmluZ2lmeTtcbnZhciBGYWlsID0gKGxpdGVyYWxzLCAuLi5hcmdzKSA9PiB7XG4gIGxldCBtc2cgPSBsaXRlcmFsc1swXTtcbiAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IGFyZ3MubGVuZ3RoOyBpMyArPSAxKSB7XG4gICAgbXNnID0gYCR7bXNnfSR7YXJnc1tpM119JHtsaXRlcmFsc1tpMyArIDFdfWA7XG4gIH1cbiAgdGhyb3cgRXJyb3IyKG1zZyk7XG59O1xudmFyIG1ha2VFbnZpcm9ubWVudENhcHRvciA9IChhR2xvYmFsLCBkcm9wTmFtZXMgPSBmYWxzZSkgPT4ge1xuICBjb25zdCBjYXB0dXJlZEVudmlyb25tZW50T3B0aW9uTmFtZXMgPSBbXTtcbiAgY29uc3QgZ2V0RW52aXJvbm1lbnRPcHRpb24yID0gKG9wdGlvbk5hbWUsIGRlZmF1bHRTZXR0aW5nLCBvcHRPdGhlclZhbHVlcyA9IHZvaWQgMCkgPT4ge1xuICAgIHR5cGVvZiBvcHRpb25OYW1lID09PSBcInN0cmluZ1wiIHx8IEZhaWxgRW52aXJvbm1lbnQgb3B0aW9uIG5hbWUgJHtxKG9wdGlvbk5hbWUpfSBtdXN0IGJlIGEgc3RyaW5nLmA7XG4gICAgdHlwZW9mIGRlZmF1bHRTZXR0aW5nID09PSBcInN0cmluZ1wiIHx8IEZhaWxgRW52aXJvbm1lbnQgb3B0aW9uIGRlZmF1bHQgc2V0dGluZyAke3EoXG4gICAgICBkZWZhdWx0U2V0dGluZ1xuICAgICl9IG11c3QgYmUgYSBzdHJpbmcuYDtcbiAgICBsZXQgc2V0dGluZyA9IGRlZmF1bHRTZXR0aW5nO1xuICAgIGNvbnN0IGdsb2JhbFByb2Nlc3MgPSBhR2xvYmFsLnByb2Nlc3MgfHwgdm9pZCAwO1xuICAgIGNvbnN0IGdsb2JhbEVudiA9IHR5cGVvZiBnbG9iYWxQcm9jZXNzID09PSBcIm9iamVjdFwiICYmIGdsb2JhbFByb2Nlc3MuZW52IHx8IHZvaWQgMDtcbiAgICBpZiAodHlwZW9mIGdsb2JhbEVudiA9PT0gXCJvYmplY3RcIikge1xuICAgICAgaWYgKG9wdGlvbk5hbWUgaW4gZ2xvYmFsRW52KSB7XG4gICAgICAgIGlmICghZHJvcE5hbWVzKSB7XG4gICAgICAgICAgYXJyYXlQdXNoKGNhcHR1cmVkRW52aXJvbm1lbnRPcHRpb25OYW1lcywgb3B0aW9uTmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb3B0aW9uVmFsdWUgPSBnbG9iYWxFbnZbb3B0aW9uTmFtZV07XG4gICAgICAgIHR5cGVvZiBvcHRpb25WYWx1ZSA9PT0gXCJzdHJpbmdcIiB8fCBGYWlsYEVudmlyb25tZW50IG9wdGlvbiBuYW1lZCAke3EoXG4gICAgICAgICAgb3B0aW9uTmFtZVxuICAgICAgICApfSwgaWYgcHJlc2VudCwgbXVzdCBoYXZlIGEgY29ycmVzcG9uZGluZyBzdHJpbmcgdmFsdWUsIGdvdCAke3EoXG4gICAgICAgICAgb3B0aW9uVmFsdWVcbiAgICAgICAgKX1gO1xuICAgICAgICBzZXR0aW5nID0gb3B0aW9uVmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIG9wdE90aGVyVmFsdWVzID09PSB2b2lkIDAgfHwgc2V0dGluZyA9PT0gZGVmYXVsdFNldHRpbmcgfHwgYXJyYXlJbmNsdWRlcyhvcHRPdGhlclZhbHVlcywgc2V0dGluZykgfHwgRmFpbGBVbnJlY29nbml6ZWQgJHtxKG9wdGlvbk5hbWUpfSB2YWx1ZSAke3EoXG4gICAgICBzZXR0aW5nXG4gICAgKX0uIEV4cGVjdGVkIG9uZSBvZiAke3EoW2RlZmF1bHRTZXR0aW5nLCAuLi5vcHRPdGhlclZhbHVlc10pfWA7XG4gICAgcmV0dXJuIHNldHRpbmc7XG4gIH07XG4gIGZyZWV6ZShnZXRFbnZpcm9ubWVudE9wdGlvbjIpO1xuICBjb25zdCBnZXRFbnZpcm9ubWVudE9wdGlvbnNMaXN0MiA9IChvcHRpb25OYW1lKSA9PiB7XG4gICAgY29uc3Qgb3B0aW9uID0gZ2V0RW52aXJvbm1lbnRPcHRpb24yKG9wdGlvbk5hbWUsIFwiXCIpO1xuICAgIHJldHVybiBmcmVlemUob3B0aW9uID09PSBcIlwiID8gW10gOiBzdHJpbmdTcGxpdChvcHRpb24sIFwiLFwiKSk7XG4gIH07XG4gIGZyZWV6ZShnZXRFbnZpcm9ubWVudE9wdGlvbnNMaXN0Mik7XG4gIGNvbnN0IGVudmlyb25tZW50T3B0aW9uc0xpc3RIYXMyID0gKG9wdGlvbk5hbWUsIGVsZW1lbnQpID0+IGFycmF5SW5jbHVkZXMoZ2V0RW52aXJvbm1lbnRPcHRpb25zTGlzdDIob3B0aW9uTmFtZSksIGVsZW1lbnQpO1xuICBjb25zdCBnZXRDYXB0dXJlZEVudmlyb25tZW50T3B0aW9uTmFtZXMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIGZyZWV6ZShbLi4uY2FwdHVyZWRFbnZpcm9ubWVudE9wdGlvbk5hbWVzXSk7XG4gIH07XG4gIGZyZWV6ZShnZXRDYXB0dXJlZEVudmlyb25tZW50T3B0aW9uTmFtZXMpO1xuICByZXR1cm4gZnJlZXplKHtcbiAgICBnZXRFbnZpcm9ubWVudE9wdGlvbjogZ2V0RW52aXJvbm1lbnRPcHRpb24yLFxuICAgIGdldEVudmlyb25tZW50T3B0aW9uc0xpc3Q6IGdldEVudmlyb25tZW50T3B0aW9uc0xpc3QyLFxuICAgIGVudmlyb25tZW50T3B0aW9uc0xpc3RIYXM6IGVudmlyb25tZW50T3B0aW9uc0xpc3RIYXMyLFxuICAgIGdldENhcHR1cmVkRW52aXJvbm1lbnRPcHRpb25OYW1lc1xuICB9KTtcbn07XG5mcmVlemUobWFrZUVudmlyb25tZW50Q2FwdG9yKTtcbnZhciB7XG4gIGdldEVudmlyb25tZW50T3B0aW9uLFxuICBnZXRFbnZpcm9ubWVudE9wdGlvbnNMaXN0LFxuICBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzXG59ID0gbWFrZUVudmlyb25tZW50Q2FwdG9yKGxvY2FsVGhpcywgdHJ1ZSk7XG5cbi8vXG52YXIgaGlkZGVuUHJpb3JFcnJvcjtcbnZhciBoaWRkZW5DdXJyZW50VHVybiA9IDA7XG52YXIgaGlkZGVuQ3VycmVudEV2ZW50ID0gMDtcbnZhciBWRVJCT1NFID0gZW52aXJvbm1lbnRPcHRpb25zTGlzdEhhcyhcIkRFQlVHXCIsIFwidHJhY2stdHVybnNcIik7XG52YXIgRU5BQkxFRCA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICBnZXRFbnZpcm9ubWVudE9wdGlvbihcIlRSQUNLX1RVUk5TXCIsIFwiZGlzYWJsZWRcIiwgW1wiZW5hYmxlZFwiXSkgPT09IFwiZW5hYmxlZFwiXG4pO1xudmFyIGFkZFJlamVjdGlvbk5vdGUgPSAoZGV0YWlsc05vdGUpID0+IChyZWFzb24pID0+IHtcbiAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgZ2xvYmFsVGhpcy5hc3NlcnQubm90ZShyZWFzb24sIGRldGFpbHNOb3RlKTtcbiAgfVxuICBpZiAoVkVSQk9TRSkge1xuICAgIGNvbnNvbGUubG9nKFwiUkVKRUNURUQgYXQgdG9wIG9mIGV2ZW50IGxvb3BcIiwgcmVhc29uKTtcbiAgfVxufTtcbnZhciB3cmFwRnVuY3Rpb24gPSAoZnVuYywgc2VuZGluZ0Vycm9yLCBYNSkgPT4gKC4uLmFyZ3MpID0+IHtcbiAgaGlkZGVuUHJpb3JFcnJvciA9IHNlbmRpbmdFcnJvcjtcbiAgaGlkZGVuQ3VycmVudFR1cm4gKz0gMTtcbiAgaGlkZGVuQ3VycmVudEV2ZW50ID0gMDtcbiAgdHJ5IHtcbiAgICBsZXQgcmVzdWx0O1xuICAgIHRyeSB7XG4gICAgICByZXN1bHQgPSBmdW5jKC4uLmFyZ3MpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgIGdsb2JhbFRoaXMuYXNzZXJ0Lm5vdGUoXG4gICAgICAgICAgZXJyLFxuICAgICAgICAgIFg1YFRocm93biBmcm9tOiAke2hpZGRlblByaW9yRXJyb3J9OiR7aGlkZGVuQ3VycmVudFR1cm59LiR7aGlkZGVuQ3VycmVudEV2ZW50fWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChWRVJCT1NFKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiVEhST1dOIHRvIHRvcCBvZiBldmVudCBsb29wXCIsIGVycik7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGNvbnN0IGRldGFpbHNOb3RlID0gWDVgUmVqZWN0aW9uIGZyb206ICR7aGlkZGVuUHJpb3JFcnJvcn06JHtoaWRkZW5DdXJyZW50VHVybn0uJHtoaWRkZW5DdXJyZW50RXZlbnR9YDtcbiAgICBQcm9taXNlLnJlc29sdmUocmVzdWx0KS5jYXRjaChhZGRSZWplY3Rpb25Ob3RlKGRldGFpbHNOb3RlKSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBmaW5hbGx5IHtcbiAgICBoaWRkZW5QcmlvckVycm9yID0gdm9pZCAwO1xuICB9XG59O1xudmFyIHRyYWNrVHVybnMgPSAoZnVuY3MpID0+IHtcbiAgaWYgKCFFTkFCTEVEIHx8IHR5cGVvZiBnbG9iYWxUaGlzID09PSBcInVuZGVmaW5lZFwiIHx8ICFnbG9iYWxUaGlzLmFzc2VydCkge1xuICAgIHJldHVybiBmdW5jcztcbiAgfVxuICBjb25zdCB7IGRldGFpbHM6IFg1LCBub3RlOiBhbm5vdGF0ZUVycm9yIH0gPSBnbG9iYWxUaGlzLmFzc2VydDtcbiAgaGlkZGVuQ3VycmVudEV2ZW50ICs9IDE7XG4gIGNvbnN0IHNlbmRpbmdFcnJvciA9IEVycm9yKFxuICAgIGBFdmVudDogJHtoaWRkZW5DdXJyZW50VHVybn0uJHtoaWRkZW5DdXJyZW50RXZlbnR9YFxuICApO1xuICBpZiAoaGlkZGVuUHJpb3JFcnJvciAhPT0gdm9pZCAwKSB7XG4gICAgYW5ub3RhdGVFcnJvcihzZW5kaW5nRXJyb3IsIFg1YENhdXNlZCBieTogJHtoaWRkZW5QcmlvckVycm9yfWApO1xuICB9XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAqL1xuICAgIGZ1bmNzLm1hcCgoZnVuYykgPT4gZnVuYyAmJiB3cmFwRnVuY3Rpb24oZnVuYywgc2VuZGluZ0Vycm9yLCBYNSkpXG4gICk7XG59O1xuXG4vL1xudmFyIHsgcXVvdGU6IHEyLCBGYWlsOiBGYWlsMiB9ID0gYXNzZXJ0O1xudmFyIHsgaGFzT3duLCBmcmVlemU6IGZyZWV6ZTIsIGVudHJpZXMgfSA9IE9iamVjdDtcbnZhciBpc0pTT05SZWNvcmQgPSAodmFsKSA9PiB0eXBlb2YgdmFsID09PSBcIm9iamVjdFwiICYmIHZhbCAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheSh2YWwpO1xudmFyIHNpbXBsaWZ5VGFnID0gKHRhZykgPT4ge1xuICBmb3IgKGNvbnN0IHByZWZpeCBvZiBbXCJBbGxlZ2VkOiBcIiwgXCJEZWJ1Z05hbWU6IFwiXSkge1xuICAgIGlmICh0YWcuc3RhcnRzV2l0aChwcmVmaXgpKSB7XG4gICAgICByZXR1cm4gdGFnLnNsaWNlKHByZWZpeC5sZW5ndGgpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdGFnO1xufTtcbnZhciBtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIgPSAob3B0aW9uTmFtZSkgPT4ge1xuICBsZXQgYnJlYWtwb2ludHMgPSBKU09OLnBhcnNlKGdldEVudmlyb25tZW50T3B0aW9uKG9wdGlvbk5hbWUsIFwibnVsbFwiKSk7XG4gIGlmIChicmVha3BvaW50cyA9PT0gbnVsbCkge1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbiAgbGV0IGJyZWFrcG9pbnRzVGFibGU7XG4gIGNvbnN0IGdldEJyZWFrcG9pbnRzID0gKCkgPT4gYnJlYWtwb2ludHM7XG4gIGZyZWV6ZTIoZ2V0QnJlYWtwb2ludHMpO1xuICBjb25zdCBzZXRCcmVha3BvaW50cyA9IChuZXdCcmVha3BvaW50cyA9IGJyZWFrcG9pbnRzKSA9PiB7XG4gICAgaXNKU09OUmVjb3JkKG5ld0JyZWFrcG9pbnRzKSB8fCBGYWlsMmBFeHBlY3RlZCAke3EyKG9wdGlvbk5hbWUpfSBvcHRpb24gdG8gYmUgYSBKU09OIGJyZWFrcG9pbnRzIHJlY29yZGA7XG4gICAgY29uc3QgbmV3QnJlYWtwb2ludHNUYWJsZSA9IHsgX19wcm90b19fOiBudWxsIH07XG4gICAgZm9yIChjb25zdCBbdGFnLCBtZXRob2RCUHNdIG9mIGVudHJpZXMobmV3QnJlYWtwb2ludHMpKSB7XG4gICAgICB0YWcgPT09IHNpbXBsaWZ5VGFnKHRhZykgfHwgRmFpbDJgSnVzdCB1c2Ugc2ltcGxlIHRhZyAke3EyKHNpbXBsaWZ5VGFnKHRhZykpfSByYXRoZXIgdGhhbiAke3EyKHRhZyl9YDtcbiAgICAgIGlzSlNPTlJlY29yZChtZXRob2RCUHMpIHx8IEZhaWwyYEV4cGVjdGVkICR7cTIob3B0aW9uTmFtZSl9IG9wdGlvbidzICR7cTIoXG4gICAgICAgIHRhZ1xuICAgICAgKX0gdG8gYmUgYSBKU09OIG1ldGhvZHMgYnJlYWtwb2ludHMgcmVjb3JkYDtcbiAgICAgIGZvciAoY29uc3QgW21ldGhvZE5hbWUsIGNvdW50XSBvZiBlbnRyaWVzKG1ldGhvZEJQcykpIHtcbiAgICAgICAgY291bnQgPT09IFwiKlwiIHx8IHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiAmJiBOdW1iZXIuaXNTYWZlSW50ZWdlcihjb3VudCkgJiYgY291bnQgPj0gMCB8fCBGYWlsMmBFeHBlY3RlZCAke3EyKG9wdGlvbk5hbWUpfSBvcHRpb24ncyAke3EyKHRhZyl9LiR7cTIoXG4gICAgICAgICAgbWV0aG9kTmFtZVxuICAgICAgICApfSB0byBiZSBcIipcIiBvciBhIG5vbi1uZWdhdGl2ZSBpbnRlZ2VyYDtcbiAgICAgICAgY29uc3QgY2xhc3NCUHMgPSBoYXNPd24obmV3QnJlYWtwb2ludHNUYWJsZSwgbWV0aG9kTmFtZSkgPyBuZXdCcmVha3BvaW50c1RhYmxlW21ldGhvZE5hbWVdIDogbmV3QnJlYWtwb2ludHNUYWJsZVttZXRob2ROYW1lXSA9IHtcbiAgICAgICAgICAvL1xuICAgICAgICAgIF9fcHJvdG9fXzogbnVsbFxuICAgICAgICB9O1xuICAgICAgICBjbGFzc0JQc1t0YWddID0gY291bnQ7XG4gICAgICB9XG4gICAgfVxuICAgIGJyZWFrcG9pbnRzID0gbmV3QnJlYWtwb2ludHM7XG4gICAgYnJlYWtwb2ludHNUYWJsZSA9IG5ld0JyZWFrcG9pbnRzVGFibGU7XG4gIH07XG4gIGZyZWV6ZTIoc2V0QnJlYWtwb2ludHMpO1xuICBjb25zdCBzaG91bGRCcmVha3BvaW50ID0gKHJlY2lwaWVudCwgbWV0aG9kTmFtZSkgPT4ge1xuICAgIGlmIChtZXRob2ROYW1lID09PSB2b2lkIDAgfHwgbWV0aG9kTmFtZSA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBjbGFzc0JQcyA9IGJyZWFrcG9pbnRzVGFibGVbbWV0aG9kTmFtZV0gfHwgYnJlYWtwb2ludHNUYWJsZVtcIipcIl07XG4gICAgaWYgKGNsYXNzQlBzID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgbGV0IHRhZyA9IHNpbXBsaWZ5VGFnKHJlY2lwaWVudFtTeW1ib2wudG9TdHJpbmdUYWddKTtcbiAgICBsZXQgY291bnQgPSBjbGFzc0JQc1t0YWddO1xuICAgIGlmIChjb3VudCA9PT0gdm9pZCAwKSB7XG4gICAgICB0YWcgPSBcIipcIjtcbiAgICAgIGNvdW50ID0gY2xhc3NCUHNbdGFnXTtcbiAgICAgIGlmIChjb3VudCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvdW50ID09PSBcIipcIikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChjb3VudCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGFzc2VydCh0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIgJiYgY291bnQgPj0gMSk7XG4gICAgY2xhc3NCUHNbdGFnXSA9IGNvdW50IC0gMTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIGZyZWV6ZTIoc2hvdWxkQnJlYWtwb2ludCk7XG4gIGNvbnN0IGJyZWFrcG9pbnRUZXN0ZXIgPSBmcmVlemUyKHtcbiAgICBnZXRCcmVha3BvaW50cyxcbiAgICBzZXRCcmVha3BvaW50cyxcbiAgICBzaG91bGRCcmVha3BvaW50XG4gIH0pO1xuICBicmVha3BvaW50VGVzdGVyLnNldEJyZWFrcG9pbnRzKCk7XG4gIHJldHVybiBicmVha3BvaW50VGVzdGVyO1xufTtcbmZyZWV6ZTIobWFrZU1lc3NhZ2VCcmVha3BvaW50VGVzdGVyKTtcblxuLy9cbnZhciB7IGRldGFpbHM6IFgsIHF1b3RlOiBxMywgRmFpbDogRmFpbDMsIGVycm9yOiBtYWtlRXJyb3IyIH0gPSBhc3NlcnQ7XG52YXIgeyBhc3NpZ24sIGZyZWV6ZTogZnJlZXplMyB9ID0gT2JqZWN0O1xudmFyIG9uU2VuZCA9IG1ha2VNZXNzYWdlQnJlYWtwb2ludFRlc3RlcihcIkVORE9fU0VORF9CUkVBS1BPSU5UU1wiKTtcbnZhciBiYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyID0ge1xuICBzZXQoX3RhcmdldCwgX3Byb3AsIF92YWx1ZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgaXNFeHRlbnNpYmxlKF90YXJnZXQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIHNldFByb3RvdHlwZU9mKF90YXJnZXQsIF92YWx1ZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgZGVsZXRlUHJvcGVydHkoX3RhcmdldCwgX3Byb3ApIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG52YXIgbWFrZUVQcm94eUhhbmRsZXIgPSAocmVjaXBpZW50LCBIYW5kbGVkUHJvbWlzZTIpID0+IGhhcmRlbih7XG4gIC4uLmJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIsXG4gIGdldDogKF90YXJnZXQsIHByb3BlcnR5S2V5LCByZWNlaXZlcikgPT4ge1xuICAgIHJldHVybiBoYXJkZW4oXG4gICAgICB7XG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBbcHJvcGVydHlLZXldKC4uLmFyZ3MpIHtcbiAgICAgICAgICBpZiAodGhpcyAhPT0gcmVjZWl2ZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBIYW5kbGVkUHJvbWlzZTIucmVqZWN0KFxuICAgICAgICAgICAgICBtYWtlRXJyb3IyKFxuICAgICAgICAgICAgICAgIFhgVW5leHBlY3RlZCByZWNlaXZlciBmb3IgXCIke3EzKHByb3BlcnR5S2V5KX1cIiBtZXRob2Qgb2YgRSgke3EzKFxuICAgICAgICAgICAgICAgICAgcmVjaXBpZW50XG4gICAgICAgICAgICAgICAgKX0pYFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob25TZW5kICYmIG9uU2VuZC5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgcHJvcGVydHlLZXkpKSB7XG4gICAgICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIEhhbmRsZWRQcm9taXNlMi5hcHBseU1ldGhvZChyZWNpcGllbnQsIHByb3BlcnR5S2V5LCBhcmdzKTtcbiAgICAgICAgfVxuICAgICAgICAvL1xuICAgICAgfVtwcm9wZXJ0eUtleV1cbiAgICApO1xuICB9LFxuICBhcHBseTogKF90YXJnZXQsIF90aGlzQXJnLCBhcmdBcnJheSA9IFtdKSA9PiB7XG4gICAgaWYgKG9uU2VuZCAmJiBvblNlbmQuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHZvaWQgMCkpIHtcbiAgICAgIGRlYnVnZ2VyO1xuICAgIH1cbiAgICByZXR1cm4gSGFuZGxlZFByb21pc2UyLmFwcGx5RnVuY3Rpb24ocmVjaXBpZW50LCBhcmdBcnJheSk7XG4gIH0sXG4gIGhhczogKF90YXJnZXQsIF9wKSA9PiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn0pO1xudmFyIG1ha2VFU2VuZE9ubHlQcm94eUhhbmRsZXIgPSAocmVjaXBpZW50LCBIYW5kbGVkUHJvbWlzZTIpID0+IGhhcmRlbih7XG4gIC4uLmJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIsXG4gIGdldDogKF90YXJnZXQsIHByb3BlcnR5S2V5LCByZWNlaXZlcikgPT4ge1xuICAgIHJldHVybiBoYXJkZW4oXG4gICAgICB7XG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIFtwcm9wZXJ0eUtleV0oLi4uYXJncykge1xuICAgICAgICAgIHRoaXMgPT09IHJlY2VpdmVyIHx8IEZhaWwzYFVuZXhwZWN0ZWQgcmVjZWl2ZXIgZm9yIFwiJHtxMyhcbiAgICAgICAgICAgIHByb3BlcnR5S2V5XG4gICAgICAgICAgKX1cIiBtZXRob2Qgb2YgRS5zZW5kT25seSgke3EzKHJlY2lwaWVudCl9KWA7XG4gICAgICAgICAgaWYgKG9uU2VuZCAmJiBvblNlbmQuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHByb3BlcnR5S2V5KSkge1xuICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgfVxuICAgICAgICAgIEhhbmRsZWRQcm9taXNlMi5hcHBseU1ldGhvZFNlbmRPbmx5KHJlY2lwaWVudCwgcHJvcGVydHlLZXksIGFyZ3MpO1xuICAgICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgIH1bcHJvcGVydHlLZXldXG4gICAgKTtcbiAgfSxcbiAgYXBwbHk6IChfdGFyZ2V0LCBfdGhpc0FyZywgYXJnc0FycmF5ID0gW10pID0+IHtcbiAgICBpZiAob25TZW5kICYmIG9uU2VuZC5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgdm9pZCAwKSkge1xuICAgICAgZGVidWdnZXI7XG4gICAgfVxuICAgIEhhbmRsZWRQcm9taXNlMi5hcHBseUZ1bmN0aW9uU2VuZE9ubHkocmVjaXBpZW50LCBhcmdzQXJyYXkpO1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH0sXG4gIGhhczogKF90YXJnZXQsIF9wKSA9PiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn0pO1xudmFyIG1ha2VFR2V0UHJveHlIYW5kbGVyID0gKHgsIEhhbmRsZWRQcm9taXNlMikgPT4gaGFyZGVuKHtcbiAgLi4uYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlcixcbiAgaGFzOiAoX3RhcmdldCwgX3Byb3ApID0+IHRydWUsXG4gIGdldDogKF90YXJnZXQsIHByb3ApID0+IEhhbmRsZWRQcm9taXNlMi5nZXQoeCwgcHJvcClcbn0pO1xudmFyIGZ1bmNUYXJnZXQgPSBmcmVlemUzKCgpID0+IHtcbn0pO1xudmFyIG9ialRhcmdldCA9IGZyZWV6ZTMoeyBfX3Byb3RvX186IG51bGwgfSk7XG52YXIgbWFrZUUgPSAoSGFuZGxlZFByb21pc2UyKSA9PiB7XG4gIHJldHVybiBoYXJkZW4oXG4gICAgYXNzaWduKFxuICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgLy9cbiAgICAgICh4KSA9PiBuZXcgUHJveHkoZnVuY1RhcmdldCwgbWFrZUVQcm94eUhhbmRsZXIoeCwgSGFuZGxlZFByb21pc2UyKSksXG4gICAgICB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICAvL1xuICAgICAgICBnZXQ6ICh4KSA9PiBuZXcgUHJveHkob2JqVGFyZ2V0LCBtYWtlRUdldFByb3h5SGFuZGxlcih4LCBIYW5kbGVkUHJvbWlzZTIpKSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgcmVzb2x2ZTogSGFuZGxlZFByb21pc2UyLnJlc29sdmUsXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHNlbmRPbmx5OiAoeCkgPT4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgbmV3IFByb3h5KGZ1bmNUYXJnZXQsIG1ha2VFU2VuZE9ubHlQcm94eUhhbmRsZXIoeCwgSGFuZGxlZFByb21pc2UyKSlcbiAgICAgICAgKSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgd2hlbjogKHgsIG9uZnVsZmlsbGVkLCBvbnJlamVjdGVkKSA9PiBIYW5kbGVkUHJvbWlzZTIucmVzb2x2ZSh4KS50aGVuKFxuICAgICAgICAgIC4uLnRyYWNrVHVybnMoW29uZnVsZmlsbGVkLCBvbnJlamVjdGVkXSlcbiAgICAgICAgKVxuICAgICAgfVxuICAgIClcbiAgKTtcbn07XG52YXIgRV9kZWZhdWx0ID0gbWFrZUU7XG5cbi8vXG52YXIgaHAgPSBIYW5kbGVkUHJvbWlzZTtcbnZhciBFID0gRV9kZWZhdWx0KGhwKTtcblxuLy9cbnZhciB7IGRldGFpbHM6IFgyLCBxdW90ZTogcTQsIEZhaWw6IEZhaWw0IH0gPSBhc3NlcnQ7XG52YXIgeyBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzLCBnZXRQcm90b3R5cGVPZiwgZnJlZXplOiBmcmVlemU0IH0gPSBPYmplY3Q7XG52YXIgeyBhcHBseTogYXBwbHkyLCBvd25LZXlzIH0gPSBSZWZsZWN0O1xudmFyIG9uRGVsaXZlcnkgPSBtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIoXCJFTkRPX0RFTElWRVJZX0JSRUFLUE9JTlRTXCIpO1xudmFyIGlzUHJpbWl0aXZlID0gKHZhbCkgPT4gIXZhbCB8fCB0eXBlb2YgdmFsICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiB2YWwgIT09IFwiZnVuY3Rpb25cIjtcbnZhciBjb21wYXJlU3RyaW5naWZpZWQgPSAoYTIsIGIzKSA9PiB7XG4gIGlmICh0eXBlb2YgYTIgPT09IHR5cGVvZiBiMykge1xuICAgIGNvbnN0IGxlZnQgPSBTdHJpbmcoYTIpO1xuICAgIGNvbnN0IHJpZ2h0ID0gU3RyaW5nKGIzKTtcbiAgICByZXR1cm4gbGVmdCA8IHJpZ2h0ID8gLTEgOiBsZWZ0ID4gcmlnaHQgPyAxIDogMDtcbiAgfVxuICBpZiAodHlwZW9mIGEyID09PSBcInN5bWJvbFwiKSB7XG4gICAgYXNzZXJ0KHR5cGVvZiBiMyA9PT0gXCJzdHJpbmdcIik7XG4gICAgcmV0dXJuIC0xO1xuICB9XG4gIGFzc2VydCh0eXBlb2YgYTIgPT09IFwic3RyaW5nXCIpO1xuICBhc3NlcnQodHlwZW9mIGIzID09PSBcInN5bWJvbFwiKTtcbiAgcmV0dXJuIDE7XG59O1xudmFyIGdldE1ldGhvZE5hbWVzID0gKHZhbCkgPT4ge1xuICBsZXQgbGF5ZXIgPSB2YWw7XG4gIGNvbnN0IG5hbWVzID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgd2hpbGUgKGxheWVyICE9PSBudWxsICYmIGxheWVyICE9PSBPYmplY3QucHJvdG90eXBlKSB7XG4gICAgY29uc3QgZGVzY3MgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKGxheWVyKTtcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2Ygb3duS2V5cyhkZXNjcykpIHtcbiAgICAgIGlmICh0eXBlb2YgdmFsW25hbWVdID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgbmFtZXMuYWRkKG5hbWUpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoaXNQcmltaXRpdmUodmFsKSkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGxheWVyID0gZ2V0UHJvdG90eXBlT2YobGF5ZXIpO1xuICB9XG4gIHJldHVybiBoYXJkZW4oWy4uLm5hbWVzXS5zb3J0KGNvbXBhcmVTdHJpbmdpZmllZCkpO1xufTtcbmZyZWV6ZTQoZ2V0TWV0aG9kTmFtZXMpO1xuXG4vL1xudmFyIHsgaXNBcnJheSB9ID0gQXJyYXk7XG52YXIgeyBwcm90b3R5cGU6IGZ1bmN0aW9uUHJvdG90eXBlIH0gPSBGdW5jdGlvbjtcbnZhciB7XG4gIGdldE93blByb3BlcnR5RGVzY3JpcHRvcixcbiAgZ2V0UHJvdG90eXBlT2Y6IGdldFByb3RvdHlwZU9mMixcbiAgaGFzT3duOiBoYXNPd24yLFxuICBpc0Zyb3plbixcbiAgcHJvdG90eXBlOiBvYmplY3RQcm90b3R5cGVcbn0gPSBPYmplY3Q7XG52YXIgeyBhcHBseTogYXBwbHkzIH0gPSBSZWZsZWN0O1xudmFyIHsgdG9TdHJpbmdUYWc6IHRvU3RyaW5nVGFnU3ltYm9sIH0gPSBTeW1ib2w7XG52YXIgdHlwZWRBcnJheVByb3RvdHlwZSA9IGdldFByb3RvdHlwZU9mMihVaW50OEFycmF5LnByb3RvdHlwZSk7XG52YXIgdHlwZWRBcnJheVRvU3RyaW5nVGFnRGVzYyA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcihcbiAgdHlwZWRBcnJheVByb3RvdHlwZSxcbiAgdG9TdHJpbmdUYWdTeW1ib2xcbik7XG5hc3NlcnQodHlwZWRBcnJheVRvU3RyaW5nVGFnRGVzYyk7XG52YXIgZ2V0VHlwZWRBcnJheVRvU3RyaW5nVGFnID0gdHlwZWRBcnJheVRvU3RyaW5nVGFnRGVzYy5nZXQ7XG5hc3NlcnQodHlwZW9mIGdldFR5cGVkQXJyYXlUb1N0cmluZ1RhZyA9PT0gXCJmdW5jdGlvblwiKTtcbnZhciBpc1ByaW1pdGl2ZTIgPSAodmFsKSA9PiAoXG4gIC8vXG4gIC8vXG4gIC8vXG4gICF2YWwgfHwgdHlwZW9mIHZhbCAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgdmFsICE9PSBcImZ1bmN0aW9uXCJcbik7XG5oYXJkZW4oaXNQcmltaXRpdmUyKTtcbnZhciBpc09iamVjdCA9ICh2YWwpID0+IChcbiAgLy9cbiAgLy9cbiAgLy9cbiAgISF2YWwgJiYgKHR5cGVvZiB2YWwgPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIHZhbCA9PT0gXCJmdW5jdGlvblwiKVxuKTtcbmhhcmRlbihpc09iamVjdCk7XG52YXIgaXNUeXBlZEFycmF5ID0gKG9iamVjdCkgPT4ge1xuICBjb25zdCB0YWcgPSBhcHBseTMoZ2V0VHlwZWRBcnJheVRvU3RyaW5nVGFnLCBvYmplY3QsIFtdKTtcbiAgcmV0dXJuIHRhZyAhPT0gdm9pZCAwO1xufTtcbmhhcmRlbihpc1R5cGVkQXJyYXkpO1xudmFyIFBBU1NfU1RZTEUgPSBTeW1ib2wuZm9yKFwicGFzc1N0eWxlXCIpO1xudmFyIGFzc2VydENoZWNrZXIgPSAoY29uZCwgZGV0YWlscykgPT4ge1xuICBhc3NlcnQoY29uZCwgZGV0YWlscyk7XG4gIHJldHVybiB0cnVlO1xufTtcbmhhcmRlbihhc3NlcnRDaGVja2VyKTtcbnZhciBDWCA9IChjaGVjaykgPT4ge1xuICBjb25zdCByZWplY3QgPSAoVCwgLi4uc3VicykgPT4gY2hlY2soZmFsc2UsIHJlZGFjdGVkKFQsIC4uLnN1YnMpKTtcbiAgcmV0dXJuIHJlamVjdDtcbn07XG5oYXJkZW4oQ1gpO1xudmFyIGdldE93bkRhdGFEZXNjcmlwdG9yID0gKGNhbmRpZGF0ZSwgcHJvcE5hbWUsIHNob3VsZEJlRW51bWVyYWJsZSwgY2hlY2spID0+IHtcbiAgY29uc3QgZGVzYyA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoY2FuZGlkYXRlLCBwcm9wTmFtZSlcbiAgKTtcbiAgcmV0dXJuIChkZXNjICE9PSB2b2lkIDAgfHwgISFjaGVjayAmJiBDWChjaGVjaylgJHtxdW90ZShwcm9wTmFtZSl9IHByb3BlcnR5IGV4cGVjdGVkOiAke2NhbmRpZGF0ZX1gKSAmJiAoaGFzT3duMihkZXNjLCBcInZhbHVlXCIpIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgY2hlY2tcbiAgKWAke3F1b3RlKHByb3BOYW1lKX0gbXVzdCBub3QgYmUgYW4gYWNjZXNzb3IgcHJvcGVydHk6ICR7Y2FuZGlkYXRlfWApICYmIChzaG91bGRCZUVudW1lcmFibGUgPyBkZXNjLmVudW1lcmFibGUgfHwgISFjaGVjayAmJiBDWChcbiAgICBjaGVja1xuICApYCR7cXVvdGUocHJvcE5hbWUpfSBtdXN0IGJlIGFuIGVudW1lcmFibGUgcHJvcGVydHk6ICR7Y2FuZGlkYXRlfWAgOiAhZGVzYy5lbnVtZXJhYmxlIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgY2hlY2tcbiAgKWAke3F1b3RlKHByb3BOYW1lKX0gbXVzdCBub3QgYmUgYW4gZW51bWVyYWJsZSBwcm9wZXJ0eTogJHtjYW5kaWRhdGV9YCkgPyBkZXNjIDogKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICB2b2lkIDBcbiAgKTtcbn07XG5oYXJkZW4oZ2V0T3duRGF0YURlc2NyaXB0b3IpO1xudmFyIGdldFRhZyA9ICh0YWdSZWNvcmQpID0+IHRhZ1JlY29yZFtTeW1ib2wudG9TdHJpbmdUYWddO1xuaGFyZGVuKGdldFRhZyk7XG52YXIgY2hlY2tQYXNzU3R5bGUgPSAob2JqLCBwYXNzU3R5bGUsIGV4cGVjdGVkUGFzc1N0eWxlLCBjaGVjaykgPT4ge1xuICByZXR1cm4gcGFzc1N0eWxlID09PSBleHBlY3RlZFBhc3NTdHlsZSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBFeHBlY3RlZCAke3F1b3RlKGV4cGVjdGVkUGFzc1N0eWxlKX0sIG5vdCAke3F1b3RlKHBhc3NTdHlsZSl9OiAke29ian1gO1xufTtcbmhhcmRlbihjaGVja1Bhc3NTdHlsZSk7XG52YXIgbWFrZUNoZWNrVGFnUmVjb3JkID0gKGNoZWNrUHJvdG8pID0+IHtcbiAgY29uc3QgY2hlY2tUYWdSZWNvcmQyID0gKHRhZ1JlY29yZCwgZXhwZWN0ZWRQYXNzU3R5bGUsIGNoZWNrKSA9PiB7XG4gICAgcmV0dXJuICghaXNQcmltaXRpdmUyKHRhZ1JlY29yZCkgfHwgISFjaGVjayAmJiBDWChjaGVjaylgQSBub24tb2JqZWN0IGNhbm5vdCBiZSBhIHRhZ1JlY29yZDogJHt0YWdSZWNvcmR9YCkgJiYgKGlzRnJvemVuKHRhZ1JlY29yZCkgfHwgISFjaGVjayAmJiBDWChjaGVjaylgQSB0YWdSZWNvcmQgbXVzdCBiZSBmcm96ZW46ICR7dGFnUmVjb3JkfWApICYmICghaXNBcnJheSh0YWdSZWNvcmQpIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYEFuIGFycmF5IGNhbm5vdCBiZSBhIHRhZ1JlY29yZDogJHt0YWdSZWNvcmR9YCkgJiYgY2hlY2tQYXNzU3R5bGUoXG4gICAgICB0YWdSZWNvcmQsXG4gICAgICBnZXRPd25EYXRhRGVzY3JpcHRvcih0YWdSZWNvcmQsIFBBU1NfU1RZTEUsIGZhbHNlLCBjaGVjaykudmFsdWUsXG4gICAgICBleHBlY3RlZFBhc3NTdHlsZSxcbiAgICAgIGNoZWNrXG4gICAgKSAmJiAodHlwZW9mIGdldE93bkRhdGFEZXNjcmlwdG9yKHRhZ1JlY29yZCwgU3ltYm9sLnRvU3RyaW5nVGFnLCBmYWxzZSwgY2hlY2spLnZhbHVlID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgICBjaGVja1xuICAgIClgQSBbU3ltYm9sLnRvU3RyaW5nVGFnXS1uYW1lZCBwcm9wZXJ0eSBtdXN0IGJlIGEgc3RyaW5nOiAke3RhZ1JlY29yZH1gKSAmJiBjaGVja1Byb3RvKHRhZ1JlY29yZCwgZ2V0UHJvdG90eXBlT2YyKHRhZ1JlY29yZCksIGNoZWNrKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbihjaGVja1RhZ1JlY29yZDIpO1xufTtcbnZhciBjaGVja1RhZ1JlY29yZCA9IG1ha2VDaGVja1RhZ1JlY29yZChcbiAgKHZhbCwgcHJvdG8sIGNoZWNrKSA9PiBwcm90byA9PT0gb2JqZWN0UHJvdG90eXBlIHx8ICEhY2hlY2sgJiYgY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgdGFnUmVjb3JkIG11c3QgaW5oZXJpdCBmcm9tIE9iamVjdC5wcm90b3R5cGU6ICR7dmFsfWApXG4pO1xuaGFyZGVuKGNoZWNrVGFnUmVjb3JkKTtcbnZhciBjaGVja0Z1bmN0aW9uVGFnUmVjb3JkID0gbWFrZUNoZWNrVGFnUmVjb3JkKFxuICAodmFsLCBwcm90bywgY2hlY2spID0+IHByb3RvID09PSBmdW5jdGlvblByb3RvdHlwZSB8fCBwcm90byAhPT0gbnVsbCAmJiBnZXRQcm90b3R5cGVPZjIocHJvdG8pID09PSBmdW5jdGlvblByb3RvdHlwZSB8fCAhIWNoZWNrICYmIGNoZWNrKFxuICAgIGZhbHNlLFxuICAgIHJlZGFjdGVkYEZvciBmdW5jdGlvbnMsIGEgdGFnUmVjb3JkIG11c3QgaW5oZXJpdCBmcm9tIEZ1bmN0aW9uLnByb3RvdHlwZTogJHt2YWx9YFxuICApXG4pO1xuaGFyZGVuKGNoZWNrRnVuY3Rpb25UYWdSZWNvcmQpO1xuXG4vL1xudmFyIGNhbkJlTWV0aG9kID0gKGZ1bmMpID0+IHR5cGVvZiBmdW5jID09PSBcImZ1bmN0aW9uXCIgJiYgIShQQVNTX1NUWUxFIGluIGZ1bmMpO1xuaGFyZGVuKGNhbkJlTWV0aG9kKTtcbnZhciBjYW5CZU1ldGhvZE5hbWUgPSAoa2V5KSA9PiAoXG4gIC8vXG4gIHR5cGVvZiBrZXkgPT09IFwic3RyaW5nXCIgfHwgdHlwZW9mIGtleSA9PT0gXCJzeW1ib2xcIiB8fCB0eXBlb2Yga2V5ID09PSBcIm51bWJlclwiXG4pO1xuaGFyZGVuKGNhbkJlTWV0aG9kTmFtZSk7XG52YXIgZ2V0UmVtb3RhYmxlTWV0aG9kTmFtZXMgPSAoYmVoYXZpb3JNZXRob2RzKSA9PiBnZXRNZXRob2ROYW1lcyhiZWhhdmlvck1ldGhvZHMpO1xuaGFyZGVuKGdldFJlbW90YWJsZU1ldGhvZE5hbWVzKTtcbnZhciB7IG93bktleXM6IG93bktleXMyIH0gPSBSZWZsZWN0O1xudmFyIHsgaXNBcnJheTogaXNBcnJheTIgfSA9IEFycmF5O1xudmFyIHtcbiAgZ2V0UHJvdG90eXBlT2Y6IGdldFByb3RvdHlwZU9mMyxcbiAgaXNGcm96ZW46IGlzRnJvemVuMixcbiAgcHJvdG90eXBlOiBvYmplY3RQcm90b3R5cGUyLFxuICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzMixcbiAgaGFzT3duOiBoYXNPd24zXG59ID0gT2JqZWN0O1xudmFyIGNoZWNrSWZhY2UgPSAoaWZhY2UsIGNoZWNrKSA9PiB7XG4gIHJldHVybiAoXG4gICAgLy9cbiAgICAodHlwZW9mIGlmYWNlID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgICBjaGVja1xuICAgIClgRm9yIG5vdywgaW50ZXJmYWNlICR7aWZhY2V9IG11c3QgYmUgYSBzdHJpbmc7IHVuaW1wbGVtZW50ZWRgKSAmJiAoaWZhY2UgPT09IFwiUmVtb3RhYmxlXCIgfHwgaWZhY2Uuc3RhcnRzV2l0aChcIkFsbGVnZWQ6IFwiKSB8fCBpZmFjZS5zdGFydHNXaXRoKFwiRGVidWdOYW1lOiBcIikgfHwgISFjaGVjayAmJiBDWChjaGVjaylgRm9yIG5vdywgaWZhY2UgJHtxdW90ZShcbiAgICAgIGlmYWNlXG4gICAgKX0gbXVzdCBiZSBcIlJlbW90YWJsZVwiIG9yIGJlZ2luIHdpdGggXCJBbGxlZ2VkOiBcIiBvciBcIkRlYnVnTmFtZTogXCI7IHVuaW1wbGVtZW50ZWRgKVxuICApO1xufTtcbnZhciBhc3NlcnRJZmFjZSA9IChpZmFjZSkgPT4gY2hlY2tJZmFjZShpZmFjZSwgYXNzZXJ0Q2hlY2tlcik7XG5oYXJkZW4oYXNzZXJ0SWZhY2UpO1xudmFyIGNoZWNrUmVtb3RhYmxlUHJvdG9PZiA9IChvcmlnaW5hbCwgY2hlY2spID0+IHtcbiAgIWlzUHJpbWl0aXZlMihvcmlnaW5hbCkgfHwgdGhyb3dSZWRhY3RlZGBSZW1vdGFibGVzIG11c3QgYmUgb2JqZWN0cyBvciBmdW5jdGlvbnM6ICR7b3JpZ2luYWx9YDtcbiAgY29uc3QgcHJvdG8gPSBnZXRQcm90b3R5cGVPZjMob3JpZ2luYWwpO1xuICBpZiAocHJvdG8gPT09IG9iamVjdFByb3RvdHlwZTIgfHwgcHJvdG8gPT09IG51bGwgfHwgcHJvdG8gPT09IEZ1bmN0aW9uLnByb3RvdHlwZSkge1xuICAgIHJldHVybiAhIWNoZWNrICYmIENYKGNoZWNrKWBSZW1vdGFibGVzIG11c3QgYmUgZXhwbGljaXRseSBkZWNsYXJlZDogJHtxdW90ZShvcmlnaW5hbCl9YDtcbiAgfVxuICBpZiAodHlwZW9mIG9yaWdpbmFsID09PSBcIm9iamVjdFwiKSB7XG4gICAgY29uc3QgcHJvdG9Qcm90byA9IGdldFByb3RvdHlwZU9mMyhwcm90byk7XG4gICAgaWYgKHByb3RvUHJvdG8gIT09IG9iamVjdFByb3RvdHlwZTIgJiYgcHJvdG9Qcm90byAhPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGNoZWNrUmVtb3RhYmxlKHByb3RvLCBjaGVjayk7XG4gICAgfVxuICAgIGlmICghY2hlY2tUYWdSZWNvcmQocHJvdG8sIFwicmVtb3RhYmxlXCIsIGNoZWNrKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSBlbHNlIGlmICh0eXBlb2Ygb3JpZ2luYWwgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIGlmICghY2hlY2tGdW5jdGlvblRhZ1JlY29yZChwcm90bywgXCJyZW1vdGFibGVcIiwgY2hlY2spKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIGNvbnN0IHBhc3NTdHlsZUtleSA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgUEFTU19TVFlMRVxuICApO1xuICBjb25zdCB0YWdLZXkgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgIFN5bWJvbC50b1N0cmluZ1RhZ1xuICApO1xuICBjb25zdCB7XG4gICAgLy9cbiAgICBbXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHBhc3NTdHlsZUtleVxuICAgIF06IF9wYXNzU3R5bGVEZXNjLFxuICAgIFtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgdGFnS2V5XG4gICAgXTogeyB2YWx1ZTogaWZhY2UgfSxcbiAgICAuLi5yZXN0RGVzY3NcbiAgfSA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnMyKHByb3RvKTtcbiAgcmV0dXJuIChvd25LZXlzMihyZXN0RGVzY3MpLmxlbmd0aCA9PT0gMCB8fCAhIWNoZWNrICYmIENYKFxuICAgIGNoZWNrXG4gIClgVW5leHBlY3RlZCBwcm9wZXJ0aWVzIG9uIFJlbW90YWJsZSBQcm90byAke293bktleXMyKHJlc3REZXNjcyl9YCkgJiYgY2hlY2tJZmFjZShpZmFjZSwgY2hlY2spO1xufTtcbnZhciBjb25maXJtZWRSZW1vdGFibGVzID0gLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCk7XG52YXIgY2hlY2tSZW1vdGFibGUgPSAodmFsLCBjaGVjaykgPT4ge1xuICBpZiAoY29uZmlybWVkUmVtb3RhYmxlcy5oYXModmFsKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmICghaXNGcm96ZW4yKHZhbCkpIHtcbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgY2Fubm90IHNlcmlhbGl6ZSBub24tZnJvemVuIG9iamVjdHMgbGlrZSAke3ZhbH1gO1xuICB9XG4gIGlmICghUmVtb3RhYmxlSGVscGVyLmNhbkJlVmFsaWQodmFsLCBjaGVjaykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgcmVzdWx0ID0gY2hlY2tSZW1vdGFibGVQcm90b09mKHZhbCwgY2hlY2spO1xuICBpZiAocmVzdWx0KSB7XG4gICAgY29uZmlybWVkUmVtb3RhYmxlcy5hZGQodmFsKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBnZXRJbnRlcmZhY2VPZiA9ICh2YWwpID0+IHtcbiAgaWYgKGlzUHJpbWl0aXZlMih2YWwpIHx8IHZhbFtQQVNTX1NUWUxFXSAhPT0gXCJyZW1vdGFibGVcIiB8fCAhY2hlY2tSZW1vdGFibGUodmFsKSkge1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbiAgcmV0dXJuIGdldFRhZyh2YWwpO1xufTtcbmhhcmRlbihnZXRJbnRlcmZhY2VPZik7XG52YXIgUmVtb3RhYmxlSGVscGVyID0gaGFyZGVuKHtcbiAgc3R5bGVOYW1lOiBcInJlbW90YWJsZVwiLFxuICBjYW5CZVZhbGlkOiAoY2FuZGlkYXRlLCBjaGVjayA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkVHlwZSA9ICghaXNQcmltaXRpdmUyKGNhbmRpZGF0ZSkgfHwgISFjaGVjayAmJiBDWChjaGVjaylgY2Fubm90IHNlcmlhbGl6ZSBub24tb2JqZWN0cyBhcyBSZW1vdGFibGUgJHtjYW5kaWRhdGV9YCkgJiYgKCFpc0FycmF5MihjYW5kaWRhdGUpIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYGNhbm5vdCBzZXJpYWxpemUgYXJyYXlzIGFzIFJlbW90YWJsZSAke2NhbmRpZGF0ZX1gKTtcbiAgICBpZiAoIXZhbGlkVHlwZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBkZXNjcyA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnMyKGNhbmRpZGF0ZSk7XG4gICAgaWYgKHR5cGVvZiBjYW5kaWRhdGUgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIHJldHVybiBvd25LZXlzMihkZXNjcykuZXZlcnkoKGtleSkgPT4ge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgKGhhc093bjMoZGVzY3NbXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGtleVxuICAgICAgICAgIF0sIFwidmFsdWVcIikgfHwgISFjaGVjayAmJiBDWChjaGVjaylgY2Fubm90IHNlcmlhbGl6ZSBSZW1vdGFibGVzIHdpdGggYWNjZXNzb3JzIGxpa2UgJHtxdW90ZShcbiAgICAgICAgICAgIFN0cmluZyhrZXkpXG4gICAgICAgICAgKX0gaW4gJHtjYW5kaWRhdGV9YCkgJiYgKGtleSA9PT0gU3ltYm9sLnRvU3RyaW5nVGFnICYmIGNoZWNrSWZhY2UoY2FuZGlkYXRlW2tleV0sIGNoZWNrKSB8fCAoY2FuQmVNZXRob2QoY2FuZGlkYXRlW2tleV0pIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYGNhbm5vdCBzZXJpYWxpemUgUmVtb3RhYmxlcyB3aXRoIG5vbi1tZXRob2RzIGxpa2UgJHtxdW90ZShcbiAgICAgICAgICAgIFN0cmluZyhrZXkpXG4gICAgICAgICAgKX0gaW4gJHtjYW5kaWRhdGV9YCkgJiYgKGtleSAhPT0gUEFTU19TVFlMRSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBBIHBhc3MtYnktcmVtb3RlIGNhbm5vdCBzaGFkb3cgJHtxdW90ZShQQVNTX1NUWUxFKX1gKSlcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGNhbmRpZGF0ZSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIG5hbWU6IG5hbWVEZXNjLFxuICAgICAgICBsZW5ndGg6IGxlbmd0aERlc2MsXG4gICAgICAgIC8vXG4gICAgICAgIFtTeW1ib2wudG9TdHJpbmdUYWddOiB0b1N0cmluZ1RhZ0Rlc2MsXG4gICAgICAgIC4uLnJlc3REZXNjc1xuICAgICAgfSA9IGRlc2NzO1xuICAgICAgY29uc3QgcmVzdEtleXMgPSBvd25LZXlzMihyZXN0RGVzY3MpO1xuICAgICAgcmV0dXJuIChuYW1lRGVzYyAmJiB0eXBlb2YgbmFtZURlc2MudmFsdWUgPT09IFwic3RyaW5nXCIgfHwgISFjaGVjayAmJiBDWChjaGVjaylgRmFyIGZ1bmN0aW9uIG5hbWUgbXVzdCBiZSBhIHN0cmluZywgaW4gJHtjYW5kaWRhdGV9YCkgJiYgKGxlbmd0aERlc2MgJiYgdHlwZW9mIGxlbmd0aERlc2MudmFsdWUgPT09IFwibnVtYmVyXCIgfHwgISFjaGVjayAmJiBDWChcbiAgICAgICAgY2hlY2tcbiAgICAgIClgRmFyIGZ1bmN0aW9uIGxlbmd0aCBtdXN0IGJlIGEgbnVtYmVyLCBpbiAke2NhbmRpZGF0ZX1gKSAmJiAodG9TdHJpbmdUYWdEZXNjID09PSB2b2lkIDAgfHwgKHR5cGVvZiB0b1N0cmluZ1RhZ0Rlc2MudmFsdWUgPT09IFwic3RyaW5nXCIgfHwgISFjaGVjayAmJiBDWChcbiAgICAgICAgY2hlY2tcbiAgICAgIClgRmFyIGZ1bmN0aW9uIEBAdG9TdHJpbmdUYWcgbXVzdCBiZSBhIHN0cmluZywgaW4gJHtjYW5kaWRhdGV9YCkgJiYgY2hlY2tJZmFjZSh0b1N0cmluZ1RhZ0Rlc2MudmFsdWUsIGNoZWNrKSkgJiYgKHJlc3RLZXlzLmxlbmd0aCA9PT0gMCB8fCAhIWNoZWNrICYmIENYKFxuICAgICAgICBjaGVja1xuICAgICAgKWBGYXIgZnVuY3Rpb25zIHVuZXhwZWN0ZWQgcHJvcGVydGllcyBiZXNpZGVzIC5uYW1lIGFuZCAubGVuZ3RoICR7cmVzdEtleXN9YCk7XG4gICAgfVxuICAgIHJldHVybiAhIWNoZWNrICYmIENYKGNoZWNrKWB1bnJlY29nbml6ZWQgdHlwZW9mICR7Y2FuZGlkYXRlfWA7XG4gIH0sXG4gIGFzc2VydFJlc3RWYWxpZDogKGNhbmRpZGF0ZSkgPT4gY2hlY2tSZW1vdGFibGUoY2FuZGlkYXRlLCBhc3NlcnRDaGVja2VyKSxcbiAgZXZlcnk6IChfcGFzc2FibGUsIF9mbikgPT4gdHJ1ZVxufSk7XG5cbi8vXG52YXIgeyBwcm90b3R5cGU6IGZ1bmN0aW9uUHJvdG90eXBlMiB9ID0gRnVuY3Rpb247XG52YXIge1xuICBnZXRQcm90b3R5cGVPZjogZ2V0UHJvdG90eXBlT2Y0LFxuICBzZXRQcm90b3R5cGVPZixcbiAgY3JlYXRlLFxuICBpc0Zyb3plbjogaXNGcm96ZW4zLFxuICBwcm90b3R5cGU6IG9iamVjdFByb3RvdHlwZTNcbn0gPSBPYmplY3Q7XG52YXIgbWFrZVJlbW90YWJsZVByb3RvID0gKHJlbW90YWJsZSwgaWZhY2UpID0+IHtcbiAgbGV0IG9sZFByb3RvID0gZ2V0UHJvdG90eXBlT2Y0KHJlbW90YWJsZSk7XG4gIGlmICh0eXBlb2YgcmVtb3RhYmxlID09PSBcIm9iamVjdFwiKSB7XG4gICAgaWYgKG9sZFByb3RvID09PSBudWxsKSB7XG4gICAgICBvbGRQcm90byA9IG9iamVjdFByb3RvdHlwZTM7XG4gICAgfVxuICAgIG9sZFByb3RvID09PSBvYmplY3RQcm90b3R5cGUzIHx8IHRocm93UmVkYWN0ZWRgRm9yIG5vdywgcmVtb3RhYmxlcyBjYW5ub3QgaW5oZXJpdCBmcm9tIGFueXRoaW5nIHVudXN1YWwsIGluICR7cmVtb3RhYmxlfWA7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHJlbW90YWJsZSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgb2xkUHJvdG8gIT09IG51bGwgfHwgdGhyb3dSZWRhY3RlZGBPcmlnaW5hbCBmdW5jdGlvbiBtdXN0IG5vdCBpbmhlcml0IGZyb20gbnVsbDogJHtyZW1vdGFibGV9YDtcbiAgICBvbGRQcm90byA9PT0gZnVuY3Rpb25Qcm90b3R5cGUyIHx8IGdldFByb3RvdHlwZU9mNChvbGRQcm90bykgPT09IGZ1bmN0aW9uUHJvdG90eXBlMiB8fCB0aHJvd1JlZGFjdGVkYEZhciBmdW5jdGlvbnMgbXVzdCBvcmlnaW5hbGx5IGluaGVyaXQgZnJvbSBGdW5jdGlvbi5wcm90b3R5cGUsIGluICR7cmVtb3RhYmxlfWA7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3dSZWRhY3RlZGB1bnJlY29nbml6ZWQgdHlwZW9mICR7cmVtb3RhYmxlfWA7XG4gIH1cbiAgcmV0dXJuIGhhcmRlbihcbiAgICBjcmVhdGUob2xkUHJvdG8sIHtcbiAgICAgIFtQQVNTX1NUWUxFXTogeyB2YWx1ZTogXCJyZW1vdGFibGVcIiB9LFxuICAgICAgW1N5bWJvbC50b1N0cmluZ1RhZ106IHsgdmFsdWU6IGlmYWNlIH1cbiAgICB9KVxuICApO1xufTtcbnZhciBhc3NlcnRDYW5CZVJlbW90YWJsZSA9IChjYW5kaWRhdGUpID0+IFJlbW90YWJsZUhlbHBlci5jYW5CZVZhbGlkKGNhbmRpZGF0ZSwgYXNzZXJ0Q2hlY2tlcik7XG52YXIgUmVtb3RhYmxlID0gKGlmYWNlID0gXCJSZW1vdGFibGVcIiwgcHJvcHMgPSB2b2lkIDAsIHJlbW90YWJsZSA9IChcbiAgLyogICAgICAgICAgICAqL1xuICB7fVxuKSkgPT4ge1xuICBhc3NlcnRJZmFjZShpZmFjZSk7XG4gIGFzc2VydChpZmFjZSk7XG4gIHByb3BzID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBSZW1vdGFibGUgcHJvcHMgbm90IHlldCBpbXBsZW1lbnRlZCAke3Byb3BzfWA7XG4gIGFzc2VydENhbkJlUmVtb3RhYmxlKHJlbW90YWJsZSk7XG4gICEoUEFTU19TVFlMRSBpbiByZW1vdGFibGUpIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlICR7cmVtb3RhYmxlfSBpcyBhbHJlYWR5IG1hcmtlZCBhcyBhICR7cXVvdGUoXG4gICAgcmVtb3RhYmxlW1BBU1NfU1RZTEVdXG4gICl9YDtcbiAgaGFyZGVuLmlzRmFrZSB8fCAvL1xuICAhaXNGcm96ZW4zKHJlbW90YWJsZSkgfHwgdGhyb3dSZWRhY3RlZGBSZW1vdGFibGUgJHtyZW1vdGFibGV9IGlzIGFscmVhZHkgZnJvemVuYDtcbiAgY29uc3QgcmVtb3RhYmxlUHJvdG8gPSBtYWtlUmVtb3RhYmxlUHJvdG8ocmVtb3RhYmxlLCBpZmFjZSk7XG4gIGNvbnN0IG11dGF0ZUhhcmRlbkFuZENoZWNrID0gKHRhcmdldCkgPT4ge1xuICAgIHNldFByb3RvdHlwZU9mKHRhcmdldCwgcmVtb3RhYmxlUHJvdG8pO1xuICAgIGhhcmRlbih0YXJnZXQpO1xuICAgIGFzc2VydENhbkJlUmVtb3RhYmxlKHRhcmdldCk7XG4gIH07XG4gIG11dGF0ZUhhcmRlbkFuZENoZWNrKHt9KTtcbiAgbXV0YXRlSGFyZGVuQW5kQ2hlY2socmVtb3RhYmxlKTtcbiAgYXNzZXJ0KGlmYWNlICE9PSB2b2lkIDApO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAqL1xuICAgIHJlbW90YWJsZVxuICApO1xufTtcbmhhcmRlbihSZW1vdGFibGUpO1xudmFyIEdFVF9NRVRIT0RfTkFNRVMgPSBcIl9fZ2V0TWV0aG9kTmFtZXNfX1wiO1xudmFyIGdldE1ldGhvZE5hbWVzTWV0aG9kID0gaGFyZGVuKHtcbiAgW0dFVF9NRVRIT0RfTkFNRVNdKCkge1xuICAgIHJldHVybiBnZXRNZXRob2ROYW1lcyh0aGlzKTtcbiAgfVxufSlbR0VUX01FVEhPRF9OQU1FU107XG52YXIgZ2V0TWV0aG9kTmFtZXNEZXNjcmlwdG9yID0gaGFyZGVuKHtcbiAgdmFsdWU6IGdldE1ldGhvZE5hbWVzTWV0aG9kLFxuICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgY29uZmlndXJhYmxlOiBmYWxzZSxcbiAgd3JpdGFibGU6IGZhbHNlXG59KTtcbnZhciBGYXIgPSAoZmFyTmFtZSwgcmVtb3RhYmxlID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IHI1ID0gcmVtb3RhYmxlID09PSB2b2lkIDAgPyAoXG4gICAgLyogICAgICAgICAgICAqL1xuICAgIHt9XG4gICkgOiByZW1vdGFibGU7XG4gIGlmICh0eXBlb2YgcjUgPT09IFwib2JqZWN0XCIgJiYgIShHRVRfTUVUSE9EX05BTUVTIGluIHI1KSkge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyNSwgR0VUX01FVEhPRF9OQU1FUywgZ2V0TWV0aG9kTmFtZXNEZXNjcmlwdG9yKTtcbiAgfVxuICByZXR1cm4gUmVtb3RhYmxlKGBBbGxlZ2VkOiAke2Zhck5hbWV9YCwgdm9pZCAwLCByNSk7XG59O1xuaGFyZGVuKEZhcik7XG52YXIgVG9GYXJGdW5jdGlvbiA9IChmYXJOYW1lLCBmdW5jKSA9PiB7XG4gIGlmIChnZXRJbnRlcmZhY2VPZihmdW5jKSAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIGZ1bmM7XG4gIH1cbiAgcmV0dXJuIEZhcihmYXJOYW1lLCAoLi4uYXJncykgPT4gZnVuYyguLi5hcmdzKSk7XG59O1xuaGFyZGVuKFRvRmFyRnVuY3Rpb24pO1xuXG4vL1xudmFyIG1hcEl0ZXJhYmxlID0gKGJhc2VJdGVyYWJsZSwgZnVuYykgPT4gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICBGYXIoXCJtYXBwZWQgaXRlcmFibGVcIiwge1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBjb25zdCBiYXNlSXRlcmF0b3IgPSBiYXNlSXRlcmFibGVbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgcmV0dXJuIEZhcihcIm1hcHBlZCBpdGVyYXRvclwiLCB7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBjb25zdCB7IHZhbHVlOiBiYXNlVmFsdWUsIGRvbmUgfSA9IGJhc2VJdGVyYXRvci5uZXh0KCk7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBkb25lID8gYmFzZVZhbHVlIDogZnVuYyhiYXNlVmFsdWUpO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyB2YWx1ZSwgZG9uZSB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KVxuKTtcbmhhcmRlbihtYXBJdGVyYWJsZSk7XG52YXIgZmlsdGVySXRlcmFibGUgPSAoYmFzZUl0ZXJhYmxlLCBwcmVkKSA9PiAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gIEZhcihcImZpbHRlcmVkIGl0ZXJhYmxlXCIsIHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgY29uc3QgYmFzZUl0ZXJhdG9yID0gYmFzZUl0ZXJhYmxlW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgIHJldHVybiBGYXIoXCJmaWx0ZXJlZCBpdGVyYXRvclwiLCB7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBmb3IgKDsgOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGJhc2VJdGVyYXRvci5uZXh0KCk7XG4gICAgICAgICAgICBjb25zdCB7IHZhbHVlLCBkb25lIH0gPSByZXN1bHQ7XG4gICAgICAgICAgICBpZiAoZG9uZSB8fCBwcmVkKHZhbHVlKSkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KVxuKTtcbmhhcmRlbihmaWx0ZXJJdGVyYWJsZSk7XG5cbi8vXG52YXIgeyBnZXRQcm90b3R5cGVPZjogZ2V0UHJvdG90eXBlT2Y1LCBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzMywgaGFzT3duOiBoYXNPd240LCBlbnRyaWVzOiBlbnRyaWVzMiB9ID0gT2JqZWN0O1xudmFyIGVycm9yQ29uc3RydWN0b3JzID0gLyogICAgICAgICAgICovIG5ldyBNYXAoXG4gIC8vXG4gIC8vXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICBbXG4gICAgW1wiRXJyb3JcIiwgRXJyb3JdLFxuICAgIFtcIkV2YWxFcnJvclwiLCBFdmFsRXJyb3JdLFxuICAgIFtcIlJhbmdlRXJyb3JcIiwgUmFuZ2VFcnJvcl0sXG4gICAgW1wiUmVmZXJlbmNlRXJyb3JcIiwgUmVmZXJlbmNlRXJyb3JdLFxuICAgIFtcIlN5bnRheEVycm9yXCIsIFN5bnRheEVycm9yXSxcbiAgICBbXCJUeXBlRXJyb3JcIiwgVHlwZUVycm9yXSxcbiAgICBbXCJVUklFcnJvclwiLCBVUklFcnJvcl1cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICBdXG4pO1xuaWYgKHR5cGVvZiBBZ2dyZWdhdGVFcnJvciAhPT0gXCJ1bmRlZmluZWRcIikge1xuICBlcnJvckNvbnN0cnVjdG9ycy5zZXQoXCJBZ2dyZWdhdGVFcnJvclwiLCBBZ2dyZWdhdGVFcnJvcik7XG59XG52YXIgZ2V0RXJyb3JDb25zdHJ1Y3RvciA9IChuYW1lKSA9PiBlcnJvckNvbnN0cnVjdG9ycy5nZXQobmFtZSk7XG5oYXJkZW4oZ2V0RXJyb3JDb25zdHJ1Y3Rvcik7XG52YXIgY2hlY2tFcnJvckxpa2UgPSAoY2FuZGlkYXRlLCBjaGVjayA9IHZvaWQgMCkgPT4ge1xuICByZXR1cm4gY2FuZGlkYXRlIGluc3RhbmNlb2YgRXJyb3IgfHwgISFjaGVjayAmJiBDWChjaGVjaylgRXJyb3IgZXhwZWN0ZWQ6ICR7Y2FuZGlkYXRlfWA7XG59O1xuaGFyZGVuKGNoZWNrRXJyb3JMaWtlKTtcbnZhciBpc0Vycm9yTGlrZSA9IChjYW5kaWRhdGUpID0+IGNoZWNrRXJyb3JMaWtlKGNhbmRpZGF0ZSk7XG5oYXJkZW4oaXNFcnJvckxpa2UpO1xudmFyIGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yUHJvcGVydHlEZXNjID0gKHByb3BOYW1lLCBkZXNjLCBwYXNzU3R5bGVPZlJlY3VyLCBjaGVjayA9IHZvaWQgMCkgPT4ge1xuICBpZiAoZGVzYy5lbnVtZXJhYmxlKSB7XG4gICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goY2hlY2spYFBhc3NhYmxlIEVycm9yICR7cXVvdGUoXG4gICAgICBwcm9wTmFtZVxuICAgICl9IG93biBwcm9wZXJ0eSBtdXN0IG5vdCBiZSBlbnVtZXJhYmxlOiAke2Rlc2N9YDtcbiAgfVxuICBpZiAoIWhhc093bjQoZGVzYywgXCJ2YWx1ZVwiKSkge1xuICAgIHJldHVybiAhIWNoZWNrICYmIENYKGNoZWNrKWBQYXNzYWJsZSBFcnJvciAke3F1b3RlKFxuICAgICAgcHJvcE5hbWVcbiAgICApfSBvd24gcHJvcGVydHkgbXVzdCBiZSBhIGRhdGEgcHJvcGVydHk6ICR7ZGVzY31gO1xuICB9XG4gIGNvbnN0IHsgdmFsdWUgfSA9IGRlc2M7XG4gIHN3aXRjaCAocHJvcE5hbWUpIHtcbiAgICBjYXNlIFwibWVzc2FnZVwiOlxuICAgIGNhc2UgXCJzdGFja1wiOiB7XG4gICAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYFBhc3NhYmxlIEVycm9yICR7cXVvdGUoXG4gICAgICAgIHByb3BOYW1lXG4gICAgICApfSBvd24gcHJvcGVydHkgbXVzdCBiZSBhIHN0cmluZzogJHt2YWx1ZX1gO1xuICAgIH1cbiAgICBjYXNlIFwiY2F1c2VcIjoge1xuICAgICAgcmV0dXJuIGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yKHZhbHVlLCBwYXNzU3R5bGVPZlJlY3VyLCBjaGVjayk7XG4gICAgfVxuICAgIGNhc2UgXCJlcnJvcnNcIjoge1xuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSB8fCBwYXNzU3R5bGVPZlJlY3VyKHZhbHVlKSAhPT0gXCJjb3B5QXJyYXlcIikge1xuICAgICAgICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgUGFzc2FibGUgRXJyb3IgJHtxdW90ZShcbiAgICAgICAgICBwcm9wTmFtZVxuICAgICAgICApfSBvd24gcHJvcGVydHkgbXVzdCBiZSBhIGNvcHlBcnJheTogJHt2YWx1ZX1gO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZhbHVlLmV2ZXJ5KFxuICAgICAgICAoZXJyKSA9PiAoXG4gICAgICAgICAgLy9cbiAgICAgICAgICBjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvcihlcnIsIHBhc3NTdHlsZU9mUmVjdXIsIGNoZWNrKVxuICAgICAgICApXG4gICAgICApO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuICEhY2hlY2sgJiYgQ1goY2hlY2spYFBhc3NhYmxlIEVycm9yIGhhcyBleHRyYSB1bnBhc3NlZCBwcm9wZXJ0eSAke3F1b3RlKHByb3BOYW1lKX1gO1xufTtcbmhhcmRlbihjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvclByb3BlcnR5RGVzYyk7XG52YXIgY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3IgPSAoY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyLCBjaGVjayA9IHZvaWQgMCkgPT4ge1xuICBpZiAoIWNoZWNrRXJyb3JMaWtlKGNhbmRpZGF0ZSwgY2hlY2spKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IHByb3RvID0gZ2V0UHJvdG90eXBlT2Y1KGNhbmRpZGF0ZSk7XG4gIGNvbnN0IHsgbmFtZSB9ID0gcHJvdG87XG4gIGNvbnN0IGVyckNvbnN0cnVjdG9yID0gZ2V0RXJyb3JDb25zdHJ1Y3RvcihuYW1lKTtcbiAgaWYgKGVyckNvbnN0cnVjdG9yID09PSB2b2lkIDAgfHwgZXJyQ29uc3RydWN0b3IucHJvdG90eXBlICE9PSBwcm90bykge1xuICAgIHJldHVybiAhIWNoZWNrICYmIENYKFxuICAgICAgY2hlY2tcbiAgICApYFBhc3NhYmxlIEVycm9yIG11c3QgaW5oZXJpdCBmcm9tIGFuIGVycm9yIGNsYXNzIC5wcm90b3R5cGU6ICR7Y2FuZGlkYXRlfWA7XG4gIH1cbiAgY29uc3QgZGVzY3MgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzMyhjYW5kaWRhdGUpO1xuICBpZiAoIShcIm1lc3NhZ2VcIiBpbiBkZXNjcykpIHtcbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChcbiAgICAgIGNoZWNrXG4gICAgKWBQYXNzYWJsZSBFcnJvciBtdXN0IGhhdmUgYW4gb3duIFwibWVzc2FnZVwiIHN0cmluZyBwcm9wZXJ0eTogJHtjYW5kaWRhdGV9YDtcbiAgfVxuICByZXR1cm4gZW50cmllczIoZGVzY3MpLmV2ZXJ5KFxuICAgIChbcHJvcE5hbWUsIGRlc2NdKSA9PiBjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvclByb3BlcnR5RGVzYyhcbiAgICAgIHByb3BOYW1lLFxuICAgICAgZGVzYyxcbiAgICAgIHBhc3NTdHlsZU9mUmVjdXIsXG4gICAgICBjaGVja1xuICAgIClcbiAgKTtcbn07XG5oYXJkZW4oY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3IpO1xudmFyIEVycm9ySGVscGVyID0gaGFyZGVuKHtcbiAgc3R5bGVOYW1lOiBcImVycm9yXCIsXG4gIGNhbkJlVmFsaWQ6IGNoZWNrRXJyb3JMaWtlLFxuICBhc3NlcnRSZXN0VmFsaWQ6IChjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIpID0+IGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yKGNhbmRpZGF0ZSwgcGFzc1N0eWxlT2ZSZWN1ciwgYXNzZXJ0Q2hlY2tlcilcbn0pO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czMgfSA9IFJlZmxlY3Q7XG52YXIgd2VsbEtub3duU3ltYm9sTmFtZXMgPSBuZXcgTWFwKFxuICBvd25LZXlzMyhTeW1ib2wpLmZpbHRlcihcbiAgICAobmFtZSkgPT4gdHlwZW9mIG5hbWUgPT09IFwic3RyaW5nXCIgJiYgdHlwZW9mIFN5bWJvbFtuYW1lXSA9PT0gXCJzeW1ib2xcIlxuICApLmZpbHRlcigobmFtZSkgPT4ge1xuICAgICFuYW1lLnN0YXJ0c1dpdGgoXCJAQFwiKSB8fCB0aHJvd1JlZGFjdGVkYERpZCBub3QgZXhwZWN0IFN5bWJvbCB0byBoYXZlIGEgc3ltYm9sLXZhbHVlZCBwcm9wZXJ0eSBuYW1lIHN0YXJ0aW5nIHdpdGggXCJAQFwiICR7cXVvdGUoXG4gICAgICBuYW1lXG4gICAgKX1gO1xuICAgIHJldHVybiB0cnVlO1xuICB9KS5tYXAoKG5hbWUpID0+IFtTeW1ib2xbbmFtZV0sIGBAQCR7bmFtZX1gXSlcbik7XG52YXIgaXNQYXNzYWJsZVN5bWJvbCA9IChzeW0pID0+IHR5cGVvZiBzeW0gPT09IFwic3ltYm9sXCIgJiYgKHR5cGVvZiBTeW1ib2wua2V5Rm9yKHN5bSkgPT09IFwic3RyaW5nXCIgfHwgd2VsbEtub3duU3ltYm9sTmFtZXMuaGFzKHN5bSkpO1xuaGFyZGVuKGlzUGFzc2FibGVTeW1ib2wpO1xudmFyIGFzc2VydFBhc3NhYmxlU3ltYm9sID0gKHN5bSkgPT4gaXNQYXNzYWJsZVN5bWJvbChzeW0pIHx8IHRocm93UmVkYWN0ZWRgT25seSByZWdpc3RlcmVkIHN5bWJvbHMgb3Igd2VsbC1rbm93biBzeW1ib2xzIGFyZSBwYXNzYWJsZTogJHtxdW90ZShzeW0pfWA7XG5oYXJkZW4oYXNzZXJ0UGFzc2FibGVTeW1ib2wpO1xudmFyIG5hbWVGb3JQYXNzYWJsZVN5bWJvbCA9IChzeW0pID0+IHtcbiAgY29uc3QgbmFtZSA9IFN5bWJvbC5rZXlGb3Ioc3ltKTtcbiAgaWYgKG5hbWUgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiB3ZWxsS25vd25TeW1ib2xOYW1lcy5nZXQoc3ltKTtcbiAgfVxuICBpZiAobmFtZS5zdGFydHNXaXRoKFwiQEBcIikpIHtcbiAgICByZXR1cm4gYEBAJHtuYW1lfWA7XG4gIH1cbiAgcmV0dXJuIG5hbWU7XG59O1xuaGFyZGVuKG5hbWVGb3JQYXNzYWJsZVN5bWJvbCk7XG52YXIgQXRBdFByZWZpeFBhdHRlcm4gPSAvXkBAKC4qKSQvO1xuaGFyZGVuKEF0QXRQcmVmaXhQYXR0ZXJuKTtcbnZhciBwYXNzYWJsZVN5bWJvbEZvck5hbWUgPSAobmFtZSkgPT4ge1xuICB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUobmFtZSl9IG11c3QgYmUgYSBzdHJpbmcsIG5vdCAke3F1b3RlKHR5cGVvZiBuYW1lKX1gO1xuICBjb25zdCBtYXRjaCA9IEF0QXRQcmVmaXhQYXR0ZXJuLmV4ZWMobmFtZSk7XG4gIGlmIChtYXRjaCkge1xuICAgIGNvbnN0IHN1ZmZpeCA9IG1hdGNoWzFdO1xuICAgIGlmIChzdWZmaXguc3RhcnRzV2l0aChcIkBAXCIpKSB7XG4gICAgICByZXR1cm4gU3ltYm9sLmZvcihzdWZmaXgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBzeW0gPSBTeW1ib2xbc3VmZml4XTtcbiAgICAgIGlmICh0eXBlb2Ygc3ltID09PSBcInN5bWJvbFwiKSB7XG4gICAgICAgIHJldHVybiBzeW07XG4gICAgICB9XG4gICAgICB0aHJvd1JlZGFjdGVkYFJlc2VydmVkIGZvciB3ZWxsIGtub3duIHN5bWJvbCAke3F1b3RlKHN1ZmZpeCl9OiAke3F1b3RlKG5hbWUpfWA7XG4gICAgfVxuICB9XG4gIHJldHVybiBTeW1ib2wuZm9yKG5hbWUpO1xufTtcbmhhcmRlbihwYXNzYWJsZVN5bWJvbEZvck5hbWUpO1xuXG4vL1xudmFyIGhhc1dlbGxGb3JtZWRTdHJpbmdNZXRob2QgPSAhIVN0cmluZy5wcm90b3R5cGUuaXNXZWxsRm9ybWVkO1xudmFyIGlzV2VsbEZvcm1lZFN0cmluZyA9IGhhc1dlbGxGb3JtZWRTdHJpbmdNZXRob2QgPyAoc3RyKSA9PiB0eXBlb2Ygc3RyID09PSBcInN0cmluZ1wiICYmIHN0ci5pc1dlbGxGb3JtZWQoKSA6IChzdHIpID0+IHtcbiAgaWYgKHR5cGVvZiBzdHIgIT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZm9yIChjb25zdCBjaCBvZiBzdHIpIHtcbiAgICBjb25zdCBjcCA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgY2guY29kZVBvaW50QXQoMClcbiAgICApO1xuICAgIGlmIChjcCA+PSA1NTI5NiAmJiBjcCA8PSA1NzM0Mykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5oYXJkZW4oaXNXZWxsRm9ybWVkU3RyaW5nKTtcbnZhciBhc3NlcnRXZWxsRm9ybWVkU3RyaW5nID0gKHN0cikgPT4ge1xuICBpc1dlbGxGb3JtZWRTdHJpbmcoc3RyKSB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkIHdlbGwtZm9ybWVkIHVuaWNvZGUgc3RyaW5nOiAke3N0cn1gO1xufTtcbmhhcmRlbihhc3NlcnRXZWxsRm9ybWVkU3RyaW5nKTtcbnZhciBPTkxZX1dFTExfRk9STUVEX1NUUklOR1NfUEFTU0FCTEUgPSBnZXRFbnZpcm9ubWVudE9wdGlvbihcIk9OTFlfV0VMTF9GT1JNRURfU1RSSU5HU19QQVNTQUJMRVwiLCBcImRpc2FibGVkXCIsIFtcbiAgXCJlbmFibGVkXCJcbl0pID09PSBcImVuYWJsZWRcIjtcbnZhciBhc3NlcnRQYXNzYWJsZVN0cmluZyA9IChzdHIpID0+IHtcbiAgdHlwZW9mIHN0ciA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkIHN0cmluZyAke3N0cn1gO1xuICAhT05MWV9XRUxMX0ZPUk1FRF9TVFJJTkdTX1BBU1NBQkxFIHx8IGFzc2VydFdlbGxGb3JtZWRTdHJpbmcoc3RyKTtcbn07XG5oYXJkZW4oYXNzZXJ0UGFzc2FibGVTdHJpbmcpO1xuXG4vL1xudmFyIG1ha2VSZWxlYXNpbmdFeGVjdXRvcktpdCA9ICgpID0+IHtcbiAgbGV0IGludGVybmFsUmVzb2x2ZTtcbiAgbGV0IGludGVybmFsUmVqZWN0O1xuICBjb25zdCByZXNvbHZlMiA9ICh2YWx1ZSkgPT4ge1xuICAgIGlmIChpbnRlcm5hbFJlc29sdmUpIHtcbiAgICAgIGludGVybmFsUmVzb2x2ZSh2YWx1ZSk7XG4gICAgICBpbnRlcm5hbFJlc29sdmUgPSBudWxsO1xuICAgICAgaW50ZXJuYWxSZWplY3QgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBhc3NlcnQoaW50ZXJuYWxSZXNvbHZlID09PSBudWxsKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHJlamVjdCA9IChyZWFzb24pID0+IHtcbiAgICBpZiAoaW50ZXJuYWxSZWplY3QpIHtcbiAgICAgIGludGVybmFsUmVqZWN0KHJlYXNvbik7XG4gICAgICBpbnRlcm5hbFJlc29sdmUgPSBudWxsO1xuICAgICAgaW50ZXJuYWxSZWplY3QgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBhc3NlcnQoaW50ZXJuYWxSZWplY3QgPT09IG51bGwpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgZXhlY3V0b3IgPSAocmVzLCByZWopID0+IHtcbiAgICBhc3NlcnQoaW50ZXJuYWxSZXNvbHZlID09PSB2b2lkIDAgJiYgaW50ZXJuYWxSZWplY3QgPT09IHZvaWQgMCk7XG4gICAgaW50ZXJuYWxSZXNvbHZlID0gcmVzO1xuICAgIGludGVybmFsUmVqZWN0ID0gcmVqO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHsgcmVzb2x2ZTogcmVzb2x2ZTIsIHJlamVjdCwgZXhlY3V0b3IgfSk7XG59O1xuaGFyZGVuKG1ha2VSZWxlYXNpbmdFeGVjdXRvcktpdCk7XG5cbi8vXG52YXIgaXNQcmltaXRpdmUzID0gKHZhbCkgPT4gIXZhbCB8fCB0eXBlb2YgdmFsICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiB2YWwgIT09IFwiZnVuY3Rpb25cIjtcbnZhciBrbm93blByb21pc2VzID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG52YXIgbWFya1NldHRsZWQgPSAocmVjb3JkKSA9PiB7XG4gIGlmICghcmVjb3JkIHx8IHJlY29yZC5zZXR0bGVkKSB7XG4gICAgcmV0dXJuIC8qICAgICAgICAgICAqLyBuZXcgU2V0KCk7XG4gIH1cbiAgY29uc3QgeyBkZWZlcnJlZHMgfSA9IHJlY29yZDtcbiAgT2JqZWN0LmFzc2lnbihyZWNvcmQsIHtcbiAgICBkZWZlcnJlZHM6IHZvaWQgMCxcbiAgICBzZXR0bGVkOiB0cnVlXG4gIH0pO1xuICBPYmplY3QuZnJlZXplKHJlY29yZCk7XG4gIHJldHVybiBkZWZlcnJlZHM7XG59O1xudmFyIGdldE1lbW9SZWNvcmQgPSAodmFsdWUpID0+IHtcbiAgaWYgKGlzUHJpbWl0aXZlMyh2YWx1ZSkpIHtcbiAgICByZXR1cm4gaGFyZGVuKHsgc2V0dGxlZDogdHJ1ZSB9KTtcbiAgfVxuICBsZXQgcmVjb3JkID0ga25vd25Qcm9taXNlcy5nZXQodmFsdWUpO1xuICBpZiAoIXJlY29yZCkge1xuICAgIHJlY29yZCA9IHsgZGVmZXJyZWRzOiAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpLCBzZXR0bGVkOiBmYWxzZSB9O1xuICAgIGtub3duUHJvbWlzZXMuc2V0KHZhbHVlLCByZWNvcmQpO1xuICAgIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihcbiAgICAgICh2YWwpID0+IHtcbiAgICAgICAgZm9yIChjb25zdCB7IHJlc29sdmU6IHJlc29sdmUyIH0gb2YgbWFya1NldHRsZWQocmVjb3JkKSkge1xuICAgICAgICAgIHJlc29sdmUyKHZhbCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAoZXJyKSA9PiB7XG4gICAgICAgIGZvciAoY29uc3QgeyByZWplY3QgfSBvZiBtYXJrU2V0dGxlZChyZWNvcmQpKSB7XG4gICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICB9XG4gIHJldHVybiByZWNvcmQ7XG59O1xudmFyIHsgcmFjZSB9ID0ge1xuICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICovXG4gIHJhY2UodmFsdWVzOCkge1xuICAgIGxldCBkZWZlcnJlZDtcbiAgICBjb25zdCBjYWNoZWRWYWx1ZXMgPSBbXTtcbiAgICBjb25zdCBDID0gdGhpcztcbiAgICBjb25zdCByZXN1bHQgPSBuZXcgQygocmVzb2x2ZTIsIHJlamVjdCkgPT4ge1xuICAgICAgZGVmZXJyZWQgPSB7IHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QgfTtcbiAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgdmFsdWVzOCkge1xuICAgICAgICBjYWNoZWRWYWx1ZXMucHVzaCh2YWx1ZSk7XG4gICAgICAgIGNvbnN0IHsgc2V0dGxlZCwgZGVmZXJyZWRzIH0gPSBnZXRNZW1vUmVjb3JkKHZhbHVlKTtcbiAgICAgICAgaWYgKHNldHRsZWQpIHtcbiAgICAgICAgICBDLnJlc29sdmUodmFsdWUpLnRoZW4ocmVzb2x2ZTIsIHJlamVjdCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGVmZXJyZWRzLmFkZChkZWZlcnJlZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0LmZpbmFsbHkoKCkgPT4ge1xuICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiBjYWNoZWRWYWx1ZXMpIHtcbiAgICAgICAgY29uc3QgeyBkZWZlcnJlZHMgfSA9IGdldE1lbW9SZWNvcmQodmFsdWUpO1xuICAgICAgICBpZiAoZGVmZXJyZWRzKSB7XG4gICAgICAgICAgZGVmZXJyZWRzLmRlbGV0ZShkZWZlcnJlZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufTtcblxuLy9cbmZ1bmN0aW9uIGlzUHJvbWlzZShtYXliZVByb21pc2UpIHtcbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShtYXliZVByb21pc2UpID09PSBtYXliZVByb21pc2U7XG59XG5oYXJkZW4oaXNQcm9taXNlKTtcblxuLy9cbnZhciBCZXN0UGlwZWxpbmFibGVQcm9taXNlID0gZ2xvYmFsVGhpcy5IYW5kbGVkUHJvbWlzZSB8fCBQcm9taXNlO1xuZnVuY3Rpb24gbWFrZVByb21pc2VLaXQoKSB7XG4gIGNvbnN0IHsgcmVzb2x2ZTogcmVzb2x2ZTIsIHJlamVjdCwgZXhlY3V0b3IgfSA9IG1ha2VSZWxlYXNpbmdFeGVjdXRvcktpdCgpO1xuICBjb25zdCBwcm9taXNlID0gbmV3IEJlc3RQaXBlbGluYWJsZVByb21pc2UoZXhlY3V0b3IpO1xuICByZXR1cm4gaGFyZGVuKHsgcHJvbWlzZSwgcmVzb2x2ZTogcmVzb2x2ZTIsIHJlamVjdCB9KTtcbn1cbmhhcmRlbihtYWtlUHJvbWlzZUtpdCk7XG5mdW5jdGlvbiByYWNlUHJvbWlzZXModmFsdWVzOCkge1xuICByZXR1cm4gaGFyZGVuKHJhY2UuY2FsbChCZXN0UGlwZWxpbmFibGVQcm9taXNlLCB2YWx1ZXM4KSk7XG59XG5oYXJkZW4ocmFjZVByb21pc2VzKTtcblxuLy9cbnZhciB7IGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjYgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IG93bktleXM0IH0gPSBSZWZsZWN0O1xudmFyIHsgaXNBcnJheTogaXNBcnJheTMsIHByb3RvdHlwZTogYXJyYXlQcm90b3R5cGUgfSA9IEFycmF5O1xudmFyIENvcHlBcnJheUhlbHBlciA9IGhhcmRlbih7XG4gIHN0eWxlTmFtZTogXCJjb3B5QXJyYXlcIixcbiAgY2FuQmVWYWxpZDogKGNhbmRpZGF0ZSwgY2hlY2sgPSB2b2lkIDApID0+IGlzQXJyYXkzKGNhbmRpZGF0ZSkgfHwgISFjaGVjayAmJiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQXJyYXkgZXhwZWN0ZWQ6ICR7Y2FuZGlkYXRlfWApLFxuICBhc3NlcnRSZXN0VmFsaWQ6IChjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIpID0+IHtcbiAgICBnZXRQcm90b3R5cGVPZjYoY2FuZGlkYXRlKSA9PT0gYXJyYXlQcm90b3R5cGUgfHwgYXNzZXJ0LmZhaWwocmVkYWN0ZWRgTWFsZm9ybWVkIGFycmF5OiAke2NhbmRpZGF0ZX1gLCBUeXBlRXJyb3IpO1xuICAgIGNvbnN0IGxlbiA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgZ2V0T3duRGF0YURlc2NyaXB0b3IoY2FuZGlkYXRlLCBcImxlbmd0aFwiLCBmYWxzZSwgYXNzZXJ0Q2hlY2tlcikudmFsdWVcbiAgICApO1xuICAgIGZvciAobGV0IGkzID0gMDsgaTMgPCBsZW47IGkzICs9IDEpIHtcbiAgICAgIHBhc3NTdHlsZU9mUmVjdXIoXG4gICAgICAgIGdldE93bkRhdGFEZXNjcmlwdG9yKGNhbmRpZGF0ZSwgaTMsIHRydWUsIGFzc2VydENoZWNrZXIpLnZhbHVlXG4gICAgICApO1xuICAgIH1cbiAgICBvd25LZXlzNChjYW5kaWRhdGUpLmxlbmd0aCA9PT0gbGVuICsgMSB8fCBhc3NlcnQuZmFpbChyZWRhY3RlZGBBcnJheXMgbXVzdCBub3QgaGF2ZSBub24taW5kZXhlczogJHtjYW5kaWRhdGV9YCwgVHlwZUVycm9yKTtcbiAgfVxufSk7XG5cbi8vXG52YXIgeyBnZXRQcm90b3R5cGVPZjogZ2V0UHJvdG90eXBlT2Y3LCBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6IGdldE93blByb3BlcnR5RGVzY3JpcHRvcjIgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IG93bktleXM1LCBhcHBseTogYXBwbHk0IH0gPSBSZWZsZWN0O1xudmFyIGFkYXB0SW1tdXRhYmxlQXJyYXlCdWZmZXIgPSAoKSA9PiB7XG4gIGNvbnN0IGFuQXJyYXlCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoMCk7XG4gIGlmIChhbkFycmF5QnVmZmVyLnNsaWNlVG9JbW11dGFibGUgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiB7XG4gICAgICBpbW11dGFibGVBcnJheUJ1ZmZlclByb3RvdHlwZTogbnVsbCxcbiAgICAgIGltbXV0YWJsZUdldHRlcjogKCkgPT4gZmFsc2VcbiAgICB9O1xuICB9XG4gIGNvbnN0IGFuSW1tdXRhYmxlQXJyYXlCdWZmZXIgPSBhbkFycmF5QnVmZmVyLnNsaWNlVG9JbW11dGFibGUoKTtcbiAgY29uc3QgaW1tdXRhYmxlQXJyYXlCdWZmZXJQcm90b3R5cGUyID0gZ2V0UHJvdG90eXBlT2Y3KGFuSW1tdXRhYmxlQXJyYXlCdWZmZXIpO1xuICBjb25zdCBpbW11dGFibGVHZXR0ZXIyID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIC8vXG4gICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMihpbW11dGFibGVBcnJheUJ1ZmZlclByb3RvdHlwZTIsIFwiaW1tdXRhYmxlXCIpLmdldFxuICApO1xuICByZXR1cm4geyBpbW11dGFibGVBcnJheUJ1ZmZlclByb3RvdHlwZTogaW1tdXRhYmxlQXJyYXlCdWZmZXJQcm90b3R5cGUyLCBpbW11dGFibGVHZXR0ZXI6IGltbXV0YWJsZUdldHRlcjIgfTtcbn07XG52YXIgeyBpbW11dGFibGVBcnJheUJ1ZmZlclByb3RvdHlwZSwgaW1tdXRhYmxlR2V0dGVyIH0gPSBhZGFwdEltbXV0YWJsZUFycmF5QnVmZmVyKCk7XG52YXIgQnl0ZUFycmF5SGVscGVyID0gaGFyZGVuKHtcbiAgc3R5bGVOYW1lOiBcImJ5dGVBcnJheVwiLFxuICBjYW5CZVZhbGlkOiAoY2FuZGlkYXRlLCBjaGVjayA9IHZvaWQgMCkgPT4gY2FuZGlkYXRlIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIgJiYgLy9cbiAgY2FuZGlkYXRlLmltbXV0YWJsZSB8fCAhIWNoZWNrICYmIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBJbW11dGFibGUgQXJyYXlCdWZmZXIgZXhwZWN0ZWQ6ICR7Y2FuZGlkYXRlfWApLFxuICBhc3NlcnRSZXN0VmFsaWQ6IChjYW5kaWRhdGUsIF9wYXNzU3R5bGVPZlJlY3VyKSA9PiB7XG4gICAgZ2V0UHJvdG90eXBlT2Y3KGNhbmRpZGF0ZSkgPT09IGltbXV0YWJsZUFycmF5QnVmZmVyUHJvdG90eXBlIHx8IGFzc2VydC5mYWlsKHJlZGFjdGVkYE1hbGZvcm1lZCBCeXRlQXJyYXkgJHtjYW5kaWRhdGV9YCwgVHlwZUVycm9yKTtcbiAgICBhcHBseTQoaW1tdXRhYmxlR2V0dGVyLCBjYW5kaWRhdGUsIFtdKSB8fCB0aHJvd1JlZGFjdGVkYE11c3QgYmUgYW4gaW1tdXRhYmxlIEFycmF5QnVmZmVyOiAke2NhbmRpZGF0ZX1gO1xuICAgIG93bktleXM1KGNhbmRpZGF0ZSkubGVuZ3RoID09PSAwIHx8IGFzc2VydC5mYWlsKFxuICAgICAgcmVkYWN0ZWRgQnl0ZUFycmF5cyBtdXN0IG5vdCBoYXZlIG93biBwcm9wZXJ0aWVzOiAke2NhbmRpZGF0ZX1gLFxuICAgICAgVHlwZUVycm9yXG4gICAgKTtcbiAgfVxufSk7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzNiB9ID0gUmVmbGVjdDtcbnZhciB7IGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjgsIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlNCB9ID0gT2JqZWN0O1xudmFyIGNoZWNrT2JqZWN0UHJvdG90eXBlID0gKGNhbmRpZGF0ZSwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgcmV0dXJuIGdldFByb3RvdHlwZU9mOChjYW5kaWRhdGUpID09PSBvYmplY3RQcm90b3R5cGU0IHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYFJlY29yZHMgbXVzdCBpbmhlcml0IGZyb20gT2JqZWN0LnByb3RvdHlwZTogJHtjYW5kaWRhdGV9YDtcbn07XG52YXIgY2hlY2tQcm9wZXJ0eUNhbkJlVmFsaWQgPSAoY2FuZGlkYXRlLCBrZXksIHZhbHVlLCBjaGVjayA9IHZvaWQgMCkgPT4ge1xuICByZXR1cm4gKHR5cGVvZiBrZXkgPT09IFwic3RyaW5nXCIgfHwgISFjaGVjayAmJiBDWChcbiAgICBjaGVja1xuICApYFJlY29yZHMgY2FuIG9ubHkgaGF2ZSBzdHJpbmctbmFtZWQgcHJvcGVydGllczogJHtjYW5kaWRhdGV9YCkgJiYgKCFjYW5CZU1ldGhvZCh2YWx1ZSkgfHwgISFjaGVjayAmJiAvL1xuICBDWChcbiAgICBjaGVja1xuICApYFJlY29yZHMgY2Fubm90IGNvbnRhaW4gbm9uLWZhciBmdW5jdGlvbnMgYmVjYXVzZSB0aGV5IG1heSBiZSBtZXRob2RzIG9mIGFuIGltcGxpY2l0IFJlbW90YWJsZTogJHtjYW5kaWRhdGV9YCk7XG59O1xudmFyIENvcHlSZWNvcmRIZWxwZXIgPSBoYXJkZW4oe1xuICBzdHlsZU5hbWU6IFwiY29weVJlY29yZFwiLFxuICBjYW5CZVZhbGlkOiAoY2FuZGlkYXRlLCBjaGVjayA9IHZvaWQgMCkgPT4ge1xuICAgIHJldHVybiBjaGVja09iamVjdFByb3RvdHlwZShjYW5kaWRhdGUsIGNoZWNrKSAmJiAvL1xuICAgIC8vXG4gICAgb3duS2V5czYoY2FuZGlkYXRlKS5ldmVyeShcbiAgICAgIChrZXkpID0+IGNoZWNrUHJvcGVydHlDYW5CZVZhbGlkKGNhbmRpZGF0ZSwga2V5LCBjYW5kaWRhdGVba2V5XSwgY2hlY2spXG4gICAgKTtcbiAgfSxcbiAgYXNzZXJ0UmVzdFZhbGlkOiAoY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyKSA9PiB7XG4gICAgZm9yIChjb25zdCBuYW1lIG9mIG93bktleXM2KGNhbmRpZGF0ZSkpIHtcbiAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IGdldE93bkRhdGFEZXNjcmlwdG9yKFxuICAgICAgICBjYW5kaWRhdGUsXG4gICAgICAgIG5hbWUsXG4gICAgICAgIHRydWUsXG4gICAgICAgIGFzc2VydENoZWNrZXJcbiAgICAgICk7XG4gICAgICBwYXNzU3R5bGVPZlJlY3VyKHZhbHVlKTtcbiAgICB9XG4gIH1cbn0pO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czcgfSA9IFJlZmxlY3Q7XG52YXIgeyBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNCB9ID0gT2JqZWN0O1xudmFyIFRhZ2dlZEhlbHBlciA9IGhhcmRlbih7XG4gIHN0eWxlTmFtZTogXCJ0YWdnZWRcIixcbiAgY2FuQmVWYWxpZDogKGNhbmRpZGF0ZSwgY2hlY2sgPSB2b2lkIDApID0+IGNoZWNrUGFzc1N0eWxlKGNhbmRpZGF0ZSwgY2FuZGlkYXRlW1BBU1NfU1RZTEVdLCBcInRhZ2dlZFwiLCBjaGVjayksXG4gIGFzc2VydFJlc3RWYWxpZDogKGNhbmRpZGF0ZSwgcGFzc1N0eWxlT2ZSZWN1cikgPT4ge1xuICAgIGNoZWNrVGFnUmVjb3JkKGNhbmRpZGF0ZSwgXCJ0YWdnZWRcIiwgYXNzZXJ0Q2hlY2tlcik7XG4gICAgY29uc3QgcGFzc1N0eWxlS2V5ID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgUEFTU19TVFlMRVxuICAgICk7XG4gICAgY29uc3QgdGFnS2V5ID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgU3ltYm9sLnRvU3RyaW5nVGFnXG4gICAgKTtcbiAgICBjb25zdCB7XG4gICAgICAvL1xuICAgICAgW1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgcGFzc1N0eWxlS2V5XG4gICAgICBdOiBfcGFzc1N0eWxlRGVzYyxcbiAgICAgIFtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgIHRhZ0tleVxuICAgICAgXTogX2xhYmVsRGVzYyxcbiAgICAgIHBheWxvYWQ6IF9wYXlsb2FkRGVzYyxcbiAgICAgIC8vXG4gICAgICAuLi5yZXN0RGVzY3NcbiAgICB9ID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczQoY2FuZGlkYXRlKTtcbiAgICBvd25LZXlzNyhyZXN0RGVzY3MpLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgcHJvcGVydGllcyBvbiB0YWdnZWQgcmVjb3JkICR7b3duS2V5czcocmVzdERlc2NzKX1gO1xuICAgIHBhc3NTdHlsZU9mUmVjdXIoXG4gICAgICBnZXRPd25EYXRhRGVzY3JpcHRvcihjYW5kaWRhdGUsIFwicGF5bG9hZFwiLCB0cnVlLCBhc3NlcnRDaGVja2VyKS52YWx1ZVxuICAgICk7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHsgaXNGcm96ZW46IGlzRnJvemVuNCwgZ2V0UHJvdG90eXBlT2Y6IGdldFByb3RvdHlwZU9mOSwgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IzLCBoYXNPd246IGhhc093bjUgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IG93bktleXM4IH0gPSBSZWZsZWN0O1xudmFyIHsgdG9TdHJpbmdUYWcgfSA9IFN5bWJvbDtcbnZhciBjaGVja1Byb21pc2VPd25LZXlzID0gKHByLCBjaGVjaykgPT4ge1xuICBjb25zdCBrZXlzOCA9IG93bktleXM4KHByKTtcbiAgaWYgKGtleXM4Lmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IHVua25vd25LZXlzID0ga2V5czguZmlsdGVyKFxuICAgIChrZXkpID0+IHR5cGVvZiBrZXkgIT09IFwic3ltYm9sXCIgfHwgIWhhc093bjUoUHJvbWlzZS5wcm90b3R5cGUsIGtleSlcbiAgKTtcbiAgaWYgKHVua25vd25LZXlzLmxlbmd0aCAhPT0gMCkge1xuICAgIHJldHVybiBDWChcbiAgICAgIGNoZWNrXG4gICAgKWAke3ByfSAtIE11c3Qgbm90IGhhdmUgYW55IG93biBwcm9wZXJ0aWVzOiAke3F1b3RlKHVua25vd25LZXlzKX1gO1xuICB9XG4gIGNvbnN0IGNoZWNrU2FmZU93bktleSA9IChrZXkpID0+IHtcbiAgICBpZiAoa2V5ID09PSB0b1N0cmluZ1RhZykge1xuICAgICAgY29uc3QgdGFnRGVzYyA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcjMocHIsIHRvU3RyaW5nVGFnKTtcbiAgICAgIGFzc2VydCh0YWdEZXNjICE9PSB2b2lkIDApO1xuICAgICAgcmV0dXJuIChoYXNPd241KHRhZ0Rlc2MsIFwidmFsdWVcIikgfHwgQ1goXG4gICAgICAgIGNoZWNrXG4gICAgICApYE93biBAQHRvU3RyaW5nVGFnIG11c3QgYmUgYSBkYXRhIHByb3BlcnR5LCBub3QgYW4gYWNjZXNzb3I6ICR7cXVvdGUodGFnRGVzYyl9YCkgJiYgKHR5cGVvZiB0YWdEZXNjLnZhbHVlID09PSBcInN0cmluZ1wiIHx8IENYKFxuICAgICAgICBjaGVja1xuICAgICAgKWBPd24gQEB0b1N0cmluZ1RhZyB2YWx1ZSBtdXN0IGJlIGEgc3RyaW5nOiAke3F1b3RlKHRhZ0Rlc2MudmFsdWUpfWApICYmICghdGFnRGVzYy5lbnVtZXJhYmxlIHx8IENYKGNoZWNrKWBPd24gQEB0b1N0cmluZ1RhZyBtdXN0IG5vdCBiZSBlbnVtZXJhYmxlOiAke3F1b3RlKHRhZ0Rlc2MpfWApO1xuICAgIH1cbiAgICBjb25zdCB2YWwgPSBwcltrZXldO1xuICAgIGlmICh2YWwgPT09IHZvaWQgMCB8fCB0eXBlb2YgdmFsID09PSBcIm51bWJlclwiKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiB2YWwgPT09IFwib2JqZWN0XCIgJiYgdmFsICE9PSBudWxsICYmIGlzRnJvemVuNCh2YWwpICYmIGdldFByb3RvdHlwZU9mOSh2YWwpID09PSBPYmplY3QucHJvdG90eXBlKSB7XG4gICAgICBjb25zdCBzdWJLZXlzID0gb3duS2V5czgodmFsKTtcbiAgICAgIGlmIChzdWJLZXlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChzdWJLZXlzLmxlbmd0aCA9PT0gMSAmJiBzdWJLZXlzWzBdID09PSBcImRlc3Ryb3llZFwiICYmIHZhbC5kZXN0cm95ZWQgPT09IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gQ1goXG4gICAgICBjaGVja1xuICAgIClgVW5leHBlY3RlZCBOb2RlIGFzeW5jX2hvb2tzIGFkZGl0aW9ucyB0byBwcm9taXNlOiAke3ByfS4ke3F1b3RlKFxuICAgICAgU3RyaW5nKGtleSlcbiAgICApfSBpcyAke3ZhbH1gO1xuICB9O1xuICByZXR1cm4ga2V5czguZXZlcnkoY2hlY2tTYWZlT3duS2V5KTtcbn07XG52YXIgY2hlY2tTYWZlUHJvbWlzZSA9IChwciwgY2hlY2spID0+IHtcbiAgcmV0dXJuIChpc0Zyb3plbjQocHIpIHx8IENYKGNoZWNrKWAke3ByfSAtIE11c3QgYmUgZnJvemVuYCkgJiYgKGlzUHJvbWlzZShwcikgfHwgQ1goY2hlY2spYCR7cHJ9IC0gTXVzdCBiZSBhIHByb21pc2VgKSAmJiAoZ2V0UHJvdG90eXBlT2Y5KHByKSA9PT0gUHJvbWlzZS5wcm90b3R5cGUgfHwgQ1goY2hlY2spYCR7cHJ9IC0gTXVzdCBpbmhlcml0IGZyb20gUHJvbWlzZS5wcm90b3R5cGU6ICR7cXVvdGUoXG4gICAgZ2V0UHJvdG90eXBlT2Y5KHByKVxuICApfWApICYmIGNoZWNrUHJvbWlzZU93bktleXMoXG4gICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgIHByLFxuICAgIGNoZWNrXG4gICk7XG59O1xuaGFyZGVuKGNoZWNrU2FmZVByb21pc2UpO1xudmFyIGlzU2FmZVByb21pc2UgPSAocHIpID0+IGNoZWNrU2FmZVByb21pc2UocHIsICh4KSA9PiB4KTtcbmhhcmRlbihpc1NhZmVQcm9taXNlKTtcbnZhciBhc3NlcnRTYWZlUHJvbWlzZSA9IChwcikgPT4gY2hlY2tTYWZlUHJvbWlzZShwciwgYXNzZXJ0Q2hlY2tlcik7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzOSB9ID0gUmVmbGVjdDtcbnZhciB7IGlzRnJvemVuOiBpc0Zyb3plbjUsIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM6IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM1LCB2YWx1ZXMgfSA9IE9iamVjdDtcbnZhciBtYWtlSGVscGVyVGFibGUgPSAocGFzc1N0eWxlSGVscGVycykgPT4ge1xuICBjb25zdCBIZWxwZXJUYWJsZSA9IHtcbiAgICBfX3Byb3RvX186IG51bGwsXG4gICAgY29weUFycmF5OiB2b2lkIDAsXG4gICAgYnl0ZUFycmF5OiB2b2lkIDAsXG4gICAgY29weVJlY29yZDogdm9pZCAwLFxuICAgIHRhZ2dlZDogdm9pZCAwLFxuICAgIGVycm9yOiB2b2lkIDAsXG4gICAgcmVtb3RhYmxlOiB2b2lkIDBcbiAgfTtcbiAgZm9yIChjb25zdCBoZWxwZXIgb2YgcGFzc1N0eWxlSGVscGVycykge1xuICAgIGNvbnN0IHsgc3R5bGVOYW1lIH0gPSBoZWxwZXI7XG4gICAgc3R5bGVOYW1lIGluIEhlbHBlclRhYmxlIHx8IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIGhlbHBlcjogJHtxdW90ZShzdHlsZU5hbWUpfWA7XG4gICAgSGVscGVyVGFibGVbc3R5bGVOYW1lXSA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgY29uZmxpY3RpbmcgaGVscGVycyBmb3IgJHtxdW90ZShzdHlsZU5hbWUpfWA7XG4gICAgSGVscGVyVGFibGVbc3R5bGVOYW1lXSA9IGhlbHBlcjtcbiAgfVxuICBmb3IgKGNvbnN0IHN0eWxlTmFtZSBvZiBvd25LZXlzOShIZWxwZXJUYWJsZSkpIHtcbiAgICBIZWxwZXJUYWJsZVtzdHlsZU5hbWVdICE9PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBtaXNzaW5nIGhlbHBlciBmb3IgJHtxdW90ZShzdHlsZU5hbWUpfWA7XG4gIH1cbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgIGhhcmRlbihIZWxwZXJUYWJsZSlcbiAgKTtcbn07XG52YXIgYXNzZXJ0VmFsaWQgPSAoaGVscGVyLCBjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIpID0+IHtcbiAgaGVscGVyLmNhbkJlVmFsaWQoY2FuZGlkYXRlLCBhc3NlcnRDaGVja2VyKTtcbiAgaGVscGVyLmFzc2VydFJlc3RWYWxpZChjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIpO1xufTtcbnZhciBtYWtlUGFzc1N0eWxlT2YgPSAocGFzc1N0eWxlSGVscGVycykgPT4ge1xuICBjb25zdCBIZWxwZXJUYWJsZSA9IG1ha2VIZWxwZXJUYWJsZShwYXNzU3R5bGVIZWxwZXJzKTtcbiAgY29uc3QgcmVtb3RhYmxlSGVscGVyID0gSGVscGVyVGFibGUucmVtb3RhYmxlO1xuICBjb25zdCBwYXNzU3R5bGVNZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IHBhc3NTdHlsZU9mMiA9IChwYXNzYWJsZSkgPT4ge1xuICAgIGNvbnN0IGluUHJvZ3Jlc3MgPSAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICAgIGNvbnN0IHBhc3NTdHlsZU9mUmVjdXIgPSAoaW5uZXIpID0+IHtcbiAgICAgIGNvbnN0IGlubmVySXNPYmplY3QgPSAhaXNQcmltaXRpdmUyKGlubmVyKTtcbiAgICAgIGlmIChpbm5lcklzT2JqZWN0KSB7XG4gICAgICAgIGNvbnN0IGlubmVyU3R5bGUgPSBwYXNzU3R5bGVNZW1vLmdldChpbm5lcik7XG4gICAgICAgIGlmIChpbm5lclN0eWxlKSB7XG4gICAgICAgICAgcmV0dXJuIGlubmVyU3R5bGU7XG4gICAgICAgIH1cbiAgICAgICAgIWluUHJvZ3Jlc3MuaGFzKGlubmVyKSB8fCB0aHJvd1JlZGFjdGVkYFBhc3MtYnktY29weSBkYXRhIGNhbm5vdCBiZSBjeWNsaWMgJHtpbm5lcn1gO1xuICAgICAgICBpblByb2dyZXNzLmFkZChpbm5lcik7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZkludGVybmFsKGlubmVyKTtcbiAgICAgIGlmIChpbm5lcklzT2JqZWN0KSB7XG4gICAgICAgIHBhc3NTdHlsZU1lbW8uc2V0KGlubmVyLCBwYXNzU3R5bGUpO1xuICAgICAgICBpblByb2dyZXNzLmRlbGV0ZShpbm5lcik7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGFzc1N0eWxlO1xuICAgIH07XG4gICAgY29uc3QgcGFzc1N0eWxlT2ZJbnRlcm5hbCA9IChpbm5lcikgPT4ge1xuICAgICAgY29uc3QgdHlwZXN0ciA9IHR5cGVvZiBpbm5lcjtcbiAgICAgIHN3aXRjaCAodHlwZXN0cikge1xuICAgICAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgICAgIGNhc2UgXCJib29sZWFuXCI6XG4gICAgICAgIGNhc2UgXCJudW1iZXJcIjpcbiAgICAgICAgY2FzZSBcImJpZ2ludFwiOiB7XG4gICAgICAgICAgcmV0dXJuIHR5cGVzdHI7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgICAgYXNzZXJ0UGFzc2FibGVTdHJpbmcoaW5uZXIpO1xuICAgICAgICAgIHJldHVybiBcInN0cmluZ1wiO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgICAgIGFzc2VydFBhc3NhYmxlU3ltYm9sKGlubmVyKTtcbiAgICAgICAgICByZXR1cm4gXCJzeW1ib2xcIjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwib2JqZWN0XCI6IHtcbiAgICAgICAgICBpZiAoaW5uZXIgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBcIm51bGxcIjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFpc0Zyb3plbjUoaW5uZXIpKSB7XG4gICAgICAgICAgICBhc3NlcnQuZmFpbChcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgaXNUeXBlZEFycmF5KGlubmVyKSA/IHJlZGFjdGVkYENhbm5vdCBwYXNzIG11dGFibGUgdHlwZWQgYXJyYXlzIGxpa2UgJHtpbm5lcn0uYCA6IHJlZGFjdGVkYENhbm5vdCBwYXNzIG5vbi1mcm96ZW4gb2JqZWN0cyBsaWtlICR7aW5uZXJ9LiBVc2UgaGFyZGVuKClgXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaXNQcm9taXNlKGlubmVyKSkge1xuICAgICAgICAgICAgYXNzZXJ0U2FmZVByb21pc2UoaW5uZXIpO1xuICAgICAgICAgICAgcmV0dXJuIFwicHJvbWlzZVwiO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0eXBlb2YgaW5uZXIudGhlbiAhPT0gXCJmdW5jdGlvblwiIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHBhc3Mgbm9uLXByb21pc2UgdGhlbmFibGVzYDtcbiAgICAgICAgICBjb25zdCBwYXNzU3R5bGVUYWcgPSBpbm5lcltQQVNTX1NUWUxFXTtcbiAgICAgICAgICBpZiAocGFzc1N0eWxlVGFnICE9PSB2b2lkIDApIHtcbiAgICAgICAgICAgIGFzc2VydC50eXBlb2YocGFzc1N0eWxlVGFnLCBcInN0cmluZ1wiKTtcbiAgICAgICAgICAgIGNvbnN0IGhlbHBlciA9IEhlbHBlclRhYmxlW3Bhc3NTdHlsZVRhZ107XG4gICAgICAgICAgICBoZWxwZXIgIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYFVucmVjb2duaXplZCBQYXNzU3R5bGU6ICR7cXVvdGUocGFzc1N0eWxlVGFnKX1gO1xuICAgICAgICAgICAgYXNzZXJ0VmFsaWQoaGVscGVyLCBpbm5lciwgcGFzc1N0eWxlT2ZSZWN1cik7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgcGFzc1N0eWxlVGFnXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3IgKGNvbnN0IGhlbHBlciBvZiBwYXNzU3R5bGVIZWxwZXJzKSB7XG4gICAgICAgICAgICBpZiAoaGVscGVyLmNhbkJlVmFsaWQoaW5uZXIpKSB7XG4gICAgICAgICAgICAgIGhlbHBlci5hc3NlcnRSZXN0VmFsaWQoaW5uZXIsIHBhc3NTdHlsZU9mUmVjdXIpO1xuICAgICAgICAgICAgICByZXR1cm4gaGVscGVyLnN0eWxlTmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgYXNzZXJ0VmFsaWQocmVtb3RhYmxlSGVscGVyLCBpbm5lciwgcGFzc1N0eWxlT2ZSZWN1cik7XG4gICAgICAgICAgcmV0dXJuIFwicmVtb3RhYmxlXCI7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImZ1bmN0aW9uXCI6IHtcbiAgICAgICAgICBpc0Zyb3plbjUoaW5uZXIpIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHBhc3Mgbm9uLWZyb3plbiBvYmplY3RzIGxpa2UgJHtpbm5lcn0uIFVzZSBoYXJkZW4oKWA7XG4gICAgICAgICAgdHlwZW9mIGlubmVyLnRoZW4gIT09IFwiZnVuY3Rpb25cIiB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCBwYXNzIG5vbi1wcm9taXNlIHRoZW5hYmxlc2A7XG4gICAgICAgICAgYXNzZXJ0VmFsaWQocmVtb3RhYmxlSGVscGVyLCBpbm5lciwgcGFzc1N0eWxlT2ZSZWN1cik7XG4gICAgICAgICAgcmV0dXJuIFwicmVtb3RhYmxlXCI7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRocm93IGFzc2VydC5mYWlsKHJlZGFjdGVkYFVucmVjb2duaXplZCB0eXBlb2YgJHtxdW90ZSh0eXBlc3RyKX1gLCBUeXBlRXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gcGFzc1N0eWxlT2ZSZWN1cihwYXNzYWJsZSk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4ocGFzc1N0eWxlT2YyKTtcbn07XG52YXIgUGFzc1N0eWxlT2ZFbmRvd21lbnRTeW1ib2wgPSBTeW1ib2wuZm9yKFwiQGVuZG8gcGFzc1N0eWxlT2ZcIik7XG52YXIgcGFzc1N0eWxlT2YgPSBnbG9iYWxUaGlzICYmIGdsb2JhbFRoaXNbUGFzc1N0eWxlT2ZFbmRvd21lbnRTeW1ib2xdIHx8IG1ha2VQYXNzU3R5bGVPZihbXG4gIENvcHlBcnJheUhlbHBlcixcbiAgQnl0ZUFycmF5SGVscGVyLFxuICBDb3B5UmVjb3JkSGVscGVyLFxuICBUYWdnZWRIZWxwZXIsXG4gIEVycm9ySGVscGVyLFxuICBSZW1vdGFibGVIZWxwZXJcbl0pO1xudmFyIGFzc2VydFBhc3NhYmxlID0gKHZhbCkgPT4ge1xuICBwYXNzU3R5bGVPZih2YWwpO1xufTtcbmhhcmRlbihhc3NlcnRQYXNzYWJsZSk7XG52YXIgaXNQYXNzYWJsZSA9IChzcGVjaW1lbikgPT4ge1xuICB0cnkge1xuICAgIHJldHVybiBwYXNzU3R5bGVPZihzcGVjaW1lbikgIT09IHZvaWQgMDtcbiAgfSBjYXRjaCAoXykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcbmhhcmRlbihpc1Bhc3NhYmxlKTtcbnZhciBpc1Bhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MgPSAobmFtZSwgZGVzYykgPT4gY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MobmFtZSwgZGVzYywgcGFzc1N0eWxlT2YpO1xudmFyIHRvUGFzc2FibGVFcnJvciA9IChlcnIpID0+IHtcbiAgaGFyZGVuKGVycik7XG4gIGlmIChjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvcihlcnIsIHBhc3NTdHlsZU9mKSkge1xuICAgIHJldHVybiBlcnI7XG4gIH1cbiAgY29uc3QgeyBuYW1lLCBtZXNzYWdlIH0gPSBlcnI7XG4gIGNvbnN0IHsgY2F1c2U6IGNhdXNlRGVzYywgZXJyb3JzOiBlcnJvcnNEZXNjIH0gPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNShlcnIpO1xuICBsZXQgY2F1c2U7XG4gIGxldCBlcnJvcnM7XG4gIGlmIChjYXVzZURlc2MgJiYgaXNQYXNzYWJsZUVycm9yUHJvcGVydHlEZXNjKFwiY2F1c2VcIiwgY2F1c2VEZXNjKSkge1xuICAgIGNhdXNlID0gY2F1c2VEZXNjLnZhbHVlO1xuICB9XG4gIGlmIChlcnJvcnNEZXNjICYmIGlzUGFzc2FibGVFcnJvclByb3BlcnR5RGVzYyhcImVycm9yc1wiLCBlcnJvcnNEZXNjKSkge1xuICAgIGVycm9ycyA9IGVycm9yc0Rlc2MudmFsdWU7XG4gIH1cbiAgY29uc3QgZXJyQ29uc3RydWN0b3IgPSBnZXRFcnJvckNvbnN0cnVjdG9yKGAke25hbWV9YCkgfHwgRXJyb3I7XG4gIGNvbnN0IG5ld0Vycm9yID0gbWFrZUVycm9yKGAke21lc3NhZ2V9YCwgZXJyQ29uc3RydWN0b3IsIHtcbiAgICAvL1xuICAgIGNhdXNlLFxuICAgIGVycm9yc1xuICB9KTtcbiAgaGFyZGVuKG5ld0Vycm9yKTtcbiAgbm90ZShuZXdFcnJvciwgcmVkYWN0ZWRgY29waWVkIGZyb20gZXJyb3IgJHtlcnJ9YCk7XG4gIHBhc3NTdHlsZU9mKG5ld0Vycm9yKSA9PT0gXCJlcnJvclwiIHx8IHRocm93UmVkYWN0ZWRgRXhwZWN0ZWQgJHtuZXdFcnJvcn0gdG8gYmUgYSBwYXNzYWJsZSBlcnJvcmA7XG4gIHJldHVybiBuZXdFcnJvcjtcbn07XG5oYXJkZW4odG9QYXNzYWJsZUVycm9yKTtcbnZhciB0b1Rocm93YWJsZSA9IChzcGVjaW1lbikgPT4ge1xuICBoYXJkZW4oc3BlY2ltZW4pO1xuICBpZiAoaXNFcnJvckxpa2Uoc3BlY2ltZW4pKSB7XG4gICAgcmV0dXJuIHRvUGFzc2FibGVFcnJvcihcbiAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICBzcGVjaW1lblxuICAgICk7XG4gIH1cbiAgaWYgKCFpc1ByaW1pdGl2ZTIoc3BlY2ltZW4pKSB7XG4gICAgY29uc3QgcGFzc1N0eWxlID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICBwYXNzU3R5bGVPZihzcGVjaW1lbilcbiAgICApO1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgc3BlY2ltZW5cbiAgICAgICAgKTtcbiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7XG4gICAgICAgICAgZWxlbWVudCA9PT0gdG9UaHJvd2FibGUoZWxlbWVudCkgfHwgdGhyb3dSZWRhY3RlZGBuZXN0ZWQgdG9UaHJvd2FibGUgY29lcmNpb24gbm90IHlldCBzdXBwb3J0ZWQgJHtlbGVtZW50fWA7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGNvbnN0IHJlYyA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgc3BlY2ltZW5cbiAgICAgICAgKTtcbiAgICAgICAgZm9yIChjb25zdCB2YWwgb2YgdmFsdWVzKHJlYykpIHtcbiAgICAgICAgICB2YWwgPT09IHRvVGhyb3dhYmxlKHZhbCkgfHwgdGhyb3dSZWRhY3RlZGBuZXN0ZWQgdG9UaHJvd2FibGUgY29lcmNpb24gbm90IHlldCBzdXBwb3J0ZWQgJHt2YWx9YDtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICBjb25zdCB0ZyA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgc3BlY2ltZW5cbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgeyBwYXlsb2FkIH0gPSB0ZztcbiAgICAgICAgcGF5bG9hZCA9PT0gdG9UaHJvd2FibGUocGF5bG9hZCkgfHwgdGhyb3dSZWRhY3RlZGBuZXN0ZWQgdG9UaHJvd2FibGUgY29lcmNpb24gbm90IHlldCBzdXBwb3J0ZWQgJHtwYXlsb2FkfWA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgY29uc3QgZXIgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBzcGVjaW1lblxuICAgICAgICApO1xuICAgICAgICBlciA9PT0gdG9UaHJvd2FibGUoZXIpIHx8IHRocm93UmVkYWN0ZWRgbmVzdGVkIHRvVGhyb3dhYmxlIGNvZXJjaW9uIG5vdCB5ZXQgc3VwcG9ydGVkICR7ZXJ9YDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgQSAke3F1b3RlKHBhc3NTdHlsZSl9IGlzIG5vdCB0aHJvd2FibGU6ICR7c3BlY2ltZW59YDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBzcGVjaW1lblxuICApO1xufTtcbmhhcmRlbih0b1Rocm93YWJsZSk7XG5cbi8vXG52YXIgeyBjcmVhdGU6IGNyZWF0ZTIsIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlNSB9ID0gT2JqZWN0O1xudmFyIG1ha2VUYWdnZWQgPSAodGFnLCBwYXlsb2FkKSA9PiB7XG4gIHR5cGVvZiB0YWcgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBUaGUgdGFnIG9mIGEgdGFnZ2VkIHJlY29yZCBtdXN0IGJlIGEgc3RyaW5nOiAke3RhZ31gO1xuICBhc3NlcnRQYXNzYWJsZShoYXJkZW4ocGF5bG9hZCkpO1xuICByZXR1cm4gaGFyZGVuKFxuICAgIGNyZWF0ZTIob2JqZWN0UHJvdG90eXBlNSwge1xuICAgICAgW1BBU1NfU1RZTEVdOiB7IHZhbHVlOiBcInRhZ2dlZFwiIH0sXG4gICAgICBbU3ltYm9sLnRvU3RyaW5nVGFnXTogeyB2YWx1ZTogdGFnIH0sXG4gICAgICBwYXlsb2FkOiB7IHZhbHVlOiBwYXlsb2FkLCBlbnVtZXJhYmxlOiB0cnVlIH1cbiAgICB9KVxuICApO1xufTtcbmhhcmRlbihtYWtlVGFnZ2VkKTtcblxuLy9cbnZhciBpZGVudENoZWNrZXIgPSAoY29uZCwgX2RldGFpbHMpID0+IGNvbmQ7XG5oYXJkZW4oaWRlbnRDaGVja2VyKTtcblxuLy9cbnZhciBpc0NvcHlBcnJheSA9IChhcnIpID0+IHBhc3NTdHlsZU9mKGFycikgPT09IFwiY29weUFycmF5XCI7XG5oYXJkZW4oaXNDb3B5QXJyYXkpO1xudmFyIGlzQnl0ZUFycmF5ID0gKGFycikgPT4gcGFzc1N0eWxlT2YoYXJyKSA9PT0gXCJieXRlQXJyYXlcIjtcbmhhcmRlbihpc0J5dGVBcnJheSk7XG52YXIgaXNSZWNvcmQgPSAocmVjb3JkKSA9PiBwYXNzU3R5bGVPZihyZWNvcmQpID09PSBcImNvcHlSZWNvcmRcIjtcbmhhcmRlbihpc1JlY29yZCk7XG52YXIgaXNSZW1vdGFibGUgPSAocmVtb3RhYmxlKSA9PiBwYXNzU3R5bGVPZihyZW1vdGFibGUpID09PSBcInJlbW90YWJsZVwiO1xuaGFyZGVuKGlzUmVtb3RhYmxlKTtcbnZhciBhc3NlcnRDb3B5QXJyYXkgPSAoYXJyLCBvcHROYW1lT2ZBcnJheSA9IFwiQWxsZWdlZCBhcnJheVwiKSA9PiB7XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKGFycik7XG4gIHBhc3NTdHlsZSA9PT0gXCJjb3B5QXJyYXlcIiB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUob3B0TmFtZU9mQXJyYXkpfSAke2Fycn0gbXVzdCBiZSBhIHBhc3MtYnktY29weSBhcnJheSwgbm90ICR7cXVvdGUoXG4gICAgcGFzc1N0eWxlXG4gICl9YDtcbn07XG5oYXJkZW4oYXNzZXJ0Q29weUFycmF5KTtcbnZhciBhc3NlcnRCeXRlQXJyYXkgPSAoYXJyLCBvcHROYW1lT2ZBcnJheSA9IFwiQWxsZWdlZCBieXRlQXJyYXlcIikgPT4ge1xuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihhcnIpO1xuICBwYXNzU3R5bGUgPT09IFwiYnl0ZUFycmF5XCIgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKFxuICAgIG9wdE5hbWVPZkFycmF5XG4gICl9ICR7YXJyfSBtdXN0IGJlIGEgcGFzcy1ieS1jb3B5IGJpbmFyeSBkYXRhLCBub3QgJHtxdW90ZShwYXNzU3R5bGUpfWA7XG59O1xuaGFyZGVuKGFzc2VydEJ5dGVBcnJheSk7XG52YXIgYXNzZXJ0UmVjb3JkID0gKHJlY29yZCwgb3B0TmFtZU9mUmVjb3JkID0gXCJBbGxlZ2VkIHJlY29yZFwiKSA9PiB7XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHJlY29yZCk7XG4gIHBhc3NTdHlsZSA9PT0gXCJjb3B5UmVjb3JkXCIgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKG9wdE5hbWVPZlJlY29yZCl9ICR7cmVjb3JkfSBtdXN0IGJlIGEgcGFzcy1ieS1jb3B5IHJlY29yZCwgbm90ICR7cXVvdGUoXG4gICAgcGFzc1N0eWxlXG4gICl9YDtcbn07XG5oYXJkZW4oYXNzZXJ0UmVjb3JkKTtcbnZhciBhc3NlcnRSZW1vdGFibGUgPSAocmVtb3RhYmxlLCBvcHROYW1lT2ZSZW1vdGFibGUgPSBcIkFsbGVnZWQgcmVtb3RhYmxlXCIpID0+IHtcbiAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocmVtb3RhYmxlKTtcbiAgcGFzc1N0eWxlID09PSBcInJlbW90YWJsZVwiIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShvcHROYW1lT2ZSZW1vdGFibGUpfSAke3JlbW90YWJsZX0gbXVzdCBiZSBhIHJlbW90YWJsZSwgbm90ICR7cXVvdGUoXG4gICAgcGFzc1N0eWxlXG4gICl9YDtcbn07XG5oYXJkZW4oYXNzZXJ0UmVtb3RhYmxlKTtcbnZhciBjaGVja0F0b20gPSAodmFsLCBjaGVjaykgPT4ge1xuICBsZXQgcGFzc1N0eWxlO1xuICB0cnkge1xuICAgIHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHZhbCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiBjaGVjayAhPT0gaWRlbnRDaGVja2VyICYmIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBOb3QgZXZlbiBQYXNzYWJsZTogJHtxdW90ZShlcnIpfTogJHt2YWx9YCk7XG4gIH1cbiAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgY2FzZSBcIm51bGxcIjpcbiAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgIGNhc2UgXCJudW1iZXJcIjpcbiAgICBjYXNlIFwiYmlnaW50XCI6XG4gICAgY2FzZSBcInN0cmluZ1wiOlxuICAgIGNhc2UgXCJieXRlQXJyYXlcIjpcbiAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICByZXR1cm4gY2hlY2sgIT09IGlkZW50Q2hlY2tlciAmJiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSAke3F1b3RlKHBhc3NTdHlsZSl9IGNhbm5vdCBiZSBhbiBhdG9tOiAke3ZhbH1gKTtcbiAgICB9XG4gIH1cbn07XG52YXIgaXNBdG9tID0gKHZhbCkgPT4gY2hlY2tBdG9tKHZhbCwgaWRlbnRDaGVja2VyKTtcbmhhcmRlbihpc0F0b20pO1xudmFyIGFzc2VydEF0b20gPSAodmFsKSA9PiB7XG4gIGNoZWNrQXRvbSh2YWwsIGFzc2VydENoZWNrZXIpO1xufTtcbmhhcmRlbihhc3NlcnRBdG9tKTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXMxMCB9ID0gUmVmbGVjdDtcbnZhciB7IGZyb21FbnRyaWVzIH0gPSBPYmplY3Q7XG52YXIgZGVlcGx5RnVsZmlsbGVkID0gYXN5bmMgKHZhbCkgPT4ge1xuICBpZiAoaXNBdG9tKHZhbCkpIHtcbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgdmFsXG4gICAgKTtcbiAgfVxuICBpZiAoaXNQcm9taXNlKHZhbCkpIHtcbiAgICByZXR1cm4gRS53aGVuKHZhbCwgKG5vbnApID0+IGRlZXBseUZ1bGZpbGxlZChub25wKSk7XG4gIH1cbiAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YodmFsKTtcbiAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICBjb25zdCByZWMgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApO1xuICAgICAgY29uc3QgbmFtZXMgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG93bktleXMxMChyZWMpXG4gICAgICApO1xuICAgICAgY29uc3QgdmFsUHMgPSBuYW1lcy5tYXAoKG5hbWUpID0+IGRlZXBseUZ1bGZpbGxlZChyZWNbbmFtZV0pKTtcbiAgICAgIHJldHVybiBFLndoZW4oXG4gICAgICAgIFByb21pc2UuYWxsKHZhbFBzKSxcbiAgICAgICAgKHZhbHMpID0+IGhhcmRlbihmcm9tRW50cmllcyh2YWxzLm1hcCgoYzIsIGkzKSA9PiBbbmFtZXNbaTNdLCBjMl0pKSlcbiAgICAgICk7XG4gICAgfVxuICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgY29uc3QgYXJyID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApO1xuICAgICAgY29uc3QgdmFsUHMgPSBhcnIubWFwKChwNCkgPT4gZGVlcGx5RnVsZmlsbGVkKHA0KSk7XG4gICAgICByZXR1cm4gRS53aGVuKFByb21pc2UuYWxsKHZhbFBzKSwgKHZhbHMpID0+IGhhcmRlbih2YWxzKSk7XG4gICAgfVxuICAgIGNhc2UgXCJieXRlQXJyYXlcIjoge1xuICAgICAgY29uc3QgYnl0ZUFycmF5ID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB2YWxcbiAgICAgICk7XG4gICAgICByZXR1cm4gYnl0ZUFycmF5O1xuICAgIH1cbiAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgIGNvbnN0IHRnZCA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB2YWxcbiAgICAgICk7XG4gICAgICBjb25zdCB0YWcgPSBnZXRUYWcodGdkKTtcbiAgICAgIHJldHVybiBFLndoZW4oXG4gICAgICAgIGRlZXBseUZ1bGZpbGxlZCh0Z2QucGF5bG9hZCksXG4gICAgICAgIChwYXlsb2FkKSA9PiBtYWtlVGFnZ2VkKHRhZywgcGF5bG9hZClcbiAgICAgICk7XG4gICAgfVxuICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgY29uc3QgcmVtID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApO1xuICAgICAgcmV0dXJuIHJlbTtcbiAgICB9XG4gICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgIGNvbnN0IGVyciA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApO1xuICAgICAgcmV0dXJuIGVycjtcbiAgICB9XG4gICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgY29uc3QgcHJvbSA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZhbFxuICAgICAgKTtcbiAgICAgIHJldHVybiBFLndoZW4ocHJvbSwgKG5vbnApID0+IGRlZXBseUZ1bGZpbGxlZChub25wKSk7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHRocm93IGFzc2VydC5mYWlsKHJlZGFjdGVkYFVuZXhwZWN0ZWQgcGFzc1N0eWxlICR7cXVvdGUocGFzc1N0eWxlKX1gLCBUeXBlRXJyb3IpO1xuICAgIH1cbiAgfVxufTtcbmhhcmRlbihkZWVwbHlGdWxmaWxsZWQpO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czExIH0gPSBSZWZsZWN0O1xudmFyIHsgaXNBcnJheTogaXNBcnJheTQgfSA9IEFycmF5O1xudmFyIHtcbiAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczYsXG4gIGRlZmluZVByb3BlcnRpZXMsXG4gIGlzLFxuICBlbnRyaWVzOiBlbnRyaWVzMyxcbiAgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMixcbiAgZnJlZXplOiBmcmVlemU1LFxuICBoYXNPd246IGhhc093bjZcbn0gPSBPYmplY3Q7XG52YXIgUUNMQVNTID0gXCJAcWNsYXNzXCI7XG52YXIgaGFzUUNsYXNzID0gKGVuY29kZWQpID0+IGhhc093bjYoZW5jb2RlZCwgUUNMQVNTKTtcbnZhciBxY2xhc3NNYXRjaGVzID0gKGVuY29kZWQsIHFjbGFzcykgPT4gIWlzUHJpbWl0aXZlMihlbmNvZGVkKSAmJiAhaXNBcnJheTQoZW5jb2RlZCkgJiYgaGFzUUNsYXNzKGVuY29kZWQpICYmIGVuY29kZWRbUUNMQVNTXSA9PT0gcWNsYXNzO1xudmFyIGRvbnRFbmNvZGVSZW1vdGFibGVUb0NhcERhdGEgPSAocmVtKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke3JlbX1gO1xudmFyIGRvbnRFbmNvZGVQcm9taXNlVG9DYXBEYXRhID0gKHByb20pID0+IHRocm93UmVkYWN0ZWRgcHJvbWlzZSB1bmV4cGVjdGVkOiAke3Byb219YDtcbnZhciBkb250RW5jb2RlRXJyb3JUb0NhcERhdGEgPSAoZXJyKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIG9iamVjdCB1bmV4cGVjdGVkOiAke2Vycn1gO1xudmFyIG1ha2VFbmNvZGVUb0NhcERhdGEgPSAoZW5jb2RlT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBlbmNvZGVSZW1vdGFibGVUb0NhcERhdGEgPSBkb250RW5jb2RlUmVtb3RhYmxlVG9DYXBEYXRhLFxuICAgIGVuY29kZVByb21pc2VUb0NhcERhdGEgPSBkb250RW5jb2RlUHJvbWlzZVRvQ2FwRGF0YSxcbiAgICBlbmNvZGVFcnJvclRvQ2FwRGF0YSA9IGRvbnRFbmNvZGVFcnJvclRvQ2FwRGF0YVxuICB9ID0gZW5jb2RlT3B0aW9ucztcbiAgY29uc3QgZW5jb2RlVG9DYXBEYXRhUmVjdXIgPSAocGFzc2FibGUpID0+IHtcbiAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihwYXNzYWJsZSk7XG4gICAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICAgIGNhc2UgXCJudWxsXCI6XG4gICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgIHJldHVybiBwYXNzYWJsZTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjoge1xuICAgICAgICByZXR1cm4geyBbUUNMQVNTXTogXCJ1bmRlZmluZWRcIiB9O1xuICAgICAgfVxuICAgICAgY2FzZSBcIm51bWJlclwiOiB7XG4gICAgICAgIGlmIChOdW1iZXIuaXNOYU4ocGFzc2FibGUpKSB7XG4gICAgICAgICAgcmV0dXJuIHsgW1FDTEFTU106IFwiTmFOXCIgfTtcbiAgICAgICAgfSBlbHNlIGlmIChwYXNzYWJsZSA9PT0gSW5maW5pdHkpIHtcbiAgICAgICAgICByZXR1cm4geyBbUUNMQVNTXTogXCJJbmZpbml0eVwiIH07XG4gICAgICAgIH0gZWxzZSBpZiAocGFzc2FibGUgPT09IC1JbmZpbml0eSkge1xuICAgICAgICAgIHJldHVybiB7IFtRQ0xBU1NdOiBcIi1JbmZpbml0eVwiIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzKHBhc3NhYmxlLCAtMCkgPyAwIDogcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBbUUNMQVNTXTogXCJiaWdpbnRcIixcbiAgICAgICAgICBkaWdpdHM6IFN0cmluZyhwYXNzYWJsZSlcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgICBhc3NlcnRQYXNzYWJsZVN5bWJvbChwYXNzYWJsZSk7XG4gICAgICAgIGNvbnN0IG5hbWUgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgbmFtZUZvclBhc3NhYmxlU3ltYm9sKHBhc3NhYmxlKVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIFtRQ0xBU1NdOiBcInN5bWJvbFwiLFxuICAgICAgICAgIG5hbWVcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgaWYgKGhhc093bjYocGFzc2FibGUsIFFDTEFTUykpIHtcbiAgICAgICAgICBjb25zdCB7IFtRQ0xBU1NdOiBxY2xhc3NWYWx1ZSwgLi4ucmVzdCB9ID0gcGFzc2FibGU7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgICAgICAgW1FDTEFTU106IFwiaGlsYmVydFwiLFxuICAgICAgICAgICAgb3JpZ2luYWw6IGVuY29kZVRvQ2FwRGF0YVJlY3VyKHFjbGFzc1ZhbHVlKVxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYgKG93bktleXMxMShyZXN0KS5sZW5ndGggPj0gMSkge1xuICAgICAgICAgICAgcmVzdWx0LnJlc3QgPSBlbmNvZGVUb0NhcERhdGFSZWN1cihmcmVlemU1KHJlc3QpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuYW1lcyA9IG93bktleXMxMShwYXNzYWJsZSkuc29ydCgpO1xuICAgICAgICByZXR1cm4gZnJvbUVudHJpZXMyKFxuICAgICAgICAgIG5hbWVzLm1hcCgobmFtZSkgPT4gW25hbWUsIGVuY29kZVRvQ2FwRGF0YVJlY3VyKHBhc3NhYmxlW25hbWVdKV0pXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgcmV0dXJuIHBhc3NhYmxlLm1hcChlbmNvZGVUb0NhcERhdGFSZWN1cik7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYnl0ZUFycmF5XCI6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBtYXJzYWwgb2YgYnl0ZUFycmF5IG5vdCB5ZXQgaW1wbGVtZW50ZWQ6ICR7cGFzc2FibGV9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIFtRQ0xBU1NdOiBcInRhZ2dlZFwiLFxuICAgICAgICAgIHRhZzogZ2V0VGFnKHBhc3NhYmxlKSxcbiAgICAgICAgICBwYXlsb2FkOiBlbmNvZGVUb0NhcERhdGFSZWN1cihwYXNzYWJsZS5wYXlsb2FkKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVSZW1vdGFibGVUb0NhcERhdGEoXG4gICAgICAgICAgcGFzc2FibGUsXG4gICAgICAgICAgZW5jb2RlVG9DYXBEYXRhUmVjdXJcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHFjbGFzc01hdGNoZXMoZW5jb2RlZCwgXCJzbG90XCIpKSB7XG4gICAgICAgICAgcmV0dXJuIGVuY29kZWQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogUmVtb3RhYmxlIGVuY29kaW5nIG11c3QgYmUgYW4gb2JqZWN0IHdpdGggJHtxdW90ZShcbiAgICAgICAgICBRQ0xBU1NcbiAgICAgICAgKX0gJHtxdW90ZShcInNsb3RcIil9OiAke2VuY29kZWR9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZVByb21pc2VUb0NhcERhdGEocGFzc2FibGUsIGVuY29kZVRvQ2FwRGF0YVJlY3VyKTtcbiAgICAgICAgaWYgKHFjbGFzc01hdGNoZXMoZW5jb2RlZCwgXCJzbG90XCIpKSB7XG4gICAgICAgICAgcmV0dXJuIGVuY29kZWQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogUHJvbWlzZSBlbmNvZGluZyBtdXN0IGJlIGFuIG9iamVjdCB3aXRoICR7cXVvdGUoXG4gICAgICAgICAgUUNMQVNTLFxuICAgICAgICAgIFwic2xvdFwiXG4gICAgICAgICl9OiAke2VuY29kZWR9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVFcnJvclRvQ2FwRGF0YShwYXNzYWJsZSwgZW5jb2RlVG9DYXBEYXRhUmVjdXIpO1xuICAgICAgICBpZiAocWNsYXNzTWF0Y2hlcyhlbmNvZGVkLCBcImVycm9yXCIpKSB7XG4gICAgICAgICAgcmV0dXJuIGVuY29kZWQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogRXJyb3IgZW5jb2RpbmcgbXVzdCBiZSBhbiBvYmplY3Qgd2l0aCAke3F1b3RlKFxuICAgICAgICAgIFFDTEFTUyxcbiAgICAgICAgICBcImVycm9yXCJcbiAgICAgICAgKX06ICR7ZW5jb2RlZH1gO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyBhc3NlcnQuZmFpbChcbiAgICAgICAgICByZWRhY3RlZGBpbnRlcm5hbDogVW5yZWNvZ25pemVkIHBhc3NTdHlsZSAke3F1b3RlKHBhc3NTdHlsZSl9YCxcbiAgICAgICAgICBUeXBlRXJyb3JcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IGVuY29kZVRvQ2FwRGF0YSA9IChwYXNzYWJsZSkgPT4ge1xuICAgIGlmIChpc0Vycm9yTGlrZShwYXNzYWJsZSkpIHtcbiAgICAgIHJldHVybiBoYXJkZW4oZW5jb2RlRXJyb3JUb0NhcERhdGEocGFzc2FibGUsIGVuY29kZVRvQ2FwRGF0YVJlY3VyKSk7XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oZW5jb2RlVG9DYXBEYXRhUmVjdXIocGFzc2FibGUpKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbihlbmNvZGVUb0NhcERhdGEpO1xufTtcbmhhcmRlbihtYWtlRW5jb2RlVG9DYXBEYXRhKTtcbnZhciBkb250RGVjb2RlUmVtb3RhYmxlT3JQcm9taXNlRnJvbUNhcERhdGEgPSAoc2xvdEVuY29kaW5nKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSBvciBwcm9taXNlIHVuZXhwZWN0ZWQ6ICR7c2xvdEVuY29kaW5nfWA7XG52YXIgZG9udERlY29kZUVycm9yRnJvbUNhcERhdGEgPSAoZXJyb3JFbmNvZGluZykgPT4gdGhyb3dSZWRhY3RlZGBlcnJvciB1bmV4cGVjdGVkOiAke2Vycm9yRW5jb2Rpbmd9YDtcbnZhciBtYWtlRGVjb2RlRnJvbUNhcERhdGEgPSAoZGVjb2RlT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBkZWNvZGVSZW1vdGFibGVGcm9tQ2FwRGF0YSA9IGRvbnREZWNvZGVSZW1vdGFibGVPclByb21pc2VGcm9tQ2FwRGF0YSxcbiAgICBkZWNvZGVQcm9taXNlRnJvbUNhcERhdGEgPSBkb250RGVjb2RlUmVtb3RhYmxlT3JQcm9taXNlRnJvbUNhcERhdGEsXG4gICAgZGVjb2RlRXJyb3JGcm9tQ2FwRGF0YSA9IGRvbnREZWNvZGVFcnJvckZyb21DYXBEYXRhXG4gIH0gPSBkZWNvZGVPcHRpb25zO1xuICBkZWNvZGVSZW1vdGFibGVGcm9tQ2FwRGF0YSA9PT0gZGVjb2RlUHJvbWlzZUZyb21DYXBEYXRhIHx8IHRocm93UmVkYWN0ZWRgQW4gaW1wbGVtZW50YXRpb24gcmVzdHJpY3Rpb24gZm9yIG5vdzogSWYgZWl0aGVyIGRlY29kZVJlbW90YWJsZUZyb21DYXBEYXRhIG9yIGRlY29kZVByb21pc2VGcm9tQ2FwRGF0YSBpcyBwcm92aWRlZCwgYm90aCBtdXN0IGJlIHByb3ZpZGVkIGFuZCB0aGV5IG11c3QgYmUgdGhlIHNhbWU6ICR7cXVvdGUoXG4gICAgZGVjb2RlUmVtb3RhYmxlRnJvbUNhcERhdGFcbiAgKX0gdnMgJHtxdW90ZShkZWNvZGVQcm9taXNlRnJvbUNhcERhdGEpfWA7XG4gIGNvbnN0IGRlY29kZUZyb21DYXBEYXRhID0gKGpzb25FbmNvZGVkKSA9PiB7XG4gICAgaWYgKGlzUHJpbWl0aXZlMihqc29uRW5jb2RlZCkpIHtcbiAgICAgIHJldHVybiBqc29uRW5jb2RlZDtcbiAgICB9XG4gICAgaWYgKGlzQXJyYXk0KGpzb25FbmNvZGVkKSkge1xuICAgICAgcmV0dXJuIGpzb25FbmNvZGVkLm1hcCgoZW5jb2RlZFZhbCkgPT4gZGVjb2RlRnJvbUNhcERhdGEoZW5jb2RlZFZhbCkpO1xuICAgIH0gZWxzZSBpZiAoaGFzUUNsYXNzKGpzb25FbmNvZGVkKSkge1xuICAgICAgY29uc3QgcWNsYXNzID0ganNvbkVuY29kZWRbUUNMQVNTXTtcbiAgICAgIHR5cGVvZiBxY2xhc3MgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBpbnZhbGlkICR7cXVvdGUoUUNMQVNTKX0gdHlwZW9mICR7cXVvdGUodHlwZW9mIHFjbGFzcyl9YDtcbiAgICAgIHN3aXRjaCAocWNsYXNzKSB7XG4gICAgICAgIC8vXG4gICAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjoge1xuICAgICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcIk5hTlwiOiB7XG4gICAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiSW5maW5pdHlcIjoge1xuICAgICAgICAgIHJldHVybiBJbmZpbml0eTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiLUluZmluaXR5XCI6IHtcbiAgICAgICAgICByZXR1cm4gLUluZmluaXR5O1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJiaWdpbnRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgZGlnaXRzIH0gPSBqc29uRW5jb2RlZDtcbiAgICAgICAgICB0eXBlb2YgZGlnaXRzID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgaW52YWxpZCBkaWdpdHMgdHlwZW9mICR7cXVvdGUodHlwZW9mIGRpZ2l0cyl9YDtcbiAgICAgICAgICByZXR1cm4gQmlnSW50KGRpZ2l0cyk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcIkBAYXN5bmNJdGVyYXRvclwiOiB7XG4gICAgICAgICAgcmV0dXJuIFN5bWJvbC5hc3luY0l0ZXJhdG9yO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgICAgIGNvbnN0IHsgbmFtZSB9ID0ganNvbkVuY29kZWQ7XG4gICAgICAgICAgcmV0dXJuIHBhc3NhYmxlU3ltYm9sRm9yTmFtZShuYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgICBjb25zdCB7IHRhZywgcGF5bG9hZCB9ID0ganNvbkVuY29kZWQ7XG4gICAgICAgICAgcmV0dXJuIG1ha2VUYWdnZWQodGFnLCBkZWNvZGVGcm9tQ2FwRGF0YShwYXlsb2FkKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInNsb3RcIjoge1xuICAgICAgICAgIGNvbnN0IGRlY29kZWQgPSBkZWNvZGVSZW1vdGFibGVGcm9tQ2FwRGF0YShcbiAgICAgICAgICAgIGpzb25FbmNvZGVkLFxuICAgICAgICAgICAgZGVjb2RlRnJvbUNhcERhdGFcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBkZWNvZGVkO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZUVycm9yRnJvbUNhcERhdGEoXG4gICAgICAgICAgICBqc29uRW5jb2RlZCxcbiAgICAgICAgICAgIGRlY29kZUZyb21DYXBEYXRhXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAocGFzc1N0eWxlT2YoZGVjb2RlZCkgPT09IFwiZXJyb3JcIikge1xuICAgICAgICAgICAgcmV0dXJuIGRlY29kZWQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGRlY29kZUVycm9yRnJvbUNhcERhdGEgb3B0aW9uIG11c3QgcmV0dXJuIGFuIGVycm9yOiAke2RlY29kZWR9YDtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiaGlsYmVydFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBvcmlnaW5hbCwgcmVzdCB9ID0ganNvbkVuY29kZWQ7XG4gICAgICAgICAgaGFzT3duNihqc29uRW5jb2RlZCwgXCJvcmlnaW5hbFwiKSB8fCB0aHJvd1JlZGFjdGVkYEludmFsaWQgSGlsYmVydCBIb3RlbCBlbmNvZGluZyAke2pzb25FbmNvZGVkfWA7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0geyBbUUNMQVNTXTogZGVjb2RlRnJvbUNhcERhdGEob3JpZ2luYWwpIH07XG4gICAgICAgICAgaWYgKGhhc093bjYoanNvbkVuY29kZWQsIFwicmVzdFwiKSkge1xuICAgICAgICAgICAgY29uc3QgaXNOb25FbXB0eU9iamVjdCA9IHR5cGVvZiByZXN0ID09PSBcIm9iamVjdFwiICYmIHJlc3QgIT09IG51bGwgJiYgb3duS2V5czExKHJlc3QpLmxlbmd0aCA+PSAxO1xuICAgICAgICAgICAgaWYgKCFpc05vbkVtcHR5T2JqZWN0KSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdCBlbmNvZGluZyBtdXN0IGJlIGEgbm9uLWVtcHR5IG9iamVjdDogJHtyZXN0fWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN0T2JqID0gZGVjb2RlRnJvbUNhcERhdGEocmVzdCk7XG4gICAgICAgICAgICAhaGFzT3duNihyZXN0T2JqLCBRQ0xBU1MpIHx8IHRocm93UmVkYWN0ZWRgUmVzdCBtdXN0IG5vdCBjb250YWluIGl0cyBvd24gZGVmaW5pdGlvbiBvZiAke3F1b3RlKFFDTEFTUyl9YDtcbiAgICAgICAgICAgIGRlZmluZVByb3BlcnRpZXMocmVzdWx0LCBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNihyZXN0T2JqKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgICAgY2FzZSBcImliaWRcIjoge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgVGhlIGNhcERhdGEgcHJvdG9jb2wgbm8gbG9uZ2VyIHN1cHBvcnRzICR7cXVvdGUoUUNMQVNTKX0gJHtxdW90ZShcbiAgICAgICAgICAgIHFjbGFzc1xuICAgICAgICAgICl9YDtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgICByZWRhY3RlZGB1bnJlY29nbml6ZWQgJHtxdW90ZShRQ0xBU1MpfSAke3F1b3RlKHFjbGFzcyl9YCxcbiAgICAgICAgICAgIFR5cGVFcnJvclxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgYXNzZXJ0KHR5cGVvZiBqc29uRW5jb2RlZCA9PT0gXCJvYmplY3RcIiAmJiBqc29uRW5jb2RlZCAhPT0gbnVsbCk7XG4gICAgICBjb25zdCBkZWNvZGVFbnRyeSA9IChbbmFtZSwgZW5jb2RlZFZhbF0pID0+IHtcbiAgICAgICAgdHlwZW9mIG5hbWUgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBQcm9wZXJ0eSAke3F1b3RlKG5hbWUpfSBvZiAke2pzb25FbmNvZGVkfSBtdXN0IGJlIGEgc3RyaW5nYDtcbiAgICAgICAgcmV0dXJuIFtuYW1lLCBkZWNvZGVGcm9tQ2FwRGF0YShlbmNvZGVkVmFsKV07XG4gICAgICB9O1xuICAgICAgY29uc3QgZGVjb2RlZEVudHJpZXMgPSBlbnRyaWVzMyhqc29uRW5jb2RlZCkubWFwKGRlY29kZUVudHJ5KTtcbiAgICAgIHJldHVybiBmcm9tRW50cmllczIoZGVjb2RlZEVudHJpZXMpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGhhcmRlbihkZWNvZGVGcm9tQ2FwRGF0YSk7XG59O1xuXG4vL1xuZnVuY3Rpb24gaXNOYXQoYWxsZWdlZE51bSkge1xuICBpZiAodHlwZW9mIGFsbGVnZWROdW0gPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4gYWxsZWdlZE51bSA+PSAwO1xuICB9XG4gIGlmICh0eXBlb2YgYWxsZWdlZE51bSAhPT0gXCJudW1iZXJcIikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gTnVtYmVyLmlzU2FmZUludGVnZXIoYWxsZWdlZE51bSkgJiYgYWxsZWdlZE51bSA+PSAwO1xufVxuZnVuY3Rpb24gTmF0KGFsbGVnZWROdW0pIHtcbiAgaWYgKHR5cGVvZiBhbGxlZ2VkTnVtID09PSBcImJpZ2ludFwiKSB7XG4gICAgaWYgKGFsbGVnZWROdW0gPCAwbikge1xuICAgICAgdGhyb3cgUmFuZ2VFcnJvcihgJHthbGxlZ2VkTnVtfSBpcyBuZWdhdGl2ZWApO1xuICAgIH1cbiAgICByZXR1cm4gYWxsZWdlZE51bTtcbiAgfVxuICBpZiAodHlwZW9mIGFsbGVnZWROdW0gPT09IFwibnVtYmVyXCIpIHtcbiAgICBpZiAoIU51bWJlci5pc1NhZmVJbnRlZ2VyKGFsbGVnZWROdW0pKSB7XG4gICAgICB0aHJvdyBSYW5nZUVycm9yKGAke2FsbGVnZWROdW19IGlzIG5vdCBhIHNhZmUgaW50ZWdlcmApO1xuICAgIH1cbiAgICBpZiAoYWxsZWdlZE51bSA8IDApIHtcbiAgICAgIHRocm93IFJhbmdlRXJyb3IoYCR7YWxsZWdlZE51bX0gaXMgbmVnYXRpdmVgKTtcbiAgICB9XG4gICAgcmV0dXJuIEJpZ0ludChhbGxlZ2VkTnVtKTtcbiAgfVxuICB0aHJvdyBUeXBlRXJyb3IoXG4gICAgYCR7YWxsZWdlZE51bX0gaXMgYSAke3R5cGVvZiBhbGxlZ2VkTnVtfSBidXQgbXVzdCBiZSBhIGJpZ2ludCBvciBhIG51bWJlcmBcbiAgKTtcbn1cblxuLy9cbnZhciB7IGVudHJpZXM6IGVudHJpZXM0LCBmcm9tRW50cmllczogZnJvbUVudHJpZXMzIH0gPSBPYmplY3Q7XG52YXIgb2JqZWN0TWFwID0gKG9yaWdpbmFsLCBtYXBGbikgPT4ge1xuICBjb25zdCBlbnRzID0gZW50cmllczQob3JpZ2luYWwpO1xuICBjb25zdCBtYXBFbnRzID0gZW50cy5tYXAoXG4gICAgKFtrLCB2Ml0pID0+IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgW2ssIG1hcEZuKHYyLCBrKV1cbiAgICApXG4gICk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgaGFyZGVuKGZyb21FbnRyaWVzMyhtYXBFbnRzKSlcbiAgKTtcbn07XG5oYXJkZW4ob2JqZWN0TWFwKTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXMxMiB9ID0gUmVmbGVjdDtcbnZhciB7IGlzQXJyYXk6IGlzQXJyYXk1IH0gPSBBcnJheTtcbnZhciB7IGlzOiBpczIsIGVudHJpZXM6IGVudHJpZXM1LCBmcm9tRW50cmllczogZnJvbUVudHJpZXM0LCBoYXNPd246IGhhc093bjcgfSA9IE9iamVjdDtcbnZhciBCQU5HID0gXCIhXCIuY2hhckNvZGVBdCgwKTtcbnZhciBEQVNIID0gXCItXCIuY2hhckNvZGVBdCgwKTtcbnZhciBzdGFydHNTcGVjaWFsID0gKGVuY29kZWRTdHIpID0+IHtcbiAgaWYgKGVuY29kZWRTdHIgPT09IFwiXCIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgY29kZSA9IGVuY29kZWRTdHIuY2hhckNvZGVBdCgwKTtcbiAgcmV0dXJuIEJBTkcgPD0gY29kZSAmJiBjb2RlIDw9IERBU0g7XG59O1xudmFyIGRvbnRFbmNvZGVSZW1vdGFibGVUb1NtYWxsY2FwcyA9IChyZW0pID0+IHRocm93UmVkYWN0ZWRgcmVtb3RhYmxlIHVuZXhwZWN0ZWQ6ICR7cmVtfWA7XG52YXIgZG9udEVuY29kZVByb21pc2VUb1NtYWxsY2FwcyA9IChwcm9tKSA9PiB0aHJvd1JlZGFjdGVkYHByb21pc2UgdW5leHBlY3RlZDogJHtwcm9tfWA7XG52YXIgZG9udEVuY29kZUVycm9yVG9TbWFsbGNhcHMgPSAoZXJyKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIG9iamVjdCB1bmV4cGVjdGVkOiAke3F1b3RlKGVycil9YDtcbnZhciBtYWtlRW5jb2RlVG9TbWFsbGNhcHMgPSAoZW5jb2RlT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBlbmNvZGVSZW1vdGFibGVUb1NtYWxsY2FwcyA9IGRvbnRFbmNvZGVSZW1vdGFibGVUb1NtYWxsY2FwcyxcbiAgICBlbmNvZGVQcm9taXNlVG9TbWFsbGNhcHMgPSBkb250RW5jb2RlUHJvbWlzZVRvU21hbGxjYXBzLFxuICAgIGVuY29kZUVycm9yVG9TbWFsbGNhcHMgPSBkb250RW5jb2RlRXJyb3JUb1NtYWxsY2Fwc1xuICB9ID0gZW5jb2RlT3B0aW9ucztcbiAgY29uc3QgYXNzZXJ0RW5jb2RlZEVycm9yID0gKGVuY29kaW5nKSA9PiB7XG4gICAgdHlwZW9mIGVuY29kaW5nID09PSBcIm9iamVjdFwiICYmIGhhc093bjcoZW5jb2RpbmcsIFwiI2Vycm9yXCIpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IEVycm9yIGVuY29kaW5nIG11c3QgaGF2ZSBcIiNlcnJvclwiIHByb3BlcnR5OiAke3F1b3RlKFxuICAgICAgZW5jb2RpbmdcbiAgICApfWA7XG4gICAgY29uc3QgbWVzc2FnZSA9IGVuY29kaW5nW1wiI2Vycm9yXCJdO1xuICAgIHR5cGVvZiBtZXNzYWdlID09PSBcInN0cmluZ1wiICYmICghc3RhcnRzU3BlY2lhbChtZXNzYWdlKSB8fCBtZXNzYWdlLmNoYXJBdCgwKSA9PT0gXCIhXCIpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IEVycm9yIGVuY29kaW5nIG11c3QgaGF2ZSBzdHJpbmcgbWVzc2FnZTogJHtxdW90ZShtZXNzYWdlKX1gO1xuICB9O1xuICBjb25zdCBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyID0gKHBhc3NhYmxlKSA9PiB7XG4gICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocGFzc2FibGUpO1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwibnVsbFwiOlxuICAgICAgY2FzZSBcImJvb2xlYW5cIjoge1xuICAgICAgICByZXR1cm4gcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwic3RyaW5nXCI6IHtcbiAgICAgICAgaWYgKHN0YXJ0c1NwZWNpYWwocGFzc2FibGUpKSB7XG4gICAgICAgICAgcmV0dXJuIGAhJHtwYXNzYWJsZX1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXNzYWJsZTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjoge1xuICAgICAgICByZXR1cm4gXCIjdW5kZWZpbmVkXCI7XG4gICAgICB9XG4gICAgICBjYXNlIFwibnVtYmVyXCI6IHtcbiAgICAgICAgaWYgKE51bWJlci5pc05hTihwYXNzYWJsZSkpIHtcbiAgICAgICAgICByZXR1cm4gXCIjTmFOXCI7XG4gICAgICAgIH0gZWxzZSBpZiAocGFzc2FibGUgPT09IEluZmluaXR5KSB7XG4gICAgICAgICAgcmV0dXJuIFwiI0luZmluaXR5XCI7XG4gICAgICAgIH0gZWxzZSBpZiAocGFzc2FibGUgPT09IC1JbmZpbml0eSkge1xuICAgICAgICAgIHJldHVybiBcIiMtSW5maW5pdHlcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXMyKHBhc3NhYmxlLCAtMCkgPyAwIDogcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgY29uc3Qgc3RyID0gU3RyaW5nKHBhc3NhYmxlKTtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBwYXNzYWJsZSA8IDBuID8gc3RyIDogYCske3N0cn1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgYXNzZXJ0UGFzc2FibGVTeW1ib2wocGFzc2FibGUpO1xuICAgICAgICBjb25zdCBuYW1lID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG5hbWVGb3JQYXNzYWJsZVN5bWJvbChwYXNzYWJsZSlcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIGAlJHtuYW1lfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGNvbnN0IG5hbWVzID0gb3duS2V5czEyKHBhc3NhYmxlKS5zb3J0KCk7XG4gICAgICAgIHJldHVybiBmcm9tRW50cmllczQoXG4gICAgICAgICAgbmFtZXMubWFwKChuYW1lKSA9PiBbXG4gICAgICAgICAgICBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKG5hbWUpLFxuICAgICAgICAgICAgZW5jb2RlVG9TbWFsbGNhcHNSZWN1cihwYXNzYWJsZVtuYW1lXSlcbiAgICAgICAgICBdKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIHJldHVybiBwYXNzYWJsZS5tYXAoZW5jb2RlVG9TbWFsbGNhcHNSZWN1cik7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYnl0ZUFycmF5XCI6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBtYXJzYWwgb2YgYnl0ZUFycmF5IG5vdCB5ZXQgaW1wbGVtZW50ZWQ6ICR7cGFzc2FibGV9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIFwiI3RhZ1wiOiBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKGdldFRhZyhwYXNzYWJsZSkpLFxuICAgICAgICAgIHBheWxvYWQ6IGVuY29kZVRvU21hbGxjYXBzUmVjdXIocGFzc2FibGUucGF5bG9hZClcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBlbmNvZGVSZW1vdGFibGVUb1NtYWxsY2FwcyhcbiAgICAgICAgICBwYXNzYWJsZSxcbiAgICAgICAgICBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyXG4gICAgICAgICk7XG4gICAgICAgIGlmICh0eXBlb2YgcmVzdWx0ID09PSBcInN0cmluZ1wiICYmIHJlc3VsdC5jaGFyQXQoMCkgPT09IFwiJFwiKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBSZW1vdGFibGUgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiJFwiOiAke3Jlc3VsdH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBlbmNvZGVQcm9taXNlVG9TbWFsbGNhcHMoXG4gICAgICAgICAgcGFzc2FibGUsXG4gICAgICAgICAgZW5jb2RlVG9TbWFsbGNhcHNSZWN1clxuICAgICAgICApO1xuICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gXCJzdHJpbmdcIiAmJiByZXN1bHQuY2hhckF0KDApID09PSBcIiZcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogUHJvbWlzZSBlbmNvZGluZyBtdXN0IHN0YXJ0IHdpdGggXCImXCI6ICR7cmVzdWx0fWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBlbmNvZGVFcnJvclRvU21hbGxjYXBzKHBhc3NhYmxlLCBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKTtcbiAgICAgICAgYXNzZXJ0RW5jb2RlZEVycm9yKHJlc3VsdCk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IGFzc2VydC5mYWlsKFxuICAgICAgICAgIHJlZGFjdGVkYGludGVybmFsOiBVbnJlY29nbml6ZWQgcGFzc1N0eWxlICR7cXVvdGUocGFzc1N0eWxlKX1gLFxuICAgICAgICAgIFR5cGVFcnJvclxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgZW5jb2RlVG9TbWFsbGNhcHMgPSAocGFzc2FibGUpID0+IHtcbiAgICBpZiAoaXNFcnJvckxpa2UocGFzc2FibGUpKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBoYXJkZW4oXG4gICAgICAgIGVuY29kZUVycm9yVG9TbWFsbGNhcHMocGFzc2FibGUsIGVuY29kZVRvU21hbGxjYXBzUmVjdXIpXG4gICAgICApO1xuICAgICAgYXNzZXJ0RW5jb2RlZEVycm9yKHJlc3VsdCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICByZXR1cm4gaGFyZGVuKGVuY29kZVRvU21hbGxjYXBzUmVjdXIocGFzc2FibGUpKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbihlbmNvZGVUb1NtYWxsY2Fwcyk7XG59O1xuaGFyZGVuKG1ha2VFbmNvZGVUb1NtYWxsY2Fwcyk7XG52YXIgZG9udERlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMgPSAoZW5jb2RpbmcpID0+IHRocm93UmVkYWN0ZWRgcmVtb3RhYmxlIHVuZXhwZWN0ZWQ6ICR7ZW5jb2Rpbmd9YDtcbnZhciBkb250RGVjb2RlUHJvbWlzZUZyb21TbWFsbGNhcHMgPSAoZW5jb2RpbmcpID0+IHRocm93UmVkYWN0ZWRgcHJvbWlzZSB1bmV4cGVjdGVkOiAke2VuY29kaW5nfWA7XG52YXIgZG9udERlY29kZUVycm9yRnJvbVNtYWxsY2FwcyA9IChlbmNvZGluZykgPT4gdGhyb3dSZWRhY3RlZGBlcnJvciB1bmV4cGVjdGVkOiAke3F1b3RlKGVuY29kaW5nKX1gO1xudmFyIG1ha2VEZWNvZGVGcm9tU21hbGxjYXBzID0gKGRlY29kZU9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgZGVjb2RlUmVtb3RhYmxlRnJvbVNtYWxsY2FwcyA9IGRvbnREZWNvZGVSZW1vdGFibGVGcm9tU21hbGxjYXBzLFxuICAgIGRlY29kZVByb21pc2VGcm9tU21hbGxjYXBzID0gZG9udERlY29kZVByb21pc2VGcm9tU21hbGxjYXBzLFxuICAgIGRlY29kZUVycm9yRnJvbVNtYWxsY2FwcyA9IGRvbnREZWNvZGVFcnJvckZyb21TbWFsbGNhcHNcbiAgfSA9IGRlY29kZU9wdGlvbnM7XG4gIGNvbnN0IGRlY29kZUZyb21TbWFsbGNhcHMgPSAoZW5jb2RpbmcpID0+IHtcbiAgICBzd2l0Y2ggKHR5cGVvZiBlbmNvZGluZykge1xuICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgIGNhc2UgXCJudW1iZXJcIjoge1xuICAgICAgICByZXR1cm4gZW5jb2Rpbmc7XG4gICAgICB9XG4gICAgICBjYXNlIFwic3RyaW5nXCI6IHtcbiAgICAgICAgaWYgKCFzdGFydHNTcGVjaWFsKGVuY29kaW5nKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGluZztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjMiA9IGVuY29kaW5nLmNoYXJBdCgwKTtcbiAgICAgICAgc3dpdGNoIChjMikge1xuICAgICAgICAgIGNhc2UgXCIhXCI6IHtcbiAgICAgICAgICAgIHJldHVybiBlbmNvZGluZy5zbGljZSgxKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcIiVcIjoge1xuICAgICAgICAgICAgcmV0dXJuIHBhc3NhYmxlU3ltYm9sRm9yTmFtZShlbmNvZGluZy5zbGljZSgxKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgXCIjXCI6IHtcbiAgICAgICAgICAgIHN3aXRjaCAoZW5jb2RpbmcpIHtcbiAgICAgICAgICAgICAgY2FzZSBcIiN1bmRlZmluZWRcIjoge1xuICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY2FzZSBcIiNOYU5cIjoge1xuICAgICAgICAgICAgICAgIHJldHVybiBOYU47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY2FzZSBcIiNJbmZpbml0eVwiOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEluZmluaXR5O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNhc2UgXCIjLUluZmluaXR5XCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gLUluZmluaXR5O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICB0aHJvdyBhc3NlcnQuZmFpbChcbiAgICAgICAgICAgICAgICAgIHJlZGFjdGVkYHVua25vd24gY29uc3RhbnQgXCIke3F1b3RlKGVuY29kaW5nKX1cImAsXG4gICAgICAgICAgICAgICAgICBUeXBlRXJyb3JcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgXCIrXCI6XG4gICAgICAgICAgY2FzZSBcIi1cIjoge1xuICAgICAgICAgICAgcmV0dXJuIEJpZ0ludChlbmNvZGluZyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgXCIkXCI6IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGRlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMoXG4gICAgICAgICAgICAgIGVuY29kaW5nLFxuICAgICAgICAgICAgICBkZWNvZGVGcm9tU21hbGxjYXBzXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKHBhc3NTdHlsZU9mKHJlc3VsdCkgIT09IFwicmVtb3RhYmxlXCIpIHtcbiAgICAgICAgICAgICAgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogZGVjb2RlUmVtb3RhYmxlRnJvbVNtYWxsY2FwcyBvcHRpb24gbXVzdCByZXR1cm4gYSByZW1vdGFibGU6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiJlwiOiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBkZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyhcbiAgICAgICAgICAgICAgZW5jb2RpbmcsXG4gICAgICAgICAgICAgIGRlY29kZUZyb21TbWFsbGNhcHNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAocGFzc1N0eWxlT2YocmVzdWx0KSAhPT0gXCJwcm9taXNlXCIpIHtcbiAgICAgICAgICAgICAgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogZGVjb2RlUHJvbWlzZUZyb21TbWFsbGNhcHMgb3B0aW9uIG11c3QgcmV0dXJuIGEgcHJvbWlzZTogJHtyZXN1bHR9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgU3BlY2lhbCBjaGFyICR7cXVvdGUoXG4gICAgICAgICAgICAgIGMyXG4gICAgICAgICAgICApfSByZXNlcnZlZCBmb3IgZnV0dXJlIHVzZTogJHtlbmNvZGluZ31gO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY2FzZSBcIm9iamVjdFwiOiB7XG4gICAgICAgIGlmIChlbmNvZGluZyA9PT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGluZztcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXNBcnJheTUoZW5jb2RpbmcpKSB7XG4gICAgICAgICAgcmV0dXJuIGVuY29kaW5nLm1hcCgodmFsKSA9PiBkZWNvZGVGcm9tU21hbGxjYXBzKHZhbCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNPd243KGVuY29kaW5nLCBcIiN0YWdcIikpIHtcbiAgICAgICAgICBjb25zdCB7IFwiI3RhZ1wiOiB0YWcsIHBheWxvYWQsIC4uLnJlc3QgfSA9IGVuY29kaW5nO1xuICAgICAgICAgIHR5cGVvZiB0YWcgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBWYWx1ZSBvZiBcIiN0YWdcIiwgdGhlIHRhZywgbXVzdCBiZSBhIHN0cmluZzogJHtlbmNvZGluZ31gO1xuICAgICAgICAgIG93bktleXMxMihyZXN0KS5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGAjdGFnIHJlY29yZCB1bmV4cGVjdGVkIHByb3BlcnRpZXM6ICR7cXVvdGUob3duS2V5czEyKHJlc3QpKX1gO1xuICAgICAgICAgIHJldHVybiBtYWtlVGFnZ2VkKFxuICAgICAgICAgICAgZGVjb2RlRnJvbVNtYWxsY2Fwcyh0YWcpLFxuICAgICAgICAgICAgZGVjb2RlRnJvbVNtYWxsY2FwcyhwYXlsb2FkKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhhc093bjcoZW5jb2RpbmcsIFwiI2Vycm9yXCIpKSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGVjb2RlRXJyb3JGcm9tU21hbGxjYXBzKFxuICAgICAgICAgICAgZW5jb2RpbmcsXG4gICAgICAgICAgICBkZWNvZGVGcm9tU21hbGxjYXBzXG4gICAgICAgICAgKTtcbiAgICAgICAgICBwYXNzU3R5bGVPZihyZXN1bHQpID09PSBcImVycm9yXCIgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogZGVjb2RlRXJyb3JGcm9tU21hbGxjYXBzIG9wdGlvbiBtdXN0IHJldHVybiBhbiBlcnJvcjogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGRlY29kZUVudHJ5ID0gKFtlbmNvZGVkTmFtZSwgZW5jb2RlZFZhbF0pID0+IHtcbiAgICAgICAgICB0eXBlb2YgZW5jb2RlZE5hbWUgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBQcm9wZXJ0eSBuYW1lICR7cXVvdGUoXG4gICAgICAgICAgICBlbmNvZGVkTmFtZVxuICAgICAgICAgICl9IG9mICR7ZW5jb2Rpbmd9IG11c3QgYmUgYSBzdHJpbmdgO1xuICAgICAgICAgIGVuY29kZWROYW1lLmNoYXJBdCgwKSAhPT0gXCIjXCIgfHwgdGhyb3dSZWRhY3RlZGBVbnJlY29nbml6ZWQgcmVjb3JkIHR5cGUgJHtxdW90ZShlbmNvZGVkTmFtZSl9OiAke2VuY29kaW5nfWA7XG4gICAgICAgICAgY29uc3QgbmFtZSA9IGRlY29kZUZyb21TbWFsbGNhcHMoZW5jb2RlZE5hbWUpO1xuICAgICAgICAgIHR5cGVvZiBuYW1lID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgRGVjb2RlZCBwcm9wZXJ0eSBuYW1lICR7bmFtZX0gZnJvbSAke2VuY29kaW5nfSBtdXN0IGJlIGEgc3RyaW5nYDtcbiAgICAgICAgICByZXR1cm4gW25hbWUsIGRlY29kZUZyb21TbWFsbGNhcHMoZW5jb2RlZFZhbCldO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBkZWNvZGVkRW50cmllcyA9IGVudHJpZXM1KGVuY29kaW5nKS5tYXAoZGVjb2RlRW50cnkpO1xuICAgICAgICByZXR1cm4gZnJvbUVudHJpZXM0KGRlY29kZWRFbnRyaWVzKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgcmVkYWN0ZWRgaW50ZXJuYWw6IHVucmVjb2duaXplZCBKU09OIHR5cGVvZiAke3F1b3RlKFxuICAgICAgICAgICAgdHlwZW9mIGVuY29kaW5nXG4gICAgICAgICAgKX06ICR7ZW5jb2Rpbmd9YCxcbiAgICAgICAgICBUeXBlRXJyb3JcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiBoYXJkZW4oZGVjb2RlRnJvbVNtYWxsY2Fwcyk7XG59O1xuXG4vL1xudmFyIHsgZGVmaW5lUHJvcGVydGllczogZGVmaW5lUHJvcGVydGllczIsIGhhc093bjogaGFzT3duOCB9ID0gT2JqZWN0O1xudmFyIHsgaXNBcnJheTogaXNBcnJheTYgfSA9IEFycmF5O1xudmFyIHsgb3duS2V5czogb3duS2V5czEzIH0gPSBSZWZsZWN0O1xudmFyIGRlZmF1bHRWYWxUb1Nsb3RGbiA9ICh4KSA9PiB4O1xudmFyIGRlZmF1bHRTbG90VG9WYWxGbiA9ICh4LCBfKSA9PiB4O1xudmFyIG1ha2VNYXJzaGFsID0gKGNvbnZlcnRWYWxUb1Nsb3QgPSBkZWZhdWx0VmFsVG9TbG90Rm4sIGNvbnZlcnRTbG90VG9WYWwgPSBkZWZhdWx0U2xvdFRvVmFsRm4sIHtcbiAgZXJyb3JUYWdnaW5nID0gXCJvblwiLFxuICBtYXJzaGFsTmFtZSA9IFwiYW5vbi1tYXJzaGFsXCIsXG4gIC8vXG4gIC8vXG4gIGVycm9ySWROdW0gPSAxZTQsXG4gIC8vXG4gIC8vXG4gIG1hcnNoYWxTYXZlRXJyb3IgPSAoZXJyKSA9PiBjb25zb2xlLmxvZyhcIlRlbXBvcmFyeSBsb2dnaW5nIG9mIHNlbnQgZXJyb3JcIiwgZXJyKSxcbiAgLy9cbiAgLy9cbiAgc2VyaWFsaXplQm9keUZvcm1hdCA9IFwiY2FwZGF0YVwiXG59ID0ge30pID0+IHtcbiAgYXNzZXJ0LnR5cGVvZihtYXJzaGFsTmFtZSwgXCJzdHJpbmdcIik7XG4gIGVycm9yVGFnZ2luZyA9PT0gXCJvblwiIHx8IGVycm9yVGFnZ2luZyA9PT0gXCJvZmZcIiB8fCB0aHJvd1JlZGFjdGVkYFRoZSBlcnJvclRhZ2dpbmcgb3B0aW9uIGNhbiBvbmx5IGJlIFwib25cIiBvciBcIm9mZlwiICR7ZXJyb3JUYWdnaW5nfWA7XG4gIGNvbnN0IG5leHRFcnJvcklkID0gKCkgPT4ge1xuICAgIGVycm9ySWROdW0gKz0gMTtcbiAgICByZXR1cm4gYGVycm9yOiR7bWFyc2hhbE5hbWV9IyR7ZXJyb3JJZE51bX1gO1xuICB9O1xuICBjb25zdCB0b0NhcERhdGEyID0gKHJvb3QpID0+IHtcbiAgICBjb25zdCBzbG90cyA9IFtdO1xuICAgIGNvbnN0IHNsb3RNYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICAgIGNvbnN0IGVuY29kZVNsb3RDb21tb24gPSAocGFzc2FibGUpID0+IHtcbiAgICAgIGxldCBpbmRleCA9IHNsb3RNYXAuZ2V0KHBhc3NhYmxlKTtcbiAgICAgIGlmIChpbmRleCAhPT0gdm9pZCAwKSB7XG4gICAgICAgIGFzc2VydC50eXBlb2YoaW5kZXgsIFwibnVtYmVyXCIpO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHsgaW5kZXgsIHJlcGVhdDogdHJ1ZSB9KTtcbiAgICAgIH1cbiAgICAgIGluZGV4ID0gc2xvdHMubGVuZ3RoO1xuICAgICAgY29uc3Qgc2xvdCA9IGNvbnZlcnRWYWxUb1Nsb3QocGFzc2FibGUpO1xuICAgICAgc2xvdHMucHVzaChzbG90KTtcbiAgICAgIHNsb3RNYXAuc2V0KHBhc3NhYmxlLCBpbmRleCk7XG4gICAgICByZXR1cm4gaGFyZGVuKHsgaW5kZXgsIHJlcGVhdDogZmFsc2UgfSk7XG4gICAgfTtcbiAgICBjb25zdCBlbmNvZGVFcnJvckNvbW1vbiA9IChlcnIsIGVuY29kZVJlY3VyKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gZW5jb2RlUmVjdXIoYCR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBhc3NlcnQudHlwZW9mKG1lc3NhZ2UsIFwic3RyaW5nXCIpO1xuICAgICAgY29uc3QgbmFtZSA9IGVuY29kZVJlY3VyKGAke2Vyci5uYW1lfWApO1xuICAgICAgYXNzZXJ0LnR5cGVvZihuYW1lLCBcInN0cmluZ1wiKTtcbiAgICAgIGlmIChlcnJvclRhZ2dpbmcgPT09IFwib25cIikge1xuICAgICAgICBjb25zdCBlcnJvcklkID0gZW5jb2RlUmVjdXIobmV4dEVycm9ySWQoKSk7XG4gICAgICAgIGFzc2VydC50eXBlb2YoZXJyb3JJZCwgXCJzdHJpbmdcIik7XG4gICAgICAgIG5vdGUoZXJyLCByZWRhY3RlZGBTZW50IGFzICR7ZXJyb3JJZH1gKTtcbiAgICAgICAgbWFyc2hhbFNhdmVFcnJvcihlcnIpO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHsgZXJyb3JJZCwgbWVzc2FnZSwgbmFtZSB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBtZXNzYWdlLCBuYW1lIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgaWYgKHNlcmlhbGl6ZUJvZHlGb3JtYXQgPT09IFwiY2FwZGF0YVwiKSB7XG4gICAgICBjb25zdCBlbmNvZGVTbG90VG9DYXBEYXRhID0gKHBhc3NhYmxlLCBpZmFjZSA9IHZvaWQgMCkgPT4ge1xuICAgICAgICBjb25zdCB7IGluZGV4LCByZXBlYXQgfSA9IGVuY29kZVNsb3RDb21tb24ocGFzc2FibGUpO1xuICAgICAgICBpZiAocmVwZWF0ID09PSB0cnVlIHx8IGlmYWNlID09PSB2b2lkIDApIHtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgW1FDTEFTU106IFwic2xvdFwiLCBpbmRleCB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgW1FDTEFTU106IFwic2xvdFwiLCBpZmFjZSwgaW5kZXggfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBjb25zdCBlbmNvZGVSZW1vdGFibGVUb0NhcERhdGEgPSAodmFsLCBfZW5jb2RlUmVjdXIpID0+IGVuY29kZVNsb3RUb0NhcERhdGEodmFsLCBnZXRJbnRlcmZhY2VPZih2YWwpKTtcbiAgICAgIGNvbnN0IGVuY29kZVByb21pc2VUb0NhcERhdGEgPSAocHJvbWlzZSwgX2VuY29kZVJlY3VyKSA9PiBlbmNvZGVTbG90VG9DYXBEYXRhKHByb21pc2UpO1xuICAgICAgY29uc3QgZW5jb2RlRXJyb3JUb0NhcERhdGEgPSAoZXJyLCBlbmNvZGVSZWN1cikgPT4ge1xuICAgICAgICBjb25zdCBlcnJEYXRhID0gZW5jb2RlRXJyb3JDb21tb24oZXJyLCBlbmNvZGVSZWN1cik7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBbUUNMQVNTXTogXCJlcnJvclwiLCAuLi5lcnJEYXRhIH0pO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGVuY29kZVRvQ2FwRGF0YSA9IG1ha2VFbmNvZGVUb0NhcERhdGEoe1xuICAgICAgICBlbmNvZGVSZW1vdGFibGVUb0NhcERhdGEsXG4gICAgICAgIGVuY29kZVByb21pc2VUb0NhcERhdGEsXG4gICAgICAgIGVuY29kZUVycm9yVG9DYXBEYXRhXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVUb0NhcERhdGEocm9vdCk7XG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5zdHJpbmdpZnkoZW5jb2RlZCk7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgYm9keSxcbiAgICAgICAgc2xvdHNcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoc2VyaWFsaXplQm9keUZvcm1hdCA9PT0gXCJzbWFsbGNhcHNcIikge1xuICAgICAgY29uc3QgZW5jb2RlU2xvdFRvU21hbGxjYXBzID0gKHByZWZpeCwgcGFzc2FibGUsIGlmYWNlID0gdm9pZCAwKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaW5kZXgsIHJlcGVhdCB9ID0gZW5jb2RlU2xvdENvbW1vbihwYXNzYWJsZSk7XG4gICAgICAgIGlmIChyZXBlYXQgPT09IHRydWUgfHwgaWZhY2UgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiBgJHtwcmVmaXh9JHtpbmRleH1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHtwcmVmaXh9JHtpbmRleH0uJHtpZmFjZX1gO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGVuY29kZVJlbW90YWJsZVRvU21hbGxjYXBzID0gKHJlbW90YWJsZSwgX2VuY29kZVJlY3VyKSA9PiBlbmNvZGVTbG90VG9TbWFsbGNhcHMoXCIkXCIsIHJlbW90YWJsZSwgZ2V0SW50ZXJmYWNlT2YocmVtb3RhYmxlKSk7XG4gICAgICBjb25zdCBlbmNvZGVQcm9taXNlVG9TbWFsbGNhcHMgPSAocHJvbWlzZSwgX2VuY29kZVJlY3VyKSA9PiBlbmNvZGVTbG90VG9TbWFsbGNhcHMoXCImXCIsIHByb21pc2UpO1xuICAgICAgY29uc3QgZW5jb2RlRXJyb3JUb1NtYWxsY2FwcyA9IChlcnIsIGVuY29kZVJlY3VyKSA9PiB7XG4gICAgICAgIGNvbnN0IGVyckRhdGEgPSBlbmNvZGVFcnJvckNvbW1vbihlcnIsIGVuY29kZVJlY3VyKTtcbiAgICAgICAgY29uc3QgeyBtZXNzYWdlLCAuLi5yZXN0IH0gPSBlcnJEYXRhO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHsgXCIjZXJyb3JcIjogbWVzc2FnZSwgLi4ucmVzdCB9KTtcbiAgICAgIH07XG4gICAgICBjb25zdCBlbmNvZGVUb1NtYWxsY2FwcyA9IG1ha2VFbmNvZGVUb1NtYWxsY2Fwcyh7XG4gICAgICAgIGVuY29kZVJlbW90YWJsZVRvU21hbGxjYXBzLFxuICAgICAgICBlbmNvZGVQcm9taXNlVG9TbWFsbGNhcHMsXG4gICAgICAgIGVuY29kZUVycm9yVG9TbWFsbGNhcHNcbiAgICAgIH0pO1xuICAgICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZVRvU21hbGxjYXBzKHJvb3QpO1xuICAgICAgY29uc3Qgc21hbGxjYXBzQm9keSA9IEpTT04uc3RyaW5naWZ5KGVuY29kZWQpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIGJvZHk6IGAjJHtzbWFsbGNhcHNCb2R5fWAsXG4gICAgICAgIHNsb3RzXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBVbnJlY29nbml6ZWQgc2VyaWFsaXplQm9keUZvcm1hdDogJHtxdW90ZShzZXJpYWxpemVCb2R5Rm9ybWF0KX1gO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgbWFrZUZ1bGxSZXZpdmUgPSAoc2xvdHMpID0+IHtcbiAgICBjb25zdCB2YWxNYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICAgIGNvbnN0IGRlY29kZVNsb3RDb21tb24gPSAoc2xvdERhdGEpID0+IHtcbiAgICAgIGNvbnN0IHsgaWZhY2UgPSB2b2lkIDAsIGluZGV4LCAuLi5yZXN0IH0gPSBzbG90RGF0YTtcbiAgICAgIG93bktleXMxMyhyZXN0KS5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGVuY29kZWQgc2xvdCBwcm9wZXJ0aWVzICR7cXVvdGUob3duS2V5czEzKHJlc3QpKX1gO1xuICAgICAgY29uc3QgZXh0YW50ID0gdmFsTWFwLmdldChpbmRleCk7XG4gICAgICBpZiAoZXh0YW50KSB7XG4gICAgICAgIHJldHVybiBleHRhbnQ7XG4gICAgICB9XG4gICAgICBjb25zdCBzbG90ID0gc2xvdHNbTnVtYmVyKE5hdChpbmRleCkpXTtcbiAgICAgIGNvbnN0IHZhbCA9IGNvbnZlcnRTbG90VG9WYWwoc2xvdCwgaWZhY2UpO1xuICAgICAgdmFsTWFwLnNldChpbmRleCwgdmFsKTtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfTtcbiAgICBjb25zdCBkZWNvZGVFcnJvckNvbW1vbiA9IChlcnJEYXRhLCBkZWNvZGVSZWN1cikgPT4ge1xuICAgICAgY29uc3Qge1xuICAgICAgICBlcnJvcklkID0gdm9pZCAwLFxuICAgICAgICBtZXNzYWdlLFxuICAgICAgICBuYW1lLFxuICAgICAgICBjYXVzZSA9IHZvaWQgMCxcbiAgICAgICAgZXJyb3JzID0gdm9pZCAwLFxuICAgICAgICAuLi5yZXN0XG4gICAgICB9ID0gZXJyRGF0YTtcbiAgICAgIGNvbnN0IGROYW1lID0gZGVjb2RlUmVjdXIobmFtZSk7XG4gICAgICBjb25zdCBkTWVzc2FnZSA9IGRlY29kZVJlY3VyKG1lc3NhZ2UpO1xuICAgICAgY29uc3QgZEVycm9ySWQgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBlcnJvcklkICYmIGRlY29kZVJlY3VyKGVycm9ySWQpXG4gICAgICApO1xuICAgICAgaWYgKHR5cGVvZiBkTmFtZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludmFsaWQgZXJyb3IgbmFtZSB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgZE5hbWUpfWA7XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGRNZXNzYWdlICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW52YWxpZCBlcnJvciBtZXNzYWdlIHR5cGVvZiAke3F1b3RlKHR5cGVvZiBkTWVzc2FnZSl9YDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGVyckNvbnN0cnVjdG9yID0gZ2V0RXJyb3JDb25zdHJ1Y3RvcihkTmFtZSkgfHwgRXJyb3I7XG4gICAgICBjb25zdCBlcnJvck5hbWUgPSBkRXJyb3JJZCA9PT0gdm9pZCAwID8gYFJlbW90ZSR7ZXJyQ29uc3RydWN0b3IubmFtZX1gIDogYFJlbW90ZSR7ZXJyQ29uc3RydWN0b3IubmFtZX0oJHtkRXJyb3JJZH0pYDtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgIGVycm9yTmFtZSxcbiAgICAgICAgc2FuaXRpemU6IGZhbHNlXG4gICAgICB9O1xuICAgICAgaWYgKGNhdXNlKSB7XG4gICAgICAgIG9wdGlvbnMuY2F1c2UgPSBkZWNvZGVSZWN1cihjYXVzZSk7XG4gICAgICB9XG4gICAgICBpZiAoZXJyb3JzKSB7XG4gICAgICAgIG9wdGlvbnMuZXJyb3JzID0gZGVjb2RlUmVjdXIoZXJyb3JzKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJhd0Vycm9yID0gbWFrZUVycm9yKGRNZXNzYWdlLCBlcnJDb25zdHJ1Y3Rvciwgb3B0aW9ucyk7XG4gICAgICBjb25zdCBkZXNjcyA9IG9iamVjdE1hcChyZXN0LCAoZGF0YSkgPT4gKHtcbiAgICAgICAgdmFsdWU6IGRlY29kZVJlY3VyKGRhdGEpLFxuICAgICAgICB3cml0YWJsZTogZmFsc2UsXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlXG4gICAgICB9KSk7XG4gICAgICBkZWZpbmVQcm9wZXJ0aWVzMihyYXdFcnJvciwgZGVzY3MpO1xuICAgICAgaGFyZGVuKHJhd0Vycm9yKTtcbiAgICAgIHJldHVybiB0b1Bhc3NhYmxlRXJyb3IocmF3RXJyb3IpO1xuICAgIH07XG4gICAgY29uc3QgZGVjb2RlUmVtb3RhYmxlT3JQcm9taXNlRnJvbUNhcERhdGEgPSAocmF3VHJlZSwgX2RlY29kZVJlY3VyKSA9PiB7XG4gICAgICBjb25zdCB7IFtRQ0xBU1NdOiBfLCAuLi5zbG90RGF0YSB9ID0gcmF3VHJlZTtcbiAgICAgIHJldHVybiBkZWNvZGVTbG90Q29tbW9uKHNsb3REYXRhKTtcbiAgICB9O1xuICAgIGNvbnN0IGRlY29kZUVycm9yRnJvbUNhcERhdGEgPSAocmF3VHJlZSwgZGVjb2RlUmVjdXIpID0+IHtcbiAgICAgIGNvbnN0IHsgW1FDTEFTU106IF8sIC4uLmVyckRhdGEgfSA9IHJhd1RyZWU7XG4gICAgICByZXR1cm4gZGVjb2RlRXJyb3JDb21tb24oZXJyRGF0YSwgZGVjb2RlUmVjdXIpO1xuICAgIH07XG4gICAgY29uc3QgcmV2aXZlRnJvbUNhcERhdGEgPSBtYWtlRGVjb2RlRnJvbUNhcERhdGEoe1xuICAgICAgZGVjb2RlUmVtb3RhYmxlRnJvbUNhcERhdGE6IGRlY29kZVJlbW90YWJsZU9yUHJvbWlzZUZyb21DYXBEYXRhLFxuICAgICAgZGVjb2RlUHJvbWlzZUZyb21DYXBEYXRhOiBkZWNvZGVSZW1vdGFibGVPclByb21pc2VGcm9tQ2FwRGF0YSxcbiAgICAgIGRlY29kZUVycm9yRnJvbUNhcERhdGFcbiAgICB9KTtcbiAgICBjb25zdCBtYWtlRGVjb2RlU2xvdEZyb21TbWFsbGNhcHMgPSAocHJlZml4KSA9PiB7XG4gICAgICByZXR1cm4gKHN0cmluZ0VuY29kaW5nLCBfZGVjb2RlUmVjdXIpID0+IHtcbiAgICAgICAgYXNzZXJ0KHN0cmluZ0VuY29kaW5nLmNoYXJBdCgwKSA9PT0gcHJlZml4KTtcbiAgICAgICAgY29uc3QgaTMgPSBzdHJpbmdFbmNvZGluZy5pbmRleE9mKFwiLlwiKTtcbiAgICAgICAgY29uc3QgaW5kZXggPSBOdW1iZXIoc3RyaW5nRW5jb2Rpbmcuc2xpY2UoMSwgaTMgPCAwID8gdm9pZCAwIDogaTMpKTtcbiAgICAgICAgY29uc3QgaWZhY2UgPSBpMyA8IDAgPyB2b2lkIDAgOiBzdHJpbmdFbmNvZGluZy5zbGljZShpMyArIDEpO1xuICAgICAgICByZXR1cm4gZGVjb2RlU2xvdENvbW1vbih7IGlmYWNlLCBpbmRleCB9KTtcbiAgICAgIH07XG4gICAgfTtcbiAgICBjb25zdCBkZWNvZGVSZW1vdGFibGVGcm9tU21hbGxjYXBzID0gbWFrZURlY29kZVNsb3RGcm9tU21hbGxjYXBzKFwiJFwiKTtcbiAgICBjb25zdCBkZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyA9IG1ha2VEZWNvZGVTbG90RnJvbVNtYWxsY2FwcyhcIiZcIik7XG4gICAgY29uc3QgZGVjb2RlRXJyb3JGcm9tU21hbGxjYXBzID0gKGVuY29kaW5nLCBkZWNvZGVSZWN1cikgPT4ge1xuICAgICAgY29uc3QgeyBcIiNlcnJvclwiOiBtZXNzYWdlLCAuLi5yZXN0RXJyRGF0YSB9ID0gZW5jb2Rpbmc7XG4gICAgICAhaGFzT3duOChyZXN0RXJyRGF0YSwgXCJtZXNzYWdlXCIpIHx8IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBlbmNvZGVkIGVycm9yIHByb3BlcnR5ICR7cXVvdGUoXCJtZXNzYWdlXCIpfWA7XG4gICAgICByZXR1cm4gZGVjb2RlRXJyb3JDb21tb24oeyBtZXNzYWdlLCAuLi5yZXN0RXJyRGF0YSB9LCBkZWNvZGVSZWN1cik7XG4gICAgfTtcbiAgICBjb25zdCByZXZpdmVGcm9tU21hbGxjYXBzID0gbWFrZURlY29kZUZyb21TbWFsbGNhcHMoe1xuICAgICAgLy9cbiAgICAgIGRlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMsXG4gICAgICAvL1xuICAgICAgZGVjb2RlUHJvbWlzZUZyb21TbWFsbGNhcHMsXG4gICAgICBkZWNvZGVFcnJvckZyb21TbWFsbGNhcHNcbiAgICB9KTtcbiAgICByZXR1cm4gaGFyZGVuKHsgcmV2aXZlRnJvbUNhcERhdGEsIHJldml2ZUZyb21TbWFsbGNhcHMgfSk7XG4gIH07XG4gIGNvbnN0IGZyb21DYXBEYXRhID0gKGRhdGEpID0+IHtcbiAgICBjb25zdCB7IGJvZHksIHNsb3RzIH0gPSBkYXRhO1xuICAgIHR5cGVvZiBib2R5ID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgdW5zZXJpYWxpemUoKSBnaXZlbiBub24tY2FwZGF0YSAoLmJvZHkgaXMgJHtib2R5fSwgbm90IHN0cmluZylgO1xuICAgIGlzQXJyYXk2KGRhdGEuc2xvdHMpIHx8IHRocm93UmVkYWN0ZWRgdW5zZXJpYWxpemUoKSBnaXZlbiBub24tY2FwZGF0YSAoLnNsb3RzIGFyZSBub3QgQXJyYXkpYDtcbiAgICBjb25zdCB7IHJldml2ZUZyb21DYXBEYXRhLCByZXZpdmVGcm9tU21hbGxjYXBzIH0gPSBtYWtlRnVsbFJldml2ZShzbG90cyk7XG4gICAgbGV0IHJlc3VsdDtcbiAgICBpZiAoYm9keS5jaGFyQXQoMCkgPT09IFwiI1wiKSB7XG4gICAgICBjb25zdCBzbWFsbGNhcHNCb2R5ID0gYm9keS5zbGljZSgxKTtcbiAgICAgIGNvbnN0IGVuY29kaW5nID0gaGFyZGVuKEpTT04ucGFyc2Uoc21hbGxjYXBzQm9keSkpO1xuICAgICAgcmVzdWx0ID0gaGFyZGVuKHJldml2ZUZyb21TbWFsbGNhcHMoZW5jb2RpbmcpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgcmF3VHJlZSA9IGhhcmRlbihKU09OLnBhcnNlKGJvZHkpKTtcbiAgICAgIHJlc3VsdCA9IGhhcmRlbihyZXZpdmVGcm9tQ2FwRGF0YShyYXdUcmVlKSk7XG4gICAgfVxuICAgIGFzc2VydFBhc3NhYmxlKHJlc3VsdCk7XG4gICAgcmV0dXJuIChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICByZXN1bHRcbiAgICApO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICB0b0NhcERhdGE6IHRvQ2FwRGF0YTIsXG4gICAgZnJvbUNhcERhdGEsXG4gICAgLy9cbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHNlcmlhbGl6ZTogdG9DYXBEYXRhMixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgdW5zZXJpYWxpemU6IGZyb21DYXBEYXRhXG4gIH0pO1xufTtcblxuLy9cbnZhciB7IGZyZWV6ZTogZnJlZXplNiB9ID0gT2JqZWN0O1xudmFyIGRvTm90Q29udmVydFZhbFRvU2xvdCA9ICh2YWwpID0+IHRocm93UmVkYWN0ZWRgTWFyc2hhbCdzIHN0cmluZ2lmeSByZWplY3RzIHByZXNlbmNlcyBhbmQgcHJvbWlzZXMgJHt2YWx9YDtcbnZhciBkb05vdENvbnZlcnRTbG90VG9WYWwgPSAoc2xvdCwgX2lmYWNlKSA9PiB0aHJvd1JlZGFjdGVkYE1hcnNoYWwncyBwYXJzZSBtdXN0IG5vdCBlbmNvZGUgYW55IHNsb3RzICR7c2xvdH1gO1xudmFyIGJhZEFycmF5SGFuZGxlciA9IGhhcmRlbih7XG4gIGdldDogKF90YXJnZXQsIG5hbWUsIF9yZWNlaXZlcikgPT4ge1xuICAgIGlmIChuYW1lID09PSBcImxlbmd0aFwiKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBNYXJzaGFsJ3MgcGFyc2UgbXVzdCBub3QgZW5jb2RlIGFueSBzbG90IHBvc2l0aW9ucyAke25hbWV9YDtcbiAgfVxufSk7XG52YXIgYXJyYXlUYXJnZXQgPSBmcmVlemU2KFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBbXVxuKTtcbnZhciBiYWRBcnJheSA9IG5ldyBQcm94eShhcnJheVRhcmdldCwgYmFkQXJyYXlIYW5kbGVyKTtcbnZhciB7IHNlcmlhbGl6ZSwgdW5zZXJpYWxpemUgfSA9IG1ha2VNYXJzaGFsKFxuICBkb05vdENvbnZlcnRWYWxUb1Nsb3QsXG4gIGRvTm90Q29udmVydFNsb3RUb1ZhbCxcbiAge1xuICAgIGVycm9yVGFnZ2luZzogXCJvZmZcIixcbiAgICAvL1xuICAgIHNlcmlhbGl6ZUJvZHlGb3JtYXQ6IFwiY2FwZGF0YVwiXG4gIH1cbik7XG52YXIgc3RyaW5naWZ5ID0gKHZhbCkgPT4gc2VyaWFsaXplKHZhbCkuYm9keTtcbmhhcmRlbihzdHJpbmdpZnkpO1xudmFyIHBhcnNlID0gKHN0cikgPT4gdW5zZXJpYWxpemUoXG4gIC8vXG4gIC8vXG4gIC8vXG4gIGZyZWV6ZTYoe1xuICAgIGJvZHk6IHN0cixcbiAgICBzbG90czogYmFkQXJyYXlcbiAgfSlcbik7XG5oYXJkZW4ocGFyc2UpO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czE0IH0gPSBSZWZsZWN0O1xudmFyIHsgaXNBcnJheTogaXNBcnJheTcgfSA9IEFycmF5O1xudmFyIHsgc3RyaW5naWZ5OiBxdW90ZTIgfSA9IEpTT047XG52YXIgbWFrZVllc0luZGVudGVyID0gKCkgPT4ge1xuICBjb25zdCBzdHJpbmdzID0gW107XG4gIGxldCBsZXZlbCA9IDA7XG4gIGxldCBuZWVkU3BhY2UgPSBmYWxzZTtcbiAgY29uc3QgbGluZSA9ICgpID0+IHtcbiAgICBuZWVkU3BhY2UgPSBmYWxzZTtcbiAgICByZXR1cm4gc3RyaW5ncy5wdXNoKFwiXFxuXCIsIFwiICBcIi5yZXBlYXQobGV2ZWwpKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgb3BlbjogKG9wZW5CcmFja2V0KSA9PiB7XG4gICAgICBsZXZlbCArPSAxO1xuICAgICAgaWYgKG5lZWRTcGFjZSkge1xuICAgICAgICBzdHJpbmdzLnB1c2goXCIgXCIpO1xuICAgICAgfVxuICAgICAgbmVlZFNwYWNlID0gZmFsc2U7XG4gICAgICByZXR1cm4gc3RyaW5ncy5wdXNoKG9wZW5CcmFja2V0KTtcbiAgICB9LFxuICAgIGxpbmUsXG4gICAgbmV4dDogKHRva2VuMikgPT4ge1xuICAgICAgaWYgKG5lZWRTcGFjZSAmJiB0b2tlbjIgIT09IFwiLFwiICYmIHRva2VuMiAhPT0gXCIpXCIpIHtcbiAgICAgICAgc3RyaW5ncy5wdXNoKFwiIFwiKTtcbiAgICAgIH1cbiAgICAgIG5lZWRTcGFjZSA9IHRydWU7XG4gICAgICByZXR1cm4gc3RyaW5ncy5wdXNoKHRva2VuMik7XG4gICAgfSxcbiAgICBjbG9zZTogKGNsb3NlQnJhY2tldCkgPT4ge1xuICAgICAgYXNzZXJ0KGxldmVsID49IDEpO1xuICAgICAgbGV2ZWwgLT0gMTtcbiAgICAgIGxpbmUoKTtcbiAgICAgIHJldHVybiBzdHJpbmdzLnB1c2goY2xvc2VCcmFja2V0KTtcbiAgICB9LFxuICAgIGRvbmU6ICgpID0+IHtcbiAgICAgIGFzc2VydC5lcXVhbChsZXZlbCwgMCk7XG4gICAgICByZXR1cm4gc3RyaW5ncy5qb2luKFwiXCIpO1xuICAgIH1cbiAgfSk7XG59O1xudmFyIGJhZFBhaXJQYXR0ZXJuID0gL14oPzpcXHdcXHd8PDx8Pj58XFwrXFwrfC0tfDwhfC0+KSQvO1xudmFyIG1ha2VOb0luZGVudGVyID0gKCkgPT4ge1xuICBjb25zdCBzdHJpbmdzID0gW107XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIG9wZW46IChvcGVuQnJhY2tldCkgPT4gc3RyaW5ncy5wdXNoKG9wZW5CcmFja2V0KSxcbiAgICBsaW5lOiAoKSA9PiBzdHJpbmdzLmxlbmd0aCxcbiAgICBuZXh0OiAodG9rZW4yKSA9PiB7XG4gICAgICBpZiAoc3RyaW5ncy5sZW5ndGggPj0gMSkge1xuICAgICAgICBjb25zdCBsYXN0ID0gc3RyaW5nc1tzdHJpbmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICBpZiAobGFzdC5sZW5ndGggPj0gMSAmJiB0b2tlbjIubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICBjb25zdCBwYWlyID0gYCR7bGFzdFtsYXN0Lmxlbmd0aCAtIDFdfSR7dG9rZW4yWzBdfWA7XG4gICAgICAgICAgaWYgKGJhZFBhaXJQYXR0ZXJuLnRlc3QocGFpcikpIHtcbiAgICAgICAgICAgIHN0cmluZ3MucHVzaChcIiBcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RyaW5ncy5wdXNoKHRva2VuMik7XG4gICAgfSxcbiAgICBjbG9zZTogKGNsb3NlQnJhY2tldCkgPT4ge1xuICAgICAgaWYgKHN0cmluZ3MubGVuZ3RoID49IDEgJiYgc3RyaW5nc1tzdHJpbmdzLmxlbmd0aCAtIDFdID09PSBcIixcIikge1xuICAgICAgICBzdHJpbmdzLnBvcCgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0cmluZ3MucHVzaChjbG9zZUJyYWNrZXQpO1xuICAgIH0sXG4gICAgZG9uZTogKCkgPT4gc3RyaW5ncy5qb2luKFwiXCIpXG4gIH0pO1xufTtcbnZhciBpZGVudFBhdHRlcm4gPSAvXlthLXpBLVpdXFx3KiQvO1xuaGFyZGVuKGlkZW50UGF0dGVybik7XG52YXIgQXRBdFByZWZpeFBhdHRlcm4yID0gL15AQCguKikkLztcbmhhcmRlbihBdEF0UHJlZml4UGF0dGVybjIpO1xudmFyIGRlY29kZVRvSnVzdGluID0gKGVuY29kaW5nLCBzaG91bGRJbmRlbnQgPSBmYWxzZSwgc2xvdHMgPSBbXSkgPT4ge1xuICBjb25zdCBwcmVwYXJlID0gKHJhd1RyZWUpID0+IHtcbiAgICBpZiAoaXNQcmltaXRpdmUyKHJhd1RyZWUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGFzc2VydC50eXBlb2YocmF3VHJlZSwgXCJvYmplY3RcIik7XG4gICAgYXNzZXJ0KHJhd1RyZWUgIT09IG51bGwpO1xuICAgIGlmIChRQ0xBU1MgaW4gcmF3VHJlZSkge1xuICAgICAgY29uc3QgcWNsYXNzID0gcmF3VHJlZVtRQ0xBU1NdO1xuICAgICAgdHlwZW9mIHFjbGFzcyA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGludmFsaWQgcWNsYXNzIHR5cGVvZiAke3F1b3RlKHR5cGVvZiBxY2xhc3MpfWA7XG4gICAgICBhc3NlcnQoIWlzQXJyYXk3KHJhd1RyZWUpKTtcbiAgICAgIHN3aXRjaCAocmF3VHJlZVtcIkBxY2xhc3NcIl0pIHtcbiAgICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgICAgICBjYXNlIFwiTmFOXCI6XG4gICAgICAgIGNhc2UgXCJJbmZpbml0eVwiOlxuICAgICAgICBjYXNlIFwiLUluZmluaXR5XCI6IHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImJpZ2ludFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBkaWdpdHMgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgdHlwZW9mIGRpZ2l0cyA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGludmFsaWQgZGlnaXRzIHR5cGVvZiAke3F1b3RlKHR5cGVvZiBkaWdpdHMpfWA7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJAQGFzeW5jSXRlcmF0b3JcIjoge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgICBjb25zdCB7IG5hbWUgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZihuYW1lLCBcInN0cmluZ1wiKTtcbiAgICAgICAgICBjb25zdCBzeW0gPSBwYXNzYWJsZVN5bWJvbEZvck5hbWUobmFtZSk7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZihzeW0sIFwic3ltYm9sXCIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgICBjb25zdCB7IHRhZywgcGF5bG9hZCB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKHRhZywgXCJzdHJpbmdcIik7XG4gICAgICAgICAgcHJlcGFyZShwYXlsb2FkKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInNsb3RcIjoge1xuICAgICAgICAgIGNvbnN0IHsgaW5kZXgsIGlmYWNlIH0gPSByYXdUcmVlO1xuICAgICAgICAgIGFzc2VydC50eXBlb2YoaW5kZXgsIFwibnVtYmVyXCIpO1xuICAgICAgICAgIE5hdChpbmRleCk7XG4gICAgICAgICAgaWYgKGlmYWNlICE9PSB2b2lkIDApIHtcbiAgICAgICAgICAgIGFzc2VydC50eXBlb2YoaWZhY2UsIFwic3RyaW5nXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImhpbGJlcnRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgb3JpZ2luYWwsIHJlc3QgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgXCJvcmlnaW5hbFwiIGluIHJhd1RyZWUgfHwgdGhyb3dSZWRhY3RlZGBJbnZhbGlkIEhpbGJlcnQgSG90ZWwgZW5jb2RpbmcgJHtyYXdUcmVlfWA7XG4gICAgICAgICAgcHJlcGFyZShvcmlnaW5hbCk7XG4gICAgICAgICAgaWYgKFwicmVzdFwiIGluIHJhd1RyZWUpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzdCAhPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3QgJHtyZXN0fSBlbmNvZGluZyBtdXN0IGJlIGFuIG9iamVjdGA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVzdCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3QgJHtyZXN0fSBlbmNvZGluZyBtdXN0IG5vdCBiZSBudWxsYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpc0FycmF5NyhyZXN0KSkge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3QgJHtyZXN0fSBlbmNvZGluZyBtdXN0IG5vdCBiZSBhbiBhcnJheWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoUUNMQVNTIGluIHJlc3QpIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN0IGVuY29kaW5nICR7cmVzdH0gbXVzdCBub3QgY29udGFpbiAke3F1b3RlKFFDTEFTUyl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG5hbWVzID0gb3duS2V5czE0KHJlc3QpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIG5hbWVzKSB7XG4gICAgICAgICAgICAgIHR5cGVvZiBuYW1lID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgUHJvcGVydHkgbmFtZSAke25hbWV9IG9mICR7cmF3VHJlZX0gbXVzdCBiZSBhIHN0cmluZ2A7XG4gICAgICAgICAgICAgIHByZXBhcmUocmVzdFtuYW1lXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICAgIGNvbnN0IHsgbmFtZSwgbWVzc2FnZSB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBpZiAodHlwZW9mIG5hbWUgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW52YWxpZCBlcnJvciBuYW1lIHR5cGVvZiAke3F1b3RlKHR5cGVvZiBuYW1lKX1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBnZXRFcnJvckNvbnN0cnVjdG9yKG5hbWUpICE9PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBNdXN0IGJlIHRoZSBuYW1lIG9mIGFuIEVycm9yIGNvbnN0cnVjdG9yICR7bmFtZX1gO1xuICAgICAgICAgIHR5cGVvZiBtZXNzYWdlID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgaW52YWxpZCBlcnJvciBtZXNzYWdlIHR5cGVvZiAke3F1b3RlKHR5cGVvZiBtZXNzYWdlKX1gO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgYXNzZXJ0LmZhaWwocmVkYWN0ZWRgdW5yZWNvZ25pemVkICR7cXVvdGUoUUNMQVNTKX0gJHtxdW90ZShxY2xhc3MpfWAsIFR5cGVFcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGlzQXJyYXk3KHJhd1RyZWUpKSB7XG4gICAgICBjb25zdCB7IGxlbmd0aCB9ID0gcmF3VHJlZTtcbiAgICAgIGZvciAobGV0IGkzID0gMDsgaTMgPCBsZW5ndGg7IGkzICs9IDEpIHtcbiAgICAgICAgcHJlcGFyZShyYXdUcmVlW2kzXSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG5hbWVzID0gb3duS2V5czE0KHJhd1RyZWUpO1xuICAgICAgZm9yIChjb25zdCBuYW1lIG9mIG5hbWVzKSB7XG4gICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUHJvcGVydHkgbmFtZSAke25hbWV9IG9mICR7cmF3VHJlZX0gbXVzdCBiZSBhIHN0cmluZ2A7XG4gICAgICAgIH1cbiAgICAgICAgcHJlcGFyZShyYXdUcmVlW25hbWVdKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IG1ha2VJbmRlbnRlciA9IHNob3VsZEluZGVudCA/IG1ha2VZZXNJbmRlbnRlciA6IG1ha2VOb0luZGVudGVyO1xuICBsZXQgb3V0ID0gbWFrZUluZGVudGVyKCk7XG4gIGNvbnN0IGRlY29kZTMgPSAocmF3VHJlZSkgPT4ge1xuICAgIHJldHVybiByZWN1cihyYXdUcmVlKTtcbiAgfTtcbiAgY29uc3QgZGVjb2RlUHJvcGVydHkgPSAobmFtZSwgdmFsdWUpID0+IHtcbiAgICBvdXQubGluZSgpO1xuICAgIGlmIChuYW1lID09PSBcIl9fcHJvdG9fX1wiKSB7XG4gICAgICBvdXQubmV4dChgW1wiX19wcm90b19fXCJdOmApO1xuICAgIH0gZWxzZSBpZiAoaWRlbnRQYXR0ZXJuLnRlc3QobmFtZSkpIHtcbiAgICAgIG91dC5uZXh0KGAke25hbWV9OmApO1xuICAgIH0gZWxzZSB7XG4gICAgICBvdXQubmV4dChgJHtxdW90ZTIobmFtZSl9OmApO1xuICAgIH1cbiAgICBkZWNvZGUzKHZhbHVlKTtcbiAgICBvdXQubmV4dChcIixcIik7XG4gIH07XG4gIGNvbnN0IHJlY3VyID0gKHJhd1RyZWUpID0+IHtcbiAgICBpZiAoaXNQcmltaXRpdmUyKHJhd1RyZWUpKSB7XG4gICAgICByZXR1cm4gb3V0Lm5leHQocXVvdGUyKHJhd1RyZWUpKTtcbiAgICB9XG4gICAgYXNzZXJ0LnR5cGVvZihyYXdUcmVlLCBcIm9iamVjdFwiKTtcbiAgICBhc3NlcnQocmF3VHJlZSAhPT0gbnVsbCk7XG4gICAgaWYgKFFDTEFTUyBpbiByYXdUcmVlKSB7XG4gICAgICBjb25zdCBxY2xhc3MgPSByYXdUcmVlW1FDTEFTU107XG4gICAgICBhc3NlcnQudHlwZW9mKHFjbGFzcywgXCJzdHJpbmdcIik7XG4gICAgICBhc3NlcnQoIWlzQXJyYXk3KHJhd1RyZWUpKTtcbiAgICAgIHN3aXRjaCAocmF3VHJlZVtcIkBxY2xhc3NcIl0pIHtcbiAgICAgICAgLy9cbiAgICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgICAgICBjYXNlIFwiTmFOXCI6XG4gICAgICAgIGNhc2UgXCJJbmZpbml0eVwiOlxuICAgICAgICBjYXNlIFwiLUluZmluaXR5XCI6IHtcbiAgICAgICAgICByZXR1cm4gb3V0Lm5leHQocWNsYXNzKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgICBjb25zdCB7IGRpZ2l0cyB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKGRpZ2l0cywgXCJzdHJpbmdcIik7XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGAke0JpZ0ludChkaWdpdHMpfW5gKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiQEBhc3luY0l0ZXJhdG9yXCI6IHtcbiAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoXCJTeW1ib2wuYXN5bmNJdGVyYXRvclwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgICBjb25zdCB7IG5hbWUgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZihuYW1lLCBcInN0cmluZ1wiKTtcbiAgICAgICAgICBjb25zdCBzeW0gPSBwYXNzYWJsZVN5bWJvbEZvck5hbWUobmFtZSk7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZihzeW0sIFwic3ltYm9sXCIpO1xuICAgICAgICAgIGNvbnN0IHJlZ2lzdGVyZWROYW1lID0gbmFtZUZvclBhc3NhYmxlU3ltYm9sKHN5bSk7XG4gICAgICAgICAgaWYgKHJlZ2lzdGVyZWROYW1lID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gQXRBdFByZWZpeFBhdHRlcm4yLmV4ZWMobmFtZSk7XG4gICAgICAgICAgICBhc3NlcnQobWF0Y2ggIT09IG51bGwpO1xuICAgICAgICAgICAgY29uc3Qgc3VmZml4ID0gbWF0Y2hbMV07XG4gICAgICAgICAgICBhc3NlcnQoU3ltYm9sW3N1ZmZpeF0gPT09IHN5bSk7XG4gICAgICAgICAgICBhc3NlcnQoaWRlbnRQYXR0ZXJuLnRlc3Qoc3VmZml4KSk7XG4gICAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoYFN5bWJvbC4ke3N1ZmZpeH1gKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGBwYXNzYWJsZVN5bWJvbEZvck5hbWUoJHtxdW90ZTIocmVnaXN0ZXJlZE5hbWUpfSlgKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgICBjb25zdCB7IHRhZywgcGF5bG9hZCB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBvdXQubmV4dChgbWFrZVRhZ2dlZCgke3F1b3RlMih0YWcpfWApO1xuICAgICAgICAgIG91dC5uZXh0KFwiLFwiKTtcbiAgICAgICAgICBkZWNvZGUzKHBheWxvYWQpO1xuICAgICAgICAgIHJldHVybiBvdXQubmV4dChcIilcIik7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInNsb3RcIjoge1xuICAgICAgICAgIGNvbnN0IHsgaWZhY2UgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgY29uc3QgaW5kZXggPSBOdW1iZXIoTmF0KHJhd1RyZWUuaW5kZXgpKTtcbiAgICAgICAgICBjb25zdCBuZXN0ZWRSZW5kZXIgPSAoYXJnKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvbGRPdXQgPSBvdXQ7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBvdXQgPSBtYWtlTm9JbmRlbnRlcigpO1xuICAgICAgICAgICAgICBkZWNvZGUzKGFyZyk7XG4gICAgICAgICAgICAgIHJldHVybiBvdXQuZG9uZSgpO1xuICAgICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgb3V0ID0gb2xkT3V0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYgKGluZGV4IDwgc2xvdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCByZW5kZXJlZFNsb3QgPSBuZXN0ZWRSZW5kZXIoc2xvdHNbaW5kZXhdKTtcbiAgICAgICAgICAgIHJldHVybiBpZmFjZSA9PT0gdm9pZCAwID8gb3V0Lm5leHQoYHNsb3RUb1ZhbCgke3JlbmRlcmVkU2xvdH0pYCkgOiBvdXQubmV4dChgc2xvdFRvVmFsKCR7cmVuZGVyZWRTbG90fSwke25lc3RlZFJlbmRlcihpZmFjZSl9KWApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gaWZhY2UgPT09IHZvaWQgMCA/IG91dC5uZXh0KGBzbG90KCR7aW5kZXh9KWApIDogb3V0Lm5leHQoYHNsb3QoJHtpbmRleH0sJHtuZXN0ZWRSZW5kZXIoaWZhY2UpfSlgKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiaGlsYmVydFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBvcmlnaW5hbCwgcmVzdCB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBvdXQub3BlbihcIntcIik7XG4gICAgICAgICAgZGVjb2RlUHJvcGVydHkoUUNMQVNTLCBvcmlnaW5hbCk7XG4gICAgICAgICAgaWYgKFwicmVzdFwiIGluIHJhd1RyZWUpIHtcbiAgICAgICAgICAgIGFzc2VydC50eXBlb2YocmVzdCwgXCJvYmplY3RcIik7XG4gICAgICAgICAgICBhc3NlcnQocmVzdCAhPT0gbnVsbCk7XG4gICAgICAgICAgICBjb25zdCBuYW1lcyA9IG93bktleXMxNChyZXN0KTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykge1xuICAgICAgICAgICAgICBpZiAodHlwZW9mIG5hbWUgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFByb3BlcnR5IG5hbWUgJHtxdW90ZShcbiAgICAgICAgICAgICAgICAgIG5hbWVcbiAgICAgICAgICAgICAgICApfSBvZiAke3Jlc3R9IG11c3QgYmUgYSBzdHJpbmdgO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGRlY29kZVByb3BlcnR5KG5hbWUsIHJlc3RbbmFtZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gb3V0LmNsb3NlKFwifVwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBtZXNzYWdlLFxuICAgICAgICAgICAgY2F1c2UgPSB2b2lkIDAsXG4gICAgICAgICAgICBlcnJvcnMgPSB2b2lkIDBcbiAgICAgICAgICB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBjYXVzZSA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgZXJyb3IgY2F1c2Ugbm90IHlldCBpbXBsZW1lbnRlZCBpbiBtYXJzaGFsLWp1c3RpbmA7XG4gICAgICAgICAgbmFtZSAhPT0gYEFnZ3JlZ2F0ZUVycm9yYCB8fCB0aHJvd1JlZGFjdGVkYEFnZ3JlZ2F0ZUVycm9yIG5vdCB5ZXQgaW1wbGVtZW50ZWQgaW4gbWFyc2hhbC1qdXN0aW5gO1xuICAgICAgICAgIGVycm9ycyA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgZXJyb3IgZXJyb3JzIG5vdCB5ZXQgaW1wbGVtZW50ZWQgaW4gbWFyc2hhbC1qdXN0aW5gO1xuICAgICAgICAgIHJldHVybiBvdXQubmV4dChgJHtuYW1lfSgke3F1b3RlMihtZXNzYWdlKX0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRocm93IGFzc2VydC5mYWlsKFxuICAgICAgICAgICAgcmVkYWN0ZWRgdW5yZWNvZ25pemVkICR7cXVvdGUoUUNMQVNTKX0gJHtxdW90ZShxY2xhc3MpfWAsXG4gICAgICAgICAgICBUeXBlRXJyb3JcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChpc0FycmF5NyhyYXdUcmVlKSkge1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHJhd1RyZWU7XG4gICAgICBpZiAobGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBvdXQubmV4dChcIltdXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3V0Lm9wZW4oXCJbXCIpO1xuICAgICAgICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgbGVuZ3RoOyBpMyArPSAxKSB7XG4gICAgICAgICAgb3V0LmxpbmUoKTtcbiAgICAgICAgICBkZWNvZGUzKHJhd1RyZWVbaTNdKTtcbiAgICAgICAgICBvdXQubmV4dChcIixcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dC5jbG9zZShcIl1cIik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG5hbWVzID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvd25LZXlzMTQocmF3VHJlZSlcbiAgICAgICk7XG4gICAgICBpZiAobmFtZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBvdXQubmV4dChcInt9XCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3V0Lm9wZW4oXCJ7XCIpO1xuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHtcbiAgICAgICAgICBkZWNvZGVQcm9wZXJ0eShuYW1lLCByYXdUcmVlW25hbWVdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0LmNsb3NlKFwifVwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHByZXBhcmUoZW5jb2RpbmcpO1xuICBkZWNvZGUzKGVuY29kaW5nKTtcbiAgcmV0dXJuIG91dC5kb25lKCk7XG59O1xuaGFyZGVuKGRlY29kZVRvSnVzdGluKTtcbnZhciBwYXNzYWJsZUFzSnVzdGluID0gKHBhc3NhYmxlLCBzaG91bGRJbmRlbnQgPSB0cnVlKSA9PiB7XG4gIGxldCBzbG90Q291bnQgPSAwO1xuICBjb25zdCBjb252ZXJ0VmFsVG9TbG90ID0gKHZhbCkgPT4gYHMke3Nsb3RDb3VudCsrfWA7XG4gIGNvbnN0IHsgdG9DYXBEYXRhOiB0b0NhcERhdGEyIH0gPSBtYWtlTWFyc2hhbChjb252ZXJ0VmFsVG9TbG90KTtcbiAgY29uc3QgeyBib2R5LCBzbG90cyB9ID0gdG9DYXBEYXRhMihwYXNzYWJsZSk7XG4gIGNvbnN0IGVuY29kZWQgPSBKU09OLnBhcnNlKGJvZHkpO1xuICByZXR1cm4gZGVjb2RlVG9KdXN0aW4oZW5jb2RlZCwgc2hvdWxkSW5kZW50LCBzbG90cyk7XG59O1xuaGFyZGVuKHBhc3NhYmxlQXNKdXN0aW4pO1xudmFyIHFwID0gKHBheWxvYWQpID0+IGBcXGAke3Bhc3NhYmxlQXNKdXN0aW4oaGFyZGVuKHBheWxvYWQpLCB0cnVlKX1cXGBgO1xuaGFyZGVuKHFwKTtcblxuLy9cbnZhciB7IGlzQXJyYXk6IGlzQXJyYXk4IH0gPSBBcnJheTtcbnZhciB7IGZyb21FbnRyaWVzOiBmcm9tRW50cmllczUsIGlzOiBpczMgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IG93bktleXMxNSB9ID0gUmVmbGVjdDtcbnZhciByQzAgPSAvW1xceDAwLVxceDFGXS87XG52YXIgZ2V0U3VmZml4ID0gKHN0ciwgaW5kZXgpID0+IGluZGV4ID09PSAwID8gc3RyIDogc3RyLnN1YnN0cmluZyhpbmRleCk7XG52YXIgcmVjb3JkTmFtZXMgPSAocmVjb3JkKSA9PiAoXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIGhhcmRlbihcbiAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgIG93bktleXMxNShyZWNvcmQpLnNvcnQoKS5yZXZlcnNlKClcbiAgKVxuKTtcbmhhcmRlbihyZWNvcmROYW1lcyk7XG52YXIgcmVjb3JkVmFsdWVzID0gKHJlY29yZCwgbmFtZXMpID0+IGhhcmRlbihuYW1lcy5tYXAoKG5hbWUpID0+IHJlY29yZFtuYW1lXSkpO1xuaGFyZGVuKHJlY29yZFZhbHVlcyk7XG52YXIgemVyb2VzID0gQXJyYXkoMTYpLmZpbGwodm9pZCAwKS5tYXAoKF8sIGkzKSA9PiBcIjBcIi5yZXBlYXQoaTMpKTtcbnZhciB6ZXJvUGFkID0gKG4yLCBzaXplKSA9PiB7XG4gIGNvbnN0IG5TdHIgPSBgJHtuMn1gO1xuICBjb25zdCBmaWxsTGVuID0gc2l6ZSAtIG5TdHIubGVuZ3RoO1xuICBpZiAoZmlsbExlbiA9PT0gMCkgcmV0dXJuIG5TdHI7XG4gIGFzc2VydChmaWxsTGVuID4gMCAmJiBmaWxsTGVuIDwgemVyb2VzLmxlbmd0aCk7XG4gIHJldHVybiBgJHt6ZXJvZXNbZmlsbExlbl19JHtuU3RyfWA7XG59O1xuaGFyZGVuKHplcm9QYWQpO1xudmFyIGFzTnVtYmVyID0gbmV3IEZsb2F0NjRBcnJheSgxKTtcbnZhciBhc0JpdHMgPSBuZXcgQmlnVWludDY0QXJyYXkoYXNOdW1iZXIuYnVmZmVyKTtcbnZhciBDYW5vbmljYWxOYU5CaXRzID0gXCJmZmY4MDAwMDAwMDAwMDAwXCI7XG52YXIgZW5jb2RlQmluYXJ5NjQgPSAobjIpID0+IHtcbiAgaWYgKGlzMyhuMiwgLTApKSB7XG4gICAgbjIgPSAwO1xuICB9IGVsc2UgaWYgKGlzMyhuMiwgTmFOKSkge1xuICAgIHJldHVybiBgZiR7Q2Fub25pY2FsTmFOQml0c31gO1xuICB9XG4gIGFzTnVtYmVyWzBdID0gbjI7XG4gIGxldCBiaXRzID0gYXNCaXRzWzBdO1xuICBpZiAobjIgPCAwKSB7XG4gICAgYml0cyBePSAweGZmZmZmZmZmZmZmZmZmZmZuO1xuICB9IGVsc2Uge1xuICAgIGJpdHMgXj0gMHg4MDAwMDAwMDAwMDAwMDAwbjtcbiAgfVxuICByZXR1cm4gYGYke3plcm9QYWQoYml0cy50b1N0cmluZygxNiksIDE2KX1gO1xufTtcbnZhciBkZWNvZGVCaW5hcnk2NCA9IChlbmNvZGVkLCBza2lwID0gMCkgPT4ge1xuICBlbmNvZGVkLmNoYXJBdChza2lwKSA9PT0gXCJmXCIgfHwgdGhyb3dSZWRhY3RlZGBFbmNvZGVkIG51bWJlciBleHBlY3RlZDogJHtlbmNvZGVkfWA7XG4gIGxldCBiaXRzID0gQmlnSW50KGAweCR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXAgKyAxKX1gKTtcbiAgaWYgKGVuY29kZWQuY2hhckF0KHNraXAgKyAxKSA8IFwiOFwiKSB7XG4gICAgYml0cyBePSAweGZmZmZmZmZmZmZmZmZmZmZuO1xuICB9IGVsc2Uge1xuICAgIGJpdHMgXj0gMHg4MDAwMDAwMDAwMDAwMDAwbjtcbiAgfVxuICBhc0JpdHNbMF0gPSBiaXRzO1xuICBjb25zdCByZXN1bHQgPSBhc051bWJlclswXTtcbiAgIWlzMyhyZXN1bHQsIC0wKSB8fCB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgbmVnYXRpdmUgemVybzogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgZW5jb2RlQmlnSW50ID0gKG4yKSA9PiB7XG4gIGNvbnN0IGFicyA9IG4yIDwgMG4gPyAtbjIgOiBuMjtcbiAgY29uc3QgbkRpZ2l0cyA9IGFicy50b1N0cmluZygpLmxlbmd0aDtcbiAgY29uc3QgbERpZ2l0cyA9IG5EaWdpdHMudG9TdHJpbmcoKS5sZW5ndGg7XG4gIGlmIChuMiA8IDBuKSB7XG4gICAgcmV0dXJuIGBuJHsvL1xuICAgIC8vXG4gICAgXCIjXCIucmVwZWF0KGxEaWdpdHMgLSAxKX0key8vXG4gICAgKDEwICoqIGxEaWdpdHMgLSBuRGlnaXRzKS50b1N0cmluZygpLnBhZFN0YXJ0KGxEaWdpdHMsIFwiMFwiKX06JHsvL1xuICAgICgxMG4gKiogQmlnSW50KG5EaWdpdHMpICsgbjIpLnRvU3RyaW5nKCkucGFkU3RhcnQobkRpZ2l0cywgXCIwXCIpfWA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGBwJHsvL1xuICAgIC8vXG4gICAgXCJ+XCIucmVwZWF0KGxEaWdpdHMgLSAxKX0key8vXG4gICAgbkRpZ2l0c306JHsvL1xuICAgIG4yfWA7XG4gIH1cbn07XG52YXIgckJpZ0ludFBheWxvYWQgPSAvKFswLTldKykoOihbMC05XSskfCl8KS9zO1xudmFyIGRlY29kZUJpZ0ludCA9IChlbmNvZGVkKSA9PiB7XG4gIGNvbnN0IHR5cGVQcmVmaXggPSBlbmNvZGVkLmNoYXJBdCgwKTtcbiAgdHlwZVByZWZpeCA9PT0gXCJwXCIgfHwgdHlwZVByZWZpeCA9PT0gXCJuXCIgfHwgdGhyb3dSZWRhY3RlZGBFbmNvZGVkIGJpZ2ludCBleHBlY3RlZDogJHtlbmNvZGVkfWA7XG4gIGNvbnN0IHtcbiAgICBpbmRleDogbERpZ2l0cyxcbiAgICAxOiBzbkRpZ2l0cyxcbiAgICAyOiB0YWlsLFxuICAgIDM6IGRpZ2l0c1xuICB9ID0gZW5jb2RlZC5tYXRjaChyQmlnSW50UGF5bG9hZCkgfHwgdGhyb3dSZWRhY3RlZGBEaWdpdCBjb3VudCBleHBlY3RlZDogJHtlbmNvZGVkfWA7XG4gIHNuRGlnaXRzLmxlbmd0aCA9PT0gbERpZ2l0cyB8fCB0aHJvd1JlZGFjdGVkYFVuYXJ5LXByZWZpeGVkIGRlY2ltYWwgZGlnaXQgY291bnQgZXhwZWN0ZWQ6ICR7ZW5jb2RlZH1gO1xuICBsZXQgbkRpZ2l0cyA9IHBhcnNlSW50KHNuRGlnaXRzLCAxMCk7XG4gIGlmICh0eXBlUHJlZml4ID09PSBcIm5cIikge1xuICAgIG5EaWdpdHMgPSAxMCAqKiAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICBsRGlnaXRzIC0gbkRpZ2l0cztcbiAgfVxuICB0YWlsLmNoYXJBdCgwKSA9PT0gXCI6XCIgfHwgdGhyb3dSZWRhY3RlZGBTZXBhcmF0b3IgZXhwZWN0ZWQ6ICR7ZW5jb2RlZH1gO1xuICBkaWdpdHMubGVuZ3RoID09PSBuRGlnaXRzIHx8IHRocm93UmVkYWN0ZWRgRml4ZWQtbGVuZ3RoIGRpZ2l0IHNlcXVlbmNlIGV4cGVjdGVkOiAke2VuY29kZWR9YDtcbiAgbGV0IG4yID0gQmlnSW50KGRpZ2l0cyk7XG4gIGlmICh0eXBlUHJlZml4ID09PSBcIm5cIikge1xuICAgIG4yID0gLSgxMG4gKiogQmlnSW50KG5EaWdpdHMpIC0gbjIpO1xuICB9XG4gIHJldHVybiBuMjtcbn07XG52YXIgc3RyaW5nRXNjYXBlcyA9IEFycmF5KDM0KS5maWxsKHZvaWQgMCkubWFwKChfLCBjcCkgPT4ge1xuICBzd2l0Y2ggKFN0cmluZy5mcm9tQ2hhckNvZGUoY3ApKSB7XG4gICAgY2FzZSBcIiBcIjpcbiAgICAgIHJldHVybiBcIiFfXCI7XG4gICAgY2FzZSBcIiFcIjpcbiAgICAgIHJldHVybiBcIiF8XCI7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBgISR7U3RyaW5nLmZyb21DaGFyQ29kZShjcCArIDMzKX1gO1xuICB9XG59KTtcbnN0cmluZ0VzY2FwZXNbXCJeXCIuY2hhckNvZGVBdCgwKV0gPSBcIl9AXCI7XG5zdHJpbmdFc2NhcGVzW1wiX1wiLmNoYXJDb2RlQXQoMCldID0gXCJfX1wiO1xudmFyIGVuY29kZUNvbXBhY3RTdHJpbmdTdWZmaXggPSAoc3RyKSA9PiBzdHIucmVwbGFjZSgvW1xcMC0hXl9dL2csIChjaCkgPT4gc3RyaW5nRXNjYXBlc1tjaC5jaGFyQ29kZUF0KDApXSk7XG52YXIgZGVjb2RlQ29tcGFjdFN0cmluZ1N1ZmZpeCA9IChlbmNvZGVkKSA9PiB7XG4gIHJldHVybiBlbmNvZGVkLnJlcGxhY2UoLyhbXFwwLSFfXSkoLnxcXG4pPy9nLCAoZXNjLCBwcmVmaXgsIHN1ZmZpeCkgPT4ge1xuICAgIHN3aXRjaCAoZXNjKSB7XG4gICAgICBjYXNlIFwiIV9cIjpcbiAgICAgICAgcmV0dXJuIFwiIFwiO1xuICAgICAgY2FzZSBcIiF8XCI6XG4gICAgICAgIHJldHVybiBcIiFcIjtcbiAgICAgIGNhc2UgXCJfQFwiOlxuICAgICAgICByZXR1cm4gXCJeXCI7XG4gICAgICBjYXNlIFwiX19cIjpcbiAgICAgICAgcmV0dXJuIFwiX1wiO1xuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBjb25zdCBjaCA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBzdWZmaXhcbiAgICAgICAgKTtcbiAgICAgICAgcHJlZml4ID09PSBcIiFcIiAmJiBzdWZmaXggIT09IHZvaWQgMCAmJiBjaCA+PSBcIiFcIiAmJiBjaCA8PSBcIkBcIiB8fCB0aHJvd1JlZGFjdGVkYGludmFsaWQgc3RyaW5nIGVzY2FwZTogJHtxdW90ZShlc2MpfWA7XG4gICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoLmNoYXJDb2RlQXQoMCkgLSAzMyk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgZW5jb2RlTGVnYWN5U3RyaW5nU3VmZml4ID0gKHN0cikgPT4gc3RyO1xudmFyIGRlY29kZUxlZ2FjeVN0cmluZ1N1ZmZpeCA9IChlbmNvZGVkKSA9PiBlbmNvZGVkO1xudmFyIGVuY29kZUNvbXBhY3RBcnJheSA9IChhcnJheSwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgY29uc3QgY2hhcnMgPSBbXCJeXCJdO1xuICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgYXJyYXkpIHtcbiAgICBjb25zdCBlbmMgPSBlbmNvZGVQYXNzYWJsZShlbGVtZW50KTtcbiAgICBjaGFycy5wdXNoKGVuYywgXCIgXCIpO1xuICB9XG4gIHJldHVybiBjaGFycy5qb2luKFwiXCIpO1xufTtcbnZhciBkZWNvZGVDb21wYWN0QXJyYXkgPSAoZW5jb2RlZCwgZGVjb2RlUGFzc2FibGUsIHNraXAgPSAwKSA9PiB7XG4gIGNvbnN0IGVsZW1lbnRzID0gW107XG4gIGxldCBkZXB0aCA9IDA7XG4gIGxldCBuZXh0SW5kZXggPSBza2lwICsgMTtcbiAgbGV0IGN1cnJlbnRFbGVtZW50U3RhcnQgPSBza2lwICsgMTtcbiAgZm9yIChjb25zdCB7IDA6IGNoLCBpbmRleDogaTMgfSBvZiBlbmNvZGVkLm1hdGNoQWxsKC9bXFxeIF0vZykpIHtcbiAgICBjb25zdCBpbmRleCA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgaTNcbiAgICApO1xuICAgIGlmIChpbmRleCA8PSBza2lwKSB7XG4gICAgICBpZiAoaW5kZXggPT09IHNraXApIHtcbiAgICAgICAgY2ggPT09IFwiXlwiIHx8IHRocm93UmVkYWN0ZWRgRW5jb2RlZCBhcnJheSBleHBlY3RlZDogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGNoID09PSBcIl5cIikge1xuICAgICAgZGVwdGggKz0gMTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGluZGV4ID09PSBuZXh0SW5kZXgpIHtcbiAgICAgICAgZGVwdGggLT0gMTtcbiAgICAgICAgZGVwdGggPj0gMCB8fCAvL1xuICAgICAgICB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgYXJyYXkgZWxlbWVudCB0ZXJtaW5hdG9yOiAke2VuY29kZWQuc2xpY2Uoc2tpcCwgaW5kZXggKyAyKX1gO1xuICAgICAgfVxuICAgICAgaWYgKGRlcHRoID09PSAwKSB7XG4gICAgICAgIGVsZW1lbnRzLnB1c2goXG4gICAgICAgICAgZGVjb2RlUGFzc2FibGUoZW5jb2RlZC5zbGljZShjdXJyZW50RWxlbWVudFN0YXJ0LCBpbmRleCkpXG4gICAgICAgICk7XG4gICAgICAgIGN1cnJlbnRFbGVtZW50U3RhcnQgPSBpbmRleCArIDE7XG4gICAgICB9XG4gICAgfVxuICAgIG5leHRJbmRleCA9IGluZGV4ICsgMTtcbiAgfVxuICBkZXB0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYHVudGVybWluYXRlZCBhcnJheTogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgbmV4dEluZGV4ID09PSBlbmNvZGVkLmxlbmd0aCB8fCB0aHJvd1JlZGFjdGVkYHVudGVybWluYXRlZCBhcnJheSBlbGVtZW50OiAke2dldFN1ZmZpeChcbiAgICBlbmNvZGVkLFxuICAgIGN1cnJlbnRFbGVtZW50U3RhcnRcbiAgKX1gO1xuICByZXR1cm4gaGFyZGVuKGVsZW1lbnRzKTtcbn07XG52YXIgZW5jb2RlTGVnYWN5QXJyYXkgPSAoYXJyYXksIGVuY29kZVBhc3NhYmxlKSA9PiB7XG4gIGNvbnN0IGNoYXJzID0gW1wiW1wiXTtcbiAgZm9yIChjb25zdCBlbGVtZW50IG9mIGFycmF5KSB7XG4gICAgY29uc3QgZW5jID0gZW5jb2RlUGFzc2FibGUoZWxlbWVudCk7XG4gICAgZm9yIChjb25zdCBjMiBvZiBlbmMpIHtcbiAgICAgIGlmIChjMiA9PT0gXCJcXDBcIiB8fCBjMiA9PT0gXCJcdTAwMDFcIikge1xuICAgICAgICBjaGFycy5wdXNoKFwiXHUwMDAxXCIpO1xuICAgICAgfVxuICAgICAgY2hhcnMucHVzaChjMik7XG4gICAgfVxuICAgIGNoYXJzLnB1c2goXCJcXDBcIik7XG4gIH1cbiAgcmV0dXJuIGNoYXJzLmpvaW4oXCJcIik7XG59O1xudmFyIGRlY29kZUxlZ2FjeUFycmF5ID0gKGVuY29kZWQsIGRlY29kZVBhc3NhYmxlLCBza2lwID0gMCkgPT4ge1xuICBjb25zdCBlbGVtZW50cyA9IFtdO1xuICBjb25zdCBlbGVtQ2hhcnMgPSBbXTtcbiAgbGV0IHN0aWxsVG9Ta2lwID0gc2tpcCArIDE7XG4gIGxldCBpbkVzY2FwZSA9IGZhbHNlO1xuICBmb3IgKGNvbnN0IGMyIG9mIGVuY29kZWQpIHtcbiAgICBpZiAoc3RpbGxUb1NraXAgPiAwKSB7XG4gICAgICBzdGlsbFRvU2tpcCAtPSAxO1xuICAgICAgaWYgKHN0aWxsVG9Ta2lwID09PSAwKSB7XG4gICAgICAgIGMyID09PSBcIltcIiB8fCB0aHJvd1JlZGFjdGVkYEVuY29kZWQgYXJyYXkgZXhwZWN0ZWQ6ICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChpbkVzY2FwZSkge1xuICAgICAgYzIgPT09IFwiXFwwXCIgfHwgYzIgPT09IFwiXHUwMDAxXCIgfHwgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIGNoYXJhY3RlciBhZnRlciB1MDAwMSBlc2NhcGU6ICR7YzJ9YDtcbiAgICAgIGVsZW1DaGFycy5wdXNoKGMyKTtcbiAgICB9IGVsc2UgaWYgKGMyID09PSBcIlxcMFwiKSB7XG4gICAgICBjb25zdCBlbmNvZGVkRWxlbWVudCA9IGVsZW1DaGFycy5qb2luKFwiXCIpO1xuICAgICAgZWxlbUNoYXJzLmxlbmd0aCA9IDA7XG4gICAgICBjb25zdCBlbGVtZW50ID0gZGVjb2RlUGFzc2FibGUoZW5jb2RlZEVsZW1lbnQpO1xuICAgICAgZWxlbWVudHMucHVzaChlbGVtZW50KTtcbiAgICB9IGVsc2UgaWYgKGMyID09PSBcIlx1MDAwMVwiKSB7XG4gICAgICBpbkVzY2FwZSA9IHRydWU7XG4gICAgICBjb250aW51ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbUNoYXJzLnB1c2goYzIpO1xuICAgIH1cbiAgICBpbkVzY2FwZSA9IGZhbHNlO1xuICB9XG4gICFpbkVzY2FwZSB8fCB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZW5kIG9mIGVuY29kaW5nICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gIGVsZW1DaGFycy5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBlbmNvZGluZyB0ZXJtaW5hdGVkIGVhcmx5OiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICByZXR1cm4gaGFyZGVuKGVsZW1lbnRzKTtcbn07XG52YXIgZW5jb2RlQnl0ZUFycmF5ID0gKGJ5dGVBcnJheSwgX2VuY29kZVBhc3NhYmxlKSA9PiB7XG4gIHRocm93UmVkYWN0ZWRgZW5jb2RlUGFzc2FibGUoYnl0ZUFycmF5KSBub3QgeWV0IGltcGxlbWVudGVkOiAke2J5dGVBcnJheX1gO1xuICByZXR1cm4gXCJcIjtcbn07XG52YXIgZW5jb2RlUmVjb3JkID0gKHJlY29yZCwgZW5jb2RlQXJyYXkyLCBlbmNvZGVQYXNzYWJsZSkgPT4ge1xuICBjb25zdCBuYW1lcyA9IHJlY29yZE5hbWVzKHJlY29yZCk7XG4gIGNvbnN0IHZhbHVlczggPSByZWNvcmRWYWx1ZXMocmVjb3JkLCBuYW1lcyk7XG4gIHJldHVybiBgKCR7ZW5jb2RlQXJyYXkyKGhhcmRlbihbbmFtZXMsIHZhbHVlczhdKSwgZW5jb2RlUGFzc2FibGUpfWA7XG59O1xudmFyIGRlY29kZVJlY29yZCA9IChlbmNvZGVkLCBkZWNvZGVBcnJheTIsIGRlY29kZVBhc3NhYmxlLCBza2lwID0gMCkgPT4ge1xuICBhc3NlcnQoZW5jb2RlZC5jaGFyQXQoc2tpcCkgPT09IFwiKFwiKTtcbiAgY29uc3QgdW56aXBwZWRFbnRyaWVzID0gZGVjb2RlQXJyYXkyKGVuY29kZWQsIGRlY29kZVBhc3NhYmxlLCBza2lwICsgMSk7XG4gIHVuemlwcGVkRW50cmllcy5sZW5ndGggPT09IDIgfHwgdGhyb3dSZWRhY3RlZGBleHBlY3RlZCBrZXlzLHZhbHVlcyBwYWlyOiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICBjb25zdCBba2V5czgsIHZhbHNdID0gdW56aXBwZWRFbnRyaWVzO1xuICBwYXNzU3R5bGVPZihrZXlzOCkgPT09IFwiY29weUFycmF5XCIgJiYgcGFzc1N0eWxlT2YodmFscykgPT09IFwiY29weUFycmF5XCIgJiYga2V5czgubGVuZ3RoID09PSB2YWxzLmxlbmd0aCAmJiBrZXlzOC5ldmVyeSgoa2V5KSA9PiB0eXBlb2Yga2V5ID09PSBcInN0cmluZ1wiKSB8fCB0aHJvd1JlZGFjdGVkYG5vdCBhIHZhbGlkIHJlY29yZCBlbmNvZGluZzogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgY29uc3QgbWFwRW50cmllcyA9IGtleXM4Lm1hcCgoa2V5LCBpMykgPT4gW2tleSwgdmFsc1tpM11dKTtcbiAgY29uc3QgcmVjb3JkID0gaGFyZGVuKGZyb21FbnRyaWVzNShtYXBFbnRyaWVzKSk7XG4gIGFzc2VydFJlY29yZChyZWNvcmQsIFwiZGVjb2RlZCByZWNvcmRcIik7XG4gIHJldHVybiByZWNvcmQ7XG59O1xudmFyIGVuY29kZVRhZ2dlZCA9ICh0YWdnZWQsIGVuY29kZUFycmF5MiwgZW5jb2RlUGFzc2FibGUpID0+IGA6JHtlbmNvZGVBcnJheTIoaGFyZGVuKFtnZXRUYWcodGFnZ2VkKSwgdGFnZ2VkLnBheWxvYWRdKSwgZW5jb2RlUGFzc2FibGUpfWA7XG52YXIgZGVjb2RlVGFnZ2VkID0gKGVuY29kZWQsIGRlY29kZUFycmF5MiwgZGVjb2RlUGFzc2FibGUsIHNraXAgPSAwKSA9PiB7XG4gIGFzc2VydChlbmNvZGVkLmNoYXJBdChza2lwKSA9PT0gXCI6XCIpO1xuICBjb25zdCB0YWdnZWRQYXlsb2FkID0gZGVjb2RlQXJyYXkyKGVuY29kZWQsIGRlY29kZVBhc3NhYmxlLCBza2lwICsgMSk7XG4gIHRhZ2dlZFBheWxvYWQubGVuZ3RoID09PSAyIHx8IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQgdGFnLHBheWxvYWQgcGFpcjogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgY29uc3QgW3RhZywgcGF5bG9hZF0gPSB0YWdnZWRQYXlsb2FkO1xuICBwYXNzU3R5bGVPZih0YWcpID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgbm90IGEgdmFsaWQgdGFnZ2VkIGVuY29kaW5nOiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICByZXR1cm4gbWFrZVRhZ2dlZCh0YWcsIHBheWxvYWQpO1xufTtcbnZhciBtYWtlRW5jb2RlUmVtb3RhYmxlID0gKHVuc2FmZUVuY29kZVJlbW90YWJsZSwgdmVyaWZ5RW5jb2RpbmcpID0+IHtcbiAgY29uc3QgZW5jb2RlUmVtb3RhYmxlID0gKHI1LCBpbm5lckVuY29kZSkgPT4ge1xuICAgIGNvbnN0IGVuY29kaW5nID0gdW5zYWZlRW5jb2RlUmVtb3RhYmxlKHI1LCBpbm5lckVuY29kZSk7XG4gICAgdHlwZW9mIGVuY29kaW5nID09PSBcInN0cmluZ1wiICYmIGVuY29kaW5nLmNoYXJBdCgwKSA9PT0gXCJyXCIgfHwgdGhyb3dSZWRhY3RlZGBSZW1vdGFibGUgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiclwiOiAke2VuY29kaW5nfWA7XG4gICAgdmVyaWZ5RW5jb2RpbmcoZW5jb2RpbmcsIFwiUmVtb3RhYmxlXCIpO1xuICAgIHJldHVybiBlbmNvZGluZztcbiAgfTtcbiAgcmV0dXJuIGVuY29kZVJlbW90YWJsZTtcbn07XG52YXIgbWFrZUVuY29kZVByb21pc2UgPSAodW5zYWZlRW5jb2RlUHJvbWlzZSwgdmVyaWZ5RW5jb2RpbmcpID0+IHtcbiAgY29uc3QgZW5jb2RlUHJvbWlzZSA9IChwNCwgaW5uZXJFbmNvZGUpID0+IHtcbiAgICBjb25zdCBlbmNvZGluZyA9IHVuc2FmZUVuY29kZVByb21pc2UocDQsIGlubmVyRW5jb2RlKTtcbiAgICB0eXBlb2YgZW5jb2RpbmcgPT09IFwic3RyaW5nXCIgJiYgZW5jb2RpbmcuY2hhckF0KDApID09PSBcIj9cIiB8fCB0aHJvd1JlZGFjdGVkYFByb21pc2UgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiP1wiOiAke2VuY29kaW5nfWA7XG4gICAgdmVyaWZ5RW5jb2RpbmcoZW5jb2RpbmcsIFwiUHJvbWlzZVwiKTtcbiAgICByZXR1cm4gZW5jb2Rpbmc7XG4gIH07XG4gIHJldHVybiBlbmNvZGVQcm9taXNlO1xufTtcbnZhciBtYWtlRW5jb2RlRXJyb3IgPSAodW5zYWZlRW5jb2RlRXJyb3IsIHZlcmlmeUVuY29kaW5nKSA9PiB7XG4gIGNvbnN0IGVuY29kZUVycm9yID0gKGVyciwgaW5uZXJFbmNvZGUpID0+IHtcbiAgICBjb25zdCBlbmNvZGluZyA9IHVuc2FmZUVuY29kZUVycm9yKGVyciwgaW5uZXJFbmNvZGUpO1xuICAgIHR5cGVvZiBlbmNvZGluZyA9PT0gXCJzdHJpbmdcIiAmJiBlbmNvZGluZy5jaGFyQXQoMCkgPT09IFwiIVwiIHx8IHRocm93UmVkYWN0ZWRgRXJyb3IgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiIVwiOiAke2VuY29kaW5nfWA7XG4gICAgdmVyaWZ5RW5jb2RpbmcoZW5jb2RpbmcsIFwiRXJyb3JcIik7XG4gICAgcmV0dXJuIGVuY29kaW5nO1xuICB9O1xuICByZXR1cm4gZW5jb2RlRXJyb3I7XG59O1xudmFyIG1ha2VJbm5lckVuY29kZSA9IChlbmNvZGVTdHJpbmdTdWZmaXgsIGVuY29kZUFycmF5Miwgb3B0aW9ucykgPT4ge1xuICBjb25zdCB7XG4gICAgZW5jb2RlUmVtb3RhYmxlOiB1bnNhZmVFbmNvZGVSZW1vdGFibGUsXG4gICAgZW5jb2RlUHJvbWlzZTogdW5zYWZlRW5jb2RlUHJvbWlzZSxcbiAgICBlbmNvZGVFcnJvcjogdW5zYWZlRW5jb2RlRXJyb3IsXG4gICAgdmVyaWZ5RW5jb2RpbmcgPSAoKSA9PiB7XG4gICAgfVxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgZW5jb2RlUmVtb3RhYmxlID0gbWFrZUVuY29kZVJlbW90YWJsZShcbiAgICB1bnNhZmVFbmNvZGVSZW1vdGFibGUsXG4gICAgdmVyaWZ5RW5jb2RpbmdcbiAgKTtcbiAgY29uc3QgZW5jb2RlUHJvbWlzZSA9IG1ha2VFbmNvZGVQcm9taXNlKHVuc2FmZUVuY29kZVByb21pc2UsIHZlcmlmeUVuY29kaW5nKTtcbiAgY29uc3QgZW5jb2RlRXJyb3IgPSBtYWtlRW5jb2RlRXJyb3IodW5zYWZlRW5jb2RlRXJyb3IsIHZlcmlmeUVuY29kaW5nKTtcbiAgY29uc3QgaW5uZXJFbmNvZGUgPSAocGFzc2FibGUpID0+IHtcbiAgICBpZiAoaXNFcnJvckxpa2UocGFzc2FibGUpKSB7XG4gICAgICByZXR1cm4gZW5jb2RlRXJyb3IocGFzc2FibGUsIGlubmVyRW5jb2RlKTtcbiAgICB9XG4gICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocGFzc2FibGUpO1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwibnVsbFwiOiB7XG4gICAgICAgIHJldHVybiBcInZcIjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjoge1xuICAgICAgICByZXR1cm4gXCJ6XCI7XG4gICAgICB9XG4gICAgICBjYXNlIFwibnVtYmVyXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZUJpbmFyeTY0KHBhc3NhYmxlKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJzdHJpbmdcIjoge1xuICAgICAgICByZXR1cm4gYHMke2VuY29kZVN0cmluZ1N1ZmZpeChwYXNzYWJsZSl9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJib29sZWFuXCI6IHtcbiAgICAgICAgcmV0dXJuIGBiJHtwYXNzYWJsZX1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJpZ2ludFwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVCaWdJbnQocGFzc2FibGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVSZW1vdGFibGUocGFzc2FibGUsIGlubmVyRW5jb2RlKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVFcnJvcihwYXNzYWJsZSwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICByZXR1cm4gZW5jb2RlUHJvbWlzZShwYXNzYWJsZSwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBuYW1lRm9yUGFzc2FibGVTeW1ib2wocGFzc2FibGUpO1xuICAgICAgICBhc3NlcnQudHlwZW9mKG5hbWUsIFwic3RyaW5nXCIpO1xuICAgICAgICByZXR1cm4gYHkke2VuY29kZVN0cmluZ1N1ZmZpeChuYW1lKX1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVBcnJheTIocGFzc2FibGUsIGlubmVyRW5jb2RlKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJieXRlQXJyYXlcIjoge1xuICAgICAgICByZXR1cm4gZW5jb2RlQnl0ZUFycmF5KHBhc3NhYmxlLCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVSZWNvcmQocGFzc2FibGUsIGVuY29kZUFycmF5MiwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVUYWdnZWQocGFzc2FibGUsIGVuY29kZUFycmF5MiwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGEgJHtxdW90ZShwYXNzU3R5bGUpfSBjYW5ub3QgYmUgdXNlZCBhcyBhIGNvbGxlY3Rpb24gcGFzc2FibGVgO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGlubmVyRW5jb2RlO1xufTtcbnZhciBsaWJlcmFsRGVjb2RlcnMgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIC8qICAgICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIGRlY29kZVJlbW90YWJsZTogKF9lbmNvZGluZywgX2lubmVyRGVjb2RlKSA9PiB2b2lkIDAsXG4gICAgZGVjb2RlUHJvbWlzZTogKF9lbmNvZGluZywgX2lubmVyRGVjb2RlKSA9PiB2b2lkIDAsXG4gICAgZGVjb2RlRXJyb3I6IChfZW5jb2RpbmcsIF9pbm5lckRlY29kZSkgPT4gdm9pZCAwXG4gIH1cbik7XG52YXIgbWFrZUlubmVyRGVjb2RlID0gKGRlY29kZVN0cmluZ1N1ZmZpeCwgZGVjb2RlQXJyYXkyLCBvcHRpb25zKSA9PiB7XG4gIGNvbnN0IHsgZGVjb2RlUmVtb3RhYmxlLCBkZWNvZGVQcm9taXNlLCBkZWNvZGVFcnJvciB9ID0gb3B0aW9ucztcbiAgY29uc3QgaW5uZXJEZWNvZGUgPSAoZW5jb2RlZCwgc2tpcCA9IDApID0+IHtcbiAgICBzd2l0Y2ggKGVuY29kZWQuY2hhckF0KHNraXApKSB7XG4gICAgICBjYXNlIFwidlwiOiB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY2FzZSBcInpcIjoge1xuICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgfVxuICAgICAgY2FzZSBcImZcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlQmluYXJ5NjQoZW5jb2RlZCwgc2tpcCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwic1wiOiB7XG4gICAgICAgIHJldHVybiBkZWNvZGVTdHJpbmdTdWZmaXgoZ2V0U3VmZml4KGVuY29kZWQsIHNraXAgKyAxKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYlwiOiB7XG4gICAgICAgIGNvbnN0IHN1YnN0cmluZyA9IGdldFN1ZmZpeChlbmNvZGVkLCBza2lwICsgMSk7XG4gICAgICAgIGlmIChzdWJzdHJpbmcgPT09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoc3Vic3RyaW5nID09PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBleHBlY3RlZCBlbmNvZGVkIGJvb2xlYW4gdG8gYmUgXCJidHJ1ZVwiIG9yIFwiYmZhbHNlXCI6ICR7c3Vic3RyaW5nfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiblwiOlxuICAgICAgY2FzZSBcInBcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlQmlnSW50KGdldFN1ZmZpeChlbmNvZGVkLCBza2lwKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiclwiOiB7XG4gICAgICAgIHJldHVybiBkZWNvZGVSZW1vdGFibGUoZ2V0U3VmZml4KGVuY29kZWQsIHNraXApLCBpbm5lckRlY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiP1wiOiB7XG4gICAgICAgIHJldHVybiBkZWNvZGVQcm9taXNlKGdldFN1ZmZpeChlbmNvZGVkLCBza2lwKSwgaW5uZXJEZWNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcIiFcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlRXJyb3IoZ2V0U3VmZml4KGVuY29kZWQsIHNraXApLCBpbm5lckRlY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwieVwiOiB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBkZWNvZGVTdHJpbmdTdWZmaXgoZ2V0U3VmZml4KGVuY29kZWQsIHNraXAgKyAxKSk7XG4gICAgICAgIHJldHVybiBwYXNzYWJsZVN5bWJvbEZvck5hbWUobmFtZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiW1wiOlxuICAgICAgY2FzZSBcIl5cIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlQXJyYXkyKGVuY29kZWQsIGlubmVyRGVjb2RlLCBza2lwKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCIoXCI6IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZVJlY29yZChlbmNvZGVkLCBkZWNvZGVBcnJheTIsIGlubmVyRGVjb2RlLCBza2lwKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCI6XCI6IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZVRhZ2dlZChlbmNvZGVkLCBkZWNvZGVBcnJheTIsIGlubmVyRGVjb2RlLCBza2lwKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGRhdGFiYXNlIGtleTogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiBpbm5lckRlY29kZTtcbn07XG52YXIgbWFrZVBhc3NhYmxlS2l0ID0gKG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgZW5jb2RlUmVtb3RhYmxlID0gKHI1LCBfKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke3I1fWAsXG4gICAgZW5jb2RlUHJvbWlzZSA9IChwNCwgXykgPT4gdGhyb3dSZWRhY3RlZGBwcm9taXNlIHVuZXhwZWN0ZWQ6ICR7cDR9YCxcbiAgICBlbmNvZGVFcnJvciA9IChlcnIsIF8pID0+IHRocm93UmVkYWN0ZWRgZXJyb3IgdW5leHBlY3RlZDogJHtlcnJ9YCxcbiAgICBmb3JtYXQgPSBcImxlZ2FjeU9yZGVyZWRcIixcbiAgICBkZWNvZGVSZW1vdGFibGUgPSAoZW5jb2RpbmcsIF8pID0+IHRocm93UmVkYWN0ZWRgcmVtb3RhYmxlIHVuZXhwZWN0ZWQ6ICR7ZW5jb2Rpbmd9YCxcbiAgICBkZWNvZGVQcm9taXNlID0gKGVuY29kaW5nLCBfKSA9PiB0aHJvd1JlZGFjdGVkYHByb21pc2UgdW5leHBlY3RlZDogJHtlbmNvZGluZ31gLFxuICAgIGRlY29kZUVycm9yID0gKGVuY29kaW5nLCBfKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIHVuZXhwZWN0ZWQ6ICR7ZW5jb2Rpbmd9YFxuICB9ID0gb3B0aW9ucztcbiAgbGV0IGVuY29kZVBhc3NhYmxlO1xuICBjb25zdCBlbmNvZGVPcHRpb25zID0geyBlbmNvZGVSZW1vdGFibGUsIGVuY29kZVByb21pc2UsIGVuY29kZUVycm9yLCBmb3JtYXQgfTtcbiAgaWYgKGZvcm1hdCA9PT0gXCJjb21wYWN0T3JkZXJlZFwiKSB7XG4gICAgY29uc3QgbGliZXJhbERlY29kZSA9IG1ha2VJbm5lckRlY29kZShcbiAgICAgIGRlY29kZUNvbXBhY3RTdHJpbmdTdWZmaXgsXG4gICAgICBkZWNvZGVDb21wYWN0QXJyYXksXG4gICAgICBsaWJlcmFsRGVjb2RlcnNcbiAgICApO1xuICAgIGNvbnN0IHZlcmlmeUVuY29kaW5nID0gKGVuY29kaW5nLCBsYWJlbCkgPT4ge1xuICAgICAgIWVuY29kaW5nLm1hdGNoKHJDMCkgfHwgdGhyb3dSZWRhY3RlZGAke2JhcmVPclF1b3RlKFxuICAgICAgICBsYWJlbFxuICAgICAgKX0gZW5jb2RpbmcgbXVzdCBub3QgY29udGFpbiBhIEMwIGNvbnRyb2wgY2hhcmFjdGVyOiAke2VuY29kaW5nfWA7XG4gICAgICBjb25zdCBkZWNvZGVkID0gZGVjb2RlQ29tcGFjdEFycmF5KGBediAke2VuY29kaW5nfSB2IGAsIGxpYmVyYWxEZWNvZGUpO1xuICAgICAgaXNBcnJheTgoZGVjb2RlZCkgJiYgZGVjb2RlZC5sZW5ndGggPT09IDMgJiYgZGVjb2RlZFswXSA9PT0gbnVsbCAmJiBkZWNvZGVkWzJdID09PSBudWxsIHx8IHRocm93UmVkYWN0ZWRgJHtiYXJlT3JRdW90ZShsYWJlbCl9IGVuY29kaW5nIG11c3QgYmUgZW1iZWRkYWJsZTogJHtlbmNvZGluZ31gO1xuICAgIH07XG4gICAgY29uc3QgZW5jb2RlQ29tcGFjdCA9IG1ha2VJbm5lckVuY29kZShcbiAgICAgIGVuY29kZUNvbXBhY3RTdHJpbmdTdWZmaXgsXG4gICAgICBlbmNvZGVDb21wYWN0QXJyYXksXG4gICAgICB7IC4uLmVuY29kZU9wdGlvbnMsIHZlcmlmeUVuY29kaW5nIH1cbiAgICApO1xuICAgIGVuY29kZVBhc3NhYmxlID0gKHBhc3NhYmxlKSA9PiBgfiR7ZW5jb2RlQ29tcGFjdChwYXNzYWJsZSl9YDtcbiAgfSBlbHNlIGlmIChmb3JtYXQgPT09IFwibGVnYWN5T3JkZXJlZFwiKSB7XG4gICAgZW5jb2RlUGFzc2FibGUgPSBtYWtlSW5uZXJFbmNvZGUoXG4gICAgICBlbmNvZGVMZWdhY3lTdHJpbmdTdWZmaXgsXG4gICAgICBlbmNvZGVMZWdhY3lBcnJheSxcbiAgICAgIGVuY29kZU9wdGlvbnNcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIHRocm93IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIGZvcm1hdDogJHtxdW90ZShmb3JtYXQpfWA7XG4gIH1cbiAgY29uc3QgZGVjb2RlT3B0aW9ucyA9IHsgZGVjb2RlUmVtb3RhYmxlLCBkZWNvZGVQcm9taXNlLCBkZWNvZGVFcnJvciB9O1xuICBjb25zdCBkZWNvZGVDb21wYWN0ID0gbWFrZUlubmVyRGVjb2RlKFxuICAgIGRlY29kZUNvbXBhY3RTdHJpbmdTdWZmaXgsXG4gICAgZGVjb2RlQ29tcGFjdEFycmF5LFxuICAgIGRlY29kZU9wdGlvbnNcbiAgKTtcbiAgY29uc3QgZGVjb2RlTGVnYWN5ID0gbWFrZUlubmVyRGVjb2RlKFxuICAgIGRlY29kZUxlZ2FjeVN0cmluZ1N1ZmZpeCxcbiAgICBkZWNvZGVMZWdhY3lBcnJheSxcbiAgICBkZWNvZGVPcHRpb25zXG4gICk7XG4gIGNvbnN0IGRlY29kZVBhc3NhYmxlID0gKGVuY29kZWQpID0+IHtcbiAgICBpZiAoZW5jb2RlZC5jaGFyQXQoMCkgPT09IFwiflwiKSB7XG4gICAgICByZXR1cm4gZGVjb2RlQ29tcGFjdChlbmNvZGVkLCAxKTtcbiAgICB9XG4gICAgcmV0dXJuIGRlY29kZUxlZ2FjeShlbmNvZGVkKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IGVuY29kZVBhc3NhYmxlLCBkZWNvZGVQYXNzYWJsZSB9KTtcbn07XG5oYXJkZW4obWFrZVBhc3NhYmxlS2l0KTtcbnZhciBtYWtlRW5jb2RlUGFzc2FibGUgPSAoZW5jb2RlT3B0aW9ucykgPT4ge1xuICBjb25zdCB7IGVuY29kZVBhc3NhYmxlIH0gPSBtYWtlUGFzc2FibGVLaXQoZW5jb2RlT3B0aW9ucyk7XG4gIHJldHVybiBlbmNvZGVQYXNzYWJsZTtcbn07XG5oYXJkZW4obWFrZUVuY29kZVBhc3NhYmxlKTtcbnZhciBtYWtlRGVjb2RlUGFzc2FibGUgPSAoZGVjb2RlT3B0aW9ucykgPT4ge1xuICBjb25zdCB7IGRlY29kZVBhc3NhYmxlIH0gPSBtYWtlUGFzc2FibGVLaXQoZGVjb2RlT3B0aW9ucyk7XG4gIHJldHVybiBkZWNvZGVQYXNzYWJsZTtcbn07XG5oYXJkZW4obWFrZURlY29kZVBhc3NhYmxlKTtcbnZhciBpc0VuY29kZWRSZW1vdGFibGUgPSAoZW5jb2RlZCkgPT4gZW5jb2RlZC5jaGFyQXQoMCkgPT09IFwiclwiO1xuaGFyZGVuKGlzRW5jb2RlZFJlbW90YWJsZSk7XG52YXIgcGFzc1N0eWxlUHJlZml4ZXMgPSB7XG4gIGVycm9yOiBcIiFcIixcbiAgY29weVJlY29yZDogXCIoXCIsXG4gIHRhZ2dlZDogXCI6XCIsXG4gIHByb21pc2U6IFwiP1wiLFxuICBjb3B5QXJyYXk6IFwiW15cIixcbiAgYnl0ZUFycmF5OiBcImFcIixcbiAgYm9vbGVhbjogXCJiXCIsXG4gIG51bWJlcjogXCJmXCIsXG4gIGJpZ2ludDogXCJucFwiLFxuICByZW1vdGFibGU6IFwiclwiLFxuICBzdHJpbmc6IFwic1wiLFxuICBudWxsOiBcInZcIixcbiAgc3ltYm9sOiBcInlcIixcbiAgLy9cbiAgLy9cbiAgLy9cbiAgdW5kZWZpbmVkOiBcInpcIlxufTtcbk9iamVjdC5zZXRQcm90b3R5cGVPZihwYXNzU3R5bGVQcmVmaXhlcywgbnVsbCk7XG5oYXJkZW4ocGFzc1N0eWxlUHJlZml4ZXMpO1xuXG4vL1xudmFyIHsgaXNOYU46IE51bWJlcklzTmFOIH0gPSBOdW1iZXI7XG52YXIgeyBlbnRyaWVzOiBlbnRyaWVzNiwgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzNiwgc2V0UHJvdG90eXBlT2Y6IHNldFByb3RvdHlwZU9mMiwgaXM6IGlzNCB9ID0gT2JqZWN0O1xudmFyIEVORE9fUkFOS19TVFJJTkdTID0gZ2V0RW52aXJvbm1lbnRPcHRpb24oXCJFTkRPX1JBTktfU1RSSU5HU1wiLCBcInV0ZjE2LWNvZGUtdW5pdC1vcmRlclwiLCBbXG4gIFwidW5pY29kZS1jb2RlLXBvaW50LW9yZGVyXCIsXG4gIFwiZXJyb3ItaWYtb3JkZXItY2hvaWNlLW1hdHRlcnNcIlxuXSk7XG52YXIgc2FtZVZhbHVlWmVybyA9ICh4LCB5KSA9PiB4ID09PSB5IHx8IGlzNCh4LCB5KTtcbnZhciB0cml2aWFsQ29tcGFyYXRvciA9IChsZWZ0LCByaWdodCkgPT4gKFxuICAvL1xuICBsZWZ0IDwgcmlnaHQgPyAtMSA6IGxlZnQgPT09IHJpZ2h0ID8gMCA6IDFcbik7XG5oYXJkZW4odHJpdmlhbENvbXBhcmF0b3IpO1xudmFyIGNvbXBhcmVCeUNvZGVQb2ludHMgPSAobGVmdCwgcmlnaHQpID0+IHtcbiAgY29uc3QgbGVmdEl0ZXIgPSBsZWZ0W1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgY29uc3QgcmlnaHRJdGVyID0gcmlnaHRbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICBmb3IgKDsgOyApIHtcbiAgICBjb25zdCB7IHZhbHVlOiBsZWZ0Q2hhciB9ID0gbGVmdEl0ZXIubmV4dCgpO1xuICAgIGNvbnN0IHsgdmFsdWU6IHJpZ2h0Q2hhciB9ID0gcmlnaHRJdGVyLm5leHQoKTtcbiAgICBpZiAobGVmdENoYXIgPT09IHZvaWQgMCAmJiByaWdodENoYXIgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfSBlbHNlIGlmIChsZWZ0Q2hhciA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfSBlbHNlIGlmIChyaWdodENoYXIgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIGNvbnN0IGxlZnRDb2RlcG9pbnQgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGxlZnRDaGFyLmNvZGVQb2ludEF0KDApXG4gICAgKTtcbiAgICBjb25zdCByaWdodENvZGVwb2ludCA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgcmlnaHRDaGFyLmNvZGVQb2ludEF0KDApXG4gICAgKTtcbiAgICBpZiAobGVmdENvZGVwb2ludCA8IHJpZ2h0Q29kZXBvaW50KSByZXR1cm4gLTE7XG4gICAgaWYgKGxlZnRDb2RlcG9pbnQgPiByaWdodENvZGVwb2ludCkgcmV0dXJuIDE7XG4gIH1cbn07XG5oYXJkZW4oY29tcGFyZUJ5Q29kZVBvaW50cyk7XG52YXIgY29tcGFyZU51bWVyaWNzID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gIGlmIChsZWZ0IDwgcmlnaHQpIHJldHVybiAtMTtcbiAgaWYgKGxlZnQgPiByaWdodCkgcmV0dXJuIDE7XG4gIGlmIChOdW1iZXJJc05hTihsZWZ0KSA9PT0gTnVtYmVySXNOYU4ocmlnaHQpKSByZXR1cm4gMDtcbiAgaWYgKE51bWJlcklzTmFOKHJpZ2h0KSkgcmV0dXJuIC0xO1xuICBhc3NlcnQoTnVtYmVySXNOYU4obGVmdCkpO1xuICByZXR1cm4gMTtcbn07XG52YXIgcGFzc1N0eWxlUmFua3MgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIGZyb21FbnRyaWVzNihcbiAgICBlbnRyaWVzNihwYXNzU3R5bGVQcmVmaXhlcykuc29ydCgoW19sZWZ0U3R5bGUsIGxlZnRQcmVmaXhlc10sIFtfcmlnaHRTdHlsZSwgcmlnaHRQcmVmaXhlc10pID0+IHtcbiAgICAgIHJldHVybiB0cml2aWFsQ29tcGFyYXRvcihsZWZ0UHJlZml4ZXMsIHJpZ2h0UHJlZml4ZXMpO1xuICAgIH0pLm1hcCgoW3Bhc3NTdHlsZSwgcHJlZml4ZXNdLCBpbmRleCkgPT4ge1xuICAgICAgcHJlZml4ZXMgPT09IHByZWZpeGVzLnNwbGl0KFwiXCIpLnNvcnQoKS5qb2luKFwiXCIpIHx8IHRocm93UmVkYWN0ZWRgdW5zb3J0ZWQgcHJlZml4ZXMgZm9yIHBhc3NTdHlsZSAke3F1b3RlKHBhc3NTdHlsZSl9OiAke3F1b3RlKHByZWZpeGVzKX1gO1xuICAgICAgY29uc3QgY292ZXIgPSBbXG4gICAgICAgIHByZWZpeGVzLmNoYXJBdCgwKSxcbiAgICAgICAgU3RyaW5nLmZyb21DaGFyQ29kZShwcmVmaXhlcy5jaGFyQ29kZUF0KHByZWZpeGVzLmxlbmd0aCAtIDEpICsgMSlcbiAgICAgIF07XG4gICAgICByZXR1cm4gW3Bhc3NTdHlsZSwgeyBpbmRleCwgY292ZXIgfV07XG4gICAgfSlcbiAgKVxuKTtcbnNldFByb3RvdHlwZU9mMihwYXNzU3R5bGVSYW5rcywgbnVsbCk7XG5oYXJkZW4ocGFzc1N0eWxlUmFua3MpO1xudmFyIGdldFBhc3NTdHlsZUNvdmVyID0gKHBhc3NTdHlsZSkgPT4gcGFzc1N0eWxlUmFua3NbcGFzc1N0eWxlXS5jb3ZlcjtcbmhhcmRlbihnZXRQYXNzU3R5bGVDb3Zlcik7XG52YXIgbWVtb09mU29ydGVkID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG52YXIgY29tcGFyYXRvck1pcnJvckltYWdlcyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xudmFyIG1ha2VDb21wYXJhdG9yS2l0ID0gKGNvbXBhcmVSZW1vdGFibGVzID0gKF94LCBfeSkgPT4gTmFOKSA9PiB7XG4gIGNvbnN0IGNvbXBhcmF0b3IgPSAobGVmdCwgcmlnaHQpID0+IHtcbiAgICBpZiAoc2FtZVZhbHVlWmVybyhsZWZ0LCByaWdodCkpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBjb25zdCBsZWZ0U3R5bGUgPSBwYXNzU3R5bGVPZihsZWZ0KTtcbiAgICBjb25zdCByaWdodFN0eWxlID0gcGFzc1N0eWxlT2YocmlnaHQpO1xuICAgIGlmIChsZWZ0U3R5bGUgIT09IHJpZ2h0U3R5bGUpIHtcbiAgICAgIHJldHVybiBjb21wYXJlTnVtZXJpY3MoXG4gICAgICAgIHBhc3NTdHlsZVJhbmtzW2xlZnRTdHlsZV0uaW5kZXgsXG4gICAgICAgIHBhc3NTdHlsZVJhbmtzW3JpZ2h0U3R5bGVdLmluZGV4XG4gICAgICApO1xuICAgIH1cbiAgICBzd2l0Y2ggKGxlZnRTdHlsZSkge1xuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIHJldHVybiBjb21wYXJlUmVtb3RhYmxlcyhsZWZ0LCByaWdodCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgICBjYXNlIFwibnVsbFwiOlxuICAgICAgY2FzZSBcImVycm9yXCI6XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgIGNhc2UgXCJiaWdpbnRcIjoge1xuICAgICAgICByZXR1cm4gdHJpdmlhbENvbXBhcmF0b3IobGVmdCwgcmlnaHQpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgIHN3aXRjaCAoRU5ET19SQU5LX1NUUklOR1MpIHtcbiAgICAgICAgICBjYXNlIFwidXRmMTYtY29kZS11bml0LW9yZGVyXCI6IHtcbiAgICAgICAgICAgIHJldHVybiB0cml2aWFsQ29tcGFyYXRvcihsZWZ0LCByaWdodCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgXCJ1bmljb2RlLWNvZGUtcG9pbnQtb3JkZXJcIjoge1xuICAgICAgICAgICAgcmV0dXJuIGNvbXBhcmVCeUNvZGVQb2ludHMobGVmdCwgcmlnaHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiZXJyb3ItaWYtb3JkZXItY2hvaWNlLW1hdHRlcnNcIjoge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0MSA9IHRyaXZpYWxDb21wYXJhdG9yKGxlZnQsIHJpZ2h0KTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdDIgPSBjb21wYXJlQnlDb2RlUG9pbnRzKGxlZnQsIHJpZ2h0KTtcbiAgICAgICAgICAgIHJlc3VsdDEgPT09IHJlc3VsdDIgfHwgdGhyb3dSZWRhY3RlZGBDb21wYXJpc29ucyBkaWZmZXJlZDogJHtsZWZ0fSB2cyAke3JpZ2h0fSwgJHtxdW90ZShyZXN1bHQxKX0gdnMgJHtxdW90ZShyZXN1bHQyKX1gO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCBFTkRPX1JBTktfU1RSSU5HUyAke3F1b3RlKEVORE9fUkFOS19TVFJJTkdTKX1gO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICAgIHJldHVybiBjb21wYXJhdG9yKFxuICAgICAgICAgIG5hbWVGb3JQYXNzYWJsZVN5bWJvbChsZWZ0KSxcbiAgICAgICAgICBuYW1lRm9yUGFzc2FibGVTeW1ib2wocmlnaHQpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjYXNlIFwibnVtYmVyXCI6IHtcbiAgICAgICAgcmV0dXJuIGNvbXBhcmVOdW1lcmljcyhsZWZ0LCByaWdodCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGNvbnN0IGxlZnROYW1lcyA9IHJlY29yZE5hbWVzKGxlZnQpO1xuICAgICAgICBjb25zdCByaWdodE5hbWVzID0gcmVjb3JkTmFtZXMocmlnaHQpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21wYXJhdG9yKGxlZnROYW1lcywgcmlnaHROYW1lcyk7XG4gICAgICAgIGlmIChyZXN1bHQgIT09IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxlZnRWYWx1ZXMgPSByZWNvcmRWYWx1ZXMobGVmdCwgbGVmdE5hbWVzKTtcbiAgICAgICAgY29uc3QgcmlnaHRWYWx1ZXMgPSByZWNvcmRWYWx1ZXMocmlnaHQsIHJpZ2h0TmFtZXMpO1xuICAgICAgICByZXR1cm4gY29tcGFyYXRvcihsZWZ0VmFsdWVzLCByaWdodFZhbHVlcyk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgY29uc3QgbGVuID0gTWF0aC5taW4obGVmdC5sZW5ndGgsIHJpZ2h0Lmxlbmd0aCk7XG4gICAgICAgIGZvciAobGV0IGkzID0gMDsgaTMgPCBsZW47IGkzICs9IDEpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBjb21wYXJhdG9yKGxlZnRbaTNdLCByaWdodFtpM10pO1xuICAgICAgICAgIGlmIChyZXN1bHQgIT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb21wYXJhdG9yKGxlZnQubGVuZ3RoLCByaWdodC5sZW5ndGgpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJ5dGVBcnJheVwiOiB7XG4gICAgICAgIGNvbnN0IHsgYnl0ZUxlbmd0aDogbGVmdExlbiB9ID0gbGVmdDtcbiAgICAgICAgY29uc3QgeyBieXRlTGVuZ3RoOiByaWdodExlbiB9ID0gcmlnaHQ7XG4gICAgICAgIGlmIChsZWZ0TGVuIDwgcmlnaHRMZW4pIHtcbiAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxlZnRMZW4gPiByaWdodExlbikge1xuICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxlZnRBcnJheSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihsZWZ0KSA9PT0gQXJyYXlCdWZmZXIucHJvdG90eXBlID8gbmV3IFVpbnQ4QXJyYXkobGVmdCkgOiBuZXcgVWludDhBcnJheShsZWZ0LnNsaWNlKDApKTtcbiAgICAgICAgY29uc3QgcmlnaHRBcnJheSA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihyaWdodCkgPT09IEFycmF5QnVmZmVyLnByb3RvdHlwZSA/IG5ldyBVaW50OEFycmF5KHJpZ2h0KSA6IG5ldyBVaW50OEFycmF5KHJpZ2h0LnNsaWNlKDApKTtcbiAgICAgICAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IGxlZnRMZW47IGkzICs9IDEpIHtcbiAgICAgICAgICBjb25zdCBsZWZ0Qnl0ZSA9IGxlZnRBcnJheVtpM107XG4gICAgICAgICAgY29uc3QgcmlnaHRCeXRlID0gcmlnaHRBcnJheVtpM107XG4gICAgICAgICAgaWYgKGxlZnRCeXRlIDwgcmlnaHRCeXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChsZWZ0Qnl0ZSA+IHJpZ2h0Qnl0ZSkge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgIGNvbnN0IGxhYmVsQ29tcCA9IGNvbXBhcmF0b3IoZ2V0VGFnKGxlZnQpLCBnZXRUYWcocmlnaHQpKTtcbiAgICAgICAgaWYgKGxhYmVsQ29tcCAhPT0gMCkge1xuICAgICAgICAgIHJldHVybiBsYWJlbENvbXA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbXBhcmF0b3IobGVmdC5wYXlsb2FkLCByaWdodC5wYXlsb2FkKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBVbnJlY29nbml6ZWQgcGFzc1N0eWxlOiAke3F1b3RlKGxlZnRTdHlsZSl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IG91dGVyQ29tcGFyYXRvciA9ICh4LCB5KSA9PiAoXG4gICAgLy9cbiAgICAvL1xuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBjb21wYXJhdG9yKHgsIHkpIHx8IDBcbiAgKTtcbiAgY29uc3QgYW50aUNvbXBhcmF0b3IgPSAoeCwgeSkgPT4gb3V0ZXJDb21wYXJhdG9yKHksIHgpO1xuICBtZW1vT2ZTb3J0ZWQuc2V0KG91dGVyQ29tcGFyYXRvciwgLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCkpO1xuICBtZW1vT2ZTb3J0ZWQuc2V0KGFudGlDb21wYXJhdG9yLCAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKSk7XG4gIGNvbXBhcmF0b3JNaXJyb3JJbWFnZXMuc2V0KG91dGVyQ29tcGFyYXRvciwgYW50aUNvbXBhcmF0b3IpO1xuICBjb21wYXJhdG9yTWlycm9ySW1hZ2VzLnNldChhbnRpQ29tcGFyYXRvciwgb3V0ZXJDb21wYXJhdG9yKTtcbiAgcmV0dXJuIGhhcmRlbih7IGNvbXBhcmF0b3I6IG91dGVyQ29tcGFyYXRvciwgYW50aUNvbXBhcmF0b3IgfSk7XG59O1xudmFyIGlzUmFua1NvcnRlZCA9IChwYXNzYWJsZXMsIGNvbXBhcmUpID0+IHtcbiAgY29uc3Qgc3ViTWVtb09mU29ydGVkID0gbWVtb09mU29ydGVkLmdldChjb21wYXJlKTtcbiAgYXNzZXJ0KHN1Yk1lbW9PZlNvcnRlZCAhPT0gdm9pZCAwKTtcbiAgaWYgKHN1Yk1lbW9PZlNvcnRlZC5oYXMocGFzc2FibGVzKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGFzc2VydChwYXNzU3R5bGVPZihwYXNzYWJsZXMpID09PSBcImNvcHlBcnJheVwiKTtcbiAgZm9yIChsZXQgaTMgPSAxOyBpMyA8IHBhc3NhYmxlcy5sZW5ndGg7IGkzICs9IDEpIHtcbiAgICBpZiAoY29tcGFyZShwYXNzYWJsZXNbaTMgLSAxXSwgcGFzc2FibGVzW2kzXSkgPj0gMSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICBzdWJNZW1vT2ZTb3J0ZWQuYWRkKHBhc3NhYmxlcyk7XG4gIHJldHVybiB0cnVlO1xufTtcbmhhcmRlbihpc1JhbmtTb3J0ZWQpO1xudmFyIGFzc2VydFJhbmtTb3J0ZWQgPSAoc29ydGVkLCBjb21wYXJlKSA9PiBpc1JhbmtTb3J0ZWQoc29ydGVkLCBjb21wYXJlKSB8fCAvL1xuLy9cbnRocm93UmVkYWN0ZWRgTXVzdCBiZSByYW5rIHNvcnRlZDogJHtzb3J0ZWR9IHZzICR7c29ydEJ5UmFuayhzb3J0ZWQsIGNvbXBhcmUpfWA7XG5oYXJkZW4oYXNzZXJ0UmFua1NvcnRlZCk7XG52YXIgc29ydEJ5UmFuayA9IChwYXNzYWJsZXMsIGNvbXBhcmUpID0+IHtcbiAgbGV0IHVuc29ydGVkO1xuICBpZiAoQXJyYXkuaXNBcnJheShwYXNzYWJsZXMpKSB7XG4gICAgaGFyZGVuKHBhc3NhYmxlcyk7XG4gICAgaWYgKGlzUmFua1NvcnRlZChwYXNzYWJsZXMsIGNvbXBhcmUpKSB7XG4gICAgICByZXR1cm4gcGFzc2FibGVzO1xuICAgIH1cbiAgICB1bnNvcnRlZCA9IFsuLi5wYXNzYWJsZXNdO1xuICB9IGVsc2Uge1xuICAgIHVuc29ydGVkID0gQXJyYXkuZnJvbShwYXNzYWJsZXMsIGhhcmRlbik7XG4gIH1cbiAgY29uc3Qgc29ydGVkID0gdW5zb3J0ZWQuc29ydChjb21wYXJlKTtcbiAgaWYgKGNvbXBhcmUodHJ1ZSwgdm9pZCAwKSA+IDApIHtcbiAgICBsZXQgaTMgPSBzb3J0ZWQubGVuZ3RoIC0gMTtcbiAgICB3aGlsZSAoaTMgPj0gMCAmJiBzb3J0ZWRbaTNdID09PSB2b2lkIDApIGkzIC09IDE7XG4gICAgY29uc3QgbjIgPSBzb3J0ZWQubGVuZ3RoIC0gaTMgLSAxO1xuICAgIGlmIChuMiA+IDAgJiYgbjIgPCBzb3J0ZWQubGVuZ3RoKSB7XG4gICAgICBzb3J0ZWQuY29weVdpdGhpbihuMiwgMCk7XG4gICAgICBzb3J0ZWQuZmlsbChcbiAgICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgICB2b2lkIDAsXG4gICAgICAgIDAsXG4gICAgICAgIG4yXG4gICAgICApO1xuICAgIH1cbiAgfVxuICBoYXJkZW4oc29ydGVkKTtcbiAgY29uc3Qgc3ViTWVtb09mU29ydGVkID0gbWVtb09mU29ydGVkLmdldChjb21wYXJlKTtcbiAgYXNzZXJ0KHN1Yk1lbW9PZlNvcnRlZCAhPT0gdm9pZCAwKTtcbiAgc3ViTWVtb09mU29ydGVkLmFkZChzb3J0ZWQpO1xuICByZXR1cm4gc29ydGVkO1xufTtcbmhhcmRlbihzb3J0QnlSYW5rKTtcbnZhciByYW5rU2VhcmNoID0gKHNvcnRlZCwgY29tcGFyZSwga2V5LCBiaWFzID0gXCJsZWZ0TW9zdFwiKSA9PiB7XG4gIGFzc2VydFJhbmtTb3J0ZWQoc29ydGVkLCBjb21wYXJlKTtcbiAgbGV0IGxlZnQgPSAwO1xuICBsZXQgcmlnaHQgPSBzb3J0ZWQubGVuZ3RoO1xuICB3aGlsZSAobGVmdCA8IHJpZ2h0KSB7XG4gICAgY29uc3QgbTIgPSBNYXRoLmZsb29yKChsZWZ0ICsgcmlnaHQpIC8gMik7XG4gICAgY29uc3QgY29tcCA9IGNvbXBhcmUoc29ydGVkW20yXSwga2V5KTtcbiAgICBpZiAoY29tcCA8PSAtMSB8fCBjb21wID09PSAwICYmIGJpYXMgPT09IFwicmlnaHRNb3N0XCIpIHtcbiAgICAgIGxlZnQgPSBtMiArIDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFzc2VydChjb21wID49IDEgfHwgY29tcCA9PT0gMCAmJiBiaWFzID09PSBcImxlZnRNb3N0XCIpO1xuICAgICAgcmlnaHQgPSBtMjtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGJpYXMgPT09IFwibGVmdE1vc3RcIiA/IGxlZnQgOiByaWdodCAtIDE7XG59O1xudmFyIGdldEluZGV4Q292ZXIgPSAoc29ydGVkLCBjb21wYXJlLCBbbGVmdEtleSwgcmlnaHRLZXldKSA9PiB7XG4gIGFzc2VydFJhbmtTb3J0ZWQoc29ydGVkLCBjb21wYXJlKTtcbiAgY29uc3QgbGVmdEluZGV4ID0gcmFua1NlYXJjaChzb3J0ZWQsIGNvbXBhcmUsIGxlZnRLZXksIFwibGVmdE1vc3RcIik7XG4gIGNvbnN0IHJpZ2h0SW5kZXggPSByYW5rU2VhcmNoKHNvcnRlZCwgY29tcGFyZSwgcmlnaHRLZXksIFwicmlnaHRNb3N0XCIpO1xuICByZXR1cm4gW2xlZnRJbmRleCwgcmlnaHRJbmRleF07XG59O1xuaGFyZGVuKGdldEluZGV4Q292ZXIpO1xudmFyIEZ1bGxSYW5rQ292ZXIgPSBoYXJkZW4oW1wiXCIsIFwie1wiXSk7XG52YXIgY292ZXJlZEVudHJpZXMgPSAoc29ydGVkLCBbbGVmdEluZGV4LCByaWdodEluZGV4XSkgPT4ge1xuICBjb25zdCBpdGVyYWJsZSA9IGhhcmRlbih7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGxldCBpMyA9IGxlZnRJbmRleDtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgaWYgKGkzIDw9IHJpZ2h0SW5kZXgpIHtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBzb3J0ZWRbaTNdO1xuICAgICAgICAgICAgaTMgKz0gMTtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oeyB2YWx1ZTogW2kzLCBlbGVtZW50XSwgZG9uZTogZmFsc2UgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oeyB2YWx1ZTogdm9pZCAwLCBkb25lOiB0cnVlIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGl0ZXJhYmxlO1xufTtcbmhhcmRlbihjb3ZlcmVkRW50cmllcyk7XG52YXIgbWF4UmFuayA9IChjb21wYXJlLCBhMiwgYjMpID0+IGNvbXBhcmUoYTIsIGIzKSA+PSAwID8gYTIgOiBiMztcbnZhciBtaW5SYW5rID0gKGNvbXBhcmUsIGEyLCBiMykgPT4gY29tcGFyZShhMiwgYjMpIDw9IDAgPyBhMiA6IGIzO1xudmFyIHVuaW9uUmFua0NvdmVycyA9IChjb21wYXJlLCBjb3ZlcnMpID0+IHtcbiAgY29uc3QgdW5pb25SYW5rQ292ZXJQYWlyID0gKFtsZWZ0QSwgcmlnaHRBXSwgW2xlZnRCLCByaWdodEJdKSA9PiBbXG4gICAgbWluUmFuayhjb21wYXJlLCBsZWZ0QSwgbGVmdEIpLFxuICAgIG1heFJhbmsoY29tcGFyZSwgcmlnaHRBLCByaWdodEIpXG4gIF07XG4gIHJldHVybiBjb3ZlcnMucmVkdWNlKHVuaW9uUmFua0NvdmVyUGFpciwgW1wie1wiLCBcIlwiXSk7XG59O1xuaGFyZGVuKHVuaW9uUmFua0NvdmVycyk7XG52YXIgaW50ZXJzZWN0UmFua0NvdmVycyA9IChjb21wYXJlLCBjb3ZlcnMpID0+IHtcbiAgY29uc3QgaW50ZXJzZWN0UmFua0NvdmVyUGFpciA9IChbbGVmdEEsIHJpZ2h0QV0sIFtsZWZ0QiwgcmlnaHRCXSkgPT4gW1xuICAgIG1heFJhbmsoY29tcGFyZSwgbGVmdEEsIGxlZnRCKSxcbiAgICBtaW5SYW5rKGNvbXBhcmUsIHJpZ2h0QSwgcmlnaHRCKVxuICBdO1xuICByZXR1cm4gY292ZXJzLnJlZHVjZShpbnRlcnNlY3RSYW5rQ292ZXJQYWlyLCBbXCJcIiwgXCJ7XCJdKTtcbn07XG52YXIgeyBjb21wYXJhdG9yOiBjb21wYXJlUmFuaywgYW50aUNvbXBhcmF0b3I6IGNvbXBhcmVBbnRpUmFuayB9ID0gbWFrZUNvbXBhcmF0b3JLaXQoKTtcbnZhciBtYWtlRnVsbE9yZGVyQ29tcGFyYXRvcktpdCA9IChsb25nTGl2ZWQgPSBmYWxzZSkgPT4ge1xuICBsZXQgbnVtU2VlbiA9IDA7XG4gIGNvbnN0IE1hcENvbnN0cnVjdG9yID0gbG9uZ0xpdmVkID8gV2Vha01hcCA6IE1hcDtcbiAgY29uc3Qgc2VlbiA9IG5ldyBNYXBDb25zdHJ1Y3RvcigpO1xuICBjb25zdCB0YWcgPSAocjUpID0+IHtcbiAgICBpZiAoc2Vlbi5oYXMocjUpKSB7XG4gICAgICByZXR1cm4gc2Vlbi5nZXQocjUpO1xuICAgIH1cbiAgICBudW1TZWVuICs9IDE7XG4gICAgc2Vlbi5zZXQocjUsIG51bVNlZW4pO1xuICAgIHJldHVybiBudW1TZWVuO1xuICB9O1xuICBjb25zdCBjb21wYXJlUmVtb3RhYmxlcyA9ICh4LCB5KSA9PiBjb21wYXJlUmFuayh0YWcoeCksIHRhZyh5KSk7XG4gIHJldHVybiBtYWtlQ29tcGFyYXRvcktpdChjb21wYXJlUmVtb3RhYmxlcyk7XG59O1xuaGFyZGVuKG1ha2VGdWxsT3JkZXJDb21wYXJhdG9yS2l0KTtcblxuLy9cbnZhciBjaGVja05vRHVwbGljYXRlcyA9IChlbGVtZW50cywgZnVsbENvbXBhcmUsIGNoZWNrKSA9PiB7XG4gIGZ1bGxDb21wYXJlID0gZnVsbENvbXBhcmUgfHwgbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgZWxlbWVudHMgPSBzb3J0QnlSYW5rKGVsZW1lbnRzLCBmdWxsQ29tcGFyZSk7XG4gIGNvbnN0IHsgbGVuZ3RoIH0gPSBlbGVtZW50cztcbiAgZm9yIChsZXQgaTMgPSAxOyBpMyA8IGxlbmd0aDsgaTMgKz0gMSkge1xuICAgIGNvbnN0IGswID0gZWxlbWVudHNbaTMgLSAxXTtcbiAgICBjb25zdCBrMSA9IGVsZW1lbnRzW2kzXTtcbiAgICBpZiAoZnVsbENvbXBhcmUoazAsIGsxKSA9PT0gMCkge1xuICAgICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGB2YWx1ZSBoYXMgZHVwbGljYXRlIGtleXM6ICR7azB9YCk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcbnZhciBhc3NlcnROb0R1cGxpY2F0ZXMgPSAoZWxlbWVudHMsIGZ1bGxDb21wYXJlID0gdm9pZCAwKSA9PiB7XG4gIGNoZWNrTm9EdXBsaWNhdGVzKGVsZW1lbnRzLCBmdWxsQ29tcGFyZSwgYXNzZXJ0Q2hlY2tlcik7XG59O1xudmFyIGNoZWNrRWxlbWVudHMgPSAoZWxlbWVudHMsIGNoZWNrKSA9PiB7XG4gIGlmIChwYXNzU3R5bGVPZihlbGVtZW50cykgIT09IFwiY29weUFycmF5XCIpIHtcbiAgICByZXR1cm4gY2hlY2soXG4gICAgICBmYWxzZSxcbiAgICAgIHJlZGFjdGVkYFRoZSBrZXlzIG9mIGEgY29weVNldCBvciBjb3B5TWFwIG11c3QgYmUgYSBjb3B5QXJyYXk6ICR7ZWxlbWVudHN9YFxuICAgICk7XG4gIH1cbiAgaWYgKCFpc1JhbmtTb3J0ZWQoZWxlbWVudHMsIGNvbXBhcmVBbnRpUmFuaykpIHtcbiAgICByZXR1cm4gY2hlY2soXG4gICAgICBmYWxzZSxcbiAgICAgIHJlZGFjdGVkYFRoZSBrZXlzIG9mIGEgY29weVNldCBvciBjb3B5TWFwIG11c3QgYmUgc29ydGVkIGluIHJldmVyc2UgcmFuayBvcmRlcjogJHtlbGVtZW50c31gXG4gICAgKTtcbiAgfVxuICByZXR1cm4gY2hlY2tOb0R1cGxpY2F0ZXMoZWxlbWVudHMsIHZvaWQgMCwgY2hlY2spO1xufTtcbmhhcmRlbihjaGVja0VsZW1lbnRzKTtcbnZhciBhc3NlcnRFbGVtZW50cyA9IChlbGVtZW50cykgPT4ge1xuICBjaGVja0VsZW1lbnRzKGVsZW1lbnRzLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0RWxlbWVudHMpO1xudmFyIGNvZXJjZVRvRWxlbWVudHMgPSAoZWxlbWVudHNMaXN0KSA9PiB7XG4gIGNvbnN0IGVsZW1lbnRzID0gc29ydEJ5UmFuayhlbGVtZW50c0xpc3QsIGNvbXBhcmVBbnRpUmFuayk7XG4gIGFzc2VydEVsZW1lbnRzKGVsZW1lbnRzKTtcbiAgcmV0dXJuIGVsZW1lbnRzO1xufTtcbmhhcmRlbihjb2VyY2VUb0VsZW1lbnRzKTtcbnZhciBtYWtlU2V0T2ZFbGVtZW50cyA9IChlbGVtZW50SXRlcikgPT4gbWFrZVRhZ2dlZChcImNvcHlTZXRcIiwgY29lcmNlVG9FbGVtZW50cyhlbGVtZW50SXRlcikpO1xuaGFyZGVuKG1ha2VTZXRPZkVsZW1lbnRzKTtcblxuLy9cbnZhciBjaGVja05vRHVwbGljYXRlS2V5cyA9IChiYWdFbnRyaWVzLCBmdWxsQ29tcGFyZSwgY2hlY2spID0+IHtcbiAgZnVsbENvbXBhcmUgPSBmdWxsQ29tcGFyZSB8fCBtYWtlRnVsbE9yZGVyQ29tcGFyYXRvcktpdCgpLmFudGlDb21wYXJhdG9yO1xuICBiYWdFbnRyaWVzID0gc29ydEJ5UmFuayhiYWdFbnRyaWVzLCBmdWxsQ29tcGFyZSk7XG4gIGNvbnN0IHsgbGVuZ3RoIH0gPSBiYWdFbnRyaWVzO1xuICBmb3IgKGxldCBpMyA9IDE7IGkzIDwgbGVuZ3RoOyBpMyArPSAxKSB7XG4gICAgY29uc3QgazAgPSBiYWdFbnRyaWVzW2kzIC0gMV1bMF07XG4gICAgY29uc3QgazEgPSBiYWdFbnRyaWVzW2kzXVswXTtcbiAgICBpZiAoZnVsbENvbXBhcmUoazAsIGsxKSA9PT0gMCkge1xuICAgICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGB2YWx1ZSBoYXMgZHVwbGljYXRlIGtleXM6ICR7azB9YCk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcbnZhciBhc3NlcnROb0R1cGxpY2F0ZUtleXMgPSAoYmFnRW50cmllcywgZnVsbENvbXBhcmUgPSB2b2lkIDApID0+IHtcbiAgY2hlY2tOb0R1cGxpY2F0ZUtleXMoYmFnRW50cmllcywgZnVsbENvbXBhcmUsIGFzc2VydENoZWNrZXIpO1xufTtcbnZhciBjaGVja0JhZ0VudHJpZXMgPSAoYmFnRW50cmllcywgY2hlY2spID0+IHtcbiAgaWYgKHBhc3NTdHlsZU9mKGJhZ0VudHJpZXMpICE9PSBcImNvcHlBcnJheVwiKSB7XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgZmFsc2UsXG4gICAgICByZWRhY3RlZGBUaGUgZW50cmllcyBvZiBhIGNvcHlCYWcgbXVzdCBiZSBhIGNvcHlBcnJheTogJHtiYWdFbnRyaWVzfWBcbiAgICApO1xuICB9XG4gIGlmICghaXNSYW5rU29ydGVkKGJhZ0VudHJpZXMsIGNvbXBhcmVBbnRpUmFuaykpIHtcbiAgICByZXR1cm4gY2hlY2soXG4gICAgICBmYWxzZSxcbiAgICAgIHJlZGFjdGVkYFRoZSBlbnRyaWVzIG9mIGEgY29weUJhZyBtdXN0IGJlIHNvcnRlZCBpbiByZXZlcnNlIHJhbmsgb3JkZXI6ICR7YmFnRW50cmllc31gXG4gICAgKTtcbiAgfVxuICBmb3IgKGNvbnN0IGVudHJ5IG9mIGJhZ0VudHJpZXMpIHtcbiAgICBpZiAocGFzc1N0eWxlT2YoZW50cnkpICE9PSBcImNvcHlBcnJheVwiIHx8IGVudHJ5Lmxlbmd0aCAhPT0gMiB8fCB0eXBlb2YgZW50cnlbMV0gIT09IFwiYmlnaW50XCIpIHtcbiAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYEVhY2ggZW50cnkgb2YgYSBjb3B5QmFnIG11c3QgYmUgcGFpciBvZiBhIGtleSBhbmQgYSBiaWdpbnQgcmVwcmVzZW50aW5nIGEgY291bnQ6ICR7ZW50cnl9YFxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKGVudHJ5WzFdIDwgMSkge1xuICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgcmVkYWN0ZWRgRWFjaCBlbnRyeSBvZiBhIGNvcHlCYWcgbXVzdCBoYXZlIGEgcG9zaXRpdmUgY291bnQ6ICR7ZW50cnl9YFxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNoZWNrTm9EdXBsaWNhdGVLZXlzKGJhZ0VudHJpZXMsIHZvaWQgMCwgY2hlY2spO1xufTtcbmhhcmRlbihjaGVja0JhZ0VudHJpZXMpO1xudmFyIGFzc2VydEJhZ0VudHJpZXMgPSAoYmFnRW50cmllcykgPT4ge1xuICBjaGVja0JhZ0VudHJpZXMoYmFnRW50cmllcywgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydEJhZ0VudHJpZXMpO1xudmFyIGNvZXJjZVRvQmFnRW50cmllcyA9IChiYWdFbnRyaWVzTGlzdCkgPT4ge1xuICBjb25zdCBiYWdFbnRyaWVzID0gc29ydEJ5UmFuayhiYWdFbnRyaWVzTGlzdCwgY29tcGFyZUFudGlSYW5rKTtcbiAgYXNzZXJ0QmFnRW50cmllcyhiYWdFbnRyaWVzKTtcbiAgcmV0dXJuIGJhZ0VudHJpZXM7XG59O1xuaGFyZGVuKGNvZXJjZVRvQmFnRW50cmllcyk7XG52YXIgbWFrZUJhZ09mRW50cmllcyA9IChiYWdFbnRyeUl0ZXIpID0+IG1ha2VUYWdnZWQoXCJjb3B5QmFnXCIsIGNvZXJjZVRvQmFnRW50cmllcyhiYWdFbnRyeUl0ZXIpKTtcbmhhcmRlbihtYWtlQmFnT2ZFbnRyaWVzKTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXMxNiB9ID0gUmVmbGVjdDtcbnZhciBjaGVja1NjYWxhcktleSA9ICh2YWwsIGNoZWNrKSA9PiB7XG4gIGlmIChpc0F0b20odmFsKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHZhbCk7XG4gIGlmIChwYXNzU3R5bGUgPT09IFwicmVtb3RhYmxlXCIpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgJHtxdW90ZShwYXNzU3R5bGUpfSBjYW5ub3QgYmUgYSBzY2FsYXIga2V5OiAke3ZhbH1gKTtcbn07XG52YXIgaXNTY2FsYXJLZXkgPSAodmFsKSA9PiBjaGVja1NjYWxhcktleSh2YWwsIGlkZW50Q2hlY2tlcik7XG5oYXJkZW4oaXNTY2FsYXJLZXkpO1xudmFyIGFzc2VydFNjYWxhcktleSA9ICh2YWwpID0+IHtcbiAgY2hlY2tTY2FsYXJLZXkodmFsLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0U2NhbGFyS2V5KTtcbnZhciBrZXlNZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCk7XG52YXIgY2hlY2tLZXkgPSAodmFsLCBjaGVjaykgPT4ge1xuICBpZiAoaXNBdG9tKHZhbCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoa2V5TWVtby5oYXModmFsKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IHJlc3VsdCA9IGNoZWNrS2V5SW50ZXJuYWwodmFsLCBjaGVjayk7XG4gIGlmIChyZXN1bHQpIHtcbiAgICBrZXlNZW1vLmFkZCh2YWwpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuaGFyZGVuKGNoZWNrS2V5KTtcbnZhciBpc0tleSA9ICh2YWwpID0+IGNoZWNrS2V5KHZhbCwgaWRlbnRDaGVja2VyKTtcbmhhcmRlbihpc0tleSk7XG52YXIgYXNzZXJ0S2V5ID0gKHZhbCkgPT4ge1xuICBjaGVja0tleSh2YWwsIGFzc2VydENoZWNrZXIpO1xufTtcbmhhcmRlbihhc3NlcnRLZXkpO1xudmFyIGNvcHlTZXRNZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCk7XG52YXIgY2hlY2tDb3B5U2V0ID0gKHMzLCBjaGVjaykgPT4ge1xuICBpZiAoY29weVNldE1lbW8uaGFzKHMzKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IHJlc3VsdCA9IChwYXNzU3R5bGVPZihzMykgPT09IFwidGFnZ2VkXCIgJiYgZ2V0VGFnKHMzKSA9PT0gXCJjb3B5U2V0XCIgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYE5vdCBhIGNvcHlTZXQ6ICR7czN9YCkpICYmIGNoZWNrRWxlbWVudHMoczMucGF5bG9hZCwgY2hlY2spICYmIGNoZWNrS2V5KHMzLnBheWxvYWQsIGNoZWNrKTtcbiAgaWYgKHJlc3VsdCkge1xuICAgIGNvcHlTZXRNZW1vLmFkZChzMyk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4oY2hlY2tDb3B5U2V0KTtcbnZhciBpc0NvcHlTZXQgPSAoczMpID0+IGNoZWNrQ29weVNldChzMywgaWRlbnRDaGVja2VyKTtcbmhhcmRlbihpc0NvcHlTZXQpO1xudmFyIGFzc2VydENvcHlTZXQgPSAoczMpID0+IHtcbiAgY2hlY2tDb3B5U2V0KHMzLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0Q29weVNldCk7XG52YXIgZ2V0Q29weVNldEtleXMgPSAoczMpID0+IHtcbiAgYXNzZXJ0Q29weVNldChzMyk7XG4gIHJldHVybiBzMy5wYXlsb2FkO1xufTtcbmhhcmRlbihnZXRDb3B5U2V0S2V5cyk7XG52YXIgZXZlcnlDb3B5U2V0S2V5ID0gKHMzLCBmbikgPT4gZ2V0Q29weVNldEtleXMoczMpLmV2ZXJ5KChrZXksIGluZGV4KSA9PiBmbihrZXksIGluZGV4KSk7XG5oYXJkZW4oZXZlcnlDb3B5U2V0S2V5KTtcbnZhciBtYWtlQ29weVNldCA9IChlbGVtZW50SXRlcikgPT4ge1xuICBjb25zdCByZXN1bHQgPSBtYWtlU2V0T2ZFbGVtZW50cyhlbGVtZW50SXRlcik7XG4gIGFzc2VydENvcHlTZXQocmVzdWx0KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4obWFrZUNvcHlTZXQpO1xudmFyIGNvcHlCYWdNZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCk7XG52YXIgY2hlY2tDb3B5QmFnID0gKGIzLCBjaGVjaykgPT4ge1xuICBpZiAoY29weUJhZ01lbW8uaGFzKGIzKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IHJlc3VsdCA9IChwYXNzU3R5bGVPZihiMykgPT09IFwidGFnZ2VkXCIgJiYgZ2V0VGFnKGIzKSA9PT0gXCJjb3B5QmFnXCIgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYE5vdCBhIGNvcHlCYWc6ICR7YjN9YCkpICYmIGNoZWNrQmFnRW50cmllcyhiMy5wYXlsb2FkLCBjaGVjaykgJiYgY2hlY2tLZXkoYjMucGF5bG9hZCwgY2hlY2spO1xuICBpZiAocmVzdWx0KSB7XG4gICAgY29weUJhZ01lbW8uYWRkKGIzKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbmhhcmRlbihjaGVja0NvcHlCYWcpO1xudmFyIGlzQ29weUJhZyA9IChiMykgPT4gY2hlY2tDb3B5QmFnKGIzLCBpZGVudENoZWNrZXIpO1xuaGFyZGVuKGlzQ29weUJhZyk7XG52YXIgYXNzZXJ0Q29weUJhZyA9IChiMykgPT4ge1xuICBjaGVja0NvcHlCYWcoYjMsIGFzc2VydENoZWNrZXIpO1xufTtcbmhhcmRlbihhc3NlcnRDb3B5QmFnKTtcbnZhciBnZXRDb3B5QmFnRW50cmllcyA9IChiMykgPT4ge1xuICBhc3NlcnRDb3B5QmFnKGIzKTtcbiAgcmV0dXJuIGIzLnBheWxvYWQ7XG59O1xuaGFyZGVuKGdldENvcHlCYWdFbnRyaWVzKTtcbnZhciBldmVyeUNvcHlCYWdFbnRyeSA9IChiMywgZm4pID0+IGdldENvcHlCYWdFbnRyaWVzKGIzKS5ldmVyeSgoZW50cnksIGluZGV4KSA9PiBmbihlbnRyeSwgaW5kZXgpKTtcbmhhcmRlbihldmVyeUNvcHlCYWdFbnRyeSk7XG52YXIgbWFrZUNvcHlCYWcgPSAoYmFnRW50cnlJdGVyKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VCYWdPZkVudHJpZXMoYmFnRW50cnlJdGVyKTtcbiAgYXNzZXJ0Q29weUJhZyhyZXN1bHQpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbmhhcmRlbihtYWtlQ29weUJhZyk7XG52YXIgbWFrZUNvcHlCYWdGcm9tRWxlbWVudHMgPSAoZWxlbWVudEl0ZXIpID0+IHtcbiAgY29uc3QgZnVsbENvbXBhcmUgPSBtYWtlRnVsbE9yZGVyQ29tcGFyYXRvcktpdCgpLmFudGlDb21wYXJhdG9yO1xuICBjb25zdCBzb3J0ZWQgPSBzb3J0QnlSYW5rKGVsZW1lbnRJdGVyLCBmdWxsQ29tcGFyZSk7XG4gIGNvbnN0IGVudHJpZXMxMCA9IFtdO1xuICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgc29ydGVkLmxlbmd0aDsgKSB7XG4gICAgY29uc3QgayA9IHNvcnRlZFtpM107XG4gICAgbGV0IGogPSBpMyArIDE7XG4gICAgd2hpbGUgKGogPCBzb3J0ZWQubGVuZ3RoICYmIGZ1bGxDb21wYXJlKGssIHNvcnRlZFtqXSkgPT09IDApIHtcbiAgICAgIGogKz0gMTtcbiAgICB9XG4gICAgZW50cmllczEwLnB1c2goW2ssIEJpZ0ludChqIC0gaTMpXSk7XG4gICAgaTMgPSBqO1xuICB9XG4gIHJldHVybiBtYWtlQ29weUJhZyhlbnRyaWVzMTApO1xufTtcbmhhcmRlbihtYWtlQ29weUJhZ0Zyb21FbGVtZW50cyk7XG52YXIgY29weU1hcE1lbW8gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKTtcbnZhciBjaGVja0NvcHlNYXAgPSAobTIsIGNoZWNrKSA9PiB7XG4gIGlmIChjb3B5TWFwTWVtby5oYXMobTIpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKCEocGFzc1N0eWxlT2YobTIpID09PSBcInRhZ2dlZFwiICYmIGdldFRhZyhtMikgPT09IFwiY29weU1hcFwiKSkge1xuICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgTm90IGEgY29weU1hcDogJHttMn1gKTtcbiAgfVxuICBjb25zdCB7IHBheWxvYWQgfSA9IG0yO1xuICBpZiAocGFzc1N0eWxlT2YocGF5bG9hZCkgIT09IFwiY29weVJlY29yZFwiKSB7XG4gICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBBIGNvcHlNYXAncyBwYXlsb2FkIG11c3QgYmUgYSByZWNvcmQ6ICR7bTJ9YCk7XG4gIH1cbiAgY29uc3QgeyBrZXlzOiBrZXlzOCwgdmFsdWVzOiB2YWx1ZXM4LCAuLi5yZXN0IH0gPSBwYXlsb2FkO1xuICBjb25zdCByZXN1bHQgPSAob3duS2V5czE2KHJlc3QpLmxlbmd0aCA9PT0gMCB8fCBjaGVjayhcbiAgICBmYWxzZSxcbiAgICByZWRhY3RlZGBBIGNvcHlNYXAncyBwYXlsb2FkIG11c3Qgb25seSBoYXZlIC5rZXlzIGFuZCAudmFsdWVzOiAke20yfWBcbiAgKSkgJiYgY2hlY2tFbGVtZW50cyhrZXlzOCwgY2hlY2spICYmIGNoZWNrS2V5KGtleXM4LCBjaGVjaykgJiYgKHBhc3NTdHlsZU9mKHZhbHVlczgpID09PSBcImNvcHlBcnJheVwiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBBIGNvcHlNYXAncyAudmFsdWVzIG11c3QgYmUgYSBjb3B5QXJyYXk6ICR7bTJ9YCkpICYmIChrZXlzOC5sZW5ndGggPT09IHZhbHVlczgubGVuZ3RoIHx8IGNoZWNrKFxuICAgIGZhbHNlLFxuICAgIHJlZGFjdGVkYEEgY29weU1hcCBtdXN0IGhhdmUgdGhlIHNhbWUgbnVtYmVyIG9mIGtleXMgYW5kIHZhbHVlczogJHttMn1gXG4gICkpO1xuICBpZiAocmVzdWx0KSB7XG4gICAgY29weU1hcE1lbW8uYWRkKG0yKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbmhhcmRlbihjaGVja0NvcHlNYXApO1xudmFyIGlzQ29weU1hcCA9IChtMikgPT4gY2hlY2tDb3B5TWFwKG0yLCBpZGVudENoZWNrZXIpO1xuaGFyZGVuKGlzQ29weU1hcCk7XG52YXIgYXNzZXJ0Q29weU1hcCA9IChtMikgPT4ge1xuICBjaGVja0NvcHlNYXAobTIsIGFzc2VydENoZWNrZXIpO1xufTtcbmhhcmRlbihhc3NlcnRDb3B5TWFwKTtcbnZhciBnZXRDb3B5TWFwS2V5cyA9IChtMikgPT4ge1xuICBhc3NlcnRDb3B5TWFwKG0yKTtcbiAgcmV0dXJuIG0yLnBheWxvYWQua2V5cztcbn07XG5oYXJkZW4oZ2V0Q29weU1hcEtleXMpO1xudmFyIGdldENvcHlNYXBWYWx1ZXMgPSAobTIpID0+IHtcbiAgYXNzZXJ0Q29weU1hcChtMik7XG4gIHJldHVybiBtMi5wYXlsb2FkLnZhbHVlcztcbn07XG5oYXJkZW4oZ2V0Q29weU1hcFZhbHVlcyk7XG52YXIgZ2V0Q29weU1hcEVudHJ5QXJyYXkgPSAobTIpID0+IHtcbiAgYXNzZXJ0Q29weU1hcChtMik7XG4gIGNvbnN0IHtcbiAgICBwYXlsb2FkOiB7IGtleXM6IGtleXM4LCB2YWx1ZXM6IHZhbHVlczggfVxuICB9ID0gbTI7XG4gIHJldHVybiBoYXJkZW4oa2V5czgubWFwKChrZXksIGkzKSA9PiBba2V5LCB2YWx1ZXM4W2kzXV0pKTtcbn07XG5oYXJkZW4oZ2V0Q29weU1hcEVudHJ5QXJyYXkpO1xudmFyIGdldENvcHlNYXBFbnRyaWVzID0gKG0yKSA9PiB7XG4gIGFzc2VydENvcHlNYXAobTIpO1xuICBjb25zdCB7XG4gICAgcGF5bG9hZDogeyBrZXlzOiBrZXlzOCwgdmFsdWVzOiB2YWx1ZXM4IH1cbiAgfSA9IG0yO1xuICBjb25zdCB7IGxlbmd0aCB9ID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAga2V5czhcbiAgKTtcbiAgcmV0dXJuIEZhcihcIkNvcHlNYXAgZW50cmllcyBpdGVyYWJsZVwiLCB7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGxldCBpMyA9IDA7XG4gICAgICByZXR1cm4gRmFyKFwiQ29weU1hcCBlbnRyaWVzIGl0ZXJhdG9yXCIsIHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgICAgaWYgKGkzIDwgbGVuZ3RoKSB7XG4gICAgICAgICAgICByZXN1bHQgPSBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWU6IFtrZXlzOFtpM10sIHZhbHVlczhbaTNdXSB9KTtcbiAgICAgICAgICAgIGkzICs9IDE7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgPSBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogdm9pZCAwIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihnZXRDb3B5TWFwRW50cmllcyk7XG52YXIgZXZlcnlDb3B5TWFwS2V5ID0gKG0yLCBmbikgPT4gZ2V0Q29weU1hcEtleXMobTIpLmV2ZXJ5KChrZXksIGluZGV4KSA9PiBmbihrZXksIGluZGV4KSk7XG5oYXJkZW4oZXZlcnlDb3B5TWFwS2V5KTtcbnZhciBldmVyeUNvcHlNYXBWYWx1ZSA9IChtMiwgZm4pID0+IGdldENvcHlNYXBWYWx1ZXMobTIpLmV2ZXJ5KCh2YWx1ZSwgaW5kZXgpID0+IGZuKHZhbHVlLCBpbmRleCkpO1xuaGFyZGVuKGV2ZXJ5Q29weU1hcFZhbHVlKTtcbnZhciBjb3B5TWFwS2V5U2V0ID0gKG0yKSA9PiAoXG4gIC8vXG4gIG1ha2VUYWdnZWQoXCJjb3B5U2V0XCIsIG0yLnBheWxvYWQua2V5cylcbik7XG5oYXJkZW4oY29weU1hcEtleVNldCk7XG52YXIgbWFrZUNvcHlNYXAgPSAoZW50cmllczEwKSA9PiB7XG4gIGNvbnN0IHNvcnRlZEVudHJpZXMgPSBzb3J0QnlSYW5rKGVudHJpZXMxMCwgY29tcGFyZUFudGlSYW5rKTtcbiAgY29uc3Qga2V5czggPSBzb3J0ZWRFbnRyaWVzLm1hcCgoW2ssIF92XSkgPT4gayk7XG4gIGNvbnN0IHZhbHVlczggPSBzb3J0ZWRFbnRyaWVzLm1hcCgoW19rLCB2Ml0pID0+IHYyKTtcbiAgY29uc3QgcmVzdWx0ID0gbWFrZVRhZ2dlZChcImNvcHlNYXBcIiwgeyBrZXlzOiBrZXlzOCwgdmFsdWVzOiB2YWx1ZXM4IH0pO1xuICBhc3NlcnRDb3B5TWFwKHJlc3VsdCk7XG4gIHJldHVybiByZXN1bHQ7XG59O1xuaGFyZGVuKG1ha2VDb3B5TWFwKTtcbnZhciBjaGVja0tleUludGVybmFsID0gKHZhbCwgY2hlY2spID0+IHtcbiAgY29uc3QgY2hlY2tJdCA9IChjaGlsZCkgPT4gY2hlY2tLZXkoY2hpbGQsIGNoZWNrKTtcbiAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YodmFsKTtcbiAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyh2YWwpLmV2ZXJ5KGNoZWNrSXQpO1xuICAgIH1cbiAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgIHJldHVybiB2YWwuZXZlcnkoY2hlY2tJdCk7XG4gICAgfVxuICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgY29uc3QgdGFnID0gZ2V0VGFnKHZhbCk7XG4gICAgICBzd2l0Y2ggKHRhZykge1xuICAgICAgICBjYXNlIFwiY29weVNldFwiOiB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrQ29weVNldCh2YWwsIGNoZWNrKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiY29weUJhZ1wiOiB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrQ29weUJhZyh2YWwsIGNoZWNrKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiY29weU1hcFwiOiB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrQ29weU1hcCh2YWwsIGNoZWNrKSAmJiAvL1xuICAgICAgICAgIC8vXG4gICAgICAgICAgLy9cbiAgICAgICAgICBldmVyeUNvcHlNYXBWYWx1ZSh2YWwsIGNoZWNrSXQpO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICByZXR1cm4gY2hlY2sgIT09IGlkZW50Q2hlY2tlciAmJiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSBwYXNzYWJsZSB0YWdnZWQgJHtxdW90ZSh0YWcpfSBpcyBub3QgYSBrZXk6ICR7dmFsfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGNhc2UgXCJlcnJvclwiOlxuICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSAke3F1b3RlKHBhc3NTdHlsZSl9IGNhbm5vdCBiZSBhIGtleWApO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgcGFzc1N0eWxlICR7cXVvdGUocGFzc1N0eWxlKX06ICR7dmFsfWA7XG4gICAgfVxuICB9XG59O1xuXG4vL1xudmFyIG1ha2VJdGVyYXRvciA9IChuZXh0KSA9PiB7XG4gIGNvbnN0IGl0ZXIgPSBoYXJkZW4oe1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiBpdGVyLFxuICAgIG5leHRcbiAgfSk7XG4gIHJldHVybiBpdGVyO1xufTtcbmhhcmRlbihtYWtlSXRlcmF0b3IpO1xuXG4vL1xudmFyIG1ha2VBcnJheUl0ZXJhdG9yID0gKGFycikgPT4ge1xuICBjb25zdCB7IGxlbmd0aCB9ID0gYXJyO1xuICBsZXQgaTMgPSAwO1xuICByZXR1cm4gbWFrZUl0ZXJhdG9yKCgpID0+IHtcbiAgICBsZXQgdmFsdWU7XG4gICAgaWYgKGkzIDwgbGVuZ3RoKSB7XG4gICAgICB2YWx1ZSA9IGFycltpM107XG4gICAgICBpMyArPSAxO1xuICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZSB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlIH0pO1xuICB9KTtcbn07XG5oYXJkZW4obWFrZUFycmF5SXRlcmF0b3IpO1xuXG4vL1xudmFyIGdlbmVyYXRlRnVsbFNvcnRlZEVudHJpZXMgPSAoZW50cmllczEwLCByYW5rQ29tcGFyZSwgZnVsbENvbXBhcmUpID0+IHtcbiAgYXNzZXJ0UmFua1NvcnRlZChlbnRyaWVzMTAsIHJhbmtDb21wYXJlKTtcbiAgY29uc3QgeyBsZW5ndGggfSA9IGVudHJpZXMxMDtcbiAgbGV0IGkzID0gMDtcbiAgbGV0IHNhbWVSYW5rSXRlcmF0b3I7XG4gIHJldHVybiBtYWtlSXRlcmF0b3IoKCkgPT4ge1xuICAgIGlmIChzYW1lUmFua0l0ZXJhdG9yKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBzYW1lUmFua0l0ZXJhdG9yLm5leHQoKTtcbiAgICAgIGlmICghcmVzdWx0LmRvbmUpIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICAgIHNhbWVSYW5rSXRlcmF0b3IgPSB2b2lkIDA7XG4gICAgfVxuICAgIGlmIChpMyA8IGxlbmd0aCkge1xuICAgICAgY29uc3QgZW50cnkgPSBlbnRyaWVzMTBbaTNdO1xuICAgICAgbGV0IGogPSBpMyArIDE7XG4gICAgICB3aGlsZSAoaiA8IGxlbmd0aCAmJiByYW5rQ29tcGFyZShlbnRyeVswXSwgZW50cmllczEwW2pdWzBdKSA9PT0gMCkge1xuICAgICAgICBqICs9IDE7XG4gICAgICB9XG4gICAgICBpZiAoaiA9PT0gaTMgKyAxKSB7XG4gICAgICAgIGkzID0gajtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZTogZW50cnkgfSk7XG4gICAgICB9XG4gICAgICBjb25zdCB0aWVzID0gZW50cmllczEwLnNsaWNlKGkzLCBqKTtcbiAgICAgIGkzID0gajtcbiAgICAgIGNvbnN0IHNvcnRlZFRpZXMgPSBzb3J0QnlSYW5rKHRpZXMsIGZ1bGxDb21wYXJlKTtcbiAgICAgIGZvciAobGV0IGsgPSAxOyBrIDwgc29ydGVkVGllcy5sZW5ndGg7IGsgKz0gMSkge1xuICAgICAgICBjb25zdCBba2V5MF0gPSBzb3J0ZWRUaWVzW2sgLSAxXTtcbiAgICAgICAgY29uc3QgW2tleTFdID0gc29ydGVkVGllc1trXTtcbiAgICAgICAgTWF0aC5zaWduKGZ1bGxDb21wYXJlKGtleTAsIGtleTEpKSB8fCB0aHJvd1JlZGFjdGVkYER1cGxpY2F0ZSBlbnRyeSBrZXk6ICR7a2V5MH1gO1xuICAgICAgfVxuICAgICAgc2FtZVJhbmtJdGVyYXRvciA9IG1ha2VBcnJheUl0ZXJhdG9yKHNvcnRlZFRpZXMpO1xuICAgICAgcmV0dXJuIHNhbWVSYW5rSXRlcmF0b3IubmV4dCgpO1xuICAgIH1cbiAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHZvaWQgMCB9KTtcbiAgfSk7XG59O1xuaGFyZGVuKGdlbmVyYXRlRnVsbFNvcnRlZEVudHJpZXMpO1xudmFyIGdlbmVyYXRlQ29sbGVjdGlvblBhaXJFbnRyaWVzID0gKGMxLCBjMiwgZ2V0RW50cmllcywgYWJzZW50VmFsdWUpID0+IHtcbiAgY29uc3QgZTEgPSBnZXRFbnRyaWVzKGMxKTtcbiAgY29uc3QgZTIgPSBnZXRFbnRyaWVzKGMyKTtcbiAgY29uc3QgZnVsbENvbXBhcmUgPSBtYWtlRnVsbE9yZGVyQ29tcGFyYXRvcktpdCgpLmFudGlDb21wYXJhdG9yO1xuICBjb25zdCB4ID0gZ2VuZXJhdGVGdWxsU29ydGVkRW50cmllcyhlMSwgY29tcGFyZUFudGlSYW5rLCBmdWxsQ29tcGFyZSk7XG4gIGNvbnN0IHkgPSBnZW5lcmF0ZUZ1bGxTb3J0ZWRFbnRyaWVzKGUyLCBjb21wYXJlQW50aVJhbmssIGZ1bGxDb21wYXJlKTtcbiAgbGV0IHhEb25lO1xuICBsZXQgeEtleTtcbiAgbGV0IHhWYWx1ZTtcbiAgbGV0IHlEb25lO1xuICBsZXQgeUtleTtcbiAgbGV0IHlWYWx1ZTtcbiAgY29uc3Qgbm9uRW50cnkgPSBbdm9pZCAwLCB2b2lkIDBdO1xuICBjb25zdCBuZXh0WCA9ICgpID0+IHtcbiAgICAheERvbmUgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogbmV4dFggbXVzdCBub3QgYmUgY2FsbGVkIG9uY2UgZG9uZWA7XG4gICAgY29uc3QgcmVzdWx0ID0geFZhbHVlO1xuICAgICh7IGRvbmU6IHhEb25lLCB2YWx1ZTogW3hLZXksIHhWYWx1ZV0gPSBub25FbnRyeSB9ID0geC5uZXh0KCkpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG4gIG5leHRYKCk7XG4gIGNvbnN0IG5leHRZID0gKCkgPT4ge1xuICAgICF5RG9uZSB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBuZXh0WSBtdXN0IG5vdCBiZSBjYWxsZWQgb25jZSBkb25lYDtcbiAgICBjb25zdCByZXN1bHQgPSB5VmFsdWU7XG4gICAgKHsgZG9uZTogeURvbmUsIHZhbHVlOiBbeUtleSwgeVZhbHVlXSA9IG5vbkVudHJ5IH0gPSB5Lm5leHQoKSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbiAgbmV4dFkoKTtcbiAgcmV0dXJuIG1ha2VJdGVyYXRvcigoKSA9PiB7XG4gICAgbGV0IGRvbmUgPSBmYWxzZTtcbiAgICBsZXQgdmFsdWU7XG4gICAgaWYgKHhEb25lICYmIHlEb25lKSB7XG4gICAgICBkb25lID0gdHJ1ZTtcbiAgICAgIHZhbHVlID0gW3ZvaWQgMCwgYWJzZW50VmFsdWUsIGFic2VudFZhbHVlXTtcbiAgICB9IGVsc2UgaWYgKHhEb25lKSB7XG4gICAgICB2YWx1ZSA9IFt5S2V5LCBhYnNlbnRWYWx1ZSwgbmV4dFkoKV07XG4gICAgfSBlbHNlIGlmICh5RG9uZSkge1xuICAgICAgdmFsdWUgPSBbeEtleSwgbmV4dFgoKSwgYWJzZW50VmFsdWVdO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBjb21wID0gZnVsbENvbXBhcmUoeEtleSwgeUtleSk7XG4gICAgICBpZiAoY29tcCA9PT0gMCkge1xuICAgICAgICB2YWx1ZSA9IFt4S2V5LCBuZXh0WCgpLCBuZXh0WSgpXTtcbiAgICAgIH0gZWxzZSBpZiAoY29tcCA8IDApIHtcbiAgICAgICAgdmFsdWUgPSBbeEtleSwgbmV4dFgoKSwgYWJzZW50VmFsdWVdO1xuICAgICAgfSBlbHNlIGlmIChjb21wID4gMCkge1xuICAgICAgICB2YWx1ZSA9IFt5S2V5LCBhYnNlbnRWYWx1ZSwgbmV4dFkoKV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQga2V5IGNvbXBhcmlzb24gJHtxdW90ZShjb21wKX0gZm9yICR7eEtleX0gdnMgJHt5S2V5fWA7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oeyBkb25lLCB2YWx1ZSB9KTtcbiAgfSk7XG59O1xuaGFyZGVuKGdlbmVyYXRlQ29sbGVjdGlvblBhaXJFbnRyaWVzKTtcbnZhciBtYWtlQ29tcGFyZUNvbGxlY3Rpb24gPSAoZ2V0RW50cmllcywgYWJzZW50VmFsdWUsIGNvbXBhcmVWYWx1ZXMyKSA9PiBoYXJkZW4oKGxlZnQsIHJpZ2h0KSA9PiB7XG4gIGNvbnN0IG1lcmdlZCA9IGdlbmVyYXRlQ29sbGVjdGlvblBhaXJFbnRyaWVzKFxuICAgIGxlZnQsXG4gICAgcmlnaHQsXG4gICAgZ2V0RW50cmllcyxcbiAgICBhYnNlbnRWYWx1ZVxuICApO1xuICBsZXQgbGVmdElzQmlnZ2VyID0gZmFsc2U7XG4gIGxldCByaWdodElzQmlnZ2VyID0gZmFsc2U7XG4gIGZvciAoY29uc3QgW19rZXksIGxlZnRWYWx1ZSwgcmlnaHRWYWx1ZV0gb2YgbWVyZ2VkKSB7XG4gICAgY29uc3QgY29tcCA9IGNvbXBhcmVWYWx1ZXMyKGxlZnRWYWx1ZSwgcmlnaHRWYWx1ZSk7XG4gICAgaWYgKGNvbXAgPT09IDApIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH0gZWxzZSBpZiAoY29tcCA8IDApIHtcbiAgICAgIHJpZ2h0SXNCaWdnZXIgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoY29tcCA+IDApIHtcbiAgICAgIGxlZnRJc0JpZ2dlciA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIE51bWJlci5pc05hTihjb21wKSB8fCAvL1xuICAgICAgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIHZhbHVlIGNvbXBhcmlzb24gJHtxdW90ZShjb21wKX0gZm9yICR7bGVmdFZhbHVlfSB2cyAke3JpZ2h0VmFsdWV9YDtcbiAgICAgIHJldHVybiBOYU47XG4gICAgfVxuICAgIGlmIChsZWZ0SXNCaWdnZXIgJiYgcmlnaHRJc0JpZ2dlcikge1xuICAgICAgcmV0dXJuIE5hTjtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGxlZnRJc0JpZ2dlciA/IDEgOiByaWdodElzQmlnZ2VyID8gLTEgOiAwO1xufSk7XG5oYXJkZW4obWFrZUNvbXBhcmVDb2xsZWN0aW9uKTtcblxuLy9cbnZhciBzZXRDb21wYXJlID0gbWFrZUNvbXBhcmVDb2xsZWN0aW9uKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAoczMpID0+IGhhcmRlbihnZXRDb3B5U2V0S2V5cyhzMykubWFwKChrZXkpID0+IFtrZXksIDFdKSksXG4gIDAsXG4gIGNvbXBhcmVOdW1lcmljc1xuKTtcbmhhcmRlbihzZXRDb21wYXJlKTtcbnZhciBiYWdDb21wYXJlID0gbWFrZUNvbXBhcmVDb2xsZWN0aW9uKFxuICBnZXRDb3B5QmFnRW50cmllcyxcbiAgMG4sXG4gIGNvbXBhcmVOdW1lcmljc1xuKTtcbmhhcmRlbihiYWdDb21wYXJlKTtcbnZhciBBQlNFTlQgPSBTeW1ib2woXCJhYnNlbnRcIik7XG52YXIgX21hcENvbXBhcmUgPSBtYWtlQ29tcGFyZUNvbGxlY3Rpb24oXG4gIGdldENvcHlNYXBFbnRyeUFycmF5LFxuICBBQlNFTlQsXG4gIChsZWZ0VmFsdWUsIHJpZ2h0VmFsdWUpID0+IHtcbiAgICBpZiAobGVmdFZhbHVlID09PSBBQlNFTlQgJiYgcmlnaHRWYWx1ZSA9PT0gQUJTRU5UKSB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBVbmV4cGVjdGVkIGFic2VudCBlbnRyeSBwYWlyYDtcbiAgICB9IGVsc2UgaWYgKGxlZnRWYWx1ZSA9PT0gQUJTRU5UKSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfSBlbHNlIGlmIChyaWdodFZhbHVlID09PSBBQlNFTlQpIHtcbiAgICAgIHJldHVybiAxO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gY29tcGFyZUtleXMobGVmdFZhbHVlLCByaWdodFZhbHVlKTtcbiAgICB9XG4gIH1cbik7XG5oYXJkZW4oX21hcENvbXBhcmUpO1xudmFyIGNvbXBhcmVLZXlzID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gIGFzc2VydEtleShsZWZ0KTtcbiAgYXNzZXJ0S2V5KHJpZ2h0KTtcbiAgY29uc3QgbGVmdFN0eWxlID0gcGFzc1N0eWxlT2YobGVmdCk7XG4gIGNvbnN0IHJpZ2h0U3R5bGUgPSBwYXNzU3R5bGVPZihyaWdodCk7XG4gIGlmIChsZWZ0U3R5bGUgIT09IHJpZ2h0U3R5bGUpIHtcbiAgICByZXR1cm4gTmFOO1xuICB9XG4gIHN3aXRjaCAobGVmdFN0eWxlKSB7XG4gICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgIGNhc2UgXCJudWxsXCI6XG4gICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICBjYXNlIFwiYmlnaW50XCI6XG4gICAgY2FzZSBcInN0cmluZ1wiOlxuICAgIGNhc2UgXCJieXRlQXJyYXlcIjpcbiAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgIHJldHVybiBjb21wYXJlUmFuayhsZWZ0LCByaWdodCk7XG4gICAgfVxuICAgIGNhc2UgXCJudW1iZXJcIjoge1xuICAgICAgY29uc3QgcmFua0NvbXAgPSBjb21wYXJlUmFuayhsZWZ0LCByaWdodCk7XG4gICAgICBpZiAocmFua0NvbXAgPT09IDApIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgICBpZiAoTnVtYmVyLmlzTmFOKGxlZnQpIHx8IE51bWJlci5pc05hTihyaWdodCkpIHtcbiAgICAgICAgYXNzZXJ0KCFOdW1iZXIuaXNOYU4obGVmdCkgfHwgIU51bWJlci5pc05hTihyaWdodCkpO1xuICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJhbmtDb21wO1xuICAgIH1cbiAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgIGlmIChsZWZ0ID09PSByaWdodCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBOYU47XG4gICAgfVxuICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgY29uc3QgbGVuID0gTWF0aC5taW4obGVmdC5sZW5ndGgsIHJpZ2h0Lmxlbmd0aCk7XG4gICAgICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgbGVuOyBpMyArPSAxKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbXBhcmVLZXlzKGxlZnRbaTNdLCByaWdodFtpM10pO1xuICAgICAgICBpZiAocmVzdWx0ICE9PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNvbXBhcmVSYW5rKGxlZnQubGVuZ3RoLCByaWdodC5sZW5ndGgpO1xuICAgIH1cbiAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICBjb25zdCBsZWZ0TmFtZXMgPSByZWNvcmROYW1lcyhsZWZ0KTtcbiAgICAgIGNvbnN0IHJpZ2h0TmFtZXMgPSByZWNvcmROYW1lcyhyaWdodCk7XG4gICAgICBpZiAoIWtleUVRKGxlZnROYW1lcywgcmlnaHROYW1lcykpIHtcbiAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGxlZnRWYWx1ZXMgPSByZWNvcmRWYWx1ZXMobGVmdCwgbGVmdE5hbWVzKTtcbiAgICAgIGNvbnN0IHJpZ2h0VmFsdWVzID0gcmVjb3JkVmFsdWVzKHJpZ2h0LCByaWdodE5hbWVzKTtcbiAgICAgIGxldCByZXN1bHQgPSAwO1xuICAgICAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IGxlZnRWYWx1ZXMubGVuZ3RoOyBpMyArPSAxKSB7XG4gICAgICAgIGNvbnN0IGNvbXAgPSBjb21wYXJlS2V5cyhsZWZ0VmFsdWVzW2kzXSwgcmlnaHRWYWx1ZXNbaTNdKTtcbiAgICAgICAgaWYgKE51bWJlci5pc05hTihjb21wKSkge1xuICAgICAgICAgIHJldHVybiBOYU47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3VsdCAhPT0gY29tcCAmJiBjb21wICE9PSAwKSB7XG4gICAgICAgICAgaWYgKHJlc3VsdCA9PT0gMCkge1xuICAgICAgICAgICAgcmVzdWx0ID0gY29tcDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXNzZXJ0KFxuICAgICAgICAgICAgICByZXN1bHQgPT09IC0xICYmIGNvbXAgPT09IDEgfHwgcmVzdWx0ID09PSAxICYmIGNvbXAgPT09IC0xXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgY29uc3QgbGVmdFRhZyA9IGdldFRhZyhsZWZ0KTtcbiAgICAgIGNvbnN0IHJpZ2h0VGFnID0gZ2V0VGFnKHJpZ2h0KTtcbiAgICAgIGlmIChsZWZ0VGFnICE9PSByaWdodFRhZykge1xuICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgfVxuICAgICAgc3dpdGNoIChsZWZ0VGFnKSB7XG4gICAgICAgIGNhc2UgXCJjb3B5U2V0XCI6IHtcbiAgICAgICAgICByZXR1cm4gc2V0Q29tcGFyZShsZWZ0LCByaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImNvcHlCYWdcIjoge1xuICAgICAgICAgIHJldHVybiBiYWdDb21wYXJlKGxlZnQsIHJpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiY29weU1hcFwiOiB7XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBNYXAgY29tcGFyaXNvbiBub3QgeWV0IGltcGxlbWVudGVkOiAke2xlZnR9IHZzICR7cmlnaHR9YDtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIHRhZyAke3F1b3RlKGxlZnRUYWcpfTogJHtsZWZ0fWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIHBhc3NTdHlsZSAke3F1b3RlKGxlZnRTdHlsZSl9OiAke2xlZnR9YDtcbiAgICB9XG4gIH1cbn07XG5oYXJkZW4oY29tcGFyZUtleXMpO1xudmFyIGtleUxUID0gKGxlZnQsIHJpZ2h0KSA9PiBjb21wYXJlS2V5cyhsZWZ0LCByaWdodCkgPCAwO1xuaGFyZGVuKGtleUxUKTtcbnZhciBrZXlMVEUgPSAobGVmdCwgcmlnaHQpID0+IGNvbXBhcmVLZXlzKGxlZnQsIHJpZ2h0KSA8PSAwO1xuaGFyZGVuKGtleUxURSk7XG52YXIga2V5RVEgPSAobGVmdCwgcmlnaHQpID0+IGNvbXBhcmVLZXlzKGxlZnQsIHJpZ2h0KSA9PT0gMDtcbmhhcmRlbihrZXlFUSk7XG52YXIga2V5R1RFID0gKGxlZnQsIHJpZ2h0KSA9PiBjb21wYXJlS2V5cyhsZWZ0LCByaWdodCkgPj0gMDtcbmhhcmRlbihrZXlHVEUpO1xudmFyIGtleUdUID0gKGxlZnQsIHJpZ2h0KSA9PiBjb21wYXJlS2V5cyhsZWZ0LCByaWdodCkgPiAwO1xuaGFyZGVuKGtleUdUKTtcblxuLy9cbnZhciB3aW5kb3dSZXNvcnQgPSAoZWxlbWVudHMsIHJhbmtDb21wYXJlLCBmdWxsQ29tcGFyZSkgPT4ge1xuICBhc3NlcnRSYW5rU29ydGVkKGVsZW1lbnRzLCByYW5rQ29tcGFyZSk7XG4gIGNvbnN0IHsgbGVuZ3RoIH0gPSBlbGVtZW50cztcbiAgbGV0IGkzID0gMDtcbiAgbGV0IG9wdElubmVySXRlcmF0b3I7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiBoYXJkZW4oe1xuICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICBpZiAob3B0SW5uZXJJdGVyYXRvcikge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IG9wdElubmVySXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgICAgICAgb3B0SW5uZXJJdGVyYXRvciA9IHZvaWQgMDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGkzIDwgbGVuZ3RoKSB7XG4gICAgICAgICAgY29uc3QgdmFsdWUgPSBlbGVtZW50c1tpM107XG4gICAgICAgICAgbGV0IGogPSBpMyArIDE7XG4gICAgICAgICAgd2hpbGUgKGogPCBsZW5ndGggJiYgcmFua0NvbXBhcmUodmFsdWUsIGVsZW1lbnRzW2pdKSA9PT0gMCkge1xuICAgICAgICAgICAgaiArPSAxO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaiA9PT0gaTMgKyAxKSB7XG4gICAgICAgICAgICBpMyA9IGo7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBzaW1pbGFyUnVuID0gZWxlbWVudHMuc2xpY2UoaTMsIGopO1xuICAgICAgICAgIGkzID0gajtcbiAgICAgICAgICBjb25zdCByZXNvcnRlZCA9IHNvcnRCeVJhbmsoc2ltaWxhclJ1biwgZnVsbENvbXBhcmUpO1xuICAgICAgICAgIGFzc2VydE5vRHVwbGljYXRlcyhyZXNvcnRlZCwgZnVsbENvbXBhcmUpO1xuICAgICAgICAgIG9wdElubmVySXRlcmF0b3IgPSByZXNvcnRlZFtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICAgICAgcmV0dXJuIG9wdElubmVySXRlcmF0b3IubmV4dCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogbnVsbCB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIH0pO1xufTtcbnZhciBtZXJnZSA9ICh4ZWxlbWVudHMsIHllbGVtZW50cykgPT4ge1xuICBjb25zdCBmdWxsQ29tcGFyZSA9IG1ha2VGdWxsT3JkZXJDb21wYXJhdG9yS2l0KCkuYW50aUNvbXBhcmF0b3I7XG4gIGNvbnN0IHhzID0gd2luZG93UmVzb3J0KHhlbGVtZW50cywgY29tcGFyZUFudGlSYW5rLCBmdWxsQ29tcGFyZSk7XG4gIGNvbnN0IHlzID0gd2luZG93UmVzb3J0KHllbGVtZW50cywgY29tcGFyZUFudGlSYW5rLCBmdWxsQ29tcGFyZSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBsZXQgeDtcbiAgICAgIGxldCB4RG9uZTtcbiAgICAgIGxldCB5O1xuICAgICAgbGV0IHlEb25lO1xuICAgICAgY29uc3QgeGkgPSB4c1tTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICBjb25zdCBuZXh0WCA9ICgpID0+IHtcbiAgICAgICAgIXhEb25lIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IG5leHRYIHNob3VsZCBub3QgYmUgY2FsbGVkIG9uY2UgZG9uZWA7XG4gICAgICAgICh7IGRvbmU6IHhEb25lLCB2YWx1ZTogeCB9ID0geGkubmV4dCgpKTtcbiAgICAgIH07XG4gICAgICBuZXh0WCgpO1xuICAgICAgY29uc3QgeWkgPSB5c1tTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICBjb25zdCBuZXh0WSA9ICgpID0+IHtcbiAgICAgICAgIXlEb25lIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IG5leHRZIHNob3VsZCBub3QgYmUgY2FsbGVkIG9uY2UgZG9uZWA7XG4gICAgICAgICh7IGRvbmU6IHlEb25lLCB2YWx1ZTogeSB9ID0geWkubmV4dCgpKTtcbiAgICAgIH07XG4gICAgICBuZXh0WSgpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBsZXQgZG9uZSA9IGZhbHNlO1xuICAgICAgICAgIGxldCB2YWx1ZTtcbiAgICAgICAgICBpZiAoeERvbmUgJiYgeURvbmUpIHtcbiAgICAgICAgICAgIGRvbmUgPSB0cnVlO1xuICAgICAgICAgICAgdmFsdWUgPSBbbnVsbCwgMG4sIDBuXTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHhEb25lKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IFt5LCAwbiwgMW5dO1xuICAgICAgICAgICAgbmV4dFkoKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHlEb25lKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IFt4LCAxbiwgMG5dO1xuICAgICAgICAgICAgbmV4dFgoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgY29tcCA9IGZ1bGxDb21wYXJlKHgsIHkpO1xuICAgICAgICAgICAgaWYgKGNvbXAgPT09IDApIHtcbiAgICAgICAgICAgICAgdmFsdWUgPSBbeCwgMW4sIDFuXTtcbiAgICAgICAgICAgICAgbmV4dFgoKTtcbiAgICAgICAgICAgICAgbmV4dFkoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29tcCA8IDApIHtcbiAgICAgICAgICAgICAgdmFsdWUgPSBbeCwgMW4sIDBuXTtcbiAgICAgICAgICAgICAgbmV4dFgoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbXAgPiAwIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IFVuZXhwZWN0ZWQgY29tcCAke3F1b3RlKGNvbXApfWA7XG4gICAgICAgICAgICAgIHZhbHVlID0gW3ksIDBuLCAxbl07XG4gICAgICAgICAgICAgIG5leHRZKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lLCB2YWx1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWVyZ2UpO1xudmFyIGl0ZXJJc1N1cGVyc2V0ID0gKHh5aSkgPT4ge1xuICBmb3IgKGNvbnN0IFtfbSwgeGMsIF95Y10gb2YgeHlpKSB7XG4gICAgaWYgKHhjID09PSAwbikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgaXRlcklzRGlzam9pbnQgPSAoeHlpKSA9PiB7XG4gIGZvciAoY29uc3QgW19tLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA+PSAxbiAmJiB5YyA+PSAxbikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgaXRlckNvbXBhcmUgPSAoeHlpKSA9PiB7XG4gIGxldCBsb25lWSA9IGZhbHNlO1xuICBsZXQgbG9uZVggPSBmYWxzZTtcbiAgZm9yIChjb25zdCBbX20sIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgaWYgKHhjID09PSAwbikge1xuICAgICAgbG9uZVkgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoeWMgPT09IDBuKSB7XG4gICAgICBsb25lWCA9IHRydWU7XG4gICAgfVxuICAgIGlmIChsb25lWCAmJiBsb25lWSkge1xuICAgICAgcmV0dXJuIE5hTjtcbiAgICB9XG4gIH1cbiAgaWYgKGxvbmVYKSB7XG4gICAgcmV0dXJuIDE7XG4gIH0gZWxzZSBpZiAobG9uZVkpIHtcbiAgICByZXR1cm4gLTE7XG4gIH0gZWxzZSB7XG4gICAgIWxvbmVYICYmICFsb25lWSB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBVbmV4cGVjdGVkIGxvbmUgcGFpciAke3F1b3RlKFtsb25lWCwgbG9uZVldKX1gO1xuICAgIHJldHVybiAwO1xuICB9XG59O1xudmFyIGl0ZXJVbmlvbiA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA+PSAwbikge1xuICAgICAgcmVzdWx0LnB1c2gobTIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB5YyA+PSAwbiB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBVbmV4cGVjdGVkIGNvdW50ICR7cXVvdGUoeWMpfWA7XG4gICAgICByZXN1bHQucHVzaChtMik7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xudmFyIGl0ZXJEaXNqb2ludFVuaW9uID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgeGMgPT09IDBuIHx8IHljID09PSAwbiB8fCB0aHJvd1JlZGFjdGVkYFNldHMgbXVzdCBub3QgaGF2ZSBjb21tb24gZWxlbWVudHM6ICR7bTJ9YDtcbiAgICBpZiAoeGMgPj0gMW4pIHtcbiAgICAgIHJlc3VsdC5wdXNoKG0yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgeWMgPj0gMW4gfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogVW5leHBlY3RlZCBjb3VudCAke3F1b3RlKHljKX1gO1xuICAgICAgcmVzdWx0LnB1c2gobTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBpdGVySW50ZXJzZWN0aW9uID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgaWYgKHhjID49IDFuICYmIHljID49IDFuKSB7XG4gICAgICByZXN1bHQucHVzaChtMik7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xudmFyIGl0ZXJEaXNqb2ludFN1YnRyYWN0ID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgeGMgPj0gMW4gfHwgdGhyb3dSZWRhY3RlZGByaWdodCBlbGVtZW50ICR7bTJ9IHdhcyBub3QgaW4gbGVmdGA7XG4gICAgaWYgKHljID09PSAwbikge1xuICAgICAgcmVzdWx0LnB1c2gobTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBtZXJnZWlmeSA9IChpdGVyT3ApID0+ICh4ZWxlbWVudHMsIHllbGVtZW50cykgPT4gaXRlck9wKG1lcmdlKHhlbGVtZW50cywgeWVsZW1lbnRzKSk7XG52YXIgZWxlbWVudHNJc1N1cGVyc2V0ID0gbWVyZ2VpZnkoaXRlcklzU3VwZXJzZXQpO1xudmFyIGVsZW1lbnRzSXNEaXNqb2ludCA9IG1lcmdlaWZ5KGl0ZXJJc0Rpc2pvaW50KTtcbnZhciBlbGVtZW50c0NvbXBhcmUgPSBtZXJnZWlmeShpdGVyQ29tcGFyZSk7XG52YXIgZWxlbWVudHNVbmlvbiA9IG1lcmdlaWZ5KGl0ZXJVbmlvbik7XG52YXIgZWxlbWVudHNEaXNqb2ludFVuaW9uID0gbWVyZ2VpZnkoaXRlckRpc2pvaW50VW5pb24pO1xudmFyIGVsZW1lbnRzSW50ZXJzZWN0aW9uID0gbWVyZ2VpZnkoaXRlckludGVyc2VjdGlvbik7XG52YXIgZWxlbWVudHNEaXNqb2ludFN1YnRyYWN0ID0gbWVyZ2VpZnkoaXRlckRpc2pvaW50U3VidHJhY3QpO1xudmFyIHJhd1NldGlmeSA9IChlbGVtZW50c09wKSA9PiAoeHNldCwgeXNldCkgPT4gZWxlbWVudHNPcCh4c2V0LnBheWxvYWQsIHlzZXQucGF5bG9hZCk7XG52YXIgc2V0aWZ5ID0gKGVsZW1lbnRzT3ApID0+ICh4c2V0LCB5c2V0KSA9PiBtYWtlU2V0T2ZFbGVtZW50cyhlbGVtZW50c09wKHhzZXQucGF5bG9hZCwgeXNldC5wYXlsb2FkKSk7XG52YXIgc2V0SXNTdXBlcnNldCA9IHJhd1NldGlmeShlbGVtZW50c0lzU3VwZXJzZXQpO1xudmFyIHNldElzRGlzam9pbnQgPSByYXdTZXRpZnkoZWxlbWVudHNJc0Rpc2pvaW50KTtcbnZhciBzZXRVbmlvbiA9IHNldGlmeShlbGVtZW50c1VuaW9uKTtcbnZhciBzZXREaXNqb2ludFVuaW9uID0gc2V0aWZ5KGVsZW1lbnRzRGlzam9pbnRVbmlvbik7XG52YXIgc2V0SW50ZXJzZWN0aW9uID0gc2V0aWZ5KGVsZW1lbnRzSW50ZXJzZWN0aW9uKTtcbnZhciBzZXREaXNqb2ludFN1YnRyYWN0ID0gc2V0aWZ5KGVsZW1lbnRzRGlzam9pbnRTdWJ0cmFjdCk7XG5cbi8vXG52YXIgYmFnV2luZG93UmVzb3J0ID0gKGJhZ0VudHJpZXMsIHJhbmtDb21wYXJlLCBmdWxsQ29tcGFyZSkgPT4ge1xuICBhc3NlcnRSYW5rU29ydGVkKGJhZ0VudHJpZXMsIHJhbmtDb21wYXJlKTtcbiAgY29uc3QgeyBsZW5ndGggfSA9IGJhZ0VudHJpZXM7XG4gIGxldCBpMyA9IDA7XG4gIGxldCBvcHRJbm5lckl0ZXJhdG9yO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4gaGFyZGVuKHtcbiAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgaWYgKG9wdElubmVySXRlcmF0b3IpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBvcHRJbm5lckl0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgICAgIG9wdElubmVySXRlcmF0b3IgPSB2b2lkIDA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChpMyA8IGxlbmd0aCkge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gYmFnRW50cmllc1tpM107XG4gICAgICAgICAgbGV0IGogPSBpMyArIDE7XG4gICAgICAgICAgd2hpbGUgKGogPCBsZW5ndGggJiYgcmFua0NvbXBhcmUoZW50cnlbMF0sIGJhZ0VudHJpZXNbal1bMF0pID09PSAwKSB7XG4gICAgICAgICAgICBqICs9IDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChqID09PSBpMyArIDEpIHtcbiAgICAgICAgICAgIGkzID0gajtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWU6IGVudHJ5IH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBzaW1pbGFyUnVuID0gYmFnRW50cmllcy5zbGljZShpMywgaik7XG4gICAgICAgICAgaTMgPSBqO1xuICAgICAgICAgIGNvbnN0IHJlc29ydGVkID0gc29ydEJ5UmFuayhzaW1pbGFyUnVuLCBmdWxsQ29tcGFyZSk7XG4gICAgICAgICAgYXNzZXJ0Tm9EdXBsaWNhdGVLZXlzKHJlc29ydGVkLCBmdWxsQ29tcGFyZSk7XG4gICAgICAgICAgb3B0SW5uZXJJdGVyYXRvciA9IHJlc29ydGVkW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgICAgICByZXR1cm4gb3B0SW5uZXJJdGVyYXRvci5uZXh0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlOiBbbnVsbCwgMG5dIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSk7XG59O1xudmFyIG1lcmdlMiA9ICh4YmFnRW50cmllcywgeWJhZ0VudHJpZXMpID0+IHtcbiAgY29uc3QgZnVsbENvbXBhcmUgPSBtYWtlRnVsbE9yZGVyQ29tcGFyYXRvcktpdCgpLmFudGlDb21wYXJhdG9yO1xuICBjb25zdCB4cyA9IGJhZ1dpbmRvd1Jlc29ydCh4YmFnRW50cmllcywgY29tcGFyZUFudGlSYW5rLCBmdWxsQ29tcGFyZSk7XG4gIGNvbnN0IHlzID0gYmFnV2luZG93UmVzb3J0KHliYWdFbnRyaWVzLCBjb21wYXJlQW50aVJhbmssIGZ1bGxDb21wYXJlKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGxldCB4O1xuICAgICAgbGV0IHhjO1xuICAgICAgbGV0IHhEb25lO1xuICAgICAgbGV0IHk7XG4gICAgICBsZXQgeWM7XG4gICAgICBsZXQgeURvbmU7XG4gICAgICBjb25zdCB4aSA9IHhzW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgIGNvbnN0IG5leHRYID0gKCkgPT4ge1xuICAgICAgICAheERvbmUgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogbmV4dFggc2hvdWxkIG5vdCBiZSBjYWxsZWQgb25jZSBkb25lYDtcbiAgICAgICAgKHtcbiAgICAgICAgICBkb25lOiB4RG9uZSxcbiAgICAgICAgICB2YWx1ZTogW3gsIHhjXVxuICAgICAgICB9ID0geGkubmV4dCgpKTtcbiAgICAgIH07XG4gICAgICBuZXh0WCgpO1xuICAgICAgY29uc3QgeWkgPSB5c1tTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICBjb25zdCBuZXh0WSA9ICgpID0+IHtcbiAgICAgICAgIXlEb25lIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IG5leHRZIHNob3VsZCBub3QgYmUgY2FsbGVkIG9uY2UgZG9uZWA7XG4gICAgICAgICh7XG4gICAgICAgICAgZG9uZTogeURvbmUsXG4gICAgICAgICAgdmFsdWU6IFt5LCB5Y11cbiAgICAgICAgfSA9IHlpLm5leHQoKSk7XG4gICAgICB9O1xuICAgICAgbmV4dFkoKTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgbGV0IGRvbmUgPSBmYWxzZTtcbiAgICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgICAgaWYgKHhEb25lICYmIHlEb25lKSB7XG4gICAgICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhbHVlID0gW251bGwsIDBuLCAwbl07XG4gICAgICAgICAgfSBlbHNlIGlmICh4RG9uZSkge1xuICAgICAgICAgICAgdmFsdWUgPSBbeSwgMG4sIHljXTtcbiAgICAgICAgICAgIG5leHRZKCk7XG4gICAgICAgICAgfSBlbHNlIGlmICh5RG9uZSkge1xuICAgICAgICAgICAgdmFsdWUgPSBbeCwgeGMsIDBuXTtcbiAgICAgICAgICAgIG5leHRYKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbXAgPSBmdWxsQ29tcGFyZSh4LCB5KTtcbiAgICAgICAgICAgIGlmIChjb21wID09PSAwKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gW3gsIHhjLCB5Y107XG4gICAgICAgICAgICAgIG5leHRYKCk7XG4gICAgICAgICAgICAgIG5leHRZKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXAgPCAwKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gW3gsIHhjLCAwbl07XG4gICAgICAgICAgICAgIG5leHRYKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb21wID4gMCB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBVbmV4cGVjdGVkIGNvbXAgJHtxdW90ZShjb21wKX1gO1xuICAgICAgICAgICAgICB2YWx1ZSA9IFt5LCAwbiwgeWNdO1xuICAgICAgICAgICAgICBuZXh0WSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZSwgdmFsdWUgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1lcmdlMik7XG52YXIgYmFnSXRlcklzU3VwZXJiYWcgPSAoeHlpKSA9PiB7XG4gIGZvciAoY29uc3QgW19tLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA8IHljKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcbnZhciBiYWdJdGVySXNEaXNqb2ludCA9ICh4eWkpID0+IHtcbiAgZm9yIChjb25zdCBbX20sIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgaWYgKHhjID49IDFuICYmIHljID49IDFuKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcbnZhciBiYWdJdGVyVW5pb24gPSAoeHlpKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3IgKGNvbnN0IFttMiwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICByZXN1bHQucHVzaChbbTIsIHhjICsgeWNdKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBiYWdJdGVySW50ZXJzZWN0aW9uID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgY29uc3QgbWMgPSB4YyA8PSB5YyA/IHhjIDogeWM7XG4gICAgcmVzdWx0LnB1c2goW20yLCBtY10pO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xudmFyIGJhZ0l0ZXJEaXNqb2ludFN1YnRyYWN0ID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgY29uc3QgbWMgPSB4YyAtIHljO1xuICAgIG1jID49IDBuIHx8IHRocm93UmVkYWN0ZWRgcmlnaHQgZWxlbWVudCAke20yfSB3YXMgbm90IGluIGxlZnRgO1xuICAgIGlmIChtYyA+PSAxbikge1xuICAgICAgcmVzdWx0LnB1c2goW20yLCBtY10pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBtZXJnZWlmeTIgPSAoYmFnSXRlck9wKSA9PiAoeGJhZ0VudHJpZXMsIHliYWdFbnRyaWVzKSA9PiBiYWdJdGVyT3AobWVyZ2UyKHhiYWdFbnRyaWVzLCB5YmFnRW50cmllcykpO1xudmFyIGJhZ0VudHJpZXNJc1N1cGVyYmFnID0gbWVyZ2VpZnkyKGJhZ0l0ZXJJc1N1cGVyYmFnKTtcbnZhciBiYWdFbnRyaWVzSXNEaXNqb2ludCA9IG1lcmdlaWZ5MihiYWdJdGVySXNEaXNqb2ludCk7XG52YXIgYmFnRW50cmllc1VuaW9uID0gbWVyZ2VpZnkyKGJhZ0l0ZXJVbmlvbik7XG52YXIgYmFnRW50cmllc0ludGVyc2VjdGlvbiA9IG1lcmdlaWZ5MihiYWdJdGVySW50ZXJzZWN0aW9uKTtcbnZhciBiYWdFbnRyaWVzRGlzam9pbnRTdWJ0cmFjdCA9IG1lcmdlaWZ5MihiYWdJdGVyRGlzam9pbnRTdWJ0cmFjdCk7XG52YXIgcmF3QmFnaWZ5ID0gKGJhZ0VudHJpZXNPcCkgPT4gKHhiYWcsIHliYWcpID0+IGJhZ0VudHJpZXNPcCh4YmFnLnBheWxvYWQsIHliYWcucGF5bG9hZCk7XG52YXIgYmFnaWZ5ID0gKGJhZ0VudHJpZXNPcCkgPT4gKHhiYWcsIHliYWcpID0+IG1ha2VCYWdPZkVudHJpZXMoYmFnRW50cmllc09wKHhiYWcucGF5bG9hZCwgeWJhZy5wYXlsb2FkKSk7XG52YXIgYmFnSXNTdXBlcmJhZyA9IHJhd0JhZ2lmeShiYWdFbnRyaWVzSXNTdXBlcmJhZyk7XG52YXIgYmFnSXNEaXNqb2ludCA9IHJhd0JhZ2lmeShiYWdFbnRyaWVzSXNEaXNqb2ludCk7XG52YXIgYmFnVW5pb24gPSBiYWdpZnkoYmFnRW50cmllc1VuaW9uKTtcbnZhciBiYWdJbnRlcnNlY3Rpb24gPSBiYWdpZnkoYmFnRW50cmllc0ludGVyc2VjdGlvbik7XG52YXIgYmFnRGlzam9pbnRTdWJ0cmFjdCA9IGJhZ2lmeShiYWdFbnRyaWVzRGlzam9pbnRTdWJ0cmFjdCk7XG5cbi8vXG52YXIgdGhyb3dMYWJlbGVkID0gKGlubmVyRXJyLCBsYWJlbCwgZXJyQ29uc3RydWN0b3IgPSB2b2lkIDAsIG9wdGlvbnMgPSB2b2lkIDApID0+IHtcbiAgaWYgKHR5cGVvZiBsYWJlbCA9PT0gXCJudW1iZXJcIikge1xuICAgIGxhYmVsID0gYFske2xhYmVsfV1gO1xuICB9XG4gIGNvbnN0IG91dGVyRXJyID0gbWFrZUVycm9yKFxuICAgIGAke2xhYmVsfTogJHtpbm5lckVyci5tZXNzYWdlfWAsXG4gICAgZXJyQ29uc3RydWN0b3IsXG4gICAgb3B0aW9uc1xuICApO1xuICBub3RlKG91dGVyRXJyLCByZWRhY3RlZGBDYXVzZWQgYnkgJHtpbm5lckVycn1gKTtcbiAgdGhyb3cgb3V0ZXJFcnI7XG59O1xuaGFyZGVuKHRocm93TGFiZWxlZCk7XG5cbi8vXG52YXIgYXBwbHlMYWJlbGluZ0Vycm9yID0gKGZ1bmMsIGFyZ3MsIGxhYmVsID0gdm9pZCAwKSA9PiB7XG4gIGlmIChsYWJlbCA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIGZ1bmMoLi4uYXJncyk7XG4gIH1cbiAgbGV0IHJlc3VsdDtcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBmdW5jKC4uLmFyZ3MpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICB0aHJvd0xhYmVsZWQoZXJyLCBsYWJlbCk7XG4gIH1cbiAgaWYgKGlzUHJvbWlzZShyZXN1bHQpKSB7XG4gICAgcmV0dXJuIEUud2hlbihyZXN1bHQsIHZvaWQgMCwgKHJlYXNvbikgPT4gdGhyb3dMYWJlbGVkKHJlYXNvbiwgbGFiZWwpKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG59O1xuaGFyZGVuKGFwcGx5TGFiZWxpbmdFcnJvcik7XG5cbi8vXG52YXIgeyBmcm9tRW50cmllczogZnJvbUVudHJpZXM3IH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTcgfSA9IFJlZmxlY3Q7XG52YXIgZnJvbVVuaXF1ZUVudHJpZXMgPSAoYWxsRW50cmllcykgPT4ge1xuICBjb25zdCBlbnRyaWVzQXJyYXkgPSBbLi4uYWxsRW50cmllc107XG4gIGNvbnN0IHJlc3VsdCA9IGhhcmRlbihmcm9tRW50cmllczcoZW50cmllc0FycmF5KSk7XG4gIGlmIChvd25LZXlzMTcocmVzdWx0KS5sZW5ndGggPT09IGVudHJpZXNBcnJheS5sZW5ndGgpIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIGNvbnN0IG5hbWVzID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgZm9yIChjb25zdCBbbmFtZSwgX10gb2YgZW50cmllc0FycmF5KSB7XG4gICAgaWYgKG5hbWVzLmhhcyhuYW1lKSkge1xuICAgICAgdGhyb3dSZWRhY3RlZGBjb2xsaXNpb24gb24gcHJvcGVydHkgbmFtZSAke3F1b3RlKG5hbWUpfTogJHtlbnRyaWVzQXJyYXl9YDtcbiAgICB9XG4gICAgbmFtZXMuYWRkKG5hbWUpO1xuICB9XG4gIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGZhaWxlZCB0byBjcmVhdGUgb2JqZWN0IGZyb20gdW5pcXVlIGVudHJpZXNgO1xufTtcbmhhcmRlbihmcm9tVW5pcXVlRW50cmllcyk7XG5cbi8vXG52YXIgbGlzdERpZmZlcmVuY2UgPSAobGVmdExpc3QsIHJpZ2h0TGlzdCkgPT4ge1xuICBjb25zdCByaWdodFNldCA9IG5ldyBTZXQocmlnaHRMaXN0KTtcbiAgcmV0dXJuIGxlZnRMaXN0LmZpbHRlcigoZWxlbWVudCkgPT4gIXJpZ2h0U2V0LmhhcyhlbGVtZW50KSk7XG59O1xuaGFyZGVuKGxpc3REaWZmZXJlbmNlKTtcblxuLy9cbnZhciB7IGVudHJpZXM6IGVudHJpZXM3LCB2YWx1ZXM6IHZhbHVlczIsIGhhc093bjogaGFzT3duOSB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czE4IH0gPSBSZWZsZWN0O1xudmFyIHBhdHRlcm5NZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCk7XG52YXIgTU07XG52YXIgZGVmYXVsdExpbWl0cyA9IGhhcmRlbih7XG4gIGRlY2ltYWxEaWdpdHNMaW1pdDogMTAwLFxuICBzdHJpbmdMZW5ndGhMaW1pdDogMWU1LFxuICBzeW1ib2xOYW1lTGVuZ3RoTGltaXQ6IDEwMCxcbiAgbnVtUHJvcGVydGllc0xpbWl0OiA4MCxcbiAgcHJvcGVydHlOYW1lTGVuZ3RoTGltaXQ6IDEwMCxcbiAgYXJyYXlMZW5ndGhMaW1pdDogMWU0LFxuICBieXRlTGVuZ3RoTGltaXQ6IDFlNSxcbiAgbnVtU2V0RWxlbWVudHNMaW1pdDogMWU0LFxuICBudW1VbmlxdWVCYWdFbGVtZW50c0xpbWl0OiAxZTQsXG4gIG51bU1hcEVudHJpZXNMaW1pdDogNWUzXG59KTtcbnZhciBsaW1pdCA9IChsaW1pdHMgPSB7fSkgPT4gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgaGFyZGVuKHsgX19wcm90b19fOiBkZWZhdWx0TGltaXRzLCAuLi5saW1pdHMgfSlcbik7XG52YXIgY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQgPSAocGF5bG9hZCwgbWFpblBheWxvYWRTaGFwZSwgY2hlY2ssIGxhYmVsKSA9PiB7XG4gIGFzc2VydChBcnJheS5pc0FycmF5KG1haW5QYXlsb2FkU2hhcGUpKTtcbiAgaWYgKCFBcnJheS5pc0FycmF5KHBheWxvYWQpKSB7XG4gICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3F1b3RlKGxhYmVsKX0gcGF5bG9hZCBtdXN0IGJlIGFuIGFycmF5OiAke3BheWxvYWR9YCk7XG4gIH1cbiAgY29uc3QgbWFpbkxlbmd0aCA9IG1haW5QYXlsb2FkU2hhcGUubGVuZ3RoO1xuICBpZiAoIShwYXlsb2FkLmxlbmd0aCA9PT0gbWFpbkxlbmd0aCB8fCBwYXlsb2FkLmxlbmd0aCA9PT0gbWFpbkxlbmd0aCArIDEpKSB7XG4gICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3F1b3RlKGxhYmVsKX0gcGF5bG9hZCB1bmV4cGVjdGVkIHNpemU6ICR7cGF5bG9hZH1gKTtcbiAgfVxuICBjb25zdCBsaW1pdHMgPSBwYXlsb2FkW21haW5MZW5ndGhdO1xuICBwYXlsb2FkID0gaGFyZGVuKHBheWxvYWQuc2xpY2UoMCwgbWFpbkxlbmd0aCkpO1xuICBpZiAoIWNoZWNrTWF0Y2hlcyhwYXlsb2FkLCBtYWluUGF5bG9hZFNoYXBlLCBjaGVjaywgbGFiZWwpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGlmIChsaW1pdHMgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiAocGFzc1N0eWxlT2YobGltaXRzKSA9PT0gXCJjb3B5UmVjb3JkXCIgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYExpbWl0cyBtdXN0IGJlIGEgcmVjb3JkOiAke3F1b3RlKGxpbWl0cyl9YCkpICYmIGVudHJpZXM3KGxpbWl0cykuZXZlcnkoXG4gICAgKFtrZXksIHZhbHVlXSkgPT4gcGFzc1N0eWxlT2YodmFsdWUpID09PSBcIm51bWJlclwiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBWYWx1ZSBvZiBsaW1pdCAke3F1b3RlKGtleSl9IGJ1dCBiZSBhIG51bWJlcjogJHtxdW90ZSh2YWx1ZSl9YClcbiAgKTtcbn07XG52YXIgY2hlY2tEZWNpbWFsRGlnaXRzTGltaXQgPSAoc3BlY2ltZW4sIGRlY2ltYWxEaWdpdHNMaW1pdCwgY2hlY2spID0+IHtcbiAgaWYgKE1hdGguZmxvb3IoTWF0aC5sb2cxMChNYXRoLmFicyhOdW1iZXIoc3BlY2ltZW4pKSkpICsgMSA8PSBkZWNpbWFsRGlnaXRzTGltaXQpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gY2hlY2soXG4gICAgZmFsc2UsXG4gICAgcmVkYWN0ZWRgYmlnaW50ICR7c3BlY2ltZW59IG11c3Qgbm90IGhhdmUgbW9yZSB0aGFuICR7ZGVjaW1hbERpZ2l0c0xpbWl0fSBkaWdpdHNgXG4gICk7XG59O1xudmFyIG1ha2VQYXR0ZXJuS2l0ID0gKCkgPT4ge1xuICBjb25zdCBtYXliZU1hdGNoSGVscGVyID0gKHRhZykgPT4gKFxuICAgIC8vXG4gICAgSGVscGVyc0J5TWF0Y2hUYWdbdGFnXVxuICApO1xuICBjb25zdCBtYXliZVBheWxvYWRTaGFwZSA9ICh0YWcpID0+IChcbiAgICAvL1xuICAgIEd1YXJkUGF5bG9hZFNoYXBlc1t0YWddXG4gICk7XG4gIGNvbnN0IHNpbmdsZXRvbktpbmRzID0gLyogICAgICAgICAgICovIG5ldyBNYXAoW1xuICAgIFtcIm51bGxcIiwgbnVsbF0sXG4gICAgW1widW5kZWZpbmVkXCIsIHZvaWQgMF1cbiAgXSk7XG4gIGNvbnN0IHRhZ01lbW8gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgY2hlY2tUYWdnZWQgPSAodGFnZ2VkLCB0YWcsIGNoZWNrKSA9PiB7XG4gICAgY29uc3QgbWF0Y2hIZWxwZXIgPSBtYXliZU1hdGNoSGVscGVyKHRhZyk7XG4gICAgaWYgKG1hdGNoSGVscGVyKSB7XG4gICAgICByZXR1cm4gbWF0Y2hIZWxwZXIuY2hlY2tJc1dlbGxGb3JtZWQodGFnZ2VkLnBheWxvYWQsIGNoZWNrKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgcGF5bG9hZFNoYXBlID0gbWF5YmVQYXlsb2FkU2hhcGUodGFnKTtcbiAgICAgIGlmIChwYXlsb2FkU2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gY2hlY2tNYXRjaGVzMih0YWdnZWQucGF5bG9hZCwgcGF5bG9hZFNoYXBlLCBjaGVjaywgdGFnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgc3dpdGNoICh0YWcpIHtcbiAgICAgIGNhc2UgXCJjb3B5U2V0XCI6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrQ29weVNldCh0YWdnZWQsIGNoZWNrKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5QmFnXCI6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrQ29weUJhZyh0YWdnZWQsIGNoZWNrKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5TWFwXCI6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrQ29weU1hcCh0YWdnZWQsIGNoZWNrKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHJlZGFjdGVkYGNhbm5vdCBjaGVjayB1bnJlY29nbml6ZWQgdGFnICR7cXVvdGUodGFnKX06ICR7dGFnZ2VkfWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IGtpbmRPZjIgPSAoc3BlY2ltZW4sIGNoZWNrID0gaWRlbnRDaGVja2VyKSA9PiB7XG4gICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2Yoc3BlY2ltZW4pO1xuICAgIGlmIChwYXNzU3R5bGUgIT09IFwidGFnZ2VkXCIpIHtcbiAgICAgIHJldHVybiBwYXNzU3R5bGU7XG4gICAgfVxuICAgIGlmICh0YWdNZW1vLmhhcyhzcGVjaW1lbikpIHtcbiAgICAgIHJldHVybiB0YWdNZW1vLmdldChzcGVjaW1lbik7XG4gICAgfVxuICAgIGNvbnN0IHRhZyA9IGdldFRhZyhzcGVjaW1lbik7XG4gICAgaWYgKGNoZWNrVGFnZ2VkKHNwZWNpbWVuLCB0YWcsIGNoZWNrKSkge1xuICAgICAgdGFnTWVtby5zZXQoc3BlY2ltZW4sIHRhZyk7XG4gICAgICByZXR1cm4gdGFnO1xuICAgIH1cbiAgICBpZiAoY2hlY2sgIT09IGlkZW50Q2hlY2tlcikge1xuICAgICAgY2hlY2soZmFsc2UsIHJlZGFjdGVkYGNhbm5vdCBjaGVjayB1bnJlY29nbml6ZWQgdGFnICR7cXVvdGUodGFnKX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfTtcbiAgaGFyZGVuKGtpbmRPZjIpO1xuICBjb25zdCBjaGVja0tpbmQgPSAoc3BlY2ltZW4sIGtpbmQyLCBjaGVjaykgPT4ge1xuICAgIGlmIChzaW5nbGV0b25LaW5kcy5oYXMoa2luZDIpKSB7XG4gICAgICByZXR1cm4gY2hlY2tBc0tleVBhdHQoc3BlY2ltZW4sIHNpbmdsZXRvbktpbmRzLmdldChraW5kMiksIGNoZWNrKTtcbiAgICB9XG4gICAgY29uc3QgcmVhbEtpbmQgPSBraW5kT2YyKHNwZWNpbWVuLCBjaGVjayk7XG4gICAgaWYgKGtpbmQyID09PSByZWFsS2luZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChjaGVjayAhPT0gaWRlbnRDaGVja2VyKSB7XG4gICAgICBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtiYXJlT3JRdW90ZShyZWFsS2luZCl9ICR7c3BlY2ltZW59IC0gTXVzdCBiZSBhICR7YmFyZU9yUXVvdGUoa2luZDIpfWApO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIGNvbnN0IGlzS2luZCA9IChzcGVjaW1lbiwga2luZDIpID0+IGNoZWNrS2luZChzcGVjaW1lbiwga2luZDIsIGlkZW50Q2hlY2tlcik7XG4gIGNvbnN0IGlzVW5kZWZpbmVkUGF0dCA9IChwYXR0KSA9PiBwYXR0ID09PSB2b2lkIDAgfHwgaXNLaW5kKHBhdHQsIFwibWF0Y2g6a2luZFwiKSAmJiBwYXR0LnBheWxvYWQgPT09IFwidW5kZWZpbmVkXCI7XG4gIGNvbnN0IGNoZWNrQXNLZXlQYXR0ID0gKHNwZWNpbWVuLCBrZXlBc1BhdHRlcm4sIGNoZWNrKSA9PiB7XG4gICAgaWYgKGlzS2V5KHNwZWNpbWVuKSAmJiBrZXlFUShzcGVjaW1lbiwga2V5QXNQYXR0ZXJuKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBjaGVjayAhPT0gaWRlbnRDaGVja2VyICYmIC8vXG4gICAgLy9cbiAgICBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlOiAke2tleUFzUGF0dGVybn1gKTtcbiAgfTtcbiAgY29uc3QgY2hlY2tQYXR0ZXJuID0gKHBhdHQsIGNoZWNrKSA9PiB7XG4gICAgaWYgKGlzS2V5KHBhdHQpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHBhdHRlcm5NZW1vLmhhcyhwYXR0KSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IGNoZWNrUGF0dGVybkludGVybmFsKHBhdHQsIGNoZWNrKTtcbiAgICBpZiAocmVzdWx0KSB7XG4gICAgICBwYXR0ZXJuTWVtby5hZGQocGF0dCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG4gIGNvbnN0IGNoZWNrUGF0dGVybkludGVybmFsID0gKHBhdHQsIGNoZWNrKSA9PiB7XG4gICAgY29uc3QgY2hlY2tJdCA9IChjaGlsZCkgPT4gY2hlY2tQYXR0ZXJuKGNoaWxkLCBjaGVjayk7XG4gICAgY29uc3Qga2luZDIgPSBraW5kT2YyKHBhdHQsIGNoZWNrKTtcbiAgICBzd2l0Y2ggKGtpbmQyKSB7XG4gICAgICBjYXNlIHZvaWQgMDoge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIHJldHVybiB2YWx1ZXMyKHBhdHQpLmV2ZXJ5KGNoZWNrSXQpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIHJldHVybiBwYXR0LmV2ZXJ5KGNoZWNrSXQpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICByZXR1cm4gY2hlY2tQYXR0ZXJuKHBhdHQudmFsdWVzLCBjaGVjayk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZXJyb3JcIjpcbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBBICR7cXVvdGUoa2luZDIpfSBjYW5ub3QgYmUgYSBwYXR0ZXJuYCk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIGlmIChtYXliZU1hdGNoSGVscGVyKGtpbmQyKSAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHJlZGFjdGVkYEEgcGFzc2FibGUgb2Yga2luZCAke3F1b3RlKGtpbmQyKX0gaXMgbm90IGEgcGF0dGVybjogJHtwYXR0fWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IGlzUGF0dGVybjIgPSAocGF0dCkgPT4gY2hlY2tQYXR0ZXJuKHBhdHQsIGlkZW50Q2hlY2tlcik7XG4gIGNvbnN0IGFzc2VydFBhdHRlcm4yID0gKHBhdHQpID0+IHtcbiAgICBjaGVja1BhdHRlcm4ocGF0dCwgYXNzZXJ0Q2hlY2tlcik7XG4gIH07XG4gIGNvbnN0IGNoZWNrTWF0Y2hlczIgPSAoc3BlY2ltZW4sIHBhdHRlcm4sIGNoZWNrLCBsYWJlbCA9IHZvaWQgMCkgPT4gKFxuICAgIC8vXG4gICAgYXBwbHlMYWJlbGluZ0Vycm9yKGNoZWNrTWF0Y2hlc0ludGVybmFsLCBbc3BlY2ltZW4sIHBhdHRlcm4sIGNoZWNrXSwgbGFiZWwpXG4gICk7XG4gIGNvbnN0IGNoZWNrTWF0Y2hlc0ludGVybmFsID0gKHNwZWNpbWVuLCBwYXR0LCBjaGVjaykgPT4ge1xuICAgIGNvbnN0IHBhdHRlcm5LaW5kID0ga2luZE9mMihwYXR0LCBjaGVjayk7XG4gICAgY29uc3Qgc3BlY2ltZW5LaW5kID0ga2luZE9mMihzcGVjaW1lbik7XG4gICAgc3dpdGNoIChwYXR0ZXJuS2luZCkge1xuICAgICAgY2FzZSB2b2lkIDA6IHtcbiAgICAgICAgcmV0dXJuIHRocm93UmVkYWN0ZWRgcGF0dGVybiBleHBlY3RlZDogJHtwYXR0fWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHJldHVybiB0aHJvd1JlZGFjdGVkYHByb21pc2VzIGNhbm5vdCBiZSBwYXR0ZXJuczogJHtwYXR0fWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICByZXR1cm4gdGhyb3dSZWRhY3RlZGBlcnJvcnMgY2Fubm90IGJlIHBhdHRlcm5zOiAke3BhdHR9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjpcbiAgICAgIGNhc2UgXCJudWxsXCI6XG4gICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgY2FzZSBcImJpZ2ludFwiOlxuICAgICAgY2FzZSBcInN0cmluZ1wiOlxuICAgICAgY2FzZSBcInN5bWJvbFwiOlxuICAgICAgY2FzZSBcImJ5dGVBcnJheVwiOlxuICAgICAgY2FzZSBcImNvcHlTZXRcIjpcbiAgICAgIGNhc2UgXCJjb3B5QmFnXCI6XG4gICAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrQXNLZXlQYXR0KHNwZWNpbWVuLCBwYXR0LCBjaGVjayk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgaWYgKGlzS2V5KHBhdHQpKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrQXNLZXlQYXR0KHNwZWNpbWVuLCBwYXR0LCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNwZWNpbWVuS2luZCAhPT0gXCJjb3B5QXJyYXlcIikge1xuICAgICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIGEgY29weUFycmF5IHRvIG1hdGNoIGEgY29weUFycmF5IHBhdHRlcm46ICR7cXAoXG4gICAgICAgICAgICAgIHBhdHRcbiAgICAgICAgICAgICl9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHBhdHQ7XG4gICAgICAgIGlmIChzcGVjaW1lbi5sZW5ndGggIT09IGxlbmd0aCkge1xuICAgICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgcmVkYWN0ZWRgQXJyYXkgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIGFzIGxvbmcgYXMgY29weUFycmF5IHBhdHRlcm46ICR7cXAoXG4gICAgICAgICAgICAgIHBhdHRcbiAgICAgICAgICAgICl9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhdHQuZXZlcnkoKHA0LCBpMykgPT4gY2hlY2tNYXRjaGVzMihzcGVjaW1lbltpM10sIHA0LCBjaGVjaywgaTMpKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgaWYgKGlzS2V5KHBhdHQpKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrQXNLZXlQYXR0KHNwZWNpbWVuLCBwYXR0LCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNwZWNpbWVuS2luZCAhPT0gXCJjb3B5UmVjb3JkXCIpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSBhIGNvcHlSZWNvcmQgdG8gbWF0Y2ggYSBjb3B5UmVjb3JkIHBhdHRlcm46ICR7cXAoXG4gICAgICAgICAgICAgIHBhdHRcbiAgICAgICAgICAgICl9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3BlY2ltZW5OYW1lcyA9IHJlY29yZE5hbWVzKHNwZWNpbWVuKTtcbiAgICAgICAgY29uc3QgcGF0dE5hbWVzID0gcmVjb3JkTmFtZXMocGF0dCk7XG4gICAgICAgIGNvbnN0IG1pc3NpbmcyID0gbGlzdERpZmZlcmVuY2UocGF0dE5hbWVzLCBzcGVjaW1lbk5hbWVzKTtcbiAgICAgICAgaWYgKG1pc3NpbmcyLmxlbmd0aCA+PSAxKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgaGF2ZSBtaXNzaW5nIHByb3BlcnRpZXMgJHtxdW90ZShtaXNzaW5nMil9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdW5leHBlY3RlZCA9IGxpc3REaWZmZXJlbmNlKHNwZWNpbWVuTmFtZXMsIHBhdHROYW1lcyk7XG4gICAgICAgIGlmICh1bmV4cGVjdGVkLmxlbmd0aCA+PSAxKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3Qgbm90IGhhdmUgdW5leHBlY3RlZCBwcm9wZXJ0aWVzOiAke3F1b3RlKFxuICAgICAgICAgICAgICB1bmV4cGVjdGVkXG4gICAgICAgICAgICApfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNwZWNpbWVuVmFsdWVzID0gcmVjb3JkVmFsdWVzKHNwZWNpbWVuLCBzcGVjaW1lbk5hbWVzKTtcbiAgICAgICAgY29uc3QgcGF0dFZhbHVlcyA9IHJlY29yZFZhbHVlcyhwYXR0LCBwYXR0TmFtZXMpO1xuICAgICAgICByZXR1cm4gcGF0dE5hbWVzLmV2ZXJ5KFxuICAgICAgICAgIChsYWJlbCwgaTMpID0+IGNoZWNrTWF0Y2hlczIoc3BlY2ltZW5WYWx1ZXNbaTNdLCBwYXR0VmFsdWVzW2kzXSwgY2hlY2ssIGxhYmVsKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICBpZiAoaXNLZXkocGF0dCkpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2tBc0tleVBhdHQoc3BlY2ltZW4sIHBhdHQsIGNoZWNrKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3BlY2ltZW5LaW5kICE9PSBcImNvcHlNYXBcIikge1xuICAgICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIGEgY29weU1hcCB0byBtYXRjaCBhIGNvcHlNYXAgcGF0dGVybjogJHtxcChcbiAgICAgICAgICAgICAgcGF0dFxuICAgICAgICAgICAgKX1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwYXR0S2V5U2V0ID0gY29weU1hcEtleVNldChwYXR0KTtcbiAgICAgICAgY29uc3Qgc3BlY2ltZW5LZXlTZXQgPSBjb3B5TWFwS2V5U2V0KHNwZWNpbWVuKTtcbiAgICAgICAgaWYgKCFjaGVja01hdGNoZXMyKHNwZWNpbWVuS2V5U2V0LCBwYXR0S2V5U2V0LCBjaGVjaykpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGF0dFZhbHVlcyA9IFtdO1xuICAgICAgICBjb25zdCBzcGVjaW1lblZhbHVlcyA9IFtdO1xuICAgICAgICBjb25zdCBlbnRyeVBhaXJzID0gZ2VuZXJhdGVDb2xsZWN0aW9uUGFpckVudHJpZXMoXG4gICAgICAgICAgcGF0dCxcbiAgICAgICAgICBzcGVjaW1lbixcbiAgICAgICAgICBnZXRDb3B5TWFwRW50cnlBcnJheSxcbiAgICAgICAgICB2b2lkIDBcbiAgICAgICAgKTtcbiAgICAgICAgZm9yIChjb25zdCBbX2tleSwgcGF0dFZhbHVlLCBzcGVjaW1lblZhbHVlXSBvZiBlbnRyeVBhaXJzKSB7XG4gICAgICAgICAgcGF0dFZhbHVlcy5wdXNoKHBhdHRWYWx1ZSk7XG4gICAgICAgICAgc3BlY2ltZW5WYWx1ZXMucHVzaChzcGVjaW1lblZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hlY2tNYXRjaGVzMihoYXJkZW4oc3BlY2ltZW5WYWx1ZXMpLCBoYXJkZW4ocGF0dFZhbHVlcyksIGNoZWNrKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgY29uc3QgbWF0Y2hIZWxwZXIgPSBtYXliZU1hdGNoSGVscGVyKHBhdHRlcm5LaW5kKTtcbiAgICAgICAgaWYgKG1hdGNoSGVscGVyKSB7XG4gICAgICAgICAgcmV0dXJuIG1hdGNoSGVscGVyLmNoZWNrTWF0Y2hlcyhzcGVjaW1lbiwgcGF0dC5wYXlsb2FkLCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogc2hvdWxkIGhhdmUgcmVjb2duaXplZCAke3F1b3RlKHBhdHRlcm5LaW5kKX0gYDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IG1hdGNoZXMyID0gKHNwZWNpbWVuLCBwYXR0KSA9PiBjaGVja01hdGNoZXMyKHNwZWNpbWVuLCBwYXR0LCBpZGVudENoZWNrZXIpO1xuICBjb25zdCBtdXN0TWF0Y2g0ID0gKHNwZWNpbWVuLCBwYXR0LCBsYWJlbCA9IHZvaWQgMCkgPT4ge1xuICAgIGxldCBpbm5lckVycm9yO1xuICAgIHRyeSB7XG4gICAgICBpZiAoY2hlY2tNYXRjaGVzMihzcGVjaW1lbiwgcGF0dCwgaWRlbnRDaGVja2VyLCB2b2lkIDApKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcikge1xuICAgICAgaW5uZXJFcnJvciA9IGVyO1xuICAgIH1cbiAgICBjaGVja01hdGNoZXMyKHNwZWNpbWVuLCBwYXR0LCBhc3NlcnRDaGVja2VyLCBsYWJlbCk7XG4gICAgY29uc3Qgb3V0ZXJFcnJvciA9IG1ha2VFcnJvcihcbiAgICAgIHJlZGFjdGVkYGludGVybmFsOiAke2xhYmVsfTogaW5jb25zaXN0ZW50IHBhdHRlcm4gbWF0Y2g6ICR7cXAocGF0dCl9YFxuICAgICk7XG4gICAgaWYgKGlubmVyRXJyb3IgIT09IHZvaWQgMCkge1xuICAgICAgbm90ZShvdXRlckVycm9yLCByZWRhY3RlZGBjYXVzZWQgYnkgJHtpbm5lckVycm9yfWApO1xuICAgIH1cbiAgICB0aHJvdyBvdXRlckVycm9yO1xuICB9O1xuICBjb25zdCBnZXRSYW5rQ292ZXIyID0gKHBhdHQsIGVuY29kZVBhc3NhYmxlKSA9PiB7XG4gICAgaWYgKGlzS2V5KHBhdHQpKSB7XG4gICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlUGFzc2FibGUocGF0dCk7XG4gICAgICBpZiAoZW5jb2RlZCAhPT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiBbZW5jb2RlZCwgYCR7ZW5jb2RlZH1+YF07XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHBhdHQpO1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgIGNvbnN0IHRhZyA9IGdldFRhZyhwYXR0KTtcbiAgICAgICAgY29uc3QgbWF0Y2hIZWxwZXIgPSBtYXliZU1hdGNoSGVscGVyKHRhZyk7XG4gICAgICAgIGlmIChtYXRjaEhlbHBlcikge1xuICAgICAgICAgIHJldHVybiBtYXRjaEhlbHBlci5nZXRSYW5rQ292ZXIocGF0dC5wYXlsb2FkLCBlbmNvZGVQYXNzYWJsZSk7XG4gICAgICAgIH1cbiAgICAgICAgc3dpdGNoICh0YWcpIHtcbiAgICAgICAgICBjYXNlIFwiY29weVNldFwiOiB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBnZXRQYXNzU3R5bGVDb3ZlcihwYXNzU3R5bGUpO1xuICB9O1xuICBjb25zdCBhcnJheUV2ZXJ5TWF0Y2hQYXR0ZXJuID0gKGFycmF5LCBwYXR0LCBjaGVjaywgbGFiZWxQcmVmaXggPSBcIlwiKSA9PiB7XG4gICAgaWYgKGlzS2luZChwYXR0LCBcIm1hdGNoOmFueVwiKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBhcnJheS5ldmVyeShcbiAgICAgIChlbCwgaTMpID0+IGNoZWNrTWF0Y2hlczIoZWwsIHBhdHQsIGNoZWNrLCBgJHtsYWJlbFByZWZpeH1bJHtpM31dYClcbiAgICApO1xuICB9O1xuICBjb25zdCBtYXRjaEFueUhlbHBlciA9IEZhcihcIm1hdGNoOmFueSBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKF9zcGVjaW1lbiwgX21hdGNoZXJQYXlsb2FkLCBfY2hlY2spID0+IHRydWUsXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChtYXRjaGVyUGF5bG9hZCwgY2hlY2spID0+IG1hdGNoZXJQYXlsb2FkID09PSB2b2lkIDAgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYG1hdGNoOmFueSBwYXlsb2FkOiAke21hdGNoZXJQYXlsb2FkfSAtIE11c3QgYmUgdW5kZWZpbmVkYCksXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBbXCJcIiwgXCJ7XCJdXG4gIH0pO1xuICBjb25zdCBtYXRjaEFuZEhlbHBlciA9IEZhcihcIm1hdGNoOmFuZCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBwYXR0cywgY2hlY2spID0+IHtcbiAgICAgIHJldHVybiBwYXR0cy5ldmVyeSgocGF0dCkgPT4gY2hlY2tNYXRjaGVzMihzcGVjaW1lbiwgcGF0dCwgY2hlY2spKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAoYWxsZWdlZFBhdHRzLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgY2hlY2tJdCA9IChwYXR0KSA9PiBjaGVja1BhdHRlcm4ocGF0dCwgY2hlY2spO1xuICAgICAgcmV0dXJuIChwYXNzU3R5bGVPZihhbGxlZ2VkUGF0dHMpID09PSBcImNvcHlBcnJheVwiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBOZWVkcyBhcnJheSBvZiBzdWItcGF0dGVybnM6ICR7cXAoYWxsZWdlZFBhdHRzKX1gKSkgJiYgYWxsZWdlZFBhdHRzLmV2ZXJ5KGNoZWNrSXQpO1xuICAgIH0sXG4gICAgZ2V0UmFua0NvdmVyOiAocGF0dHMsIGVuY29kZVBhc3NhYmxlKSA9PiBpbnRlcnNlY3RSYW5rQ292ZXJzKFxuICAgICAgY29tcGFyZVJhbmssXG4gICAgICBwYXR0cy5tYXAoKHA0KSA9PiBnZXRSYW5rQ292ZXIyKHA0LCBlbmNvZGVQYXNzYWJsZSkpXG4gICAgKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hPckhlbHBlciA9IEZhcihcIm1hdGNoOm9yIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIHBhdHRzLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHBhdHRzO1xuICAgICAgaWYgKGxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBubyBwYXR0ZXJuIGRpc2p1bmN0cyB0byBtYXRjaDogJHtxcChwYXR0cyl9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgYmluYXJ5VW5kZWZQYXR0SWR4ID0gcGF0dHMubGVuZ3RoID09PSAyID8gcGF0dHMuZmluZEluZGV4KChwYXR0KSA9PiBpc1VuZGVmaW5lZFBhdHQocGF0dCkpIDogLTE7XG4gICAgICBpZiAoYmluYXJ5VW5kZWZQYXR0SWR4ICE9PSAtMSkge1xuICAgICAgICByZXR1cm4gc3BlY2ltZW4gPT09IHZvaWQgMCB8fCBjaGVja01hdGNoZXMyKHNwZWNpbWVuLCBwYXR0c1sxIC0gYmluYXJ5VW5kZWZQYXR0SWR4XSwgY2hlY2spO1xuICAgICAgfVxuICAgICAgaWYgKHBhdHRzLnNvbWUoKHBhdHQpID0+IG1hdGNoZXMyKHNwZWNpbWVuLCBwYXR0KSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBtYXRjaCBvbmUgb2YgJHtxcChwYXR0cyl9YCk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogbWF0Y2hBbmRIZWxwZXIuY2hlY2tJc1dlbGxGb3JtZWQsXG4gICAgZ2V0UmFua0NvdmVyOiAocGF0dHMsIGVuY29kZVBhc3NhYmxlKSA9PiB1bmlvblJhbmtDb3ZlcnMoXG4gICAgICBjb21wYXJlUmFuayxcbiAgICAgIHBhdHRzLm1hcCgocDQpID0+IGdldFJhbmtDb3ZlcjIocDQsIGVuY29kZVBhc3NhYmxlKSlcbiAgICApXG4gIH0pO1xuICBjb25zdCBtYXRjaE5vdEhlbHBlciA9IEZhcihcIm1hdGNoOm5vdCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBwYXR0LCBjaGVjaykgPT4ge1xuICAgICAgaWYgKG1hdGNoZXMyKHNwZWNpbWVuLCBwYXR0KSkge1xuICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGZhaWwgbmVnYXRlZCBwYXR0ZXJuOiAke3FwKHBhdHQpfWBcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IGNoZWNrUGF0dGVybixcbiAgICBnZXRSYW5rQ292ZXI6IChfcGF0dCwgX2VuY29kZVBhc3NhYmxlKSA9PiBbXCJcIiwgXCJ7XCJdXG4gIH0pO1xuICBjb25zdCBtYXRjaFNjYWxhckhlbHBlciA9IEZhcihcIm1hdGNoOnNjYWxhciBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBfbWF0Y2hlclBheWxvYWQsIGNoZWNrKSA9PiBjaGVja1NjYWxhcktleShzcGVjaW1lbiwgY2hlY2spLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBtYXRjaEFueUhlbHBlci5jaGVja0lzV2VsbEZvcm1lZCxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IFtcImFcIiwgXCJ6flwiXVxuICB9KTtcbiAgY29uc3QgbWF0Y2hLZXlIZWxwZXIgPSBGYXIoXCJtYXRjaDprZXkgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgX21hdGNoZXJQYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tLZXkoc3BlY2ltZW4sIGNoZWNrKSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogbWF0Y2hBbnlIZWxwZXIuY2hlY2tJc1dlbGxGb3JtZWQsXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBbXCJhXCIsIFwien5cIl1cbiAgfSk7XG4gIGNvbnN0IG1hdGNoUGF0dGVybkhlbHBlciA9IEZhcihcIm1hdGNoOnBhdHRlcm4gaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgX21hdGNoZXJQYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tQYXR0ZXJuKHNwZWNpbWVuLCBjaGVjayksXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IG1hdGNoQW55SGVscGVyLmNoZWNrSXNXZWxsRm9ybWVkLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gW1wiYVwiLCBcInp+XCJdXG4gIH0pO1xuICBjb25zdCBtYXRjaEtpbmRIZWxwZXIgPSBGYXIoXCJtYXRjaDpraW5kIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiBjaGVja0tpbmQsXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChhbGxlZ2VkS2V5S2luZCwgY2hlY2spID0+IHR5cGVvZiBhbGxlZ2VkS2V5S2luZCA9PT0gXCJzdHJpbmdcIiB8fCBjaGVjayhcbiAgICAgIGZhbHNlLFxuICAgICAgcmVkYWN0ZWRgbWF0Y2g6a2luZDogcGF5bG9hZDogJHthbGxlZ2VkS2V5S2luZH0gLSBBIGtpbmQgbmFtZSBtdXN0IGJlIGEgc3RyaW5nYFxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoa2luZDIsIF9lbmNvZGVQYXNzYWJsZSkgPT4ge1xuICAgICAgbGV0IHN0eWxlO1xuICAgICAgc3dpdGNoIChraW5kMikge1xuICAgICAgICBjYXNlIFwiY29weVNldFwiOlxuICAgICAgICBjYXNlIFwiY29weU1hcFwiOiB7XG4gICAgICAgICAgc3R5bGUgPSBcInRhZ2dlZFwiO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICBzdHlsZSA9IGtpbmQyO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZ2V0UGFzc1N0eWxlQ292ZXIoc3R5bGUpO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IG1hdGNoVGFnZ2VkSGVscGVyID0gRmFyKFwibWF0Y2g6dGFnZ2VkIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFt0YWdQYXR0LCBwYXlsb2FkUGF0dF0sIGNoZWNrKSA9PiB7XG4gICAgICBpZiAocGFzc1N0eWxlT2Yoc3BlY2ltZW4pICE9PSBcInRhZ2dlZFwiKSB7XG4gICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICByZWRhY3RlZGBFeHBlY3RlZCB0YWdnZWQgb2JqZWN0LCBub3QgJHtxdW90ZShcbiAgICAgICAgICAgIHBhc3NTdHlsZU9mKHNwZWNpbWVuKVxuICAgICAgICAgICl9OiAke3NwZWNpbWVufWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjaGVja01hdGNoZXMyKGdldFRhZyhzcGVjaW1lbiksIHRhZ1BhdHQsIGNoZWNrLCBcInRhZ1wiKSAmJiBjaGVja01hdGNoZXMyKHNwZWNpbWVuLnBheWxvYWQsIHBheWxvYWRQYXR0LCBjaGVjaywgXCJwYXlsb2FkXCIpO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tNYXRjaGVzMihcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0ucGF0dGVybigpXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6dGFnZ2VkIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX2tpbmQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJ0YWdnZWRcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoQmlnaW50SGVscGVyID0gRmFyKFwibWF0Y2g6YmlnaW50IGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBkZWNpbWFsRGlnaXRzTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImJpZ2ludFwiLCBjaGVjaykgJiYgY2hlY2tEZWNpbWFsRGlnaXRzTGltaXQoc3BlY2ltZW4sIGRlY2ltYWxEaWdpdHNMaW1pdCwgY2hlY2spO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtdKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpiaWdpbnQgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwiYmlnaW50XCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaE5hdEhlbHBlciA9IEZhcihcIm1hdGNoOm5hdCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgZGVjaW1hbERpZ2l0c0xpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgcmV0dXJuIGNoZWNrS2luZChzcGVjaW1lbiwgXCJiaWdpbnRcIiwgY2hlY2spICYmIGNoZWNrKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc3BlY2ltZW4gPj0gMG4sXG4gICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSBub24tbmVnYXRpdmVgXG4gICAgICApICYmIGNoZWNrRGVjaW1hbERpZ2l0c0xpbWl0KHNwZWNpbWVuLCBkZWNpbWFsRGlnaXRzTGltaXQsIGNoZWNrKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6bmF0IHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiAoXG4gICAgICAvL1xuICAgICAgZ2V0UGFzc1N0eWxlQ292ZXIoXCJiaWdpbnRcIilcbiAgICApXG4gIH0pO1xuICBjb25zdCBtYXRjaFN0cmluZ0hlbHBlciA9IEZhcihcIm1hdGNoOnN0cmluZyBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgc3RyaW5nTGVuZ3RoTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcInN0cmluZ1wiLCBjaGVjaykgJiYgLy9cbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgKHNwZWNpbWVuLmxlbmd0aCA8PSBzdHJpbmdMZW5ndGhMaW1pdCB8fCBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYHN0cmluZyAke3NwZWNpbWVufSBtdXN0IG5vdCBiZSBiaWdnZXIgdGhhbiAke3N0cmluZ0xlbmd0aExpbWl0fWBcbiAgICAgICkpO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtdKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpzdHJpbmcgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwic3RyaW5nXCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaFN5bWJvbEhlbHBlciA9IEZhcihcIm1hdGNoOnN5bWJvbCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgc3ltYm9sTmFtZUxlbmd0aExpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgaWYgKCFjaGVja0tpbmQoc3BlY2ltZW4sIFwic3ltYm9sXCIsIGNoZWNrKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25zdCBzeW1ib2xOYW1lID0gbmFtZUZvclBhc3NhYmxlU3ltYm9sKHNwZWNpbWVuKTtcbiAgICAgIGlmICh0eXBlb2Ygc3ltYm9sTmFtZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBQYXNzYWJsZSBzeW1ib2wgJHtzcGVjaW1lbn0gbXVzdCBoYXZlIGEgcGFzc2FibGUgbmFtZWA7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgIHN5bWJvbE5hbWUubGVuZ3RoIDw9IHN5bWJvbE5hbWVMZW5ndGhMaW1pdCxcbiAgICAgICAgcmVkYWN0ZWRgU3ltYm9sIG5hbWUgJHtxdW90ZShcbiAgICAgICAgICBzeW1ib2xOYW1lXG4gICAgICAgICl9IG11c3Qgbm90IGJlIGJpZ2dlciB0aGFuICR7c3ltYm9sTmFtZUxlbmd0aExpbWl0fWBcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW10pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOnN5bWJvbCBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJzeW1ib2xcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoUmVtb3RhYmxlSGVscGVyID0gRmFyKFwibWF0Y2g6cmVtb3RhYmxlIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIHJlbW90YWJsZURlc2MsIGNoZWNrKSA9PiB7XG4gICAgICBpZiAoaXNLaW5kKHNwZWNpbWVuLCBcInJlbW90YWJsZVwiKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChjaGVjayA9PT0gaWRlbnRDaGVja2VyKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgbGFiZWwgfSA9IHJlbW90YWJsZURlc2M7XG4gICAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihzcGVjaW1lbik7XG4gICAgICBjb25zdCBraW5kRGV0YWlscyA9IHBhc3NTdHlsZSAhPT0gXCJ0YWdnZWRcIiA/IChcbiAgICAgICAgLy9cbiAgICAgICAgYmFyZU9yUXVvdGUocGFzc1N0eWxlKVxuICAgICAgKSA6IChcbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgcXVvdGUoZ2V0VGFnKHNwZWNpbWVuKSlcbiAgICAgICk7XG4gICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgYSByZW1vdGFibGUgJHtiYXJlT3JRdW90ZShsYWJlbCl9LCBub3QgJHtraW5kRGV0YWlsc31gXG4gICAgICApO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChhbGxlZ2VkUmVtb3RhYmxlRGVzYywgY2hlY2spID0+IGNoZWNrTWF0Y2hlczIoXG4gICAgICBhbGxlZ2VkUmVtb3RhYmxlRGVzYyxcbiAgICAgIGhhcmRlbih7IGxhYmVsOiBNTS5zdHJpbmcoKSB9KSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpyZW1vdGFibGUgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfcmVtb3RhYmxlRGVzYywgX2VuY29kZVBhc3NhYmxlKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInJlbW90YWJsZVwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hMVEVIZWxwZXIgPSBGYXIoXCJtYXRjaDpsdGUgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcmlnaHRPcGVyYW5kLCBjaGVjaykgPT4ga2V5TFRFKHNwZWNpbWVuLCByaWdodE9wZXJhbmQpIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgPD0gJHtyaWdodE9wZXJhbmR9YCksXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IGNoZWNrS2V5LFxuICAgIGdldFJhbmtDb3ZlcjogKHJpZ2h0T3BlcmFuZCwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHJpZ2h0T3BlcmFuZCk7XG4gICAgICBsZXQgW2xlZnRCb3VuZCwgcmlnaHRCb3VuZF0gPSBnZXRQYXNzU3R5bGVDb3ZlcihwYXNzU3R5bGUpO1xuICAgICAgY29uc3QgbmV3UmlnaHRCb3VuZCA9IGAke2VuY29kZVBhc3NhYmxlKHJpZ2h0T3BlcmFuZCl9fmA7XG4gICAgICBpZiAobmV3UmlnaHRCb3VuZCAhPT0gdm9pZCAwKSB7XG4gICAgICAgIHJpZ2h0Qm91bmQgPSBuZXdSaWdodEJvdW5kO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFtsZWZ0Qm91bmQsIHJpZ2h0Qm91bmRdO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IG1hdGNoTFRIZWxwZXIgPSBGYXIoXCJtYXRjaDpsdCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCByaWdodE9wZXJhbmQsIGNoZWNrKSA9PiBrZXlMVChzcGVjaW1lbiwgcmlnaHRPcGVyYW5kKSB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIDwgJHtyaWdodE9wZXJhbmR9YCksXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IGNoZWNrS2V5LFxuICAgIGdldFJhbmtDb3ZlcjogbWF0Y2hMVEVIZWxwZXIuZ2V0UmFua0NvdmVyXG4gIH0pO1xuICBjb25zdCBtYXRjaEdURUhlbHBlciA9IEZhcihcIm1hdGNoOmd0ZSBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCByaWdodE9wZXJhbmQsIGNoZWNrKSA9PiBrZXlHVEUoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCkgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSA+PSAke3JpZ2h0T3BlcmFuZH1gKSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogY2hlY2tLZXksXG4gICAgZ2V0UmFua0NvdmVyOiAocmlnaHRPcGVyYW5kLCBlbmNvZGVQYXNzYWJsZSkgPT4ge1xuICAgICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocmlnaHRPcGVyYW5kKTtcbiAgICAgIGxldCBbbGVmdEJvdW5kLCByaWdodEJvdW5kXSA9IGdldFBhc3NTdHlsZUNvdmVyKHBhc3NTdHlsZSk7XG4gICAgICBjb25zdCBuZXdMZWZ0Qm91bmQgPSBlbmNvZGVQYXNzYWJsZShyaWdodE9wZXJhbmQpO1xuICAgICAgaWYgKG5ld0xlZnRCb3VuZCAhPT0gdm9pZCAwKSB7XG4gICAgICAgIGxlZnRCb3VuZCA9IG5ld0xlZnRCb3VuZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBbbGVmdEJvdW5kLCByaWdodEJvdW5kXTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBtYXRjaEdUSGVscGVyID0gRmFyKFwibWF0Y2g6Z3QgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcmlnaHRPcGVyYW5kLCBjaGVjaykgPT4ga2V5R1Qoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCkgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSA+ICR7cmlnaHRPcGVyYW5kfWApLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBjaGVja0tleSxcbiAgICBnZXRSYW5rQ292ZXI6IG1hdGNoR1RFSGVscGVyLmdldFJhbmtDb3ZlclxuICB9KTtcbiAgY29uc3QgbWF0Y2hSZWNvcmRPZkhlbHBlciA9IEZhcihcIm1hdGNoOnJlY29yZE9mIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtrZXlQYXR0LCB2YWx1ZVBhdHQsIGxpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IG51bVByb3BlcnRpZXNMaW1pdCwgcHJvcGVydHlOYW1lTGVuZ3RoTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlSZWNvcmRcIiwgY2hlY2spICYmIGNoZWNrKFxuICAgICAgICBvd25LZXlzMTgoc3BlY2ltZW4pLmxlbmd0aCA8PSBudW1Qcm9wZXJ0aWVzTGltaXQsXG4gICAgICAgIHJlZGFjdGVkYE11c3Qgbm90IGhhdmUgbW9yZSB0aGFuICR7cXVvdGUoXG4gICAgICAgICAgbnVtUHJvcGVydGllc0xpbWl0XG4gICAgICAgICl9IHByb3BlcnRpZXM6ICR7c3BlY2ltZW59YFxuICAgICAgKSAmJiBlbnRyaWVzNyhzcGVjaW1lbikuZXZlcnkoXG4gICAgICAgIChba2V5LCB2YWx1ZV0pID0+IGFwcGx5TGFiZWxpbmdFcnJvcihcbiAgICAgICAgICBjaGVjayxcbiAgICAgICAgICBbXG4gICAgICAgICAgICBrZXkubGVuZ3RoIDw9IHByb3BlcnR5TmFtZUxlbmd0aExpbWl0LFxuICAgICAgICAgICAgcmVkYWN0ZWRgUHJvcGVydHkgbmFtZSBtdXN0IG5vdCBiZSBsb25nZXIgdGhhbiAke3F1b3RlKFxuICAgICAgICAgICAgICBwcm9wZXJ0eU5hbWVMZW5ndGhMaW1pdFxuICAgICAgICAgICAgKX1gXG4gICAgICAgICAgXSxcbiAgICAgICAgICBrZXlcbiAgICAgICAgKSAmJiBjaGVja01hdGNoZXMyKFxuICAgICAgICAgIGhhcmRlbihba2V5LCB2YWx1ZV0pLFxuICAgICAgICAgIGhhcmRlbihba2V5UGF0dCwgdmFsdWVQYXR0XSksXG4gICAgICAgICAgY2hlY2ssXG4gICAgICAgICAga2V5XG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0ucGF0dGVybigpXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6cmVjb3JkT2YgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfZW50cnlQYXR0KSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcImNvcHlSZWNvcmRcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoQXJyYXlPZkhlbHBlciA9IEZhcihcIm1hdGNoOmFycmF5T2YgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW3N1YlBhdHQsIGxpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IGFycmF5TGVuZ3RoTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlBcnJheVwiLCBjaGVjaykgJiYgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgIChzcGVjaW1lbi5sZW5ndGggPD0gYXJyYXlMZW5ndGhMaW1pdCB8fCBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYEFycmF5IGxlbmd0aCAke3NwZWNpbWVuLmxlbmd0aH0gbXVzdCBiZSA8PSBsaW1pdCAke2FycmF5TGVuZ3RoTGltaXR9YFxuICAgICAgKSkgJiYgYXJyYXlFdmVyeU1hdGNoUGF0dGVybihzcGVjaW1lbiwgc3ViUGF0dCwgY2hlY2spO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtNTS5wYXR0ZXJuKCldKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDphcnJheU9mIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcImNvcHlBcnJheVwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hCeXRlQXJyYXlIZWxwZXIgPSBGYXIoXCJtYXRjaDpieXRlQXJyYXkgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2xpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IGJ5dGVMZW5ndGhMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiYnl0ZUFycmF5XCIsIGNoZWNrKSAmJiAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgKHNwZWNpbWVuLmJ5dGVMZW5ndGggPD0gYnl0ZUxlbmd0aExpbWl0IHx8IGNoZWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgcmVkYWN0ZWRgYnl0ZUFycmF5ICR7c3BlY2ltZW59IG11c3Qgbm90IGJlIGJpZ2dlciB0aGFuICR7Ynl0ZUxlbmd0aExpbWl0fWBcbiAgICAgICkpO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtdKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpieXRlQXJyYXkgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwiYnl0ZUFycmF5XCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaFNldE9mSGVscGVyID0gRmFyKFwibWF0Y2g6c2V0T2YgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2tleVBhdHQsIGxpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IG51bVNldEVsZW1lbnRzTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlTZXRcIiwgY2hlY2spICYmIGNoZWNrKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLmxlbmd0aCA8IG51bVNldEVsZW1lbnRzTGltaXQsXG4gICAgICAgIHJlZGFjdGVkYFNldCBtdXN0IG5vdCBoYXZlIG1vcmUgdGhhbiAke3F1b3RlKG51bVNldEVsZW1lbnRzTGltaXQpfSBlbGVtZW50czogJHtzcGVjaW1lbi5wYXlsb2FkLmxlbmd0aH1gXG4gICAgICApICYmIGFycmF5RXZlcnlNYXRjaFBhdHRlcm4oc3BlY2ltZW4ucGF5bG9hZCwga2V5UGF0dCwgY2hlY2ssIFwic2V0IGVsZW1lbnRzXCIpO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtNTS5wYXR0ZXJuKCldKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpzZXRPZiBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKCkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJ0YWdnZWRcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoQmFnT2ZIZWxwZXIgPSBGYXIoXCJtYXRjaDpiYWdPZiBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBba2V5UGF0dCwgY291bnRQYXR0LCBsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBudW1VbmlxdWVCYWdFbGVtZW50c0xpbWl0LCBkZWNpbWFsRGlnaXRzTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlCYWdcIiwgY2hlY2spICYmIGNoZWNrKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLmxlbmd0aCA8PSBudW1VbmlxdWVCYWdFbGVtZW50c0xpbWl0LFxuICAgICAgICByZWRhY3RlZGBCYWcgbXVzdCBub3QgaGF2ZSBtb3JlIHRoYW4gJHtxdW90ZShcbiAgICAgICAgICBudW1VbmlxdWVCYWdFbGVtZW50c0xpbWl0XG4gICAgICAgICl9IHVuaXF1ZSBlbGVtZW50czogJHtzcGVjaW1lbn1gXG4gICAgICApICYmIHNwZWNpbWVuLnBheWxvYWQuZXZlcnkoXG4gICAgICAgIChba2V5LCBjb3VudF0sIGkzKSA9PiBjaGVja01hdGNoZXMyKGtleSwga2V5UGF0dCwgY2hlY2ssIGBiYWcga2V5c1ske2kzfV1gKSAmJiBhcHBseUxhYmVsaW5nRXJyb3IoXG4gICAgICAgICAgY2hlY2tEZWNpbWFsRGlnaXRzTGltaXQsXG4gICAgICAgICAgW2NvdW50LCBkZWNpbWFsRGlnaXRzTGltaXQsIGNoZWNrXSxcbiAgICAgICAgICBgYmFnIGNvdW50c1ske2kzfV1gXG4gICAgICAgICkgJiYgY2hlY2tNYXRjaGVzMihjb3VudCwgY291bnRQYXR0LCBjaGVjaywgYGJhZyBjb3VudHNbJHtpM31dYClcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0ucGF0dGVybigpXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6YmFnT2YgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6ICgpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwidGFnZ2VkXCIpXG4gIH0pO1xuICBjb25zdCBlbGVtZW50c0hhc1NwbGl0ID0gKGVsZW1lbnRzLCBlbGVtZW50UGF0dCwgYm91bmQsIGluUmVzdWx0cyA9IHZvaWQgMCwgb3V0UmVzdWx0cyA9IHZvaWQgMCwgY2hlY2sgPSBpZGVudENoZWNrZXIpID0+IHtcbiAgICBsZXQgY291bnQgPSAwbjtcbiAgICBmb3IgKGxldCBpMyA9IGVsZW1lbnRzLmxlbmd0aCAtIDE7IGkzID49IDA7IGkzIC09IDEpIHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBlbGVtZW50c1tpM107XG4gICAgICBpZiAoY291bnQgPCBib3VuZCkge1xuICAgICAgICBpZiAobWF0Y2hlczIoZWxlbWVudCwgZWxlbWVudFBhdHQpKSB7XG4gICAgICAgICAgY291bnQgKz0gMW47XG4gICAgICAgICAgaWYgKGluUmVzdWx0cykgaW5SZXN1bHRzLnB1c2goZWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAob3V0UmVzdWx0cykge1xuICAgICAgICAgIG91dFJlc3VsdHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChvdXRSZXN1bHRzID09PSB2b2lkIDApIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvdXRSZXN1bHRzLnB1c2goZWxlbWVudCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjaGVjayhcbiAgICAgIGNvdW50ID49IGJvdW5kLFxuICAgICAgcmVkYWN0ZWRgSGFzIG9ubHkgJHtxdW90ZShjb3VudCl9IG1hdGNoZXMsIGJ1dCBuZWVkcyAke3F1b3RlKGJvdW5kKX1gXG4gICAgKTtcbiAgfTtcbiAgY29uc3QgcGFpcnNIYXNTcGxpdCA9IChwYWlycywgZWxlbWVudFBhdHQsIGJvdW5kLCBpblJlc3VsdHMgPSB2b2lkIDAsIG91dFJlc3VsdHMgPSB2b2lkIDAsIGNoZWNrID0gaWRlbnRDaGVja2VyKSA9PiB7XG4gICAgbGV0IGNvdW50ID0gMG47XG4gICAgZm9yIChsZXQgaTMgPSBwYWlycy5sZW5ndGggLSAxOyBpMyA+PSAwOyBpMyAtPSAxKSB7XG4gICAgICBjb25zdCBbZWxlbWVudCwgbnVtXSA9IHBhaXJzW2kzXTtcbiAgICAgIGNvbnN0IG51bVJlc3QgPSBib3VuZCAtIGNvdW50O1xuICAgICAgaWYgKG51bVJlc3QgPj0gMW4pIHtcbiAgICAgICAgaWYgKG1hdGNoZXMyKGVsZW1lbnQsIGVsZW1lbnRQYXR0KSkge1xuICAgICAgICAgIGlmIChudW0gPD0gbnVtUmVzdCkge1xuICAgICAgICAgICAgY291bnQgKz0gbnVtO1xuICAgICAgICAgICAgaWYgKGluUmVzdWx0cykgaW5SZXN1bHRzLnB1c2goW2VsZW1lbnQsIG51bV0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBudW1JbiA9IG51bVJlc3Q7XG4gICAgICAgICAgICBjb3VudCArPSBudW1JbjtcbiAgICAgICAgICAgIGlmIChpblJlc3VsdHMpIGluUmVzdWx0cy5wdXNoKFtlbGVtZW50LCBudW1SZXN0XSk7XG4gICAgICAgICAgICBpZiAob3V0UmVzdWx0cykgb3V0UmVzdWx0cy5wdXNoKFtlbGVtZW50LCBudW0gLSBudW1SZXN0XSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKG91dFJlc3VsdHMpIHtcbiAgICAgICAgICBvdXRSZXN1bHRzLnB1c2goW2VsZW1lbnQsIG51bV0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKG91dFJlc3VsdHMgPT09IHZvaWQgMCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG91dFJlc3VsdHMucHVzaChbZWxlbWVudCwgbnVtXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjaGVjayhcbiAgICAgIGNvdW50ID49IGJvdW5kLFxuICAgICAgcmVkYWN0ZWRgSGFzIG9ubHkgJHtxdW90ZShjb3VudCl9IG1hdGNoZXMsIGJ1dCBuZWVkcyAke3F1b3RlKGJvdW5kKX1gXG4gICAgKTtcbiAgfTtcbiAgY29uc3QgY29udGFpbmVySGFzU3BsaXQyID0gKHNwZWNpbWVuLCBlbGVtZW50UGF0dCwgYm91bmQsIG5lZWRJblJlc3VsdHMgPSBmYWxzZSwgbmVlZE91dFJlc3VsdHMgPSBmYWxzZSwgY2hlY2sgPSBpZGVudENoZWNrZXIpID0+IHtcbiAgICBjb25zdCBpblJlc3VsdHMgPSBuZWVkSW5SZXN1bHRzID8gW10gOiB2b2lkIDA7XG4gICAgY29uc3Qgb3V0UmVzdWx0cyA9IG5lZWRPdXRSZXN1bHRzID8gW10gOiB2b2lkIDA7XG4gICAgY29uc3Qga2luZDIgPSBraW5kT2YyKHNwZWNpbWVuKTtcbiAgICBzd2l0Y2ggKGtpbmQyKSB7XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgaWYgKCFlbGVtZW50c0hhc1NwbGl0KFxuICAgICAgICAgIHNwZWNpbWVuLFxuICAgICAgICAgIGVsZW1lbnRQYXR0LFxuICAgICAgICAgIGJvdW5kLFxuICAgICAgICAgIGluUmVzdWx0cyxcbiAgICAgICAgICBvdXRSZXN1bHRzLFxuICAgICAgICAgIGNoZWNrXG4gICAgICAgICkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtpblJlc3VsdHMsIG91dFJlc3VsdHNdO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlTZXRcIjoge1xuICAgICAgICBpZiAoIWVsZW1lbnRzSGFzU3BsaXQoXG4gICAgICAgICAgc3BlY2ltZW4ucGF5bG9hZCxcbiAgICAgICAgICBlbGVtZW50UGF0dCxcbiAgICAgICAgICBib3VuZCxcbiAgICAgICAgICBpblJlc3VsdHMsXG4gICAgICAgICAgb3V0UmVzdWx0cyxcbiAgICAgICAgICBjaGVja1xuICAgICAgICApKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgaW5SZXN1bHRzICYmIG1ha2VDb3B5U2V0KGluUmVzdWx0cyksXG4gICAgICAgICAgb3V0UmVzdWx0cyAmJiBtYWtlQ29weVNldChvdXRSZXN1bHRzKVxuICAgICAgICBdO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlCYWdcIjoge1xuICAgICAgICBpZiAoIXBhaXJzSGFzU3BsaXQoXG4gICAgICAgICAgc3BlY2ltZW4ucGF5bG9hZCxcbiAgICAgICAgICBlbGVtZW50UGF0dCxcbiAgICAgICAgICBib3VuZCxcbiAgICAgICAgICBpblJlc3VsdHMsXG4gICAgICAgICAgb3V0UmVzdWx0cyxcbiAgICAgICAgICBjaGVja1xuICAgICAgICApKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgaW5SZXN1bHRzICYmIG1ha2VDb3B5QmFnKGluUmVzdWx0cyksXG4gICAgICAgICAgb3V0UmVzdWx0cyAmJiBtYWtlQ29weUJhZyhvdXRSZXN1bHRzKVxuICAgICAgICBdO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYHVuZXhwZWN0ZWQgJHtxdW90ZShraW5kMil9YCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBtYXRjaENvbnRhaW5lckhhc0hlbHBlciA9IEZhcihcIk0uY29udGFpbmVySGFzIGhlbHBlclwiLCB7XG4gICAgLypcblxuXG5cbiAgICAgKi9cbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2VsZW1lbnRQYXR0LCBib3VuZCwgbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IGtpbmQyID0ga2luZE9mMihzcGVjaW1lbiwgY2hlY2spO1xuICAgICAgY29uc3QgeyBkZWNpbWFsRGlnaXRzTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICBpZiAoIWFwcGx5TGFiZWxpbmdFcnJvcihcbiAgICAgICAgY2hlY2tEZWNpbWFsRGlnaXRzTGltaXQsXG4gICAgICAgIFtib3VuZCwgZGVjaW1hbERpZ2l0c0xpbWl0LCBjaGVja10sXG4gICAgICAgIGAke2tpbmQyfSBtYXRjaGVzYFxuICAgICAgKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gISFjb250YWluZXJIYXNTcGxpdDIoXG4gICAgICAgIHNwZWNpbWVuLFxuICAgICAgICBlbGVtZW50UGF0dCxcbiAgICAgICAgYm91bmQsXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgY2hlY2tcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0uZ3RlKDFuKV0pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIk0uY29udGFpbmVySGFzIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInRhZ2dlZFwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hNYXBPZkhlbHBlciA9IEZhcihcIm1hdGNoOm1hcE9mIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtrZXlQYXR0LCB2YWx1ZVBhdHQsIGxpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IG51bU1hcEVudHJpZXNMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiY29weU1hcFwiLCBjaGVjaykgJiYgY2hlY2soXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNwZWNpbWVuLnBheWxvYWQua2V5cy5sZW5ndGggPD0gbnVtTWFwRW50cmllc0xpbWl0LFxuICAgICAgICByZWRhY3RlZGBDb3B5TWFwIG11c3QgaGF2ZSBubyBtb3JlIHRoYW4gJHtxdW90ZShcbiAgICAgICAgICBudW1NYXBFbnRyaWVzTGltaXRcbiAgICAgICAgKX0gZW50cmllczogJHtzcGVjaW1lbn1gXG4gICAgICApICYmIGFycmF5RXZlcnlNYXRjaFBhdHRlcm4oXG4gICAgICAgIHNwZWNpbWVuLnBheWxvYWQua2V5cyxcbiAgICAgICAga2V5UGF0dCxcbiAgICAgICAgY2hlY2ssXG4gICAgICAgIFwibWFwIGtleXNcIlxuICAgICAgKSAmJiBhcnJheUV2ZXJ5TWF0Y2hQYXR0ZXJuKFxuICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLnZhbHVlcyxcbiAgICAgICAgdmFsdWVQYXR0LFxuICAgICAgICBjaGVjayxcbiAgICAgICAgXCJtYXAgdmFsdWVzXCJcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0ucGF0dGVybigpXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6bWFwT2YgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfZW50cnlQYXR0KSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInRhZ2dlZFwiKVxuICB9KTtcbiAgY29uc3Qgc3BsaXRBcnJheVBhcnRzID0gKHNwZWNpbWVuLCByZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCkgPT4ge1xuICAgIGNvbnN0IG51bVJlcXVpcmVkID0gcmVxdWlyZWRQYXR0Lmxlbmd0aDtcbiAgICBjb25zdCBudW1PcHRpb25hbCA9IG9wdGlvbmFsUGF0dC5sZW5ndGg7XG4gICAgY29uc3QgcmVxdWlyZWRTcGVjaW1lbiA9IHNwZWNpbWVuLnNsaWNlKDAsIG51bVJlcXVpcmVkKTtcbiAgICBjb25zdCBvcHRpb25hbFNwZWNpbWVuID0gc3BlY2ltZW4uc2xpY2UoXG4gICAgICBudW1SZXF1aXJlZCxcbiAgICAgIG51bVJlcXVpcmVkICsgbnVtT3B0aW9uYWxcbiAgICApO1xuICAgIGNvbnN0IHJlc3RTcGVjaW1lbiA9IHNwZWNpbWVuLnNsaWNlKG51bVJlcXVpcmVkICsgbnVtT3B0aW9uYWwpO1xuICAgIHJldHVybiBoYXJkZW4oeyByZXF1aXJlZFNwZWNpbWVuLCBvcHRpb25hbFNwZWNpbWVuLCByZXN0U3BlY2ltZW4gfSk7XG4gIH07XG4gIGNvbnN0IGFkYXB0QXJyYXlQYXR0ZXJuID0gKG9wdGlvbmFsUGF0dCwgbGVuZ3RoKSA9PiBoYXJkZW4ob3B0aW9uYWxQYXR0LnNsaWNlKDAsIGxlbmd0aCkubWFwKChwYXR0KSA9PiBNTS5vcHQocGF0dCkpKTtcbiAgY29uc3QgbWF0Y2hTcGxpdEFycmF5SGVscGVyID0gRmFyKFwibWF0Y2g6c3BsaXRBcnJheSBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQgPSBbXSwgcmVzdFBhdHQgPSBNTS5hbnkoKV0sIGNoZWNrKSA9PiB7XG4gICAgICBpZiAoIWNoZWNrS2luZChzcGVjaW1lbiwgXCJjb3B5QXJyYXlcIiwgY2hlY2spKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgcmVxdWlyZWRTcGVjaW1lbiwgb3B0aW9uYWxTcGVjaW1lbiwgcmVzdFNwZWNpbWVuIH0gPSBzcGxpdEFycmF5UGFydHMoc3BlY2ltZW4sIHJlcXVpcmVkUGF0dCwgb3B0aW9uYWxQYXR0KTtcbiAgICAgIGNvbnN0IHBhcnRpYWxQYXR0ID0gYWRhcHRBcnJheVBhdHRlcm4oXG4gICAgICAgIG9wdGlvbmFsUGF0dCxcbiAgICAgICAgb3B0aW9uYWxTcGVjaW1lbi5sZW5ndGhcbiAgICAgICk7XG4gICAgICBsZXQgYXJnTnVtID0gMDtcbiAgICAgIHJldHVybiAocmVxdWlyZWRTcGVjaW1lbi5sZW5ndGggPT09IHJlcXVpcmVkUGF0dC5sZW5ndGggfHwgY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICByZWRhY3RlZGBFeHBlY3RlZCBhdCBsZWFzdCAke3F1b3RlKFxuICAgICAgICAgIHJlcXVpcmVkUGF0dC5sZW5ndGhcbiAgICAgICAgKX0gYXJndW1lbnRzOiAke3NwZWNpbWVufWBcbiAgICAgICkpICYmIHJlcXVpcmVkUGF0dC5ldmVyeShcbiAgICAgICAgKHA0LCBpMykgPT4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY2hlY2tNYXRjaGVzMihyZXF1aXJlZFNwZWNpbWVuW2kzXSwgcDQsIGNoZWNrLCBgYXJnICR7YXJnTnVtKyt9YClcbiAgICAgICAgKVxuICAgICAgKSAmJiBwYXJ0aWFsUGF0dC5ldmVyeShcbiAgICAgICAgKHA0LCBpMykgPT4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY2hlY2tNYXRjaGVzMihvcHRpb25hbFNwZWNpbWVuW2kzXSwgcDQsIGNoZWNrLCBgYXJnICR7YXJnTnVtKyt9P2ApXG4gICAgICAgIClcbiAgICAgICkgJiYgY2hlY2tNYXRjaGVzMihyZXN0U3BlY2ltZW4sIHJlc3RQYXR0LCBjaGVjaywgXCIuLi5yZXN0XCIpO1xuICAgIH0sXG4gICAgLypcblxuXG4gICAgICovXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChzcGxpdEFycmF5LCBjaGVjaykgPT4ge1xuICAgICAgaWYgKHBhc3NTdHlsZU9mKHNwbGl0QXJyYXkpID09PSBcImNvcHlBcnJheVwiICYmIChzcGxpdEFycmF5Lmxlbmd0aCA+PSAxIHx8IHNwbGl0QXJyYXkubGVuZ3RoIDw9IDMpKSB7XG4gICAgICAgIGNvbnN0IFtyZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCA9IHZvaWQgMCwgcmVzdFBhdHQgPSB2b2lkIDBdID0gc3BsaXRBcnJheTtcbiAgICAgICAgaWYgKGlzUGF0dGVybjIocmVxdWlyZWRQYXR0KSAmJiBwYXNzU3R5bGVPZihyZXF1aXJlZFBhdHQpID09PSBcImNvcHlBcnJheVwiICYmIChvcHRpb25hbFBhdHQgPT09IHZvaWQgMCB8fCBpc1BhdHRlcm4yKG9wdGlvbmFsUGF0dCkgJiYgcGFzc1N0eWxlT2Yob3B0aW9uYWxQYXR0KSA9PT0gXCJjb3B5QXJyYXlcIikgJiYgKHJlc3RQYXR0ID09PSB2b2lkIDAgfHwgaXNQYXR0ZXJuMihyZXN0UGF0dCkpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYE11c3QgYmUgYW4gYXJyYXkgb2YgYSByZXF1aXJlZFBhdHQgYXJyYXksIGFuIG9wdGlvbmFsIG9wdGlvbmFsUGF0dCBhcnJheSwgYW5kIGFuIG9wdGlvbmFsIHJlc3RQYXR0OiAke3F1b3RlKFxuICAgICAgICAgIHNwbGl0QXJyYXlcbiAgICAgICAgKX1gXG4gICAgICApO1xuICAgIH0sXG4gICAgZ2V0UmFua0NvdmVyOiAoW1xuICAgICAgX3JlcXVpcmVkUGF0dCxcbiAgICAgIF9vcHRpb25hbFBhdHQgPSB2b2lkIDAsXG4gICAgICBfcmVzdFBhdHQgPSB2b2lkIDBcbiAgICBdKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcImNvcHlBcnJheVwiKVxuICB9KTtcbiAgY29uc3Qgc3BsaXRSZWNvcmRQYXJ0cyA9IChzcGVjaW1lbiwgcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQpID0+IHtcbiAgICBjb25zdCByZXF1aXJlZEVudHJpZXMgPSBbXTtcbiAgICBjb25zdCBvcHRpb25hbEVudHJpZXMgPSBbXTtcbiAgICBjb25zdCByZXN0RW50cmllcyA9IFtdO1xuICAgIGZvciAoY29uc3QgW25hbWUsIHZhbHVlXSBvZiBlbnRyaWVzNyhzcGVjaW1lbikpIHtcbiAgICAgIGlmIChoYXNPd245KHJlcXVpcmVkUGF0dCwgbmFtZSkpIHtcbiAgICAgICAgcmVxdWlyZWRFbnRyaWVzLnB1c2goW25hbWUsIHZhbHVlXSk7XG4gICAgICB9IGVsc2UgaWYgKGhhc093bjkob3B0aW9uYWxQYXR0LCBuYW1lKSkge1xuICAgICAgICBvcHRpb25hbEVudHJpZXMucHVzaChbbmFtZSwgdmFsdWVdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3RFbnRyaWVzLnB1c2goW25hbWUsIHZhbHVlXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgcmVxdWlyZWRTcGVjaW1lbjogZnJvbVVuaXF1ZUVudHJpZXMocmVxdWlyZWRFbnRyaWVzKSxcbiAgICAgIG9wdGlvbmFsU3BlY2ltZW46IGZyb21VbmlxdWVFbnRyaWVzKG9wdGlvbmFsRW50cmllcyksXG4gICAgICByZXN0U3BlY2ltZW46IGZyb21VbmlxdWVFbnRyaWVzKHJlc3RFbnRyaWVzKVxuICAgIH0pO1xuICB9O1xuICBjb25zdCBhZGFwdFJlY29yZFBhdHRlcm4gPSAob3B0aW9uYWxQYXR0LCBuYW1lcykgPT4gZnJvbVVuaXF1ZUVudHJpZXMobmFtZXMubWFwKChuYW1lKSA9PiBbbmFtZSwgTU0ub3B0KG9wdGlvbmFsUGF0dFtuYW1lXSldKSk7XG4gIGNvbnN0IG1hdGNoU3BsaXRSZWNvcmRIZWxwZXIgPSBGYXIoXCJtYXRjaDpzcGxpdFJlY29yZCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQgPSB7fSwgcmVzdFBhdHQgPSBNTS5hbnkoKV0sIGNoZWNrKSA9PiB7XG4gICAgICBpZiAoIWNoZWNrS2luZChzcGVjaW1lbiwgXCJjb3B5UmVjb3JkXCIsIGNoZWNrKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25zdCB7IHJlcXVpcmVkU3BlY2ltZW4sIG9wdGlvbmFsU3BlY2ltZW4sIHJlc3RTcGVjaW1lbiB9ID0gc3BsaXRSZWNvcmRQYXJ0cyhzcGVjaW1lbiwgcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQpO1xuICAgICAgY29uc3QgcGFydGlhbE5hbWVzID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvd25LZXlzMTgob3B0aW9uYWxTcGVjaW1lbilcbiAgICAgICk7XG4gICAgICBjb25zdCBwYXJ0aWFsUGF0dCA9IGFkYXB0UmVjb3JkUGF0dGVybihvcHRpb25hbFBhdHQsIHBhcnRpYWxOYW1lcyk7XG4gICAgICByZXR1cm4gY2hlY2tNYXRjaGVzMihyZXF1aXJlZFNwZWNpbWVuLCByZXF1aXJlZFBhdHQsIGNoZWNrKSAmJiBwYXJ0aWFsTmFtZXMuZXZlcnkoXG4gICAgICAgIChuYW1lKSA9PiBjaGVja01hdGNoZXMyKFxuICAgICAgICAgIG9wdGlvbmFsU3BlY2ltZW5bbmFtZV0sXG4gICAgICAgICAgcGFydGlhbFBhdHRbbmFtZV0sXG4gICAgICAgICAgY2hlY2ssXG4gICAgICAgICAgYCR7bmFtZX0/YFxuICAgICAgICApXG4gICAgICApICYmIGNoZWNrTWF0Y2hlczIocmVzdFNwZWNpbWVuLCByZXN0UGF0dCwgY2hlY2ssIFwiLi4ucmVzdFwiKTtcbiAgICB9LFxuICAgIC8qXG5cblxuICAgICAqL1xuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAoc3BsaXRBcnJheSwgY2hlY2spID0+IHtcbiAgICAgIGlmIChwYXNzU3R5bGVPZihzcGxpdEFycmF5KSA9PT0gXCJjb3B5QXJyYXlcIiAmJiAoc3BsaXRBcnJheS5sZW5ndGggPj0gMSB8fCBzcGxpdEFycmF5Lmxlbmd0aCA8PSAzKSkge1xuICAgICAgICBjb25zdCBbcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQgPSB2b2lkIDAsIHJlc3RQYXR0ID0gdm9pZCAwXSA9IHNwbGl0QXJyYXk7XG4gICAgICAgIGlmIChpc1BhdHRlcm4yKHJlcXVpcmVkUGF0dCkgJiYgcGFzc1N0eWxlT2YocmVxdWlyZWRQYXR0KSA9PT0gXCJjb3B5UmVjb3JkXCIgJiYgKG9wdGlvbmFsUGF0dCA9PT0gdm9pZCAwIHx8IGlzUGF0dGVybjIob3B0aW9uYWxQYXR0KSAmJiBwYXNzU3R5bGVPZihvcHRpb25hbFBhdHQpID09PSBcImNvcHlSZWNvcmRcIikgJiYgKHJlc3RQYXR0ID09PSB2b2lkIDAgfHwgaXNQYXR0ZXJuMihyZXN0UGF0dCkpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYE11c3QgYmUgYW4gYXJyYXkgb2YgYSByZXF1aXJlZFBhdHQgcmVjb3JkLCBhbiBvcHRpb25hbCBvcHRpb25hbFBhdHQgcmVjb3JkLCBhbmQgYW4gb3B0aW9uYWwgcmVzdFBhdHQ6ICR7cXVvdGUoXG4gICAgICAgICAgc3BsaXRBcnJheVxuICAgICAgICApfWBcbiAgICAgICk7XG4gICAgfSxcbiAgICBnZXRSYW5rQ292ZXI6IChbXG4gICAgICByZXF1aXJlZFBhdHQsXG4gICAgICBfb3B0aW9uYWxQYXR0ID0gdm9pZCAwLFxuICAgICAgX3Jlc3RQYXR0ID0gdm9pZCAwXG4gICAgXSkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIocGFzc1N0eWxlT2YocmVxdWlyZWRQYXR0KSlcbiAgfSk7XG4gIGNvbnN0IEhlbHBlcnNCeU1hdGNoVGFnID0gaGFyZGVuKHtcbiAgICBcIm1hdGNoOmFueVwiOiBtYXRjaEFueUhlbHBlcixcbiAgICBcIm1hdGNoOmFuZFwiOiBtYXRjaEFuZEhlbHBlcixcbiAgICBcIm1hdGNoOm9yXCI6IG1hdGNoT3JIZWxwZXIsXG4gICAgXCJtYXRjaDpub3RcIjogbWF0Y2hOb3RIZWxwZXIsXG4gICAgXCJtYXRjaDpzY2FsYXJcIjogbWF0Y2hTY2FsYXJIZWxwZXIsXG4gICAgXCJtYXRjaDprZXlcIjogbWF0Y2hLZXlIZWxwZXIsXG4gICAgXCJtYXRjaDpwYXR0ZXJuXCI6IG1hdGNoUGF0dGVybkhlbHBlcixcbiAgICBcIm1hdGNoOmtpbmRcIjogbWF0Y2hLaW5kSGVscGVyLFxuICAgIFwibWF0Y2g6dGFnZ2VkXCI6IG1hdGNoVGFnZ2VkSGVscGVyLFxuICAgIFwibWF0Y2g6YmlnaW50XCI6IG1hdGNoQmlnaW50SGVscGVyLFxuICAgIFwibWF0Y2g6bmF0XCI6IG1hdGNoTmF0SGVscGVyLFxuICAgIFwibWF0Y2g6c3RyaW5nXCI6IG1hdGNoU3RyaW5nSGVscGVyLFxuICAgIFwibWF0Y2g6c3ltYm9sXCI6IG1hdGNoU3ltYm9sSGVscGVyLFxuICAgIFwibWF0Y2g6cmVtb3RhYmxlXCI6IG1hdGNoUmVtb3RhYmxlSGVscGVyLFxuICAgIFwibWF0Y2g6bHRcIjogbWF0Y2hMVEhlbHBlcixcbiAgICBcIm1hdGNoOmx0ZVwiOiBtYXRjaExURUhlbHBlcixcbiAgICBcIm1hdGNoOmd0ZVwiOiBtYXRjaEdURUhlbHBlcixcbiAgICBcIm1hdGNoOmd0XCI6IG1hdGNoR1RIZWxwZXIsXG4gICAgXCJtYXRjaDphcnJheU9mXCI6IG1hdGNoQXJyYXlPZkhlbHBlcixcbiAgICBcIm1hdGNoOmJ5dGVBcnJheVwiOiBtYXRjaEJ5dGVBcnJheUhlbHBlcixcbiAgICBcIm1hdGNoOnJlY29yZE9mXCI6IG1hdGNoUmVjb3JkT2ZIZWxwZXIsXG4gICAgXCJtYXRjaDpzZXRPZlwiOiBtYXRjaFNldE9mSGVscGVyLFxuICAgIFwibWF0Y2g6YmFnT2ZcIjogbWF0Y2hCYWdPZkhlbHBlcixcbiAgICBcIm1hdGNoOmNvbnRhaW5lckhhc1wiOiBtYXRjaENvbnRhaW5lckhhc0hlbHBlcixcbiAgICBcIm1hdGNoOm1hcE9mXCI6IG1hdGNoTWFwT2ZIZWxwZXIsXG4gICAgXCJtYXRjaDpzcGxpdEFycmF5XCI6IG1hdGNoU3BsaXRBcnJheUhlbHBlcixcbiAgICBcIm1hdGNoOnNwbGl0UmVjb3JkXCI6IG1hdGNoU3BsaXRSZWNvcmRIZWxwZXJcbiAgfSk7XG4gIGNvbnN0IG1ha2VNYXRjaGVyID0gKHRhZywgcGF5bG9hZCkgPT4ge1xuICAgIGNvbnN0IG1hdGNoZXIgPSBtYWtlVGFnZ2VkKHRhZywgcGF5bG9hZCk7XG4gICAgYXNzZXJ0UGF0dGVybjIobWF0Y2hlcik7XG4gICAgcmV0dXJuIG1hdGNoZXI7XG4gIH07XG4gIGNvbnN0IG1ha2VLaW5kTWF0Y2hlciA9IChraW5kMikgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpraW5kXCIsIGtpbmQyKTtcbiAgY29uc3QgQW55U2hhcGUgPSBtYWtlTWF0Y2hlcihcIm1hdGNoOmFueVwiLCB2b2lkIDApO1xuICBjb25zdCBTY2FsYXJTaGFwZSA9IG1ha2VNYXRjaGVyKFwibWF0Y2g6c2NhbGFyXCIsIHZvaWQgMCk7XG4gIGNvbnN0IEtleVNoYXBlID0gbWFrZU1hdGNoZXIoXCJtYXRjaDprZXlcIiwgdm9pZCAwKTtcbiAgY29uc3QgUGF0dGVyblNoYXBlID0gbWFrZU1hdGNoZXIoXCJtYXRjaDpwYXR0ZXJuXCIsIHZvaWQgMCk7XG4gIGNvbnN0IEJvb2xlYW5TaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcImJvb2xlYW5cIik7XG4gIGNvbnN0IE51bWJlclNoYXBlID0gbWFrZUtpbmRNYXRjaGVyKFwibnVtYmVyXCIpO1xuICBjb25zdCBCaWdJbnRTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpiaWdpbnRcIiwgW10pO1xuICBjb25zdCBOYXRTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpuYXRcIiwgW10pO1xuICBjb25zdCBTdHJpbmdTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpzdHJpbmdcIiwgW10pO1xuICBjb25zdCBTeW1ib2xTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpzeW1ib2xcIiwgW10pO1xuICBjb25zdCBSZWNvcmRTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpyZWNvcmRPZlwiLCBbQW55U2hhcGUsIEFueVNoYXBlXSk7XG4gIGNvbnN0IEFycmF5U2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6YXJyYXlPZlwiLCBbQW55U2hhcGVdKTtcbiAgY29uc3QgQnl0ZUFycmF5U2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6Ynl0ZUFycmF5XCIsIFtdKTtcbiAgY29uc3QgU2V0U2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6c2V0T2ZcIiwgW0FueVNoYXBlXSk7XG4gIGNvbnN0IEJhZ1NoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOmJhZ09mXCIsIFtBbnlTaGFwZSwgQW55U2hhcGVdKTtcbiAgY29uc3QgTWFwU2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6bWFwT2ZcIiwgW0FueVNoYXBlLCBBbnlTaGFwZV0pO1xuICBjb25zdCBSZW1vdGFibGVTaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcInJlbW90YWJsZVwiKTtcbiAgY29uc3QgRXJyb3JTaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcImVycm9yXCIpO1xuICBjb25zdCBQcm9taXNlU2hhcGUgPSBtYWtlS2luZE1hdGNoZXIoXCJwcm9taXNlXCIpO1xuICBjb25zdCBVbmRlZmluZWRTaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcInVuZGVmaW5lZFwiKTtcbiAgY29uc3QgbWFrZUxpbWl0c01hdGNoZXIgPSAodGFnLCBwYXlsb2FkKSA9PiB7XG4gICAgaWYgKHBheWxvYWRbcGF5bG9hZC5sZW5ndGggLSAxXSA9PT0gdm9pZCAwKSB7XG4gICAgICBwYXlsb2FkID0gaGFyZGVuKHBheWxvYWQuc2xpY2UoMCwgcGF5bG9hZC5sZW5ndGggLSAxKSk7XG4gICAgfVxuICAgIHJldHVybiBtYWtlTWF0Y2hlcih0YWcsIHBheWxvYWQpO1xuICB9O1xuICBjb25zdCBtYWtlUmVtb3RhYmxlTWF0Y2hlciA9IChsYWJlbCA9IHZvaWQgMCkgPT4gbGFiZWwgPT09IHZvaWQgMCA/IFJlbW90YWJsZVNoYXBlIDogbWFrZU1hdGNoZXIoXCJtYXRjaDpyZW1vdGFibGVcIiwgaGFyZGVuKHsgbGFiZWwgfSkpO1xuICBjb25zdCBtYWtlU3BsaXRQYXlsb2FkID0gKGVtcHR5NSwgYmFzZTIsIG9wdGlvbmFsID0gdm9pZCAwLCByZXN0ID0gdm9pZCAwKSA9PiB7XG4gICAgaWYgKHJlc3QpIHtcbiAgICAgIHJldHVybiBbYmFzZTIsIG9wdGlvbmFsIHx8IGVtcHR5NSwgcmVzdF07XG4gICAgfVxuICAgIGlmIChvcHRpb25hbCkge1xuICAgICAgcmV0dXJuIFtiYXNlMiwgb3B0aW9uYWxdO1xuICAgIH1cbiAgICByZXR1cm4gW2Jhc2UyXTtcbiAgfTtcbiAgY29uc3QgTTMgPSBoYXJkZW4oe1xuICAgIGFueTogKCkgPT4gQW55U2hhcGUsXG4gICAgYW5kOiAoLi4ucGF0dHMpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6YW5kXCIsIHBhdHRzKSxcbiAgICBvcjogKC4uLnBhdHRzKSA9PiBtYWtlTWF0Y2hlcihcIm1hdGNoOm9yXCIsIHBhdHRzKSxcbiAgICBub3Q6IChzdWJQYXR0KSA9PiBtYWtlTWF0Y2hlcihcIm1hdGNoOm5vdFwiLCBzdWJQYXR0KSxcbiAgICBzY2FsYXI6ICgpID0+IFNjYWxhclNoYXBlLFxuICAgIGtleTogKCkgPT4gS2V5U2hhcGUsXG4gICAgcGF0dGVybjogKCkgPT4gUGF0dGVyblNoYXBlLFxuICAgIGtpbmQ6IG1ha2VLaW5kTWF0Y2hlcixcbiAgICB0YWdnZWQ6ICh0YWdQYXR0ID0gTTMuc3RyaW5nKCksIHBheWxvYWRQYXR0ID0gTTMuYW55KCkpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6dGFnZ2VkXCIsIGhhcmRlbihbdGFnUGF0dCwgcGF5bG9hZFBhdHRdKSksXG4gICAgYm9vbGVhbjogKCkgPT4gQm9vbGVhblNoYXBlLFxuICAgIG51bWJlcjogKCkgPT4gTnVtYmVyU2hhcGUsXG4gICAgYmlnaW50OiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOmJpZ2ludFwiLCBbbGltaXRzXSkgOiBCaWdJbnRTaGFwZSxcbiAgICBuYXQ6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6bmF0XCIsIFtsaW1pdHNdKSA6IE5hdFNoYXBlLFxuICAgIHN0cmluZzogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpzdHJpbmdcIiwgW2xpbWl0c10pIDogU3RyaW5nU2hhcGUsXG4gICAgc3ltYm9sOiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnN5bWJvbFwiLCBbbGltaXRzXSkgOiBTeW1ib2xTaGFwZSxcbiAgICByZWNvcmQ6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IE0zLnJlY29yZE9mKE0zLmFueSgpLCBNMy5hbnkoKSwgbGltaXRzKSA6IFJlY29yZFNoYXBlLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgYXJyYXk6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IE0zLmFycmF5T2YoTTMuYW55KCksIGxpbWl0cykgOiBBcnJheVNoYXBlLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIGJ5dGVBcnJheTogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpieXRlQXJyYXlcIiwgW2xpbWl0c10pIDogQnl0ZUFycmF5U2hhcGUsXG4gICAgc2V0OiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBNMy5zZXRPZihNMy5hbnkoKSwgbGltaXRzKSA6IFNldFNoYXBlLFxuICAgIGJhZzogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gTTMuYmFnT2YoTTMuYW55KCksIE0zLmFueSgpLCBsaW1pdHMpIDogQmFnU2hhcGUsXG4gICAgbWFwOiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBNMy5tYXBPZihNMy5hbnkoKSwgTTMuYW55KCksIGxpbWl0cykgOiBNYXBTaGFwZSxcbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIHJlbW90YWJsZTogbWFrZVJlbW90YWJsZU1hdGNoZXIsXG4gICAgZXJyb3I6ICgpID0+IEVycm9yU2hhcGUsXG4gICAgcHJvbWlzZTogKCkgPT4gUHJvbWlzZVNoYXBlLFxuICAgIHVuZGVmaW5lZDogKCkgPT4gVW5kZWZpbmVkU2hhcGUsXG4gICAgbnVsbDogKCkgPT4gbnVsbCxcbiAgICBsdDogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpsdFwiLCByaWdodE9wZXJhbmQpLFxuICAgIGx0ZTogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpsdGVcIiwgcmlnaHRPcGVyYW5kKSxcbiAgICBlcTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5KGtleSk7XG4gICAgICByZXR1cm4ga2V5ID09PSB2b2lkIDAgPyBNMy51bmRlZmluZWQoKSA6IGtleTtcbiAgICB9LFxuICAgIG5lcTogKGtleSkgPT4gTTMubm90KE0zLmVxKGtleSkpLFxuICAgIGd0ZTogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpndGVcIiwgcmlnaHRPcGVyYW5kKSxcbiAgICBndDogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpndFwiLCByaWdodE9wZXJhbmQpLFxuICAgIHJlY29yZE9mOiAoa2V5UGF0dCA9IE0zLmFueSgpLCB2YWx1ZVBhdHQgPSBNMy5hbnkoKSwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnJlY29yZE9mXCIsIFtrZXlQYXR0LCB2YWx1ZVBhdHQsIGxpbWl0c10pLFxuICAgIGFycmF5T2Y6IChzdWJQYXR0ID0gTTMuYW55KCksIGxpbWl0cyA9IHZvaWQgMCkgPT4gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDphcnJheU9mXCIsIFtzdWJQYXR0LCBsaW1pdHNdKSxcbiAgICBzZXRPZjogKGtleVBhdHQgPSBNMy5hbnkoKSwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnNldE9mXCIsIFtrZXlQYXR0LCBsaW1pdHNdKSxcbiAgICBiYWdPZjogKGtleVBhdHQgPSBNMy5hbnkoKSwgY291bnRQYXR0ID0gTTMuYW55KCksIGxpbWl0cyA9IHZvaWQgMCkgPT4gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpiYWdPZlwiLCBba2V5UGF0dCwgY291bnRQYXR0LCBsaW1pdHNdKSxcbiAgICBjb250YWluZXJIYXM6IChlbGVtZW50UGF0dCA9IE0zLmFueSgpLCBjb3VudFBhdHQgPSAxbiwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOmNvbnRhaW5lckhhc1wiLCBbZWxlbWVudFBhdHQsIGNvdW50UGF0dCwgbGltaXRzXSksXG4gICAgbWFwT2Y6IChrZXlQYXR0ID0gTTMuYW55KCksIHZhbHVlUGF0dCA9IE0zLmFueSgpLCBsaW1pdHMgPSB2b2lkIDApID0+IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6bWFwT2ZcIiwgW2tleVBhdHQsIHZhbHVlUGF0dCwgbGltaXRzXSksXG4gICAgc3BsaXRBcnJheTogKGJhc2UyLCBvcHRpb25hbCA9IHZvaWQgMCwgcmVzdCA9IHZvaWQgMCkgPT4gbWFrZU1hdGNoZXIoXG4gICAgICBcIm1hdGNoOnNwbGl0QXJyYXlcIixcbiAgICAgIG1ha2VTcGxpdFBheWxvYWQoW10sIGJhc2UyLCBvcHRpb25hbCwgcmVzdClcbiAgICApLFxuICAgIHNwbGl0UmVjb3JkOiAoYmFzZTIsIG9wdGlvbmFsID0gdm9pZCAwLCByZXN0ID0gdm9pZCAwKSA9PiBtYWtlTWF0Y2hlcihcbiAgICAgIFwibWF0Y2g6c3BsaXRSZWNvcmRcIixcbiAgICAgIG1ha2VTcGxpdFBheWxvYWQoe30sIGJhc2UyLCBvcHRpb25hbCwgcmVzdClcbiAgICApLFxuICAgIHNwbGl0OiAoYmFzZTIsIHJlc3QgPSB2b2lkIDApID0+IHtcbiAgICAgIGlmIChwYXNzU3R5bGVPZihoYXJkZW4oYmFzZTIpKSA9PT0gXCJjb3B5QXJyYXlcIikge1xuICAgICAgICByZXR1cm4gTTMuc3BsaXRBcnJheShiYXNlMiwgcmVzdCAmJiBbXSwgcmVzdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gTTMuc3BsaXRSZWNvcmQoYmFzZTIsIHJlc3QgJiYge30sIHJlc3QpO1xuICAgICAgfVxuICAgIH0sXG4gICAgcGFydGlhbDogKGJhc2UyLCByZXN0ID0gdm9pZCAwKSA9PiB7XG4gICAgICBpZiAocGFzc1N0eWxlT2YoaGFyZGVuKGJhc2UyKSkgPT09IFwiY29weUFycmF5XCIpIHtcbiAgICAgICAgcmV0dXJuIE0zLnNwbGl0QXJyYXkoW10sIGJhc2UyLCByZXN0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBNMy5zcGxpdFJlY29yZCh7fSwgYmFzZTIsIHJlc3QpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZXJlZjogKHQ1KSA9PiBNMy5vcih0NSwgTTMucHJvbWlzZSgpKSxcbiAgICBvcHQ6ICh0NSkgPT4gTTMub3IoTTMudW5kZWZpbmVkKCksIHQ1KSxcbiAgICBpbnRlcmZhY2U6IChpbnRlcmZhY2VOYW1lLCBtZXRob2RHdWFyZHMsIG9wdGlvbnMpID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlSW50ZXJmYWNlR3VhcmQoaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCBvcHRpb25zKVxuICAgICksXG4gICAgY2FsbDogKC4uLmFyZ1BhdHRlcm5zKSA9PiAoXG4gICAgICAvL1xuICAgICAgbWFrZU1ldGhvZEd1YXJkTWFrZXIoXCJzeW5jXCIsIGFyZ1BhdHRlcm5zKVxuICAgICksXG4gICAgY2FsbFdoZW46ICguLi5hcmdHdWFyZHMpID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlTWV0aG9kR3VhcmRNYWtlcihcImFzeW5jXCIsIGFyZ0d1YXJkcylcbiAgICApLFxuICAgIGF3YWl0OiAoYXJnUGF0dGVybikgPT4gKFxuICAgICAgLy9cbiAgICAgIG1ha2VBd2FpdEFyZ0d1YXJkKGFyZ1BhdHRlcm4pXG4gICAgKSxcbiAgICByYXc6ICgpID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlUmF3R3VhcmQoKVxuICAgIClcbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGNoZWNrTWF0Y2hlczogY2hlY2tNYXRjaGVzMixcbiAgICBtYXRjaGVzOiBtYXRjaGVzMixcbiAgICBtdXN0TWF0Y2g6IG11c3RNYXRjaDQsXG4gICAgYXNzZXJ0UGF0dGVybjogYXNzZXJ0UGF0dGVybjIsXG4gICAgaXNQYXR0ZXJuOiBpc1BhdHRlcm4yLFxuICAgIGdldFJhbmtDb3ZlcjogZ2V0UmFua0NvdmVyMixcbiAgICBNOiBNMyxcbiAgICBraW5kT2Y6IGtpbmRPZjIsXG4gICAgY29udGFpbmVySGFzU3BsaXQ6IGNvbnRhaW5lckhhc1NwbGl0MlxuICB9KTtcbn07XG52YXIge1xuICBjaGVja01hdGNoZXMsXG4gIG1hdGNoZXMsXG4gIG11c3RNYXRjaCxcbiAgYXNzZXJ0UGF0dGVybixcbiAgaXNQYXR0ZXJuLFxuICBnZXRSYW5rQ292ZXIsXG4gIE0sXG4gIGtpbmRPZixcbiAgY29udGFpbmVySGFzU3BsaXRcbn0gPSBtYWtlUGF0dGVybktpdCgpO1xuTU0gPSBNO1xudmFyIEF3YWl0QXJnR3VhcmRQYXlsb2FkU2hhcGUgPSBoYXJkZW4oe1xuICBhcmdHdWFyZDogTS5wYXR0ZXJuKClcbn0pO1xudmFyIEF3YWl0QXJnR3VhcmRTaGFwZSA9IE0ua2luZChcImd1YXJkOmF3YWl0QXJnR3VhcmRcIik7XG52YXIgaXNBd2FpdEFyZ0d1YXJkID0gKHNwZWNpbWVuKSA9PiBtYXRjaGVzKHNwZWNpbWVuLCBBd2FpdEFyZ0d1YXJkU2hhcGUpO1xuaGFyZGVuKGlzQXdhaXRBcmdHdWFyZCk7XG52YXIgYXNzZXJ0QXdhaXRBcmdHdWFyZCA9IChzcGVjaW1lbikgPT4ge1xuICBtdXN0TWF0Y2goc3BlY2ltZW4sIEF3YWl0QXJnR3VhcmRTaGFwZSwgXCJhd2FpdEFyZ0d1YXJkXCIpO1xufTtcbmhhcmRlbihhc3NlcnRBd2FpdEFyZ0d1YXJkKTtcbnZhciBtYWtlQXdhaXRBcmdHdWFyZCA9IChhcmdQYXR0ZXJuKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VUYWdnZWQoXCJndWFyZDphd2FpdEFyZ0d1YXJkXCIsIHtcbiAgICBhcmdHdWFyZDogYXJnUGF0dGVyblxuICB9KTtcbiAgYXNzZXJ0QXdhaXRBcmdHdWFyZChyZXN1bHQpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBSYXdHdWFyZFBheWxvYWRTaGFwZSA9IE0ucmVjb3JkKCk7XG52YXIgUmF3R3VhcmRTaGFwZSA9IE0ua2luZChcImd1YXJkOnJhd0d1YXJkXCIpO1xudmFyIGlzUmF3R3VhcmQgPSAoc3BlY2ltZW4pID0+IG1hdGNoZXMoc3BlY2ltZW4sIFJhd0d1YXJkU2hhcGUpO1xudmFyIG1ha2VSYXdHdWFyZCA9ICgpID0+IG1ha2VUYWdnZWQoXCJndWFyZDpyYXdHdWFyZFwiLCB7fSk7XG52YXIgU3luY1ZhbHVlR3VhcmRTaGFwZSA9IE0ub3IoUmF3R3VhcmRTaGFwZSwgTS5wYXR0ZXJuKCkpO1xudmFyIFN5bmNWYWx1ZUd1YXJkTGlzdFNoYXBlID0gTS5hcnJheU9mKFN5bmNWYWx1ZUd1YXJkU2hhcGUpO1xudmFyIEFyZ0d1YXJkU2hhcGUgPSBNLm9yKFJhd0d1YXJkU2hhcGUsIEF3YWl0QXJnR3VhcmRTaGFwZSwgTS5wYXR0ZXJuKCkpO1xudmFyIEFyZ0d1YXJkTGlzdFNoYXBlID0gTS5hcnJheU9mKEFyZ0d1YXJkU2hhcGUpO1xudmFyIFN5bmNNZXRob2RHdWFyZFBheWxvYWRTaGFwZSA9IGhhcmRlbih7XG4gIGNhbGxLaW5kOiBcInN5bmNcIixcbiAgYXJnR3VhcmRzOiBTeW5jVmFsdWVHdWFyZExpc3RTaGFwZSxcbiAgb3B0aW9uYWxBcmdHdWFyZHM6IE0ub3B0KFN5bmNWYWx1ZUd1YXJkTGlzdFNoYXBlKSxcbiAgcmVzdEFyZ0d1YXJkOiBNLm9wdChTeW5jVmFsdWVHdWFyZFNoYXBlKSxcbiAgcmV0dXJuR3VhcmQ6IFN5bmNWYWx1ZUd1YXJkU2hhcGVcbn0pO1xudmFyIEFzeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUgPSBoYXJkZW4oe1xuICBjYWxsS2luZDogXCJhc3luY1wiLFxuICBhcmdHdWFyZHM6IEFyZ0d1YXJkTGlzdFNoYXBlLFxuICBvcHRpb25hbEFyZ0d1YXJkczogTS5vcHQoQXJnR3VhcmRMaXN0U2hhcGUpLFxuICByZXN0QXJnR3VhcmQ6IE0ub3B0KFN5bmNWYWx1ZUd1YXJkU2hhcGUpLFxuICByZXR1cm5HdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxufSk7XG52YXIgTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUgPSBNLm9yKFxuICBTeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUsXG4gIEFzeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGVcbik7XG52YXIgTWV0aG9kR3VhcmRTaGFwZSA9IE0ua2luZChcImd1YXJkOm1ldGhvZEd1YXJkXCIpO1xudmFyIGFzc2VydE1ldGhvZEd1YXJkID0gKHNwZWNpbWVuKSA9PiB7XG4gIG11c3RNYXRjaChzcGVjaW1lbiwgTWV0aG9kR3VhcmRTaGFwZSwgXCJtZXRob2RHdWFyZFwiKTtcbn07XG5oYXJkZW4oYXNzZXJ0TWV0aG9kR3VhcmQpO1xudmFyIG1ha2VNZXRob2RHdWFyZE1ha2VyID0gKGNhbGxLaW5kLCBhcmdHdWFyZHMsIG9wdGlvbmFsQXJnR3VhcmRzID0gdm9pZCAwLCByZXN0QXJnR3VhcmQgPSB2b2lkIDApID0+IGhhcmRlbih7XG4gIG9wdGlvbmFsOiAoLi4ub3B0QXJnR3VhcmRzKSA9PiB7XG4gICAgb3B0aW9uYWxBcmdHdWFyZHMgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYENhbiBvbmx5IGhhdmUgb25lIHNldCBvZiBvcHRpb25hbCBndWFyZHNgO1xuICAgIHJlc3RBcmdHdWFyZCA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgb3B0aW9uYWwgYXJnIGd1YXJkcyBtdXN0IGNvbWUgYmVmb3JlIHJlc3QgYXJnYDtcbiAgICByZXR1cm4gbWFrZU1ldGhvZEd1YXJkTWFrZXIoY2FsbEtpbmQsIGFyZ0d1YXJkcywgb3B0QXJnR3VhcmRzKTtcbiAgfSxcbiAgcmVzdDogKHJBcmdHdWFyZCkgPT4ge1xuICAgIHJlc3RBcmdHdWFyZCA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgQ2FuIG9ubHkgaGF2ZSBvbmUgcmVzdCBhcmdgO1xuICAgIHJldHVybiBtYWtlTWV0aG9kR3VhcmRNYWtlcihcbiAgICAgIGNhbGxLaW5kLFxuICAgICAgYXJnR3VhcmRzLFxuICAgICAgb3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgICByQXJnR3VhcmRcbiAgICApO1xuICB9LFxuICByZXR1cm5zOiAocmV0dXJuR3VhcmQgPSBNLnVuZGVmaW5lZCgpKSA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gbWFrZVRhZ2dlZChcImd1YXJkOm1ldGhvZEd1YXJkXCIsIHtcbiAgICAgIGNhbGxLaW5kLFxuICAgICAgYXJnR3VhcmRzLFxuICAgICAgb3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgICByZXN0QXJnR3VhcmQsXG4gICAgICByZXR1cm5HdWFyZFxuICAgIH0pO1xuICAgIGFzc2VydE1ldGhvZEd1YXJkKHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufSk7XG52YXIgSW50ZXJmYWNlR3VhcmRQYXlsb2FkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgaW50ZXJmYWNlTmFtZTogTS5zdHJpbmcoKSxcbiAgICBtZXRob2RHdWFyZHM6IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgTWV0aG9kR3VhcmRTaGFwZSlcbiAgfSxcbiAge1xuICAgIGRlZmF1bHRHdWFyZHM6IE0ub3IoTS51bmRlZmluZWQoKSwgXCJwYXNzYWJsZVwiLCBcInJhd1wiKSxcbiAgICBzbG9wcHk6IE0uYm9vbGVhbigpLFxuICAgIHN5bWJvbE1ldGhvZEd1YXJkczogTS5tYXBPZihNLnN5bWJvbCgpLCBNZXRob2RHdWFyZFNoYXBlKVxuICB9XG4pO1xudmFyIEludGVyZmFjZUd1YXJkU2hhcGUgPSBNLmtpbmQoXCJndWFyZDppbnRlcmZhY2VHdWFyZFwiKTtcbnZhciBhc3NlcnRJbnRlcmZhY2VHdWFyZCA9IChzcGVjaW1lbikgPT4ge1xuICBtdXN0TWF0Y2goc3BlY2ltZW4sIEludGVyZmFjZUd1YXJkU2hhcGUsIFwiaW50ZXJmYWNlR3VhcmRcIik7XG59O1xuaGFyZGVuKGFzc2VydEludGVyZmFjZUd1YXJkKTtcbnZhciBtYWtlSW50ZXJmYWNlR3VhcmQgPSAoaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCBvcHRpb25zID0ge30pID0+IHtcbiAgY29uc3QgeyBzbG9wcHkgPSBmYWxzZSwgZGVmYXVsdEd1YXJkcyA9IHNsb3BweSA/IFwicGFzc2FibGVcIiA6IHZvaWQgMCB9ID0gb3B0aW9ucztcbiAgY29uc3Qgc3RyaW5nTWV0aG9kR3VhcmRzID0ge307XG4gIGNvbnN0IHN5bWJvbE1ldGhvZEd1YXJkc0VudHJpZXMgPSBbXTtcbiAgZm9yIChjb25zdCBrZXkgb2Ygb3duS2V5czE4KG1ldGhvZEd1YXJkcykpIHtcbiAgICBjb25zdCB2YWx1ZSA9IG1ldGhvZEd1YXJkc1tcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAga2V5XG4gICAgXTtcbiAgICBpZiAodHlwZW9mIGtleSA9PT0gXCJzeW1ib2xcIikge1xuICAgICAgc3ltYm9sTWV0aG9kR3VhcmRzRW50cmllcy5wdXNoKFtrZXksIHZhbHVlXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0cmluZ01ldGhvZEd1YXJkc1trZXldID0gdmFsdWU7XG4gICAgfVxuICB9XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VUYWdnZWQoXCJndWFyZDppbnRlcmZhY2VHdWFyZFwiLCB7XG4gICAgaW50ZXJmYWNlTmFtZSxcbiAgICBtZXRob2RHdWFyZHM6IHN0cmluZ01ldGhvZEd1YXJkcyxcbiAgICAuLi4oc3ltYm9sTWV0aG9kR3VhcmRzRW50cmllcy5sZW5ndGg/IHsgc3ltYm9sTWV0aG9kR3VhcmRzOiBtYWtlQ29weU1hcChzeW1ib2xNZXRob2RHdWFyZHNFbnRyaWVzKSB9IDoge30pLFxuICAgIGRlZmF1bHRHdWFyZHNcbiAgfSk7XG4gIGFzc2VydEludGVyZmFjZUd1YXJkKHJlc3VsdCk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICByZXN1bHRcbiAgKTtcbn07XG52YXIgR3VhcmRQYXlsb2FkU2hhcGVzID0gaGFyZGVuKHtcbiAgXCJndWFyZDphd2FpdEFyZ0d1YXJkXCI6IEF3YWl0QXJnR3VhcmRQYXlsb2FkU2hhcGUsXG4gIFwiZ3VhcmQ6cmF3R3VhcmRcIjogUmF3R3VhcmRQYXlsb2FkU2hhcGUsXG4gIFwiZ3VhcmQ6bWV0aG9kR3VhcmRcIjogTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUsXG4gIFwiZ3VhcmQ6aW50ZXJmYWNlR3VhcmRcIjogSW50ZXJmYWNlR3VhcmRQYXlsb2FkU2hhcGVcbn0pO1xuXG4vL1xudmFyIExlZ2FjeUF3YWl0QXJnR3VhcmRTaGFwZSA9IGhhcmRlbih7XG4gIGtsYXNzOiBcImF3YWl0QXJnXCIsXG4gIGFyZ0d1YXJkOiBNLnBhdHRlcm4oKVxufSk7XG52YXIgZ2V0QXdhaXRBcmdHdWFyZFBheWxvYWQgPSAoYXdhaXRBcmdHdWFyZCkgPT4ge1xuICBpZiAobWF0Y2hlcyhhd2FpdEFyZ0d1YXJkLCBMZWdhY3lBd2FpdEFyZ0d1YXJkU2hhcGUpKSB7XG4gICAgY29uc3QgeyBrbGFzczogXywgLi4ucGF5bG9hZCB9ID0gYXdhaXRBcmdHdWFyZDtcbiAgICByZXR1cm4gcGF5bG9hZDtcbiAgfVxuICBhc3NlcnRBd2FpdEFyZ0d1YXJkKGF3YWl0QXJnR3VhcmQpO1xuICByZXR1cm4gYXdhaXRBcmdHdWFyZC5wYXlsb2FkO1xufTtcbmhhcmRlbihnZXRBd2FpdEFyZ0d1YXJkUGF5bG9hZCk7XG52YXIgTGVnYWN5U3luY01ldGhvZEd1YXJkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAga2xhc3M6IFwibWV0aG9kR3VhcmRcIixcbiAgICBjYWxsS2luZDogXCJzeW5jXCIsXG4gICAgYXJnR3VhcmRzOiBTeW5jVmFsdWVHdWFyZExpc3RTaGFwZSxcbiAgICByZXR1cm5HdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxuICB9LFxuICB7XG4gICAgb3B0aW9uYWxBcmdHdWFyZHM6IFN5bmNWYWx1ZUd1YXJkTGlzdFNoYXBlLFxuICAgIHJlc3RBcmdHdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxuICB9XG4pO1xudmFyIExlZ2FjeUFyZ0d1YXJkU2hhcGUgPSBNLm9yKFxuICBSYXdHdWFyZFNoYXBlLFxuICBBd2FpdEFyZ0d1YXJkU2hhcGUsXG4gIExlZ2FjeUF3YWl0QXJnR3VhcmRTaGFwZSxcbiAgTS5wYXR0ZXJuKClcbik7XG52YXIgTGVnYWN5QXJnR3VhcmRMaXN0U2hhcGUgPSBNLmFycmF5T2YoTGVnYWN5QXJnR3VhcmRTaGFwZSk7XG52YXIgTGVnYWN5QXN5bmNNZXRob2RHdWFyZFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGtsYXNzOiBcIm1ldGhvZEd1YXJkXCIsXG4gICAgY2FsbEtpbmQ6IFwiYXN5bmNcIixcbiAgICBhcmdHdWFyZHM6IExlZ2FjeUFyZ0d1YXJkTGlzdFNoYXBlLFxuICAgIHJldHVybkd1YXJkOiBTeW5jVmFsdWVHdWFyZFNoYXBlXG4gIH0sXG4gIHtcbiAgICBvcHRpb25hbEFyZ0d1YXJkczogQXJnR3VhcmRMaXN0U2hhcGUsXG4gICAgcmVzdEFyZ0d1YXJkOiBTeW5jVmFsdWVHdWFyZFNoYXBlXG4gIH1cbik7XG52YXIgTGVnYWN5TWV0aG9kR3VhcmRTaGFwZSA9IE0ub3IoXG4gIExlZ2FjeVN5bmNNZXRob2RHdWFyZFNoYXBlLFxuICBMZWdhY3lBc3luY01ldGhvZEd1YXJkU2hhcGVcbik7XG52YXIgYWRhcHRMZWdhY3lBcmdHdWFyZCA9IChhcmdHdWFyZCkgPT4gbWF0Y2hlcyhhcmdHdWFyZCwgTGVnYWN5QXdhaXRBcmdHdWFyZFNoYXBlKSA/IE0uYXdhaXQoZ2V0QXdhaXRBcmdHdWFyZFBheWxvYWQoYXJnR3VhcmQpLmFyZ0d1YXJkKSA6IGFyZ0d1YXJkO1xudmFyIGdldE1ldGhvZEd1YXJkUGF5bG9hZCA9IChtZXRob2RHdWFyZCkgPT4ge1xuICBpZiAobWF0Y2hlcyhtZXRob2RHdWFyZCwgTWV0aG9kR3VhcmRTaGFwZSkpIHtcbiAgICByZXR1cm4gbWV0aG9kR3VhcmQucGF5bG9hZDtcbiAgfVxuICBtdXN0TWF0Y2gobWV0aG9kR3VhcmQsIExlZ2FjeU1ldGhvZEd1YXJkU2hhcGUsIFwibGVnYWN5TWV0aG9kR3VhcmRcIik7XG4gIGNvbnN0IHtcbiAgICAvL1xuICAgIGtsYXNzOiBfLFxuICAgIC8vXG4gICAgY2FsbEtpbmQsXG4gICAgLy9cbiAgICByZXR1cm5HdWFyZCxcbiAgICAvL1xuICAgIHJlc3RBcmdHdWFyZFxuICB9ID0gbWV0aG9kR3VhcmQ7XG4gIGxldCB7XG4gICAgLy9cbiAgICBhcmdHdWFyZHMsXG4gICAgLy9cbiAgICBvcHRpb25hbEFyZ0d1YXJkc1xuICB9ID0gbWV0aG9kR3VhcmQ7XG4gIGlmIChjYWxsS2luZCA9PT0gXCJhc3luY1wiKSB7XG4gICAgYXJnR3VhcmRzID0gYXJnR3VhcmRzLm1hcChhZGFwdExlZ2FjeUFyZ0d1YXJkKTtcbiAgICBvcHRpb25hbEFyZ0d1YXJkcyA9IG9wdGlvbmFsQXJnR3VhcmRzICYmIG9wdGlvbmFsQXJnR3VhcmRzLm1hcChhZGFwdExlZ2FjeUFyZ0d1YXJkKTtcbiAgfVxuICBjb25zdCBwYXlsb2FkID0gaGFyZGVuKHtcbiAgICBjYWxsS2luZCxcbiAgICBhcmdHdWFyZHMsXG4gICAgb3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgcmVzdEFyZ0d1YXJkLFxuICAgIHJldHVybkd1YXJkXG4gIH0pO1xuICBtdXN0TWF0Y2gocGF5bG9hZCwgTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUsIFwiaW50ZXJuYWxNZXRob2RHdWFyZEFkYXB0b3JcIik7XG4gIHJldHVybiBwYXlsb2FkO1xufTtcbmhhcmRlbihnZXRNZXRob2RHdWFyZFBheWxvYWQpO1xudmFyIExlZ2FjeUludGVyZmFjZUd1YXJkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAga2xhc3M6IFwiSW50ZXJmYWNlXCIsXG4gICAgaW50ZXJmYWNlTmFtZTogTS5zdHJpbmcoKSxcbiAgICBtZXRob2RHdWFyZHM6IE0ucmVjb3JkT2YoXG4gICAgICBNLnN0cmluZygpLFxuICAgICAgTS5vcihNZXRob2RHdWFyZFNoYXBlLCBMZWdhY3lNZXRob2RHdWFyZFNoYXBlKVxuICAgIClcbiAgfSxcbiAge1xuICAgIGRlZmF1bHRHdWFyZHM6IE0ub3IoTS51bmRlZmluZWQoKSwgXCJwYXNzYWJsZVwiLCBcInJhd1wiKSxcbiAgICBzbG9wcHk6IE0uYm9vbGVhbigpLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIHN5bWJvbE1ldGhvZEd1YXJkczogTS5tYXBPZihNLnN5bWJvbCgpLCBNZXRob2RHdWFyZFNoYXBlKVxuICB9XG4pO1xudmFyIGFkYXB0TWV0aG9kR3VhcmQgPSAobWV0aG9kR3VhcmQpID0+IHtcbiAgaWYgKG1hdGNoZXMobWV0aG9kR3VhcmQsIExlZ2FjeU1ldGhvZEd1YXJkU2hhcGUpKSB7XG4gICAgY29uc3Qge1xuICAgICAgY2FsbEtpbmQsXG4gICAgICBhcmdHdWFyZHMsXG4gICAgICBvcHRpb25hbEFyZ0d1YXJkcyA9IFtdLFxuICAgICAgcmVzdEFyZ0d1YXJkID0gTS5hbnkoKSxcbiAgICAgIHJldHVybkd1YXJkXG4gICAgfSA9IGdldE1ldGhvZEd1YXJkUGF5bG9hZChtZXRob2RHdWFyZCk7XG4gICAgY29uc3QgbUNhbGwgPSBjYWxsS2luZCA9PT0gXCJzeW5jXCIgPyBNLmNhbGwgOiBNLmNhbGxXaGVuO1xuICAgIHJldHVybiBtQ2FsbCguLi5hcmdHdWFyZHMpLm9wdGlvbmFsKC4uLm9wdGlvbmFsQXJnR3VhcmRzKS5yZXN0KHJlc3RBcmdHdWFyZCkucmV0dXJucyhyZXR1cm5HdWFyZCk7XG4gIH1cbiAgcmV0dXJuIG1ldGhvZEd1YXJkO1xufTtcbnZhciBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQgPSAoaW50ZXJmYWNlR3VhcmQpID0+IHtcbiAgaWYgKG1hdGNoZXMoaW50ZXJmYWNlR3VhcmQsIEludGVyZmFjZUd1YXJkU2hhcGUpKSB7XG4gICAgcmV0dXJuIGludGVyZmFjZUd1YXJkLnBheWxvYWQ7XG4gIH1cbiAgbXVzdE1hdGNoKGludGVyZmFjZUd1YXJkLCBMZWdhY3lJbnRlcmZhY2VHdWFyZFNoYXBlLCBcImxlZ2FjeUludGVyZmFjZUd1YXJkXCIpO1xuICBsZXQgeyBrbGFzczogXywgaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCAuLi5yZXN0IH0gPSBpbnRlcmZhY2VHdWFyZDtcbiAgbWV0aG9kR3VhcmRzID0gb2JqZWN0TWFwKG1ldGhvZEd1YXJkcywgYWRhcHRNZXRob2RHdWFyZCk7XG4gIGNvbnN0IHBheWxvYWQgPSBoYXJkZW4oe1xuICAgIGludGVyZmFjZU5hbWUsXG4gICAgbWV0aG9kR3VhcmRzLFxuICAgIC4uLnJlc3RcbiAgfSk7XG4gIG11c3RNYXRjaChcbiAgICBwYXlsb2FkLFxuICAgIEludGVyZmFjZUd1YXJkUGF5bG9hZFNoYXBlLFxuICAgIFwiaW50ZXJuYWxJbnRlcmZhY2VHdWFyZEFkYXB0b3JcIlxuICApO1xuICByZXR1cm4gcGF5bG9hZDtcbn07XG5oYXJkZW4oZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKTtcbnZhciBlbXB0eUNvcHlNYXAgPSBtYWtlQ29weU1hcChbXSk7XG52YXIgZ2V0SW50ZXJmYWNlTWV0aG9kS2V5cyA9IChpbnRlcmZhY2VHdWFyZCkgPT4ge1xuICBjb25zdCB7IG1ldGhvZEd1YXJkcywgc3ltYm9sTWV0aG9kR3VhcmRzID0gZW1wdHlDb3B5TWFwIH0gPSBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoaW50ZXJmYWNlR3VhcmQpO1xuICByZXR1cm4gaGFyZGVuKFtcbiAgICAuLi5SZWZsZWN0Lm93bktleXMobWV0aG9kR3VhcmRzKSxcbiAgICAuLi5nZXRDb3B5TWFwS2V5cyhzeW1ib2xNZXRob2RHdWFyZHMpXG4gIF0pO1xufTtcbmhhcmRlbihnZXRJbnRlcmZhY2VNZXRob2RLZXlzKTtcblxuLy9cbnZhciBHRVRfSU5URVJGQUNFX0dVQVJEID0gXCJfX2dldEludGVyZmFjZUd1YXJkX19cIjtcblxuLy9cbnZhciB7IGFwcGx5OiBhcHBseTUsIG93bktleXM6IG93bktleXMxOSB9ID0gUmVmbGVjdDtcbnZhciB7IGRlZmluZVByb3BlcnRpZXM6IGRlZmluZVByb3BlcnRpZXMzLCBmcm9tRW50cmllczogZnJvbUVudHJpZXM4LCBoYXNPd246IGhhc093bjEwIH0gPSBPYmplY3Q7XG52YXIgUmF3TWV0aG9kR3VhcmQgPSBNLmNhbGwoKS5yZXN0KE0ucmF3KCkpLnJldHVybnMoTS5yYXcoKSk7XG52YXIgUkVEQUNURURfUkFXX0FSRyA9IFwiPHJlZGFjdGVkIHJhdyBhcmc+XCI7XG52YXIgUGFzc2FibGVNZXRob2RHdWFyZCA9IE0uY2FsbCgpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKTtcbnZhciBkZWZlbmRTeW5jQXJncyA9IChzeW5jQXJncywgbWF0Y2hDb25maWcsIGxhYmVsID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBkZWNsYXJlZExlbixcbiAgICBoYXNSZXN0QXJnR3VhcmQsXG4gICAgcmVzdEFyZ0d1YXJkSXNSYXcsXG4gICAgcGFyYW1zUGF0dGVybixcbiAgICByZWRhY3RlZEluZGljZXNcbiAgfSA9IG1hdGNoQ29uZmlnO1xuICBsZXQgbWF0Y2hhYmxlQXJncyA9IHN5bmNBcmdzO1xuICBpZiAocmVzdEFyZ0d1YXJkSXNSYXcgJiYgc3luY0FyZ3MubGVuZ3RoID4gZGVjbGFyZWRMZW4pIHtcbiAgICBjb25zdCByZXN0TGVuID0gc3luY0FyZ3MubGVuZ3RoIC0gZGVjbGFyZWRMZW47XG4gICAgY29uc3QgcmVkYWN0ZWRSZXN0ID0gQXJyYXkocmVzdExlbikuZmlsbChSRURBQ1RFRF9SQVdfQVJHKTtcbiAgICBtYXRjaGFibGVBcmdzID0gWy4uLnN5bmNBcmdzLnNsaWNlKDAsIGRlY2xhcmVkTGVuKSwgLi4ucmVkYWN0ZWRSZXN0XTtcbiAgfSBlbHNlIGlmIChyZWRhY3RlZEluZGljZXMubGVuZ3RoID4gMCAmJiByZWRhY3RlZEluZGljZXNbMF0gPCBzeW5jQXJncy5sZW5ndGgpIHtcbiAgICBtYXRjaGFibGVBcmdzID0gWy4uLnN5bmNBcmdzXTtcbiAgfVxuICBmb3IgKGNvbnN0IGkzIG9mIHJlZGFjdGVkSW5kaWNlcykge1xuICAgIGlmIChpMyA+PSBtYXRjaGFibGVBcmdzLmxlbmd0aCkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIG1hdGNoYWJsZUFyZ3NbaTNdID0gUkVEQUNURURfUkFXX0FSRztcbiAgfVxuICBtdXN0TWF0Y2goaGFyZGVuKG1hdGNoYWJsZUFyZ3MpLCBwYXJhbXNQYXR0ZXJuLCBsYWJlbCk7XG4gIGlmIChoYXNSZXN0QXJnR3VhcmQpIHtcbiAgICByZXR1cm4gc3luY0FyZ3M7XG4gIH1cbiAgc3luY0FyZ3MubGVuZ3RoIDw9IGRlY2xhcmVkTGVuIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShsYWJlbCl9IGFjY2VwdHMgYXQgbW9zdCAke3F1b3RlKGRlY2xhcmVkTGVuKX0gYXJndW1lbnRzLCBub3QgJHtxdW90ZShcbiAgICBzeW5jQXJncy5sZW5ndGhcbiAgKX06ICR7c3luY0FyZ3N9YDtcbiAgcmV0dXJuIHN5bmNBcmdzO1xufTtcbnZhciBidWlsZE1hdGNoQ29uZmlnID0gKG1ldGhvZEd1YXJkUGF5bG9hZCkgPT4ge1xuICBjb25zdCB7XG4gICAgYXJnR3VhcmRzLFxuICAgIG9wdGlvbmFsQXJnR3VhcmRzID0gW10sXG4gICAgcmVzdEFyZ0d1YXJkXG4gIH0gPSBtZXRob2RHdWFyZFBheWxvYWQ7XG4gIGNvbnN0IG1hdGNoYWJsZUFyZ0d1YXJkcyA9IFsuLi5hcmdHdWFyZHMsIC4uLm9wdGlvbmFsQXJnR3VhcmRzXTtcbiAgY29uc3QgcmVkYWN0ZWRJbmRpY2VzID0gW107XG4gIGZvciAobGV0IGkzID0gMDsgaTMgPCBtYXRjaGFibGVBcmdHdWFyZHMubGVuZ3RoOyBpMyArPSAxKSB7XG4gICAgaWYgKGlzUmF3R3VhcmQobWF0Y2hhYmxlQXJnR3VhcmRzW2kzXSkpIHtcbiAgICAgIG1hdGNoYWJsZUFyZ0d1YXJkc1tpM10gPSBSRURBQ1RFRF9SQVdfQVJHO1xuICAgICAgcmVkYWN0ZWRJbmRpY2VzLnB1c2goaTMpO1xuICAgIH1cbiAgfVxuICBsZXQgbWF0Y2hhYmxlUmVzdEFyZ0d1YXJkID0gcmVzdEFyZ0d1YXJkO1xuICBpZiAoaXNSYXdHdWFyZChtYXRjaGFibGVSZXN0QXJnR3VhcmQpKSB7XG4gICAgbWF0Y2hhYmxlUmVzdEFyZ0d1YXJkID0gTS5hcnJheU9mKFJFREFDVEVEX1JBV19BUkcpO1xuICB9XG4gIGNvbnN0IG1hdGNoYWJsZU1ldGhvZEd1YXJkUGF5bG9hZCA9IGhhcmRlbih7XG4gICAgLi4ubWV0aG9kR3VhcmRQYXlsb2FkLFxuICAgIGFyZ0d1YXJkczogbWF0Y2hhYmxlQXJnR3VhcmRzLnNsaWNlKDAsIGFyZ0d1YXJkcy5sZW5ndGgpLFxuICAgIG9wdGlvbmFsQXJnR3VhcmRzOiBtYXRjaGFibGVBcmdHdWFyZHMuc2xpY2UoYXJnR3VhcmRzLmxlbmd0aCksXG4gICAgcmVzdEFyZ0d1YXJkOiBtYXRjaGFibGVSZXN0QXJnR3VhcmRcbiAgfSk7XG4gIGNvbnN0IHBhcmFtc1BhdHRlcm4gPSBNLnNwbGl0QXJyYXkoXG4gICAgbWF0Y2hhYmxlTWV0aG9kR3VhcmRQYXlsb2FkLmFyZ0d1YXJkcyxcbiAgICBtYXRjaGFibGVNZXRob2RHdWFyZFBheWxvYWQub3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgbWF0Y2hhYmxlTWV0aG9kR3VhcmRQYXlsb2FkLnJlc3RBcmdHdWFyZFxuICApO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBkZWNsYXJlZExlbjogbWF0Y2hhYmxlQXJnR3VhcmRzLmxlbmd0aCxcbiAgICBoYXNSZXN0QXJnR3VhcmQ6IHJlc3RBcmdHdWFyZCAhPT0gdm9pZCAwLFxuICAgIHJlc3RBcmdHdWFyZElzUmF3OiByZXN0QXJnR3VhcmQgIT09IG1hdGNoYWJsZVJlc3RBcmdHdWFyZCxcbiAgICBwYXJhbXNQYXR0ZXJuLFxuICAgIHJlZGFjdGVkSW5kaWNlcyxcbiAgICBtYXRjaGFibGVNZXRob2RHdWFyZFBheWxvYWRcbiAgfSk7XG59O1xudmFyIGRlZmVuZFN5bmNNZXRob2QgPSAoZ2V0Q29udGV4dCwgYmVoYXZpb3JNZXRob2QsIG1ldGhvZEd1YXJkUGF5bG9hZCwgbGFiZWwpID0+IHtcbiAgY29uc3QgeyByZXR1cm5HdWFyZCB9ID0gbWV0aG9kR3VhcmRQYXlsb2FkO1xuICBjb25zdCBpc1Jhd1JldHVybiA9IGlzUmF3R3VhcmQocmV0dXJuR3VhcmQpO1xuICBjb25zdCBtYXRjaENvbmZpZyA9IGJ1aWxkTWF0Y2hDb25maWcobWV0aG9kR3VhcmRQYXlsb2FkKTtcbiAgY29uc3QgeyBzeW5jTWV0aG9kIH0gPSB7XG4gICAgLy9cbiAgICBzeW5jTWV0aG9kKC4uLnN5bmNBcmdzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gZ2V0Q29udGV4dCh0aGlzKTtcbiAgICAgICAgY29uc3QgcmVhbEFyZ3MgPSBkZWZlbmRTeW5jQXJncyhzeW5jQXJncywgbWF0Y2hDb25maWcsIGxhYmVsKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXBwbHk1KGJlaGF2aW9yTWV0aG9kLCBjb250ZXh0LCByZWFsQXJncyk7XG4gICAgICAgIGlmICghaXNSYXdSZXR1cm4pIHtcbiAgICAgICAgICBtdXN0TWF0Y2goaGFyZGVuKHJlc3VsdCksIHJldHVybkd1YXJkLCBgJHtsYWJlbH06IHJlc3VsdGApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9IGNhdGNoICh0aHJvd25UaGluZykge1xuICAgICAgICB0aHJvdyB0b1Rocm93YWJsZSh0aHJvd25UaGluZyk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gc3luY01ldGhvZDtcbn07XG52YXIgZGVzeW5jID0gKG1ldGhvZEd1YXJkUGF5bG9hZCkgPT4ge1xuICBjb25zdCB7XG4gICAgYXJnR3VhcmRzLFxuICAgIG9wdGlvbmFsQXJnR3VhcmRzID0gW10sXG4gICAgcmVzdEFyZ0d1YXJkXG4gIH0gPSBtZXRob2RHdWFyZFBheWxvYWQ7XG4gICFpc0F3YWl0QXJnR3VhcmQocmVzdEFyZ0d1YXJkKSB8fCB0aHJvd1JlZGFjdGVkYFJlc3QgYXJncyBtYXkgbm90IGJlIGF3YWl0ZWQ6ICR7cmVzdEFyZ0d1YXJkfWA7XG4gIGNvbnN0IHJhd0FyZ0d1YXJkcyA9IFsuLi5hcmdHdWFyZHMsIC4uLm9wdGlvbmFsQXJnR3VhcmRzXTtcbiAgY29uc3QgYXdhaXRJbmRleGVzID0gW107XG4gIGZvciAobGV0IGkzID0gMDsgaTMgPCByYXdBcmdHdWFyZHMubGVuZ3RoOyBpMyArPSAxKSB7XG4gICAgY29uc3QgYXJnR3VhcmQgPSByYXdBcmdHdWFyZHNbaTNdO1xuICAgIGlmIChpc0F3YWl0QXJnR3VhcmQoYXJnR3VhcmQpKSB7XG4gICAgICByYXdBcmdHdWFyZHNbaTNdID0gZ2V0QXdhaXRBcmdHdWFyZFBheWxvYWQoYXJnR3VhcmQpLmFyZ0d1YXJkO1xuICAgICAgYXdhaXRJbmRleGVzLnB1c2goaTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4ge1xuICAgIGF3YWl0SW5kZXhlcyxcbiAgICByYXdNZXRob2RHdWFyZFBheWxvYWQ6IHtcbiAgICAgIC4uLm1ldGhvZEd1YXJkUGF5bG9hZCxcbiAgICAgIGFyZ0d1YXJkczogcmF3QXJnR3VhcmRzLnNsaWNlKDAsIGFyZ0d1YXJkcy5sZW5ndGgpLFxuICAgICAgb3B0aW9uYWxBcmdHdWFyZHM6IHJhd0FyZ0d1YXJkcy5zbGljZShhcmdHdWFyZHMubGVuZ3RoKVxuICAgIH1cbiAgfTtcbn07XG52YXIgZGVmZW5kQXN5bmNNZXRob2QgPSAoZ2V0Q29udGV4dCwgYmVoYXZpb3JNZXRob2QsIG1ldGhvZEd1YXJkUGF5bG9hZCwgbGFiZWwpID0+IHtcbiAgY29uc3QgeyByZXR1cm5HdWFyZCB9ID0gbWV0aG9kR3VhcmRQYXlsb2FkO1xuICBjb25zdCBpc1Jhd1JldHVybiA9IGlzUmF3R3VhcmQocmV0dXJuR3VhcmQpO1xuICBjb25zdCB7IGF3YWl0SW5kZXhlcywgcmF3TWV0aG9kR3VhcmRQYXlsb2FkIH0gPSBkZXN5bmMobWV0aG9kR3VhcmRQYXlsb2FkKTtcbiAgY29uc3QgbWF0Y2hDb25maWcgPSBidWlsZE1hdGNoQ29uZmlnKHJhd01ldGhvZEd1YXJkUGF5bG9hZCk7XG4gIGNvbnN0IHsgYXN5bmNNZXRob2QgfSA9IHtcbiAgICAvL1xuICAgIGFzeW5jTWV0aG9kKC4uLmFyZ3MpIHtcbiAgICAgIGNvbnN0IGF3YWl0TGlzdCA9IFtdO1xuICAgICAgZm9yIChjb25zdCBpMyBvZiBhd2FpdEluZGV4ZXMpIHtcbiAgICAgICAgaWYgKGkzID49IGFyZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXRMaXN0LnB1c2goYXJnc1tpM10pO1xuICAgICAgfVxuICAgICAgY29uc3QgcDQgPSBQcm9taXNlLmFsbChhd2FpdExpc3QpO1xuICAgICAgY29uc3Qgc3luY0FyZ3MgPSBbLi4uYXJnc107XG4gICAgICBjb25zdCByZXN1bHRQID0gRS53aGVuKFxuICAgICAgICBwNCxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIChhd2FpdGVkQXJncykgPT4ge1xuICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYXdhaXRlZEFyZ3MubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgICAgICAgIHN5bmNBcmdzW2F3YWl0SW5kZXhlc1tqXV0gPSBhd2FpdGVkQXJnc1tqXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgY29udGV4dCA9IGdldENvbnRleHQodGhpcyk7XG4gICAgICAgICAgY29uc3QgcmVhbEFyZ3MgPSBkZWZlbmRTeW5jQXJncyhzeW5jQXJncywgbWF0Y2hDb25maWcsIGxhYmVsKTtcbiAgICAgICAgICByZXR1cm4gYXBwbHk1KGJlaGF2aW9yTWV0aG9kLCBjb250ZXh0LCByZWFsQXJncyk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gRS53aGVuKHJlc3VsdFAsIChmdWxmaWxsbWVudCkgPT4ge1xuICAgICAgICBpZiAoIWlzUmF3UmV0dXJuKSB7XG4gICAgICAgICAgbXVzdE1hdGNoKGhhcmRlbihmdWxmaWxsbWVudCksIHJldHVybkd1YXJkLCBgJHtsYWJlbH06IHJlc3VsdGApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmdWxmaWxsbWVudDtcbiAgICAgIH0pLmNhdGNoKFxuICAgICAgICAocmVhc29uKSA9PiAoXG4gICAgICAgICAgLy9cbiAgICAgICAgICAvL1xuICAgICAgICAgIFByb21pc2UucmVqZWN0KHRvVGhyb3dhYmxlKHJlYXNvbikpXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfVxuICB9O1xuICByZXR1cm4gYXN5bmNNZXRob2Q7XG59O1xudmFyIGRlZmVuZE1ldGhvZCA9IChnZXRDb250ZXh0LCBiZWhhdmlvck1ldGhvZCwgbWV0aG9kR3VhcmQsIGxhYmVsKSA9PiB7XG4gIGNvbnN0IG1ldGhvZEd1YXJkUGF5bG9hZCA9IGdldE1ldGhvZEd1YXJkUGF5bG9hZChtZXRob2RHdWFyZCk7XG4gIGNvbnN0IHsgY2FsbEtpbmQgfSA9IG1ldGhvZEd1YXJkUGF5bG9hZDtcbiAgaWYgKGNhbGxLaW5kID09PSBcInN5bmNcIikge1xuICAgIHJldHVybiBkZWZlbmRTeW5jTWV0aG9kKFxuICAgICAgZ2V0Q29udGV4dCxcbiAgICAgIGJlaGF2aW9yTWV0aG9kLFxuICAgICAgbWV0aG9kR3VhcmRQYXlsb2FkLFxuICAgICAgbGFiZWxcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIGFzc2VydChjYWxsS2luZCA9PT0gXCJhc3luY1wiKTtcbiAgICByZXR1cm4gZGVmZW5kQXN5bmNNZXRob2QoXG4gICAgICBnZXRDb250ZXh0LFxuICAgICAgYmVoYXZpb3JNZXRob2QsXG4gICAgICBtZXRob2RHdWFyZFBheWxvYWQsXG4gICAgICBsYWJlbFxuICAgICk7XG4gIH1cbn07XG52YXIgYmluZE1ldGhvZCA9IChtZXRob2RUYWcsIGNvbnRleHRQcm92aWRlciwgYmVoYXZpb3JNZXRob2QsIG1ldGhvZEd1YXJkKSA9PiB7XG4gIGFzc2VydC50eXBlb2YoYmVoYXZpb3JNZXRob2QsIFwiZnVuY3Rpb25cIik7XG4gIGNvbnN0IGdldENvbnRleHQgPSAocmVwcmVzZW50YXRpdmUpID0+IHtcbiAgICByZXByZXNlbnRhdGl2ZSB8fCAvL1xuICAgIHRocm93UmVkYWN0ZWRgTWV0aG9kICR7bWV0aG9kVGFnfSBjYWxsZWQgd2l0aG91dCAndGhpcycgb2JqZWN0YDtcbiAgICBjb25zdCBjb250ZXh0ID0gY29udGV4dFByb3ZpZGVyKHJlcHJlc2VudGF0aXZlKTtcbiAgICBpZiAoY29udGV4dCA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoXG4gICAgICAgIG1ldGhvZFRhZ1xuICAgICAgKX0gbWF5IG9ubHkgYmUgYXBwbGllZCB0byBhIHZhbGlkIGluc3RhbmNlOiAke3JlcHJlc2VudGF0aXZlfWA7XG4gICAgfVxuICAgIHJldHVybiBjb250ZXh0O1xuICB9O1xuICBjb25zdCBtZXRob2QgPSBkZWZlbmRNZXRob2QoXG4gICAgZ2V0Q29udGV4dCxcbiAgICBiZWhhdmlvck1ldGhvZCxcbiAgICBtZXRob2RHdWFyZCxcbiAgICBtZXRob2RUYWdcbiAgKTtcbiAgZGVmaW5lUHJvcGVydGllczMobWV0aG9kLCB7XG4gICAgbmFtZTogeyB2YWx1ZTogbWV0aG9kVGFnIH0sXG4gICAgbGVuZ3RoOiB7IHZhbHVlOiBiZWhhdmlvck1ldGhvZC5sZW5ndGggfVxuICB9KTtcbiAgcmV0dXJuIG1ldGhvZDtcbn07XG52YXIgZGVmZW5kUHJvdG90eXBlID0gKHRhZywgY29udGV4dFByb3ZpZGVyLCBiZWhhdmlvck1ldGhvZHMsIHRoaXNmdWxNZXRob2RzID0gZmFsc2UsIGludGVyZmFjZUd1YXJkID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IHByb3RvdHlwZSA9IHt9O1xuICBjb25zdCBtZXRob2ROYW1lcyA9IGdldFJlbW90YWJsZU1ldGhvZE5hbWVzKGJlaGF2aW9yTWV0aG9kcykuZmlsdGVyKFxuICAgIC8vXG4gICAgLy9cbiAgICAoa2V5KSA9PiB7XG4gICAgICBpZiAoa2V5ICE9PSBcImNvbnN0cnVjdG9yXCIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBjb25zdCBjb25zdHJ1Y3RvciA9IGJlaGF2aW9yTWV0aG9kcy5jb25zdHJ1Y3RvcjtcbiAgICAgIHJldHVybiAhKGNvbnN0cnVjdG9yLnByb3RvdHlwZSAmJiBjb25zdHJ1Y3Rvci5wcm90b3R5cGUuY29uc3RydWN0b3IgPT09IGNvbnN0cnVjdG9yKTtcbiAgICB9XG4gICk7XG4gIGxldCBtZXRob2RHdWFyZHM7XG4gIGxldCBkZWZhdWx0R3VhcmRzO1xuICBpZiAoaW50ZXJmYWNlR3VhcmQpIHtcbiAgICBjb25zdCB7XG4gICAgICBpbnRlcmZhY2VOYW1lLFxuICAgICAgbWV0aG9kR3VhcmRzOiBtZyxcbiAgICAgIHN5bWJvbE1ldGhvZEd1YXJkcyxcbiAgICAgIHNsb3BweSxcbiAgICAgIGRlZmF1bHRHdWFyZHM6IGRnID0gc2xvcHB5ID8gXCJwYXNzYWJsZVwiIDogZGVmYXVsdEd1YXJkc1xuICAgIH0gPSBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoaW50ZXJmYWNlR3VhcmQpO1xuICAgIG1ldGhvZEd1YXJkcyA9IGhhcmRlbih7XG4gICAgICAuLi5tZyxcbiAgICAgIC4uLihzeW1ib2xNZXRob2RHdWFyZHMmJiBmcm9tRW50cmllczgoZ2V0Q29weU1hcEVudHJpZXMoc3ltYm9sTWV0aG9kR3VhcmRzKSkpXG4gICAgfSk7XG4gICAgZGVmYXVsdEd1YXJkcyA9IGRnO1xuICAgIHtcbiAgICAgIGNvbnN0IG1ldGhvZEd1YXJkTmFtZXMgPSBvd25LZXlzMTkobWV0aG9kR3VhcmRzKTtcbiAgICAgIGNvbnN0IHVuaW1wbGVtZW50ZWQgPSBsaXN0RGlmZmVyZW5jZShtZXRob2RHdWFyZE5hbWVzLCBtZXRob2ROYW1lcyk7XG4gICAgICB1bmltcGxlbWVudGVkLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZHMgJHtxdW90ZSh1bmltcGxlbWVudGVkKX0gbm90IGltcGxlbWVudGVkIGJ5ICR7cXVvdGUodGFnKX1gO1xuICAgICAgaWYgKGRlZmF1bHRHdWFyZHMgPT09IHZvaWQgMCkge1xuICAgICAgICBjb25zdCB1bmd1YXJkZWQgPSBsaXN0RGlmZmVyZW5jZShtZXRob2ROYW1lcywgbWV0aG9kR3VhcmROYW1lcyk7XG4gICAgICAgIHVuZ3VhcmRlZC5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBtZXRob2RzICR7cXVvdGUodW5ndWFyZGVkKX0gbm90IGd1YXJkZWQgYnkgJHtxdW90ZShpbnRlcmZhY2VOYW1lKX1gO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBmb3IgKGNvbnN0IHByb3Agb2YgbWV0aG9kTmFtZXMpIHtcbiAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGJlaGF2aW9yTWV0aG9kc1twcm9wXTtcbiAgICBjb25zdCB7IHNoaWZ0ZWRNZXRob2QgfSA9IHtcbiAgICAgIHNoaWZ0ZWRNZXRob2QoLi4uYXJncykge1xuICAgICAgICByZXR1cm4gb3JpZ2luYWxNZXRob2QodGhpcywgLi4uYXJncyk7XG4gICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBiZWhhdmlvck1ldGhvZCA9IHRoaXNmdWxNZXRob2RzID8gb3JpZ2luYWxNZXRob2QgOiBzaGlmdGVkTWV0aG9kO1xuICAgIGxldCBtZXRob2RHdWFyZCA9IG1ldGhvZEd1YXJkcyAmJiBtZXRob2RHdWFyZHNbcHJvcF07XG4gICAgaWYgKCFtZXRob2RHdWFyZCkge1xuICAgICAgc3dpdGNoIChkZWZhdWx0R3VhcmRzKSB7XG4gICAgICAgIGNhc2Ugdm9pZCAwOiB7XG4gICAgICAgICAgaWYgKHRoaXNmdWxNZXRob2RzKSB7XG4gICAgICAgICAgICBtZXRob2RHdWFyZCA9IFBhc3NhYmxlTWV0aG9kR3VhcmQ7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1ldGhvZEd1YXJkID0gUmF3TWV0aG9kR3VhcmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJwYXNzYWJsZVwiOiB7XG4gICAgICAgICAgbWV0aG9kR3VhcmQgPSBQYXNzYWJsZU1ldGhvZEd1YXJkO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJyYXdcIjoge1xuICAgICAgICAgIG1ldGhvZEd1YXJkID0gUmF3TWV0aG9kR3VhcmQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIGRlZmF1bHRHdWFyZHMgJHtxdW90ZShkZWZhdWx0R3VhcmRzKX1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHByb3RvdHlwZVtwcm9wXSA9IGJpbmRNZXRob2QoXG4gICAgICBgSW4gJHtxdW90ZShwcm9wKX0gbWV0aG9kIG9mICgke3RhZ30pYCxcbiAgICAgIGNvbnRleHRQcm92aWRlcixcbiAgICAgIGJlaGF2aW9yTWV0aG9kLFxuICAgICAgbWV0aG9kR3VhcmRcbiAgICApO1xuICB9XG4gIGlmICghaGFzT3duMTAocHJvdG90eXBlLCBHRVRfSU5URVJGQUNFX0dVQVJEKSkge1xuICAgIGNvbnN0IGdldEludGVyZmFjZUd1YXJkTWV0aG9kID0ge1xuICAgICAgW0dFVF9JTlRFUkZBQ0VfR1VBUkRdKCkge1xuICAgICAgICByZXR1cm4gaW50ZXJmYWNlR3VhcmQ7XG4gICAgICB9XG4gICAgfVtHRVRfSU5URVJGQUNFX0dVQVJEXTtcbiAgICBwcm90b3R5cGVbR0VUX0lOVEVSRkFDRV9HVUFSRF0gPSBiaW5kTWV0aG9kKFxuICAgICAgYEluICR7cXVvdGUoR0VUX0lOVEVSRkFDRV9HVUFSRCl9IG1ldGhvZCBvZiAoJHt0YWd9KWAsXG4gICAgICBjb250ZXh0UHJvdmlkZXIsXG4gICAgICBnZXRJbnRlcmZhY2VHdWFyZE1ldGhvZCxcbiAgICAgIFBhc3NhYmxlTWV0aG9kR3VhcmRcbiAgICApO1xuICB9XG4gIHJldHVybiBGYXIoXG4gICAgdGFnLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHByb3RvdHlwZVxuICApO1xufTtcbmhhcmRlbihkZWZlbmRQcm90b3R5cGUpO1xudmFyIGRlZmVuZFByb3RvdHlwZUtpdCA9ICh0YWcsIGNvbnRleHRQcm92aWRlcktpdCwgYmVoYXZpb3JNZXRob2RzS2l0LCB0aGlzZnVsTWV0aG9kcyA9IGZhbHNlLCBpbnRlcmZhY2VHdWFyZEtpdCA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCBmYWNldE5hbWVzID0gb3duS2V5czE5KGJlaGF2aW9yTWV0aG9kc0tpdCkuc29ydCgpO1xuICBmYWNldE5hbWVzLmxlbmd0aCA+IDEgfHwgdGhyb3dSZWRhY3RlZGBBIG11bHRpLWZhY2V0IG9iamVjdCBtdXN0IGhhdmUgbXVsdGlwbGUgZmFjZXRzYDtcbiAgaWYgKGludGVyZmFjZUd1YXJkS2l0KSB7XG4gICAgY29uc3QgaW50ZXJmYWNlTmFtZXMgPSBvd25LZXlzMTkoaW50ZXJmYWNlR3VhcmRLaXQpO1xuICAgIGNvbnN0IGV4dHJhSW50ZXJmYWNlTmFtZXMgPSBsaXN0RGlmZmVyZW5jZShmYWNldE5hbWVzLCBpbnRlcmZhY2VOYW1lcyk7XG4gICAgZXh0cmFJbnRlcmZhY2VOYW1lcy5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcmZhY2VzICR7cXVvdGUoZXh0cmFJbnRlcmZhY2VOYW1lcyl9IG5vdCBpbXBsZW1lbnRlZCBieSAke3F1b3RlKHRhZyl9YDtcbiAgICBjb25zdCBleHRyYUZhY2V0TmFtZXMyID0gbGlzdERpZmZlcmVuY2UoaW50ZXJmYWNlTmFtZXMsIGZhY2V0TmFtZXMpO1xuICAgIGV4dHJhRmFjZXROYW1lczIubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgRmFjZXRzICR7cXVvdGUoZXh0cmFGYWNldE5hbWVzMil9IG9mICR7cXVvdGUodGFnKX0gbm90IGd1YXJkZWQgYnkgaW50ZXJmYWNlc2A7XG4gIH1cbiAgY29uc3QgY29udGV4dE1hcE5hbWVzID0gb3duS2V5czE5KGNvbnRleHRQcm92aWRlcktpdCk7XG4gIGNvbnN0IGV4dHJhQ29udGV4dE5hbWVzID0gbGlzdERpZmZlcmVuY2UoZmFjZXROYW1lcywgY29udGV4dE1hcE5hbWVzKTtcbiAgZXh0cmFDb250ZXh0TmFtZXMubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgQ29udGV4dHMgJHtxdW90ZShleHRyYUNvbnRleHROYW1lcyl9IG5vdCBpbXBsZW1lbnRlZCBieSAke3F1b3RlKHRhZyl9YDtcbiAgY29uc3QgZXh0cmFGYWNldE5hbWVzID0gbGlzdERpZmZlcmVuY2UoY29udGV4dE1hcE5hbWVzLCBmYWNldE5hbWVzKTtcbiAgZXh0cmFGYWNldE5hbWVzLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYEZhY2V0cyAke3F1b3RlKGV4dHJhRmFjZXROYW1lcyl9IG9mICR7cXVvdGUodGFnKX0gbWlzc2luZyBjb250ZXh0c2A7XG4gIGNvbnN0IHByb3RvS2l0ID0gb2JqZWN0TWFwKFxuICAgIGJlaGF2aW9yTWV0aG9kc0tpdCxcbiAgICAoYmVoYXZpb3JNZXRob2RzLCBmYWNldE5hbWUpID0+IGRlZmVuZFByb3RvdHlwZShcbiAgICAgIGAke3RhZ30gJHtTdHJpbmcoZmFjZXROYW1lKX1gLFxuICAgICAgY29udGV4dFByb3ZpZGVyS2l0W2ZhY2V0TmFtZV0sXG4gICAgICBiZWhhdmlvck1ldGhvZHMsXG4gICAgICB0aGlzZnVsTWV0aG9kcyxcbiAgICAgIGludGVyZmFjZUd1YXJkS2l0ICYmIGludGVyZmFjZUd1YXJkS2l0W2ZhY2V0TmFtZV1cbiAgICApXG4gICk7XG4gIHJldHVybiBwcm90b0tpdDtcbn07XG5cbi8vXG52YXIgeyBjcmVhdGU6IGNyZWF0ZTMsIHNlYWwsIGZyZWV6ZTogZnJlZXplNywgZGVmaW5lUHJvcGVydHk6IGRlZmluZVByb3BlcnR5MiwgdmFsdWVzOiB2YWx1ZXMzIH0gPSBPYmplY3Q7XG52YXIgTEFCRUxfSU5TVEFOQ0VTID0gZW52aXJvbm1lbnRPcHRpb25zTGlzdEhhcyhcIkRFQlVHXCIsIFwibGFiZWwtaW5zdGFuY2VzXCIpO1xudmFyIG1ha2VTZWxmID0gKHByb3RvLCBpbnN0YW5jZUNvdW50KSA9PiB7XG4gIGNvbnN0IHNlbGYgPSBjcmVhdGUzKHByb3RvKTtcbiAgaWYgKExBQkVMX0lOU1RBTkNFUykge1xuICAgIGRlZmluZVByb3BlcnR5MihzZWxmLCBTeW1ib2wudG9TdHJpbmdUYWcsIHtcbiAgICAgIHZhbHVlOiBgJHtwcm90b1tTeW1ib2wudG9TdHJpbmdUYWddfSMke2luc3RhbmNlQ291bnR9YCxcbiAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgY29uZmlndXJhYmxlOiBmYWxzZVxuICAgIH0pO1xuICB9XG4gIHJldHVybiBoYXJkZW4oc2VsZik7XG59O1xudmFyIGVtcHR5UmVjb3JkID0gaGFyZGVuKHt9KTtcbnZhciBpbml0RW1wdHkgPSAoKSA9PiBlbXB0eVJlY29yZDtcbnZhciBkZWZpbmVFeG9DbGFzcyA9ICh0YWcsIGludGVyZmFjZUd1YXJkLCBpbml0LCBtZXRob2RzLCBvcHRpb25zID0ge30pID0+IHtcbiAgaGFyZGVuKG1ldGhvZHMpO1xuICBjb25zdCB7XG4gICAgZmluaXNoID0gdm9pZCAwLFxuICAgIHJlY2VpdmVBbXBsaWZpZXIgPSB2b2lkIDAsXG4gICAgcmVjZWl2ZUluc3RhbmNlVGVzdGVyID0gdm9pZCAwXG4gIH0gPSBvcHRpb25zO1xuICByZWNlaXZlQW1wbGlmaWVyID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBPbmx5IGZhY2V0cyBvZiBhbiBleG8gY2xhc3Mga2l0IGNhbiBiZSBhbXBsaWZpZWQgJHtxdW90ZSh0YWcpfWA7XG4gIGNvbnN0IGNvbnRleHRNYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgcHJvdG8gPSBkZWZlbmRQcm90b3R5cGUoXG4gICAgdGFnLFxuICAgIChzZWxmKSA9PiAoXG4gICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgIGNvbnRleHRNYXAuZ2V0KHNlbGYpXG4gICAgKSxcbiAgICBtZXRob2RzLFxuICAgIHRydWUsXG4gICAgaW50ZXJmYWNlR3VhcmRcbiAgKTtcbiAgbGV0IGluc3RhbmNlQ291bnQgPSAwO1xuICBjb25zdCBtYWtlSW5zdGFuY2UgPSAoLi4uYXJncykgPT4ge1xuICAgIGNvbnN0IHN0YXRlID0gc2VhbChpbml0KC4uLmFyZ3MpKTtcbiAgICBpbnN0YW5jZUNvdW50ICs9IDE7XG4gICAgY29uc3Qgc2VsZiA9IG1ha2VTZWxmKHByb3RvLCBpbnN0YW5jZUNvdW50KTtcbiAgICBjb25zdCBjb250ZXh0ID0gZnJlZXplNyh7IHN0YXRlLCBzZWxmIH0pO1xuICAgIGNvbnRleHRNYXAuc2V0KHNlbGYsIGNvbnRleHQpO1xuICAgIGlmIChmaW5pc2gpIHtcbiAgICAgIGZpbmlzaChjb250ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIHNlbGY7XG4gIH07XG4gIGlmIChyZWNlaXZlSW5zdGFuY2VUZXN0ZXIpIHtcbiAgICBjb25zdCBpc0luc3RhbmNlID0gKGV4bywgZmFjZXROYW1lID0gdm9pZCAwKSA9PiB7XG4gICAgICBmYWNldE5hbWUgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYGZhY2V0TmFtZSBjYW4gb25seSBiZSB1c2VkIHdpdGggYW4gZXhvIGNsYXNzIGtpdDogJHtxdW90ZShcbiAgICAgICAgdGFnXG4gICAgICApfSBoYXMgbm8gZmFjZXQgJHtxdW90ZShmYWNldE5hbWUpfWA7XG4gICAgICByZXR1cm4gY29udGV4dE1hcC5oYXMoZXhvKTtcbiAgICB9O1xuICAgIGhhcmRlbihpc0luc3RhbmNlKTtcbiAgICByZWNlaXZlSW5zdGFuY2VUZXN0ZXIoaXNJbnN0YW5jZSk7XG4gIH1cbiAgcmV0dXJuIGhhcmRlbihtYWtlSW5zdGFuY2UpO1xufTtcbmhhcmRlbihkZWZpbmVFeG9DbGFzcyk7XG52YXIgZGVmaW5lRXhvQ2xhc3NLaXQgPSAodGFnLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgbWV0aG9kc0tpdCwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGhhcmRlbihtZXRob2RzS2l0KTtcbiAgY29uc3Qge1xuICAgIGZpbmlzaCA9IHZvaWQgMCxcbiAgICByZWNlaXZlQW1wbGlmaWVyID0gdm9pZCAwLFxuICAgIHJlY2VpdmVJbnN0YW5jZVRlc3RlciA9IHZvaWQgMFxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgY29udGV4dE1hcEtpdCA9IG9iamVjdE1hcChtZXRob2RzS2l0LCAoKSA9PiAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKSk7XG4gIGNvbnN0IGdldENvbnRleHRLaXQgPSBvYmplY3RNYXAoXG4gICAgY29udGV4dE1hcEtpdCxcbiAgICAoY29udGV4dE1hcCkgPT4gKGZhY2V0KSA9PiBjb250ZXh0TWFwLmdldChmYWNldClcbiAgKTtcbiAgY29uc3QgcHJvdG90eXBlS2l0ID0gZGVmZW5kUHJvdG90eXBlS2l0KFxuICAgIHRhZyxcbiAgICBnZXRDb250ZXh0S2l0LFxuICAgIG1ldGhvZHNLaXQsXG4gICAgdHJ1ZSxcbiAgICBpbnRlcmZhY2VHdWFyZEtpdFxuICApO1xuICBsZXQgaW5zdGFuY2VDb3VudCA9IDA7XG4gIGNvbnN0IG1ha2VJbnN0YW5jZUtpdCA9ICguLi5hcmdzKSA9PiB7XG4gICAgY29uc3Qgc3RhdGUgPSBzZWFsKGluaXQoLi4uYXJncykpO1xuICAgIGNvbnN0IGNvbnRleHQgPSB7IHN0YXRlLCBmYWNldHM6IG51bGwgfTtcbiAgICBpbnN0YW5jZUNvdW50ICs9IDE7XG4gICAgY29uc3QgZmFjZXRzID0gb2JqZWN0TWFwKHByb3RvdHlwZUtpdCwgKHByb3RvLCBmYWNldE5hbWUpID0+IHtcbiAgICAgIGNvbnN0IHNlbGYgPSBtYWtlU2VsZihwcm90bywgaW5zdGFuY2VDb3VudCk7XG4gICAgICBjb250ZXh0TWFwS2l0W2ZhY2V0TmFtZV0uc2V0KHNlbGYsIGNvbnRleHQpO1xuICAgICAgcmV0dXJuIHNlbGY7XG4gICAgfSk7XG4gICAgY29udGV4dC5mYWNldHMgPSBmYWNldHM7XG4gICAgZnJlZXplNyhjb250ZXh0KTtcbiAgICBpZiAoZmluaXNoKSB7XG4gICAgICBmaW5pc2goY29udGV4dCk7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBjb250ZXh0LmZhY2V0c1xuICAgICk7XG4gIH07XG4gIGlmIChyZWNlaXZlQW1wbGlmaWVyKSB7XG4gICAgY29uc3QgYW1wbGlmeSA9IChleG9GYWNldCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBjb250ZXh0TWFwIG9mIHZhbHVlczMoY29udGV4dE1hcEtpdCkpIHtcbiAgICAgICAgaWYgKGNvbnRleHRNYXAuaGFzKGV4b0ZhY2V0KSkge1xuICAgICAgICAgIGNvbnN0IHsgZmFjZXRzIH0gPSBjb250ZXh0TWFwLmdldChleG9GYWNldCk7XG4gICAgICAgICAgcmV0dXJuIGZhY2V0cztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBNdXN0IGJlIGEgZmFjZXQgb2YgJHtxdW90ZSh0YWcpfTogJHtleG9GYWNldH1gO1xuICAgIH07XG4gICAgaGFyZGVuKGFtcGxpZnkpO1xuICAgIHJlY2VpdmVBbXBsaWZpZXIoYW1wbGlmeSk7XG4gIH1cbiAgaWYgKHJlY2VpdmVJbnN0YW5jZVRlc3Rlcikge1xuICAgIGNvbnN0IGlzSW5zdGFuY2UgPSAoZXhvRmFjZXQsIGZhY2V0TmFtZSA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKGZhY2V0TmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZXMzKGNvbnRleHRNYXBLaXQpLnNvbWUoXG4gICAgICAgICAgKGNvbnRleHRNYXAyKSA9PiBjb250ZXh0TWFwMi5oYXMoZXhvRmFjZXQpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBhc3NlcnQudHlwZW9mKGZhY2V0TmFtZSwgXCJzdHJpbmdcIik7XG4gICAgICBjb25zdCBjb250ZXh0TWFwID0gY29udGV4dE1hcEtpdFtmYWNldE5hbWVdO1xuICAgICAgY29udGV4dE1hcCAhPT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgZXhvIGNsYXNzIGtpdCAke3F1b3RlKHRhZyl9IGhhcyBubyBmYWNldCBuYW1lZCAke3F1b3RlKGZhY2V0TmFtZSl9YDtcbiAgICAgIHJldHVybiBjb250ZXh0TWFwLmhhcyhleG9GYWNldCk7XG4gICAgfTtcbiAgICBoYXJkZW4oaXNJbnN0YW5jZSk7XG4gICAgcmVjZWl2ZUluc3RhbmNlVGVzdGVyKGlzSW5zdGFuY2UpO1xuICB9XG4gIHJldHVybiBoYXJkZW4obWFrZUluc3RhbmNlS2l0KTtcbn07XG5oYXJkZW4oZGVmaW5lRXhvQ2xhc3NLaXQpO1xudmFyIG1ha2VFeG8gPSAodGFnLCBpbnRlcmZhY2VHdWFyZCwgbWV0aG9kcywgb3B0aW9ucyA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCBtYWtlSW5zdGFuY2UgPSBkZWZpbmVFeG9DbGFzcyhcbiAgICB0YWcsXG4gICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgaW5pdEVtcHR5LFxuICAgIG1ldGhvZHMsXG4gICAgb3B0aW9uc1xuICApO1xuICByZXR1cm4gbWFrZUluc3RhbmNlKCk7XG59O1xuaGFyZGVuKG1ha2VFeG8pO1xuXG4vL1xudmFyIG1ha2VXZWFrU2V0U3RvcmVNZXRob2RzID0gKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiBqc3NldC5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoa2V5TmFtZSl9IG5vdCBmb3VuZDogJHtrZXl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgaGFzOiAoa2V5KSA9PiB7XG4gICAgICByZXR1cm4ganNzZXQuaGFzKGtleSk7XG4gICAgfSxcbiAgICBhZGQ6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleU9rVG9BZGQoa2V5KTtcbiAgICAgIGpzc2V0LmFkZChrZXkpO1xuICAgIH0sXG4gICAgZGVsZXRlOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIGlmIChhc3NlcnRLZXlPa1RvRGVsZXRlICE9PSB2b2lkIDApIHtcbiAgICAgICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgICAganNzZXQuZGVsZXRlKGtleSk7XG4gICAgfSxcbiAgICBhZGRBbGw6IChrZXlzOCkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBrZXlzOFtTeW1ib2wuaXRlcmF0b3JdICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgaWYgKE9iamVjdC5pc0Zyb3plbihrZXlzOCkgJiYgaXNDb3B5U2V0KGtleXM4KSkge1xuICAgICAgICAgIGtleXM4ID0gZ2V0Q29weVNldEtleXMoa2V5czgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93UmVkYWN0ZWRgcHJvdmlkZWQgZGF0YSBzb3VyY2UgaXMgbm90IGl0ZXJhYmxlOiAke2tleXM4fWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoXG4gICAgICAgIGNvbnN0IGtleSBvZlxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBrZXlzOFxuICAgICAgKSB7XG4gICAgICAgIGFzc2VydEtleU9rVG9BZGQoa2V5KTtcbiAgICAgICAganNzZXQuYWRkKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhcldlYWtTZXRTdG9yZSA9ICh0YWcgPSBcImtleVwiLCB7IGxvbmdMaXZlZCA9IHRydWUsIGtleVNoYXBlID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBqc3NldCA9IG5ldyAobG9uZ0xpdmVkID8gV2Vha1NldCA6IFNldCkoKTtcbiAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGtleVNoYXBlKTtcbiAgfVxuICBjb25zdCBhc3NlcnRLZXlPa1RvQWRkID0gKGtleSkgPT4ge1xuICAgIGhhcmRlbihrZXkpO1xuICAgIHBhc3NTdHlsZU9mKGtleSkgPT09IFwicmVtb3RhYmxlXCIgfHwgdGhyb3dSZWRhY3RlZGBPbmx5IHJlbW90YWJsZXMgY2FuIGJlIGtleXMgb2Ygc2NhbGFyIFdlYWtTdG9yZXM6ICR7a2V5fWA7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcIndlYWtTZXRTdG9yZSBrZXlcIik7XG4gICAgfVxuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgV2Vha1NldFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZVdlYWtTZXRTdG9yZU1ldGhvZHMoanNzZXQsIGFzc2VydEtleU9rVG9BZGQsIHZvaWQgMCwgdGFnKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVNjYWxhcldlYWtTZXRTdG9yZSk7XG5cbi8vXG52YXIgbWFrZUN1cnJlbnRLZXlzS2l0ID0gKGdldFJhd0tleXMsIGNoZWNrSGFzLCBjb21wYXJlLCBhc3NlcnRPa1RvQWRkLCBhc3NlcnRPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBsZXQgdXBkYXRlQ291bnQgPSAwO1xuICBsZXQgc29ydGVkS2V5c01lbW87XG4gIGNvbnN0IGFzc2VydFVwZGF0ZU9uQWRkID0gKGssIHYyID0gdm9pZCAwKSA9PiB7XG4gICAgYXNzZXJ0T2tUb0FkZChrLCB2Mik7XG4gICAgdXBkYXRlQ291bnQgKz0gMTtcbiAgICBzb3J0ZWRLZXlzTWVtbyA9IHZvaWQgMDtcbiAgfTtcbiAgY29uc3QgYXNzZXJ0VXBkYXRlT25EZWxldGUgPSAoaykgPT4gYXNzZXJ0T2tUb0RlbGV0ZSAmJiBhc3NlcnRPa1RvRGVsZXRlKGspO1xuICBjb25zdCBnZXRTb3J0ZWRLZXlzID0gKCkgPT4ge1xuICAgIGlmIChzb3J0ZWRLZXlzTWVtbyA9PT0gdm9pZCAwKSB7XG4gICAgICBzb3J0ZWRLZXlzTWVtbyA9IGhhcmRlbihbLi4uZ2V0UmF3S2V5cygpXS5zb3J0KGNvbXBhcmUpKTtcbiAgICB9XG4gICAgcmV0dXJuIHNvcnRlZEtleXNNZW1vO1xuICB9O1xuICBjb25zdCBpdGVyYWJsZUtleXMgPSBGYXIoXCJJdGVyYWJsZSBvZiBrZXlzXCIsIHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgY29uc3QgZ2VuZXJhdGlvbiA9IHVwZGF0ZUNvdW50O1xuICAgICAgZ2V0U29ydGVkS2V5cygpO1xuICAgICAgY29uc3QgbGVuID0gc29ydGVkS2V5c01lbW8ubGVuZ3RoO1xuICAgICAgbGV0IGkzID0gMDtcbiAgICAgIHJldHVybiBGYXIoXCJJdGVyYXRvciBvZiBrZXlzXCIsIHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGdlbmVyYXRpb24gPT09IHVwZGF0ZUNvdW50IHx8IHRocm93UmVkYWN0ZWRgU3RvcmUgJHtxdW90ZShrZXlOYW1lKX0gY3Vyc29yIHN0YWxlYDtcbiAgICAgICAgICBmb3IgKDsgOyApIHtcbiAgICAgICAgICAgIGlmIChpMyA8IGxlbikge1xuICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHNvcnRlZEtleXNNZW1vW2kzXTtcbiAgICAgICAgICAgICAgaTMgKz0gMTtcbiAgICAgICAgICAgICAgaWYgKGNoZWNrSGFzKHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWUgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogdm9pZCAwIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgYXNzZXJ0VXBkYXRlT25BZGQsXG4gICAgYXNzZXJ0VXBkYXRlT25EZWxldGUsXG4gICAgaXRlcmFibGVLZXlzXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlQ3VycmVudEtleXNLaXQpO1xudmFyIHByb3ZpZGVMYXp5ID0gKG1hcFN0b3JlLCBrZXksIG1ha2VWYWx1ZSkgPT4ge1xuICBpZiAoIW1hcFN0b3JlLmhhcyhrZXkpKSB7XG4gICAgbWFwU3RvcmUuaW5pdChrZXksIG1ha2VWYWx1ZShrZXkpKTtcbiAgfVxuICByZXR1cm4gbWFwU3RvcmUuZ2V0KGtleSk7XG59O1xuaGFyZGVuKHByb3ZpZGVMYXp5KTtcbnZhciBtYWtlQXRvbWljUHJvdmlkZXIgPSAoc3RvcmUpID0+IHtcbiAgY29uc3QgcGVuZGluZyA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGNvbnN0IHByb3ZpZGVBc3luYyA9IChrZXksIG1ha2VWYWx1ZSwgZmluaXNoVmFsdWUpID0+IHtcbiAgICBpZiAoc3RvcmUuaGFzKGtleSkpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoc3RvcmUuZ2V0KGtleSkpO1xuICAgIH1cbiAgICBpZiAoIXBlbmRpbmcuaGFzKGtleSkpIHtcbiAgICAgIGNvbnN0IHZhbFAyID0gbWFrZVZhbHVlKGtleSkudGhlbigodjIpID0+IHtcbiAgICAgICAgc3RvcmUuaW5pdChrZXksIHYyKTtcbiAgICAgICAgcmV0dXJuIHYyO1xuICAgICAgfSkudGhlbigodjIpID0+IHtcbiAgICAgICAgaWYgKGZpbmlzaFZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIGZpbmlzaFZhbHVlKGtleSwgdjIpLnRoZW4oKCkgPT4gdjIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB2MjtcbiAgICAgIH0pLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICBwZW5kaW5nLmRlbGV0ZShrZXkpO1xuICAgICAgfSk7XG4gICAgICBwZW5kaW5nLnNldChrZXksIHZhbFAyKTtcbiAgICB9XG4gICAgY29uc3QgdmFsUCA9IHBlbmRpbmcuZ2V0KGtleSk7XG4gICAgYXNzZXJ0KHZhbFApO1xuICAgIHJldHVybiB2YWxQO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHsgcHJvdmlkZUFzeW5jIH0pO1xufTtcbmhhcmRlbihtYWtlQXRvbWljUHJvdmlkZXIpO1xudmFyIGFwcGVuZFRvU3RvcmVkQXJyYXkgPSAobWFwU3RvcmUsIGtleSwgaXRlbSkgPT4ge1xuICBpZiAobWFwU3RvcmUuaGFzKGtleSkpIHtcbiAgICBjb25zdCBleHRhbnQgPSBtYXBTdG9yZS5nZXQoa2V5KTtcbiAgICBtYXBTdG9yZS5zZXQoa2V5LCBoYXJkZW4oWy4uLmV4dGFudCwgaXRlbV0pKTtcbiAgfSBlbHNlIHtcbiAgICBtYXBTdG9yZS5pbml0KGtleSwgaGFyZGVuKFtpdGVtXSkpO1xuICB9XG59O1xuaGFyZGVuKGFwcGVuZFRvU3RvcmVkQXJyYXkpO1xuXG4vL1xudmFyIG1ha2VTZXRTdG9yZU1ldGhvZHMgPSAoanNzZXQsIGFzc2VydEtleU9rVG9BZGQsIGFzc2VydEtleU9rVG9EZWxldGUgPSB2b2lkIDAsIGtleU5hbWUgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IHsgYXNzZXJ0VXBkYXRlT25BZGQsIGFzc2VydFVwZGF0ZU9uRGVsZXRlLCBpdGVyYWJsZUtleXMgfSA9IG1ha2VDdXJyZW50S2V5c0tpdChcbiAgICAoKSA9PiBqc3NldC5rZXlzKCksXG4gICAgKGspID0+IGpzc2V0LmhhcyhrKSxcbiAgICBjb21wYXJlUmFuayxcbiAgICBhc3NlcnRLZXlPa1RvQWRkLFxuICAgIGFzc2VydEtleU9rVG9EZWxldGUsXG4gICAga2V5TmFtZVxuICApO1xuICBjb25zdCBrZXlzOCA9IChrZXlQYXR0ID0gdm9pZCAwKSA9PiBrZXlQYXR0ID09PSB2b2lkIDAgPyBpdGVyYWJsZUtleXMgOiBmaWx0ZXJJdGVyYWJsZShpdGVyYWJsZUtleXMsIChrKSA9PiBtYXRjaGVzKGssIGtleVBhdHQpKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgLi4ubWFrZVdlYWtTZXRTdG9yZU1ldGhvZHMoXG4gICAgICBqc3NldCxcbiAgICAgIGFzc2VydFVwZGF0ZU9uQWRkLFxuICAgICAgYXNzZXJ0VXBkYXRlT25EZWxldGUsXG4gICAgICBrZXlOYW1lXG4gICAgKSxcbiAgICBrZXlzOiBrZXlzOCxcbiAgICB2YWx1ZXM6IGtleXM4LFxuICAgIHNuYXBzaG90OiAoa2V5UGF0dCA9IHZvaWQgMCkgPT4gbWFrZUNvcHlTZXQoa2V5czgoa2V5UGF0dCkpLFxuICAgIGdldFNpemU6IChrZXlQYXR0ID0gdm9pZCAwKSA9PiBrZXlQYXR0ID09PSB2b2lkIDAgPyBqc3NldC5zaXplIDogWy4uLmtleXM4KGtleVBhdHQpXS5sZW5ndGgsXG4gICAgY2xlYXI6IChrZXlQYXR0ID0gdm9pZCAwKSA9PiB7XG4gICAgICBpZiAoa2V5UGF0dCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGpzc2V0LmNsZWFyKCk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzOChrZXlQYXR0KSkge1xuICAgICAgICBqc3NldC5kZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBtYWtlU2NhbGFyU2V0U3RvcmUgPSAodGFnID0gXCJrZXlcIiwgeyBrZXlTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNzZXQgPSAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oa2V5U2hhcGUpO1xuICB9XG4gIGNvbnN0IGFzc2VydEtleU9rVG9BZGQgPSAoa2V5KSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgYXNzZXJ0U2NhbGFyS2V5KGtleSk7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcInNldFN0b3JlIGtleVwiKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBGYXIoYHNjYWxhciBTZXRTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VTZXRTdG9yZU1ldGhvZHMoanNzZXQsIGFzc2VydEtleU9rVG9BZGQsIHZvaWQgMCwgdGFnKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVNjYWxhclNldFN0b3JlKTtcblxuLy9cbnZhciBtYWtlV2Vha01hcFN0b3JlTWV0aG9kcyA9IChqc21hcCwgYXNzZXJ0S1ZPa1RvQWRkLCBhc3NlcnRLVk9rVG9TZXQsIGFzc2VydEtleU9rVG9EZWxldGUgPSB2b2lkIDAsIGtleU5hbWUgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IGFzc2VydEtleURvZXNOb3RFeGlzdCA9IChrZXkpID0+ICFqc21hcC5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoa2V5TmFtZSl9IGFscmVhZHkgcmVnaXN0ZXJlZDogJHtrZXl9YDtcbiAgY29uc3QgYXNzZXJ0S2V5RXhpc3RzID0gKGtleSkgPT4ganNtYXAuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGtleU5hbWUpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIGpzbWFwLmhhcyhrZXkpO1xuICAgIH0sXG4gICAgZ2V0OiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgICAganNtYXAuZ2V0KGtleSlcbiAgICAgICk7XG4gICAgfSxcbiAgICBpbml0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RG9lc05vdEV4aXN0KGtleSk7XG4gICAgICBhc3NlcnRLVk9rVG9BZGQoa2V5LCB2YWx1ZSk7XG4gICAgICBqc21hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBzZXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIGFzc2VydEtWT2tUb1NldChrZXksIHZhbHVlKTtcbiAgICAgIGpzbWFwLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBpZiAoYXNzZXJ0S2V5T2tUb0RlbGV0ZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgIGFzc2VydEtleU9rVG9EZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICAgIGpzbWFwLmRlbGV0ZShrZXkpO1xuICAgIH0sXG4gICAgYWRkQWxsOiAoZW50cmllczEwKSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGVudHJpZXMxMFtTeW1ib2wuaXRlcmF0b3JdICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgaWYgKE9iamVjdC5pc0Zyb3plbihlbnRyaWVzMTApICYmIGlzQ29weU1hcChlbnRyaWVzMTApKSB7XG4gICAgICAgICAgZW50cmllczEwID0gZ2V0Q29weU1hcEVudHJpZXMoZW50cmllczEwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvd1JlZGFjdGVkYHByb3ZpZGVkIGRhdGEgc291cmNlIGlzIG5vdCBpdGVyYWJsZTogJHtlbnRyaWVzMTB9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChcbiAgICAgICAgY29uc3QgW2tleSwgdmFsdWVdIG9mXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZW50cmllczEwXG4gICAgICApIHtcbiAgICAgICAgYXNzZXJ0S1ZPa1RvQWRkKGtleSwgdmFsdWUpO1xuICAgICAgICBqc21hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhcldlYWtNYXBTdG9yZSA9ICh0YWcgPSBcImtleVwiLCB7IGxvbmdMaXZlZCA9IHRydWUsIGtleVNoYXBlID0gdm9pZCAwLCB2YWx1ZVNoYXBlID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBqc21hcCA9IG5ldyAobG9uZ0xpdmVkID8gV2Vha01hcCA6IE1hcCkoKTtcbiAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGtleVNoYXBlKTtcbiAgfVxuICBpZiAodmFsdWVTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybih2YWx1ZVNoYXBlKTtcbiAgfVxuICBjb25zdCBhc3NlcnRLVk9rVG9TZXQgPSAoX2tleSwgdmFsdWUpID0+IHtcbiAgICBoYXJkZW4odmFsdWUpO1xuICAgIGFzc2VydFBhc3NhYmxlKHZhbHVlKTtcbiAgICBpZiAodmFsdWVTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2godmFsdWUsIHZhbHVlU2hhcGUsIFwid2Vha01hcFN0b3JlIHZhbHVlXCIpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgYXNzZXJ0S1ZPa1RvQWRkID0gKGtleSwgdmFsdWUpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBwYXNzU3R5bGVPZihrZXkpID09PSBcInJlbW90YWJsZVwiIHx8IHRocm93UmVkYWN0ZWRgT25seSByZW1vdGFibGVzIGNhbiBiZSBrZXlzIG9mIHNjYWxhciBXZWFrTWFwU3RvcmVzOiAke2tleX1gO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJ3ZWFrTWFwU3RvcmUga2V5XCIpO1xuICAgIH1cbiAgICBhc3NlcnRLVk9rVG9TZXQoa2V5LCB2YWx1ZSk7XG4gIH07XG4gIHJldHVybiBGYXIoYHNjYWxhciBXZWFrTWFwU3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlV2Vha01hcFN0b3JlTWV0aG9kcyhcbiAgICAgIGpzbWFwLFxuICAgICAgYXNzZXJ0S1ZPa1RvQWRkLFxuICAgICAgYXNzZXJ0S1ZPa1RvU2V0LFxuICAgICAgdm9pZCAwLFxuICAgICAgdGFnXG4gICAgKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVNjYWxhcldlYWtNYXBTdG9yZSk7XG5cbi8vXG52YXIgbWFrZU1hcFN0b3JlTWV0aG9kcyA9IChqc21hcCwgYXNzZXJ0S1ZPa1RvQWRkLCBhc3NlcnRLVk9rVG9TZXQsIGFzc2VydEtleU9rVG9EZWxldGUgPSB2b2lkIDAsIHRhZyA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgeyBhc3NlcnRVcGRhdGVPbkFkZCwgYXNzZXJ0VXBkYXRlT25EZWxldGUsIGl0ZXJhYmxlS2V5cyB9ID0gbWFrZUN1cnJlbnRLZXlzS2l0KFxuICAgICgpID0+IGpzbWFwLmtleXMoKSxcbiAgICAoaykgPT4ganNtYXAuaGFzKGspLFxuICAgIGNvbXBhcmVSYW5rLFxuICAgIGFzc2VydEtWT2tUb0FkZCxcbiAgICBhc3NlcnRLZXlPa1RvRGVsZXRlLFxuICAgIHRhZ1xuICApO1xuICBjb25zdCBrZXlzOCA9IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IHtcbiAgICBpZiAoa2V5UGF0dCA9PT0gdm9pZCAwICYmIHZhbHVlUGF0dCA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gaXRlcmFibGVLZXlzO1xuICAgIH1cbiAgICBjb25zdCBmaWx0ZXIgPSAoaykgPT4ge1xuICAgICAgaWYgKGtleVBhdHQgIT09IHZvaWQgMCAmJiAhbWF0Y2hlcyhrLCBrZXlQYXR0KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAodmFsdWVQYXR0ICE9PSB2b2lkIDAgJiYgIW1hdGNoZXMoanNtYXAuZ2V0KGspLCB2YWx1ZVBhdHQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG4gICAgcmV0dXJuIGZpbHRlckl0ZXJhYmxlKGl0ZXJhYmxlS2V5cywgZmlsdGVyKTtcbiAgfTtcbiAgY29uc3QgdmFsdWVzOCA9IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IG1hcEl0ZXJhYmxlKGtleXM4KGtleVBhdHQsIHZhbHVlUGF0dCksIChrKSA9PiAoXG4gICAgLyogICAgICAgICAgICAqL1xuICAgIGpzbWFwLmdldChrKVxuICApKTtcbiAgY29uc3QgZW50cmllczEwID0gKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4gbWFwSXRlcmFibGUoa2V5czgoa2V5UGF0dCwgdmFsdWVQYXR0KSwgKGspID0+IFtcbiAgICBrLFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICBqc21hcC5nZXQoaylcbiAgXSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIC4uLm1ha2VXZWFrTWFwU3RvcmVNZXRob2RzKFxuICAgICAganNtYXAsXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgYXNzZXJ0VXBkYXRlT25BZGQsXG4gICAgICBhc3NlcnRLVk9rVG9TZXQsXG4gICAgICBhc3NlcnRVcGRhdGVPbkRlbGV0ZSxcbiAgICAgIHRhZ1xuICAgICksXG4gICAga2V5czoga2V5czgsXG4gICAgdmFsdWVzOiB2YWx1ZXM4LFxuICAgIGVudHJpZXM6IGVudHJpZXMxMCxcbiAgICBzbmFwc2hvdDogKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4gbWFrZUNvcHlNYXAoZW50cmllczEwKGtleVBhdHQsIHZhbHVlUGF0dCkpLFxuICAgIGdldFNpemU6IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IGtleVBhdHQgPT09IHZvaWQgMCAmJiB2YWx1ZVBhdHQgPT09IHZvaWQgMCA/IGpzbWFwLnNpemUgOiBbLi4ua2V5czgoa2V5UGF0dCwgdmFsdWVQYXR0KV0ubGVuZ3RoLFxuICAgIGNsZWFyOiAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiB7XG4gICAgICBpZiAoa2V5UGF0dCA9PT0gdm9pZCAwICYmIHZhbHVlUGF0dCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGpzbWFwLmNsZWFyKCk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzOChrZXlQYXR0LCB2YWx1ZVBhdHQpKSB7XG4gICAgICAgIGpzbWFwLmRlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJNYXBTdG9yZSA9ICh0YWcgPSBcImtleVwiLCB7IGtleVNoYXBlID0gdm9pZCAwLCB2YWx1ZVNoYXBlID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBqc21hcCA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4odmFsdWVTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S1ZPa1RvU2V0ID0gKF9rZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKHZhbHVlKTtcbiAgICBhc3NlcnRQYXNzYWJsZSh2YWx1ZSk7XG4gICAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKHZhbHVlLCB2YWx1ZVNoYXBlLCBcIm1hcFN0b3JlIHZhbHVlXCIpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgYXNzZXJ0S1ZPa1RvQWRkID0gKGtleSwgdmFsdWUpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBhc3NlcnRTY2FsYXJLZXkoa2V5KTtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwibWFwU3RvcmUga2V5XCIpO1xuICAgIH1cbiAgICBhc3NlcnRLVk9rVG9TZXQoa2V5LCB2YWx1ZSk7XG4gIH07XG4gIHJldHVybiBGYXIoYHNjYWxhciBNYXBTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VNYXBTdG9yZU1ldGhvZHMoXG4gICAgICBqc21hcCxcbiAgICAgIGFzc2VydEtWT2tUb0FkZCxcbiAgICAgIGFzc2VydEtWT2tUb1NldCxcbiAgICAgIHZvaWQgMCxcbiAgICAgIHRhZ1xuICAgIClcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJNYXBTdG9yZSk7XG5cbi8vXG52YXIgbWFrZUxlZ2FjeU1hcCA9ICh0YWcgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IG0yID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbiAgY29uc3QgYXNzZXJ0S2V5RG9lc05vdEV4aXN0ID0gKGtleSkgPT4gIW0yLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBhbHJlYWR5IHJlZ2lzdGVyZWQ6ICR7a2V5fWA7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IG0yLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIG0yLmhhcyhrZXkpO1xuICAgIH0sXG4gICAgaW5pdDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleURvZXNOb3RFeGlzdChrZXkpO1xuICAgICAgbTIuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZ2V0OiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHJldHVybiBtMi5nZXQoa2V5KTtcbiAgICB9LFxuICAgIHNldDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgbTIuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZGVsZXRlOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIG0yLmRlbGV0ZShrZXkpO1xuICAgIH0sXG4gICAga2V5czogKCkgPT4gbTIua2V5cygpLFxuICAgIHZhbHVlczogKCkgPT4gbTIudmFsdWVzKCksXG4gICAgZW50cmllczogKCkgPT4gbTIuZW50cmllcygpLFxuICAgIGdldFNpemU6ICgpID0+IG0yLnNpemUsXG4gICAgY2xlYXI6ICgpID0+IG0yLmNsZWFyKClcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VMZWdhY3lNYXApO1xuXG4vL1xudmFyIG1ha2VMZWdhY3lXZWFrTWFwID0gKHRhZyA9IFwia2V5XCIpID0+IHtcbiAgY29uc3Qgd20gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgYXNzZXJ0S2V5RG9lc05vdEV4aXN0ID0gKGtleSkgPT4gIXdtLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBhbHJlYWR5IHJlZ2lzdGVyZWQ6ICR7a2V5fWA7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IHdtLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIHdtLmhhcyhrZXkpO1xuICAgIH0sXG4gICAgaW5pdDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleURvZXNOb3RFeGlzdChrZXkpO1xuICAgICAgd20uc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZ2V0OiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgICAgd20uZ2V0KGtleSlcbiAgICAgICk7XG4gICAgfSxcbiAgICBzZXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHdtLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICB3bS5kZWxldGUoa2V5KTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihtYWtlTGVnYWN5V2Vha01hcCk7XG5cbi8vXG52YXIgbXVzdE1hdGNoMiA9IG11c3RNYXRjaDtcblxuLy9cbnZhciBkZWZhdWx0TGFiZWxUb0tleXMgPSAobGFiZWwpID0+IGhhcmRlbihbbGFiZWxdKTtcbmhhcmRlbihkZWZhdWx0TGFiZWxUb0tleXMpO1xudmFyIG1ha2VPbmNlS2l0ID0gKGRlYnVnTmFtZSwgc3RvcmVzLCBiYWNraW5nU3RvcmUgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgdXNlZEtleXMgPSBzdG9yZXMuZGV0YWNoZWQoKS5zZXRTdG9yZShgJHtkZWJ1Z05hbWV9IHVzZWQga2V5c2ApO1xuICBjb25zdCBhc3NlcnRPbmx5T25jZSA9IChrZXkpID0+IHtcbiAgICB0eXBlb2Yga2V5ID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRga2V5ICR7a2V5fSBtdXN0IGJlIGEgc3RyaW5nYDtcbiAgICAhdXNlZEtleXMuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGBrZXkgJHtrZXl9IGhhcyBhbHJlYWR5IGJlZW4gdXNlZCBpbiB0aGlzIHpvbmUgYW5kIGluY2FybmF0aW9uYDtcbiAgICB1c2VkS2V5cy5hZGQoa2V5KTtcbiAgfTtcbiAgY29uc3Qgd3JhcFByb3ZpZGVyID0gKHByb3ZpZGVyLCBsYWJlbFRvS2V5cyA9IGRlZmF1bHRMYWJlbFRvS2V5cykgPT4ge1xuICAgIGNvbnN0IHdyYXBwZXIgPSAobGFiZWwsIC4uLnJlc3QpID0+IHtcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGxhYmVsVG9LZXlzKGxhYmVsKSkge1xuICAgICAgICBhc3NlcnRPbmx5T25jZShrZXkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHByb3ZpZGVyKGxhYmVsLCAuLi5yZXN0KTtcbiAgICB9O1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICovXG4gICAgICB3cmFwcGVyXG4gICAgKTtcbiAgfTtcbiAgY29uc3QgbWFrZU9uY2UgPSAoa2V5LCBtYWtlcikgPT4ge1xuICAgIGFzc2VydE9ubHlPbmNlKGtleSk7XG4gICAgaWYgKGJhY2tpbmdTdG9yZSAmJiBiYWNraW5nU3RvcmUuaGFzKGtleSkpIHtcbiAgICAgIHJldHVybiBiYWNraW5nU3RvcmUuZ2V0KGtleSk7XG4gICAgfVxuICAgIGNvbnN0IHZhbHVlID0gbWFrZXIoa2V5KTtcbiAgICBzdG9yZXMuaXNTdG9yYWJsZSh2YWx1ZSkgfHwgdGhyb3dSZWRhY3RlZGBtYWtlciByZXR1cm4gdmFsdWUgJHt2YWx1ZX0gaXMgbm90IHN0b3JhYmxlYDtcbiAgICBiYWNraW5nU3RvcmUgJiYgYmFja2luZ1N0b3JlLmluaXQoa2V5LCB2YWx1ZSk7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHsgbWFrZU9uY2UsIHdyYXBQcm92aWRlciB9KTtcbn07XG5oYXJkZW4obWFrZU9uY2VLaXQpO1xuXG4vL1xudmFyIGtpbmQgPSAobGFiZWwpID0+IGAke2xhYmVsfV9raW5kSGFuZGxlYDtcbnZhciBzaW5nbGV0b24gPSAobGFiZWwpID0+IGAke2xhYmVsfV9zaW5nbGV0b25gO1xudmFyIGFnb3JpY1ZhdERhdGFLZXlzID0ge1xuICBleG9DbGFzczogKGxhYmVsKSA9PiBoYXJkZW4oW2tpbmQobGFiZWwpXSksXG4gIGV4b0NsYXNzS2l0OiAobGFiZWwpID0+IGhhcmRlbihba2luZChsYWJlbCldKSxcbiAgZXhvOiAobGFiZWwpID0+IGhhcmRlbihba2luZChsYWJlbCksIHNpbmdsZXRvbihsYWJlbCldKSxcbiAgc3RvcmU6IChsYWJlbCkgPT4gaGFyZGVuKFtsYWJlbF0pLFxuICB6b25lOiAobGFiZWwpID0+IGhhcmRlbihbbGFiZWxdKVxufTtcbmhhcmRlbihhZ29yaWNWYXREYXRhS2V5cyk7XG5cbi8vXG52YXIgeyBhcHBseTogYXBwbHk2IH0gPSBSZWZsZWN0O1xudmFyIFByb21pc2VXYXRjaGVySGFuZGxlciA9IE0uY2FsbChNLnJhdygpKS5yZXN0KE0ucmF3KCkpLnJldHVybnMoKTtcbnZhciBQcm9taXNlV2F0Y2hlckkgPSBNLmludGVyZmFjZShcIlByb21pc2VXYXRjaGVyXCIsIHtcbiAgb25GdWxmaWxsZWQ6IFByb21pc2VXYXRjaGVySGFuZGxlcixcbiAgb25SZWplY3RlZDogUHJvbWlzZVdhdGNoZXJIYW5kbGVyXG59KTtcbnZhciBQcm9taXNlV2F0Y2hlckZ1bGZpbGxlZEkgPSBNLmludGVyZmFjZShcIlByb21pc2VXYXRjaGVyRnVsZmlsbGVkXCIsIHtcbiAgb25GdWxmaWxsZWQ6IFByb21pc2VXYXRjaGVySGFuZGxlclxufSk7XG52YXIgUHJvbWlzZVdhdGNoZXJSZWplY3RlZEkgPSBNLmludGVyZmFjZShcIlByb21pc2VXYXRjaGVyUmVqZWN0ZWRcIiwge1xuICBvblJlamVjdGVkOiBQcm9taXNlV2F0Y2hlckhhbmRsZXJcbn0pO1xudmFyIGNhbGxNZU1heWJlID0gKHRoYXQsIHByb3AsIHBvc3RBcmdzKSA9PiB7XG4gIGNvbnN0IGZuID0gdGhhdFtwcm9wXTtcbiAgaWYgKCFmbikge1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbiAgYXNzZXJ0LnR5cGVvZihmbiwgXCJmdW5jdGlvblwiKTtcbiAgY29uc3Qgd3JhcHBlZCA9IChhcmcpID0+IHtcbiAgICBhcHBseTYoZm4sIHRoYXQsIFthcmcsIC4uLnBvc3RBcmdzXSk7XG4gIH07XG4gIHJldHVybiB3cmFwcGVkO1xufTtcbnZhciB3YXRjaFByb21pc2UgPSAocDQsIHdhdGNoZXIsIC4uLndhdGNoZXJBcmdzKSA9PiB7XG4gIFByb21pc2UucmVzb2x2ZShwNCkgPT09IHA0IHx8IHRocm93UmVkYWN0ZWRgd2F0Y2hQcm9taXNlIG9ubHkgd2F0Y2hlcyBwcm9taXNlc2A7XG4gIGNvbnN0IG9uRnVsZmlsbGVkID0gY2FsbE1lTWF5YmUod2F0Y2hlciwgXCJvbkZ1bGZpbGxlZFwiLCB3YXRjaGVyQXJncyk7XG4gIGNvbnN0IG9uUmVqZWN0ZWQgPSBjYWxsTWVNYXliZSh3YXRjaGVyLCBcIm9uUmVqZWN0ZWRcIiwgd2F0Y2hlckFyZ3MpO1xuICBvbkZ1bGZpbGxlZCB8fCBvblJlamVjdGVkIHx8IHRocm93UmVkYWN0ZWRgcHJvbWlzZSB3YXRjaGVyIG11c3QgaW1wbGVtZW50IGF0IGxlYXN0IG9uZSBoYW5kbGVyIG1ldGhvZGA7XG4gIHZvaWQgRS53aGVuKHA0LCBvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCk7XG59O1xuaGFyZGVuKHdhdGNoUHJvbWlzZSk7XG5cbi8vXG52YXIgZGV0YWNoZWRIZWFwU3RvcmVzID0gRmFyKFwiaGVhcFN0b3Jlc1wiLCB7XG4gIGRldGFjaGVkOiAoKSA9PiBkZXRhY2hlZEhlYXBTdG9yZXMsXG4gIGlzU3RvcmFibGU6IGlzUGFzc2FibGUsXG4gIHNldFN0b3JlOiBtYWtlU2NhbGFyU2V0U3RvcmUsXG4gIG1hcFN0b3JlOiBtYWtlU2NhbGFyTWFwU3RvcmUsXG4gIHdlYWtNYXBTdG9yZTogbWFrZVNjYWxhcldlYWtNYXBTdG9yZSxcbiAgd2Vha1NldFN0b3JlOiBtYWtlU2NhbGFyV2Vha1NldFN0b3JlXG59KTtcbnZhciBtYWtlSGVhcFpvbmUgPSAoYmFzZUxhYmVsID0gXCJoZWFwWm9uZVwiKSA9PiB7XG4gIGNvbnN0IHsgbWFrZU9uY2UsIHdyYXBQcm92aWRlciB9ID0gbWFrZU9uY2VLaXQoYmFzZUxhYmVsLCBkZXRhY2hlZEhlYXBTdG9yZXMpO1xuICBjb25zdCBtYWtlU3ViWm9uZSA9IChsYWJlbCwgX29wdGlvbnMpID0+IG1ha2VIZWFwWm9uZShgJHtiYXNlTGFiZWx9LiR7bGFiZWx9YCk7XG4gIHJldHVybiBGYXIoXCJoZWFwWm9uZVwiLCB7XG4gICAgZXhvOiB3cmFwUHJvdmlkZXIobWFrZUV4bywgYWdvcmljVmF0RGF0YUtleXMuZXhvKSxcbiAgICBleG9DbGFzczogd3JhcFByb3ZpZGVyKGRlZmluZUV4b0NsYXNzLCBhZ29yaWNWYXREYXRhS2V5cy5leG9DbGFzcyksXG4gICAgZXhvQ2xhc3NLaXQ6IHdyYXBQcm92aWRlcihkZWZpbmVFeG9DbGFzc0tpdCwgYWdvcmljVmF0RGF0YUtleXMuZXhvQ2xhc3NLaXQpLFxuICAgIHN1YlpvbmU6IHdyYXBQcm92aWRlcihtYWtlU3ViWm9uZSksXG4gICAgbWFrZU9uY2UsXG4gICAgd2F0Y2hQcm9taXNlLFxuICAgIGRldGFjaGVkOiBkZXRhY2hlZEhlYXBTdG9yZXMuZGV0YWNoZWQsXG4gICAgaXNTdG9yYWJsZTogZGV0YWNoZWRIZWFwU3RvcmVzLmlzU3RvcmFibGUsXG4gICAgbWFwU3RvcmU6IHdyYXBQcm92aWRlcihkZXRhY2hlZEhlYXBTdG9yZXMubWFwU3RvcmUpLFxuICAgIHNldFN0b3JlOiB3cmFwUHJvdmlkZXIoZGV0YWNoZWRIZWFwU3RvcmVzLnNldFN0b3JlKSxcbiAgICB3ZWFrTWFwU3RvcmU6IHdyYXBQcm92aWRlcihkZXRhY2hlZEhlYXBTdG9yZXMud2Vha01hcFN0b3JlKSxcbiAgICB3ZWFrU2V0U3RvcmU6IHdyYXBQcm92aWRlcihkZXRhY2hlZEhlYXBTdG9yZXMud2Vha1NldFN0b3JlKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUhlYXBab25lKTtcblxuLy9cbnZhciB7IGZyb21FbnRyaWVzOiBmcm9tRW50cmllczkgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IHJhd093bktleXMgfSA9IFJlZmxlY3Q7XG52YXIgb3duS2V5czIwID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICByYXdPd25LZXlzXG4pO1xudmFyIGlzUHJvcGVydHlLZXkgPSAoa2V5KSA9PiB7XG4gIHN3aXRjaCAodHlwZW9mIGtleSkge1xuICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgY2FzZSBcInN5bWJvbFwiOlxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcbnZhciBjYWxsU3luYyA9IChjYWxsYmFjaywgLi4uYXJncykgPT4ge1xuICBjb25zdCB7IHRhcmdldCwgbWV0aG9kTmFtZSwgYm91bmQgfSA9IGNhbGxiYWNrO1xuICBpZiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRhcmdldCguLi5ib3VuZCwgLi4uYXJncyk7XG4gIH1cbiAgcmV0dXJuIHRhcmdldFttZXRob2ROYW1lXSguLi5ib3VuZCwgLi4uYXJncyk7XG59O1xuaGFyZGVuKGNhbGxTeW5jKTtcbnZhciBjYWxsRSA9IChjYWxsYmFjaywgLi4uYXJncykgPT4ge1xuICBjb25zdCB7IHRhcmdldCwgbWV0aG9kTmFtZSwgYm91bmQgfSA9IGNhbGxiYWNrO1xuICBpZiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIEUodGFyZ2V0KSguLi5ib3VuZCwgLi4uYXJncyk7XG4gIH1cbiAgcmV0dXJuIEUodGFyZ2V0KVttZXRob2ROYW1lXSguLi5ib3VuZCwgLi4uYXJncyk7XG59O1xuaGFyZGVuKGNhbGxFKTtcbnZhciBtYWtlU3luY0Z1bmN0aW9uQ2FsbGJhY2sgPSAodGFyZ2V0LCAuLi5ib3VuZCkgPT4ge1xuICB0eXBlb2YgdGFyZ2V0ID09PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGBzeW5jIGZ1bmN0aW9uIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGEgZnVuY3Rpb246ICR7dGFyZ2V0fWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBib3VuZCwgaXNTeW5jOiB0cnVlIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VTeW5jRnVuY3Rpb25DYWxsYmFjayk7XG52YXIgbWFrZUZ1bmN0aW9uQ2FsbGJhY2sgPSAodGFyZ2V0LCAuLi5ib3VuZCkgPT4ge1xuICAhaXNQcmltaXRpdmUyKHRhcmdldCkgfHwgdGhyb3dSZWRhY3RlZGBmdW5jdGlvbiBjYWxsYmFjayB0YXJnZXQgbXVzdCBiZSBhIGZ1bmN0aW9uIHByZXNlbmNlOiAke3RhcmdldH1gO1xuICBjb25zdCBjYiA9IGhhcmRlbih7IHRhcmdldCwgYm91bmQgfSk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBjYlxuICApO1xufTtcbmhhcmRlbihtYWtlRnVuY3Rpb25DYWxsYmFjayk7XG52YXIgbWFrZVN5bmNNZXRob2RDYWxsYmFjayA9ICh0YXJnZXQsIG1ldGhvZE5hbWUsIC4uLmJvdW5kKSA9PiB7XG4gICFpc1ByaW1pdGl2ZTIodGFyZ2V0KSB8fCB0aHJvd1JlZGFjdGVkYHN5bmMgbWV0aG9kIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGFuIG9iamVjdDogJHt0YXJnZXR9YDtcbiAgdHlwZW9mIG1ldGhvZE5hbWUgPT09IFwic3RyaW5nXCIgfHwgaXNQYXNzYWJsZVN5bWJvbChtZXRob2ROYW1lKSB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZCBuYW1lIG11c3QgYmUgYSBzdHJpbmcgb3IgcGFzc2FibGUgc3ltYm9sOiAke21ldGhvZE5hbWV9YDtcbiAgY29uc3QgY2IgPSBoYXJkZW4oeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kLCBpc1N5bmM6IHRydWUgfSk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgY2JcbiAgKTtcbn07XG5oYXJkZW4obWFrZVN5bmNNZXRob2RDYWxsYmFjayk7XG52YXIgbWFrZU1ldGhvZENhbGxiYWNrID0gKHRhcmdldCwgbWV0aG9kTmFtZSwgLi4uYm91bmQpID0+IHtcbiAgIWlzUHJpbWl0aXZlMih0YXJnZXQpIHx8IHRocm93UmVkYWN0ZWRgbWV0aG9kIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGFuIG9iamVjdDogJHt0YXJnZXR9YDtcbiAgdHlwZW9mIG1ldGhvZE5hbWUgPT09IFwic3RyaW5nXCIgfHwgaXNQYXNzYWJsZVN5bWJvbChtZXRob2ROYW1lKSB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZCBuYW1lIG11c3QgYmUgYSBzdHJpbmcgb3IgcGFzc2FibGUgc3ltYm9sOiAke21ldGhvZE5hbWV9YDtcbiAgY29uc3QgY2IgPSBoYXJkZW4oeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgY2JcbiAgKTtcbn07XG5oYXJkZW4obWFrZU1ldGhvZENhbGxiYWNrKTtcbnZhciBpc0NhbGxiYWNrID0gKGNhbGxiYWNrKSA9PiB7XG4gIGlmIChpc1ByaW1pdGl2ZTIoY2FsbGJhY2spKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IHsgdGFyZ2V0LCBtZXRob2ROYW1lLCBib3VuZCB9ID0gY2FsbGJhY2s7XG4gIHJldHVybiAhaXNQcmltaXRpdmUyKHRhcmdldCkgJiYgKG1ldGhvZE5hbWUgPT09IHZvaWQgMCB8fCB0eXBlb2YgbWV0aG9kTmFtZSA9PT0gXCJzdHJpbmdcIiB8fCBpc1Bhc3NhYmxlU3ltYm9sKG1ldGhvZE5hbWUpKSAmJiBBcnJheS5pc0FycmF5KGJvdW5kKTtcbn07XG5oYXJkZW4oaXNDYWxsYmFjayk7XG52YXIgcHJlcGFyZUF0dGVudWF0b3IgPSAoem9uZSwgbWV0aG9kTmFtZXMsIHsgaW50ZXJmYWNlR3VhcmQsIHRhZyA9IFwiQXR0ZW51YXRvclwiIH0gPSB7fSkgPT4ge1xuICBjb25zdCBtZXRob2RzID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBmcm9tRW50cmllczkoXG4gICAgICBtZXRob2ROYW1lcy5tYXAoKGtleSkgPT4ge1xuICAgICAgICBpZiAoIWlzUHJvcGVydHlLZXkoa2V5KSkge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRga2V5ICR7cXVvdGUoa2V5KX0gaXMgbm90IGEgUHJvcGVydHlLZXlgO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG0yID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB7XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgW2tleV0oLi4uYXJncykge1xuICAgICAgICAgICAgICBjb25zdCBjYiA9IHRoaXMuc3RhdGUuY2JzW2tleV07XG4gICAgICAgICAgICAgIGlmICghY2IpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSBtYWtlRXJyb3IoYHVuaW1wbGVtZW50ZWQgJHtxdW90ZSh0YWcpfSBtZXRob2QgJHtxdW90ZShrZXkpfWApO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmlzU3luYykge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoY2IuaXNTeW5jKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxTeW5jKGNiLCAuLi5hcmdzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gY2FsbEUoY2IsIC4uLmFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1ba2V5XVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgW2tleSwgbTJdXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgIClcbiAgKTtcbiAgY29uc3QgbWFrZUF0dGVudWF0b3IgPSB6b25lLmV4b0NsYXNzKFxuICAgIHRhZyxcbiAgICBpbnRlcmZhY2VHdWFyZCxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgKHtcbiAgICAgIHRhcmdldCA9IG51bGwsXG4gICAgICBpc1N5bmMgPSBmYWxzZSxcbiAgICAgIG92ZXJyaWRlcyA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHt9XG4gICAgICApXG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgY2JzID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAge31cbiAgICAgICk7XG4gICAgICBjb25zdCByZW1haW5pbmcgPSBuZXcgU2V0KG1ldGhvZE5hbWVzKTtcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIG93bktleXMyMChvdmVycmlkZXMpKSB7XG4gICAgICAgIHJlbWFpbmluZy5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gb3ZlcnJpZGVzWyR7cXVvdGUoa2V5KX1dIG5vdCBhbGxvd2VkIGJ5IG1ldGhvZE5hbWVzYDtcbiAgICAgICAgcmVtYWluaW5nLmRlbGV0ZShrZXkpO1xuICAgICAgICBjb25zdCBjYiA9IG92ZXJyaWRlc1trZXldO1xuICAgICAgICBjYiA9PSBudWxsIHx8IGlzQ2FsbGJhY2soY2IpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBvdmVycmlkZXNbJHtxdW90ZShrZXkpfV0gaXMgbm90IGEgY2FsbGJhY2s7IGdvdCAke2NifWA7XG4gICAgICAgIGNic1trZXldID0gY2I7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiByZW1haW5pbmcpIHtcbiAgICAgICAgaWYgKGlzU3luYykge1xuICAgICAgICAgIGNic1trZXldID0gbWFrZVN5bmNNZXRob2RDYWxsYmFjayh0YXJnZXQsIGtleSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2JzW2tleV0gPSBtYWtlTWV0aG9kQ2FsbGJhY2sodGFyZ2V0LCBrZXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gaGFyZGVuKHsgY2JzLCBpc1N5bmMgfSk7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgbWV0aG9kc1xuICApO1xuICByZXR1cm4gbWFrZUF0dGVudWF0b3I7XG59O1xuaGFyZGVuKHByZXBhcmVBdHRlbnVhdG9yKTtcbnZhciBwcmVwYXJlR3VhcmRlZEF0dGVudWF0b3IgPSAoem9uZSwgaW50ZXJmYWNlR3VhcmQsIG9wdHMgPSB7fSkgPT4ge1xuICBjb25zdCBtZXRob2ROYW1lcyA9IGdldEludGVyZmFjZU1ldGhvZEtleXMoaW50ZXJmYWNlR3VhcmQpO1xuICBjb25zdCBtYWtlQXR0ZW51YXRvciA9IHByZXBhcmVBdHRlbnVhdG9yKHpvbmUsIG1ldGhvZE5hbWVzLCB7XG4gICAgLi4ub3B0cyxcbiAgICBpbnRlcmZhY2VHdWFyZFxuICB9KTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgbWFrZUF0dGVudWF0b3JcbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZUd1YXJkZWRBdHRlbnVhdG9yKTtcblxuLy9cbnZhciBTdHJlYW1DZWxsU2hhcGUgPSBoYXJkZW4oe1xuICBibG9ja0hlaWdodDogTS5zdHJpbmcoKSxcbiAgdmFsdWVzOiBNLmFycmF5KClcbn0pO1xudmFyIENoYWluU3RvcmFnZU5vZGVJID0gTS5pbnRlcmZhY2UoXCJTdG9yYWdlTm9kZVwiLCB7XG4gIHNldFZhbHVlOiBNLmNhbGxXaGVuKE0uc3RyaW5nKCkpLnJldHVybnMoKSxcbiAgZ2V0UGF0aDogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgZ2V0U3RvcmVLZXk6IE0uY2FsbFdoZW4oKS5yZXR1cm5zKE0ucmVjb3JkKCkpLFxuICBtYWtlQ2hpbGROb2RlOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5zcGxpdFJlY29yZCh7fSwgeyBzZXF1ZW5jZTogTS5ib29sZWFuKCkgfSwge30pKS5yZXR1cm5zKE0ucmVtb3RhYmxlKFwiU3RvcmFnZU5vZGVcIikpXG59KTtcbnZhciBpc1N0cmVhbUNlbGwgPSAoY2VsbCkgPT4gY2VsbCAmJiB0eXBlb2YgY2VsbCA9PT0gXCJvYmplY3RcIiAmJiBBcnJheS5pc0FycmF5KGNlbGwudmFsdWVzKSAmJiB0eXBlb2YgY2VsbC5ibG9ja0hlaWdodCA9PT0gXCJzdHJpbmdcIiAmJiAvXjAkfF5bMS05XVswLTldKiQvLnRlc3QoY2VsbC5ibG9ja0hlaWdodCk7XG5oYXJkZW4oaXNTdHJlYW1DZWxsKTtcbnZhciBwYXRoU2VnbWVudFBhdHRlcm4gPSAvXlthLXpBLVowLTlfLV17MSwxMDB9JC87XG52YXIgYXNzZXJ0UGF0aFNlZ21lbnQgPSAobmFtZSkgPT4ge1xuICBwYXRoU2VnbWVudFBhdHRlcm4udGVzdChuYW1lKSB8fCB0aHJvd1JlZGFjdGVkYFBhdGggc2VnbWVudCBuYW1lcyBtdXN0IGNvbnNpc3Qgb2YgMSB0byAxMDAgY2hhcmFjdGVycyBsaW1pdGVkIHRvIEFTQ0lJIGFscGhhbnVtZXJpY3MsIHVuZGVyc2NvcmVzLCBhbmQvb3IgZGFzaGVzOiAke25hbWV9YDtcbn07XG5oYXJkZW4oYXNzZXJ0UGF0aFNlZ21lbnQpO1xudmFyIHByZXBhcmVDaGFpblN0b3JhZ2VOb2RlID0gKHpvbmUpID0+IHtcbiAgY29uc3QgbWFrZUNoYWluU3RvcmFnZU5vZGUgPSB6b25lLmV4b0NsYXNzKFxuICAgIFwiQ2hhaW5TdG9yYWdlTm9kZVwiLFxuICAgIENoYWluU3RvcmFnZU5vZGVJLFxuICAgIC8qXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgKG1lc3NlbmdlciwgcGF0aCwgeyBzZXF1ZW5jZSA9IGZhbHNlIH0gPSB7fSkgPT4ge1xuICAgICAgYXNzZXJ0LnR5cGVvZihwYXRoLCBcInN0cmluZ1wiKTtcbiAgICAgIGFzc2VydC50eXBlb2Yoc2VxdWVuY2UsIFwiYm9vbGVhblwiKTtcbiAgICAgIHJldHVybiBoYXJkZW4oeyBwYXRoLCBtZXNzZW5nZXIsIHNlcXVlbmNlIH0pO1xuICAgIH0sXG4gICAge1xuICAgICAgZ2V0UGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUucGF0aDtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgYXN5bmMgZ2V0U3RvcmVLZXkoKSB7XG4gICAgICAgIGNvbnN0IHsgcGF0aCwgbWVzc2VuZ2VyIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gY2FsbEUobWVzc2VuZ2VyLCB7XG4gICAgICAgICAgbWV0aG9kOiBcImdldFN0b3JlS2V5XCIsXG4gICAgICAgICAgYXJnczogW3BhdGhdXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgbWFrZUNoaWxkTm9kZShuYW1lLCBjaGlsZE5vZGVPcHRpb25zID0ge30pIHtcbiAgICAgICAgY29uc3QgeyBzZXF1ZW5jZSwgcGF0aCwgbWVzc2VuZ2VyIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBhc3NlcnRQYXRoU2VnbWVudChuYW1lKTtcbiAgICAgICAgY29uc3QgbWVyZ2VkT3B0aW9ucyA9IHsgc2VxdWVuY2UsIC4uLmNoaWxkTm9kZU9wdGlvbnMgfTtcbiAgICAgICAgcmV0dXJuIG1ha2VDaGFpblN0b3JhZ2VOb2RlKFxuICAgICAgICAgIG1lc3NlbmdlcixcbiAgICAgICAgICBgJHtwYXRofS4ke25hbWV9YCxcbiAgICAgICAgICBtZXJnZWRPcHRpb25zXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGFzeW5jIHNldFZhbHVlKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHsgc2VxdWVuY2UsIHBhdGgsIG1lc3NlbmdlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgYXNzZXJ0LnR5cGVvZih2YWx1ZSwgXCJzdHJpbmdcIik7XG4gICAgICAgIGxldCBlbnRyeTtcbiAgICAgICAgaWYgKCFzZXF1ZW5jZSAmJiAhdmFsdWUpIHtcbiAgICAgICAgICBlbnRyeSA9IFtwYXRoXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbnRyeSA9IFtwYXRoLCB2YWx1ZV07XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgY2FsbEUobWVzc2VuZ2VyLCB7XG4gICAgICAgICAgbWV0aG9kOiBzZXF1ZW5jZSA/IFwiYXBwZW5kXCIgOiBcInNldFwiLFxuICAgICAgICAgIGFyZ3M6IFtlbnRyeV1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgIH1cbiAgKTtcbiAgcmV0dXJuIG1ha2VDaGFpblN0b3JhZ2VOb2RlO1xufTtcbnZhciBtYWtlSGVhcENoYWluU3RvcmFnZU5vZGUgPSBwcmVwYXJlQ2hhaW5TdG9yYWdlTm9kZShtYWtlSGVhcFpvbmUoKSk7XG5mdW5jdGlvbiBtYWtlQ2hhaW5TdG9yYWdlUm9vdChoYW5kbGVTdG9yYWdlTWVzc2FnZSwgcm9vdFBhdGgsIHJvb3RPcHRpb25zID0ge30pIHtcbiAgY29uc3QgbWVzc2VuZ2VyID0gbWFrZUZ1bmN0aW9uQ2FsbGJhY2soaGFuZGxlU3RvcmFnZU1lc3NhZ2UpO1xuICBjb25zdCByb290Tm9kZSA9IG1ha2VIZWFwQ2hhaW5TdG9yYWdlTm9kZShtZXNzZW5nZXIsIHJvb3RQYXRoLCByb290T3B0aW9ucyk7XG4gIHJldHVybiByb290Tm9kZTtcbn1cbnZhciBtYWtlTnVsbFN0b3JhZ2VOb2RlID0gKCkgPT4ge1xuICByZXR1cm4gbWFrZUNoYWluU3RvcmFnZVJvb3QoXG4gICAgRmFyKFwiTnVsbE1lc3NlbmdlclwiLCAoKSA9PiBudWxsKSxcbiAgICBcIm51bGxcIlxuICApO1xufTtcbmFzeW5jIGZ1bmN0aW9uIG1ha2VTdG9yYWdlTm9kZUNoaWxkKHN0b3JhZ2VOb2RlUmVmLCBjaGlsZE5hbWUpIHtcbiAgY29uc3QgZXhpc3RpbmdTdG9yYWdlTm9kZSA9IGF3YWl0IHN0b3JhZ2VOb2RlUmVmO1xuICBjb25zdCBzdG9yYWdlTm9kZSA9IGV4aXN0aW5nU3RvcmFnZU5vZGUgfHwgbWFrZU51bGxTdG9yYWdlTm9kZSgpO1xuICByZXR1cm4gRShzdG9yYWdlTm9kZSkubWFrZUNoaWxkTm9kZShjaGlsZE5hbWUpO1xufVxuaGFyZGVuKG1ha2VTdG9yYWdlTm9kZUNoaWxkKTtcbnZhciBtYWtlU2VyaWFsaXplVG9TdG9yYWdlID0gKHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKSA9PiB7XG4gIHJldHVybiBhc3luYyAodmFsdWUpID0+IHtcbiAgICBjb25zdCBtYXJzaGFsbGVkID0gYXdhaXQgRShtYXJzaGFsbGVyKS50b0NhcERhdGEodmFsdWUpO1xuICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSBKU09OLnN0cmluZ2lmeShtYXJzaGFsbGVkKTtcbiAgICByZXR1cm4gRShzdG9yYWdlTm9kZSkuc2V0VmFsdWUoc2VyaWFsaXplZCk7XG4gIH07XG59O1xuXG4vL1xudmFyIENhcERhdGFTaGFwZSA9IHsgYm9keTogTS5zdHJpbmcoKSwgc2xvdHM6IE0uYXJyYXkoKSB9O1xuaGFyZGVuKENhcERhdGFTaGFwZSk7XG52YXIgYXNzZXJ0Q2FwRGF0YSA9IChkYXRhKSA9PiB7XG4gIGFzc2VydC50eXBlb2YoZGF0YSwgXCJvYmplY3RcIik7XG4gIGFzc2VydChkYXRhKTtcbiAgdHlwZW9mIGRhdGEuYm9keSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGRhdGEgaGFzIG5vbi1zdHJpbmcgLmJvZHkgJHtkYXRhLmJvZHl9YDtcbiAgQXJyYXkuaXNBcnJheShkYXRhLnNsb3RzKSB8fCB0aHJvd1JlZGFjdGVkYGRhdGEgaGFzIG5vbi1BcnJheSBzbG90cyAke2RhdGEuc2xvdHN9YDtcbn07XG5oYXJkZW4oYXNzZXJ0Q2FwRGF0YSk7XG52YXIgdW5tYXJzaGFsRnJvbVZzdG9yYWdlID0gKGRhdGEsIGtleSwgZnJvbUNhcERhdGEsIGluZGV4KSA9PiB7XG4gIGNvbnN0IHNlcmlhbGl6ZWQgPSBkYXRhLmdldChrZXkpIHx8IHRocm93UmVkYWN0ZWRgbm8gZGF0YSBmb3IgJHtrZXl9YDtcbiAgYXNzZXJ0LnR5cGVvZihzZXJpYWxpemVkLCBcInN0cmluZ1wiKTtcbiAgYXNzZXJ0LnR5cGVvZihpbmRleCwgXCJudW1iZXJcIik7XG4gIGNvbnN0IHN0cmVhbUNlbGwgPSBKU09OLnBhcnNlKHNlcmlhbGl6ZWQpO1xuICBpZiAoIWlzU3RyZWFtQ2VsbChzdHJlYW1DZWxsKSkge1xuICAgIHRocm93IHRocm93UmVkYWN0ZWRgbm90IGEgU3RyZWFtQ2VsbDogJHtzdHJlYW1DZWxsfWA7XG4gIH1cbiAgY29uc3QgeyB2YWx1ZXM6IHZhbHVlczggfSA9IHN0cmVhbUNlbGw7XG4gIHZhbHVlczgubGVuZ3RoID4gMCB8fCB0aHJvd1JlZGFjdGVkYG5vIFN0cmVhbUNlbGwgdmFsdWVzOiAke3N0cmVhbUNlbGx9YDtcbiAgY29uc3QgbWFyc2hhbGxlZCA9IHZhbHVlczguYXQoaW5kZXgpO1xuICBhc3NlcnQudHlwZW9mKG1hcnNoYWxsZWQsIFwic3RyaW5nXCIpO1xuICBjb25zdCBjYXBEYXRhID0gaGFyZGVuKEpTT04ucGFyc2UobWFyc2hhbGxlZCkpO1xuICBhc3NlcnRDYXBEYXRhKGNhcERhdGEpO1xuICBjb25zdCB1bm1hcnNoYWxsZWQgPSBmcm9tQ2FwRGF0YShjYXBEYXRhKTtcbiAgcmV0dXJuIHVubWFyc2hhbGxlZDtcbn07XG5oYXJkZW4odW5tYXJzaGFsRnJvbVZzdG9yYWdlKTtcbnZhciByZWplY3RPQ2FwID0gKGNhcCkgPT4gdGhyb3dSZWRhY3RlZGAke2NhcH0gaXMgbm90IHB1cmUgZGF0YWA7XG52YXIgcHVyZURhdGFNYXJzaGFsbGVyID0gbWFrZU1hcnNoYWwocmVqZWN0T0NhcCwgcmVqZWN0T0NhcCwge1xuICBzZXJpYWxpemVCb2R5Rm9ybWF0OiBcInNtYWxsY2Fwc1wiXG59KTtcbmhhcmRlbihwdXJlRGF0YU1hcnNoYWxsZXIpO1xuXG4vL1xudmFyIHsgY3JlYXRlOiBjcmVhdGU0LCBmcm9tRW50cmllczogZnJvbUVudHJpZXMxMCB9ID0gT2JqZWN0O1xudmFyIHsgYXBwbHk6IGFwcGx5NyB9ID0gUmVmbGVjdDtcbnZhciBnZXRNZXRob2ROYW1lczIgPSAodmFsKSA9PiAoXG4gIC8qICAgICAgICAgICAgICAqL1xuICBnZXRNZXRob2ROYW1lcyh2YWwpXG4pO1xuaGFyZGVuKGdldE1ldGhvZE5hbWVzMik7XG52YXIgYmluZEFsbE1ldGhvZHMgPSAob2JqKSA9PiBoYXJkZW4oXG4gIGNyZWF0ZTQoXG4gICAgb2JqLFxuICAgIGZyb21FbnRyaWVzMTAoXG4gICAgICBnZXRNZXRob2ROYW1lcyhvYmopLm1hcCgobmFtZSkgPT4gW1xuICAgICAgICBuYW1lLFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6ICguLi5hcmdzKSA9PiBhcHBseTcob2JqW25hbWVdLCBvYmosIGFyZ3MpLFxuICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgfVxuICAgICAgXSlcbiAgICApXG4gIClcbik7XG5oYXJkZW4oYmluZEFsbE1ldGhvZHMpO1xuXG4vL1xudmFyIEhJU1RPR1JBTV9NU19MQVRFTkNZX0JPVU5EQVJJRVMgPSBbXG4gIDUsXG4gIDEwLFxuICAyNSxcbiAgNTAsXG4gIDEwMCxcbiAgMjUwLFxuICA1MDAsXG4gIDFlMyxcbiAgMjUwMCxcbiAgNWUzLFxuICAxZTQsXG4gIEluZmluaXR5XG5dO1xudmFyIEhJU1RPR1JBTV9TRUNPTkRTX0xBVEVOQ1lfQk9VTkRBUklFUyA9IEhJU1RPR1JBTV9NU19MQVRFTkNZX0JPVU5EQVJJRVMubWFwKChtcykgPT4gbXMgLyAxZTMpO1xudmFyIEhJU1RPR1JBTV9NRVRSSUNTID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgc3dpbmdzZXRfY3JhbmtfcHJvY2Vzc2luZ190aW1lOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQcm9jZXNzaW5nIHRpbWUgcGVyIGNyYW5rIChtcylcIixcbiAgICAgIHVuaXQ6IFwibXNcIixcbiAgICAgIGJvdW5kYXJpZXM6IEFycmF5Lm9mKDEsIDExLCAyMSwgMzEsIDQxLCA1MSwgNjEsIDcxLCA4MSwgOTEsIEluZmluaXR5KVxuICAgIH0sXG4gICAgc3dpbmdzZXRfYmxvY2tfcHJvY2Vzc2luZ19zZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQcm9jZXNzaW5nIHRpbWUgcGVyIGJsb2NrXCIsXG4gICAgICB1bml0OiBcInNcIixcbiAgICAgIGJvdW5kYXJpZXM6IEhJU1RPR1JBTV9TRUNPTkRTX0xBVEVOQ1lfQk9VTkRBUklFU1xuICAgIH0sXG4gICAgc3dpbmdzZXRfdmF0X3N0YXJ0dXA6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlZhdCBzdGFydHVwIHRpbWUgKG1zKVwiLFxuICAgICAgdW5pdDogXCJtc1wiLFxuICAgICAgYm91bmRhcmllczogSElTVE9HUkFNX01TX0xBVEVOQ1lfQk9VTkRBUklFU1xuICAgIH0sXG4gICAgc3dpbmdzZXRfdmF0X2RlbGl2ZXJ5OiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJWYXQgZGVsaXZlcnkgdGltZSAobXMpXCIsXG4gICAgICB1bml0OiBcIm1zXCIsXG4gICAgICBib3VuZGFyaWVzOiBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTXG4gICAgfSxcbiAgICBzd2luZ3NldF9tZXRlcl91c2FnZToge1xuICAgICAgZGVzY3JpcHRpb246IFwiVmF0IG1ldGVyIHVzYWdlXCIsXG4gICAgICB1bml0OiBcIm1zXCIsXG4gICAgICBib3VuZGFyaWVzOiBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTXG4gICAgfVxuICB9XG4pO1xudmFyIGJsb2NrSGlzdG9ncmFtTWV0cmljRGVzYyA9IHtcbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgdW5pdDogXCJzXCIsXG4gIGFkdmljZToge1xuICAgIGV4cGxpY2l0QnVja2V0Qm91bmRhcmllczogW1xuICAgICAgMC4xLFxuICAgICAgMC4yLFxuICAgICAgMC4zLFxuICAgICAgMC40LFxuICAgICAgMC41LFxuICAgICAgMSxcbiAgICAgIDIsXG4gICAgICAzLFxuICAgICAgNCxcbiAgICAgIDUsXG4gICAgICA2LFxuICAgICAgNyxcbiAgICAgIDEwLFxuICAgICAgMTUsXG4gICAgICAzMFxuICAgIF1cbiAgfVxufTtcbnZhciBCTE9DS19ISVNUT0dSQU1fTUVUUklDUyA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIHN3aW5nc2V0UnVuU2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgZXhlY3V0aW5nIFN3aW5nU2V0XCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2NcbiAgICB9LFxuICAgIHN3aW5nc2V0Q2hhaW5TYXZlU2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgcHJvcGFnYXRpbmcgU3dpbmdTZXQgc3RhdGUgaW50byBjb3Ntb3NcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgc3dpbmdzZXRDb21taXRTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQZXItYmxvY2sgdGltZSBzcGVudCBjb21taXR0aW5nIFN3aW5nU2V0IHN0YXRlIHRvIGhvc3Qgc3RvcmFnZVwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjXG4gICAgfSxcbiAgICBjb3Ntb3NDb21taXRTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQZXItYmxvY2sgdGltZSBzcGVudCBjb21taXR0aW5nIGNvc21vcyBzdGF0ZVwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjXG4gICAgfSxcbiAgICBmdWxsQ29tbWl0U2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgY29tbWl0dGluZyBzdGF0ZSwgaW5jbHVzaXZlIG9mIENPTU1JVF9CTE9DSyBwcm9jZXNzaW5nIHBsdXMgdGltZSBzcGVudCBbb3V0c2lkZSBvZiBjb3NtaWMtc3dpbmdzZXRdIGJlZm9yZSBhbmQgYWZ0ZXIgaXRcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgaW50ZXJCbG9ja1NlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlRpbWUgc3BlbnQgaWRsZSBiZXR3ZWVuIGJsb2Nrc1wiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjXG4gICAgfSxcbiAgICBhZnRlckNvbW1pdEhhbmdvdmVyU2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgd2FpdGluZyBmb3IgcHJldmlvdXMtYmxvY2sgYWZ0ZXJDb21taXQgd29ya1wiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjXG4gICAgfSxcbiAgICBibG9ja0xhZ1NlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBkZWxheSBvZiBlYWNoIGJsb2NrIGZyb20gaXRzIGV4cGVjdGVkIGJlZ2luIHRpbWVcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzYyxcbiAgICAgIC8vXG4gICAgICBhZHZpY2U6IHtcbiAgICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjLmFkdmljZSxcbiAgICAgICAgZXhwbGljaXRCdWNrZXRCb3VuZGFyaWVzOiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBbXG4gICAgICAgICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MuYWR2aWNlLmV4cGxpY2l0QnVja2V0Qm91bmRhcmllcyxcbiAgICAgICAgICAgIC4uLls2MCwgMTIwLCAxODAsIDI0MCwgMzAwLCA2MDAsIDM2MDBdXG4gICAgICAgICAgXVxuICAgICAgICApXG4gICAgICB9XG4gICAgfVxuICB9XG4pO1xudmFyIE1ldHJpY1R5cGUgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBDb3VudGVyOiBcImNvdW50ZXJcIixcbiAgICBHYXVnZTogXCJnYXVnZVwiXG4gIH1cbik7XG52YXIgS0VSTkVMX1NUQVRTX1NVTV9NRVRSSUNTID0gW1xuICB7XG4gICAga2V5OiBcInN5c2NhbGxzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9hbGxfc3lzY2FsbF90b3RhbFwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxTZW5kXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInNlbmRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBtZXNzYWdlIHNlbmQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsQ2FsbE5vd1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJjYWxsTm93XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgc3luY2hyb25vdXMgZGV2aWNlIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFN1YnNjcmliZVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJzdWJzY3JpYmVcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBwcm9taXNlIHN1YnNjcmlwdGlvbiBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxSZXNvbHZlXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInJlc29sdmVcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBwcm9taXNlIHJlc29sdXRpb24ga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsRXhpdFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJleGl0XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0IGV4aXQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsVmF0c3RvcmVHZXRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwidmF0c3RvcmVHZXRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXRzdG9yZSBnZXQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsVmF0c3RvcmVTZXRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwidmF0c3RvcmVTZXRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXRzdG9yZSBzZXQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsVmF0c3RvcmVHZXROZXh0S2V5XCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInZhdHN0b3JlR2V0TmV4dFwiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdHN0b3JlIGdldE5leHRLZXkga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsVmF0c3RvcmVEZWxldGVcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwidmF0c3RvcmVEZWxldGVcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXRzdG9yZSBkZWxldGUga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsRHJvcEltcG9ydHNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwiZHJvcEltcG9ydHNcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBkcm9wIGltcG9ydHMga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJkaXNwYXRjaGVzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9kaXNwYXRjaF90b3RhbFwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXQgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImRpc3BhdGNoRGVsaXZlclwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfZGlzcGF0Y2hfZGVsaXZlcl90b3RhbFwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXQgbWVzc2FnZSBkZWxpdmVyaWVzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJkaXNwYXRjaE5vdGlmeVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfZGlzcGF0Y2hfbm90aWZ5X3RvdGFsXCIsXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdCBwcm9taXNlIG5vdGlmaWNhdGlvbnNcIlxuICB9XG5dO1xudmFyIEtFUk5FTF9TVEFUU19VUERPV05fTUVUUklDUyA9IFtcbiAge1xuICAgIGtleTogXCJrZXJuZWxPYmplY3RzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9rZXJuZWxfb2JqZWN0c1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIkFjdGl2ZSBrZXJuZWwgb2JqZWN0c1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwia2VybmVsRGV2aWNlc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfa2VybmVsX2RldmljZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJBY3RpdmUga2VybmVsIGRldmljZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImtlcm5lbFByb21pc2VzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9rZXJuZWxfcHJvbWlzZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJBY3RpdmUga2VybmVsIHByb21pc2VzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJrcFVucmVzb2x2ZWRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3VucmVzb2x2ZWRfa2VybmVsX3Byb21pc2VzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiVW5yZXNvbHZlZCBrZXJuZWwgcHJvbWlzZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImtwRnVsZmlsbGVkXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9mdWxmaWxsZWRfa2VybmVsX3Byb21pc2VzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiRnVsZmlsbGVkIGtlcm5lbCBwcm9taXNlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwia3BSZWplY3RlZFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfcmVqZWN0ZWRfa2VybmVsX3Byb21pc2VzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiUmVqZWN0ZWQga2VybmVsIHByb21pc2VzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJydW5RdWV1ZUxlbmd0aFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfcnVuX3F1ZXVlX2xlbmd0aFwiLFxuICAgIGNvbnNlbnN1czogdHJ1ZSxcbiAgICBkZXNjcmlwdGlvbjogXCJMZW5ndGggb2YgdGhlIGtlcm5lbCBydW4gcXVldWVcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImFjY2VwdGFuY2VRdWV1ZUxlbmd0aFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfYWNjZXB0YW5jZV9xdWV1ZV9sZW5ndGhcIixcbiAgICBjb25zZW5zdXM6IHRydWUsXG4gICAgZGVzY3JpcHRpb246IFwiTGVuZ3RoIG9mIHRoZSBrZXJuZWwgYWNjZXB0YW5jZSBxdWV1ZVwiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwicHJvbWlzZVF1ZXVlc0xlbmd0aFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfcHJvbWlzZV9xdWV1ZXNfbGVuZ3RoXCIsXG4gICAgY29uc2Vuc3VzOiB0cnVlLFxuICAgIGRlc2NyaXB0aW9uOiBcIkNvbWJpbmVkIGxlbmd0aCBvZiBhbGwga2VybmVsIHByb21pc2UgcXVldWVzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJjbGlzdEVudHJpZXNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2NsaXN0X2VudHJpZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJOdW1iZXIgb2YgZW50cmllcyBpbiB0aGUga2VybmVsIGMtbGlzdFwiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwidmF0c1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfdmF0c1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIk51bWJlciBvZiBhY3RpdmUgdmF0c1wiXG4gIH1cbl07XG52YXIgeyBDb3VudGVyLCBHYXVnZSB9ID0gTWV0cmljVHlwZTtcbnZhciBLRVJORUxfU1RBVFNfTUVUUklDUyA9IGhhcmRlbihbXG4gIC4uLktFUk5FTF9TVEFUU19TVU1fTUVUUklDUy5tYXAoKG0yKSA9PiAoeyAuLi5tMiwgbWV0cmljVHlwZTogQ291bnRlciB9KSksXG4gIC4uLktFUk5FTF9TVEFUU19VUERPV05fTUVUUklDUy5tYXAoKG0yKSA9PiAoeyAuLi5tMiwgbWV0cmljVHlwZTogR2F1Z2UgfSkpXG5dKTtcbnZhciBrZXJuZWxTdGF0c0tleXMgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuZm9yIChjb25zdCB7IGtleSB9IG9mIEtFUk5FTF9TVEFUU19NRVRSSUNTKSB7XG4gIGtlcm5lbFN0YXRzS2V5cy5zZXQoa2V5LCAoa2VybmVsU3RhdHNLZXlzLmdldChrZXkpIHx8IDApICsgMSk7XG59XG52YXIgZHVwbGljYXRlS2VybmVsU3RhdHNLZXlzID0gWy4uLmtlcm5lbFN0YXRzS2V5cy5lbnRyaWVzKCldLmZsYXRNYXAoXG4gIChba2V5LCB2YWx1ZV0pID0+IHZhbHVlID4gMSA/IFtrZXldIDogW11cbik7XG5pZiAoZHVwbGljYXRlS2VybmVsU3RhdHNLZXlzLmxlbmd0aCA+IDApIHtcbiAgY29uc3QgbXNnID0gYER1cGxpY2F0ZSBrZXJuZWwgc3RhdHMga2V5cyAke0pTT04uc3RyaW5naWZ5KGR1cGxpY2F0ZUtlcm5lbFN0YXRzS2V5cyl9YDtcbiAgdGhyb3cgRXJyb3IobXNnKTtcbn1cblxuLy9cbnZhciBjb21wYXJlTmF0cyA9IChhMiwgYjMpID0+IHtcbiAgY29uc3QgZGlmZiA9ICthMiAtICtiMztcbiAgY29uc3QgZmluaXRlRGlmZiA9IE51bWJlci5pc0Zpbml0ZShkaWZmKSAmJiBkaWZmIHx8IChhMiA9PT0gYjMgPyAwIDogTnVtYmVyKEJpZ0ludChhMikgLSBCaWdJbnQoYjMpKSB8fCBhMi5sZW5ndGggLSBiMy5sZW5ndGgpO1xuICByZXR1cm4gTWF0aC5zaWduKGZpbml0ZURpZmYpO1xufTtcbnZhciBjb21wYXJlU3RyaW5ncyA9IChhMiwgYjMpID0+IGEyID4gYjMgPyAxIDogYTIgPCBiMyA/IC0xIDogMDtcbnZhciByUHJlZml4ZWREaWdpdHMgPSAvXihcXEQqKShcXGQrKShcXEQuKnwpL3M7XG52YXIgbmF0dXJhbENvbXBhcmUgPSAoYTIsIGIzKSA9PiB7XG4gIGNvbnN0IFtfYSwgYVByZWZpeCwgYURpZ2l0cywgYVN1ZmZpeF0gPSByUHJlZml4ZWREaWdpdHMuZXhlYyhhMikgfHwgW107XG4gIGlmIChhUHJlZml4ICE9PSB2b2lkIDApIHtcbiAgICBjb25zdCBbX2IsIGJQcmVmaXgsIGJEaWdpdHMsIGJTdWZmaXhdID0gclByZWZpeGVkRGlnaXRzLmV4ZWMoYjMpIHx8IFtdO1xuICAgIGlmIChiUHJlZml4ID09PSBhUHJlZml4KSB7XG4gICAgICByZXR1cm4gY29tcGFyZU5hdHMoYURpZ2l0cywgYkRpZ2l0cykgfHwgY29tcGFyZVN0cmluZ3MoYVN1ZmZpeCwgYlN1ZmZpeCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBjb21wYXJlU3RyaW5ncyhhMiwgYjMpO1xufTtcbmhhcmRlbihuYXR1cmFsQ29tcGFyZSk7XG5cbi8vXG52YXIgeyBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNywgY3JlYXRlOiBjcmVhdGU1LCBmcm9tRW50cmllczogZnJvbUVudHJpZXMxMSB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czIxIH0gPSBSZWZsZWN0O1xudmFyIG9iamVjdE1ldGFNYXAgPSAob3JpZ2luYWwsIG1ldGFNYXBGbiwgcHJvdG8gPSBPYmplY3QucHJvdG90eXBlKSA9PiB7XG4gIGNvbnN0IGRlc2NzID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczcob3JpZ2luYWwpO1xuICBjb25zdCBrZXlzOCA9IG93bktleXMyMShvcmlnaW5hbCk7XG4gIGNvbnN0IGRlc2NFbnRyaWVzID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBrZXlzOC5tYXAoKGtleSkgPT4gW2tleSwgbWV0YU1hcEZuKGRlc2NzW2tleV0sIGtleSldKS5maWx0ZXIoKFtfa2V5LCBvcHREZXNjXSkgPT4gb3B0RGVzYyAhPT0gdm9pZCAwKVxuICApO1xuICByZXR1cm4gaGFyZGVuKGNyZWF0ZTUocHJvdG8sIGZyb21FbnRyaWVzMTEoZGVzY0VudHJpZXMpKSk7XG59O1xuaGFyZGVuKG9iamVjdE1ldGFNYXApO1xuXG4vL1xudmFyIGZyZWV6ZTggPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgT2JqZWN0LmZyZWV6ZVxuKTtcbnZhciBtYWtlUXVldWUgPSAoKSA9PiB7XG4gIGxldCB7IHByb21pc2U6IHRhaWxQcm9taXNlLCByZXNvbHZlOiB0YWlsUmVzb2x2ZSB9ID0gbWFrZVByb21pc2VLaXQoKTtcbiAgcmV0dXJuIHtcbiAgICBwdXQodmFsdWUpIHtcbiAgICAgIGNvbnN0IHsgcmVzb2x2ZTogcmVzb2x2ZTIsIHByb21pc2UgfSA9IG1ha2VQcm9taXNlS2l0KCk7XG4gICAgICB0YWlsUmVzb2x2ZShmcmVlemU4KHsgdmFsdWUsIHByb21pc2UgfSkpO1xuICAgICAgdGFpbFJlc29sdmUgPSByZXNvbHZlMjtcbiAgICB9LFxuICAgIGdldCgpIHtcbiAgICAgIGNvbnN0IHByb21pc2UgPSB0YWlsUHJvbWlzZS50aGVuKChuZXh0KSA9PiBuZXh0LnZhbHVlKTtcbiAgICAgIHRhaWxQcm9taXNlID0gdGFpbFByb21pc2UudGhlbigobmV4dCkgPT4gbmV4dC5wcm9taXNlKTtcbiAgICAgIHJldHVybiBoYXJkZW4ocHJvbWlzZSk7XG4gICAgfVxuICB9O1xufTtcbmhhcmRlbihtYWtlUXVldWUpO1xudmFyIG1ha2VTdHJlYW0gPSAoYWNrcywgZGF0YSkgPT4ge1xuICBjb25zdCBzdHJlYW0gPSBoYXJkZW4oe1xuICAgIC8qXG5cbiAgICAgKi9cbiAgICBuZXh0KHZhbHVlKSB7XG4gICAgICBkYXRhLnB1dChmcmVlemU4KHsgdmFsdWUsIGRvbmU6IGZhbHNlIH0pKTtcbiAgICAgIHJldHVybiBhY2tzLmdldCgpO1xuICAgIH0sXG4gICAgLypcblxuICAgICAqL1xuICAgIHJldHVybih2YWx1ZSkge1xuICAgICAgZGF0YS5wdXQoZnJlZXplOCh7IHZhbHVlLCBkb25lOiB0cnVlIH0pKTtcbiAgICAgIHJldHVybiBhY2tzLmdldCgpO1xuICAgIH0sXG4gICAgLypcblxuICAgICAqL1xuICAgIHRocm93KGVycm9yKSB7XG4gICAgICBkYXRhLnB1dChoYXJkZW4oUHJvbWlzZS5yZWplY3QoZXJyb3IpKSk7XG4gICAgICByZXR1cm4gYWNrcy5nZXQoKTtcbiAgICB9LFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgICByZXR1cm4gc3RyZWFtO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBzdHJlYW07XG59O1xuaGFyZGVuKG1ha2VTdHJlYW0pO1xudmFyIG1ha2VQaXBlID0gKCkgPT4ge1xuICBjb25zdCBkYXRhID0gbWFrZVF1ZXVlKCk7XG4gIGNvbnN0IGFja3MgPSBtYWtlUXVldWUoKTtcbiAgY29uc3QgcmVhZGVyID0gbWFrZVN0cmVhbShhY2tzLCBkYXRhKTtcbiAgY29uc3Qgd3JpdGVyID0gbWFrZVN0cmVhbShkYXRhLCBhY2tzKTtcbiAgcmV0dXJuIGhhcmRlbihbd3JpdGVyLCByZWFkZXJdKTtcbn07XG5oYXJkZW4obWFrZVBpcGUpO1xudmFyIHB1bXAgPSBhc3luYyAod3JpdGVyLCByZWFkZXIsIHByaW1lcikgPT4ge1xuICBjb25zdCB0aWNrID0gKHByb21pc2UpID0+IEUud2hlbihcbiAgICBwcm9taXNlLFxuICAgIChyZXN1bHQpID0+IHtcbiAgICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgICByZXR1cm4gd3JpdGVyLnJldHVybihyZXN1bHQudmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRvY2sod3JpdGVyLm5leHQocmVzdWx0LnZhbHVlKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICAoZXJyb3IpID0+IHtcbiAgICAgIHJldHVybiB3cml0ZXIudGhyb3coZXJyb3IpO1xuICAgIH1cbiAgKTtcbiAgY29uc3QgdG9jayA9IChwcm9taXNlKSA9PiBFLndoZW4oXG4gICAgcHJvbWlzZSxcbiAgICAocmVzdWx0KSA9PiB7XG4gICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgcmV0dXJuIHJlYWRlci5yZXR1cm4ocmVzdWx0LnZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0aWNrKHJlYWRlci5uZXh0KHJlc3VsdC52YWx1ZSkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgKGVycm9yKSA9PiB7XG4gICAgICByZXR1cm4gcmVhZGVyLnRocm93KGVycm9yKTtcbiAgICB9XG4gICk7XG4gIGF3YWl0IHRpY2socmVhZGVyLm5leHQocHJpbWVyKSk7XG4gIHJldHVybiB2b2lkIDA7XG59O1xuaGFyZGVuKHB1bXApO1xudmFyIHByaW1lID0gKGdlbmVyYXRvciwgcHJpbWVyKSA9PiB7XG4gIGNvbnN0IGZpcnN0ID0gZ2VuZXJhdG9yLm5leHQocHJpbWVyKTtcbiAgbGV0IHJlc3VsdDtcbiAgY29uc3QgcHJpbWVkID0gaGFyZGVuKHtcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgYXN5bmMgbmV4dCh2YWx1ZSkge1xuICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IGZpcnN0O1xuICAgICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZ2VuZXJhdG9yLm5leHQodmFsdWUpO1xuICAgIH0sXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBhc3luYyByZXR1cm4odmFsdWUpIHtcbiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCBmaXJzdDtcbiAgICAgICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGdlbmVyYXRvci5yZXR1cm4odmFsdWUpO1xuICAgIH0sXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgYXN5bmMgdGhyb3coZXJyb3IpIHtcbiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCBmaXJzdDtcbiAgICAgICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBnZW5lcmF0b3IudGhyb3coZXJyb3IpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBwcmltZWQ7XG59O1xuaGFyZGVuKHByaW1lKTtcbnZhciBtYXBSZWFkZXIgPSAocmVhZGVyLCB0cmFuc2Zvcm0pID0+IHtcbiAgYXN5bmMgZnVuY3Rpb24qIHRyYW5zZm9ybUdlbmVyYXRvcigpIHtcbiAgICBmb3IgYXdhaXQgKGNvbnN0IHZhbHVlIG9mIHJlYWRlcikge1xuICAgICAgeWllbGQgdHJhbnNmb3JtKHZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBoYXJkZW4odHJhbnNmb3JtR2VuZXJhdG9yKTtcbiAgcmV0dXJuIGhhcmRlbih0cmFuc2Zvcm1HZW5lcmF0b3IoKSk7XG59O1xuaGFyZGVuKG1hcFJlYWRlcik7XG52YXIgbWFwV3JpdGVyID0gKHdyaXRlciwgdHJhbnNmb3JtKSA9PiB7XG4gIGNvbnN0IHRyYW5zZm9ybWVkV3JpdGVyID0gaGFyZGVuKHtcbiAgICAvKlxuXG4gICAgICovXG4gICAgYXN5bmMgbmV4dCh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHdyaXRlci5uZXh0KHRyYW5zZm9ybSh2YWx1ZSkpO1xuICAgIH0sXG4gICAgLypcblxuICAgICAqL1xuICAgIGFzeW5jIHRocm93KGVycm9yKSB7XG4gICAgICByZXR1cm4gd3JpdGVyLnRocm93KGVycm9yKTtcbiAgICB9LFxuICAgIC8qXG5cbiAgICAgKi9cbiAgICBhc3luYyByZXR1cm4odmFsdWUpIHtcbiAgICAgIHJldHVybiB3cml0ZXIucmV0dXJuKHZhbHVlKTtcbiAgICB9LFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgICByZXR1cm4gdHJhbnNmb3JtZWRXcml0ZXI7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHRyYW5zZm9ybWVkV3JpdGVyO1xufTtcbmhhcmRlbihtYXBXcml0ZXIpO1xuXG4vL1xudmFyIG1ha2VQcm9taXNlID0gKGV4ZWN1dG9yKSA9PiBoYXJkZW4obmV3IFByb21pc2UoZXhlY3V0b3IpKTtcbmhhcmRlbihtYWtlUHJvbWlzZSk7XG52YXIgbWFrZU1hcCA9IChlbnRyaWVzT3JJdGVyYWJsZSkgPT4gaGFyZGVuKG5ldyBNYXAoZW50cmllc09ySXRlcmFibGUpKTtcbmhhcmRlbihtYWtlTWFwKTtcbnZhciBtYWtlU2V0ID0gKHZhbHVlczgpID0+IGhhcmRlbihuZXcgU2V0KHZhbHVlczgpKTtcbmhhcmRlbihtYWtlU2V0KTtcbnZhciBtYWtlV2Vha01hcCA9IChlbnRyaWVzMTApID0+IGhhcmRlbihuZXcgV2Vha01hcChlbnRyaWVzMTApKTtcbmhhcmRlbihtYWtlV2Vha01hcCk7XG52YXIgbWFrZVdlYWtTZXQgPSAodmFsdWVzOCkgPT4gaGFyZGVuKG5ldyBXZWFrU2V0KHZhbHVlczgpKTtcbmhhcmRlbihtYWtlV2Vha1NldCk7XG5cbi8vXG52YXIgYXN5bmNHZW5lcmF0ZSA9IChuZXh0KSA9PiB7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBuZXh0OiBhc3luYyAoKSA9PiBoYXJkZW4obmV4dCgpKVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4oYXN5bmNHZW5lcmF0ZSk7XG5cbi8vXG52YXIgYXN5bmNEb1doaWxlID0gKGJvZHkpID0+IHtcbiAgcmV0dXJuIG1ha2VQcm9taXNlKChyZXNvbHZlMiwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3QgbG9vcCA9IGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRvQ29udGludWUgPSBhd2FpdCBib2R5KCk7XG4gICAgICBpZiAoIWRvQ29udGludWUpIHtcbiAgICAgICAgcmVzb2x2ZTIodm9pZCAwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbG9vcCgpLmNhdGNoKHJlamVjdCk7XG4gICAgfTtcbiAgICBsb29wKCkuY2F0Y2gocmVqZWN0KTtcbiAgfSk7XG59O1xuaGFyZGVuKGFzeW5jRG9XaGlsZSk7XG5cbi8vXG52YXIgeyBmcm9tRW50cmllczogZnJvbUVudHJpZXMxMiwga2V5cywgdmFsdWVzOiB2YWx1ZXM0IH0gPSBPYmplY3Q7XG52YXIgbWFrZUxpbWl0ZWRDb25zb2xlID0gKG1ha2VMb2dnZXIpID0+IHtcbiAgY29uc3QgbGltaXRlZENvbnNvbGUgPSAoXG4gICAgLyogICAgICAgICAgICAgICovXG4gICAgZnJvbUVudHJpZXMxMihsb2dMZXZlbHMubWFwKChsZXZlbCkgPT4gW2xldmVsLCBtYWtlTG9nZ2VyKGxldmVsKV0pKVxuICApO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgaGFyZGVuKGxpbWl0ZWRDb25zb2xlKVxuICApO1xufTtcbmhhcmRlbihtYWtlTGltaXRlZENvbnNvbGUpO1xudmFyIGFzc2VydEFsbERlZmluZWQgPSAob2JqKSA9PiB7XG4gIGNvbnN0IG1pc3NpbmcyID0gW107XG4gIGZvciAoY29uc3QgW2tleSwgdmFsXSBvZiBPYmplY3QuZW50cmllcyhvYmopKSB7XG4gICAgaWYgKHZhbCA9PT0gdm9pZCAwKSB7XG4gICAgICBtaXNzaW5nMi5wdXNoKGtleSk7XG4gICAgfVxuICB9XG4gIGlmIChtaXNzaW5nMi5sZW5ndGggPiAwKSB7XG4gICAgdGhyb3dSZWRhY3RlZGBtaXNzaW5nICR7cXVvdGUobWlzc2luZzIpfWA7XG4gIH1cbn07XG52YXIgbm90RG9uZSA9IGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZTogdm9pZCAwIH0pO1xudmFyIGFsd2F5c0RvbmUgPSBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogdm9pZCAwIH0pO1xudmFyIGZvcmV2ZXIgPSBhc3luY0dlbmVyYXRlKCgpID0+IG5vdERvbmUpO1xudmFyIHppcCA9ICh4cywgeXMpID0+IGhhcmRlbih4cy5tYXAoKHgsIGkzKSA9PiBbeCwgeXNbK2kzXV0pKTtcbnZhciBhbGxWYWx1ZXMgPSBhc3luYyAob2JqKSA9PiB7XG4gIGNvbnN0IHJlc29sdmVkID0gYXdhaXQgUHJvbWlzZS5hbGwodmFsdWVzNChvYmopKTtcbiAgcmV0dXJuIGhhcmRlbihmcm9tRW50cmllczEyKHppcChrZXlzKG9iaiksIHJlc29sdmVkKSkpO1xufTtcblxuLy9cbnZhciBtdXN0TWF0Y2gzID0gbXVzdE1hdGNoO1xuXG4vL1xudmFyIFN0b3JhZ2VOb2RlU2hhcGUgPSBNLnJlbW90YWJsZShcIlN0b3JhZ2VOb2RlXCIpO1xudmFyIFVuZ3VhcmRlZEhlbHBlckkgPSBNLmludGVyZmFjZShcbiAgXCJoZWxwZXJcIixcbiAge30sXG4gIC8vXG4gIHsgc2xvcHB5OiB0cnVlIH1cbik7XG52YXIgQnJpZGdlQmlnSW50U2hhcGUgPSBNLm9yKE0ubnVtYmVyKCksIE0uc3RyaW5nKCkpO1xuXG4vL1xudmFyIHsgZnJlZXplOiBmcmVlemU5IH0gPSBPYmplY3Q7XG52YXIgcGFkZGluZyA9IFwiPVwiO1xudmFyIGFscGhhYmV0NjQgPSBcIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky9cIjtcbnZhciBtb25vZHU2NCA9IHt9O1xuZm9yIChsZXQgaTMgPSAwOyBpMyA8IGFscGhhYmV0NjQubGVuZ3RoOyBpMyArPSAxKSB7XG4gIGNvbnN0IGMyID0gYWxwaGFiZXQ2NFtpM107XG4gIG1vbm9kdTY0W2MyXSA9IGkzO1xufVxuZnJlZXplOShtb25vZHU2NCk7XG5cbi8vXG52YXIganNFbmNvZGVCYXNlNjQgPSAoZGF0YSkgPT4ge1xuICBsZXQgc3RyaW5nID0gXCJcIjtcbiAgbGV0IHJlZ2lzdGVyID0gMDtcbiAgbGV0IHF1YW50dW0gPSAwO1xuICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgZGF0YS5sZW5ndGg7IGkzICs9IDEpIHtcbiAgICBjb25zdCBiMyA9IGRhdGFbaTNdO1xuICAgIHJlZ2lzdGVyID0gcmVnaXN0ZXIgPDwgOCB8IGIzO1xuICAgIHF1YW50dW0gKz0gODtcbiAgICBpZiAocXVhbnR1bSA9PT0gMjQpIHtcbiAgICAgIHN0cmluZyArPSBhbHBoYWJldDY0W3JlZ2lzdGVyID4+PiAxOCAmIDYzXSArIGFscGhhYmV0NjRbcmVnaXN0ZXIgPj4+IDEyICYgNjNdICsgYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gNiAmIDYzXSArIGFscGhhYmV0NjRbcmVnaXN0ZXIgPj4+IDAgJiA2M107XG4gICAgICByZWdpc3RlciA9IDA7XG4gICAgICBxdWFudHVtID0gMDtcbiAgICB9XG4gIH1cbiAgc3dpdGNoIChxdWFudHVtKSB7XG4gICAgY2FzZSAwOlxuICAgICAgYnJlYWs7XG4gICAgY2FzZSA4OlxuICAgICAgc3RyaW5nICs9IGFscGhhYmV0NjRbcmVnaXN0ZXIgPj4+IDIgJiA2M10gKyBhbHBoYWJldDY0W3JlZ2lzdGVyIDw8IDQgJiA2M10gKyBwYWRkaW5nICsgcGFkZGluZztcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMTY6XG4gICAgICBzdHJpbmcgKz0gYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gMTAgJiA2M10gKyBhbHBoYWJldDY0W3JlZ2lzdGVyID4+PiA0ICYgNjNdICsgYWxwaGFiZXQ2NFtyZWdpc3RlciA8PCAyICYgNjNdICsgcGFkZGluZztcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBFcnJvcihgaW50ZXJuYWw6IGJhZCBxdWFudHVtICR7cXVhbnR1bX1gKTtcbiAgfVxuICByZXR1cm4gc3RyaW5nO1xufTtcbnZhciBlbmNvZGVCYXNlNjQgPSBnbG9iYWxUaGlzLkJhc2U2NCAhPT0gdm9pZCAwID8gZ2xvYmFsVGhpcy5CYXNlNjQuZW5jb2RlIDoganNFbmNvZGVCYXNlNjQ7XG5cbi8vXG52YXIganNEZWNvZGVCYXNlNjQgPSAoc3RyaW5nLCBuYW1lID0gXCI8dW5rbm93bj5cIikgPT4ge1xuICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoTWF0aC5jZWlsKHN0cmluZy5sZW5ndGggKiA0IC8gMykpO1xuICBsZXQgcmVnaXN0ZXIgPSAwO1xuICBsZXQgcXVhbnR1bSA9IDA7XG4gIGxldCBpMyA9IDA7XG4gIGxldCBqID0gMDtcbiAgd2hpbGUgKGkzIDwgc3RyaW5nLmxlbmd0aCAmJiBzdHJpbmdbaTNdICE9PSBwYWRkaW5nKSB7XG4gICAgY29uc3QgbnVtYmVyMiA9IG1vbm9kdTY0W3N0cmluZ1tpM11dO1xuICAgIGlmIChudW1iZXIyID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IEVycm9yKGBJbnZhbGlkIGJhc2U2NCBjaGFyYWN0ZXIgJHtzdHJpbmdbaTNdfSBpbiBzdHJpbmcgJHtuYW1lfWApO1xuICAgIH1cbiAgICByZWdpc3RlciA9IHJlZ2lzdGVyIDw8IDYgfCBudW1iZXIyO1xuICAgIHF1YW50dW0gKz0gNjtcbiAgICBpZiAocXVhbnR1bSA+PSA4KSB7XG4gICAgICBxdWFudHVtIC09IDg7XG4gICAgICBkYXRhW2pdID0gcmVnaXN0ZXIgPj4+IHF1YW50dW07XG4gICAgICBqICs9IDE7XG4gICAgICByZWdpc3RlciAmPSAoMSA8PCBxdWFudHVtKSAtIDE7XG4gICAgfVxuICAgIGkzICs9IDE7XG4gIH1cbiAgd2hpbGUgKHF1YW50dW0gPiAwKSB7XG4gICAgaWYgKGkzID09PSBzdHJpbmcubGVuZ3RoIHx8IHN0cmluZ1tpM10gIT09IHBhZGRpbmcpIHtcbiAgICAgIHRocm93IEVycm9yKGBNaXNzaW5nIHBhZGRpbmcgYXQgb2Zmc2V0ICR7aTN9IG9mIHN0cmluZyAke25hbWV9YCk7XG4gICAgfVxuICAgIGkzICs9IDE7XG4gICAgcXVhbnR1bSAtPSAyO1xuICB9XG4gIGlmIChpMyA8IHN0cmluZy5sZW5ndGgpIHtcbiAgICB0aHJvdyBFcnJvcihcbiAgICAgIGBCYXNlNjQgc3RyaW5nIGhhcyB0cmFpbGluZyBnYXJiYWdlICR7c3RyaW5nLnN1YnN0cihcbiAgICAgICAgaTNcbiAgICAgICl9IGluIHN0cmluZyAke25hbWV9YFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGRhdGEuc3ViYXJyYXkoMCwgaik7XG59O1xudmFyIGFkYXB0RGVjb2RlciA9IChuYXRpdmVEZWNvZGVCYXNlNjQpID0+ICguLi5hcmdzKSA9PiB7XG4gIGNvbnN0IGRlY29kZWQgPSBuYXRpdmVEZWNvZGVCYXNlNjQoLi4uYXJncyk7XG4gIGlmIChkZWNvZGVkIGluc3RhbmNlb2YgVWludDhBcnJheSkge1xuICAgIHJldHVybiBkZWNvZGVkO1xuICB9XG4gIHJldHVybiBuZXcgVWludDhBcnJheShkZWNvZGVkKTtcbn07XG52YXIgZGVjb2RlQmFzZTY0ID0gZ2xvYmFsVGhpcy5CYXNlNjQgIT09IHZvaWQgMCA/IGFkYXB0RGVjb2RlcihnbG9iYWxUaGlzLkJhc2U2NC5kZWNvZGUpIDoganNEZWNvZGVCYXNlNjQ7XG5cbi8vXG52YXIgYXRvYjIgPSAoZW5jb2RlZERhdGEpID0+IHtcbiAgY29uc3QgYnVmID0gZGVjb2RlQmFzZTY0KGVuY29kZWREYXRhKTtcbiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uYnVmKTtcbn07XG5cbi8vXG52YXIgY29lcmNlVG9CeXRlQXJyYXkgPSAoY29udGVudHMpID0+IHtcbiAgaWYgKHR5cGVvZiBjb250ZW50cyA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiBVaW50OEFycmF5LmZyb20oY29udGVudHMsIChjMikgPT4ge1xuICAgICAgY29uc3QgYjMgPSBjMi5jaGFyQ29kZUF0KDApO1xuICAgICAgYjMgPD0gMjU1IHx8IHRocm93UmVkYWN0ZWRgY2hhcmFjdGVyIGNhbm5vdCBiZSBjb2VyY2VkIHRvIGFuIG9jdGV0OiAke2MyfWA7XG4gICAgICByZXR1cm4gYjM7XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoY29udGVudHMgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG4gICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KFxuICAgICAgY29udGVudHMuYnVmZmVyLFxuICAgICAgY29udGVudHMuYnl0ZU9mZnNldCxcbiAgICAgIGNvbnRlbnRzLmJ5dGVMZW5ndGhcbiAgICApO1xuICB9XG4gIHJldHVybiBuZXcgVWludDhBcnJheShjb250ZW50cyk7XG59O1xuZnVuY3Rpb24gdG9CeXRlcyhieXRlU291cmNlKSB7XG4gIGNvbnN0IGJ1ZiA9IGNvZXJjZVRvQnl0ZUFycmF5KGJ5dGVTb3VyY2UpO1xuICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSguLi5idWYpO1xufVxuZnVuY3Rpb24gYmFzZTY0VG9CeXRlcyhzdHJpbmcpIHtcbiAgcmV0dXJuIHRvQnl0ZXMoZGVjb2RlQmFzZTY0KHN0cmluZykpO1xufVxuXG4vL1xudmFyIFNoYXBlMSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIC8qXG5cblxuICAgICAqL1xuICAgIERhdGE6IE0uc3RyaW5nKCksXG4gICAgQnl0ZXM6IE0uc3RyaW5nKCksXG4gICAgRW5kcG9pbnQ6IE0uc3RyaW5nKCksXG4gICAgVm93OiBNLnRhZ2dlZChcbiAgICAgIFwiVm93XCIsXG4gICAgICBoYXJkZW4oe1xuICAgICAgICB2b3dWMDogTS5yZW1vdGFibGUoXCJWb3dWMFwiKVxuICAgICAgfSlcbiAgICApLFxuICAgIENvbm5lY3Rpb25IYW5kbGVyOiBNLnJlbW90YWJsZShcIkNvbm5lY3Rpb25IYW5kbGVyXCIpLFxuICAgIENvbm5lY3Rpb246IE0ucmVtb3RhYmxlKFwiQ29ubmVjdGlvblwiKSxcbiAgICBJbmJvdW5kQXR0ZW1wdDogTS5yZW1vdGFibGUoXCJJbmJvdW5kQXR0ZW1wdFwiKSxcbiAgICBMaXN0ZW5lcjogTS5yZW1vdGFibGUoXCJMaXN0ZW5lclwiKSxcbiAgICBMaXN0ZW5IYW5kbGVyOiBNLnJlbW90YWJsZShcIkxpc3RlbkhhbmRsZXJcIiksXG4gICAgUG9ydDogTS5yZW1vdGFibGUoXCJQb3J0XCIpLFxuICAgIFByb3RvY29sSGFuZGxlcjogTS5yZW1vdGFibGUoXCJQcm90b2NvbEhhbmRsZXJcIiksXG4gICAgUHJvdG9jb2xJbXBsOiBNLnJlbW90YWJsZShcIlByb3RvY29sSW1wbFwiKVxuICB9XG4pO1xudmFyIFNlbmRPcHRpb25zU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7fSxcbiAgeyByZWxhdGl2ZVRpbWVvdXROczogTS5iaWdpbnQoKSB9XG4pO1xudmFyIFNoYXBlMiA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIC4uLlNoYXBlMSxcbiAgICBWb3ckOiAoc2hhcGUpID0+IE0ub3Ioc2hhcGUsIFNoYXBlMS5Wb3cpLFxuICAgIEF0dGVtcHREZXNjcmlwdGlvbjogTS5zcGxpdFJlY29yZChcbiAgICAgIHsgaGFuZGxlcjogU2hhcGUxLkNvbm5lY3Rpb25IYW5kbGVyIH0sXG4gICAgICB7IHJlbW90ZUFkZHJlc3M6IFNoYXBlMS5FbmRwb2ludCwgbG9jYWxBZGRyZXNzOiBTaGFwZTEuRW5kcG9pbnQgfVxuICAgICksXG4gICAgT3B0czogU2VuZE9wdGlvbnNTaGFwZVxuICB9XG4pO1xudmFyIFNoYXBlID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBoYXJkZW4oe1xuICAgIC4uLlNoYXBlMixcbiAgICBDb25uZWN0aW9uSToge1xuICAgICAgY29ubmVjdGlvbjogTS5pbnRlcmZhY2UoXCJDb25uZWN0aW9uXCIsIHtcbiAgICAgICAgc2VuZDogTS5jYWxsV2hlbihTaGFwZTIuRGF0YSkub3B0aW9uYWwoU2hhcGUyLk9wdHMpLnJldHVybnMoU2hhcGUyLlZvdyQoU2hhcGUyLkJ5dGVzKSksXG4gICAgICAgIGNsb3NlOiBNLmNhbGxXaGVuKCkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSksXG4gICAgICAgIGdldExvY2FsQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhTaGFwZTIuRW5kcG9pbnQpLFxuICAgICAgICBnZXRSZW1vdGVBZGRyZXNzOiBNLmNhbGwoKS5yZXR1cm5zKFNoYXBlMi5FbmRwb2ludClcbiAgICAgIH0pLFxuICAgICAgb3BlbkNvbm5lY3Rpb25BY2tXYXRjaGVyOiBNLmludGVyZmFjZShcIk9wZW5Db25uZWN0aW9uQWNrV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJSZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXJcIiwge1xuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHNpbmtXYXRjaGVyOiBNLmludGVyZmFjZShcIlNpbmtXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoKVxuICAgICAgfSlcbiAgICB9LFxuICAgIEluYm91bmRBdHRlbXB0SToge1xuICAgICAgaW5ib3VuZEF0dGVtcHQ6IE0uaW50ZXJmYWNlKFwiSW5ib3VuZEF0dGVtcHRcIiwge1xuICAgICAgICBhY2NlcHQ6IE0uY2FsbFdoZW4oU2hhcGUyLkF0dGVtcHREZXNjcmlwdGlvbikucmV0dXJucyhcbiAgICAgICAgICBTaGFwZTIuVm93JChTaGFwZTIuQ29ubmVjdGlvbilcbiAgICAgICAgKSxcbiAgICAgICAgZ2V0TG9jYWxBZGRyZXNzOiBNLmNhbGwoKS5yZXR1cm5zKFNoYXBlMi5FbmRwb2ludCksXG4gICAgICAgIGdldFJlbW90ZUFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoU2hhcGUyLkVuZHBvaW50KSxcbiAgICAgICAgY2xvc2U6IE0uY2FsbFdoZW4oKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpKVxuICAgICAgfSksXG4gICAgICBpbmJvdW5kQXR0ZW1wdEFjY2VwdFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiSW5ib3VuZEF0dGVtcHRBY2NlcHRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyOiBNLmludGVyZmFjZShcIlJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgc2lua1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiU2lua1dhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucygpXG4gICAgICB9KVxuICAgIH0sXG4gICAgUG9ydEk6IHtcbiAgICAgIHBvcnQ6IE0uaW50ZXJmYWNlKFwiUG9ydFwiLCB7XG4gICAgICAgIGdldExvY2FsQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhTaGFwZTIuRW5kcG9pbnQpLFxuICAgICAgICBhZGRMaXN0ZW5lcjogTS5jYWxsV2hlbihTaGFwZTIuTGlzdGVuZXIpLnJldHVybnMoXG4gICAgICAgICAgU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSlcbiAgICAgICAgKSxcbiAgICAgICAgY29ubmVjdDogTS5jYWxsV2hlbihTaGFwZTIuRW5kcG9pbnQpLm9wdGlvbmFsKFNoYXBlMi5Db25uZWN0aW9uSGFuZGxlcikucmV0dXJucyhTaGFwZTIuVm93JChTaGFwZTIuQ29ubmVjdGlvbikpLFxuICAgICAgICByZW1vdmVMaXN0ZW5lcjogTS5jYWxsV2hlbihTaGFwZTIuTGlzdGVuZXIpLnJldHVybnMoXG4gICAgICAgICAgU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSlcbiAgICAgICAgKSxcbiAgICAgICAgcmV2b2tlOiBNLmNhbGxXaGVuKCkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSlcbiAgICAgIH0pLFxuICAgICAgcG9ydEFkZExpc3RlbmVyV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQb3J0QWRkTGlzdGVuZXJXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcG9ydFJlbW92ZUxpc3RlbmVyV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQb3J0UmVtb3ZlTGlzdGVuZXJXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcG9ydENvbm5lY3RXYXRjaGVyOiBNLmludGVyZmFjZShcIlBvcnRDb25uZWN0V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHBvcnRSZXZva2VXYXRjaGVyOiBNLmludGVyZmFjZShcIlBvcnRSZXZva2VXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcG9ydFJldm9rZUNsZWFudXBXYXRjaGVyOiBNLmludGVyZmFjZShcIlBvcnRSZXZva2VDbGVhbnVwV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJSZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXJcIiwge1xuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHNpbmtXYXRjaGVyOiBNLmludGVyZmFjZShcIlNpbmtXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoKSxcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSlcbiAgICB9LFxuICAgIFByb3RvY29sSGFuZGxlckk6IHtcbiAgICAgIHByb3RvY29sSGFuZGxlcjogTS5pbnRlcmZhY2UoXCJQcm90b2NvbEhhbmRsZXJcIiwge1xuICAgICAgICBvbkNyZWF0ZTogTS5jYWxsV2hlbihNLnJlbW90YWJsZSgpLCBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyKS5yZXR1cm5zKFxuICAgICAgICAgIFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpXG4gICAgICAgICksXG4gICAgICAgIGdlbmVyYXRlUG9ydElEOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChNLnN0cmluZygpKSksXG4gICAgICAgIG9uQmluZDogTS5jYWxsV2hlbihcbiAgICAgICAgICBTaGFwZTIuUG9ydCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLlByb3RvY29sSGFuZGxlclxuICAgICAgICApLnJldHVybnMoU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSkpLFxuICAgICAgICBvbkxpc3RlbjogTS5jYWxsV2hlbihcbiAgICAgICAgICBTaGFwZTIuUG9ydCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLkxpc3RlbkhhbmRsZXIsXG4gICAgICAgICAgU2hhcGUyLlByb3RvY29sSGFuZGxlclxuICAgICAgICApLnJldHVybnMoU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSkpLFxuICAgICAgICBvbkxpc3RlblJlbW92ZTogTS5jYWxsV2hlbihcbiAgICAgICAgICBTaGFwZTIuUG9ydCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLkxpc3RlbkhhbmRsZXIsXG4gICAgICAgICAgU2hhcGUyLlByb3RvY29sSGFuZGxlclxuICAgICAgICApLnJldHVybnMoU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSkpLFxuICAgICAgICBvbkluc3RhbnRpYXRlOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLlByb3RvY29sSGFuZGxlclxuICAgICAgICApLnJldHVybnMoU2hhcGUyLlZvdyQoU2hhcGUyLkVuZHBvaW50KSksXG4gICAgICAgIG9uQ29ubmVjdDogTS5jYWxsV2hlbihcbiAgICAgICAgICBTaGFwZTIuUG9ydCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5Db25uZWN0aW9uSGFuZGxlcixcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChTaGFwZTIuQXR0ZW1wdERlc2NyaXB0aW9uKSksXG4gICAgICAgIG9uUmV2b2tlOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSlcbiAgICAgIH0pLFxuICAgICAgcHJvdG9jb2xIYW5kbGVyQWNjZXB0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQcm90b2NvbEhhbmRsZXJBY2NlcHRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcHJvdG9jb2xIYW5kbGVySW5zdGFudGlhdGVXYXRjaGVyOiBNLmludGVyZmFjZShcbiAgICAgICAgXCJQcm90b2NvbEhhbmRsZXJJbnN0YW50aWF0ZVdhdGNoZXJcIixcbiAgICAgICAge1xuICAgICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICBwcm90b2NvbEhhbmRsZXJDb25uZWN0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICAgIFwiUHJvdG9jb2xIYW5kbGVyQ29ubmVjdFdhdGNoZXJcIixcbiAgICAgICAge1xuICAgICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICByZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyXCIsIHtcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSlcbiAgICB9LFxuICAgIFByb3RvY29sSW1wbEk6IE0uaW50ZXJmYWNlKFwiUHJvdG9jb2xJbXBsXCIsIHtcbiAgICAgIGJpbmRQb3J0OiBNLmNhbGxXaGVuKFNoYXBlMi5FbmRwb2ludCkucmV0dXJucyhTaGFwZTIuVm93JChTaGFwZTIuUG9ydCkpLFxuICAgICAgaW5ib3VuZDogTS5jYWxsV2hlbihTaGFwZTIuRW5kcG9pbnQsIFNoYXBlMi5FbmRwb2ludCkucmV0dXJucyhcbiAgICAgICAgU2hhcGUyLlZvdyQoU2hhcGUyLkluYm91bmRBdHRlbXB0KVxuICAgICAgKSxcbiAgICAgIG91dGJvdW5kOiBNLmNhbGxXaGVuKFxuICAgICAgICBTaGFwZTIuUG9ydCxcbiAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICBTaGFwZTIuQ29ubmVjdGlvbkhhbmRsZXJcbiAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChTaGFwZTIuQ29ubmVjdGlvbikpXG4gICAgfSlcbiAgfSlcbik7XG5cbi8vXG52YXIgc2luayA9ICgpID0+IHtcbn07XG5oYXJkZW4oc2luayk7XG52YXIgQ0xPU0VfUkVBU09OX0ZJTkFMSVpFUiA9IFwiY2xvc2VkLWJ5LWZpbmFsaXplclwiO1xudmFyIFJldm9rZVN0YXRlID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgTk9UX1JFVk9LRUQ6IDAsXG4gICAgUkVWT0tJTkc6IDEsXG4gICAgUkVWT0tFRDogMlxuICB9XG4pO1xuaGFyZGVuKFJldm9rZVN0YXRlKTtcbnZhciBwcmVwYXJlRmluYWxpemVyID0gKHpvbmUsIHsgd2F0Y2ggfSkgPT4ge1xuICBjb25zdCBvYmpUb0ZpbmFsaXplckluZm8gPSB6b25lLm1hcFN0b3JlKFwib2JqVG9GaW5hbGl6ZXJJbmZvXCIpO1xuICByZXR1cm4gem9uZS5leG8oXCJOZXR3b3JrRmluYWxpemVyXCIsIHZvaWQgMCwge1xuICAgIGhhcyhvYmopIHtcbiAgICAgIHJldHVybiBvYmpUb0ZpbmFsaXplckluZm8uaGFzKG9iaik7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgaW5pdENvbm5lY3Rpb24oY29ubiwgaGFuZGxlcikge1xuICAgICAgb2JqVG9GaW5hbGl6ZXJJbmZvLmluaXQoY29ubiwgaGFyZGVuKHsgY29ubiwgaGFuZGxlciB9KSk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuICAgICAqL1xuICAgIGluaXRDbG9zZXIoY2xvc2VyKSB7XG4gICAgICBvYmpUb0ZpbmFsaXplckluZm8uaW5pdChjbG9zZXIsIGhhcmRlbih7IGNsb3NlciB9KSk7XG4gICAgfSxcbiAgICBmaW5hbGl6ZShvYmopIHtcbiAgICAgIGlmICghb2JqVG9GaW5hbGl6ZXJJbmZvLmhhcyhvYmopKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRpc3Bvc2VJbmZvID0gb2JqVG9GaW5hbGl6ZXJJbmZvLmdldChvYmopO1xuICAgICAgaWYgKFwiY29ublwiIGluIGRpc3Bvc2VJbmZvKSB7XG4gICAgICAgIGNvbnN0IHsgY29ubiwgaGFuZGxlciB9ID0gZGlzcG9zZUluZm87XG4gICAgICAgIG9ialRvRmluYWxpemVySW5mby5kZWxldGUob2JqKTtcbiAgICAgICAgcmV0dXJuIHdhdGNoKEUoaGFuZGxlcikub25DbG9zZShjb25uLCBDTE9TRV9SRUFTT05fRklOQUxJWkVSLCBoYW5kbGVyKSk7XG4gICAgICB9IGVsc2UgaWYgKFwiY2xvc2VyXCIgaW4gZGlzcG9zZUluZm8pIHtcbiAgICAgICAgY29uc3QgeyBjbG9zZXIgfSA9IGRpc3Bvc2VJbmZvO1xuICAgICAgICBvYmpUb0ZpbmFsaXplckluZm8uZGVsZXRlKG9iaik7XG4gICAgICAgIHJldHVybiB3YXRjaChFKGNsb3NlcikuY2xvc2UoKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICB1bnBpbihvYmopIHtcbiAgICAgIG9ialRvRmluYWxpemVySW5mby5kZWxldGUob2JqKTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihwcmVwYXJlRmluYWxpemVyKTtcblxuLy9cbnZhciBSb3V0ZXJJID0gTS5pbnRlcmZhY2UoXCJSb3V0ZXJcIiwge1xuICBnZXRSb3V0ZXM6IE0uY2FsbChTaGFwZS5FbmRwb2ludCkucmV0dXJucyhNLmFycmF5T2YoW00uc3RyaW5nKCksIE0uYW55KCldKSksXG4gIHJlZ2lzdGVyOiBNLmNhbGwoTS5zdHJpbmcoKSwgTS5hbnkoKSkucmV0dXJucyhNLnVuZGVmaW5lZCgpKSxcbiAgdW5yZWdpc3RlcjogTS5jYWxsKE0uc3RyaW5nKCksIE0uYW55KCkpLnJldHVybnMoTS51bmRlZmluZWQoKSlcbn0pO1xuXG4vL1xudmFyIFZhdERhdGFHbG9iYWw7XG5pZiAoXCJWYXREYXRhXCIgaW4gZ2xvYmFsVGhpcykge1xuICBnbG9iYWxUaGlzLlZhdERhdGEgfHwgdGhyb3dSZWRhY3RlZGBWYXREYXRhIGRlZmluZWQgaW4gZ2xvYmFsIGFzIG51bGwgb3IgdW5kZWZpbmVkYDtcbiAgVmF0RGF0YUdsb2JhbCA9IC8qICAgICAgICAgICAgICAqL1xuICBnbG9iYWxUaGlzLlZhdERhdGE7XG59IGVsc2Uge1xuICBjb25zdCB1bmF2YWlsYWJsZSA9ICgpID0+IHRocm93UmVkYWN0ZWRgVmF0RGF0YSB1bmF2YWlsYWJsZWA7XG4gIFZhdERhdGFHbG9iYWwgPSB7XG4gICAgZGVmaW5lS2luZDogdW5hdmFpbGFibGUsXG4gICAgZGVmaW5lS2luZE11bHRpOiB1bmF2YWlsYWJsZSxcbiAgICBkZWZpbmVEdXJhYmxlS2luZDogdW5hdmFpbGFibGUsXG4gICAgZGVmaW5lRHVyYWJsZUtpbmRNdWx0aTogdW5hdmFpbGFibGUsXG4gICAgbWFrZUtpbmRIYW5kbGU6IHVuYXZhaWxhYmxlLFxuICAgIHByb3ZpZGVQcm9taXNlV2F0Y2hlcjogdW5hdmFpbGFibGUsXG4gICAgd2F0Y2hQcm9taXNlOiB1bmF2YWlsYWJsZSxcbiAgICBtYWtlU2NhbGFyQmlnTWFwU3RvcmU6IHVuYXZhaWxhYmxlLFxuICAgIG1ha2VTY2FsYXJCaWdXZWFrTWFwU3RvcmU6IHVuYXZhaWxhYmxlLFxuICAgIG1ha2VTY2FsYXJCaWdTZXRTdG9yZTogdW5hdmFpbGFibGUsXG4gICAgbWFrZVNjYWxhckJpZ1dlYWtTZXRTdG9yZTogdW5hdmFpbGFibGUsXG4gICAgY2FuQmVEdXJhYmxlOiB1bmF2YWlsYWJsZVxuICB9O1xufVxudmFyIFZhdERhdGFFeHBvcnQgPSBWYXREYXRhR2xvYmFsO1xudmFyIHtcbiAgZGVmaW5lS2luZCxcbiAgZGVmaW5lS2luZE11bHRpLFxuICBkZWZpbmVEdXJhYmxlS2luZCxcbiAgZGVmaW5lRHVyYWJsZUtpbmRNdWx0aVxufSA9IFZhdERhdGFHbG9iYWw7XG52YXIge1xuICBtYWtlS2luZEhhbmRsZSxcbiAgcHJvdmlkZVByb21pc2VXYXRjaGVyLFxuICB3YXRjaFByb21pc2U6IHdhdGNoUHJvbWlzZTIsXG4gIG1ha2VTY2FsYXJCaWdNYXBTdG9yZSxcbiAgbWFrZVNjYWxhckJpZ1dlYWtNYXBTdG9yZSxcbiAgbWFrZVNjYWxhckJpZ1NldFN0b3JlLFxuICBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlLFxuICBjYW5CZUR1cmFibGVcbn0gPSBWYXREYXRhR2xvYmFsO1xudmFyIHBpY2tGYWNldCA9IChtYWtlciwgZmFjZXROYW1lKSA9PiAoLi4uYXJncykgPT4gbWFrZXIoLi4uYXJncylbZmFjZXROYW1lXTtcbmhhcmRlbihwaWNrRmFjZXQpO1xudmFyIHBhcnRpYWxBc3NpZ24gPSAodGFyZ2V0LCBzb3VyY2UpID0+IHtcbiAgT2JqZWN0LmFzc2lnbih0YXJnZXQsIHNvdXJjZSk7XG59O1xuaGFyZGVuKHBhcnRpYWxBc3NpZ24pO1xudmFyIHByb3ZpZGUgPSAoXG4gIC8vXG4gIC8qXG5cblxuXG5cblxuICAgKi9cbiAgcHJvdmlkZUxhenlcbik7XG52YXIgbWFrZVN0b3JlVXRpbHMgPSAoVmF0RGF0YSkgPT4ge1xuICBjb25zdCB7XG4gICAgLy9cbiAgICBtYWtlU2NhbGFyQmlnTWFwU3RvcmU6IG1ha2VTY2FsYXJCaWdNYXBTdG9yZTIsXG4gICAgLy9cbiAgICBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlOiBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlMixcbiAgICAvL1xuICAgIG1ha2VTY2FsYXJCaWdTZXRTdG9yZTogbWFrZVNjYWxhckJpZ1NldFN0b3JlMixcbiAgICAvL1xuICAgIG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmU6IG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmUyXG4gIH0gPSBWYXREYXRhO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZU1hcFN0b3JlMiA9IChiYWdnYWdlLCBuYW1lLCBvcHRpb25zID0ge30pID0+IHByb3ZpZGUoXG4gICAgYmFnZ2FnZSxcbiAgICBuYW1lLFxuICAgICgpID0+IG1ha2VTY2FsYXJCaWdNYXBTdG9yZTIobmFtZSwgeyBkdXJhYmxlOiB0cnVlLCAuLi5vcHRpb25zIH0pXG4gICk7XG4gIGhhcmRlbihwcm92aWRlRHVyYWJsZU1hcFN0b3JlMik7XG4gIGNvbnN0IHByb3ZpZGVEdXJhYmxlV2Vha01hcFN0b3JlMiA9IChiYWdnYWdlLCBuYW1lLCBvcHRpb25zID0ge30pID0+IHByb3ZpZGUoXG4gICAgYmFnZ2FnZSxcbiAgICBuYW1lLFxuICAgICgpID0+IG1ha2VTY2FsYXJCaWdXZWFrTWFwU3RvcmUyKG5hbWUsIHsgZHVyYWJsZTogdHJ1ZSwgLi4ub3B0aW9ucyB9KVxuICApO1xuICBoYXJkZW4ocHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmUyKTtcbiAgY29uc3QgcHJvdmlkZUR1cmFibGVTZXRTdG9yZTIgPSAoYmFnZ2FnZSwgbmFtZSwgb3B0aW9ucyA9IHt9KSA9PiBwcm92aWRlKFxuICAgIGJhZ2dhZ2UsXG4gICAgbmFtZSxcbiAgICAoKSA9PiBtYWtlU2NhbGFyQmlnU2V0U3RvcmUyKG5hbWUsIHsgZHVyYWJsZTogdHJ1ZSwgLi4ub3B0aW9ucyB9KVxuICApO1xuICBoYXJkZW4ocHJvdmlkZUR1cmFibGVTZXRTdG9yZTIpO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTIgPSAoYmFnZ2FnZSwgbmFtZSwgb3B0aW9ucyA9IHt9KSA9PiBwcm92aWRlKFxuICAgIGJhZ2dhZ2UsXG4gICAgbmFtZSxcbiAgICAoKSA9PiBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlMihuYW1lLCB7IGR1cmFibGU6IHRydWUsIC4uLm9wdGlvbnMgfSlcbiAgKTtcbiAgaGFyZGVuKHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlMik7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIHByb3ZpZGVEdXJhYmxlTWFwU3RvcmU6IHByb3ZpZGVEdXJhYmxlTWFwU3RvcmUyLFxuICAgIHByb3ZpZGVEdXJhYmxlV2Vha01hcFN0b3JlOiBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTIsXG4gICAgcHJvdmlkZUR1cmFibGVTZXRTdG9yZTogcHJvdmlkZUR1cmFibGVTZXRTdG9yZTIsXG4gICAgcHJvdmlkZUR1cmFibGVXZWFrU2V0U3RvcmU6IHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlMlxuICB9KTtcbn07XG52YXIgZ2xvYmFsU3RvcmVVdGlscyA9IG1ha2VTdG9yZVV0aWxzKFZhdERhdGFHbG9iYWwpO1xudmFyIHtcbiAgcHJvdmlkZUR1cmFibGVNYXBTdG9yZSxcbiAgcHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmUsXG4gIHByb3ZpZGVEdXJhYmxlU2V0U3RvcmUsXG4gIHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlXG59ID0gZ2xvYmFsU3RvcmVVdGlscztcblxuLy9cbnZhciBpZ25vcmVDb250ZXh0ID0gKGZuKSA9PiAoX2NvbnRleHQsIC4uLmFyZ3MpID0+IGZuKC4uLmFyZ3MpO1xuaGFyZGVuKGlnbm9yZUNvbnRleHQpO1xudmFyIG1ha2VFeG9VdGlscyA9IChWYXREYXRhKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBkZWZpbmVLaW5kOiBkZWZpbmVLaW5kMixcbiAgICBkZWZpbmVLaW5kTXVsdGk6IGRlZmluZUtpbmRNdWx0aTIsXG4gICAgZGVmaW5lRHVyYWJsZUtpbmQ6IGRlZmluZUR1cmFibGVLaW5kMixcbiAgICBkZWZpbmVEdXJhYmxlS2luZE11bHRpOiBkZWZpbmVEdXJhYmxlS2luZE11bHRpMixcbiAgICBtYWtlS2luZEhhbmRsZTogbWFrZUtpbmRIYW5kbGUyXG4gIH0gPSBWYXREYXRhO1xuICBjb25zdCBwcm92aWRlS2luZEhhbmRsZTIgPSAoYmFnZ2FnZSwga2luZE5hbWUpID0+IHByb3ZpZGUoYmFnZ2FnZSwgYCR7a2luZE5hbWV9X2tpbmRIYW5kbGVgLCAoKSA9PiBtYWtlS2luZEhhbmRsZTIoa2luZE5hbWUpKTtcbiAgaGFyZGVuKHByb3ZpZGVLaW5kSGFuZGxlMik7XG4gIGNvbnN0IHByZXBhcmVLaW5kMiA9IChiYWdnYWdlLCBraW5kTmFtZSwgaW5pdCwgYmVoYXZpb3IsIG9wdGlvbnMgPSB2b2lkIDApID0+IGRlZmluZUR1cmFibGVLaW5kMihcbiAgICBwcm92aWRlS2luZEhhbmRsZTIoYmFnZ2FnZSwga2luZE5hbWUpLFxuICAgIGluaXQsXG4gICAgYmVoYXZpb3IsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUtpbmQyKTtcbiAgY29uc3QgcHJlcGFyZUtpbmRNdWx0aTIgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGluaXQsIGJlaGF2aW9yLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlS2luZE11bHRpMihcbiAgICBwcm92aWRlS2luZEhhbmRsZTIoYmFnZ2FnZSwga2luZE5hbWUpLFxuICAgIGluaXQsXG4gICAgYmVoYXZpb3IsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUtpbmRNdWx0aTIpO1xuICBjb25zdCBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3MyID0gKHRhZywgaW50ZXJmYWNlR3VhcmQsIGluaXQsIG1ldGhvZHMsIG9wdGlvbnMpID0+IChcbiAgICAvL1xuICAgIGRlZmluZUtpbmQyKHRhZywgaW5pdCwgbWV0aG9kcywge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHRoaXNmdWxNZXRob2RzOiB0cnVlLFxuICAgICAgaW50ZXJmYWNlR3VhcmRcbiAgICB9KVxuICApO1xuICBoYXJkZW4oZGVmaW5lVmlydHVhbEV4b0NsYXNzMik7XG4gIGNvbnN0IGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDIgPSAodGFnLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgZmFjZXRzLCBvcHRpb25zKSA9PiAoXG4gICAgLy9cbiAgICBkZWZpbmVLaW5kTXVsdGkyKHRhZywgaW5pdCwgZmFjZXRzLCB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgdGhpc2Z1bE1ldGhvZHM6IHRydWUsXG4gICAgICBpbnRlcmZhY2VHdWFyZEtpdFxuICAgIH0pXG4gICk7XG4gIGhhcmRlbihkZWZpbmVWaXJ0dWFsRXhvQ2xhc3NLaXQyKTtcbiAgY29uc3QgZGVmaW5lRHVyYWJsZUV4b0NsYXNzMiA9IChraW5kSGFuZGxlLCBpbnRlcmZhY2VHdWFyZCwgaW5pdCwgbWV0aG9kcywgb3B0aW9ucykgPT4gKFxuICAgIC8vXG4gICAgZGVmaW5lRHVyYWJsZUtpbmQyKGtpbmRIYW5kbGUsIGluaXQsIG1ldGhvZHMsIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICB0aGlzZnVsTWV0aG9kczogdHJ1ZSxcbiAgICAgIGludGVyZmFjZUd1YXJkXG4gICAgfSlcbiAgKTtcbiAgaGFyZGVuKGRlZmluZUR1cmFibGVFeG9DbGFzczIpO1xuICBjb25zdCBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQyID0gKGtpbmRIYW5kbGUsIGludGVyZmFjZUd1YXJkS2l0LCBpbml0LCBmYWNldHMsIG9wdGlvbnMpID0+IChcbiAgICAvL1xuICAgIGRlZmluZUR1cmFibGVLaW5kTXVsdGkyKGtpbmRIYW5kbGUsIGluaXQsIGZhY2V0cywge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHRoaXNmdWxNZXRob2RzOiB0cnVlLFxuICAgICAgaW50ZXJmYWNlR3VhcmRLaXRcbiAgICB9KVxuICApO1xuICBoYXJkZW4oZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0Mik7XG4gIGNvbnN0IHByZXBhcmVFeG9DbGFzczIgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGludGVyZmFjZUd1YXJkLCBpbml0LCBtZXRob2RzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3MyKFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlMihiYWdnYWdlLCBraW5kTmFtZSksXG4gICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgaW5pdCxcbiAgICBtZXRob2RzLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgaGFyZGVuKHByZXBhcmVFeG9DbGFzczIpO1xuICBjb25zdCBwcmVwYXJlRXhvQ2xhc3NLaXQyID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgZmFjZXRzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQyKFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlMihiYWdnYWdlLCBraW5kTmFtZSksXG4gICAgaW50ZXJmYWNlR3VhcmRLaXQsXG4gICAgaW5pdCxcbiAgICBmYWNldHMsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUV4b0NsYXNzS2l0Mik7XG4gIGNvbnN0IHByZXBhcmVFeG8yID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbnRlcmZhY2VHdWFyZCwgbWV0aG9kcywgb3B0aW9ucyA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IG1ha2VTaW5nbGV0b24gPSBwcmVwYXJlRXhvQ2xhc3MyKFxuICAgICAgYmFnZ2FnZSxcbiAgICAgIGtpbmROYW1lLFxuICAgICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgICBpbml0RW1wdHksXG4gICAgICBtZXRob2RzLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gICAgcmV0dXJuIHByb3ZpZGUoYmFnZ2FnZSwgYCR7a2luZE5hbWV9X3NpbmdsZXRvbmAsICgpID0+IG1ha2VTaW5nbGV0b24oKSk7XG4gIH07XG4gIGhhcmRlbihwcmVwYXJlRXhvMik7XG4gIGNvbnN0IHByZXBhcmVTaW5nbGV0b24yID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBtZXRob2RzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBwcmVwYXJlRXhvMihiYWdnYWdlLCBraW5kTmFtZSwgdm9pZCAwLCBtZXRob2RzLCBvcHRpb25zKTtcbiAgaGFyZGVuKHByZXBhcmVTaW5nbGV0b24yKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgZGVmaW5lVmlydHVhbEV4b0NsYXNzOiBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3MyLFxuICAgIGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDogZGVmaW5lVmlydHVhbEV4b0NsYXNzS2l0MixcbiAgICBkZWZpbmVEdXJhYmxlRXhvQ2xhc3M6IGRlZmluZUR1cmFibGVFeG9DbGFzczIsXG4gICAgZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0OiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQyLFxuICAgIHByZXBhcmVFeG9DbGFzczogcHJlcGFyZUV4b0NsYXNzMixcbiAgICBwcmVwYXJlRXhvQ2xhc3NLaXQ6IHByZXBhcmVFeG9DbGFzc0tpdDIsXG4gICAgcHJlcGFyZUV4bzogcHJlcGFyZUV4bzIsXG4gICAgcHJlcGFyZVNpbmdsZXRvbjogcHJlcGFyZVNpbmdsZXRvbjIsXG4gICAgcHJvdmlkZUtpbmRIYW5kbGU6IHByb3ZpZGVLaW5kSGFuZGxlMixcbiAgICBwcmVwYXJlS2luZDogcHJlcGFyZUtpbmQyLFxuICAgIHByZXBhcmVLaW5kTXVsdGk6IHByZXBhcmVLaW5kTXVsdGkyXG4gIH0pO1xufTtcbnZhciBnbG9iYWxFeG9VdGlscyA9IG1ha2VFeG9VdGlscyhWYXREYXRhRXhwb3J0KTtcbnZhciB7XG4gIGRlZmluZVZpcnR1YWxFeG9DbGFzcyxcbiAgZGVmaW5lVmlydHVhbEV4b0NsYXNzS2l0LFxuICBkZWZpbmVEdXJhYmxlRXhvQ2xhc3MsXG4gIGRlZmluZUR1cmFibGVFeG9DbGFzc0tpdCxcbiAgcHJlcGFyZUV4b0NsYXNzLFxuICBwcmVwYXJlRXhvQ2xhc3NLaXQsXG4gIHByZXBhcmVFeG8sXG4gIHByZXBhcmVTaW5nbGV0b25cbn0gPSBnbG9iYWxFeG9VdGlscztcbnZhciB7IHByb3ZpZGVLaW5kSGFuZGxlLCBwcmVwYXJlS2luZCwgcHJlcGFyZUtpbmRNdWx0aSB9ID0gZ2xvYmFsRXhvVXRpbHM7XG5cbi8vXG52YXIgaW1wb3J0X2VuY29kaW5nID0gX190b0VTTShyZXF1aXJlX2J1aWxkKCksIDEpO1xuXG4vL1xuZnVuY3Rpb24gYmFzZShBTFBIQUJFVDIpIHtcbiAgaWYgKEFMUEhBQkVUMi5sZW5ndGggPj0gMjU1KSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFscGhhYmV0IHRvbyBsb25nXCIpO1xuICB9XG4gIGNvbnN0IEJBU0VfTUFQID0gbmV3IFVpbnQ4QXJyYXkoMjU2KTtcbiAgZm9yIChsZXQgaiA9IDA7IGogPCBCQVNFX01BUC5sZW5ndGg7IGorKykge1xuICAgIEJBU0VfTUFQW2pdID0gMjU1O1xuICB9XG4gIGZvciAobGV0IGkzID0gMDsgaTMgPCBBTFBIQUJFVDIubGVuZ3RoOyBpMysrKSB7XG4gICAgY29uc3QgeCA9IEFMUEhBQkVUMi5jaGFyQXQoaTMpO1xuICAgIGNvbnN0IHhjID0geC5jaGFyQ29kZUF0KDApO1xuICAgIGlmIChCQVNFX01BUFt4Y10gIT09IDI1NSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcih4ICsgXCIgaXMgYW1iaWd1b3VzXCIpO1xuICAgIH1cbiAgICBCQVNFX01BUFt4Y10gPSBpMztcbiAgfVxuICBjb25zdCBCQVNFID0gQUxQSEFCRVQyLmxlbmd0aDtcbiAgY29uc3QgTEVBREVSID0gQUxQSEFCRVQyLmNoYXJBdCgwKTtcbiAgY29uc3QgRkFDVE9SID0gTWF0aC5sb2coQkFTRSkgLyBNYXRoLmxvZygyNTYpO1xuICBjb25zdCBpRkFDVE9SID0gTWF0aC5sb2coMjU2KSAvIE1hdGgubG9nKEJBU0UpO1xuICBmdW5jdGlvbiBlbmNvZGUyKHNvdXJjZSkge1xuICAgIGlmIChzb3VyY2UgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG4gICAgfSBlbHNlIGlmIChBcnJheUJ1ZmZlci5pc1ZpZXcoc291cmNlKSkge1xuICAgICAgc291cmNlID0gbmV3IFVpbnQ4QXJyYXkoc291cmNlLmJ1ZmZlciwgc291cmNlLmJ5dGVPZmZzZXQsIHNvdXJjZS5ieXRlTGVuZ3RoKTtcbiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoc291cmNlKSkge1xuICAgICAgc291cmNlID0gVWludDhBcnJheS5mcm9tKHNvdXJjZSk7XG4gICAgfVxuICAgIGlmICghKHNvdXJjZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRXhwZWN0ZWQgVWludDhBcnJheVwiKTtcbiAgICB9XG4gICAgaWYgKHNvdXJjZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgICBsZXQgemVyb2VzMiA9IDA7XG4gICAgbGV0IGxlbmd0aCA9IDA7XG4gICAgbGV0IHBiZWdpbiA9IDA7XG4gICAgY29uc3QgcGVuZCA9IHNvdXJjZS5sZW5ndGg7XG4gICAgd2hpbGUgKHBiZWdpbiAhPT0gcGVuZCAmJiBzb3VyY2VbcGJlZ2luXSA9PT0gMCkge1xuICAgICAgcGJlZ2luKys7XG4gICAgICB6ZXJvZXMyKys7XG4gICAgfVxuICAgIGNvbnN0IHNpemUgPSAocGVuZCAtIHBiZWdpbikgKiBpRkFDVE9SICsgMSA+Pj4gMDtcbiAgICBjb25zdCBiNTggPSBuZXcgVWludDhBcnJheShzaXplKTtcbiAgICB3aGlsZSAocGJlZ2luICE9PSBwZW5kKSB7XG4gICAgICBsZXQgY2FycnkgPSBzb3VyY2VbcGJlZ2luXTtcbiAgICAgIGxldCBpMyA9IDA7XG4gICAgICBmb3IgKGxldCBpdDEgPSBzaXplIC0gMTsgKGNhcnJ5ICE9PSAwIHx8IGkzIDwgbGVuZ3RoKSAmJiBpdDEgIT09IC0xOyBpdDEtLSwgaTMrKykge1xuICAgICAgICBjYXJyeSArPSAyNTYgKiBiNThbaXQxXSA+Pj4gMDtcbiAgICAgICAgYjU4W2l0MV0gPSBjYXJyeSAlIEJBU0UgPj4+IDA7XG4gICAgICAgIGNhcnJ5ID0gY2FycnkgLyBCQVNFID4+PiAwO1xuICAgICAgfVxuICAgICAgaWYgKGNhcnJ5ICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vbi16ZXJvIGNhcnJ5XCIpO1xuICAgICAgfVxuICAgICAgbGVuZ3RoID0gaTM7XG4gICAgICBwYmVnaW4rKztcbiAgICB9XG4gICAgbGV0IGl0MiA9IHNpemUgLSBsZW5ndGg7XG4gICAgd2hpbGUgKGl0MiAhPT0gc2l6ZSAmJiBiNThbaXQyXSA9PT0gMCkge1xuICAgICAgaXQyKys7XG4gICAgfVxuICAgIGxldCBzdHIgPSBMRUFERVIucmVwZWF0KHplcm9lczIpO1xuICAgIGZvciAoOyBpdDIgPCBzaXplOyArK2l0Mikge1xuICAgICAgc3RyICs9IEFMUEhBQkVUMi5jaGFyQXQoYjU4W2l0Ml0pO1xuICAgIH1cbiAgICByZXR1cm4gc3RyO1xuICB9XG4gIGZ1bmN0aW9uIGRlY29kZVVuc2FmZShzb3VyY2UpIHtcbiAgICBpZiAodHlwZW9mIHNvdXJjZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkV4cGVjdGVkIFN0cmluZ1wiKTtcbiAgICB9XG4gICAgaWYgKHNvdXJjZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSgpO1xuICAgIH1cbiAgICBsZXQgcHN6ID0gMDtcbiAgICBsZXQgemVyb2VzMiA9IDA7XG4gICAgbGV0IGxlbmd0aCA9IDA7XG4gICAgd2hpbGUgKHNvdXJjZVtwc3pdID09PSBMRUFERVIpIHtcbiAgICAgIHplcm9lczIrKztcbiAgICAgIHBzeisrO1xuICAgIH1cbiAgICBjb25zdCBzaXplID0gKHNvdXJjZS5sZW5ndGggLSBwc3opICogRkFDVE9SICsgMSA+Pj4gMDtcbiAgICBjb25zdCBiMjU2ID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZSk7XG4gICAgd2hpbGUgKHBzeiA8IHNvdXJjZS5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IGNoYXJDb2RlID0gc291cmNlLmNoYXJDb2RlQXQocHN6KTtcbiAgICAgIGlmIChjaGFyQ29kZSA+IDI1NSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsZXQgY2FycnkgPSBCQVNFX01BUFtjaGFyQ29kZV07XG4gICAgICBpZiAoY2FycnkgPT09IDI1NSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsZXQgaTMgPSAwO1xuICAgICAgZm9yIChsZXQgaXQzID0gc2l6ZSAtIDE7IChjYXJyeSAhPT0gMCB8fCBpMyA8IGxlbmd0aCkgJiYgaXQzICE9PSAtMTsgaXQzLS0sIGkzKyspIHtcbiAgICAgICAgY2FycnkgKz0gQkFTRSAqIGIyNTZbaXQzXSA+Pj4gMDtcbiAgICAgICAgYjI1NltpdDNdID0gY2FycnkgJSAyNTYgPj4+IDA7XG4gICAgICAgIGNhcnJ5ID0gY2FycnkgLyAyNTYgPj4+IDA7XG4gICAgICB9XG4gICAgICBpZiAoY2FycnkgIT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm9uLXplcm8gY2FycnlcIik7XG4gICAgICB9XG4gICAgICBsZW5ndGggPSBpMztcbiAgICAgIHBzeisrO1xuICAgIH1cbiAgICBsZXQgaXQ0ID0gc2l6ZSAtIGxlbmd0aDtcbiAgICB3aGlsZSAoaXQ0ICE9PSBzaXplICYmIGIyNTZbaXQ0XSA9PT0gMCkge1xuICAgICAgaXQ0Kys7XG4gICAgfVxuICAgIGNvbnN0IHZjaCA9IG5ldyBVaW50OEFycmF5KHplcm9lczIgKyAoc2l6ZSAtIGl0NCkpO1xuICAgIGxldCBqID0gemVyb2VzMjtcbiAgICB3aGlsZSAoaXQ0ICE9PSBzaXplKSB7XG4gICAgICB2Y2hbaisrXSA9IGIyNTZbaXQ0KytdO1xuICAgIH1cbiAgICByZXR1cm4gdmNoO1xuICB9XG4gIGZ1bmN0aW9uIGRlY29kZTMoc3RyaW5nKSB7XG4gICAgY29uc3QgYnVmZmVyID0gZGVjb2RlVW5zYWZlKHN0cmluZyk7XG4gICAgaWYgKGJ1ZmZlcikge1xuICAgICAgcmV0dXJuIGJ1ZmZlcjtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTm9uLWJhc2VcIiArIEJBU0UgKyBcIiBjaGFyYWN0ZXJcIik7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBlbmNvZGU6IGVuY29kZTIsXG4gICAgZGVjb2RlVW5zYWZlLFxuICAgIGRlY29kZTogZGVjb2RlM1xuICB9O1xufVxudmFyIGVzbV9kZWZhdWx0ID0gYmFzZTtcblxuLy9cbnZhciBBTFBIQUJFVCA9IFwiMTIzNDU2Nzg5QUJDREVGR0hKS0xNTlBRUlNUVVZXWFlaYWJjZGVmZ2hpamttbm9wcXJzdHV2d3h5elwiO1xudmFyIGVzbV9kZWZhdWx0MiA9IGVzbV9kZWZhdWx0KEFMUEhBQkVUKTtcblxuLy9cbnZhciBtYWtlSUNBQ2hhbm5lbEFkZHJlc3MgPSAoaG9zdENvbm5lY3Rpb25JZCwgY29udHJvbGxlckNvbm5lY3Rpb25JZCwge1xuICB2ZXJzaW9uID0gXCJpY3MyNy0xXCIsXG4gIGVuY29kaW5nID0gXCJwcm90bzNcIixcbiAgb3JkZXJpbmcgPSBcIm9yZGVyZWRcIixcbiAgdHhUeXBlID0gXCJzZGtfbXVsdGlfbXNnXCJcbn0gPSB7fSkgPT4ge1xuICBob3N0Q29ubmVjdGlvbklkIHx8IHRocm93UmVkYWN0ZWRgaG9zdENvbm5lY3Rpb25JZCBpcyByZXF1aXJlZGA7XG4gIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQgfHwgdGhyb3dSZWRhY3RlZGBjb250cm9sbGVyQ29ubmVjdGlvbklkIGlzIHJlcXVpcmVkYDtcbiAgY29uc3QgY29ublN0cmluZyA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICB2ZXJzaW9uLFxuICAgIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsXG4gICAgaG9zdENvbm5lY3Rpb25JZCxcbiAgICBhZGRyZXNzOiBcIlwiLFxuICAgIC8vXG4gICAgZW5jb2RpbmcsXG4gICAgdHhUeXBlXG4gIH0pO1xuICByZXR1cm4gYC9pYmMtaG9wLyR7Y29udHJvbGxlckNvbm5lY3Rpb25JZH0vaWJjLXBvcnQvaWNhaG9zdC8ke29yZGVyaW5nfS8ke2Nvbm5TdHJpbmd9YDtcbn07XG5oYXJkZW4obWFrZUlDQUNoYW5uZWxBZGRyZXNzKTtcbnZhciBERUZBVUxUX0lDUV9WRVJTSU9OID0gXCJpY3EtMVwiO1xudmFyIG1ha2VJQ1FDaGFubmVsQWRkcmVzcyA9IChjb250cm9sbGVyQ29ubmVjdGlvbklkLCB2ZXJzaW9uID0gREVGQVVMVF9JQ1FfVkVSU0lPTikgPT4ge1xuICBjb250cm9sbGVyQ29ubmVjdGlvbklkIHx8IHRocm93UmVkYWN0ZWRgY29udHJvbGxlckNvbm5lY3Rpb25JZCBpcyByZXF1aXJlZGA7XG4gIHJldHVybiBgL2liYy1ob3AvJHtjb250cm9sbGVyQ29ubmVjdGlvbklkfS9pYmMtcG9ydC9pY3Fob3N0L3Vub3JkZXJlZC8ke3ZlcnNpb259YDtcbn07XG5oYXJkZW4obWFrZUlDUUNoYW5uZWxBZGRyZXNzKTtcbnZhciBmaW5kQWRkcmVzc0ZpZWxkID0gKHJlbW90ZUFkZHJlc3NTdHJpbmcpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBqc29uU3RyID0gcmVtb3RlQWRkcmVzc1N0cmluZz8ubWF0Y2goL3suKj99Lyk/LlswXTtcbiAgICBjb25zdCBqc29uT2JqID0ganNvblN0ciA/IEpTT04ucGFyc2UoanNvblN0cikgOiB2b2lkIDA7XG4gICAgaWYgKCFqc29uT2JqPy5hZGRyZXNzPy5sZW5ndGgpIHJldHVybiB2b2lkIDA7XG4gICAgcmV0dXJuIGpzb25PYmouYWRkcmVzcztcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG59O1xuaGFyZGVuKGZpbmRBZGRyZXNzRmllbGQpO1xudmFyIGdldEJlY2gzMlByZWZpeCA9IChhZGRyZXNzKSA9PiB7XG4gIGFzc2VydChhZGRyZXNzLCBcImFkZHJlc3MgaXMgcmVxdWlyZWRcIik7XG4gIGNvbnN0IHNwbGl0MiA9IGFkZHJlc3MubGFzdEluZGV4T2YoXCIxXCIpO1xuICBpZiAoc3BsaXQyID09PSAtMSkgcmV0dXJuIHRocm93UmVkYWN0ZWRgTm8gc2VwYXJhdG9yIGNoYXJhY3RlciBmb3IgJHtxdW90ZShhZGRyZXNzKX1gO1xuICBpZiAoc3BsaXQyID09PSAwKSByZXR1cm4gdGhyb3dSZWRhY3RlZGBNaXNzaW5nIHByZWZpeCBmb3IgJHtxdW90ZShhZGRyZXNzKX1gO1xuICByZXR1cm4gYWRkcmVzcy5zbGljZSgwLCBzcGxpdDIpO1xufTtcbnZhciBjb2VyY2VBY2NvdW50SWQgPSAoaWRBcmcpID0+IHtcbiAgaWYgKHR5cGVvZiBpZEFyZyA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiBpZEFyZztcbiAgfVxuICByZXR1cm4gYGNvc21vczoke2lkQXJnLmNoYWluSWR9OiR7aWRBcmcudmFsdWV9YDtcbn07XG5oYXJkZW4oY29lcmNlQWNjb3VudElkKTtcbnZhciBwYXJzZUFjY291bnRJZEFyZyA9IChpZEFyZykgPT4ge1xuICBpZiAodHlwZW9mIGlkQXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHBhcnNlQWNjb3VudElkKGlkQXJnKTtcbiAgfVxuICByZXR1cm4ge1xuICAgIG5hbWVzcGFjZTogXCJjb3Ntb3NcIixcbiAgICByZWZlcmVuY2U6IGlkQXJnLmNoYWluSWQsXG4gICAgYWNjb3VudEFkZHJlc3M6IGlkQXJnLnZhbHVlXG4gIH07XG59O1xuaGFyZGVuKHBhcnNlQWNjb3VudElkQXJnKTtcbnZhciBwYXJzZUFjY291bnRJZCA9IChhY2NvdW50SWQpID0+IHtcbiAgY29uc3QgcGFydHMgPSBhY2NvdW50SWQuc3BsaXQoXCI6XCIpO1xuICBwYXJ0cy5sZW5ndGggPT09IDMgfHwgdGhyb3dSZWRhY3RlZGBtYWxmb3JtZWQgQ0FJUC0xMCBhY2NvdW50SWQ6ICR7cXVvdGUoYWNjb3VudElkKX1gO1xuICBjb25zdCBbbmFtZXNwYWNlLCByZWZlcmVuY2UsIGFjY291bnRBZGRyZXNzXSA9IHBhcnRzO1xuICByZXR1cm4ge1xuICAgIG5hbWVzcGFjZSxcbiAgICByZWZlcmVuY2UsXG4gICAgYWNjb3VudEFkZHJlc3NcbiAgfTtcbn07XG5oYXJkZW4ocGFyc2VBY2NvdW50SWQpO1xudmFyIGlzQmVjaDMyQWRkcmVzcyA9IChhZGRyZXNzKSA9PiB7XG4gIGlmICh0eXBlb2YgYWRkcmVzcyAhPT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICB0cnkge1xuICAgIGNvbnN0IGRlY29kZWQgPSAoMCwgaW1wb3J0X2VuY29kaW5nLmZyb21CZWNoMzIpKGFkZHJlc3MpO1xuICAgIHJldHVybiAhIWRlY29kZWQgJiYgZGVjb2RlZC5kYXRhLmxlbmd0aCA+IDA7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuaGFyZGVuKGlzQmVjaDMyQWRkcmVzcyk7XG52YXIgYXNzZXJ0QmVjaDMyQWRkcmVzcyA9IChhZGRyZXNzKSA9PiB7XG4gIGlmICghaXNCZWNoMzJBZGRyZXNzKGFkZHJlc3MpKSB7XG4gICAgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCBhIHZhbGlkIEJlY2gzMiBhZGRyZXNzLCBnb3QgJHtxdW90ZShhZGRyZXNzKX1gO1xuICB9XG59O1xuaGFyZGVuKGFzc2VydEJlY2gzMkFkZHJlc3MpO1xudmFyIGxlZnRQYWRFdGhBZGRyZXNzVG8zMkJ5dGVzID0gKHJhd0FkZHJlc3MpID0+IHtcbiAgY29uc3QgY2xlYW5lZEFkZHJlc3MgPSByYXdBZGRyZXNzLnJlcGxhY2UoL14weC8sIFwiXCIpO1xuICBjb25zdCB6ZXJvZXNOZWVkZWQgPSA2NCAtIGNsZWFuZWRBZGRyZXNzLmxlbmd0aDtcbiAgY29uc3QgcGFkZGVkQWRkcmVzcyA9IFwiMFwiLnJlcGVhdCh6ZXJvZXNOZWVkZWQpICsgY2xlYW5lZEFkZHJlc3M7XG4gIHJldHVybiAoMCwgaW1wb3J0X2VuY29kaW5nLmZyb21IZXgpKHBhZGRlZEFkZHJlc3MpO1xufTtcbnZhciBzb2xhbmFBZGRyZXNzVG9DY3RwUmVjaXBpZW50ID0gKHNvbGFuYUFkZHJlc3MpID0+IGVzbV9kZWZhdWx0Mi5kZWNvZGUoc29sYW5hQWRkcmVzcyk7XG52YXIgYWNjb3VudElkVG8zMkJ5dGVzID0gKGFjY291bnRJZCkgPT4ge1xuICBjb25zdCB7IG5hbWVzcGFjZSwgYWNjb3VudEFkZHJlc3MgfSA9IHBhcnNlQWNjb3VudElkKGFjY291bnRJZCk7XG4gIHN3aXRjaCAobmFtZXNwYWNlKSB7XG4gICAgY2FzZSBcImVpcDE1NVwiOlxuICAgICAgcmV0dXJuIGxlZnRQYWRFdGhBZGRyZXNzVG8zMkJ5dGVzKGFjY291bnRBZGRyZXNzKTtcbiAgICBjYXNlIFwic29sYW5hXCI6XG4gICAgICByZXR1cm4gc29sYW5hQWRkcmVzc1RvQ2N0cFJlY2lwaWVudChhY2NvdW50QWRkcmVzcyk7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgbmFtZXNwYWNlICR7bmFtZXNwYWNlfSBub3Qgc3VwcG9ydGVkYCk7XG4gIH1cbn07XG5cbi8vXG52YXIgeyBpc0Zyb3plbjogaXNGcm96ZW42IH0gPSBPYmplY3Q7XG52YXIgVXBncmFkZURpc2Nvbm5lY3Rpb25TaGFwZSA9IGhhcmRlbih7XG4gIG5hbWU6IFwidmF0VXBncmFkZWRcIixcbiAgdXBncmFkZU1lc3NhZ2U6IE0uc3RyaW5nKCksXG4gIGluY2FybmF0aW9uTnVtYmVyOiBNLm51bWJlcigpXG59KTtcbnZhciBtYWtlVXBncmFkZURpc2Nvbm5lY3Rpb24gPSAodXBncmFkZU1lc3NhZ2UsIHRvSW5jYXJuYXRpb25OdW1iZXIpID0+IGhhcmRlbih7XG4gIG5hbWU6IFwidmF0VXBncmFkZWRcIixcbiAgdXBncmFkZU1lc3NhZ2UsXG4gIGluY2FybmF0aW9uTnVtYmVyOiB0b0luY2FybmF0aW9uTnVtYmVyXG59KTtcbmhhcmRlbihtYWtlVXBncmFkZURpc2Nvbm5lY3Rpb24pO1xudmFyIGlzVXBncmFkZURpc2Nvbm5lY3Rpb24gPSAocmVhc29uKSA9PiByZWFzb24gIT0gbnVsbCAmJiAvL1xuaXNGcm96ZW42KHJlYXNvbikgJiYgbWF0Y2hlcyhyZWFzb24sIFVwZ3JhZGVEaXNjb25uZWN0aW9uU2hhcGUpO1xuaGFyZGVuKGlzVXBncmFkZURpc2Nvbm5lY3Rpb24pO1xudmFyIGlzQWJhbmRvbmVkRXJyb3IgPSAocmVhc29uKSA9PiByZWFzb24gIT0gbnVsbCAmJiAvL1xuaXNGcm96ZW42KHJlYXNvbikgJiYgbWF0Y2hlcyhyZWFzb24sIE0uZXJyb3IoKSkgJiYgLy9cbi8vXG5yZWFzb24ubWVzc2FnZSA9PT0gXCJ2YXQgdGVybWluYXRlZFwiO1xuaGFyZGVuKGlzQWJhbmRvbmVkRXJyb3IpO1xuXG4vL1xudmFyIHNpbmsyID0gKCkgPT4ge1xufTtcbmhhcmRlbihzaW5rMik7XG52YXIgVm93U2hhcGUgPSBNLnRhZ2dlZChcbiAgXCJWb3dcIixcbiAgTS5zcGxpdFJlY29yZCh7XG4gICAgdm93VjA6IE0ucmVtb3RhYmxlKFwiVm93VjBcIilcbiAgfSlcbik7XG52YXIgaXNWb3cgPSAoc3BlY2ltZW4pID0+IGlzUGFzc2FibGUoc3BlY2ltZW4pICYmIG1hdGNoZXMoc3BlY2ltZW4sIFZvd1NoYXBlKTtcbmhhcmRlbihpc1Zvdyk7XG52YXIgZ2V0Vm93UGF5bG9hZCA9IChzcGVjaW1lbikgPT4ge1xuICBpZiAoIWlzVm93KHNwZWNpbWVuKSkge1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbiAgY29uc3Qgdm93ID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBzcGVjaW1lblxuICApO1xuICByZXR1cm4gdm93LnBheWxvYWQ7XG59O1xuaGFyZGVuKGdldFZvd1BheWxvYWQpO1xudmFyIHRvUGFzc2FibGVDYXAgPSAoaykgPT4ge1xuICBjb25zdCBwYXlsb2FkID0gZ2V0Vm93UGF5bG9hZChrKTtcbiAgaWYgKHBheWxvYWQgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAga1xuICAgICk7XG4gIH1cbiAgY29uc3QgeyB2b3dWMCB9ID0gcGF5bG9hZDtcbiAgcmV0dXJuIHZvd1YwO1xufTtcbmhhcmRlbih0b1Bhc3NhYmxlQ2FwKTtcbnZhciBtYWtlQXNWb3cgPSAobWFrZVZvd0tpdCkgPT4ge1xuICBjb25zdCBhc1ZvdyA9IChmbikgPT4ge1xuICAgIGxldCByZXN1bHQ7XG4gICAgdHJ5IHtcbiAgICAgIHJlc3VsdCA9IGZuKCk7XG4gICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgIHJlc3VsdCA9IFByb21pc2UucmVqZWN0KGUyKTtcbiAgICB9XG4gICAgaWYgKGlzVm93KHJlc3VsdCkpIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIGNvbnN0IHsgdm93LCByZXNvbHZlciB9ID0gbWFrZVZvd0tpdCgpO1xuICAgIHJlc29sdmVyLnJlc29sdmUocmVzdWx0KTtcbiAgICByZXR1cm4gdm93O1xuICB9O1xuICByZXR1cm4gaGFyZGVuKGFzVm93KTtcbn07XG5oYXJkZW4obWFrZUFzVm93KTtcblxuLy9cbnZhciB7IGRldGFpbHM6IFgzIH0gPSBhc3NlcnQ7XG52YXIgbm9vcCA9ICgpID0+IHtcbn07XG5oYXJkZW4obm9vcCk7XG52YXIgcHJlcGFyZVZvd0tpdCA9ICh6b25lLCB2b3dSZWplY3Rpb25UcmFja2VyKSA9PiB7XG4gIGNvbnN0IHJlc29sdmVyVG9FcGhlbWVyYSA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCByZXNvbHZlclRvTm9uU3RvcmVkVmFsdWUgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgcHJvdmlkZUVwaGVtZXJhID0gKHJlc29sdmVyLCBvcHRpb25zKSA9PiB7XG4gICAgbGV0IGVwaGVtZXJhID0gcmVzb2x2ZXJUb0VwaGVtZXJhLmdldChyZXNvbHZlcik7XG4gICAgaWYgKCFlcGhlbWVyYSkge1xuICAgICAgZXBoZW1lcmEgPSBtYWtlUHJvbWlzZUtpdCgpO1xuICAgICAgZXBoZW1lcmEucHJvbWlzZS5jYXRjaChub29wKTtcbiAgICB9XG4gICAgZXBoZW1lcmEgPSBoYXJkZW4oeyAuLi5lcGhlbWVyYSwgLi4ub3B0aW9ucyB9KTtcbiAgICByZXNvbHZlclRvRXBoZW1lcmEuc2V0KHJlc29sdmVyLCBlcGhlbWVyYSk7XG4gICAgcmV0dXJuIGVwaGVtZXJhO1xuICB9O1xuICBjb25zdCBwcm92aWRlRXBoZW1lcmFGb3JSZXNvbHV0aW9uID0gKHJlc29sdmVyKSA9PiB7XG4gICAgY29uc3QgZXBoZW1lcmEgPSBwcm92aWRlRXBoZW1lcmEocmVzb2x2ZXIpO1xuICAgIGlmIChlcGhlbWVyYS5yZXNvbHZlKSB7XG4gICAgICBjb25zdCB7IHJlc29sdmU6IF8xLCByZWplY3Q6IF8yLCAuLi5yZXN0IH0gPSBlcGhlbWVyYTtcbiAgICAgIHJlc29sdmVyVG9FcGhlbWVyYS5zZXQocmVzb2x2ZXIsIGhhcmRlbihyZXN0KSk7XG4gICAgfVxuICAgIHJldHVybiBlcGhlbWVyYTtcbiAgfTtcbiAgY29uc3QgbWFrZVZvd0ludGVybmFsc0tpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJWb3dJbnRlcm5hbHNLaXRcIixcbiAgICB7XG4gICAgICB2b3dWMDogTS5pbnRlcmZhY2UoXCJWb3dWMFwiLCB7XG4gICAgICAgIHNob3J0ZW46IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpXG4gICAgICB9KSxcbiAgICAgIHJlc29sdmVyOiBNLmludGVyZmFjZShcIlZvd1Jlc29sdmVyXCIsIHtcbiAgICAgICAgcmVzb2x2ZTogTS5jYWxsKCkub3B0aW9uYWwoTS5yYXcoKSkucmV0dXJucygpLFxuICAgICAgICByZWplY3Q6IE0uY2FsbCgpLm9wdGlvbmFsKE0ucmF3KCkpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICB3YXRjaE5leHRTdGVwOiBQcm9taXNlV2F0Y2hlcklcbiAgICB9LFxuICAgICgpID0+ICh7XG4gICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgIHZhbHVlOiB2b2lkIDAsXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgc3RlcFN0YXR1czogbnVsbCxcbiAgICAgIGlzU3RvcmVkVmFsdWU6IGZhbHNlLFxuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgdm93SXNIYW5kbGVkOiBmYWxzZSxcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGV4dHJhOiB2b2lkIDBcbiAgICB9KSxcbiAgICB7XG4gICAgICB2b3dWMDoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBhc3luYyBzaG9ydGVuKCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RlcFN0YXR1cywgaXNTdG9yZWRWYWx1ZSwgdmFsdWUsIHZvd0lzSGFuZGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmVyLCB2b3dWMCB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgc3dpdGNoIChzdGVwU3RhdHVzKSB7XG4gICAgICAgICAgICBjYXNlIFwiZnVsZmlsbGVkXCI6IHtcbiAgICAgICAgICAgICAgaWYgKHZvd0lzSGFuZGxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnZvd0lzSGFuZGxlZCA9IHRydWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGlzU3RvcmVkVmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzb2x2ZXJUb05vblN0b3JlZFZhbHVlLmhhcyhyZXNvbHZlcikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZXJUb05vblN0b3JlZFZhbHVlLmdldChyZXNvbHZlcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdGhyb3cgdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwicmVqZWN0ZWRcIjoge1xuICAgICAgICAgICAgICBpZiAodm93SXNIYW5kbGVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUudm93SXNIYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2b3dSZWplY3Rpb25UcmFja2VyPy5oYW5kbGUodm93VjApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNvbnN0IHJlYXNvbiA9IHJlc29sdmVyVG9Ob25TdG9yZWRWYWx1ZS5oYXMocmVzb2x2ZXIpID8gcmVzb2x2ZXJUb05vblN0b3JlZFZhbHVlLmdldChyZXNvbHZlcikgOiB2YWx1ZTtcbiAgICAgICAgICAgICAgdGhyb3cgcmVhc29uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBudWxsOlxuICAgICAgICAgICAgY2FzZSBcInBlbmRpbmdcIjpcbiAgICAgICAgICAgICAgcmV0dXJuIHByb3ZpZGVFcGhlbWVyYSh0aGlzLmZhY2V0cy5yZXNvbHZlciwge1xuICAgICAgICAgICAgICAgIHBvdGVudGlhbGx5SGFuZGxlZDogdHJ1ZVxuICAgICAgICAgICAgICB9KS5wcm9taXNlO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKGB1bmV4cGVjdGVkIHN0ZXBTdGF0dXMgJHtzdGVwU3RhdHVzfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlc29sdmVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIHJlc29sdmUodmFsdWUpIHtcbiAgICAgICAgICBjb25zdCB7IHN0ZXBTdGF0dXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKHN0ZXBTdGF0dXMgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zdGF0ZS5zdGVwU3RhdHVzID0gXCJwZW5kaW5nXCI7XG4gICAgICAgICAgY29uc3QgeyByZXNvbHZlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgeyByZXNvbHZlOiByZXNvbHZlMiB9ID0gcHJvdmlkZUVwaGVtZXJhRm9yUmVzb2x1dGlvbihyZXNvbHZlcik7XG4gICAgICAgICAgcmVzb2x2ZTIgJiYgcmVzb2x2ZTIodmFsdWUpO1xuICAgICAgICAgIHpvbmUud2F0Y2hQcm9taXNlKFxuICAgICAgICAgICAgSGFuZGxlZFByb21pc2UucmVzb2x2ZSh2YWx1ZSksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy53YXRjaE5leHRTdGVwXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgcmVqZWN0KHJlYXNvbikge1xuICAgICAgICAgIGNvbnN0IHsgc3RlcFN0YXR1cyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoc3RlcFN0YXR1cyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnN0YXRlLnN0ZXBTdGF0dXMgPSBcInJlamVjdGVkXCI7XG4gICAgICAgICAgY29uc3QgeyByZXNvbHZlciwgd2F0Y2hOZXh0U3RlcCB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgeyByZWplY3QgfSA9IHByb3ZpZGVFcGhlbWVyYUZvclJlc29sdXRpb24ocmVzb2x2ZXIpO1xuICAgICAgICAgIHJlamVjdCAmJiByZWplY3QocmVhc29uKTtcbiAgICAgICAgICB3YXRjaE5leHRTdGVwLm9uUmVqZWN0ZWQocmVhc29uKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdhdGNoTmV4dFN0ZXA6IHtcbiAgICAgICAgb25GdWxmaWxsZWQodmFsdWUpIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLnN0ZXBTdGF0dXMgPSBcImZ1bGZpbGxlZFwiO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZTogcmVzb2x2ZTIgfSA9IHByb3ZpZGVFcGhlbWVyYUZvclJlc29sdXRpb24ocmVzb2x2ZXIpO1xuICAgICAgICAgIGhhcmRlbih2YWx1ZSk7XG4gICAgICAgICAgcmVzb2x2ZTIgJiYgcmVzb2x2ZTIodmFsdWUpO1xuICAgICAgICAgIHRoaXMuc3RhdGUuaXNTdG9yZWRWYWx1ZSA9IHpvbmUuaXNTdG9yYWJsZSh2YWx1ZSk7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaXNTdG9yZWRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlclRvTm9uU3RvcmVkVmFsdWUuc2V0KHJlc29sdmVyLCB2YWx1ZSk7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gYXNzZXJ0LmVycm9yKFxuICAgICAgICAgICAgICBYM2BWb3cgZnVsZmlsbG1lbnQgdmFsdWUgd2FzIG5vdCBzdG9yZWQ6ICR7dmFsdWV9YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5zdGVwU3RhdHVzID0gXCJyZWplY3RlZFwiO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZXIsIHZvd1YwIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCB7IHJlamVjdCwgcG90ZW50aWFsbHlIYW5kbGVkIH0gPSBwcm92aWRlRXBoZW1lcmFGb3JSZXNvbHV0aW9uKHJlc29sdmVyKTtcbiAgICAgICAgICBoYXJkZW4ocmVhc29uKTtcbiAgICAgICAgICByZWplY3QgJiYgcmVqZWN0KHJlYXNvbik7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGUudm93SXNIYW5kbGVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgaWYgKHBvdGVudGlhbGx5SGFuZGxlZCkge1xuICAgICAgICAgICAgICB0aGlzLnN0YXRlLnZvd0lzSGFuZGxlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB2b3dSZWplY3Rpb25UcmFja2VyPy5yZWplY3Qodm93VjAsIHJlYXNvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuc3RhdGUuaXNTdG9yZWRWYWx1ZSA9IHpvbmUuaXNTdG9yYWJsZShyZWFzb24pO1xuICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmlzU3RvcmVkVmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUudmFsdWUgPSByZWFzb247XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc29sdmVyVG9Ob25TdG9yZWRWYWx1ZS5zZXQocmVzb2x2ZXIsIHJlYXNvbik7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gYXNzZXJ0LmVycm9yKFxuICAgICAgICAgICAgICBYM2BWb3cgcmVqZWN0aW9uIHJlYXNvbiB3YXMgbm90IHN0b3JlZDogJHtyZWFzb259YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VWb3dLaXQgPSAoKSA9PiB7XG4gICAgY29uc3QgeyByZXNvbHZlciwgdm93VjAgfSA9IG1ha2VWb3dJbnRlcm5hbHNLaXQoKTtcbiAgICBjb25zdCB2b3cgPSBtYWtlVGFnZ2VkKFwiVm93XCIsIGhhcmRlbih7IHZvd1YwIH0pKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgcmVzb2x2ZXIsIHZvdyB9KTtcbiAgfTtcbiAgcmV0dXJuIG1ha2VWb3dLaXQ7XG59O1xuaGFyZGVuKHByZXBhcmVWb3dLaXQpO1xuXG4vL1xudmFyIHsgRmFpbDogRmFpbDUsIGJhcmU6IGJhcmUyLCBkZXRhaWxzOiBYNCB9ID0gYXNzZXJ0O1xudmFyIFZvd1NoYXBlMiA9IE0udGFnZ2VkKFxuICBcIlZvd1wiLFxuICBoYXJkZW4oe1xuICAgIHZvd1YwOiBNLnJlbW90YWJsZShcIlZvd1YwXCIpXG4gIH0pXG4pO1xudmFyIHByZXBhcmVXYXRjaFV0aWxzID0gKHpvbmUsIHsgd2F0Y2gsIHdoZW4sIG1ha2VWb3dLaXQsIGlzUmV0cnlhYmxlUmVhc29uOiBpc1JldHJ5YWJsZVJlYXNvbjIgfSkgPT4ge1xuICBjb25zdCBkZXRhY2hlZCA9IHpvbmUuZGV0YWNoZWQoKTtcbiAgY29uc3QgdXRpbHNUb05vblN0b3JhYmxlUmVzdWx0cyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCBtYWtlV2F0Y2hVdGlsc0tpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJXYXRjaFV0aWxzXCIsXG4gICAge1xuICAgICAgdXRpbHM6IE0uaW50ZXJmYWNlKFwiVXRpbHNcIiwge1xuICAgICAgICBhbGw6IE0uY2FsbChNLmFycmF5T2YoTS5hbnkoKSkpLnJldHVybnMoVm93U2hhcGUyKSxcbiAgICAgICAgYWxsU2V0dGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLmFueSgpKSkucmV0dXJucyhWb3dTaGFwZTIpLFxuICAgICAgICBhc1Byb21pc2U6IE0uY2FsbChNLnJhdygpKS5yZXN0KE0ucmF3KCkpLnJldHVybnMoTS5wcm9taXNlKCkpXG4gICAgICB9KSxcbiAgICAgIHdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5yYXcoKSkucmVzdChNLnJhdygpKS5yZXR1cm5zKE0ucmF3KCkpLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5yYXcoKSkucmVzdChNLnJhdygpKS5yZXR1cm5zKE0ucmF3KCkpXG4gICAgICB9KSxcbiAgICAgIGhlbHBlcjogTS5pbnRlcmZhY2UoXCJIZWxwZXJcIiwge1xuICAgICAgICBjcmVhdGVWb3c6IE0uY2FsbChNLmFycmF5T2YoTS5hbnkoKSksIE0uYm9vbGVhbigpKS5yZXR1cm5zKFZvd1NoYXBlMiksXG4gICAgICAgIHByb2Nlc3NSZXN1bHQ6IE0uY2FsbChNLnJhdygpKS5yZXN0KE0ucmF3KCkpLnJldHVybnMoTS51bmRlZmluZWQoKSlcbiAgICAgIH0pLFxuICAgICAgcmV0cnlSZWplY3Rpb25Qcm9taXNlV2F0Y2hlcjogUHJvbWlzZVdhdGNoZXJJXG4gICAgfSxcbiAgICAoKSA9PiB7XG4gICAgICBjb25zdCBpZFRvVm93U3RhdGUgPSBkZXRhY2hlZC5tYXBTdG9yZShcImlkVG9Wb3dTdGF0ZVwiKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5leHRJZDogMG4sXG4gICAgICAgIGlkVG9Wb3dTdGF0ZVxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIHV0aWxzOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGFsbChzcGVjaW1lbnMpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5mYWNldHMuaGVscGVyLmNyZWF0ZVZvdyhzcGVjaW1lbnMsIGZhbHNlKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYWxsU2V0dGxlZChzcGVjaW1lbnMpIHtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5oZWxwZXIuY3JlYXRlVm93KHNwZWNpbWVucywgdHJ1ZSlcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBhc1Byb21pc2Uoc3BlY2ltZW5QLCAuLi53YXRjaGVyQXJncykge1xuICAgICAgICAgIGNvbnN0IHZvdyA9IHdhdGNoKHNwZWNpbWVuUCwgLi4ud2F0Y2hlckFyZ3MpO1xuICAgICAgICAgIGNvbnN0IHByb21pc2UgPSB3aGVuKHZvdyk7XG4gICAgICAgICAgem9uZS53YXRjaFByb21pc2UocHJvbWlzZSwgdGhpcy5mYWNldHMucmV0cnlSZWplY3Rpb25Qcm9taXNlV2F0Y2hlcik7XG4gICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3YXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZCh2YWx1ZSwgY3R4KSB7XG4gICAgICAgICAgdGhpcy5mYWNldHMuaGVscGVyLnByb2Nlc3NSZXN1bHQodmFsdWUsIGN0eCwgXCJmdWxmaWxsZWRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgY3R4KSB7XG4gICAgICAgICAgdGhpcy5mYWNldHMuaGVscGVyLnByb2Nlc3NSZXN1bHQocmVhc29uLCBjdHgsIFwicmVqZWN0ZWRcIik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBoZWxwZXI6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBjcmVhdGVWb3coc3BlY2ltZW5zLCBpc0FsbFNldHRsZWQpIHtcbiAgICAgICAgICBjb25zdCB7IG5leHRJZDogaWQsIGlkVG9Wb3dTdGF0ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCBraXQgPSBtYWtlVm93S2l0KCk7XG4gICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHNwZWNpbWVucy5sZW5ndGg7IGluZGV4ICs9IDEpIHtcbiAgICAgICAgICAgIHdhdGNoKHNwZWNpbWVuc1tpbmRleF0sIHRoaXMuZmFjZXRzLndhdGNoZXIsIHtcbiAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAgIGluZGV4LFxuICAgICAgICAgICAgICBudW1SZXN1bHRzOiBzcGVjaW1lbnMubGVuZ3RoLFxuICAgICAgICAgICAgICBpc0FsbFNldHRsZWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc3BlY2ltZW5zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUubmV4dElkICs9IDFuO1xuICAgICAgICAgICAgaWRUb1Zvd1N0YXRlLmluaXQoXG4gICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICBoYXJkZW4oe1xuICAgICAgICAgICAgICAgIHJlc29sdmVyOiBraXQucmVzb2x2ZXIsXG4gICAgICAgICAgICAgICAgcmVtYWluaW5nOiBzcGVjaW1lbnMubGVuZ3RoLFxuICAgICAgICAgICAgICAgIHJlc3VsdHNNYXA6IGRldGFjaGVkLm1hcFN0b3JlKFwicmVzdWx0c01hcFwiKSxcbiAgICAgICAgICAgICAgICBpc0FsbFNldHRsZWRcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zdCBpZFRvTm9uU3RvcmFibGVSZXN1bHRzID0gcHJvdmlkZUxhenlNYXAoXG4gICAgICAgICAgICAgIHV0aWxzVG9Ob25TdG9yYWJsZVJlc3VsdHMsXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnV0aWxzLFxuICAgICAgICAgICAgICAoKSA9PiAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWRUb05vblN0b3JhYmxlUmVzdWx0cy5zZXQoaWQsIC8qICAgICAgICAgICAqLyBuZXcgTWFwKCkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBraXQucmVzb2x2ZXIucmVzb2x2ZShoYXJkZW4oW10pKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGtpdC52b3c7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHByb2Nlc3NSZXN1bHQocmVzdWx0LCB7IGlkLCBpbmRleCwgbnVtUmVzdWx0cywgaXNBbGxTZXR0bGVkIH0sIHN0YXR1cykge1xuICAgICAgICAgIGNvbnN0IHsgaWRUb1Zvd1N0YXRlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICghaWRUb1Zvd1N0YXRlLmhhcyhpZCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgaWRUb05vblN0b3JhYmxlUmVzdWx0cyA9IHByb3ZpZGVMYXp5TWFwKFxuICAgICAgICAgICAgdXRpbHNUb05vblN0b3JhYmxlUmVzdWx0cyxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnV0aWxzLFxuICAgICAgICAgICAgKCkgPT4gLyogICAgICAgICAgICovIG5ldyBNYXAoKVxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgeyByZW1haW5pbmcsIHJlc3VsdHNNYXAsIHJlc29sdmVyIH0gPSBpZFRvVm93U3RhdGUuZ2V0KGlkKTtcbiAgICAgICAgICBpZiAoIWlzQWxsU2V0dGxlZCAmJiBzdGF0dXMgPT09IFwicmVqZWN0ZWRcIikge1xuICAgICAgICAgICAgaWRUb1Zvd1N0YXRlLmRlbGV0ZShpZCk7XG4gICAgICAgICAgICBpZFRvTm9uU3RvcmFibGVSZXN1bHRzLmRlbGV0ZShpZCk7XG4gICAgICAgICAgICByZXNvbHZlci5yZWplY3QocmVzdWx0KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgcG9zc2libHlXcmFwcGVkUmVzdWx0ID0gaXNBbGxTZXR0bGVkID8gaGFyZGVuKHtcbiAgICAgICAgICAgIHN0YXR1cyxcbiAgICAgICAgICAgIFtzdGF0dXMgPT09IFwiZnVsZmlsbGVkXCIgPyBcInZhbHVlXCIgOiBcInJlYXNvblwiXTogcmVzdWx0XG4gICAgICAgICAgfSkgOiByZXN1bHQ7XG4gICAgICAgICAgY29uc3Qgbm9uU3RvcmFibGVSZXN1bHRzID0gcHJvdmlkZUxhenlNYXAoXG4gICAgICAgICAgICBpZFRvTm9uU3RvcmFibGVSZXN1bHRzLFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAoKSA9PiAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoem9uZS5pc1N0b3JhYmxlKHBvc3NpYmx5V3JhcHBlZFJlc3VsdCkpIHtcbiAgICAgICAgICAgIHJlc3VsdHNNYXAuaW5pdChpbmRleCwgcG9zc2libHlXcmFwcGVkUmVzdWx0KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbm9uU3RvcmFibGVSZXN1bHRzLnNldChpbmRleCwgcG9zc2libHlXcmFwcGVkUmVzdWx0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3Qgdm93U3RhdGUgPSBoYXJkZW4oe1xuICAgICAgICAgICAgcmVtYWluaW5nOiByZW1haW5pbmcgLSAxLFxuICAgICAgICAgICAgcmVzdWx0c01hcCxcbiAgICAgICAgICAgIHJlc29sdmVyLFxuICAgICAgICAgICAgaXNBbGxTZXR0bGVkXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKHZvd1N0YXRlLnJlbWFpbmluZyA+IDApIHtcbiAgICAgICAgICAgIGlkVG9Wb3dTdGF0ZS5zZXQoaWQsIHZvd1N0YXRlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWRUb1Zvd1N0YXRlLmRlbGV0ZShpZCk7XG4gICAgICAgICAgaWRUb05vblN0b3JhYmxlUmVzdWx0cy5kZWxldGUoaWQpO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBuZXcgQXJyYXkobnVtUmVzdWx0cyk7XG4gICAgICAgICAgbGV0IG51bUxvc3QgPSAwO1xuICAgICAgICAgIGZvciAobGV0IGkzID0gMDsgaTMgPCBudW1SZXN1bHRzOyBpMyArPSAxKSB7XG4gICAgICAgICAgICBpZiAobm9uU3RvcmFibGVSZXN1bHRzLmhhcyhpMykpIHtcbiAgICAgICAgICAgICAgcmVzdWx0c1tpM10gPSBub25TdG9yYWJsZVJlc3VsdHMuZ2V0KGkzKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0c01hcC5oYXMoaTMpKSB7XG4gICAgICAgICAgICAgIHJlc3VsdHNbaTNdID0gcmVzdWx0c01hcC5nZXQoaTMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbnVtTG9zdCArPSAxO1xuICAgICAgICAgICAgICByZXN1bHRzW2kzXSA9IGlzQWxsU2V0dGxlZCA/IHsgc3RhdHVzOiBcInJlamVjdGVkXCIsIHJlYXNvbjogXCJVbnN0b3JhYmxlIHJlc3VsdCB3YXMgbG9zdFwiIH0gOiB2b2lkIDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChudW1Mb3N0ID4gMCAmJiAhaXNBbGxTZXR0bGVkKSB7XG4gICAgICAgICAgICByZXNvbHZlci5yZWplY3QoXG4gICAgICAgICAgICAgIGFzc2VydC5lcnJvcihYNGAke251bUxvc3R9IHVuc3RvcmFibGUgcmVzdWx0cyB3ZXJlIGxvc3RgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzb2x2ZXIucmVzb2x2ZShoYXJkZW4ocmVzdWx0cykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJldHJ5UmVqZWN0aW9uUHJvbWlzZVdhdGNoZXI6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoX3Jlc3VsdCkge1xuICAgICAgICB9LFxuICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgZmFpbGVkT3ApIHtcbiAgICAgICAgICBpZiAoaXNSZXRyeWFibGVSZWFzb24yKHJlYXNvbiwgdm9pZCAwKSkge1xuICAgICAgICAgICAgRmFpbDVgUGVuZGluZyAke2JhcmUyKGZhaWxlZE9wKX0gY291bGQgbm90IHJldHJ5OyAke3JlYXNvbn1gO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZVdhdGNoVXRpbCA9ICgpID0+IHtcbiAgICBjb25zdCB7IHV0aWxzIH0gPSBtYWtlV2F0Y2hVdGlsc0tpdCgpO1xuICAgIHJldHVybiBoYXJkZW4odXRpbHMpO1xuICB9O1xuICByZXR1cm4gbWFrZVdhdGNoVXRpbDtcbn07XG5oYXJkZW4ocHJlcGFyZVdhdGNoVXRpbHMpO1xuXG4vL1xudmFyIHsgYXBwbHk6IGFwcGx5OCB9ID0gUmVmbGVjdDtcbnZhciBtYWtlV2F0Y2hOZXh0U3RlcCA9ICh6b25lKSA9PiAoXG4gIC8qXG5cblxuXG5cblxuXG4gICAqL1xuICAoc3BlY2ltZW4sIHByb21pc2VXYXRjaGVyKSA9PiB7XG4gICAgbGV0IHByb21pc2U7XG4gICAgY29uc3QgcGF5bG9hZCA9IGdldFZvd1BheWxvYWQoc3BlY2ltZW4pO1xuICAgIGlmIChwYXlsb2FkKSB7XG4gICAgICBwcm9taXNlID0gRShwYXlsb2FkLnZvd1YwKS5zaG9ydGVuKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHByb21pc2UgPSBFLnJlc29sdmUoc3BlY2ltZW4pO1xuICAgIH1cbiAgICB6b25lLndhdGNoUHJvbWlzZShwcm9taXNlLCBwcm9taXNlV2F0Y2hlcik7XG4gIH1cbik7XG52YXIgc2V0dGxlID0gYXN5bmMgKHJlc29sdmVyLCB3YXRjaGVyLCB3Y2IsIHZhbHVlLCB3YXRjaGVyQXJncyA9IFtdKSA9PiB7XG4gIGF3YWl0IG51bGw7XG4gIHRyeSB7XG4gICAgbGV0IGNoYWluZWRWYWx1ZSA9IHZhbHVlO1xuICAgIGNvbnN0IHcyID0gd2F0Y2hlciAmJiB3YXRjaGVyW3djYl07XG4gICAgaWYgKHcyKSB7XG4gICAgICBjaGFpbmVkVmFsdWUgPSBhcHBseTgodzIsIHdhdGNoZXIsIFt2YWx1ZSwgLi4ud2F0Y2hlckFyZ3NdKTtcbiAgICB9IGVsc2UgaWYgKHdjYiA9PT0gXCJvblJlamVjdGVkXCIpIHtcbiAgICAgIHRocm93IHZhbHVlO1xuICAgIH1cbiAgICBpZiAocmVzb2x2ZXIpIHtcbiAgICAgIHJlc29sdmVyLnJlc29sdmUoY2hhaW5lZFZhbHVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYXdhaXQgY2hhaW5lZFZhbHVlO1xuICB9IGNhdGNoIChlMikge1xuICAgIGlmIChyZXNvbHZlcikge1xuICAgICAgcmVzb2x2ZXIucmVqZWN0KGUyKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhyb3cgZTI7XG4gIH1cbn07XG52YXIgcHJlcGFyZVByb21pc2VXYXRjaGVyID0gKHpvbmUsIGlzUmV0cnlhYmxlUmVhc29uMiwgd2F0Y2hOZXh0U3RlcCkgPT4ge1xuICBjb25zdCB3YXRjaGVyU2VlblBheWxvYWRzID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IGdldFNlZW5QYXlsb2FkcyA9ICh3YXRjaGVyKSA9PiB7XG4gICAgbGV0IHNlZW5QYXlsb2FkcyA9IHdhdGNoZXJTZWVuUGF5bG9hZHMuZ2V0KHdhdGNoZXIpO1xuICAgIGlmICghc2VlblBheWxvYWRzKSB7XG4gICAgICBzZWVuUGF5bG9hZHMgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKTtcbiAgICAgIHdhdGNoZXJTZWVuUGF5bG9hZHMuc2V0KHdhdGNoZXIsIHNlZW5QYXlsb2Fkcyk7XG4gICAgfVxuICAgIHJldHVybiBzZWVuUGF5bG9hZHM7XG4gIH07XG4gIHJldHVybiB6b25lLmV4b0NsYXNzKFxuICAgIFwiUHJvbWlzZVdhdGNoZXJcIixcbiAgICBQcm9taXNlV2F0Y2hlckksXG4gICAgLypcblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICAocmVzb2x2ZXIsIHdhdGNoZXIsIHdhdGNoZXJBcmdzKSA9PiB7XG4gICAgICBjb25zdCBzdGF0ZSA9IHtcbiAgICAgICAgdm93OiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHZvaWQgMFxuICAgICAgICApLFxuICAgICAgICBwcmlvclJldHJ5VmFsdWU6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB2b2lkIDBcbiAgICAgICAgKSxcbiAgICAgICAgcmVzb2x2ZXIsXG4gICAgICAgIHdhdGNoZXIsXG4gICAgICAgIHdhdGNoZXJBcmdzOiBoYXJkZW4od2F0Y2hlckFyZ3MpXG4gICAgICB9O1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHN0YXRlXG4gICAgICApO1xuICAgIH0sXG4gICAge1xuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZCh2YWx1ZSkge1xuICAgICAgICBjb25zdCB7IHdhdGNoZXIsIHdhdGNoZXJBcmdzLCByZXNvbHZlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFyZXNvbHZlcikge1xuICAgICAgICAgIHRocm93IEVycm9yKFwiVW5leHBlY3RlZCBtdWx0aXBsZSBjYWxscyB0byBQcm9taXNlV2F0Y2hlclwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwYXlsb2FkID0gZ2V0Vm93UGF5bG9hZCh2YWx1ZSk7XG4gICAgICAgIGlmIChwYXlsb2FkKSB7XG4gICAgICAgICAgY29uc3Qgc2VlblBheWxvYWRzID0gZ2V0U2VlblBheWxvYWRzKHRoaXMuc2VsZik7XG4gICAgICAgICAgaWYgKHNlZW5QYXlsb2Fkcy5oYXMocGF5bG9hZC52b3dWMCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGYub25SZWplY3RlZChFcnJvcihcIlZvdyByZXNvbHV0aW9uIGN5Y2xlIGRldGVjdGVkXCIpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc2VlblBheWxvYWRzLmFkZChwYXlsb2FkLnZvd1YwKTtcbiAgICAgICAgICB0aGlzLnN0YXRlLnZvdyA9IHZhbHVlO1xuICAgICAgICAgIHdhdGNoTmV4dFN0ZXAodmFsdWUsIHRoaXMuc2VsZik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHdhdGNoZXJTZWVuUGF5bG9hZHMuZGVsZXRlKHRoaXMuc2VsZik7XG4gICAgICAgIHRoaXMuc3RhdGUucHJpb3JSZXRyeVZhbHVlID0gdm9pZCAwO1xuICAgICAgICB0aGlzLnN0YXRlLndhdGNoZXIgPSB2b2lkIDA7XG4gICAgICAgIHRoaXMuc3RhdGUucmVzb2x2ZXIgPSB2b2lkIDA7XG4gICAgICAgIHZvaWQgc2V0dGxlKHJlc29sdmVyLCB3YXRjaGVyLCBcIm9uRnVsZmlsbGVkXCIsIHZhbHVlLCB3YXRjaGVyQXJncyk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIG9uUmVqZWN0ZWQocmVhc29uKSB7XG4gICAgICAgIGNvbnN0IHsgdm93LCB3YXRjaGVyLCB3YXRjaGVyQXJncywgcmVzb2x2ZXIsIHByaW9yUmV0cnlWYWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFyZXNvbHZlcikge1xuICAgICAgICAgIHRocm93IEVycm9yKFwiVW5leHBlY3RlZCBtdWx0aXBsZSBjYWxscyB0byBQcm9taXNlV2F0Y2hlclwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXRyeVZhbHVlID0gaXNSZXRyeWFibGVSZWFzb24yKHJlYXNvbiwgcHJpb3JSZXRyeVZhbHVlKTtcbiAgICAgICAgaWYgKHJldHJ5VmFsdWUpIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLnByaW9yUmV0cnlWYWx1ZSA9IHJldHJ5VmFsdWU7XG4gICAgICAgICAgaWYgKHZvdykge1xuICAgICAgICAgICAgd2F0Y2hOZXh0U3RlcCh2b3csIHRoaXMuc2VsZik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHdhdGNoZXJTZWVuUGF5bG9hZHMuZGVsZXRlKHRoaXMuc2VsZik7XG4gICAgICAgIHRoaXMuc3RhdGUucHJpb3JSZXRyeVZhbHVlID0gdm9pZCAwO1xuICAgICAgICB0aGlzLnN0YXRlLnJlc29sdmVyID0gdm9pZCAwO1xuICAgICAgICB0aGlzLnN0YXRlLndhdGNoZXIgPSB2b2lkIDA7XG4gICAgICAgIHZvaWQgc2V0dGxlKHJlc29sdmVyLCB3YXRjaGVyLCBcIm9uUmVqZWN0ZWRcIiwgcmVhc29uLCB3YXRjaGVyQXJncyk7XG4gICAgICB9XG4gICAgfVxuICApO1xufTtcbnZhciBwcmVwYXJlV2F0Y2ggPSAoem9uZSwgbWFrZVZvd0tpdCwgaXNSZXRyeWFibGVSZWFzb24yID0gKF9yZWFzb24sIF9sYXN0VmFsdWUpID0+IHZvaWQgMCkgPT4ge1xuICBjb25zdCB3YXRjaE5leHRTdGVwID0gbWFrZVdhdGNoTmV4dFN0ZXAoem9uZSk7XG4gIGNvbnN0IG1ha2VQcm9taXNlV2F0Y2hlciA9IHByZXBhcmVQcm9taXNlV2F0Y2hlcihcbiAgICB6b25lLFxuICAgIGlzUmV0cnlhYmxlUmVhc29uMixcbiAgICB3YXRjaE5leHRTdGVwXG4gICk7XG4gIGNvbnN0IHdhdGNoID0gKHNwZWNpbWVuUCwgd2F0Y2hlciwgLi4ud2F0Y2hlckFyZ3MpID0+IHtcbiAgICBjb25zdCB7IHJlc29sdmVyLCB2b3cgfSA9IG1ha2VWb3dLaXQoKTtcbiAgICBjb25zdCBwcm9taXNlV2F0Y2hlciA9IG1ha2VQcm9taXNlV2F0Y2hlcihyZXNvbHZlciwgd2F0Y2hlciwgd2F0Y2hlckFyZ3MpO1xuICAgIGNvbnN0IHByb21pc2UgPSBFLnJlc29sdmUoc3BlY2ltZW5QKTtcbiAgICB6b25lLndhdGNoUHJvbWlzZShwcm9taXNlLCBwcm9taXNlV2F0Y2hlcik7XG4gICAgcmV0dXJuIHZvdztcbiAgfTtcbiAgaGFyZGVuKHdhdGNoKTtcbiAgcmV0dXJuIHdhdGNoO1xufTtcbmhhcmRlbihwcmVwYXJlV2F0Y2gpO1xuXG4vL1xudmFyIG1ha2VVbmhhbmRsZWRSZWplY3Rpb25DYW5jZWxsZXIgPSAocmVqZWN0ZWQsIHVwZ3JhZGVkUEspID0+IHtcbiAgcmV0dXJuICgpID0+IHtcbiAgICByZWplY3RlZD8uY2F0Y2goc2luazIpO1xuICAgIHVwZ3JhZGVkUEs/LnJlc29sdmUoKTtcbiAgfTtcbn07XG52YXIgcHJlcGFyZVZvd1JlamVjdGlvblRyYWNrZXIgPSAoem9uZSkgPT4ge1xuICBjb25zdCB2b3dUb0NhbmNlbFVuaGFuZGxlZFJlamVjdGlvbiA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCB1cGdyYWRlUmVqZWN0aW9uV2F0Y2hlciA9IHpvbmUuZXhvKFxuICAgIFwiVXBncmFkZVJlamVjdGlvbldhdGNoZXJcIixcbiAgICBNLmludGVyZmFjZShcIlVwZ3JhZGVSZWplY3Rpb25XYXRjaGVyXCIsIHtcbiAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLnJhdygpLCBNLnJhdygpKS5yZXR1cm5zKClcbiAgICB9KSxcbiAgICB7XG4gICAgICBvblJlamVjdGVkKHVwZ3JhZGVSZWFzb24sIGJhc2VSZWFzb24pIHtcbiAgICAgICAgY29uc3QgcmVhc29uID0gYXNzZXJ0LmVycm9yKFxuICAgICAgICAgIHJlZGFjdGVkYFZPV19SRUpFQ1RJT04gJHtiYXNlUmVhc29ufSBub3QgaGFuZGxlZCBiZWZvcmUgdXBncmFkZSAke3VwZ3JhZGVSZWFzb259YFxuICAgICAgICApO1xuICAgICAgICB0aHJvdyByZWFzb247XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCB2b3dSZWplY3Rpb25UcmFja2VyID0gem9uZS5leG8oXG4gICAgXCJWb3dSZWplY3Rpb25UcmFja2VyXCIsXG4gICAgTS5pbnRlcmZhY2UoXCJWb3dSZWplY3Rpb25UcmFja2VyXCIsIHtcbiAgICAgIGhhbmRsZTogTS5jYWxsKE0ucmVtb3RhYmxlKCkpLnJldHVybnMoKSxcbiAgICAgIHJlamVjdDogTS5jYWxsKE0ucmVtb3RhYmxlKCksIE0ucmF3KCkpLnJldHVybnMoKVxuICAgIH0pLFxuICAgIHtcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgaGFuZGxlKHZvd0NhcCkge1xuICAgICAgICBjb25zdCBjYW5jZWwgPSB2b3dUb0NhbmNlbFVuaGFuZGxlZFJlamVjdGlvbi5nZXQodm93Q2FwKTtcbiAgICAgICAgaWYgKCFjYW5jZWwpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICBhc3NlcnQuZXJyb3IoXG4gICAgICAgICAgICAgIHJlZGFjdGVkYE5vdyBoYW5kbGluZyBhIFZPV19SRUpFQ1RJT04gZnJvbSBhIHByaW9yIGluY2FybmF0aW9uIGZvciAke3Zvd0NhcH1gXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdm93VG9DYW5jZWxVbmhhbmRsZWRSZWplY3Rpb24uZGVsZXRlKHZvd0NhcCk7XG4gICAgICAgIGNhbmNlbCgpO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICByZWplY3Qodm93Q2FwLCByZWFzb24pIHtcbiAgICAgICAgaWYgKHZvd1RvQ2FuY2VsVW5oYW5kbGVkUmVqZWN0aW9uLmhhcyh2b3dDYXApKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGhhcmRlbihyZWFzb24pO1xuICAgICAgICBjb25zdCBiYXNlUmVhc29uID0gem9uZS5pc1N0b3JhYmxlKHJlYXNvbikgPyByZWFzb24gOiBhc3NlcnQuZXJyb3IocmVkYWN0ZWRgVm93IHJlamVjdGlvbiByZWFzb24gd2FzIG5vdCBzdG9yZWQ6ICR7cmVhc29ufWApO1xuICAgICAgICBjb25zdCB1cGdyYWRlZFBLID0gbWFrZVByb21pc2VLaXQoKTtcbiAgICAgICAgem9uZS53YXRjaFByb21pc2UoXG4gICAgICAgICAgdXBncmFkZWRQSy5wcm9taXNlLFxuICAgICAgICAgIHVwZ3JhZGVSZWplY3Rpb25XYXRjaGVyLFxuICAgICAgICAgIGJhc2VSZWFzb25cbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgcmVqZWN0ZWQgPSBQcm9taXNlLnJlamVjdChyZWFzb24pO1xuICAgICAgICBjb25zdCBjYW5jZWwgPSBtYWtlVW5oYW5kbGVkUmVqZWN0aW9uQ2FuY2VsbGVyKHJlamVjdGVkLCB1cGdyYWRlZFBLKTtcbiAgICAgICAgdm93VG9DYW5jZWxVbmhhbmRsZWRSZWplY3Rpb24uc2V0KHZvd0NhcCwgY2FuY2VsKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiB2b3dSZWplY3Rpb25UcmFja2VyO1xufTtcblxuLy9cbnZhciB7IGRlZmluZVByb3BlcnRpZXM6IGRlZmluZVByb3BlcnRpZXM0IH0gPSBPYmplY3Q7XG52YXIgUmV0cnlhYmxlRmxvd0lLaXQgPSBoYXJkZW4oe1xuICBmbG93OiBNLmludGVyZmFjZShcIkZsb3dcIiwge1xuICAgIHJlc3RhcnQ6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgICBnZXRPdXRjb21lOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKVxuICB9KSxcbiAgcmVzdWx0V2F0Y2hlcjogUHJvbWlzZVdhdGNoZXJJXG59KTtcbnZhciBBZG1pblJldHJ5YWJsZUZsb3dJID0gTS5pbnRlcmZhY2UoXCJSZXRyeWFibGVGbG93QWRtaW5cIiwge1xuICBnZXRGbG93Rm9yT3V0Y29tZVZvdzogTS5jYWxsKFZvd1NoYXBlKS5yZXR1cm5zKE0ub3B0KE0ucmVtb3RhYmxlKFwiZmxvd1wiKSkpXG59KTtcbnZhciBwcmVwYXJlUmV0cnlhYmxlVG9vbHMgPSAob3V0ZXJab25lLCBvdXRlck9wdGlvbnMpID0+IHtcbiAgY29uc3QgeyBtYWtlVm93S2l0LCBpc1JldHJ5YWJsZVJlYXNvbjogaXNSZXRyeWFibGVSZWFzb24yIH0gPSBvdXRlck9wdGlvbnM7XG4gIGNvbnN0IGFzVm93ID0gbWFrZUFzVm93KG1ha2VWb3dLaXQpO1xuICBjb25zdCBmbG93Rm9yT3V0Y29tZVZvd0tleSA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBvdXRlclpvbmUubWFwU3RvcmUoXCJyZXRyeWFibGVGbG93Rm9yT3V0Y29tZVZvd1wiLCB7XG4gICAgICBrZXlTaGFwZTogTS5yZW1vdGFibGUoXCJ0b1Bhc3NhYmxlQ2FwXCIpLFxuICAgICAgdmFsdWVTaGFwZTogTS5yZW1vdGFibGUoXCJmbG93XCIpXG4gICAgICAvL1xuICAgIH0pXG4gICk7XG4gIGNvbnN0IHByZXBhcmVSZXRyeWFibGVGbG93S2l0ID0gKHpvbmUsIHRhZywgcmV0cnlhYmxlRnVuYykgPT4ge1xuICAgIHR5cGVvZiByZXRyeWFibGVGdW5jID09PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGByZXRyeWFibGVGdW5jIG11c3QgYmUgYSBjYWxsYWJsZSBmdW5jdGlvbiAke3JldHJ5YWJsZUZ1bmN9YDtcbiAgICBjb25zdCBpbnRlcm5hbE1ha2VSZXRyeWFibGVGbG93S2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICAgIHRhZyxcbiAgICAgIFJldHJ5YWJsZUZsb3dJS2l0LFxuICAgICAgKGFjdGl2YXRpb25BcmdzKSA9PiB7XG4gICAgICAgIGhhcmRlbihhY3RpdmF0aW9uQXJncyk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWN0aXZhdGlvbkFyZ3MsXG4gICAgICAgICAgLy9cbiAgICAgICAgICBvdXRjb21lS2l0OiBtYWtlVm93S2l0KCksXG4gICAgICAgICAgLy9cbiAgICAgICAgICBsYXN0UmV0cnlSZWFzb246IHZvaWQgMCxcbiAgICAgICAgICBydW5zOiAwbixcbiAgICAgICAgICBpc0RvbmU6IGZhbHNlXG4gICAgICAgICAgLy9cbiAgICAgICAgfTtcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGZsb3c6IHtcbiAgICAgICAgICAvKlxuXG5cbiAgICAgICAgICAgKi9cbiAgICAgICAgICByZXN0YXJ0KCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBhY3RpdmF0aW9uQXJncywgaXNEb25lIH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdywgcmVzdWx0V2F0Y2hlciB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgIWlzRG9uZSB8fCAvL1xuICAgICAgICAgICAgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcmVzdGFydCBhIGRvbmUgcmV0cnlhYmxlIGZsb3cgJHtmbG93fWA7XG4gICAgICAgICAgICBjb25zdCBydW5JZCA9IHN0YXRlLnJ1bnMgKyAxbjtcbiAgICAgICAgICAgIHN0YXRlLnJ1bnMgPSBydW5JZDtcbiAgICAgICAgICAgIGxldCByZXN1bHRQO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgcmVzdWx0UCA9IFByb21pc2UucmVzb2x2ZShyZXRyeWFibGVGdW5jKC4uLmFjdGl2YXRpb25BcmdzKSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgcmVzdWx0UCA9IFByb21pc2UucmVqZWN0KGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvdXRlclpvbmUud2F0Y2hQcm9taXNlKGhhcmRlbihyZXN1bHRQKSwgcmVzdWx0V2F0Y2hlciwgcnVuSWQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0T3V0Y29tZSgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IG91dGNvbWVLaXQgfSA9IHN0YXRlO1xuICAgICAgICAgICAgcmV0dXJuIG91dGNvbWVLaXQudm93O1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcmVzdWx0V2F0Y2hlcjoge1xuICAgICAgICAgIG9uRnVsZmlsbGVkKHZhbHVlLCBydW5JZCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgcnVucywgb3V0Y29tZUtpdCB9ID0gc3RhdGU7XG4gICAgICAgICAgICBpZiAocnVuSWQgIT09IHJ1bnMpIHJldHVybjtcbiAgICAgICAgICAgICFzdGF0ZS5pc0RvbmUgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcmVzb2x2ZSBhIGRvbmUgcmV0cnlhYmxlIGZsb3cgJHt0aGlzLmZhY2V0cy5mbG93fWA7XG4gICAgICAgICAgICBvdXRjb21lS2l0LnJlc29sdmVyLnJlc29sdmUodmFsdWUpO1xuICAgICAgICAgICAgZmxvd0Zvck91dGNvbWVWb3dLZXkuZGVsZXRlKHRvUGFzc2FibGVDYXAob3V0Y29tZUtpdC52b3cpKTtcbiAgICAgICAgICAgIHN0YXRlLmlzRG9uZSA9IHRydWU7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgcnVuSWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IHJ1bnMsIG91dGNvbWVLaXQgfSA9IHN0YXRlO1xuICAgICAgICAgICAgaWYgKHJ1bklkICE9PSBydW5zKSByZXR1cm47XG4gICAgICAgICAgICAhc3RhdGUuaXNEb25lIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlamVjdCBhIGRvbmUgcmV0cnlhYmxlIGZsb3cgJHt0aGlzLmZhY2V0cy5mbG93fWA7XG4gICAgICAgICAgICBjb25zdCByZXRyeVJlYXNvbiA9IGlzUmV0cnlhYmxlUmVhc29uMihcbiAgICAgICAgICAgICAgcmVhc29uLFxuICAgICAgICAgICAgICBzdGF0ZS5sYXN0UmV0cnlSZWFzb25cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAocmV0cnlSZWFzb24pIHtcbiAgICAgICAgICAgICAgc3RhdGUubGFzdFJldHJ5UmVhc29uID0gcmV0cnlSZWFzb247XG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmZsb3cucmVzdGFydCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgb3V0Y29tZUtpdC5yZXNvbHZlci5yZWplY3QocmVhc29uKTtcbiAgICAgICAgICAgICAgZmxvd0Zvck91dGNvbWVWb3dLZXkuZGVsZXRlKHRvUGFzc2FibGVDYXAob3V0Y29tZUtpdC52b3cpKTtcbiAgICAgICAgICAgICAgc3RhdGUuaXNEb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICAgIGNvbnN0IG1ha2VSZXRyeWFibGVGbG93S2l0ID0gKGFjdGl2YXRpb25BcmdzKSA9PiB7XG4gICAgICBjb25zdCByZXRyeWFibGVLaXQgPSBpbnRlcm5hbE1ha2VSZXRyeWFibGVGbG93S2l0KGFjdGl2YXRpb25BcmdzKTtcbiAgICAgIGNvbnN0IHsgZmxvdyB9ID0gcmV0cnlhYmxlS2l0O1xuICAgICAgY29uc3Qgdm93ID0gZmxvdy5nZXRPdXRjb21lKCk7XG4gICAgICBmbG93Rm9yT3V0Y29tZVZvd0tleS5pbml0KHRvUGFzc2FibGVDYXAodm93KSwgZmxvdyk7XG4gICAgICBmbG93LnJlc3RhcnQoKTtcbiAgICAgIHJldHVybiByZXRyeWFibGVLaXQ7XG4gICAgfTtcbiAgICByZXR1cm4gaGFyZGVuKG1ha2VSZXRyeWFibGVGbG93S2l0KTtcbiAgfTtcbiAgY29uc3QgcmV0cnlhYmxlID0gKHpvbmUsIHRhZywgcmV0cnlhYmxlRnVuYykgPT4ge1xuICAgIGNvbnN0IG1ha2VSZXRyeWFibGVLaXQgPSBwcmVwYXJlUmV0cnlhYmxlRmxvd0tpdCh6b25lLCB0YWcsIHJldHJ5YWJsZUZ1bmMpO1xuICAgIGNvbnN0IHdyYXBwZXJGdW5jTmFtZSA9IGAke3RhZ31fcmV0cnlhYmxlYDtcbiAgICBjb25zdCB3cmFwcGVyRnVuYyA9IHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBbd3JhcHBlckZ1bmNOYW1lXSguLi5hcmdzKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgem9uZS5pc1N0b3JhYmxlKGhhcmRlbihhcmdzKSkgfHwgdGhyb3dSZWRhY3RlZGByZXRyeWFibGUgYXJndW1lbnRzIG11c3QgYmUgc3RvcmFibGUgJHthcmdzfWA7XG4gICAgICAgICAgY29uc3QgeyBmbG93IH0gPSBtYWtlUmV0cnlhYmxlS2l0KGFyZ3MpO1xuICAgICAgICAgIHJldHVybiBmbG93LmdldE91dGNvbWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVt3cmFwcGVyRnVuY05hbWVdO1xuICAgIGRlZmluZVByb3BlcnRpZXM0KHdyYXBwZXJGdW5jLCB7XG4gICAgICBsZW5ndGg6IHsgdmFsdWU6IHJldHJ5YWJsZUZ1bmMubGVuZ3RoIH1cbiAgICB9KTtcbiAgICByZXR1cm4gaGFyZGVuKHdyYXBwZXJGdW5jKTtcbiAgfTtcbiAgY29uc3QgYWRtaW5SZXRyeWFibGVGbG93ID0gb3V0ZXJab25lLmV4byhcbiAgICBcIkFkbWluUmV0cnlhYmxlRmxvd1wiLFxuICAgIEFkbWluUmV0cnlhYmxlRmxvd0ksXG4gICAge1xuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBnZXRGbG93Rm9yT3V0Y29tZVZvdyhvdXRjb21lVm93KSB7XG4gICAgICAgIHJldHVybiBmbG93Rm9yT3V0Y29tZVZvd0tleS5nZXQodG9QYXNzYWJsZUNhcChvdXRjb21lVm93KSk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBwcmVwYXJlUmV0cnlhYmxlRmxvd0tpdCxcbiAgICBhZG1pblJldHJ5YWJsZUZsb3csXG4gICAgcmV0cnlhYmxlXG4gIH0pO1xufTtcbmhhcmRlbihwcmVwYXJlUmV0cnlhYmxlVG9vbHMpO1xuXG4vL1xudmFyIG1ha2VXaGVuID0gKGlzUmV0cnlhYmxlUmVhc29uMiA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgKCkgPT4gZmFsc2VcbikpID0+IHtcbiAgY29uc3QgdW53cmFwID0gYXN5bmMgKHNwZWNpbWVuUCkgPT4ge1xuICAgIGF3YWl0IG51bGw7XG4gICAgbGV0IHJlc3VsdCA9IGF3YWl0IHNwZWNpbWVuUDtcbiAgICBsZXQgcGF5bG9hZCA9IGdldFZvd1BheWxvYWQocmVzdWx0KTtcbiAgICBsZXQgcHJpb3JSZXRyeVZhbHVlO1xuICAgIGNvbnN0IHNlZW5QYXlsb2FkcyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xuICAgIHdoaWxlIChwYXlsb2FkKSB7XG4gICAgICBjb25zdCB7IHZvd1YwIH0gPSBwYXlsb2FkO1xuICAgICAgaWYgKHNlZW5QYXlsb2Fkcy5oYXModm93VjApKSB7XG4gICAgICAgIHRocm93IEVycm9yKFwiVm93IHJlc29sdXRpb24gY3ljbGUgZGV0ZWN0ZWRcIik7XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBFKHZvd1YwKS5zaG9ydGVuKCk7XG4gICAgICAgIHNlZW5QYXlsb2Fkcy5hZGQodm93VjApO1xuICAgICAgICBwcmlvclJldHJ5VmFsdWUgPSB2b2lkIDA7XG4gICAgICAgIHJlc3VsdCA9IHJlcztcbiAgICAgIH0gY2F0Y2ggKGUyKSB7XG4gICAgICAgIGNvbnN0IG5leHRSZXRyeVZhbHVlID0gaXNSZXRyeWFibGVSZWFzb24yKGUyLCBwcmlvclJldHJ5VmFsdWUpO1xuICAgICAgICBpZiAoIW5leHRSZXRyeVZhbHVlKSB7XG4gICAgICAgICAgdGhyb3cgZTI7XG4gICAgICAgIH1cbiAgICAgICAgcHJpb3JSZXRyeVZhbHVlID0gbmV4dFJldHJ5VmFsdWU7XG4gICAgICB9XG4gICAgICBwYXlsb2FkID0gZ2V0Vm93UGF5bG9hZChyZXN1bHQpO1xuICAgIH1cbiAgICBjb25zdCB1bndyYXBwZWQgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICByZXN1bHRcbiAgICApO1xuICAgIHJldHVybiB1bndyYXBwZWQ7XG4gIH07XG4gIGNvbnN0IHdoZW4gPSAoc3BlY2ltZW5QLCBvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgPT4ge1xuICAgIGNvbnN0IHVud3JhcHBlZCA9IHVud3JhcChzcGVjaW1lblApO1xuICAgIGlmIChvbkZ1bGZpbGxlZCA9PSBudWxsICYmIG9uUmVqZWN0ZWQgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdW53cmFwcGVkXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gRS5yZXNvbHZlKHVud3JhcHBlZCkudGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCk7XG4gIH07XG4gIGhhcmRlbih3aGVuKTtcbiAgcmV0dXJuIHdoZW47XG59O1xuaGFyZGVuKG1ha2VXaGVuKTtcblxuLy9cbnZhciBwcmVwYXJlQmFzaWNWb3dUb29scyA9ICh6b25lLCBwb3dlcnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IGlzUmV0cnlhYmxlUmVhc29uOiBpc1JldHJ5YWJsZVJlYXNvbjIgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAoKSA9PiBmYWxzZVxuICApIH0gPSBwb3dlcnM7XG4gIGNvbnN0IHZvd1JlamVjdGlvblRyYWNrZXIgPSBwcmVwYXJlVm93UmVqZWN0aW9uVHJhY2tlcih6b25lKTtcbiAgY29uc3QgbWFrZVZvd0tpdCA9IHByZXBhcmVWb3dLaXQoem9uZSwgdm93UmVqZWN0aW9uVHJhY2tlcik7XG4gIGNvbnN0IHdoZW4gPSBtYWtlV2hlbihpc1JldHJ5YWJsZVJlYXNvbjIpO1xuICBjb25zdCB3YXRjaCA9IHByZXBhcmVXYXRjaCh6b25lLCBtYWtlVm93S2l0LCBpc1JldHJ5YWJsZVJlYXNvbjIpO1xuICBjb25zdCBtYWtlV2F0Y2hVdGlscyA9IHByZXBhcmVXYXRjaFV0aWxzKHpvbmUsIHtcbiAgICB3YXRjaCxcbiAgICB3aGVuLFxuICAgIG1ha2VWb3dLaXQsXG4gICAgaXNSZXRyeWFibGVSZWFzb246IGlzUmV0cnlhYmxlUmVhc29uMlxuICB9KTtcbiAgY29uc3Qgd2F0Y2hVdGlscyA9IG1ha2VXYXRjaFV0aWxzKCk7XG4gIGNvbnN0IGFzVm93ID0gbWFrZUFzVm93KG1ha2VWb3dLaXQpO1xuICBjb25zdCB7IHJldHJ5YWJsZSB9ID0gcHJlcGFyZVJldHJ5YWJsZVRvb2xzKHpvbmUsIHtcbiAgICBtYWtlVm93S2l0LFxuICAgIGlzUmV0cnlhYmxlUmVhc29uOiBpc1JldHJ5YWJsZVJlYXNvbjJcbiAgfSk7XG4gIGNvbnN0IGFsbCA9IChtYXliZVZvd3MpID0+IHdhdGNoVXRpbHMuYWxsKG1heWJlVm93cyk7XG4gIGNvbnN0IGFsbFZvd3MgPSBhbGw7XG4gIGNvbnN0IGFsbFNldHRsZWQgPSAobWF5YmVWb3dzKSA9PiB3YXRjaFV0aWxzLmFsbFNldHRsZWQobWF5YmVWb3dzKTtcbiAgY29uc3QgYXNQcm9taXNlID0gKHNwZWNpbWVuUCwgLi4ud2F0Y2hlckFyZ3MpID0+IHdhdGNoVXRpbHMuYXNQcm9taXNlKHNwZWNpbWVuUCwgLi4ud2F0Y2hlckFyZ3MpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICB3aGVuLFxuICAgIHdhdGNoLFxuICAgIG1ha2VWb3dLaXQsXG4gICAgYWxsLFxuICAgIGFsbFZvd3MsXG4gICAgYWxsU2V0dGxlZCxcbiAgICBhc1ZvdyxcbiAgICBhc1Byb21pc2UsXG4gICAgcmV0cnlhYmxlLFxuICAgIHJldHJpYWJsZTogcmV0cnlhYmxlXG4gICAgLy9cbiAgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVCYXNpY1Zvd1Rvb2xzKTtcblxuLy9cbnZhciBoaWRkZW5QcmlvckVycm9yMjtcbnZhciBoaWRkZW5DdXJyZW50VHVybjIgPSAwO1xudmFyIGhpZGRlbkN1cnJlbnRFdmVudDIgPSAwO1xudmFyIFZFUkJPU0UyID0gZW52aXJvbm1lbnRPcHRpb25zTGlzdEhhcyhcIkRFQlVHXCIsIFwidHJhY2stdHVybnNcIik7XG52YXIgRU5BQkxFRDIgPSBnZXRFbnZpcm9ubWVudE9wdGlvbihcIlRSQUNLX1RVUk5TXCIsIFwiZGlzYWJsZWRcIiwgW1wiZW5hYmxlZFwiXSkgPT09IFwiZW5hYmxlZFwiO1xudmFyIGFkZFJlamVjdGlvbk5vdGUyID0gKGRldGFpbHNOb3RlKSA9PiAocmVhc29uKSA9PiB7XG4gIGlmIChyZWFzb24gaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIG5vdGUocmVhc29uLCBkZXRhaWxzTm90ZSk7XG4gIH1cbiAgaWYgKFZFUkJPU0UyKSB7XG4gICAgY29uc29sZS5sb2coXCJSRUpFQ1RFRCBhdCB0b3Agb2YgZXZlbnQgbG9vcFwiLCByZWFzb24pO1xuICB9XG59O1xudmFyIHdyYXBGdW5jdGlvbjIgPSAoZnVuYywgc2VuZGluZ0Vycm9yKSA9PiAoLi4uYXJncykgPT4ge1xuICBoaWRkZW5QcmlvckVycm9yMiA9IHNlbmRpbmdFcnJvcjtcbiAgaGlkZGVuQ3VycmVudFR1cm4yICs9IDE7XG4gIGhpZGRlbkN1cnJlbnRFdmVudDIgPSAwO1xuICB0cnkge1xuICAgIGxldCByZXN1bHQ7XG4gICAgdHJ5IHtcbiAgICAgIHJlc3VsdCA9IGZ1bmMoLi4uYXJncyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoZXJyIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgbm90ZShcbiAgICAgICAgICBlcnIsXG4gICAgICAgICAgcmVkYWN0ZWRgVGhyb3duIGZyb206ICR7aGlkZGVuUHJpb3JFcnJvcjJ9OiR7aGlkZGVuQ3VycmVudFR1cm4yfS4ke2hpZGRlbkN1cnJlbnRFdmVudDJ9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKFZFUkJPU0UyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiVEhST1dOIHRvIHRvcCBvZiBldmVudCBsb29wXCIsIGVycik7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGNvbnN0IGRldGFpbHNOb3RlID0gcmVkYWN0ZWRgUmVqZWN0aW9uIGZyb206ICR7aGlkZGVuUHJpb3JFcnJvcjJ9OiR7aGlkZGVuQ3VycmVudFR1cm4yfS4ke2hpZGRlbkN1cnJlbnRFdmVudDJ9YDtcbiAgICBQcm9taXNlLnJlc29sdmUocmVzdWx0KS5jYXRjaChhZGRSZWplY3Rpb25Ob3RlMihkZXRhaWxzTm90ZSkpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH0gZmluYWxseSB7XG4gICAgaGlkZGVuUHJpb3JFcnJvcjIgPSB2b2lkIDA7XG4gIH1cbn07XG52YXIgdHJhY2tUdXJuczIgPSAoZnVuY3MpID0+IHtcbiAgaWYgKCFFTkFCTEVEMiB8fCB0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gXCJ1bmRlZmluZWRcIiB8fCAhZ2xvYmFsVGhpcy5hc3NlcnQpIHtcbiAgICByZXR1cm4gZnVuY3M7XG4gIH1cbiAgaGlkZGVuQ3VycmVudEV2ZW50MiArPSAxO1xuICBjb25zdCBzZW5kaW5nRXJyb3IgPSBFcnJvcihcbiAgICBgRXZlbnQ6ICR7aGlkZGVuQ3VycmVudFR1cm4yfS4ke2hpZGRlbkN1cnJlbnRFdmVudDJ9YFxuICApO1xuICBpZiAoaGlkZGVuUHJpb3JFcnJvcjIgIT09IHZvaWQgMCkge1xuICAgIG5vdGUoc2VuZGluZ0Vycm9yLCByZWRhY3RlZGBDYXVzZWQgYnk6ICR7aGlkZGVuUHJpb3JFcnJvcjJ9YCk7XG4gIH1cbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICovXG4gICAgZnVuY3MubWFwKChmdW5jKSA9PiBmdW5jICYmIHdyYXBGdW5jdGlvbjIoZnVuYywgc2VuZGluZ0Vycm9yKSlcbiAgKTtcbn07XG5cbi8vXG52YXIgeyBoYXNPd246IGhhc093bjExLCBmcmVlemU6IGZyZWV6ZTEwLCBlbnRyaWVzOiBlbnRyaWVzOCB9ID0gT2JqZWN0O1xudmFyIGlzSlNPTlJlY29yZDIgPSAodmFsKSA9PiB0eXBlb2YgdmFsID09PSBcIm9iamVjdFwiICYmIHZhbCAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheSh2YWwpO1xudmFyIHNpbXBsaWZ5VGFnMiA9ICh0YWcpID0+IHtcbiAgZm9yIChjb25zdCBwcmVmaXggb2YgW1wiQWxsZWdlZDogXCIsIFwiRGVidWdOYW1lOiBcIl0pIHtcbiAgICBpZiAodGFnLnN0YXJ0c1dpdGgocHJlZml4KSkge1xuICAgICAgcmV0dXJuIHRhZy5zbGljZShwcmVmaXgubGVuZ3RoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRhZztcbn07XG52YXIgbWFrZU1lc3NhZ2VCcmVha3BvaW50VGVzdGVyMiA9IChvcHRpb25OYW1lKSA9PiB7XG4gIGxldCBicmVha3BvaW50cyA9IEpTT04ucGFyc2UoZ2V0RW52aXJvbm1lbnRPcHRpb24ob3B0aW9uTmFtZSwgXCJudWxsXCIpKTtcbiAgaWYgKGJyZWFrcG9pbnRzID09PSBudWxsKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBsZXQgYnJlYWtwb2ludHNUYWJsZTtcbiAgY29uc3QgZ2V0QnJlYWtwb2ludHMgPSAoKSA9PiBicmVha3BvaW50cztcbiAgZnJlZXplMTAoZ2V0QnJlYWtwb2ludHMpO1xuICBjb25zdCBzZXRCcmVha3BvaW50cyA9IChuZXdCcmVha3BvaW50cyA9IGJyZWFrcG9pbnRzKSA9PiB7XG4gICAgaXNKU09OUmVjb3JkMihuZXdCcmVha3BvaW50cykgfHwgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCAke3F1b3RlKG9wdGlvbk5hbWUpfSBvcHRpb24gdG8gYmUgYSBKU09OIGJyZWFrcG9pbnRzIHJlY29yZGA7XG4gICAgY29uc3QgbmV3QnJlYWtwb2ludHNUYWJsZSA9IHsgX19wcm90b19fOiBudWxsIH07XG4gICAgZm9yIChjb25zdCBbdGFnLCBtZXRob2RCUHNdIG9mIGVudHJpZXM4KG5ld0JyZWFrcG9pbnRzKSkge1xuICAgICAgdGFnID09PSBzaW1wbGlmeVRhZzIodGFnKSB8fCB0aHJvd1JlZGFjdGVkYEp1c3QgdXNlIHNpbXBsZSB0YWcgJHtxdW90ZShzaW1wbGlmeVRhZzIodGFnKSl9IHJhdGhlciB0aGFuICR7cXVvdGUodGFnKX1gO1xuICAgICAgaXNKU09OUmVjb3JkMihtZXRob2RCUHMpIHx8IHRocm93UmVkYWN0ZWRgRXhwZWN0ZWQgJHtxdW90ZShvcHRpb25OYW1lKX0gb3B0aW9uJ3MgJHtxdW90ZShcbiAgICAgICAgdGFnXG4gICAgICApfSB0byBiZSBhIEpTT04gbWV0aG9kcyBicmVha3BvaW50cyByZWNvcmRgO1xuICAgICAgZm9yIChjb25zdCBbbWV0aG9kTmFtZSwgY291bnRdIG9mIGVudHJpZXM4KG1ldGhvZEJQcykpIHtcbiAgICAgICAgY291bnQgPT09IFwiKlwiIHx8IHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiAmJiBOdW1iZXIuaXNTYWZlSW50ZWdlcihjb3VudCkgJiYgY291bnQgPj0gMCB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkICR7cXVvdGUob3B0aW9uTmFtZSl9IG9wdGlvbidzICR7cXVvdGUodGFnKX0uJHtxdW90ZShcbiAgICAgICAgICBtZXRob2ROYW1lXG4gICAgICAgICl9IHRvIGJlIFwiKlwiIG9yIGEgbm9uLW5lZ2F0aXZlIGludGVnZXJgO1xuICAgICAgICBjb25zdCBjbGFzc0JQcyA9IGhhc093bjExKG5ld0JyZWFrcG9pbnRzVGFibGUsIG1ldGhvZE5hbWUpID8gbmV3QnJlYWtwb2ludHNUYWJsZVttZXRob2ROYW1lXSA6IG5ld0JyZWFrcG9pbnRzVGFibGVbbWV0aG9kTmFtZV0gPSB7XG4gICAgICAgICAgLy9cbiAgICAgICAgICBfX3Byb3RvX186IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgY2xhc3NCUHNbdGFnXSA9IGNvdW50O1xuICAgICAgfVxuICAgIH1cbiAgICBicmVha3BvaW50cyA9IG5ld0JyZWFrcG9pbnRzO1xuICAgIGJyZWFrcG9pbnRzVGFibGUgPSBuZXdCcmVha3BvaW50c1RhYmxlO1xuICB9O1xuICBmcmVlemUxMChzZXRCcmVha3BvaW50cyk7XG4gIGNvbnN0IHNob3VsZEJyZWFrcG9pbnQgPSAocmVjaXBpZW50LCBtZXRob2ROYW1lKSA9PiB7XG4gICAgaWYgKG1ldGhvZE5hbWUgPT09IHZvaWQgMCB8fCBtZXRob2ROYW1lID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGNsYXNzQlBzID0gYnJlYWtwb2ludHNUYWJsZVttZXRob2ROYW1lXSB8fCBicmVha3BvaW50c1RhYmxlW1wiKlwiXTtcbiAgICBpZiAoY2xhc3NCUHMgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBsZXQgdGFnID0gc2ltcGxpZnlUYWcyKHJlY2lwaWVudFtTeW1ib2wudG9TdHJpbmdUYWddKTtcbiAgICBsZXQgY291bnQgPSBjbGFzc0JQc1t0YWddO1xuICAgIGlmIChjb3VudCA9PT0gdm9pZCAwKSB7XG4gICAgICB0YWcgPSBcIipcIjtcbiAgICAgIGNvdW50ID0gY2xhc3NCUHNbdGFnXTtcbiAgICAgIGlmIChjb3VudCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvdW50ID09PSBcIipcIikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChjb3VudCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGFzc2VydCh0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIgJiYgY291bnQgPj0gMSk7XG4gICAgY2xhc3NCUHNbdGFnXSA9IGNvdW50IC0gMTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIGZyZWV6ZTEwKHNob3VsZEJyZWFrcG9pbnQpO1xuICBjb25zdCBicmVha3BvaW50VGVzdGVyID0gZnJlZXplMTAoe1xuICAgIGdldEJyZWFrcG9pbnRzLFxuICAgIHNldEJyZWFrcG9pbnRzLFxuICAgIHNob3VsZEJyZWFrcG9pbnRcbiAgfSk7XG4gIGJyZWFrcG9pbnRUZXN0ZXIuc2V0QnJlYWtwb2ludHMoKTtcbiAgcmV0dXJuIGJyZWFrcG9pbnRUZXN0ZXI7XG59O1xuZnJlZXplMTAobWFrZU1lc3NhZ2VCcmVha3BvaW50VGVzdGVyMik7XG5cbi8vXG52YXIgeyBhc3NpZ246IGFzc2lnbjIsIGNyZWF0ZTogY3JlYXRlNiB9ID0gT2JqZWN0O1xudmFyIG9uU2VuZDIgPSBtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIyKFwiRU5ET19TRU5EX0JSRUFLUE9JTlRTXCIpO1xudmFyIGJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIyID0ge1xuICBzZXQoX3RhcmdldCwgX3Byb3AsIF92YWx1ZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgaXNFeHRlbnNpYmxlKF90YXJnZXQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIHNldFByb3RvdHlwZU9mKF90YXJnZXQsIF92YWx1ZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgZGVsZXRlUHJvcGVydHkoX3RhcmdldCwgX3Byb3ApIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG52YXIgbWFrZUVQcm94eUhhbmRsZXIyID0gKHJlY2lwaWVudCwgSGFuZGxlZFByb21pc2UyLCB1bndyYXApID0+IGhhcmRlbih7XG4gIC4uLmJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIyLFxuICBnZXQ6IChfdGFyZ2V0LCBwcm9wZXJ0eUtleSwgcmVjZWl2ZXIpID0+IHtcbiAgICByZXR1cm4gaGFyZGVuKFxuICAgICAge1xuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFtwcm9wZXJ0eUtleV0oLi4uYXJncykge1xuICAgICAgICAgIGlmICh0aGlzICE9PSByZWNlaXZlcikge1xuICAgICAgICAgICAgcmV0dXJuIEhhbmRsZWRQcm9taXNlMi5yZWplY3QoXG4gICAgICAgICAgICAgIG1ha2VFcnJvcihcbiAgICAgICAgICAgICAgICByZWRhY3RlZGBVbmV4cGVjdGVkIHJlY2VpdmVyIGZvciBcIiR7cXVvdGUocHJvcGVydHlLZXkpfVwiIG1ldGhvZCBvZiBFKCR7cXVvdGUoXG4gICAgICAgICAgICAgICAgICByZWNpcGllbnRcbiAgICAgICAgICAgICAgICApfSlgXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvblNlbmQyICYmIG9uU2VuZDIuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHByb3BlcnR5S2V5KSkge1xuICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB1bndyYXAoXG4gICAgICAgICAgICBIYW5kbGVkUHJvbWlzZTIuYXBwbHlNZXRob2QodW53cmFwKHJlY2lwaWVudCksIHByb3BlcnR5S2V5LCBhcmdzKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgIH1bcHJvcGVydHlLZXldXG4gICAgKTtcbiAgfSxcbiAgYXBwbHk6IChfdGFyZ2V0LCBfdGhpc0FyZywgYXJnQXJyYXkgPSBbXSkgPT4ge1xuICAgIGlmIChvblNlbmQyICYmIG9uU2VuZDIuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHZvaWQgMCkpIHtcbiAgICAgIGRlYnVnZ2VyO1xuICAgIH1cbiAgICByZXR1cm4gdW53cmFwKEhhbmRsZWRQcm9taXNlMi5hcHBseUZ1bmN0aW9uKHVud3JhcChyZWNpcGllbnQpLCBhcmdBcnJheSkpO1xuICB9LFxuICBoYXM6IChfdGFyZ2V0LCBfcCkgPT4ge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59KTtcbnZhciBtYWtlRVNlbmRPbmx5UHJveHlIYW5kbGVyMiA9IChyZWNpcGllbnQsIEhhbmRsZWRQcm9taXNlMiwgdW53cmFwKSA9PiBoYXJkZW4oe1xuICAuLi5iYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyMixcbiAgZ2V0OiAoX3RhcmdldCwgcHJvcGVydHlLZXksIHJlY2VpdmVyKSA9PiB7XG4gICAgcmV0dXJuIGhhcmRlbihcbiAgICAgIHtcbiAgICAgICAgLypcblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBbcHJvcGVydHlLZXldKC4uLmFyZ3MpIHtcbiAgICAgICAgICB0aGlzID09PSByZWNlaXZlciB8fCB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgcmVjZWl2ZXIgZm9yIFwiJHtxdW90ZShcbiAgICAgICAgICAgIHByb3BlcnR5S2V5XG4gICAgICAgICAgKX1cIiBtZXRob2Qgb2YgRS5zZW5kT25seSgke3F1b3RlKHJlY2lwaWVudCl9KWA7XG4gICAgICAgICAgaWYgKG9uU2VuZDIgJiYgb25TZW5kMi5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgcHJvcGVydHlLZXkpKSB7XG4gICAgICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgSGFuZGxlZFByb21pc2UyLmFwcGx5TWV0aG9kU2VuZE9ubHkoXG4gICAgICAgICAgICB1bndyYXAocmVjaXBpZW50KSxcbiAgICAgICAgICAgIHByb3BlcnR5S2V5LFxuICAgICAgICAgICAgYXJnc1xuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgfVxuICAgICAgICAvL1xuICAgICAgfVtwcm9wZXJ0eUtleV1cbiAgICApO1xuICB9LFxuICBhcHBseTogKF90YXJnZXQsIF90aGlzQXJnLCBhcmdzQXJyYXkgPSBbXSkgPT4ge1xuICAgIGlmIChvblNlbmQyICYmIG9uU2VuZDIuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHZvaWQgMCkpIHtcbiAgICAgIGRlYnVnZ2VyO1xuICAgIH1cbiAgICBIYW5kbGVkUHJvbWlzZTIuYXBwbHlGdW5jdGlvblNlbmRPbmx5KHVud3JhcChyZWNpcGllbnQpLCBhcmdzQXJyYXkpO1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH0sXG4gIGhhczogKF90YXJnZXQsIF9wKSA9PiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn0pO1xudmFyIG1ha2VFR2V0UHJveHlIYW5kbGVyMiA9ICh4LCBIYW5kbGVkUHJvbWlzZTIsIHVud3JhcCkgPT4gaGFyZGVuKHtcbiAgLi4uYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlcjIsXG4gIGhhczogKF90YXJnZXQsIF9wcm9wKSA9PiB0cnVlLFxuICBnZXQ6IChfdGFyZ2V0LCBwcm9wKSA9PiBIYW5kbGVkUHJvbWlzZTIuZ2V0KHVud3JhcCh4KSwgcHJvcClcbn0pO1xudmFyIHJlc29sdmUgPSAoeCkgPT4gSGFuZGxlZFByb21pc2UucmVzb2x2ZSh4KTtcbnZhciBtYWtlRTIgPSAoSGFuZGxlZFByb21pc2UyLCBwb3dlcnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgYWRkaXRpb25hbCA9IChcbiAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgIHt9XG4gICAgKSxcbiAgICB1bndyYXAgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHJlc29sdmVcbiAgICApXG4gIH0gPSBwb3dlcnM7XG4gIHJldHVybiBoYXJkZW4oXG4gICAgYXNzaWduMihcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgKHgpID0+IGhhcmRlbihcbiAgICAgICAgbmV3IFByb3h5KCgpID0+IHtcbiAgICAgICAgfSwgbWFrZUVQcm94eUhhbmRsZXIyKHgsIEhhbmRsZWRQcm9taXNlMiwgdW53cmFwKSlcbiAgICAgICksXG4gICAgICB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBnZXQ6ICh4KSA9PiBoYXJkZW4oXG4gICAgICAgICAgbmV3IFByb3h5KFxuICAgICAgICAgICAgY3JlYXRlNihudWxsKSxcbiAgICAgICAgICAgIG1ha2VFR2V0UHJveHlIYW5kbGVyMih4LCBIYW5kbGVkUHJvbWlzZTIsIHVud3JhcClcbiAgICAgICAgICApXG4gICAgICAgICksXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHJlc29sdmU6ICh4KSA9PiByZXNvbHZlKHVud3JhcCh4KSksXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHNlbmRPbmx5OiAoeCkgPT4gaGFyZGVuKFxuICAgICAgICAgIG5ldyBQcm94eShcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtYWtlRVNlbmRPbmx5UHJveHlIYW5kbGVyMih4LCBIYW5kbGVkUHJvbWlzZTIsIHVud3JhcClcbiAgICAgICAgICApXG4gICAgICAgICksXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgd2hlbjogKHgsIG9uZnVsZmlsbGVkLCBvbnJlamVjdGVkKSA9PiB7XG4gICAgICAgICAgY29uc3QgdW53cmFwcGVkID0gcmVzb2x2ZSh1bndyYXAoeCkpO1xuICAgICAgICAgIGlmIChvbmZ1bGZpbGxlZCA9PSBudWxsICYmIG9ucmVqZWN0ZWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHVud3JhcHBlZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHVud3JhcHBlZC50aGVuKFxuICAgICAgICAgICAgLi4udHJhY2tUdXJuczIoXG4gICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgIFtvbmZ1bGZpbGxlZCwgb25yZWplY3RlZF1cbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYWRkaXRpb25hbFxuICAgIClcbiAgKTtcbn07XG52YXIgRV9kZWZhdWx0MiA9IG1ha2VFMjtcblxuLy9cbnZhciBpc1JldHJ5YWJsZVJlYXNvbiA9IChyZWFzb24sIHByaW9yUmV0cnlWYWx1ZSkgPT4ge1xuICBpZiAoaXNVcGdyYWRlRGlzY29ubmVjdGlvbihyZWFzb24pICYmICghaXNVcGdyYWRlRGlzY29ubmVjdGlvbihwcmlvclJldHJ5VmFsdWUpIHx8IHJlYXNvbi5pbmNhcm5hdGlvbk51bWJlciA+IHByaW9yUmV0cnlWYWx1ZS5pbmNhcm5hdGlvbk51bWJlcikpIHtcbiAgICByZXR1cm4gcmVhc29uO1xuICB9XG4gIGlmIChpc0FiYW5kb25lZEVycm9yKHJlYXNvbikgJiYgIWlzQWJhbmRvbmVkRXJyb3IocHJpb3JSZXRyeVZhbHVlKSkge1xuICAgIHJldHVybiByZWFzb247XG4gIH1cbiAgcmV0dXJuIHZvaWQgMDtcbn07XG52YXIgZGVmYXVsdFBvd2VycyA9IGhhcmRlbih7XG4gIGlzUmV0cnlhYmxlUmVhc29uXG59KTtcbnZhciBwcmVwYXJlU3dpbmdzZXRWb3dUb29scyA9ICh6b25lLCBwb3dlcnMgPSB7fSkgPT4gcHJlcGFyZUJhc2ljVm93VG9vbHMoem9uZSwgeyAuLi5kZWZhdWx0UG93ZXJzLCAuLi5wb3dlcnMgfSk7XG5oYXJkZW4ocHJlcGFyZVN3aW5nc2V0Vm93VG9vbHMpO1xudmFyIGhlYXBWb3dUb29scyA9IHByZXBhcmVTd2luZ3NldFZvd1Rvb2xzKG1ha2VIZWFwWm9uZSgpKTtcbnZhciBoZWFwVm93RSA9IEVfZGVmYXVsdDIoZ2xvYmFsVGhpcy5IYW5kbGVkUHJvbWlzZSwge1xuICB1bndyYXA6IGhlYXBWb3dUb29scy53aGVuLFxuICBhZGRpdGlvbmFsOiB7IHdoZW46IGhlYXBWb3dUb29scy53aGVuIH1cbn0pO1xuXG4vL1xudmFyIEJyYW5kU2hhcGUgPSBNLnJlbW90YWJsZShcIkJyYW5kXCIpO1xudmFyIElzc3VlclNoYXBlID0gTS5yZW1vdGFibGUoXCJJc3N1ZXJcIik7XG52YXIgUGF5bWVudFNoYXBlID0gTS5yZW1vdGFibGUoXCJQYXltZW50XCIpO1xudmFyIFB1cnNlU2hhcGUgPSBNLnJlbW90YWJsZShcIlB1cnNlXCIpO1xudmFyIERlcG9zaXRGYWNldFNoYXBlID0gTS5yZW1vdGFibGUoXCJEZXBvc2l0RmFjZXRcIik7XG52YXIgTm90aWZpZXJTaGFwZSA9IE0ucmVtb3RhYmxlKFwiTm90aWZpZXJcIik7XG52YXIgTWludFNoYXBlID0gTS5yZW1vdGFibGUoXCJNaW50XCIpO1xudmFyIE5hdFZhbHVlU2hhcGUgPSBNLm5hdCgpO1xudmFyIENvcHlTZXRWYWx1ZVNoYXBlID0gTS5zZXQoKTtcbnZhciBTZXRWYWx1ZVNoYXBlID0gTS5hcnJheU9mKE0ua2V5KCkpO1xudmFyIENvcHlCYWdWYWx1ZVNoYXBlID0gTS5iYWcoKTtcbnZhciBBbW91bnRWYWx1ZVNoYXBlID0gTS5vcihcbiAgTmF0VmFsdWVTaGFwZSxcbiAgQ29weVNldFZhbHVlU2hhcGUsXG4gIFNldFZhbHVlU2hhcGUsXG4gIENvcHlCYWdWYWx1ZVNoYXBlXG4pO1xudmFyIEFtb3VudFNoYXBlID0geyBicmFuZDogQnJhbmRTaGFwZSwgdmFsdWU6IEFtb3VudFZhbHVlU2hhcGUgfTtcbmhhcmRlbihBbW91bnRTaGFwZSk7XG52YXIgQW1vdW50UGF0dGVyblNoYXBlID0gTS5wYXR0ZXJuKCk7XG52YXIgUmF0aW9TaGFwZSA9IHsgbnVtZXJhdG9yOiBBbW91bnRTaGFwZSwgZGVub21pbmF0b3I6IEFtb3VudFNoYXBlIH07XG5oYXJkZW4oUmF0aW9TaGFwZSk7XG52YXIgaXNOYXRWYWx1ZSA9ICh2YWx1ZSkgPT4gbWF0Y2hlcyh2YWx1ZSwgTmF0VmFsdWVTaGFwZSk7XG5oYXJkZW4oaXNOYXRWYWx1ZSk7XG52YXIgaXNDb3B5U2V0VmFsdWUgPSAodmFsdWUpID0+IG1hdGNoZXModmFsdWUsIENvcHlTZXRWYWx1ZVNoYXBlKTtcbmhhcmRlbihpc0NvcHlTZXRWYWx1ZSk7XG52YXIgaXNTZXRWYWx1ZSA9ICh2YWx1ZSkgPT4gbWF0Y2hlcyh2YWx1ZSwgU2V0VmFsdWVTaGFwZSk7XG5oYXJkZW4oaXNTZXRWYWx1ZSk7XG52YXIgaXNDb3B5QmFnVmFsdWUgPSAodmFsdWUpID0+IG1hdGNoZXModmFsdWUsIENvcHlCYWdWYWx1ZVNoYXBlKTtcbmhhcmRlbihpc0NvcHlCYWdWYWx1ZSk7XG52YXIgTUFYX0FCU09MVVRFX0RFQ0lNQUxfUExBQ0VTID0gMTAwO1xudmFyIEFzc2V0S2luZFNoYXBlID0gTS5vcihcIm5hdFwiLCBcInNldFwiLCBcImNvcHlTZXRcIiwgXCJjb3B5QmFnXCIpO1xudmFyIERpc3BsYXlJbmZvU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7fSxcbiAge1xuICAgIGRlY2ltYWxQbGFjZXM6IE0uYW5kKFxuICAgICAgTS5ndGUoLU1BWF9BQlNPTFVURV9ERUNJTUFMX1BMQUNFUyksXG4gICAgICBNLmx0ZShNQVhfQUJTT0xVVEVfREVDSU1BTF9QTEFDRVMpXG4gICAgKSxcbiAgICBhc3NldEtpbmQ6IEFzc2V0S2luZFNoYXBlXG4gIH0sXG4gIHtcbiAgICAvL1xuICAgIC8vXG4gIH1cbik7XG52YXIgSXNzdWVyS2l0U2hhcGUgPSB7XG4gIGJyYW5kOiBCcmFuZFNoYXBlLFxuICBtaW50OiBNaW50U2hhcGUsXG4gIG1pbnRSZWNvdmVyeVB1cnNlOiBQdXJzZVNoYXBlLFxuICBpc3N1ZXI6IElzc3VlclNoYXBlLFxuICBkaXNwbGF5SW5mbzogRGlzcGxheUluZm9TaGFwZVxufTtcbmhhcmRlbihJc3N1ZXJLaXRTaGFwZSk7XG52YXIgQnJhbmRJID0gTS5pbnRlcmZhY2UoXCJCcmFuZFwiLCB7XG4gIGlzTXlJc3N1ZXI6IE0uY2FsbFdoZW4oTS5hd2FpdChJc3N1ZXJTaGFwZSkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICBnZXRBbGxlZ2VkTmFtZTogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgZ2V0RGlzcGxheUluZm86IE0uY2FsbCgpLnJldHVybnMoRGlzcGxheUluZm9TaGFwZSksXG4gIGdldEFtb3VudFNoYXBlOiBNLmNhbGwoKS5yZXR1cm5zKE0ucGF0dGVybigpKVxufSk7XG52YXIgbWFrZUlzc3VlckludGVyZmFjZXMgPSAoYnJhbmRTaGFwZSA9IEJyYW5kU2hhcGUsIGFzc2V0S2luZFNoYXBlID0gQXNzZXRLaW5kU2hhcGUsIGFtb3VudFNoYXBlID0gQW1vdW50U2hhcGUpID0+IHtcbiAgY29uc3QgSXNzdWVySSA9IE0uaW50ZXJmYWNlKFwiSXNzdWVyXCIsIHtcbiAgICBnZXRCcmFuZDogTS5jYWxsKCkucmV0dXJucyhicmFuZFNoYXBlKSxcbiAgICBnZXRBbGxlZ2VkTmFtZTogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgICBnZXRBc3NldEtpbmQ6IE0uY2FsbCgpLnJldHVybnMoYXNzZXRLaW5kU2hhcGUpLFxuICAgIGdldERpc3BsYXlJbmZvOiBNLmNhbGwoKS5yZXR1cm5zKERpc3BsYXlJbmZvU2hhcGUpLFxuICAgIG1ha2VFbXB0eVB1cnNlOiBNLmNhbGwoKS5yZXR1cm5zKFB1cnNlU2hhcGUpLFxuICAgIGlzTGl2ZTogTS5jYWxsV2hlbihNLmF3YWl0KFBheW1lbnRTaGFwZSkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICAgIGdldEFtb3VudE9mOiBNLmNhbGxXaGVuKE0uYXdhaXQoUGF5bWVudFNoYXBlKSkucmV0dXJucyhhbW91bnRTaGFwZSksXG4gICAgYnVybjogTS5jYWxsV2hlbihNLmF3YWl0KFBheW1lbnRTaGFwZSkpLm9wdGlvbmFsKEFtb3VudFBhdHRlcm5TaGFwZSkucmV0dXJucyhhbW91bnRTaGFwZSlcbiAgfSk7XG4gIGNvbnN0IE1pbnRJID0gTS5pbnRlcmZhY2UoXCJNaW50XCIsIHtcbiAgICBnZXRJc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUpLFxuICAgIG1pbnRQYXltZW50OiBNLmNhbGwoYW1vdW50U2hhcGUpLnJldHVybnMoUGF5bWVudFNoYXBlKVxuICB9KTtcbiAgY29uc3QgUGF5bWVudEkgPSBNLmludGVyZmFjZShcIlBheW1lbnRcIiwge1xuICAgIGdldEFsbGVnZWRCcmFuZDogTS5jYWxsKCkucmV0dXJucyhicmFuZFNoYXBlKVxuICB9KTtcbiAgY29uc3QgUHVyc2VJID0gTS5pbnRlcmZhY2UoXCJQdXJzZVwiLCB7XG4gICAgZ2V0QWxsZWdlZEJyYW5kOiBNLmNhbGwoKS5yZXR1cm5zKGJyYW5kU2hhcGUpLFxuICAgIGdldEN1cnJlbnRBbW91bnQ6IE0uY2FsbCgpLnJldHVybnMoYW1vdW50U2hhcGUpLFxuICAgIGdldEN1cnJlbnRBbW91bnROb3RpZmllcjogTS5jYWxsKCkucmV0dXJucyhOb3RpZmllclNoYXBlKSxcbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIGRlcG9zaXQ6IE0uY2FsbChQYXltZW50U2hhcGUpLm9wdGlvbmFsKEFtb3VudFBhdHRlcm5TaGFwZSkucmV0dXJucyhhbW91bnRTaGFwZSksXG4gICAgZ2V0RGVwb3NpdEZhY2V0OiBNLmNhbGwoKS5yZXR1cm5zKERlcG9zaXRGYWNldFNoYXBlKSxcbiAgICB3aXRoZHJhdzogTS5jYWxsKGFtb3VudFNoYXBlKS5yZXR1cm5zKFBheW1lbnRTaGFwZSksXG4gICAgZ2V0UmVjb3ZlcnlTZXQ6IE0uY2FsbCgpLnJldHVybnMoTS5zZXRPZihQYXltZW50U2hhcGUpKSxcbiAgICByZWNvdmVyQWxsOiBNLmNhbGwoKS5yZXR1cm5zKGFtb3VudFNoYXBlKVxuICB9KTtcbiAgY29uc3QgRGVwb3NpdEZhY2V0SSA9IE0uaW50ZXJmYWNlKFwiRGVwb3NpdEZhY2V0XCIsIHtcbiAgICByZWNlaXZlOiBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoUHVyc2VJKS5tZXRob2RHdWFyZHMuZGVwb3NpdFxuICB9KTtcbiAgY29uc3QgUHVyc2VJS2l0ID0ge1xuICAgIHB1cnNlOiBQdXJzZUksXG4gICAgZGVwb3NpdEZhY2V0OiBEZXBvc2l0RmFjZXRJXG4gIH07XG4gIGhhcmRlbihQdXJzZUlLaXQpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBJc3N1ZXJJLFxuICAgIE1pbnRJLFxuICAgIFBheW1lbnRJLFxuICAgIFB1cnNlSUtpdFxuICB9KTtcbn07XG5oYXJkZW4obWFrZUlzc3VlckludGVyZmFjZXMpO1xuXG4vL1xudmFyIE91dGJvdW5kQ29ubmVjdGlvbkhhbmRsZXJJID0gTS5pbnRlcmZhY2UoXG4gIFwiT3V0Ym91bmRDb25uZWN0aW9uSGFuZGxlclwiLFxuICB7XG4gICAgb25PcGVuOiBNLmNhbGxXaGVuKE0uYW55KCksIE0uc3RyaW5nKCksIE0uc3RyaW5nKCksIE0uYW55KCkpLnJldHVybnMoXG4gICAgICBNLmFueSgpXG4gICAgKSxcbiAgICBvbkNsb3NlOiBNLmNhbGxXaGVuKE0uYW55KCksIE0uYW55KCksIE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgfVxuKTtcbnZhciBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSA9IHtcbiAgY2hhaW5JZDogTS5zdHJpbmcoKSxcbiAgLy9cbiAgZW5jb2Rpbmc6IE0uc3RyaW5nKCksXG4gIHZhbHVlOiBNLnN0cmluZygpXG59O1xuaGFyZGVuKENvc21vc0NoYWluQWRkcmVzc1NoYXBlKTtcbnZhciBDYWlwMTBSZWNvcmRTaGFwZSA9IHtcbiAgbmFtZXNwYWNlOiBNLnN0cmluZygpLFxuICByZWZlcmVuY2U6IE0uc3RyaW5nKCksXG4gIGFjY291bnRBZGRyZXNzOiBNLnN0cmluZygpXG59O1xuaGFyZGVuKENhaXAxMFJlY29yZFNoYXBlKTtcbnZhciBBY2NvdW50SWRBcmdTaGFwZSA9IE0ub3IoTS5zdHJpbmcoKSwgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpO1xudmFyIFByb3RvM1NoYXBlID0geyB0eXBlVXJsOiBNLnN0cmluZygpLCB2YWx1ZTogTS5zdHJpbmcoKSB9O1xuaGFyZGVuKFByb3RvM1NoYXBlKTtcbnZhciBJQkNDaGFubmVsSURTaGFwZSA9IE0uc3RyaW5nKCk7XG52YXIgSUJDQ2hhbm5lbEluZm9TaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBwb3J0SWQ6IE0uc3RyaW5nKCksXG4gIGNoYW5uZWxJZDogSUJDQ2hhbm5lbElEU2hhcGUsXG4gIGNvdW50ZXJQYXJ0eVBvcnRJZDogTS5zdHJpbmcoKSxcbiAgY291bnRlclBhcnR5Q2hhbm5lbElkOiBJQkNDaGFubmVsSURTaGFwZSxcbiAgb3JkZXJpbmc6IE0uc2NhbGFyKCksXG4gIC8vXG4gIHN0YXRlOiBNLnNjYWxhcigpLFxuICAvL1xuICB2ZXJzaW9uOiBNLnN0cmluZygpXG59KTtcbnZhciBJQkNDb25uZWN0aW9uSURTaGFwZSA9IE0uc3RyaW5nKCk7XG52YXIgSUJDQ29ubmVjdGlvbkluZm9TaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBpZDogSUJDQ29ubmVjdGlvbklEU2hhcGUsXG4gIGNsaWVudF9pZDogTS5zdHJpbmcoKSxcbiAgc3RhdGU6IE0uc2NhbGFyKCksXG4gIC8vXG4gIGNvdW50ZXJwYXJ0eToge1xuICAgIGNsaWVudF9pZDogTS5zdHJpbmcoKSxcbiAgICBjb25uZWN0aW9uX2lkOiBJQkNDb25uZWN0aW9uSURTaGFwZVxuICB9LFxuICB0cmFuc2ZlckNoYW5uZWw6IElCQ0NoYW5uZWxJbmZvU2hhcGVcbn0pO1xudmFyIENvc21vc0Fzc2V0SW5mb1NoYXBlID0gTS5zcGxpdFJlY29yZCh7XG4gIGJhc2U6IE0uc3RyaW5nKCksXG4gIG5hbWU6IE0uc3RyaW5nKCksXG4gIGRpc3BsYXk6IE0uc3RyaW5nKCksXG4gIHN5bWJvbDogTS5zdHJpbmcoKSxcbiAgZGVub21fdW5pdHM6IE0uYXJyYXlPZihcbiAgICBNLnNwbGl0UmVjb3JkKHsgZGVub206IE0uc3RyaW5nKCksIGV4cG9uZW50OiBNLm51bWJlcigpIH0pXG4gIClcbn0pO1xudmFyIENoYWluSW5mb1JlcXVpcmVkU2hhcGUgPSB7XG4gIG5hbWVzcGFjZTogTS5zdHJpbmcoKSxcbiAgcmVmZXJlbmNlOiBNLnN0cmluZygpXG59O1xudmFyIENoYWluSW5mb09wdGlvbmFsU2hhcGUgPSB7XG4gIGNjdHBEZXN0aW5hdGlvbkRvbWFpbjogTS5udW1iZXIoKVxufTtcbnZhciBCYXNlQ2hhaW5JbmZvU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICBDaGFpbkluZm9SZXF1aXJlZFNoYXBlLFxuICBDaGFpbkluZm9PcHRpb25hbFNoYXBlXG4pO1xuaGFyZGVuKEJhc2VDaGFpbkluZm9TaGFwZSk7XG52YXIgQ29zbW9zQ2hhaW5JbmZvU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgY2hhaW5JZDogTS5zdHJpbmcoKSxcbiAgICBiZWNoMzJQcmVmaXg6IE0uc3RyaW5nKCksXG4gICAgLi4uQ2hhaW5JbmZvUmVxdWlyZWRTaGFwZVxuICB9LFxuICB7XG4gICAgY29ubmVjdGlvbnM6IE0ucmVjb3JkKCksXG4gICAgLy9cbiAgICBpY3FFbmFibGVkOiBNLmJvb2xlYW4oKSxcbiAgICBwZm1FbmFibGVkOiBNLmJvb2xlYW4oKSxcbiAgICBzdGFraW5nVG9rZW5zOiBNLmFycmF5T2YoeyBkZW5vbTogTS5zdHJpbmcoKSB9KSxcbiAgICAuLi5DaGFpbkluZm9PcHRpb25hbFNoYXBlXG4gIH1cbik7XG5oYXJkZW4oQ29zbW9zQ2hhaW5JbmZvU2hhcGUpO1xudmFyIENoYWluSW5mb1NoYXBlID0gTS5vcihDb3Ntb3NDaGFpbkluZm9TaGFwZSwgQmFzZUNoYWluSW5mb1NoYXBlKTtcbmhhcmRlbihDaGFpbkluZm9TaGFwZSk7XG52YXIgRGVub21TaGFwZSA9IE0uc3RyaW5nKCk7XG52YXIgQ29pblNoYXBlID0ge1xuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICBhbW91bnQ6IE0uc3RyaW5nKCksXG4gIGRlbm9tOiBEZW5vbVNoYXBlXG59O1xuaGFyZGVuKENvaW5TaGFwZSk7XG52YXIgRGVub21JbmZvU2hhcGUgPSB7XG4gIGNoYWluOiBNLnJlbW90YWJsZShcIkNoYWluXCIpLFxuICBiYXNlOiBNLnJlbW90YWJsZShcIkNoYWluXCIpLFxuICBicmFuZDogTS5vcihNLnJlbW90YWJsZShcIkJyYW5kXCIpLCBNLnVuZGVmaW5lZCgpKSxcbiAgYmFzZURlbm9tOiBNLnN0cmluZygpXG59O1xuaGFyZGVuKERlbm9tSW5mb1NoYXBlKTtcbnZhciBEZW5vbURldGFpbFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAgeyBjaGFpbk5hbWU6IE0uc3RyaW5nKCksIGJhc2VOYW1lOiBNLnN0cmluZygpLCBiYXNlRGVub206IE0uc3RyaW5nKCkgfSxcbiAgeyBicmFuZDogQnJhbmRTaGFwZSB9XG4pO1xuaGFyZGVuKERlbm9tRGV0YWlsU2hhcGUpO1xudmFyIERlbm9tQW1vdW50U2hhcGUgPSB7IGRlbm9tOiBEZW5vbVNoYXBlLCB2YWx1ZTogTS5uYXQoKSB9O1xuaGFyZGVuKERlbm9tQW1vdW50U2hhcGUpO1xudmFyIEFueU5hdEFtb3VudFNoYXBlID0ge1xuICBicmFuZDogTS5yZW1vdGFibGUoXCJCcmFuZFwiKSxcbiAgdmFsdWU6IE0ubmF0KClcbn07XG5oYXJkZW4oQW55TmF0QW1vdW50U2hhcGUpO1xudmFyIEFtb3VudEFyZ1NoYXBlID0gTS5vcihBbnlOYXRBbW91bnRTaGFwZSwgRGVub21BbW91bnRTaGFwZSk7XG52YXIgRGVsZWdhdGlvblNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIHZhbGlkYXRvcjogQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsXG4gICAgYW1vdW50OiBBbW91bnRBcmdTaGFwZVxuICB9LFxuICB7IGRlbGVnYXRvcjogQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUgfVxuKTtcbnZhciBJQ1FNc2dTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHsgcGF0aDogTS5zdHJpbmcoKSwgZGF0YTogTS5zdHJpbmcoKSB9LFxuICB7IGhlaWdodDogTS5zdHJpbmcoKSwgcHJvdmU6IE0uYm9vbGVhbigpIH1cbik7XG52YXIgVHlwZWRKc29uU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHsgXCJAdHlwZVwiOiBNLnN0cmluZygpIH0pO1xudmFyIGNoYWluRmFjYWRlTWV0aG9kcyA9IHtcbiAgZ2V0Q2hhaW5JbmZvOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgbWFrZUFjY291bnQ6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpXG59O1xuaGFyZGVuKGNoYWluRmFjYWRlTWV0aG9kcyk7XG52YXIgVGltZXN0YW1wUHJvdG9TaGFwZSA9IHsgc2Vjb25kczogTS5zdHJpbmcoKSwgbmFub3M6IE0ubnVtYmVyKCkgfTtcbmhhcmRlbihUaW1lc3RhbXBQcm90b1NoYXBlKTtcbnZhciBFeGVjdXRlSUNBVHhPcHRzU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7fSxcbiAge1xuICAgIG1lbW86IE0uc3RyaW5nKCksXG4gICAgdGltZW91dEhlaWdodDogTS5iaWdpbnQoKSxcbiAgICBleHRlbnNpb25PcHRpb25zOiBNLmFycmF5T2YoTS5hbnkoKSksXG4gICAgbm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zOiBNLmFycmF5T2YoTS5hbnkoKSksXG4gICAgc2VuZE9wdHM6IFNlbmRPcHRpb25zU2hhcGVcbiAgfVxuKTtcbnZhciBBbnlOYXRBbW91bnRzUmVjb3JkID0gTS5hbmQoXG4gIE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgQW55TmF0QW1vdW50U2hhcGUpLFxuICBNLm5vdCh7fSlcbik7XG52YXIgT3JjaGVzdHJhdGlvblBvd2Vyc1NoYXBlID0ge1xuICBhZ29yaWNOYW1lczogTS5yZW1vdGFibGUoKSxcbiAgbG9jYWxjaGFpbjogTS5yZW1vdGFibGUoKSxcbiAgb3JjaGVzdHJhdGlvblNlcnZpY2U6IE0ucmVtb3RhYmxlKCksXG4gIHN0b3JhZ2VOb2RlOiBNLnJlbW90YWJsZSgpLFxuICB0aW1lclNlcnZpY2U6IE0ucmVtb3RhYmxlKClcbn07XG5oYXJkZW4oT3JjaGVzdHJhdGlvblBvd2Vyc1NoYXBlKTtcbnZhciBGb3J3YXJkQXJnc1NoYXBlID0ge1xuICByZWNlaXZlcjogTS5zdHJpbmcoKSxcbiAgcG9ydDogXCJ0cmFuc2ZlclwiLFxuICBjaGFubmVsOiBNLnN0cmluZygpLFxuICB0aW1lb3V0OiBNLnN0cmluZygpLFxuICByZXRyaWVzOiBNLm51bWJlcigpXG59O1xuaGFyZGVuKEZvcndhcmRBcmdzU2hhcGUpO1xudmFyIEZvcndhcmRJbmZvU2hhcGUgPSB7XG4gIGZvcndhcmQ6IE0uc3BsaXRSZWNvcmQoRm9yd2FyZEFyZ3NTaGFwZSwge1xuICAgIC8qXG5cblxuICAgICAqL1xuICAgIG5leHQ6IHtcbiAgICAgIGZvcndhcmQ6IEZvcndhcmRBcmdzU2hhcGVcbiAgICB9XG4gIH0pXG59O1xuaGFyZGVuKEZvcndhcmRJbmZvU2hhcGUpO1xudmFyIEZvcndhcmRPcHRzU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7fSxcbiAge1xuICAgIHRpbWVvdXQ6IE0uc3RyaW5nKCksXG4gICAgcmV0cmllczogTS5udW1iZXIoKSxcbiAgICBpbnRlcm1lZGlhdGVSZWNpcGllbnQ6IENvc21vc0NoYWluQWRkcmVzc1NoYXBlXG4gIH0sXG4gIHt9XG4pO1xudmFyIElCQ1RyYW5zZmVyT3B0aW9uc1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge30sXG4gIHtcbiAgICB0aW1lb3V0VGltZXN0YW1wOiBNLmJpZ2ludCgpLFxuICAgIHRpbWVvdXRIZWlnaHQ6IHtcbiAgICAgIHJldmlzaW9uSGVpZ2h0OiBNLmJpZ2ludCgpLFxuICAgICAgcmV2aXNpb25OdW1iZXI6IE0uYmlnaW50KClcbiAgICB9LFxuICAgIHRpbWVvdXRSZWxhdGl2ZVNlY29uZHM6IE0uYmlnaW50KCksXG4gICAgbWVtbzogTS5zdHJpbmcoKSxcbiAgICBmb3J3YXJkT3B0czogRm9yd2FyZE9wdHNTaGFwZVxuICB9XG4pO1xuXG4vL1xuZnVuY3Rpb24gdXRmOExlbmd0aCh0NSkge1xuICBsZXQgcjUgPSAwLCBlMiA9IDA7XG4gIGZvciAobGV0IG8yID0gMDsgbzIgPCB0NS5sZW5ndGg7ICsrbzIpIGUyID0gdDUuY2hhckNvZGVBdChvMiksIGUyIDwgMTI4ID8gcjUgKz0gMSA6IGUyIDwgMjA0OCA/IHI1ICs9IDIgOiA1NTI5NiA9PSAoNjQ1MTIgJiBlMikgJiYgNTYzMjAgPT0gKDY0NTEyICYgdDUuY2hhckNvZGVBdChvMiArIDEpKSA/ICgrK28yLCByNSArPSA0KSA6IHI1ICs9IDM7XG4gIHJldHVybiByNTtcbn1cbmZ1bmN0aW9uIHV0ZjhSZWFkKHQ1LCByNSwgZTIpIHtcbiAgaWYgKGUyIC0gcjUgPCAxKSByZXR1cm4gXCJcIjtcbiAgY29uc3QgbzIgPSBbXTtcbiAgbGV0IG4yLCBmMiA9IFtdLCBoID0gMDtcbiAgZm9yICg7IHI1IDwgZTI7ICkgbjIgPSB0NVtyNSsrXSwgbjIgPCAxMjggPyBvMltoKytdID0gbjIgOiBuMiA+IDE5MSAmJiBuMiA8IDIyNCA/IG8yW2grK10gPSAoMzEgJiBuMikgPDwgNiB8IDYzICYgdDVbcjUrK10gOiBuMiA+IDIzOSAmJiBuMiA8IDM2NSA/IChuMiA9ICgoNyAmIG4yKSA8PCAxOCB8ICg2MyAmIHQ1W3I1KytdKSA8PCAxMiB8ICg2MyAmIHQ1W3I1KytdKSA8PCA2IHwgNjMgJiB0NVtyNSsrXSkgLSA2NTUzNiwgbzJbaCsrXSA9IDU1Mjk2ICsgKG4yID4+IDEwKSwgbzJbaCsrXSA9IDU2MzIwICsgKDEwMjMgJiBuMikpIDogbzJbaCsrXSA9ICgxNSAmIG4yKSA8PCAxMiB8ICg2MyAmIHQ1W3I1KytdKSA8PCA2IHwgNjMgJiB0NVtyNSsrXSwgaCA+IDgxOTEgJiYgKChmMiB8fCAoZjIgPSBbXSkpLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSguLi5vMikpLCBoID0gMCk7XG4gIHJldHVybiBmMiA/IChoICYmIGYyLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSguLi5vMi5zbGljZSgwLCBoKSkpLCBmMi5qb2luKFwiXCIpKSA6IFN0cmluZy5mcm9tQ2hhckNvZGUoLi4ubzIuc2xpY2UoMCwgaCkpO1xufVxuZnVuY3Rpb24gdXRmOFdyaXRlKHQ1LCByNSwgZTIpIHtcbiAgY29uc3QgbzIgPSBlMjtcbiAgbGV0IG4yLCBmMjtcbiAgZm9yIChsZXQgbzMgPSAwOyBvMyA8IHQ1Lmxlbmd0aDsgKytvMykgbjIgPSB0NS5jaGFyQ29kZUF0KG8zKSwgbjIgPCAxMjggPyByNVtlMisrXSA9IG4yIDogbjIgPCAyMDQ4ID8gKHI1W2UyKytdID0gbjIgPj4gNiB8IDE5MiwgcjVbZTIrK10gPSA2MyAmIG4yIHwgMTI4KSA6IDU1Mjk2ID09ICg2NDUxMiAmIG4yKSAmJiA1NjMyMCA9PSAoNjQ1MTIgJiAoZjIgPSB0NS5jaGFyQ29kZUF0KG8zICsgMSkpKSA/IChuMiA9IDY1NTM2ICsgKCgxMDIzICYgbjIpIDw8IDEwKSArICgxMDIzICYgZjIpLCArK28zLCByNVtlMisrXSA9IG4yID4+IDE4IHwgMjQwLCByNVtlMisrXSA9IG4yID4+IDEyICYgNjMgfCAxMjgsIHI1W2UyKytdID0gbjIgPj4gNiAmIDYzIHwgMTI4LCByNVtlMisrXSA9IDYzICYgbjIgfCAxMjgpIDogKHI1W2UyKytdID0gbjIgPj4gMTIgfCAyMjQsIHI1W2UyKytdID0gbjIgPj4gNiAmIDYzIHwgMTI4LCByNVtlMisrXSA9IDYzICYgbjIgfCAxMjgpO1xuICByZXR1cm4gZTIgLSBvMjtcbn1cblxuLy9cbmZ1bmN0aW9uIHZhcmludDY0cmVhZCgpIHtcbiAgbGV0IHQ1ID0gMCwgcjUgPSAwO1xuICBmb3IgKGxldCBuMyA9IDA7IG4zIDwgMjg7IG4zICs9IDcpIHtcbiAgICBsZXQgbzIgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgICBpZiAodDUgfD0gKDEyNyAmIG8yKSA8PCBuMywgISgxMjggJiBvMikpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCBbdDUsIHI1XTtcbiAgfVxuICBsZXQgbjIgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgaWYgKHQ1IHw9ICgxNSAmIG4yKSA8PCAyOCwgcjUgPSAoMTEyICYgbjIpID4+IDQsICEoMTI4ICYgbjIpKSByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgW3Q1LCByNV07XG4gIGZvciAobGV0IG4zID0gMzsgbjMgPD0gMzE7IG4zICs9IDcpIHtcbiAgICBsZXQgbzIgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgICBpZiAocjUgfD0gKDEyNyAmIG8yKSA8PCBuMywgISgxMjggJiBvMikpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCBbdDUsIHI1XTtcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoXCJpbnZhbGlkIHZhcmludFwiKTtcbn1cbnZhciB0ID0gNDI5NDk2NzI5NjtcbmZ1bmN0aW9uIGludDY0RnJvbVN0cmluZyhvMikge1xuICBjb25zdCBpMyA9IFwiLVwiID09PSBvMlswXTtcbiAgaTMgJiYgKG8yID0gbzIuc2xpY2UoMSkpO1xuICBjb25zdCBlMiA9IDFlNjtcbiAgbGV0IHMzID0gMCwgdSA9IDA7XG4gIGZ1bmN0aW9uIGYyKHI1LCBuMikge1xuICAgIGNvbnN0IGk0ID0gTnVtYmVyKG8yLnNsaWNlKHI1LCBuMikpO1xuICAgIHUgKj0gZTIsIHMzID0gczMgKiBlMiArIGk0LCBzMyA+PSB0ICYmICh1ICs9IHMzIC8gdCB8IDAsIHMzICU9IHQpO1xuICB9XG4gIHJldHVybiBmMigtMjQsIC0xOCksIGYyKC0xOCwgLTEyKSwgZjIoLTEyLCAtNiksIGYyKC02KSwgaTMgPyBuKHMzLCB1KSA6IHIoczMsIHUpO1xufVxuZnVuY3Rpb24gaW50NjRUb1N0cmluZyh0NSwgbzIpIHtcbiAgbGV0IGkzID0gcih0NSwgbzIpO1xuICBjb25zdCBlMiA9IDIxNDc0ODM2NDggJiBpMy5oaTtcbiAgZTIgJiYgKGkzID0gbihpMy5sbywgaTMuaGkpKTtcbiAgY29uc3QgczMgPSB1SW50NjRUb1N0cmluZyhpMy5sbywgaTMuaGkpO1xuICByZXR1cm4gZTIgPyBcIi1cIiArIHMzIDogczM7XG59XG5mdW5jdGlvbiB1SW50NjRUb1N0cmluZyhyNSwgbjIpIHtcbiAgaWYgKHsgbG86IHI1LCBoaTogbjIgfSA9IGZ1bmN0aW9uKHQ1LCByNikge1xuICAgIHJldHVybiB7IGxvOiB0NSA+Pj4gMCwgaGk6IHI2ID4+PiAwIH07XG4gIH0ocjUsIG4yKSwgbjIgPD0gMjA5NzE1MSkgcmV0dXJuIFN0cmluZyh0ICogbjIgKyByNSk7XG4gIGNvbnN0IGkzID0gMTY3NzcyMTUgJiAocjUgPj4+IDI0IHwgbjIgPDwgOCksIGUyID0gbjIgPj4gMTYgJiA2NTUzNTtcbiAgbGV0IHMzID0gKDE2Nzc3MjE1ICYgcjUpICsgNjc3NzIxNiAqIGkzICsgNjcxMDY1NiAqIGUyLCB1ID0gaTMgKyA4MTQ3NDk3ICogZTIsIGYyID0gMiAqIGUyO1xuICBjb25zdCBoID0gMWU3O1xuICByZXR1cm4gczMgPj0gaCAmJiAodSArPSBNYXRoLmZsb29yKHMzIC8gaCksIHMzICU9IGgpLCB1ID49IGggJiYgKGYyICs9IE1hdGguZmxvb3IodSAvIGgpLCB1ICU9IGgpLCBmMi50b1N0cmluZygpICsgbyh1KSArIG8oczMpO1xufVxuZnVuY3Rpb24gcih0NSwgcjUpIHtcbiAgcmV0dXJuIHsgbG86IDAgfCB0NSwgaGk6IDAgfCByNSB9O1xufVxuZnVuY3Rpb24gbih0NSwgbjIpIHtcbiAgcmV0dXJuIG4yID0gfm4yLCB0NSA/IHQ1ID0gMSArIH50NSA6IG4yICs9IDEsIHIodDUsIG4yKTtcbn1cbnZhciBvID0gKHQ1KSA9PiB7XG4gIGNvbnN0IHI1ID0gU3RyaW5nKHQ1KTtcbiAgcmV0dXJuIFwiMDAwMDAwMFwiLnNsaWNlKHI1Lmxlbmd0aCkgKyByNTtcbn07XG5mdW5jdGlvbiB2YXJpbnQzMnJlYWQoKSB7XG4gIGxldCB0NSA9IHRoaXMuYnVmW3RoaXMucG9zKytdLCByNSA9IDEyNyAmIHQ1O1xuICBpZiAoISgxMjggJiB0NSkpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCByNTtcbiAgaWYgKHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI1IHw9ICgxMjcgJiB0NSkgPDwgNywgISgxMjggJiB0NSkpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCByNTtcbiAgaWYgKHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI1IHw9ICgxMjcgJiB0NSkgPDwgMTQsICEoMTI4ICYgdDUpKSByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgcjU7XG4gIGlmICh0NSA9IHRoaXMuYnVmW3RoaXMucG9zKytdLCByNSB8PSAoMTI3ICYgdDUpIDw8IDIxLCAhKDEyOCAmIHQ1KSkgcmV0dXJuIHRoaXMuYXNzZXJ0Qm91bmRzKCksIHI1O1xuICB0NSA9IHRoaXMuYnVmW3RoaXMucG9zKytdLCByNSB8PSAoMTUgJiB0NSkgPDwgMjg7XG4gIGZvciAobGV0IHI2ID0gNTsgMTI4ICYgdDUgJiYgcjYgPCAxMDsgcjYrKykgdDUgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgaWYgKDEyOCAmIHQ1KSB0aHJvdyBuZXcgRXJyb3IoXCJpbnZhbGlkIHZhcmludFwiKTtcbiAgcmV0dXJuIHRoaXMuYXNzZXJ0Qm91bmRzKCksIHI1ID4+PiAwO1xufVxuZnVuY3Rpb24genpFbmNvZGUodDUsIHI1KSB7XG4gIGxldCBuMiA9IHI1ID4+IDMxO1xuICByZXR1cm4gcjUgPSAoKHI1IDw8IDEgfCB0NSA+Pj4gMzEpIF4gbjIpID4+PiAwLCBbdDUgPSAodDUgPDwgMSBeIG4yKSA+Pj4gMCwgcjVdO1xufVxuZnVuY3Rpb24genpEZWNvZGUodDUsIHI1KSB7XG4gIGxldCBuMiA9IC0oMSAmIHQ1KTtcbiAgcmV0dXJuIFt0NSA9ICgodDUgPj4+IDEgfCByNSA8PCAzMSkgXiBuMikgPj4+IDAsIHI1ID0gKHI1ID4+PiAxIF4gbjIpID4+PiAwXTtcbn1cbmZ1bmN0aW9uIHJlYWRVSW50MzIodDUsIHI1KSB7XG4gIHJldHVybiAodDVbcjVdIHwgdDVbcjUgKyAxXSA8PCA4IHwgdDVbcjUgKyAyXSA8PCAxNikgKyAxNjc3NzIxNiAqIHQ1W3I1ICsgM107XG59XG5mdW5jdGlvbiByZWFkSW50MzIodDUsIHI1KSB7XG4gIHJldHVybiAodDVbcjVdIHwgdDVbcjUgKyAxXSA8PCA4IHwgdDVbcjUgKyAyXSA8PCAxNikgKyAodDVbcjUgKyAzXSA8PCAyNCk7XG59XG5mdW5jdGlvbiB3cml0ZVZhcmludDMyKHQ1LCByNSwgbjIpIHtcbiAgZm9yICg7IHQ1ID4gMTI3OyApIHI1W24yKytdID0gMTI3ICYgdDUgfCAxMjgsIHQ1ID4+Pj0gNztcbiAgcjVbbjJdID0gdDU7XG59XG5mdW5jdGlvbiB3cml0ZVZhcmludDY0KHQ1LCByNSwgbjIpIHtcbiAgZm9yICg7IHQ1LmhpOyApIHI1W24yKytdID0gMTI3ICYgdDUubG8gfCAxMjgsIHQ1LmxvID0gKHQ1LmxvID4+PiA3IHwgdDUuaGkgPDwgMjUpID4+PiAwLCB0NS5oaSA+Pj49IDc7XG4gIGZvciAoOyB0NS5sbyA+IDEyNzsgKSByNVtuMisrXSA9IDEyNyAmIHQ1LmxvIHwgMTI4LCB0NS5sbyA9IHQ1LmxvID4+PiA3O1xuICByNVtuMisrXSA9IHQ1LmxvO1xufVxuZnVuY3Rpb24gaW50NjRMZW5ndGgodDUsIHI1KSB7XG4gIGxldCBuMiA9ICh0NSA+Pj4gMjggfCByNSA8PCA0KSA+Pj4gMCwgbzIgPSByNSA+Pj4gMjQ7XG4gIHJldHVybiAwID09PSBvMiA/IDAgPT09IG4yID8gdDUgPCAxNjM4NCA/IHQ1IDwgMTI4ID8gMSA6IDIgOiB0NSA8IDIwOTcxNTIgPyAzIDogNCA6IG4yIDwgMTYzODQgPyBuMiA8IDEyOCA/IDUgOiA2IDogbjIgPCAyMDk3MTUyID8gNyA6IDggOiBvMiA8IDEyOCA/IDkgOiAxMDtcbn1cbmZ1bmN0aW9uIHdyaXRlRml4ZWQzMih0NSwgcjUsIG4yKSB7XG4gIHI1W24yXSA9IDI1NSAmIHQ1LCByNVtuMiArIDFdID0gdDUgPj4+IDggJiAyNTUsIHI1W24yICsgMl0gPSB0NSA+Pj4gMTYgJiAyNTUsIHI1W24yICsgM10gPSB0NSA+Pj4gMjQ7XG59XG5mdW5jdGlvbiB3cml0ZUJ5dGUodDUsIHI1LCBuMikge1xuICByNVtuMl0gPSAyNTUgJiB0NTtcbn1cblxuLy9cbnZhciBXaXJlVHlwZTtcbiFmdW5jdGlvbih0NSkge1xuICB0NVt0NS5WYXJpbnQgPSAwXSA9IFwiVmFyaW50XCIsIHQ1W3Q1LkZpeGVkNjQgPSAxXSA9IFwiRml4ZWQ2NFwiLCB0NVt0NS5CeXRlcyA9IDJdID0gXCJCeXRlc1wiLCB0NVt0NS5GaXhlZDMyID0gNV0gPSBcIkZpeGVkMzJcIjtcbn0oV2lyZVR5cGUgfHwgKFdpcmVUeXBlID0ge30pKTtcbnZhciBCaW5hcnlSZWFkZXIgPSBjbGFzcyB7XG4gIGJ1ZjtcbiAgcG9zO1xuICB0eXBlO1xuICBsZW47XG4gIGFzc2VydEJvdW5kcygpIHtcbiAgICBpZiAodGhpcy5wb3MgPiB0aGlzLmxlbikgdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJwcmVtYXR1cmUgRU9GXCIpO1xuICB9XG4gIGNvbnN0cnVjdG9yKHQ1KSB7XG4gICAgdGhpcy5idWYgPSB0NSA/IG5ldyBVaW50OEFycmF5KHQ1KSA6IG5ldyBVaW50OEFycmF5KDApLCB0aGlzLnBvcyA9IDAsIHRoaXMudHlwZSA9IDAsIHRoaXMubGVuID0gdGhpcy5idWYubGVuZ3RoO1xuICB9XG4gIHRhZygpIHtcbiAgICBjb25zdCB0NSA9IHRoaXMudWludDMyKCksIGkzID0gdDUgPj4+IDMsIHMzID0gNyAmIHQ1O1xuICAgIGlmIChpMyA8PSAwIHx8IHMzIDwgMCB8fCBzMyA+IDUpIHRocm93IG5ldyBFcnJvcihcImlsbGVnYWwgdGFnOiBmaWVsZCBubyBcIiArIGkzICsgXCIgd2lyZSB0eXBlIFwiICsgczMpO1xuICAgIHJldHVybiBbaTMsIHMzLCB0NV07XG4gIH1cbiAgc2tpcCh0NSkge1xuICAgIGlmIChcIm51bWJlclwiID09IHR5cGVvZiB0NSkge1xuICAgICAgaWYgKHRoaXMucG9zICsgdDUgPiB0aGlzLmxlbikgdGhyb3cgQih0aGlzLCB0NSk7XG4gICAgICB0aGlzLnBvcyArPSB0NTtcbiAgICB9IGVsc2UgZG8ge1xuICAgICAgaWYgKHRoaXMucG9zID49IHRoaXMubGVuKSB0aHJvdyBCKHRoaXMpO1xuICAgIH0gd2hpbGUgKDEyOCAmIHRoaXMuYnVmW3RoaXMucG9zKytdKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBza2lwVHlwZSh0NSkge1xuICAgIHN3aXRjaCAodDUpIHtcbiAgICAgIGNhc2UgV2lyZVR5cGUuVmFyaW50OlxuICAgICAgICB0aGlzLnNraXAoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFdpcmVUeXBlLkZpeGVkNjQ6XG4gICAgICAgIHRoaXMuc2tpcCg4KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFdpcmVUeXBlLkJ5dGVzOlxuICAgICAgICB0aGlzLnNraXAodGhpcy51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBmb3IgKDsgNCAhPSAodDUgPSA3ICYgdGhpcy51aW50MzIoKSk7ICkgdGhpcy5za2lwVHlwZSh0NSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBXaXJlVHlwZS5GaXhlZDMyOlxuICAgICAgICB0aGlzLnNraXAoNCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJpbnZhbGlkIHdpcmUgdHlwZSBcIiArIHQ1ICsgXCIgYXQgb2Zmc2V0IFwiICsgdGhpcy5wb3MpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICB1aW50MzIoKSB7XG4gICAgcmV0dXJuIHZhcmludDMycmVhZC5iaW5kKHRoaXMpKCk7XG4gIH1cbiAgaW50MzIoKSB7XG4gICAgcmV0dXJuIDAgfCB0aGlzLnVpbnQzMigpO1xuICB9XG4gIHNpbnQzMigpIHtcbiAgICBjb25zdCB0NSA9IHRoaXMudWludDMyKCk7XG4gICAgcmV0dXJuIHQ1ICUgMiA9PSAxID8gKHQ1ICsgMSkgLyAtMiA6IHQ1IC8gMjtcbiAgfVxuICBmaXhlZDMyKCkge1xuICAgIGNvbnN0IHQ1ID0gcmVhZFVJbnQzMih0aGlzLmJ1ZiwgdGhpcy5wb3MpO1xuICAgIHJldHVybiB0aGlzLnBvcyArPSA0LCB0NTtcbiAgfVxuICBzZml4ZWQzMigpIHtcbiAgICBjb25zdCB0NSA9IHJlYWRJbnQzMih0aGlzLmJ1ZiwgdGhpcy5wb3MpO1xuICAgIHJldHVybiB0aGlzLnBvcyArPSA0LCB0NTtcbiAgfVxuICBpbnQ2NCgpIHtcbiAgICBjb25zdCBbdDUsIGkzXSA9IHZhcmludDY0cmVhZC5iaW5kKHRoaXMpKCk7XG4gICAgcmV0dXJuIEJpZ0ludChpbnQ2NFRvU3RyaW5nKHQ1LCBpMykpO1xuICB9XG4gIHVpbnQ2NCgpIHtcbiAgICBjb25zdCBbdDUsIGkzXSA9IHZhcmludDY0cmVhZC5iaW5kKHRoaXMpKCk7XG4gICAgcmV0dXJuIEJpZ0ludCh1SW50NjRUb1N0cmluZyh0NSwgaTMpKTtcbiAgfVxuICBzaW50NjQoKSB7XG4gICAgbGV0IFt0NSwgaTNdID0gdmFyaW50NjRyZWFkLmJpbmQodGhpcykoKTtcbiAgICByZXR1cm4gW3Q1LCBpM10gPSB6ekRlY29kZSh0NSwgaTMpLCBCaWdJbnQoaW50NjRUb1N0cmluZyh0NSwgaTMpKTtcbiAgfVxuICBmaXhlZDY0KCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy5zZml4ZWQzMigpLCBpMyA9IHRoaXMuc2ZpeGVkMzIoKTtcbiAgICByZXR1cm4gQmlnSW50KHVJbnQ2NFRvU3RyaW5nKHQ1LCBpMykpO1xuICB9XG4gIHNmaXhlZDY0KCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy5zZml4ZWQzMigpLCBpMyA9IHRoaXMuc2ZpeGVkMzIoKTtcbiAgICByZXR1cm4gQmlnSW50KGludDY0VG9TdHJpbmcodDUsIGkzKSk7XG4gIH1cbiAgZmxvYXQoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiZmxvYXQgbm90IHN1cHBvcnRlZFwiKTtcbiAgfVxuICBkb3VibGUoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiZG91YmxlIG5vdCBzdXBwb3J0ZWRcIik7XG4gIH1cbiAgYm9vbCgpIHtcbiAgICBjb25zdCBbdDUsIGkzXSA9IHZhcmludDY0cmVhZC5iaW5kKHRoaXMpKCk7XG4gICAgcmV0dXJuIDAgIT09IHQ1IHx8IDAgIT09IGkzO1xuICB9XG4gIGJ5dGVzKCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy51aW50MzIoKSwgaTMgPSB0aGlzLnBvcztcbiAgICByZXR1cm4gdGhpcy5wb3MgKz0gdDUsIHRoaXMuYXNzZXJ0Qm91bmRzKCksIHRoaXMuYnVmLnN1YmFycmF5KGkzLCBpMyArIHQ1KTtcbiAgfVxuICBzdHJpbmcoKSB7XG4gICAgY29uc3QgdDUgPSB0aGlzLmJ5dGVzKCk7XG4gICAgcmV0dXJuIHV0ZjhSZWFkKHQ1LCAwLCB0NS5sZW5ndGgpO1xuICB9XG59O1xudmFyIHcgPSBjbGFzcyB7XG4gIGZuO1xuICBsZW47XG4gIHZhbDtcbiAgbmV4dDtcbiAgY29uc3RydWN0b3IodDUsIGkzLCBzMykge1xuICAgIHRoaXMuZm4gPSB0NSwgdGhpcy5sZW4gPSBpMywgdGhpcy52YWwgPSBzMztcbiAgfVxuICBwcm9jZWVkKHQ1LCBpMykge1xuICAgIHRoaXMuZm4gJiYgdGhpcy5mbih0aGlzLnZhbCwgdDUsIGkzKTtcbiAgfVxufTtcbnZhciBiID0gY2xhc3Mge1xuICBoZWFkO1xuICB0YWlsO1xuICBsZW47XG4gIG5leHQ7XG4gIGNvbnN0cnVjdG9yKHQ1KSB7XG4gICAgdGhpcy5oZWFkID0gdDUuaGVhZCwgdGhpcy50YWlsID0gdDUudGFpbCwgdGhpcy5sZW4gPSB0NS5sZW4sIHRoaXMubmV4dCA9IHQ1LnN0YXRlcztcbiAgfVxufTtcbnZhciBCaW5hcnlXcml0ZXIgPSBjbGFzcyBfQmluYXJ5V3JpdGVyIHtcbiAgbGVuID0gMDtcbiAgaGVhZDtcbiAgdGFpbDtcbiAgc3RhdGVzO1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmhlYWQgPSBuZXcgdyhudWxsLCAwLCAwKSwgdGhpcy50YWlsID0gdGhpcy5oZWFkLCB0aGlzLnN0YXRlcyA9IG51bGw7XG4gIH1cbiAgc3RhdGljIGNyZWF0ZSgpIHtcbiAgICByZXR1cm4gbmV3IF9CaW5hcnlXcml0ZXIoKTtcbiAgfVxuICBzdGF0aWMgYWxsb2ModDUpIHtcbiAgICByZXR1cm4gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgVWludDhBcnJheSA/IGZ1bmN0aW9uKHQ2LCBpMywgczMpIHtcbiAgICAgIGNvbnN0IGUyID0gczMgfHwgODE5MiwgbjIgPSBlMiA+Pj4gMTtcbiAgICAgIGxldCByNSA9IG51bGwsIGggPSBlMjtcbiAgICAgIHJldHVybiBmdW5jdGlvbihzNCkge1xuICAgICAgICBpZiAoczQgPCAxIHx8IHM0ID4gbjIpIHJldHVybiB0NihzNCk7XG4gICAgICAgIGggKyBzNCA+IGUyICYmIChyNSA9IHQ2KGUyKSwgaCA9IDApO1xuICAgICAgICBjb25zdCBvMiA9IGkzLmNhbGwocjUsIGgsIGggKz0gczQpO1xuICAgICAgICByZXR1cm4gNyAmIGggJiYgKGggPSAxICsgKDcgfCBoKSksIG8yO1xuICAgICAgfTtcbiAgICB9KCh0NikgPT4gbmV3IFVpbnQ4QXJyYXkodDYpLCBVaW50OEFycmF5LnByb3RvdHlwZS5zdWJhcnJheSkodDUpIDogbmV3IEFycmF5KHQ1KTtcbiAgfVxuICBfcHVzaCh0NSwgaTMsIHMzKSB7XG4gICAgcmV0dXJuIHRoaXMudGFpbCA9IHRoaXMudGFpbC5uZXh0ID0gbmV3IHcodDUsIGkzLCBzMyksIHRoaXMubGVuICs9IGkzLCB0aGlzO1xuICB9XG4gIGZpbmlzaCgpIHtcbiAgICBsZXQgdDUgPSB0aGlzLmhlYWQubmV4dCwgaTMgPSAwO1xuICAgIGNvbnN0IHMzID0gX0JpbmFyeVdyaXRlci5hbGxvYyh0aGlzLmxlbik7XG4gICAgZm9yICg7IHQ1OyApIHQ1LnByb2NlZWQoczMsIGkzKSwgaTMgKz0gdDUubGVuLCB0NSA9IHQ1Lm5leHQ7XG4gICAgcmV0dXJuIHMzO1xuICB9XG4gIGZvcmsoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGVzID0gbmV3IGIodGhpcyksIHRoaXMuaGVhZCA9IHRoaXMudGFpbCA9IG5ldyB3KG51bGwsIDAsIDApLCB0aGlzLmxlbiA9IDAsIHRoaXM7XG4gIH1cbiAgcmVzZXQoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGVzID8gKHRoaXMuaGVhZCA9IHRoaXMuc3RhdGVzLmhlYWQsIHRoaXMudGFpbCA9IHRoaXMuc3RhdGVzLnRhaWwsIHRoaXMubGVuID0gdGhpcy5zdGF0ZXMubGVuLCB0aGlzLnN0YXRlcyA9IHRoaXMuc3RhdGVzLm5leHQpIDogKHRoaXMuaGVhZCA9IHRoaXMudGFpbCA9IG5ldyB3KG51bGwsIDAsIDApLCB0aGlzLmxlbiA9IDApLCB0aGlzO1xuICB9XG4gIGxkZWxpbSgpIHtcbiAgICBjb25zdCB0NSA9IHRoaXMuaGVhZCwgaTMgPSB0aGlzLnRhaWwsIHMzID0gdGhpcy5sZW47XG4gICAgcmV0dXJuIHRoaXMucmVzZXQoKS51aW50MzIoczMpLCBzMyAmJiAodGhpcy50YWlsLm5leHQgPSB0NS5uZXh0LCB0aGlzLnRhaWwgPSBpMywgdGhpcy5sZW4gKz0gczMpLCB0aGlzO1xuICB9XG4gIHRhZyh0NSwgaTMpIHtcbiAgICByZXR1cm4gdGhpcy51aW50MzIoKHQ1IDw8IDMgfCBpMykgPj4+IDApO1xuICB9XG4gIHVpbnQzMih0NSkge1xuICAgIHJldHVybiB0aGlzLmxlbiArPSAodGhpcy50YWlsID0gdGhpcy50YWlsLm5leHQgPSBuZXcgdyh3cml0ZVZhcmludDMyLCAodDUgPj4+PSAwKSA8IDEyOCA/IDEgOiB0NSA8IDE2Mzg0ID8gMiA6IHQ1IDwgMjA5NzE1MiA/IDMgOiB0NSA8IDI2ODQzNTQ1NiA/IDQgOiA1LCB0NSkpLmxlbiwgdGhpcztcbiAgfVxuICBpbnQzMih0NSkge1xuICAgIHJldHVybiB0NSA8IDAgPyB0aGlzLl9wdXNoKHdyaXRlVmFyaW50NjQsIDEwLCBpbnQ2NEZyb21TdHJpbmcodDUudG9TdHJpbmcoKSkpIDogdGhpcy51aW50MzIodDUpO1xuICB9XG4gIHNpbnQzMih0NSkge1xuICAgIHJldHVybiB0aGlzLnVpbnQzMigodDUgPDwgMSBeIHQ1ID4+IDMxKSA+Pj4gMCk7XG4gIH1cbiAgaW50NjQodDUpIHtcbiAgICBjb25zdCB7IGxvOiBpMywgaGk6IHMzIH0gPSBpbnQ2NEZyb21TdHJpbmcodDUudG9TdHJpbmcoKSk7XG4gICAgcmV0dXJuIHRoaXMuX3B1c2god3JpdGVWYXJpbnQ2NCwgaW50NjRMZW5ndGgoaTMsIHMzKSwgeyBsbzogaTMsIGhpOiBzMyB9KTtcbiAgfVxuICB1aW50NjQgPSBfQmluYXJ5V3JpdGVyLnByb3RvdHlwZS5pbnQ2NDtcbiAgc2ludDY0KHQ1KSB7XG4gICAgbGV0IHsgbG86IGkzLCBoaTogczMgfSA9IGludDY0RnJvbVN0cmluZyh0NS50b1N0cmluZygpKTtcbiAgICByZXR1cm4gW2kzLCBzM10gPSB6ekVuY29kZShpMywgczMpLCB0aGlzLl9wdXNoKHdyaXRlVmFyaW50NjQsIGludDY0TGVuZ3RoKGkzLCBzMyksIHsgbG86IGkzLCBoaTogczMgfSk7XG4gIH1cbiAgZml4ZWQ2NCh0NSkge1xuICAgIGNvbnN0IHsgbG86IGkzLCBoaTogczMgfSA9IGludDY0RnJvbVN0cmluZyh0NS50b1N0cmluZygpKTtcbiAgICByZXR1cm4gdGhpcy5fcHVzaCh3cml0ZUZpeGVkMzIsIDQsIGkzKS5fcHVzaCh3cml0ZUZpeGVkMzIsIDQsIHMzKTtcbiAgfVxuICBzZml4ZWQ2NCA9IF9CaW5hcnlXcml0ZXIucHJvdG90eXBlLmZpeGVkNjQ7XG4gIGJvb2wodDUpIHtcbiAgICByZXR1cm4gdGhpcy5fcHVzaCh3cml0ZUJ5dGUsIDEsIHQ1ID8gMSA6IDApO1xuICB9XG4gIGZpeGVkMzIodDUpIHtcbiAgICByZXR1cm4gdGhpcy5fcHVzaCh3cml0ZUZpeGVkMzIsIDQsIHQ1ID4+PiAwKTtcbiAgfVxuICBzZml4ZWQzMiA9IF9CaW5hcnlXcml0ZXIucHJvdG90eXBlLmZpeGVkMzI7XG4gIGZsb2F0KHQ1KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiZmxvYXQgbm90IHN1cHBvcnRlZFwiICsgdDUpO1xuICB9XG4gIGRvdWJsZSh0NSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcImRvdWJsZSBub3Qgc3VwcG9ydGVkXCIgKyB0NSk7XG4gIH1cbiAgYnl0ZXModDUpIHtcbiAgICBjb25zdCBpMyA9IHQ1Lmxlbmd0aCA+Pj4gMDtcbiAgICByZXR1cm4gaTMgPyB0aGlzLnVpbnQzMihpMykuX3B1c2goZywgaTMsIHQ1KSA6IHRoaXMuX3B1c2god3JpdGVCeXRlLCAxLCAwKTtcbiAgfVxuICBzdHJpbmcoaTMpIHtcbiAgICBjb25zdCBlMiA9IHV0ZjhMZW5ndGgoaTMpO1xuICAgIHJldHVybiBlMiA/IHRoaXMudWludDMyKGUyKS5fcHVzaCh1dGY4V3JpdGUsIGUyLCBpMykgOiB0aGlzLl9wdXNoKHdyaXRlQnl0ZSwgMSwgMCk7XG4gIH1cbn07XG5mdW5jdGlvbiBnKHQ1LCBpMywgczMpIHtcbiAgaWYgKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIFVpbnQ4QXJyYXkpIGkzLnNldCh0NSwgczMpO1xuICBlbHNlIGZvciAobGV0IGUyID0gMDsgZTIgPCB0NS5sZW5ndGg7ICsrZTIpIGkzW3MzICsgZTJdID0gdDVbZTJdO1xufVxuZnVuY3Rpb24gQih0NSwgaTMpIHtcbiAgcmV0dXJuIFJhbmdlRXJyb3IoXCJpbmRleCBvdXQgb2YgcmFuZ2U6IFwiICsgdDUucG9zICsgXCIgKyBcIiArIChpMyB8fCAxKSArIFwiID4gXCIgKyB0NS5sZW4pO1xufVxuXG4vL1xuZnVuY3Rpb24gaXNTZXQodDUpIHtcbiAgcmV0dXJuIG51bGwgIT0gdDU7XG59XG5mdW5jdGlvbiB0b1RpbWVzdGFtcCh0NSkge1xuICB2YXIgbjI7XG4gIHJldHVybiB7IHNlY29uZHM6IChuMiA9IHQ1LmdldFRpbWUoKSAvIDFlMywgQmlnSW50KE1hdGgudHJ1bmMobjIpKSksIG5hbm9zOiB0NS5nZXRUaW1lKCkgJSAxZTMgKiAxZTYgfTtcbn1cbmZ1bmN0aW9uIGZyb21UaW1lc3RhbXAodDUpIHtcbiAgbGV0IG4yID0gMWUzICogTnVtYmVyKHQ1LnNlY29uZHMpO1xuICByZXR1cm4gbjIgKz0gdDUubmFub3MgLyAxZTYsIG5ldyBEYXRlKG4yKTtcbn1cbmZ1bmN0aW9uIGZyb21Kc29uVGltZXN0YW1wKHQ1KSB7XG4gIHJldHVybiB0NSBpbnN0YW5jZW9mIERhdGUgPyB0b1RpbWVzdGFtcCh0NSkgOiBcInN0cmluZ1wiID09IHR5cGVvZiB0NSA/IHRvVGltZXN0YW1wKG5ldyBEYXRlKHQ1KSkgOiB7IHNlY29uZHM6IGlzU2V0KChuMiA9IHQ1KS5zZWNvbmRzKSA/IEJpZ0ludChuMi5zZWNvbmRzLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBuYW5vczogaXNTZXQobjIubmFub3MpID8gTnVtYmVyKG4yLm5hbm9zKSA6IDAgfTtcbiAgdmFyIG4yO1xufVxuXG4vL1xuZnVuY3Rpb24gbCgpIHtcbiAgcmV0dXJuIHsgJHR5cGVVcmw6IFwiL2dvb2dsZS5wcm90b2J1Zi5BbnlcIiwgdHlwZVVybDogXCJcIiwgdmFsdWU6IG5ldyBVaW50OEFycmF5KCkgfTtcbn1cbnZhciBBbnkgPSB7IHR5cGVVcmw6IFwiL2dvb2dsZS5wcm90b2J1Zi5BbnlcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIudHlwZVVybCAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi50eXBlVXJsKSwgMCAhPT0gZTIudmFsdWUubGVuZ3RoICYmIG8yLnVpbnQzMigxOCkuYnl0ZXMoZTIudmFsdWUpLCBvMiksIGRlY29kZShyNSwgbzIpIHtcbiAgY29uc3QgdDUgPSByNSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHI1IDogbmV3IEJpbmFyeVJlYWRlcihyNSk7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gbzIgPyB0NS5sZW4gOiB0NS5wb3MgKyBvMjtcbiAgY29uc3QgYTIgPSBsKCk7XG4gIGZvciAoOyB0NS5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTIgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUyID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGEyLnR5cGVVcmwgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGEyLnZhbHVlID0gdDUuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgZTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyB0eXBlVXJsOiBpc1NldChlMi50eXBlVXJsKSA/IFN0cmluZyhlMi50eXBlVXJsKSA6IFwiXCIsIHZhbHVlOiBpc1NldChlMi52YWx1ZSkgPyBkZWNvZGVCYXNlNjQoZTIudmFsdWUpIDogbmV3IFVpbnQ4QXJyYXkoKSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHI1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLnR5cGVVcmwgJiYgKHI1LnR5cGVVcmwgPSBlMi50eXBlVXJsKSwgdm9pZCAwICE9PSBlMi52YWx1ZSAmJiAocjUudmFsdWUgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSBlMi52YWx1ZSA/IGUyLnZhbHVlIDogbmV3IFVpbnQ4QXJyYXkoKSkpLCByNTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHI1ID0gbCgpO1xuICByZXR1cm4gcjUudHlwZVVybCA9IGUyLnR5cGVVcmwgPz8gXCJcIiwgcjUudmFsdWUgPSBlMi52YWx1ZSA/PyBuZXcgVWludDhBcnJheSgpLCByNTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBBbnkuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBBbnkuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9nb29nbGUucHJvdG9idWYuQW55XCIsIHZhbHVlOiBBbnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIFNpZ25Nb2RlO1xuIWZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLlNJR05fTU9ERV9VTlNQRUNJRklFRCA9IDBdID0gXCJTSUdOX01PREVfVU5TUEVDSUZJRURcIiwgZTJbZTIuU0lHTl9NT0RFX0RJUkVDVCA9IDFdID0gXCJTSUdOX01PREVfRElSRUNUXCIsIGUyW2UyLlNJR05fTU9ERV9URVhUVUFMID0gMl0gPSBcIlNJR05fTU9ERV9URVhUVUFMXCIsIGUyW2UyLlNJR05fTU9ERV9ESVJFQ1RfQVVYID0gM10gPSBcIlNJR05fTU9ERV9ESVJFQ1RfQVVYXCIsIGUyW2UyLlNJR05fTU9ERV9MRUdBQ1lfQU1JTk9fSlNPTiA9IDEyN10gPSBcIlNJR05fTU9ERV9MRUdBQ1lfQU1JTk9fSlNPTlwiLCBlMltlMi5TSUdOX01PREVfRUlQXzE5MSA9IDE5MV0gPSBcIlNJR05fTU9ERV9FSVBfMTkxXCIsIGUyW2UyLlVOUkVDT0dOSVpFRCA9IC0xXSA9IFwiVU5SRUNPR05JWkVEXCI7XG59KFNpZ25Nb2RlIHx8IChTaWduTW9kZSA9IHt9KSk7XG5cbi8vXG52YXIgRGVjaW1hbCA9IGNsYXNzIF9EZWNpbWFsIHtcbiAgc3RhdGljIGZyb21Vc2VySW5wdXQodDUsIGkzKSB7XG4gICAgX0RlY2ltYWwudmVyaWZ5RnJhY3Rpb25hbERpZ2l0cyhpMyk7XG4gICAgY29uc3QgcjUgPSB0NS5tYXRjaCgvW14wLTkuXS8pO1xuICAgIGlmIChyNSkgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGNoYXJhY3RlciBhdCBwb3NpdGlvbiAke3I1LmluZGV4ICsgMX1gKTtcbiAgICBsZXQgYTIsIGUyO1xuICAgIGlmIChcIlwiID09PSB0NSkgYTIgPSBcIjBcIiwgZTIgPSBcIlwiO1xuICAgIGVsc2UgaWYgKC0xID09PSB0NS5zZWFyY2goL1xcLi8pKSBhMiA9IHQ1LCBlMiA9IFwiXCI7XG4gICAgZWxzZSB7XG4gICAgICBjb25zdCBpNCA9IHQ1LnNwbGl0KFwiLlwiKTtcbiAgICAgIHN3aXRjaCAoaTQubGVuZ3RoKSB7XG4gICAgICAgIGNhc2UgMDpcbiAgICAgICAgY2FzZSAxOlxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZld2VyIHRoYW4gdHdvIGVsZW1lbnRzIGluIHNwbGl0IHJlc3VsdC4gVGhpcyBtdXN0IG5vdCBoYXBwZW4gaGVyZS5cIik7XG4gICAgICAgIGNhc2UgMjpcbiAgICAgICAgICBpZiAoIWk0WzFdKSB0aHJvdyBuZXcgRXJyb3IoXCJGcmFjdGlvbmFsIHBhcnQgbWlzc2luZ1wiKTtcbiAgICAgICAgICBhMiA9IGk0WzBdLCBlMiA9IGk0WzFdLnJlcGxhY2UoLzArJC8sIFwiXCIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1vcmUgdGhhbiBvbmUgc2VwYXJhdG9yIGZvdW5kXCIpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZTIubGVuZ3RoID4gaTMpIHRocm93IG5ldyBFcnJvcihcIkdvdCBtb3JlIGZyYWN0aW9uYWwgZGlnaXRzIHRoYW4gc3VwcG9ydGVkXCIpO1xuICAgIGNvbnN0IG4yID0gYCR7YTJ9JHtlMi5wYWRFbmQoaTMsIFwiMFwiKX1gO1xuICAgIHJldHVybiBuZXcgX0RlY2ltYWwobjIsIGkzKTtcbiAgfVxuICBzdGF0aWMgZnJvbUF0b21pY3ModDUsIGkzKSB7XG4gICAgcmV0dXJuIF9EZWNpbWFsLnZlcmlmeUZyYWN0aW9uYWxEaWdpdHMoaTMpLCBuZXcgX0RlY2ltYWwodDUsIGkzKTtcbiAgfVxuICBzdGF0aWMgdmVyaWZ5RnJhY3Rpb25hbERpZ2l0cyh0NSkge1xuICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcih0NSkpIHRocm93IG5ldyBFcnJvcihcIkZyYWN0aW9uYWwgZGlnaXRzIGlzIG5vdCBhbiBpbnRlZ2VyXCIpO1xuICAgIGlmICh0NSA8IDApIHRocm93IG5ldyBFcnJvcihcIkZyYWN0aW9uYWwgZGlnaXRzIG11c3Qgbm90IGJlIG5lZ2F0aXZlXCIpO1xuICAgIGlmICh0NSA+IDMwKSB0aHJvdyBuZXcgRXJyb3IoXCJGcmFjdGlvbmFsIGRpZ2l0cyBtdXN0IG5vdCBleGNlZWQgMzBcIik7XG4gIH1cbiAgZ2V0IGF0b21pY3MoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YS5hdG9taWNzLnRvU3RyaW5nKCk7XG4gIH1cbiAgZ2V0IGZyYWN0aW9uYWxEaWdpdHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YS5mcmFjdGlvbmFsRGlnaXRzO1xuICB9XG4gIGRhdGE7XG4gIGNvbnN0cnVjdG9yKHQ1LCBpMykge1xuICAgIGlmICghdDUubWF0Y2goL15bMC05XSskLykpIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3RyaW5nIGZvcm1hdC4gT25seSBub24tbmVnYXRpdmUgaW50ZWdlcnMgaW4gZGVjaW1hbCByZXByZXNlbnRhdGlvbiBzdXBwb3J0ZWQuXCIpO1xuICAgIHRoaXMuZGF0YSA9IHsgYXRvbWljczogQmlnSW50KHQ1KSwgZnJhY3Rpb25hbERpZ2l0czogaTMgfTtcbiAgfVxuICB0b1N0cmluZygpIHtcbiAgICBjb25zdCB0NSA9IEJpZ0ludCgxMCkgKiogQmlnSW50KHRoaXMuZGF0YS5mcmFjdGlvbmFsRGlnaXRzKSwgaTMgPSB0aGlzLmRhdGEuYXRvbWljcyAvIHQ1LCByNSA9IHRoaXMuZGF0YS5hdG9taWNzICUgdDU7XG4gICAgaWYgKDBuID09PSByNSkgcmV0dXJuIGkzLnRvU3RyaW5nKCk7XG4gICAge1xuICAgICAgY29uc3QgdDYgPSByNS50b1N0cmluZygpLnBhZFN0YXJ0KHRoaXMuZGF0YS5mcmFjdGlvbmFsRGlnaXRzLCBcIjBcIikucmVwbGFjZSgvMCskLywgXCJcIik7XG4gICAgICByZXR1cm4gYCR7aTMudG9TdHJpbmcoKX0uJHt0Nn1gO1xuICAgIH1cbiAgfVxufTtcblxuLy9cbnZhciBDb2luID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS52MWJldGExLkNvaW5cIiwgZW5jb2RlOiAobzIsIG4yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbzIuZGVub20gJiYgbjIudWludDMyKDEwKS5zdHJpbmcobzIuZGVub20pLCBcIlwiICE9PSBvMi5hbW91bnQgJiYgbjIudWludDMyKDE4KS5zdHJpbmcobzIuYW1vdW50KSwgbjIpLCBkZWNvZGUodDUsIG4yKSB7XG4gIGNvbnN0IGUyID0gdDUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyB0NSA6IG5ldyBCaW5hcnlSZWFkZXIodDUpO1xuICBsZXQgcjUgPSB2b2lkIDAgPT09IG4yID8gZTIubGVuIDogZTIucG9zICsgbjI7XG4gIGNvbnN0IHMzID0geyBkZW5vbTogXCJcIiwgYW1vdW50OiBcIlwiIH07XG4gIGZvciAoOyBlMi5wb3MgPCByNTsgKSB7XG4gICAgY29uc3QgbzIgPSBlMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG8yID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHMzLmRlbm9tID0gZTIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBzMy5hbW91bnQgPSBlMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBlMi5za2lwVHlwZSg3ICYgbzIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gczM7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyBkZW5vbTogaXNTZXQobzIuZGVub20pID8gU3RyaW5nKG8yLmRlbm9tKSA6IFwiXCIsIGFtb3VudDogaXNTZXQobzIuYW1vdW50KSA/IFN0cmluZyhvMi5hbW91bnQpIDogXCJcIiB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLmRlbm9tICYmICh0NS5kZW5vbSA9IG8yLmRlbm9tKSwgdm9pZCAwICE9PSBvMi5hbW91bnQgJiYgKHQ1LmFtb3VudCA9IG8yLmFtb3VudCksIHQ1O1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgdDUgPSB7IGRlbm9tOiBcIlwiLCBhbW91bnQ6IFwiXCIgfTtcbiAgcmV0dXJuIHQ1LmRlbm9tID0gbzIuZGVub20gPz8gXCJcIiwgdDUuYW1vdW50ID0gbzIuYW1vdW50ID8/IFwiXCIsIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IENvaW4uZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBDb2luLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhc2UudjFiZXRhMS5Db2luXCIsIHZhbHVlOiBDb2luLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbnZhciBEZWNDb2luID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS52MWJldGExLkRlY0NvaW5cIiwgZW5jb2RlOiAobzIsIG4yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbzIuZGVub20gJiYgbjIudWludDMyKDEwKS5zdHJpbmcobzIuZGVub20pLCBcIlwiICE9PSBvMi5hbW91bnQgJiYgbjIudWludDMyKDE4KS5zdHJpbmcoRGVjaW1hbC5mcm9tVXNlcklucHV0KG8yLmFtb3VudCwgMTgpLmF0b21pY3MpLCBuMiksIGRlY29kZSh0NSwgbjIpIHtcbiAgY29uc3QgcjUgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBzMyA9IHZvaWQgMCA9PT0gbjIgPyByNS5sZW4gOiByNS5wb3MgKyBuMjtcbiAgY29uc3QgaTMgPSB7IGRlbm9tOiBcIlwiLCBhbW91bnQ6IFwiXCIgfTtcbiAgZm9yICg7IHI1LnBvcyA8IHMzOyApIHtcbiAgICBjb25zdCBvMiA9IHI1LnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzIgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTMuZGVub20gPSByNS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkzLmFtb3VudCA9IERlY2ltYWwuZnJvbUF0b21pY3MocjUuc3RyaW5nKCksIDE4KS50b1N0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHI1LnNraXBUeXBlKDcgJiBvMik7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMztcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGRlbm9tOiBpc1NldChvMi5kZW5vbSkgPyBTdHJpbmcobzIuZGVub20pIDogXCJcIiwgYW1vdW50OiBpc1NldChvMi5hbW91bnQpID8gU3RyaW5nKG8yLmFtb3VudCkgOiBcIlwiIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZGVub20gJiYgKHQ1LmRlbm9tID0gbzIuZGVub20pLCB2b2lkIDAgIT09IG8yLmFtb3VudCAmJiAodDUuYW1vdW50ID0gbzIuYW1vdW50KSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgZGVub206IFwiXCIsIGFtb3VudDogXCJcIiB9O1xuICByZXR1cm4gdDUuZGVub20gPSBvMi5kZW5vbSA/PyBcIlwiLCB0NS5hbW91bnQgPSBvMi5hbW91bnQgPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gRGVjQ29pbi5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IERlY0NvaW4uZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS52MWJldGExLkRlY0NvaW5cIiwgdmFsdWU6IERlY0NvaW4uZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xuXG4vL1xuZnVuY3Rpb24gZzIoKSB7XG4gIHJldHVybiB7IG1lc3NhZ2VzOiBbXSwgbWVtbzogXCJcIiwgdGltZW91dEhlaWdodDogQmlnSW50KDApLCBleHRlbnNpb25PcHRpb25zOiBbXSwgbm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zOiBbXSB9O1xufVxudmFyIFR4Qm9keSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnR4LnYxYmV0YTEuVHhCb2R5XCIsIGVuY29kZShlMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBuMiBvZiBlMi5tZXNzYWdlcykgQW55LmVuY29kZShuMiwgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICBcIlwiICE9PSBlMi5tZW1vICYmIHQ1LnVpbnQzMigxOCkuc3RyaW5nKGUyLm1lbW8pLCBlMi50aW1lb3V0SGVpZ2h0ICE9PSBCaWdJbnQoMCkgJiYgdDUudWludDMyKDI0KS51aW50NjQoZTIudGltZW91dEhlaWdodCk7XG4gIGZvciAoY29uc3QgbjIgb2YgZTIuZXh0ZW5zaW9uT3B0aW9ucykgQW55LmVuY29kZShuMiwgdDUudWludDMyKDgxODYpLmZvcmsoKSkubGRlbGltKCk7XG4gIGZvciAoY29uc3QgbjIgb2YgZTIubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zKSBBbnkuZW5jb2RlKG4yLCB0NS51aW50MzIoMTYzNzgpLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB0NTtcbn0sIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbjIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBpMyA9IHZvaWQgMCA9PT0gdDUgPyBuMi5sZW4gOiBuMi5wb3MgKyB0NTtcbiAgY29uc3QgcjUgPSBnMigpO1xuICBmb3IgKDsgbjIucG9zIDwgaTM7ICkge1xuICAgIGNvbnN0IGUzID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5tZXNzYWdlcy5wdXNoKEFueS5kZWNvZGUobjIsIG4yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNS5tZW1vID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICByNS50aW1lb3V0SGVpZ2h0ID0gbjIudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAxMDIzOlxuICAgICAgICByNS5leHRlbnNpb25PcHRpb25zLnB1c2goQW55LmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDIwNDc6XG4gICAgICAgIHI1Lm5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9ucy5wdXNoKEFueS5kZWNvZGUobjIsIG4yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgbWVzc2FnZXM6IEFycmF5LmlzQXJyYXkoZTI/Lm1lc3NhZ2VzKSA/IGUyLm1lc3NhZ2VzLm1hcCgoZTMpID0+IEFueS5mcm9tSlNPTihlMykpIDogW10sIG1lbW86IGlzU2V0KGUyLm1lbW8pID8gU3RyaW5nKGUyLm1lbW8pIDogXCJcIiwgdGltZW91dEhlaWdodDogaXNTZXQoZTIudGltZW91dEhlaWdodCkgPyBCaWdJbnQoZTIudGltZW91dEhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgZXh0ZW5zaW9uT3B0aW9uczogQXJyYXkuaXNBcnJheShlMj8uZXh0ZW5zaW9uT3B0aW9ucykgPyBlMi5leHRlbnNpb25PcHRpb25zLm1hcCgoZTMpID0+IEFueS5mcm9tSlNPTihlMykpIDogW10sIG5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9uczogQXJyYXkuaXNBcnJheShlMj8ubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zKSA/IGUyLm5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9ucy5tYXAoKGUzKSA9PiBBbnkuZnJvbUpTT04oZTMpKSA6IFtdIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIGUyLm1lc3NhZ2VzID8gdDUubWVzc2FnZXMgPSBlMi5tZXNzYWdlcy5tYXAoKGUzKSA9PiBlMyA/IEFueS50b0pTT04oZTMpIDogdm9pZCAwKSA6IHQ1Lm1lc3NhZ2VzID0gW10sIHZvaWQgMCAhPT0gZTIubWVtbyAmJiAodDUubWVtbyA9IGUyLm1lbW8pLCB2b2lkIDAgIT09IGUyLnRpbWVvdXRIZWlnaHQgJiYgKHQ1LnRpbWVvdXRIZWlnaHQgPSAoZTIudGltZW91dEhlaWdodCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCBlMi5leHRlbnNpb25PcHRpb25zID8gdDUuZXh0ZW5zaW9uT3B0aW9ucyA9IGUyLmV4dGVuc2lvbk9wdGlvbnMubWFwKChlMykgPT4gZTMgPyBBbnkudG9KU09OKGUzKSA6IHZvaWQgMCkgOiB0NS5leHRlbnNpb25PcHRpb25zID0gW10sIGUyLm5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9ucyA/IHQ1Lm5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9ucyA9IGUyLm5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9ucy5tYXAoKGUzKSA9PiBlMyA/IEFueS50b0pTT04oZTMpIDogdm9pZCAwKSA6IHQ1Lm5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9ucyA9IFtdLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0gZzIoKTtcbiAgcmV0dXJuIHQ1Lm1lc3NhZ2VzID0gZTIubWVzc2FnZXM/Lm1hcCgoZTMpID0+IEFueS5mcm9tUGFydGlhbChlMykpIHx8IFtdLCB0NS5tZW1vID0gZTIubWVtbyA/PyBcIlwiLCB0NS50aW1lb3V0SGVpZ2h0ID0gdm9pZCAwICE9PSBlMi50aW1lb3V0SGVpZ2h0ICYmIG51bGwgIT09IGUyLnRpbWVvdXRIZWlnaHQgPyBCaWdJbnQoZTIudGltZW91dEhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgdDUuZXh0ZW5zaW9uT3B0aW9ucyA9IGUyLmV4dGVuc2lvbk9wdGlvbnM/Lm1hcCgoZTMpID0+IEFueS5mcm9tUGFydGlhbChlMykpIHx8IFtdLCB0NS5ub25Dcml0aWNhbEV4dGVuc2lvbk9wdGlvbnMgPSBlMi5ub25Dcml0aWNhbEV4dGVuc2lvbk9wdGlvbnM/Lm1hcCgoZTMpID0+IEFueS5mcm9tUGFydGlhbChlMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBUeEJvZHkuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBUeEJvZHkuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MudHgudjFiZXRhMS5UeEJvZHlcIiwgdmFsdWU6IFR4Qm9keS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG5mdW5jdGlvbiBzKCkge1xuICByZXR1cm4geyB0eXBlOiBcIlwiLCBrZXk6IG5ldyBVaW50OEFycmF5KCksIGRhdGE6IG5ldyBVaW50OEFycmF5KCkgfTtcbn1cbnZhciBQcm9vZk9wID0geyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmNyeXB0by5Qcm9vZk9wXCIsIGVuY29kZTogKHQ1LCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IHQ1LnR5cGUgJiYgZTIudWludDMyKDEwKS5zdHJpbmcodDUudHlwZSksIDAgIT09IHQ1LmtleS5sZW5ndGggJiYgZTIudWludDMyKDE4KS5ieXRlcyh0NS5rZXkpLCAwICE9PSB0NS5kYXRhLmxlbmd0aCAmJiBlMi51aW50MzIoMjYpLmJ5dGVzKHQ1LmRhdGEpLCBlMiksIGRlY29kZShvMiwgZTIpIHtcbiAgY29uc3QgbjIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCByNSA9IHZvaWQgMCA9PT0gZTIgPyBuMi5sZW4gOiBuMi5wb3MgKyBlMjtcbiAgY29uc3QgaTMgPSBzKCk7XG4gIGZvciAoOyBuMi5wb3MgPCByNTsgKSB7XG4gICAgY29uc3QgdDUgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKHQ1ID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkzLnR5cGUgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkzLmtleSA9IG4yLmJ5dGVzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBpMy5kYXRhID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgdDUpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTM7XG59LCBmcm9tSlNPTjogKHQ1KSA9PiAoeyB0eXBlOiBpc1NldCh0NS50eXBlKSA/IFN0cmluZyh0NS50eXBlKSA6IFwiXCIsIGtleTogaXNTZXQodDUua2V5KSA/IGRlY29kZUJhc2U2NCh0NS5rZXkpIDogbmV3IFVpbnQ4QXJyYXkoKSwgZGF0YTogaXNTZXQodDUuZGF0YSkgPyBkZWNvZGVCYXNlNjQodDUuZGF0YSkgOiBuZXcgVWludDhBcnJheSgpIH0pLCB0b0pTT04odDUpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gdDUudHlwZSAmJiAobzIudHlwZSA9IHQ1LnR5cGUpLCB2b2lkIDAgIT09IHQ1LmtleSAmJiAobzIua2V5ID0gZW5jb2RlQmFzZTY0KHZvaWQgMCAhPT0gdDUua2V5ID8gdDUua2V5IDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB2b2lkIDAgIT09IHQ1LmRhdGEgJiYgKG8yLmRhdGEgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSB0NS5kYXRhID8gdDUuZGF0YSA6IG5ldyBVaW50OEFycmF5KCkpKSwgbzI7XG59LCBmcm9tUGFydGlhbCh0NSkge1xuICBjb25zdCBvMiA9IHMoKTtcbiAgcmV0dXJuIG8yLnR5cGUgPSB0NS50eXBlID8/IFwiXCIsIG8yLmtleSA9IHQ1LmtleSA/PyBuZXcgVWludDhBcnJheSgpLCBvMi5kYXRhID0gdDUuZGF0YSA/PyBuZXcgVWludDhBcnJheSgpLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKHQ1KSA9PiBQcm9vZk9wLmRlY29kZSh0NS52YWx1ZSksIHRvUHJvdG86ICh0NSkgPT4gUHJvb2ZPcC5lbmNvZGUodDUpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAodDUpID0+ICh7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuY3J5cHRvLlByb29mT3BcIiwgdmFsdWU6IFByb29mT3AuZW5jb2RlKHQ1KS5maW5pc2goKSB9KSB9O1xudmFyIFByb29mT3BzID0geyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmNyeXB0by5Qcm9vZk9wc1wiLCBlbmNvZGUodDUsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgbzIgb2YgdDUub3BzKSBQcm9vZk9wLmVuY29kZShvMiwgZTIudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gZTI7XG59LCBkZWNvZGUobzIsIGUyKSB7XG4gIGNvbnN0IG4yID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgcjUgPSB2b2lkIDAgPT09IGUyID8gbjIubGVuIDogbjIucG9zICsgZTI7XG4gIGNvbnN0IGkzID0geyBvcHM6IFtdIH07XG4gIGZvciAoOyBuMi5wb3MgPCByNTsgKSB7XG4gICAgY29uc3QgdDUgPSBuMi51aW50MzIoKTtcbiAgICBpZiAodDUgPj4+IDMgPT0gMSkgaTMub3BzLnB1c2goUHJvb2ZPcC5kZWNvZGUobjIsIG4yLnVpbnQzMigpKSk7XG4gICAgZWxzZSBuMi5za2lwVHlwZSg3ICYgdDUpO1xuICB9XG4gIHJldHVybiBpMztcbn0sIGZyb21KU09OOiAodDUpID0+ICh7IG9wczogQXJyYXkuaXNBcnJheSh0NT8ub3BzKSA/IHQ1Lm9wcy5tYXAoKHQ2KSA9PiBQcm9vZk9wLmZyb21KU09OKHQ2KSkgOiBbXSB9KSwgdG9KU09OKHQ1KSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB0NS5vcHMgPyBvMi5vcHMgPSB0NS5vcHMubWFwKCh0NikgPT4gdDYgPyBQcm9vZk9wLnRvSlNPTih0NikgOiB2b2lkIDApIDogbzIub3BzID0gW10sIG8yO1xufSwgZnJvbVBhcnRpYWwodDUpIHtcbiAgY29uc3QgbzIgPSB7IG9wczogW10gfTtcbiAgcmV0dXJuIG8yLm9wcyA9IHQ1Lm9wcz8ubWFwKCh0NikgPT4gUHJvb2ZPcC5mcm9tUGFydGlhbCh0NikpIHx8IFtdLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKHQ1KSA9PiBQcm9vZk9wcy5kZWNvZGUodDUudmFsdWUpLCB0b1Byb3RvOiAodDUpID0+IFByb29mT3BzLmVuY29kZSh0NSkuZmluaXNoKCksIHRvUHJvdG9Nc2c6ICh0NSkgPT4gKHsgdHlwZVVybDogXCIvdGVuZGVybWludC5jcnlwdG8uUHJvb2ZPcHNcIiwgdmFsdWU6IFByb29mT3BzLmVuY29kZSh0NSkuZmluaXNoKCkgfSkgfTtcblxuLy9cbmZ1bmN0aW9uIHQyKCkge1xuICByZXR1cm4geyBzZWNvbmRzOiBCaWdJbnQoMCksIG5hbm9zOiAwIH07XG59XG52YXIgVGltZXN0YW1wID0geyB0eXBlVXJsOiBcIi9nb29nbGUucHJvdG9idWYuVGltZXN0YW1wXCIsIGVuY29kZTogKG4yLCBzMyA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKG4yLnNlY29uZHMgIT09IEJpZ0ludCgwKSAmJiBzMy51aW50MzIoOCkuaW50NjQobjIuc2Vjb25kcyksIDAgIT09IG4yLm5hbm9zICYmIHMzLnVpbnQzMigxNikuaW50MzIobjIubmFub3MpLCBzMyksIGRlY29kZShvMiwgczMpIHtcbiAgY29uc3QgZTIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBpMyA9IHZvaWQgMCA9PT0gczMgPyBlMi5sZW4gOiBlMi5wb3MgKyBzMztcbiAgY29uc3QgcjUgPSB0MigpO1xuICBmb3IgKDsgZTIucG9zIDwgaTM7ICkge1xuICAgIGNvbnN0IG4yID0gZTIudWludDMyKCk7XG4gICAgc3dpdGNoIChuMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5zZWNvbmRzID0gZTIuaW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1Lm5hbm9zID0gZTIuaW50MzIoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBlMi5za2lwVHlwZSg3ICYgbjIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKG4yKSA9PiAoeyBzZWNvbmRzOiBpc1NldChuMi5zZWNvbmRzKSA/IEJpZ0ludChuMi5zZWNvbmRzLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBuYW5vczogaXNTZXQobjIubmFub3MpID8gTnVtYmVyKG4yLm5hbm9zKSA6IDAgfSksIHRvSlNPTihuMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBuMi5zZWNvbmRzICYmIChvMi5zZWNvbmRzID0gKG4yLnNlY29uZHMgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBuMi5uYW5vcyAmJiAobzIubmFub3MgPSBNYXRoLnJvdW5kKG4yLm5hbm9zKSksIG8yO1xufSwgZnJvbVBhcnRpYWwobjIpIHtcbiAgY29uc3QgbzIgPSB0MigpO1xuICByZXR1cm4gbzIuc2Vjb25kcyA9IHZvaWQgMCAhPT0gbjIuc2Vjb25kcyAmJiBudWxsICE9PSBuMi5zZWNvbmRzID8gQmlnSW50KG4yLnNlY29uZHMudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG8yLm5hbm9zID0gbjIubmFub3MgPz8gMCwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChuMikgPT4gVGltZXN0YW1wLmRlY29kZShuMi52YWx1ZSksIHRvUHJvdG86IChuMikgPT4gVGltZXN0YW1wLmVuY29kZShuMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChuMikgPT4gKHsgdHlwZVVybDogXCIvZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcFwiLCB2YWx1ZTogVGltZXN0YW1wLmVuY29kZShuMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBCbG9ja0lERmxhZztcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5CTE9DS19JRF9GTEFHX1VOS05PV04gPSAwXSA9IFwiQkxPQ0tfSURfRkxBR19VTktOT1dOXCIsIGUyW2UyLkJMT0NLX0lEX0ZMQUdfQUJTRU5UID0gMV0gPSBcIkJMT0NLX0lEX0ZMQUdfQUJTRU5UXCIsIGUyW2UyLkJMT0NLX0lEX0ZMQUdfQ09NTUlUID0gMl0gPSBcIkJMT0NLX0lEX0ZMQUdfQ09NTUlUXCIsIGUyW2UyLkJMT0NLX0lEX0ZMQUdfTklMID0gM10gPSBcIkJMT0NLX0lEX0ZMQUdfTklMXCIsIGUyW2UyLlVOUkVDT0dOSVpFRCA9IC0xXSA9IFwiVU5SRUNPR05JWkVEXCI7XG59KEJsb2NrSURGbGFnIHx8IChCbG9ja0lERmxhZyA9IHt9KSk7XG52YXIgU2lnbmVkTXNnVHlwZTtcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5TSUdORURfTVNHX1RZUEVfVU5LTk9XTiA9IDBdID0gXCJTSUdORURfTVNHX1RZUEVfVU5LTk9XTlwiLCBlMltlMi5TSUdORURfTVNHX1RZUEVfUFJFVk9URSA9IDFdID0gXCJTSUdORURfTVNHX1RZUEVfUFJFVk9URVwiLCBlMltlMi5TSUdORURfTVNHX1RZUEVfUFJFQ09NTUlUID0gMl0gPSBcIlNJR05FRF9NU0dfVFlQRV9QUkVDT01NSVRcIiwgZTJbZTIuU0lHTkVEX01TR19UWVBFX1BST1BPU0FMID0gMzJdID0gXCJTSUdORURfTVNHX1RZUEVfUFJPUE9TQUxcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0oU2lnbmVkTXNnVHlwZSB8fCAoU2lnbmVkTXNnVHlwZSA9IHt9KSk7XG5cbi8vXG52YXIgQ2hlY2tUeFR5cGU7XG4hZnVuY3Rpb24oZTIpIHtcbiAgZTJbZTIuTkVXID0gMF0gPSBcIk5FV1wiLCBlMltlMi5SRUNIRUNLID0gMV0gPSBcIlJFQ0hFQ0tcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0oQ2hlY2tUeFR5cGUgfHwgKENoZWNrVHhUeXBlID0ge30pKTtcbnZhciBFdmlkZW5jZVR5cGU7XG4hZnVuY3Rpb24oZTIpIHtcbiAgZTJbZTIuVU5LTk9XTiA9IDBdID0gXCJVTktOT1dOXCIsIGUyW2UyLkRVUExJQ0FURV9WT1RFID0gMV0gPSBcIkRVUExJQ0FURV9WT1RFXCIsIGUyW2UyLkxJR0hUX0NMSUVOVF9BVFRBQ0sgPSAyXSA9IFwiTElHSFRfQ0xJRU5UX0FUVEFDS1wiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShFdmlkZW5jZVR5cGUgfHwgKEV2aWRlbmNlVHlwZSA9IHt9KSk7XG5mdW5jdGlvbiBwKCkge1xuICByZXR1cm4geyBkYXRhOiBuZXcgVWludDhBcnJheSgpLCBwYXRoOiBcIlwiLCBoZWlnaHQ6IEJpZ0ludCgwKSwgcHJvdmU6IGZhbHNlIH07XG59XG52YXIgUmVxdWVzdFF1ZXJ5ID0geyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmFiY2kuUmVxdWVzdFF1ZXJ5XCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKDAgIT09IGUyLmRhdGEubGVuZ3RoICYmIHQ1LnVpbnQzMigxMCkuYnl0ZXMoZTIuZGF0YSksIFwiXCIgIT09IGUyLnBhdGggJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIucGF0aCksIGUyLmhlaWdodCAhPT0gQmlnSW50KDApICYmIHQ1LnVpbnQzMigyNCkuaW50NjQoZTIuaGVpZ2h0KSwgdHJ1ZSA9PT0gZTIucHJvdmUgJiYgdDUudWludDMyKDMyKS5ib29sKGUyLnByb3ZlKSwgdDUpLCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IGkzID0gcCgpO1xuICBmb3IgKDsgbzIucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMy5kYXRhID0gbzIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkzLnBhdGggPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGkzLmhlaWdodCA9IG8yLmludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBpMy5wcm92ZSA9IG8yLmJvb2woKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTM7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkYXRhOiBpc1NldChlMi5kYXRhKSA/IGRlY29kZUJhc2U2NChlMi5kYXRhKSA6IG5ldyBVaW50OEFycmF5KCksIHBhdGg6IGlzU2V0KGUyLnBhdGgpID8gU3RyaW5nKGUyLnBhdGgpIDogXCJcIiwgaGVpZ2h0OiBpc1NldChlMi5oZWlnaHQpID8gQmlnSW50KGUyLmhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgcHJvdmU6ICEhaXNTZXQoZTIucHJvdmUpICYmIEJvb2xlYW4oZTIucHJvdmUpIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGF0YSAmJiAodDUuZGF0YSA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IGUyLmRhdGEgPyBlMi5kYXRhIDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB2b2lkIDAgIT09IGUyLnBhdGggJiYgKHQ1LnBhdGggPSBlMi5wYXRoKSwgdm9pZCAwICE9PSBlMi5oZWlnaHQgJiYgKHQ1LmhlaWdodCA9IChlMi5oZWlnaHQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi5wcm92ZSAmJiAodDUucHJvdmUgPSBlMi5wcm92ZSksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSBwKCk7XG4gIHJldHVybiB0NS5kYXRhID0gZTIuZGF0YSA/PyBuZXcgVWludDhBcnJheSgpLCB0NS5wYXRoID0gZTIucGF0aCA/PyBcIlwiLCB0NS5oZWlnaHQgPSB2b2lkIDAgIT09IGUyLmhlaWdodCAmJiBudWxsICE9PSBlMi5oZWlnaHQgPyBCaWdJbnQoZTIuaGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB0NS5wcm92ZSA9IGUyLnByb3ZlID8/IGZhbHNlLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBSZXF1ZXN0UXVlcnkuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBSZXF1ZXN0UXVlcnkuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmFiY2kuUmVxdWVzdFF1ZXJ5XCIsIHZhbHVlOiBSZXF1ZXN0UXVlcnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gbSgpIHtcbiAgcmV0dXJuIHsgY29kZTogMCwgbG9nOiBcIlwiLCBpbmZvOiBcIlwiLCBpbmRleDogQmlnSW50KDApLCBrZXk6IG5ldyBVaW50OEFycmF5KCksIHZhbHVlOiBuZXcgVWludDhBcnJheSgpLCBwcm9vZk9wczogdm9pZCAwLCBoZWlnaHQ6IEJpZ0ludCgwKSwgY29kZXNwYWNlOiBcIlwiIH07XG59XG52YXIgUmVzcG9uc2VRdWVyeSA9IHsgdHlwZVVybDogXCIvdGVuZGVybWludC5hYmNpLlJlc3BvbnNlUXVlcnlcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoMCAhPT0gZTIuY29kZSAmJiBvMi51aW50MzIoOCkudWludDMyKGUyLmNvZGUpLCBcIlwiICE9PSBlMi5sb2cgJiYgbzIudWludDMyKDI2KS5zdHJpbmcoZTIubG9nKSwgXCJcIiAhPT0gZTIuaW5mbyAmJiBvMi51aW50MzIoMzQpLnN0cmluZyhlMi5pbmZvKSwgZTIuaW5kZXggIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoNDApLmludDY0KGUyLmluZGV4KSwgMCAhPT0gZTIua2V5Lmxlbmd0aCAmJiBvMi51aW50MzIoNTApLmJ5dGVzKGUyLmtleSksIDAgIT09IGUyLnZhbHVlLmxlbmd0aCAmJiBvMi51aW50MzIoNTgpLmJ5dGVzKGUyLnZhbHVlKSwgdm9pZCAwICE9PSBlMi5wcm9vZk9wcyAmJiBQcm9vZk9wcy5lbmNvZGUoZTIucHJvb2ZPcHMsIG8yLnVpbnQzMig2NikuZm9yaygpKS5sZGVsaW0oKSwgZTIuaGVpZ2h0ICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDcyKS5pbnQ2NChlMi5oZWlnaHQpLCBcIlwiICE9PSBlMi5jb2Rlc3BhY2UgJiYgbzIudWludDMyKDgyKS5zdHJpbmcoZTIuY29kZXNwYWNlKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IG4yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTMgPSB2b2lkIDAgPT09IG8yID8gbjIubGVuIDogbjIucG9zICsgbzI7XG4gIGNvbnN0IGEyID0gbSgpO1xuICBmb3IgKDsgbjIucG9zIDwgaTM7ICkge1xuICAgIGNvbnN0IGUzID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBhMi5jb2RlID0gbjIudWludDMyKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBhMi5sb2cgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGEyLmluZm8gPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDU6XG4gICAgICAgIGEyLmluZGV4ID0gbjIuaW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDY6XG4gICAgICAgIGEyLmtleSA9IG4yLmJ5dGVzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA3OlxuICAgICAgICBhMi52YWx1ZSA9IG4yLmJ5dGVzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA4OlxuICAgICAgICBhMi5wcm9vZk9wcyA9IFByb29mT3BzLmRlY29kZShuMiwgbjIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgOTpcbiAgICAgICAgYTIuaGVpZ2h0ID0gbjIuaW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDEwOlxuICAgICAgICBhMi5jb2Rlc3BhY2UgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBjb2RlOiBpc1NldChlMi5jb2RlKSA/IE51bWJlcihlMi5jb2RlKSA6IDAsIGxvZzogaXNTZXQoZTIubG9nKSA/IFN0cmluZyhlMi5sb2cpIDogXCJcIiwgaW5mbzogaXNTZXQoZTIuaW5mbykgPyBTdHJpbmcoZTIuaW5mbykgOiBcIlwiLCBpbmRleDogaXNTZXQoZTIuaW5kZXgpID8gQmlnSW50KGUyLmluZGV4LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBrZXk6IGlzU2V0KGUyLmtleSkgPyBkZWNvZGVCYXNlNjQoZTIua2V5KSA6IG5ldyBVaW50OEFycmF5KCksIHZhbHVlOiBpc1NldChlMi52YWx1ZSkgPyBkZWNvZGVCYXNlNjQoZTIudmFsdWUpIDogbmV3IFVpbnQ4QXJyYXkoKSwgcHJvb2ZPcHM6IGlzU2V0KGUyLnByb29mT3BzKSA/IFByb29mT3BzLmZyb21KU09OKGUyLnByb29mT3BzKSA6IHZvaWQgMCwgaGVpZ2h0OiBpc1NldChlMi5oZWlnaHQpID8gQmlnSW50KGUyLmhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgY29kZXNwYWNlOiBpc1NldChlMi5jb2Rlc3BhY2UpID8gU3RyaW5nKGUyLmNvZGVzcGFjZSkgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuY29kZSAmJiAobzIuY29kZSA9IE1hdGgucm91bmQoZTIuY29kZSkpLCB2b2lkIDAgIT09IGUyLmxvZyAmJiAobzIubG9nID0gZTIubG9nKSwgdm9pZCAwICE9PSBlMi5pbmZvICYmIChvMi5pbmZvID0gZTIuaW5mbyksIHZvaWQgMCAhPT0gZTIuaW5kZXggJiYgKG8yLmluZGV4ID0gKGUyLmluZGV4IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIua2V5ICYmIChvMi5rZXkgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSBlMi5rZXkgPyBlMi5rZXkgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gZTIudmFsdWUgJiYgKG8yLnZhbHVlID0gZW5jb2RlQmFzZTY0KHZvaWQgMCAhPT0gZTIudmFsdWUgPyBlMi52YWx1ZSA6IG5ldyBVaW50OEFycmF5KCkpKSwgdm9pZCAwICE9PSBlMi5wcm9vZk9wcyAmJiAobzIucHJvb2ZPcHMgPSBlMi5wcm9vZk9wcyA/IFByb29mT3BzLnRvSlNPTihlMi5wcm9vZk9wcykgOiB2b2lkIDApLCB2b2lkIDAgIT09IGUyLmhlaWdodCAmJiAobzIuaGVpZ2h0ID0gKGUyLmhlaWdodCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLmNvZGVzcGFjZSAmJiAobzIuY29kZXNwYWNlID0gZTIuY29kZXNwYWNlKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IG0oKTtcbiAgcmV0dXJuIG8yLmNvZGUgPSBlMi5jb2RlID8/IDAsIG8yLmxvZyA9IGUyLmxvZyA/PyBcIlwiLCBvMi5pbmZvID0gZTIuaW5mbyA/PyBcIlwiLCBvMi5pbmRleCA9IHZvaWQgMCAhPT0gZTIuaW5kZXggJiYgbnVsbCAhPT0gZTIuaW5kZXggPyBCaWdJbnQoZTIuaW5kZXgudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG8yLmtleSA9IGUyLmtleSA/PyBuZXcgVWludDhBcnJheSgpLCBvMi52YWx1ZSA9IGUyLnZhbHVlID8/IG5ldyBVaW50OEFycmF5KCksIG8yLnByb29mT3BzID0gdm9pZCAwICE9PSBlMi5wcm9vZk9wcyAmJiBudWxsICE9PSBlMi5wcm9vZk9wcyA/IFByb29mT3BzLmZyb21QYXJ0aWFsKGUyLnByb29mT3BzKSA6IHZvaWQgMCwgbzIuaGVpZ2h0ID0gdm9pZCAwICE9PSBlMi5oZWlnaHQgJiYgbnVsbCAhPT0gZTIuaGVpZ2h0ID8gQmlnSW50KGUyLmhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbzIuY29kZXNwYWNlID0gZTIuY29kZXNwYWNlID8/IFwiXCIsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFJlc3BvbnNlUXVlcnkuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBSZXNwb25zZVF1ZXJ5LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvdGVuZGVybWludC5hYmNpLlJlc3BvbnNlUXVlcnlcIiwgdmFsdWU6IFJlc3BvbnNlUXVlcnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIENvc21vc1F1ZXJ5ID0geyB0eXBlVXJsOiBcIi9pY3EudjEuQ29zbW9zUXVlcnlcIiwgZW5jb2RlKG8yLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IHI1IG9mIG8yLnJlcXVlc3RzKSBSZXF1ZXN0UXVlcnkuZW5jb2RlKHI1LCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB0NTtcbn0sIGRlY29kZShvMiwgcjUpIHtcbiAgY29uc3QgczMgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gcjUgPyBzMy5sZW4gOiBzMy5wb3MgKyByNTtcbiAgY29uc3QgYTIgPSB7IHJlcXVlc3RzOiBbXSB9O1xuICBmb3IgKDsgczMucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IG8zID0gczMudWludDMyKCk7XG4gICAgaWYgKG8zID4+PiAzID09IDEpIGEyLnJlcXVlc3RzLnB1c2goUmVxdWVzdFF1ZXJ5LmRlY29kZShzMywgczMudWludDMyKCkpKTtcbiAgICBlbHNlIHMzLnNraXBUeXBlKDcgJiBvMyk7XG4gIH1cbiAgcmV0dXJuIGEyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgcmVxdWVzdHM6IEFycmF5LmlzQXJyYXkobzI/LnJlcXVlc3RzKSA/IG8yLnJlcXVlc3RzLm1hcCgobzMpID0+IFJlcXVlc3RRdWVyeS5mcm9tSlNPTihvMykpIDogW10gfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gbzIucmVxdWVzdHMgPyB0NS5yZXF1ZXN0cyA9IG8yLnJlcXVlc3RzLm1hcCgobzMpID0+IG8zID8gUmVxdWVzdFF1ZXJ5LnRvSlNPTihvMykgOiB2b2lkIDApIDogdDUucmVxdWVzdHMgPSBbXSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgcmVxdWVzdHM6IFtdIH07XG4gIHJldHVybiB0NS5yZXF1ZXN0cyA9IG8yLnJlcXVlc3RzPy5tYXAoKG8zKSA9PiBSZXF1ZXN0UXVlcnkuZnJvbVBhcnRpYWwobzMpKSB8fCBbXSwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gQ29zbW9zUXVlcnkuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBDb3Ntb3NRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2ljcS52MS5Db3Ntb3NRdWVyeVwiLCB2YWx1ZTogQ29zbW9zUXVlcnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIENvc21vc1Jlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9pY3EudjEuQ29zbW9zUmVzcG9uc2VcIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IHI1IG9mIGUyLnJlc3BvbnNlcykgUmVzcG9uc2VRdWVyeS5lbmNvZGUocjUsIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHQ1O1xufSwgZGVjb2RlKGUyLCByNSkge1xuICBjb25zdCBzMyA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSByNSA/IHMzLmxlbiA6IHMzLnBvcyArIHI1O1xuICBjb25zdCBhMiA9IHsgcmVzcG9uc2VzOiBbXSB9O1xuICBmb3IgKDsgczMucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IGUzID0gczMudWludDMyKCk7XG4gICAgaWYgKGUzID4+PiAzID09IDEpIGEyLnJlc3BvbnNlcy5wdXNoKFJlc3BvbnNlUXVlcnkuZGVjb2RlKHMzLCBzMy51aW50MzIoKSkpO1xuICAgIGVsc2UgczMuc2tpcFR5cGUoNyAmIGUzKTtcbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyByZXNwb25zZXM6IEFycmF5LmlzQXJyYXkoZTI/LnJlc3BvbnNlcykgPyBlMi5yZXNwb25zZXMubWFwKChlMykgPT4gUmVzcG9uc2VRdWVyeS5mcm9tSlNPTihlMykpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gZTIucmVzcG9uc2VzID8gdDUucmVzcG9uc2VzID0gZTIucmVzcG9uc2VzLm1hcCgoZTMpID0+IGUzID8gUmVzcG9uc2VRdWVyeS50b0pTT04oZTMpIDogdm9pZCAwKSA6IHQ1LnJlc3BvbnNlcyA9IFtdLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0geyByZXNwb25zZXM6IFtdIH07XG4gIHJldHVybiB0NS5yZXNwb25zZXMgPSBlMi5yZXNwb25zZXM/Lm1hcCgoZTMpID0+IFJlc3BvbnNlUXVlcnkuZnJvbVBhcnRpYWwoZTMpKSB8fCBbXSwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gQ29zbW9zUmVzcG9uc2UuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBDb3Ntb3NSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2ljcS52MS5Db3Ntb3NSZXNwb25zZVwiLCB2YWx1ZTogQ29zbW9zUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIFR5cGU7XG4hZnVuY3Rpb24oZTIpIHtcbiAgZTJbZTIuVFlQRV9VTlNQRUNJRklFRCA9IDBdID0gXCJUWVBFX1VOU1BFQ0lGSUVEXCIsIGUyW2UyLlRZUEVfRVhFQ1VURV9UWCA9IDFdID0gXCJUWVBFX0VYRUNVVEVfVFhcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0oVHlwZSB8fCAoVHlwZSA9IHt9KSk7XG5cbi8vXG5mdW5jdGlvbiBtYWtlVHhQYWNrZXQobXNncywgb3B0cykge1xuICBjb25zdCBtZXNzYWdlcyA9IG1zZ3MubWFwKEFueS5mcm9tSlNPTik7XG4gIGNvbnN0IGJ5dGVzMiA9IFR4Qm9keS5lbmNvZGUoXG4gICAgVHhCb2R5LmZyb21QYXJ0aWFsKHtcbiAgICAgIG1lc3NhZ2VzLFxuICAgICAgLi4ub3B0c1xuICAgIH0pXG4gICkuZmluaXNoKCk7XG4gIHJldHVybiBKU09OLnN0cmluZ2lmeShcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAge1xuICAgICAgdHlwZTogVHlwZS5UWVBFX0VYRUNVVEVfVFgsXG4gICAgICBkYXRhOiBlbmNvZGVCYXNlNjQoYnl0ZXMyKSxcbiAgICAgIG1lbW86IFwiXCJcbiAgICB9XG4gICk7XG59XG5oYXJkZW4obWFrZVR4UGFja2V0KTtcbmZ1bmN0aW9uIG1ha2VRdWVyeVBhY2tldChtc2dzKSB7XG4gIGNvbnN0IGJ5dGVzMiA9IENvc21vc1F1ZXJ5LmVuY29kZShcbiAgICBDb3Ntb3NRdWVyeS5mcm9tUGFydGlhbCh7XG4gICAgICByZXF1ZXN0czogbXNncy5tYXAoUmVxdWVzdFF1ZXJ5LmZyb21KU09OKVxuICAgIH0pXG4gICkuZmluaXNoKCk7XG4gIHJldHVybiBKU09OLnN0cmluZ2lmeShcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHtcbiAgICAgIGRhdGE6IGVuY29kZUJhc2U2NChieXRlczIpLFxuICAgICAgbWVtbzogXCJcIlxuICAgIH1cbiAgKTtcbn1cbmhhcmRlbihtYWtlUXVlcnlQYWNrZXQpO1xuZnVuY3Rpb24gcGFyc2VUeFBhY2tldChyZXNwb25zZSkge1xuICBjb25zdCB7IHJlc3VsdCwgZXJyb3IgfSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuICBpZiAocmVzdWx0KSByZXR1cm4gcmVzdWx0O1xuICBlbHNlIGlmIChlcnJvcikgdGhyb3cgRXJyb3IoZXJyb3IpO1xuICBlbHNlIHRocm93IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQgZWl0aGVyIHJlc3VsdCBvciBlcnJvcjogJHtyZXNwb25zZX1gO1xufVxuaGFyZGVuKHBhcnNlVHhQYWNrZXQpO1xuZnVuY3Rpb24gcGFyc2VRdWVyeVBhY2tldChyZXNwb25zZSkge1xuICBjb25zdCByZXN1bHQgPSBwYXJzZVR4UGFja2V0KHJlc3BvbnNlKTtcbiAgY29uc3QgeyBkYXRhIH0gPSBKU09OLnBhcnNlKGF0b2IyKHJlc3VsdCkpO1xuICBjb25zdCB7IHJlc3BvbnNlcyA9IFtdIH0gPSBDb3Ntb3NSZXNwb25zZS5kZWNvZGUoZGVjb2RlQmFzZTY0KGRhdGEpKTtcbiAgcmV0dXJuIGhhcmRlbihyZXNwb25zZXMubWFwKFJlc3BvbnNlUXVlcnkudG9KU09OKSk7XG59XG5oYXJkZW4ocGFyc2VRdWVyeVBhY2tldCk7XG5cbi8vXG52YXIgdHJhY2UgPSBtYWtlVHJhY2VyKFwiSWNhQWNjb3VudEtpdFwiKTtcbnZhciBVTlBBUlNBQkxFX0NIQUlOX0FERFJFU1MgPSBcIlVOUEFSU0FCTEVfQ0hBSU5fQUREUkVTU1wiO1xudmFyIEljYUFjY291bnRJID0gTS5pbnRlcmZhY2UoXCJJY2FBY2NvdW50XCIsIHtcbiAgZ2V0QWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSksXG4gIGdldExvY2FsQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgZ2V0UmVtb3RlQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgZ2V0UG9ydDogTS5jYWxsKCkucmV0dXJucyhNLnJlbW90YWJsZShcIlBvcnRcIikpLFxuICBleGVjdXRlVHg6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoVm93U2hhcGUpLFxuICBleGVjdXRlRW5jb2RlZFR4OiBNLmNhbGwoTS5hcnJheU9mKFByb3RvM1NoYXBlKSkub3B0aW9uYWwoRXhlY3V0ZUlDQVR4T3B0c1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZGVhY3RpdmF0ZTogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIHJlYWN0aXZhdGU6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpXG59KTtcbnZhciBwcmVwYXJlSWNhQWNjb3VudEtpdCA9ICh6b25lLCB7IHdhdGNoLCBhc1ZvdyB9KSA9PiB6b25lLmV4b0NsYXNzS2l0KFxuICBcIkljYUFjY291bnRLaXRcIixcbiAge1xuICAgIGFjY291bnQ6IEljYUFjY291bnRJLFxuICAgIGNvbm5lY3Rpb25IYW5kbGVyOiBPdXRib3VuZENvbm5lY3Rpb25IYW5kbGVySSxcbiAgICBwYXJzZVR4UGFja2V0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQYXJzZVR4UGFja2V0V2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhNLnN0cmluZygpKVxuICAgIH0pXG4gIH0sXG4gIC8qXG5cblxuXG4gICAqL1xuICAoY2hhaW5JZCwgcG9ydCwgcmVxdWVzdGVkUmVtb3RlQWRkcmVzcykgPT4gKFxuICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAge1xuICAgICAgY2hhaW5JZCxcbiAgICAgIHBvcnQsXG4gICAgICBjb25uZWN0aW9uOiB2b2lkIDAsXG4gICAgICByZXF1ZXN0ZWRSZW1vdGVBZGRyZXNzLFxuICAgICAgcmVtb3RlQWRkcmVzczogdm9pZCAwLFxuICAgICAgY2hhaW5BZGRyZXNzOiB2b2lkIDAsXG4gICAgICBsb2NhbEFkZHJlc3M6IHZvaWQgMCxcbiAgICAgIGlzSW5pdGlhdGluZ0Nsb3NlOiBmYWxzZVxuICAgIH1cbiAgKSxcbiAge1xuICAgIHBhcnNlVHhQYWNrZXRXYXRjaGVyOiB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoYWNrKSB7XG4gICAgICAgIHJldHVybiBwYXJzZVR4UGFja2V0KGFjayk7XG4gICAgICB9XG4gICAgfSxcbiAgICBhY2NvdW50OiB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGdldEFkZHJlc3MoKSB7XG4gICAgICAgIHJldHVybiBOb25OdWxsaXNoKFxuICAgICAgICAgIHRoaXMuc3RhdGUuY2hhaW5BZGRyZXNzLFxuICAgICAgICAgIFwiSUNBIGNoYW5uZWwgY3JlYXRpb24gYWNrbm93bGVkZ2VtZW50IG5vdCB5ZXQgcmVjZWl2ZWQuXCJcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBnZXRMb2NhbEFkZHJlc3MoKSB7XG4gICAgICAgIHJldHVybiBOb25OdWxsaXNoKFxuICAgICAgICAgIHRoaXMuc3RhdGUubG9jYWxBZGRyZXNzLFxuICAgICAgICAgIFwibG9jYWwgYWRkcmVzcyBub3QgYXZhaWxhYmxlXCJcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBnZXRSZW1vdGVBZGRyZXNzKCkge1xuICAgICAgICByZXR1cm4gTm9uTnVsbGlzaChcbiAgICAgICAgICB0aGlzLnN0YXRlLnJlbW90ZUFkZHJlc3MsXG4gICAgICAgICAgXCJyZW1vdGUgYWRkcmVzcyBub3QgYXZhaWxhYmxlXCJcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBnZXRQb3J0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5wb3J0O1xuICAgICAgfSxcbiAgICAgIGV4ZWN1dGVUeCgpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHRocm93UmVkYWN0ZWRgbm90IHlldCBpbXBsZW1lbnRlZGApO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGV4ZWN1dGVFbmNvZGVkVHgobXNncywgb3B0cyA9IHt9KSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBjb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICghY29ubmVjdGlvbikge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBBY2NvdW50IG5vdCBhdmFpbGFibGUgb3IgZGVhY3RpdmF0ZWQuYDtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgeyBzZW5kT3B0cywgLi4udHhCb2R5T3B0cyB9ID0gb3B0cztcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKGNvbm5lY3Rpb24pLnNlbmQobWFrZVR4UGFja2V0KG1zZ3MsIHR4Qm9keU9wdHMpLCBzZW5kT3B0cyksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5wYXJzZVR4UGFja2V0V2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBkZWFjdGl2YXRlKCkge1xuICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgY29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoIWNvbm5lY3Rpb24pIHRocm93IHRocm93UmVkYWN0ZWRgQWNjb3VudCBub3QgYXZhaWxhYmxlIG9yIGRlYWN0aXZhdGVkLmA7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5pc0luaXRpYXRpbmdDbG9zZSA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuIEUoY29ubmVjdGlvbikuY2xvc2UoKTtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHJlYWN0aXZhdGUoKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBjb25uZWN0aW9uLCBwb3J0LCByZXF1ZXN0ZWRSZW1vdGVBZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChjb25uZWN0aW9uKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEFjY291bnQgaXMgYWxyZWFkeSBhY3RpdmUuYDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgRShwb3J0KS5jb25uZWN0KFxuICAgICAgICAgICAgICByZXF1ZXN0ZWRSZW1vdGVBZGRyZXNzLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5jb25uZWN0aW9uSGFuZGxlclxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgY29ubmVjdGlvbkhhbmRsZXI6IHtcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIG9uT3Blbihjb25uZWN0aW9uLCBsb2NhbEFkZHIsIHJlbW90ZUFkZHIpIHtcbiAgICAgICAgdHJhY2UoYElDQSBDaGFubmVsIE9wZW5lZCBmb3IgJHtsb2NhbEFkZHJ9IGF0ICR7cmVtb3RlQWRkcn1gKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcbiAgICAgICAgdGhpcy5zdGF0ZS5yZW1vdGVBZGRyZXNzID0gcmVtb3RlQWRkcjtcbiAgICAgICAgdGhpcy5zdGF0ZS5sb2NhbEFkZHJlc3MgPSBsb2NhbEFkZHI7XG4gICAgICAgIGNvbnN0IGFkZHJlc3MgPSBmaW5kQWRkcmVzc0ZpZWxkKHJlbW90ZUFkZHIpO1xuICAgICAgICBpZiAoIWFkZHJlc3MpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiXFx1MjZBMFxcdUZFMEYgZmFpbGVkIHRvIHBhcnNlIGNoYWluIGFkZHJlc3NcIiwgcmVtb3RlQWRkcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGF0ZS5jaGFpbkFkZHJlc3MgPSBoYXJkZW4oe1xuICAgICAgICAgIHZhbHVlOiBhZGRyZXNzIHx8IFVOUEFSU0FCTEVfQ0hBSU5fQUREUkVTUyxcbiAgICAgICAgICBjaGFpbklkOiB0aGlzLnN0YXRlLmNoYWluSWQsXG4gICAgICAgICAgZW5jb2Rpbmc6IFwiYmVjaDMyXCJcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgYXN5bmMgb25DbG9zZShfY29ubmVjdGlvbiwgcmVhc29uKSB7XG4gICAgICAgIHRyYWNlKGBJQ0EgQ2hhbm5lbCBjbG9zZWQuIFJlYXNvbjogJHtyZWFzb259YCk7XG4gICAgICAgIHRoaXMuc3RhdGUuY29ubmVjdGlvbiA9IHZvaWQgMDtcbiAgICAgICAgdGhpcy5zdGF0ZS5sb2NhbEFkZHJlc3MgPSB2b2lkIDA7XG4gICAgICAgIHRoaXMuc3RhdGUucmVtb3RlQWRkcmVzcyA9IHZvaWQgMDtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaXNJbml0aWF0aW5nQ2xvc2UgPT09IHRydWUpIHtcbiAgICAgICAgICB0cmFjZShcIkFjY291bnQgZGVhY3RpdmF0ZWQgYnkgaG9sZGVyLiBTa2lwcGluZyByZWFjdGl2YXRpb24uXCIpO1xuICAgICAgICAgIHRoaXMuc3RhdGUuaXNJbml0aWF0aW5nQ2xvc2UgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0cmFjZShcIkFjY291bnQgY2xvc2VkIHVuZXhwZWN0ZWRseS4gQXV0b21hdGljYWxseSByZWFjdGl2YXRpbmcuXCIpO1xuICAgICAgICAgIHZvaWQgd2F0Y2godGhpcy5mYWNldHMuYWNjb3VudC5yZWFjdGl2YXRlKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4pO1xuXG4vL1xudmFyIHRyYWNlMiA9IG1ha2VUcmFjZXIoXCJPcmNoZXN0cmF0aW9uOklDUUNvbm5lY3Rpb25cIik7XG52YXIgSUNRQ29ubmVjdGlvbkkgPSBNLmludGVyZmFjZShcIklDUUNvbm5lY3Rpb25cIiwge1xuICBnZXRMb2NhbEFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIGdldFJlbW90ZUFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIHF1ZXJ5OiBNLmNhbGwoTS5hcnJheU9mKElDUU1zZ1NoYXBlKSkucmV0dXJucyhWb3dTaGFwZSlcbn0pO1xudmFyIHByZXBhcmVJQ1FDb25uZWN0aW9uS2l0ID0gKHpvbmUsIHsgd2F0Y2gsIGFzVm93IH0pID0+IHpvbmUuZXhvQ2xhc3NLaXQoXG4gIFwiSUNRQ29ubmVjdGlvbktpdFwiLFxuICB7XG4gICAgY29ubmVjdGlvbjogSUNRQ29ubmVjdGlvbkksXG4gICAgY29ubmVjdGlvbkhhbmRsZXI6IE91dGJvdW5kQ29ubmVjdGlvbkhhbmRsZXJJLFxuICAgIHBhcnNlUXVlcnlQYWNrZXRXYXRjaGVyOiBNLmludGVyZmFjZShcIlBhcnNlUXVlcnlQYWNrZXRXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKE0uYXJyYXlPZihNLnJlY29yZCgpKSlcbiAgICB9KVxuICB9LFxuICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gIChwb3J0KSA9PiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAge1xuICAgICAgcG9ydCxcbiAgICAgIGNvbm5lY3Rpb246IHZvaWQgMCxcbiAgICAgIHJlbW90ZUFkZHJlc3M6IHZvaWQgMCxcbiAgICAgIGxvY2FsQWRkcmVzczogdm9pZCAwXG4gICAgfVxuICApLFxuICB7XG4gICAgY29ubmVjdGlvbjoge1xuICAgICAgZ2V0TG9jYWxBZGRyZXNzKCkge1xuICAgICAgICByZXR1cm4gTm9uTnVsbGlzaChcbiAgICAgICAgICB0aGlzLnN0YXRlLmxvY2FsQWRkcmVzcyxcbiAgICAgICAgICBcImxvY2FsIGFkZHJlc3Mgbm90IGF2YWlsYWJsZVwiXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgZ2V0UmVtb3RlQWRkcmVzcygpIHtcbiAgICAgICAgcmV0dXJuIE5vbk51bGxpc2goXG4gICAgICAgICAgdGhpcy5zdGF0ZS5yZW1vdGVBZGRyZXNzLFxuICAgICAgICAgIFwicmVtb3RlIGFkZHJlc3Mgbm90IGF2YWlsYWJsZVwiXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuICAgICAgICovXG4gICAgICBxdWVyeShtc2dzKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBjb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICghY29ubmVjdGlvbikgdGhyb3cgdGhyb3dSZWRhY3RlZGBjb25uZWN0aW9uIG5vdCBhdmFpbGFibGVgO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUoY29ubmVjdGlvbikuc2VuZChtYWtlUXVlcnlQYWNrZXQobXNncykpLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMucGFyc2VRdWVyeVBhY2tldFdhdGNoZXJcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHBhcnNlUXVlcnlQYWNrZXRXYXRjaGVyOiB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoYWNrKSB7XG4gICAgICAgIHJldHVybiBwYXJzZVF1ZXJ5UGFja2V0KGFjayk7XG4gICAgICB9XG4gICAgfSxcbiAgICBjb25uZWN0aW9uSGFuZGxlcjoge1xuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgYXN5bmMgb25PcGVuKGNvbm5lY3Rpb24sIGxvY2FsQWRkciwgcmVtb3RlQWRkcikge1xuICAgICAgICB0cmFjZTIoYElDUSBDaGFubmVsIE9wZW5lZCBmb3IgJHtsb2NhbEFkZHJ9IGF0ICR7cmVtb3RlQWRkcn1gKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcbiAgICAgICAgdGhpcy5zdGF0ZS5yZW1vdGVBZGRyZXNzID0gcmVtb3RlQWRkcjtcbiAgICAgICAgdGhpcy5zdGF0ZS5sb2NhbEFkZHJlc3MgPSBsb2NhbEFkZHI7XG4gICAgICB9LFxuICAgICAgYXN5bmMgb25DbG9zZShfY29ubmVjdGlvbiwgcmVhc29uKSB7XG4gICAgICAgIHRyYWNlMihgSUNRIENoYW5uZWwgY2xvc2VkLiBSZWFzb246ICR7cmVhc29ufWApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuKTtcblxuLy9cbnZhciB7IFZvdyQgfSA9IFNoYXBlO1xudmFyIGdldElDUUNvbm5lY3Rpb25LZXkgPSAoY29udHJvbGxlckNvbm5lY3Rpb25JZCwgdmVyc2lvbikgPT4ge1xuICByZXR1cm4gYCR7Y29udHJvbGxlckNvbm5lY3Rpb25JZH06JHt2ZXJzaW9uIHx8IERFRkFVTFRfSUNRX1ZFUlNJT059YDtcbn07XG52YXIgcHJlcGFyZUNvc21vc09yY2hlc3RyYXRpb25TZXJ2aWNlS2l0ID0gKHpvbmUsIHsgd2F0Y2gsIGFzVm93IH0sIG1ha2VJY2FBY2NvdW50S2l0LCBtYWtlSUNRQ29ubmVjdGlvbktpdCkgPT4gem9uZS5leG9DbGFzc0tpdChcbiAgXCJPcmNoZXN0cmF0aW9uXCIsXG4gIHtcbiAgICByZXF1ZXN0SUNBQ2hhbm5lbFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUmVxdWVzdElDQUNoYW5uZWxXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5yZW1vdGFibGUoXCJQb3J0XCIpKS5vcHRpb25hbCh7IGNoYWluSWQ6IE0uc3RyaW5nKCksIHJlbW90ZUNvbm5BZGRyOiBNLnN0cmluZygpIH0pLnJldHVybnMoVm93JChTaGFwZS5Db25uZWN0aW9uKSlcbiAgICB9KSxcbiAgICByZXF1ZXN0SUNRQ2hhbm5lbFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUmVxdWVzdElDUUNoYW5uZWxXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5yZW1vdGFibGUoXCJQb3J0XCIpKS5vcHRpb25hbCh7XG4gICAgICAgIHJlbW90ZUNvbm5BZGRyOiBNLnN0cmluZygpLFxuICAgICAgICBpY3FMb29rdXBLZXk6IE0uc3RyaW5nKClcbiAgICAgIH0pLnJldHVybnMoVm93JChTaGFwZS5Db25uZWN0aW9uKSlcbiAgICB9KSxcbiAgICBjaGFubmVsT3BlbldhdGNoZXI6IE0uaW50ZXJmYWNlKFwiQ2hhbm5lbE9wZW5XYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5yZW1vdGFibGUoXCJDb25uZWN0aW9uXCIpKS5vcHRpb25hbChcbiAgICAgICAgTS5zcGxpdFJlY29yZChcbiAgICAgICAgICB7IGNvbm5lY3Rpb25LaXQ6IE0ucmVjb3JkKCksIHJldHVybkZhY2V0OiBNLnN0cmluZygpIH0sXG4gICAgICAgICAgeyBpY3FMb29rdXBLZXk6IE0uc3RyaW5nKCkgfVxuICAgICAgICApXG4gICAgICApLnJldHVybnMoTS5yZW1vdGFibGUoXCJDb25uZWN0aW9uS2l0IEhvbGRlciBmYWNldFwiKSlcbiAgICB9KSxcbiAgICBwdWJsaWM6IE0uaW50ZXJmYWNlKFwiQ29zbW9zSW50ZXJjaGFpblNlcnZpY2VcIiwge1xuICAgICAgbWFrZUFjY291bnQ6IE0uY2FsbChNLnN0cmluZygpLCBNLnN0cmluZygpLCBNLnN0cmluZygpKS5vcHRpb25hbChNLnJlY29yZCgpKS5yZXR1cm5zKFZvdyQoTS5yZW1vdGFibGUoXCJJY2FBY2NvdW50S2l0XCIpKSksXG4gICAgICBwcm92aWRlSUNRQ29ubmVjdGlvbjogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoVm93JChNLnJlbW90YWJsZShcIklDUUNvbm5lY3Rpb25cIikpKVxuICAgIH0pXG4gIH0sXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAocG93ZXJzKSA9PiB7XG4gICAgbXVzdE1hdGNoKHBvd2Vycz8ucG9ydEFsbG9jYXRvciwgTS5yZW1vdGFibGUoXCJQb3J0QWxsb2NhdG9yXCIpKTtcbiAgICBjb25zdCBpY3FDb25uZWN0aW9ucyA9IHpvbmUuZGV0YWNoZWQoKS5tYXBTdG9yZShcIklDUUNvbm5lY3Rpb25zXCIpO1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHtcbiAgICAgICAgaWNxQ29ubmVjdGlvbnMsXG4gICAgICAgIHNoYXJlZElDUVBvcnQ6IHZvaWQgMCxcbiAgICAgICAgcmVzZXJ2ZWQ6IHZvaWQgMCxcbiAgICAgICAgLi4ucG93ZXJzXG4gICAgICB9XG4gICAgKTtcbiAgfSxcbiAge1xuICAgIHJlcXVlc3RJQ0FDaGFubmVsV2F0Y2hlcjoge1xuICAgICAgLypcblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKHBvcnQsIHsgY2hhaW5JZCwgcmVtb3RlQ29ubkFkZHIgfSkge1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uS2l0ID0gbWFrZUljYUFjY291bnRLaXQoXG4gICAgICAgICAgY2hhaW5JZCxcbiAgICAgICAgICBwb3J0LFxuICAgICAgICAgIHJlbW90ZUNvbm5BZGRyXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICBFKHBvcnQpLmNvbm5lY3QocmVtb3RlQ29ubkFkZHIsIGNvbm5lY3Rpb25LaXQuY29ubmVjdGlvbkhhbmRsZXIpLFxuICAgICAgICAgIHRoaXMuZmFjZXRzLmNoYW5uZWxPcGVuV2F0Y2hlcixcbiAgICAgICAgICB7IHJldHVybkZhY2V0OiBcImFjY291bnRcIiwgY29ubmVjdGlvbktpdCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcbiAgICByZXF1ZXN0SUNRQ2hhbm5lbFdhdGNoZXI6IHtcbiAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChwb3J0LCB7IHJlbW90ZUNvbm5BZGRyLCBpY3FMb29rdXBLZXkgfSkge1xuICAgICAgICBpZiAoIXRoaXMuc3RhdGUuc2hhcmVkSUNRUG9ydCkge1xuICAgICAgICAgIHRoaXMuc3RhdGUuc2hhcmVkSUNRUG9ydCA9IHBvcnQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29ubmVjdGlvbktpdCA9IG1ha2VJQ1FDb25uZWN0aW9uS2l0KHBvcnQpO1xuICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgRShwb3J0KS5jb25uZWN0KHJlbW90ZUNvbm5BZGRyLCBjb25uZWN0aW9uS2l0LmNvbm5lY3Rpb25IYW5kbGVyKSxcbiAgICAgICAgICB0aGlzLmZhY2V0cy5jaGFubmVsT3BlbldhdGNoZXIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgY29ubmVjdGlvbktpdCxcbiAgICAgICAgICAgIHJldHVybkZhY2V0OiBcImNvbm5lY3Rpb25cIixcbiAgICAgICAgICAgIGljcUxvb2t1cEtleVxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qXG5cblxuXG4gICAgICovXG4gICAgY2hhbm5lbE9wZW5XYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChfY29ubmVjdGlvbiwgeyBjb25uZWN0aW9uS2l0LCByZXR1cm5GYWNldCwgaWNxTG9va3VwS2V5IH0pIHtcbiAgICAgICAgaWYgKGljcUxvb2t1cEtleSkge1xuICAgICAgICAgIHRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbnMuaW5pdChcbiAgICAgICAgICAgIGljcUxvb2t1cEtleSxcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGNvbm5lY3Rpb25LaXRcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb25uZWN0aW9uS2l0W3JldHVybkZhY2V0XTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHB1YmxpYzoge1xuICAgICAgLypcblxuXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG1ha2VBY2NvdW50KGNoYWluSWQsIGhvc3RDb25uZWN0aW9uSWQsIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsIG9wdHMpIHtcbiAgICAgICAgY29uc3QgcmVtb3RlQ29ubkFkZHIgPSBtYWtlSUNBQ2hhbm5lbEFkZHJlc3MoXG4gICAgICAgICAgaG9zdENvbm5lY3Rpb25JZCxcbiAgICAgICAgICBjb250cm9sbGVyQ29ubmVjdGlvbklkLFxuICAgICAgICAgIG9wdHNcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgeyBwb3J0QWxsb2NhdG9yIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgRShwb3J0QWxsb2NhdG9yKS5hbGxvY2F0ZUlDQUNvbnRyb2xsZXJQb3J0KCksXG4gICAgICAgICAgdGhpcy5mYWNldHMucmVxdWVzdElDQUNoYW5uZWxXYXRjaGVyLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGNoYWluSWQsXG4gICAgICAgICAgICByZW1vdGVDb25uQWRkclxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHByb3ZpZGVJQ1FDb25uZWN0aW9uKGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsIHZlcnNpb24pIHtcbiAgICAgICAgY29uc3QgaWNxTG9va3VwS2V5ID0gZ2V0SUNRQ29ubmVjdGlvbktleShcbiAgICAgICAgICBjb250cm9sbGVyQ29ubmVjdGlvbklkLFxuICAgICAgICAgIHZlcnNpb25cbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbnMuaGFzKGljcUxvb2t1cEtleSkpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coXG4gICAgICAgICAgICAoKSA9PiB0aGlzLnN0YXRlLmljcUNvbm5lY3Rpb25zLmdldChpY3FMb29rdXBLZXkpLmNvbm5lY3Rpb25cbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlbW90ZUNvbm5BZGRyID0gbWFrZUlDUUNoYW5uZWxBZGRyZXNzKFxuICAgICAgICAgIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsXG4gICAgICAgICAgdmVyc2lvblxuICAgICAgICApO1xuICAgICAgICBjb25zdCB7IHBvcnRBbGxvY2F0b3IsIHNoYXJlZElDUVBvcnQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHBvcnRPclBvcnRWb3cgPSBzaGFyZWRJQ1FQb3J0IHx8IEUocG9ydEFsbG9jYXRvcikuYWxsb2NhdGVJQ1FDb250cm9sbGVyUG9ydCgpO1xuICAgICAgICByZXR1cm4gd2F0Y2gocG9ydE9yUG9ydFZvdywgdGhpcy5mYWNldHMucmVxdWVzdElDUUNoYW5uZWxXYXRjaGVyLCB7XG4gICAgICAgICAgcmVtb3RlQ29ubkFkZHIsXG4gICAgICAgICAgaWNxTG9va3VwS2V5XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAge1xuICAgIHN0YXRlU2hhcGU6IHtcbiAgICAgIGljcUNvbm5lY3Rpb25zOiBNLnJlbW90YWJsZShcImljcUNvbm5lY3Rpb25zIG1hcFN0b3JlXCIpLFxuICAgICAgc2hhcmVkSUNRUG9ydDogTS5vcihNLnJlbW90YWJsZShcIlBvcnRcIiksIE0udW5kZWZpbmVkKCkpLFxuICAgICAgcG9ydEFsbG9jYXRvcjogTS5yZW1vdGFibGUoXCJQb3J0QWxsb2NhdG9yXCIpLFxuICAgICAgcmVzZXJ2ZWQ6IE0uYW55KClcbiAgICB9XG4gIH1cbik7XG52YXIgcHJlcGFyZUNvc21vc0ludGVyY2hhaW5TZXJ2aWNlID0gKHpvbmUsIHZvd1Rvb2xzKSA9PiB7XG4gIGNvbnN0IG1ha2VJY2FBY2NvdW50S2l0ID0gcHJlcGFyZUljYUFjY291bnRLaXQoem9uZSwgdm93VG9vbHMpO1xuICBjb25zdCBtYWtlSUNRQ29ubmVjdGlvbktpdCA9IHByZXBhcmVJQ1FDb25uZWN0aW9uS2l0KHpvbmUsIHZvd1Rvb2xzKTtcbiAgY29uc3QgbWFrZUNvc21vc09yY2hlc3RyYXRpb25TZXJ2aWNlS2l0ID0gcHJlcGFyZUNvc21vc09yY2hlc3RyYXRpb25TZXJ2aWNlS2l0KFxuICAgIHpvbmUsXG4gICAgdm93VG9vbHMsXG4gICAgbWFrZUljYUFjY291bnRLaXQsXG4gICAgbWFrZUlDUUNvbm5lY3Rpb25LaXRcbiAgKTtcbiAgY29uc3QgbWFrZUNvc21vc0ludGVyY2hhaW5TZXJ2aWNlID0gcGlja0ZhY2V0KFxuICAgIG1ha2VDb3Ntb3NPcmNoZXN0cmF0aW9uU2VydmljZUtpdCxcbiAgICBcInB1YmxpY1wiXG4gICk7XG4gIHJldHVybiBtYWtlQ29zbW9zSW50ZXJjaGFpblNlcnZpY2U7XG59O1xuaGFyZGVuKHByZXBhcmVDb3Ntb3NJbnRlcmNoYWluU2VydmljZSk7XG5cbi8vXG52YXIgbWFrZUNvbnZlcnQgPSAoY29udmVydFJlbW90YWJsZSwgY29udmVydFByb21pc2VPclZvdywgY29udmVydEVycm9yKSA9PiB7XG4gIGNvbnN0IGNvbnZlcnRSZWN1ciA9IChzcGVjaW1lbiwgbGFiZWwpID0+IHtcbiAgICBpZiAobGFiZWwgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGlubmVyQ29udmVydChzcGVjaW1lbik7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gaW5uZXJDb252ZXJ0KHNwZWNpbWVuKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRocm93TGFiZWxlZChlcnIsIGxhYmVsKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGlubmVyQ29udmVydCA9IChzcGVjaW1lbikgPT4ge1xuICAgIGlmIChpc1ByaW1pdGl2ZTIoc3BlY2ltZW4pKSB7XG4gICAgICByZXR1cm4gc3BlY2ltZW47XG4gICAgfVxuICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHNwZWNpbWVuKTtcbiAgICBzd2l0Y2ggKHBhc3NTdHlsZSkge1xuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIHJldHVybiBzcGVjaW1lbi5tYXAoKGVsZW1lbnQsIGkzKSA9PiBjb252ZXJ0UmVjdXIoZWxlbWVudCwgaTMpKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgcmV0dXJuIG9iamVjdE1hcChzcGVjaW1lbiwgKHZhbHVlLCBuYW1lKSA9PiBjb252ZXJ0UmVjdXIodmFsdWUsIG5hbWUpKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICBpZiAoaXNWb3coc3BlY2ltZW4pKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnZlcnRQcm9taXNlT3JWb3coc3BlY2ltZW4pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRhZyA9IGdldFRhZyhzcGVjaW1lbik7XG4gICAgICAgIGNvbnN0IHsgcGF5bG9hZCB9ID0gc3BlY2ltZW47XG4gICAgICAgIHJldHVybiBtYWtlVGFnZ2VkKHRhZywgY29udmVydFJlY3VyKHBheWxvYWQsIGAke3RhZ30gcGF5bG9hZGApKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgIHJldHVybiBjb252ZXJ0RXJyb3Ioc3BlY2ltZW4pO1xuICAgICAgfVxuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIHJldHVybiBjb252ZXJ0UmVtb3RhYmxlKHNwZWNpbWVuKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgcmV0dXJuIGNvbnZlcnRQcm9taXNlT3JWb3coc3BlY2ltZW4pO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgcGFzc1N0eWxlICR7cXVvdGUocGFzc1N0eWxlKX1gO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgY29udmVydCA9IChzcGVjaW1lbiwgbGFiZWwgPSB2b2lkIDApID0+IGNvbnZlcnRSZWN1cihoYXJkZW4oc3BlY2ltZW4pLCBsYWJlbCk7XG4gIHJldHVybiBoYXJkZW4oY29udmVydCk7XG59O1xudmFyIG1ha2VDb252ZXJ0S2l0ID0gKGJpamVjdGlvbiwgbWFrZUd1ZXN0Rm9ySG9zdFJlbW90YWJsZSwgbWFrZUd1ZXN0Rm9ySG9zdFZvdykgPT4ge1xuICBjb25zdCBndWVzdFRvSG9zdCA9IG1ha2VDb252ZXJ0KFxuICAgIChnUmVtKSA9PiB7XG4gICAgICBpZiAoYmlqZWN0aW9uLmhhc0d1ZXN0KGdSZW0pKSB7XG4gICAgICAgIHJldHVybiBiaWplY3Rpb24uZ3Vlc3RUb0hvc3QoZ1JlbSk7XG4gICAgICB9XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGNhbm5vdCB5ZXQgc2VuZCBndWVzdCByZW1vdGFibGVzICR7Z1JlbX1gO1xuICAgIH0sXG4gICAgKGdQcm9tKSA9PiB7XG4gICAgICBpZiAoYmlqZWN0aW9uLmhhc0d1ZXN0KGdQcm9tKSkge1xuICAgICAgICByZXR1cm4gYmlqZWN0aW9uLmd1ZXN0VG9Ib3N0KGdQcm9tKTtcbiAgICAgIH1cbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgY2Fubm90IHlldCBzZW5kIGd1ZXN0IHByb21pc2VzICR7Z1Byb219YDtcbiAgICB9LFxuICAgIChnRXJyKSA9PiB7XG4gICAgICBjb25zdCBoRXJyID0gaGFyZGVuKFxuICAgICAgICBtYWtlRXJyb3IoZ0Vyci5tZXNzYWdlLCBnZXRFcnJvckNvbnN0cnVjdG9yKGdFcnIubmFtZSkpXG4gICAgICApO1xuICAgICAgbm90ZShoRXJyLCByZWRhY3RlZGBmcm9tIGd1ZXN0IGVycm9yICR7Z0Vycn1gKTtcbiAgICAgIHJldHVybiBoRXJyO1xuICAgIH1cbiAgKTtcbiAgY29uc3QgaG9zdFRvR3Vlc3QgPSBtYWtlQ29udmVydChcbiAgICAoaFJlbSkgPT4ge1xuICAgICAgaWYgKGJpamVjdGlvbi5oYXNIb3N0KGhSZW0pKSB7XG4gICAgICAgIHJldHVybiBiaWplY3Rpb24uaG9zdFRvR3Vlc3QoaFJlbSk7XG4gICAgICB9XG4gICAgICBjb25zdCBnUmVtID0gbWFrZUd1ZXN0Rm9ySG9zdFJlbW90YWJsZShoUmVtKTtcbiAgICAgIHJldHVybiBiaWplY3Rpb24udW53cmFwSW5pdChnUmVtLCBoUmVtKTtcbiAgICB9LFxuICAgIChoVm93KSA9PiB7XG4gICAgICBpZiAoYmlqZWN0aW9uLmhhc0hvc3QoaFZvdykpIHtcbiAgICAgICAgcmV0dXJuIGJpamVjdGlvbi5ob3N0VG9HdWVzdChoVm93KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGdQID0gbWFrZUd1ZXN0Rm9ySG9zdFZvdyhoVm93KTtcbiAgICAgIHJldHVybiBiaWplY3Rpb24udW53cmFwSW5pdChnUCwgaFZvdyk7XG4gICAgfSxcbiAgICAoaEVycikgPT4ge1xuICAgICAgY29uc3QgZ0VyciA9IGhhcmRlbihcbiAgICAgICAgbWFrZUVycm9yKGhFcnIubWVzc2FnZSwgZ2V0RXJyb3JDb25zdHJ1Y3RvcihoRXJyLm5hbWUpKVxuICAgICAgKTtcbiAgICAgIG5vdGUoZ0VyciwgcmVkYWN0ZWRgZnJvbSBob3N0IGVycm9yICR7aEVycn1gKTtcbiAgICAgIHJldHVybiBnRXJyO1xuICAgIH1cbiAgKTtcbiAgcmV0dXJuIGhhcmRlbih7IGd1ZXN0VG9Ib3N0LCBob3N0VG9HdWVzdCB9KTtcbn07XG5oYXJkZW4obWFrZUNvbnZlcnRLaXQpO1xuXG4vL1xudmFyIHsgaXM6IGlzNSB9ID0gT2JqZWN0O1xudmFyIG1ha2VFcXVhdGUgPSAoYmlqZWN0aW9uKSA9PiB7XG4gIGNvbnN0IGVxdWF0ZSA9IChnMywgaCwgbGFiZWwpID0+IHtcbiAgICBpZiAobGFiZWwgPT09IHZvaWQgMCkge1xuICAgICAgaW5uZXJFcXVhdGUoZzMsIGgpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgaW5uZXJFcXVhdGUoZzMsIGgpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdGhyb3dMYWJlbGVkKGVyciwgbGFiZWwpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgaW5uZXJFcXVhdGUgPSAoZzMsIGgpID0+IHtcbiAgICBpZiAoaXNQcmltaXRpdmUyKGczKSkge1xuICAgICAgaXM1KGczLCBoKSB8fCAvL1xuICAgICAgdGhyb3dSZWRhY3RlZGB1bmVxdWFsICR7ZzN9IHZzICR7aH1gO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoYmlqZWN0aW9uLmhhc0d1ZXN0KGczKSAmJiBiaWplY3Rpb24uZ3Vlc3RUb0hvc3QoZzMpID09PSBoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGdQYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihnMyk7XG4gICAgaWYgKGdQYXNzU3R5bGUgPT09IFwicHJvbWlzZVwiICYmIGlzVm93KGgpKSB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGd1ZXN0IHByb21pc2VzIG5vdCB5ZXQgcGFzc2FibGVgO1xuICAgIH1cbiAgICBjb25zdCBoUGFzc1N0eWxlID0gcGFzc1N0eWxlT2YoaCk7XG4gICAgZ1Bhc3NTdHlsZSA9PT0gaFBhc3NTdHlsZSB8fCB0aHJvd1JlZGFjdGVkYHVuZXF1YWwgcGFzc1N0eWxlcyAke3F1b3RlKGdQYXNzU3R5bGUpfSB2cyAke3F1b3RlKGhQYXNzU3R5bGUpfWA7XG4gICAgc3dpdGNoIChnUGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgZXF1YXRlKGczLmxlbmd0aCwgaC5sZW5ndGgsIFwibGVuZ3RoXCIpO1xuICAgICAgICBnMy5mb3JFYWNoKChnRWwsIGkzKSA9PiBlcXVhdGUoZ0VsLCBoW2kzXSwgaTMpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICBjb25zdCBnTmFtZXMgPSByZWNvcmROYW1lcyhnMyk7XG4gICAgICAgIGNvbnN0IGhOYW1lcyA9IHJlY29yZE5hbWVzKGgpO1xuICAgICAgICBlcXVhdGUoZ05hbWVzLCBoTmFtZXMsIFwicHJvcGVydHlOYW1lc1wiKTtcbiAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIGdOYW1lcykge1xuICAgICAgICAgIGVxdWF0ZShnM1tuYW1lXSwgaFtuYW1lXSwgbmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgIGVxdWF0ZShnZXRUYWcoZzMpLCBnZXRUYWcoaCksIFwidGFnXCIpO1xuICAgICAgICBlcXVhdGUoZzMucGF5bG9hZCwgaC5wYXlsb2FkLCBcInBheWxvYWRcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgIGVxdWF0ZShnMy5uYW1lLCBoLm5hbWUsIFwiZXJyb3IgbmFtZVwiKTtcbiAgICAgICAgbm90ZShnMywgcmVkYWN0ZWRgcmVwbGF5IG9mIGVycm9yICR7aH1gKTtcbiAgICAgICAgbm90ZShoLCByZWRhY3RlZGByZXBsYXllZCBhcyBlcnJvciAke2czfWApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBjYW5ub3QgeWV0IHNlbmQgZ3Vlc3QgcmVtb3RhYmxlcyB0byBob3N0ICR7ZzN9IHZzICR7aH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGNhbm5vdCB5ZXQgc2VuZCBndWVzdCBwcm9taXNlcyB0byBob3N0ICR7ZzN9IHZzICR7aH1gO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgcGFzc1N0eWxlICR7cXVvdGUoZ1Bhc3NTdHlsZSl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiBoYXJkZW4oZXF1YXRlKTtcbn07XG5oYXJkZW4obWFrZUVxdWF0ZSk7XG5cbi8vXG52YXIgeyBmcm9tRW50cmllczogZnJvbUVudHJpZXMxMywgZGVmaW5lUHJvcGVydGllczogZGVmaW5lUHJvcGVydGllczUsIGFzc2lnbjogYXNzaWduMyB9ID0gT2JqZWN0O1xudmFyIG1ha2VSZXBsYXlNZW1icmFuZSA9IChhcmcpID0+IHtcbiAgY29uc3Qgbm9EdW5kZXJBcmcgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgIE9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyhhcmcpLmZpbHRlcigoW2tdKSA9PiAhay5zdGFydHNXaXRoKFwiX19cIikpKVxuICApO1xuICByZXR1cm4gbWFrZVJlcGxheU1lbWJyYW5lRm9yVGVzdGluZyhub0R1bmRlckFyZyk7XG59O1xudmFyIG1ha2VSZXBsYXlNZW1icmFuZUZvclRlc3RpbmcgPSAoe1xuICBsb2csXG4gIGJpamVjdGlvbixcbiAgdm93VG9vbHMsXG4gIHdhdGNoV2FrZSxcbiAgcGFuaWMsXG4gIF9fZXZlbnR1YWxTZW5kRm9yVGVzdGluZ1xufSkgPT4ge1xuICBjb25zdCB7IHdoZW4sIG1ha2VWb3dLaXQgfSA9IHZvd1Rvb2xzO1xuICBjb25zdCBlcXVhdGUgPSBtYWtlRXF1YXRlKGJpamVjdGlvbik7XG4gIGNvbnN0IGd1ZXN0UHJvbWlzZU1hcCA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBsZXQgc3RvcHBlZCA9IGZhbHNlO1xuICBjb25zdCBQYW5pYyA9ICh0ZW1wbGF0ZSwgLi4uYXJncykgPT4gcGFuaWMobWFrZUVycm9yKHJlZGFjdGVkKHRlbXBsYXRlLCAuLi5hcmdzKSkpO1xuICBjb25zdCBzdGFydEdlbmVyYXRpb24gPSAoZ2VuZXJhdGlvbikgPT4ge1xuICAgIE51bWJlci5pc1NhZmVJbnRlZ2VyKGdlbmVyYXRpb24pIHx8IHRocm93UmVkYWN0ZWRgZ2VuZXJhdGlvbiBleHBlY3RlZCBpbnRlZ2VyOyBnb3QgJHtnZW5lcmF0aW9ufWA7XG4gICAgZ2VuZXJhdGlvbiA+PSAwIHx8IHRocm93UmVkYWN0ZWRgZ2VuZXJhdGlvbiBleHBlY3RlZCBub24tbmVnYXRpdmU7IGdvdCAke2dlbmVyYXRpb259YDtcbiAgfTtcbiAgY29uc3QgZG9GdWxmaWxsID0gKGhvc3RWb3csIGhvc3RGdWxmaWxsbWVudCkgPT4ge1xuICAgIGNvbnN0IGd1ZXN0UHJvbWlzZSA9IGhvc3RUb0d1ZXN0KGhvc3RWb3cpO1xuICAgIGNvbnN0IHN0YXR1cyA9IGd1ZXN0UHJvbWlzZU1hcC5nZXQoZ3Vlc3RQcm9taXNlKTtcbiAgICBpZiAoIXN0YXR1cyB8fCBzdGF0dXMgPT09IFwic2V0dGxlZFwiKSB7XG4gICAgICB0aHJvd1JlZGFjdGVkYGRvRnVsZmlsbCBzaG91bGQgb25seSBiZSBjYWxsZWQgb24gYSByZWdpc3RlcmVkIHVucmVzb2x2ZWQgcHJvbWlzZWA7XG4gICAgfVxuICAgIGNvbnN0IGd1ZXN0RnVsZmlsbG1lbnQgPSBob3N0VG9HdWVzdChob3N0RnVsZmlsbG1lbnQpO1xuICAgIHN0YXR1cy5yZXNvbHZlKGd1ZXN0RnVsZmlsbG1lbnQpO1xuICAgIGd1ZXN0UHJvbWlzZU1hcC5zZXQoZ3Vlc3RQcm9taXNlLCBcInNldHRsZWRcIik7XG4gIH07XG4gIGNvbnN0IGRvUmVqZWN0ID0gKGhvc3RWb3csIGhvc3RSZWFzb24pID0+IHtcbiAgICBjb25zdCBndWVzdFByb21pc2UgPSBob3N0VG9HdWVzdChob3N0Vm93KTtcbiAgICBjb25zdCBzdGF0dXMgPSBndWVzdFByb21pc2VNYXAuZ2V0KGd1ZXN0UHJvbWlzZSk7XG4gICAgaWYgKCFzdGF0dXMgfHwgc3RhdHVzID09PSBcInNldHRsZWRcIikge1xuICAgICAgdGhyb3dSZWRhY3RlZGBkb1JlamVjdCBzaG91bGQgb25seSBiZSBjYWxsZWQgb24gYSByZWdpc3RlcmVkIHVucmVzb2x2ZWQgcHJvbWlzZWA7XG4gICAgfVxuICAgIGNvbnN0IGd1ZXN0UmVhc29uID0gaG9zdFRvR3Vlc3QoaG9zdFJlYXNvbik7XG4gICAgc3RhdHVzLnJlamVjdChndWVzdFJlYXNvbik7XG4gICAgZ3Vlc3RQcm9taXNlTWFwLnNldChndWVzdFByb21pc2UsIFwic2V0dGxlZFwiKTtcbiAgfTtcbiAgY29uc3QgZG9SZXR1cm4gPSAoY2FsbEluZGV4LCBob3N0UmVzdWx0KSA9PiB7XG4gICAgdW5uZXN0SW50ZXJwcmV0ZXIoY2FsbEluZGV4KTtcbiAgICBjb25zdCBndWVzdFJlc3VsdCA9IGhvc3RUb0d1ZXN0KGhvc3RSZXN1bHQpO1xuICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAga2luZDogXCJyZXR1cm5cIixcbiAgICAgIHJlc3VsdDogZ3Vlc3RSZXN1bHRcbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgZG9UaHJvdyA9IChjYWxsSW5kZXgsIGhvc3RQcm9ibGVtKSA9PiB7XG4gICAgdW5uZXN0SW50ZXJwcmV0ZXIoY2FsbEluZGV4KTtcbiAgICBjb25zdCBndWVzdFByb2JsZW0gPSBob3N0VG9HdWVzdChob3N0UHJvYmxlbSk7XG4gICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICBraW5kOiBcInRocm93XCIsXG4gICAgICBwcm9ibGVtOiBndWVzdFByb2JsZW1cbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgcGVyZm9ybUNhbGwgPSAoaG9zdFRhcmdldCwgb3B0VmVyYiwgaG9zdEFyZ3MsIGNhbGxJbmRleCkgPT4ge1xuICAgIGxldCBob3N0UmVzdWx0O1xuICAgIHRyeSB7XG4gICAgICBob3N0UmVzdWx0ID0gb3B0VmVyYiA/IGhvc3RUYXJnZXRbb3B0VmVyYl0oLi4uaG9zdEFyZ3MpIDogaG9zdFRhcmdldCguLi5ob3N0QXJncyk7XG4gICAgICBob3N0VG9HdWVzdChob3N0UmVzdWx0LCBgY29udmVydGluZyAke29wdFZlcmIgfHwgXCJob3N0XCJ9IHJlc3VsdGApO1xuICAgIH0gY2F0Y2ggKGhvc3RQcm9ibGVtKSB7XG4gICAgICByZXR1cm4gbG9nRG8obmVzdERpc3BhdGNoLCBoYXJkZW4oW1wiZG9UaHJvd1wiLCBjYWxsSW5kZXgsIGhvc3RQcm9ibGVtXSkpO1xuICAgIH1cbiAgICByZXR1cm4gbG9nRG8obmVzdERpc3BhdGNoLCBoYXJkZW4oW1wiZG9SZXR1cm5cIiwgY2FsbEluZGV4LCBob3N0UmVzdWx0XSkpO1xuICB9O1xuICBjb25zdCBndWVzdENhbGxzSG9zdCA9IChndWVzdFRhcmdldCwgb3B0VmVyYiwgZ3Vlc3RBcmdzLCBjYWxsSW5kZXgpID0+IHtcbiAgICBpZiAoc3RvcHBlZCB8fCAhYmlqZWN0aW9uLmhhc0d1ZXN0KGd1ZXN0VGFyZ2V0KSkge1xuICAgICAgY29uc3QgZXh0cmFEaWFnbm9zdGljID0gY2FsbFN0YWNrLmxlbmd0aCA9PT0gMCA/IFwiXCIgOiAoXG4gICAgICAgIC8vXG4gICAgICAgIGAgd2l0aCBub24tZW1wdHkgY2FsbHN0YWNrICR7cXVvdGUoY2FsbFN0YWNrKX07YFxuICAgICAgKTtcbiAgICAgIHRocm93UmVkYWN0ZWRgQ2FsbGVkIGZyb20gYSBwcmV2aW91cyBydW46ICR7Z3Vlc3RUYXJnZXR9JHtiYXJlT3JRdW90ZShleHRyYURpYWdub3N0aWMpfWA7XG4gICAgfVxuICAgIGxldCBvdXRjb21lO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBndWVzdEVudHJ5ID0gaGFyZGVuKFtcbiAgICAgICAgXCJjaGVja0NhbGxcIixcbiAgICAgICAgZ3Vlc3RUYXJnZXQsXG4gICAgICAgIG9wdFZlcmIsXG4gICAgICAgIGd1ZXN0QXJncyxcbiAgICAgICAgY2FsbEluZGV4XG4gICAgICBdKTtcbiAgICAgIGlmIChsb2cuaXNSZXBsYXlpbmcoKSkge1xuICAgICAgICBjb25zdCBlbnRyeSA9IGxvZy5uZXh0RW50cnkoKTtcbiAgICAgICAgZXF1YXRlKFxuICAgICAgICAgIGd1ZXN0RW50cnksXG4gICAgICAgICAgZW50cnksXG4gICAgICAgICAgYHJlcGxheSAke2NhbGxJbmRleH06XG4gICAgICR7cXVvdGUoZ3Vlc3RFbnRyeSl9XG4gIHZzICR7cXVvdGUoZW50cnkpfVxuICAgIGBcbiAgICAgICAgKTtcbiAgICAgICAgb3V0Y29tZSA9IC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgbmVzdEludGVycHJldGVyKGNhbGxJbmRleCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBlbnRyeSA9IGd1ZXN0VG9Ib3N0KGd1ZXN0RW50cnkpO1xuICAgICAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICAgICAgY29uc3QgW18sIC4uLmFyZ3NdID0gZW50cnk7XG4gICAgICAgIG5lc3RJbnRlcnByZXRlcihjYWxsSW5kZXgpO1xuICAgICAgICBvdXRjb21lID0gcGVyZm9ybUNhbGwoLi4uYXJncyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZmF0YWxFcnJvcikge1xuICAgICAgdGhyb3cgcGFuaWMoZmF0YWxFcnJvcik7XG4gICAgfVxuICAgIHN3aXRjaCAob3V0Y29tZS5raW5kKSB7XG4gICAgICBjYXNlIFwicmV0dXJuXCI6IHtcbiAgICAgICAgcmV0dXJuIG91dGNvbWUucmVzdWx0O1xuICAgICAgfVxuICAgICAgY2FzZSBcInRocm93XCI6IHtcbiAgICAgICAgdGhyb3cgb3V0Y29tZS5wcm9ibGVtO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyBQYW5pY2B1bmV4cGVjdGVkIG91dGNvbWUga2luZCAke3F1b3RlKG91dGNvbWUua2luZCl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IHBlcmZvcm1TZW5kT25seSA9IChob3N0VGFyZ2V0LCBvcHRWZXJiLCBob3N0QXJncykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBvcHRWZXJiID09PSB2b2lkIDAgPyBoZWFwVm93RS5zZW5kT25seShob3N0VGFyZ2V0KSguLi5ob3N0QXJncykgOiBoZWFwVm93RS5zZW5kT25seShob3N0VGFyZ2V0KVtvcHRWZXJiXSguLi5ob3N0QXJncyk7XG4gICAgfSBjYXRjaCAoaG9zdFByb2JsZW0pIHtcbiAgICAgIHRocm93IFBhbmljYGludGVybmFsOiBldmVudHVhbCBzZW5kT25seSBzeW5jaHJvbm91c2x5IGZhaWxlZCAke2hvc3RQcm9ibGVtfWA7XG4gICAgfVxuICB9O1xuICBjb25zdCBwZXJmb3JtU2VuZCA9IChob3N0VGFyZ2V0LCBvcHRWZXJiLCBob3N0QXJncywgY2FsbEluZGV4LCBob3N0UmVzdWx0S2l0LCBndWVzdFJldHVybmVkUCkgPT4ge1xuICAgIGNvbnN0IHsgdm93LCByZXNvbHZlciB9ID0gaG9zdFJlc3VsdEtpdDtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaG9zdFByb21pc2UgPSBvcHRWZXJiID09PSB2b2lkIDAgPyBoZWFwVm93RShob3N0VGFyZ2V0KSguLi5ob3N0QXJncykgOiBoZWFwVm93RShob3N0VGFyZ2V0KVtvcHRWZXJiXSguLi5ob3N0QXJncyk7XG4gICAgICByZXNvbHZlci5yZXNvbHZlKGhvc3RQcm9taXNlKTtcbiAgICB9IGNhdGNoIChob3N0UHJvYmxlbSkge1xuICAgICAgdGhyb3cgUGFuaWNgaW50ZXJuYWw6IGV2ZW50dWFsIHNlbmQgc3luY2hyb25vdXNseSBmYWlsZWQgJHtob3N0UHJvYmxlbX1gO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgZW50cnkgPSBoYXJkZW4oW1wiZG9SZXR1cm5cIiwgY2FsbEluZGV4LCB2b3ddKTtcbiAgICAgIGxvZy5wdXNoRW50cnkoZW50cnkpO1xuICAgICAgY29uc3QgZ3Vlc3RQcm9taXNlID0gbWFrZUd1ZXN0Rm9ySG9zdFZvdyh2b3csIGd1ZXN0UmV0dXJuZWRQKTtcbiAgICAgIGRvUmV0dXJuKGNhbGxJbmRleCwgdm93KTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBraW5kOiBcInJldHVyblwiLFxuICAgICAgICByZXN1bHQ6IGd1ZXN0UHJvbWlzZVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAocHJvYmxlbSkge1xuICAgICAgdGhyb3cgcGFuaWMocHJvYmxlbSk7XG4gICAgfVxuICB9O1xuICBjb25zdCBndWVzdEhhbmRsZXIgPSBoYXJkZW4oe1xuICAgIGFwcGx5TWV0aG9kU2VuZE9ubHkoZ3Vlc3RUYXJnZXQsIG9wdFZlcmIsIGd1ZXN0QXJncykge1xuICAgICAgX19ldmVudHVhbFNlbmRGb3JUZXN0aW5nIHx8IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGFwcGx5TWV0aG9kU2VuZE9ubHkgbm90IHlldCBzdXBwb3J0ZWQ6ICR7Z3Vlc3RUYXJnZXR9LiR7YmFyZU9yUXVvdGUob3B0VmVyYil9YDtcbiAgICAgIGNvbnN0IGNhbGxJbmRleCA9IGxvZy5nZXRJbmRleCgpO1xuICAgICAgaWYgKHN0b3BwZWQgfHwgIWJpamVjdGlvbi5oYXNHdWVzdChndWVzdFRhcmdldCkpIHtcbiAgICAgICAgdGhyb3dSZWRhY3RlZGBTZW50IGZyb20gYSBwcmV2aW91cyBydW46ICR7Z3Vlc3RUYXJnZXR9YDtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGd1ZXN0RW50cnkgPSBoYXJkZW4oW1xuICAgICAgICAgIFwiY2hlY2tTZW5kT25seVwiLFxuICAgICAgICAgIGd1ZXN0VGFyZ2V0LFxuICAgICAgICAgIG9wdFZlcmIsXG4gICAgICAgICAgZ3Vlc3RBcmdzLFxuICAgICAgICAgIGNhbGxJbmRleFxuICAgICAgICBdKTtcbiAgICAgICAgaWYgKGxvZy5pc1JlcGxheWluZygpKSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBsb2cubmV4dEVudHJ5KCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGVxdWF0ZShndWVzdEVudHJ5LCBlbnRyeSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXF1YXRlRXJyKSB7XG4gICAgICAgICAgICB0aHJvd0xhYmVsZWQoXG4gICAgICAgICAgICAgIGVxdWF0ZUVycixcbiAgICAgICAgICAgICAgYHJlcGxheSAke2NhbGxJbmRleH06XG4gICAgICR7cXVvdGUoZ3Vlc3RFbnRyeSl9XG4gIHZzICR7cXVvdGUoZW50cnkpfVxuICAgIGBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gZ3Vlc3RUb0hvc3QoZ3Vlc3RFbnRyeSk7XG4gICAgICAgICAgbG9nLnB1c2hFbnRyeShlbnRyeSk7XG4gICAgICAgICAgY29uc3QgW19vcCwgaG9zdFRhcmdldCwgX29wdFZlcmIsIGhvc3RBcmdzLCBfY2FsbEluZGV4XSA9IGVudHJ5O1xuICAgICAgICAgIHBlcmZvcm1TZW5kT25seShob3N0VGFyZ2V0LCBvcHRWZXJiLCBob3N0QXJncyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGZhdGFsRXJyb3IpIHtcbiAgICAgICAgdGhyb3cgcGFuaWMoZmF0YWxFcnJvcik7XG4gICAgICB9XG4gICAgfSxcbiAgICBhcHBseU1ldGhvZChndWVzdFRhcmdldCwgb3B0VmVyYiwgZ3Vlc3RBcmdzLCBndWVzdFJldHVybmVkUCkge1xuICAgICAgX19ldmVudHVhbFNlbmRGb3JUZXN0aW5nIHx8IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGFwcGx5TWV0aG9kIG5vdCB5ZXQgc3VwcG9ydGVkOiAke2d1ZXN0VGFyZ2V0fS4ke2JhcmVPclF1b3RlKG9wdFZlcmIpfSAtPiAke2JhcmVPclF1b3RlKGd1ZXN0UmV0dXJuZWRQKX1gO1xuICAgICAgY29uc3QgY2FsbEluZGV4ID0gbG9nLmdldEluZGV4KCk7XG4gICAgICBpZiAoc3RvcHBlZCB8fCAhYmlqZWN0aW9uLmhhc0d1ZXN0KGd1ZXN0VGFyZ2V0KSkge1xuICAgICAgICB0aHJvd1JlZGFjdGVkYFNlbnQgZnJvbSBhIHByZXZpb3VzIHJ1bjogJHtndWVzdFRhcmdldH1gO1xuICAgICAgfVxuICAgICAgY29uc3QgaG9zdFJlc3VsdEtpdCA9IG1ha2VWb3dLaXQoKTtcbiAgICAgIGNvbnN0IGczID0gYmlqZWN0aW9uLnVud3JhcEluaXQoZ3Vlc3RSZXR1cm5lZFAsIGhvc3RSZXN1bHRLaXQudm93KTtcbiAgICAgIGczID09PSBndWVzdFJldHVybmVkUCB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBndWVzdFJldHVybmVkUCBzaG91bGQgbm90IHVud3JhcDogJHtnM30gdnMgJHtndWVzdFJldHVybmVkUH1gO1xuICAgICAgbGV0IG91dGNvbWU7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBndWVzdEVudHJ5ID0gaGFyZGVuKFtcbiAgICAgICAgICBcImNoZWNrU2VuZFwiLFxuICAgICAgICAgIGd1ZXN0VGFyZ2V0LFxuICAgICAgICAgIG9wdFZlcmIsXG4gICAgICAgICAgZ3Vlc3RBcmdzLFxuICAgICAgICAgIGNhbGxJbmRleFxuICAgICAgICBdKTtcbiAgICAgICAgaWYgKGxvZy5pc1JlcGxheWluZygpKSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBsb2cubmV4dEVudHJ5KCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGVxdWF0ZShndWVzdEVudHJ5LCBlbnRyeSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXF1YXRlRXJyKSB7XG4gICAgICAgICAgICB0aHJvd0xhYmVsZWQoXG4gICAgICAgICAgICAgIGVxdWF0ZUVycixcbiAgICAgICAgICAgICAgYHJlcGxheSAke2NhbGxJbmRleH06XG4gICAgICR7cXVvdGUoZ3Vlc3RFbnRyeSl9XG4gIHZzICR7cXVvdGUoZW50cnkpfVxuICAgIGBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG91dGNvbWUgPSAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgbmVzdEludGVycHJldGVyKGNhbGxJbmRleCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBndWVzdFRvSG9zdChndWVzdEVudHJ5KTtcbiAgICAgICAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICAgICAgICBjb25zdCBbX29wLCBob3N0VGFyZ2V0LCBfb3B0VmVyYiwgaG9zdEFyZ3MsIF9jYWxsSW5kZXhdID0gZW50cnk7XG4gICAgICAgICAgbmVzdEludGVycHJldGVyKGNhbGxJbmRleCk7XG4gICAgICAgICAgb3V0Y29tZSA9IHBlcmZvcm1TZW5kKFxuICAgICAgICAgICAgaG9zdFRhcmdldCxcbiAgICAgICAgICAgIG9wdFZlcmIsXG4gICAgICAgICAgICBob3N0QXJncyxcbiAgICAgICAgICAgIGNhbGxJbmRleCxcbiAgICAgICAgICAgIGhvc3RSZXN1bHRLaXQsXG4gICAgICAgICAgICBndWVzdFJldHVybmVkUFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGZhdGFsRXJyb3IpIHtcbiAgICAgICAgdGhyb3cgcGFuaWMoZmF0YWxFcnJvcik7XG4gICAgICB9XG4gICAgICBzd2l0Y2ggKG91dGNvbWUua2luZCkge1xuICAgICAgICBjYXNlIFwicmV0dXJuXCI6IHtcbiAgICAgICAgICByZXR1cm4gb3V0Y29tZS5yZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInRocm93XCI6IHtcbiAgICAgICAgICB0aHJvdyBvdXRjb21lLnByb2JsZW07XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRocm93IFBhbmljYHVuZXhwZWN0ZWQgb3V0Y29tZSBraW5kICR7cXVvdGUob3V0Y29tZS5raW5kKX1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBhcHBseUZ1bmN0aW9uU2VuZE9ubHkoZ3Vlc3RUYXJnZXQsIGd1ZXN0QXJncykge1xuICAgICAgX19ldmVudHVhbFNlbmRGb3JUZXN0aW5nIHx8IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGFwcGx5RnVuY3Rpb25TZW5kT25seSBub3QgeWV0IHN1cHBvcnRlZDogJHtndWVzdFRhcmdldH1gO1xuICAgICAgcmV0dXJuIGd1ZXN0SGFuZGxlci5hcHBseU1ldGhvZFNlbmRPbmx5KFxuICAgICAgICBndWVzdFRhcmdldCxcbiAgICAgICAgdm9pZCAwLFxuICAgICAgICBndWVzdEFyZ3NcbiAgICAgICk7XG4gICAgfSxcbiAgICBhcHBseUZ1bmN0aW9uKGd1ZXN0VGFyZ2V0LCBndWVzdEFyZ3MsIGd1ZXN0UmV0dXJuZWRQKSB7XG4gICAgICBfX2V2ZW50dWFsU2VuZEZvclRlc3RpbmcgfHwgUGFuaWNgZ3Vlc3QgZXZlbnR1YWwgYXBwbHlGdW5jdGlvbiBub3QgeWV0IHN1cHBvcnRlZDogJHtndWVzdFRhcmdldH0gLT4gJHtiYXJlT3JRdW90ZShndWVzdFJldHVybmVkUCl9YDtcbiAgICAgIHJldHVybiBndWVzdEhhbmRsZXIuYXBwbHlNZXRob2QoXG4gICAgICAgIGd1ZXN0VGFyZ2V0LFxuICAgICAgICB2b2lkIDAsXG4gICAgICAgIGd1ZXN0QXJncyxcbiAgICAgICAgZ3Vlc3RSZXR1cm5lZFBcbiAgICAgICk7XG4gICAgfSxcbiAgICBnZXRTZW5kT25seShndWVzdFRhcmdldCwgcHJvcCkge1xuICAgICAgdGhyb3cgUGFuaWNgZ3Vlc3QgZXZlbnR1YWwgZ2V0U2VuZE9ubHkgbm90IHlldCBzdXBwb3J0ZWQ6ICR7Z3Vlc3RUYXJnZXR9LiR7YmFyZU9yUXVvdGUocHJvcCl9YDtcbiAgICB9LFxuICAgIGdldChndWVzdFRhcmdldCwgcHJvcCwgZ3Vlc3RSZXR1cm5lZFApIHtcbiAgICAgIHRocm93IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGdldCBub3QgeWV0IHN1cHBvcnRlZDogJHtndWVzdFRhcmdldH0uJHtiYXJlT3JRdW90ZShwcm9wKX0gLT4gJHtiYXJlT3JRdW90ZShndWVzdFJldHVybmVkUCl9YDtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBtYWtlR3Vlc3RQcmVzZW5jZSA9IChpZmFjZSwgbWV0aG9kRW50cmllcykgPT4ge1xuICAgIGxldCBndWVzdFByZXNlbmNlO1xuICAgIHZvaWQgbmV3IEhhbmRsZWRQcm9taXNlKChfcmVzLCBfcmVqLCByZXNvbHZlV2l0aFByZXNlbmNlKSA9PiB7XG4gICAgICBndWVzdFByZXNlbmNlID0gcmVzb2x2ZVdpdGhQcmVzZW5jZShndWVzdEhhbmRsZXIpO1xuICAgIH0pO1xuICAgIGlmICh0eXBlb2YgZ3Vlc3RQcmVzZW5jZSAhPT0gXCJvYmplY3RcIikge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBwcmVzZW5jZSBleHBlY3RlZCB0byBiZSBvYmplY3QgJHtndWVzdFByZXNlbmNlfWA7XG4gICAgfVxuICAgIGFzc2lnbjMoZ3Vlc3RQcmVzZW5jZSwgZnJvbUVudHJpZXMxMyhtZXRob2RFbnRyaWVzKSk7XG4gICAgY29uc3QgcmVzdWx0ID0gUmVtb3RhYmxlKGlmYWNlLCB2b2lkIDAsIGd1ZXN0UHJlc2VuY2UpO1xuICAgIHJlc3VsdCA9PT0gZ3Vlc3RQcmVzZW5jZSB8fCB0aHJvd1JlZGFjdGVkYFJlbW90YWJsZSBleHBlY3RlZCB0byBtYWtlIHByZXNlbmNlIGluIHBsYWNlOiAke2d1ZXN0UHJlc2VuY2V9IHZzICR7cmVzdWx0fWA7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbiAgY29uc3QgbWFrZUd1ZXN0UHJvbWlzZUtpdCA9ICgpID0+IHtcbiAgICBsZXQgcmVzb2x2ZTI7XG4gICAgbGV0IHJlamVjdDtcbiAgICBjb25zdCBwcm9taXNlID0gbmV3IEhhbmRsZWRQcm9taXNlKChyZXMsIHJlaiwgX3Jlc1ByZXMpID0+IHtcbiAgICAgIHJlc29sdmUyID0gcmVzO1xuICAgICAgcmVqZWN0ID0gcmVqO1xuICAgIH0sIGd1ZXN0SGFuZGxlcik7XG4gICAgcmV0dXJuIGhhcmRlbih7IHByb21pc2UsIHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QgfSk7XG4gIH07XG4gIGNvbnN0IG1ha2VHdWVzdEZvckhvc3RSZW1vdGFibGUgPSAoaFJlbSkgPT4ge1xuICAgIGxldCBnUmVtO1xuICAgIGNvbnN0IG1ha2VHdWVzdE1ldGhvZCA9IChvcHRWZXJiID0gdm9pZCAwKSA9PiB7XG4gICAgICBjb25zdCBndWVzdE1ldGhvZCA9ICguLi5ndWVzdEFyZ3MpID0+IHtcbiAgICAgICAgY29uc3QgY2FsbEluZGV4ID0gbG9nLmdldEluZGV4KCk7XG4gICAgICAgIHJldHVybiBndWVzdENhbGxzSG9zdChnUmVtLCBvcHRWZXJiLCBndWVzdEFyZ3MsIGNhbGxJbmRleCk7XG4gICAgICB9O1xuICAgICAgaWYgKG9wdFZlcmIpIHtcbiAgICAgICAgZGVmaW5lUHJvcGVydGllczUoZ3Vlc3RNZXRob2QsIHtcbiAgICAgICAgICBuYW1lOiB7IHZhbHVlOiBTdHJpbmcoaFJlbVtvcHRWZXJiXS5uYW1lIHx8IG9wdFZlcmIpIH0sXG4gICAgICAgICAgbGVuZ3RoOiB7IHZhbHVlOiBOdW1iZXIoaFJlbVtvcHRWZXJiXS5sZW5ndGggfHwgMCkgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlZmluZVByb3BlcnRpZXM1KGd1ZXN0TWV0aG9kLCB7XG4gICAgICAgICAgbmFtZTogeyB2YWx1ZTogU3RyaW5nKGhSZW0ubmFtZSB8fCBcImFub25cIikgfSxcbiAgICAgICAgICBsZW5ndGg6IHsgdmFsdWU6IE51bWJlcihoUmVtLmxlbmd0aCB8fCAwKSB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGd1ZXN0TWV0aG9kO1xuICAgIH07XG4gICAgY29uc3QgaWZhY2UgPSBTdHJpbmcoZ2V0SW50ZXJmYWNlT2YoaFJlbSkgfHwgXCJyZW1vdGFibGVcIik7XG4gICAgY29uc3QgZ3Vlc3RJZmFjZSA9IGAke2lmYWNlfSBndWVzdCB3cmFwcGVyYDtcbiAgICBpZiAodHlwZW9mIGhSZW0gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgZ1JlbSA9IFJlbW90YWJsZShndWVzdElmYWNlLCB2b2lkIDAsIG1ha2VHdWVzdE1ldGhvZCgpKTtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaG9zdCBmYXIgZnVuY3Rpb25zIG5vdCB5ZXQgcGFzc2FibGVgO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBtZXRob2ROYW1lcyA9IGdldE1ldGhvZE5hbWVzKGhSZW0pO1xuICAgICAgY29uc3QgZ3Vlc3RNZXRob2RzID0gbWV0aG9kTmFtZXMubWFwKChuYW1lKSA9PiBbXG4gICAgICAgIG5hbWUsXG4gICAgICAgIG1ha2VHdWVzdE1ldGhvZChuYW1lKVxuICAgICAgXSk7XG4gICAgICBnUmVtID0gbWFrZUd1ZXN0UHJlc2VuY2UoZ3Vlc3RJZmFjZSwgZ3Vlc3RNZXRob2RzKTtcbiAgICB9XG4gICAgaFJlbSA9IHZvaWQgMDtcbiAgICByZXR1cm4gZ1JlbTtcbiAgfTtcbiAgaGFyZGVuKG1ha2VHdWVzdEZvckhvc3RSZW1vdGFibGUpO1xuICBjb25zdCBtYWtlR3Vlc3RGb3JIb3N0Vm93ID0gKGhWb3csIHByb21pc2VLZXkgPSB2b2lkIDApID0+IHtcbiAgICBpc1ZvdyhoVm93KSB8fCB0aHJvd1JlZGFjdGVkYHZvdyBleHBlY3RlZCAke2hWb3d9YDtcbiAgICBjb25zdCB7IHByb21pc2UsIHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QgfSA9IG1ha2VHdWVzdFByb21pc2VLaXQoKTtcbiAgICBwcm9taXNlS2V5ID8/PSBwcm9taXNlO1xuICAgIGd1ZXN0UHJvbWlzZU1hcC5zZXQocHJvbWlzZUtleSwgaGFyZGVuKHsgcmVzb2x2ZTogcmVzb2x2ZTIsIHJlamVjdCB9KSk7XG4gICAgd2F0Y2hXYWtlKGhWb3cpO1xuICAgIHZvaWQgd2hlbihcbiAgICAgIGhWb3csXG4gICAgICBhc3luYyAoaG9zdEZ1bGZpbGxtZW50KSA9PiB7XG4gICAgICAgIGF3YWl0IGxvZy5wcm9taXNlUmVwbGF5RG9uZSgpO1xuICAgICAgICBpZiAoIXN0b3BwZWQgJiYgZ3Vlc3RQcm9taXNlTWFwLmdldChwcm9taXNlS2V5KSAhPT0gXCJzZXR0bGVkXCIpIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGhhcmRlbihbXCJkb0Z1bGZpbGxcIiwgaFZvdywgaG9zdEZ1bGZpbGxtZW50XSk7XG4gICAgICAgICAgbG9nLnB1c2hFbnRyeShlbnRyeSk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGludGVycHJldE9uZSh0b3BEaXNwYXRjaCwgZW50cnkpO1xuICAgICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGFzeW5jIChob3N0UmVhc29uKSA9PiB7XG4gICAgICAgIGF3YWl0IGxvZy5wcm9taXNlUmVwbGF5RG9uZSgpO1xuICAgICAgICBpZiAoIXN0b3BwZWQgJiYgZ3Vlc3RQcm9taXNlTWFwLmdldChwcm9taXNlS2V5KSAhPT0gXCJzZXR0bGVkXCIpIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGhhcmRlbihbXCJkb1JlamVjdFwiLCBoVm93LCBob3N0UmVhc29uXSk7XG4gICAgICAgICAgbG9nLnB1c2hFbnRyeShlbnRyeSk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGludGVycHJldE9uZSh0b3BEaXNwYXRjaCwgZW50cnkpO1xuICAgICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuIHByb21pc2U7XG4gIH07XG4gIGhhcmRlbihtYWtlR3Vlc3RGb3JIb3N0Vm93KTtcbiAgY29uc3QgeyBndWVzdFRvSG9zdCwgaG9zdFRvR3Vlc3QgfSA9IG1ha2VDb252ZXJ0S2l0KFxuICAgIGJpamVjdGlvbixcbiAgICBtYWtlR3Vlc3RGb3JIb3N0UmVtb3RhYmxlLFxuICAgIG1ha2VHdWVzdEZvckhvc3RWb3dcbiAgKTtcbiAgY29uc3QgdG9wRGlzcGF0Y2ggPSBoYXJkZW4oe1xuICAgIHN0YXJ0R2VuZXJhdGlvbixcbiAgICBkb0Z1bGZpbGwsXG4gICAgZG9SZWplY3RcbiAgICAvL1xuICB9KTtcbiAgY29uc3QgbmVzdERpc3BhdGNoID0gaGFyZGVuKHtcbiAgICBkb1JldHVybixcbiAgICBkb1Rocm93XG4gICAgLy9cbiAgfSk7XG4gIGNvbnN0IGludGVycHJldE9uZSA9IChkaXNwYXRjaCwgW29wLCAuLi5hcmdzXSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBvcCBpbiBkaXNwYXRjaCB8fCAvL1xuICAgICAgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGRpc3BhdGNoIG9wOiAke3F1b3RlKG9wKX1gO1xuICAgICAgcmV0dXJuIGRpc3BhdGNoW29wXSguLi5hcmdzKTtcbiAgICB9IGNhdGNoIChwcm9ibGVtKSB7XG4gICAgICB0aHJvdyBwYW5pYyhwcm9ibGVtKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGxvZ0RvID0gKGRpc3BhdGNoLCBlbnRyeSkgPT4ge1xuICAgIGxvZy5wdXNoRW50cnkoZW50cnkpO1xuICAgIHJldHVybiBpbnRlcnByZXRPbmUoZGlzcGF0Y2gsIGVudHJ5KTtcbiAgfTtcbiAgY29uc3QgY2FsbFN0YWNrID0gW107XG4gIGxldCB1bm5lc3RGbGFnID0gZmFsc2U7XG4gIGNvbnN0IG5lc3RJbnRlcnByZXRlciA9IChjYWxsSW5kZXgpID0+IHtcbiAgICBjYWxsU3RhY2sucHVzaChjYWxsSW5kZXgpO1xuICAgIHdoaWxlIChsb2cuaXNSZXBsYXlpbmcoKSAmJiAhc3RvcHBlZCkge1xuICAgICAgY29uc3QgZW50cnkgPSBsb2cubmV4dFVuZmlsdGVyZWRFbnRyeSgpO1xuICAgICAgY29uc3Qgb3B0T3V0Y29tZSA9IGludGVycHJldE9uZShuZXN0RGlzcGF0Y2gsIGVudHJ5KTtcbiAgICAgIGlmICh1bm5lc3RGbGFnKSB7XG4gICAgICAgIG9wdE91dGNvbWUgfHwgLy9cbiAgICAgICAgdGhyb3dSZWRhY3RlZGBvbmx5IHVubmVzdCB3aXRoIGFuIG91dGNvbWU6ICR7cXVvdGUoZW50cnlbMF0pfWA7XG4gICAgICAgIHVubmVzdEZsYWcgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIG9wdE91dGNvbWU7XG4gICAgICB9XG4gICAgfVxuICAgIHVubmVzdEZsYWcgPSBmYWxzZTtcbiAgfTtcbiAgY29uc3QgdW5uZXN0SW50ZXJwcmV0ZXIgPSAoY2FsbEluZGV4KSA9PiB7XG4gICAgIXN0b3BwZWQgfHwgdGhyb3dSZWRhY3RlZGBUaGlzIG1lbWJyYW5lIHN0b3BwZWQuIFJlc3RhcnQgd2l0aCBuZXcgbWVtYnJhbmUgJHtyZXBsYXlNZW1icmFuZX1gO1xuICAgIGNhbGxTdGFjay5sZW5ndGggPj0gMSB8fCAvL1xuICAgIHRocm93UmVkYWN0ZWRgVW5tYXRjaGVkIHVubmVzdDogJHtxdW90ZShjYWxsSW5kZXgpfWA7XG4gICAgY29uc3QgaTMgPSBjYWxsU3RhY2sucG9wKCk7XG4gICAgaTMgPT09IGNhbGxJbmRleCB8fCAvL1xuICAgIHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCB1bm5lc3Q6ICR7cXVvdGUoY2FsbEluZGV4KX0gdnMgJHtxdW90ZShpMyl9YDtcbiAgICB1bm5lc3RGbGFnID0gdHJ1ZTtcbiAgICBpZiAoY2FsbFN0YWNrLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdm9pZCBFLndoZW4odm9pZCAwLCB3YWtlKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHdha2UgPSAoKSA9PiB7XG4gICAgd2hpbGUgKGxvZy5pc1JlcGxheWluZygpICYmICFzdG9wcGVkKSB7XG4gICAgICBjYWxsU3RhY2subGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgd2FrZSBvbmx5IHdpdGggZW1wdHkgY2FsbFN0YWNrOiAke3F1b3RlKGNhbGxTdGFjayl9YDtcbiAgICAgIGNvbnN0IGVudHJ5ID0gbG9nLnBlZWtFbnRyeSgpO1xuICAgICAgY29uc3Qgb3AgPSBlbnRyeVswXTtcbiAgICAgIGlmICghKG9wIGluIHRvcERpc3BhdGNoKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2b2lkIGxvZy5uZXh0VW5maWx0ZXJlZEVudHJ5KCk7XG4gICAgICBpbnRlcnByZXRPbmUodG9wRGlzcGF0Y2gsIGVudHJ5KTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHN0b3AgPSAoKSA9PiB7XG4gICAgc3RvcHBlZCA9IHRydWU7XG4gIH07XG4gIGNvbnN0IHJlcGxheU1lbWJyYW5lID0gRmFyKFwicmVwbGF5TWVtYnJhbmVcIiwge1xuICAgIGhvc3RUb0d1ZXN0LFxuICAgIGd1ZXN0VG9Ib3N0LFxuICAgIHdha2UsXG4gICAgc3RvcFxuICB9KTtcbiAgcmV0dXJuIHJlcGxheU1lbWJyYW5lO1xufTtcbmhhcmRlbihtYWtlUmVwbGF5TWVtYnJhbmUpO1xuXG4vL1xudmFyIEZsb3dTdGF0ZVNoYXBlID0gTS5vcihcbiAgXCJSdW5uaW5nXCIsXG4gIFwiU2xlZXBpbmdcIixcbiAgXCJSZXBsYXlpbmdcIixcbiAgXCJGYWlsZWRcIixcbiAgXCJEb25lXCJcbik7XG52YXIgUHJvcGVydHlLZXlTaGFwZSA9IE0ub3IoTS5zdHJpbmcoKSwgTS5zeW1ib2woKSk7XG52YXIgTG9nRW50cnlTaGFwZSA9IE0ub3IoXG4gIFtcInN0YXJ0R2VuZXJhdGlvblwiLCBNLm51bWJlcigpXSxcbiAgLy9cbiAgW1wiZG9GdWxmaWxsXCIsIFZvd1NoYXBlLCBNLmFueSgpXSxcbiAgW1wiZG9SZWplY3RcIiwgVm93U2hhcGUsIE0uYW55KCldLFxuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICBbXCJkb1JldHVyblwiLCBNLm51bWJlcigpLCBNLmFueSgpXSxcbiAgW1wiZG9UaHJvd1wiLCBNLm51bWJlcigpLCBNLmFueSgpXSxcbiAgLy9cbiAgLy9cbiAgLy9cbiAgW1xuICAgIFwiY2hlY2tDYWxsXCIsXG4gICAgTS5yZW1vdGFibGUoXCJob3N0IHRhcmdldFwiKSxcbiAgICBNLm9wdChQcm9wZXJ0eUtleVNoYXBlKSxcbiAgICBNLmFycmF5T2YoTS5hbnkoKSksXG4gICAgTS5udW1iZXIoKVxuICBdLFxuICBbXG4gICAgXCJjaGVja1NlbmRPbmx5XCIsXG4gICAgTS5vcihNLnJlbW90YWJsZShcImhvc3QgdGFyZ2V0XCIpLCBWb3dTaGFwZSksXG4gICAgTS5vcHQoUHJvcGVydHlLZXlTaGFwZSksXG4gICAgTS5hcnJheU9mKE0uYW55KCkpLFxuICAgIE0ubnVtYmVyKClcbiAgXSxcbiAgW1xuICAgIFwiY2hlY2tTZW5kXCIsXG4gICAgTS5vcihNLnJlbW90YWJsZShcImhvc3QgdGFyZ2V0XCIpLCBWb3dTaGFwZSksXG4gICAgTS5vcHQoUHJvcGVydHlLZXlTaGFwZSksXG4gICAgTS5hcnJheU9mKE0uYW55KCkpLFxuICAgIE0ubnVtYmVyKClcbiAgXVxuICAvL1xuICAvL1xuKTtcblxuLy9cbnZhciBtYWtlRXBoZW1lcmEgPSAocmVpbml0KSA9PiB7XG4gIGNvbnN0IG1hcCA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBmb3Ioc2VsZikge1xuICAgICAgaWYgKCFtYXAuaGFzKHNlbGYpKSB7XG4gICAgICAgIG1hcC5zZXQoc2VsZiwgcmVpbml0KHNlbGYpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAoXG4gICAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgICAgbWFwLmdldChzZWxmKVxuICAgICAgKTtcbiAgICB9LFxuICAgIHJlc2V0Rm9yKHNlbGYpIHtcbiAgICAgIHJldHVybiBtYXAuZGVsZXRlKHNlbGYpO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VFcGhlbWVyYSk7XG5cbi8vXG52YXIgTG9nU3RvcmVJID0gTS5pbnRlcmZhY2UoXCJMb2dTdG9yZVwiLCB7XG4gIHJlc2V0OiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gIGRpc3Bvc2U6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgZ2V0VW5maWx0ZXJlZEluZGV4OiBNLmNhbGwoKS5yZXR1cm5zKE0ubnVtYmVyKCkpLFxuICBnZXRJbmRleDogTS5jYWxsKCkucmV0dXJucyhNLm51bWJlcigpKSxcbiAgZ2V0TGVuZ3RoOiBNLmNhbGwoKS5yZXR1cm5zKE0ubnVtYmVyKCkpLFxuICBpc1JlcGxheWluZzogTS5jYWxsKCkucmV0dXJucyhNLmJvb2xlYW4oKSksXG4gIHBlZWtFbnRyeTogTS5jYWxsKCkucmV0dXJucyhMb2dFbnRyeVNoYXBlKSxcbiAgbmV4dEVudHJ5OiBNLmNhbGwoKS5yZXR1cm5zKExvZ0VudHJ5U2hhcGUpLFxuICBuZXh0VW5maWx0ZXJlZEVudHJ5OiBNLmNhbGwoKS5yZXR1cm5zKExvZ0VudHJ5U2hhcGUpLFxuICBwdXNoRW50cnk6IE0uY2FsbChMb2dFbnRyeVNoYXBlKS5yZXR1cm5zKE0ubnVtYmVyKCkpLFxuICBkdW1wVW5maWx0ZXJlZDogTS5jYWxsKCkucmV0dXJucyhNLmFycmF5T2YoTG9nRW50cnlTaGFwZSkpLFxuICBkdW1wOiBNLmNhbGwoKS5yZXR1cm5zKE0uYXJyYXlPZihMb2dFbnRyeVNoYXBlKSksXG4gIHByb21pc2VSZXBsYXlEb25lOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxufSk7XG52YXIgbmV4dEdlbmVyYXRpb24gPSAoem9uZSkgPT4ge1xuICBjb25zdCBsb2dTdG9yZU1ldGFkYXRhID0gem9uZS5tYXBTdG9yZShcIkxvZ1N0b3JlTWV0YWRhdGFcIik7XG4gIGNvbnN0IGdlbmVyYXRpb25LZXkgPSBcImdlbmVyYXRpb25cIjtcbiAgaWYgKCFsb2dTdG9yZU1ldGFkYXRhLmhhcyhnZW5lcmF0aW9uS2V5KSkge1xuICAgIGNvbnN0IGZpcnN0R2VuID0gMDtcbiAgICBsb2dTdG9yZU1ldGFkYXRhLmluaXQoZ2VuZXJhdGlvbktleSwgZmlyc3RHZW4pO1xuICAgIHJldHVybiBmaXJzdEdlbjtcbiAgfVxuICBjb25zdCBuZXh0R2VuID0gbG9nU3RvcmVNZXRhZGF0YS5nZXQoZ2VuZXJhdGlvbktleSkgKyAxO1xuICBsb2dTdG9yZU1ldGFkYXRhLnNldChnZW5lcmF0aW9uS2V5LCBuZXh0R2VuKTtcbiAgcmV0dXJuIG5leHRHZW47XG59O1xudmFyIHByZXBhcmVMb2dTdG9yZSA9ICh6b25lKSA9PiB7XG4gIGNvbnN0IGluaXRpYWxQdXNoID0gaGFyZGVuKFtbXCJzdGFydEdlbmVyYXRpb25cIiwgbmV4dEdlbmVyYXRpb24oem9uZSldXSk7XG4gIGNvbnN0IGVudHJ5SXNWaXNpYmxlID0gKGVudHJ5KSA9PiBlbnRyeVswXSAhPT0gXCJzdGFydEdlbmVyYXRpb25cIjtcbiAgY29uc3QgdG1wID0gbWFrZUVwaGVtZXJhKChsb2cpID0+IHtcbiAgICBjb25zdCByZXN1bHQgPSB7XG4gICAgICBpbmRleDogMCxcbiAgICAgIHVuZmlsdGVyZWRJbmRleDogMCxcbiAgICAgIGluaXRpYWxQdXNoLFxuICAgICAgcmVwbGF5RG9uZUtpdDogbWFrZVByb21pc2VLaXQoKVxuICAgIH07XG4gICAgaWYgKGxvZy5nZXRMZW5ndGgoKSA9PT0gMCkge1xuICAgICAgcmVzdWx0LnJlcGxheURvbmVLaXQucmVzb2x2ZSh2b2lkIDApO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9KTtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3MoXG4gICAgXCJMb2dTdG9yZVwiLFxuICAgIExvZ1N0b3JlSSxcbiAgICAoKSA9PiB7XG4gICAgICBjb25zdCBtYXBTdG9yZSA9IHpvbmUuZGV0YWNoZWQoKS5tYXBTdG9yZShcImxvZ01hcFN0b3JlXCIsIHtcbiAgICAgICAga2V5U2hhcGU6IE0ubnVtYmVyKCksXG4gICAgICAgIHZhbHVlU2hhcGU6IExvZ0VudHJ5U2hhcGVcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWFwU3RvcmVcbiAgICAgIH07XG4gICAgfSxcbiAgICB7XG4gICAgICByZXNldCgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICB0bXAucmVzZXRGb3Ioc2VsZik7XG4gICAgICB9LFxuICAgICAgZGlzcG9zZSgpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSwgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtYXBTdG9yZSB9ID0gc3RhdGU7XG4gICAgICAgIHRtcC5yZXNldEZvcihzZWxmKTtcbiAgICAgICAgbWFwU3RvcmUuY2xlYXIoKTtcbiAgICAgIH0sXG4gICAgICBnZXRVbmZpbHRlcmVkSW5kZXgoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgcmV0dXJuIGVwaC51bmZpbHRlcmVkSW5kZXg7XG4gICAgICB9LFxuICAgICAgZ2V0SW5kZXgoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgcmV0dXJuIGVwaC5pbmRleDtcbiAgICAgIH0sXG4gICAgICBnZXRMZW5ndGgoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbWFwU3RvcmUgfSA9IHN0YXRlO1xuICAgICAgICByZXR1cm4gbWFwU3RvcmUuZ2V0U2l6ZSgpO1xuICAgICAgfSxcbiAgICAgIGlzUmVwbGF5aW5nKCkge1xuICAgICAgICBjb25zdCB7IHN0YXRlLCBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IG1hcFN0b3JlIH0gPSBzdGF0ZTtcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgcmV0dXJuIGVwaC51bmZpbHRlcmVkSW5kZXggPCBtYXBTdG9yZS5nZXRTaXplKCk7XG4gICAgICB9LFxuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBwZWVrRW50cnkoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUsIHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbWFwU3RvcmUgfSA9IHN0YXRlO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICBzZWxmLmlzUmVwbGF5aW5nKCkgfHwgdGhyb3dSZWRhY3RlZGBObyBsb25nZXIgcmVwbGF5aW5nOiAke3F1b3RlKGVwaC51bmZpbHRlcmVkSW5kZXgpfSB2cyAke3F1b3RlKFxuICAgICAgICAgIG1hcFN0b3JlLmdldFNpemUoKVxuICAgICAgICApfWA7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG1hcFN0b3JlLmdldChlcGgudW5maWx0ZXJlZEluZGV4KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0sXG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIG5leHRVbmZpbHRlcmVkRW50cnkoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gc2VsZi5wZWVrRW50cnkoKTtcbiAgICAgICAgZXBoLnVuZmlsdGVyZWRJbmRleCArPSAxO1xuICAgICAgICBpZiAoZW50cnlJc1Zpc2libGUocmVzdWx0KSkge1xuICAgICAgICAgIGVwaC5pbmRleCArPSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmICghc2VsZi5pc1JlcGxheWluZygpKSB7XG4gICAgICAgICAgZXBoLnJlcGxheURvbmVLaXQucmVzb2x2ZSh2b2lkIDApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9LFxuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBuZXh0RW50cnkoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgbGV0IHJlc3VsdCA9IHNlbGYubmV4dFVuZmlsdGVyZWRFbnRyeSgpO1xuICAgICAgICB3aGlsZSAoIWVudHJ5SXNWaXNpYmxlKHJlc3VsdCkpIHtcbiAgICAgICAgICBzZWxmLmlzUmVwbGF5aW5nKCkgfHwgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIGVudHJ5IGF0IGxvZyB0YWlsOiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJlc3VsdCA9IHNlbGYubmV4dFVuZmlsdGVyZWRFbnRyeSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9LFxuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBwdXNoRW50cnkobGF0ZXN0RW50cnkpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSwgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtYXBTdG9yZSB9ID0gc3RhdGU7XG4gICAgICAgIGNvbnN0IGVwaCA9IHRtcC5mb3Ioc2VsZik7XG4gICAgICAgICFzZWxmLmlzUmVwbGF5aW5nKCkgfHwgdGhyb3dSZWRhY3RlZGBzdGlsbCByZXBsYXlpbmc6ICR7cXVvdGUoZXBoLnVuZmlsdGVyZWRJbmRleCl9IHZzICR7cXVvdGUobWFwU3RvcmUuZ2V0U2l6ZSgpKX1gO1xuICAgICAgICBjb25zdCBwdXNoT25lID0gKGVudHJ5KSA9PiB7XG4gICAgICAgICAgZXBoLnVuZmlsdGVyZWRJbmRleCA9PT0gbWFwU3RvcmUuZ2V0U2l6ZSgpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IHVuZmlsdGVyZWRJbmRleCBjb25mdXNpb24gJHtxdW90ZShlcGgudW5maWx0ZXJlZEluZGV4KX0gdnMgJHtxdW90ZShcbiAgICAgICAgICAgIG1hcFN0b3JlLmdldFNpemUoKVxuICAgICAgICAgICl9YDtcbiAgICAgICAgICBtYXBTdG9yZS5pbml0KGVwaC51bmZpbHRlcmVkSW5kZXgsIGVudHJ5KTtcbiAgICAgICAgICBlcGgudW5maWx0ZXJlZEluZGV4ICs9IDE7XG4gICAgICAgICAgaWYgKGVudHJ5SXNWaXNpYmxlKGVudHJ5KSkge1xuICAgICAgICAgICAgZXBoLmluZGV4ICs9IDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVwaC51bmZpbHRlcmVkSW5kZXggPT09IG1hcFN0b3JlLmdldFNpemUoKSB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiB1bmZpbHRlcmVkSW5kZXggY29uZnVzaW9uICR7cXVvdGUoZXBoLnVuZmlsdGVyZWRJbmRleCl9IHZzICR7cXVvdGUoXG4gICAgICAgICAgICBtYXBTdG9yZS5nZXRTaXplKClcbiAgICAgICAgICApfWA7XG4gICAgICAgIH07XG4gICAgICAgIGlmIChlcGguaW5pdGlhbFB1c2gpIHtcbiAgICAgICAgICBjb25zdCBpbml0aWFsRW50cmllcyA9IGVwaC5pbml0aWFsUHVzaDtcbiAgICAgICAgICBlcGguaW5pdGlhbFB1c2ggPSB2b2lkIDA7XG4gICAgICAgICAgZm9yIChjb25zdCBpbml0aWFsRW50cnkgb2YgaW5pdGlhbEVudHJpZXMpIHtcbiAgICAgICAgICAgIHB1c2hPbmUoaW5pdGlhbEVudHJ5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcHVzaE9uZShsYXRlc3RFbnRyeSk7XG4gICAgICAgIHJldHVybiBlcGgudW5maWx0ZXJlZEluZGV4O1xuICAgICAgfSxcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgZHVtcFVuZmlsdGVyZWQoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbWFwU3RvcmUgfSA9IHN0YXRlO1xuICAgICAgICBjb25zdCBsZW4gPSBtYXBTdG9yZS5nZXRTaXplKCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpMyA9IDA7IGkzIDwgbGVuOyBpMyArPSAxKSB7XG4gICAgICAgICAgcmVzdWx0LnB1c2gobWFwU3RvcmUuZ2V0KGkzKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGhhcmRlbihyZXN1bHQpO1xuICAgICAgfSxcbiAgICAgIGR1bXAoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIGhhcmRlbihzZWxmLmR1bXBVbmZpbHRlcmVkKCkuZmlsdGVyKGVudHJ5SXNWaXNpYmxlKSk7XG4gICAgICB9LFxuICAgICAgcHJvbWlzZVJlcGxheURvbmUoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgcmV0dXJuIGVwaC5yZXBsYXlEb25lS2l0LnByb21pc2U7XG4gICAgICB9XG4gICAgfVxuICApO1xufTtcblxuLy9cbnZhciBCaWplY3Rpb25JID0gTS5pbnRlcmZhY2UoXCJCaWplY3Rpb25cIiwge1xuICByZXNldDogTS5jYWxsKCkucmV0dXJucygpLFxuICB1bndyYXBJbml0OiBNLmNhbGwoTS5yYXcoKSwgTS5hbnkoKSkucmV0dXJucyhNLnJhdygpKSxcbiAgaGFzR3Vlc3Q6IE0uY2FsbChNLnJhdygpKS5yZXR1cm5zKE0uYm9vbGVhbigpKSxcbiAgaGFzSG9zdDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICBoYXM6IE0uY2FsbChNLnJhdygpLCBNLmFueSgpKS5yZXR1cm5zKE0uYm9vbGVhbigpKSxcbiAgZ3Vlc3RUb0hvc3Q6IE0uY2FsbChNLnJhdygpKS5yZXR1cm5zKE0uYW55KCkpLFxuICBob3N0VG9HdWVzdDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoTS5yYXcoKSlcbn0pO1xudmFyIHRvS2V5ID0gKGspID0+IChcbiAgLy9cbiAgaXNQYXNzYWJsZShrKSA/IHRvUGFzc2FibGVDYXAoaykgOiBrXG4pO1xudmFyIG1ha2VWb3dpc2hTdG9yZSA9IChuYW1lKSA9PiB7XG4gIGNvbnN0IG1hcCA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIHJldHVybiBGYXIobmFtZSwge1xuICAgIGluaXQ6IChrLCB2MikgPT4ge1xuICAgICAgY29uc3QgazIgPSB0b0tleShrKTtcbiAgICAgICFtYXAuaGFzKGsyKSB8fCAvL1xuICAgICAgdGhyb3dSZWRhY3RlZGAke2JhcmVPclF1b3RlKG5hbWUpfSBrZXkgYWxyZWFkeSBib3VuZDogJHtrfSAtPiAke21hcC5nZXQoazIpfSB2cyAke3YyfWA7XG4gICAgICBtYXAuc2V0KGsyLCB2Mik7XG4gICAgfSxcbiAgICBoYXM6IChrKSA9PiBtYXAuaGFzKHRvS2V5KGspKSxcbiAgICBnZXQ6IChrKSA9PiB7XG4gICAgICBjb25zdCBrMiA9IHRvS2V5KGspO1xuICAgICAgbWFwLmhhcyhrMikgfHwgLy9cbiAgICAgIHRocm93UmVkYWN0ZWRgJHtiYXJlT3JRdW90ZShuYW1lKX0ga2V5IG5vdCBmb3VuZDogJHtrfWA7XG4gICAgICByZXR1cm4gbWFwLmdldChrMik7XG4gICAgfVxuICB9KTtcbn07XG52YXIgcHJlcGFyZUJpamVjdGlvbiA9ICh6b25lLCB1bndyYXAgPSAoX2hvc3RXcmFwcGVyLCBndWVzdFdyYXBwZXIpID0+IGd1ZXN0V3JhcHBlcikgPT4ge1xuICBjb25zdCBnMmggPSBtYWtlRXBoZW1lcmEoKCkgPT4gbWFrZVZvd2lzaFN0b3JlKFwiZ3Vlc3RUb0hvc3RcIikpO1xuICBjb25zdCBoMmcgPSBtYWtlRXBoZW1lcmEoKCkgPT4gbWFrZVZvd2lzaFN0b3JlKFwiaG9zdFRvR3Vlc3RcIikpO1xuICByZXR1cm4gem9uZS5leG9DbGFzcyhcIkJpamVjdGlvblwiLCBCaWplY3Rpb25JLCAoKSA9PiAoe30pLCB7XG4gICAgcmVzZXQoKSB7XG4gICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICBnMmgucmVzZXRGb3Ioc2VsZik7XG4gICAgICBoMmcucmVzZXRGb3Ioc2VsZik7XG4gICAgfSxcbiAgICB1bndyYXBJbml0KGczLCBoKSB7XG4gICAgICBoYXJkZW4oZzMpO1xuICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgY29uc3QgZ3Vlc3RUb0hvc3QgPSBnMmguZm9yKHNlbGYpO1xuICAgICAgY29uc3QgaG9zdFRvR3Vlc3QgPSBoMmcuZm9yKHNlbGYpO1xuICAgICAgY29uc3QgZ1Vud3JhcHBlZCA9IHVud3JhcChoLCBnMyk7XG4gICAgICAhaG9zdFRvR3Vlc3QuaGFzKGgpIHx8IHRocm93UmVkYWN0ZWRgaG9zdFRvR3Vlc3Qga2V5IGFscmVhZHkgYm91bmQ6ICR7aH0gLT4gJHtob3N0VG9HdWVzdC5nZXQoaCl9IHZzICR7Z1Vud3JhcHBlZH1gO1xuICAgICAgZ3Vlc3RUb0hvc3QuaW5pdChnVW53cmFwcGVkLCBoKTtcbiAgICAgIGhvc3RUb0d1ZXN0LmluaXQoaCwgZ1Vud3JhcHBlZCk7XG4gICAgICBzZWxmLmhhcyhnVW53cmFwcGVkLCBoKSB8fCAvL1xuICAgICAgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogJHtnM30gPC0+ICR7aH1gO1xuICAgICAgaWYgKGczICE9PSBnVW53cmFwcGVkKSB7XG4gICAgICAgICFndWVzdFRvSG9zdC5oYXMoZzMpIHx8IC8vXG4gICAgICAgIHRocm93UmVkYWN0ZWRgaGlkZGVuIGd1ZXN0IHdyYXBwZXIgYWxyZWFkeSBib3VuZCAke2czfWA7XG4gICAgICAgIGd1ZXN0VG9Ib3N0LmluaXQoZzMsIGgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGdVbndyYXBwZWQ7XG4gICAgfSxcbiAgICBoYXNHdWVzdChnMykge1xuICAgICAgaGFyZGVuKGczKTtcbiAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgIGNvbnN0IGd1ZXN0VG9Ib3N0ID0gZzJoLmZvcihzZWxmKTtcbiAgICAgIHJldHVybiBndWVzdFRvSG9zdC5oYXMoZzMpO1xuICAgIH0sXG4gICAgaGFzSG9zdChoKSB7XG4gICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICBjb25zdCBob3N0VG9HdWVzdCA9IGgyZy5mb3Ioc2VsZik7XG4gICAgICByZXR1cm4gaG9zdFRvR3Vlc3QuaGFzKGgpO1xuICAgIH0sXG4gICAgaGFzKGczLCBoKSB7XG4gICAgICBoYXJkZW4oZzMpO1xuICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgY29uc3QgZ3Vlc3RUb0hvc3QgPSBnMmguZm9yKHNlbGYpO1xuICAgICAgY29uc3QgaG9zdFRvR3Vlc3QgPSBoMmcuZm9yKHNlbGYpO1xuICAgICAgaWYgKGd1ZXN0VG9Ib3N0LmhhcyhnMykpIHtcbiAgICAgICAgdG9QYXNzYWJsZUNhcChndWVzdFRvSG9zdC5nZXQoZzMpKSA9PT0gdG9QYXNzYWJsZUNhcChoKSB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBnLT5oICR7ZzN9IC0+ICR7aH0gdnMgJHtndWVzdFRvSG9zdC5nZXQoZzMpfWA7XG4gICAgICAgIGhvc3RUb0d1ZXN0LmdldChoKSA9PT0gZzMgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbCBoLT5nOiAke2h9IC0+ICR7ZzN9IHZzICR7aG9zdFRvR3Vlc3QuZ2V0KGgpfWA7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgIWhvc3RUb0d1ZXN0LmhhcyhoKSB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiB1bmV4cGVjdGVkIGgtPmcgJHtofSAtPiAke2hvc3RUb0d1ZXN0LmdldChoKX1gO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfSxcbiAgICBndWVzdFRvSG9zdChnMykge1xuICAgICAgaGFyZGVuKGczKTtcbiAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgIGNvbnN0IGd1ZXN0VG9Ib3N0ID0gZzJoLmZvcihzZWxmKTtcbiAgICAgIHJldHVybiBndWVzdFRvSG9zdC5nZXQoZzMpO1xuICAgIH0sXG4gICAgaG9zdFRvR3Vlc3QoaCkge1xuICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgY29uc3QgaG9zdFRvR3Vlc3QgPSBoMmcuZm9yKHNlbGYpO1xuICAgICAgcmV0dXJuIGhvc3RUb0d1ZXN0LmdldChoKTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihwcmVwYXJlQmlqZWN0aW9uKTtcblxuLy9cbnZhciB7XG4gIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yNCxcbiAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczgsXG4gIGNyZWF0ZTogY3JlYXRlNyxcbiAgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTQsXG4gIGVudHJpZXM6IGVudHJpZXM5LFxuICBwcm90b3R5cGU6IG9iamVjdFByb3RvdHlwZTZcbn0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzMjIgfSA9IFJlZmxlY3Q7XG52YXIgRnVuY3Rpb25XcmFwcGVySSA9IE0uaW50ZXJmYWNlKFwiRnVuY3Rpb25XcmFwcGVyXCIsIHtcbiAgYXBwbHk6IE0uY2FsbChNLmFycmF5KCkpLnJldHVybnMoTS5hbnkoKSlcbn0pO1xudmFyIFN0YXRlQWNjZXNzb3JJID0gTS5pbnRlcmZhY2UoXCJTdGF0ZUFjY2Vzc29yXCIsIHtcbiAgZ2V0OiBNLmNhbGwoUHJvcGVydHlLZXlTaGFwZSkucmV0dXJucyhNLmFueSgpKSxcbiAgc2V0OiBNLmNhbGwoUHJvcGVydHlLZXlTaGFwZSwgTS5hbnkoKSkucmV0dXJucygpXG59KTtcbnZhciBVbndyYXBwZXJJID0gTS5pbnRlcmZhY2UoXCJVbndyYXBwZXJcIiwge1xuICB1bndyYXA6IE0uY2FsbChNLnJlbW90YWJsZShcImd1ZXN0V3JhcHBlZFwiKSkucmV0dXJucyhNLnJhdygpKVxufSk7XG52YXIgZm9yd2FyZGluZ01ldGhvZHMgPSAocmVtKSA9PiB7XG4gIGNvbnN0IGtleXM4ID0gcmVtW0dFVF9NRVRIT0RfTkFNRVNdKCk7XG4gIGNvbnN0IG1ha2VNZXRob2RFbnRyeSA9IChrZXkpID0+IGVudHJpZXM5KHtcbiAgICBba2V5XSguLi5hcmdzKSB7XG4gICAgICByZXR1cm4gcmVtW2tleV0oLi4uYXJncyk7XG4gICAgfVxuICB9KVswXTtcbiAgcmV0dXJuIGZyb21FbnRyaWVzMTQoa2V5czgubWFwKG1ha2VNZXRob2RFbnRyeSkpO1xufTtcbnZhciBwcmVwYXJlRW5kb3dtZW50VG9vbHMgPSAob3V0ZXJab25lLCBvdXRlck9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IHZvd1Rvb2xzID0gcHJlcGFyZVN3aW5nc2V0Vm93VG9vbHMob3V0ZXJab25lKSB9ID0gb3V0ZXJPcHRpb25zO1xuICBjb25zdCB7IG1ha2VWb3dLaXQgfSA9IHZvd1Rvb2xzO1xuICBjb25zdCBmdW5jdGlvblVud3JhcHBlciA9IG91dGVyWm9uZS5leG8oXCJGdW5jdGlvblVud3JhcHBlclwiLCBVbndyYXBwZXJJLCB7XG4gICAgdW53cmFwKGd1ZXN0V3JhcHBlZCkge1xuICAgICAgcmV0dXJuIEZhcihcIlVud3JhcHBlZEZ1bmN0aW9uXCIsICguLi5hcmdzKSA9PiBndWVzdFdyYXBwZWQuYXBwbHkoYXJncykpO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IG1ha2VTdGF0ZVVud3JhcHBlciA9IG91dGVyWm9uZS5leG9DbGFzcyhcbiAgICBcIlN0YXRlVW53cmFwcGVyXCIsXG4gICAgVW53cmFwcGVySSxcbiAgICAoa2V5czgpID0+ICh7IGtleXM6IGtleXM4IH0pLFxuICAgIHtcbiAgICAgIHVud3JhcChndWVzdFdyYXBwZWQpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBrZXlzOiBrZXlzOCB9ID0gc3RhdGU7XG4gICAgICAgIHJldHVybiBoYXJkZW4oXG4gICAgICAgICAgY3JlYXRlNyhcbiAgICAgICAgICAgIG9iamVjdFByb3RvdHlwZTYsXG4gICAgICAgICAgICBmcm9tRW50cmllczE0KFxuICAgICAgICAgICAgICBrZXlzOC5mbGF0TWFwKFxuICAgICAgICAgICAgICAgIChrZXkpID0+IGVudHJpZXM5KFxuICAgICAgICAgICAgICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczgoe1xuICAgICAgICAgICAgICAgICAgICBnZXQgW2tleV0oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGd1ZXN0V3JhcHBlZC5nZXQoa2V5KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc2V0IFtrZXldKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgZ3Vlc3RXcmFwcGVkLnNldChrZXksIG5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBlbmRvd21lbnRLaW5kT2YgPSAoZTIpID0+IHtcbiAgICBoYXJkZW4oZTIpO1xuICAgIGlmIChpc1Byb21pc2UoZTIpKSB7XG4gICAgICByZXR1cm4gXCJwcm9taXNlXCI7XG4gICAgfSBlbHNlIGlmIChvdXRlclpvbmUuaXNTdG9yYWJsZShlMikpIHtcbiAgICAgIHJldHVybiBcInN0b3JhYmxlXCI7XG4gICAgfSBlbHNlIGlmIChpc1Bhc3NhYmxlKGUyKSAmJiBpc1JlbW90YWJsZShlMikpIHtcbiAgICAgIHJldHVybiBcImZhclwiO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGUyID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIHJldHVybiBcImZ1bmN0aW9uXCI7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZTIgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGlmIChlMiA9PT0gbnVsbCkge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBudWxsIGlzIGFsd2F5cyBzdG9yYWJsZWA7XG4gICAgICB9XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShlMikpIHtcbiAgICAgICAgcmV0dXJuIFwiYXJyYXlcIjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGtleXM4ID0gb3duS2V5czIyKGUyKTtcbiAgICAgIGtleXM4Lmxlbmd0aCA+PSAxIHx8IHRocm93UmVkYWN0ZWRgZW1wdHkgcmVjb3JkIHNob3VsZCBiZSBzdG9yYWJsZSAke2UyfWA7XG4gICAgICBjb25zdCBkZXNjID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yNChlMiwga2V5czhbMF0pXG4gICAgICApO1xuICAgICAgaWYgKFwidmFsdWVcIiBpbiBkZXNjKSB7XG4gICAgICAgIHJldHVybiBcInJlY29yZFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgXCJnZXRcIiBpbiBkZXNjIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IHVuZXhwZWN0ZWQgZGVzY3JpcHRvciAke2Rlc2N9YDtcbiAgICAgICAgcmV0dXJuIFwic3RhdGVcIjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGVuZG93bWVudCAke2UyfWA7XG4gICAgfVxuICB9O1xuICBoYXJkZW4oZW5kb3dtZW50S2luZE9mKTtcbiAgY29uc3QgdW53cmFwTWFwID0gb3V0ZXJab25lLndlYWtNYXBTdG9yZShcInVud3JhcE1hcFwiLCB7XG4gICAga2V5U2hhcGU6IE0ucmVtb3RhYmxlKFwid3JhcHBlZFwiKSxcbiAgICB2YWx1ZVNoYXBlOiBNLnJlbW90YWJsZShcInVud3JhcHBlclwiKVxuICB9KTtcbiAgY29uc3QgdW53cmFwTWFwSGFzID0gKGspID0+IHtcbiAgICBpZiAoaXNWb3coaykgfHwgaXNSZW1vdGFibGUoaykpIHtcbiAgICAgIHJldHVybiB1bndyYXBNYXAuaGFzKHRvUGFzc2FibGVDYXAoaykpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xuICBjb25zdCB1bndyYXBNYXBHZXQgPSAoaykgPT4gdW53cmFwTWFwLmdldCh0b1Bhc3NhYmxlQ2FwKGspKTtcbiAgY29uc3QgdW53cmFwTWFwU2V0ID0gKGssIHYyKSA9PiB7XG4gICAgY29uc3QgazIgPSB0b1Bhc3NhYmxlQ2FwKGspO1xuICAgIGlmICh1bndyYXBNYXBIYXMoaykpIHtcbiAgICAgIHVud3JhcE1hcC5zZXQoazIsIHYyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdW53cmFwTWFwLmluaXQoazIsIHYyKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHByZXBhcmVFbmRvd21lbnQgPSAoem9uZSwgdGFnLCBlMikgPT4ge1xuICAgIGNvbnN0IGVLaW5kID0gZW5kb3dtZW50S2luZE9mKGUyKTtcbiAgICBzd2l0Y2ggKGVLaW5kKSB7XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIGNvbnN0IHA0ID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBlMlxuICAgICAgICApO1xuICAgICAgICBjb25zdCB7IHZvdywgcmVzb2x2ZXIgfSA9IG1ha2VWb3dLaXQoKTtcbiAgICAgICAgdm9pZCBFLndoZW4oXG4gICAgICAgICAgcDQsXG4gICAgICAgICAgKHYyKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlci5yZXNvbHZlKHYyKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIChyZWFzb24pID0+IHtcbiAgICAgICAgICAgIGlmICghaXNVcGdyYWRlRGlzY29ubmVjdGlvbihyZWFzb24pKSB7XG4gICAgICAgICAgICAgIHJlc29sdmVyLnJlamVjdChyZWFzb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHZvdztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJzdG9yYWJsZVwiOiB7XG4gICAgICAgIHJldHVybiBlMjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJmYXJcIjoge1xuICAgICAgICBjb25zdCByNSA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBlMlxuICAgICAgICApO1xuICAgICAgICBjb25zdCBtZXRob2RzID0gZm9yd2FyZGluZ01ldGhvZHMocjUpO1xuICAgICAgICByZXR1cm4gem9uZS5leG8oXG4gICAgICAgICAgdGFnLFxuICAgICAgICAgIE0uaW50ZXJmYWNlKFwiRmFyV3JhcHBlZFwiLCB7fSwgeyBkZWZhdWx0R3VhcmRzOiBcInJhd1wiIH0pLFxuICAgICAgICAgIG1ldGhvZHNcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJmdW5jdGlvblwiOiB7XG4gICAgICAgIGNvbnN0IGYyID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgZTJcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3Qgd3JhcHBlZCA9IHpvbmUuZXhvKHRhZywgRnVuY3Rpb25XcmFwcGVySSwge1xuICAgICAgICAgIGFwcGx5KGFyZ3MpIHtcbiAgICAgICAgICAgIHJldHVybiBmMiguLi5hcmdzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB1bndyYXBNYXBTZXQod3JhcHBlZCwgZnVuY3Rpb25VbndyYXBwZXIpO1xuICAgICAgICByZXR1cm4gd3JhcHBlZDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJhcnJheVwiOiB7XG4gICAgICAgIGNvbnN0IGEyID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGUyXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHN1YlpvbmUgPSB6b25lLnN1YlpvbmUodGFnKTtcbiAgICAgICAgcmV0dXJuIGEyLm1hcCgoc3ViRSwgaTMpID0+IHByZXBhcmVFbmRvd21lbnQoc3ViWm9uZSwgYCR7aTN9YCwgc3ViRSkpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInJlY29yZFwiOiB7XG4gICAgICAgIGNvbnN0IHI1ID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBlMlxuICAgICAgICApO1xuICAgICAgICBjb25zdCBzdWJab25lID0gem9uZS5zdWJab25lKHRhZyk7XG4gICAgICAgIHJldHVybiBvYmplY3RNYXAoXG4gICAgICAgICAgcjUsXG4gICAgICAgICAgKHN1YkUsIGspID0+IHByZXBhcmVFbmRvd21lbnQoc3ViWm9uZSwgU3RyaW5nKGspLCBzdWJFKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0YXRlXCI6IHtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGUyXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGtleXM4ID0gaGFyZGVuKG93bktleXMyMihzdGF0ZSkpO1xuICAgICAgICBjb25zdCB3cmFwcGVkID0gem9uZS5leG8odGFnLCBTdGF0ZUFjY2Vzc29ySSwge1xuICAgICAgICAgIGdldChrZXkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZVtrZXldO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2V0KGtleSwgbmV3VmFsdWUpIHtcbiAgICAgICAgICAgIHN0YXRlW2tleV0gPSBuZXdWYWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBzdGF0ZVVud3JhcHBlciA9IG1ha2VTdGF0ZVVud3JhcHBlcihrZXlzOCk7XG4gICAgICAgIHVud3JhcE1hcFNldCh3cmFwcGVkLCBzdGF0ZVVud3JhcHBlcik7XG4gICAgICAgIHJldHVybiB3cmFwcGVkO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZW5kb3dtZW50ICR7ZTJ9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IHVud3JhcCA9ICh3cmFwcGVkLCBndWVzdFdyYXBwZWQpID0+IHtcbiAgICBpZiAodW53cmFwTWFwSGFzKHdyYXBwZWQpKSB7XG4gICAgICBjb25zdCB1bndyYXBwZXIgPSB1bndyYXBNYXBHZXQod3JhcHBlZCk7XG4gICAgICByZXR1cm4gdW53cmFwcGVyLnVud3JhcChndWVzdFdyYXBwZWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZ3Vlc3RXcmFwcGVkO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IHByZXBhcmVFbmRvd21lbnQsIHVud3JhcCB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZUVuZG93bWVudFRvb2xzKTtcblxuLy9cbnZhciB7IGRlZmluZVByb3BlcnRpZXM6IGRlZmluZVByb3BlcnRpZXM2IH0gPSBPYmplY3Q7XG52YXIgQXN5bmNGbG93SUtpdCA9IGhhcmRlbih7XG4gIGZsb3c6IE0uaW50ZXJmYWNlKFwiRmxvd1wiLCB7XG4gICAgZ2V0Rmxvd1N0YXRlOiBNLmNhbGwoKS5yZXR1cm5zKEZsb3dTdGF0ZVNoYXBlKSxcbiAgICByZXN0YXJ0OiBNLmNhbGwoKS5vcHRpb25hbChNLmJvb2xlYW4oKSkucmV0dXJucygpLFxuICAgIHdha2U6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgICBnZXRPdXRjb21lOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgICBkdW1wOiBNLmNhbGwoKS5yZXR1cm5zKE0uYXJyYXlPZihMb2dFbnRyeVNoYXBlKSksXG4gICAgZ2V0T3B0RmF0YWxQcm9ibGVtOiBNLmNhbGwoKS5yZXR1cm5zKE0ub3B0KE0uZXJyb3IoKSkpXG4gIH0pLFxuICBhZG1pbjogTS5pbnRlcmZhY2UoXCJGbG93QWRtaW5cIiwge1xuICAgIHJlc2V0OiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gICAgY29tcGxldGU6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgICBwYW5pYzogTS5jYWxsKE0uZXJyb3IoKSkucmV0dXJucyhNLm5vdChNLmFueSgpKSlcbiAgICAvL1xuICB9KSxcbiAgd2FrZVdhdGNoZXI6IFByb21pc2VXYXRjaGVySVxufSk7XG52YXIgQWRtaW5Bc3luY0Zsb3dJID0gTS5pbnRlcmZhY2UoXCJBc3luY0Zsb3dBZG1pblwiLCB7XG4gIGdldEZhaWx1cmVzOiBNLmNhbGwoKS5yZXR1cm5zKE0ubWFwT2YoTS5yZW1vdGFibGUoXCJhc3luY0Zsb3dcIiksIE0uZXJyb3IoKSkpLFxuICB3YWtlQWxsOiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gIGdldEZsb3dGb3JPdXRjb21lVm93OiBNLmNhbGwoVm93U2hhcGUpLnJldHVybnMoTS5vcHQoTS5yZW1vdGFibGUoXCJmbG93XCIpKSlcbn0pO1xudmFyIHByZXBhcmVBc3luY0Zsb3dUb29scyA9IChvdXRlclpvbmUsIG91dGVyT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICB2b3dUb29scyA9IHByZXBhcmVTd2luZ3NldFZvd1Rvb2xzKG91dGVyWm9uZSksXG4gICAgbWFrZUxvZ1N0b3JlID0gcHJlcGFyZUxvZ1N0b3JlKG91dGVyWm9uZSksXG4gICAgZW5kb3dtZW50VG9vbHM6IHsgcHJlcGFyZUVuZG93bWVudCwgdW53cmFwIH0gPSBwcmVwYXJlRW5kb3dtZW50VG9vbHMoXG4gICAgICBvdXRlclpvbmUsXG4gICAgICB7IHZvd1Rvb2xzIH1cbiAgICApLFxuICAgIG1ha2VCaWplY3Rpb24gPSBwcmVwYXJlQmlqZWN0aW9uKG91dGVyWm9uZSwgdW53cmFwKSxcbiAgICBwYW5pY0hhbmRsZXIgPSAoZXJyKSA9PiB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9ID0gb3V0ZXJPcHRpb25zO1xuICBjb25zdCB7IHdhdGNoLCBtYWtlVm93S2l0IH0gPSB2b3dUb29scztcbiAgY29uc3QgZmFpbHVyZXMgPSBvdXRlclpvbmUubWFwU3RvcmUoXCJhc3luY0Z1bmNGYWlsdXJlc1wiLCB7XG4gICAga2V5U2hhcGU6IE0ucmVtb3RhYmxlKFwiZmxvd1wiKSxcbiAgICAvL1xuICAgIHZhbHVlU2hhcGU6IE0uZXJyb3IoKVxuICB9KTtcbiAgY29uc3QgZWFnZXJXYWtlcnMgPSBvdXRlclpvbmUuc2V0U3RvcmUoYGFzeW5jRnVuY0VhZ2VyV2FrZXJzYCwge1xuICAgIGtleVNoYXBlOiBNLnJlbW90YWJsZShcImZsb3dcIilcbiAgICAvL1xuICB9KTtcbiAgY29uc3QgbWVtYnJhbmVNYXAgPSBtYWtlU2NhbGFyV2Vha01hcFN0b3JlKFwibWVtYnJhbmVGb3JcIiwge1xuICAgIGtleVNoYXBlOiBNLnJlbW90YWJsZShcImZsb3dcIiksXG4gICAgdmFsdWVTaGFwZTogTS5yZW1vdGFibGUoXCJtZW1icmFuZVwiKVxuICB9KTtcbiAgY29uc3QgaGFzTWVtYnJhbmUgPSAoZmxvdykgPT4gbWVtYnJhbmVNYXAuaGFzKGZsb3cpO1xuICBjb25zdCBnZXRNZW1icmFuZSA9IChmbG93KSA9PiBtZW1icmFuZU1hcC5nZXQoZmxvdyk7XG4gIGNvbnN0IGluaXRNZW1icmFuZSA9IChmbG93LCBtZW1icmFuZSkgPT4gbWVtYnJhbmVNYXAuaW5pdChmbG93LCBtZW1icmFuZSk7XG4gIGNvbnN0IGRlbGV0ZU1lbWJyYW5lID0gKGZsb3cpID0+IG1lbWJyYW5lTWFwLmRlbGV0ZShmbG93KTtcbiAgY29uc3QgZmxvd0Zvck91dGNvbWVWb3dLZXkgPSBvdXRlclpvbmUubWFwU3RvcmUoXCJmbG93Rm9yT3V0Y29tZVZvd1wiLCB7XG4gICAga2V5U2hhcGU6IE0ucmVtb3RhYmxlKFwidG9QYXNzYWJsZUNhcFwiKSxcbiAgICB2YWx1ZVNoYXBlOiBNLnJlbW90YWJsZShcImZsb3dcIilcbiAgICAvL1xuICB9KTtcbiAgY29uc3QgcHJlcGFyZUFzeW5jRmxvd0tpdCA9ICh6b25lLCB0YWcsIGd1ZXN0QXN5bmNGdW5jLCBvcHRpb25zID0ge30pID0+IHtcbiAgICB0eXBlb2YgZ3Vlc3RBc3luY0Z1bmMgPT09IFwiZnVuY3Rpb25cIiB8fCB0aHJvd1JlZGFjdGVkYGd1ZXN0QXN5bmNGdW5jIG11c3QgYmUgYSBjYWxsYWJsZSBmdW5jdGlvbiAke2d1ZXN0QXN5bmNGdW5jfWA7XG4gICAgY29uc3Qge1xuICAgICAgLy9cbiAgICAgIHN0YXJ0RWFnZXIgPSB0cnVlXG4gICAgfSA9IG9wdGlvbnM7XG4gICAgY29uc3QgaW50ZXJuYWxNYWtlQXN5bmNGbG93S2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICAgIHRhZyxcbiAgICAgIEFzeW5jRmxvd0lLaXQsXG4gICAgICAoYWN0aXZhdGlvbkFyZ3MpID0+IHtcbiAgICAgICAgaGFyZGVuKGFjdGl2YXRpb25BcmdzKTtcbiAgICAgICAgY29uc3QgbG9nID0gbWFrZUxvZ1N0b3JlKCk7XG4gICAgICAgIGNvbnN0IGJpamVjdGlvbiA9IG1ha2VCaWplY3Rpb24oKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhY3RpdmF0aW9uQXJncyxcbiAgICAgICAgICAvL1xuICAgICAgICAgIGxvZyxcbiAgICAgICAgICAvL1xuICAgICAgICAgIGJpamVjdGlvbixcbiAgICAgICAgICAvL1xuICAgICAgICAgIG91dGNvbWVLaXQ6IG1ha2VWb3dLaXQoKSxcbiAgICAgICAgICAvL1xuICAgICAgICAgIGlzRG9uZTogZmFsc2VcbiAgICAgICAgICAvL1xuICAgICAgICB9O1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgZmxvdzoge1xuICAgICAgICAgIC8qXG5cbiAgICAgICAgICAgKi9cbiAgICAgICAgICBnZXRGbG93U3RhdGUoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGxvZywgb3V0Y29tZUtpdCwgaXNEb25lIH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgaWYgKGlzRG9uZSkge1xuICAgICAgICAgICAgICAhaGFzTWVtYnJhbmUoZmxvdykgfHwgdGhyb3dSZWRhY3RlZGBEb25lIGZsb3cgbXVzdCBkcm9wIG1lbWJyYW5lICR7Zmxvd30gJHtnZXRNZW1icmFuZShmbG93KX1gO1xuICAgICAgICAgICAgICAhZmFpbHVyZXMuaGFzKGZsb3cpIHx8IHRocm93UmVkYWN0ZWRgRG9uZSBmbG93IG11c3Qgbm90IGJlIGluIGZhaWx1cmVzICR7Zmxvd30gJHtmYWlsdXJlcy5nZXQoZmxvdyl9YDtcbiAgICAgICAgICAgICAgIWVhZ2VyV2FrZXJzLmhhcyhmbG93KSB8fCB0aHJvd1JlZGFjdGVkYERvbmUgZmxvdyBtdXN0IG5vdCBiZSBpbiBlYWdlcldha2VycyAke2Zsb3d9YDtcbiAgICAgICAgICAgICAgIWZsb3dGb3JPdXRjb21lVm93S2V5LmhhcyhvdXRjb21lS2l0LnZvdykgfHwgdGhyb3dSZWRhY3RlZGBEb25lIGZsb3cgbXVzdCBkcm9wIGZsb3cgbG9va3VwIGZyb20gdm93ICR7b3V0Y29tZUtpdC52b3d9YDtcbiAgICAgICAgICAgICAgbG9nLmdldEluZGV4KCkgPT09IDAgJiYgbG9nLmdldExlbmd0aCgpID09PSAwIHx8IHRocm93UmVkYWN0ZWRgRG9uZSBmbG93IG11c3QgZW1wdHkgbG9nICR7Zmxvd30gJHtsb2d9YDtcbiAgICAgICAgICAgICAgcmV0dXJuIFwiRG9uZVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZhaWx1cmVzLmhhcyhmbG93KSkge1xuICAgICAgICAgICAgICByZXR1cm4gXCJGYWlsZWRcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghaGFzTWVtYnJhbmUoZmxvdykpIHtcbiAgICAgICAgICAgICAgbG9nLmdldEluZGV4KCkgPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBTbGVlcGluZyBmbG93IG11c3QgcGxheSBmcm9tIGxvZyBzdGFydCAke2Zsb3d9ICR7bG9nLmdldEluZGV4KCl9YDtcbiAgICAgICAgICAgICAgcmV0dXJuIFwiU2xlZXBpbmdcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChsb2cuaXNSZXBsYXlpbmcoKSkge1xuICAgICAgICAgICAgICByZXR1cm4gXCJSZXBsYXlpbmdcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBcIlJ1bm5pbmdcIjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8qXG5cblxuXG5cbiAgICAgICAgICAgKi9cbiAgICAgICAgICByZXN0YXJ0KGVhZ2VyID0gc3RhcnRFYWdlcikge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBhY3RpdmF0aW9uQXJncywgbG9nLCBiaWplY3Rpb24sIG91dGNvbWVLaXQgfSA9IHN0YXRlO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93LCBhZG1pbiwgd2FrZVdhdGNoZXIgfSA9IGZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0Rmxvd1N0YXRlID0gZmxvdy5nZXRGbG93U3RhdGUoKTtcbiAgICAgICAgICAgIHN0YXJ0Rmxvd1N0YXRlICE9PSBcIkRvbmVcIiB8fCAvL1xuICAgICAgICAgICAgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcmVzdGFydCBhIGRvbmUgZmxvdyAke2Zsb3d9YDtcbiAgICAgICAgICAgIGFkbWluLnJlc2V0KCk7XG4gICAgICAgICAgICBpZiAoZWFnZXIpIHtcbiAgICAgICAgICAgICAgZWFnZXJXYWtlcnMuYWRkKGZsb3cpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlYWdlcldha2Vycy5oYXMoZmxvdykpIHtcbiAgICAgICAgICAgICAgZWFnZXJXYWtlcnMuZGVsZXRlKGZsb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgd2F0Y2hXYWtlID0gKHZvd2lzaCkgPT4ge1xuICAgICAgICAgICAgICB6b25lLmlzU3RvcmFibGUodm93aXNoKSB8fCB0aHJvd1JlZGFjdGVkYHZvd2lzaCBtdXN0IGJlIHN0b3JhYmxlIGluIHRoaXMgem9uZSAodXN1YWxseSwgbXVzdCBiZSBkdXJhYmxlKTogJHt2b3dpc2h9YDtcbiAgICAgICAgICAgICAgem9uZS5pc1N0b3JhYmxlKHdha2VXYXRjaGVyKSB8fCB0aHJvd1JlZGFjdGVkYHdha2VXYXRjaGVyIG11c3QgYmUgc3RvcmFibGUgaW4gdGhpcyB6b25lICh1c3VhbGx5LCBtdXN0IGJlIGR1cmFibGUpOiAke3dha2VXYXRjaGVyfWA7XG4gICAgICAgICAgICAgIHdhdGNoKHZvd2lzaCwgd2FrZVdhdGNoZXIpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IHBhbmljID0gKGVycikgPT4gYWRtaW4ucGFuaWMoZXJyKTtcbiAgICAgICAgICAgIGNvbnN0IG1lbWJyYW5lID0gbWFrZVJlcGxheU1lbWJyYW5lKHtcbiAgICAgICAgICAgICAgbG9nLFxuICAgICAgICAgICAgICBiaWplY3Rpb24sXG4gICAgICAgICAgICAgIHZvd1Rvb2xzLFxuICAgICAgICAgICAgICB3YXRjaFdha2UsXG4gICAgICAgICAgICAgIHBhbmljXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGluaXRNZW1icmFuZShmbG93LCBtZW1icmFuZSk7XG4gICAgICAgICAgICBjb25zdCBndWVzdEFyZ3MgPSBtZW1icmFuZS5ob3N0VG9HdWVzdChhY3RpdmF0aW9uQXJncyk7XG4gICAgICAgICAgICBjb25zdCBmbG93U3RhdGUgPSBmbG93LmdldEZsb3dTdGF0ZSgpO1xuICAgICAgICAgICAgZmxvd1N0YXRlID09PSBcIlJ1bm5pbmdcIiB8fCBmbG93U3RhdGUgPT09IFwiUmVwbGF5aW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBSZXN0YXJ0ZWQgZmxvdyBtdXN0IGJlIFJ1bm5pbmcgb3IgUmVwbGF5aW5nICR7Zmxvd31gO1xuICAgICAgICAgICAgbWVtYnJhbmUud2FrZSgpO1xuICAgICAgICAgICAgY29uc3QgZ3Vlc3RSZXN1bHRQID0gKGFzeW5jICgpID0+IChcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgZ3Vlc3RBc3luY0Z1bmMoLi4uZ3Vlc3RBcmdzKVxuICAgICAgICAgICAgKSkoKTtcbiAgICAgICAgICAgIGlmIChmbG93LmdldEZsb3dTdGF0ZSgpICE9PSBcIkZhaWxlZFwiKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGczID0gYmlqZWN0aW9uLnVud3JhcEluaXQoZ3Vlc3RSZXN1bHRQLCBvdXRjb21lS2l0LnZvdyk7XG4gICAgICAgICAgICAgIGczID09PSBndWVzdFJlc3VsdFAgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogcHJvbWlzZXMgc2hvdWxkIG5vdCBiZSB1bndyYXBwZWQgJHtnM31gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm9pZCBFLndoZW4oXG4gICAgICAgICAgICAgIGd1ZXN0UmVzdWx0UCxcbiAgICAgICAgICAgICAgKGdGdWxmaWxsbWVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChiaWplY3Rpb24uaGFzR3Vlc3QoZ3Vlc3RSZXN1bHRQKSkge1xuICAgICAgICAgICAgICAgICAgIWxvZy5pc1JlcGxheWluZygpIHx8IHBhbmljKFxuICAgICAgICAgICAgICAgICAgICBtYWtlRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgcmVkYWN0ZWRgZ3Vlc3QgZnVsZmlsbGVkIHdpdGggJHtnRnVsZmlsbG1lbnR9IGJlZm9yZSBmaW5pc2hpbmcgcmVwbGF5YFxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgb3V0Y29tZUtpdC5yZXNvbHZlci5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICBtZW1icmFuZS5ndWVzdFRvSG9zdChnRnVsZmlsbG1lbnQpXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgYWRtaW4uY29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIChndWVzdFJlYXNvbikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChiaWplY3Rpb24uaGFzR3Vlc3QoZ3Vlc3RSZXN1bHRQKSkge1xuICAgICAgICAgICAgICAgICAgIWxvZy5pc1JlcGxheWluZygpIHx8IHBhbmljKFxuICAgICAgICAgICAgICAgICAgICBtYWtlRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgcmVkYWN0ZWRgZ3Vlc3QgcmVqZWN0ZWQgd2l0aCAke2d1ZXN0UmVhc29ufSBiZWZvcmUgZmluaXNoaW5nIHJlcGxheWBcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIG91dGNvbWVLaXQucmVzb2x2ZXIucmVqZWN0KG1lbWJyYW5lLmd1ZXN0VG9Ib3N0KGd1ZXN0UmVhc29uKSk7XG4gICAgICAgICAgICAgICAgICBhZG1pbi5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKS50aGVuKFxuICAgICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZsb3cuZ2V0Rmxvd1N0YXRlKCkgPT09IFwiRmFpbGVkXCIpIHtcbiAgICAgICAgICAgICAgICAgIHRocm93IGZsb3cuZ2V0T3B0RmF0YWxQcm9ibGVtKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAobWF5YmVQYW5pY1JlYXNvbikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmbG93LmdldEZsb3dTdGF0ZSgpID09PSBcIkZhaWxlZFwiKSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBlcnIyID0gZmxvdy5nZXRPcHRGYXRhbFByb2JsZW0oKTtcbiAgICAgICAgICAgICAgICAgIHRocm93IGVycjI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGVyciA9IG1ha2VFcnJvcihcbiAgICAgICAgICAgICAgICAgIHJlZGFjdGVkYGludGVybmFsOiB1bmV4cGVjdGVkIGVycm9yIGluIGd1ZXN0IGNvbXBsZXRpb24gaGFuZGxpbmcgJHttYXliZVBhbmljUmVhc29ufWBcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBwYW5pYyhlcnIpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKF9lKSB7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLmNhdGNoKHBhbmljSGFuZGxlcik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB3YWtlKCkge1xuICAgICAgICAgICAgY29uc3QgeyBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3cgfSA9IGZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IGZsb3dTdGF0ZSA9IGZsb3cuZ2V0Rmxvd1N0YXRlKCk7XG4gICAgICAgICAgICBzd2l0Y2ggKGZsb3dTdGF0ZSkge1xuICAgICAgICAgICAgICBjYXNlIFwiRG9uZVwiOlxuICAgICAgICAgICAgICBjYXNlIFwiRmFpbGVkXCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY2FzZSBcIlJ1bm5pbmdcIjpcbiAgICAgICAgICAgICAgY2FzZSBcIlJlcGxheWluZ1wiOiB7XG4gICAgICAgICAgICAgICAgZ2V0TWVtYnJhbmUoZmxvdykud2FrZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjYXNlIFwiU2xlZXBpbmdcIjoge1xuICAgICAgICAgICAgICAgIGZsb3cucmVzdGFydCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGZsb3dTdGF0ZSAke3F1b3RlKGZsb3dTdGF0ZSl9YDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0T3V0Y29tZSgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IG91dGNvbWVLaXQgfSA9IHN0YXRlO1xuICAgICAgICAgICAgcmV0dXJuIG91dGNvbWVLaXQudm93O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZHVtcCgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGxvZyB9ID0gc3RhdGU7XG4gICAgICAgICAgICByZXR1cm4gbG9nLmR1bXAoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldE9wdEZhdGFsUHJvYmxlbSgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93IH0gPSBmYWNldHM7XG4gICAgICAgICAgICByZXR1cm4gZmFpbHVyZXMuaGFzKGZsb3cpID8gZmFpbHVyZXMuZ2V0KGZsb3cpIDogdm9pZCAwO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgYWRtaW46IHtcbiAgICAgICAgICByZXNldCgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgYmlqZWN0aW9uLCBsb2cgfSA9IHN0YXRlO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93IH0gPSBmYWNldHM7XG4gICAgICAgICAgICAhc3RhdGUuaXNEb25lIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlc2V0IGEgZG9uZSBmbG93YDtcbiAgICAgICAgICAgIGlmIChmYWlsdXJlcy5oYXMoZmxvdykpIHtcbiAgICAgICAgICAgICAgZmFpbHVyZXMuZGVsZXRlKGZsb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGhhc01lbWJyYW5lKGZsb3cpKSB7XG4gICAgICAgICAgICAgIGdldE1lbWJyYW5lKGZsb3cpLnN0b3AoKTtcbiAgICAgICAgICAgICAgZGVsZXRlTWVtYnJhbmUoZmxvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2cucmVzZXQoKTtcbiAgICAgICAgICAgIGJpamVjdGlvbi5yZXNldCgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY29tcGxldGUoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGxvZyB9ID0gc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3csIGFkbWluIH0gPSBmYWNldHM7XG4gICAgICAgICAgICBhZG1pbi5yZXNldCgpO1xuICAgICAgICAgICAgaWYgKGVhZ2VyV2FrZXJzLmhhcyhmbG93KSkge1xuICAgICAgICAgICAgICBlYWdlcldha2Vycy5kZWxldGUoZmxvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmbG93Rm9yT3V0Y29tZVZvd0tleS5kZWxldGUodG9QYXNzYWJsZUNhcChmbG93LmdldE91dGNvbWUoKSkpO1xuICAgICAgICAgICAgc3RhdGUuaXNEb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIGxvZy5kaXNwb3NlKCk7XG4gICAgICAgICAgICBmbG93LmdldEZsb3dTdGF0ZSgpID09PSBcIkRvbmVcIiB8fCB0aHJvd1JlZGFjdGVkYENvbXBsZXRlIGZsb3cgbXVzdCBiZSBEb25lICR7Zmxvd31gO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcGFuaWMoZmF0YWxQcm9ibGVtKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGJpamVjdGlvbiwgbG9nIH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgaWYgKGZhaWx1cmVzLmhhcyhmbG93KSkge1xuICAgICAgICAgICAgICBjb25zdCBwcmV2RXJyID0gZmFpbHVyZXMuZ2V0KGZsb3cpO1xuICAgICAgICAgICAgICBub3RlKFxuICAgICAgICAgICAgICAgIHByZXZFcnIsXG4gICAgICAgICAgICAgICAgcmVkYWN0ZWRgZG91Ymx5IGZhaWxlZCBzb21laG93IHdpdGggJHtmYXRhbFByb2JsZW19YFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBmYXRhbFByb2JsZW0gPSBwcmV2RXJyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZmFpbHVyZXMuaW5pdChmbG93LCBmYXRhbFByb2JsZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGhhc01lbWJyYW5lKGZsb3cpKSB7XG4gICAgICAgICAgICAgIGdldE1lbWJyYW5lKGZsb3cpLnN0b3AoKTtcbiAgICAgICAgICAgICAgZGVsZXRlTWVtYnJhbmUoZmxvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2cucmVzZXQoKTtcbiAgICAgICAgICAgIGJpamVjdGlvbi5yZXNldCgpO1xuICAgICAgICAgICAgZmxvdy5nZXRGbG93U3RhdGUoKSA9PT0gXCJGYWlsZWRcIiB8fCB0aHJvd1JlZGFjdGVkYFBhbmlja2VkIGZsb3cgbXVzdCBiZSBGYWlsZWQgJHtmbG93fWA7XG4gICAgICAgICAgICBjb25zdCBlcnIgPSBtYWtlRXJyb3IoXG4gICAgICAgICAgICAgIHJlZGFjdGVkYEluIGEgRmFpbGVkIHN0YXRlOiBzZWUgZ2V0RmFpbHVyZXMoKSBvciBnZXRPcHRGYXRhbFByb2JsZW0oKSBmb3IgbW9yZSBpbmZvcm1hdGlvbmBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBub3RlKGVyciwgcmVkYWN0ZWRgZHVlIHRvICR7ZmF0YWxQcm9ibGVtfWApO1xuICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgd2FrZVdhdGNoZXI6IHtcbiAgICAgICAgICBvbkZ1bGZpbGxlZChfZnVsZmlsbG1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgZmFjZXRzLmZsb3cud2FrZSgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25SZWplY3RlZChfZnVsZmlsbG1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgZmFjZXRzLmZsb3cud2FrZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gICAgY29uc3QgbWFrZUFzeW5jRmxvd0tpdCA9IChhY3RpdmF0aW9uQXJncykgPT4ge1xuICAgICAgY29uc3QgYXN5bmNGbG93S2l0ID0gaW50ZXJuYWxNYWtlQXN5bmNGbG93S2l0KGFjdGl2YXRpb25BcmdzKTtcbiAgICAgIGNvbnN0IHsgZmxvdyB9ID0gYXN5bmNGbG93S2l0O1xuICAgICAgY29uc3Qgdm93ID0gZmxvdy5nZXRPdXRjb21lKCk7XG4gICAgICBmbG93Rm9yT3V0Y29tZVZvd0tleS5pbml0KHRvUGFzc2FibGVDYXAodm93KSwgZmxvdyk7XG4gICAgICBmbG93LnJlc3RhcnQoKTtcbiAgICAgIHJldHVybiBhc3luY0Zsb3dLaXQ7XG4gICAgfTtcbiAgICByZXR1cm4gaGFyZGVuKG1ha2VBc3luY0Zsb3dLaXQpO1xuICB9O1xuICBjb25zdCBhc3luY0Zsb3cgPSAoem9uZSwgdGFnLCBndWVzdEZ1bmMsIG9wdGlvbnMgPSB2b2lkIDApID0+IHtcbiAgICBjb25zdCBtYWtlQXN5bmNGbG93S2l0ID0gcHJlcGFyZUFzeW5jRmxvd0tpdCh6b25lLCB0YWcsIGd1ZXN0RnVuYywgb3B0aW9ucyk7XG4gICAgY29uc3QgaG9zdEZ1bmNOYW1lID0gYCR7dGFnfV9ob3N0Rmxvd2A7XG4gICAgY29uc3Qgd3JhcHBlckZ1bmMgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHtcbiAgICAgICAgW2hvc3RGdW5jTmFtZV0oLi4uYXJncykge1xuICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gbWFrZUFzeW5jRmxvd0tpdChhcmdzKTtcbiAgICAgICAgICByZXR1cm4gZmxvdy5nZXRPdXRjb21lKCk7XG4gICAgICAgIH1cbiAgICAgIH1baG9zdEZ1bmNOYW1lXVxuICAgICk7XG4gICAgZGVmaW5lUHJvcGVydGllczYod3JhcHBlckZ1bmMsIHtcbiAgICAgIGxlbmd0aDogeyB2YWx1ZTogZ3Vlc3RGdW5jLmxlbmd0aCB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGhhcmRlbih3cmFwcGVyRnVuYyk7XG4gIH07XG4gIGNvbnN0IGFkbWluQXN5bmNGbG93ID0gb3V0ZXJab25lLmV4byhcIkFkbWluQXN5bmNGbG93XCIsIEFkbWluQXN5bmNGbG93SSwge1xuICAgIGdldEZhaWx1cmVzKCkge1xuICAgICAgcmV0dXJuIGZhaWx1cmVzLnNuYXBzaG90KCk7XG4gICAgfSxcbiAgICB3YWtlQWxsKCkge1xuICAgICAgY29uc3QgZmFpbHVyZXNUb1Jlc3RhcnQgPSBbLi4uZmFpbHVyZXMua2V5cygpXTtcbiAgICAgIGNvbnN0IGZsb3dzVG9XYWtlID0gWy4uLmVhZ2VyV2FrZXJzLmtleXMoKV07XG4gICAgICBmb3IgKGNvbnN0IGZsb3cgb2YgZmFpbHVyZXNUb1Jlc3RhcnQpIHtcbiAgICAgICAgZmxvdy5yZXN0YXJ0KCk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGZsb3cgb2YgZmxvd3NUb1dha2UpIHtcbiAgICAgICAgZmxvdy53YWtlKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBnZXRGbG93Rm9yT3V0Y29tZVZvdyhvdXRjb21lVm93KSB7XG4gICAgICByZXR1cm4gZmxvd0Zvck91dGNvbWVWb3dLZXkuZ2V0KHRvUGFzc2FibGVDYXAob3V0Y29tZVZvdykpO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IGFsbFdva2VuUCA9IEUud2hlbihudWxsLCAoKSA9PiBhZG1pbkFzeW5jRmxvdy53YWtlQWxsKCkpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBwcmVwYXJlQXN5bmNGbG93S2l0LFxuICAgIGFzeW5jRmxvdyxcbiAgICBhZG1pbkFzeW5jRmxvdyxcbiAgICBhbGxXb2tlblAsXG4gICAgcHJlcGFyZUVuZG93bWVudFxuICB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZUFzeW5jRmxvd1Rvb2xzKTtcblxuLy9cbnZhciBzaW5rMyA9ICgpID0+IHtcbn07XG52YXIgbWFrZVF1aWV0UmVqZWN0aW9uID0gKHJlYXNvbikgPT4ge1xuICBjb25zdCByZWplY3Rpb24gPSBoYXJkZW4oUHJvbWlzZS5yZWplY3QocmVhc29uKSk7XG4gIHZvaWQgRS53aGVuKHJlamVjdGlvbiwgc2luazMsIHNpbmszKTtcbiAgcmV0dXJuIHJlamVjdGlvbjtcbn07XG52YXIgdG9vRmFyUmVqZWN0aW9uID0gbWFrZVF1aWV0UmVqZWN0aW9uKFxuICBoYXJkZW4oRXJyb3IoXCJDYW5ub3QgcmVhZCBwYXN0IGVuZCBvZiBpdGVyYXRpb24uXCIpKVxuKTtcbnZhciBQdWJsaXNoZXJJID0gTS5pbnRlcmZhY2UoXCJQdWJsaXNoZXJcIiwge1xuICBwdWJsaXNoOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpLFxuICBmaW5pc2g6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKCksXG4gIGZhaWw6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKClcbn0pO1xudmFyIFVwZGF0ZUNvdW50U2hhcGUgPSBNLm9yKE0uYmlnaW50KCksIE0ubnVtYmVyKCkpO1xudmFyIFN1YnNjcmliZXJJID0gTS5pbnRlcmZhY2UoXCJTdWJzY3JpYmVyXCIsIHtcbiAgc3Vic2NyaWJlQWZ0ZXI6IE0uY2FsbCgpLm9wdGlvbmFsKE0uYmlnaW50KCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBnZXRVcGRhdGVTaW5jZTogTS5jYWxsKCkub3B0aW9uYWwoVXBkYXRlQ291bnRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSlcbn0pO1xudmFyIHB1Ymxpc2hLaXRJS2l0ID0gaGFyZGVuKHtcbiAgcHVibGlzaGVyOiBQdWJsaXNoZXJJLFxuICBzdWJzY3JpYmVyOiBTdWJzY3JpYmVySVxufSk7XG52YXIgRm9ya2FibGVBc3luY0l0ZXJhYmxlSXRlcmF0b3JTaGFwZSA9IE0uaW50ZXJmYWNlKFxuICBcIkZvcmthYmxlQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXCIsXG4gIHtcbiAgICBmb3JrOiBNLmNhbGwoKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06IE0uY2FsbCgpLnJldHVybnMoTS5hbnkoKSksXG4gICAgLy9cbiAgICBuZXh0OiBNLmNhbGxXaGVuKCkucmV0dXJucyhNLmFueSgpKVxuICB9XG4pO1xudmFyIEl0ZXJhYmxlRWFjaFRvcGljSSA9IE0uaW50ZXJmYWNlKFwiSXRlcmFibGVFYWNoVG9waWNcIiwge1xuICBzdWJzY3JpYmVBZnRlcjogZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKFN1YnNjcmliZXJJKS5tZXRob2RHdWFyZHMuc3Vic2NyaWJlQWZ0ZXIsXG4gIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06IE0uY2FsbCgpLnJldHVybnMoXG4gICAgTS5yZW1vdGFibGUoXCJGb3JrYWJsZUFzeW5jSXRlcmFibGVJdGVyYXRvclwiKVxuICApXG59KTtcbnZhciBJdGVyYWJsZUxhdGVzdFRvcGljSSA9IE0uaW50ZXJmYWNlKFwiSXRlcmFibGVMYXRlc3RUb3BpY1wiLCB7XG4gIGdldFVwZGF0ZVNpbmNlOiBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoU3Vic2NyaWJlckkpLm1ldGhvZEd1YXJkcy5nZXRVcGRhdGVTaW5jZSxcbiAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogTS5jYWxsKCkucmV0dXJucyhcbiAgICBNLnJlbW90YWJsZShcIkZvcmthYmxlQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXCIpXG4gIClcbn0pO1xudmFyIHdlYWtNZW1vaXplVW5hcnkgPSAoZm4pID0+IHtcbiAgY29uc3QgY2FjaGUgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgcmV0dXJuIChhcmcpID0+IHtcbiAgICBjb25zdCBvYXJnID0gYXJnO1xuICAgIGlmIChjYWNoZS5oYXMob2FyZykpIHtcbiAgICAgIHJldHVybiBjYWNoZS5nZXQob2FyZyk7XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IGZuKGFyZyk7XG4gICAgY2FjaGUuc2V0KG9hcmcsIHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbn07XG52YXIgbWFrZVVwZGF0ZVJlY29yZEZyb21QdWJsaWNhdGlvblJlY29yZCA9IChyZWNvcmQpID0+IHtcbiAgY29uc3Qge1xuICAgIGhlYWQ6IHsgdmFsdWUsIGRvbmUgfSxcbiAgICBwdWJsaXNoQ291bnRcbiAgfSA9IHJlY29yZDtcbiAgaWYgKGRvbmUpIHtcbiAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWUsIHVwZGF0ZUNvdW50OiB2b2lkIDAgfSk7XG4gIH1cbiAgcmV0dXJuIGhhcmRlbih7IHZhbHVlLCB1cGRhdGVDb3VudDogcHVibGlzaENvdW50IH0pO1xufTtcbnZhciBtYWtlUHVibGlzaEtpdCA9ICgpID0+IHtcbiAgbGV0IHRhaWxQO1xuICBsZXQgdGFpbFI7XG4gICh7IHByb21pc2U6IHRhaWxQLCByZXNvbHZlOiB0YWlsUiB9ID0gbWFrZVByb21pc2VLaXQoKSk7XG4gIGxldCBjdXJyZW50UHVibGlzaENvdW50ID0gMG47XG4gIGxldCBjdXJyZW50UCA9IHRhaWxQO1xuICBjb25zdCBhZHZhbmNlQ3VycmVudCA9IChkb25lLCB2YWx1ZSwgcmVqZWN0aW9uKSA9PiB7XG4gICAgaWYgKHRhaWxSID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHVwZGF0ZSBzdGF0ZSBhZnRlciB0ZXJtaW5hdGlvbi5cIik7XG4gICAgfVxuICAgIGN1cnJlbnRQdWJsaXNoQ291bnQgKz0gMW47XG4gICAgY3VycmVudFAgPSB0YWlsUDtcbiAgICBjb25zdCByZXNvbHZlQ3VycmVudCA9IHRhaWxSO1xuICAgIGlmIChkb25lKSB7XG4gICAgICB0YWlsUCA9IHRvb0ZhclJlamVjdGlvbjtcbiAgICAgIHRhaWxSID0gdm9pZCAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAoeyBwcm9taXNlOiB0YWlsUCwgcmVzb2x2ZTogdGFpbFIgfSA9IG1ha2VQcm9taXNlS2l0KCkpO1xuICAgIH1cbiAgICBpZiAocmVqZWN0aW9uKSB7XG4gICAgICByZXNvbHZlQ3VycmVudChyZWplY3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNvbHZlQ3VycmVudChcbiAgICAgICAgaGFyZGVuKHtcbiAgICAgICAgICBoZWFkOiB7IHZhbHVlLCBkb25lIH0sXG4gICAgICAgICAgcHVibGlzaENvdW50OiBjdXJyZW50UHVibGlzaENvdW50LFxuICAgICAgICAgIHRhaWw6IHRhaWxQXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgbWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkID0gd2Vha01lbW9pemVVbmFyeShcbiAgICBtYWtlVXBkYXRlUmVjb3JkRnJvbVB1YmxpY2F0aW9uUmVjb3JkXG4gICk7XG4gIGNvbnN0IHN1YnNjcmliZXIgPSBGYXIoXCJTdWJzY3JpYmVyXCIsIHtcbiAgICBzdWJzY3JpYmVBZnRlcjogKHB1Ymxpc2hDb3VudCA9IC0xbikgPT4ge1xuICAgICAgYXNzZXJ0LnR5cGVvZihwdWJsaXNoQ291bnQsIFwiYmlnaW50XCIpO1xuICAgICAgaWYgKHB1Ymxpc2hDb3VudCA9PT0gY3VycmVudFB1Ymxpc2hDb3VudCkge1xuICAgICAgICByZXR1cm4gdGFpbFA7XG4gICAgICB9IGVsc2UgaWYgKHB1Ymxpc2hDb3VudCA8IGN1cnJlbnRQdWJsaXNoQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRQO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgXCJzdWJzY3JpYmVBZnRlciBhcmd1bWVudCBtdXN0IGJlIGEgcHJldmlvdXNseS1pc3N1ZWQgcHVibGlzaENvdW50LlwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcbiAgICBnZXRVcGRhdGVTaW5jZTogKHVwZGF0ZUNvdW50KSA9PiB7XG4gICAgICBpZiAodXBkYXRlQ291bnQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcigpLnRoZW4obWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkKTtcbiAgICAgIH1cbiAgICAgIHVwZGF0ZUNvdW50ID0gQmlnSW50KHVwZGF0ZUNvdW50KTtcbiAgICAgIHJldHVybiBzdWJzY3JpYmVyLnN1YnNjcmliZUFmdGVyKHVwZGF0ZUNvdW50KS50aGVuKCgpID0+IHN1YnNjcmliZXIuZ2V0VXBkYXRlU2luY2UoKSk7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgcHVibGlzaGVyID0gRmFyKFwiUHVibGlzaGVyXCIsIHtcbiAgICBwdWJsaXNoOiAodmFsdWUpID0+IHtcbiAgICAgIGFkdmFuY2VDdXJyZW50KGZhbHNlLCB2YWx1ZSk7XG4gICAgfSxcbiAgICBmaW5pc2g6IChmaW5hbFZhbHVlKSA9PiB7XG4gICAgICBhZHZhbmNlQ3VycmVudCh0cnVlLCBmaW5hbFZhbHVlKTtcbiAgICB9LFxuICAgIGZhaWw6IChyZWFzb24pID0+IHtcbiAgICAgIGFkdmFuY2VDdXJyZW50KHRydWUsIHZvaWQgMCwgbWFrZVF1aWV0UmVqZWN0aW9uKHJlYXNvbikpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSk7XG59O1xuaGFyZGVuKG1ha2VQdWJsaXNoS2l0KTtcbnZhciBEdXJhYmxlUHVibGlzaEtpdFN0YXRlU2hhcGUgPSBoYXJkZW4oe1xuICB2YWx1ZUR1cmFiaWxpdHk6IE0uYW55KCksXG4gIHB1Ymxpc2hDb3VudDogTS5hbnkoKSxcbiAgc3RhdHVzOiBNLmFueSgpLFxuICBoYXNWYWx1ZTogTS5hbnkoKSxcbiAgdmFsdWU6IE0uYW55KClcbn0pO1xudmFyIGluaXREdXJhYmxlUHVibGlzaEtpdFN0YXRlID0gKG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IHZhbHVlRHVyYWJpbGl0eSA9IFwibWFuZGF0b3J5XCIgfSA9IG9wdGlvbnM7XG4gIGFzc2VydC5lcXVhbCh2YWx1ZUR1cmFiaWxpdHksIFwibWFuZGF0b3J5XCIpO1xuICByZXR1cm4ge1xuICAgIC8vXG4gICAgdmFsdWVEdXJhYmlsaXR5LFxuICAgIC8vXG4gICAgcHVibGlzaENvdW50OiAwbixcbiAgICBzdGF0dXM6IFwibGl2ZVwiLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgaGFzVmFsdWU6IGZhbHNlLFxuICAgIHZhbHVlOiB2b2lkIDBcbiAgfTtcbn07XG52YXIgZ2V0RXBoZW1lcmFsS2V5ID0gKGZhY2V0cykgPT4gZmFjZXRzLnB1Ymxpc2hlcjtcbnZhciBkdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbnZhciBwcm92aWRlQ3VycmVudFAgPSAoc3RhdGUsIGZhY2V0cywgdGFpbCkgPT4ge1xuICBjb25zdCBlcGhlbWVyYWxLZXkgPSBnZXRFcGhlbWVyYWxLZXkoZmFjZXRzKTtcbiAgY29uc3QgZm91bmREYXRhID0gZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhLmdldChlcGhlbWVyYWxLZXkpO1xuICBjb25zdCBjdXJyZW50UCA9IGZvdW5kRGF0YSAmJiBmb3VuZERhdGEuY3VycmVudFA7XG4gIGlmIChjdXJyZW50UCkge1xuICAgIHJldHVybiBjdXJyZW50UDtcbiAgfVxuICBjb25zdCB7IHB1Ymxpc2hDb3VudCwgc3RhdHVzLCBoYXNWYWx1ZSwgdmFsdWUgfSA9IHN0YXRlO1xuICBpZiAoIWhhc1ZhbHVlKSB7XG4gICAgYXNzZXJ0KHN0YXR1cyA9PT0gXCJsaXZlXCIpO1xuICAgIHJldHVybiB0YWlsO1xuICB9XG4gIGlmIChzdGF0dXMgPT09IFwibGl2ZVwiIHx8IHN0YXR1cyA9PT0gXCJmaW5pc2hlZFwiKSB7XG4gICAgY29uc3QgY2VsbCA9IGhhcmRlbih7XG4gICAgICBoZWFkOiB7IHZhbHVlLCBkb25lOiBzdGF0dXMgIT09IFwibGl2ZVwiIH0sXG4gICAgICBwdWJsaXNoQ291bnQsXG4gICAgICB0YWlsXG4gICAgfSk7XG4gICAgcmV0dXJuIEUucmVzb2x2ZShjZWxsKTtcbiAgfSBlbHNlIGlmIChzdGF0dXMgPT09IFwiZmFpbGVkXCIpIHtcbiAgICByZXR1cm4gbWFrZVF1aWV0UmVqZWN0aW9uKHZhbHVlKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEludmFsaWQgZHVyYWJsZSBwcm9taXNlIGtpdCBzdGF0dXM6ICR7cXVvdGUoc3RhdHVzKX1gO1xuICB9XG59O1xudmFyIHByb3ZpZGVEdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEgPSAoc3RhdGUsIGZhY2V0cykgPT4ge1xuICBjb25zdCBlcGhlbWVyYWxLZXkgPSBnZXRFcGhlbWVyYWxLZXkoZmFjZXRzKTtcbiAgY29uc3QgZm91bmREYXRhID0gZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhLmdldChlcGhlbWVyYWxLZXkpO1xuICBpZiAoZm91bmREYXRhKSB7XG4gICAgcmV0dXJuIGZvdW5kRGF0YTtcbiAgfVxuICBjb25zdCB7IHN0YXR1cyB9ID0gc3RhdGU7XG4gIGxldCB0YWlsUDtcbiAgbGV0IHRhaWxSO1xuICBpZiAoc3RhdHVzID09PSBcImxpdmVcIikge1xuICAgICh7IHByb21pc2U6IHRhaWxQLCByZXNvbHZlOiB0YWlsUiB9ID0gbWFrZVByb21pc2VLaXQoKSk7XG4gICAgdm9pZCBFLndoZW4odGFpbFAsIHNpbmszLCBzaW5rMyk7XG4gIH0gZWxzZSBpZiAoc3RhdHVzID09PSBcImZpbmlzaGVkXCIgfHwgc3RhdHVzID09PSBcImZhaWxlZFwiKSB7XG4gICAgdGFpbFAgPSB0b29GYXJSZWplY3Rpb247XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBJbnZhbGlkIGR1cmFibGUgcHJvbWlzZSBraXQgc3RhdHVzOiAke3F1b3RlKHN0YXR1cyl9YDtcbiAgfVxuICBjb25zdCBvYmogPSBoYXJkZW4oeyBjdXJyZW50UDogdm9pZCAwLCB0YWlsUCwgdGFpbFIgfSk7XG4gIGR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YS5zZXQoZXBoZW1lcmFsS2V5LCBvYmopO1xuICByZXR1cm4gb2JqO1xufTtcbnZhciBhZHZhbmNlRHVyYWJsZVB1Ymxpc2hLaXQgPSAoY29udGV4dCwgdmFsdWUsIHRhcmdldFN0YXR1cyA9IFwibGl2ZVwiKSA9PiB7XG4gIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gY29udGV4dDtcbiAgY29uc3QgeyB2YWx1ZUR1cmFiaWxpdHksIHN0YXR1cyB9ID0gc3RhdGU7XG4gIGlmIChzdGF0dXMgIT09IFwibGl2ZVwiKSB7XG4gICAgdGhyb3cgRXJyb3IoXCJDYW5ub3QgdXBkYXRlIHN0YXRlIGFmdGVyIHRlcm1pbmF0aW9uLlwiKTtcbiAgfVxuICBjb25zdCBkb25lID0gdGFyZ2V0U3RhdHVzICE9PSBcImxpdmVcIjtcbiAgaWYgKGRvbmUgfHwgdmFsdWVEdXJhYmlsaXR5ID09PSBcIm1hbmRhdG9yeVwiKSB7XG4gICAgY2FuQmVEdXJhYmxlKHZhbHVlKSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCBhY2NlcHQgbm9uLWR1cmFibGUgdmFsdWU6ICR7dmFsdWV9YDtcbiAgfVxuICBjb25zdCB7IHRhaWxQOiBvbGRUYWlsUCwgdGFpbFI6IHJlc29sdmVPbGRUYWlsIH0gPSBwcm92aWRlRHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhKHN0YXRlLCBmYWNldHMpO1xuICBhc3NlcnQudHlwZW9mKHJlc29sdmVPbGRUYWlsLCBcImZ1bmN0aW9uXCIpO1xuICBjb25zdCBwdWJsaXNoQ291bnQgPSBzdGF0ZS5wdWJsaXNoQ291bnQgKyAxbjtcbiAgc3RhdGUucHVibGlzaENvdW50ID0gcHVibGlzaENvdW50O1xuICBsZXQgdGFpbFA7XG4gIGxldCB0YWlsUjtcbiAgaWYgKGRvbmUpIHtcbiAgICBzdGF0ZS5zdGF0dXMgPSB0YXJnZXRTdGF0dXM7XG4gICAgdGFpbFAgPSB0b29GYXJSZWplY3Rpb247XG4gICAgdGFpbFIgPSB2b2lkIDA7XG4gIH0gZWxzZSB7XG4gICAgKHsgcHJvbWlzZTogdGFpbFAsIHJlc29sdmU6IHRhaWxSIH0gPSBtYWtlUHJvbWlzZUtpdCgpKTtcbiAgICB2b2lkIEUud2hlbih0YWlsUCwgc2luazMsIHNpbmszKTtcbiAgfVxuICBsZXQgY3VycmVudFA7XG4gIGlmICh0YXJnZXRTdGF0dXMgPT09IFwiZmFpbGVkXCIpIHtcbiAgICBzdGF0ZS5oYXNWYWx1ZSA9IHRydWU7XG4gICAgc3RhdGUudmFsdWUgPSB2YWx1ZTtcbiAgICBjb25zdCByZWplY3Rpb24gPSBtYWtlUXVpZXRSZWplY3Rpb24odmFsdWUpO1xuICAgIHJlc29sdmVPbGRUYWlsKHJlamVjdGlvbik7XG4gIH0gZWxzZSB7XG4gICAgaWYgKGRvbmUgfHwgdmFsdWVEdXJhYmlsaXR5ICE9PSBcImlnbm9yZWRcIiAmJiBjYW5CZUR1cmFibGUodmFsdWUpKSB7XG4gICAgICBzdGF0ZS5oYXNWYWx1ZSA9IHRydWU7XG4gICAgICBzdGF0ZS52YWx1ZSA9IHZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdGF0ZS5oYXNWYWx1ZSA9IGZhbHNlO1xuICAgICAgc3RhdGUudmFsdWUgPSB2b2lkIDA7XG4gICAgICBjdXJyZW50UCA9IG9sZFRhaWxQO1xuICAgIH1cbiAgICByZXNvbHZlT2xkVGFpbChcbiAgICAgIGhhcmRlbih7XG4gICAgICAgIGhlYWQ6IHsgdmFsdWUsIGRvbmUgfSxcbiAgICAgICAgcHVibGlzaENvdW50LFxuICAgICAgICB0YWlsOiB0YWlsUFxuICAgICAgfSlcbiAgICApO1xuICB9XG4gIGR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YS5zZXQoXG4gICAgZ2V0RXBoZW1lcmFsS2V5KGZhY2V0cyksXG4gICAgaGFyZGVuKHsgY3VycmVudFAsIHRhaWxQLCB0YWlsUiB9KVxuICApO1xufTtcbnZhciBwcmVwYXJlRHVyYWJsZVB1Ymxpc2hLaXQgPSAoYmFnZ2FnZSwga2luZE5hbWUpID0+IHtcbiAgY29uc3QgbWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkID0gbWFrZVVwZGF0ZVJlY29yZEZyb21QdWJsaWNhdGlvblJlY29yZDtcbiAgcmV0dXJuIHByZXBhcmVFeG9DbGFzc0tpdChcbiAgICBiYWdnYWdlLFxuICAgIGtpbmROYW1lLFxuICAgIHB1Ymxpc2hLaXRJS2l0LFxuICAgIGluaXREdXJhYmxlUHVibGlzaEtpdFN0YXRlLFxuICAgIHtcbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgcHVibGlzaGVyOiB7XG4gICAgICAgIHB1Ymxpc2godmFsdWUpIHtcbiAgICAgICAgICBhZHZhbmNlRHVyYWJsZVB1Ymxpc2hLaXQodGhpcywgdmFsdWUpO1xuICAgICAgICB9LFxuICAgICAgICBmaW5pc2goZmluYWxWYWx1ZSkge1xuICAgICAgICAgIGFkdmFuY2VEdXJhYmxlUHVibGlzaEtpdCh0aGlzLCBmaW5hbFZhbHVlLCBcImZpbmlzaGVkXCIpO1xuICAgICAgICB9LFxuICAgICAgICBmYWlsKHJlYXNvbikge1xuICAgICAgICAgIGFkdmFuY2VEdXJhYmxlUHVibGlzaEtpdCh0aGlzLCByZWFzb24sIFwiZmFpbGVkXCIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICBzdWJzY3JpYmVyOiB7XG4gICAgICAgIHN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudCA9IC0xbikge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICBjb25zdCB7IHB1Ymxpc2hDb3VudDogY3VycmVudFB1Ymxpc2hDb3VudCB9ID0gc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyBjdXJyZW50UCwgdGFpbFAgfSA9IHByb3ZpZGVEdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEoXG4gICAgICAgICAgICBzdGF0ZSxcbiAgICAgICAgICAgIGZhY2V0c1xuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHB1Ymxpc2hDb3VudCA9PT0gY3VycmVudFB1Ymxpc2hDb3VudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRhaWxQO1xuICAgICAgICAgIH0gZWxzZSBpZiAocHVibGlzaENvdW50IDwgY3VycmVudFB1Ymxpc2hDb3VudCkge1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRQIHx8IHByb3ZpZGVDdXJyZW50UChzdGF0ZSwgZmFjZXRzLCB0YWlsUCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICAgICBcInN1YnNjcmliZUFmdGVyIGFyZ3VtZW50IG11c3QgYmUgYSBwcmV2aW91c2x5LWlzc3VlZCBwdWJsaXNoQ291bnQuXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBnZXRVcGRhdGVTaW5jZSh1cGRhdGVDb3VudCkge1xuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIGZhY2V0czogeyBzdWJzY3JpYmVyIH1cbiAgICAgICAgICB9ID0gdGhpcztcbiAgICAgICAgICBpZiAodXBkYXRlQ291bnQgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgcmV0dXJuIHN1YnNjcmliZXIuc3Vic2NyaWJlQWZ0ZXIoKS50aGVuKG1ha2VNZW1vaXplZFVwZGF0ZVJlY29yZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHVwZGF0ZUNvdW50ID0gQmlnSW50KHVwZGF0ZUNvdW50KTtcbiAgICAgICAgICByZXR1cm4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcih1cGRhdGVDb3VudCkudGhlbigoKSA9PiBzdWJzY3JpYmVyLmdldFVwZGF0ZVNpbmNlKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBzdGF0ZVNoYXBlOiBEdXJhYmxlUHVibGlzaEtpdFN0YXRlU2hhcGVcbiAgICB9XG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVEdXJhYmxlUHVibGlzaEtpdCk7XG52YXIgU3Vic2NyaWJlclNoYXBlID0gTS5yZW1vdGFibGUoXCJTdWJzY3JpYmVyXCIpO1xuXG4vL1xudmFyIHNpbms0ID0gKCkgPT4ge1xufTtcbnZhciByZWNvbm5lY3RBc05lZWRlZCA9IGFzeW5jIChnZXR0ZXIsIHNlZWQgPSBbXSkgPT4ge1xuICBsZXQgZGlzY29ubmVjdGlvbjtcbiAgbGV0IGxhc3RWZXJzaW9uID0gLUluZmluaXR5O1xuICBhd2FpdCBudWxsO1xuICBmb3IgKGxldCBpMyA9IDA7IDsgaTMgKz0gMSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHRQID0gaTMgPCBzZWVkLmxlbmd0aCA/IHNlZWRbaTNdIDogZ2V0dGVyKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXN1bHRQO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChpc1VwZ3JhZGVEaXNjb25uZWN0aW9uKGVycikpIHtcbiAgICAgICAgaWYgKCFkaXNjb25uZWN0aW9uKSB7XG4gICAgICAgICAgZGlzY29ubmVjdGlvbiA9IGVycjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGluY2FybmF0aW9uTnVtYmVyOiB2ZXJzaW9uIH0gPSBlcnI7XG4gICAgICAgIGlmICh2ZXJzaW9uID4gbGFzdFZlcnNpb24pIHtcbiAgICAgICAgICBsYXN0VmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghaXNQcmltaXRpdmUyKGVycikgJiYgZGlzY29ubmVjdGlvbiAmJiBkaXNjb25uZWN0aW9uICE9PSBlcnIpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBub3RlKFxuICAgICAgICAgICAgZXJyLFxuICAgICAgICAgICAgcmVkYWN0ZWRgQXR0ZW1wdGluZyB0byByZWNvdmVyIGZyb20gZGlzY29ubmVjdGlvbjogJHtkaXNjb25uZWN0aW9ufWBcbiAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIChfZXJyKSB7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cbn07XG52YXIgbWFrZUVhY2hJdGVyYXRvciA9ICh0b3BpYywgbmV4dENlbGxQKSA9PiB7XG4gIGNvbnN0IHNlbGYgPSBGYXIoXCJFYWNoSXRlcmF0b3JcIiwge1xuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IHNlbGYsXG4gICAgbmV4dDogKCkgPT4ge1xuICAgICAgY29uc3Qge1xuICAgICAgICBoZWFkOiByZXN1bHRQLFxuICAgICAgICBwdWJsaXNoQ291bnQ6IHB1Ymxpc2hDb3VudFAsXG4gICAgICAgIHRhaWw6IHRhaWxQXG4gICAgICB9ID0gRS5nZXQobmV4dENlbGxQKTtcbiAgICAgIGNvbnN0IGdldFN1Y2Nlc3NvciA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcHVibGlzaENvdW50ID0gYXdhaXQgcHVibGlzaENvdW50UDtcbiAgICAgICAgYXNzZXJ0LnR5cGVvZihwdWJsaXNoQ291bnQsIFwiYmlnaW50XCIpO1xuICAgICAgICBjb25zdCBzdWNjZXNzb3IgPSBhd2FpdCBFKHRvcGljKS5zdWJzY3JpYmVBZnRlcihwdWJsaXNoQ291bnQpO1xuICAgICAgICBjb25zdCBuZXdQdWJsaXNoQ291bnQgPSBzdWNjZXNzb3IucHVibGlzaENvdW50O1xuICAgICAgICBpZiAobmV3UHVibGlzaENvdW50ICE9PSBwdWJsaXNoQ291bnQgKyAxbikge1xuICAgICAgICAgIHRocm93UmVkYWN0ZWRgZWFjaEl0ZXJhdG9yIGJyb2tlbiBieSBnYXAgZnJvbSBwdWJsaXNoQ291bnQgJHtwdWJsaXNoQ291bnR9IHRvICR7bmV3UHVibGlzaENvdW50fWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1Y2Nlc3NvcjtcbiAgICAgIH07XG4gICAgICBuZXh0Q2VsbFAgPSByZWNvbm5lY3RBc05lZWRlZChnZXRTdWNjZXNzb3IsIFt0YWlsUF0pO1xuICAgICAgdm9pZCBFLndoZW4ocHVibGlzaENvdW50UCwgc2luazQsIHNpbms0KTtcbiAgICAgIHZvaWQgRS53aGVuKG5leHRDZWxsUCwgc2luazQsIHNpbms0KTtcbiAgICAgIHJldHVybiByZXN1bHRQO1xuICAgIH0sXG4gICAgZm9yazogKCkgPT4gbWFrZUVhY2hJdGVyYXRvcih0b3BpYywgbmV4dENlbGxQKVxuICB9KTtcbiAgcmV0dXJuIHNlbGY7XG59O1xudmFyIHN1YnNjcmliZUVhY2ggPSAodG9waWMpID0+IHtcbiAgY29uc3QgaXRlcmFibGUgPSBGYXIoXCJFYWNoSXRlcmFibGVcIiwge1xuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGNvbnN0IGZpcnN0Q2VsbFAgPSByZWNvbm5lY3RBc05lZWRlZCgoKSA9PiBFKHRvcGljKS5zdWJzY3JpYmVBZnRlcigpKTtcbiAgICAgIHJldHVybiBtYWtlRWFjaEl0ZXJhdG9yKHRvcGljLCBmaXJzdENlbGxQKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gaXRlcmFibGU7XG59O1xuaGFyZGVuKHN1YnNjcmliZUVhY2gpO1xudmFyIGNsb25lTGF0ZXN0SXRlcmF0b3IgPSAodG9waWMsIGxvY2FsVXBkYXRlQ291bnQsIHRlcm1pbmFsUmVzdWx0KSA9PiB7XG4gIGxldCBtdXRleCA9IFByb21pc2UucmVzb2x2ZSgpO1xuICBjb25zdCBtYXliZVJlcXVlc3ROZXh0UmVzdWx0ID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICh0ZXJtaW5hbFJlc3VsdCkge1xuICAgICAgcmV0dXJuIHRlcm1pbmFsUmVzdWx0O1xuICAgIH1cbiAgICBjb25zdCB7IHZhbHVlLCB1cGRhdGVDb3VudCB9ID0gYXdhaXQgcmVjb25uZWN0QXNOZWVkZWQoXG4gICAgICAoKSA9PiBFKHRvcGljKS5nZXRVcGRhdGVTaW5jZShsb2NhbFVwZGF0ZUNvdW50KVxuICAgICk7XG4gICAgbG9jYWxVcGRhdGVDb3VudCA9IHVwZGF0ZUNvdW50O1xuICAgIGlmICh1cGRhdGVDb3VudCA9PT0gdm9pZCAwKSB7XG4gICAgICB0ZXJtaW5hbFJlc3VsdCA9IGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlIH0pO1xuICAgICAgcmV0dXJuIHRlcm1pbmFsUmVzdWx0O1xuICAgIH1cbiAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlIH0pO1xuICB9O1xuICBjb25zdCBzZWxmID0gRmFyKFwiTGF0ZXN0SXRlcmF0b3JcIiwge1xuICAgIGZvcms6ICgpID0+IGNsb25lTGF0ZXN0SXRlcmF0b3IodG9waWMsIGxvY2FsVXBkYXRlQ291bnQsIHRlcm1pbmFsUmVzdWx0KSxcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiAoKSA9PiBzZWxmLFxuICAgIG5leHQ6IGFzeW5jICgpID0+IHtcbiAgICAgIGlmICh0ZXJtaW5hbFJlc3VsdCkge1xuICAgICAgICByZXR1cm4gdGVybWluYWxSZXN1bHQ7XG4gICAgICB9XG4gICAgICBjb25zdCBuZXh0UmVzdWx0ID0gbXV0ZXgudGhlbihtYXliZVJlcXVlc3ROZXh0UmVzdWx0KTtcbiAgICAgIG11dGV4ID0gbmV4dFJlc3VsdC50aGVuKHNpbms0LCBzaW5rNCk7XG4gICAgICByZXR1cm4gbmV4dFJlc3VsdDtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gc2VsZjtcbn07XG52YXIgbWFrZUxhdGVzdEl0ZXJhdG9yID0gKHRvcGljKSA9PiBjbG9uZUxhdGVzdEl0ZXJhdG9yKHRvcGljKTtcbnZhciBzdWJzY3JpYmVMYXRlc3QgPSAodG9waWMpID0+IHtcbiAgY29uc3QgaXRlcmFibGUgPSBGYXIoXCJMYXRlc3RJdGVyYWJsZVwiLCB7XG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogKCkgPT4gbWFrZUxhdGVzdEl0ZXJhdG9yKHRvcGljKVxuICB9KTtcbiAgcmV0dXJuIGl0ZXJhYmxlO1xufTtcbmhhcmRlbihzdWJzY3JpYmVMYXRlc3QpO1xuXG4vL1xudmFyIG1ha2VOb3RpZmllciA9IChzaGFyYWJsZUludGVybmFsc1ApID0+IHtcbiAgY29uc3Qgbm90aWZpZXIgPSBGYXIoXCJub3RpZmllclwiLCB7XG4gICAgLi4uc3Vic2NyaWJlTGF0ZXN0KHNoYXJhYmxlSW50ZXJuYWxzUCksXG4gICAgZ2V0VXBkYXRlU2luY2U6IGFzeW5jICh1cGRhdGVDb3VudCkgPT4gRShzaGFyYWJsZUludGVybmFsc1ApLmdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KSxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgZ2V0U2hhcmFibGVOb3RpZmllckludGVybmFsczogYXN5bmMgKCkgPT4gc2hhcmFibGVJbnRlcm5hbHNQLFxuICAgIC8qXG5cblxuXG4gICAgICovXG4gICAgZ2V0U3RvcmVLZXk6ICgpID0+IGhhcmRlbih7IG5vdGlmaWVyIH0pXG4gIH0pO1xuICByZXR1cm4gbm90aWZpZXI7XG59O1xudmFyIG1ha2VOb3RpZmllckZyb21TdWJzY3JpYmVyID0gKHN1YnNjcmliZXIpID0+IHtcbiAgY29uc3QgYmFzZU5vdGlmaWVyID0gaGFyZGVuKHtcbiAgICBnZXRVcGRhdGVTaW5jZTogKHVwZGF0ZUNvdW50ID0gdm9pZCAwKSA9PiBFKHN1YnNjcmliZXIpLmdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KVxuICB9KTtcbiAgY29uc3Qgbm90aWZpZXIgPSBGYXIoXCJub3RpZmllclwiLCB7XG4gICAgLi4ubWFrZU5vdGlmaWVyKGJhc2VOb3RpZmllciksXG4gICAgLi4uYmFzZU5vdGlmaWVyXG4gIH0pO1xuICByZXR1cm4gbm90aWZpZXI7XG59O1xuaGFyZGVuKG1ha2VOb3RpZmllckZyb21TdWJzY3JpYmVyKTtcbnZhciBtYWtlTm90aWZpZXJLaXQgPSAoLi4uaW5pdGlhbFN0YXRlQXJyKSA9PiB7XG4gIGNvbnN0IHsgcHVibGlzaGVyLCBzdWJzY3JpYmVyIH0gPSBtYWtlUHVibGlzaEtpdCgpO1xuICBjb25zdCBub3RpZmllciA9IG1ha2VOb3RpZmllckZyb21TdWJzY3JpYmVyKHN1YnNjcmliZXIpO1xuICBjb25zdCB1cGRhdGVyID0gRmFyKFwidXBkYXRlclwiLCB7XG4gICAgdXBkYXRlU3RhdGU6IChzdGF0ZSkgPT4gcHVibGlzaGVyLnB1Ymxpc2goc3RhdGUpLFxuICAgIGZpbmlzaDogKGNvbXBsZXRpb24pID0+IHB1Ymxpc2hlci5maW5pc2goY29tcGxldGlvbiksXG4gICAgZmFpbDogKHJlYXNvbikgPT4gcHVibGlzaGVyLmZhaWwocmVhc29uKVxuICB9KTtcbiAgYXNzZXJ0Mihpbml0aWFsU3RhdGVBcnIubGVuZ3RoIDw9IDEsIFwidG9vIG1hbnkgYXJndW1lbnRzXCIpO1xuICBpZiAoaW5pdGlhbFN0YXRlQXJyLmxlbmd0aCA9PT0gMSkge1xuICAgIHVwZGF0ZXIudXBkYXRlU3RhdGUoaW5pdGlhbFN0YXRlQXJyWzBdKTtcbiAgfVxuICByZXR1cm4gaGFyZGVuKHsgbm90aWZpZXIsIHVwZGF0ZXIgfSk7XG59O1xudmFyIG1ha2VOb3RpZmllckZyb21Bc3luY0l0ZXJhYmxlID0gKGFzeW5jSXRlcmFibGVQKSA9PiB7XG4gIGNvbnN0IGl0ZXJhdG9yUCA9IEUoYXN5bmNJdGVyYWJsZVApW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpO1xuICBsZXQgb3B0TmV4dFByb21pc2U7XG4gIGxldCBjdXJyZW50VXBkYXRlQ291bnQgPSAwbjtcbiAgbGV0IGN1cnJlbnRSZXNwb25zZTtcbiAgbGV0IGZpbmFsID0gZmFsc2U7XG4gIGNvbnN0IGJhc2VOb3RpZmllciA9IEZhcihcImJhc2VOb3RpZmllclwiLCB7XG4gICAgZ2V0VXBkYXRlU2luY2UodXBkYXRlQ291bnQgPSAtMW4pIHtcbiAgICAgIGlmICh1cGRhdGVDb3VudCA8IGN1cnJlbnRVcGRhdGVDb3VudCkge1xuICAgICAgICBpZiAoY3VycmVudFJlc3BvbnNlKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjdXJyZW50UmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHVwZGF0ZUNvdW50ICE9PSBjdXJyZW50VXBkYXRlQ291bnQpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgXCJnZXRVcGRhdGVTaW5jZSBhcmd1bWVudCBtdXN0IGJlIGEgcHJldmlvdXNseS1pc3N1ZWQgdXBkYXRlQ291bnQuXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChmaW5hbCkge1xuICAgICAgICBhc3NlcnQyKGN1cnJlbnRSZXNwb25zZSAhPT0gdm9pZCAwKTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjdXJyZW50UmVzcG9uc2UpO1xuICAgICAgfVxuICAgICAgaWYgKCFvcHROZXh0UHJvbWlzZSkge1xuICAgICAgICBjb25zdCBuZXh0SXRlclJlc3VsdFAgPSBFKGl0ZXJhdG9yUCkubmV4dCgpO1xuICAgICAgICBvcHROZXh0UHJvbWlzZSA9IEUud2hlbihcbiAgICAgICAgICBuZXh0SXRlclJlc3VsdFAsXG4gICAgICAgICAgKHsgZG9uZSwgdmFsdWUgfSkgPT4ge1xuICAgICAgICAgICAgYXNzZXJ0MighZmluYWwpO1xuICAgICAgICAgICAgaWYgKGRvbmUpIHtcbiAgICAgICAgICAgICAgZmluYWwgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3VycmVudFVwZGF0ZUNvdW50ICs9IDFuO1xuICAgICAgICAgICAgY3VycmVudFJlc3BvbnNlID0gaGFyZGVuKHtcbiAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgIHVwZGF0ZUNvdW50OiBkb25lID8gdm9pZCAwIDogY3VycmVudFVwZGF0ZUNvdW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG9wdE5leHRQcm9taXNlID0gdm9pZCAwO1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRSZXNwb25zZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIChfcmVhc29uKSA9PiB7XG4gICAgICAgICAgICBmaW5hbCA9IHRydWU7XG4gICAgICAgICAgICBjdXJyZW50UmVzcG9uc2UgPSAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG5leHRJdGVyUmVzdWx0UDtcbiAgICAgICAgICAgIG9wdE5leHRQcm9taXNlID0gdm9pZCAwO1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRSZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3B0TmV4dFByb21pc2U7XG4gICAgfVxuICB9KTtcbiAgY29uc3Qgbm90aWZpZXIgPSBGYXIoXCJub3RpZmllclwiLCB7XG4gICAgLy9cbiAgICAvL1xuICAgIC4uLm1ha2VOb3RpZmllcihiYXNlTm90aWZpZXIpLFxuICAgIC4uLmJhc2VOb3RpZmllclxuICB9KTtcbiAgcmV0dXJuIG5vdGlmaWVyO1xufTtcbmhhcmRlbihtYWtlTm90aWZpZXJGcm9tQXN5bmNJdGVyYWJsZSk7XG5cbi8vXG52YXIgbWFrZVBpbm5lZEhpc3RvcnlUb3BpYyA9ICh0b3BpYykgPT4ge1xuICBjb25zdCBwaW5uZWRQdWJMaXN0ID0gdG9waWMuc3Vic2NyaWJlQWZ0ZXIoKTtcbiAgcmV0dXJuIEZhcihcIlBpbm5lZEhpc3RvcnlUb3BpY1wiLCB7XG4gICAgc3Vic2NyaWJlQWZ0ZXI6IGFzeW5jIChwdWJsaXNoQ291bnQgPSAtMW4pID0+IHtcbiAgICAgIGlmIChwdWJsaXNoQ291bnQgPT09IC0xbikge1xuICAgICAgICByZXR1cm4gcGlubmVkUHViTGlzdDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0b3BpYy5zdWJzY3JpYmVBZnRlcihwdWJsaXNoQ291bnQpO1xuICAgIH0sXG4gICAgZ2V0VXBkYXRlU2luY2U6IGFzeW5jICh1cGRhdGVDb3VudCA9IHZvaWQgMCkgPT4ge1xuICAgICAgcmV0dXJuIHRvcGljLmdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihtYWtlUGlubmVkSGlzdG9yeVRvcGljKTtcblxuLy9cbnZhciBtYWtlU3Vic2NyaXB0aW9uID0gKHRvcGljKSA9PiB7XG4gIGNvbnN0IHN1YnNjcmlwdGlvbiA9IEZhcihcIlN1YnNjcmlwdGlvblwiLCB7XG4gICAgLi4uc3Vic2NyaWJlRWFjaCh0b3BpYyksXG4gICAgc3Vic2NyaWJlQWZ0ZXI6IGFzeW5jIChwdWJsaXNoQ291bnQpID0+IEUodG9waWMpLnN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudCksXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgIGdldFNoYXJhYmxlU3Vic2NyaXB0aW9uSW50ZXJuYWxzOiBhc3luYyAoKSA9PiB0b3BpYyxcbiAgICBnZXRTdG9yZUtleTogKCkgPT4gaGFyZGVuKHsgc3Vic2NyaXB0aW9uIH0pXG4gIH0pO1xuICByZXR1cm4gc3Vic2NyaXB0aW9uO1xufTtcbmhhcmRlbihtYWtlU3Vic2NyaXB0aW9uKTtcbnZhciBtYWtlU3Vic2NyaXB0aW9uS2l0ID0gKCkgPT4ge1xuICBjb25zdCB7IHB1Ymxpc2hlciwgc3Vic2NyaWJlciB9ID0gbWFrZVB1Ymxpc2hLaXQoKTtcbiAgY29uc3QgcGlubmVkSGlzdG9yeVRvcGljID0gbWFrZVBpbm5lZEhpc3RvcnlUb3BpYyhzdWJzY3JpYmVyKTtcbiAgY29uc3Qgc3Vic2NyaXB0aW9uID0gbWFrZVN1YnNjcmlwdGlvbihwaW5uZWRIaXN0b3J5VG9waWMpO1xuICBjb25zdCBwdWJsaWNhdGlvbiA9IEZhcihcInB1YmxpY2F0aW9uXCIsIHtcbiAgICB1cGRhdGVTdGF0ZTogKG5vbkZpbmFsVmFsdWUpID0+IHB1Ymxpc2hlci5wdWJsaXNoKG5vbkZpbmFsVmFsdWUpLFxuICAgIGZpbmlzaDogKGNvbXBsZXRpb24pID0+IHB1Ymxpc2hlci5maW5pc2goY29tcGxldGlvbiksXG4gICAgZmFpbDogKHJlYXNvbikgPT4gcHVibGlzaGVyLmZhaWwocmVhc29uKVxuICB9KTtcbiAgcmV0dXJuIGhhcmRlbih7IHB1YmxpY2F0aW9uLCBzdWJzY3JpcHRpb24gfSk7XG59O1xuaGFyZGVuKG1ha2VTdWJzY3JpcHRpb25LaXQpO1xuXG4vL1xudmFyIG9ic2VydmVJdGVyYXRvciA9IChhc3luY0l0ZXJhdG9yUCwgaXRlcmF0aW9uT2JzZXJ2ZXIpID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChhY2ssIG9ic2VydmVyRXJyb3IpID0+IHtcbiAgICBjb25zdCByZWN1ciA9ICgpID0+IHtcbiAgICAgIEUud2hlbihcbiAgICAgICAgRShhc3luY0l0ZXJhdG9yUCkubmV4dCgpLFxuICAgICAgICAoeyB2YWx1ZSwgZG9uZSB9KSA9PiB7XG4gICAgICAgICAgaWYgKGRvbmUpIHtcbiAgICAgICAgICAgIGl0ZXJhdGlvbk9ic2VydmVyLmZpbmlzaCAmJiBpdGVyYXRpb25PYnNlcnZlci5maW5pc2godmFsdWUpO1xuICAgICAgICAgICAgYWNrKHZvaWQgMCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGl0ZXJhdGlvbk9ic2VydmVyLnVwZGF0ZVN0YXRlICYmIGl0ZXJhdGlvbk9ic2VydmVyLnVwZGF0ZVN0YXRlKHZhbHVlKTtcbiAgICAgICAgICAgIHJlY3VyKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAocmVhc29uKSA9PiB7XG4gICAgICAgICAgaXRlcmF0aW9uT2JzZXJ2ZXIuZmFpbCAmJiBpdGVyYXRpb25PYnNlcnZlci5mYWlsKHJlYXNvbik7XG4gICAgICAgICAgYWNrKHZvaWQgMCk7XG4gICAgICAgIH1cbiAgICAgICkuY2F0Y2gob2JzZXJ2ZXJFcnJvcik7XG4gICAgfTtcbiAgICByZWN1cigpO1xuICB9KTtcbn07XG52YXIgb2JzZXJ2ZUl0ZXJhdGlvbiA9IChhc3luY0l0ZXJhYmxlUCwgaXRlcmF0aW9uT2JzZXJ2ZXIpID0+IHtcbiAgY29uc3QgaXRlcmF0b3JQID0gRShhc3luY0l0ZXJhYmxlUClbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCk7XG4gIHJldHVybiBvYnNlcnZlSXRlcmF0b3IoaXRlcmF0b3JQLCBpdGVyYXRpb25PYnNlcnZlcik7XG59O1xuXG4vL1xudmFyIGZvckVhY2hQdWJsaWNhdGlvblJlY29yZCA9IGFzeW5jIChzdWJzY3JpYmVyLCBjb25zdW1lVmFsdWUpID0+IHtcbiAgY29uc3QgaXRlcmF0b3IgPSBzdWJzY3JpYmVFYWNoKHN1YnNjcmliZXIpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpO1xuICBsZXQgZmluaXNoZWQgPSBmYWxzZTtcbiAgYXdhaXQgbnVsbDtcbiAgd2hpbGUgKCFmaW5pc2hlZCkge1xuICAgIGNvbnN0IHsgdmFsdWUsIGRvbmUgfSA9IGF3YWl0IGl0ZXJhdG9yLm5leHQoKTtcbiAgICBhd2FpdCBjb25zdW1lVmFsdWUodmFsdWUpO1xuICAgIGZpbmlzaGVkID0gISFkb25lO1xuICB9XG59O1xudmFyIG1ha2VTdG9yZWRTdWJzY3JpYmVyID0gKHN1YnNjcmliZXIsIHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKSA9PiB7XG4gIGFzc2VydEFsbERlZmluZWQoeyBzdWJzY3JpYmVyLCBzdG9yYWdlTm9kZSwgbWFyc2hhbGxlciB9KTtcbiAgY29uc3QgbWFyc2hhbGxUb1N0b3JhZ2UgPSBtYWtlU2VyaWFsaXplVG9TdG9yYWdlKHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKTtcbiAgZm9yRWFjaFB1YmxpY2F0aW9uUmVjb3JkKHN1YnNjcmliZXIsIG1hcnNoYWxsVG9TdG9yYWdlKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcihcIlN0b3JlZFN1YnNjcmliZXIgZmFpbGVkIHRvIGl0ZXJhdGVcIiwgZXJyKTtcbiAgfSk7XG4gIGNvbnN0IHVuc2VyaWFsaXplciA9IEZhcihcInVuc2VyaWFsaXplclwiLCB7XG4gICAgZnJvbUNhcERhdGE6IChkYXRhKSA9PiBFKG1hcnNoYWxsZXIpLmZyb21DYXBEYXRhKGRhdGEpLFxuICAgIHVuc2VyaWFsaXplOiAoZGF0YSkgPT4gRShtYXJzaGFsbGVyKS5mcm9tQ2FwRGF0YShkYXRhKVxuICB9KTtcbiAgY29uc3Qgc3RvcmVzdWIgPSBGYXIoXCJTdG9yZWRTdWJzY3JpYmVyXCIsIHtcbiAgICBzdWJzY3JpYmVBZnRlcjogKHB1Ymxpc2hDb3VudCkgPT4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcihwdWJsaXNoQ291bnQpLFxuICAgIGdldFVwZGF0ZVNpbmNlOiAodXBkYXRlQ291bnQpID0+IHN1YnNjcmliZXIuZ2V0VXBkYXRlU2luY2UodXBkYXRlQ291bnQpLFxuICAgIGdldFBhdGg6ICgpID0+IEUoc3RvcmFnZU5vZGUpLmdldFBhdGgoKSxcbiAgICBnZXRTdG9yZUtleTogKCkgPT4gRShzdG9yYWdlTm9kZSkuZ2V0U3RvcmVLZXkoKSxcbiAgICBnZXRVbnNlcmlhbGl6ZXI6ICgpID0+IHVuc2VyaWFsaXplclxuICB9KTtcbiAgcmV0dXJuIHN0b3Jlc3ViO1xufTtcbnZhciBtYWtlU3RvcmVkU3Vic2NyaXB0aW9uID0gKHN1YnNjcmlwdGlvbiwgc3RvcmFnZU5vZGUsIG1hcnNoYWxsZXIgPSBtYWtlTWFyc2hhbCh2b2lkIDAsIHZvaWQgMCwge1xuICBtYXJzaGFsU2F2ZUVycm9yOiAoKSA9PiB7XG4gIH0sXG4gIHNlcmlhbGl6ZUJvZHlGb3JtYXQ6IFwic21hbGxjYXBzXCJcbn0pKSA9PiB7XG4gIGNvbnN0IHVuc2VyaWFsaXplciA9IEZhcihcInVuc2VyaWFsaXplclwiLCB7XG4gICAgZnJvbUNhcERhdGE6IChkYXRhKSA9PiBFKG1hcnNoYWxsZXIpLmZyb21DYXBEYXRhKGRhdGEpLFxuICAgIHVuc2VyaWFsaXplOiAoZGF0YSkgPT4gRShtYXJzaGFsbGVyKS5mcm9tQ2FwRGF0YShkYXRhKVxuICB9KTtcbiAgbGV0IHB1Ymxpc2hGYWlsZWQgPSBmYWxzZTtcbiAgbGV0IHB1Ymxpc2hFeGNlcHRpb247XG4gIGNvbnN0IGZhaWwgPSAoZXJyKSA9PiB7XG4gICAgcHVibGlzaEZhaWxlZCA9IHRydWU7XG4gICAgcHVibGlzaEV4Y2VwdGlvbiA9IGVycjtcbiAgfTtcbiAgY29uc3QgcHVibGlzaFZhbHVlID0gKG9iaikgPT4ge1xuICAgIGFzc2VydChzdG9yYWdlTm9kZSk7XG4gICAgaWYgKHB1Ymxpc2hGYWlsZWQpIHtcbiAgICAgIHRocm93IHB1Ymxpc2hFeGNlcHRpb247XG4gICAgfVxuICAgIEUobWFyc2hhbGxlcikudG9DYXBEYXRhKG9iaikudGhlbigoc2VyaWFsaXplZCkgPT4ge1xuICAgICAgY29uc3QgZW5jb2RlZCA9IEpTT04uc3RyaW5naWZ5KHNlcmlhbGl6ZWQpO1xuICAgICAgcmV0dXJuIEUoc3RvcmFnZU5vZGUpLnNldFZhbHVlKGVuY29kZWQpO1xuICAgIH0pLmNhdGNoKGZhaWwpO1xuICB9O1xuICBpZiAoc3RvcmFnZU5vZGUpIHtcbiAgICBvYnNlcnZlSXRlcmF0aW9uKHN1YnNjcmlwdGlvbiwge1xuICAgICAgdXBkYXRlU3RhdGU6IHB1Ymxpc2hWYWx1ZSxcbiAgICAgIGZpbmlzaDogcHVibGlzaFZhbHVlXG4gICAgfSkuY2F0Y2goZmFpbCk7XG4gIH1cbiAgY29uc3Qgc3RvcmVzdWIgPSBGYXIoXCJTdG9yZWRTdWJzY3JpcHRpb25cIiwge1xuICAgIC8vXG4gICAgZ2V0U3RvcmVLZXk6IGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghc3RvcmFnZU5vZGUpIHtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7IHN1YnNjcmlwdGlvbiB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHN0b3JlS2V5ID0gYXdhaXQgRShzdG9yYWdlTm9kZSkuZ2V0U3RvcmVLZXkoKTtcbiAgICAgIHJldHVybiBoYXJkZW4oeyAuLi5zdG9yZUtleSwgc3Vic2NyaXB0aW9uIH0pO1xuICAgIH0sXG4gICAgZ2V0VW5zZXJpYWxpemVyOiAoKSA9PiB1bnNlcmlhbGl6ZXIsXG4gICAgZ2V0U2hhcmFibGVTdWJzY3JpcHRpb25JbnRlcm5hbHM6ICgpID0+IHN1YnNjcmlwdGlvbi5nZXRTaGFyYWJsZVN1YnNjcmlwdGlvbkludGVybmFscygpLFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IHN1YnNjcmlwdGlvbltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSxcbiAgICBzdWJzY3JpYmVBZnRlcjogKHB1Ymxpc2hDb3VudCkgPT4gc3Vic2NyaXB0aW9uLnN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudClcbiAgfSk7XG4gIHJldHVybiBzdG9yZXN1Yjtcbn07XG5oYXJkZW4obWFrZVN0b3JlZFN1YnNjcmlwdGlvbik7XG52YXIgbWFrZVN0b3JlZFB1Ymxpc2hLaXQgPSAoc3RvcmFnZU5vZGUsIG1hcnNoYWxsZXIpID0+IHtcbiAgY29uc3QgeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSA9IG1ha2VQdWJsaXNoS2l0KCk7XG4gIHJldHVybiB7XG4gICAgcHVibGlzaGVyLFxuICAgIC8vXG4gICAgc3Vic2NyaWJlcjogbWFrZVN0b3JlZFN1YnNjcmliZXIoc3Vic2NyaWJlciwgc3RvcmFnZU5vZGUsIG1hcnNoYWxsZXIpXG4gIH07XG59O1xuaGFyZGVuKG1ha2VTdG9yZWRQdWJsaXNoS2l0KTtcblxuLy9cbnZhciBldmVudExvb3BJdGVyYXRpb24gPSBhc3luYyAoKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZTIpID0+IHNldEltbWVkaWF0ZShyZXNvbHZlMikpO1xuaGFyZGVuKGV2ZW50TG9vcEl0ZXJhdGlvbik7XG52YXIgc3RyaW5nT3JUYWcgPSAodmFsdWUpID0+IHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgU3ltYm9sLnRvU3RyaW5nVGFnIGluIHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlW1N5bWJvbC50b1N0cmluZ1RhZ107XG4gIH1cbiAgcmV0dXJuIFN0cmluZyh2YWx1ZSk7XG59O1xudmFyIGluc3BlY3RNYXBTdG9yZSA9IChzdG9yZSkgPT4ge1xuICBjb25zdCBvYmogPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgb2Ygc3RvcmUua2V5cygpKSB7XG4gICAgY29uc3QgdmFsdWUgPSBzdG9yZS5nZXQoa2V5KTtcbiAgICBjb25zdCBoYXNLZXlzID0gdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIFwia2V5c1wiIGluIHZhbHVlO1xuICAgIGNvbnN0IGluZGV4ID0gc3RyaW5nT3JUYWcoa2V5KTtcbiAgICBpZiAoaGFzS2V5cyAmJiBcImdldFwiIGluIHZhbHVlKSB7XG4gICAgICBvYmpbaW5kZXhdID0gaW5zcGVjdE1hcFN0b3JlKHZhbHVlKTtcbiAgICB9IGVsc2UgaWYgKGhhc0tleXMpIHtcbiAgICAgIG9ialtpbmRleF0gPSBBcnJheS5mcm9tKHZhbHVlLmtleXMoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9ialtpbmRleF0gPSB2YWx1ZSBpbnN0YW5jZW9mIE9iamVjdCAmJiBTeW1ib2wudG9TdHJpbmdUYWcgaW4gdmFsdWUgPyB2YWx1ZVtTeW1ib2wudG9TdHJpbmdUYWddIDogdmFsdWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBvYmo7XG59O1xuaGFyZGVuKGluc3BlY3RNYXBTdG9yZSk7XG5cbi8vXG52YXIgbWFrZUZha2VTdG9yYWdlID0gKHBhdGgsIHB1YmxpY2F0aW9uKSA9PiB7XG4gIGxldCBzZXRWYWx1ZUNhbGxzID0gMDtcbiAgY29uc3QgZnVsbFBhdGggPSBgcHVibGlzaC4ke3BhdGh9YDtcbiAgY29uc3Qgc3RvcmVLZXkgPSBoYXJkZW4oe1xuICAgIHN0b3JlTmFtZTogXCJzd2luZ3NldFwiLFxuICAgIHN0b3JlU3Via2V5OiBgc3dpbmdzZXQvZGF0YToke2Z1bGxQYXRofWAsXG4gICAgZGF0YVByZWZpeEJ5dGVzOiBcIlwiXG4gIH0pO1xuICBjb25zdCBzdG9yYWdlID0gRmFyKFwiU3RvcmFnZU5vZGVcIiwge1xuICAgIGdldFBhdGg6ICgpID0+IHBhdGgsXG4gICAgZ2V0U3RvcmVLZXk6IGFzeW5jICgpID0+IHN0b3JlS2V5LFxuICAgIHNldFZhbHVlOiBhc3luYyAodmFsdWUpID0+IHtcbiAgICAgIHNldFZhbHVlQ2FsbHMgKz0gMTtcbiAgICAgIGFzc2VydC50eXBlb2YodmFsdWUsIFwic3RyaW5nXCIpO1xuICAgICAgaWYgKHB1YmxpY2F0aW9uKSB7XG4gICAgICAgIHB1YmxpY2F0aW9uLnVwZGF0ZVN0YXRlKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1ha2VDaGlsZE5vZGU6ICgpID0+IHN0b3JhZ2UsXG4gICAgY291bnRTZXRWYWx1ZUNhbGxzOiAoKSA9PiBzZXRWYWx1ZUNhbGxzXG4gIH0pO1xuICByZXR1cm4gc3RvcmFnZTtcbn07XG5oYXJkZW4obWFrZUZha2VTdG9yYWdlKTtcbnZhciBtYWtlRmFrZU1hcnNoYWxsZXIgPSAoKSA9PiBtYWtlTWFyc2hhbCh2b2lkIDAsIHZvaWQgMCwge1xuICBtYXJzaGFsU2F2ZUVycm9yOiAoKSA9PiB7XG4gIH1cbn0pO1xuaGFyZGVuKG1ha2VGYWtlTWFyc2hhbGxlcik7XG5cbi8vXG52YXIgcHJlcGFyZVJlY29yZGVyID0gKGJhZ2dhZ2UsIG1hcnNoYWxsZXIpID0+IHtcbiAgY29uc3QgbWFrZVJlY29yZGVyID0gcHJlcGFyZUV4b0NsYXNzKFxuICAgIGJhZ2dhZ2UsXG4gICAgXCJSZWNvcmRlclwiLFxuICAgIE0uaW50ZXJmYWNlKFwiUmVjb3JkZXJcIiwge1xuICAgICAgZ2V0U3RvcmFnZU5vZGU6IE0uY2FsbCgpLnJldHVybnMoU3RvcmFnZU5vZGVTaGFwZSksXG4gICAgICBnZXRTdG9yYWdlUGF0aDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoXG4gICAgICAgIC8qICAgICAgICAqL1xuICAgICAgKSksXG4gICAgICB3cml0ZTogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgd3JpdGVGaW5hbDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoTS5wcm9taXNlKCkpXG4gICAgfSksXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgIChwdWJsaXNoZXIsIHN0b3JhZ2VOb2RlLCB2YWx1ZVNoYXBlID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIE0uYW55KClcbiAgICApKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjbG9zZWQ6IGZhbHNlLFxuICAgICAgICBwdWJsaXNoZXIsXG4gICAgICAgIHN0b3JhZ2VOb2RlLFxuICAgICAgICBzdG9yYWdlUGF0aDogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHZvaWQgMFxuICAgICAgICApLFxuICAgICAgICB2YWx1ZVNoYXBlXG4gICAgICB9O1xuICAgIH0sXG4gICAge1xuICAgICAgZ2V0U3RvcmFnZU5vZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnN0b3JhZ2VOb2RlO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIGdldFN0b3JhZ2VQYXRoKCkge1xuICAgICAgICBjb25zdCB7IHN0b3JhZ2VQYXRoOiBoZWxkUGF0aCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgYXdhaXQgbnVsbDtcbiAgICAgICAgaWYgKGhlbGRQYXRoICE9PSB2b2lkIDApIHtcbiAgICAgICAgICByZXR1cm4gaGVsZFBhdGg7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGF0aCA9IGF3YWl0IEUodGhpcy5zdGF0ZS5zdG9yYWdlTm9kZSkuZ2V0UGF0aCgpO1xuICAgICAgICB0aGlzLnN0YXRlLnN0b3JhZ2VQYXRoID0gcGF0aDtcbiAgICAgICAgcmV0dXJuIHBhdGg7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuICAgICAgICovXG4gICAgICBhc3luYyB3cml0ZSh2YWx1ZSkge1xuICAgICAgICBjb25zdCB7IGNsb3NlZCwgcHVibGlzaGVyLCBzdG9yYWdlTm9kZSwgdmFsdWVTaGFwZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgIWNsb3NlZCB8fCB0aHJvd1JlZGFjdGVkYGNhbm5vdCB3cml0ZSB0byBjbG9zZWQgcmVjb3JkZXJgO1xuICAgICAgICBtdXN0TWF0Y2gyKHZhbHVlLCB2YWx1ZVNoYXBlKTtcbiAgICAgICAgY29uc3QgZW5jb2RlZCA9IGF3YWl0IEUobWFyc2hhbGxlcikudG9DYXBEYXRhKHZhbHVlKTtcbiAgICAgICAgY29uc3Qgc2VyaWFsaXplZCA9IEpTT04uc3RyaW5naWZ5KGVuY29kZWQpO1xuICAgICAgICBhd2FpdCBFKHN0b3JhZ2VOb2RlKS5zZXRWYWx1ZShzZXJpYWxpemVkKTtcbiAgICAgICAgcmV0dXJuIHB1Ymxpc2hlci5wdWJsaXNoKHZhbHVlKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIHdyaXRlRmluYWwodmFsdWUpIHtcbiAgICAgICAgY29uc3QgeyBjbG9zZWQsIHB1Ymxpc2hlciwgc3RvcmFnZU5vZGUsIHZhbHVlU2hhcGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICFjbG9zZWQgfHwgdGhyb3dSZWRhY3RlZGBjYW5ub3Qgd3JpdGUgdG8gY2xvc2VkIHJlY29yZGVyYDtcbiAgICAgICAgbXVzdE1hdGNoMih2YWx1ZSwgdmFsdWVTaGFwZSk7XG4gICAgICAgIGNvbnN0IGVuY29kZWQgPSBhd2FpdCBFKG1hcnNoYWxsZXIpLnRvQ2FwRGF0YSh2YWx1ZSk7XG4gICAgICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSBKU09OLnN0cmluZ2lmeShlbmNvZGVkKTtcbiAgICAgICAgYXdhaXQgRShzdG9yYWdlTm9kZSkuc2V0VmFsdWUoc2VyaWFsaXplZCk7XG4gICAgICAgIHRoaXMuc3RhdGUuY2xvc2VkID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHB1Ymxpc2hlci5maW5pc2godmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuIG1ha2VSZWNvcmRlcjtcbn07XG5oYXJkZW4ocHJlcGFyZVJlY29yZGVyKTtcbnZhciBkZWZpbmVSZWNvcmRlcktpdCA9ICh7IG1ha2VSZWNvcmRlciwgbWFrZUR1cmFibGVQdWJsaXNoS2l0IH0pID0+IHtcbiAgY29uc3QgbWFrZVJlY29yZGVyS2l0ID0gKHN0b3JhZ2VOb2RlLCB2YWx1ZVNoYXBlKSA9PiB7XG4gICAgY29uc3QgeyBzdWJzY3JpYmVyLCBwdWJsaXNoZXIgfSA9IG1ha2VEdXJhYmxlUHVibGlzaEtpdCgpO1xuICAgIGNvbnN0IHJlY29yZGVyID0gbWFrZVJlY29yZGVyKFxuICAgICAgcHVibGlzaGVyLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHN0b3JhZ2VOb2RlLFxuICAgICAgdmFsdWVTaGFwZVxuICAgICk7XG4gICAgcmV0dXJuIGhhcmRlbih7IHN1YnNjcmliZXIsIHJlY29yZGVyIH0pO1xuICB9O1xuICByZXR1cm4gbWFrZVJlY29yZGVyS2l0O1xufTtcbnZhciBkZWZpbmVFUmVjb3JkZXJLaXQgPSAoeyBtYWtlUmVjb3JkZXIsIG1ha2VEdXJhYmxlUHVibGlzaEtpdCB9KSA9PiB7XG4gIGNvbnN0IG1ha2VFUmVjb3JkZXJLaXQgPSAoc3RvcmFnZU5vZGVQLCB2YWx1ZVNoYXBlKSA9PiB7XG4gICAgY29uc3QgeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSA9IG1ha2VEdXJhYmxlUHVibGlzaEtpdCgpO1xuICAgIGNvbnN0IHJlY29yZGVyUCA9IEUud2hlbihcbiAgICAgIHN0b3JhZ2VOb2RlUCxcbiAgICAgIChzdG9yYWdlTm9kZSkgPT4gbWFrZVJlY29yZGVyKFxuICAgICAgICBwdWJsaXNoZXIsXG4gICAgICAgIC8vXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHN0b3JhZ2VOb2RlLFxuICAgICAgICB2YWx1ZVNoYXBlXG4gICAgICApXG4gICAgKTtcbiAgICByZXR1cm4geyBzdWJzY3JpYmVyLCByZWNvcmRlclAgfTtcbiAgfTtcbiAgcmV0dXJuIG1ha2VFUmVjb3JkZXJLaXQ7XG59O1xuaGFyZGVuKGRlZmluZUVSZWNvcmRlcktpdCk7XG52YXIgcHJlcGFyZVJlY29yZGVyS2l0TWFrZXJzID0gKGJhZ2dhZ2UsIG1hcnNoYWxsZXIpID0+IHtcbiAgY29uc3QgbWFrZUR1cmFibGVQdWJsaXNoS2l0ID0gcHJlcGFyZUR1cmFibGVQdWJsaXNoS2l0KFxuICAgIGJhZ2dhZ2UsXG4gICAgXCJEdXJhYmxlIFB1Ymxpc2ggS2l0XCJcbiAgKTtcbiAgY29uc3QgbWFrZVJlY29yZGVyID0gcHJlcGFyZVJlY29yZGVyKGJhZ2dhZ2UsIG1hcnNoYWxsZXIpO1xuICBjb25zdCBtYWtlUmVjb3JkZXJLaXQgPSBkZWZpbmVSZWNvcmRlcktpdCh7XG4gICAgbWFrZVJlY29yZGVyLFxuICAgIG1ha2VEdXJhYmxlUHVibGlzaEtpdFxuICB9KTtcbiAgY29uc3QgbWFrZUVSZWNvcmRlcktpdCA9IGRlZmluZUVSZWNvcmRlcktpdCh7XG4gICAgbWFrZVJlY29yZGVyLFxuICAgIG1ha2VEdXJhYmxlUHVibGlzaEtpdFxuICB9KTtcbiAgcmV0dXJuIHtcbiAgICBtYWtlRHVyYWJsZVB1Ymxpc2hLaXQsXG4gICAgbWFrZVJlY29yZGVyLFxuICAgIG1ha2VSZWNvcmRlcktpdCxcbiAgICBtYWtlRVJlY29yZGVyS2l0XG4gIH07XG59O1xudmFyIFJlY29yZGVyS2l0U2hhcGUgPSB7XG4gIHJlY29yZGVyOiBNLnJlbW90YWJsZSgpLFxuICBzdWJzY3JpYmVyOiBNLnJlbW90YWJsZSgpXG59O1xuaGFyZGVuKFJlY29yZGVyS2l0U2hhcGUpO1xuXG4vL1xudmFyIGlzU3RvcmFibGUgPSAoc3BlY2ltZW4pID0+IGlzUGFzc2FibGUoc3BlY2ltZW4pICYmIGNhbkJlRHVyYWJsZShzcGVjaW1lbik7XG5oYXJkZW4oaXNTdG9yYWJsZSk7XG52YXIgYXR0YWNoRHVyYWJsZVN0b3JlcyA9IChnZXRCYWdnYWdlKSA9PiB7XG4gIGNvbnN0IG1hcFN0b3JlID0gKGxhYmVsLCBvcHRpb25zKSA9PiB7XG4gICAgY29uc3QgYmFnZ2FnZSA9IGdldEJhZ2dhZ2UoKTtcbiAgICBjb25zdCByZXQgPSBwcm92aWRlRHVyYWJsZU1hcFN0b3JlKGJhZ2dhZ2UsIGxhYmVsLCBvcHRpb25zKTtcbiAgICByZXR1cm4gcmV0O1xuICB9O1xuICBjb25zdCBzZXRTdG9yZSA9IChsYWJlbCwgb3B0aW9ucykgPT4gcHJvdmlkZUR1cmFibGVTZXRTdG9yZShnZXRCYWdnYWdlKCksIGxhYmVsLCBvcHRpb25zKTtcbiAgY29uc3Qgd2Vha1NldFN0b3JlID0gKGxhYmVsLCBvcHRpb25zKSA9PiBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZShnZXRCYWdnYWdlKCksIGxhYmVsLCBvcHRpb25zKTtcbiAgY29uc3Qgd2Vha01hcFN0b3JlID0gKGxhYmVsLCBvcHRpb25zKSA9PiBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZShnZXRCYWdnYWdlKCksIGxhYmVsLCBvcHRpb25zKTtcbiAgcmV0dXJuIEZhcihcImR1cmFibGVTdG9yZXNcIiwge1xuICAgIGRldGFjaGVkOiAoKSA9PiBkZXRhY2hlZER1cmFibGVTdG9yZXMsXG4gICAgaXNTdG9yYWJsZSxcbiAgICBtYXBTdG9yZSxcbiAgICBzZXRTdG9yZSxcbiAgICB3ZWFrTWFwU3RvcmUsXG4gICAgd2Vha1NldFN0b3JlXG4gIH0pO1xufTtcbnZhciBkZXRhY2hlZER1cmFibGVTdG9yZXMgPSBhdHRhY2hEdXJhYmxlU3RvcmVzKFxuICAoKSA9PiBtYWtlU2NhbGFyTWFwU3RvcmUoXCJkZXRhY2hlZFwiKVxuKTtcbnZhciBtYWtlRHVyYWJsZVpvbmUgPSAoYmFnZ2FnZSwgYmFzZUxhYmVsID0gXCJkdXJhYmxlWm9uZVwiKSA9PiB7XG4gIGJhZ2dhZ2UgfHwgdGhyb3dSZWRhY3RlZGBiYWdnYWdlIHJlcXVpcmVkYDtcbiAgY29uc3QgYXR0YWNoZWRTdG9yZXMgPSBhdHRhY2hEdXJhYmxlU3RvcmVzKCgpID0+IGJhZ2dhZ2UpO1xuICBjb25zdCB7IG1ha2VPbmNlLCB3cmFwUHJvdmlkZXIgfSA9IG1ha2VPbmNlS2l0KFxuICAgIGJhc2VMYWJlbCxcbiAgICBhdHRhY2hlZFN0b3JlcyxcbiAgICBiYWdnYWdlXG4gICk7XG4gIGNvbnN0IGV4b0NsYXNzID0gKC4uLmFyZ3MpID0+IHByZXBhcmVFeG9DbGFzcyhiYWdnYWdlLCAuLi5hcmdzKTtcbiAgY29uc3QgZXhvQ2xhc3NLaXQgPSAoLi4uYXJncykgPT4gcHJlcGFyZUV4b0NsYXNzS2l0KGJhZ2dhZ2UsIC4uLmFyZ3MpO1xuICBjb25zdCBleG8gPSAoLi4uYXJncykgPT4gcHJlcGFyZUV4byhiYWdnYWdlLCAuLi5hcmdzKTtcbiAgY29uc3Qgc3ViWm9uZVN0b3JlID0gd3JhcFByb3ZpZGVyKGF0dGFjaGVkU3RvcmVzLm1hcFN0b3JlLCBhZ29yaWNWYXREYXRhS2V5cy56b25lKTtcbiAgY29uc3Qgc3ViWm9uZSA9IChsYWJlbCwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gICAgY29uc3Qgc3ViQmFnZ2FnZSA9IHN1YlpvbmVTdG9yZShsYWJlbCwgb3B0aW9ucyk7XG4gICAgcmV0dXJuIG1ha2VEdXJhYmxlWm9uZShzdWJCYWdnYWdlLCBgJHtiYXNlTGFiZWx9LiR7bGFiZWx9YCk7XG4gIH07XG4gIHJldHVybiBGYXIoXCJkdXJhYmxlWm9uZVwiLCB7XG4gICAgZXhvOiB3cmFwUHJvdmlkZXIoZXhvLCBhZ29yaWNWYXREYXRhS2V5cy5leG8pLFxuICAgIGV4b0NsYXNzOiB3cmFwUHJvdmlkZXIoZXhvQ2xhc3MsIGFnb3JpY1ZhdERhdGFLZXlzLmV4b0NsYXNzKSxcbiAgICBleG9DbGFzc0tpdDogd3JhcFByb3ZpZGVyKGV4b0NsYXNzS2l0LCBhZ29yaWNWYXREYXRhS2V5cy5leG9DbGFzc0tpdCksXG4gICAgc3ViWm9uZSxcbiAgICBtYWtlT25jZSxcbiAgICB3YXRjaFByb21pc2U6IHdhdGNoUHJvbWlzZTIsXG4gICAgZGV0YWNoZWQ6IGF0dGFjaGVkU3RvcmVzLmRldGFjaGVkLFxuICAgIGlzU3RvcmFibGU6IGF0dGFjaGVkU3RvcmVzLmlzU3RvcmFibGUsXG4gICAgbWFwU3RvcmU6IHdyYXBQcm92aWRlcihhdHRhY2hlZFN0b3Jlcy5tYXBTdG9yZSwgYWdvcmljVmF0RGF0YUtleXMuc3RvcmUpLFxuICAgIHNldFN0b3JlOiB3cmFwUHJvdmlkZXIoYXR0YWNoZWRTdG9yZXMuc2V0U3RvcmUsIGFnb3JpY1ZhdERhdGFLZXlzLnN0b3JlKSxcbiAgICB3ZWFrTWFwU3RvcmU6IHdyYXBQcm92aWRlcihhdHRhY2hlZFN0b3Jlcy53ZWFrTWFwU3RvcmUsIGFnb3JpY1ZhdERhdGFLZXlzLnN0b3JlKSxcbiAgICB3ZWFrU2V0U3RvcmU6IHdyYXBQcm92aWRlcihhdHRhY2hlZFN0b3Jlcy53ZWFrU2V0U3RvcmUsIGFnb3JpY1ZhdERhdGFLZXlzLnN0b3JlKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUR1cmFibGVab25lKTtcblxuLy9cbnZhciBjYWlwSWRGcm9tSW5mbyA9IChpbmZvKSA9PiB7XG4gIHJldHVybiBgJHtpbmZvLm5hbWVzcGFjZX06JHtpbmZvLnJlZmVyZW5jZX1gO1xufTtcblxuLy9cbnZhciBQRk1fUkVDRUlWRVIgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIFwicGZtXCJcbik7XG52YXIgSHViTmFtZSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBDaGFpbjogXCJjaGFpblwiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIENoYWluQXNzZXRzOiBcImNoYWluQXNzZXRzXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIENoYWluQ29ubmVjdGlvbjogXCJjaGFpbkNvbm5lY3Rpb25cIlxuICB9XG4pO1xuaGFyZGVuKEh1Yk5hbWUpO1xudmFyIENIQUlOX0tFWSA9IEh1Yk5hbWUuQ2hhaW47XG52YXIgQ09OTkVDVElPTlNfS0VZID0gSHViTmFtZS5DaGFpbkNvbm5lY3Rpb247XG52YXIgQVNTRVRTX0tFWSA9IEh1Yk5hbWUuQ2hhaW5Bc3NldHM7XG52YXIgQ0hBSU5fSURfU0VQQVJBVE9SID0gXCJfXCI7XG52YXIgZW5jb2RlQ2hhaW5JZCA9IChjaGFpbklkKSA9PiBjaGFpbklkLnJlcGxhY2VBbGwoXG4gIENIQUlOX0lEX1NFUEFSQVRPUixcbiAgYCR7Q0hBSU5fSURfU0VQQVJBVE9SfSR7Q0hBSU5fSURfU0VQQVJBVE9SfWBcbik7XG52YXIgY29ubmVjdGlvbktleSA9IChjaGFpbklkMSwgY2hhaW5JZDIpID0+IHtcbiAgY29uc3QgY2hhaW5JZDFTYW5pdGl6ZWQgPSBlbmNvZGVDaGFpbklkKGNoYWluSWQxKTtcbiAgY29uc3QgY2hhaW5JZDJTYW5pdGl6ZWQgPSBlbmNvZGVDaGFpbklkKGNoYWluSWQyKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgW2NoYWluSWQxU2FuaXRpemVkLCBjaGFpbklkMlNhbml0aXplZF0uc29ydCgpLmpvaW4oQ0hBSU5fSURfU0VQQVJBVE9SKVxuICApO1xufTtcbnZhciByZXZlcnNlQ29ubkluZm8gPSAoY29ubkluZm8pID0+IHtcbiAgY29uc3QgeyB0cmFuc2ZlckNoYW5uZWwgfSA9IGNvbm5JbmZvO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBpZDogY29ubkluZm8uY291bnRlcnBhcnR5LmNvbm5lY3Rpb25faWQsXG4gICAgY2xpZW50X2lkOiBjb25uSW5mby5jb3VudGVycGFydHkuY2xpZW50X2lkLFxuICAgIGNvdW50ZXJwYXJ0eToge1xuICAgICAgY2xpZW50X2lkOiBjb25uSW5mby5jbGllbnRfaWQsXG4gICAgICBjb25uZWN0aW9uX2lkOiBjb25uSW5mby5pZFxuICAgIH0sXG4gICAgc3RhdGU6IGNvbm5JbmZvLnN0YXRlLFxuICAgIHRyYW5zZmVyQ2hhbm5lbDoge1xuICAgICAgLi4udHJhbnNmZXJDaGFubmVsLFxuICAgICAgY2hhbm5lbElkOiB0cmFuc2ZlckNoYW5uZWwuY291bnRlclBhcnR5Q2hhbm5lbElkLFxuICAgICAgY291bnRlclBhcnR5Q2hhbm5lbElkOiB0cmFuc2ZlckNoYW5uZWwuY2hhbm5lbElkLFxuICAgICAgcG9ydElkOiB0cmFuc2ZlckNoYW5uZWwuY291bnRlclBhcnR5UG9ydElkLFxuICAgICAgY291bnRlclBhcnR5UG9ydElkOiB0cmFuc2ZlckNoYW5uZWwucG9ydElkXG4gICAgfVxuICB9KTtcbn07XG52YXIgbm9ybWFsaXplQ29ubmVjdGlvbkluZm8gPSAocHJpbWFyeUNoYWluSWQsIGNvdW50ZXJDaGFpbklkLCBkaXJlY3RlZCkgPT4ge1xuICBjb25zdCBrZXkgPSBjb25uZWN0aW9uS2V5KHByaW1hcnlDaGFpbklkLCBjb3VudGVyQ2hhaW5JZCk7XG4gIGlmIChwcmltYXJ5Q2hhaW5JZCA8IGNvdW50ZXJDaGFpbklkKSB7XG4gICAgcmV0dXJuIFtrZXksIGRpcmVjdGVkXTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gW2tleSwgcmV2ZXJzZUNvbm5JbmZvKGRpcmVjdGVkKV07XG4gIH1cbn07XG52YXIgZGVub3JtYWxpemVDb25uZWN0aW9uSW5mbyA9IChwcmltYXJ5Q2hhaW5JZCwgY291bnRlckNoYWluSWQsIG5vcm1hbGl6ZWQpID0+IHtcbiAgaWYgKHByaW1hcnlDaGFpbklkIDwgY291bnRlckNoYWluSWQpIHtcbiAgICByZXR1cm4gbm9ybWFsaXplZDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmV2ZXJzZUNvbm5JbmZvKG5vcm1hbGl6ZWQpO1xuICB9XG59O1xudmFyIENoYWluSWRBcmdTaGFwZSA9IE0ub3IoXG4gIE0uc3RyaW5nKCksXG4gIE0uc3BsaXRSZWNvcmQoXG4gICAge1xuICAgICAgY2hhaW5JZDogTS5zdHJpbmcoKVxuICAgIH0sXG4gICAgdm9pZCAwLFxuICAgIE0uYW55KClcbiAgKVxuKTtcbnZhciBEZWZhdWx0UGZtVGltZW91dE9wdHMgPSBoYXJkZW4oXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICByZXRyaWVzOiAzLFxuICAgIHRpbWVvdXQ6IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICBcIjEwbVwiXG4gICAgKVxuICB9XG4pO1xudmFyIFRyYW5zZmVyUm91dGVTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBzb3VyY2VQb3J0OiBNLnN0cmluZygpLFxuICAgIHNvdXJjZUNoYW5uZWw6IElCQ0NoYW5uZWxJRFNoYXBlLFxuICAgIHRva2VuOiBDb2luU2hhcGUsXG4gICAgcmVjZWl2ZXI6IE0uc3RyaW5nKClcbiAgfSxcbiAgeyBmb3J3YXJkSW5mbzogRm9yd2FyZEluZm9TaGFwZSB9LFxuICB7fVxuKTtcbnZhciBDaGFpbkh1YkkgPSBNLmludGVyZmFjZShcIkNoYWluSHViXCIsIHtcbiAgcmVnaXN0ZXJDaGFpbjogTS5jYWxsKE0uc3RyaW5nKCksIENoYWluSW5mb1NoYXBlKS5yZXR1cm5zKCksXG4gIHVwZGF0ZUNoYWluOiBNLmNhbGwoTS5zdHJpbmcoKSwgQ2hhaW5JbmZvU2hhcGUpLnJldHVybnMoKSxcbiAgZ2V0Q2hhaW5JbmZvOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldENoYWluSW5mb0J5Q2hhaW5JZDogTS5jYWxsKE0uc3RyaW5nKCkpLnJldHVybnMoQ2hhaW5JbmZvU2hhcGUpLFxuICByZWdpc3RlckNvbm5lY3Rpb246IE0uY2FsbChcbiAgICBNLnN0cmluZygpLFxuICAgIE0uc3RyaW5nKCksXG4gICAgSUJDQ29ubmVjdGlvbkluZm9TaGFwZVxuICApLnJldHVybnMoKSxcbiAgdXBkYXRlQ29ubmVjdGlvbjogTS5jYWxsKFxuICAgIE0uc3RyaW5nKCksXG4gICAgTS5zdHJpbmcoKSxcbiAgICBJQkNDb25uZWN0aW9uSW5mb1NoYXBlXG4gICkucmV0dXJucygpLFxuICBnZXRDb25uZWN0aW9uSW5mbzogTS5jYWxsKENoYWluSWRBcmdTaGFwZSwgQ2hhaW5JZEFyZ1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0Q2hhaW5zQW5kQ29ubmVjdGlvbjogTS5jYWxsKE0uc3RyaW5nKCksIE0uc3RyaW5nKCkpLnJldHVybnMoVm93U2hhcGUpLFxuICByZWdpc3RlckFzc2V0OiBNLmNhbGwoTS5zdHJpbmcoKSwgRGVub21EZXRhaWxTaGFwZSkucmV0dXJucygpLFxuICB1cGRhdGVBc3NldDogTS5jYWxsKE0uc3RyaW5nKCksIERlbm9tRGV0YWlsU2hhcGUpLnJldHVybnMoKSxcbiAgZ2V0QXNzZXQ6IE0uY2FsbChNLnN0cmluZygpLCBNLnN0cmluZygpKS5yZXR1cm5zKFxuICAgIE0ub3IoRGVub21EZXRhaWxTaGFwZSwgTS51bmRlZmluZWQoKSlcbiAgKSxcbiAgZ2V0RGVub206IE0uY2FsbChCcmFuZFNoYXBlKS5yZXR1cm5zKE0ub3IoTS5zdHJpbmcoKSwgTS51bmRlZmluZWQoKSkpLFxuICBjb2VyY2VDb3Ntb3NBZGRyZXNzOiBNLmNhbGwoQWNjb3VudElkQXJnU2hhcGUpLnJldHVybnMoXG4gICAgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGVcbiAgKSxcbiAgcmVzb2x2ZUFjY291bnRJZDogTS5jYWxsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIG1ha2VUcmFuc2ZlclJvdXRlOiBNLmNhbGwoQWNjb3VudElkQXJnU2hhcGUsIERlbm9tQW1vdW50U2hhcGUsIE0uc3RyaW5nKCkpLm9wdGlvbmFsKEZvcndhcmRPcHRzU2hhcGUpLnJldHVybnMoTS5vcihNLnVuZGVmaW5lZCgpLCBUcmFuc2ZlclJvdXRlU2hhcGUpKVxufSk7XG52YXIgbWFrZUNoYWluSHViID0gKHpvbmUsIGFnb3JpY05hbWVzLCB2b3dUb29scywgeyBjaGFpbkluZm9WYWx1ZVNoYXBlID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICovXG4gIENoYWluSW5mb1NoYXBlXG4pIH0gPSB7fSkgPT4ge1xuICBjb25zdCBjaGFpbkluZm9zID0gem9uZS5tYXBTdG9yZShcImNoYWluSW5mb3NcIiwge1xuICAgIGtleVNoYXBlOiBNLnN0cmluZygpLFxuICAgIHZhbHVlU2hhcGU6IGNoYWluSW5mb1ZhbHVlU2hhcGVcbiAgfSk7XG4gIGNvbnN0IGNvbm5lY3Rpb25JbmZvcyA9IHpvbmUubWFwU3RvcmUoXCJjb25uZWN0aW9uSW5mb3NcIiwge1xuICAgIGtleVNoYXBlOiBNLnN0cmluZygpLFxuICAgIHZhbHVlU2hhcGU6IElCQ0Nvbm5lY3Rpb25JbmZvU2hhcGVcbiAgfSk7XG4gIGNvbnN0IGRlbm9tRGV0YWlscyA9IHpvbmUubWFwU3RvcmUoXCJkZW5vbVwiLCB7XG4gICAga2V5U2hhcGU6IE0uc3RyaW5nKCksXG4gICAgdmFsdWVTaGFwZTogRGVub21EZXRhaWxTaGFwZVxuICB9KTtcbiAgY29uc3QgYnJhbmREZW5vbXMgPSB6b25lLm1hcFN0b3JlKFwiYnJhbmREZW5vbVwiLCB7XG4gICAga2V5U2hhcGU6IEJyYW5kU2hhcGUsXG4gICAgdmFsdWVTaGFwZTogTS5zdHJpbmcoKVxuICB9KTtcbiAgY29uc3QgYmVjaDMyUHJlZml4VG9DaGFpbk5hbWUgPSB6b25lLm1hcFN0b3JlKFwiYmVjaDMyUHJlZml4VG9DaGFpbk5hbWVcIiwge1xuICAgIGtleVNoYXBlOiBNLnN0cmluZygpLFxuICAgIHZhbHVlU2hhcGU6IE0uc3RyaW5nKClcbiAgfSk7XG4gIGNvbnN0IGNoYWluSWRUb0NoYWluTmFtZSA9IHpvbmUubWFwU3RvcmUoXCJjaGFpbklkVG9DaGFpbk5hbWVcIiwge1xuICAgIGtleVNoYXBlOiBNLnN0cmluZygpLFxuICAgIHZhbHVlU2hhcGU6IE0uc3RyaW5nKClcbiAgfSk7XG4gIGNvbnN0IG1ha2VEZW5vbUtleSA9IChkZW5vbSwgc3JjQ2hhaW5OYW1lKSA9PiBgJHtzcmNDaGFpbk5hbWV9OiR7ZGVub219YDtcbiAgY29uc3QgcmVzb2x2ZUNvc21vc0NoYWluSWQgPSAoYWRkcmVzcykgPT4ge1xuICAgIGNvbnN0IHByZWZpeCA9IGdldEJlY2gzMlByZWZpeChhZGRyZXNzKTtcbiAgICBpZiAoIWJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lLmhhcyhwcmVmaXgpKSB7XG4gICAgICB0aHJvdyBtYWtlRXJyb3IoYENoYWluIGluZm8gbm90IGZvdW5kIGZvciBiZWNoMzJQcmVmaXggJHtxdW90ZShwcmVmaXgpfWApO1xuICAgIH1cbiAgICBjb25zdCBjaGFpbk5hbWUgPSBiZWNoMzJQcmVmaXhUb0NoYWluTmFtZS5nZXQocHJlZml4KTtcbiAgICBjb25zdCB7IGNoYWluSWQgfSA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgY2hhaW5JbmZvcy5nZXQoY2hhaW5OYW1lKVxuICAgICk7XG4gICAgcmV0dXJuIGNoYWluSWQ7XG4gIH07XG4gIGNvbnN0IGxvb2t1cENoYWluSW5mbyA9IHZvd1Rvb2xzLnJldHJ5YWJsZShcbiAgICB6b25lLFxuICAgIFwibG9va3VwQ2hhaW5JbmZvXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAvL1xuICAgIGFzeW5jIChjaGFpbk5hbWUpID0+IHtcbiAgICAgIGF3YWl0IG51bGw7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGFpbkluZm8gPSBhd2FpdCBFKGFnb3JpY05hbWVzKS5sb29rdXAoSHViTmFtZS5DaGFpbiwgY2hhaW5OYW1lKTtcbiAgICAgICAgaWYgKCFjaGFpbkluZm9zLmhhcyhjaGFpbk5hbWUpKSB7XG4gICAgICAgICAgY2hhaW5JbmZvcy5pbml0KGNoYWluTmFtZSwgY2hhaW5JbmZvKTtcbiAgICAgICAgICBjaGFpbklkVG9DaGFpbk5hbWUuaW5pdChjYWlwSWRGcm9tSW5mbyhjaGFpbkluZm8pLCBjaGFpbk5hbWUpO1xuICAgICAgICAgIGlmIChjaGFpbkluZm8uYmVjaDMyUHJlZml4KSB7XG4gICAgICAgICAgICBiZWNoMzJQcmVmaXhUb0NoYWluTmFtZS5pbml0KGNoYWluSW5mby5iZWNoMzJQcmVmaXgsIGNoYWluTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGFpbkluZm87XG4gICAgICB9IGNhdGNoIChlMikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwibG9va3VwQ2hhaW5JbmZvXCIsIGNoYWluTmFtZSwgXCJlcnJvclwiLCBlMik7XG4gICAgICAgIHRocm93IG1ha2VFcnJvcihgY2hhaW4gbm90IGZvdW5kOiR7Y2hhaW5OYW1lfWApO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbG9va3VwQ29ubmVjdGlvbkluZm8gPSB2b3dUb29scy5yZXRyeWFibGUoXG4gICAgem9uZSxcbiAgICBcImxvb2t1cENvbm5lY3Rpb25JbmZvXCIsXG4gICAgLypcblxuXG4gICAgICovXG4gICAgLy9cbiAgICBhc3luYyAoY2hhaW5JZDEsIGNoYWluSWQyKSA9PiB7XG4gICAgICBhd2FpdCBudWxsO1xuICAgICAgY29uc3Qga2V5ID0gY29ubmVjdGlvbktleShjaGFpbklkMSwgY2hhaW5JZDIpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29ubmVjdGlvbkluZm8gPSBhd2FpdCBFKGFnb3JpY05hbWVzKS5sb29rdXAoXG4gICAgICAgICAgSHViTmFtZS5DaGFpbkNvbm5lY3Rpb24sXG4gICAgICAgICAga2V5XG4gICAgICAgICk7XG4gICAgICAgIGlmICghY29ubmVjdGlvbkluZm9zLmhhcyhrZXkpKSB7XG4gICAgICAgICAgY29ubmVjdGlvbkluZm9zLmluaXQoa2V5LCBjb25uZWN0aW9uSW5mbyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oY2hhaW5JZDEsIGNoYWluSWQyLCBjb25uZWN0aW9uSW5mbyk7XG4gICAgICB9IGNhdGNoIChlMikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwibG9va3VwQ29ubmVjdGlvbkluZm9cIiwgY2hhaW5JZDEsIGNoYWluSWQyLCBcImVycm9yXCIsIGUyKTtcbiAgICAgICAgdGhyb3cgbWFrZUVycm9yKGBjb25uZWN0aW9uIG5vdCBmb3VuZDogJHtjaGFpbklkMX08LT4ke2NoYWluSWQyfWApO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbG9va3VwQ2hhaW5zQW5kQ29ubmVjdGlvbiA9IHZvd1Rvb2xzLnJldHJ5YWJsZShcbiAgICB6b25lLFxuICAgIFwibG9va3VwQ2hhaW5zQW5kQ29ubmVjdGlvblwiLFxuICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIC8vXG4gICAgYXN5bmMgKHByaW1hcnlOYW1lLCBjb3VudGVyTmFtZSkgPT4ge1xuICAgICAgY29uc3QgW3ByaW1hcnksIGNvdW50ZXJdID0gYXdhaXQgdm93VG9vbHMuYXNQcm9taXNlKFxuICAgICAgICB2b3dUb29scy5hbGxWb3dzKFtcbiAgICAgICAgICBjaGFpbkh1Yi5nZXRDaGFpbkluZm8ocHJpbWFyeU5hbWUpLFxuICAgICAgICAgIGNoYWluSHViLmdldENoYWluSW5mbyhjb3VudGVyTmFtZSlcbiAgICAgICAgXSlcbiAgICAgICk7XG4gICAgICBjb25zdCBjb25uZWN0aW9uSW5mbyA9IHByaW1hcnkubmFtZXNwYWNlID09PSBcImNvc21vc1wiICYmIGNvdW50ZXIubmFtZXNwYWNlID09PSBcImNvc21vc1wiID8gYXdhaXQgdm93VG9vbHMuYXNQcm9taXNlKFxuICAgICAgICBjaGFpbkh1Yi5nZXRDb25uZWN0aW9uSW5mbyhwcmltYXJ5LCBjb3VudGVyKVxuICAgICAgKSA6IHZvaWQgMDtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgW3ByaW1hcnksIGNvdW50ZXIsIGNvbm5lY3Rpb25JbmZvXVxuICAgICAgKTtcbiAgICB9XG4gICk7XG4gIGNvbnN0IGNoYWluSHViID0gem9uZS5leG8oXCJDaGFpbkh1YlwiLCBDaGFpbkh1YkksIHtcbiAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgcmVnaXN0ZXJDaGFpbihuYW1lLCBjaGFpbkluZm8pIHtcbiAgICAgIGNoYWluSW5mb3MuaW5pdChuYW1lLCBjaGFpbkluZm8pO1xuICAgICAgY2hhaW5JZFRvQ2hhaW5OYW1lLmluaXQoY2FpcElkRnJvbUluZm8oY2hhaW5JbmZvKSwgbmFtZSk7XG4gICAgICBpZiAoY2hhaW5JbmZvLm5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIiAmJiBjaGFpbkluZm8uYmVjaDMyUHJlZml4KSB7XG4gICAgICAgIGJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lLmluaXQoY2hhaW5JbmZvLmJlY2gzMlByZWZpeCwgbmFtZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cbiAgICAgKi9cbiAgICB1cGRhdGVDaGFpbihjaGFpbk5hbWUsIGNoYWluSW5mbykge1xuICAgICAgaWYgKCFjaGFpbkluZm9zLmhhcyhjaGFpbk5hbWUpKSB7XG4gICAgICAgIHRocm93IG1ha2VFcnJvcihgQ2hhaW4gJHtxdW90ZShjaGFpbk5hbWUpfSBub3QgcmVnaXN0ZXJlZGApO1xuICAgICAgfVxuICAgICAgY29uc3Qgb2xkSW5mbyA9IGNoYWluSW5mb3MuZ2V0KGNoYWluTmFtZSk7XG4gICAgICBpZiAoY2hhaW5JZFRvQ2hhaW5OYW1lLmhhcyhjYWlwSWRGcm9tSW5mbyhvbGRJbmZvKSkpIHtcbiAgICAgICAgY2hhaW5JZFRvQ2hhaW5OYW1lLmRlbGV0ZShjYWlwSWRGcm9tSW5mbyhvbGRJbmZvKSk7XG4gICAgICB9XG4gICAgICBpZiAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvbGRJbmZvLmJlY2gzMlByZWZpeFxuICAgICAgKSB7XG4gICAgICAgIGJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lLmRlbGV0ZShcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBvbGRJbmZvLmJlY2gzMlByZWZpeFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2hhaW5JbmZvcy5zZXQoY2hhaW5OYW1lLCBjaGFpbkluZm8pO1xuICAgICAgY2hhaW5JZFRvQ2hhaW5OYW1lLmluaXQoY2FpcElkRnJvbUluZm8oY2hhaW5JbmZvKSwgY2hhaW5OYW1lKTtcbiAgICAgIGlmIChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGNoYWluSW5mby5iZWNoMzJQcmVmaXhcbiAgICAgICkge1xuICAgICAgICBiZWNoMzJQcmVmaXhUb0NoYWluTmFtZS5pbml0KFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGNoYWluSW5mby5iZWNoMzJQcmVmaXgsXG4gICAgICAgICAgY2hhaW5OYW1lXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKlxuXG5cblxuICAgICAqL1xuICAgIGdldENoYWluSW5mbyhjaGFpbk5hbWUpIHtcbiAgICAgIGNoYWluTmFtZS5pbmNsdWRlcyhcIjpcIikgJiYgdGhyb3dSZWRhY3RlZGAke2NoYWluTmFtZX0gbXVzdCBiZSBhIGJhcmUgY2hhaW4gbmFtZS4gTWF5YmUgdHJ5IGdldENoYWluSW5mb0J5Q2hhaW5JZCgpYDtcbiAgICAgIGlmIChjaGFpbkluZm9zLmhhcyhjaGFpbk5hbWUpKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB2b3dUb29scy5hc1ZvdyhcbiAgICAgICAgICAgICgpID0+IChcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgY2hhaW5JbmZvcy5nZXQoY2hhaW5OYW1lKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBsb29rdXBDaGFpbkluZm8oY2hhaW5OYW1lKTtcbiAgICB9LFxuICAgIC8qXG5cblxuICAgICAqL1xuICAgIGdldENoYWluSW5mb0J5Q2hhaW5JZChjaGFpbklkKSB7XG4gICAgICBjaGFpbklkVG9DaGFpbk5hbWUuaGFzKGNoYWluSWQpIHx8IHRocm93UmVkYWN0ZWRgQ2hhaW4gbmFtZSBub3QgZm91bmQgZm9yICR7cXVvdGUoY2hhaW5JZCl9YDtcbiAgICAgIGNvbnN0IGNoYWluTmFtZSA9IGNoYWluSWRUb0NoYWluTmFtZS5nZXQoY2hhaW5JZCk7XG4gICAgICBjaGFpbkluZm9zLmhhcyhjaGFpbk5hbWUpIHx8IHRocm93UmVkYWN0ZWRgQ2hhaW4gSW5mbyBub3QgZm91bmQgZm9yICR7cXVvdGUoY2hhaW5JZCl9YDtcbiAgICAgIHJldHVybiBjaGFpbkluZm9zLmdldChjaGFpbk5hbWUpO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG4gICAgICovXG4gICAgcmVnaXN0ZXJDb25uZWN0aW9uKHByaW1hcnlDaGFpbklkLCBjb3VudGVycGFydHlDaGFpbklkLCBjb25uZWN0aW9uSW5mbykge1xuICAgICAgY29uc3QgW2tleSwgbm9ybWFsaXplZF0gPSBub3JtYWxpemVDb25uZWN0aW9uSW5mbyhcbiAgICAgICAgcHJpbWFyeUNoYWluSWQsXG4gICAgICAgIGNvdW50ZXJwYXJ0eUNoYWluSWQsXG4gICAgICAgIGNvbm5lY3Rpb25JbmZvXG4gICAgICApO1xuICAgICAgY29ubmVjdGlvbkluZm9zLmluaXQoa2V5LCBub3JtYWxpemVkKTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICB1cGRhdGVDb25uZWN0aW9uKHByaW1hcnlDaGFpbklkLCBjb3VudGVycGFydHlDaGFpbklkLCBjb25uZWN0aW9uSW5mbykge1xuICAgICAgY29uc3Qga2V5ID0gY29ubmVjdGlvbktleShwcmltYXJ5Q2hhaW5JZCwgY291bnRlcnBhcnR5Q2hhaW5JZCk7XG4gICAgICBpZiAoIWNvbm5lY3Rpb25JbmZvcy5oYXMoa2V5KSkge1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoXG4gICAgICAgICAgYENvbm5lY3Rpb24gJHtxdW90ZShwcmltYXJ5Q2hhaW5JZCl9PC0+JHtxdW90ZShjb3VudGVycGFydHlDaGFpbklkKX0gbm90IHJlZ2lzdGVyZWRgXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjb25zdCBbXywgbm9ybWFsaXplZEluZm9dID0gbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oXG4gICAgICAgIHByaW1hcnlDaGFpbklkLFxuICAgICAgICBjb3VudGVycGFydHlDaGFpbklkLFxuICAgICAgICBjb25uZWN0aW9uSW5mb1xuICAgICAgKTtcbiAgICAgIGNvbm5lY3Rpb25JbmZvcy5zZXQoa2V5LCBub3JtYWxpemVkSW5mbyk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuICAgICAqL1xuICAgIGdldENvbm5lY3Rpb25JbmZvKHByaW1hcnksIGNvdW50ZXIpIHtcbiAgICAgIGNvbnN0IHByaW1hcnlJZCA9IHR5cGVvZiBwcmltYXJ5ID09PSBcInN0cmluZ1wiID8gcHJpbWFyeSA6IHByaW1hcnkuY2hhaW5JZDtcbiAgICAgIGNvbnN0IGNvdW50ZXJJZCA9IHR5cGVvZiBjb3VudGVyID09PSBcInN0cmluZ1wiID8gY291bnRlciA6IGNvdW50ZXIuY2hhaW5JZDtcbiAgICAgIGNvbnN0IGtleSA9IGNvbm5lY3Rpb25LZXkocHJpbWFyeUlkLCBjb3VudGVySWQpO1xuICAgICAgaWYgKGNvbm5lY3Rpb25JbmZvcy5oYXMoa2V5KSkge1xuICAgICAgICByZXR1cm4gdm93VG9vbHMuYXNWb3coXG4gICAgICAgICAgKCkgPT4gZGVub3JtYWxpemVDb25uZWN0aW9uSW5mbyhcbiAgICAgICAgICAgIHByaW1hcnlJZCxcbiAgICAgICAgICAgIGNvdW50ZXJJZCxcbiAgICAgICAgICAgIGNvbm5lY3Rpb25JbmZvcy5nZXQoa2V5KVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBsb29rdXBDb25uZWN0aW9uSW5mbyhwcmltYXJ5SWQsIGNvdW50ZXJJZCk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgZ2V0Q2hhaW5zQW5kQ29ubmVjdGlvbihwcmltYXJ5TmFtZSwgY291bnRlck5hbWUpIHtcbiAgICAgIHJldHVybiBsb29rdXBDaGFpbnNBbmRDb25uZWN0aW9uKHByaW1hcnlOYW1lLCBjb3VudGVyTmFtZSk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIHJlZ2lzdGVyQXNzZXQoZGVub20sIGRldGFpbCkge1xuICAgICAgY29uc3QgeyBjaGFpbk5hbWUsIGJhc2VOYW1lIH0gPSBkZXRhaWw7XG4gICAgICBjaGFpbkluZm9zLmhhcyhjaGFpbk5hbWUpIHx8IHRocm93UmVkYWN0ZWRgbXVzdCByZWdpc3RlciBjaGFpbiAke3F1b3RlKGNoYWluTmFtZSl9IGZpcnN0YDtcbiAgICAgIGNoYWluSW5mb3MuaGFzKGJhc2VOYW1lKSB8fCB0aHJvd1JlZGFjdGVkYG11c3QgcmVnaXN0ZXIgY2hhaW4gJHtxdW90ZShiYXNlTmFtZSl9IGZpcnN0YDtcbiAgICAgIGNvbnN0IGRlbm9tS2V5ID0gbWFrZURlbm9tS2V5KGRlbm9tLCBkZXRhaWwuY2hhaW5OYW1lKTtcbiAgICAgIGRlbm9tRGV0YWlscy5oYXMoZGVub21LZXkpICYmIHRocm93UmVkYWN0ZWRgYWxyZWFkeSByZWdpc3RlcmVkICR7cXVvdGUoZGVub20pfSBvbiAke3F1b3RlKGNoYWluTmFtZSl9YDtcbiAgICAgIGRlbm9tRGV0YWlscy5pbml0KGRlbm9tS2V5LCBkZXRhaWwpO1xuICAgICAgaWYgKGRldGFpbC5icmFuZCkge1xuICAgICAgICBjaGFpbk5hbWUgPT09IFwiYWdvcmljXCIgfHwgdGhyb3dSZWRhY3RlZGBicmFuZHMgb25seSByZWdpc3RlcmFibGUgZm9yIGFnb3JpYy1oZWxkIGFzc2V0c2A7XG4gICAgICAgIGJyYW5kRGVub21zLmluaXQoZGV0YWlsLmJyYW5kLCBkZW5vbSk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIHVwZGF0ZUFzc2V0KGRlbm9tLCBkZXRhaWwpIHtcbiAgICAgIGNvbnN0IHsgYmFzZU5hbWUsIGJyYW5kLCBjaGFpbk5hbWUgfSA9IGRldGFpbDtcbiAgICAgIGNvbnN0IGRlbm9tS2V5ID0gbWFrZURlbm9tS2V5KGRlbm9tLCBjaGFpbk5hbWUpO1xuICAgICAgaWYgKCFkZW5vbURldGFpbHMuaGFzKGRlbm9tS2V5KSkge1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoYEFzc2V0ICR7cXVvdGUoZGVub20pfSBvbiAke3F1b3RlKGNoYWluTmFtZSl9IG5vdCByZWdpc3RlcmVkYCk7XG4gICAgICB9XG4gICAgICBpZiAoIWNoYWluSW5mb3MuaGFzKGNoYWluTmFtZSkpIHtcbiAgICAgICAgdGhyb3cgbWFrZUVycm9yKGBDaGFpbiAke3F1b3RlKGNoYWluTmFtZSl9IG5vdCByZWdpc3RlcmVkYCk7XG4gICAgICB9XG4gICAgICBpZiAoIWNoYWluSW5mb3MuaGFzKGJhc2VOYW1lKSkge1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoYENoYWluICR7cXVvdGUoYmFzZU5hbWUpfSBub3QgcmVnaXN0ZXJlZGApO1xuICAgICAgfVxuICAgICAgaWYgKGJyYW5kKSB7XG4gICAgICAgIGlmIChjaGFpbk5hbWUgIT09IFwiYWdvcmljXCIpIHtcbiAgICAgICAgICB0aHJvdyBtYWtlRXJyb3IoXCJCcmFuZHMgb25seSByZWdpc3RlcmFibGUgZm9yIGFnb3JpYy1oZWxkIGFzc2V0c1wiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3Qgb2xkRGV0YWlsID0gZGVub21EZXRhaWxzLmdldChkZW5vbUtleSk7XG4gICAgICBpZiAob2xkRGV0YWlsLmJyYW5kKSB7XG4gICAgICAgIGJyYW5kRGVub21zLmRlbGV0ZShvbGREZXRhaWwuYnJhbmQpO1xuICAgICAgfVxuICAgICAgZGVub21EZXRhaWxzLnNldChkZW5vbUtleSwgZGV0YWlsKTtcbiAgICAgIGlmIChicmFuZCkge1xuICAgICAgICBicmFuZERlbm9tcy5pbml0KGJyYW5kLCBkZW5vbSk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cbiAgICAgKi9cbiAgICBnZXRBc3NldChkZW5vbSwgc3JjQ2hhaW5OYW1lKSB7XG4gICAgICBjb25zdCBkZW5vbUtleSA9IG1ha2VEZW5vbUtleShkZW5vbSwgc3JjQ2hhaW5OYW1lKTtcbiAgICAgIGlmIChkZW5vbURldGFpbHMuaGFzKGRlbm9tS2V5KSkge1xuICAgICAgICByZXR1cm4gZGVub21EZXRhaWxzLmdldChkZW5vbUtleSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgIGdldERlbm9tKGJyYW5kKSB7XG4gICAgICBpZiAoYnJhbmREZW5vbXMuaGFzKGJyYW5kKSkge1xuICAgICAgICByZXR1cm4gYnJhbmREZW5vbXMuZ2V0KGJyYW5kKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgcmVzb2x2ZUFjY291bnRJZChwYXJ0aWFsSWQpIHtcbiAgICAgIGlmIChwYXJ0aWFsSWQuc3BsaXQoXCI6XCIpLmxlbmd0aCA9PT0gMykge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHBhcnRpYWxJZFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgY29zbW9zQ2hhaW5JZCA9IHJlc29sdmVDb3Ntb3NDaGFpbklkKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHBhcnRpYWxJZFxuICAgICAgKTtcbiAgICAgIHJldHVybiBgY29zbW9zOiR7Y29zbW9zQ2hhaW5JZH06JHtwYXJ0aWFsSWR9YDtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgY29lcmNlQ29zbW9zQWRkcmVzcyhwYXJ0aWFsSWQpIHtcbiAgICAgIGlmICh0eXBlb2YgcGFydGlhbElkICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiBwYXJ0aWFsSWQ7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXJ0cyA9IHBhcnRpYWxJZC5zcGxpdChcIjpcIik7XG4gICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7XG4gICAgICAgIGFzc2VydC5lcXVhbChwYXJ0c1swXSwgXCJjb3Ntb3NcIik7XG4gICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgIGNoYWluSWQ6IHBhcnRzWzFdLFxuICAgICAgICAgIGVuY29kaW5nOiBcImJlY2gzMlwiLFxuICAgICAgICAgIHZhbHVlOiAoXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICBwYXJ0c1syXVxuICAgICAgICAgIClcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBhc3NlcnQuZXF1YWwocGFydHMubGVuZ3RoLCAxKTtcbiAgICAgIGNvbnN0IHZhbHVlID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHBhcnRpYWxJZFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGNvc21vc0NoYWluSWQgPSByZXNvbHZlQ29zbW9zQ2hhaW5JZCh2YWx1ZSk7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgY2hhaW5JZDogY29zbW9zQ2hhaW5JZCxcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIGVuY29kaW5nOiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBcImJlY2gzMlwiXG4gICAgICAgIClcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgbWFrZVRyYW5zZmVyUm91dGUoZGVzdGluYXRpb24sIGRlbm9tQW1vdW50LCBzcmNDaGFpbk5hbWUsIGZvcndhcmRPcHRzKSB7XG4gICAgICBjaGFpbkluZm9zLmhhcyhzcmNDaGFpbk5hbWUpIHx8IHRocm93UmVkYWN0ZWRgY2hhaW4gaW5mbyBub3QgZm91bmQgZm9yIGhvbGRpbmcgY2hhaW46ICR7cXVvdGUoc3JjQ2hhaW5OYW1lKX1gO1xuICAgICAgY29uc3QgZGVub21EZXRhaWwgPSBjaGFpbkh1Yi5nZXRBc3NldChkZW5vbUFtb3VudC5kZW5vbSwgc3JjQ2hhaW5OYW1lKTtcbiAgICAgIGRlbm9tRGV0YWlsIHx8IHRocm93UmVkYWN0ZWRgbm8gZGVub20gZGV0YWlsIGZvcjogJHtxdW90ZShkZW5vbUFtb3VudC5kZW5vbSl9IG9uICR7cXVvdGUoc3JjQ2hhaW5OYW1lKX0uIGVuc3VyZSBpdCBpcyByZWdpc3RlcmVkIGluIGNoYWluSHViLmA7XG4gICAgICBjb25zdCB7IGJhc2VOYW1lLCBjaGFpbk5hbWUgfSA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZGVub21EZXRhaWxcbiAgICAgICk7XG4gICAgICBjaGFpbk5hbWUgPT09IHNyY0NoYWluTmFtZSB8fCB0aHJvd1JlZGFjdGVkYGNhbm5vdCB0cmFuc2ZlciBhc3NldCAke3F1b3RlKGRlbm9tQW1vdW50LmRlbm9tKX0uIGhlbGQgb24gJHtxdW90ZShjaGFpbk5hbWUpfSBub3QgJHtxdW90ZShzcmNDaGFpbk5hbWUpfS5gO1xuICAgICAgY2hhaW5JbmZvcy5oYXMoYmFzZU5hbWUpIHx8IHRocm93UmVkYWN0ZWRgY2hhaW4gaW5mbyBub3QgZm91bmQgZm9yIGlzc3VpbmcgY2hhaW46ICR7cXVvdGUoYmFzZU5hbWUpfWA7XG4gICAgICBjb25zdCBiYXNlQ2hhaW5JbmZvID0gY2hhaW5JbmZvcy5nZXQoYmFzZU5hbWUpO1xuICAgICAgaWYgKGJhc2VDaGFpbkluZm8ubmFtZXNwYWNlICE9PSBcImNvc21vc1wiKVxuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYE9ubHkgY29zbW9zIHN1cHBvcnRlZDsgZ290ICR7cXVvdGUoYmFzZUNoYWluSW5mby5uYW1lc3BhY2UpfWA7XG4gICAgICBjb25zdCB7IGNoYWluSWQ6IGJhc2VDaGFpbklkLCBwZm1FbmFibGVkIH0gPSBiYXNlQ2hhaW5JbmZvO1xuICAgICAgY29uc3QgaG9sZGluZ0NoYWluSW5mbyA9IGNoYWluSW5mb3MuZ2V0KHNyY0NoYWluTmFtZSk7XG4gICAgICBpZiAoaG9sZGluZ0NoYWluSW5mby5uYW1lc3BhY2UgIT09IFwiY29zbW9zXCIpIHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBPbmx5IGNvc21vcyBzdXBwb3J0ZWQ7IGdvdCAke3F1b3RlKGhvbGRpbmdDaGFpbkluZm8ubmFtZXNwYWNlKX1gO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBjaGFpbklkOiBob2xkaW5nQ2hhaW5JZCB9ID0gaG9sZGluZ0NoYWluSW5mbztcbiAgICAgIGNvbnN0IGNvc21vc0Rlc3QgPSBjaGFpbkh1Yi5jb2VyY2VDb3Ntb3NBZGRyZXNzKGRlc3RpbmF0aW9uKTtcbiAgICAgIGlmIChiYXNlQ2hhaW5JZCA9PT0gY29zbW9zRGVzdC5jaGFpbklkIHx8IGJhc2VOYW1lID09PSBzcmNDaGFpbk5hbWUpIHtcbiAgICAgICAgY29uc3QgY29ubktleSA9IGNvbm5lY3Rpb25LZXkoaG9sZGluZ0NoYWluSWQsIGNvc21vc0Rlc3QuY2hhaW5JZCk7XG4gICAgICAgIGNvbm5lY3Rpb25JbmZvcy5oYXMoY29ubktleSkgfHwgdGhyb3dSZWRhY3RlZGBubyBjb25uZWN0aW9uIGluZm8gZm91bmQgZm9yICR7aG9sZGluZ0NoYWluSWR9PC0+JHtjb3Ntb3NEZXN0LmNoYWluSWR9YDtcbiAgICAgICAgY29uc3QgeyB0cmFuc2ZlckNoYW5uZWwgfSA9IGRlbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oXG4gICAgICAgICAgaG9sZGluZ0NoYWluSWQsXG4gICAgICAgICAgLy9cbiAgICAgICAgICBjb3Ntb3NEZXN0LmNoYWluSWQsXG4gICAgICAgICAgLy9cbiAgICAgICAgICBjb25uZWN0aW9uSW5mb3MuZ2V0KGNvbm5LZXkpXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgIHNvdXJjZVBvcnQ6IHRyYW5zZmVyQ2hhbm5lbC5wb3J0SWQsXG4gICAgICAgICAgc291cmNlQ2hhbm5lbDogdHJhbnNmZXJDaGFubmVsLmNoYW5uZWxJZCxcbiAgICAgICAgICB0b2tlbjoge1xuICAgICAgICAgICAgYW1vdW50OiBTdHJpbmcoZGVub21BbW91bnQudmFsdWUpLFxuICAgICAgICAgICAgZGVub206IGRlbm9tQW1vdW50LmRlbm9tXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZWNlaXZlcjogY29zbW9zRGVzdC52YWx1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHBmbUVuYWJsZWQgfHwgdGhyb3dSZWRhY3RlZGBwZm0gbm90IGVuYWJsZWQgb24gaXNzdWluZyBjaGFpbjogJHtxdW90ZShiYXNlTmFtZSl9YDtcbiAgICAgIGNvbnN0IGN1cnJUb0lzc3VlcktleSA9IGNvbm5lY3Rpb25LZXkoaG9sZGluZ0NoYWluSWQsIGJhc2VDaGFpbklkKTtcbiAgICAgIGNvbm5lY3Rpb25JbmZvcy5oYXMoY3VyclRvSXNzdWVyS2V5KSB8fCB0aHJvd1JlZGFjdGVkYG5vIGNvbm5lY3Rpb24gaW5mbyBmb3VuZCBmb3IgJHtob2xkaW5nQ2hhaW5JZH08LT4ke2Jhc2VDaGFpbklkfWA7XG4gICAgICBjb25zdCBpc3N1ZXJUb0Rlc3RLZXkgPSBjb25uZWN0aW9uS2V5KGJhc2VDaGFpbklkLCBjb3Ntb3NEZXN0LmNoYWluSWQpO1xuICAgICAgY29ubmVjdGlvbkluZm9zLmhhcyhpc3N1ZXJUb0Rlc3RLZXkpIHx8IHRocm93UmVkYWN0ZWRgbm8gY29ubmVjdGlvbiBpbmZvIGZvdW5kIGZvciAke2Jhc2VDaGFpbklkfTwtPiR7Y29zbW9zRGVzdC5jaGFpbklkfWA7XG4gICAgICBjb25zdCBjdXJyVG9Jc3N1ZXIgPSBkZW5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvKFxuICAgICAgICBob2xkaW5nQ2hhaW5JZCxcbiAgICAgICAgYmFzZUNoYWluSWQsXG4gICAgICAgIGNvbm5lY3Rpb25JbmZvcy5nZXQoY3VyclRvSXNzdWVyS2V5KVxuICAgICAgKTtcbiAgICAgIGNvbnN0IGlzc3VlclRvRGVzdCA9IGRlbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oXG4gICAgICAgIGJhc2VDaGFpbklkLFxuICAgICAgICBjb3Ntb3NEZXN0LmNoYWluSWQsXG4gICAgICAgIGNvbm5lY3Rpb25JbmZvcy5nZXQoaXNzdWVyVG9EZXN0S2V5KVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHsgaW50ZXJtZWRpYXRlUmVjaXBpZW50LCAuLi5yZXN0IH0gPSBmb3J3YXJkT3B0cyA/PyB7fTtcbiAgICAgIGNvbnN0IGZvcndhcmRJbmZvID0gaGFyZGVuKHtcbiAgICAgICAgZm9yd2FyZDoge1xuICAgICAgICAgIHJlY2VpdmVyOiBjb3Ntb3NEZXN0LnZhbHVlLFxuICAgICAgICAgIHBvcnQ6IGlzc3VlclRvRGVzdC50cmFuc2ZlckNoYW5uZWwucG9ydElkLFxuICAgICAgICAgIGNoYW5uZWw6IGlzc3VlclRvRGVzdC50cmFuc2ZlckNoYW5uZWwuY2hhbm5lbElkLFxuICAgICAgICAgIC4uLkRlZmF1bHRQZm1UaW1lb3V0T3B0cyxcbiAgICAgICAgICAuLi4vKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHJlc3RcbiAgICAgICAgICAvL1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBzb3VyY2VQb3J0OiBjdXJyVG9Jc3N1ZXIudHJhbnNmZXJDaGFubmVsLnBvcnRJZCxcbiAgICAgICAgc291cmNlQ2hhbm5lbDogY3VyclRvSXNzdWVyLnRyYW5zZmVyQ2hhbm5lbC5jaGFubmVsSWQsXG4gICAgICAgIHRva2VuOiB7XG4gICAgICAgICAgYW1vdW50OiBTdHJpbmcoZGVub21BbW91bnQudmFsdWUpLFxuICAgICAgICAgIGRlbm9tOiBkZW5vbUFtb3VudC5kZW5vbVxuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHJlY2VpdmVyOiBpbnRlcm1lZGlhdGVSZWNpcGllbnQ/LnZhbHVlIHx8IFBGTV9SRUNFSVZFUixcbiAgICAgICAgZm9yd2FyZEluZm9cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBjaGFpbkh1Yjtcbn07XG5cbi8vXG52YXIgdHlwZWRKc29uID0gKGUyLCB0NSkgPT4gKHsgXCJAdHlwZVwiOiBlMiwgLi4udDUgfSk7XG52YXIgdDMgPSAvXlxcLyg/PHNlcnZpY2VOYW1lPlxcdysoPzpcXC5cXHcrKSopXFwuUXVlcnkoPzxtZXRob2ROYW1lPlxcdyspUmVxdWVzdCQvO1xudmFyIHR5cGVVcmxUb0dycGNQYXRoID0gKGUyKSA9PiB7XG4gIGNvbnN0IHI1ID0gZTIubWF0Y2godDMpO1xuICBpZiAoIXI1IHx8ICFyNS5ncm91cHMpIHRocm93IFR5cGVFcnJvcihgSW52YWxpZCB0eXBlVXJsOiAke2UyfS4gTXVzdCBiZSBhIFF1ZXJ5IFJlcXVlc3QuYCk7XG4gIGNvbnN0IHsgc2VydmljZU5hbWU6IG8yLCBtZXRob2ROYW1lOiBzMyB9ID0gcjUuZ3JvdXBzO1xuICByZXR1cm4gYC8ke28yfS5RdWVyeS8ke3MzfWA7XG59O1xudmFyIHRvUmVxdWVzdFF1ZXJ5SnNvbiA9ICh0NSwgcjUgPSB7fSkgPT4gUmVxdWVzdFF1ZXJ5LnRvSlNPTihSZXF1ZXN0UXVlcnkuZnJvbVBhcnRpYWwoeyBwYXRoOiB0eXBlVXJsVG9HcnBjUGF0aCh0NS50eXBlVXJsKSwgZGF0YTogdDUudmFsdWUsIC4uLnI1IH0pKTtcblxuLy9cbmZ1bmN0aW9uIHIyKCkge1xuICByZXR1cm4geyBmcm9tOiBcIlwiLCBhbW91bnQ6IFwiXCIsIGRlc3RpbmF0aW9uRG9tYWluOiAwLCBtaW50UmVjaXBpZW50OiBuZXcgVWludDhBcnJheSgpLCBidXJuVG9rZW46IFwiXCIgfTtcbn1cbnZhciBNc2dEZXBvc2l0Rm9yQnVybiA9IHsgdHlwZVVybDogXCIvY2lyY2xlLmNjdHAudjEuTXNnRGVwb3NpdEZvckJ1cm5cIiwgZW5jb2RlOiAobjIsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbjIuZnJvbSAmJiBlMi51aW50MzIoMTApLnN0cmluZyhuMi5mcm9tKSwgXCJcIiAhPT0gbjIuYW1vdW50ICYmIGUyLnVpbnQzMigxOCkuc3RyaW5nKG4yLmFtb3VudCksIDAgIT09IG4yLmRlc3RpbmF0aW9uRG9tYWluICYmIGUyLnVpbnQzMigyNCkudWludDMyKG4yLmRlc3RpbmF0aW9uRG9tYWluKSwgMCAhPT0gbjIubWludFJlY2lwaWVudC5sZW5ndGggJiYgZTIudWludDMyKDM0KS5ieXRlcyhuMi5taW50UmVjaXBpZW50KSwgXCJcIiAhPT0gbjIuYnVyblRva2VuICYmIGUyLnVpbnQzMig0Mikuc3RyaW5nKG4yLmJ1cm5Ub2tlbiksIGUyKSwgZGVjb2RlKHQ1LCBlMikge1xuICBjb25zdCBvMiA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IGkzID0gdm9pZCAwID09PSBlMiA/IG8yLmxlbiA6IG8yLnBvcyArIGUyO1xuICBjb25zdCBzMyA9IHIyKCk7XG4gIGZvciAoOyBvMi5wb3MgPCBpMzsgKSB7XG4gICAgY29uc3QgbjIgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG4yID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHMzLmZyb20gPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHMzLmFtb3VudCA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgczMuZGVzdGluYXRpb25Eb21haW4gPSBvMi51aW50MzIoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIHMzLm1pbnRSZWNpcGllbnQgPSBvMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgczMuYnVyblRva2VuID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIG4yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHMzO1xufSwgZnJvbUpTT046IChuMikgPT4gKHsgZnJvbTogaXNTZXQobjIuZnJvbSkgPyBTdHJpbmcobjIuZnJvbSkgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KG4yLmFtb3VudCkgPyBTdHJpbmcobjIuYW1vdW50KSA6IFwiXCIsIGRlc3RpbmF0aW9uRG9tYWluOiBpc1NldChuMi5kZXN0aW5hdGlvbkRvbWFpbikgPyBOdW1iZXIobjIuZGVzdGluYXRpb25Eb21haW4pIDogMCwgbWludFJlY2lwaWVudDogaXNTZXQobjIubWludFJlY2lwaWVudCkgPyBkZWNvZGVCYXNlNjQobjIubWludFJlY2lwaWVudCkgOiBuZXcgVWludDhBcnJheSgpLCBidXJuVG9rZW46IGlzU2V0KG4yLmJ1cm5Ub2tlbikgPyBTdHJpbmcobjIuYnVyblRva2VuKSA6IFwiXCIgfSksIHRvSlNPTihuMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBuMi5mcm9tICYmICh0NS5mcm9tID0gbjIuZnJvbSksIHZvaWQgMCAhPT0gbjIuYW1vdW50ICYmICh0NS5hbW91bnQgPSBuMi5hbW91bnQpLCB2b2lkIDAgIT09IG4yLmRlc3RpbmF0aW9uRG9tYWluICYmICh0NS5kZXN0aW5hdGlvbkRvbWFpbiA9IE1hdGgucm91bmQobjIuZGVzdGluYXRpb25Eb21haW4pKSwgdm9pZCAwICE9PSBuMi5taW50UmVjaXBpZW50ICYmICh0NS5taW50UmVjaXBpZW50ID0gZW5jb2RlQmFzZTY0KHZvaWQgMCAhPT0gbjIubWludFJlY2lwaWVudCA/IG4yLm1pbnRSZWNpcGllbnQgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gbjIuYnVyblRva2VuICYmICh0NS5idXJuVG9rZW4gPSBuMi5idXJuVG9rZW4pLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG4yKSB7XG4gIGNvbnN0IHQ1ID0gcjIoKTtcbiAgcmV0dXJuIHQ1LmZyb20gPSBuMi5mcm9tID8/IFwiXCIsIHQ1LmFtb3VudCA9IG4yLmFtb3VudCA/PyBcIlwiLCB0NS5kZXN0aW5hdGlvbkRvbWFpbiA9IG4yLmRlc3RpbmF0aW9uRG9tYWluID8/IDAsIHQ1Lm1pbnRSZWNpcGllbnQgPSBuMi5taW50UmVjaXBpZW50ID8/IG5ldyBVaW50OEFycmF5KCksIHQ1LmJ1cm5Ub2tlbiA9IG4yLmJ1cm5Ub2tlbiA/PyBcIlwiLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG4yKSA9PiBNc2dEZXBvc2l0Rm9yQnVybi5kZWNvZGUobjIudmFsdWUpLCB0b1Byb3RvOiAobjIpID0+IE1zZ0RlcG9zaXRGb3JCdXJuLmVuY29kZShuMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChuMikgPT4gKHsgdHlwZVVybDogXCIvY2lyY2xlLmNjdHAudjEuTXNnRGVwb3NpdEZvckJ1cm5cIiwgdmFsdWU6IE1zZ0RlcG9zaXRGb3JCdXJuLmVuY29kZShuMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIGEoKSB7XG4gIHJldHVybiB7IGZyb206IFwiXCIsIGFtb3VudDogXCJcIiwgZGVzdGluYXRpb25Eb21haW46IDAsIG1pbnRSZWNpcGllbnQ6IG5ldyBVaW50OEFycmF5KCksIGJ1cm5Ub2tlbjogXCJcIiwgZGVzdGluYXRpb25DYWxsZXI6IG5ldyBVaW50OEFycmF5KCkgfTtcbn1cbnZhciBNc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXIgPSB7IHR5cGVVcmw6IFwiL2NpcmNsZS5jY3RwLnYxLk1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlclwiLCBlbmNvZGU6IChuMiwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBuMi5mcm9tICYmIGUyLnVpbnQzMigxMCkuc3RyaW5nKG4yLmZyb20pLCBcIlwiICE9PSBuMi5hbW91bnQgJiYgZTIudWludDMyKDE4KS5zdHJpbmcobjIuYW1vdW50KSwgMCAhPT0gbjIuZGVzdGluYXRpb25Eb21haW4gJiYgZTIudWludDMyKDI0KS51aW50MzIobjIuZGVzdGluYXRpb25Eb21haW4pLCAwICE9PSBuMi5taW50UmVjaXBpZW50Lmxlbmd0aCAmJiBlMi51aW50MzIoMzQpLmJ5dGVzKG4yLm1pbnRSZWNpcGllbnQpLCBcIlwiICE9PSBuMi5idXJuVG9rZW4gJiYgZTIudWludDMyKDQyKS5zdHJpbmcobjIuYnVyblRva2VuKSwgMCAhPT0gbjIuZGVzdGluYXRpb25DYWxsZXIubGVuZ3RoICYmIGUyLnVpbnQzMig1MCkuYnl0ZXMobjIuZGVzdGluYXRpb25DYWxsZXIpLCBlMiksIGRlY29kZSh0NSwgZTIpIHtcbiAgY29uc3QgbzIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBpMyA9IHZvaWQgMCA9PT0gZTIgPyBvMi5sZW4gOiBvMi5wb3MgKyBlMjtcbiAgY29uc3QgcjUgPSBhKCk7XG4gIGZvciAoOyBvMi5wb3MgPCBpMzsgKSB7XG4gICAgY29uc3QgbjIgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG4yID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LmZyb20gPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LmFtb3VudCA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgcjUuZGVzdGluYXRpb25Eb21haW4gPSBvMi51aW50MzIoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIHI1Lm1pbnRSZWNpcGllbnQgPSBvMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgcjUuYnVyblRva2VuID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA2OlxuICAgICAgICByNS5kZXN0aW5hdGlvbkNhbGxlciA9IG8yLmJ5dGVzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIG4yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChuMikgPT4gKHsgZnJvbTogaXNTZXQobjIuZnJvbSkgPyBTdHJpbmcobjIuZnJvbSkgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KG4yLmFtb3VudCkgPyBTdHJpbmcobjIuYW1vdW50KSA6IFwiXCIsIGRlc3RpbmF0aW9uRG9tYWluOiBpc1NldChuMi5kZXN0aW5hdGlvbkRvbWFpbikgPyBOdW1iZXIobjIuZGVzdGluYXRpb25Eb21haW4pIDogMCwgbWludFJlY2lwaWVudDogaXNTZXQobjIubWludFJlY2lwaWVudCkgPyBkZWNvZGVCYXNlNjQobjIubWludFJlY2lwaWVudCkgOiBuZXcgVWludDhBcnJheSgpLCBidXJuVG9rZW46IGlzU2V0KG4yLmJ1cm5Ub2tlbikgPyBTdHJpbmcobjIuYnVyblRva2VuKSA6IFwiXCIsIGRlc3RpbmF0aW9uQ2FsbGVyOiBpc1NldChuMi5kZXN0aW5hdGlvbkNhbGxlcikgPyBkZWNvZGVCYXNlNjQobjIuZGVzdGluYXRpb25DYWxsZXIpIDogbmV3IFVpbnQ4QXJyYXkoKSB9KSwgdG9KU09OKG4yKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG4yLmZyb20gJiYgKHQ1LmZyb20gPSBuMi5mcm9tKSwgdm9pZCAwICE9PSBuMi5hbW91bnQgJiYgKHQ1LmFtb3VudCA9IG4yLmFtb3VudCksIHZvaWQgMCAhPT0gbjIuZGVzdGluYXRpb25Eb21haW4gJiYgKHQ1LmRlc3RpbmF0aW9uRG9tYWluID0gTWF0aC5yb3VuZChuMi5kZXN0aW5hdGlvbkRvbWFpbikpLCB2b2lkIDAgIT09IG4yLm1pbnRSZWNpcGllbnQgJiYgKHQ1Lm1pbnRSZWNpcGllbnQgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSBuMi5taW50UmVjaXBpZW50ID8gbjIubWludFJlY2lwaWVudCA6IG5ldyBVaW50OEFycmF5KCkpKSwgdm9pZCAwICE9PSBuMi5idXJuVG9rZW4gJiYgKHQ1LmJ1cm5Ub2tlbiA9IG4yLmJ1cm5Ub2tlbiksIHZvaWQgMCAhPT0gbjIuZGVzdGluYXRpb25DYWxsZXIgJiYgKHQ1LmRlc3RpbmF0aW9uQ2FsbGVyID0gZW5jb2RlQmFzZTY0KHZvaWQgMCAhPT0gbjIuZGVzdGluYXRpb25DYWxsZXIgPyBuMi5kZXN0aW5hdGlvbkNhbGxlciA6IG5ldyBVaW50OEFycmF5KCkpKSwgdDU7XG59LCBmcm9tUGFydGlhbChuMikge1xuICBjb25zdCB0NSA9IGEoKTtcbiAgcmV0dXJuIHQ1LmZyb20gPSBuMi5mcm9tID8/IFwiXCIsIHQ1LmFtb3VudCA9IG4yLmFtb3VudCA/PyBcIlwiLCB0NS5kZXN0aW5hdGlvbkRvbWFpbiA9IG4yLmRlc3RpbmF0aW9uRG9tYWluID8/IDAsIHQ1Lm1pbnRSZWNpcGllbnQgPSBuMi5taW50UmVjaXBpZW50ID8/IG5ldyBVaW50OEFycmF5KCksIHQ1LmJ1cm5Ub2tlbiA9IG4yLmJ1cm5Ub2tlbiA/PyBcIlwiLCB0NS5kZXN0aW5hdGlvbkNhbGxlciA9IG4yLmRlc3RpbmF0aW9uQ2FsbGVyID8/IG5ldyBVaW50OEFycmF5KCksIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAobjIpID0+IE1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlci5kZWNvZGUobjIudmFsdWUpLCB0b1Byb3RvOiAobjIpID0+IE1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlci5lbmNvZGUobjIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobjIpID0+ICh7IHR5cGVVcmw6IFwiL2NpcmNsZS5jY3RwLnYxLk1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlclwiLCB2YWx1ZTogTXNnRGVwb3NpdEZvckJ1cm5XaXRoQ2FsbGVyLmVuY29kZShuMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbmZ1bmN0aW9uIHIzKCkge1xuICByZXR1cm4geyBrZXk6IG5ldyBVaW50OEFycmF5KCksIG9mZnNldDogQmlnSW50KDApLCBsaW1pdDogQmlnSW50KDApLCBjb3VudFRvdGFsOiBmYWxzZSwgcmV2ZXJzZTogZmFsc2UgfTtcbn1cbnZhciBQYWdlUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhc2UucXVlcnkudjFiZXRhMS5QYWdlUmVxdWVzdFwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICgwICE9PSBlMi5rZXkubGVuZ3RoICYmIG8yLnVpbnQzMigxMCkuYnl0ZXMoZTIua2V5KSwgZTIub2Zmc2V0ICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDE2KS51aW50NjQoZTIub2Zmc2V0KSwgZTIubGltaXQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoMjQpLnVpbnQ2NChlMi5saW1pdCksIHRydWUgPT09IGUyLmNvdW50VG90YWwgJiYgbzIudWludDMyKDMyKS5ib29sKGUyLmNvdW50VG90YWwpLCB0cnVlID09PSBlMi5yZXZlcnNlICYmIG8yLnVpbnQzMig0MCkuYm9vbChlMi5yZXZlcnNlKSwgbzIpLCBkZWNvZGUodDUsIG8yKSB7XG4gIGNvbnN0IG4yID0gdDUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyB0NSA6IG5ldyBCaW5hcnlSZWFkZXIodDUpO1xuICBsZXQgaTMgPSB2b2lkIDAgPT09IG8yID8gbjIubGVuIDogbjIucG9zICsgbzI7XG4gIGNvbnN0IHMzID0gcjMoKTtcbiAgZm9yICg7IG4yLnBvcyA8IGkzOyApIHtcbiAgICBjb25zdCBlMiA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTIgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczMua2V5ID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHMzLm9mZnNldCA9IG4yLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgczMubGltaXQgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIHMzLmNvdW50VG90YWwgPSBuMi5ib29sKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA1OlxuICAgICAgICBzMy5yZXZlcnNlID0gbjIuYm9vbCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBlMik7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMztcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGtleTogaXNTZXQoZTIua2V5KSA/IGRlY29kZUJhc2U2NChlMi5rZXkpIDogbmV3IFVpbnQ4QXJyYXkoKSwgb2Zmc2V0OiBpc1NldChlMi5vZmZzZXQpID8gQmlnSW50KGUyLm9mZnNldC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbGltaXQ6IGlzU2V0KGUyLmxpbWl0KSA/IEJpZ0ludChlMi5saW1pdC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgY291bnRUb3RhbDogISFpc1NldChlMi5jb3VudFRvdGFsKSAmJiBCb29sZWFuKGUyLmNvdW50VG90YWwpLCByZXZlcnNlOiAhIWlzU2V0KGUyLnJldmVyc2UpICYmIEJvb2xlYW4oZTIucmV2ZXJzZSkgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5rZXkgJiYgKHQ1LmtleSA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IGUyLmtleSA/IGUyLmtleSA6IG5ldyBVaW50OEFycmF5KCkpKSwgdm9pZCAwICE9PSBlMi5vZmZzZXQgJiYgKHQ1Lm9mZnNldCA9IChlMi5vZmZzZXQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi5saW1pdCAmJiAodDUubGltaXQgPSAoZTIubGltaXQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi5jb3VudFRvdGFsICYmICh0NS5jb3VudFRvdGFsID0gZTIuY291bnRUb3RhbCksIHZvaWQgMCAhPT0gZTIucmV2ZXJzZSAmJiAodDUucmV2ZXJzZSA9IGUyLnJldmVyc2UpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0gcjMoKTtcbiAgcmV0dXJuIHQ1LmtleSA9IGUyLmtleSA/PyBuZXcgVWludDhBcnJheSgpLCB0NS5vZmZzZXQgPSB2b2lkIDAgIT09IGUyLm9mZnNldCAmJiBudWxsICE9PSBlMi5vZmZzZXQgPyBCaWdJbnQoZTIub2Zmc2V0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB0NS5saW1pdCA9IHZvaWQgMCAhPT0gZTIubGltaXQgJiYgbnVsbCAhPT0gZTIubGltaXQgPyBCaWdJbnQoZTIubGltaXQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIHQ1LmNvdW50VG90YWwgPSBlMi5jb3VudFRvdGFsID8/IGZhbHNlLCB0NS5yZXZlcnNlID0gZTIucmV2ZXJzZSA/PyBmYWxzZSwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUGFnZVJlcXVlc3QuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBQYWdlUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnF1ZXJ5LnYxYmV0YTEuUGFnZVJlcXVlc3RcIiwgdmFsdWU6IFBhZ2VSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIHMyKCkge1xuICByZXR1cm4geyBuZXh0S2V5OiBuZXcgVWludDhBcnJheSgpLCB0b3RhbDogQmlnSW50KDApIH07XG59XG52YXIgUGFnZVJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS5xdWVyeS52MWJldGExLlBhZ2VSZXNwb25zZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICgwICE9PSBlMi5uZXh0S2V5Lmxlbmd0aCAmJiBvMi51aW50MzIoMTApLmJ5dGVzKGUyLm5leHRLZXkpLCBlMi50b3RhbCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMigxNikudWludDY0KGUyLnRvdGFsKSwgbzIpLCBkZWNvZGUodDUsIG8yKSB7XG4gIGNvbnN0IG4yID0gdDUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyB0NSA6IG5ldyBCaW5hcnlSZWFkZXIodDUpO1xuICBsZXQgaTMgPSB2b2lkIDAgPT09IG8yID8gbjIubGVuIDogbjIucG9zICsgbzI7XG4gIGNvbnN0IHI1ID0gczIoKTtcbiAgZm9yICg7IG4yLnBvcyA8IGkzOyApIHtcbiAgICBjb25zdCBlMiA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTIgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjUubmV4dEtleSA9IG4yLmJ5dGVzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNS50b3RhbCA9IG4yLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBlMik7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IG5leHRLZXk6IGlzU2V0KGUyLm5leHRLZXkpID8gZGVjb2RlQmFzZTY0KGUyLm5leHRLZXkpIDogbmV3IFVpbnQ4QXJyYXkoKSwgdG90YWw6IGlzU2V0KGUyLnRvdGFsKSA/IEJpZ0ludChlMi50b3RhbC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLm5leHRLZXkgJiYgKHQ1Lm5leHRLZXkgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSBlMi5uZXh0S2V5ID8gZTIubmV4dEtleSA6IG5ldyBVaW50OEFycmF5KCkpKSwgdm9pZCAwICE9PSBlMi50b3RhbCAmJiAodDUudG90YWwgPSAoZTIudG90YWwgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHMyKCk7XG4gIHJldHVybiB0NS5uZXh0S2V5ID0gZTIubmV4dEtleSA/PyBuZXcgVWludDhBcnJheSgpLCB0NS50b3RhbCA9IHZvaWQgMCAhPT0gZTIudG90YWwgJiYgbnVsbCAhPT0gZTIudG90YWwgPyBCaWdJbnQoZTIudG90YWwudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFBhZ2VSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFBhZ2VSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnF1ZXJ5LnYxYmV0YTEuUGFnZVJlc3BvbnNlXCIsIHZhbHVlOiBQYWdlUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIFF1ZXJ5QmFsYW5jZVJlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlCYWxhbmNlUmVxdWVzdFwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5hZGRyZXNzICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLmFkZHJlc3MpLCBcIlwiICE9PSBlMi5kZW5vbSAmJiBvMi51aW50MzIoMTgpLnN0cmluZyhlMi5kZW5vbSksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSBvMiA/IG4yLmxlbiA6IG4yLnBvcyArIG8yO1xuICBjb25zdCB0NSA9IHsgYWRkcmVzczogXCJcIiwgZGVub206IFwiXCIgfTtcbiAgZm9yICg7IG4yLnBvcyA8IGEyOyApIHtcbiAgICBjb25zdCBlMyA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgdDUuYWRkcmVzcyA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgdDUuZGVub20gPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdDU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBhZGRyZXNzOiBpc1NldChlMi5hZGRyZXNzKSA/IFN0cmluZyhlMi5hZGRyZXNzKSA6IFwiXCIsIGRlbm9tOiBpc1NldChlMi5kZW5vbSkgPyBTdHJpbmcoZTIuZGVub20pIDogXCJcIiB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmFkZHJlc3MgJiYgKG8yLmFkZHJlc3MgPSBlMi5hZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5kZW5vbSAmJiAobzIuZGVub20gPSBlMi5kZW5vbSksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB7IGFkZHJlc3M6IFwiXCIsIGRlbm9tOiBcIlwiIH07XG4gIHJldHVybiBvMi5hZGRyZXNzID0gZTIuYWRkcmVzcyA/PyBcIlwiLCBvMi5kZW5vbSA9IGUyLmRlbm9tID8/IFwiXCIsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5QmFsYW5jZVJlcXVlc3QuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeUJhbGFuY2VSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUJhbGFuY2VSZXF1ZXN0XCIsIHZhbHVlOiBRdWVyeUJhbGFuY2VSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeUJhbGFuY2VSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUJhbGFuY2VSZXNwb25zZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICh2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgQ29pbi5lbmNvZGUoZTIuYmFsYW5jZSwgbzIudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgYTIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCB0NSA9IHZvaWQgMCA9PT0gbzIgPyBhMi5sZW4gOiBhMi5wb3MgKyBvMjtcbiAgY29uc3QgczMgPSB7IGJhbGFuY2U6IHZvaWQgMCB9O1xuICBmb3IgKDsgYTIucG9zIDwgdDU7ICkge1xuICAgIGNvbnN0IGUzID0gYTIudWludDMyKCk7XG4gICAgaWYgKGUzID4+PiAzID09IDEpIHMzLmJhbGFuY2UgPSBDb2luLmRlY29kZShhMiwgYTIudWludDMyKCkpO1xuICAgIGVsc2UgYTIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgfVxuICByZXR1cm4gczM7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBiYWxhbmNlOiBpc1NldChlMi5iYWxhbmNlKSA/IENvaW4uZnJvbUpTT04oZTIuYmFsYW5jZSkgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5iYWxhbmNlICYmIChvMi5iYWxhbmNlID0gZTIuYmFsYW5jZSA/IENvaW4udG9KU09OKGUyLmJhbGFuY2UpIDogdm9pZCAwKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgYmFsYW5jZTogdm9pZCAwIH07XG4gIHJldHVybiBvMi5iYWxhbmNlID0gdm9pZCAwICE9PSBlMi5iYWxhbmNlICYmIG51bGwgIT09IGUyLmJhbGFuY2UgPyBDb2luLmZyb21QYXJ0aWFsKGUyLmJhbGFuY2UpIDogdm9pZCAwLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeUJhbGFuY2VSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5QmFsYW5jZVJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUJhbGFuY2VSZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlCYWxhbmNlUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0XCIsIGVuY29kZTogKG8yLCBuMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG8yLmFkZHJlc3MgJiYgbjIudWludDMyKDEwKS5zdHJpbmcobzIuYWRkcmVzcyksIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBQYWdlUmVxdWVzdC5lbmNvZGUobzIucGFnaW5hdGlvbiwgbjIudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCBuMiksIGRlY29kZShvMiwgbjIpIHtcbiAgY29uc3QgYTIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCB0NSA9IHZvaWQgMCA9PT0gbjIgPyBhMi5sZW4gOiBhMi5wb3MgKyBuMjtcbiAgY29uc3QgczMgPSB7IGFkZHJlc3M6IFwiXCIsIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgYTIucG9zIDwgdDU7ICkge1xuICAgIGNvbnN0IG8zID0gYTIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzMy5hZGRyZXNzID0gYTIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBzMy5wYWdpbmF0aW9uID0gUGFnZVJlcXVlc3QuZGVjb2RlKGEyLCBhMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYTIuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHMzO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgYWRkcmVzczogaXNTZXQobzIuYWRkcmVzcykgPyBTdHJpbmcobzIuYWRkcmVzcykgOiBcIlwiLCBwYWdpbmF0aW9uOiBpc1NldChvMi5wYWdpbmF0aW9uKSA/IFBhZ2VSZXF1ZXN0LmZyb21KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgbjIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuYWRkcmVzcyAmJiAobjIuYWRkcmVzcyA9IG8yLmFkZHJlc3MpLCB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgKG4yLnBhZ2luYXRpb24gPSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QudG9KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgbjI7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCBuMiA9IHsgYWRkcmVzczogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiBuMi5hZGRyZXNzID0gbzIuYWRkcmVzcyA/PyBcIlwiLCBuMi5wYWdpbmF0aW9uID0gdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmIG51bGwgIT09IG8yLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC5mcm9tUGFydGlhbChvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgbjI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3QuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeUFsbEJhbGFuY2VzUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeUFsbEJhbGFuY2VzUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlXCIsIGVuY29kZShlMiwgYTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBvMiBvZiBlMi5iYWxhbmNlcykgQ29pbi5lbmNvZGUobzIsIGEyLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiBQYWdlUmVzcG9uc2UuZW5jb2RlKGUyLnBhZ2luYXRpb24sIGEyLnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgYTI7XG59LCBkZWNvZGUoZTIsIGEyKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgczMgPSB2b2lkIDAgPT09IGEyID8gdDUubGVuIDogdDUucG9zICsgYTI7XG4gIGNvbnN0IHI1ID0geyBiYWxhbmNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgdDUucG9zIDwgczM7ICkge1xuICAgIGNvbnN0IGUzID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5iYWxhbmNlcy5wdXNoKENvaW4uZGVjb2RlKHQ1LCB0NS51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUucGFnaW5hdGlvbiA9IFBhZ2VSZXNwb25zZS5kZWNvZGUodDUsIHQ1LnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBiYWxhbmNlczogQXJyYXkuaXNBcnJheShlMj8uYmFsYW5jZXMpID8gZTIuYmFsYW5jZXMubWFwKChlMykgPT4gQ29pbi5mcm9tSlNPTihlMykpIDogW10sIHBhZ2luYXRpb246IGlzU2V0KGUyLnBhZ2luYXRpb24pID8gUGFnZVJlc3BvbnNlLmZyb21KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgYTIgPSB7fTtcbiAgcmV0dXJuIGUyLmJhbGFuY2VzID8gYTIuYmFsYW5jZXMgPSBlMi5iYWxhbmNlcy5tYXAoKGUzKSA9PiBlMyA/IENvaW4udG9KU09OKGUzKSA6IHZvaWQgMCkgOiBhMi5iYWxhbmNlcyA9IFtdLCB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgKGEyLnBhZ2luYXRpb24gPSBlMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLnRvSlNPTihlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCksIGEyO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgYTIgPSB7IGJhbGFuY2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiBhMi5iYWxhbmNlcyA9IGUyLmJhbGFuY2VzPy5tYXAoKGUzKSA9PiBDb2luLmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIGEyLnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS5mcm9tUGFydGlhbChlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgYTI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUFsbEJhbGFuY2VzUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5QWxsQmFsYW5jZXNSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgTXNnU2VuZCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5Nc2dTZW5kXCIsIGVuY29kZShvMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgXCJcIiAhPT0gbzIuZnJvbUFkZHJlc3MgJiYgdDUudWludDMyKDEwKS5zdHJpbmcobzIuZnJvbUFkZHJlc3MpLCBcIlwiICE9PSBvMi50b0FkZHJlc3MgJiYgdDUudWludDMyKDE4KS5zdHJpbmcobzIudG9BZGRyZXNzKTtcbiAgZm9yIChjb25zdCBzMyBvZiBvMi5hbW91bnQpIENvaW4uZW5jb2RlKHMzLCB0NS51aW50MzIoMjYpLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB0NTtcbn0sIGRlY29kZShvMiwgdDUpIHtcbiAgY29uc3QgczMgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gdDUgPyBzMy5sZW4gOiBzMy5wb3MgKyB0NTtcbiAgY29uc3QgYTIgPSB7IGZyb21BZGRyZXNzOiBcIlwiLCB0b0FkZHJlc3M6IFwiXCIsIGFtb3VudDogW10gfTtcbiAgZm9yICg7IHMzLnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBvMyA9IHMzLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgYTIuZnJvbUFkZHJlc3MgPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGEyLnRvQWRkcmVzcyA9IHMzLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgYTIuYW1vdW50LnB1c2goQ29pbi5kZWNvZGUoczMsIHMzLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgczMuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGEyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZnJvbUFkZHJlc3M6IGlzU2V0KG8yLmZyb21BZGRyZXNzKSA/IFN0cmluZyhvMi5mcm9tQWRkcmVzcykgOiBcIlwiLCB0b0FkZHJlc3M6IGlzU2V0KG8yLnRvQWRkcmVzcykgPyBTdHJpbmcobzIudG9BZGRyZXNzKSA6IFwiXCIsIGFtb3VudDogQXJyYXkuaXNBcnJheShvMj8uYW1vdW50KSA/IG8yLmFtb3VudC5tYXAoKG8zKSA9PiBDb2luLmZyb21KU09OKG8zKSkgOiBbXSB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLmZyb21BZGRyZXNzICYmICh0NS5mcm9tQWRkcmVzcyA9IG8yLmZyb21BZGRyZXNzKSwgdm9pZCAwICE9PSBvMi50b0FkZHJlc3MgJiYgKHQ1LnRvQWRkcmVzcyA9IG8yLnRvQWRkcmVzcyksIG8yLmFtb3VudCA/IHQ1LmFtb3VudCA9IG8yLmFtb3VudC5tYXAoKG8zKSA9PiBvMyA/IENvaW4udG9KU09OKG8zKSA6IHZvaWQgMCkgOiB0NS5hbW91bnQgPSBbXSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgZnJvbUFkZHJlc3M6IFwiXCIsIHRvQWRkcmVzczogXCJcIiwgYW1vdW50OiBbXSB9O1xuICByZXR1cm4gdDUuZnJvbUFkZHJlc3MgPSBvMi5mcm9tQWRkcmVzcyA/PyBcIlwiLCB0NS50b0FkZHJlc3MgPSBvMi50b0FkZHJlc3MgPz8gXCJcIiwgdDUuYW1vdW50ID0gbzIuYW1vdW50Py5tYXAoKG8zKSA9PiBDb2luLmZyb21QYXJ0aWFsKG8zKSkgfHwgW10sIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ1NlbmQuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBNc2dTZW5kLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5Nc2dTZW5kXCIsIHZhbHVlOiBNc2dTZW5kLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZFwiLCBlbmNvZGUodDUsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIFwiXCIgIT09IHQ1LnZhbGlkYXRvckFkZHJlc3MgJiYgZTIudWludDMyKDEwKS5zdHJpbmcodDUudmFsaWRhdG9yQWRkcmVzcyk7XG4gIGZvciAoY29uc3QgcjUgb2YgdDUucmV3YXJkKSBEZWNDb2luLmVuY29kZShyNSwgZTIudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gZTI7XG59LCBkZWNvZGUodDUsIHI1KSB7XG4gIGNvbnN0IGkzID0gdDUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyB0NSA6IG5ldyBCaW5hcnlSZWFkZXIodDUpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHI1ID8gaTMubGVuIDogaTMucG9zICsgcjU7XG4gIGNvbnN0IGEyID0geyB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiLCByZXdhcmQ6IFtdIH07XG4gIGZvciAoOyBpMy5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgdDYgPSBpMy51aW50MzIoKTtcbiAgICBzd2l0Y2ggKHQ2ID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGEyLnZhbGlkYXRvckFkZHJlc3MgPSBpMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGEyLnJld2FyZC5wdXNoKERlY0NvaW4uZGVjb2RlKGkzLCBpMy51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGkzLnNraXBUeXBlKDcgJiB0Nik7XG4gICAgfVxuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAodDUpID0+ICh7IHZhbGlkYXRvckFkZHJlc3M6IGlzU2V0KHQ1LnZhbGlkYXRvckFkZHJlc3MpID8gU3RyaW5nKHQ1LnZhbGlkYXRvckFkZHJlc3MpIDogXCJcIiwgcmV3YXJkOiBBcnJheS5pc0FycmF5KHQ1Py5yZXdhcmQpID8gdDUucmV3YXJkLm1hcCgodDYpID0+IERlY0NvaW4uZnJvbUpTT04odDYpKSA6IFtdIH0pLCB0b0pTT04odDUpIHtcbiAgY29uc3QgZTIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gdDUudmFsaWRhdG9yQWRkcmVzcyAmJiAoZTIudmFsaWRhdG9yQWRkcmVzcyA9IHQ1LnZhbGlkYXRvckFkZHJlc3MpLCB0NS5yZXdhcmQgPyBlMi5yZXdhcmQgPSB0NS5yZXdhcmQubWFwKCh0NikgPT4gdDYgPyBEZWNDb2luLnRvSlNPTih0NikgOiB2b2lkIDApIDogZTIucmV3YXJkID0gW10sIGUyO1xufSwgZnJvbVBhcnRpYWwodDUpIHtcbiAgY29uc3QgZTIgPSB7IHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIHJld2FyZDogW10gfTtcbiAgcmV0dXJuIGUyLnZhbGlkYXRvckFkZHJlc3MgPSB0NS52YWxpZGF0b3JBZGRyZXNzID8/IFwiXCIsIGUyLnJld2FyZCA9IHQ1LnJld2FyZD8ubWFwKCh0NikgPT4gRGVjQ29pbi5mcm9tUGFydGlhbCh0NikpIHx8IFtdLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5EZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkXCIsIHZhbHVlOiBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgbzIudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcyksIFwiXCIgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgbzIudWludDMyKDE4KS5zdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcyksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBzMyA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHI1ID0gdm9pZCAwID09PSBvMiA/IHMzLmxlbiA6IHMzLnBvcyArIG8yO1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiB9O1xuICBmb3IgKDsgczMucG9zIDwgcjU7ICkge1xuICAgIGNvbnN0IGUzID0gczMudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICB0NS5kZWxlZ2F0b3JBZGRyZXNzID0gczMuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICB0NS52YWxpZGF0b3JBZGRyZXNzID0gczMuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgczMuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHQ1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIChvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiAobzIudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiIH07XG4gIHJldHVybiBvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdC5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0XCIsIHZhbHVlOiBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1Jlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1Jlc3BvbnNlXCIsIGVuY29kZShlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBzMyBvZiBlMi5yZXdhcmRzKSBEZWNDb2luLmVuY29kZShzMywgbzIudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gbzI7XG59LCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHMzID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgcjUgPSB2b2lkIDAgPT09IG8yID8gczMubGVuIDogczMucG9zICsgbzI7XG4gIGNvbnN0IHQ1ID0geyByZXdhcmRzOiBbXSB9O1xuICBmb3IgKDsgczMucG9zIDwgcjU7ICkge1xuICAgIGNvbnN0IGUzID0gczMudWludDMyKCk7XG4gICAgaWYgKGUzID4+PiAzID09IDEpIHQ1LnJld2FyZHMucHVzaChEZWNDb2luLmRlY29kZShzMywgczMudWludDMyKCkpKTtcbiAgICBlbHNlIHMzLnNraXBUeXBlKDcgJiBlMyk7XG4gIH1cbiAgcmV0dXJuIHQ1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgcmV3YXJkczogQXJyYXkuaXNBcnJheShlMj8ucmV3YXJkcykgPyBlMi5yZXdhcmRzLm1hcCgoZTMpID0+IERlY0NvaW4uZnJvbUpTT04oZTMpKSA6IFtdIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIGUyLnJld2FyZHMgPyBvMi5yZXdhcmRzID0gZTIucmV3YXJkcy5tYXAoKGUzKSA9PiBlMyA/IERlY0NvaW4udG9KU09OKGUzKSA6IHZvaWQgMCkgOiBvMi5yZXdhcmRzID0gW10sIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB7IHJld2FyZHM6IFtdIH07XG4gIHJldHVybiBvMi5yZXdhcmRzID0gZTIucmV3YXJkcz8ubWFwKChlMykgPT4gRGVjQ29pbi5mcm9tUGFydGlhbChlMykpIHx8IFtdLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2UuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1Jlc3BvbnNlXCIsIHZhbHVlOiBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1JlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgbzIudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcyksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBzMyA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHI1ID0gdm9pZCAwID09PSBvMiA/IHMzLmxlbiA6IHMzLnBvcyArIG8yO1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiB9O1xuICBmb3IgKDsgczMucG9zIDwgcjU7ICkge1xuICAgIGNvbnN0IGUzID0gczMudWludDMyKCk7XG4gICAgaWYgKGUzID4+PiAzID09IDEpIHQ1LmRlbGVnYXRvckFkZHJlc3MgPSBzMy5zdHJpbmcoKTtcbiAgICBlbHNlIHMzLnNraXBUeXBlKDcgJiBlMyk7XG4gIH1cbiAgcmV0dXJuIHQ1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiAobzIuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiIH07XG4gIHJldHVybiBvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXF1ZXN0LmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXF1ZXN0XCIsIHZhbHVlOiBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1Jlc3BvbnNlXCIsIGVuY29kZShlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBzMyBvZiBlMi5yZXdhcmRzKSBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmVuY29kZShzMywgbzIudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICBmb3IgKGNvbnN0IHMzIG9mIGUyLnRvdGFsKSBEZWNDb2luLmVuY29kZShzMywgbzIudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gbzI7XG59LCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHMzID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgcjUgPSB2b2lkIDAgPT09IG8yID8gczMubGVuIDogczMucG9zICsgbzI7XG4gIGNvbnN0IHQ1ID0geyByZXdhcmRzOiBbXSwgdG90YWw6IFtdIH07XG4gIGZvciAoOyBzMy5wb3MgPCByNTsgKSB7XG4gICAgY29uc3QgZTMgPSBzMy51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHQ1LnJld2FyZHMucHVzaChEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmRlY29kZShzMywgczMudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHQ1LnRvdGFsLnB1c2goRGVjQ29pbi5kZWNvZGUoczMsIHMzLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgczMuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHQ1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgcmV3YXJkczogQXJyYXkuaXNBcnJheShlMj8ucmV3YXJkcykgPyBlMi5yZXdhcmRzLm1hcCgoZTMpID0+IERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQuZnJvbUpTT04oZTMpKSA6IFtdLCB0b3RhbDogQXJyYXkuaXNBcnJheShlMj8udG90YWwpID8gZTIudG90YWwubWFwKChlMykgPT4gRGVjQ29pbi5mcm9tSlNPTihlMykpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gZTIucmV3YXJkcyA/IG8yLnJld2FyZHMgPSBlMi5yZXdhcmRzLm1hcCgoZTMpID0+IGUzID8gRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZC50b0pTT04oZTMpIDogdm9pZCAwKSA6IG8yLnJld2FyZHMgPSBbXSwgZTIudG90YWwgPyBvMi50b3RhbCA9IGUyLnRvdGFsLm1hcCgoZTMpID0+IGUzID8gRGVjQ29pbi50b0pTT04oZTMpIDogdm9pZCAwKSA6IG8yLnRvdGFsID0gW10sIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB7IHJld2FyZHM6IFtdLCB0b3RhbDogW10gfTtcbiAgcmV0dXJuIG8yLnJld2FyZHMgPSBlMi5yZXdhcmRzPy5tYXAoKGUzKSA9PiBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIG8yLnRvdGFsID0gZTIudG90YWw/Lm1hcCgoZTMpID0+IERlY0NvaW4uZnJvbVBhcnRpYWwoZTMpKSB8fCBbXSwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVzcG9uc2UuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRcIiwgZW5jb2RlOiAobzIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbzIuZGVsZWdhdG9yQWRkcmVzcyAmJiB0NS51aW50MzIoMTApLnN0cmluZyhvMi5kZWxlZ2F0b3JBZGRyZXNzKSwgXCJcIiAhPT0gbzIudmFsaWRhdG9yQWRkcmVzcyAmJiB0NS51aW50MzIoMTgpLnN0cmluZyhvMi52YWxpZGF0b3JBZGRyZXNzKSwgdDUpLCBkZWNvZGUobzIsIHQ1KSB7XG4gIGNvbnN0IHMzID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgcjUgPSB2b2lkIDAgPT09IHQ1ID8gczMubGVuIDogczMucG9zICsgdDU7XG4gIGNvbnN0IGQgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIgfTtcbiAgZm9yICg7IHMzLnBvcyA8IHI1OyApIHtcbiAgICBjb25zdCBvMyA9IHMzLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgZC5kZWxlZ2F0b3JBZGRyZXNzID0gczMuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBkLnZhbGlkYXRvckFkZHJlc3MgPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBzMy5za2lwVHlwZSg3ICYgbzMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZDtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KG8yLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKG8yLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogaXNTZXQobzIudmFsaWRhdG9yQWRkcmVzcykgPyBTdHJpbmcobzIudmFsaWRhdG9yQWRkcmVzcykgOiBcIlwiIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZGVsZWdhdG9yQWRkcmVzcyAmJiAodDUuZGVsZWdhdG9yQWRkcmVzcyA9IG8yLmRlbGVnYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IG8yLnZhbGlkYXRvckFkZHJlc3MgJiYgKHQ1LnZhbGlkYXRvckFkZHJlc3MgPSBvMi52YWxpZGF0b3JBZGRyZXNzKSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiB9O1xuICByZXR1cm4gdDUuZGVsZWdhdG9yQWRkcmVzcyA9IG8yLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUudmFsaWRhdG9yQWRkcmVzcyA9IG8yLnZhbGlkYXRvckFkZHJlc3MgPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmQuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5Nc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFwiLCB2YWx1ZTogTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmQuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5Nc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlXCIsIGVuY29kZSh0NSwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBzMyBvZiB0NS5hbW91bnQpIENvaW4uZW5jb2RlKHMzLCBlMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiBlMjtcbn0sIGRlY29kZSh0NSwgczMpIHtcbiAgY29uc3QgcjUgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBkID0gdm9pZCAwID09PSBzMyA/IHI1LmxlbiA6IHI1LnBvcyArIHMzO1xuICBjb25zdCBpMyA9IHsgYW1vdW50OiBbXSB9O1xuICBmb3IgKDsgcjUucG9zIDwgZDsgKSB7XG4gICAgY29uc3QgdDYgPSByNS51aW50MzIoKTtcbiAgICBpZiAodDYgPj4+IDMgPT0gMSkgaTMuYW1vdW50LnB1c2goQ29pbi5kZWNvZGUocjUsIHI1LnVpbnQzMigpKSk7XG4gICAgZWxzZSByNS5za2lwVHlwZSg3ICYgdDYpO1xuICB9XG4gIHJldHVybiBpMztcbn0sIGZyb21KU09OOiAodDUpID0+ICh7IGFtb3VudDogQXJyYXkuaXNBcnJheSh0NT8uYW1vdW50KSA/IHQ1LmFtb3VudC5tYXAoKHQ2KSA9PiBDb2luLmZyb21KU09OKHQ2KSkgOiBbXSB9KSwgdG9KU09OKHQ1KSB7XG4gIGNvbnN0IGUyID0ge307XG4gIHJldHVybiB0NS5hbW91bnQgPyBlMi5hbW91bnQgPSB0NS5hbW91bnQubWFwKCh0NikgPT4gdDYgPyBDb2luLnRvSlNPTih0NikgOiB2b2lkIDApIDogZTIuYW1vdW50ID0gW10sIGUyO1xufSwgZnJvbVBhcnRpYWwodDUpIHtcbiAgY29uc3QgZTIgPSB7IGFtb3VudDogW10gfTtcbiAgcmV0dXJuIGUyLmFtb3VudCA9IHQ1LmFtb3VudD8ubWFwKCh0NikgPT4gQ29pbi5mcm9tUGFydGlhbCh0NikpIHx8IFtdLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRSZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5Nc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlXCIsIHZhbHVlOiBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBCb25kU3RhdHVzO1xuIWZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLkJPTkRfU1RBVFVTX1VOU1BFQ0lGSUVEID0gMF0gPSBcIkJPTkRfU1RBVFVTX1VOU1BFQ0lGSUVEXCIsIGUyW2UyLkJPTkRfU1RBVFVTX1VOQk9OREVEID0gMV0gPSBcIkJPTkRfU1RBVFVTX1VOQk9OREVEXCIsIGUyW2UyLkJPTkRfU1RBVFVTX1VOQk9ORElORyA9IDJdID0gXCJCT05EX1NUQVRVU19VTkJPTkRJTkdcIiwgZTJbZTIuQk9ORF9TVEFUVVNfQk9OREVEID0gM10gPSBcIkJPTkRfU1RBVFVTX0JPTkRFRFwiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShCb25kU3RhdHVzIHx8IChCb25kU3RhdHVzID0ge30pKTtcbnZhciBJbmZyYWN0aW9uO1xuIWZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLklORlJBQ1RJT05fVU5TUEVDSUZJRUQgPSAwXSA9IFwiSU5GUkFDVElPTl9VTlNQRUNJRklFRFwiLCBlMltlMi5JTkZSQUNUSU9OX0RPVUJMRV9TSUdOID0gMV0gPSBcIklORlJBQ1RJT05fRE9VQkxFX1NJR05cIiwgZTJbZTIuSU5GUkFDVElPTl9ET1dOVElNRSA9IDJdID0gXCJJTkZSQUNUSU9OX0RPV05USU1FXCIsIGUyW2UyLlVOUkVDT0dOSVpFRCA9IC0xXSA9IFwiVU5SRUNPR05JWkVEXCI7XG59KEluZnJhY3Rpb24gfHwgKEluZnJhY3Rpb24gPSB7fSkpO1xudmFyIERlbGVnYXRpb24gPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuRGVsZWdhdGlvblwiLCBlbmNvZGU6IChlMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi5zaGFyZXMgJiYgdDUudWludDMyKDI2KS5zdHJpbmcoRGVjaW1hbC5mcm9tVXNlcklucHV0KGUyLnNoYXJlcywgMTgpLmF0b21pY3MpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbzIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gdDUgPyBvMi5sZW4gOiBvMi5wb3MgKyB0NTtcbiAgY29uc3QgaTMgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIHNoYXJlczogXCJcIiB9O1xuICBmb3IgKDsgbzIucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMy5kZWxlZ2F0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMy52YWxpZGF0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBpMy5zaGFyZXMgPSBEZWNpbWFsLmZyb21BdG9taWNzKG8yLnN0cmluZygpLCAxOCkudG9TdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTM7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpIDogXCJcIiwgc2hhcmVzOiBpc1NldChlMi5zaGFyZXMpID8gU3RyaW5nKGUyLnNoYXJlcykgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiAodDUuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgKHQ1LnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5zaGFyZXMgJiYgKHQ1LnNoYXJlcyA9IGUyLnNoYXJlcyksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIHNoYXJlczogXCJcIiB9O1xuICByZXR1cm4gdDUuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUuc2hhcmVzID0gZTIuc2hhcmVzID8/IFwiXCIsIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IERlbGVnYXRpb24uZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBEZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5EZWxlZ2F0aW9uXCIsIHZhbHVlOiBEZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBVbmJvbmRpbmdEZWxlZ2F0aW9uID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlVuYm9uZGluZ0RlbGVnYXRpb25cIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpO1xuICBmb3IgKGNvbnN0IG8yIG9mIGUyLmVudHJpZXMpIFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5lbmNvZGUobzIsIHQ1LnVpbnQzMigyNikuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHQ1O1xufSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBvMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSB0NSA/IG8yLmxlbiA6IG8yLnBvcyArIHQ1O1xuICBjb25zdCBpMyA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgZW50cmllczogW10gfTtcbiAgZm9yICg7IG8yLnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBlMyA9IG8yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTMuZGVsZWdhdG9yQWRkcmVzcyA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTMudmFsaWRhdG9yQWRkcmVzcyA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgaTMuZW50cmllcy5wdXNoKFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5kZWNvZGUobzIsIG8yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkzO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIsIGVudHJpZXM6IEFycmF5LmlzQXJyYXkoZTI/LmVudHJpZXMpID8gZTIuZW50cmllcy5tYXAoKGUzKSA9PiBVbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnkuZnJvbUpTT04oZTMpKSA6IFtdIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiAodDUuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgKHQ1LnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzKSwgZTIuZW50cmllcyA/IHQ1LmVudHJpZXMgPSBlMi5lbnRyaWVzLm1hcCgoZTMpID0+IGUzID8gVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUuZW50cmllcyA9IFtdLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiLCBlbnRyaWVzOiBbXSB9O1xuICByZXR1cm4gdDUuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUuZW50cmllcyA9IGUyLmVudHJpZXM/Lm1hcCgoZTMpID0+IFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5mcm9tUGFydGlhbChlMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gVW5ib25kaW5nRGVsZWdhdGlvbi5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuVW5ib25kaW5nRGVsZWdhdGlvblwiLCB2YWx1ZTogVW5ib25kaW5nRGVsZWdhdGlvbi5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBmKCkge1xuICByZXR1cm4geyBjcmVhdGlvbkhlaWdodDogQmlnSW50KDApLCBjb21wbGV0aW9uVGltZTogVGltZXN0YW1wLmZyb21QYXJ0aWFsKHt9KSwgaW5pdGlhbEJhbGFuY2U6IFwiXCIsIGJhbGFuY2U6IFwiXCIsIHVuYm9uZGluZ0lkOiBCaWdJbnQoMCksIHVuYm9uZGluZ09uSG9sZFJlZkNvdW50OiBCaWdJbnQoMCkgfTtcbn1cbnZhciBVbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnkgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5XCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKGUyLmNyZWF0aW9uSGVpZ2h0ICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDgpLmludDY0KGUyLmNyZWF0aW9uSGVpZ2h0KSwgdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBUaW1lc3RhbXAuZW5jb2RlKGUyLmNvbXBsZXRpb25UaW1lLCBvMi51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIFwiXCIgIT09IGUyLmluaXRpYWxCYWxhbmNlICYmIG8yLnVpbnQzMigyNikuc3RyaW5nKGUyLmluaXRpYWxCYWxhbmNlKSwgXCJcIiAhPT0gZTIuYmFsYW5jZSAmJiBvMi51aW50MzIoMzQpLnN0cmluZyhlMi5iYWxhbmNlKSwgZTIudW5ib25kaW5nSWQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoNDApLnVpbnQ2NChlMi51bmJvbmRpbmdJZCksIGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50ICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDQ4KS5pbnQ2NChlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkzID0gdm9pZCAwID09PSBvMiA/IG4yLmxlbiA6IG4yLnBvcyArIG8yO1xuICBjb25zdCBzMyA9IGYoKTtcbiAgZm9yICg7IG4yLnBvcyA8IGkzOyApIHtcbiAgICBjb25zdCBlMyA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczMuY3JlYXRpb25IZWlnaHQgPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgczMuY29tcGxldGlvblRpbWUgPSBUaW1lc3RhbXAuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBzMy5pbml0aWFsQmFsYW5jZSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgczMuYmFsYW5jZSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgczMudW5ib25kaW5nSWQgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDY6XG4gICAgICAgIHMzLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50ID0gbjIuaW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gczM7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBjcmVhdGlvbkhlaWdodDogaXNTZXQoZTIuY3JlYXRpb25IZWlnaHQpID8gQmlnSW50KGUyLmNyZWF0aW9uSGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBjb21wbGV0aW9uVGltZTogaXNTZXQoZTIuY29tcGxldGlvblRpbWUpID8gZnJvbUpzb25UaW1lc3RhbXAoZTIuY29tcGxldGlvblRpbWUpIDogdm9pZCAwLCBpbml0aWFsQmFsYW5jZTogaXNTZXQoZTIuaW5pdGlhbEJhbGFuY2UpID8gU3RyaW5nKGUyLmluaXRpYWxCYWxhbmNlKSA6IFwiXCIsIGJhbGFuY2U6IGlzU2V0KGUyLmJhbGFuY2UpID8gU3RyaW5nKGUyLmJhbGFuY2UpIDogXCJcIiwgdW5ib25kaW5nSWQ6IGlzU2V0KGUyLnVuYm9uZGluZ0lkKSA/IEJpZ0ludChlMi51bmJvbmRpbmdJZC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgdW5ib25kaW5nT25Ib2xkUmVmQ291bnQ6IGlzU2V0KGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50KSA/IEJpZ0ludChlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmNyZWF0aW9uSGVpZ2h0ICYmICh0NS5jcmVhdGlvbkhlaWdodCA9IChlMi5jcmVhdGlvbkhlaWdodCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmICh0NS5jb21wbGV0aW9uVGltZSA9IGZyb21UaW1lc3RhbXAoZTIuY29tcGxldGlvblRpbWUpLnRvSVNPU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLmluaXRpYWxCYWxhbmNlICYmICh0NS5pbml0aWFsQmFsYW5jZSA9IGUyLmluaXRpYWxCYWxhbmNlKSwgdm9pZCAwICE9PSBlMi5iYWxhbmNlICYmICh0NS5iYWxhbmNlID0gZTIuYmFsYW5jZSksIHZvaWQgMCAhPT0gZTIudW5ib25kaW5nSWQgJiYgKHQ1LnVuYm9uZGluZ0lkID0gKGUyLnVuYm9uZGluZ0lkIHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgJiYgKHQ1LnVuYm9uZGluZ09uSG9sZFJlZkNvdW50ID0gKGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSBmKCk7XG4gIHJldHVybiBvMi5jcmVhdGlvbkhlaWdodCA9IHZvaWQgMCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgJiYgbnVsbCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgPyBCaWdJbnQoZTIuY3JlYXRpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG8yLmNvbXBsZXRpb25UaW1lID0gdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBudWxsICE9PSBlMi5jb21wbGV0aW9uVGltZSA/IFRpbWVzdGFtcC5mcm9tUGFydGlhbChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIG8yLmluaXRpYWxCYWxhbmNlID0gZTIuaW5pdGlhbEJhbGFuY2UgPz8gXCJcIiwgbzIuYmFsYW5jZSA9IGUyLmJhbGFuY2UgPz8gXCJcIiwgbzIudW5ib25kaW5nSWQgPSB2b2lkIDAgIT09IGUyLnVuYm9uZGluZ0lkICYmIG51bGwgIT09IGUyLnVuYm9uZGluZ0lkID8gQmlnSW50KGUyLnVuYm9uZGluZ0lkLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBvMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCA9IHZvaWQgMCAhPT0gZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgJiYgbnVsbCAhPT0gZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgPyBCaWdJbnQoZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5XCIsIHZhbHVlOiBVbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gYjIoKSB7XG4gIHJldHVybiB7IGNyZWF0aW9uSGVpZ2h0OiBCaWdJbnQoMCksIGNvbXBsZXRpb25UaW1lOiBUaW1lc3RhbXAuZnJvbVBhcnRpYWwoe30pLCBpbml0aWFsQmFsYW5jZTogXCJcIiwgc2hhcmVzRHN0OiBcIlwiLCB1bmJvbmRpbmdJZDogQmlnSW50KDApLCB1bmJvbmRpbmdPbkhvbGRSZWZDb3VudDogQmlnSW50KDApIH07XG59XG52YXIgUmVkZWxlZ2F0aW9uRW50cnkgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUmVkZWxlZ2F0aW9uRW50cnlcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoZTIuY3JlYXRpb25IZWlnaHQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoOCkuaW50NjQoZTIuY3JlYXRpb25IZWlnaHQpLCB2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmIFRpbWVzdGFtcC5lbmNvZGUoZTIuY29tcGxldGlvblRpbWUsIG8yLnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgXCJcIiAhPT0gZTIuaW5pdGlhbEJhbGFuY2UgJiYgbzIudWludDMyKDI2KS5zdHJpbmcoZTIuaW5pdGlhbEJhbGFuY2UpLCBcIlwiICE9PSBlMi5zaGFyZXNEc3QgJiYgbzIudWludDMyKDM0KS5zdHJpbmcoRGVjaW1hbC5mcm9tVXNlcklucHV0KGUyLnNoYXJlc0RzdCwgMTgpLmF0b21pY3MpLCBlMi51bmJvbmRpbmdJZCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMig0MCkudWludDY0KGUyLnVuYm9uZGluZ0lkKSwgZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoNDgpLmludDY0KGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50KSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IG4yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTMgPSB2b2lkIDAgPT09IG8yID8gbjIubGVuIDogbjIucG9zICsgbzI7XG4gIGNvbnN0IHMzID0gYjIoKTtcbiAgZm9yICg7IG4yLnBvcyA8IGkzOyApIHtcbiAgICBjb25zdCBlMyA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczMuY3JlYXRpb25IZWlnaHQgPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgczMuY29tcGxldGlvblRpbWUgPSBUaW1lc3RhbXAuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBzMy5pbml0aWFsQmFsYW5jZSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgczMuc2hhcmVzRHN0ID0gRGVjaW1hbC5mcm9tQXRvbWljcyhuMi5zdHJpbmcoKSwgMTgpLnRvU3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA1OlxuICAgICAgICBzMy51bmJvbmRpbmdJZCA9IG4yLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNjpcbiAgICAgICAgczMudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMztcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGNyZWF0aW9uSGVpZ2h0OiBpc1NldChlMi5jcmVhdGlvbkhlaWdodCkgPyBCaWdJbnQoZTIuY3JlYXRpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGNvbXBsZXRpb25UaW1lOiBpc1NldChlMi5jb21wbGV0aW9uVGltZSkgPyBmcm9tSnNvblRpbWVzdGFtcChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIGluaXRpYWxCYWxhbmNlOiBpc1NldChlMi5pbml0aWFsQmFsYW5jZSkgPyBTdHJpbmcoZTIuaW5pdGlhbEJhbGFuY2UpIDogXCJcIiwgc2hhcmVzRHN0OiBpc1NldChlMi5zaGFyZXNEc3QpID8gU3RyaW5nKGUyLnNoYXJlc0RzdCkgOiBcIlwiLCB1bmJvbmRpbmdJZDogaXNTZXQoZTIudW5ib25kaW5nSWQpID8gQmlnSW50KGUyLnVuYm9uZGluZ0lkLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB1bmJvbmRpbmdPbkhvbGRSZWZDb3VudDogaXNTZXQoZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQpID8gQmlnSW50KGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50LnRvU3RyaW5nKCkpIDogQmlnSW50KDApIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgJiYgKHQ1LmNyZWF0aW9uSGVpZ2h0ID0gKGUyLmNyZWF0aW9uSGVpZ2h0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuY29tcGxldGlvblRpbWUgJiYgKHQ1LmNvbXBsZXRpb25UaW1lID0gZnJvbVRpbWVzdGFtcChlMi5jb21wbGV0aW9uVGltZSkudG9JU09TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuaW5pdGlhbEJhbGFuY2UgJiYgKHQ1LmluaXRpYWxCYWxhbmNlID0gZTIuaW5pdGlhbEJhbGFuY2UpLCB2b2lkIDAgIT09IGUyLnNoYXJlc0RzdCAmJiAodDUuc2hhcmVzRHN0ID0gZTIuc2hhcmVzRHN0KSwgdm9pZCAwICE9PSBlMi51bmJvbmRpbmdJZCAmJiAodDUudW5ib25kaW5nSWQgPSAoZTIudW5ib25kaW5nSWQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCAmJiAodDUudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgPSAoZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IGIyKCk7XG4gIHJldHVybiBvMi5jcmVhdGlvbkhlaWdodCA9IHZvaWQgMCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgJiYgbnVsbCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgPyBCaWdJbnQoZTIuY3JlYXRpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG8yLmNvbXBsZXRpb25UaW1lID0gdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBudWxsICE9PSBlMi5jb21wbGV0aW9uVGltZSA/IFRpbWVzdGFtcC5mcm9tUGFydGlhbChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIG8yLmluaXRpYWxCYWxhbmNlID0gZTIuaW5pdGlhbEJhbGFuY2UgPz8gXCJcIiwgbzIuc2hhcmVzRHN0ID0gZTIuc2hhcmVzRHN0ID8/IFwiXCIsIG8yLnVuYm9uZGluZ0lkID0gdm9pZCAwICE9PSBlMi51bmJvbmRpbmdJZCAmJiBudWxsICE9PSBlMi51bmJvbmRpbmdJZCA/IEJpZ0ludChlMi51bmJvbmRpbmdJZC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbzIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgPSB2b2lkIDAgIT09IGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50ICYmIG51bGwgIT09IGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50ID8gQmlnSW50KGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBSZWRlbGVnYXRpb25FbnRyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlZGVsZWdhdGlvbkVudHJ5LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25FbnRyeVwiLCB2YWx1ZTogUmVkZWxlZ2F0aW9uRW50cnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFJlZGVsZWdhdGlvbiA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25cIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzICYmIHQ1LnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzICYmIHQ1LnVpbnQzMigyNikuc3RyaW5nKGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpO1xuICBmb3IgKGNvbnN0IG8yIG9mIGUyLmVudHJpZXMpIFJlZGVsZWdhdGlvbkVudHJ5LmVuY29kZShvMiwgdDUudWludDMyKDM0KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdDU7XG59LCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IGkzID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JTcmNBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JEc3RBZGRyZXNzOiBcIlwiLCBlbnRyaWVzOiBbXSB9O1xuICBmb3IgKDsgbzIucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMy5kZWxlZ2F0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMy52YWxpZGF0b3JTcmNBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBpMy52YWxpZGF0b3JEc3RBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBpMy5lbnRyaWVzLnB1c2goUmVkZWxlZ2F0aW9uRW50cnkuZGVjb2RlKG8yLCBvMi51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMztcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yU3JjQWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yU3JjQWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yU3JjQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JEc3RBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSA6IFwiXCIsIGVudHJpZXM6IEFycmF5LmlzQXJyYXkoZTI/LmVudHJpZXMpID8gZTIuZW50cmllcy5tYXAoKGUzKSA9PiBSZWRlbGVnYXRpb25FbnRyeS5mcm9tSlNPTihlMykpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmICh0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyAmJiAodDUudmFsaWRhdG9yU3JjQWRkcmVzcyA9IGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MgJiYgKHQ1LnZhbGlkYXRvckRzdEFkZHJlc3MgPSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSwgZTIuZW50cmllcyA/IHQ1LmVudHJpZXMgPSBlMi5lbnRyaWVzLm1hcCgoZTMpID0+IGUzID8gUmVkZWxlZ2F0aW9uRW50cnkudG9KU09OKGUzKSA6IHZvaWQgMCkgOiB0NS5lbnRyaWVzID0gW10sIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvclNyY0FkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckRzdEFkZHJlc3M6IFwiXCIsIGVudHJpZXM6IFtdIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCB0NS52YWxpZGF0b3JTcmNBZGRyZXNzID0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyA/PyBcIlwiLCB0NS52YWxpZGF0b3JEc3RBZGRyZXNzID0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyA/PyBcIlwiLCB0NS5lbnRyaWVzID0gZTIuZW50cmllcz8ubWFwKChlMykgPT4gUmVkZWxlZ2F0aW9uRW50cnkuZnJvbVBhcnRpYWwoZTMpKSB8fCBbXSwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUmVkZWxlZ2F0aW9uLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUmVkZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25cIiwgdmFsdWU6IFJlZGVsZWdhdGlvbi5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBTKCkge1xuICByZXR1cm4geyBkZWxlZ2F0aW9uOiBEZWxlZ2F0aW9uLmZyb21QYXJ0aWFsKHt9KSwgYmFsYW5jZTogQ29pbi5mcm9tUGFydGlhbCh7fSkgfTtcbn1cbnZhciBEZWxlZ2F0aW9uUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuRGVsZWdhdGlvblJlc3BvbnNlXCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHZvaWQgMCAhPT0gZTIuZGVsZWdhdGlvbiAmJiBEZWxlZ2F0aW9uLmVuY29kZShlMi5kZWxlZ2F0aW9uLCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiBDb2luLmVuY29kZShlMi5iYWxhbmNlLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBvMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSB0NSA/IG8yLmxlbiA6IG8yLnBvcyArIHQ1O1xuICBjb25zdCBzMyA9IFMoKTtcbiAgZm9yICg7IG8yLnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBlMyA9IG8yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczMuZGVsZWdhdGlvbiA9IERlbGVnYXRpb24uZGVjb2RlKG8yLCBvMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBzMy5iYWxhbmNlID0gQ29pbi5kZWNvZGUobzIsIG8yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gczM7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0aW9uOiBpc1NldChlMi5kZWxlZ2F0aW9uKSA/IERlbGVnYXRpb24uZnJvbUpTT04oZTIuZGVsZWdhdGlvbikgOiB2b2lkIDAsIGJhbGFuY2U6IGlzU2V0KGUyLmJhbGFuY2UpID8gQ29pbi5mcm9tSlNPTihlMi5iYWxhbmNlKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRpb24gJiYgKHQ1LmRlbGVnYXRpb24gPSBlMi5kZWxlZ2F0aW9uID8gRGVsZWdhdGlvbi50b0pTT04oZTIuZGVsZWdhdGlvbikgOiB2b2lkIDApLCB2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgKHQ1LmJhbGFuY2UgPSBlMi5iYWxhbmNlID8gQ29pbi50b0pTT04oZTIuYmFsYW5jZSkgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0gUygpO1xuICByZXR1cm4gdDUuZGVsZWdhdGlvbiA9IHZvaWQgMCAhPT0gZTIuZGVsZWdhdGlvbiAmJiBudWxsICE9PSBlMi5kZWxlZ2F0aW9uID8gRGVsZWdhdGlvbi5mcm9tUGFydGlhbChlMi5kZWxlZ2F0aW9uKSA6IHZvaWQgMCwgdDUuYmFsYW5jZSA9IHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiBudWxsICE9PSBlMi5iYWxhbmNlID8gQ29pbi5mcm9tUGFydGlhbChlMi5iYWxhbmNlKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gRGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gRGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5EZWxlZ2F0aW9uUmVzcG9uc2VcIiwgdmFsdWU6IERlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBBKCkge1xuICByZXR1cm4geyByZWRlbGVnYXRpb25FbnRyeTogUmVkZWxlZ2F0aW9uRW50cnkuZnJvbVBhcnRpYWwoe30pLCBiYWxhbmNlOiBcIlwiIH07XG59XG52YXIgUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlXCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHZvaWQgMCAhPT0gZTIucmVkZWxlZ2F0aW9uRW50cnkgJiYgUmVkZWxlZ2F0aW9uRW50cnkuZW5jb2RlKGUyLnJlZGVsZWdhdGlvbkVudHJ5LCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIFwiXCIgIT09IGUyLmJhbGFuY2UgJiYgdDUudWludDMyKDM0KS5zdHJpbmcoZTIuYmFsYW5jZSksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBvMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSB0NSA/IG8yLmxlbiA6IG8yLnBvcyArIHQ1O1xuICBjb25zdCBpMyA9IEEoKTtcbiAgZm9yICg7IG8yLnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBlMyA9IG8yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTMucmVkZWxlZ2F0aW9uRW50cnkgPSBSZWRlbGVnYXRpb25FbnRyeS5kZWNvZGUobzIsIG8yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGkzLmJhbGFuY2UgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTM7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyByZWRlbGVnYXRpb25FbnRyeTogaXNTZXQoZTIucmVkZWxlZ2F0aW9uRW50cnkpID8gUmVkZWxlZ2F0aW9uRW50cnkuZnJvbUpTT04oZTIucmVkZWxlZ2F0aW9uRW50cnkpIDogdm9pZCAwLCBiYWxhbmNlOiBpc1NldChlMi5iYWxhbmNlKSA/IFN0cmluZyhlMi5iYWxhbmNlKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb25FbnRyeSAmJiAodDUucmVkZWxlZ2F0aW9uRW50cnkgPSBlMi5yZWRlbGVnYXRpb25FbnRyeSA/IFJlZGVsZWdhdGlvbkVudHJ5LnRvSlNPTihlMi5yZWRlbGVnYXRpb25FbnRyeSkgOiB2b2lkIDApLCB2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgKHQ1LmJhbGFuY2UgPSBlMi5iYWxhbmNlKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IEEoKTtcbiAgcmV0dXJuIHQ1LnJlZGVsZWdhdGlvbkVudHJ5ID0gdm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb25FbnRyeSAmJiBudWxsICE9PSBlMi5yZWRlbGVnYXRpb25FbnRyeSA/IFJlZGVsZWdhdGlvbkVudHJ5LmZyb21QYXJ0aWFsKGUyLnJlZGVsZWdhdGlvbkVudHJ5KSA6IHZvaWQgMCwgdDUuYmFsYW5jZSA9IGUyLmJhbGFuY2UgPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2VcIiwgdmFsdWU6IFJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gRCgpIHtcbiAgcmV0dXJuIHsgcmVkZWxlZ2F0aW9uOiBSZWRlbGVnYXRpb24uZnJvbVBhcnRpYWwoe30pLCBlbnRyaWVzOiBbXSB9O1xufVxudmFyIFJlZGVsZWdhdGlvblJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvblJlc3BvbnNlXCIsIGVuY29kZShlMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgdm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb24gJiYgUmVkZWxlZ2F0aW9uLmVuY29kZShlMi5yZWRlbGVnYXRpb24sIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgZm9yIChjb25zdCBvMiBvZiBlMi5lbnRyaWVzKSBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLmVuY29kZShvMiwgdDUudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdDU7XG59LCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IGkzID0gRCgpO1xuICBmb3IgKDsgbzIucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMy5yZWRlbGVnYXRpb24gPSBSZWRlbGVnYXRpb24uZGVjb2RlKG8yLCBvMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMy5lbnRyaWVzLnB1c2goUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5kZWNvZGUobzIsIG8yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkzO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgcmVkZWxlZ2F0aW9uOiBpc1NldChlMi5yZWRlbGVnYXRpb24pID8gUmVkZWxlZ2F0aW9uLmZyb21KU09OKGUyLnJlZGVsZWdhdGlvbikgOiB2b2lkIDAsIGVudHJpZXM6IEFycmF5LmlzQXJyYXkoZTI/LmVudHJpZXMpID8gZTIuZW50cmllcy5tYXAoKGUzKSA9PiBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLmZyb21KU09OKGUzKSkgOiBbXSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLnJlZGVsZWdhdGlvbiAmJiAodDUucmVkZWxlZ2F0aW9uID0gZTIucmVkZWxlZ2F0aW9uID8gUmVkZWxlZ2F0aW9uLnRvSlNPTihlMi5yZWRlbGVnYXRpb24pIDogdm9pZCAwKSwgZTIuZW50cmllcyA/IHQ1LmVudHJpZXMgPSBlMi5lbnRyaWVzLm1hcCgoZTMpID0+IGUzID8gUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS50b0pTT04oZTMpIDogdm9pZCAwKSA6IHQ1LmVudHJpZXMgPSBbXSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IEQoKTtcbiAgcmV0dXJuIHQ1LnJlZGVsZWdhdGlvbiA9IHZvaWQgMCAhPT0gZTIucmVkZWxlZ2F0aW9uICYmIG51bGwgIT09IGUyLnJlZGVsZWdhdGlvbiA/IFJlZGVsZWdhdGlvbi5mcm9tUGFydGlhbChlMi5yZWRlbGVnYXRpb24pIDogdm9pZCAwLCB0NS5lbnRyaWVzID0gZTIuZW50cmllcz8ubWFwKChlMykgPT4gUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5mcm9tUGFydGlhbChlMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBSZWRlbGVnYXRpb25SZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlZGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25SZXNwb25zZVwiLCB2YWx1ZTogUmVkZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIFF1ZXJ5RGVsZWdhdGlvblJlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdFwiLCBlbmNvZGU6IChvMiwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5kZWxlZ2F0b3JBZGRyICYmIGUyLnVpbnQzMigxMCkuc3RyaW5nKG8yLmRlbGVnYXRvckFkZHIpLCBcIlwiICE9PSBvMi52YWxpZGF0b3JBZGRyICYmIGUyLnVpbnQzMigxOCkuc3RyaW5nKG8yLnZhbGlkYXRvckFkZHIpLCBlMiksIGRlY29kZShvMiwgZTIpIHtcbiAgY29uc3QgdDUgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gZTIgPyB0NS5sZW4gOiB0NS5wb3MgKyBlMjtcbiAgY29uc3QgYTIgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHZhbGlkYXRvckFkZHI6IFwiXCIgfTtcbiAgZm9yICg7IHQ1LnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBvMyA9IHQ1LnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgYTIuZGVsZWdhdG9yQWRkciA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgYTIudmFsaWRhdG9yQWRkciA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHQ1LnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGRlbGVnYXRvckFkZHI6IGlzU2V0KG8yLmRlbGVnYXRvckFkZHIpID8gU3RyaW5nKG8yLmRlbGVnYXRvckFkZHIpIDogXCJcIiwgdmFsaWRhdG9yQWRkcjogaXNTZXQobzIudmFsaWRhdG9yQWRkcikgPyBTdHJpbmcobzIudmFsaWRhdG9yQWRkcikgOiBcIlwiIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgZTIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZGVsZWdhdG9yQWRkciAmJiAoZTIuZGVsZWdhdG9yQWRkciA9IG8yLmRlbGVnYXRvckFkZHIpLCB2b2lkIDAgIT09IG8yLnZhbGlkYXRvckFkZHIgJiYgKGUyLnZhbGlkYXRvckFkZHIgPSBvMi52YWxpZGF0b3JBZGRyKSwgZTI7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCBlMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgdmFsaWRhdG9yQWRkcjogXCJcIiB9O1xuICByZXR1cm4gZTIuZGVsZWdhdG9yQWRkciA9IG8yLmRlbGVnYXRvckFkZHIgPz8gXCJcIiwgZTIudmFsaWRhdG9yQWRkciA9IG8yLnZhbGlkYXRvckFkZHIgPz8gXCJcIiwgZTI7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5RGVsZWdhdGlvblJlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdGlvblJlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlXCIsIGVuY29kZTogKG8yLCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHZvaWQgMCAhPT0gbzIuZGVsZWdhdGlvblJlc3BvbnNlICYmIERlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUobzIuZGVsZWdhdGlvblJlc3BvbnNlLCBlMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCB0NSA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSBlMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIGUyO1xuICBjb25zdCBpMyA9IHsgZGVsZWdhdGlvblJlc3BvbnNlOiB2b2lkIDAgfTtcbiAgZm9yICg7IHQ1LnBvcyA8IGEyOyApIHtcbiAgICBjb25zdCBvMyA9IHQ1LnVpbnQzMigpO1xuICAgIGlmIChvMyA+Pj4gMyA9PSAxKSBpMy5kZWxlZ2F0aW9uUmVzcG9uc2UgPSBEZWxlZ2F0aW9uUmVzcG9uc2UuZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgZWxzZSB0NS5za2lwVHlwZSg3ICYgbzMpO1xuICB9XG4gIHJldHVybiBpMztcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGRlbGVnYXRpb25SZXNwb25zZTogaXNTZXQobzIuZGVsZWdhdGlvblJlc3BvbnNlKSA/IERlbGVnYXRpb25SZXNwb25zZS5mcm9tSlNPTihvMi5kZWxlZ2F0aW9uUmVzcG9uc2UpIDogdm9pZCAwIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgZTIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZGVsZWdhdGlvblJlc3BvbnNlICYmIChlMi5kZWxlZ2F0aW9uUmVzcG9uc2UgPSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2UgPyBEZWxlZ2F0aW9uUmVzcG9uc2UudG9KU09OKG8yLmRlbGVnYXRpb25SZXNwb25zZSkgOiB2b2lkIDApLCBlMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IGUyID0geyBkZWxlZ2F0aW9uUmVzcG9uc2U6IHZvaWQgMCB9O1xuICByZXR1cm4gZTIuZGVsZWdhdGlvblJlc3BvbnNlID0gdm9pZCAwICE9PSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2UgJiYgbnVsbCAhPT0gbzIuZGVsZWdhdGlvblJlc3BvbnNlID8gRGVsZWdhdGlvblJlc3BvbnNlLmZyb21QYXJ0aWFsKG8yLmRlbGVnYXRpb25SZXNwb25zZSkgOiB2b2lkIDAsIGUyO1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IFF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlXCIsIHZhbHVlOiBRdWVyeURlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0XCIsIGVuY29kZTogKG8yLCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG8yLmRlbGVnYXRvckFkZHIgJiYgZTIudWludDMyKDEwKS5zdHJpbmcobzIuZGVsZWdhdG9yQWRkciksIFwiXCIgIT09IG8yLnZhbGlkYXRvckFkZHIgJiYgZTIudWludDMyKDE4KS5zdHJpbmcobzIudmFsaWRhdG9yQWRkciksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCB0NSA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSBlMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIGUyO1xuICBjb25zdCBhMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgdmFsaWRhdG9yQWRkcjogXCJcIiB9O1xuICBmb3IgKDsgdDUucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IG8zID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBhMi5kZWxlZ2F0b3JBZGRyID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBhMi52YWxpZGF0b3JBZGRyID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGEyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVsZWdhdG9yQWRkcjogaXNTZXQobzIuZGVsZWdhdG9yQWRkcikgPyBTdHJpbmcobzIuZGVsZWdhdG9yQWRkcikgOiBcIlwiLCB2YWxpZGF0b3JBZGRyOiBpc1NldChvMi52YWxpZGF0b3JBZGRyKSA/IFN0cmluZyhvMi52YWxpZGF0b3JBZGRyKSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZWxlZ2F0b3JBZGRyICYmIChlMi5kZWxlZ2F0b3JBZGRyID0gbzIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gbzIudmFsaWRhdG9yQWRkciAmJiAoZTIudmFsaWRhdG9yQWRkciA9IG8yLnZhbGlkYXRvckFkZHIpLCBlMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IGUyID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCB2YWxpZGF0b3JBZGRyOiBcIlwiIH07XG4gIHJldHVybiBlMi5kZWxlZ2F0b3JBZGRyID0gbzIuZGVsZWdhdG9yQWRkciA/PyBcIlwiLCBlMi52YWxpZGF0b3JBZGRyID0gbzIudmFsaWRhdG9yQWRkciA/PyBcIlwiLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0LmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBjKCkge1xuICByZXR1cm4geyB1bmJvbmQ6IFVuYm9uZGluZ0RlbGVnYXRpb24uZnJvbVBhcnRpYWwoe30pIH07XG59XG52YXIgUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVzcG9uc2VcIiwgZW5jb2RlOiAobzIsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodm9pZCAwICE9PSBvMi51bmJvbmQgJiYgVW5ib25kaW5nRGVsZWdhdGlvbi5lbmNvZGUobzIudW5ib25kLCBlMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCB0NSA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSBlMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIGUyO1xuICBjb25zdCBpMyA9IGMoKTtcbiAgZm9yICg7IHQ1LnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBvMyA9IHQ1LnVpbnQzMigpO1xuICAgIGlmIChvMyA+Pj4gMyA9PSAxKSBpMy51bmJvbmQgPSBVbmJvbmRpbmdEZWxlZ2F0aW9uLmRlY29kZSh0NSwgdDUudWludDMyKCkpO1xuICAgIGVsc2UgdDUuc2tpcFR5cGUoNyAmIG8zKTtcbiAgfVxuICByZXR1cm4gaTM7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyB1bmJvbmQ6IGlzU2V0KG8yLnVuYm9uZCkgPyBVbmJvbmRpbmdEZWxlZ2F0aW9uLmZyb21KU09OKG8yLnVuYm9uZCkgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi51bmJvbmQgJiYgKGUyLnVuYm9uZCA9IG8yLnVuYm9uZCA/IFVuYm9uZGluZ0RlbGVnYXRpb24udG9KU09OKG8yLnVuYm9uZCkgOiB2b2lkIDApLCBlMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IGUyID0gYygpO1xuICByZXR1cm4gZTIudW5ib25kID0gdm9pZCAwICE9PSBvMi51bmJvbmQgJiYgbnVsbCAhPT0gbzIudW5ib25kID8gVW5ib25kaW5nRGVsZWdhdGlvbi5mcm9tUGFydGlhbChvMi51bmJvbmQpIDogdm9pZCAwLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZS5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHIgJiYgdDUudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiBQYWdlUmVxdWVzdC5lbmNvZGUoZTIucGFnaW5hdGlvbiwgdDUudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbjIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBhMiA9IHZvaWQgMCA9PT0gdDUgPyBuMi5sZW4gOiBuMi5wb3MgKyB0NTtcbiAgY29uc3QgaTMgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgbjIucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IGUzID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMy5kZWxlZ2F0b3JBZGRyID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMy5wYWdpbmF0aW9uID0gUGFnZVJlcXVlc3QuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkzO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcjogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcikgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcikgOiBcIlwiLCBwYWdpbmF0aW9uOiBpc1NldChlMi5wYWdpbmF0aW9uKSA/IFBhZ2VSZXF1ZXN0LmZyb21KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkciAmJiAodDUuZGVsZWdhdG9yQWRkciA9IGUyLmRlbGVnYXRvckFkZHIpLCB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgKHQ1LnBhZ2luYXRpb24gPSBlMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QudG9KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyID0gZTIuZGVsZWdhdG9yQWRkciA/PyBcIlwiLCB0NS5wYWdpbmF0aW9uID0gdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIG51bGwgIT09IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC5mcm9tUGFydGlhbChlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3QuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0LmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlXCIsIGVuY29kZShvMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBlMiBvZiBvMi5kZWxlZ2F0aW9uUmVzcG9uc2VzKSBEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKGUyLCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgUGFnZVJlc3BvbnNlLmVuY29kZShvMi5wYWdpbmF0aW9uLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1O1xufSwgZGVjb2RlKG8yLCB0NSkge1xuICBjb25zdCBhMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IGkzID0gdm9pZCAwID09PSB0NSA/IGEyLmxlbiA6IGEyLnBvcyArIHQ1O1xuICBjb25zdCByNSA9IHsgZGVsZWdhdGlvblJlc3BvbnNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgYTIucG9zIDwgaTM7ICkge1xuICAgIGNvbnN0IG8zID0gYTIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5kZWxlZ2F0aW9uUmVzcG9uc2VzLnB1c2goRGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShhMiwgYTIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LnBhZ2luYXRpb24gPSBQYWdlUmVzcG9uc2UuZGVjb2RlKGEyLCBhMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYTIuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVsZWdhdGlvblJlc3BvbnNlczogQXJyYXkuaXNBcnJheShvMj8uZGVsZWdhdGlvblJlc3BvbnNlcykgPyBvMi5kZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcCgobzMpID0+IERlbGVnYXRpb25SZXNwb25zZS5mcm9tSlNPTihvMykpIDogW10sIHBhZ2luYXRpb246IGlzU2V0KG8yLnBhZ2luYXRpb24pID8gUGFnZVJlc3BvbnNlLmZyb21KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIG8yLmRlbGVnYXRpb25SZXNwb25zZXMgPyB0NS5kZWxlZ2F0aW9uUmVzcG9uc2VzID0gbzIuZGVsZWdhdGlvblJlc3BvbnNlcy5tYXAoKG8zKSA9PiBvMyA/IERlbGVnYXRpb25SZXNwb25zZS50b0pTT04obzMpIDogdm9pZCAwKSA6IHQ1LmRlbGVnYXRpb25SZXNwb25zZXMgPSBbXSwgdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmICh0NS5wYWdpbmF0aW9uID0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS50b0pTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0aW9uUmVzcG9uc2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0aW9uUmVzcG9uc2VzID0gbzIuZGVsZWdhdGlvblJlc3BvbnNlcz8ubWFwKChvMykgPT4gRGVsZWdhdGlvblJlc3BvbnNlLmZyb21QYXJ0aWFsKG8zKSkgfHwgW10sIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS5mcm9tUGFydGlhbChvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1JlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1JlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkciAmJiB0NS51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXF1ZXN0LmVuY29kZShlMi5wYWdpbmF0aW9uLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSB0NSA/IG4yLmxlbiA6IG4yLnBvcyArIHQ1O1xuICBjb25zdCBpMyA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyBuMi5wb3MgPCBhMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkzLmRlbGVnYXRvckFkZHIgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkzLnBhZ2luYXRpb24gPSBQYWdlUmVxdWVzdC5kZWNvZGUobjIsIG4yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTM7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSA6IFwiXCIsIHBhZ2luYXRpb246IGlzU2V0KGUyLnBhZ2luYXRpb24pID8gUGFnZVJlcXVlc3QuZnJvbUpTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyICYmICh0NS5kZWxlZ2F0b3JBZGRyID0gZTIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiAodDUucGFnaW5hdGlvbiA9IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC50b0pTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIHQ1LmRlbGVnYXRvckFkZHIgPSBlMi5kZWxlZ2F0b3JBZGRyID8/IFwiXCIsIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXF1ZXN0LmZyb21QYXJ0aWFsKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXF1ZXN0LmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2VcIiwgZW5jb2RlKG8yLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IGUyIG9mIG8yLnVuYm9uZGluZ1Jlc3BvbnNlcykgVW5ib25kaW5nRGVsZWdhdGlvbi5lbmNvZGUoZTIsIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBQYWdlUmVzcG9uc2UuZW5jb2RlKG8yLnBhZ2luYXRpb24sIHQ1LnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgdDU7XG59LCBkZWNvZGUobzIsIHQ1KSB7XG4gIGNvbnN0IG4yID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgaTMgPSB2b2lkIDAgPT09IHQ1ID8gbjIubGVuIDogbjIucG9zICsgdDU7XG4gIGNvbnN0IHI1ID0geyB1bmJvbmRpbmdSZXNwb25zZXM6IFtdLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgZm9yICg7IG4yLnBvcyA8IGkzOyApIHtcbiAgICBjb25zdCBvMyA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjUudW5ib25kaW5nUmVzcG9uc2VzLnB1c2goVW5ib25kaW5nRGVsZWdhdGlvbi5kZWNvZGUobjIsIG4yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNS5wYWdpbmF0aW9uID0gUGFnZVJlc3BvbnNlLmRlY29kZShuMiwgbjIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IHVuYm9uZGluZ1Jlc3BvbnNlczogQXJyYXkuaXNBcnJheShvMj8udW5ib25kaW5nUmVzcG9uc2VzKSA/IG8yLnVuYm9uZGluZ1Jlc3BvbnNlcy5tYXAoKG8zKSA9PiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmZyb21KU09OKG8zKSkgOiBbXSwgcGFnaW5hdGlvbjogaXNTZXQobzIucGFnaW5hdGlvbikgPyBQYWdlUmVzcG9uc2UuZnJvbUpTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gbzIudW5ib25kaW5nUmVzcG9uc2VzID8gdDUudW5ib25kaW5nUmVzcG9uc2VzID0gbzIudW5ib25kaW5nUmVzcG9uc2VzLm1hcCgobzMpID0+IG8zID8gVW5ib25kaW5nRGVsZWdhdGlvbi50b0pTT04obzMpIDogdm9pZCAwKSA6IHQ1LnVuYm9uZGluZ1Jlc3BvbnNlcyA9IFtdLCB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgKHQ1LnBhZ2luYXRpb24gPSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLnRvSlNPTihvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCksIHQ1O1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgdDUgPSB7IHVuYm9uZGluZ1Jlc3BvbnNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICByZXR1cm4gdDUudW5ib25kaW5nUmVzcG9uc2VzID0gbzIudW5ib25kaW5nUmVzcG9uc2VzPy5tYXAoKG8zKSA9PiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmZyb21QYXJ0aWFsKG8zKSkgfHwgW10sIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS5mcm9tUGFydGlhbChvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1Jlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVJlZGVsZWdhdGlvbnNSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHIgJiYgdDUudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkciksIFwiXCIgIT09IGUyLnNyY1ZhbGlkYXRvckFkZHIgJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIuc3JjVmFsaWRhdG9yQWRkciksIFwiXCIgIT09IGUyLmRzdFZhbGlkYXRvckFkZHIgJiYgdDUudWludDMyKDI2KS5zdHJpbmcoZTIuZHN0VmFsaWRhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiBQYWdlUmVxdWVzdC5lbmNvZGUoZTIucGFnaW5hdGlvbiwgdDUudWludDMyKDM0KS5mb3JrKCkpLmxkZWxpbSgpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbjIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBhMiA9IHZvaWQgMCA9PT0gdDUgPyBuMi5sZW4gOiBuMi5wb3MgKyB0NTtcbiAgY29uc3QgaTMgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHNyY1ZhbGlkYXRvckFkZHI6IFwiXCIsIGRzdFZhbGlkYXRvckFkZHI6IFwiXCIsIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgbjIucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IGUzID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMy5kZWxlZ2F0b3JBZGRyID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMy5zcmNWYWxpZGF0b3JBZGRyID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBpMy5kc3RWYWxpZGF0b3JBZGRyID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBpMy5wYWdpbmF0aW9uID0gUGFnZVJlcXVlc3QuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkzO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcjogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcikgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcikgOiBcIlwiLCBzcmNWYWxpZGF0b3JBZGRyOiBpc1NldChlMi5zcmNWYWxpZGF0b3JBZGRyKSA/IFN0cmluZyhlMi5zcmNWYWxpZGF0b3JBZGRyKSA6IFwiXCIsIGRzdFZhbGlkYXRvckFkZHI6IGlzU2V0KGUyLmRzdFZhbGlkYXRvckFkZHIpID8gU3RyaW5nKGUyLmRzdFZhbGlkYXRvckFkZHIpIDogXCJcIiwgcGFnaW5hdGlvbjogaXNTZXQoZTIucGFnaW5hdGlvbikgPyBQYWdlUmVxdWVzdC5mcm9tSlNPTihlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHIgJiYgKHQ1LmRlbGVnYXRvckFkZHIgPSBlMi5kZWxlZ2F0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5zcmNWYWxpZGF0b3JBZGRyICYmICh0NS5zcmNWYWxpZGF0b3JBZGRyID0gZTIuc3JjVmFsaWRhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIuZHN0VmFsaWRhdG9yQWRkciAmJiAodDUuZHN0VmFsaWRhdG9yQWRkciA9IGUyLmRzdFZhbGlkYXRvckFkZHIpLCB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgKHQ1LnBhZ2luYXRpb24gPSBlMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QudG9KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgc3JjVmFsaWRhdG9yQWRkcjogXCJcIiwgZHN0VmFsaWRhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyID0gZTIuZGVsZWdhdG9yQWRkciA/PyBcIlwiLCB0NS5zcmNWYWxpZGF0b3JBZGRyID0gZTIuc3JjVmFsaWRhdG9yQWRkciA/PyBcIlwiLCB0NS5kc3RWYWxpZGF0b3JBZGRyID0gZTIuZHN0VmFsaWRhdG9yQWRkciA/PyBcIlwiLCB0NS5wYWdpbmF0aW9uID0gdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIG51bGwgIT09IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC5mcm9tUGFydGlhbChlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlXCIsIGVuY29kZShvMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBlMiBvZiBvMi5yZWRlbGVnYXRpb25SZXNwb25zZXMpIFJlZGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShlMiwgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXNwb25zZS5lbmNvZGUobzIucGFnaW5hdGlvbiwgdDUudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCB0NTtcbn0sIGRlY29kZShvMiwgdDUpIHtcbiAgY29uc3QgbjIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBhMiA9IHZvaWQgMCA9PT0gdDUgPyBuMi5sZW4gOiBuMi5wb3MgKyB0NTtcbiAgY29uc3QgcjUgPSB7IHJlZGVsZWdhdGlvblJlc3BvbnNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgbjIucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IG8zID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5yZWRlbGVnYXRpb25SZXNwb25zZXMucHVzaChSZWRlbGVnYXRpb25SZXNwb25zZS5kZWNvZGUobjIsIG4yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNS5wYWdpbmF0aW9uID0gUGFnZVJlc3BvbnNlLmRlY29kZShuMiwgbjIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IHJlZGVsZWdhdGlvblJlc3BvbnNlczogQXJyYXkuaXNBcnJheShvMj8ucmVkZWxlZ2F0aW9uUmVzcG9uc2VzKSA/IG8yLnJlZGVsZWdhdGlvblJlc3BvbnNlcy5tYXAoKG8zKSA9PiBSZWRlbGVnYXRpb25SZXNwb25zZS5mcm9tSlNPTihvMykpIDogW10sIHBhZ2luYXRpb246IGlzU2V0KG8yLnBhZ2luYXRpb24pID8gUGFnZVJlc3BvbnNlLmZyb21KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIG8yLnJlZGVsZWdhdGlvblJlc3BvbnNlcyA/IHQ1LnJlZGVsZWdhdGlvblJlc3BvbnNlcyA9IG8yLnJlZGVsZWdhdGlvblJlc3BvbnNlcy5tYXAoKG8zKSA9PiBvMyA/IFJlZGVsZWdhdGlvblJlc3BvbnNlLnRvSlNPTihvMykgOiB2b2lkIDApIDogdDUucmVkZWxlZ2F0aW9uUmVzcG9uc2VzID0gW10sIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiAodDUucGFnaW5hdGlvbiA9IG8yLnBhZ2luYXRpb24gPyBQYWdlUmVzcG9uc2UudG9KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiB0NS5yZWRlbGVnYXRpb25SZXNwb25zZXMgPSBvMi5yZWRlbGVnYXRpb25SZXNwb25zZXM/Lm1hcCgobzMpID0+IFJlZGVsZWdhdGlvblJlc3BvbnNlLmZyb21QYXJ0aWFsKG8zKSkgfHwgW10sIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS5mcm9tUGFydGlhbChvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2UuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeVJlZGVsZWdhdGlvbnNSZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbmZ1bmN0aW9uIHYoKSB7XG4gIHJldHVybiB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIGFtb3VudDogQ29pbi5mcm9tUGFydGlhbCh7fSkgfTtcbn1cbnZhciBNc2dEZWxlZ2F0ZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dEZWxlZ2F0ZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBDb2luLmVuY29kZShlMi5hbW91bnQsIG8yLnVpbnQzMigyNikuZm9yaygpKS5sZGVsaW0oKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgczMgPSB2b2lkIDAgPT09IG8yID8gdDUubGVuIDogdDUucG9zICsgbzI7XG4gIGNvbnN0IGkzID0gdigpO1xuICBmb3IgKDsgdDUucG9zIDwgczM7ICkge1xuICAgIGNvbnN0IGUzID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMy5kZWxlZ2F0b3JBZGRyZXNzID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMy52YWxpZGF0b3JBZGRyZXNzID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBpMy5hbW91bnQgPSBDb2luLmRlY29kZSh0NSwgdDUudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHQ1LnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMztcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcykgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KGUyLmFtb3VudCkgPyBDb2luLmZyb21KU09OKGUyLmFtb3VudCkgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIChvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiAobzIudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiAobzIuYW1vdW50ID0gZTIuYW1vdW50ID8gQ29pbi50b0pTT04oZTIuYW1vdW50KSA6IHZvaWQgMCksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB2KCk7XG4gIHJldHVybiBvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi5hbW91bnQgPSB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBudWxsICE9PSBlMi5hbW91bnQgPyBDb2luLmZyb21QYXJ0aWFsKGUyLmFtb3VudCkgOiB2b2lkIDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ0RlbGVnYXRlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gTXNnRGVsZWdhdGUuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ0RlbGVnYXRlXCIsIHZhbHVlOiBNc2dEZWxlZ2F0ZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBwMigpIHtcbiAgcmV0dXJuIHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yU3JjQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yRHN0QWRkcmVzczogXCJcIiwgYW1vdW50OiBDb2luLmZyb21QYXJ0aWFsKHt9KSB9O1xufVxudmFyIE1zZ0JlZ2luUmVkZWxlZ2F0ZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dCZWdpblJlZGVsZWdhdGVcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgXCJcIiAhPT0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyAmJiBvMi51aW50MzIoMTgpLnN0cmluZyhlMi52YWxpZGF0b3JTcmNBZGRyZXNzKSwgXCJcIiAhPT0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyAmJiBvMi51aW50MzIoMjYpLnN0cmluZyhlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgQ29pbi5lbmNvZGUoZTIuYW1vdW50LCBvMi51aW50MzIoMzQpLmZvcmsoKSkubGRlbGltKCksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCB0NSA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHMzID0gdm9pZCAwID09PSBvMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIG8yO1xuICBjb25zdCBpMyA9IHAyKCk7XG4gIGZvciAoOyB0NS5wb3MgPCBzMzsgKSB7XG4gICAgY29uc3QgZTMgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkzLmRlbGVnYXRvckFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkzLnZhbGlkYXRvclNyY0FkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGkzLnZhbGlkYXRvckRzdEFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGkzLmFtb3VudCA9IENvaW4uZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkzO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JTcmNBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JTcmNBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JTcmNBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckRzdEFkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpIDogXCJcIiwgYW1vdW50OiBpc1NldChlMi5hbW91bnQpID8gQ29pbi5mcm9tSlNPTihlMi5hbW91bnQpIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiAobzIuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvclNyY0FkZHJlc3MgJiYgKG8yLnZhbGlkYXRvclNyY0FkZHJlc3MgPSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzICYmIChvMi52YWxpZGF0b3JEc3RBZGRyZXNzID0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyksIHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIChvMi5hbW91bnQgPSBlMi5hbW91bnQgPyBDb2luLnRvSlNPTihlMi5hbW91bnQpIDogdm9pZCAwKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHAyKCk7XG4gIHJldHVybiBvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JTcmNBZGRyZXNzID0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JEc3RBZGRyZXNzID0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyA/PyBcIlwiLCBvMi5hbW91bnQgPSB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBudWxsICE9PSBlMi5hbW91bnQgPyBDb2luLmZyb21QYXJ0aWFsKGUyLmFtb3VudCkgOiB2b2lkIDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ0JlZ2luUmVkZWxlZ2F0ZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IE1zZ0JlZ2luUmVkZWxlZ2F0ZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnQmVnaW5SZWRlbGVnYXRlXCIsIHZhbHVlOiBNc2dCZWdpblJlZGVsZWdhdGUuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gQTIoKSB7XG4gIHJldHVybiB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIGFtb3VudDogQ29pbi5mcm9tUGFydGlhbCh7fSkgfTtcbn1cbnZhciBNc2dVbmRlbGVnYXRlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ1VuZGVsZWdhdGVcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgXCJcIiAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTgpLnN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgQ29pbi5lbmNvZGUoZTIuYW1vdW50LCBvMi51aW50MzIoMjYpLmZvcmsoKSkubGRlbGltKCksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCB0NSA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHMzID0gdm9pZCAwID09PSBvMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIG8yO1xuICBjb25zdCBpMyA9IEEyKCk7XG4gIGZvciAoOyB0NS5wb3MgPCBzMzsgKSB7XG4gICAgY29uc3QgZTMgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkzLmRlbGVnYXRvckFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkzLnZhbGlkYXRvckFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGkzLmFtb3VudCA9IENvaW4uZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkzO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIsIGFtb3VudDogaXNTZXQoZTIuYW1vdW50KSA/IENvaW4uZnJvbUpTT04oZTIuYW1vdW50KSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIChvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIChvMi5hbW91bnQgPSBlMi5hbW91bnQgPyBDb2luLnRvSlNPTihlMi5hbW91bnQpIDogdm9pZCAwKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IEEyKCk7XG4gIHJldHVybiBvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi5hbW91bnQgPSB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBudWxsICE9PSBlMi5hbW91bnQgPyBDb2luLmZyb21QYXJ0aWFsKGUyLmFtb3VudCkgOiB2b2lkIDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ1VuZGVsZWdhdGUuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBNc2dVbmRlbGVnYXRlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dVbmRlbGVnYXRlXCIsIHZhbHVlOiBNc2dVbmRlbGVnYXRlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIE0yKCkge1xuICByZXR1cm4geyBjb21wbGV0aW9uVGltZTogVGltZXN0YW1wLmZyb21QYXJ0aWFsKHt9KSB9O1xufVxudmFyIE1zZ1VuZGVsZWdhdGVSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dVbmRlbGVnYXRlUmVzcG9uc2VcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBUaW1lc3RhbXAuZW5jb2RlKGUyLmNvbXBsZXRpb25UaW1lLCBvMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCB0NSA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHMzID0gdm9pZCAwID09PSBvMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIG8yO1xuICBjb25zdCByNSA9IE0yKCk7XG4gIGZvciAoOyB0NS5wb3MgPCBzMzsgKSB7XG4gICAgY29uc3QgZTMgPSB0NS51aW50MzIoKTtcbiAgICBpZiAoZTMgPj4+IDMgPT0gMSkgcjUuY29tcGxldGlvblRpbWUgPSBUaW1lc3RhbXAuZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgZWxzZSB0NS5za2lwVHlwZSg3ICYgZTMpO1xuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGNvbXBsZXRpb25UaW1lOiBpc1NldChlMi5jb21wbGV0aW9uVGltZSkgPyBmcm9tSnNvblRpbWVzdGFtcChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiAobzIuY29tcGxldGlvblRpbWUgPSBmcm9tVGltZXN0YW1wKGUyLmNvbXBsZXRpb25UaW1lKS50b0lTT1N0cmluZygpKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IE0yKCk7XG4gIHJldHVybiBvMi5jb21wbGV0aW9uVGltZSA9IHZvaWQgMCAhPT0gZTIuY29tcGxldGlvblRpbWUgJiYgbnVsbCAhPT0gZTIuY29tcGxldGlvblRpbWUgPyBUaW1lc3RhbXAuZnJvbVBhcnRpYWwoZTIuY29tcGxldGlvblRpbWUpIDogdm9pZCAwLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBNc2dVbmRlbGVnYXRlUmVzcG9uc2UuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBNc2dVbmRlbGVnYXRlUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ1VuZGVsZWdhdGVSZXNwb25zZVwiLCB2YWx1ZTogTXNnVW5kZWxlZ2F0ZVJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbmZ1bmN0aW9uIGwyKCkge1xuICByZXR1cm4geyByZXZpc2lvbk51bWJlcjogQmlnSW50KDApLCByZXZpc2lvbkhlaWdodDogQmlnSW50KDApIH07XG59XG52YXIgSGVpZ2h0ID0geyB0eXBlVXJsOiBcIi9pYmMuY29yZS5jbGllbnQudjEuSGVpZ2h0XCIsIGVuY29kZTogKHQ1LCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHQ1LnJldmlzaW9uTnVtYmVyICE9PSBCaWdJbnQoMCkgJiYgZTIudWludDMyKDgpLnVpbnQ2NCh0NS5yZXZpc2lvbk51bWJlciksIHQ1LnJldmlzaW9uSGVpZ2h0ICE9PSBCaWdJbnQoMCkgJiYgZTIudWludDMyKDE2KS51aW50NjQodDUucmV2aXNpb25IZWlnaHQpLCBlMiksIGRlY29kZSh0NSwgZTIpIHtcbiAgY29uc3QgbjIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBvMiA9IHZvaWQgMCA9PT0gZTIgPyBuMi5sZW4gOiBuMi5wb3MgKyBlMjtcbiAgY29uc3QgczMgPSBsMigpO1xuICBmb3IgKDsgbjIucG9zIDwgbzI7ICkge1xuICAgIGNvbnN0IHQ2ID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoICh0NiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzMy5yZXZpc2lvbk51bWJlciA9IG4yLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgczMucmV2aXNpb25IZWlnaHQgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgdDYpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gczM7XG59LCBmcm9tSlNPTjogKHQ1KSA9PiAoeyByZXZpc2lvbk51bWJlcjogaXNTZXQodDUucmV2aXNpb25OdW1iZXIpID8gQmlnSW50KHQ1LnJldmlzaW9uTnVtYmVyLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCByZXZpc2lvbkhlaWdodDogaXNTZXQodDUucmV2aXNpb25IZWlnaHQpID8gQmlnSW50KHQ1LnJldmlzaW9uSGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApIH0pLCB0b0pTT04odDUpIHtcbiAgY29uc3QgZTIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gdDUucmV2aXNpb25OdW1iZXIgJiYgKGUyLnJldmlzaW9uTnVtYmVyID0gKHQ1LnJldmlzaW9uTnVtYmVyIHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gdDUucmV2aXNpb25IZWlnaHQgJiYgKGUyLnJldmlzaW9uSGVpZ2h0ID0gKHQ1LnJldmlzaW9uSGVpZ2h0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIGUyO1xufSwgZnJvbVBhcnRpYWwodDUpIHtcbiAgY29uc3QgZTIgPSBsMigpO1xuICByZXR1cm4gZTIucmV2aXNpb25OdW1iZXIgPSB2b2lkIDAgIT09IHQ1LnJldmlzaW9uTnVtYmVyICYmIG51bGwgIT09IHQ1LnJldmlzaW9uTnVtYmVyID8gQmlnSW50KHQ1LnJldmlzaW9uTnVtYmVyLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBlMi5yZXZpc2lvbkhlaWdodCA9IHZvaWQgMCAhPT0gdDUucmV2aXNpb25IZWlnaHQgJiYgbnVsbCAhPT0gdDUucmV2aXNpb25IZWlnaHQgPyBCaWdJbnQodDUucmV2aXNpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGUyO1xufSwgZnJvbVByb3RvTXNnOiAodDUpID0+IEhlaWdodC5kZWNvZGUodDUudmFsdWUpLCB0b1Byb3RvOiAodDUpID0+IEhlaWdodC5lbmNvZGUodDUpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAodDUpID0+ICh7IHR5cGVVcmw6IFwiL2liYy5jb3JlLmNsaWVudC52MS5IZWlnaHRcIiwgdmFsdWU6IEhlaWdodC5lbmNvZGUodDUpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG5mdW5jdGlvbiBpKCkge1xuICByZXR1cm4geyBzb3VyY2VQb3J0OiBcIlwiLCBzb3VyY2VDaGFubmVsOiBcIlwiLCB0b2tlbjogQ29pbi5mcm9tUGFydGlhbCh7fSksIHNlbmRlcjogXCJcIiwgcmVjZWl2ZXI6IFwiXCIsIHRpbWVvdXRIZWlnaHQ6IEhlaWdodC5mcm9tUGFydGlhbCh7fSksIHRpbWVvdXRUaW1lc3RhbXA6IEJpZ0ludCgwKSwgbWVtbzogXCJcIiB9O1xufVxudmFyIE1zZ1RyYW5zZmVyID0geyB0eXBlVXJsOiBcIi9pYmMuYXBwbGljYXRpb25zLnRyYW5zZmVyLnYxLk1zZ1RyYW5zZmVyXCIsIGVuY29kZTogKG8yLCBuMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG8yLnNvdXJjZVBvcnQgJiYgbjIudWludDMyKDEwKS5zdHJpbmcobzIuc291cmNlUG9ydCksIFwiXCIgIT09IG8yLnNvdXJjZUNoYW5uZWwgJiYgbjIudWludDMyKDE4KS5zdHJpbmcobzIuc291cmNlQ2hhbm5lbCksIHZvaWQgMCAhPT0gbzIudG9rZW4gJiYgQ29pbi5lbmNvZGUobzIudG9rZW4sIG4yLnVpbnQzMigyNikuZm9yaygpKS5sZGVsaW0oKSwgXCJcIiAhPT0gbzIuc2VuZGVyICYmIG4yLnVpbnQzMigzNCkuc3RyaW5nKG8yLnNlbmRlciksIFwiXCIgIT09IG8yLnJlY2VpdmVyICYmIG4yLnVpbnQzMig0Mikuc3RyaW5nKG8yLnJlY2VpdmVyKSwgdm9pZCAwICE9PSBvMi50aW1lb3V0SGVpZ2h0ICYmIEhlaWdodC5lbmNvZGUobzIudGltZW91dEhlaWdodCwgbjIudWludDMyKDUwKS5mb3JrKCkpLmxkZWxpbSgpLCBvMi50aW1lb3V0VGltZXN0YW1wICE9PSBCaWdJbnQoMCkgJiYgbjIudWludDMyKDU2KS51aW50NjQobzIudGltZW91dFRpbWVzdGFtcCksIFwiXCIgIT09IG8yLm1lbW8gJiYgbjIudWludDMyKDY2KS5zdHJpbmcobzIubWVtbyksIG4yKSwgZGVjb2RlKHI1LCBuMikge1xuICBjb25zdCBzMyA9IHI1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gcjUgOiBuZXcgQmluYXJ5UmVhZGVyKHI1KTtcbiAgbGV0IG0yID0gdm9pZCAwID09PSBuMiA/IHMzLmxlbiA6IHMzLnBvcyArIG4yO1xuICBjb25zdCBjMiA9IGkoKTtcbiAgZm9yICg7IHMzLnBvcyA8IG0yOyApIHtcbiAgICBjb25zdCBvMiA9IHMzLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzIgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgYzIuc291cmNlUG9ydCA9IHMzLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgYzIuc291cmNlQ2hhbm5lbCA9IHMzLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgYzIudG9rZW4gPSBDb2luLmRlY29kZShzMywgczMudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgYzIuc2VuZGVyID0gczMuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA1OlxuICAgICAgICBjMi5yZWNlaXZlciA9IHMzLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNjpcbiAgICAgICAgYzIudGltZW91dEhlaWdodCA9IEhlaWdodC5kZWNvZGUoczMsIHMzLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDc6XG4gICAgICAgIGMyLnRpbWVvdXRUaW1lc3RhbXAgPSBzMy51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDg6XG4gICAgICAgIGMyLm1lbW8gPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBzMy5za2lwVHlwZSg3ICYgbzIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYzI7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyBzb3VyY2VQb3J0OiBpc1NldChvMi5zb3VyY2VQb3J0KSA/IFN0cmluZyhvMi5zb3VyY2VQb3J0KSA6IFwiXCIsIHNvdXJjZUNoYW5uZWw6IGlzU2V0KG8yLnNvdXJjZUNoYW5uZWwpID8gU3RyaW5nKG8yLnNvdXJjZUNoYW5uZWwpIDogXCJcIiwgdG9rZW46IGlzU2V0KG8yLnRva2VuKSA/IENvaW4uZnJvbUpTT04obzIudG9rZW4pIDogdm9pZCAwLCBzZW5kZXI6IGlzU2V0KG8yLnNlbmRlcikgPyBTdHJpbmcobzIuc2VuZGVyKSA6IFwiXCIsIHJlY2VpdmVyOiBpc1NldChvMi5yZWNlaXZlcikgPyBTdHJpbmcobzIucmVjZWl2ZXIpIDogXCJcIiwgdGltZW91dEhlaWdodDogaXNTZXQobzIudGltZW91dEhlaWdodCkgPyBIZWlnaHQuZnJvbUpTT04obzIudGltZW91dEhlaWdodCkgOiB2b2lkIDAsIHRpbWVvdXRUaW1lc3RhbXA6IGlzU2V0KG8yLnRpbWVvdXRUaW1lc3RhbXApID8gQmlnSW50KG8yLnRpbWVvdXRUaW1lc3RhbXAudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG1lbW86IGlzU2V0KG8yLm1lbW8pID8gU3RyaW5nKG8yLm1lbW8pIDogXCJcIiB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IHI1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLnNvdXJjZVBvcnQgJiYgKHI1LnNvdXJjZVBvcnQgPSBvMi5zb3VyY2VQb3J0KSwgdm9pZCAwICE9PSBvMi5zb3VyY2VDaGFubmVsICYmIChyNS5zb3VyY2VDaGFubmVsID0gbzIuc291cmNlQ2hhbm5lbCksIHZvaWQgMCAhPT0gbzIudG9rZW4gJiYgKHI1LnRva2VuID0gbzIudG9rZW4gPyBDb2luLnRvSlNPTihvMi50b2tlbikgOiB2b2lkIDApLCB2b2lkIDAgIT09IG8yLnNlbmRlciAmJiAocjUuc2VuZGVyID0gbzIuc2VuZGVyKSwgdm9pZCAwICE9PSBvMi5yZWNlaXZlciAmJiAocjUucmVjZWl2ZXIgPSBvMi5yZWNlaXZlciksIHZvaWQgMCAhPT0gbzIudGltZW91dEhlaWdodCAmJiAocjUudGltZW91dEhlaWdodCA9IG8yLnRpbWVvdXRIZWlnaHQgPyBIZWlnaHQudG9KU09OKG8yLnRpbWVvdXRIZWlnaHQpIDogdm9pZCAwKSwgdm9pZCAwICE9PSBvMi50aW1lb3V0VGltZXN0YW1wICYmIChyNS50aW1lb3V0VGltZXN0YW1wID0gKG8yLnRpbWVvdXRUaW1lc3RhbXAgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBvMi5tZW1vICYmIChyNS5tZW1vID0gbzIubWVtbyksIHI1O1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgcjUgPSBpKCk7XG4gIHJldHVybiByNS5zb3VyY2VQb3J0ID0gbzIuc291cmNlUG9ydCA/PyBcIlwiLCByNS5zb3VyY2VDaGFubmVsID0gbzIuc291cmNlQ2hhbm5lbCA/PyBcIlwiLCByNS50b2tlbiA9IHZvaWQgMCAhPT0gbzIudG9rZW4gJiYgbnVsbCAhPT0gbzIudG9rZW4gPyBDb2luLmZyb21QYXJ0aWFsKG8yLnRva2VuKSA6IHZvaWQgMCwgcjUuc2VuZGVyID0gbzIuc2VuZGVyID8/IFwiXCIsIHI1LnJlY2VpdmVyID0gbzIucmVjZWl2ZXIgPz8gXCJcIiwgcjUudGltZW91dEhlaWdodCA9IHZvaWQgMCAhPT0gbzIudGltZW91dEhlaWdodCAmJiBudWxsICE9PSBvMi50aW1lb3V0SGVpZ2h0ID8gSGVpZ2h0LmZyb21QYXJ0aWFsKG8yLnRpbWVvdXRIZWlnaHQpIDogdm9pZCAwLCByNS50aW1lb3V0VGltZXN0YW1wID0gdm9pZCAwICE9PSBvMi50aW1lb3V0VGltZXN0YW1wICYmIG51bGwgIT09IG8yLnRpbWVvdXRUaW1lc3RhbXAgPyBCaWdJbnQobzIudGltZW91dFRpbWVzdGFtcC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgcjUubWVtbyA9IG8yLm1lbW8gPz8gXCJcIiwgcjU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gTXNnVHJhbnNmZXIuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBNc2dUcmFuc2Zlci5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2liYy5hcHBsaWNhdGlvbnMudHJhbnNmZXIudjEuTXNnVHJhbnNmZXJcIiwgdmFsdWU6IE1zZ1RyYW5zZmVyLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBjb2VyY2VEZW5vbSA9IChjaGFpbkh1YiwgZGVub21BcmcpID0+IHtcbiAgaWYgKHR5cGVvZiBkZW5vbUFyZyA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiBkZW5vbUFyZztcbiAgfVxuICBjb25zdCBkZW5vbSA9IGNoYWluSHViLmdldERlbm9tKGRlbm9tQXJnKTtcbiAgaWYgKCFkZW5vbSkge1xuICAgIHRocm93IG1ha2VFcnJvcihgTm8gZGVub20gZm9yIGJyYW5kICR7ZGVub21Bcmd9YCk7XG4gIH1cbiAgcmV0dXJuIGRlbm9tO1xufTtcbnZhciBjb2VyY2VEZW5vbUFtb3VudCA9IChjaGFpbkh1YiwgYW1vdW50KSA9PiB7XG4gIGlmIChcImRlbm9tXCIgaW4gYW1vdW50KSB7XG4gICAgcmV0dXJuIGFtb3VudDtcbiAgfVxuICBjb25zdCBkZW5vbSA9IGNvZXJjZURlbm9tKGNoYWluSHViLCBhbW91bnQuYnJhbmQpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBkZW5vbSxcbiAgICB2YWx1ZTogYW1vdW50LnZhbHVlXG4gIH0pO1xufTtcbnZhciBjb2VyY2VDb2luID0gKGNoYWluSHViLCBhbW91bnQpID0+IHtcbiAgY29uc3QgZGVub20gPSBcImRlbm9tXCIgaW4gYW1vdW50ID8gYW1vdW50LmRlbm9tIDogY29lcmNlRGVub20oY2hhaW5IdWIsIGFtb3VudC5icmFuZCk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGRlbm9tLFxuICAgIGFtb3VudDogU3RyaW5nKGFtb3VudC52YWx1ZSlcbiAgfSk7XG59O1xuXG4vL1xudmFyIG1heENsb2NrU2tldyA9IDEwbiAqIDYwbjtcbnZhciB0cnlEZWNvZGVSZXNwb25zZSA9IChhY2tTdHIsIGZyb21Qcm90b01zZykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGFueSA9IEFueS5kZWNvZGUoZGVjb2RlQmFzZTY0KGFja1N0cikpO1xuICAgIGNvbnN0IHByb3RvTXNnID0gQW55LmRlY29kZShhbnkudmFsdWUpO1xuICAgIGNvbnN0IG1zZyA9IGZyb21Qcm90b01zZyhwcm90b01zZyk7XG4gICAgcmV0dXJuIG1zZztcbiAgfSBjYXRjaCAoY2F1c2UpIHtcbiAgICB0aHJvdyBtYWtlRXJyb3IoYGJhZCByZXNwb25zZTogJHthY2tTdHJ9YCwgdm9pZCAwLCB7IGNhdXNlIH0pO1xuICB9XG59O1xudmFyIHRvRGVub21BbW91bnQgPSAoYzIpID0+ICh7IGRlbm9tOiBjMi5kZW5vbSwgdmFsdWU6IEJpZ0ludChjMi5hbW91bnQpIH0pO1xudmFyIHRvVHJ1bmNhdGVkRGVub21BbW91bnQgPSAoYzIpID0+ICh7XG4gIGRlbm9tOiBjMi5kZW5vbSxcbiAgdmFsdWU6IEJpZ0ludChjMi5hbW91bnQuc3BsaXQoXCIuXCIpWzBdKVxufSk7XG52YXIgdG9Db3Ntb3NWYWxpZGF0b3JBZGRyZXNzID0gKHI1LCBjaGFpbklkKSA9PiAoe1xuICBlbmNvZGluZzogXCJiZWNoMzJcIixcbiAgdmFsdWU6IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgcjUudmFsaWRhdG9yQWRkcmVzc1xuICApLFxuICBjaGFpbklkXG59KTtcbnZhciB0b0Nvc21vc0RlbGVnYXRpb25SZXNwb25zZSA9ICh7IGNoYWluSWQgfSwgcjUpID0+ICh7XG4gIGRlbGVnYXRvcjoge1xuICAgIGNoYWluSWQsXG4gICAgZW5jb2Rpbmc6IFwiYmVjaDMyXCIsXG4gICAgdmFsdWU6IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHI1LmRlbGVnYXRpb24uZGVsZWdhdG9yQWRkcmVzc1xuICAgIClcbiAgfSxcbiAgdmFsaWRhdG9yOiB0b0Nvc21vc1ZhbGlkYXRvckFkZHJlc3MocjUuZGVsZWdhdGlvbiwgY2hhaW5JZCksXG4gIGFtb3VudDogdG9EZW5vbUFtb3VudChyNS5iYWxhbmNlKVxufSk7XG5cbi8vXG52YXIgZW1wdHkgPSAwbjtcbnZhciBuYXRNYXRoSGVscGVycyA9IGhhcmRlbih7XG4gIGRvQ29lcmNlOiAobmF0KSA9PiB7XG4gICAgYXNzZXJ0LnR5cGVvZihuYXQsIFwiYmlnaW50XCIpO1xuICAgIGlzTmF0KG5hdCkgfHwgdGhyb3dSZWRhY3RlZGB2YWx1ZSAke25hdH0gbXVzdCBiZSBhIG5hdHVyYWwgbnVtYmVyYDtcbiAgICByZXR1cm4gTmF0KG5hdCk7XG4gIH0sXG4gIGRvTWFrZUVtcHR5OiAoKSA9PiBlbXB0eSxcbiAgZG9Jc0VtcHR5OiAobmF0KSA9PiBuYXQgPT09IGVtcHR5LFxuICBkb0lzR1RFOiAobGVmdCwgcmlnaHQpID0+IGxlZnQgPj0gcmlnaHQsXG4gIGRvSXNFcXVhbDogKGxlZnQsIHJpZ2h0KSA9PiBsZWZ0ID09PSByaWdodCxcbiAgLy9cbiAgZG9BZGQ6IChsZWZ0LCByaWdodCkgPT4gbGVmdCArIHJpZ2h0LFxuICBkb1N1YnRyYWN0OiAobGVmdCwgcmlnaHQpID0+IE5hdChsZWZ0IC0gcmlnaHQpXG59KTtcblxuLy9cbnZhciBlbXB0eTIgPSBoYXJkZW4oW10pO1xudmFyIHNldE1hdGhIZWxwZXJzID0gaGFyZGVuKHtcbiAgZG9Db2VyY2U6IChsaXN0KSA9PiB7XG4gICAgbGlzdCA9IGNvZXJjZVRvRWxlbWVudHMobGlzdCk7XG4gICAgYXNzZXJ0S2V5KGxpc3QpO1xuICAgIHJldHVybiBsaXN0O1xuICB9LFxuICBkb01ha2VFbXB0eTogKCkgPT4gZW1wdHkyLFxuICBkb0lzRW1wdHk6IChsaXN0KSA9PiBwYXNzU3R5bGVPZihsaXN0KSA9PT0gXCJjb3B5QXJyYXlcIiAmJiBsaXN0Lmxlbmd0aCA9PT0gMCxcbiAgZG9Jc0dURTogZWxlbWVudHNJc1N1cGVyc2V0LFxuICBkb0lzRXF1YWw6ICh4LCB5KSA9PiBlbGVtZW50c0NvbXBhcmUoeCwgeSkgPT09IDAsXG4gIGRvQWRkOiBlbGVtZW50c0Rpc2pvaW50VW5pb24sXG4gIGRvU3VidHJhY3Q6IGVsZW1lbnRzRGlzam9pbnRTdWJ0cmFjdFxufSk7XG5cbi8vXG52YXIgZW1wdHkzID0gbWFrZUNvcHlTZXQoW10pO1xudmFyIGNvcHlTZXRNYXRoSGVscGVycyA9IGhhcmRlbih7XG4gIGRvQ29lcmNlOiAoc2V0KSA9PiB7XG4gICAgbXVzdE1hdGNoMihzZXQsIE0uc2V0KCksIFwic2V0IG9mIGFtb3VudFwiKTtcbiAgICByZXR1cm4gc2V0O1xuICB9LFxuICBkb01ha2VFbXB0eTogKCkgPT4gZW1wdHkzLFxuICBkb0lzRW1wdHk6IChzZXQpID0+IGdldENvcHlTZXRLZXlzKHNldCkubGVuZ3RoID09PSAwLFxuICBkb0lzR1RFOiBzZXRJc1N1cGVyc2V0LFxuICBkb0lzRXF1YWw6IGtleUVRLFxuICBkb0FkZDogc2V0RGlzam9pbnRVbmlvbixcbiAgZG9TdWJ0cmFjdDogc2V0RGlzam9pbnRTdWJ0cmFjdFxufSk7XG5cbi8vXG52YXIgZW1wdHk0ID0gbWFrZUNvcHlCYWcoW10pO1xudmFyIGNvcHlCYWdNYXRoSGVscGVycyA9IGhhcmRlbih7XG4gIGRvQ29lcmNlOiAoYmFnKSA9PiB7XG4gICAgbXVzdE1hdGNoMihiYWcsIE0uYmFnKCksIFwiYmFnIG9mIGFtb3VudFwiKTtcbiAgICByZXR1cm4gYmFnO1xuICB9LFxuICBkb01ha2VFbXB0eTogKCkgPT4gZW1wdHk0LFxuICBkb0lzRW1wdHk6IChiYWcpID0+IGdldENvcHlCYWdFbnRyaWVzKGJhZykubGVuZ3RoID09PSAwLFxuICBkb0lzR1RFOiBiYWdJc1N1cGVyYmFnLFxuICBkb0lzRXF1YWw6IGtleUVRLFxuICBkb0FkZDogYmFnVW5pb24sXG4gIGRvU3VidHJhY3Q6IGJhZ0Rpc2pvaW50U3VidHJhY3Rcbn0pO1xuXG4vL1xudmFyIEFzc2V0S2luZCA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIE5BVDogXCJuYXRcIixcbiAgICBTRVQ6IFwic2V0XCIsXG4gICAgQ09QWV9TRVQ6IFwiY29weVNldFwiLFxuICAgIENPUFlfQkFHOiBcImNvcHlCYWdcIlxuICB9XG4pO1xuaGFyZGVuKEFzc2V0S2luZCk7XG52YXIgYXNzZXRLaW5kTmFtZXMgPSBoYXJkZW4oT2JqZWN0LnZhbHVlcyhBc3NldEtpbmQpLnNvcnQoKSk7XG52YXIgYXNzZXJ0QXNzZXRLaW5kID0gKGFsbGVnZWRBSykgPT4ge1xuICBhc3NldEtpbmROYW1lcy5pbmNsdWRlcyhhbGxlZ2VkQUspIHx8IHRocm93UmVkYWN0ZWRgVGhlIGFzc2V0S2luZCAke2FsbGVnZWRBS30gbXVzdCBiZSBvbmUgb2YgJHtxdW90ZShhc3NldEtpbmROYW1lcyl9YDtcbn07XG5oYXJkZW4oYXNzZXJ0QXNzZXRLaW5kKTtcbnZhciBoZWxwZXJzID0ge1xuICBuYXQ6IG5hdE1hdGhIZWxwZXJzLFxuICBzZXQ6IHNldE1hdGhIZWxwZXJzLFxuICBjb3B5U2V0OiBjb3B5U2V0TWF0aEhlbHBlcnMsXG4gIGNvcHlCYWc6IGNvcHlCYWdNYXRoSGVscGVyc1xufTtcbnZhciBhc3NlcnRWYWx1ZUdldEFzc2V0S2luZCA9ICh2YWx1ZSkgPT4ge1xuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZih2YWx1ZSk7XG4gIGlmIChwYXNzU3R5bGUgPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4gXCJuYXRcIjtcbiAgfVxuICBpZiAocGFzc1N0eWxlID09PSBcImNvcHlBcnJheVwiKSB7XG4gICAgcmV0dXJuIFwic2V0XCI7XG4gIH1cbiAgaWYgKG1hdGNoZXModmFsdWUsIE0uc2V0KCkpKSB7XG4gICAgcmV0dXJuIFwiY29weVNldFwiO1xuICB9XG4gIGlmIChtYXRjaGVzKHZhbHVlLCBNLmJhZygpKSkge1xuICAgIHJldHVybiBcImNvcHlCYWdcIjtcbiAgfVxuICB0aHJvdyB0aHJvd1JlZGFjdGVkYHZhbHVlICR7dmFsdWV9IG11c3QgYmUgYSBiaWdpbnQsIGNvcHlTZXQsIGNvcHlCYWcsIG9yIGFuIGFycmF5LCBub3QgJHtxdW90ZShcbiAgICBwYXNzU3R5bGVcbiAgKX1gO1xufTtcbnZhciBhc3NlcnRWYWx1ZUdldEhlbHBlcnMgPSAodmFsdWUpID0+IChcbiAgLy9cbiAgaGVscGVyc1thc3NlcnRWYWx1ZUdldEFzc2V0S2luZCh2YWx1ZSldXG4pO1xudmFyIG9wdGlvbmFsQnJhbmRDaGVjayA9IChhbGxlZ2VkQnJhbmQsIGJyYW5kKSA9PiB7XG4gIGlmIChicmFuZCAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGJyYW5kLCBcImJyYW5kXCIpO1xuICAgIGFsbGVnZWRCcmFuZCA9PT0gYnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBhbW91bnQncyBicmFuZCAke3F1b3RlKGFsbGVnZWRCcmFuZCl9IGRpZCBub3QgbWF0Y2ggZXhwZWN0ZWQgYnJhbmQgJHtxdW90ZShcbiAgICAgIGJyYW5kXG4gICAgKX1gO1xuICB9XG59O1xudmFyIGNoZWNrTFJBbmRHZXRIZWxwZXJzID0gKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICBhc3NlcnRSZWNvcmQobGVmdEFtb3VudCwgXCJsZWZ0QW1vdW50XCIpO1xuICBhc3NlcnRSZWNvcmQocmlnaHRBbW91bnQsIFwicmlnaHRBbW91bnRcIik7XG4gIGNvbnN0IHsgdmFsdWU6IGxlZnRWYWx1ZSwgYnJhbmQ6IGxlZnRCcmFuZCB9ID0gbGVmdEFtb3VudDtcbiAgY29uc3QgeyB2YWx1ZTogcmlnaHRWYWx1ZSwgYnJhbmQ6IHJpZ2h0QnJhbmQgfSA9IHJpZ2h0QW1vdW50O1xuICBhc3NlcnRSZW1vdGFibGUobGVmdEJyYW5kLCBcImxlZnRCcmFuZFwiKTtcbiAgYXNzZXJ0UmVtb3RhYmxlKHJpZ2h0QnJhbmQsIFwicmlnaHRCcmFuZFwiKTtcbiAgb3B0aW9uYWxCcmFuZENoZWNrKGxlZnRCcmFuZCwgYnJhbmQpO1xuICBvcHRpb25hbEJyYW5kQ2hlY2socmlnaHRCcmFuZCwgYnJhbmQpO1xuICBsZWZ0QnJhbmQgPT09IHJpZ2h0QnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBCcmFuZHMgaW4gbGVmdCAke3F1b3RlKGxlZnRCcmFuZCl9IGFuZCByaWdodCAke3F1b3RlKFxuICAgIHJpZ2h0QnJhbmRcbiAgKX0gc2hvdWxkIG1hdGNoIGJ1dCBkbyBub3RgO1xuICBjb25zdCBsZWZ0SGVscGVycyA9IGFzc2VydFZhbHVlR2V0SGVscGVycyhsZWZ0VmFsdWUpO1xuICBjb25zdCByaWdodEhlbHBlcnMgPSBhc3NlcnRWYWx1ZUdldEhlbHBlcnMocmlnaHRWYWx1ZSk7XG4gIGxlZnRIZWxwZXJzID09PSByaWdodEhlbHBlcnMgfHwgdGhyb3dSZWRhY3RlZGBUaGUgbGVmdCAke2xlZnRBbW91bnR9IGFuZCByaWdodCBhbW91bnQgJHtyaWdodEFtb3VudH0gaGFkIGRpZmZlcmVudCBhc3NldEtpbmRzYDtcbiAgcmV0dXJuIGxlZnRIZWxwZXJzO1xufTtcbnZhciBjb2VyY2VMUiA9IChoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkgPT4ge1xuICByZXR1cm4gW2guZG9Db2VyY2UobGVmdEFtb3VudC52YWx1ZSksIGguZG9Db2VyY2UocmlnaHRBbW91bnQudmFsdWUpXTtcbn07XG52YXIgaXNHVEUgPSAobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVycyhsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICByZXR1cm4gaC5kb0lzR1RFKC4uLmNvZXJjZUxSKGgsIGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50KSk7XG59O1xudmFyIEFtb3VudE1hdGggPSB7XG4gIC8vXG4gIC8vXG4gIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICovXG4gIG1ha2U6IChicmFuZCwgYWxsZWdlZFZhbHVlKSA9PiB7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGJyYW5kLCBcImJyYW5kXCIpO1xuICAgIGNvbnN0IGggPSBhc3NlcnRWYWx1ZUdldEhlbHBlcnMoYWxsZWdlZFZhbHVlKTtcbiAgICBjb25zdCB2YWx1ZSA9IGguZG9Db2VyY2UoYWxsZWdlZFZhbHVlKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgYnJhbmQsIHZhbHVlIH0pO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuXG4gICAqL1xuICBjb2VyY2U6IChicmFuZCwgYWxsZWdlZEFtb3VudCkgPT4ge1xuICAgIGFzc2VydFJlbW90YWJsZShicmFuZCwgXCJicmFuZFwiKTtcbiAgICBhc3NlcnRSZWNvcmQoYWxsZWdlZEFtb3VudCwgXCJhbW91bnRcIik7XG4gICAgY29uc3QgeyBicmFuZDogYWxsZWdlZEJyYW5kLCB2YWx1ZTogYWxsZWdlZFZhbHVlIH0gPSBhbGxlZ2VkQW1vdW50O1xuICAgIGJyYW5kID09PSBhbGxlZ2VkQnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBUaGUgYnJhbmQgaW4gdGhlIGFsbGVnZWRBbW91bnQgJHthbGxlZ2VkQW1vdW50fSBpbiAnY29lcmNlJyBkaWRuJ3QgbWF0Y2ggdGhlIHNwZWNpZmllZCBicmFuZCAke2JyYW5kfS5gO1xuICAgIHJldHVybiBBbW91bnRNYXRoLm1ha2UoYnJhbmQsIGFsbGVnZWRWYWx1ZSk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuXG4gICAqL1xuICBnZXRWYWx1ZTogKGJyYW5kLCBhbW91bnQpID0+IEFtb3VudE1hdGguY29lcmNlKGJyYW5kLCBhbW91bnQpLnZhbHVlLFxuICAvKlxuXG5cblxuXG5cblxuXG4gICAqL1xuICBtYWtlRW1wdHk6IChicmFuZCwgYXNzZXRLaW5kID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgXCJuYXRcIlxuICApKSA9PiB7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGJyYW5kLCBcImJyYW5kXCIpO1xuICAgIGFzc2VydEFzc2V0S2luZChhc3NldEtpbmQpO1xuICAgIGNvbnN0IHZhbHVlID0gaGVscGVyc1thc3NldEtpbmRdLmRvTWFrZUVtcHR5KCk7XG4gICAgcmV0dXJuIGhhcmRlbih7IGJyYW5kLCB2YWx1ZSB9KTtcbiAgfSxcbiAgLypcblxuXG5cblxuXG5cbiAgICovXG4gIG1ha2VFbXB0eUZyb21BbW91bnQ6IChhbW91bnQpID0+IHtcbiAgICBhc3NlcnRSZWNvcmQoYW1vdW50LCBcImFtb3VudFwiKTtcbiAgICBjb25zdCB7IGJyYW5kLCB2YWx1ZSB9ID0gYW1vdW50O1xuICAgIGNvbnN0IGFzc2V0S2luZCA9IGFzc2VydFZhbHVlR2V0QXNzZXRLaW5kKHZhbHVlKTtcbiAgICByZXR1cm4gQW1vdW50TWF0aC5tYWtlRW1wdHkoYnJhbmQsIGFzc2V0S2luZCk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuICAgKi9cbiAgaXNFbXB0eTogKGFtb3VudCwgYnJhbmQgPSB2b2lkIDApID0+IHtcbiAgICBhc3NlcnRSZWNvcmQoYW1vdW50LCBcImFtb3VudFwiKTtcbiAgICBjb25zdCB7IGJyYW5kOiBhbGxlZ2VkQnJhbmQsIHZhbHVlIH0gPSBhbW91bnQ7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGFsbGVnZWRCcmFuZCwgXCJicmFuZFwiKTtcbiAgICBvcHRpb25hbEJyYW5kQ2hlY2soYWxsZWdlZEJyYW5kLCBicmFuZCk7XG4gICAgY29uc3QgaCA9IGFzc2VydFZhbHVlR2V0SGVscGVycyh2YWx1ZSk7XG4gICAgcmV0dXJuIGguZG9Jc0VtcHR5KGguZG9Db2VyY2UodmFsdWUpKTtcbiAgfSxcbiAgaXNHVEUsXG4gIC8qXG5cblxuXG5cblxuXG5cblxuICAgKi9cbiAgaXNFcXVhbDogKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVycyhsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICAgIHJldHVybiBoLmRvSXNFcXVhbCguLi5jb2VyY2VMUihoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkpO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICovXG4gIGFkZDogKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVycyhsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICAgIGNvbnN0IHZhbHVlID0gaC5kb0FkZCguLi5jb2VyY2VMUihoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkpO1xuICAgIHJldHVybiBoYXJkZW4oeyBicmFuZDogbGVmdEFtb3VudC5icmFuZCwgdmFsdWUgfSk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAqL1xuICBzdWJ0cmFjdDogKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVycyhsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICAgIGNvbnN0IHZhbHVlID0gaC5kb1N1YnRyYWN0KC4uLmNvZXJjZUxSKGgsIGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50KSk7XG4gICAgcmV0dXJuIGhhcmRlbih7IGJyYW5kOiBsZWZ0QW1vdW50LmJyYW5kLCB2YWx1ZSB9KTtcbiAgfSxcbiAgLypcblxuXG5cblxuXG5cblxuICAgKi9cbiAgbWluOiAoeCwgeSwgYnJhbmQgPSB2b2lkIDApID0+IChcbiAgICAvL1xuICAgIGlzR1RFKHgsIHksIGJyYW5kKSA/IHkgOiBpc0dURSh5LCB4LCBicmFuZCkgPyB4IDogdGhyb3dSZWRhY3RlZGAke3h9IGFuZCAke3l9IGFyZSBpbmNvbXBhcmFibGVgXG4gICksXG4gIC8qXG5cblxuXG5cblxuXG5cbiAgICovXG4gIG1heDogKHgsIHksIGJyYW5kID0gdm9pZCAwKSA9PiAoXG4gICAgLy9cbiAgICBpc0dURSh4LCB5LCBicmFuZCkgPyB4IDogaXNHVEUoeSwgeCkgPyB5IDogdGhyb3dSZWRhY3RlZGAke3h9IGFuZCAke3l9IGFyZSBpbmNvbXBhcmFibGVgXG4gIClcbn07XG5oYXJkZW4oQW1vdW50TWF0aCk7XG52YXIgZ2V0QXNzZXRLaW5kID0gKGFtb3VudCkgPT4ge1xuICBhc3NlcnRSZWNvcmQoYW1vdW50LCBcImFtb3VudFwiKTtcbiAgY29uc3QgeyB2YWx1ZSB9ID0gYW1vdW50O1xuICByZXR1cm4gYXNzZXJ0VmFsdWVHZXRBc3NldEtpbmQodmFsdWUpO1xufTtcbmhhcmRlbihnZXRBc3NldEtpbmQpO1xuXG4vL1xudmFyIGNvZXJjZURpc3BsYXlJbmZvID0gKGFsbGVnZWREaXNwbGF5SW5mbywgYXNzZXRLaW5kKSA9PiB7XG4gIG11c3RNYXRjaDIoYWxsZWdlZERpc3BsYXlJbmZvLCBEaXNwbGF5SW5mb1NoYXBlLCBcImRpc3BsYXlJbmZvXCIpO1xuICBpZiAoYWxsZWdlZERpc3BsYXlJbmZvLmFzc2V0S2luZCAhPT0gdm9pZCAwKSB7XG4gICAgYWxsZWdlZERpc3BsYXlJbmZvLmFzc2V0S2luZCA9PT0gYXNzZXRLaW5kIHx8IHRocm93UmVkYWN0ZWRgZGlzcGxheUluZm8uYXNzZXRLaW5kIHdhcyBwcmVzZW50ICgke2FsbGVnZWREaXNwbGF5SW5mby5hc3NldEtpbmR9KSBhbmQgZGlkIG5vdCBtYXRjaCB0aGUgYXNzZXRLaW5kIGFyZ3VtZW50ICgke2Fzc2V0S2luZH0pYDtcbiAgfVxuICBjb25zdCBkaXNwbGF5SW5mbyA9IGhhcmRlbih7IC4uLmFsbGVnZWREaXNwbGF5SW5mbywgYXNzZXRLaW5kIH0pO1xuICBpZiAoZGlzcGxheUluZm8uZGVjaW1hbFBsYWNlcyAhPT0gdm9pZCAwKSB7XG4gICAgTnVtYmVyLmlzU2FmZUludGVnZXIoZGlzcGxheUluZm8uZGVjaW1hbFBsYWNlcykgfHwgdGhyb3dSZWRhY3RlZGBkZWNpbWFsUGxhY2VzICR7ZGlzcGxheUluZm8uZGVjaW1hbFBsYWNlc30gaXMgbm90IGEgc2FmZSBpbnRlZ2VyYDtcbiAgfVxuICByZXR1cm4gZGlzcGxheUluZm87XG59O1xuXG4vL1xudmFyIHByZXBhcmVQYXltZW50S2luZCA9IChpc3N1ZXJab25lLCBuYW1lLCBicmFuZCwgUGF5bWVudEkpID0+IHtcbiAgY29uc3QgbWFrZVBheW1lbnQgPSBpc3N1ZXJab25lLmV4b0NsYXNzKFxuICAgIGAke25hbWV9IHBheW1lbnRgLFxuICAgIFBheW1lbnRJLFxuICAgIGluaXRFbXB0eSxcbiAgICB7XG4gICAgICBnZXRBbGxlZ2VkQnJhbmQoKSB7XG4gICAgICAgIHJldHVybiBicmFuZDtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlUGF5bWVudDtcbn07XG5oYXJkZW4ocHJlcGFyZVBheW1lbnRLaW5kKTtcblxuLy9cbnZhciBtYWtlVHJhbnNpZW50Tm90aWZpZXJLaXQgPSAoKSA9PiB7XG4gIGNvbnN0IHRyYW5zaWVudE5vdGlmZXJLaXRzID0gbWFrZVNjYWxhckJpZ1dlYWtNYXBTdG9yZShcbiAgICBcInRyYW5zaWVudE5vdGlmZXJLaXRzXCJcbiAgKTtcbiAgY29uc3QgcHJvdmlkZU5vdGlmaWVyS2l0ID0gKGtleSkgPT4gcHJvdmlkZUxhenkoXG4gICAgdHJhbnNpZW50Tm90aWZlcktpdHMsXG4gICAga2V5LFxuICAgICgpID0+IG1ha2VOb3RpZmllcktpdChrZXkuZ2V0Q3VycmVudEFtb3VudCgpKVxuICApO1xuICBjb25zdCBwcm92aWRlTm90aWZpZXIgPSAoa2V5KSA9PiBwcm92aWRlTm90aWZpZXJLaXQoa2V5KS5ub3RpZmllcjtcbiAgY29uc3QgdXBkYXRlID0gKGtleSwgbmV3VmFsdWUpID0+IHtcbiAgICBpZiAodHJhbnNpZW50Tm90aWZlcktpdHMuaGFzKGtleSkpIHtcbiAgICAgIGNvbnN0IHsgdXBkYXRlciB9ID0gdHJhbnNpZW50Tm90aWZlcktpdHMuZ2V0KGtleSk7XG4gICAgICB1cGRhdGVyLnVwZGF0ZVN0YXRlKG5ld1ZhbHVlKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiB7IHByb3ZpZGVOb3RpZmllciwgdXBkYXRlIH07XG59O1xuaGFyZGVuKG1ha2VUcmFuc2llbnROb3RpZmllcktpdCk7XG5cbi8vXG52YXIgbWFrZUFtb3VudFN0b3JlID0gKHN0YXRlLCBrZXkpID0+IHtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgZ2V0QW1vdW50OiAoKSA9PiBzdGF0ZVtrZXldLFxuICAgIGluY3JlbWVudDogKGRlbHRhKSA9PiB7XG4gICAgICBzdGF0ZVtrZXldID0gQW1vdW50TWF0aC5hZGQoc3RhdGVba2V5XSwgZGVsdGEpO1xuICAgIH0sXG4gICAgZGVjcmVtZW50OiAoZGVsdGEpID0+IHtcbiAgICAgIGlmIChBbW91bnRNYXRoLmlzR1RFKHN0YXRlW2tleV0sIGRlbHRhKSkge1xuICAgICAgICBzdGF0ZVtrZXldID0gQW1vdW50TWF0aC5zdWJ0cmFjdChzdGF0ZVtrZXldLCBkZWx0YSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VBbW91bnRTdG9yZSk7XG5cbi8vXG52YXIgRU1QVFlfQ09QWV9TRVQgPSBtYWtlQ29weVNldChbXSk7XG52YXIgcHJlcGFyZVB1cnNlS2luZCA9IChpc3N1ZXJab25lLCBuYW1lLCBhc3NldEtpbmQsIGJyYW5kLCBQdXJzZUlLaXQsIHB1cnNlTWV0aG9kcywgcmVjb3ZlcnlTZXRzU3RhdGUsIHBheW1lbnRSZWNvdmVyeVNldHMpID0+IHtcbiAgY29uc3QgYW1vdW50U2hhcGUgPSBicmFuZC5nZXRBbW91bnRTaGFwZSgpO1xuICBjb25zdCB7IHByb3ZpZGVOb3RpZmllciwgdXBkYXRlOiB1cGRhdGVCYWxhbmNlIH0gPSBtYWtlVHJhbnNpZW50Tm90aWZpZXJLaXQoKTtcbiAgY29uc3QgbWF5YmVSZWNvdmVyeVNldCA9IChzdGF0ZSkgPT4ge1xuICAgIGNvbnN0IHsgcmVjb3ZlcnlTZXQgfSA9IHN0YXRlO1xuICAgIGlmIChyZWNvdmVyeVNldHNTdGF0ZSA9PT0gXCJoYXNSZWNvdmVyeVNldHNcIikge1xuICAgICAgcmV0dXJuIHJlY292ZXJ5U2V0O1xuICAgIH0gZWxzZSB7XG4gICAgICByZWNvdmVyeVNldHNTdGF0ZSA9PT0gXCJub1JlY292ZXJ5U2V0c1wiIHx8IHRocm93UmVkYWN0ZWRgcmVjb3ZlclNldHNTdGF0ZSBtdXN0IGJlIG5vUmVjb3ZlcnlTZXRzIGlmIGl0IGlzbid0IGhhc1JlY292ZXJTZXRzYDtcbiAgICAgIHBheW1lbnRSZWNvdmVyeVNldHMgIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYHBheW1lbnRSZWNvdmVyeVNldHMgbXVzdCBhbHdheXMgYmUgZGVmaW5lZGA7XG4gICAgICByZWNvdmVyeVNldC5nZXRTaXplKCkgPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBXaXRoIG5vUmVjb3ZlcnlTZXRzLCByZWNvdmVyeVNldCBtdXN0IGJlIGVtcHR5YDtcbiAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgfVxuICB9O1xuICBjb25zdCB7IGRlcG9zaXRJbnRlcm5hbCwgd2l0aGRyYXdJbnRlcm5hbCB9ID0gcHVyc2VNZXRob2RzO1xuICBjb25zdCBtYWtlUHVyc2VLaXQgPSBpc3N1ZXJab25lLmV4b0NsYXNzS2l0KFxuICAgIGAke25hbWV9IFB1cnNlYCxcbiAgICBQdXJzZUlLaXQsXG4gICAgKCkgPT4ge1xuICAgICAgY29uc3QgY3VycmVudEJhbGFuY2UgPSBBbW91bnRNYXRoLm1ha2VFbXB0eShicmFuZCwgYXNzZXRLaW5kKTtcbiAgICAgIGNvbnN0IHJlY292ZXJ5U2V0ID0gaXNzdWVyWm9uZS5kZXRhY2hlZCgpLnNldFN0b3JlKFwicmVjb3Zlcnkgc2V0XCIpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY3VycmVudEJhbGFuY2UsXG4gICAgICAgIHJlY292ZXJ5U2V0XG4gICAgICB9O1xuICAgIH0sXG4gICAge1xuICAgICAgcHVyc2U6IHtcbiAgICAgICAgZGVwb3NpdChzcmNQYXltZW50LCBvcHRBbW91bnRTaGFwZSA9IHZvaWQgMCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgY29uc3QgeyBwdXJzZSB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgYmFsYW5jZVN0b3JlID0gbWFrZUFtb3VudFN0b3JlKHN0YXRlLCBcImN1cnJlbnRCYWxhbmNlXCIpO1xuICAgICAgICAgIGNvbnN0IHNyY1BheW1lbnRCYWxhbmNlID0gZGVwb3NpdEludGVybmFsKFxuICAgICAgICAgICAgYmFsYW5jZVN0b3JlLFxuICAgICAgICAgICAgc3JjUGF5bWVudCxcbiAgICAgICAgICAgIG9wdEFtb3VudFNoYXBlXG4gICAgICAgICAgKTtcbiAgICAgICAgICB1cGRhdGVCYWxhbmNlKHB1cnNlLCBiYWxhbmNlU3RvcmUuZ2V0QW1vdW50KCkpO1xuICAgICAgICAgIHJldHVybiBzcmNQYXltZW50QmFsYW5jZTtcbiAgICAgICAgfSxcbiAgICAgICAgd2l0aGRyYXcoYW1vdW50KSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICBjb25zdCB7IHB1cnNlIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCBvcHRSZWNvdmVyeVNldCA9IG1heWJlUmVjb3ZlcnlTZXQoc3RhdGUpO1xuICAgICAgICAgIGNvbnN0IGJhbGFuY2VTdG9yZSA9IG1ha2VBbW91bnRTdG9yZShzdGF0ZSwgXCJjdXJyZW50QmFsYW5jZVwiKTtcbiAgICAgICAgICBjb25zdCBwYXltZW50ID0gd2l0aGRyYXdJbnRlcm5hbChcbiAgICAgICAgICAgIGJhbGFuY2VTdG9yZSxcbiAgICAgICAgICAgIGFtb3VudCxcbiAgICAgICAgICAgIG9wdFJlY292ZXJ5U2V0XG4gICAgICAgICAgKTtcbiAgICAgICAgICB1cGRhdGVCYWxhbmNlKHB1cnNlLCBiYWxhbmNlU3RvcmUuZ2V0QW1vdW50KCkpO1xuICAgICAgICAgIHJldHVybiBwYXltZW50O1xuICAgICAgICB9LFxuICAgICAgICBnZXRDdXJyZW50QW1vdW50KCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgY29uc3QgYmFsYW5jZVN0b3JlID0gbWFrZUFtb3VudFN0b3JlKHN0YXRlLCBcImN1cnJlbnRCYWxhbmNlXCIpO1xuICAgICAgICAgIHJldHVybiBiYWxhbmNlU3RvcmUuZ2V0QW1vdW50KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEN1cnJlbnRBbW91bnROb3RpZmllcigpIHtcbiAgICAgICAgICByZXR1cm4gcHJvdmlkZU5vdGlmaWVyKHRoaXMuZmFjZXRzLnB1cnNlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0QWxsZWdlZEJyYW5kKCkge1xuICAgICAgICAgIHJldHVybiBicmFuZDtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0RGVwb3NpdEZhY2V0KCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmZhY2V0cy5kZXBvc2l0RmFjZXQ7XG4gICAgICAgIH0sXG4gICAgICAgIGdldFJlY292ZXJ5U2V0KCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgY29uc3Qgb3B0UmVjb3ZlcnlTZXQgPSBtYXliZVJlY292ZXJ5U2V0KHN0YXRlKTtcbiAgICAgICAgICBpZiAob3B0UmVjb3ZlcnlTZXQgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgcmV0dXJuIEVNUFRZX0NPUFlfU0VUO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gb3B0UmVjb3ZlcnlTZXQuc25hcHNob3QoKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVjb3ZlckFsbCgpIHtcbiAgICAgICAgICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgbGV0IGFtb3VudCA9IEFtb3VudE1hdGgubWFrZUVtcHR5KGJyYW5kLCBhc3NldEtpbmQpO1xuICAgICAgICAgIGNvbnN0IG9wdFJlY292ZXJ5U2V0ID0gbWF5YmVSZWNvdmVyeVNldChzdGF0ZSk7XG4gICAgICAgICAgaWYgKG9wdFJlY292ZXJ5U2V0ID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIHJldHVybiBhbW91bnQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAoY29uc3QgcGF5bWVudCBvZiBvcHRSZWNvdmVyeVNldC5rZXlzKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGRlbHRhID0gZmFjZXRzLnB1cnNlLmRlcG9zaXQocGF5bWVudCk7XG4gICAgICAgICAgICBhbW91bnQgPSBBbW91bnRNYXRoLmFkZChhbW91bnQsIGRlbHRhLCBicmFuZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG9wdFJlY292ZXJ5U2V0LmdldFNpemUoKSA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBSZW1haW5pbmcgdW5yZWNvdmVyZWQgcGF5bWVudHM6ICR7ZmFjZXRzLnB1cnNlLmdldFJlY292ZXJ5U2V0KCl9YDtcbiAgICAgICAgICByZXR1cm4gYW1vdW50O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGVwb3NpdEZhY2V0OiB7XG4gICAgICAgIHJlY2VpdmUoLi4uYXJncykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmZhY2V0cy5wdXJzZS5kZXBvc2l0KC4uLmFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBzdGF0ZVNoYXBlOiB7XG4gICAgICAgIGN1cnJlbnRCYWxhbmNlOiBhbW91bnRTaGFwZSxcbiAgICAgICAgcmVjb3ZlcnlTZXQ6IE0ucmVtb3RhYmxlKFwicmVjb3ZlcnlTZXRcIilcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiAoKSA9PiBtYWtlUHVyc2VLaXQoKS5wdXJzZTtcbn07XG5oYXJkZW4ocHJlcGFyZVB1cnNlS2luZCk7XG5cbi8vXG52YXIgYW1vdW50U2hhcGVGcm9tRWxlbWVudFNoYXBlID0gKGJyYW5kLCBhc3NldEtpbmQsIGVsZW1lbnRTaGFwZSkgPT4ge1xuICBsZXQgdmFsdWVTaGFwZTtcbiAgc3dpdGNoIChhc3NldEtpbmQpIHtcbiAgICBjYXNlIFwibmF0XCI6IHtcbiAgICAgIHZhbHVlU2hhcGUgPSBNLm5hdCgpO1xuICAgICAgZWxlbWVudFNoYXBlID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBGdW5naWJsZSBhc3NldHMgY2Fubm90IGhhdmUgYW4gZWxlbWVudFNoYXBlOiAke3F1b3RlKGVsZW1lbnRTaGFwZSl9YDtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIFwic2V0XCI6IHtcbiAgICAgIGlmIChlbGVtZW50U2hhcGUgPT09IHZvaWQgMCkge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5hcnJheU9mKE0ua2V5KCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWVTaGFwZSA9IE0uYXJyYXlPZihNLmFuZChNLmtleSgpLCBlbGVtZW50U2hhcGUpKTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIFwiY29weVNldFwiOiB7XG4gICAgICBpZiAoZWxlbWVudFNoYXBlID09PSB2b2lkIDApIHtcbiAgICAgICAgdmFsdWVTaGFwZSA9IE0uc2V0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5zZXRPZihlbGVtZW50U2hhcGUpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgXCJjb3B5QmFnXCI6IHtcbiAgICAgIGlmIChlbGVtZW50U2hhcGUgPT09IHZvaWQgMCkge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5iYWcoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlU2hhcGUgPSBNLmJhZ09mKGVsZW1lbnRTaGFwZSk7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGFzc2V0IGtpbmQgJHtxdW90ZShhc3NldEtpbmQpfWA7XG4gICAgfVxuICB9XG4gIGNvbnN0IGFtb3VudFNoYXBlID0gaGFyZGVuKHtcbiAgICBicmFuZCxcbiAgICAvL1xuICAgIHZhbHVlOiB2YWx1ZVNoYXBlXG4gIH0pO1xuICByZXR1cm4gYW1vdW50U2hhcGU7XG59O1xudmFyIHByZXBhcmVQYXltZW50TGVkZ2VyID0gKGlzc3VlclpvbmUsIG5hbWUsIGFzc2V0S2luZCwgZGlzcGxheUluZm8sIGVsZW1lbnRTaGFwZSwgcmVjb3ZlcnlTZXRzU3RhdGUsIG9wdFNodXRkb3duV2l0aEZhaWx1cmUgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgYnJhbmQgPSBpc3N1ZXJab25lLmV4byhgJHtuYW1lfSBicmFuZGAsIEJyYW5kSSwge1xuICAgIGlzTXlJc3N1ZXIoYWxsZWdlZElzc3Vlcikge1xuICAgICAgcmV0dXJuIGFsbGVnZWRJc3N1ZXIgPT09IGlzc3VlcjtcbiAgICB9LFxuICAgIGdldEFsbGVnZWROYW1lKCkge1xuICAgICAgcmV0dXJuIG5hbWU7XG4gICAgfSxcbiAgICAvL1xuICAgIGdldERpc3BsYXlJbmZvKCkge1xuICAgICAgcmV0dXJuIGRpc3BsYXlJbmZvO1xuICAgIH0sXG4gICAgZ2V0QW1vdW50U2hhcGUoKSB7XG4gICAgICByZXR1cm4gYW1vdW50U2hhcGU7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgYW1vdW50U2hhcGUgPSBhbW91bnRTaGFwZUZyb21FbGVtZW50U2hhcGUoXG4gICAgYnJhbmQsXG4gICAgYXNzZXRLaW5kLFxuICAgIGVsZW1lbnRTaGFwZVxuICApO1xuICBjb25zdCB7IElzc3VlckksIE1pbnRJLCBQYXltZW50SSwgUHVyc2VJS2l0IH0gPSBtYWtlSXNzdWVySW50ZXJmYWNlcyhcbiAgICBicmFuZCxcbiAgICBhc3NldEtpbmQsXG4gICAgYW1vdW50U2hhcGVcbiAgKTtcbiAgY29uc3QgbWFrZVBheW1lbnQgPSBwcmVwYXJlUGF5bWVudEtpbmQoaXNzdWVyWm9uZSwgbmFtZSwgYnJhbmQsIFBheW1lbnRJKTtcbiAgY29uc3Qgc2h1dGRvd25MZWRnZXJXaXRoRmFpbHVyZSA9IChyZWFzb24pID0+IHtcbiAgICBpZiAob3B0U2h1dGRvd25XaXRoRmFpbHVyZSAhPT0gdm9pZCAwKSB7XG4gICAgICB0cnkge1xuICAgICAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlKHJlYXNvbik7XG4gICAgICB9IGNhdGNoIChlcnJJblNodXRkb3duKSB7XG4gICAgICAgIG5vdGUoZXJySW5TaHV0ZG93biwgcmVkYWN0ZWRgQ2F1c2VkIGJ5OiAke3JlYXNvbn1gKTtcbiAgICAgICAgdGhyb3cgZXJySW5TaHV0ZG93bjtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhyb3cgcmVhc29uO1xuICB9O1xuICBjb25zdCBwYXltZW50TGVkZ2VyID0gaXNzdWVyWm9uZS53ZWFrTWFwU3RvcmUoXCJwYXltZW50TGVkZ2VyXCIsIHtcbiAgICB2YWx1ZVNoYXBlOiBhbW91bnRTaGFwZVxuICB9KTtcbiAgY29uc3QgcGF5bWVudFJlY292ZXJ5U2V0cyA9IGlzc3VlclpvbmUud2Vha01hcFN0b3JlKFwicGF5bWVudFJlY292ZXJ5U2V0c1wiKTtcbiAgY29uc3QgaW5pdFBheW1lbnQgPSAocGF5bWVudCwgYW1vdW50LCBvcHRSZWNvdmVyeVNldCA9IHZvaWQgMCkgPT4ge1xuICAgIGlmIChyZWNvdmVyeVNldHNTdGF0ZSA9PT0gXCJub1JlY292ZXJ5U2V0c1wiKSB7XG4gICAgICBvcHRSZWNvdmVyeVNldCA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgd2hlbiByZWNvdmVyU2V0c1N0YXRlID09PSAnbm9SZWNvdmVyeVNldHMnLCBvcHRSZWNvdmVyeVNldCBtdXN0IGJlIGVtcHR5YDtcbiAgICB9XG4gICAgaWYgKG9wdFJlY292ZXJ5U2V0ICE9PSB2b2lkIDAgJiYgIUFtb3VudE1hdGguaXNFbXB0eShhbW91bnQpKSB7XG4gICAgICBvcHRSZWNvdmVyeVNldC5hZGQocGF5bWVudCk7XG4gICAgICBwYXltZW50UmVjb3ZlcnlTZXRzLmluaXQocGF5bWVudCwgb3B0UmVjb3ZlcnlTZXQpO1xuICAgIH1cbiAgICBwYXltZW50TGVkZ2VyLmluaXQocGF5bWVudCwgYW1vdW50KTtcbiAgfTtcbiAgY29uc3QgZGVsZXRlUGF5bWVudCA9IChwYXltZW50KSA9PiB7XG4gICAgcGF5bWVudExlZGdlci5kZWxldGUocGF5bWVudCk7XG4gICAgaWYgKHBheW1lbnRSZWNvdmVyeVNldHMuaGFzKHBheW1lbnQpKSB7XG4gICAgICBjb25zdCByZWNvdmVyeVNldCA9IHBheW1lbnRSZWNvdmVyeVNldHMuZ2V0KHBheW1lbnQpO1xuICAgICAgcGF5bWVudFJlY292ZXJ5U2V0cy5kZWxldGUocGF5bWVudCk7XG4gICAgICByZWNvdmVyeVNldC5kZWxldGUocGF5bWVudCk7XG4gICAgfVxuICB9O1xuICBjb25zdCBjb2VyY2UgPSAoYWxsZWdlZEFtb3VudCkgPT4gQW1vdW50TWF0aC5jb2VyY2UoYnJhbmQsIGFsbGVnZWRBbW91bnQpO1xuICBjb25zdCBhc3NlcnRBbW91bnRDb25zaXN0ZW50ID0gKHBheW1lbnRCYWxhbmNlLCBvcHRBbW91bnRTaGFwZSkgPT4ge1xuICAgIGlmIChvcHRBbW91bnRTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2gocGF5bWVudEJhbGFuY2UsIG9wdEFtb3VudFNoYXBlLCBcImFtb3VudFwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydExpdmVQYXltZW50ID0gKHBheW1lbnQpID0+IHtcbiAgICBwYXltZW50TGVkZ2VyLmhhcyhwYXltZW50KSB8fCB0aHJvd1JlZGFjdGVkYCR7cGF5bWVudH0gd2FzIG5vdCBhIGxpdmUgcGF5bWVudCBmb3IgYnJhbmQgJHtxdW90ZShcbiAgICAgIGJyYW5kXG4gICAgKX0uIEl0IGNvdWxkIGJlIGEgdXNlZC11cCBwYXltZW50LCBhIHBheW1lbnQgZm9yIGFub3RoZXIgYnJhbmQsIG9yIGl0IG1pZ2h0IG5vdCBiZSBhIHBheW1lbnQgYXQgYWxsLmA7XG4gIH07XG4gIGNvbnN0IGRlcG9zaXRJbnRlcm5hbCA9IChiYWxhbmNlU3RvcmUsIHNyY1BheW1lbnQsIG9wdEFtb3VudFNoYXBlID0gdm9pZCAwKSA9PiB7XG4gICAgIWlzUHJvbWlzZShzcmNQYXltZW50KSB8fCBhc3NlcnQuZmFpbChcbiAgICAgIGBkZXBvc2l0IGRvZXMgbm90IGFjY2VwdCBwcm9taXNlcyBhcyBmaXJzdCBhcmd1bWVudC4gSW5zdGVhZCBvZiBwYXNzaW5nIHRoZSBwcm9taXNlIChkZXBvc2l0KHBheW1lbnRQcm9taXNlKSksIGNvbnNpZGVyIHVud3JhcHBpbmcgdGhlIHByb21pc2UgZmlyc3Q6IEUud2hlbihwYXltZW50UHJvbWlzZSwgKGFjdHVhbFBheW1lbnQgPT4gZGVwb3NpdChhY3R1YWxQYXltZW50KSlgLFxuICAgICAgVHlwZUVycm9yXG4gICAgKTtcbiAgICBhc3NlcnRMaXZlUGF5bWVudChzcmNQYXltZW50KTtcbiAgICBjb25zdCBzcmNQYXltZW50QmFsYW5jZSA9IHBheW1lbnRMZWRnZXIuZ2V0KHNyY1BheW1lbnQpO1xuICAgIGFzc2VydEFtb3VudENvbnNpc3RlbnQoc3JjUGF5bWVudEJhbGFuY2UsIG9wdEFtb3VudFNoYXBlKTtcbiAgICB0cnkge1xuICAgICAgZGVsZXRlUGF5bWVudChzcmNQYXltZW50KTtcbiAgICAgIGJhbGFuY2VTdG9yZS5pbmNyZW1lbnQoc3JjUGF5bWVudEJhbGFuY2UpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgc2h1dGRvd25MZWRnZXJXaXRoRmFpbHVyZShlcnIpO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICByZXR1cm4gc3JjUGF5bWVudEJhbGFuY2U7XG4gIH07XG4gIGNvbnN0IHdpdGhkcmF3SW50ZXJuYWwgPSAoYmFsYW5jZVN0b3JlLCBhbW91bnQsIHJlY292ZXJ5U2V0ID0gdm9pZCAwKSA9PiB7XG4gICAgYW1vdW50ID0gY29lcmNlKGFtb3VudCk7XG4gICAgY29uc3QgcGF5bWVudCA9IG1ha2VQYXltZW50KCk7XG4gICAgYmFsYW5jZVN0b3JlLmRlY3JlbWVudChhbW91bnQpIHx8IHRocm93UmVkYWN0ZWRgV2l0aGRyYXdhbCBvZiAke2Ftb3VudH0gZmFpbGVkIGJlY2F1c2UgdGhlIHB1cnNlIG9ubHkgY29udGFpbmVkICR7YmFsYW5jZVN0b3JlLmdldEFtb3VudCgpfWA7XG4gICAgdHJ5IHtcbiAgICAgIGluaXRQYXltZW50KHBheW1lbnQsIGFtb3VudCwgcmVjb3ZlcnlTZXQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgc2h1dGRvd25MZWRnZXJXaXRoRmFpbHVyZShlcnIpO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICByZXR1cm4gcGF5bWVudDtcbiAgfTtcbiAgY29uc3QgbWFrZUVtcHR5UHVyc2UgPSBwcmVwYXJlUHVyc2VLaW5kKFxuICAgIGlzc3VlclpvbmUsXG4gICAgbmFtZSxcbiAgICBhc3NldEtpbmQsXG4gICAgYnJhbmQsXG4gICAgUHVyc2VJS2l0LFxuICAgIGhhcmRlbih7XG4gICAgICBkZXBvc2l0SW50ZXJuYWwsXG4gICAgICB3aXRoZHJhd0ludGVybmFsXG4gICAgfSksXG4gICAgcmVjb3ZlcnlTZXRzU3RhdGUsXG4gICAgcGF5bWVudFJlY292ZXJ5U2V0c1xuICApO1xuICBjb25zdCBpc3N1ZXIgPSBpc3N1ZXJab25lLmV4byhgJHtuYW1lfSBpc3N1ZXJgLCBJc3N1ZXJJLCB7XG4gICAgZ2V0QnJhbmQoKSB7XG4gICAgICByZXR1cm4gYnJhbmQ7XG4gICAgfSxcbiAgICBnZXRBbGxlZ2VkTmFtZSgpIHtcbiAgICAgIHJldHVybiBuYW1lO1xuICAgIH0sXG4gICAgZ2V0QXNzZXRLaW5kKCkge1xuICAgICAgcmV0dXJuIGFzc2V0S2luZDtcbiAgICB9LFxuICAgIGdldERpc3BsYXlJbmZvKCkge1xuICAgICAgcmV0dXJuIGRpc3BsYXlJbmZvO1xuICAgIH0sXG4gICAgbWFrZUVtcHR5UHVyc2UoKSB7XG4gICAgICByZXR1cm4gbWFrZUVtcHR5UHVyc2UoKTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGlzTGl2ZShwYXltZW50KSB7XG4gICAgICByZXR1cm4gcGF5bWVudExlZGdlci5oYXMocGF5bWVudCk7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBnZXRBbW91bnRPZihwYXltZW50KSB7XG4gICAgICBhc3NlcnRMaXZlUGF5bWVudChwYXltZW50KTtcbiAgICAgIHJldHVybiBwYXltZW50TGVkZ2VyLmdldChwYXltZW50KTtcbiAgICB9LFxuICAgIC8qXG5cblxuICAgICAqL1xuICAgIGJ1cm4ocGF5bWVudCwgb3B0QW1vdW50U2hhcGUgPSB2b2lkIDApIHtcbiAgICAgIGFzc2VydExpdmVQYXltZW50KHBheW1lbnQpO1xuICAgICAgY29uc3QgcGF5bWVudEJhbGFuY2UgPSBwYXltZW50TGVkZ2VyLmdldChwYXltZW50KTtcbiAgICAgIGFzc2VydEFtb3VudENvbnNpc3RlbnQocGF5bWVudEJhbGFuY2UsIG9wdEFtb3VudFNoYXBlKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGRlbGV0ZVBheW1lbnQocGF5bWVudCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgc2h1dGRvd25MZWRnZXJXaXRoRmFpbHVyZShlcnIpO1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGF5bWVudEJhbGFuY2U7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgbWludFJlY292ZXJ5UHVyc2UgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgICBpc3N1ZXJab25lLm1ha2VPbmNlKFwibWludFJlY292ZXJ5UHVyc2VcIiwgKCkgPT4gbWFrZUVtcHR5UHVyc2UoKSlcbiAgKTtcbiAgY29uc3QgbWludCA9IGlzc3VlclpvbmUuZXhvKGAke25hbWV9IG1pbnRgLCBNaW50SSwge1xuICAgIGdldElzc3VlcigpIHtcbiAgICAgIHJldHVybiBpc3N1ZXI7XG4gICAgfSxcbiAgICBtaW50UGF5bWVudChuZXdBbW91bnQpIHtcbiAgICAgIG5ld0Ftb3VudCA9IGNvZXJjZShuZXdBbW91bnQpO1xuICAgICAgbXVzdE1hdGNoKG5ld0Ftb3VudCwgYW1vdW50U2hhcGUsIFwibWludGVkIGFtb3VudFwiKTtcbiAgICAgIGNvbnN0IHJhd1BheW1lbnQgPSBtYWtlUGF5bWVudCgpO1xuICAgICAgaW5pdFBheW1lbnQocmF3UGF5bWVudCwgbmV3QW1vdW50LCB2b2lkIDApO1xuICAgICAgY29uc3QgbWludFJlY292ZXJ5UHVyc2VCZWZvcmUgPSBtaW50UmVjb3ZlcnlQdXJzZS5nZXRDdXJyZW50QW1vdW50KCk7XG4gICAgICBtaW50UmVjb3ZlcnlQdXJzZS5kZXBvc2l0KHJhd1BheW1lbnQsIG5ld0Ftb3VudCk7XG4gICAgICBjb25zdCBwYXltZW50ID0gbWludFJlY292ZXJ5UHVyc2Uud2l0aGRyYXcobmV3QW1vdW50KTtcbiAgICAgIGNvbnN0IG1pbnRSZWNvdmVyeVB1cnNlQWZ0ZXIgPSBtaW50UmVjb3ZlcnlQdXJzZS5nZXRDdXJyZW50QW1vdW50KCk7XG4gICAgICBhc3NlcnQoa2V5RVEobWludFJlY292ZXJ5UHVyc2VCZWZvcmUsIG1pbnRSZWNvdmVyeVB1cnNlQWZ0ZXIpKTtcbiAgICAgIHJldHVybiBwYXltZW50O1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IGlzc3VlcktpdCA9IGhhcmRlbih7IGlzc3VlciwgbWludCwgYnJhbmQsIG1pbnRSZWNvdmVyeVB1cnNlIH0pO1xuICByZXR1cm4gaXNzdWVyS2l0O1xufTtcbmhhcmRlbihwcmVwYXJlUGF5bWVudExlZGdlcik7XG5cbi8vXG52YXIgc2V0dXBJc3N1ZXJLaXQgPSAoeyBuYW1lLCBhc3NldEtpbmQsIGRpc3BsYXlJbmZvLCBlbGVtZW50U2hhcGUgfSwgaXNzdWVyWm9uZSwgcmVjb3ZlcnlTZXRzU3RhdGUsIG9wdFNodXRkb3duV2l0aEZhaWx1cmUgPSB2b2lkIDApID0+IHtcbiAgYXNzZXJ0Mi50eXBlb2YobmFtZSwgXCJzdHJpbmdcIik7XG4gIGFzc2VydEFzc2V0S2luZChhc3NldEtpbmQpO1xuICBjb25zdCBjbGVhbkRpc3BsYXlJbmZvID0gY29lcmNlRGlzcGxheUluZm8oZGlzcGxheUluZm8sIGFzc2V0S2luZCk7XG4gIGlmIChvcHRTaHV0ZG93bldpdGhGYWlsdXJlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnQyLnR5cGVvZihvcHRTaHV0ZG93bldpdGhGYWlsdXJlLCBcImZ1bmN0aW9uXCIpO1xuICB9XG4gIGlmIChlbGVtZW50U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oZWxlbWVudFNoYXBlKTtcbiAgfVxuICBjb25zdCB7IGlzc3VlciwgbWludCwgYnJhbmQsIG1pbnRSZWNvdmVyeVB1cnNlIH0gPSBwcmVwYXJlUGF5bWVudExlZGdlcihcbiAgICBpc3N1ZXJab25lLFxuICAgIG5hbWUsXG4gICAgYXNzZXRLaW5kLFxuICAgIGNsZWFuRGlzcGxheUluZm8sXG4gICAgZWxlbWVudFNoYXBlLFxuICAgIHJlY292ZXJ5U2V0c1N0YXRlLFxuICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmVcbiAgKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgYnJhbmQsXG4gICAgaXNzdWVyLFxuICAgIG1pbnQsXG4gICAgbWludFJlY292ZXJ5UHVyc2UsXG4gICAgZGlzcGxheUluZm86IGNsZWFuRGlzcGxheUluZm9cbiAgfSk7XG59O1xuaGFyZGVuKHNldHVwSXNzdWVyS2l0KTtcbnZhciBJTlNUQU5DRV9LRVkgPSBcImlzc3VlclwiO1xudmFyIFJFQ09WRVJZX1NFVFNfU1RBVEUgPSBcInJlY292ZXJ5U2V0c1N0YXRlXCI7XG52YXIgdXBncmFkZUlzc3VlcktpdCA9IChpc3N1ZXJCYWdnYWdlLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwLCByZWNvdmVyeVNldHNPcHRpb24gPSB2b2lkIDApID0+IHtcbiAgY29uc3QgaXNzdWVyUmVjb3JkID0gaXNzdWVyQmFnZ2FnZS5nZXQoSU5TVEFOQ0VfS0VZKTtcbiAgY29uc3QgaXNzdWVyWm9uZSA9IG1ha2VEdXJhYmxlWm9uZShpc3N1ZXJCYWdnYWdlKTtcbiAgY29uc3Qgb2xkUmVjb3ZlcnlTZXRzU3RhdGUgPSBpc3N1ZXJCYWdnYWdlLmhhcyhSRUNPVkVSWV9TRVRTX1NUQVRFKSA/IGlzc3VlckJhZ2dhZ2UuZ2V0KFJFQ09WRVJZX1NFVFNfU1RBVEUpIDogXCJoYXNSZWNvdmVyeVNldHNcIjtcbiAgaWYgKG9sZFJlY292ZXJ5U2V0c1N0YXRlID09PSBcIm5vUmVjb3ZlcnlTZXRzXCIgJiYgcmVjb3ZlcnlTZXRzT3B0aW9uID09PSBcImhhc1JlY292ZXJ5U2V0c1wiKSB7XG4gICAgdGhyb3dSZWRhY3RlZGBDYW5ub3QgKHlldD8pIHVwZ3JhZGUgZnJvbSAnbm9SZWNvdmVyeVNldHMnIHRvICdoYXNSZWNvdmVyeVNldHMnYDtcbiAgfVxuICBjb25zdCByZWNvdmVyeVNldHNTdGF0ZSA9IHJlY292ZXJ5U2V0c09wdGlvbiB8fCBvbGRSZWNvdmVyeVNldHNTdGF0ZTtcbiAgcmV0dXJuIHNldHVwSXNzdWVyS2l0KFxuICAgIGlzc3VlclJlY29yZCxcbiAgICBpc3N1ZXJab25lLFxuICAgIHJlY292ZXJ5U2V0c1N0YXRlLFxuICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmVcbiAgKTtcbn07XG5oYXJkZW4odXBncmFkZUlzc3VlcktpdCk7XG52YXIgaGFzSXNzdWVyID0gKGJhZ2dhZ2UpID0+IGJhZ2dhZ2UuaGFzKElOU1RBTkNFX0tFWSk7XG52YXIgbWFrZUR1cmFibGVJc3N1ZXJLaXQgPSAoaXNzdWVyQmFnZ2FnZSwgbmFtZSwgYXNzZXRLaW5kID0gQXNzZXRLaW5kLk5BVCwgZGlzcGxheUluZm8gPSBoYXJkZW4oe30pLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwLCB7IGVsZW1lbnRTaGFwZSA9IHZvaWQgMCwgcmVjb3ZlcnlTZXRzT3B0aW9uID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBpc3N1ZXJEYXRhID0gaGFyZGVuKHtcbiAgICBuYW1lLFxuICAgIGFzc2V0S2luZCxcbiAgICBkaXNwbGF5SW5mbyxcbiAgICBlbGVtZW50U2hhcGVcbiAgfSk7XG4gIGlzc3VlckJhZ2dhZ2UuaW5pdChJTlNUQU5DRV9LRVksIGlzc3VlckRhdGEpO1xuICBjb25zdCBpc3N1ZXJab25lID0gbWFrZUR1cmFibGVab25lKGlzc3VlckJhZ2dhZ2UpO1xuICBjb25zdCByZWNvdmVyeVNldHNTdGF0ZSA9IHJlY292ZXJ5U2V0c09wdGlvbiB8fCBcImhhc1JlY292ZXJ5U2V0c1wiO1xuICBpc3N1ZXJCYWdnYWdlLmluaXQoUkVDT1ZFUllfU0VUU19TVEFURSwgcmVjb3ZlcnlTZXRzU3RhdGUpO1xuICByZXR1cm4gc2V0dXBJc3N1ZXJLaXQoXG4gICAgaXNzdWVyRGF0YSxcbiAgICBpc3N1ZXJab25lLFxuICAgIHJlY292ZXJ5U2V0c1N0YXRlLFxuICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmVcbiAgKTtcbn07XG5oYXJkZW4obWFrZUR1cmFibGVJc3N1ZXJLaXQpO1xudmFyIHByZXBhcmVJc3N1ZXJLaXQgPSAoaXNzdWVyQmFnZ2FnZSwgbmFtZSwgYXNzZXRLaW5kID0gQXNzZXRLaW5kLk5BVCwgZGlzcGxheUluZm8gPSBoYXJkZW4oe30pLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwLCBvcHRpb25zID0ge30pID0+IHtcbiAgaWYgKGhhc0lzc3Vlcihpc3N1ZXJCYWdnYWdlKSkge1xuICAgIGNvbnN0IHsgZWxlbWVudFNoYXBlOiBfID0gdm9pZCAwLCByZWNvdmVyeVNldHNPcHRpb24gPSB2b2lkIDAgfSA9IG9wdGlvbnM7XG4gICAgY29uc3QgaXNzdWVyS2l0ID0gdXBncmFkZUlzc3VlcktpdChcbiAgICAgIGlzc3VlckJhZ2dhZ2UsXG4gICAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlLFxuICAgICAgcmVjb3ZlcnlTZXRzT3B0aW9uXG4gICAgKTtcbiAgICByZXR1cm4gaXNzdWVyS2l0O1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGlzc3VlcktpdCA9IG1ha2VEdXJhYmxlSXNzdWVyS2l0KFxuICAgICAgaXNzdWVyQmFnZ2FnZSxcbiAgICAgIG5hbWUsXG4gICAgICBhc3NldEtpbmQsXG4gICAgICBkaXNwbGF5SW5mbyxcbiAgICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmUsXG4gICAgICBvcHRpb25zXG4gICAgKTtcbiAgICByZXR1cm4gaXNzdWVyS2l0O1xuICB9XG59O1xuaGFyZGVuKHByZXBhcmVJc3N1ZXJLaXQpO1xudmFyIG1ha2VJc3N1ZXJLaXQgPSAobmFtZSwgYXNzZXRLaW5kID0gQXNzZXRLaW5kLk5BVCwgZGlzcGxheUluZm8gPSBoYXJkZW4oe30pLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwLCB7IGVsZW1lbnRTaGFwZSA9IHZvaWQgMCwgcmVjb3ZlcnlTZXRzT3B0aW9uID0gdm9pZCAwIH0gPSB7fSkgPT4gKFxuICAvL1xuICBtYWtlRHVyYWJsZUlzc3VlcktpdChcbiAgICBtYWtlU2NhbGFyQmlnTWFwU3RvcmUoXCJkcm9wcGVkIGlzc3VlciBraXRcIiwgeyBkdXJhYmxlOiB0cnVlIH0pLFxuICAgIG5hbWUsXG4gICAgYXNzZXRLaW5kLFxuICAgIGRpc3BsYXlJbmZvLFxuICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmUsXG4gICAgeyBlbGVtZW50U2hhcGUsIHJlY292ZXJ5U2V0c09wdGlvbiB9XG4gIClcbik7XG5oYXJkZW4obWFrZUlzc3VlcktpdCk7XG5cbi8vXG52YXIgUHVibGljVG9waWNTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBzdWJzY3JpYmVyOiBTdWJzY3JpYmVyU2hhcGUsXG4gICAgc3RvcmFnZVBhdGg6IE0ub3IoTS5wcm9taXNlKFxuICAgICAgLyogICAgICAgICovXG4gICAgKSwgTS5zdHJpbmcoKSlcbiAgfSxcbiAgeyBkZXNjcmlwdGlvbjogTS5zdHJpbmcoKSB9XG4pO1xudmFyIFRvcGljc1JlY29yZFNoYXBlID0gTS5yZWNvcmRPZihNLnN0cmluZygpLCBQdWJsaWNUb3BpY1NoYXBlKTtcblxuLy9cbnZhciB7IFZvdyQ6IFZvdyQyIH0gPSBTaGFwZTtcbnZhciBvcmNoZXN0cmF0aW9uQWNjb3VudE1ldGhvZHMgPSB7XG4gIGdldEFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpLFxuICBnZXRCYWxhbmNlOiBNLmNhbGwoTS5vcihCcmFuZFNoYXBlLCBNLnN0cmluZygpKSkucmV0dXJucyhcbiAgICBWb3ckMihEZW5vbUFtb3VudFNoYXBlKVxuICApLFxuICBnZXRCYWxhbmNlczogTS5jYWxsKCkucmV0dXJucyhWb3ckMihNLmFycmF5T2YoRGVub21BbW91bnRTaGFwZSkpKSxcbiAgc2VuZDogTS5jYWxsKEFjY291bnRJZEFyZ1NoYXBlLCBBbW91bnRBcmdTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIHNlbmRBbGw6IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSwgTS5hcnJheU9mKEFtb3VudEFyZ1NoYXBlKSkucmV0dXJucyhcbiAgICBWb3dTaGFwZVxuICApLFxuICB0cmFuc2ZlcjogTS5jYWxsKEFjY291bnRJZEFyZ1NoYXBlLCBBbW91bnRBcmdTaGFwZSkub3B0aW9uYWwoSUJDVHJhbnNmZXJPcHRpb25zU2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICB0cmFuc2ZlclN0ZXBzOiBNLmNhbGwoQW1vdW50QXJnU2hhcGUsIE0uYW55KCkpLnJldHVybnMoVm93U2hhcGUpLFxuICBhc0NvbnRpbnVpbmdPZmZlcjogTS5jYWxsKCkucmV0dXJucyhcbiAgICBWb3ckMih7XG4gICAgICBwdWJsaWNTdWJzY3JpYmVyczogVG9waWNzUmVjb3JkU2hhcGUsXG4gICAgICBpbnZpdGF0aW9uTWFrZXJzOiBNLmFueSgpLFxuICAgICAgaG9sZGVyOiBNLnJlbW90YWJsZSgpXG4gICAgfSlcbiAgKSxcbiAgZ2V0UHVibGljVG9waWNzOiBNLmNhbGwoKS5yZXR1cm5zKFZvdyQyKFRvcGljc1JlY29yZFNoYXBlKSlcbn07XG5cbi8vXG52YXIgVGltZXJCcmFuZFNoYXBlID0gTS5yZW1vdGFibGUoXCJUaW1lckJyYW5kXCIpO1xudmFyIFRpbWVzdGFtcFZhbHVlU2hhcGUgPSBNLm5hdCgpO1xudmFyIFJlbGF0aXZlVGltZVZhbHVlU2hhcGUgPSBNLm5hdCgpO1xudmFyIFRpbWVzdGFtcFJlY29yZFNoYXBlID0ge1xuICB0aW1lckJyYW5kOiBUaW1lckJyYW5kU2hhcGUsXG4gIGFic1ZhbHVlOiBUaW1lc3RhbXBWYWx1ZVNoYXBlXG59O1xuaGFyZGVuKFRpbWVzdGFtcFJlY29yZFNoYXBlKTtcbnZhciBSZWxhdGl2ZVRpbWVSZWNvcmRTaGFwZSA9IHtcbiAgdGltZXJCcmFuZDogVGltZXJCcmFuZFNoYXBlLFxuICByZWxWYWx1ZTogUmVsYXRpdmVUaW1lVmFsdWVTaGFwZVxufTtcbmhhcmRlbihSZWxhdGl2ZVRpbWVSZWNvcmRTaGFwZSk7XG52YXIgVGltZXN0YW1wU2hhcGUgPSBNLm9yKFRpbWVzdGFtcFJlY29yZFNoYXBlLCBUaW1lc3RhbXBWYWx1ZVNoYXBlKTtcbnZhciBSZWxhdGl2ZVRpbWVTaGFwZSA9IE0ub3IoXG4gIFJlbGF0aXZlVGltZVJlY29yZFNoYXBlLFxuICBSZWxhdGl2ZVRpbWVWYWx1ZVNoYXBlXG4pO1xudmFyIFRpbWVyU2VydmljZVNoYXBlID0gTS5yZW1vdGFibGUoXCJUaW1lclNlcnZpY2VcIik7XG5cbi8vXG52YXIgYWdyZWVkVGltZXJCcmFuZCA9IChsZWZ0QnJhbmQsIHJpZ2h0QnJhbmQpID0+IHtcbiAgaWYgKGxlZnRCcmFuZCA9PT0gdm9pZCAwKSB7XG4gICAgaWYgKHJpZ2h0QnJhbmQgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHJpZ2h0QnJhbmQ7XG4gICAgfVxuICB9IGVsc2UgaWYgKHJpZ2h0QnJhbmQgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiBsZWZ0QnJhbmQ7XG4gIH0gZWxzZSB7XG4gICAgbGVmdEJyYW5kID09PSByaWdodEJyYW5kIHx8IHRocm93UmVkYWN0ZWRgVGltZXJCcmFuZHMgbXVzdCBtYXRjaDogJHtxdW90ZShsZWZ0QnJhbmQpfSB2cyAke3F1b3RlKHJpZ2h0QnJhbmQpfWA7XG4gICAgcmV0dXJuIGxlZnRCcmFuZDtcbiAgfVxufTtcbnZhciBzaGFyZWRUaW1lckJyYW5kID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gIGNvbnN0IGxlZnRCcmFuZCA9IHR5cGVvZiBsZWZ0ID09PSBcImJpZ2ludFwiID8gdm9pZCAwIDogbGVmdC50aW1lckJyYW5kO1xuICBjb25zdCByaWdodEJyYW5kID0gdHlwZW9mIHJpZ2h0ID09PSBcImJpZ2ludFwiID8gdm9pZCAwIDogcmlnaHQudGltZXJCcmFuZDtcbiAgcmV0dXJuIGFncmVlZFRpbWVyQnJhbmQobGVmdEJyYW5kLCByaWdodEJyYW5kKTtcbn07XG52YXIgYWJzTGlrZSA9IChsZWZ0LCByaWdodCwgYWJzVmFsdWUyKSA9PiB7XG4gIE5hdChhYnNWYWx1ZTIpO1xuICBjb25zdCB0aW1lckJyYW5kID0gc2hhcmVkVGltZXJCcmFuZChsZWZ0LCByaWdodCk7XG4gIGlmICh0aW1lckJyYW5kKSB7XG4gICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICB0aW1lckJyYW5kLFxuICAgICAgYWJzVmFsdWU6IGFic1ZhbHVlMlxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBhYnNWYWx1ZTI7XG4gIH1cbn07XG52YXIgcmVsTGlrZSA9IChsZWZ0LCByaWdodCwgcmVsVmFsdWUyKSA9PiB7XG4gIE5hdChyZWxWYWx1ZTIpO1xuICBjb25zdCB0aW1lckJyYW5kID0gc2hhcmVkVGltZXJCcmFuZChsZWZ0LCByaWdodCk7XG4gIGlmICh0aW1lckJyYW5kKSB7XG4gICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICB0aW1lckJyYW5kLFxuICAgICAgcmVsVmFsdWU6IHJlbFZhbHVlMlxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiByZWxWYWx1ZTI7XG4gIH1cbn07XG52YXIgYWJzVmFsdWUgPSAoYWJzKSA9PiB7XG4gIGlmICh0eXBlb2YgYWJzID09PSBcImJpZ2ludFwiKSB7XG4gICAgcmV0dXJuIE5hdChhYnMpO1xuICB9XG4gIG11c3RNYXRjaDIoYWJzLCBUaW1lc3RhbXBSZWNvcmRTaGFwZSwgXCJ0aW1lc3RhbXBcIik7XG4gIHJldHVybiBOYXQoYWJzLmFic1ZhbHVlKTtcbn07XG52YXIgcmVsVmFsdWUgPSAocmVsKSA9PiB7XG4gIGlmICh0eXBlb2YgcmVsID09PSBcImJpZ2ludFwiKSB7XG4gICAgcmV0dXJuIE5hdChyZWwpO1xuICB9XG4gIG11c3RNYXRjaDIocmVsLCBSZWxhdGl2ZVRpbWVSZWNvcmRTaGFwZSwgXCJyZWxhdGl2ZVwiKTtcbiAgcmV0dXJuIE5hdChyZWwucmVsVmFsdWUpO1xufTtcbnZhciBtYWtlVGltZXN0YW1wUmVjb3JkID0gKGFicywgdGltZXJCcmFuZCkgPT4gaGFyZGVuKHsgYWJzVmFsdWU6IGFicywgdGltZXJCcmFuZCB9KTtcbnZhciBtYWtlUmVsYXRpdmVUaW1lUmVjb3JkID0gKHJlbCwgdGltZXJCcmFuZCkgPT4gaGFyZGVuKHsgcmVsVmFsdWU6IHJlbCwgdGltZXJCcmFuZCB9KTtcbnZhciBjb2VyY2VUaW1lc3RhbXBSZWNvcmQgPSAodHMsIGJyYW5kKSA9PiB7XG4gIGJyYW5kIHx8IHRocm93UmVkYWN0ZWRgbXVzdCBoYXZlIGEgYnJhbmRgO1xuICBpZiAodHlwZW9mIHRzID09PSBcIm51bWJlclwiKSB7XG4gICAgdHMgPSBOYXQodHMpO1xuICB9XG4gIGlmICh0eXBlb2YgdHMgPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4gbWFrZVRpbWVzdGFtcFJlY29yZCh0cywgYnJhbmQpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHsgdGltZXJCcmFuZCB9ID0gdHM7XG4gICAgbXVzdE1hdGNoMih0cywgVGltZXN0YW1wUmVjb3JkU2hhcGUsIFwidGltZXN0YW1wXCIpO1xuICAgIGFncmVlZFRpbWVyQnJhbmQodGltZXJCcmFuZCwgYnJhbmQpO1xuICAgIHJldHVybiB0cztcbiAgfVxufTtcbnZhciBjb2VyY2VSZWxhdGl2ZVRpbWVSZWNvcmQgPSAocnQsIGJyYW5kKSA9PiB7XG4gIGJyYW5kIHx8IHRocm93UmVkYWN0ZWRgbXVzdCBoYXZlIGEgYnJhbmRgO1xuICBpZiAodHlwZW9mIHJ0ID09PSBcIm51bWJlclwiKSB7XG4gICAgcnQgPSBOYXQocnQpO1xuICB9XG4gIGlmICh0eXBlb2YgcnQgPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4gbWFrZVJlbGF0aXZlVGltZVJlY29yZChydCwgYnJhbmQpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IHsgdGltZXJCcmFuZCB9ID0gcnQ7XG4gICAgbXVzdE1hdGNoMihydCwgUmVsYXRpdmVUaW1lUmVjb3JkU2hhcGUsIFwicmVsYXRpdmVUaW1lXCIpO1xuICAgIGFncmVlZFRpbWVyQnJhbmQodGltZXJCcmFuZCwgYnJhbmQpO1xuICAgIHJldHVybiBydDtcbiAgfVxufTtcbnZhciBhZGRBYnNSZWwgPSAoYWJzLCByZWwpID0+IGFic0xpa2UoYWJzLCByZWwsIGFic1ZhbHVlKGFicykgKyByZWxWYWx1ZShyZWwpKTtcbnZhciBhZGRSZWxSZWwgPSAocmVsMSwgcmVsMikgPT4gcmVsTGlrZShyZWwxLCByZWwyLCByZWxWYWx1ZShyZWwxKSArIHJlbFZhbHVlKHJlbDIpKTtcbnZhciBzdWJ0cmFjdEFic0FicyA9IChhYnMxLCBhYnMyKSA9PiByZWxMaWtlKGFiczEsIGFiczIsIGFic1ZhbHVlKGFiczEpIC0gYWJzVmFsdWUoYWJzMikpO1xudmFyIGNsYW1wZWRTdWJ0cmFjdEFic0FicyA9IChhYnMxLCBhYnMyKSA9PiB7XG4gIGNvbnN0IHZhbDEgPSBhYnNWYWx1ZShhYnMxKTtcbiAgY29uc3QgdmFsMiA9IGFic1ZhbHVlKGFiczIpO1xuICByZXR1cm4gcmVsTGlrZShhYnMxLCBhYnMyLCB2YWwxID4gdmFsMiA/IHZhbDEgLSB2YWwyIDogMG4pO1xufTtcbnZhciBzdWJ0cmFjdEFic1JlbCA9IChhYnMsIHJlbCkgPT4gYWJzTGlrZShhYnMsIHJlbCwgYWJzVmFsdWUoYWJzKSAtIHJlbFZhbHVlKHJlbCkpO1xudmFyIHN1YnRyYWN0UmVsUmVsID0gKHJlbDEsIHJlbDIpID0+IHJlbExpa2UocmVsMSwgcmVsMiwgcmVsVmFsdWUocmVsMSkgLSByZWxWYWx1ZShyZWwyKSk7XG52YXIgaXNSZWxaZXJvID0gKHJlbCkgPT4gcmVsVmFsdWUocmVsKSA9PT0gMG47XG52YXIgbXVsdGlwbHlSZWxOYXQgPSAocmVsLCBuYXQpID0+IHJlbExpa2UocmVsLCBuYXQsIHJlbFZhbHVlKHJlbCkgKiBuYXQpO1xudmFyIGRpdmlkZVJlbE5hdCA9IChyZWwsIG5hdCkgPT4gcmVsTGlrZShyZWwsIG5hdCwgcmVsVmFsdWUocmVsKSAvIG5hdCk7XG52YXIgZGl2aWRlUmVsUmVsID0gKHJlbDEsIHJlbDIpID0+IHtcbiAgc2hhcmVkVGltZXJCcmFuZChyZWwxLCByZWwyKTtcbiAgcmV0dXJuIHJlbFZhbHVlKHJlbDEpIC8gcmVsVmFsdWUocmVsMik7XG59O1xudmFyIG1vZEFic1JlbCA9IChhYnMsIHN0ZXApID0+IHJlbExpa2UoYWJzLCBzdGVwLCBhYnNWYWx1ZShhYnMpICUgcmVsVmFsdWUoc3RlcCkpO1xudmFyIG1vZFJlbFJlbCA9IChyZWwsIHN0ZXApID0+IHJlbExpa2UocmVsLCBzdGVwLCByZWxWYWx1ZShyZWwpICUgcmVsVmFsdWUoc3RlcCkpO1xudmFyIGNvbXBhcmVWYWx1ZXMgPSAobGVmdCwgcmlnaHQsIHYxLCB2MikgPT4ge1xuICBzaGFyZWRUaW1lckJyYW5kKGxlZnQsIHJpZ2h0KTtcbiAgaWYgKHYxIDwgdjIpIHtcbiAgICByZXR1cm4gLTE7XG4gIH0gZWxzZSBpZiAodjEgPT09IHYyKSB7XG4gICAgcmV0dXJuIDA7XG4gIH0gZWxzZSB7XG4gICAgYXNzZXJ0KHYxID4gdjIpO1xuICAgIHJldHVybiAxO1xuICB9XG59O1xudmFyIFRpbWVNYXRoID0gaGFyZGVuKHtcbiAgYWJzVmFsdWUsXG4gIHJlbFZhbHVlLFxuICBjb2VyY2VUaW1lc3RhbXBSZWNvcmQsXG4gIGNvZXJjZVJlbGF0aXZlVGltZVJlY29yZCxcbiAgLy9cbiAgYWRkQWJzUmVsLFxuICAvL1xuICBhZGRSZWxSZWwsXG4gIHN1YnRyYWN0QWJzQWJzLFxuICBjbGFtcGVkU3VidHJhY3RBYnNBYnMsXG4gIHN1YnRyYWN0QWJzUmVsLFxuICBzdWJ0cmFjdFJlbFJlbCxcbiAgaXNSZWxaZXJvLFxuICBtdWx0aXBseVJlbE5hdCxcbiAgZGl2aWRlUmVsTmF0LFxuICBkaXZpZGVSZWxSZWwsXG4gIG1vZEFic1JlbCxcbiAgbW9kUmVsUmVsLFxuICBjb21wYXJlQWJzOiAoYWJzMSwgYWJzMikgPT4gY29tcGFyZVZhbHVlcyhhYnMxLCBhYnMyLCBhYnNWYWx1ZShhYnMxKSwgYWJzVmFsdWUoYWJzMikpLFxuICBjb21wYXJlUmVsOiAocmVsMSwgcmVsMikgPT4gY29tcGFyZVZhbHVlcyhyZWwxLCByZWwyLCByZWxWYWx1ZShyZWwxKSwgcmVsVmFsdWUocmVsMikpXG59KTtcblxuLy9cbnZhciBTRUNPTkRTX1BFUl9NSU5VVEUgPSA2MG47XG52YXIgTkFOT1NFQ09ORFNfUEVSX1NFQ09ORCA9IDEwMDAwMDAwMDBuO1xuZnVuY3Rpb24gbWFrZVRpbWVzdGFtcEhlbHBlcih0aW1lcikge1xuICBjb25zdCBzZWxmID0gaGFyZGVuKHtcbiAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIGFzeW5jIGdldFRpbWVvdXRUaW1lc3RhbXBOUyhzZWNvbmRzSW5GdXR1cmUgPSBTRUNPTkRTX1BFUl9NSU5VVEUgKiA1bikge1xuICAgICAgY29uc3QgY3VycmVudFRpbWUgPSBhd2FpdCBFKHRpbWVyKS5nZXRDdXJyZW50VGltZXN0YW1wKCk7XG4gICAgICBjb25zdCB0aW1lb3V0ID0gVGltZU1hdGguY29lcmNlUmVsYXRpdmVUaW1lUmVjb3JkKFxuICAgICAgICBzZWNvbmRzSW5GdXR1cmUsXG4gICAgICAgIGN1cnJlbnRUaW1lLnRpbWVyQnJhbmRcbiAgICAgICk7XG4gICAgICByZXR1cm4gVGltZU1hdGguYWRkQWJzUmVsKGN1cnJlbnRUaW1lLCB0aW1lb3V0KS5hYnNWYWx1ZSAqIE5BTk9TRUNPTkRTX1BFUl9TRUNPTkQ7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHZvd09yVmFsdWVGcm9tT3B0cyhvcHRzKSB7XG4gICAgICBpZiAob3B0cyAmJiBcInRpbWVvdXRUaW1lc3RhbXBcIiBpbiBvcHRzKSByZXR1cm4gb3B0cy50aW1lb3V0VGltZXN0YW1wO1xuICAgICAgaWYgKG9wdHMgJiYgXCJ0aW1lb3V0SGVpZ2h0XCIgaW4gb3B0cykgcmV0dXJuIDBuO1xuICAgICAgcmV0dXJuIHNlbGYuZ2V0VGltZW91dFRpbWVzdGFtcE5TKFxuICAgICAgICBvcHRzICYmIFwidGltZW91dFJlbGF0aXZlU2Vjb25kc1wiIGluIG9wdHMgPyBvcHRzLnRpbWVvdXRSZWxhdGl2ZVNlY29uZHMgOiB2b2lkIDBcbiAgICAgICk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHNlbGY7XG59XG5cbi8vXG52YXIgdHJhY2UzID0gbWFrZVRyYWNlcihcIkNvc21vc09yY2hBY2NvdW50XCIpO1xudmFyIHsgVm93JDogVm93JDMgfSA9IFNoYXBlO1xudmFyIGRlY29kZUljcVJlc3VsdCA9IChjb2RlYywgcmVzdWx0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgYnl0ZXMyID0gZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkgfHwgcmVzdWx0LnZhbHVlKTtcbiAgICByZXR1cm4gY29kZWMuZGVjb2RlKGJ5dGVzMik7XG4gIH0gY2F0Y2ggKGNhdXNlKSB7XG4gICAgdGhyb3cgbWFrZUVycm9yKFxuICAgICAgYEZhaWxlZCB0byBwYXJzZSAke2NvZGVjLnR5cGVVcmx9IGZyb20gcmVzdWx0ICR7cXVvdGUocmVzdWx0KX1gLFxuICAgICAgdm9pZCAwLFxuICAgICAgeyBjYXVzZSB9XG4gICAgKTtcbiAgfVxufTtcbnZhciBzdGFraW5nQWNjb3VudEFjdGlvbnNNZXRob2RzID0ge1xuICBkZWxlZ2F0ZTogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlLCBBbW91bnRBcmdTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIHJlZGVsZWdhdGU6IE0uY2FsbChcbiAgICBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICBBbW91bnRBcmdTaGFwZVxuICApLnJldHVybnMoVm93U2hhcGUpLFxuICB1bmRlbGVnYXRlOiBNLmNhbGwoTS5hcnJheU9mKERlbGVnYXRpb25TaGFwZSkpLnJldHVybnMoVm93U2hhcGUpLFxuICB3aXRoZHJhd1Jld2FyZDogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlKS5yZXR1cm5zKFxuICAgIFZvdyQzKE0uYXJyYXlPZihEZW5vbUFtb3VudFNoYXBlKSlcbiAgKSxcbiAgd2l0aGRyYXdSZXdhcmRzOiBNLmNhbGwoKS5yZXR1cm5zKFZvdyQzKE0uYXJyYXlPZihEZW5vbUFtb3VudFNoYXBlKSkpXG59O1xudmFyIHN0YWtpbmdBY2NvdW50UXVlcmllc01ldGhvZHMgPSB7XG4gIGdldERlbGVnYXRpb246IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldERlbGVnYXRpb25zOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0VW5ib25kaW5nRGVsZWdhdGlvbjogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0VW5ib25kaW5nRGVsZWdhdGlvbnM6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpLFxuICBnZXRSZWRlbGVnYXRpb25zOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0UmV3YXJkOiBNLmNhbGwoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICBnZXRSZXdhcmRzOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKVxufTtcbnZhciBub2JsZU1ldGhvZHMgPSB7XG4gIGRlcG9zaXRGb3JCdXJuOiBNLmNhbGwoTS5zdHJpbmcoKSwgQW1vdW50QXJnU2hhcGUpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoVm93U2hhcGUpXG59O1xudmFyIEljYUFjY291bnRIb2xkZXJJID0gTS5pbnRlcmZhY2UoXCJJY2FBY2NvdW50SG9sZGVyXCIsIHtcbiAgLi4ubm9ibGVNZXRob2RzLFxuICAuLi5vcmNoZXN0cmF0aW9uQWNjb3VudE1ldGhvZHMsXG4gIC4uLnN0YWtpbmdBY2NvdW50QWN0aW9uc01ldGhvZHMsXG4gIC4uLnN0YWtpbmdBY2NvdW50UXVlcmllc01ldGhvZHMsXG4gIGRlYWN0aXZhdGU6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpLFxuICByZWFjdGl2YXRlOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZXhlY3V0ZUVuY29kZWRUeDogTS5jYWxsKE0uYXJyYXlPZihQcm90bzNTaGFwZSkpLm9wdGlvbmFsKEV4ZWN1dGVJQ0FUeE9wdHNTaGFwZSkucmV0dXJucyhWb3dTaGFwZSlcbn0pO1xudmFyIFBVQkxJQ19UT1BJQ1MgPSB7XG4gIGFjY291bnQ6IFtcIlN0YWtpbmcgQWNjb3VudCBob2xkZXIgc3RhdHVzXCIsIE0uYW55KCldXG59O1xudmFyIENvc21vc09yY2hlc3RyYXRpb25JbnZpdGF0aW9uTWFrZXJzSSA9IE0uaW50ZXJmYWNlKFxuICBcImludml0YXRpb25NYWtlcnNcIixcbiAge1xuICAgIERlbGVnYXRlOiBNLmNhbGwoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsIEFtb3VudEFyZ1NoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5wcm9taXNlKClcbiAgICApLFxuICAgIFJlZGVsZWdhdGU6IE0uY2FsbChcbiAgICAgIENvc21vc0NoYWluQWRkcmVzc1NoYXBlLFxuICAgICAgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsXG4gICAgICBBbW91bnRBcmdTaGFwZVxuICAgICkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgV2l0aGRyYXdSZXdhcmQ6IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgVW5kZWxlZ2F0ZTogTS5jYWxsKE0uYXJyYXlPZihEZWxlZ2F0aW9uU2hhcGUpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICBEZWFjdGl2YXRlQWNjb3VudDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgUmVhY3RpdmF0ZUFjY291bnQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFRyYW5zZmVyQWNjb3VudDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgU2VuZDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgU2VuZEFsbDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgVHJhbnNmZXI6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpXG4gIH1cbik7XG5oYXJkZW4oQ29zbW9zT3JjaGVzdHJhdGlvbkludml0YXRpb25NYWtlcnNJKTtcbnZhciBwcmVwYXJlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnRLaXQgPSAoem9uZSwge1xuICBjaGFpbkh1YixcbiAgbWFrZVJlY29yZGVyS2l0LFxuICB0aW1lclNlcnZpY2UsXG4gIHZvd1Rvb2xzOiB7IHdhdGNoLCBhc1Zvdywgd2hlbiwgYWxsVm93cyB9LFxuICB6Y2Zcbn0pID0+IHtcbiAgY29uc3QgdGltZXN0YW1wSGVscGVyID0gbWFrZVRpbWVzdGFtcEhlbHBlcih0aW1lclNlcnZpY2UpO1xuICBjb25zdCBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnRLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiQ29zbW9zIE9yY2hlc3RyYXRpb24gQWNjb3VudCBIb2xkZXJcIixcbiAgICB7XG4gICAgICBoZWxwZXI6IE0uaW50ZXJmYWNlKFwiaGVscGVyXCIsIHtcbiAgICAgICAgb3duZWQ6IE0uY2FsbCgpLnJldHVybnMoTS5yZW1vdGFibGUoKSksXG4gICAgICAgIGdldFVwZGF0ZXI6IE0uY2FsbCgpLnJldHVybnMoTS5yZW1vdGFibGUoKSksXG4gICAgICAgIGFtb3VudFRvQ29pbjogTS5jYWxsKEFtb3VudEFyZ1NoYXBlKS5yZXR1cm5zKE0ucmVjb3JkKCkpXG4gICAgICB9KSxcbiAgICAgIHJldHVyblZvaWRXYXRjaGVyOiBNLmludGVyZmFjZShcInJldHVyblZvaWRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS51bmRlZmluZWQoKSlcbiAgICAgIH0pLFxuICAgICAgYmFsYW5jZVF1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJiYWxhbmNlUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhNLm9yKE0ucmVjb3JkKCksIE0udW5kZWZpbmVkKCkpKVxuICAgICAgfSksXG4gICAgICBhbGxCYWxhbmNlc1F1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJhbGxCYWxhbmNlc1F1ZXJ5V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5yZXR1cm5zKFxuICAgICAgICAgIE0uYXJyYXlPZihNLnJlY29yZCgpKVxuICAgICAgICApXG4gICAgICB9KSxcbiAgICAgIHVuZGVsZWdhdGVXYXRjaGVyOiBNLmludGVyZmFjZShcInVuZGVsZWdhdGVXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnN0cmluZygpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoVm93JDMoTS5wcm9taXNlKCkpKVxuICAgICAgfSksXG4gICAgICB3aXRoZHJhd1Jld2FyZFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwid2l0aGRyYXdSZXdhcmRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnN0cmluZygpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS5hcnJheU9mKERlbm9tQW1vdW50U2hhcGUpKVxuICAgICAgfSksXG4gICAgICB0cmFuc2ZlcldhdGNoZXI6IE0uaW50ZXJmYWNlKFwidHJhbnNmZXJXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbTS5yZWNvcmQoKSwgTS5uYXQoKV0pLm9wdGlvbmFsKHtcbiAgICAgICAgICBkZXN0aW5hdGlvbjogQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsXG4gICAgICAgICAgb3B0czogTS5vcihNLnVuZGVmaW5lZCgpLCBJQkNUcmFuc2Zlck9wdGlvbnNTaGFwZSksXG4gICAgICAgICAgdG9rZW46IHtcbiAgICAgICAgICAgIGRlbm9tOiBNLnN0cmluZygpLFxuICAgICAgICAgICAgYW1vdW50OiBNLnN0cmluZygpXG4gICAgICAgICAgfVxuICAgICAgICB9KS5yZXR1cm5zKFZvdyQzKE0ucmVjb3JkKCkpKVxuICAgICAgfSksXG4gICAgICBkZWxlZ2F0aW9uUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcImRlbGVnYXRpb25RdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhNLnJlY29yZCgpKVxuICAgICAgfSksXG4gICAgICBkZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJkZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5yZXR1cm5zKFxuICAgICAgICAgIE0uYXJyYXlPZihNLnJlY29yZCgpKVxuICAgICAgICApXG4gICAgICB9KSxcbiAgICAgIHVuYm9uZGluZ0RlbGVnYXRpb25RdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgICBcInVuYm9uZGluZ0RlbGVnYXRpb25RdWVyeVdhdGNoZXJcIixcbiAgICAgICAge1xuICAgICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5yZXR1cm5zKE0ucmVjb3JkKCkpXG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICB1bmJvbmRpbmdEZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICAgIFwidW5ib25kaW5nRGVsZWdhdGlvbnNRdWVyeVdhdGNoZXJcIixcbiAgICAgICAge1xuICAgICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5yZXR1cm5zKFxuICAgICAgICAgICAgTS5hcnJheU9mKE0ucmVjb3JkKCkpXG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgcmVkZWxlZ2F0aW9uUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcInJlZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5yZXR1cm5zKFxuICAgICAgICAgIE0uYXJyYXlPZihNLnJlY29yZCgpKVxuICAgICAgICApXG4gICAgICB9KSxcbiAgICAgIHJlZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmVkZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5yZXR1cm5zKFxuICAgICAgICAgIE0uYXJyYXlPZihNLnJlY29yZCgpKVxuICAgICAgICApXG4gICAgICB9KSxcbiAgICAgIHJld2FyZFF1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZXdhcmRRdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICByZXdhcmRzUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcInJld2FyZHNRdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhNLnJlY29yZCgpKVxuICAgICAgfSksXG4gICAgICBob2xkZXI6IEljYUFjY291bnRIb2xkZXJJLFxuICAgICAgaW52aXRhdGlvbk1ha2VyczogQ29zbW9zT3JjaGVzdHJhdGlvbkludml0YXRpb25NYWtlcnNJXG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgKHsgY2hhaW5BZGRyZXNzLCBsb2NhbEFkZHJlc3MsIHJlbW90ZUFkZHJlc3MgfSwgaW8pID0+IHtcbiAgICAgIHRyYWNlMyhcImNvc21vcyBvcmNoIGFjY3QgaW5pdFwiLCB7XG4gICAgICAgIGNoYWluQWRkcmVzcyxcbiAgICAgICAgbG9jYWxBZGRyZXNzLFxuICAgICAgICByZW1vdGVBZGRyZXNzXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHsgc3RvcmFnZU5vZGUgfSA9IGlvO1xuICAgICAgY29uc3QgdG9waWNLaXQgPSBzdG9yYWdlTm9kZSA/IG1ha2VSZWNvcmRlcktpdChzdG9yYWdlTm9kZSwgUFVCTElDX1RPUElDUy5hY2NvdW50WzFdKSA6IHZvaWQgMDtcbiAgICAgIGlmICh0b3BpY0tpdCkge1xuICAgICAgICB2b2lkIEUodG9waWNLaXQucmVjb3JkZXIpLndyaXRlKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAge1xuICAgICAgICAgICAgbG9jYWxBZGRyZXNzLFxuICAgICAgICAgICAgcmVtb3RlQWRkcmVzc1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgYWNjb3VudCwgaWNxQ29ubmVjdGlvbiwgdGltZXIgfSA9IGlvO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWNjb3VudCxcbiAgICAgICAgY2hhaW5BZGRyZXNzLFxuICAgICAgICBpY3FDb25uZWN0aW9uLFxuICAgICAgICBsb2NhbEFkZHJlc3MsXG4gICAgICAgIHJlbW90ZUFkZHJlc3MsXG4gICAgICAgIHRpbWVyLFxuICAgICAgICB0b3BpY0tpdFxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGhlbHBlcjoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvd25lZCgpIHtcbiAgICAgICAgICBjb25zdCB7IGFjY291bnQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKCFhY2NvdW50KSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFVzaW5nIGFjY291bnQgaG9sZGVyIGFmdGVyIHRyYW5zZmVyYDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGFjY291bnQ7XG4gICAgICAgIH0sXG4gICAgICAgIGdldFVwZGF0ZXIoKSB7XG4gICAgICAgICAgaWYgKCF0aGlzLnN0YXRlLnRvcGljS2l0KSB0aHJvdyB0aHJvd1JlZGFjdGVkYG5vIHRvcGljS2l0YDtcbiAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS50b3BpY0tpdC5yZWNvcmRlcjtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBhbW91bnRUb0NvaW4oYW1vdW50KSB7XG4gICAgICAgICAgIShcImJyYW5kXCIgaW4gYW1vdW50KSB8fCB0aHJvd1JlZGFjdGVkYCdhbW91bnRUb0NvaW4nIG5vdCB3b3JraW5nIGZvciAke3F1b3RlKGFtb3VudC5icmFuZCl9IHVudGlsICMxMDQ0OTsgdXNlICdEZW5vbUFtb3VudCcgZm9yIG5vd2A7XG4gICAgICAgICAgcmV0dXJuIGNvZXJjZUNvaW4oY2hhaW5IdWIsIGFtb3VudCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBiYWxhbmNlUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlIH0gPSBkZWNvZGVJY3FSZXN1bHQoUXVlcnlCYWxhbmNlUmVzcG9uc2UsIHJlc3VsdCk7XG4gICAgICAgICAgaWYgKCFiYWxhbmNlKSB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgYmFsYW5jZSBrZXk6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih0b0Rlbm9tQW1vdW50KGJhbGFuY2UpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlbGVnYXRpb25RdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGNvbnN0IHsgZGVsZWdhdGlvblJlc3BvbnNlIH0gPSBkZWNvZGVJY3FSZXN1bHQoXG4gICAgICAgICAgICBRdWVyeURlbGVnYXRpb25SZXNwb25zZSxcbiAgICAgICAgICAgIHJlc3VsdFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFkZWxlZ2F0aW9uUmVzcG9uc2UpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgZGVsZWdhdGlvblJlc3BvbnNlIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKFxuICAgICAgICAgICAgdG9Db3Ntb3NEZWxlZ2F0aW9uUmVzcG9uc2UoY2hhaW5BZGRyZXNzLCBkZWxlZ2F0aW9uUmVzcG9uc2UpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBjb25zdCB7IGRlbGVnYXRpb25SZXNwb25zZXMgfSA9IGRlY29kZUljcVJlc3VsdChcbiAgICAgICAgICAgIFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXNwb25zZSxcbiAgICAgICAgICAgIHJlc3VsdFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFkZWxlZ2F0aW9uUmVzcG9uc2VzKVxuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIGRlbGVnYXRpb25SZXNwb25zZXMga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oXG4gICAgICAgICAgICBkZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcChcbiAgICAgICAgICAgICAgKHI1KSA9PiB0b0Nvc21vc0RlbGVnYXRpb25SZXNwb25zZShjaGFpbkFkZHJlc3MsIHI1KVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB1bmJvbmRpbmdEZWxlZ2F0aW9uUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgY29uc3QgeyB1bmJvbmQgfSA9IGRlY29kZUljcVJlc3VsdChcbiAgICAgICAgICAgIFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlc3BvbnNlLFxuICAgICAgICAgICAgcmVzdWx0XG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXVuYm9uZCkgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIHVuYm9uZCBrZXk6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih1bmJvbmQpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdW5ib25kaW5nRGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBjb25zdCB7IHVuYm9uZGluZ1Jlc3BvbnNlcyB9ID0gZGVjb2RlSWNxUmVzdWx0KFxuICAgICAgICAgICAgUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1Jlc3BvbnNlLFxuICAgICAgICAgICAgcmVzdWx0XG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXVuYm9uZGluZ1Jlc3BvbnNlcylcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCB1bmJvbmRpbmdSZXNwb25zZXMga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4odW5ib25kaW5nUmVzcG9uc2VzKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGNvbnN0IHsgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzIH0gPSBkZWNvZGVJY3FSZXN1bHQoXG4gICAgICAgICAgICBRdWVyeVJlZGVsZWdhdGlvbnNSZXNwb25zZSxcbiAgICAgICAgICAgIHJlc3VsdFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFyZWRlbGVnYXRpb25SZXNwb25zZXMpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHJlZGVsZWdhdGlvblJlc3BvbnNlcyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZWRlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgY29uc3QgeyByZWRlbGVnYXRpb25SZXNwb25zZXMgfSA9IGRlY29kZUljcVJlc3VsdChcbiAgICAgICAgICAgIFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlLFxuICAgICAgICAgICAgcmVzdWx0XG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXJlZGVsZWdhdGlvblJlc3BvbnNlcylcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCByZWRlbGVnYXRpb25SZXNwb25zZXMga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4ocmVkZWxlZ2F0aW9uUmVzcG9uc2VzKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJld2FyZFF1ZXJ5V2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGNvbnN0IHsgcmV3YXJkcyB9ID0gZGVjb2RlSWNxUmVzdWx0KFxuICAgICAgICAgICAgUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1Jlc3BvbnNlLFxuICAgICAgICAgICAgcmVzdWx0XG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXJld2FyZHMpIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCByZXdhcmRzIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHJld2FyZHMubWFwKHRvVHJ1bmNhdGVkRGVub21BbW91bnQpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJld2FyZHNRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGNvbnN0IHsgcmV3YXJkcywgdG90YWwgfSA9IGRlY29kZUljcVJlc3VsdChcbiAgICAgICAgICAgIFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1Jlc3BvbnNlLFxuICAgICAgICAgICAgcmVzdWx0XG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXJld2FyZHMgfHwgIXRvdGFsKVxuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIHJld2FyZHMgb3IgdG90YWwga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgcmV3YXJkczogcmV3YXJkcy5tYXAoKHJld2FyZCkgPT4gKHtcbiAgICAgICAgICAgICAgdmFsaWRhdG9yOiB0b0Nvc21vc1ZhbGlkYXRvckFkZHJlc3MocmV3YXJkLCBjaGFpbkFkZHJlc3MuY2hhaW5JZCksXG4gICAgICAgICAgICAgIHJld2FyZDogcmV3YXJkLnJld2FyZC5tYXAodG9UcnVuY2F0ZWREZW5vbUFtb3VudClcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgIHRvdGFsOiB0b3RhbC5tYXAodG9UcnVuY2F0ZWREZW5vbUFtb3VudClcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGFsbEJhbGFuY2VzUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlcyB9ID0gZGVjb2RlSWNxUmVzdWx0KFxuICAgICAgICAgICAgUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlLFxuICAgICAgICAgICAgcmVzdWx0XG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIWJhbGFuY2VzKSB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgYmFsYW5jZXMga2V5OiAke3F1b3RlKHJlc3VsdCl9YDtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKGJhbGFuY2VzLm1hcCgoY29pbikgPT4gdG9EZW5vbUFtb3VudChjb2luKSkpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdW5kZWxlZ2F0ZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0KSB7XG4gICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB0cnlEZWNvZGVSZXNwb25zZShcbiAgICAgICAgICAgIHJlc3VsdCxcbiAgICAgICAgICAgIE1zZ1VuZGVsZWdhdGVSZXNwb25zZS5mcm9tUHJvdG9Nc2dcbiAgICAgICAgICApO1xuICAgICAgICAgIHRyYWNlMyhcInVuZGVsZWdhdGUgcmVzcG9uc2VcIiwgcmVzcG9uc2UpO1xuICAgICAgICAgIGNvbnN0IHsgY29tcGxldGlvblRpbWUgfSA9IHJlc3BvbnNlO1xuICAgICAgICAgIGNvbXBsZXRpb25UaW1lIHx8IHRocm93UmVkYWN0ZWRgTm8gY29tcGxldGlvbiB0aW1lIHJlc3VsdCAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBFKHRoaXMuc3RhdGUudGltZXIpLndha2VBdChjb21wbGV0aW9uVGltZS5zZWNvbmRzICsgbWF4Q2xvY2tTa2V3KVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgcmV0dXJuVm9pZFdhdGNoZXI6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChyZXN1bHQpIHtcbiAgICAgICAgICB0cmFjZTMoXCJSZXN1bHRcIiwgcmVzdWx0KTtcbiAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2l0aGRyYXdSZXdhcmRXYXRjaGVyOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCkge1xuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gdHJ5RGVjb2RlUmVzcG9uc2UoXG4gICAgICAgICAgICByZXN1bHQsXG4gICAgICAgICAgICBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlLmZyb21Qcm90b01zZ1xuICAgICAgICAgICk7XG4gICAgICAgICAgdHJhY2UzKFwid2l0aGRyYXdSZXdhcmQgcmVzcG9uc2VcIiwgcmVzcG9uc2UpO1xuICAgICAgICAgIGNvbnN0IHsgYW1vdW50OiBjb2lucyB9ID0gcmVzcG9uc2U7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbihjb2lucy5tYXAodG9EZW5vbUFtb3VudCkpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdHJhbnNmZXJXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbeyB0cmFuc2ZlckNoYW5uZWwgfSwgdGltZW91dFRpbWVzdGFtcF0sIHsgb3B0cywgdG9rZW46IHRva2VuMiwgZGVzdGluYXRpb24gfSkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKHRoaXMuZmFjZXRzLmhlbHBlci5vd25lZCgpKS5leGVjdXRlRW5jb2RlZFR4KFtcbiAgICAgICAgICAgIEFueS50b0pTT04oXG4gICAgICAgICAgICAgIE1zZ1RyYW5zZmVyLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgIHNvdXJjZVBvcnQ6IHRyYW5zZmVyQ2hhbm5lbC5wb3J0SWQsXG4gICAgICAgICAgICAgICAgc291cmNlQ2hhbm5lbDogdHJhbnNmZXJDaGFubmVsLmNoYW5uZWxJZCxcbiAgICAgICAgICAgICAgICB0b2tlbjogdG9rZW4yLFxuICAgICAgICAgICAgICAgIHNlbmRlcjogdGhpcy5zdGF0ZS5jaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgcmVjZWl2ZXI6IGRlc3RpbmF0aW9uLnZhbHVlLFxuICAgICAgICAgICAgICAgIHRpbWVvdXRIZWlnaHQ6IG9wdHM/LnRpbWVvdXRIZWlnaHQgPz8ge1xuICAgICAgICAgICAgICAgICAgcmV2aXNpb25IZWlnaHQ6IDBuLFxuICAgICAgICAgICAgICAgICAgcmV2aXNpb25OdW1iZXI6IDBuXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aW1lb3V0VGltZXN0YW1wLFxuICAgICAgICAgICAgICAgIG1lbW86IG9wdHM/Lm1lbW8gPz8gXCJcIlxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgIF0pO1xuICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlcik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBpbnZpdGF0aW9uTWFrZXJzOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgRGVsZWdhdGUodmFsaWRhdG9yLCBhbW91bnQpIHtcbiAgICAgICAgICB0cmFjZTMoXCJEZWxlZ2F0ZVwiLCB2YWxpZGF0b3IsIGFtb3VudCk7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLmRlbGVnYXRlKHZhbGlkYXRvciwgYW1vdW50KSk7XG4gICAgICAgICAgfSwgXCJEZWxlZ2F0ZVwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFJlZGVsZWdhdGUoc3JjVmFsaWRhdG9yLCBkc3RWYWxpZGF0b3IsIGFtb3VudCkge1xuICAgICAgICAgIHRyYWNlMyhcIlJlZGVsZWdhdGVcIiwgc3JjVmFsaWRhdG9yLCBkc3RWYWxpZGF0b3IsIGFtb3VudCk7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmhvbGRlci5yZWRlbGVnYXRlKHNyY1ZhbGlkYXRvciwgZHN0VmFsaWRhdG9yLCBhbW91bnQpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sIFwiUmVkZWxlZ2F0ZVwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIFdpdGhkcmF3UmV3YXJkKHZhbGlkYXRvcikge1xuICAgICAgICAgIHRyYWNlMyhcIldpdGhkcmF3UmV3YXJkXCIsIHZhbGlkYXRvcik7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLndpdGhkcmF3UmV3YXJkKHZhbGlkYXRvcikpO1xuICAgICAgICAgIH0sIFwiV2l0aGRyYXdSZXdhcmRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFVuZGVsZWdhdGUoZGVsZWdhdGlvbnMpIHtcbiAgICAgICAgICB0cmFjZTMoXCJVbmRlbGVnYXRlXCIsIGRlbGVnYXRpb25zKTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIudW5kZWxlZ2F0ZShkZWxlZ2F0aW9ucykpO1xuICAgICAgICAgIH0sIFwiVW5kZWxlZ2F0ZVwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgRGVhY3RpdmF0ZUFjY291bnQoKSB7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLmRlYWN0aXZhdGUoKSk7XG4gICAgICAgICAgfSwgXCJEZWFjdGl2YXRlQWNjb3VudFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgUmVhY3RpdmF0ZUFjY291bnQoKSB7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLnJlYWN0aXZhdGUoKSk7XG4gICAgICAgICAgfSwgXCJSZWFjdGl2YXRlQWNjb3VudFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgU2VuZCgpIHtcbiAgICAgICAgICBjb25zdCBvZmZlckhhbmRsZXIgPSAoc2VhdCwgeyB0b0FjY291bnQsIGFtb3VudCB9KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIuc2VuZCh0b0FjY291bnQsIGFtb3VudCkpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihvZmZlckhhbmRsZXIsIFwiU2VuZFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgU2VuZEFsbCgpIHtcbiAgICAgICAgICBjb25zdCBvZmZlckhhbmRsZXIgPSAoc2VhdCwgeyB0b0FjY291bnQsIGFtb3VudHMgfSkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLnNlbmRBbGwodG9BY2NvdW50LCBhbW91bnRzKSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKG9mZmVySGFuZGxlciwgXCJTZW5kQWxsXCIpO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgVHJhbnNmZXJBY2NvdW50KCkge1xuICAgICAgICAgIHRocm93IEVycm9yKFwibm90IHlldCBpbXBsZW1lbnRlZFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgVHJhbnNmZXIoKSB7XG4gICAgICAgICAgY29uc3Qgb2ZmZXJIYW5kbGVyID0gKHNlYXQsIHsgYW1vdW50LCBkZXN0aW5hdGlvbiwgb3B0cyB9KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMuaG9sZGVyLnRyYW5zZmVyKGRlc3RpbmF0aW9uLCBhbW91bnQsIG9wdHMpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihvZmZlckhhbmRsZXIsIFwiVHJhbnNmZXJcIik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBob2xkZXI6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBhc0NvbnRpbnVpbmdPZmZlcigpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgbnVsbDtcbiAgICAgICAgICAgIGNvbnN0IHsgaG9sZGVyLCBpbnZpdGF0aW9uTWFrZXJzOiBpbSB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCBpbnZpdGF0aW9uTWFrZXJzID0gKFxuICAgICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgaW1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgcHVibGljU3Vic2NyaWJlcnM6IGF3YWl0IHdoZW4oaG9sZGVyLmdldFB1YmxpY1RvcGljcygpKSxcbiAgICAgICAgICAgICAgaW52aXRhdGlvbk1ha2Vyc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldFB1YmxpY1RvcGljcygpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgbnVsbDtcbiAgICAgICAgICAgIGNvbnN0IHsgdG9waWNLaXQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIXRvcGljS2l0KSB0aHJvdyB0aHJvd1JlZGFjdGVkYE5vIHRvcGljS2l0OyBzdG9yYWdlTm9kZSBub3QgcHJvdmlkZWRgO1xuICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgICAgICAgIGFjY291bnQ6IHtcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogUFVCTElDX1RPUElDUy5hY2NvdW50WzBdLFxuICAgICAgICAgICAgICAgIHN1YnNjcmliZXI6IHRvcGljS2l0LnN1YnNjcmliZXIsXG4gICAgICAgICAgICAgICAgc3RvcmFnZVBhdGg6IGF3YWl0IHRvcGljS2l0LnJlY29yZGVyLmdldFN0b3JhZ2VQYXRoKClcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRBZGRyZXNzKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmNoYWluQWRkcmVzcztcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZGVsZWdhdGUodmFsaWRhdG9yLCBhbW91bnQpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwiZGVsZWdhdGVcIiwgdmFsaWRhdG9yLCBhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBjb25zdCBhbW91bnRBc0NvaW4gPSBoZWxwZXIuYW1vdW50VG9Db2luKGFtb3VudCk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShoZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChbXG4gICAgICAgICAgICAgIEFueS50b0pTT04oXG4gICAgICAgICAgICAgICAgTXNnRGVsZWdhdGUudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyZXNzOiB2YWxpZGF0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtb3VudEFzQ29pblxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICByZWRlbGVnYXRlKHNyY1ZhbGlkYXRvciwgZHN0VmFsaWRhdG9yLCBhbW91bnQpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwicmVkZWxlZ2F0ZVwiLCBzcmNWYWxpZGF0b3IsIGRzdFZhbGlkYXRvciwgYW1vdW50KTtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoW1xuICAgICAgICAgICAgICBBbnkudG9KU09OKFxuICAgICAgICAgICAgICAgIE1zZ0JlZ2luUmVkZWxlZ2F0ZS50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIHZhbGlkYXRvclNyY0FkZHJlc3M6IHNyY1ZhbGlkYXRvci52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIHZhbGlkYXRvckRzdEFkZHJlc3M6IGRzdFZhbGlkYXRvci52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIGFtb3VudDogaGVscGVyLmFtb3VudFRvQ29pbihhbW91bnQpXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIHJlc3VsdHMsXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB3aXRoZHJhd1Jld2FyZCh2YWxpZGF0b3IpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwid2l0aGRyYXdSZXdhcmRcIiwgdmFsaWRhdG9yKTtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29uc3QgbXNnID0gTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmQudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgIGRlbGVnYXRvckFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcmVzczogdmFsaWRhdG9yLnZhbHVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IGFjY291bnQgPSBoZWxwZXIub3duZWQoKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGFjY291bnQpLmV4ZWN1dGVFbmNvZGVkVHgoW0FueS50b0pTT04obXNnKV0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLndpdGhkcmF3UmV3YXJkV2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRCYWxhbmNlKGRlbm9tKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzLCBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCFpY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluQWRkcmVzcy5jaGFpbklkKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaWNxQ29ubmVjdGlvbikucXVlcnkoW1xuICAgICAgICAgICAgICB0b1JlcXVlc3RRdWVyeUpzb24oXG4gICAgICAgICAgICAgICAgUXVlcnlCYWxhbmNlUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIGRlbm9tOiBjb2VyY2VEZW5vbShjaGFpbkh1YiwgZGVub20pXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMuYmFsYW5jZVF1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0QmFsYW5jZXMoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzLCBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCFpY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluQWRkcmVzcy5jaGFpbklkKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaWNxQ29ubmVjdGlvbikucXVlcnkoW1xuICAgICAgICAgICAgICB0b1JlcXVlc3RRdWVyeUpzb24oXG4gICAgICAgICAgICAgICAgUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3QudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBhZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5hbGxCYWxhbmNlc1F1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzZW5kKHRvQWNjb3VudCwgYW1vdW50KSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcInNlbmRcIiwgdG9BY2NvdW50LCBhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgY29zbW9zRGVzdCA9IGNoYWluSHViLmNvZXJjZUNvc21vc0FkZHJlc3ModG9BY2NvdW50KTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29zbW9zRGVzdC5jaGFpbklkID09PSBjaGFpbkFkZHJlc3MuY2hhaW5JZCB8fCB0aHJvd1JlZGFjdGVkYGJhbmsvc2VuZCBjYW5ub3Qgc2VuZCB0byBhIGRpZmZlcmVudCBjaGFpbiAke3F1b3RlKGNvc21vc0Rlc3QuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShoZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChbXG4gICAgICAgICAgICAgICAgQW55LnRvSlNPTihcbiAgICAgICAgICAgICAgICAgIE1zZ1NlbmQudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICAgIGZyb21BZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIHRvQWRkcmVzczogY29zbW9zRGVzdC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBbaGVscGVyLmFtb3VudFRvQ29pbihhbW91bnQpXVxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNlbmRBbGwodG9BY2NvdW50LCBhbW91bnRzKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcInNlbmRBbGxcIiwgdG9BY2NvdW50LCBhbW91bnRzKTtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICBFKGhlbHBlci5vd25lZCgpKS5leGVjdXRlRW5jb2RlZFR4KFtcbiAgICAgICAgICAgICAgICBBbnkudG9KU09OKFxuICAgICAgICAgICAgICAgICAgTXNnU2VuZC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgICAgZnJvbUFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgdG9BZGRyZXNzOiB0b0FjY291bnQudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGFtb3VudDogYW1vdW50cy5tYXAoKHgpID0+IGhlbHBlci5hbW91bnRUb0NvaW4oeCkpXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHRyYW5zZmVyKGRlc3RpbmF0aW9uLCBhbW91bnQsIG9wdHMpIHtcbiAgICAgICAgICB0cmFjZTMoXCJ0cmFuc2ZlclwiLCBkZXN0aW5hdGlvbiwgYW1vdW50LCBvcHRzKTtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29zbW9zRGVzdCA9IGNoYWluSHViLmNvZXJjZUNvc21vc0FkZHJlc3MoZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgdG9rZW4yID0gaGVscGVyLmFtb3VudFRvQ29pbihhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgY29ubmVjdGlvbkluZm9WID0gd2F0Y2goXG4gICAgICAgICAgICAgIGNoYWluSHViLmdldENvbm5lY3Rpb25JbmZvKFxuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUuY2hhaW5BZGRyZXNzLmNoYWluSWQsXG4gICAgICAgICAgICAgICAgY29zbW9zRGVzdC5jaGFpbklkXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIGFsbFZvd3MoW1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb25JbmZvVixcbiAgICAgICAgICAgICAgICB0aW1lc3RhbXBIZWxwZXIudm93T3JWYWx1ZUZyb21PcHRzKG9wdHMpXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy50cmFuc2ZlcldhdGNoZXIsXG4gICAgICAgICAgICAgIHsgb3B0cywgdG9rZW46IHRva2VuMiwgZGVzdGluYXRpb246IGNvc21vc0Rlc3QgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHRyYW5zZmVyU3RlcHMoYW1vdW50LCBtc2cpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcInRyYW5zZmVyU3RlcHMgZ290XCIsIGFtb3VudCwgbXNnKTtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4gdGhyb3dSZWRhY3RlZGBub3QgeWV0IGltcGxlbWVudGVkYCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB3aXRoZHJhd1Jld2FyZHMoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHRocm93UmVkYWN0ZWRgTm90IEltcGxlbWVudGVkLiBUcnkgdXNpbmcgd2l0aGRyYXdSZXdhcmQuYCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdW5kZWxlZ2F0ZShkZWxlZ2F0aW9ucykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJ1bmRlbGVnYXRlXCIsIGRlbGVnYXRpb25zKTtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgZGVsZWdhdGlvbnMuZXZlcnkoXG4gICAgICAgICAgICAgIChkKSA9PiBkLmRlbGVnYXRvciA/IGQuZGVsZWdhdG9yLnZhbHVlID09PSBjaGFpbkFkZHJlc3MudmFsdWUgOiB0cnVlXG4gICAgICAgICAgICApIHx8IHRocm93UmVkYWN0ZWRgU29tZSBkZWxlZ2F0aW9uIHJlY29yZCBpcyBmb3IgYW5vdGhlciBkZWxlZ2F0b3JgO1xuICAgICAgICAgICAgY29uc3QgdW5kZWxlZ2F0ZVYgPSB3YXRjaChcbiAgICAgICAgICAgICAgRShoZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChcbiAgICAgICAgICAgICAgICBkZWxlZ2F0aW9ucy5tYXAoXG4gICAgICAgICAgICAgICAgICAoeyB2YWxpZGF0b3IsIGFtb3VudCB9KSA9PiBBbnkudG9KU09OKFxuICAgICAgICAgICAgICAgICAgICBNc2dVbmRlbGVnYXRlLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyZXNzOiB2YWxpZGF0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBjb2VyY2VDb2luKGNoYWluSHViLCBhbW91bnQpXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy51bmRlbGVnYXRlV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh1bmRlbGVnYXRlViwgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBkZWFjdGl2YXRlKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB3YXRjaChFKHRoaXMuZmFjZXRzLmhlbHBlci5vd25lZCgpKS5kZWFjdGl2YXRlKCkpKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgcmVhY3RpdmF0ZSgpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4gd2F0Y2goRSh0aGlzLmZhY2V0cy5oZWxwZXIub3duZWQoKSkucmVhY3RpdmF0ZSgpKSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0RGVsZWdhdGlvbih2YWxpZGF0b3IpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwiZ2V0RGVsZWdhdGlvblwiLCB2YWxpZGF0b3IpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeURlbGVnYXRpb25SZXF1ZXN0LnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcjogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcjogdmFsaWRhdG9yLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMuZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldERlbGVnYXRpb25zKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJnZXREZWxlZ2F0aW9uc1wiKTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzLCBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCFpY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluQWRkcmVzcy5jaGFpbklkKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaWNxQ29ubmVjdGlvbikucXVlcnkoW1xuICAgICAgICAgICAgICB0b1JlcXVlc3RRdWVyeUpzb24oXG4gICAgICAgICAgICAgICAgUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3QudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyOiBjaGFpbkFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5kZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0VW5ib25kaW5nRGVsZWdhdGlvbih2YWxpZGF0b3IpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwiZ2V0VW5ib25kaW5nRGVsZWdhdGlvblwiLCB2YWxpZGF0b3IpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0LnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcjogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcjogdmFsaWRhdG9yLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMudW5ib25kaW5nRGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldFVuYm9uZGluZ0RlbGVnYXRpb25zKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJnZXRVbmJvbmRpbmdEZWxlZ2F0aW9uc1wiKTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzLCBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCFpY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluQWRkcmVzcy5jaGFpbklkKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaWNxQ29ubmVjdGlvbikucXVlcnkoW1xuICAgICAgICAgICAgICB0b1JlcXVlc3RRdWVyeUpzb24oXG4gICAgICAgICAgICAgICAgUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1JlcXVlc3QudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyOiBjaGFpbkFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy51bmJvbmRpbmdEZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0UmVkZWxlZ2F0aW9ucygpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwiZ2V0UmVkZWxlZ2F0aW9uc1wiKTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzLCBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCFpY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluQWRkcmVzcy5jaGFpbklkKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaWNxQ29ubmVjdGlvbikucXVlcnkoW1xuICAgICAgICAgICAgICB0b1JlcXVlc3RRdWVyeUpzb24oXG4gICAgICAgICAgICAgICAgUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHI6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICBkc3RWYWxpZGF0b3JBZGRyOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgc3JjVmFsaWRhdG9yQWRkcjogXCJcIlxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLnJlZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0UmV3YXJkKHZhbGlkYXRvcikge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJnZXRSZXdhcmRcIiwgdmFsaWRhdG9yKTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzLCBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCFpY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluQWRkcmVzcy5jaGFpbklkKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaWNxQ29ubmVjdGlvbikucXVlcnkoW1xuICAgICAgICAgICAgICB0b1JlcXVlc3RRdWVyeUpzb24oXG4gICAgICAgICAgICAgICAgUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1JlcXVlc3QudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyZXNzOiB2YWxpZGF0b3IudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5yZXdhcmRRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldFJld2FyZHMoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImdldFJld2FyZHNcIik7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1JlcXVlc3QudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5yZXdhcmRzUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZXhlY3V0ZUVuY29kZWRUeChtc2dzLCBvcHRzKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KFxuICAgICAgICAgICAgKCkgPT4gd2F0Y2goRSh0aGlzLmZhY2V0cy5oZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChtc2dzLCBvcHRzKSlcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBkZXBvc2l0Rm9yQnVybihkZXN0aW5hdGlvbiwgYW1vdW50LCBjYWxsZXIpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwiZGVwb3NpdEZvckJ1cm5cIiwgeyBkZXN0aW5hdGlvbiwgYW1vdW50IH0pO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBjb25zdCBkZXN0UGFydHMgPSBwYXJzZUFjY291bnRJZChkZXN0aW5hdGlvbik7XG4gICAgICAgICAgICBjb25zdCBjaGFpbklkID0gYCR7ZGVzdFBhcnRzLm5hbWVzcGFjZX06JHtkZXN0UGFydHMucmVmZXJlbmNlfWA7XG4gICAgICAgICAgICBjb25zdCB7IGNjdHBEZXN0aW5hdGlvbkRvbWFpbiB9ID0gY2hhaW5IdWIuZ2V0Q2hhaW5JbmZvQnlDaGFpbklkKGNoYWluSWQpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjY3RwRGVzdGluYXRpb25Eb21haW4gIT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGNoYWluSWQpfSBkb2VzIG5vdCBoYXZlIFwiY2N0cERlc3RpbmF0aW9uRG9tYWluXCIgc2V0IGluIENoYWluSW5mb2A7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBkZXBvc2l0Rm9yQnVybiA9IHtcbiAgICAgICAgICAgICAgYW1vdW50OiBoZWxwZXIuYW1vdW50VG9Db2luKGFtb3VudCk/LmFtb3VudCxcbiAgICAgICAgICAgICAgZnJvbTogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICBkZXN0aW5hdGlvbkRvbWFpbjogY2N0cERlc3RpbmF0aW9uRG9tYWluLFxuICAgICAgICAgICAgICBtaW50UmVjaXBpZW50OiBhY2NvdW50SWRUbzMyQnl0ZXMoZGVzdGluYXRpb24pLFxuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBidXJuVG9rZW46IFwidXVzZGNcIlxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uQ2FsbGVyID0gKCgpID0+IHtcbiAgICAgICAgICAgICAgaWYgKCFjYWxsZXIpIHJldHVybiB2b2lkIDA7XG4gICAgICAgICAgICAgIGNvbnN0IGNhbGxlclBhcnRzID0gcGFyc2VBY2NvdW50SWQoY2FsbGVyKTtcbiAgICAgICAgICAgICAgY2FsbGVyUGFydHMubmFtZXNwYWNlID09PSBkZXN0UGFydHMubmFtZXNwYWNlIHx8IHRocm93UmVkYWN0ZWRgY2FsbGVyICR7cXVvdGUoY2FsbGVyKX0gbXVzdCBiZSBpbiBzYW1lIG5hbWVzcGFjZSBhcyBkZXN0aW5hdGlvbiAke3F1b3RlKGRlc3RpbmF0aW9uKX1gO1xuICAgICAgICAgICAgICByZXR1cm4gYWNjb3VudElkVG8zMkJ5dGVzKGNhbGxlcik7XG4gICAgICAgICAgICB9KSgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICBFKGhlbHBlci5vd25lZCgpKS5leGVjdXRlRW5jb2RlZFR4KFtcbiAgICAgICAgICAgICAgICBBbnkudG9KU09OKFxuICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25DYWxsZXIgPyBNc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXIudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICAgIC4uLmRlcG9zaXRGb3JCdXJuLFxuICAgICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbkNhbGxlclxuICAgICAgICAgICAgICAgICAgfSkgOiBNc2dEZXBvc2l0Rm9yQnVybi50b1Byb3RvTXNnKGRlcG9zaXRGb3JCdXJuKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4gbWFrZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50S2l0O1xufTtcbnZhciBwcmVwYXJlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnQgPSAoem9uZSwgeyBjaGFpbkh1YiwgbWFrZVJlY29yZGVyS2l0LCB0aW1lclNlcnZpY2UsIHZvd1Rvb2xzLCB6Y2YgfSkgPT4ge1xuICBjb25zdCBtYWtlS2l0ID0gcHJlcGFyZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50S2l0KHpvbmUsIHtcbiAgICBjaGFpbkh1YixcbiAgICBtYWtlUmVjb3JkZXJLaXQsXG4gICAgdGltZXJTZXJ2aWNlLFxuICAgIHZvd1Rvb2xzLFxuICAgIHpjZlxuICB9KTtcbiAgcmV0dXJuICguLi5hcmdzKSA9PiBtYWtlS2l0KC4uLmFyZ3MpLmhvbGRlcjtcbn07XG5cbi8vXG52YXIgcHJlcGFyZUxvY2FsQ2hhaW5GYWNhZGVLaXQgPSAoem9uZSwge1xuICBtYWtlTG9jYWxPcmNoZXN0cmF0aW9uQWNjb3VudEtpdCxcbiAgYWdvcmljTmFtZXMsXG4gIGxvY2FsY2hhaW4sXG4gIC8vXG4gIC8vXG4gIHN0b3JhZ2VOb2RlLFxuICB2b3dUb29sczogeyBhbGxWb3dzLCB3YXRjaCwgYXNWb3cgfVxufSkgPT4gem9uZS5leG9DbGFzc0tpdChcbiAgXCJMb2NhbENoYWluRmFjYWRlXCIsXG4gIHtcbiAgICBwdWJsaWM6IE0uaW50ZXJmYWNlKFwiTG9jYWxDaGFpbkZhY2FkZVwiLCB7XG4gICAgICAuLi5jaGFpbkZhY2FkZU1ldGhvZHMsXG4gICAgICBxdWVyeTogTS5jYWxsKE0uYXJyYXlPZihUeXBlZEpzb25TaGFwZSkpLnJldHVybnMoVm93U2hhcGUpLFxuICAgICAgZ2V0VkJhbmtBc3NldEluZm86IE0uY2FsbCgpLm9wdGlvbmFsKE0uYm9vbGVhbigpKS5yZXR1cm5zKFZvd1NoYXBlKVxuICAgIH0pLFxuICAgIHZiYW5rQXNzZXRWYWx1ZXNXYXRjaGVyOiBNLmludGVyZmFjZShcInZiYW5rQXNzZXRWYWx1ZXNXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgfSksXG4gICAgbWFrZUFjY291bnRXYXRjaGVyOiBNLmludGVyZmFjZShcIm1ha2VBY2NvdW50V2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKFtNLnJlbW90YWJsZShcIkxDQSBBY2NvdW50XCIpLCBNLnN0cmluZygpXSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKFZvd1NoYXBlKVxuICAgIH0pLFxuICAgIG1ha2VDaGlsZE5vZGVXYXRjaGVyOiBNLmludGVyZmFjZShcIm1ha2VDaGlsZE5vZGVXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5vcihNLnJlbW90YWJsZSgpLCBNLnVuZGVmaW5lZCgpKSkub3B0aW9uYWwoeyBhY2NvdW50OiBNLnJlbW90YWJsZSgpLCBhZGRyZXNzOiBNLnN0cmluZygpIH0pLnJldHVybnMoTS5yZW1vdGFibGUoKSlcbiAgICB9KVxuICB9LFxuICAvKlxuXG4gICAqL1xuICAobG9jYWxDaGFpbkluZm8pID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgbG9jYWxDaGFpbkluZm8sXG4gICAgICB2YmFua0Fzc2V0czogKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB2b2lkIDBcbiAgICAgIClcbiAgICB9O1xuICB9LFxuICB7XG4gICAgcHVibGljOiB7XG4gICAgICBnZXRDaGFpbkluZm8oKSB7XG4gICAgICAgIHJldHVybiB3YXRjaCh0aGlzLnN0YXRlLmxvY2FsQ2hhaW5JbmZvKTtcbiAgICAgIH0sXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBtYWtlQWNjb3VudCgpIHtcbiAgICAgICAgY29uc3QgbGNhUCA9IEUobG9jYWxjaGFpbikubWFrZUFjY291bnQoKTtcbiAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgLy9cbiAgICAgICAgICAvL1xuICAgICAgICAgIGFsbFZvd3MoW2xjYVAsIGhlYXBWb3dFKGxjYVApLmdldEFkZHJlc3MoKV0pLFxuICAgICAgICAgIHRoaXMuZmFjZXRzLm1ha2VBY2NvdW50V2F0Y2hlclxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBxdWVyeShyZXF1ZXN0cykge1xuICAgICAgICByZXR1cm4gd2F0Y2goRShsb2NhbGNoYWluKS5xdWVyeU1hbnkocmVxdWVzdHMpKTtcbiAgICAgIH0sXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgZ2V0VkJhbmtBc3NldEluZm8oKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyB2YmFua0Fzc2V0cyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAodmJhbmtBc3NldHMpIHtcbiAgICAgICAgICAgIHJldHVybiB2YmFua0Fzc2V0cztcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgdmJhbmtBc3NldE5hbWVIdWJQID0gRShhZ29yaWNOYW1lcykubG9va3VwKFwidmJhbmtBc3NldFwiKTtcbiAgICAgICAgICBjb25zdCB2YmFua0Fzc2V0VmFsdWVzUCA9IEUodmJhbmtBc3NldE5hbWVIdWJQKS52YWx1ZXMoKTtcbiAgICAgICAgICBjb25zdCB7IHZiYW5rQXNzZXRWYWx1ZXNXYXRjaGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICByZXR1cm4gd2F0Y2godmJhbmtBc3NldFZhbHVlc1AsIHZiYW5rQXNzZXRWYWx1ZXNXYXRjaGVyKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICB2YmFua0Fzc2V0VmFsdWVzV2F0Y2hlcjoge1xuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChhc3NldHMpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBzdGF0ZS52YmFua0Fzc2V0cyA9IGFzc2V0cztcbiAgICAgICAgICByZXR1cm4gYXNzZXRzO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1ha2VBY2NvdW50V2F0Y2hlcjoge1xuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChbYWNjb3VudCwgYWRkcmVzc10pIHtcbiAgICAgICAgY29uc3Qgb3B0aW9uYWxTdG9yYWdlTm9kZSA9IHN0b3JhZ2VOb2RlID8gRShzdG9yYWdlTm9kZSkubWFrZUNoaWxkTm9kZShhZGRyZXNzKSA6IHZvaWQgMDtcbiAgICAgICAgcmV0dXJuIHdhdGNoKG9wdGlvbmFsU3RvcmFnZU5vZGUsIHRoaXMuZmFjZXRzLm1ha2VDaGlsZE5vZGVXYXRjaGVyLCB7XG4gICAgICAgICAgYWNjb3VudCxcbiAgICAgICAgICBhZGRyZXNzXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUNoaWxkTm9kZVdhdGNoZXI6IHtcbiAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChjaGlsZE5vZGUsIHsgYWNjb3VudCwgYWRkcmVzcyB9KSB7XG4gICAgICAgIGNvbnN0IHsgbG9jYWxDaGFpbkluZm8gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHsgaG9sZGVyIH0gPSBtYWtlTG9jYWxPcmNoZXN0cmF0aW9uQWNjb3VudEtpdCh7XG4gICAgICAgICAgYWNjb3VudCxcbiAgICAgICAgICBhZGRyZXNzOiBoYXJkZW4oe1xuICAgICAgICAgICAgdmFsdWU6IGFkZHJlc3MsXG4gICAgICAgICAgICBlbmNvZGluZzogXCJiZWNoMzJcIixcbiAgICAgICAgICAgIGNoYWluSWQ6IGxvY2FsQ2hhaW5JbmZvLmNoYWluSWRcbiAgICAgICAgICB9KSxcbiAgICAgICAgICAvL1xuICAgICAgICAgIHN0b3JhZ2VOb2RlOiBjaGlsZE5vZGVcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBob2xkZXI7XG4gICAgICB9XG4gICAgfVxuICB9XG4pO1xuaGFyZGVuKHByZXBhcmVMb2NhbENoYWluRmFjYWRlS2l0KTtcbnZhciBwcmVwYXJlTG9jYWxDaGFpbkZhY2FkZSA9ICh6b25lLCBwb3dlcnMpID0+IHtcbiAgY29uc3QgbWFrZUxvY2FsQ2hhaW5GYWNhZGVLaXQgPSBwcmVwYXJlTG9jYWxDaGFpbkZhY2FkZUtpdCh6b25lLCBwb3dlcnMpO1xuICByZXR1cm4gcGlja0ZhY2V0KG1ha2VMb2NhbENoYWluRmFjYWRlS2l0LCBcInB1YmxpY1wiKTtcbn07XG5oYXJkZW4ocHJlcGFyZUxvY2FsQ2hhaW5GYWNhZGUpO1xuXG4vL1xudmFyIHRyYWNlNCA9IG1ha2VUcmFjZXIoXCJQYWNrZXRUb29sc1wiKTtcbnZhciB7IHRvQ2FwRGF0YSB9ID0gbWFrZU1hcnNoYWwodm9pZCAwLCB2b2lkIDAsIHtcbiAgbWFyc2hhbE5hbWU6IFwiSnVzdEVuY29kZXJcIixcbiAgc2VyaWFsaXplQm9keUZvcm1hdDogXCJjYXBkYXRhXCJcbn0pO1xudmFyIGp1c3QgPSAob2JqKSA9PiB7XG4gIGNvbnN0IHsgYm9keSB9ID0gdG9DYXBEYXRhKG9iaik7XG4gIHJldHVybiBkZWNvZGVUb0p1c3RpbihKU09OLnBhcnNlKGJvZHkpLCBmYWxzZSk7XG59O1xudmFyIHsgVm93JDogVm93JDQgfSA9IFNoYXBlO1xudmFyIEVWb3ckID0gKHNoYXBlKSA9PiBNLm9yKFZvdyQ0KHNoYXBlKSwgTS5wcm9taXNlKFxuICAvKiAgICAgICAqL1xuKSk7XG52YXIgc2luazUgPSAoKSA9PiB7XG59O1xuaGFyZGVuKHNpbms1KTtcbnZhciBwcmVwYXJlUGFja2V0VG9vbHMgPSAoem9uZSwgdm93VG9vbHMpID0+IHtcbiAgY29uc3QgeyBhbGxWb3dzLCBtYWtlVm93S2l0LCB3YXRjaCwgd2hlbiB9ID0gdm93VG9vbHM7XG4gIGNvbnN0IG1ha2VQYWNrZXRUb29sc0tpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJQYWNrZXRUb29sc0tpdFwiLFxuICAgIHtcbiAgICAgIHB1YmxpYzogTS5pbnRlcmZhY2UoXCJQYWNrZXRUb29sc1wiLCB7XG4gICAgICAgIHNlbmRUaGVuV2FpdEZvckFjazogTS5jYWxsKEVWb3ckKE0ucmVtb3RhYmxlKFwiUGFja2V0U2VuZGVyXCIpKSkub3B0aW9uYWwoTS5hbnkoKSkucmV0dXJucyhFVm93JChNLmFueSgpKSksXG4gICAgICAgIG1hdGNoRmlyc3RQYWNrZXQ6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKEVWb3ckKE0uYW55KCkpKSxcbiAgICAgICAgbW9uaXRvclRyYW5zZmVyczogTS5jYWxsKE0ucmVtb3RhYmxlKFwiVGFyZ2V0QXBwXCIpKS5yZXR1cm5zKFxuICAgICAgICAgIEVWb3ckKE0uYW55KCkpXG4gICAgICAgIClcbiAgICAgIH0pLFxuICAgICAgdGFwOiBNLmludGVyZmFjZShcInRhcFwiLCB7XG4gICAgICAgIC8vXG4gICAgICAgIHJlY2VpdmVVcGNhbGw6IE0uY2FsbFdoZW4oTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBtb25pdG9yUmVnaXN0cmF0aW9uOiBNLmludGVyZmFjZShcIm1vbml0b3JSZWdpc3RyYXRpb25cIiwge1xuICAgICAgICAvL1xuICAgICAgICB1cGRhdGVUYXJnZXRBcHA6IE0uY2FsbFdoZW4oXG4gICAgICAgICAgTS5hd2FpdChNLnJlbW90YWJsZShcIlRhcmdldEFwcFwiKSlcbiAgICAgICAgKS5yZXR1cm5zKCksXG4gICAgICAgIC8vXG4gICAgICAgIHJldm9rZTogTS5jYWxsV2hlbigpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICB3YXRjaFBhY2tldE1hdGNoOiBNLmludGVyZmFjZShcIndhdGNoUGFja2V0TWF0Y2hcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCksIE0ucmVjb3JkKCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgd2F0Y2hQYWNrZXRQYXR0ZXJuOiBNLmludGVyZmFjZShcIndhdGNoUGFja2V0UGF0dGVyblwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSwgTS5yZWNvcmQoKSkucmV0dXJucyhNLmFueSgpKSxcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCksIE0ucmVjb3JkKCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgd2F0Y2hEZWNyUGVuZGluZ1BhdHRlcm5zOiBNLmludGVyZmFjZShcIndhdGNoRGVjclBlbmRpbmdQYXR0ZXJuc1wiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKSxcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgc2VuZFBhY2tldFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwic2VuZFBhY2tldFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKFxuICAgICAgICAgIFtNLnJlY29yZCgpLCBNLnJlbW90YWJsZShcIlBhY2tldFNlbmRlclwiKV0sXG4gICAgICAgICAgTS5yZWNvcmQoKVxuICAgICAgICApLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcGFja2V0V2FzU2VudFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicGFja2V0V2FzU2VudFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKFxuICAgICAgICAgIHsgZXZlbnRQYXR0ZXJuOiBNLnBhdHRlcm4oKSwgcmVzdWx0VjogVm93JDQoTS5hbnkoKSkgfSxcbiAgICAgICAgICBNLnJlY29yZCgpXG4gICAgICAgICkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICB1dGlsczogTS5pbnRlcmZhY2UoXCJ1dGlsc1wiLCB7XG4gICAgICAgIHN1YnNjcmliZVRvVHJhbnNmZXJzOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgdW5zdWJzY3JpYmVGcm9tVHJhbnNmZXJzOiBNLmNhbGwoKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpLFxuICAgICAgICBpbmNyUGVuZGluZ1BhdHRlcm5zOiBNLmNhbGwoKS5yZXR1cm5zKFZvdyQ0KE0udW5kZWZpbmVkKCkpKSxcbiAgICAgICAgZGVjclBlbmRpbmdQYXR0ZXJuczogTS5jYWxsKCkucmV0dXJucyhWb3ckNChNLnVuZGVmaW5lZCgpKSlcbiAgICAgIH0pLFxuICAgICAgcmVqZWN0UmVzb2x2ZXJBbmRSZXRocm93V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZWplY3RSZXNvbHZlcldhdGNoZXJcIiwge1xuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSwge1xuICAgICAgICAgIHJlc29sdmVyOiBNLnJlbW90YWJsZShcInJlc29sdmVyXCIpXG4gICAgICAgIH0pLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pXG4gICAgfSxcbiAgICAvKlxuXG4gICAgICovXG4gICAgKGxjYSkgPT4ge1xuICAgICAgY29uc3QgcmVzb2x2ZXJUb1BhdHRlcm4gPSB6b25lLmRldGFjaGVkKCkubWFwU3RvcmUoXCJyZXNvbHZlclRvUGF0dGVyblwiKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxjYSxcbiAgICAgICAgcmVnOiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgbnVsbFxuICAgICAgICApLFxuICAgICAgICByZXNvbHZlclRvUGF0dGVybixcbiAgICAgICAgdXBjYWxsUXVldWU6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBudWxsXG4gICAgICAgICksXG4gICAgICAgIHBlbmRpbmc6IDAsXG4gICAgICAgIGV4dHJhOiBudWxsLFxuICAgICAgICBtb25pdG9yOiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgbnVsbFxuICAgICAgICApXG4gICAgICB9O1xuICAgIH0sXG4gICAge1xuICAgICAgcHVibGljOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIC8vXG4gICAgICAgIGFzeW5jIG1vbml0b3JUcmFuc2ZlcnMobW9uaXRvcikge1xuICAgICAgICAgIGNvbnN0IG1yZWcgPSB0aGlzLmZhY2V0cy5tb25pdG9yUmVnaXN0cmF0aW9uO1xuICAgICAgICAgIGF3YWl0IG1yZWcudXBkYXRlVGFyZ2V0QXBwKG1vbml0b3IpO1xuICAgICAgICAgIHJldHVybiBtcmVnO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBtYXRjaEZpcnN0UGFja2V0KHBhdHRlcm5QKSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgdGhpcy5mYWNldHMudXRpbHMuaW5jclBlbmRpbmdQYXR0ZXJucygpLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMud2F0Y2hQYWNrZXRNYXRjaCxcbiAgICAgICAgICAgIHsgcGF0dGVyblAgfVxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBzZW5kVGhlbldhaXRGb3JBY2socGFja2V0U2VuZGVyLCBvcHRzID0ge30pIHtcbiAgICAgICAgICBjb25zdCBwYXR0ZXJuID0gbWFrZVZvd0tpdCgpO1xuICAgICAgICAgIGNvbnN0IG1hdGNoViA9IHdhdGNoKFxuICAgICAgICAgICAgYWxsVm93cyhbXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnB1YmxpYy5tYXRjaEZpcnN0UGFja2V0KHBhdHRlcm4udm93KSxcbiAgICAgICAgICAgICAgcGFja2V0U2VuZGVyXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnNlbmRQYWNrZXRXYXRjaGVyLFxuICAgICAgICAgICAgeyBvcHRzIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdFYgPSB3YXRjaChtYXRjaFYsIHRoaXMuZmFjZXRzLnBhY2tldFdhc1NlbnRXYXRjaGVyLCB7XG4gICAgICAgICAgICBvcHRzLFxuICAgICAgICAgICAgcGF0dGVyblJlc29sdmVyOiBwYXR0ZXJuLnJlc29sdmVyXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdFYsIHRoaXMuZmFjZXRzLnJlamVjdFJlc29sdmVyQW5kUmV0aHJvd1dhdGNoZXIsIHtcbiAgICAgICAgICAgIHJlc29sdmVyOiBwYXR0ZXJuLnJlc29sdmVyXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBtb25pdG9yUmVnaXN0cmF0aW9uOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgLy9cbiAgICAgICAgYXN5bmMgdXBkYXRlVGFyZ2V0QXBwKHRhcCkge1xuICAgICAgICAgIHRoaXMuc3RhdGUubW9uaXRvciA9IGF3YWl0IHRhcDtcbiAgICAgICAgICBhd2FpdCB0aGlzLmZhY2V0cy51dGlscy5zdWJzY3JpYmVUb1RyYW5zZmVycygpO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIC8vXG4gICAgICAgIGFzeW5jIHJldm9rZSgpIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLm1vbml0b3IgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGFwOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIGFzeW5jIHJlY2VpdmVVcGNhbGwob2JqKSB7XG4gICAgICAgICAgY29uc3QgeyBtb25pdG9yLCByZXNvbHZlclRvUGF0dGVybiwgdXBjYWxsUXVldWUsIHBlbmRpbmcgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgdHJhY2U0KFxuICAgICAgICAgICAgYFRyeWluZyAke3Jlc29sdmVyVG9QYXR0ZXJuLmdldFNpemUoKX0gY3VycmVudCBwYXR0ZXJucyBhbmQgJHtwZW5kaW5nfSBwZW5kaW5nIHBhdHRlcm5zIGFnYWluc3RgLFxuICAgICAgICAgICAganVzdChvYmopXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAobW9uaXRvcikge1xuICAgICAgICAgICAgdm9pZCBFKG1vbml0b3IpLnJlY2VpdmVVcGNhbGwob2JqKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yIChjb25zdCBbcmVzb2x2ZXIsIHBhdHRlcm5dIG9mIHJlc29sdmVyVG9QYXR0ZXJuLmVudHJpZXMoKSkge1xuICAgICAgICAgICAgaWYgKG1hdGNoZXMob2JqLCBwYXR0ZXJuKSkge1xuICAgICAgICAgICAgICB0cmFjZTQoXCJNYXRjaGVkIHBhdHRlcm46XCIsIGp1c3QocGF0dGVybikpO1xuICAgICAgICAgICAgICByZXNvbHZlci5yZXNvbHZlKG9iaik7XG4gICAgICAgICAgICAgIHJlc29sdmVyVG9QYXR0ZXJuLmRlbGV0ZShyZXNvbHZlcik7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHVwY2FsbFF1ZXVlKSB7XG4gICAgICAgICAgICB0cmFjZTQoXCJTdGFzaGluZyBvYmplY3QgaW4gdXBjYWxsUXVldWVcIik7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnVwY2FsbFF1ZXVlID0gaGFyZGVuKHVwY2FsbFF1ZXVlLmNvbmNhdChvYmopKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdHJhY2U0KFwiTm8gbWF0Y2ggeWV0LlwiKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHNlbmRQYWNrZXRXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFt7IG1hdGNoIH0sIHNlbmRlcl0sIGN0eCkge1xuICAgICAgICAgIHJldHVybiB3YXRjaChFKHNlbmRlcikuc2VuZFBhY2tldChtYXRjaCwgY3R4Lm9wdHMpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHBhY2tldFdhc1NlbnRXYXRjaGVyOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKHsgZXZlbnRQYXR0ZXJuLCByZXN1bHRWIH0sIGN0eCkge1xuICAgICAgICAgIGNvbnN0IHsgcGF0dGVyblJlc29sdmVyIH0gPSBjdHg7XG4gICAgICAgICAgcGF0dGVyblJlc29sdmVyLnJlc29sdmUoZXZlbnRQYXR0ZXJuKTtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0VjtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlamVjdFJlc29sdmVyQW5kUmV0aHJvd1dhdGNoZXI6IHtcbiAgICAgICAgb25SZWplY3RlZChyZWosIHsgcmVzb2x2ZXIgfSkge1xuICAgICAgICAgIHJlc29sdmVyLnJlamVjdChyZWopO1xuICAgICAgICAgIHRocm93IHJlajtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdhdGNoUGFja2V0TWF0Y2g6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoXywgeyBwYXR0ZXJuUCB9KSB7XG4gICAgICAgICAgY29uc3QgeyB2b3csIHJlc29sdmVyIH0gPSBtYWtlVm93S2l0KCk7XG4gICAgICAgICAgY29uc3QgcGF0dGVyblYgPSB3YXRjaChcbiAgICAgICAgICAgIHBhdHRlcm5QLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMud2F0Y2hQYWNrZXRQYXR0ZXJuLFxuICAgICAgICAgICAgaGFyZGVuKHsgcmVzb2x2ZXIgfSlcbiAgICAgICAgICApO1xuICAgICAgICAgIHdhdGNoKHBhdHRlcm5WLCB0aGlzLmZhY2V0cy53YXRjaERlY3JQZW5kaW5nUGF0dGVybnMpO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBtYXRjaDogdm93LCByZXNvbHZlciB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdhdGNoRGVjclBlbmRpbmdQYXR0ZXJuczoge1xuICAgICAgICBvbkZ1bGZpbGxlZCgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5mYWNldHMudXRpbHMuZGVjclBlbmRpbmdQYXR0ZXJucygpO1xuICAgICAgICB9LFxuICAgICAgICBvblJlamVjdGVkKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmZhY2V0cy51dGlscy5kZWNyUGVuZGluZ1BhdHRlcm5zKCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3YXRjaFBhY2tldFBhdHRlcm46IHtcbiAgICAgICAgb25GdWxmaWxsZWQocGF0dGVybiwgeyByZXNvbHZlciB9KSB7XG4gICAgICAgICAgY29uc3QgeyByZXNvbHZlclRvUGF0dGVybiwgdXBjYWxsUXVldWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgdHJhY2U0KFwid2F0Y2hQYWNrZXRQYXR0ZXJuIG9uRnVsZmlsbGVkXCIsIGp1c3QocGF0dGVybikpO1xuICAgICAgICAgIGlmICghdXBjYWxsUXVldWUpIHtcbiAgICAgICAgICAgIHRyYWNlNChcIk5vIHVwY2FsbCBxdWV1ZSB5ZXQuICBTYXZlIHRoZSBwYXR0ZXJuIGZvciBsYXRlci5cIik7XG4gICAgICAgICAgICByZXNvbHZlclRvUGF0dGVybi5pbml0KHJlc29sdmVyLCBwYXR0ZXJuKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgaTMgPSB1cGNhbGxRdWV1ZS5maW5kSW5kZXgoKG9iaikgPT4gbWF0Y2hlcyhvYmosIHBhdHRlcm4pKTtcbiAgICAgICAgICBpZiAoaTMgPT09IC0xKSB7XG4gICAgICAgICAgICB0cmFjZTQoXCJObyBtYXRjaCB5ZXQuIFNhdmUgdGhlIHBhdHRlcm4gZm9yIGxhdGVyLlwiKTtcbiAgICAgICAgICAgIHJlc29sdmVyVG9QYXR0ZXJuLmluaXQocmVzb2x2ZXIsIHBhdHRlcm4pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0cmFjZTQoXG4gICAgICAgICAgICBcIlN1Y2Nlc3MhIFJlbW92ZSB0aGUgbWF0Y2hlZCBvYmplY3QgZnJvbSB0aGUgcXVldWUuXCIsXG4gICAgICAgICAgICBqdXN0KHVwY2FsbFF1ZXVlW2kzXSlcbiAgICAgICAgICApO1xuICAgICAgICAgIHJlc29sdmVyLnJlc29sdmUodXBjYWxsUXVldWVbaTNdKTtcbiAgICAgICAgICB0aGlzLnN0YXRlLnVwY2FsbFF1ZXVlID0gaGFyZGVuKFxuICAgICAgICAgICAgdXBjYWxsUXVldWUuc2xpY2UoMCwgaTMpLmNvbmNhdCh1cGNhbGxRdWV1ZS5zbGljZShpMyArIDEpKVxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCB7IHJlc29sdmVyIH0pIHtcbiAgICAgICAgICByZXNvbHZlci5yZWplY3QocmVhc29uKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHV0aWxzOiB7XG4gICAgICAgIGluY3JQZW5kaW5nUGF0dGVybnMoKSB7XG4gICAgICAgICAgY29uc3QgeyBwZW5kaW5nLCByZWcsIHVwY2FsbFF1ZXVlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHRoaXMuc3RhdGUucGVuZGluZyArPSAxO1xuICAgICAgICAgIGlmICghdXBjYWxsUXVldWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUudXBjYWxsUXVldWUgPSBoYXJkZW4oW10pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocmVnIHx8IHBlbmRpbmcgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godm9pZCAwKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLnV0aWxzLnN1YnNjcmliZVRvVHJhbnNmZXJzKCkpO1xuICAgICAgICB9LFxuICAgICAgICBkZWNyUGVuZGluZ1BhdHRlcm5zKCkge1xuICAgICAgICAgIHRoaXMuc3RhdGUucGVuZGluZyAtPSAxO1xuICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnBlbmRpbmcgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuc3RhdGUucGVuZGluZyA9IDA7XG4gICAgICAgICAgdGhpcy5zdGF0ZS51cGNhbGxRdWV1ZSA9IG51bGw7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLnV0aWxzLnVuc3Vic2NyaWJlRnJvbVRyYW5zZmVycygpKTtcbiAgICAgICAgfSxcbiAgICAgICAgc3Vic2NyaWJlVG9UcmFuc2ZlcnMoKSB7XG4gICAgICAgICAgY29uc3QgeyBsY2EsIHJlZzogY2FjaGVkUmVnIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChjYWNoZWRSZWcpIHtcbiAgICAgICAgICAgIHJldHVybiB3aGVuKGNhY2hlZFJlZyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHsgdGFwIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCByZWcgPSB3YXRjaChFKGxjYSkubW9uaXRvclRyYW5zZmVycyh0YXApKTtcbiAgICAgICAgICB0aGlzLnN0YXRlLnJlZyA9IHJlZztcbiAgICAgICAgICByZXR1cm4gd2hlbihyZWcpO1xuICAgICAgICB9LFxuICAgICAgICB1bnN1YnNjcmliZUZyb21UcmFuc2ZlcnMoKSB7XG4gICAgICAgICAgY29uc3QgeyByZWcsIG1vbml0b3IgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKCFyZWcgfHwgbW9uaXRvcikge1xuICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIGZpbmlzaChjb250ZXh0KSB7XG4gICAgICAgIHZvaWQgY29udGV4dC5mYWNldHMudXRpbHMuc3Vic2NyaWJlVG9UcmFuc2ZlcnMoKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VQYWNrZXRUb29scyA9IHBpY2tGYWNldChtYWtlUGFja2V0VG9vbHNLaXQsIFwicHVibGljXCIpO1xuICByZXR1cm4gbWFrZVBhY2tldFRvb2xzO1xufTtcbmhhcmRlbihwcmVwYXJlUGFja2V0VG9vbHMpO1xuXG4vL1xudmFyIElDUzIwX1RSQU5TRkVSX1NVQ0NFU1NfUkVTVUxUID0gXCJBUT09XCI7XG52YXIgdHJhY2U1ID0gbWFrZVRyYWNlcihcIklCQ1BcIik7XG52YXIgeyBGYWlsOiBGYWlsNiwgYmFyZTogYmFyZTMgfSA9IGFzc2VydDtcbnZhciB7IFZvdyQ6IFZvdyQ1IH0gPSBTaGFwZTtcbnZhciBjcmVhdGVTZXF1ZW5jZVBhdHRlcm4gPSAoc2VxdWVuY2UpID0+IHtcbiAgY29uc3Qgc2VxdWVuY2VQYXR0ZXJucyA9IFtdO1xuICB0cnkge1xuICAgIGNvbnN0IGJpbnRTZXF1ZW5jZSA9IEJpZ0ludChzZXF1ZW5jZSk7XG4gICAgYmludFNlcXVlbmNlID4gMG4gJiYgc2VxdWVuY2VQYXR0ZXJucy5wdXNoKGJpbnRTZXF1ZW5jZSk7XG4gIH0gY2F0Y2ggKGUyKSB7XG4gIH1cbiAgY29uc3QgbnVtU2VxdWVuY2UgPSBOdW1iZXIoc2VxdWVuY2UpO1xuICBudW1TZXF1ZW5jZSA+IDAgJiYgTnVtYmVyLmlzU2FmZUludGVnZXIobnVtU2VxdWVuY2UpICYmIHNlcXVlbmNlUGF0dGVybnMucHVzaChudW1TZXF1ZW5jZSk7XG4gIGNvbnN0IHN0clNlcXVlbmNlID0gU3RyaW5nKHNlcXVlbmNlKTtcbiAgc3RyU2VxdWVuY2UgJiYgc2VxdWVuY2VQYXR0ZXJucy5wdXNoKHN0clNlcXVlbmNlKTtcbiAgaWYgKCFzZXF1ZW5jZVBhdHRlcm5zLmZpbmQoKHNlcSkgPT4gc2VxID09PSBzZXF1ZW5jZSkpIHtcbiAgICBzZXF1ZW5jZVBhdHRlcm5zLnB1c2goc2VxdWVuY2UpO1xuICB9XG4gIHN3aXRjaCAoc2VxdWVuY2VQYXR0ZXJucy5sZW5ndGgpIHtcbiAgICBjYXNlIDA6XG4gICAgICB0aHJvdyBGYWlsNmBzZXF1ZW5jZSAke3NlcXVlbmNlfSBpcyBub3QgdmFsaWRgO1xuICAgIGNhc2UgMTpcbiAgICAgIHJldHVybiBzZXF1ZW5jZVBhdHRlcm5zWzBdO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gTS5vciguLi5zZXF1ZW5jZVBhdHRlcm5zKTtcbiAgfVxufTtcbmhhcmRlbihjcmVhdGVTZXF1ZW5jZVBhdHRlcm4pO1xudmFyIHByZXBhcmVJQkNUcmFuc2ZlclNlbmRlciA9ICh6b25lLCB7IHdhdGNoLCBtYWtlSUJDUmVwbHlLaXQgfSkgPT4ge1xuICBjb25zdCBtYWtlSUJDVHJhbnNmZXJTZW5kZXJLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiSUJDVHJhbnNmZXJTZW5kZXJLaXRcIixcbiAgICB7XG4gICAgICBwdWJsaWM6IE0uaW50ZXJmYWNlKFwiSUJDVHJhbnNmZXJTZW5kZXJcIiwge1xuICAgICAgICBzZW5kUGFja2V0OiBNLmNhbGwoVm93JDUoTS5hbnkoKSksIE0uYW55KCkpLnJldHVybnMoVm93JDUoTS5yZWNvcmQoKSkpXG4gICAgICB9KSxcbiAgICAgIHJlc3BvbnNlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZXNwb25zZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKFtNLnJlY29yZCgpXSwgTS5yZWNvcmQoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICB2ZXJpZnlUcmFuc2ZlclN1Y2Nlc3M6IE0uaW50ZXJmYWNlKFwidmVyaWZ5VHJhbnNmZXJTdWNjZXNzXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKClcbiAgICAgIH0pXG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgKHR4RXhlY3V0b3IsIHRyYW5zZmVyTXNnKSA9PiAoe1xuICAgICAgdHhFeGVjdXRvcixcbiAgICAgIHRyYW5zZmVyTXNnOiBoYXJkZW4odHJhbnNmZXJNc2cpXG4gICAgfSksXG4gICAge1xuICAgICAgcHVibGljOiB7XG4gICAgICAgIC8qXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHNlbmRQYWNrZXQobWF0Y2gsIG9wdHMpIHtcbiAgICAgICAgICBjb25zdCB7IHR4RXhlY3V0b3IsIHRyYW5zZmVyTXNnIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUodHhFeGVjdXRvcikuZXhlY3V0ZVR4KFt0cmFuc2Zlck1zZ10pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMucmVzcG9uc2VXYXRjaGVyLFxuICAgICAgICAgICAgeyBvcHRzLCBtYXRjaCB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlc3BvbnNlV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3sgc2VxdWVuY2UgfV0sIGN0eCkge1xuICAgICAgICAgIGNvbnN0IHsgbWF0Y2gsIG9wdHMgfSA9IGN0eDtcbiAgICAgICAgICBjb25zdCB7IHRyYW5zZmVyTXNnIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHRyYWNlNShcInNlcXVlbmNlXCIsIHNlcXVlbmNlLCB0cmFuc2Zlck1zZyk7XG4gICAgICAgICAgY29uc3QgcmVwbHlQYWNrZXRQYXR0ZXJuID0gTS5zcGxpdFJlY29yZCh7XG4gICAgICAgICAgICBzb3VyY2VfcG9ydDogdHJhbnNmZXJNc2cuc291cmNlUG9ydCxcbiAgICAgICAgICAgIHNvdXJjZV9jaGFubmVsOiB0cmFuc2Zlck1zZy5zb3VyY2VDaGFubmVsLFxuICAgICAgICAgICAgc2VxdWVuY2U6IGNyZWF0ZVNlcXVlbmNlUGF0dGVybihzZXF1ZW5jZSlcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCB7IHJlc3VsdFY6IGFja0RhdGFWLCAuLi5yZXN0IH0gPSBtYWtlSUJDUmVwbHlLaXQoXG4gICAgICAgICAgICByZXBseVBhY2tldFBhdHRlcm4sXG4gICAgICAgICAgICBtYXRjaCxcbiAgICAgICAgICAgIHsgb3BOYW1lOiBcInRyYW5zZmVyXCIsIC4uLm9wdHMgfVxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ViA9IHdhdGNoKGFja0RhdGFWLCB0aGlzLmZhY2V0cy52ZXJpZnlUcmFuc2ZlclN1Y2Nlc3MpO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyByZXN1bHRWLCAuLi5yZXN0IH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdmVyaWZ5VHJhbnNmZXJTdWNjZXNzOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKGFja0RhdGEpIHtcbiAgICAgICAgICBsZXQgb2JqO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBvYmogPSBKU09OLnBhcnNlKGFja0RhdGEpO1xuICAgICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgRmFpbDZgSUNTMjAtMSB0cmFuc2ZlciBhY2sgZGF0YSBpcyBub3QgSlNPTjogJHthY2tEYXRhfWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHsgcmVzdWx0LCBlcnJvciB9ID0gb2JqO1xuICAgICAgICAgIGVycm9yID09PSB2b2lkIDAgfHwgRmFpbDZgSUNTMjAtMSB0cmFuc2ZlciBlcnJvciAke2Vycm9yfWA7XG4gICAgICAgICAgcmVzdWx0ID8/IEZhaWw2YE1pc3NpbmcgcmVzdWx0IGluIElDUzIwLTEgdHJhbnNmZXIgYWNrICR7b2JqfWA7XG4gICAgICAgICAgaWYgKHJlc3VsdCA9PT0gSUNTMjBfVFJBTlNGRVJfU1VDQ0VTU19SRVNVTFQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgZGVjb2RlQW5kUGFyc2UgPSAoYjY0KSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShhdG9iKGI2NCkpO1xuICAgICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICAgIEZhaWw2YERlY29kaW5nIG9mIGJhc2U2NC1lbmNvZGVkIGFjayBvYmogb2JqZWN0IGZhaWxlZDogJHtKU09OLnN0cmluZ2lmeShiNjQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgICBjb25zdCBvdXRlckRlY29kZWQgPSBkZWNvZGVBbmRQYXJzZShyZXN1bHQpO1xuICAgICAgICAgIGNvbnN0IGliY0FjayA9IG91dGVyRGVjb2RlZD8uaWJjX2FjayAmJiBkZWNvZGVBbmRQYXJzZShvdXRlckRlY29kZWQuaWJjX2Fjayk7XG4gICAgICAgICAgaWJjQWNrPy5yZXN1bHQgPT09IElDUzIwX1RSQU5TRkVSX1NVQ0NFU1NfUkVTVUxUIHx8IEZhaWw2YElDUzIwLTEgdHJhbnNmZXIgdW5zdWNjZXNzZnVsIHdpdGggYWNrIHJlc3VsdDogJHtvdXRlckRlY29kZWR9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuICguLi5hcmdzKSA9PiBtYWtlSUJDVHJhbnNmZXJTZW5kZXJLaXQoLi4uYXJncykucHVibGljO1xufTtcbmhhcmRlbihwcmVwYXJlSUJDVHJhbnNmZXJTZW5kZXIpO1xudmFyIHByZXBhcmVJQkNSZXBseUtpdCA9ICh6b25lLCB2b3dUb29scykgPT4ge1xuICBjb25zdCB7IHdhdGNoIH0gPSB2b3dUb29scztcbiAgY29uc3QgaWJjV2F0Y2hlciA9IHpvbmUuZXhvKFxuICAgIFwiaWJjUmVzdWx0V2F0Y2hlclwiLFxuICAgIE0uaW50ZXJmYWNlKFwicHJvY2Vzc0lCQ1dhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChcbiAgICAgICAgTS5zcGxpdFJlY29yZCh7IGV2ZW50OiBNLnN0cmluZygpIH0sIHsgYWNrbm93bGVkZ2VtZW50OiBNLnN0cmluZygpIH0pLFxuICAgICAgICBNLnNwbGl0UmVjb3JkKHt9LCB7IG9wTmFtZTogTS5zdHJpbmcoKSwgdGltZW91dDogTS5yZWNvcmQoKSB9KVxuICAgICAgKS5yZXR1cm5zKFZvdyQ1KE0uc3RyaW5nKCkpKVxuICAgIH0pLFxuICAgIHtcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKGliY0V2ZW50LCB7IG9wTmFtZSA9IFwidW5rbm93blwiIH0pIHtcbiAgICAgICAgY29uc3QgeyBldmVudCB9ID0gaWJjRXZlbnQ7XG4gICAgICAgIHN3aXRjaCAoZXZlbnQpIHtcbiAgICAgICAgICBjYXNlIFwiYWNrbm93bGVkZ2VtZW50UGFja2V0XCI6IHtcbiAgICAgICAgICAgIGNvbnN0IHsgYWNrbm93bGVkZ2VtZW50IH0gPSBpYmNFdmVudDtcbiAgICAgICAgICAgIGFja25vd2xlZGdlbWVudCB8fCBGYWlsNmBhY2tub3dsZWRnZW1lbnRQYWNrZXQgbWlzc2luZyAnYWNrbm93bGVkZ2VtZW50J2A7XG4gICAgICAgICAgICByZXR1cm4gYmFzZTY0VG9CeXRlcyhhY2tub3dsZWRnZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwidGltZW91dFBhY2tldFwiOlxuICAgICAgICAgICAgdGhyb3cgRmFpbDZgJHtiYXJlMyhvcE5hbWUpfSBvcGVyYXRpb24gcmVjZWl2ZWQgdGltZW91dCBwYWNrZXRgO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBGYWlsNmBVbmV4cGVjdGVkIGV2ZW50OiAke2V2ZW50fWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VJQkNSZXBseUtpdCA9IChyZXBseVBhY2tldFBhdHRlcm4sIG1hdGNoViwgb3B0cykgPT4ge1xuICAgIGNvbnN0IGV2ZW50UGF0dGVybiA9IE0ub3IoXG4gICAgICBNLnNwbGl0UmVjb3JkKHtcbiAgICAgICAgZXZlbnQ6IFwiYWNrbm93bGVkZ2VtZW50UGFja2V0XCIsXG4gICAgICAgIHBhY2tldDogcmVwbHlQYWNrZXRQYXR0ZXJuLFxuICAgICAgICBhY2tub3dsZWRnZW1lbnQ6IE0uc3RyaW5nKClcbiAgICAgIH0pLFxuICAgICAgTS5zcGxpdFJlY29yZCh7XG4gICAgICAgIGV2ZW50OiBcInRpbWVvdXRQYWNrZXRcIixcbiAgICAgICAgcGFja2V0OiByZXBseVBhY2tldFBhdHRlcm5cbiAgICAgIH0pXG4gICAgKTtcbiAgICBjb25zdCByZXN1bHRWID0gd2F0Y2gobWF0Y2hWLCBpYmNXYXRjaGVyLCBvcHRzKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgZXZlbnRQYXR0ZXJuLCByZXN1bHRWIH0pO1xuICB9O1xuICByZXR1cm4gbWFrZUlCQ1JlcGx5S2l0O1xufTtcbmhhcmRlbihwcmVwYXJlSUJDUmVwbHlLaXQpO1xudmFyIHByZXBhcmVJQkNUb29scyA9ICh6b25lLCB2b3dUb29scykgPT4ge1xuICBjb25zdCBtYWtlSUJDUmVwbHlLaXQgPSBwcmVwYXJlSUJDUmVwbHlLaXQoem9uZSwgdm93VG9vbHMpO1xuICBjb25zdCBtYWtlSUJDVHJhbnNmZXJTZW5kZXIgPSBwcmVwYXJlSUJDVHJhbnNmZXJTZW5kZXIoem9uZSwge1xuICAgIG1ha2VJQkNSZXBseUtpdCxcbiAgICAuLi52b3dUb29sc1xuICB9KTtcbiAgcmV0dXJuIGhhcmRlbih7IG1ha2VJQkNUcmFuc2ZlclNlbmRlciwgbWFrZUlCQ1JlcGx5S2l0IH0pO1xufTtcbmhhcmRlbihwcmVwYXJlSUJDVG9vbHMpO1xuXG4vL1xudmFyIHRyYWNlNiA9IG1ha2VUcmFjZXIoXCJMb2NhbE9yY2hBY2NvdW50XCIpO1xudmFyIHsgVm93JDogVm93JDYgfSA9IFNoYXBlO1xudmFyIEVWb3ckMiA9IChzaGFwZSkgPT4gTS5vcihWb3ckNihzaGFwZSksIE0ucHJvbWlzZShcbiAgLyogICAgICAgKi9cbikpO1xudmFyIEhvbGRlckkgPSBNLmludGVyZmFjZShcImhvbGRlclwiLCB7XG4gIC4uLm9yY2hlc3RyYXRpb25BY2NvdW50TWV0aG9kcyxcbiAgZGVsZWdhdGU6IE0uY2FsbChNLnN0cmluZygpLCBBbW91bnRTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIHVuZGVsZWdhdGU6IE0uY2FsbChNLnN0cmluZygpLCBBbW91bnRTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGRlcG9zaXQ6IE0uY2FsbChQYXltZW50U2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICB3aXRoZHJhdzogTS5jYWxsKEFtb3VudFNoYXBlKS5yZXR1cm5zKFZvdyQ2KFBheW1lbnRTaGFwZSkpLFxuICBleGVjdXRlVHg6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoVm93JDYoTS5yZWNvcmQoKSkpLFxuICBzZW5kVGhlbldhaXRGb3JBY2s6IE0uY2FsbChFVm93JDIoTS5yZW1vdGFibGUoXCJQYWNrZXRTZW5kZXJcIikpKS5vcHRpb25hbChNLmFueSgpKS5yZXR1cm5zKEVWb3ckMihNLnN0cmluZygpKSksXG4gIG1hdGNoRmlyc3RQYWNrZXQ6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKEVWb3ckMihNLmFueSgpKSksXG4gIG1vbml0b3JUcmFuc2ZlcnM6IE0uY2FsbChNLnJlbW90YWJsZShcIlRhcmdldEFwcFwiKSkucmV0dXJucyhFVm93JDIoTS5hbnkoKSkpLFxuICBwYXJzZUluYm91bmRUcmFuc2ZlcjogTS5jYWxsKE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgTS5hbnkoKSkpLnJldHVybnMoXG4gICAgVm93JDYoe1xuICAgICAgYW1vdW50OiBEZW5vbUFtb3VudFNoYXBlLFxuICAgICAgZnJvbUFjY291bnQ6IE0uc3RyaW5nKCksXG4gICAgICB0b0FjY291bnQ6IE0uc3RyaW5nKCksXG4gICAgICBleHRyYTogTS5yZWNvcmRPZihNLnN0cmluZygpLCBNLmFueSgpKVxuICAgIH0pXG4gIClcbn0pO1xudmFyIFBVQkxJQ19UT1BJQ1MyID0ge1xuICBhY2NvdW50OiBbXCJBY2NvdW50IGhvbGRlciBzdGF0dXNcIiwgTS5hbnkoKV1cbn07XG52YXIgcHJlcGFyZUxvY2FsT3JjaGVzdHJhdGlvbkFjY291bnRLaXQgPSAoem9uZSwge1xuICBtYWtlUmVjb3JkZXJLaXQsXG4gIHpjZixcbiAgdGltZXJTZXJ2aWNlLFxuICB2b3dUb29scyxcbiAgY2hhaW5IdWIsXG4gIGxvY2FsY2hhaW4sXG4gIHpvZVRvb2xzXG59KSA9PiB7XG4gIGNvbnN0IHsgd2F0Y2gsIGFzVm93LCB3aGVuIH0gPSB2b3dUb29scztcbiAgY29uc3QgeyBtYWtlSUJDVHJhbnNmZXJTZW5kZXIgfSA9IHByZXBhcmVJQkNUb29scyhcbiAgICB6b25lLnN1YlpvbmUoXCJpYmNUb29sc1wiKSxcbiAgICB2b3dUb29sc1xuICApO1xuICBjb25zdCBtYWtlUGFja2V0VG9vbHMgPSBwcmVwYXJlUGFja2V0VG9vbHMoXG4gICAgem9uZS5zdWJab25lKFwicGFja2V0VG9vbHNcIiksXG4gICAgdm93VG9vbHNcbiAgKTtcbiAgY29uc3QgdGltZXN0YW1wSGVscGVyID0gbWFrZVRpbWVzdGFtcEhlbHBlcih0aW1lclNlcnZpY2UpO1xuICBjb25zdCBtYWtlTG9jYWxPcmNoZXN0cmF0aW9uQWNjb3VudEtpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJMb2NhbCBPcmNoZXN0cmF0aW9uIEFjY291bnQgS2l0XCIsXG4gICAge1xuICAgICAgaGVscGVyOiBNLmludGVyZmFjZShcImhlbHBlclwiLCB7XG4gICAgICAgIGFtb3VudFRvQ29pbjogTS5jYWxsKEFtb3VudEFyZ1NoYXBlKS5yZXR1cm5zKE0ucmVjb3JkKCkpXG4gICAgICB9KSxcbiAgICAgIGhvbGRlcjogSG9sZGVySSxcbiAgICAgIHVuZGVsZWdhdGVXYXRjaGVyOiBNLmludGVyZmFjZShcInVuZGVsZWdhdGVXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbXG4gICAgICAgICAgTS5zcGxpdFJlY29yZCh7IGNvbXBsZXRpb25UaW1lOiBUaW1lc3RhbXBQcm90b1NoYXBlIH0pXG4gICAgICAgIF0pLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhWb3dTaGFwZSlcbiAgICAgIH0pLFxuICAgICAgdHJhbnNmZXJXYXRjaGVyOiBNLmludGVyZmFjZShcInRyYW5zZmVyV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5uYXQoKSkub3B0aW9uYWwoe1xuICAgICAgICAgIG9wdHM6IE0ub3IoTS51bmRlZmluZWQoKSwgSUJDVHJhbnNmZXJPcHRpb25zU2hhcGUpLFxuICAgICAgICAgIHJvdXRlOiBUcmFuc2ZlclJvdXRlU2hhcGVcbiAgICAgICAgfSkucmV0dXJucyhWb3ckNihNLnJlY29yZCgpKSlcbiAgICAgIH0pLFxuICAgICAgZXh0cmFjdEZpcnN0UmVzdWx0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJleHRyYWN0Rmlyc3RSZXN1bHRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbTS5yZWNvcmQoKV0pLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICByZXR1cm5Wb2lkV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZXR1cm5Wb2lkV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkub3B0aW9uYWwoTS5hbnkoKSkucmV0dXJucyhNLnVuZGVmaW5lZCgpKVxuICAgICAgfSksXG4gICAgICBzZWF0RXhpdGVySGFuZGxlcjogTS5pbnRlcmZhY2UoXCJzZWF0RXhpdGVySGFuZGxlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS51bmRlZmluZWQoKSwgTS5yZW1vdGFibGUoKSkucmV0dXJucyhcbiAgICAgICAgICBNLnVuZGVmaW5lZCgpXG4gICAgICAgICksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIE0ucmVtb3RhYmxlKCkpLnJldHVybnMoTS51bmRlZmluZWQoKSlcbiAgICAgIH0pLFxuICAgICAgZ2V0QmFsYW5jZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiZ2V0QmFsYW5jZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKEFtb3VudFNoYXBlLCBEZW5vbVNoYXBlKS5yZXR1cm5zKERlbm9tQW1vdW50U2hhcGUpXG4gICAgICB9KSxcbiAgICAgIHF1ZXJ5QmFsYW5jZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicXVlcnlCYWxhbmNlV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoVHlwZWRKc29uU2hhcGUpLnJldHVybnMoRGVub21BbW91bnRTaGFwZSlcbiAgICAgIH0pLFxuICAgICAgcXVlcnlCYWxhbmNlc1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwicXVlcnlCYWxhbmNlc1dhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKFR5cGVkSnNvblNoYXBlKS5yZXR1cm5zKFxuICAgICAgICAgIE0uYXJyYXlPZihEZW5vbUFtb3VudFNoYXBlKVxuICAgICAgICApXG4gICAgICB9KSxcbiAgICAgIHBhcnNlSW5ib3VuZFRyYW5zZmVyV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJwYXJzZUluYm91bmRUcmFuc2ZlcldhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVjb3JkKCksIE0ucmVjb3JkKCkpLnJldHVybnMoTS5yZWNvcmQoKSksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpLCBNLnJlY29yZCgpKS5yZXR1cm5zKE0ucmVjb3JkKCkpXG4gICAgICB9KSxcbiAgICAgIGludml0YXRpb25NYWtlcnM6IE0uaW50ZXJmYWNlKFwiaW52aXRhdGlvbk1ha2Vyc1wiLCB7XG4gICAgICAgIENsb3NlQWNjb3VudDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIERlbGVnYXRlOiBNLmNhbGwoTS5zdHJpbmcoKSwgQW1vdW50U2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBEZXBvc2l0OiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgU2VuZDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIFNlbmRBbGw6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBUcmFuc2ZlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIFVuZGVsZWdhdGU6IE0uY2FsbChNLnN0cmluZygpLCBBbW91bnRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIFdpdGhkcmF3OiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgICAgfSlcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuICAgICAqL1xuICAgICh7IGFjY291bnQsIGFkZHJlc3MsIHN0b3JhZ2VOb2RlIH0pID0+IHtcbiAgICAgIGNvbnN0IHRvcGljS2l0ID0gc3RvcmFnZU5vZGUgPyBtYWtlUmVjb3JkZXJLaXQoc3RvcmFnZU5vZGUsIFBVQkxJQ19UT1BJQ1MyLmFjY291bnRbMV0pIDogdm9pZCAwO1xuICAgICAgaWYgKHRvcGljS2l0KSB7XG4gICAgICAgIHZvaWQgRSh0b3BpY0tpdC5yZWNvcmRlcikud3JpdGUoXCJcIik7XG4gICAgICB9XG4gICAgICBjb25zdCBwYWNrZXRUb29scyA9IG1ha2VQYWNrZXRUb29scyhhY2NvdW50KTtcbiAgICAgIHJldHVybiB7IGFjY291bnQsIGFkZHJlc3MsIHBhY2tldFRvb2xzLCB0b3BpY0tpdCB9O1xuICAgIH0sXG4gICAge1xuICAgICAgaGVscGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgYW1vdW50VG9Db2luKGFtb3VudCkge1xuICAgICAgICAgIHJldHVybiBjb2VyY2VDb2luKGNoYWluSHViLCBhbW91bnQpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaW52aXRhdGlvbk1ha2Vyczoge1xuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIERlbGVnYXRlKHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpIHtcbiAgICAgICAgICB0cmFjZTYoXCJEZWxlZ2F0ZVwiLCB2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMuaG9sZGVyLmRlbGVnYXRlKHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sIFwiRGVsZWdhdGVcIik7XG4gICAgICAgIH0sXG4gICAgICAgIERlcG9zaXQoKSB7XG4gICAgICAgICAgdHJhY2U2KFwiRGVwb3NpdFwiKTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKFxuICAgICAgICAgICAgKHNlYXQpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgeyBnaXZlIH0gPSBzZWF0LmdldFByb3Bvc2FsKCk7XG4gICAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgICB6b2VUb29scy5sb2NhbFRyYW5zZmVyKFxuICAgICAgICAgICAgICAgICAgc2VhdCxcbiAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmFjY291bnQsXG4gICAgICAgICAgICAgICAgICBnaXZlXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5zZWF0RXhpdGVySGFuZGxlcixcbiAgICAgICAgICAgICAgICBzZWF0XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJEZXBvc2l0XCIsXG4gICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICBNLnNwbGl0UmVjb3JkKHsgZ2l2ZTogQW55TmF0QW1vdW50c1JlY29yZCwgd2FudDoge30gfSlcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFVuZGVsZWdhdGUodmFsaWRhdG9yQWRkcmVzcywgZXJ0cEFtb3VudCkge1xuICAgICAgICAgIHRyYWNlNihcIlVuZGVsZWdhdGVcIiwgdmFsaWRhdG9yQWRkcmVzcywgZXJ0cEFtb3VudCk7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmhvbGRlci51bmRlbGVnYXRlKHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sIFwiVW5kZWxlZ2F0ZVwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgQ2xvc2VBY2NvdW50KCkge1xuICAgICAgICAgIHRocm93IEVycm9yKFwibm90IHlldCBpbXBsZW1lbnRlZFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgU2VuZCgpIHtcbiAgICAgICAgICBjb25zdCBvZmZlckhhbmRsZXIgPSAoc2VhdCwgeyB0b0FjY291bnQsIGFtb3VudCB9KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIuc2VuZCh0b0FjY291bnQsIGFtb3VudCkpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihvZmZlckhhbmRsZXIsIFwiU2VuZFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgU2VuZEFsbCgpIHtcbiAgICAgICAgICBjb25zdCBvZmZlckhhbmRsZXIgPSAoc2VhdCwgeyB0b0FjY291bnQsIGFtb3VudHMgfSkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLnNlbmRBbGwodG9BY2NvdW50LCBhbW91bnRzKSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKG9mZmVySGFuZGxlciwgXCJTZW5kQWxsXCIpO1xuICAgICAgICB9LFxuICAgICAgICBUcmFuc2ZlcigpIHtcbiAgICAgICAgICBjb25zdCBvZmZlckhhbmRsZXIgPSAoc2VhdCwgeyBhbW91bnQsIGRlc3RpbmF0aW9uLCBvcHRzIH0pID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5ob2xkZXIudHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwgb3B0cylcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKG9mZmVySGFuZGxlciwgXCJUcmFuc2ZlclwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgV2l0aGRyYXcoKSB7XG4gICAgICAgICAgdHJhY2U2KFwiV2l0aGRyYXdcIik7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihcbiAgICAgICAgICAgIChzZWF0KSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHsgd2FudCB9ID0gc2VhdC5nZXRQcm9wb3NhbCgpO1xuICAgICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgICAgem9lVG9vbHMud2l0aGRyYXdUb1NlYXQoXG4gICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5hY2NvdW50LFxuICAgICAgICAgICAgICAgICAgc2VhdCxcbiAgICAgICAgICAgICAgICAgIHdhbnRcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnNlYXRFeGl0ZXJIYW5kbGVyLFxuICAgICAgICAgICAgICAgIHNlYXRcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIldpdGhkcmF3XCIsXG4gICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICBNLnNwbGl0UmVjb3JkKHsgZ2l2ZToge30sIHdhbnQ6IEFueU5hdEFtb3VudHNSZWNvcmQgfSlcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdW5kZWxlZ2F0ZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChyZXNwb25zZSkge1xuICAgICAgICAgIGNvbnN0IHsgY29tcGxldGlvblRpbWUgfSA9IHJlc3BvbnNlWzBdO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUodGltZXJTZXJ2aWNlKS53YWtlQXQoXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIEJpZ0ludChjb21wbGV0aW9uVGltZS5zZWNvbmRzKSArIG1heENsb2NrU2tld1xuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRyYW5zZmVyV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHRpbWVvdXRUaW1lc3RhbXAsIHsgb3B0cywgcm91dGUgfSkge1xuICAgICAgICAgIGNvbnN0IHsgZm9yd2FyZEluZm8sIC4uLnRyYW5zZmVyRGV0YWlscyB9ID0gcm91dGU7XG4gICAgICAgICAgbGV0IG1lbW87XG4gICAgICAgICAgaWYgKG9wdHMgJiYgXCJtZW1vXCIgaW4gb3B0cykge1xuICAgICAgICAgICAgbWVtbyA9IG9wdHMubWVtbztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGZvcndhcmRJbmZvKSB7XG4gICAgICAgICAgICBtZW1vID0gSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICBmb3J3YXJkOiB7XG4gICAgICAgICAgICAgICAgLi4uZm9yd2FyZEluZm8uZm9yd2FyZCxcbiAgICAgICAgICAgICAgICBuZXh0OiBtZW1vXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB0cmFuc2Zlck1zZyA9IHR5cGVkSnNvbihcbiAgICAgICAgICAgIFwiL2liYy5hcHBsaWNhdGlvbnMudHJhbnNmZXIudjEuTXNnVHJhbnNmZXJcIixcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgLi4udHJhbnNmZXJEZXRhaWxzLFxuICAgICAgICAgICAgICBzZW5kZXI6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgdGltZW91dEhlaWdodDogb3B0cz8udGltZW91dEhlaWdodCA/PyB7XG4gICAgICAgICAgICAgICAgcmV2aXNpb25IZWlnaHQ6IDBuLFxuICAgICAgICAgICAgICAgIHJldmlzaW9uTnVtYmVyOiAwblxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB0aW1lb3V0VGltZXN0YW1wLFxuICAgICAgICAgICAgICBtZW1vOiBtZW1vID8/IFwiXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHsgaG9sZGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCBzZW5kZXIgPSBtYWtlSUJDVHJhbnNmZXJTZW5kZXIoXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGhvbGRlcixcbiAgICAgICAgICAgIHRyYW5zZmVyTXNnXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gaG9sZGVyLnNlbmRUaGVuV2FpdEZvckFjayhzZW5kZXIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIGV4dHJhY3RGaXJzdFJlc3VsdFdhdGNoZXI6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0cykge1xuICAgICAgICAgIHJlc3VsdHMubGVuZ3RoID09PSAxIHx8IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQgZXhhY3RseSBvbmUgcmVzdWx0OyBnb3QgJHtyZXN1bHRzfWA7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdHNbMF07XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXR1cm5Wb2lkV2F0Y2hlcjoge1xuICAgICAgICBvbkZ1bGZpbGxlZCgpIHtcbiAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIGdldEJhbGFuY2VXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChuYXRBbW91bnQsIGRlbm9tKSB7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRlbm9tLCB2YWx1ZTogbmF0QW1vdW50LnZhbHVlIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHNlYXRFeGl0ZXJIYW5kbGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoXywgc2VhdCkge1xuICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCBzZWF0KSB7XG4gICAgICAgICAgc2VhdC5leGl0KHJlYXNvbik7XG4gICAgICAgICAgdGhyb3cgcmVhc29uO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIHF1ZXJ5QmFsYW5jZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0KSB7XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlIH0gPSByZXN1bHQ7XG4gICAgICAgICAgaWYgKCFiYWxhbmNlIHx8ICFiYWxhbmNlPy5kZW5vbSkge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCBiYWxhbmNlICR7cXVvdGUocmVzdWx0KX07YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih0b0Rlbm9tQW1vdW50KGJhbGFuY2UpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBxdWVyeUJhbGFuY2VzV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0KSB7XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlcyB9ID0gcmVzdWx0O1xuICAgICAgICAgIGlmICghYmFsYW5jZXMgfHwgIUFycmF5LmlzQXJyYXkoYmFsYW5jZXMpKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkIGJhbGFuY2VzICR7cXVvdGUocmVzdWx0KX07YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbihiYWxhbmNlcy5tYXAodG9EZW5vbUFtb3VudCkpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcGFyc2VJbmJvdW5kVHJhbnNmZXJXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKGxvY2FsRGVub21IYXNoLCBuYWl2ZVJlc3VsdCkge1xuICAgICAgICAgIGNvbnN0IGxvY2FsRGVub20gPSBgaWJjLyR7bG9jYWxEZW5vbUhhc2guaGFzaH1gO1xuICAgICAgICAgIGNvbnN0IHsgYW1vdW50LCAuLi5yZXN0IH0gPSBuYWl2ZVJlc3VsdDtcbiAgICAgICAgICBjb25zdCB7IGRlbm9tOiBfLCAuLi5hbW91bnRSZXN0IH0gPSBhbW91bnQ7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgYW1vdW50OiB7IC4uLmFtb3VudFJlc3QsIGRlbm9tOiBsb2NhbERlbm9tIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25SZWplY3RlZChyZWFzb24sIG5haXZlUmVzdWx0KSB7XG4gICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEVycm9yICYmIFN0cmluZyhyZWFzb24ubWVzc2FnZSkuaW5jbHVkZXMoXCJkZW5vbWluYXRpb24gdHJhY2Ugbm90IGZvdW5kXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmFpdmVSZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRocm93IHJlYXNvbjtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGhvbGRlcjoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGFzQ29udGludWluZ09mZmVyKCkge1xuICAgICAgICAgIHJldHVybiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBudWxsO1xuICAgICAgICAgICAgY29uc3QgeyBob2xkZXIsIGludml0YXRpb25NYWtlcnM6IGltIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IGludml0YXRpb25NYWtlcnMgPSAoXG4gICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICBpbVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBwdWJsaWNTdWJzY3JpYmVyczogYXdhaXQgd2hlbihob2xkZXIuZ2V0UHVibGljVG9waWNzKCkpLFxuICAgICAgICAgICAgICBpbnZpdGF0aW9uTWFrZXJzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEJhbGFuY2UoZGVub21BcmcpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgW2JyYW5kLCBkZW5vbV0gPSB0eXBlb2YgZGVub21BcmcgPT09IFwic3RyaW5nXCIgPyBbY2hhaW5IdWIuZ2V0QXNzZXQoZGVub21BcmcsIFwiYWdvcmljXCIpPy5icmFuZCwgZGVub21BcmddIDogW2Rlbm9tQXJnLCBjaGFpbkh1Yi5nZXREZW5vbShkZW5vbUFyZyldO1xuICAgICAgICAgICAgaWYgKCFkZW5vbSkge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYE5vIGRlbm9tIGZvciBicmFuZDogJHtkZW5vbUFyZ31gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJyYW5kKSB7XG4gICAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgICBFKHRoaXMuc3RhdGUuYWNjb3VudCkuZ2V0QmFsYW5jZShicmFuZCksXG4gICAgICAgICAgICAgICAgdGhpcy5mYWNldHMuZ2V0QmFsYW5jZVdhdGNoZXIsXG4gICAgICAgICAgICAgICAgZGVub21cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShsb2NhbGNoYWluKS5xdWVyeShcbiAgICAgICAgICAgICAgICB0eXBlZEpzb24oXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUJhbGFuY2VSZXF1ZXN0XCIsIHtcbiAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIGRlbm9tXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucXVlcnlCYWxhbmNlV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRCYWxhbmNlcygpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKGxvY2FsY2hhaW4pLnF1ZXJ5KFxuICAgICAgICAgICAgICB0eXBlZEpzb24oXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUFsbEJhbGFuY2VzUmVxdWVzdFwiLCB7XG4gICAgICAgICAgICAgICAgYWRkcmVzczogdGhpcy5zdGF0ZS5hZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMucXVlcnlCYWxhbmNlc1dhdGNoZXJcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRQdWJsaWNUb3BpY3MoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IG51bGw7XG4gICAgICAgICAgICBjb25zdCB7IHRvcGljS2l0IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCF0b3BpY0tpdCkgdGhyb3cgdGhyb3dSZWRhY3RlZGBObyB0b3BpY0tpdDsgc3RvcmFnZU5vZGUgbm90IHByb3ZpZGVkYDtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgICBhY2NvdW50OiB7XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFBVQkxJQ19UT1BJQ1MyLmFjY291bnRbMF0sXG4gICAgICAgICAgICAgICAgc3Vic2NyaWJlcjogdG9waWNLaXQuc3Vic2NyaWJlcixcbiAgICAgICAgICAgICAgICBzdG9yYWdlUGF0aDogYXdhaXQgdG9waWNLaXQucmVjb3JkZXIuZ2V0U3RvcmFnZVBhdGgoKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLy9cbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBkZWxlZ2F0ZSh2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KSB7XG4gICAgICAgICAgY29uc3QgeyBhY2NvdW50OiBsY2EgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgYW1vdW50ID0gY29lcmNlQ29pbihjaGFpbkh1YiwgZXJ0cEFtb3VudCk7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgRShsY2EpLmV4ZWN1dGVUeChbXG4gICAgICAgICAgICAgIHR5cGVkSnNvbihcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ0RlbGVnYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcmVzcyxcbiAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiB0aGlzLnN0YXRlLmFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMuZXh0cmFjdEZpcnN0UmVzdWx0V2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICB1bmRlbGVnYXRlKHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpIHtcbiAgICAgICAgICBjb25zdCBhbW91bnQgPSBjb2VyY2VDb2luKGNoYWluSHViLCBlcnRwQW1vdW50KTtcbiAgICAgICAgICBjb25zdCB7IGFjY291bnQ6IGxjYSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKGxjYSkuZXhlY3V0ZVR4KFtcbiAgICAgICAgICAgICAgdHlwZWRKc29uKFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnVW5kZWxlZ2F0ZVwiLCB7XG4gICAgICAgICAgICAgICAgYW1vdW50LFxuICAgICAgICAgICAgICAgIHZhbGlkYXRvckFkZHJlc3MsXG4gICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcmVzczogdGhpcy5zdGF0ZS5hZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnVuZGVsZWdhdGVXYXRjaGVyXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGRlcG9zaXQocGF5bWVudCkge1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUodGhpcy5zdGF0ZS5hY2NvdW50KS5kZXBvc2l0KHBheW1lbnQpLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgd2l0aGRyYXcoYW1vdW50KSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUodGhpcy5zdGF0ZS5hY2NvdW50KS53aXRoZHJhdyhhbW91bnQpKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZXhlY3V0ZVR4KG1lc3NhZ2VzKSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUodGhpcy5zdGF0ZS5hY2NvdW50KS5leGVjdXRlVHgobWVzc2FnZXMpKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRBZGRyZXNzKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmFkZHJlc3M7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBzZW5kKHRvQWNjb3VudCwgYW1vdW50KSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlNihcInNlbmRcIiwgdG9BY2NvdW50LCBhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgY29zbW9zRGVzdCA9IGNoYWluSHViLmNvZXJjZUNvc21vc0FkZHJlc3ModG9BY2NvdW50KTtcbiAgICAgICAgICAgIGNvc21vc0Rlc3QuY2hhaW5JZCA9PT0gdGhpcy5zdGF0ZS5hZGRyZXNzLmNoYWluSWQgfHwgdGhyb3dSZWRhY3RlZGBiYW5rL3NlbmQgY2Fubm90IHNlbmQgdG8gYSBkaWZmZXJlbnQgY2hhaW4gJHtxdW90ZShjb3Ntb3NEZXN0LmNoYWluSWQpfWA7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUodGhpcy5zdGF0ZS5hY2NvdW50KS5leGVjdXRlVHgoW1xuICAgICAgICAgICAgICAgIHR5cGVkSnNvbihcIi9jb3Ntb3MuYmFuay52MWJldGExLk1zZ1NlbmRcIiwge1xuICAgICAgICAgICAgICAgICAgYW1vdW50OiBbaGVscGVyLmFtb3VudFRvQ29pbihhbW91bnQpXSxcbiAgICAgICAgICAgICAgICAgIHRvQWRkcmVzczogY29zbW9zRGVzdC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIGZyb21BZGRyZXNzOiB0aGlzLnN0YXRlLmFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBzZW5kQWxsKHRvQWNjb3VudCwgYW1vdW50cykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTYoXCJzZW5kQWxsXCIsIHRvQWNjb3VudCwgYW1vdW50cyk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUodGhpcy5zdGF0ZS5hY2NvdW50KS5leGVjdXRlVHgoW1xuICAgICAgICAgICAgICAgIHR5cGVkSnNvbihcIi9jb3Ntb3MuYmFuay52MWJldGExLk1zZ1NlbmRcIiwge1xuICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnRzLm1hcCgoYTIpID0+IGhlbHBlci5hbW91bnRUb0NvaW4oYTIpKSxcbiAgICAgICAgICAgICAgICAgIHRvQWRkcmVzczogdG9BY2NvdW50LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgZnJvbUFkZHJlc3M6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgdHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwgb3B0cykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTYoXCJUcmFuc2ZlcnJpbmcgZnVuZHMgb3ZlciBJQkNcIik7XG4gICAgICAgICAgICBjb25zdCBkZW5vbUFtb3VudCA9IGNvZXJjZURlbm9tQW1vdW50KGNoYWluSHViLCBhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgeyBmb3J3YXJkT3B0cywgLi4ucmVzdCB9ID0gb3B0cyA/PyB7fTtcbiAgICAgICAgICAgIGNvbnN0IHJvdXRlID0gY2hhaW5IdWIubWFrZVRyYW5zZmVyUm91dGUoXG4gICAgICAgICAgICAgIGRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICBkZW5vbUFtb3VudCxcbiAgICAgICAgICAgICAgXCJhZ29yaWNcIixcbiAgICAgICAgICAgICAgZm9yd2FyZE9wdHNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0cmFjZTYoXCJnb3QgdHJhbnNmZXIgcm91dGVcIiwgcm91dGUpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ViA9IHdhdGNoKFxuICAgICAgICAgICAgICB0aW1lc3RhbXBIZWxwZXIudm93T3JWYWx1ZUZyb21PcHRzKG9wdHMpLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy50cmFuc2ZlcldhdGNoZXIsXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBvcHRzOiByZXN0LFxuICAgICAgICAgICAgICAgIHJvdXRlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0VjtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgcGFyc2VJbmJvdW5kVHJhbnNmZXIocmVjb3JkKSB7XG4gICAgICAgICAgdHJhY2U2KFwicGFyc2VJbmJvdW5kVHJhbnNmZXJcIiwgcmVjb3JkKTtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGFja2V0ID0gKFxuICAgICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgcmVjb3JkXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgZnRQYWNrZXREYXRhID0gSlNPTi5wYXJzZShhdG9iKHBhY2tldC5kYXRhKSk7XG4gICAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICAgIGRlbm9tOiB0cmFuc2ZlckRlbm9tLFxuICAgICAgICAgICAgICBzZW5kZXIsXG4gICAgICAgICAgICAgIHJlY2VpdmVyLFxuICAgICAgICAgICAgICBhbW91bnRcbiAgICAgICAgICAgIH0gPSBmdFBhY2tldERhdGE7XG4gICAgICAgICAgICBjb25zdCBidWlsZFJldHVyblZhbHVlID0gKGxvY2FsRGVub20pID0+IGhhcmRlbih7XG4gICAgICAgICAgICAgIGFtb3VudDogKFxuICAgICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgdmFsdWU6IEJpZ0ludChhbW91bnQpLFxuICAgICAgICAgICAgICAgICAgZGVub206IGxvY2FsRGVub21cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIGZyb21BY2NvdW50OiBzZW5kZXIsXG4gICAgICAgICAgICAgIHRvQWNjb3VudDogcmVjZWl2ZXIsXG4gICAgICAgICAgICAgIGV4dHJhOiB7XG4gICAgICAgICAgICAgICAgLi4uZnRQYWNrZXREYXRhXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IGRlbm9tT3JUcmFjZTtcbiAgICAgICAgICAgIGNvbnN0IHByZWZpeCA9IGAke3BhY2tldC5zb3VyY2VfcG9ydH0vJHtwYWNrZXQuc291cmNlX2NoYW5uZWx9L2A7XG4gICAgICAgICAgICB0cmFjZTYoeyB0cmFuc2ZlckRlbm9tLCBwcmVmaXggfSk7XG4gICAgICAgICAgICBpZiAodHJhbnNmZXJEZW5vbS5zdGFydHNXaXRoKHByZWZpeCkpIHtcbiAgICAgICAgICAgICAgZGVub21PclRyYWNlID0gdHJhbnNmZXJEZW5vbS5zbGljZShwcmVmaXgubGVuZ3RoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGRlbm9tT3JUcmFjZSA9IGAke3BhY2tldC5kZXN0aW5hdGlvbl9wb3J0fS8ke3BhY2tldC5kZXN0aW5hdGlvbl9jaGFubmVsfS8ke3RyYW5zZmVyRGVub219YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShsb2NhbGNoYWluKS5xdWVyeShcbiAgICAgICAgICAgICAgICB0eXBlZEpzb24oXG4gICAgICAgICAgICAgICAgICBcIi9pYmMuYXBwbGljYXRpb25zLnRyYW5zZmVyLnYxLlF1ZXJ5RGVub21IYXNoUmVxdWVzdFwiLFxuICAgICAgICAgICAgICAgICAgeyB0cmFjZTogZGVub21PclRyYWNlIH1cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnBhcnNlSW5ib3VuZFRyYW5zZmVyV2F0Y2hlcixcbiAgICAgICAgICAgICAgYnVpbGRSZXR1cm5WYWx1ZShkZW5vbU9yVHJhY2UpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdHJhbnNmZXJTdGVwcyhhbW91bnQsIG1zZykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInRyYW5zZmVyU3RlcHMgZ290XCIsIGFtb3VudCwgbXNnKTtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgbm90IHlldCBpbXBsZW1lbnRlZGA7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNlbmRUaGVuV2FpdEZvckFjayhzZW5kZXIsIG9wdHMpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKHRoaXMuc3RhdGUucGFja2V0VG9vbHMpLnNlbmRUaGVuV2FpdEZvckFjayhzZW5kZXIsIG9wdHMpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG1hdGNoRmlyc3RQYWNrZXQocGF0dGVyblYpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goRSh0aGlzLnN0YXRlLnBhY2tldFRvb2xzKS5tYXRjaEZpcnN0UGFja2V0KHBhdHRlcm5WKSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG1vbml0b3JUcmFuc2ZlcnModGFwKSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUodGhpcy5zdGF0ZS5wYWNrZXRUb29scykubW9uaXRvclRyYW5zZmVycyh0YXApKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuIG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0O1xufTtcblxuLy9cbnZhciB7IFZvdyQ6IFZvdyQ3IH0gPSBTaGFwZTtcbnZhciB0cmFjZTcgPSBtYWtlVHJhY2VyKFwiT3JjaGVzdHJhdG9yXCIpO1xudmFyIE9yY2hlc3RyYXRvckkgPSBNLmludGVyZmFjZShcIk9yY2hlc3RyYXRvclwiLCB7XG4gIGdldENoYWluOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhWb3ckNyhNLnJlbW90YWJsZShcIkNoYWluRmFjYWRlXCIpKSksXG4gIGdldERlbm9tSW5mbzogTS5jYWxsKERlbm9tU2hhcGUsIE0uc3RyaW5nKCkpLnJldHVybnMoRGVub21JbmZvU2hhcGUpLFxuICBhc0Ftb3VudDogTS5jYWxsKERlbm9tQW1vdW50U2hhcGUpLnJldHVybnMoQW1vdW50U2hhcGUpXG59KTtcbnZhciBwcmVwYXJlT3JjaGVzdHJhdG9yS2l0ID0gKHpvbmUsIHtcbiAgY2hhaW5IdWIsXG4gIG1ha2VMb2NhbENoYWluRmFjYWRlLFxuICBtYWtlUmVtb3RlQ2hhaW5GYWNhZGUsXG4gIHZvd1Rvb2xzOiB7IHdhdGNoLCBhc1ZvdyB9XG59KSA9PiB7XG4gIGNvbnN0IGNoYWluQnlOYW1lID0gbWFrZVNjYWxhck1hcFN0b3JlKFwiY2hhaW5OYW1lXCIpO1xuICByZXR1cm4gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIk9yY2hlc3RyYXRvclwiLFxuICAgIHtcbiAgICAgIG9yY2hlc3RyYXRvcjogT3JjaGVzdHJhdG9ySSxcbiAgICAgIG1ha2VMb2NhbENoYWluRmFjYWRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJtYWtlTG9jYWxDaGFpbkZhY2FkZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVjb3JkKCkpLnJldHVybnMoTS5yZW1vdGFibGUoKSlcbiAgICAgIH0pLFxuICAgICAgbWFrZVJlbW90ZUNoYWluRmFjYWRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICAgIFwibWFrZVJlbW90ZUNoYWluRmFjYWRlV2F0Y2hlclwiLFxuICAgICAgICB7XG4gICAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpLCBNLnN0cmluZygpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS5yZW1vdGFibGUoKSlcbiAgICAgICAgfVxuICAgICAgKVxuICAgIH0sXG4gICAgKCkgPT4ge1xuICAgICAgdHJhY2U3KFwibWFraW5nIGFuIE9yY2hlc3RyYXRvclwiKTtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9LFxuICAgIHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBtYWtlTG9jYWxDaGFpbkZhY2FkZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoYWdvcmljQ2hhaW5JbmZvKSB7XG4gICAgICAgICAgY29uc3QgaXQgPSBtYWtlTG9jYWxDaGFpbkZhY2FkZShhZ29yaWNDaGFpbkluZm8pO1xuICAgICAgICAgIGNoYWluQnlOYW1lLnNldChcImFnb3JpY1wiLCBoYXJkZW4oeyB2YWx1ZTogaXQsIHBlbmRpbmc6IGZhbHNlIH0pKTtcbiAgICAgICAgICByZXR1cm4gaXQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgbWFrZVJlbW90ZUNoYWluRmFjYWRlV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtfYWdvcmljQ2hhaW5JbmZvLCByZW1vdGVDaGFpbkluZm8sIGNvbm5lY3Rpb25JbmZvXSwgbmFtZSkge1xuICAgICAgICAgIGNvbnN0IGl0ID0gbWFrZVJlbW90ZUNoYWluRmFjYWRlKHJlbW90ZUNoYWluSW5mbywgY29ubmVjdGlvbkluZm8pO1xuICAgICAgICAgIGNoYWluQnlOYW1lLnNldChuYW1lLCBoYXJkZW4oeyB2YWx1ZTogaXQsIHBlbmRpbmc6IGZhbHNlIH0pKTtcbiAgICAgICAgICByZXR1cm4gaXQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvcmNoZXN0cmF0b3I6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0Q2hhaW4obmFtZSkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBpZiAoY2hhaW5CeU5hbWUuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICAgIGNvbnN0IG1heWJlQ2hhaW4gPSBjaGFpbkJ5TmFtZS5nZXQobmFtZSk7XG4gICAgICAgICAgICAgIHJldHVybiBtYXliZUNoYWluLnBlbmRpbmcgPyBtYXliZUNoYWluLnZvdyA6IG1heWJlQ2hhaW4udmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB2b3cgPSBuYW1lID09PSBcImFnb3JpY1wiID8gd2F0Y2goXG4gICAgICAgICAgICAgIGNoYWluSHViLmdldENoYWluSW5mbyhcImFnb3JpY1wiKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMubWFrZUxvY2FsQ2hhaW5GYWNhZGVXYXRjaGVyXG4gICAgICAgICAgICApIDogd2F0Y2goXG4gICAgICAgICAgICAgIGNoYWluSHViLmdldENoYWluc0FuZENvbm5lY3Rpb24oXCJhZ29yaWNcIiwgbmFtZSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLm1ha2VSZW1vdGVDaGFpbkZhY2FkZVdhdGNoZXIsXG4gICAgICAgICAgICAgIG5hbWVcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjaGFpbkJ5TmFtZS5pbml0KG5hbWUsIGhhcmRlbih7IHZvdywgcGVuZGluZzogdHJ1ZSB9KSk7XG4gICAgICAgICAgICByZXR1cm4gdm93O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0RGVub21JbmZvKGRlbm9tLCBob2xkaW5nQ2hhaW5OYW1lKSB7XG4gICAgICAgICAgY29uc3QgZGVub21EZXRhaWwgPSBjaGFpbkh1Yi5nZXRBc3NldChkZW5vbSwgaG9sZGluZ0NoYWluTmFtZSk7XG4gICAgICAgICAgaWYgKCFkZW5vbURldGFpbCkgdGhyb3cgdGhyb3dSZWRhY3RlZGBObyBkZW5vbSBkZXRhaWwgZm9yICR7cXVvdGUoZGVub20pfWA7XG4gICAgICAgICAgY29uc3QgeyBjaGFpbk5hbWUsIGJhc2VOYW1lLCBiYXNlRGVub20sIGJyYW5kIH0gPSBkZW5vbURldGFpbDtcbiAgICAgICAgICBjaGFpbkJ5TmFtZS5oYXMoY2hhaW5OYW1lKSB8fCB0aHJvd1JlZGFjdGVkYHVzZSBnZXRDaGFpbigke3F1b3RlKGNoYWluTmFtZSl9KSBiZWZvcmUgZ2V0RGVub21JbmZvKCR7cXVvdGUoZGVub20pfSlgO1xuICAgICAgICAgIGNvbnN0IG1heWJlQ2hhaW4gPSBjaGFpbkJ5TmFtZS5nZXQoY2hhaW5OYW1lKTtcbiAgICAgICAgICBpZiAobWF5YmVDaGFpbi5wZW5kaW5nKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHdhaXQgdW50aWwgZ2V0Q2hhaW4oJHtxdW90ZShjaGFpbk5hbWUpfSkgY29tcGxldGVzIGJlZm9yZSBnZXREZW5vbUluZm8oJHtxdW90ZShkZW5vbSl9KWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGNoYWluID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgbWF5YmVDaGFpbi52YWx1ZVxuICAgICAgICAgICk7XG4gICAgICAgICAgY2hhaW5CeU5hbWUuaGFzKGJhc2VOYW1lKSB8fCB0aHJvd1JlZGFjdGVkYHVzZSBnZXRDaGFpbigke3F1b3RlKGJhc2VOYW1lKX0pIGJlZm9yZSBnZXREZW5vbUluZm8oJHtxdW90ZShkZW5vbSl9KWA7XG4gICAgICAgICAgY29uc3QgbWF5YmVCYXNlID0gY2hhaW5CeU5hbWUuZ2V0KGJhc2VOYW1lKTtcbiAgICAgICAgICBpZiAobWF5YmVCYXNlLnBlbmRpbmcpIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgd2FpdCB1bnRpbCBnZXRDaGFpbigke3F1b3RlKGJhc2VOYW1lKX0pIGNvbXBsZXRlcyBiZWZvcmUgZ2V0RGVub21JbmZvKCR7cXVvdGUoZGVub20pfSlgO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBiYXNlMiA9IChcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG1heWJlQmFzZS52YWx1ZVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGNoYWluLCBiYXNlOiBiYXNlMiwgYnJhbmQsIGJhc2VEZW5vbSB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYXNBbW91bnQ6ICgpID0+IHRocm93UmVkYWN0ZWRgbm90IHlldCBpbXBsZW1lbnRlZGBcbiAgICAgIH1cbiAgICB9XG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVPcmNoZXN0cmF0b3JLaXQpO1xudmFyIHByZXBhcmVPcmNoZXN0cmF0b3IgPSAoem9uZSwgcG93ZXJzKSA9PiB7XG4gIGNvbnN0IG1ha2VPcmNoZXN0cmF0b3JLaXQgPSBwcmVwYXJlT3JjaGVzdHJhdG9yS2l0KHpvbmUsIHBvd2Vycyk7XG4gIHJldHVybiBwaWNrRmFjZXQobWFrZU9yY2hlc3RyYXRvcktpdCwgXCJvcmNoZXN0cmF0b3JcIik7XG59O1xuXG4vL1xudmFyIHRyYWNlOCA9IG1ha2VUcmFjZXIoXCJSZW1vdGVDaGFpbkZhY2FkZVwiKTtcbnZhciBwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGVLaXQgPSAoem9uZSwge1xuICBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnQsXG4gIG9yY2hlc3RyYXRpb24sXG4gIC8vXG4gIC8vXG4gIHN0b3JhZ2VOb2RlLFxuICB0aW1lcixcbiAgdm93VG9vbHM6IHsgYWxsVm93cywgYXNWb3csIHdhdGNoIH1cbn0pID0+IHpvbmUuZXhvQ2xhc3NLaXQoXG4gIFwiUmVtb3RlQ2hhaW5GYWNhZGVcIixcbiAge1xuICAgIHB1YmxpYzogTS5pbnRlcmZhY2UoXCJSZW1vdGVDaGFpbkZhY2FkZVwiLCB7XG4gICAgICAuLi5jaGFpbkZhY2FkZU1ldGhvZHMsXG4gICAgICBxdWVyeTogTS5jYWxsKE0uYXJyYXlPZihJQ1FNc2dTaGFwZSkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgfSksXG4gICAgbWFrZUlDUUNvbm5lY3Rpb25RdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgXCJtYWtlSUNRQ29ubmVjdGlvblF1ZXJ5V2F0Y2hlclwiLFxuICAgICAge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVtb3RhYmxlKCksIE0uYXJyYXlPZihJQ1FNc2dTaGFwZSkpLnJldHVybnMoXG4gICAgICAgICAgVm93U2hhcGVcbiAgICAgICAgKVxuICAgICAgfVxuICAgICksXG4gICAgbWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICBcIm1ha2VBY2NvdW50QW5kUHJvdmlkZVF1ZXJ5Q29ubldhdGNoZXJcIixcbiAgICAgIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbXG4gICAgICAgICAgTS5yZW1vdGFibGUoKSxcbiAgICAgICAgICBNLm9yKE0ucmVtb3RhYmxlKCksIE0udW5kZWZpbmVkKCkpXG4gICAgICAgIF0pLnJldHVybnMoVm93U2hhcGUpXG4gICAgICB9XG4gICAgKSxcbiAgICBnZXRBZGRyZXNzZXNXYXRjaGVyOiBNLmludGVyZmFjZShcImdldEFkZHJlc3NXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoXG4gICAgICAgIFtDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSwgTS5zdHJpbmcoKSwgTS5zdHJpbmcoKV0sXG4gICAgICAgIE0ucmVtb3RhYmxlKClcbiAgICAgICkucmV0dXJucyhWb3dTaGFwZSlcbiAgICB9KSxcbiAgICBtYWtlQ2hpbGROb2RlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJtYWtlQ2hpbGROb2RlV2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ub3IoTS5yZW1vdGFibGUoKSwgTS51bmRlZmluZWQoKSksIHtcbiAgICAgICAgYWNjb3VudDogTS5yZW1vdGFibGUoKSxcbiAgICAgICAgY2hhaW5BZGRyZXNzOiBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICAgICAgbG9jYWxBZGRyZXNzOiBNLnN0cmluZygpLFxuICAgICAgICByZW1vdGVBZGRyZXNzOiBNLnN0cmluZygpXG4gICAgICB9KS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpXG4gICAgfSlcbiAgfSxcbiAgLypcblxuXG4gICAqL1xuICAocmVtb3RlQ2hhaW5JbmZvLCBjb25uZWN0aW9uSW5mbykgPT4ge1xuICAgIHRyYWNlOChcIm1ha2luZyBhIFJlbW90ZUNoYWluRmFjYWRlXCIpO1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICB7XG4gICAgICAgIHJlbW90ZUNoYWluSW5mbyxcbiAgICAgICAgY29ubmVjdGlvbkluZm8sXG4gICAgICAgIGljcUNvbm5lY3Rpb246IHZvaWQgMFxuICAgICAgfVxuICAgICk7XG4gIH0sXG4gIHtcbiAgICBwdWJsaWM6IHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBnZXRDaGFpbkluZm8oKSB7XG4gICAgICAgIHJldHVybiB3YXRjaCh0aGlzLnN0YXRlLnJlbW90ZUNoYWluSW5mbyk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgbWFrZUFjY291bnQoKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyByZW1vdGVDaGFpbkluZm8sIGNvbm5lY3Rpb25JbmZvIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChyZW1vdGVDaGFpbkluZm8ubmFtZXNwYWNlICE9PSBcImNvc21vc1wiKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYG9ubHkgc3VwcG9ydGVkIG9uICdjb3Ntb3MnIGNoYWlucywgbm90ICR7cmVtb3RlQ2hhaW5JbmZvLm5hbWVzcGFjZX1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWNvbm5lY3Rpb25JbmZvKSB0aHJvdyB0aHJvd1JlZGFjdGVkYElCQyBjb25uZWN0aW9uIGluZm8gbm90IGZvdW5kYDtcbiAgICAgICAgICBjb25zdCBpY3FDb25uT3JVbmRlZmluZWRWID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICByZW1vdGVDaGFpbkluZm8/LmljcUVuYWJsZWQgJiYgIXRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbiA/IEUob3JjaGVzdHJhdGlvbikucHJvdmlkZUlDUUNvbm5lY3Rpb24oY29ubmVjdGlvbkluZm8uaWQpIDogdm9pZCAwXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCBtYWtlQWNjb3VudFYgPSBFKG9yY2hlc3RyYXRpb24pLm1ha2VBY2NvdW50KFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICByZW1vdGVDaGFpbkluZm8uY2hhaW5JZCxcbiAgICAgICAgICAgIGNvbm5lY3Rpb25JbmZvLmNvdW50ZXJwYXJ0eS5jb25uZWN0aW9uX2lkLFxuICAgICAgICAgICAgY29ubmVjdGlvbkluZm8uaWRcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIGFsbFZvd3MoW21ha2VBY2NvdW50ViwgaWNxQ29ubk9yVW5kZWZpbmVkVl0pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMubWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHF1ZXJ5KG1zZ3MpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHJlbW90ZUNoYWluSW5mbzogeyBpY3FFbmFibGVkLCBjaGFpbklkIH0sXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgY29ubmVjdGlvbkluZm9cbiAgICAgICAgICB9ID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLnN0YXRlXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIWljcUVuYWJsZWQpIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluSWQpfWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghY29ubmVjdGlvbkluZm8pIHRocm93IHRocm93UmVkYWN0ZWRgSUJDIGNvbm5lY3Rpb24gaW5mbyBub3QgZm91bmRgO1xuICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUob3JjaGVzdHJhdGlvbikucHJvdmlkZUlDUUNvbm5lY3Rpb24oY29ubmVjdGlvbkluZm8uaWQpLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5tYWtlSUNRQ29ubmVjdGlvblF1ZXJ5V2F0Y2hlcixcbiAgICAgICAgICAgICAgbXNnc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUodGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKS5xdWVyeShtc2dzKSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlcjoge1xuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChbYWNjb3VudCwgaWNxQ29ubmVjdGlvbl0pIHtcbiAgICAgICAgaWYgKGljcUNvbm5lY3Rpb24gJiYgIXRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgIHRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbiA9IGljcUNvbm5lY3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgIGFsbFZvd3MoW1xuICAgICAgICAgICAgRShhY2NvdW50KS5nZXRBZGRyZXNzKCksXG4gICAgICAgICAgICBFKGFjY291bnQpLmdldExvY2FsQWRkcmVzcygpLFxuICAgICAgICAgICAgRShhY2NvdW50KS5nZXRSZW1vdGVBZGRyZXNzKClcbiAgICAgICAgICBdKSxcbiAgICAgICAgICB0aGlzLmZhY2V0cy5nZXRBZGRyZXNzZXNXYXRjaGVyLFxuICAgICAgICAgIGFjY291bnRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1ha2VJQ1FDb25uZWN0aW9uUXVlcnlXYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChpY3FDb25uZWN0aW9uLCBtc2dzKSB7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uID0gaWNxQ29ubmVjdGlvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gd2F0Y2goRShpY3FDb25uZWN0aW9uKS5xdWVyeShtc2dzKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBnZXRBZGRyZXNzZXNXYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoW2NoYWluQWRkcmVzcywgbG9jYWxBZGRyZXNzLCByZW1vdGVBZGRyZXNzXSwgYWNjb3VudCkge1xuICAgICAgICBjb25zdCBvcHRpb25hbFN0b3JhZ2VOb2RlID0gc3RvcmFnZU5vZGUgPyBFKHN0b3JhZ2VOb2RlKS5tYWtlQ2hpbGROb2RlKGNoYWluQWRkcmVzcy52YWx1ZSkgOiB2b2lkIDA7XG4gICAgICAgIHJldHVybiB3YXRjaChvcHRpb25hbFN0b3JhZ2VOb2RlLCB0aGlzLmZhY2V0cy5tYWtlQ2hpbGROb2RlV2F0Y2hlciwge1xuICAgICAgICAgIGFjY291bnQsXG4gICAgICAgICAgY2hhaW5BZGRyZXNzLFxuICAgICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgICByZW1vdGVBZGRyZXNzXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUNoaWxkTm9kZVdhdGNoZXI6IHtcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoY2hpbGROb2RlLCB7IGFjY291bnQsIGNoYWluQWRkcmVzcywgbG9jYWxBZGRyZXNzLCByZW1vdGVBZGRyZXNzIH0pIHtcbiAgICAgICAgY29uc3QgeyBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gbWFrZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50KFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGNoYWluQWRkcmVzcyxcbiAgICAgICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgICAgIHJlbW90ZUFkZHJlc3NcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGFjY291bnQsXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgc3RvcmFnZU5vZGU6IGNoaWxkTm9kZSxcbiAgICAgICAgICAgIGljcUNvbm5lY3Rpb24sXG4gICAgICAgICAgICB0aW1lclxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG5oYXJkZW4ocHJlcGFyZVJlbW90ZUNoYWluRmFjYWRlS2l0KTtcbnZhciBwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGUgPSAoem9uZSwgcG93ZXJzKSA9PiB7XG4gIGNvbnN0IG1ha2VMb2NhbENoYWluRmFjYWRlS2l0ID0gcHJlcGFyZVJlbW90ZUNoYWluRmFjYWRlS2l0KHpvbmUsIHBvd2Vycyk7XG4gIHJldHVybiBwaWNrRmFjZXQobWFrZUxvY2FsQ2hhaW5GYWNhZGVLaXQsIFwicHVibGljXCIpO1xufTtcbmhhcmRlbihwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGUpO1xuXG4vL1xudmFyIG1ha2VPcmNoZXN0cmF0aW9uRmFjYWRlID0gKHtcbiAgem9uZSxcbiAgdGltZXJTZXJ2aWNlLFxuICB6Y2YsXG4gIG9yY2hlc3RyYXRpb25TZXJ2aWNlLFxuICBtYWtlT3JjaGVzdHJhdG9yLFxuICB2b3dUb29scyxcbiAgYXN5bmNGbG93VG9vbHNcbn0pID0+IHtcbiAgYXNzZXJ0QWxsRGVmaW5lZCh7XG4gICAgem9uZSxcbiAgICB0aW1lclNlcnZpY2UsXG4gICAgemNmLFxuICAgIG9yY2hlc3RyYXRpb25TZXJ2aWNlLFxuICAgIG1ha2VPcmNoZXN0cmF0b3IsXG4gICAgdm93VG9vbHMsXG4gICAgYXN5bmNGbG93VG9vbHNcbiAgfSk7XG4gIGNvbnN0IHsgcHJlcGFyZUVuZG93bWVudCwgYXN5bmNGbG93IH0gPSBhc3luY0Zsb3dUb29scztcbiAgY29uc3Qgb3JjaGVzdHJhdGUgPSAoZHVyYWJsZU5hbWUsIGhvc3RDdHgsIGd1ZXN0Rm4pID0+IHtcbiAgICBjb25zdCBzdWJab25lID0gem9uZS5zdWJab25lKGR1cmFibGVOYW1lKTtcbiAgICBjb25zdCBbd3JhcHBlZEN0eF0gPSBwcmVwYXJlRW5kb3dtZW50KHN1YlpvbmUsIFwiZW5kb3dtZW50c1wiLCBbaG9zdEN0eF0pO1xuICAgIGNvbnN0IGhvc3RGbiA9IGFzeW5jRmxvdyhzdWJab25lLCBcImFzeW5jRmxvd1wiLCBndWVzdEZuKTtcbiAgICBkZWVwTWFwT2JqZWN0KFxuICAgICAgd3JhcHBlZEN0eCxcbiAgICAgICh2YWwpID0+IHZhbCA9PT0gemNmICYmIGFzc2VydC5mYWlsKFwiZG8gbm90IHVzZSB6Y2YgaW4gb3JjaGVzdHJhdGlvbiBjb250ZXh0OyB0cnkgemNmVG9vbHNcIilcbiAgICApO1xuICAgIGNvbnN0IG9yY0ZuID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgY29uc3QgaG9zdE9yYyA9IG1ha2VPcmNoZXN0cmF0b3IoKTtcbiAgICAgICAgcmV0dXJuIGhvc3RGbihob3N0T3JjLCB3cmFwcGVkQ3R4LCAuLi5hcmdzKTtcbiAgICAgIH1cbiAgICApO1xuICAgIHJldHVybiBoYXJkZW4ob3JjRm4pO1xuICB9O1xuICBjb25zdCBvcmNoZXN0cmF0ZUFsbCA9IChndWVzdEZucywgaG9zdEN0eCkgPT4ge1xuICAgIGNvbnN0IG1hcHBlZEZsb3dzID0gbmV3IE1hcChcbiAgICAgIE9iamVjdC5lbnRyaWVzKGd1ZXN0Rm5zKS5tYXAoKFtuYW1lLCBndWVzdEZuXSkgPT4gW1xuICAgICAgICBndWVzdEZuLFxuICAgICAgICAoLi4uYXJncykgPT4gb3JjRm5zW25hbWVdKC4uLmFyZ3MpXG4gICAgICBdKVxuICAgICk7XG4gICAgY29uc3QgbWFwcGVkQ29udGV4dCA9IGRlZXBNYXBPYmplY3QoXG4gICAgICBob3N0Q3R4LFxuICAgICAgKHZhbCkgPT4gbWFwcGVkRmxvd3MuZ2V0KFxuICAgICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApIHx8IHZhbFxuICAgICk7XG4gICAgY29uc3Qgb3JjRm5zID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgIE9iamVjdC5lbnRyaWVzKGd1ZXN0Rm5zKS5tYXAoKFtuYW1lLCBndWVzdEZuXSkgPT4gW1xuICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgb3JjaGVzdHJhdGUobmFtZSwgbWFwcGVkQ29udGV4dCwgZ3Vlc3RGbilcbiAgICAgICAgXSlcbiAgICAgIClcbiAgICApO1xuICAgIHJldHVybiB7IC4uLm9yY0ZucyB9O1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBvcmNoZXN0cmF0ZSxcbiAgICBvcmNoZXN0cmF0ZUFsbFxuICB9KTtcbn07XG5oYXJkZW4obWFrZU9yY2hlc3RyYXRpb25GYWNhZGUpO1xuXG4vL1xudmFyIG5hdFNhZmVNYXRoID0gaGFyZGVuKHtcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgLy9cbiAgYWRkOiAoeCwgeSkgPT4gTmF0KHgpICsgTmF0KHkpLFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBzdWJ0cmFjdDogKHgsIHkpID0+IE5hdChOYXQoeCkgLSBOYXQoeSkpLFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBtdWx0aXBseTogKHgsIHkpID0+IE5hdCh4KSAqIE5hdCh5KSxcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgZmxvb3JEaXZpZGU6ICh4LCB5KSA9PiBOYXQoeCkgLyBOYXQoeSksXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIGNlaWxEaXZpZGU6ICh4LCB5KSA9PiB7XG4gICAgeSA9IE5hdCh5KTtcbiAgICByZXR1cm4gTmF0KE5hdCh4KSArIHkgLSAxbikgLyB5O1xuICB9LFxuICAvKlxuXG5cblxuXG4gICAqL1xuICBiYW5rZXJzRGl2aWRlOiAoYTIsIGIzKSA9PiB7XG4gICAgYTIgPSBOYXQoYTIpO1xuICAgIGIzID0gTmF0KGIzKTtcbiAgICBjb25zdCBkaXYgPSBhMiAvIGIzO1xuICAgIGNvbnN0IHJlbSA9IGEyICUgYjM7XG4gICAgaWYgKHJlbSAqIDJuID4gYjMpIHtcbiAgICAgIHJldHVybiBkaXYgKyAxbjtcbiAgICB9IGVsc2UgaWYgKHJlbSAqIDJuID09PSBiMykge1xuICAgICAgaWYgKGRpdiAlIDJuID09PSAxbikgcmV0dXJuIGRpdiArIDFuO1xuICAgIH1cbiAgICByZXR1cm4gZGl2O1xuICB9LFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgaXNHVEU6ICh4LCB5KSA9PiBOYXQoeCkgPj0gTmF0KHkpXG59KTtcblxuLy9cbnZhciB7IHN1YnRyYWN0LCBhZGQsIG11bHRpcGx5LCBmbG9vckRpdmlkZSB9ID0gbmF0U2FmZU1hdGg7XG5cbi8vXG52YXIgbWFrZVN0YXRlTWFjaGluZSA9IChpbml0aWFsU3RhdGUsIGFsbG93ZWRUcmFuc2l0aW9uc0FycmF5KSA9PiB7XG4gIGxldCBzdGF0ZSA9IGluaXRpYWxTdGF0ZTtcbiAgY29uc3QgYWxsb3dlZFRyYW5zaXRpb25zID0gbmV3IE1hcChhbGxvd2VkVHJhbnNpdGlvbnNBcnJheSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGNhblRyYW5zaXRpb25UbzogKG5leHRTdGF0ZSkgPT4gYWxsb3dlZFRyYW5zaXRpb25zLmdldChzdGF0ZSkuaW5jbHVkZXMobmV4dFN0YXRlKSxcbiAgICB0cmFuc2l0aW9uVG86IChuZXh0U3RhdGUpID0+IHtcbiAgICAgIGFzc2VydDIoYWxsb3dlZFRyYW5zaXRpb25zLmdldChzdGF0ZSkuaW5jbHVkZXMobmV4dFN0YXRlKSk7XG4gICAgICBzdGF0ZSA9IG5leHRTdGF0ZTtcbiAgICB9LFxuICAgIGdldFN0YXR1czogKF8pID0+IHN0YXRlXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU3RhdGVNYWNoaW5lKTtcblxuLy9cbnZhciBLZXl3b3JkU2hhcGUgPSBNLnN0cmluZygpO1xudmFyIEludml0YXRpb25IYW5kbGVTaGFwZSA9IE0ucmVtb3RhYmxlKFwiSW52aXRhdGlvbkhhbmRsZVwiKTtcbnZhciBJbnZpdGF0aW9uU2hhcGUgPSBNLnJlbW90YWJsZShcIkludml0YXRpb25cIik7XG52YXIgSW5zdGFuY2VIYW5kbGVTaGFwZSA9IE0ucmVtb3RhYmxlKFwiSW5zdGFuY2VIYW5kbGVcIik7XG52YXIgSW5zdGFsbGF0aW9uU2hhcGUgPSBNLnJlbW90YWJsZShcIkluc3RhbGxhdGlvblwiKTtcbnZhciBTZWF0U2hhcGUgPSBNLnJlbW90YWJsZShcIlNlYXRcIik7XG52YXIgQW1vdW50S2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihLZXl3b3JkU2hhcGUsIEFtb3VudFNoYXBlKTtcbnZhciBBbW91bnRQYXR0ZXJuS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihcbiAgS2V5d29yZFNoYXBlLFxuICBNLnBhdHRlcm4oKVxuKTtcbnZhciBQYXltZW50UEtleXdvcmRSZWNvcmRTaGFwZSA9IE0ucmVjb3JkT2YoXG4gIEtleXdvcmRTaGFwZSxcbiAgTS5lcmVmKFBheW1lbnRTaGFwZSlcbik7XG52YXIgSXNzdWVyS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihLZXl3b3JkU2hhcGUsIElzc3VlclNoYXBlKTtcbnZhciBJc3N1ZXJQS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihcbiAgS2V5d29yZFNoYXBlLFxuICBNLmVyZWYoSXNzdWVyU2hhcGUpXG4pO1xudmFyIEJyYW5kS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihLZXl3b3JkU2hhcGUsIEJyYW5kU2hhcGUpO1xudmFyIElzc3VlclJlY29yZFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGJyYW5kOiBCcmFuZFNoYXBlLFxuICAgIGlzc3VlcjogSXNzdWVyU2hhcGUsXG4gICAgYXNzZXRLaW5kOiBBc3NldEtpbmRTaGFwZVxuICB9LFxuICB7IGRpc3BsYXlJbmZvOiBEaXNwbGF5SW5mb1NoYXBlIH1cbik7XG52YXIgVGVybXNTaGFwZSA9IHtcbiAgaXNzdWVyczogSXNzdWVyS2V5d29yZFJlY29yZFNoYXBlLFxuICBicmFuZHM6IEJyYW5kS2V5d29yZFJlY29yZFNoYXBlXG59O1xuaGFyZGVuKFRlcm1zU2hhcGUpO1xudmFyIEluc3RhbmNlUmVjb3JkU2hhcGUgPSB7XG4gIGluc3RhbGxhdGlvbjogSW5zdGFsbGF0aW9uU2hhcGUsXG4gIGluc3RhbmNlOiBJbnN0YW5jZUhhbmRsZVNoYXBlLFxuICB0ZXJtczogTS5zcGxpdFJlY29yZChUZXJtc1NoYXBlKVxufTtcbmhhcmRlbihJbnN0YW5jZVJlY29yZFNoYXBlKTtcbnZhciBIYW5kbGVJID0gTS5pbnRlcmZhY2UoXCJIYW5kbGVcIiwge30pO1xudmFyIG1ha2VIYW5kbGVTaGFwZSA9IChuYW1lKSA9PiBNLnJlbW90YWJsZShgJHtuYW1lfUhhbmRsZWApO1xudmFyIFRpbWVyU2hhcGUgPSBtYWtlSGFuZGxlU2hhcGUoXCJ0aW1lclwiKTtcbnZhciBGdWxsUHJvcG9zYWxTaGFwZSA9IHtcbiAgd2FudDogQW1vdW50UGF0dGVybktleXdvcmRSZWNvcmRTaGFwZSxcbiAgZ2l2ZTogQW1vdW50S2V5d29yZFJlY29yZFNoYXBlLFxuICAvL1xuICAvL1xuICAvL1xuICBleGl0OiBNLnNwbGl0UmVjb3JkKFxuICAgIHt9LFxuICAgIHtcbiAgICAgIG9uRGVtYW5kOiBudWxsLFxuICAgICAgd2FpdmVkOiBudWxsLFxuICAgICAgYWZ0ZXJEZWFkbGluZToge1xuICAgICAgICB0aW1lcjogTS5lcmVmKFRpbWVyU2hhcGUpLFxuICAgICAgICBkZWFkbGluZTogVGltZXN0YW1wU2hhcGVcbiAgICAgIH1cbiAgICB9LFxuICAgIHt9XG4gIClcbn07XG5oYXJkZW4oRnVsbFByb3Bvc2FsU2hhcGUpO1xudmFyIFByb3Bvc2FsU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHt9LCBGdWxsUHJvcG9zYWxTaGFwZSwge30pO1xudmFyIEVtcHR5UHJvcG9zYWxTaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBnaXZlOiB7fSxcbiAgd2FudDoge30sXG4gIGV4aXQ6IHsgb25EZW1hbmQ6IG51bGwgfVxufSk7XG52YXIgaXNPbkRlbWFuZEV4aXRSdWxlID0gKGV4aXQpID0+IHtcbiAgY29uc3QgW2V4aXRLZXldID0gT2JqZWN0LmtleXMoZXhpdCk7XG4gIHJldHVybiBleGl0S2V5ID09PSBcIm9uRGVtYW5kXCI7XG59O1xuaGFyZGVuKGlzT25EZW1hbmRFeGl0UnVsZSk7XG52YXIgaXNXYWl2ZWRFeGl0UnVsZSA9IChleGl0KSA9PiB7XG4gIGNvbnN0IFtleGl0S2V5XSA9IE9iamVjdC5rZXlzKGV4aXQpO1xuICByZXR1cm4gZXhpdEtleSA9PT0gXCJ3YWl2ZWRcIjtcbn07XG5oYXJkZW4oaXNXYWl2ZWRFeGl0UnVsZSk7XG52YXIgaXNBZnRlckRlYWRsaW5lRXhpdFJ1bGUgPSAoZXhpdCkgPT4ge1xuICBjb25zdCBbZXhpdEtleV0gPSBPYmplY3Qua2V5cyhleGl0KTtcbiAgcmV0dXJuIGV4aXRLZXkgPT09IFwiYWZ0ZXJEZWFkbGluZVwiO1xufTtcbmhhcmRlbihpc0FmdGVyRGVhZGxpbmVFeGl0UnVsZSk7XG52YXIgSW52aXRhdGlvbkVsZW1lbnRTaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBkZXNjcmlwdGlvbjogTS5zdHJpbmcoKSxcbiAgaGFuZGxlOiBJbnZpdGF0aW9uSGFuZGxlU2hhcGUsXG4gIGluc3RhbmNlOiBJbnN0YW5jZUhhbmRsZVNoYXBlLFxuICBpbnN0YWxsYXRpb246IEluc3RhbGxhdGlvblNoYXBlXG59KTtcbnZhciBPZmZlckhhbmRsZXJJID0gTS5pbnRlcmZhY2UoXCJPZmZlckhhbmRsZXJcIiwge1xuICBoYW5kbGU6IE0uY2FsbChTZWF0U2hhcGUpLm9wdGlvbmFsKE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbn0pO1xudmFyIFNlYXRIYW5kbGVBbGxvY2F0aW9uc1NoYXBlID0gTS5hcnJheU9mKHtcbiAgc2VhdEhhbmRsZTogU2VhdFNoYXBlLFxuICBhbGxvY2F0aW9uOiBBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGVcbn0pO1xudmFyIFpvZU1pbnRTaGFwZSA9IE0ucmVtb3RhYmxlKFwiWm9lTWludFwiKTtcbnZhciBab2VNaW50SSA9IE0uaW50ZXJmYWNlKFwiWm9lTWludFwiLCB7XG4gIGdldElzc3VlclJlY29yZDogTS5jYWxsKCkucmV0dXJucyhJc3N1ZXJSZWNvcmRTaGFwZSksXG4gIG1pbnRBbmRFc2Nyb3c6IE0uY2FsbChBbW91bnRTaGFwZSkucmV0dXJucygpLFxuICB3aXRoZHJhd0FuZEJ1cm46IE0uY2FsbChBbW91bnRTaGFwZSkucmV0dXJucygpXG59KTtcbnZhciBGZWVNaW50QWNjZXNzU2hhcGUgPSBNLnJlbW90YWJsZShcIkZlZU1pbnRBY2Nlc3NcIik7XG52YXIgRXhpdE9iamVjdEkgPSBNLmludGVyZmFjZShcIkV4aXQgT2JqZWN0XCIsIHtcbiAgZXhpdDogTS5jYWxsKCkucmV0dXJucygpXG59KTtcbnZhciBFeGl0T2JqZWN0U2hhcGUgPSBNLnJlbW90YWJsZShcIkV4aXRPYmpcIik7XG52YXIgSW5zdGFuY2VBZG1pblNoYXBlID0gTS5yZW1vdGFibGUoXCJJbnN0YW5jZUFkbWluXCIpO1xudmFyIEluc3RhbmNlQWRtaW5JID0gTS5pbnRlcmZhY2UoXCJJbnN0YW5jZUFkbWluXCIsIHtcbiAgbWFrZUludml0YXRpb246IE0uY2FsbChJbnZpdGF0aW9uSGFuZGxlU2hhcGUsIE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0ucmVjb3JkKCksIE0ucGF0dGVybigpKS5yZXR1cm5zKEludml0YXRpb25TaGFwZSksXG4gIHNhdmVJc3N1ZXI6IE0uY2FsbFdoZW4oTS5hd2FpdChJc3N1ZXJTaGFwZSksIEtleXdvcmRTaGFwZSkucmV0dXJucyhcbiAgICBJc3N1ZXJSZWNvcmRTaGFwZVxuICApLFxuICBtYWtlTm9Fc2Nyb3dTZWF0OiBNLmNhbGwoXG4gICAgQW1vdW50S2V5d29yZFJlY29yZFNoYXBlLFxuICAgIFByb3Bvc2FsU2hhcGUsXG4gICAgRXhpdE9iamVjdFNoYXBlLFxuICAgIFNlYXRTaGFwZVxuICApLnJldHVybnMoU2VhdFNoYXBlKSxcbiAgZXhpdEFsbFNlYXRzOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpLFxuICBmYWlsQWxsU2VhdHM6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKCksXG4gIGV4aXRTZWF0OiBNLmNhbGwoU2VhdFNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKCksXG4gIGZhaWxTZWF0OiBNLmNhbGwoU2VhdFNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKCksXG4gIG1ha2Vab2VNaW50OiBNLmNhbGwoS2V5d29yZFNoYXBlKS5vcHRpb25hbChcbiAgICBBc3NldEtpbmRTaGFwZSxcbiAgICBEaXNwbGF5SW5mb1NoYXBlLFxuICAgIE0uc3BsaXRSZWNvcmQoe30sIHsgZWxlbWVudFNoYXBlOiBNLnBhdHRlcm4oKSB9KVxuICApLnJldHVybnMoTS5yZW1vdGFibGUoXCJ6b2VNaW50XCIpKSxcbiAgcmVnaXN0ZXJGZWVNaW50OiBNLmNhbGwoS2V5d29yZFNoYXBlLCBGZWVNaW50QWNjZXNzU2hhcGUpLnJldHVybnMoXG4gICAgTS5yZW1vdGFibGUoXCJmZWVNaW50XCIpXG4gICksXG4gIHJlcGxhY2VBbGxvY2F0aW9uczogTS5jYWxsKFNlYXRIYW5kbGVBbGxvY2F0aW9uc1NoYXBlKS5yZXR1cm5zKCksXG4gIHN0b3BBY2NlcHRpbmdPZmZlcnM6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgc2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbChNLmFycmF5T2YoTS5zdHJpbmcoKSkpLnJldHVybnMoKSxcbiAgZ2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbCgpLnJldHVybnMoTS5hcnJheU9mKE0uc3RyaW5nKCkpKSxcbiAgZ2V0RXhpdFN1YnNjcmliZXI6IE0uY2FsbChTZWF0U2hhcGUpLnJldHVybnMoU3Vic2NyaWJlclNoYXBlKSxcbiAgaXNCbG9ja2VkOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhNLmJvb2xlYW4oKSksXG4gIHJlcGFpckNvbnRyYWN0Q29tcGxldGlvbldhdGNoZXI6IE0uY2FsbCgpLnJldHVybnMoKVxufSk7XG52YXIgSW5zdGFuY2VTdG9yYWdlTWFuYWdlcklLaXQgPSB7XG4gIGluc3RhbmNlU3RvcmFnZU1hbmFnZXI6IE0uaW50ZXJmYWNlKFwiSW5zdGFuY2VTdG9yYWdlTWFuYWdlclwiLCB7XG4gICAgZ2V0VGVybXM6IE0uY2FsbCgpLnJldHVybnMoTS5zcGxpdFJlY29yZChUZXJtc1NoYXBlKSksXG4gICAgZ2V0SXNzdWVyczogTS5jYWxsKCkucmV0dXJucyhJc3N1ZXJLZXl3b3JkUmVjb3JkU2hhcGUpLFxuICAgIGdldEJyYW5kczogTS5jYWxsKCkucmV0dXJucyhCcmFuZEtleXdvcmRSZWNvcmRTaGFwZSksXG4gICAgZ2V0SW5zdGFsbGF0aW9uOiBNLmNhbGwoKS5yZXR1cm5zKEluc3RhbGxhdGlvblNoYXBlKSxcbiAgICBnZXRJbnZpdGF0aW9uSXNzdWVyOiBNLmNhbGwoKS5yZXR1cm5zKElzc3VlclNoYXBlKSxcbiAgICBzYXZlSXNzdWVyOiBNLmNhbGwoSXNzdWVyU2hhcGUsIEtleXdvcmRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgbWFrZVpvZU1pbnQ6IE0uY2FsbChLZXl3b3JkU2hhcGUpLm9wdGlvbmFsKFxuICAgICAgQXNzZXRLaW5kU2hhcGUsXG4gICAgICBEaXNwbGF5SW5mb1NoYXBlLFxuICAgICAgTS5zcGxpdFJlY29yZCh7fSwgeyBlbGVtZW50U2hhcGU6IE0ucGF0dGVybigpIH0pXG4gICAgKS5yZXR1cm5zKE0uZXJlZihab2VNaW50U2hhcGUpKSxcbiAgICByZWdpc3RlckZlZU1pbnQ6IE0uY2FsbChLZXl3b3JkU2hhcGUsIEZlZU1pbnRBY2Nlc3NTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ucmVtb3RhYmxlKFwiZmVlTWludFwiKVxuICAgICksXG4gICAgZ2V0SW5zdGFuY2VSZWNvcmQ6IE0uY2FsbCgpLnJldHVybnMoSW5zdGFuY2VSZWNvcmRTaGFwZSksXG4gICAgZ2V0SXNzdWVyUmVjb3JkczogTS5jYWxsKCkucmV0dXJucyhNLmFycmF5T2YoSXNzdWVyUmVjb3JkU2hhcGUpKSxcbiAgICBnZXRXaXRoZHJhd0ZhY2V0OiBNLmNhbGwoKS5yZXR1cm5zKE0ucmVtb3RhYmxlKFwiV2l0aGRyYXdGYWNldFwiKSksXG4gICAgaW5pdEluc3RhbmNlQWRtaW46IE0uY2FsbChcbiAgICAgIEluc3RhbmNlSGFuZGxlU2hhcGUsXG4gICAgICBNLnJlbW90YWJsZShcImluc3RhbmNlQWRtaW5cIilcbiAgICApLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIGRlbGV0ZUluc3RhbmNlQWRtaW46IE0uY2FsbChJbnN0YW5jZUFkbWluU2hhcGUpLnJldHVybnMoKSxcbiAgICBtYWtlSW52aXRhdGlvbjogTS5jYWxsKEludml0YXRpb25IYW5kbGVTaGFwZSwgTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5yZWNvcmQoKSwgTS5wYXR0ZXJuKCkpLnJldHVybnMoUGF5bWVudFNoYXBlKSxcbiAgICBnZXRSb290OiBNLmNhbGwoKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgIGdldEFkbWluTm9kZTogTS5jYWxsKCkucmV0dXJucyhNLnJlbW90YWJsZShcImFkbWluTm9kZVwiKSlcbiAgfSksXG4gIHdpdGhkcmF3RmFjZXQ6IE0uaW50ZXJmYWNlKFwiV2l0aGRyYXdGYWNldFwiLCB7XG4gICAgd2l0aGRyYXdQYXltZW50czogTS5jYWxsKEFtb3VudEtleXdvcmRSZWNvcmRTaGFwZSkucmV0dXJucyhcbiAgICAgIFBheW1lbnRQS2V5d29yZFJlY29yZFNoYXBlXG4gICAgKVxuICB9KSxcbiAgaGVscGVyczogTS5pbnRlcmZhY2UoXCJJbnN0YW5jZVN0b3JhZ2VNYW5hZ2VyIGhlbHBlclwiLCB7XG4gICAgd3JhcElzc3VlcktpdFdpdGhab2VNaW50OiBNLmNhbGwoXG4gICAgICBLZXl3b3JkU2hhcGUsXG4gICAgICBJc3N1ZXJLaXRTaGFwZSxcbiAgICAgIE0ucmVtb3RhYmxlKFwiYWRtaW5Ob2RlXCIpXG4gICAgKS5yZXR1cm5zKFpvZU1pbnRTaGFwZSlcbiAgfSlcbn07XG5oYXJkZW4oSW5zdGFuY2VTdG9yYWdlTWFuYWdlcklLaXQpO1xudmFyIEJ1bmRsZUNhcFNoYXBlID0gTS5yZW1vdGFibGUoXCJidW5kbGVDYXBcIik7XG52YXIgQnVuZGxlU2hhcGUgPSBNLmFuZChcbiAgTS5zcGxpdFJlY29yZCh7IG1vZHVsZUZvcm1hdDogTS5hbnkoKSB9KSxcbiAgTS5yZWNvcmRPZihNLnN0cmluZygpLCBNLnN0cmluZyh7IHN0cmluZ0xlbmd0aExpbWl0OiBJbmZpbml0eSB9KSlcbik7XG52YXIgVW53cmFwcGVkSW5zdGFsbGF0aW9uU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7IGluc3RhbGxhdGlvbjogSW5zdGFsbGF0aW9uU2hhcGUgfSxcbiAge1xuICAgIGJ1bmRsZTogTS5yZWNvcmRPZihNLnN0cmluZygpLCBNLnN0cmluZyh7IHN0cmluZ0xlbmd0aExpbWl0OiBJbmZpbml0eSB9KSksXG4gICAgYnVuZGxlQ2FwOiBCdW5kbGVDYXBTaGFwZSxcbiAgICBidW5kbGVJRDogTS5zdHJpbmcoKVxuICB9LFxuICB7fVxuKTtcbnZhciBab2VTdG9yYWdlTWFuYWdlcklLaXQgPSB7XG4gIHpvZVNlcnZpY2VEYXRhQWNjZXNzOiBNLmludGVyZmFjZShcIlpvZVNlcnZpY2UgZGF0YUFjY2Vzc1wiLCB7XG4gICAgZ2V0VGVybXM6IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKE0uc3BsaXRSZWNvcmQoVGVybXNTaGFwZSkpLFxuICAgIGdldElzc3VlcnM6IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKElzc3VlcktleXdvcmRSZWNvcmRTaGFwZSksXG4gICAgZ2V0QnJhbmRzOiBNLmNhbGwoSW5zdGFuY2VIYW5kbGVTaGFwZSkucmV0dXJucyhCcmFuZEtleXdvcmRSZWNvcmRTaGFwZSksXG4gICAgZ2V0SW5zdGFsbGF0aW9uOiBNLmNhbGwoSW5zdGFuY2VIYW5kbGVTaGFwZSkucmV0dXJucyhcbiAgICAgIE0uZXJlZihNLnJlbW90YWJsZShcIkluc3RhbGxhdGlvblwiKSlcbiAgICApLFxuICAgIGdldEludml0YXRpb25Jc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUpLFxuICAgIGdldEJ1bmRsZUlERnJvbUluc3RhbGxhdGlvbjogTS5jYWxsKEluc3RhbGxhdGlvblNoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5lcmVmKE0uc3RyaW5nKCkpXG4gICAgKSxcbiAgICBpbnN0YWxsQnVuZGxlOiBNLmNhbGwoQnVuZGxlU2hhcGUpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIGluc3RhbGxCdW5kbGVJRDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIGdldFB1YmxpY0ZhY2V0OiBNLmNhbGwoSW5zdGFuY2VIYW5kbGVTaGFwZSkucmV0dXJucyhcbiAgICAgIE0uZXJlZihNLnJlbW90YWJsZShcIlB1YmxpY0ZhY2V0XCIpKVxuICAgICksXG4gICAgZ2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKE0uYXJyYXlPZihNLnN0cmluZygpKSksXG4gICAgZ2V0UHJvcG9zYWxTaGFwZUZvckludml0YXRpb246IE0uY2FsbChJbnZpdGF0aW9uSGFuZGxlU2hhcGUpLnJldHVybnMoXG4gICAgICBNLm9wdChNLnBhdHRlcm4oKSlcbiAgICApXG4gIH0pLFxuICBtYWtlT2ZmZXJBY2Nlc3M6IE0uaW50ZXJmYWNlKFwiWm9lU3RvcmFnZSBtYWtlT2ZmZXIgYWNjZXNzXCIsIHtcbiAgICBnZXRBc3NldEtpbmRCeUJyYW5kOiBNLmNhbGwoQnJhbmRTaGFwZSkucmV0dXJucyhBc3NldEtpbmRTaGFwZSksXG4gICAgZ2V0SW5zdGFuY2VBZG1pbjogTS5jYWxsKEluc3RhbmNlSGFuZGxlU2hhcGUpLnJldHVybnMoXG4gICAgICBNLnJlbW90YWJsZShcImluc3RhbmNlQWRtaW5cIilcbiAgICApLFxuICAgIGdldFByb3Bvc2FsU2hhcGVGb3JJbnZpdGF0aW9uOiBNLmNhbGwoSW52aXRhdGlvbkhhbmRsZVNoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5vcHQoTS5wYXR0ZXJuKCkpXG4gICAgKSxcbiAgICBnZXRJbnZpdGF0aW9uSXNzdWVyOiBNLmNhbGwoKS5yZXR1cm5zKElzc3VlclNoYXBlKSxcbiAgICBkZXBvc2l0UGF5bWVudHM6IE0uY2FsbChQcm9wb3NhbFNoYXBlLCBQYXltZW50UEtleXdvcmRSZWNvcmRTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ucHJvbWlzZSgpXG4gICAgKVxuICB9KSxcbiAgc3RhcnRJbnN0YW5jZUFjY2VzczogTS5pbnRlcmZhY2UoXCJab2VTdG9yYWdlIHN0YXJ0SW5zdGFuY2UgYWNjZXNzXCIsIHtcbiAgICBtYWtlWm9lSW5zdGFuY2VTdG9yYWdlTWFuYWdlcjogTS5jYWxsKFxuICAgICAgSW5zdGFsbGF0aW9uU2hhcGUsXG4gICAgICBNLmFueSgpLFxuICAgICAgSXNzdWVyUEtleXdvcmRSZWNvcmRTaGFwZSxcbiAgICAgIEluc3RhbmNlSGFuZGxlU2hhcGUsXG4gICAgICBNLm9yKEJ1bmRsZUNhcFNoYXBlLCBCdW5kbGVTaGFwZSksXG4gICAgICBNLnN0cmluZygpXG4gICAgKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICB1bndyYXBJbnN0YWxsYXRpb246IE0uY2FsbFdoZW4oTS5lcmVmKEluc3RhbGxhdGlvblNoYXBlKSkucmV0dXJucyhcbiAgICAgIFVud3JhcHBlZEluc3RhbGxhdGlvblNoYXBlXG4gICAgKVxuICB9KSxcbiAgaW52aXRhdGlvbklzc3VlckFjY2VzczogTS5pbnRlcmZhY2UoXCJab2VTdG9yYWdlIGludml0YXRpb25Jc3N1ZXJcIiwge1xuICAgIGdldEludml0YXRpb25Jc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUpXG4gIH0pXG59O1xuaGFyZGVuKFpvZVN0b3JhZ2VNYW5hZ2VySUtpdCk7XG52YXIgWm9lU2VydmljZUkgPSBNLmludGVyZmFjZShcIlpvZVNlcnZpY2VcIiwge1xuICBpbnN0YWxsOiBNLmNhbGwoTS5hbnkoKSkub3B0aW9uYWwoTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGluc3RhbGxCdW5kbGVJRDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBzdGFydEluc3RhbmNlOiBNLmNhbGwoTS5lcmVmKEluc3RhbGxhdGlvblNoYXBlKSkub3B0aW9uYWwoSXNzdWVyUEtleXdvcmRSZWNvcmRTaGFwZSwgTS5yZWNvcmQoKSwgTS5yZWNvcmQoKSwgTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIG9mZmVyOiBNLmNhbGwoTS5lcmVmKEludml0YXRpb25TaGFwZSkpLm9wdGlvbmFsKFByb3Bvc2FsU2hhcGUsIFBheW1lbnRQS2V5d29yZFJlY29yZFNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBNLmFycmF5T2YoTS5zdHJpbmcoKSlcbiAgKSxcbiAgZ2V0SW52aXRhdGlvbklzc3VlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldEZlZUlzc3VlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldEJyYW5kczogTS5jYWxsV2hlbihNLmF3YWl0KEluc3RhbmNlSGFuZGxlU2hhcGUpKS5yZXR1cm5zKFxuICAgIEJyYW5kS2V5d29yZFJlY29yZFNoYXBlXG4gICksXG4gIGdldElzc3VlcnM6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBJc3N1ZXJLZXl3b3JkUmVjb3JkU2hhcGVcbiAgKSxcbiAgZ2V0UHVibGljRmFjZXQ6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBNLnJlbW90YWJsZShcIlB1YmxpY0ZhY2V0XCIpXG4gICksXG4gIGdldFRlcm1zOiBNLmNhbGxXaGVuKE0uYXdhaXQoSW5zdGFuY2VIYW5kbGVTaGFwZSkpLnJldHVybnMoTS5hbnkoKSksXG4gIGdldEluc3RhbGxhdGlvbkZvckluc3RhbmNlOiBNLmNhbGxXaGVuKE0uYXdhaXQoSW5zdGFuY2VIYW5kbGVTaGFwZSkpLnJldHVybnMoXG4gICAgTS5lcmVmKE0ucmVtb3RhYmxlKFwiSW5zdGFsbGF0aW9uXCIpKVxuICApLFxuICBnZXRCdW5kbGVJREZyb21JbnN0YWxsYXRpb246IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YWxsYXRpb25TaGFwZSkpLnJldHVybnMoXG4gICAgTS5lcmVmKE0uc3RyaW5nKCkpXG4gICksXG4gIGdldEluc3RhbGxhdGlvbjogTS5jYWxsKE0uZXJlZihJbnZpdGF0aW9uU2hhcGUpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0SW5zdGFuY2U6IE0uY2FsbChNLmVyZWYoSW52aXRhdGlvblNoYXBlKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldENvbmZpZ3VyYXRpb246IE0uY2FsbCgpLnJldHVybnMoe1xuICAgIGZlZUlzc3VlckNvbmZpZzoge1xuICAgICAgbmFtZTogTS5zdHJpbmcoKSxcbiAgICAgIGFzc2V0S2luZDogXCJuYXRcIixcbiAgICAgIGRpc3BsYXlJbmZvOiBEaXNwbGF5SW5mb1NoYXBlXG4gICAgfVxuICB9KSxcbiAgZ2V0SW52aXRhdGlvbkRldGFpbHM6IE0uY2FsbChNLmVyZWYoSW52aXRhdGlvblNoYXBlKSkucmV0dXJucyhNLmFueSgpKSxcbiAgZ2V0UHJvcG9zYWxTaGFwZUZvckludml0YXRpb246IE0uY2FsbChJbnZpdGF0aW9uSGFuZGxlU2hhcGUpLnJldHVybnMoXG4gICAgTS5vcHQoTS5wYXR0ZXJuKCkpXG4gIClcbn0pO1xudmFyIEFkbWluRmFjZXRJID0gTS5pbnRlcmZhY2UoXCJaY2ZBZG1pbkZhY2V0XCIsIHtcbiAgZ2V0VmF0U2h1dGRvd25Qcm9taXNlOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgcmVzdGFydENvbnRyYWN0OiBNLmNhbGwoKS5vcHRpb25hbChNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgdXBncmFkZUNvbnRyYWN0OiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hbnkoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIHRlcm1pbmF0ZUNvbnRyYWN0OiBNLmNhbGwoTS5lcnJvcigpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxufSk7XG52YXIgU2VhdERhdGFTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBwcm9wb3NhbDogUHJvcG9zYWxTaGFwZSxcbiAgICBpbml0aWFsQWxsb2NhdGlvbjogQW1vdW50S2V5d29yZFJlY29yZFNoYXBlLFxuICAgIHNlYXRIYW5kbGU6IFNlYXRTaGFwZVxuICB9LFxuICB7XG4gICAgb2ZmZXJBcmdzOiBNLmFueSgpXG4gIH1cbik7XG52YXIgSGFuZGxlT2ZmZXJJID0gTS5pbnRlcmZhY2UoXCJIYW5kbGVPZmZlclwiLCB7XG4gIGhhbmRsZU9mZmVyOiBNLmNhbGwoSW52aXRhdGlvbkhhbmRsZVNoYXBlLCBTZWF0RGF0YVNoYXBlKS5yZXR1cm5zKHtcbiAgICBvZmZlclJlc3VsdFByb21pc2U6IE0ucHJvbWlzZSgpLFxuICAgIGV4aXRPYmo6IEV4aXRPYmplY3RTaGFwZVxuICB9KVxufSk7XG52YXIgUHJpY2VRdW90ZVNoYXBlID0ge1xuICBxdW90ZUFtb3VudDogQW1vdW50U2hhcGUsXG4gIHF1b3RlUGF5bWVudDogTS5lcmVmKFBheW1lbnRTaGFwZSlcbn07XG5oYXJkZW4oUHJpY2VRdW90ZVNoYXBlKTtcblxuLy9cbnZhciBUcmFuc2ZlclBhcnRTaGFwZSA9IE0uc3BsaXRBcnJheShcbiAgaGFyZGVuKFtNLm9wdChTZWF0U2hhcGUpLCBNLm9wdChTZWF0U2hhcGUpLCBNLm9wdChBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUpXSksXG4gIGhhcmRlbihbTS5vcHQoQW1vdW50S2V5d29yZFJlY29yZFNoYXBlKV0pXG4pO1xudmFyIGF0b21pY1RyYW5zZmVyID0gKHpjZiwgZnJvbVNlYXQgPSB2b2lkIDAsIHRvU2VhdCA9IHZvaWQgMCwgZnJvbUFtb3VudHMgPSB2b2lkIDAsIHRvQW1vdW50cyA9IHZvaWQgMCkgPT4gemNmLmF0b21pY1JlYXJyYW5nZShoYXJkZW4oW1tmcm9tU2VhdCwgdG9TZWF0LCBmcm9tQW1vdW50cywgdG9BbW91bnRzXV0pKTtcblxuLy9cbnZhciBzYXRpc2ZpZXNJbnRlcm5hbCA9IChnaXZlT3JXYW50ID0ge30sIGFsbG9jYXRpb24pID0+IHtcbiAgY29uc3QgaXNHVEVCeUtleXdvcmQgPSAoW2tleXdvcmQsIHJlcXVpcmVkQW1vdW50XSkgPT4ge1xuICAgIGlmIChhbGxvY2F0aW9uW2tleXdvcmRdID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBjb25zdCBhbGxvY2F0aW9uQW1vdW50ID0gYWxsb2NhdGlvbltrZXl3b3JkXTtcbiAgICByZXR1cm4gQW1vdW50TWF0aC5pc0dURShhbGxvY2F0aW9uQW1vdW50LCByZXF1aXJlZEFtb3VudCkgPyAxIDogMDtcbiAgfTtcbiAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKGdpdmVPcldhbnQpLmV2ZXJ5KGlzR1RFQnlLZXl3b3JkKSA/IDEgOiAwO1xufTtcbnZhciBzYXRpc2ZpZXNXYW50ID0gKHByb3Bvc2FsLCBhbGxvY2F0aW9uKSA9PiBzYXRpc2ZpZXNJbnRlcm5hbChwcm9wb3NhbC53YW50LCBhbGxvY2F0aW9uKTtcbnZhciBzYXRpc2ZpZXNHaXZlID0gKHByb3Bvc2FsLCBhbGxvY2F0aW9uKSA9PiBzYXRpc2ZpZXNJbnRlcm5hbChwcm9wb3NhbC5naXZlLCBhbGxvY2F0aW9uKTtcbmZ1bmN0aW9uIGlzT2ZmZXJTYWZlKHByb3Bvc2FsLCBhbGxvY2F0aW9uKSB7XG4gIHJldHVybiBzYXRpc2ZpZXNHaXZlKHByb3Bvc2FsLCBhbGxvY2F0aW9uKSA+IDAgfHwgc2F0aXNmaWVzV2FudChwcm9wb3NhbCwgYWxsb2NhdGlvbikgPiAwO1xufVxuaGFyZGVuKGlzT2ZmZXJTYWZlKTtcbmhhcmRlbihzYXRpc2ZpZXNXYW50KTtcblxuLy9cbnZhciBkZXBvc2l0VG9TZWF0U3VjY2Vzc01zZyA9IGBEZXBvc2l0IGFuZCByZWFsbG9jYXRpb24gc3VjY2Vzc2Z1bC5gO1xudmFyIGRlcG9zaXRUb1NlYXQgPSBhc3luYyAoemNmLCByZWNpcGllbnRTZWF0LCBhbW91bnRzLCBwYXltZW50cykgPT4ge1xuICAhcmVjaXBpZW50U2VhdC5oYXNFeGl0ZWQoKSB8fCB0aHJvd1JlZGFjdGVkYFRoZSByZWNpcGllbnRTZWF0IGNhbm5vdCBoYXZlIGV4aXRlZC5gO1xuICBjb25zdCByZWFsbG9jYXRlQWZ0ZXJEZXBvc2l0ID0gKHRlbXBTZWF0KSA9PiB7XG4gICAgYXRvbWljVHJhbnNmZXIoemNmLCB0ZW1wU2VhdCwgcmVjaXBpZW50U2VhdCwgYW1vdW50cyk7XG4gICAgdGVtcFNlYXQuZXhpdCgpO1xuICAgIHJldHVybiBkZXBvc2l0VG9TZWF0U3VjY2Vzc01zZztcbiAgfTtcbiAgY29uc3QgaW52aXRhdGlvbiA9IHpjZi5tYWtlSW52aXRhdGlvbihcbiAgICByZWFsbG9jYXRlQWZ0ZXJEZXBvc2l0LFxuICAgIFwidGVtcG9yYXJ5IHNlYXQgZm9yIGRlcG9zaXRcIlxuICApO1xuICBjb25zdCBwcm9wb3NhbCA9IGhhcmRlbih7IGdpdmU6IGFtb3VudHMgfSk7XG4gIGhhcmRlbihwYXltZW50cyk7XG4gIGNvbnN0IHpvZSA9IHpjZi5nZXRab2VTZXJ2aWNlKCk7XG4gIGNvbnN0IHRlbXBVc2VyU2VhdCA9IEUoem9lKS5vZmZlcihpbnZpdGF0aW9uLCBwcm9wb3NhbCwgcGF5bWVudHMpO1xuICByZXR1cm4gRSh0ZW1wVXNlclNlYXQpLmdldE9mZmVyUmVzdWx0KCk7XG59O1xuXG4vL1xudmFyIHsgbXVsdGlwbHk6IG11bHRpcGx5MiwgZmxvb3JEaXZpZGU6IGZsb29yRGl2aWRlMiwgY2VpbERpdmlkZSwgYmFua2Vyc0RpdmlkZSwgYWRkOiBhZGQyLCBzdWJ0cmFjdDogc3VidHJhY3QyIH0gPSBuYXRTYWZlTWF0aDtcblxuLy9cbnZhciBtYWtlRXBoZW1lcmFQcm92aWRlciA9IChpbml0KSA9PiB7XG4gIGNvbnN0IGV4dGFudCA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICByZXR1cm4gKGtleSkgPT4ge1xuICAgIGlmIChleHRhbnQuaGFzKGtleSkpIHtcbiAgICAgIHJldHVybiBleHRhbnQuZ2V0KGtleSk7XG4gICAgfVxuICAgIGNvbnN0IG5ld0VwaCA9IGluaXQoa2V5KTtcbiAgICBleHRhbnQuc2V0KGtleSwgbmV3RXBoKTtcbiAgICByZXR1cm4gbmV3RXBoO1xuICB9O1xufTtcbmhhcmRlbihtYWtlRXBoZW1lcmFQcm92aWRlcik7XG52YXIgcHJvdmlkZUVtcHR5U2VhdCA9ICh6Y2YsIGJhZ2dhZ2UsIG5hbWUpID0+IHtcbiAgcmV0dXJuIHByb3ZpZGUoYmFnZ2FnZSwgbmFtZSwgKCkgPT4gemNmLm1ha2VFbXB0eVNlYXRLaXQoKS56Y2ZTZWF0KTtcbn07XG5oYXJkZW4ocHJvdmlkZUVtcHR5U2VhdCk7XG52YXIgcHJvdmlkZUFsbCA9IChiYWdnYWdlLCB0aHVua3MpID0+IHtcbiAgY29uc3Qga2V5czggPSBPYmplY3Qua2V5cyh0aHVua3MpO1xuICBjb25zdCBpbkJhZ2dhZ2UgPSBiYWdnYWdlLmhhcyhrZXlzOFswXSk7XG4gIGlmIChpbkJhZ2dhZ2UpIHtcbiAgICBjb25zdCBvYmogPSBvYmplY3RNYXAoXG4gICAgICB0aHVua3MsXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgKF8sIGspID0+IGJhZ2dhZ2UuZ2V0KGspXG4gICAgKTtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGhhcmRlbihvYmopKTtcbiAgfVxuICBjb25zdCBrZXllZFByb21pc2VzID0gb2JqZWN0TWFwKHRodW5rcywgKGZuKSA9PiBmbigpKTtcbiAgcmV0dXJuIGFsbFZhbHVlcyhrZXllZFByb21pc2VzKS50aGVuKChrZXllZFZhbHMpID0+IHtcbiAgICBmb3IgKGNvbnN0IFtrLCB2Ml0gb2YgT2JqZWN0LmVudHJpZXMoa2V5ZWRWYWxzKSkge1xuICAgICAgYmFnZ2FnZS5pbml0KGssIHYyKTtcbiAgICB9XG4gICAgcmV0dXJuIGtleWVkVmFscztcbiAgfSk7XG59O1xuaGFyZGVuKHByb3ZpZGVBbGwpO1xuXG4vL1xudmFyIHdyYXBwZXJNZXRob2RzID0gKHdyYXBwZXJLaW5kTmFtZSwgdU1ldGhvZE5hbWVzLCBleHRyYU1ldGhvZHMgPSB7fSkgPT4gaGFyZGVuKHtcbiAgLi4uZnJvbVVuaXF1ZUVudHJpZXMoXG4gICAgdU1ldGhvZE5hbWVzLm1hcCgobmFtZSkgPT4gW1xuICAgICAgbmFtZSxcbiAgICAgIHtcbiAgICAgICAgLy9cbiAgICAgICAgW25hbWVdKC4uLmFyZ3MpIHtcbiAgICAgICAgICBjb25zdCB7IHVuZGVybHlpbmcgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgdW5kZXJseWluZyAhPT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh3cmFwcGVyS2luZE5hbWUpfSByZXZva2VkYDtcbiAgICAgICAgICByZXR1cm4gdW5kZXJseWluZ1tuYW1lXSguLi5hcmdzKTtcbiAgICAgICAgfVxuICAgICAgICAvL1xuICAgICAgfVtuYW1lXVxuICAgIF0pXG4gICksXG4gIC4uLmV4dHJhTWV0aG9kc1xufSk7XG5oYXJkZW4od3JhcHBlck1ldGhvZHMpO1xudmFyIHByZXBhcmVBdHRlbnVhdG9yTWFrZXIgPSAoem9uZSwgdUtpbmROYW1lLCB1TWV0aG9kTmFtZXMsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgdUludGVyZmFjZU5hbWUgPSB1S2luZE5hbWUsXG4gICAgZXh0cmFNZXRob2RHdWFyZHMgPSB7fSxcbiAgICBleHRyYU1ldGhvZHMgPSB7fVxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgQXR0ZW51YXRvckkgPSBNLmludGVyZmFjZShcbiAgICBgJHt1SW50ZXJmYWNlTmFtZX1fYXR0ZW51YXRvcmAsXG4gICAgZXh0cmFNZXRob2RHdWFyZHMsXG4gICAgeyBkZWZhdWx0R3VhcmRzOiBcInJhd1wiIH1cbiAgKTtcbiAgY29uc3QgYXR0ZW51YXRvcktpbmROYW1lID0gYCR7dUtpbmROYW1lfV9hdHRlbnVhdG9yYDtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3MoXG4gICAgYXR0ZW51YXRvcktpbmROYW1lLFxuICAgIEF0dGVudWF0b3JJLFxuICAgICh1bmRlcmx5aW5nKSA9PiAoeyB1bmRlcmx5aW5nIH0pLFxuICAgIHdyYXBwZXJNZXRob2RzKGF0dGVudWF0b3JLaW5kTmFtZSwgdU1ldGhvZE5hbWVzLCBleHRyYU1ldGhvZHMpLFxuICAgIHtcbiAgICAgIHN0YXRlU2hhcGU6IHsgdW5kZXJseWluZzogTS5vcHQoTS5yZW1vdGFibGUoXCJ1bmRlcmx5aW5nXCIpKSB9XG4gICAgfVxuICApO1xufTtcbmhhcmRlbihwcmVwYXJlQXR0ZW51YXRvck1ha2VyKTtcbnZhciBSZW1vdGFibGVQcmVmaXhSRSA9IC9eKEFsbGVnZWQ6IHxEZWJ1Z05hbWU6ICkvO1xudmFyIGF0dGVudWF0ZU9uZSA9ICh1bmRlcmx5aW5nLCB1TWV0aG9kTmFtZXMsIG9wdGlvbnMgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgaGVhcFpvbmUgPSBtYWtlSGVhcFpvbmUoKTtcbiAgY29uc3QgdUtpbmROYW1lID0gKHVuZGVybHlpbmdbU3ltYm9sLnRvU3RyaW5nVGFnXSB8fCBcIlVuZGVybHlpbmdcIikucmVwbGFjZShcbiAgICBSZW1vdGFibGVQcmVmaXhSRSxcbiAgICBcIlwiXG4gICk7XG4gIGNvbnN0IG1ha2VBdHRlbnVhdG9yID0gcHJlcGFyZUF0dGVudWF0b3JNYWtlcihcbiAgICBoZWFwWm9uZSxcbiAgICB1S2luZE5hbWUsXG4gICAgdU1ldGhvZE5hbWVzLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgcmV0dXJuIG1ha2VBdHRlbnVhdG9yKHVuZGVybHlpbmcpO1xufTtcbmhhcmRlbihhdHRlbnVhdGVPbmUpO1xuXG4vL1xudmFyIHByZXBhcmVSZXZvY2FibGVNYWtlcktpdCA9ICh6b25lLCB1S2luZE5hbWUsIHVNZXRob2ROYW1lcywgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICB1SW50ZXJmYWNlTmFtZSA9IHVLaW5kTmFtZSxcbiAgICBleHRyYU1ldGhvZEd1YXJkcyA9IHt9LFxuICAgIGV4dHJhTWV0aG9kcyA9IHt9XG4gIH0gPSBvcHRpb25zO1xuICBjb25zdCBSZXZvY2FibGVJS2l0ID0gaGFyZGVuKHtcbiAgICByZXZva2VyOiBNLmludGVyZmFjZShgJHt1SW50ZXJmYWNlTmFtZX1fcmV2b2tlcmAsIHtcbiAgICAgIHJldm9rZTogTS5jYWxsKCkucmV0dXJucyhNLmJvb2xlYW4oKSlcbiAgICB9KSxcbiAgICByZXZvY2FibGU6IE0uaW50ZXJmYWNlKGAke3VJbnRlcmZhY2VOYW1lfV9yZXZvY2FibGVgLCBleHRyYU1ldGhvZEd1YXJkcywge1xuICAgICAgZGVmYXVsdEd1YXJkczogXCJyYXdcIlxuICAgIH0pXG4gIH0pO1xuICBjb25zdCByZXZvY2FibGVLaW5kTmFtZSA9IGAke3VLaW5kTmFtZX1fY2FyZXRha2VyYDtcbiAgbGV0IGFtcGxpZmllcjtcbiAgY29uc3QgbWFrZVJldm9jYWJsZUtpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgcmV2b2NhYmxlS2luZE5hbWUsXG4gICAgUmV2b2NhYmxlSUtpdCxcbiAgICAodW5kZXJseWluZykgPT4gKHsgdW5kZXJseWluZyB9KSxcbiAgICB7XG4gICAgICByZXZva2VyOiB7XG4gICAgICAgIHJldm9rZSgpIHtcbiAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgIGlmIChzdGF0ZS51bmRlcmx5aW5nID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc3RhdGUudW5kZXJseWluZyA9IHZvaWQgMDtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJldm9jYWJsZTogd3JhcHBlck1ldGhvZHMocmV2b2NhYmxlS2luZE5hbWUsIHVNZXRob2ROYW1lcywgZXh0cmFNZXRob2RzKVxuICAgIH0sXG4gICAge1xuICAgICAgc3RhdGVTaGFwZTogeyB1bmRlcmx5aW5nOiBNLm9wdChNLnJlbW90YWJsZShcInVuZGVybHlpbmdcIikpIH0sXG4gICAgICByZWNlaXZlQW1wbGlmaWVyOiAoYW1wKSA9PiB7XG4gICAgICAgIGFtcGxpZmllciA9IGFtcDtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VSZXZvY2FibGUgPSAodW5kZXJseWluZykgPT4gbWFrZVJldm9jYWJsZUtpdCh1bmRlcmx5aW5nKS5yZXZvY2FibGU7XG4gIGNvbnN0IHJldm9rZSA9IChyZXZvY2FibGUpID0+IHtcbiAgICBjb25zdCBmYWNldHMgPSBhbXBsaWZpZXIocmV2b2NhYmxlKTtcbiAgICBpZiAoZmFjZXRzID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhY2V0cy5yZXZva2VyLnJldm9rZSgpO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICByZXZva2UsXG4gICAgbWFrZVJldm9jYWJsZSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgbWFrZVJldm9jYWJsZUtpdFxuICB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZVJldm9jYWJsZU1ha2VyS2l0KTtcblxuLy9cbnZhciBUcmFuc2ZlclByb3Bvc2FsU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHtcbiAgZ2l2ZToge30sXG4gIHdhbnQ6IHt9LFxuICBleGl0OiB7XG4gICAgb25EZW1hbmQ6IG51bGxcbiAgfVxufSk7XG52YXIgcHJlcGFyZU93bmFibGUgPSAoem9uZSwgbWFrZUludml0YXRpb24sIHVLaW5kTmFtZSwgdU1ldGhvZE5hbWVzLCBvcHRpb25zID0ge30pID0+IHtcbiAgY29uc3QgeyB1SW50ZXJmYWNlTmFtZSA9IHVLaW5kTmFtZSB9ID0gb3B0aW9ucztcbiAgY29uc3QgeyByZXZva2UsIG1ha2VSZXZvY2FibGUgfSA9IHByZXBhcmVSZXZvY2FibGVNYWtlcktpdChcbiAgICB6b25lLFxuICAgIHVLaW5kTmFtZSxcbiAgICB1TWV0aG9kTmFtZXMsXG4gICAge1xuICAgICAgdUludGVyZmFjZU5hbWUsXG4gICAgICBleHRyYU1ldGhvZEd1YXJkczoge1xuICAgICAgICBtYWtlVHJhbnNmZXJJbnZpdGF0aW9uOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgICAgfSxcbiAgICAgIGV4dHJhTWV0aG9kczoge1xuICAgICAgICBtYWtlVHJhbnNmZXJJbnZpdGF0aW9uKCkge1xuICAgICAgICAgIGNvbnN0IHsgdW5kZXJseWluZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IHJldm9jYWJsZSB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgY3VzdG9tRGV0YWlscyA9IHVuZGVybHlpbmcuZ2V0SW52aXRhdGlvbkN1c3RvbURldGFpbHMoKTtcbiAgICAgICAgICBjb25zdCB0cmFuc2ZlckhhbmRsZXIgPSBtYWtlVHJhbnNmZXJIYW5kbGVyKHVuZGVybHlpbmcpO1xuICAgICAgICAgIGNvbnN0IGludml0YXRpb24gPSBtYWtlSW52aXRhdGlvbihcbiAgICAgICAgICAgIHRyYW5zZmVySGFuZGxlcixcbiAgICAgICAgICAgIFwidHJhbnNmZXJcIixcbiAgICAgICAgICAgIGN1c3RvbURldGFpbHMsXG4gICAgICAgICAgICBUcmFuc2ZlclByb3Bvc2FsU2hhcGVcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldm9rZShyZXZvY2FibGUpO1xuICAgICAgICAgIHJldHVybiBpbnZpdGF0aW9uO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlVHJhbnNmZXJIYW5kbGVyID0gem9uZS5leG9DbGFzcyhcbiAgICBcIlRyYW5zZmVySGFuZGxlclwiLFxuICAgIE9mZmVySGFuZGxlckksXG4gICAgKHVuZGVybHlpbmcpID0+ICh7XG4gICAgICB1bmRlcmx5aW5nXG4gICAgfSksXG4gICAge1xuICAgICAgaGFuZGxlKHNlYXQpIHtcbiAgICAgICAgY29uc3QgeyB1bmRlcmx5aW5nIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCByZXZvY2FibGUgPSBtYWtlUmV2b2NhYmxlKHVuZGVybHlpbmcpO1xuICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgcmV0dXJuIHJldm9jYWJsZTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VPd25hYmxlID0gKHVuZGVybHlpbmcpID0+IG1ha2VSZXZvY2FibGUodW5kZXJseWluZyk7XG4gIHJldHVybiBoYXJkZW4obWFrZU93bmFibGUpO1xufTtcbmhhcmRlbihwcmVwYXJlT3duYWJsZSk7XG5cbi8vXG52YXIgdHJhY2U5ID0gbWFrZVRyYWNlcihcIlBBXCIsIGZhbHNlKTtcbnZhciBHdWFyZENhbGxBbW91bnRUdXBsZSA9IE0uY2FsbChBbW91bnRTaGFwZSwgQW1vdW50U2hhcGUpLnJldHVybnMoXG4gIE0ucHJvbWlzZSgpXG4pO1xudmFyIFByaWNlQXV0aG9yaXR5SSA9IE0uaW50ZXJmYWNlKFwiUHJpY2VBdXRob3JpdHlcIiwge1xuICBnZXRRdW90ZUlzc3VlcjogTS5jYWxsKEJyYW5kU2hhcGUsIEJyYW5kU2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBnZXRUaW1lclNlcnZpY2U6IE0uY2FsbChCcmFuZFNoYXBlLCBCcmFuZFNoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgcXVvdGVHaXZlbjogTS5jYWxsKEFtb3VudFNoYXBlLCBCcmFuZFNoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgcXVvdGVXYW50ZWQ6IE0uY2FsbChCcmFuZFNoYXBlLCBBbW91bnRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIG1ha2VRdW90ZU5vdGlmaWVyOiBNLmNhbGwoQW1vdW50U2hhcGUsIEJyYW5kU2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBxdW90ZUF0VGltZTogTS5jYWxsKFRpbWVzdGFtcFNoYXBlLCBBbW91bnRTaGFwZSwgQnJhbmRTaGFwZSkucmV0dXJucyhcbiAgICBNLnByb21pc2UoKVxuICApLFxuICBxdW90ZVdoZW5MVDogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIHF1b3RlV2hlbkxURTogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIHF1b3RlV2hlbkdURTogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIHF1b3RlV2hlbkdUOiBHdWFyZENhbGxBbW91bnRUdXBsZSxcbiAgbXV0YWJsZVF1b3RlV2hlbkxUOiBHdWFyZENhbGxBbW91bnRUdXBsZSxcbiAgbXV0YWJsZVF1b3RlV2hlbkxURTogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIG11dGFibGVRdW90ZVdoZW5HVEU6IEd1YXJkQ2FsbEFtb3VudFR1cGxlLFxuICBtdXRhYmxlUXVvdGVXaGVuR1Q6IEd1YXJkQ2FsbEFtb3VudFR1cGxlXG59KTtcblxuLy9cbnZhciB1bml0QW1vdW50ID0gYXN5bmMgKGJyYW5kKSA9PiB7XG4gIGNvbnN0IGRpc3BsYXlJbmZvID0gYXdhaXQgRShicmFuZCkuZ2V0RGlzcGxheUluZm8oKTtcbiAgY29uc3QgZGVjaW1hbFBsYWNlcyA9IGRpc3BsYXlJbmZvLmRlY2ltYWxQbGFjZXMgPz8gMDtcbiAgcmV0dXJuIEFtb3VudE1hdGgubWFrZShicmFuZCwgMTBuICoqIE5hdChkZWNpbWFsUGxhY2VzKSk7XG59O1xuaGFyZGVuKHVuaXRBbW91bnQpO1xuXG4vL1xudmFyIHRyYWNlMTAgPSBtYWtlVHJhY2VyKFwiWm9lVG9vbHNcIik7XG52YXIgeyBhc3NpZ246IGFzc2lnbjQsIGtleXM6IGtleXMyLCB2YWx1ZXM6IHZhbHVlczUgfSA9IE9iamVjdDtcbnZhciBtYWtlWm9lVG9vbHMgPSAoemNmLCB7IHdoZW4sIGFsbFZvd3MsIGFsbFNldHRsZWQsIGFzVm93IH0pID0+IHtcbiAgY29uc3QgbG9jYWxUcmFuc2ZlciA9IChzcmNTZWF0LCBsb2NhbEFjY291bnQsIGFtb3VudHMpID0+IGFzVm93KGFzeW5jICgpID0+IHtcbiAgICAhc3JjU2VhdC5oYXNFeGl0ZWQoKSB8fCB0aHJvd1JlZGFjdGVkYFRoZSBzZWF0IGNhbm5vdCBoYXZlIGV4aXRlZC5gO1xuICAgIGNvbnN0IHsgemNmU2VhdDogdGVtcFNlYXQsIHVzZXJTZWF0OiB1c2VyU2VhdFAgfSA9IHpjZi5tYWtlRW1wdHlTZWF0S2l0KCk7XG4gICAgY29uc3QgdXNlclNlYXQgPSBhd2FpdCB1c2VyU2VhdFA7XG4gICAgemNmLmF0b21pY1JlYXJyYW5nZShoYXJkZW4oW1tzcmNTZWF0LCB0ZW1wU2VhdCwgYW1vdW50c11dKSk7XG4gICAgdGVtcFNlYXQuZXhpdCgpO1xuICAgIGNvbnN0IHBheW1lbnRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBrZXlzMihhbW91bnRzKS5tYXAoKGt3KSA9PiBFKHVzZXJTZWF0KS5nZXRQYXlvdXQoa3cpKVxuICAgICk7XG4gICAgY29uc3Qgc2V0dGxlRGVwb3NpdHMgPSBhd2FpdCB3aGVuKFxuICAgICAgYWxsU2V0dGxlZChwYXltZW50cy5tYXAoKHBtdCkgPT4gRShsb2NhbEFjY291bnQpLmRlcG9zaXQocG10KSkpXG4gICAgKTtcbiAgICBpZiAoc2V0dGxlRGVwb3NpdHMuZmluZCgoeCkgPT4geC5zdGF0dXMgPT09IFwicmVqZWN0ZWRcIikpIHtcbiAgICAgIGNvbnN0IGFtdHMgPSB2YWx1ZXM1KGFtb3VudHMpO1xuICAgICAgY29uc3QgZXJyb3JzID0gW107XG4gICAgICBjb25zdCBwYXltZW50c09yV2l0aGRyYXdWcyA9IHNldHRsZURlcG9zaXRzLm1hcCgoeCwgaTMpID0+IHtcbiAgICAgICAgaWYgKHguc3RhdHVzID09PSBcInJlamVjdGVkXCIpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaCh4LnJlYXNvbik7XG4gICAgICAgICAgcmV0dXJuIHBheW1lbnRzW2kzXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gRShsb2NhbEFjY291bnQpLndpdGhkcmF3KGFtdHNbaTNdKTtcbiAgICAgIH0pO1xuICAgICAgY29uc3QgcGF5bWVudHNUb1JldHVybiA9IGF3YWl0IHdoZW4oYWxsVm93cyhwYXltZW50c09yV2l0aGRyYXdWcykpO1xuICAgICAgY29uc3QgcGF5bWVudEt3ciA9IGhhcmRlbihcbiAgICAgICAga2V5czIoYW1vdW50cykucmVkdWNlKFxuICAgICAgICAgIChrd3IsIGt3LCBpMykgPT4gYXNzaWduNChrd3IsIHsgW2t3XTogcGF5bWVudHNUb1JldHVybltpM10gfSksXG4gICAgICAgICAge31cbiAgICAgICAgKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IGRlcG9zaXRSZXNwb25zZSA9IGF3YWl0IGRlcG9zaXRUb1NlYXQoXG4gICAgICAgIHpjZixcbiAgICAgICAgc3JjU2VhdCxcbiAgICAgICAgYW1vdW50cyxcbiAgICAgICAgcGF5bWVudEt3clxuICAgICAgKTtcbiAgICAgIHRyYWNlMTAoXCJsb2NhbFRyYW5zZmVyIGRlcG9zaXRSZXNwb25zZVwiLCBkZXBvc2l0UmVzcG9uc2UpO1xuICAgICAgdGhyb3cgbWFrZUVycm9yKGBPbmUgb3IgbW9yZSBkZXBvc2l0cyBmYWlsZWQgJHtxdW90ZShlcnJvcnMpfWApO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IHdpdGhkcmF3VG9TZWF0ID0gKGxvY2FsQWNjb3VudCwgZGVzdFNlYXQsIGFtb3VudHMpID0+IGFzVm93KGFzeW5jICgpID0+IHtcbiAgICAhZGVzdFNlYXQuaGFzRXhpdGVkKCkgfHwgdGhyb3dSZWRhY3RlZGBUaGUgc2VhdCBjYW5ub3QgaGF2ZSBleGl0ZWQuYDtcbiAgICBjb25zdCBzZXR0bGVkV2l0aGRyYXdhbHMgPSBhd2FpdCB3aGVuKFxuICAgICAgYWxsU2V0dGxlZCh2YWx1ZXM1KGFtb3VudHMpLm1hcCgoYW10KSA9PiBFKGxvY2FsQWNjb3VudCkud2l0aGRyYXcoYW10KSkpXG4gICAgKTtcbiAgICBpZiAoc2V0dGxlZFdpdGhkcmF3YWxzLmZpbmQoKHgpID0+IHguc3RhdHVzID09PSBcInJlamVjdGVkXCIpKSB7XG4gICAgICBjb25zdCByZXR1cm5QYXltZW50VnMgPSBbXTtcbiAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuICAgICAgZm9yIChjb25zdCByZXN1bHQgb2Ygc2V0dGxlZFdpdGhkcmF3YWxzKSB7XG4gICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSBcImZ1bGZpbGxlZFwiKSB7XG4gICAgICAgICAgcmV0dXJuUGF5bWVudFZzLnB1c2goRShsb2NhbEFjY291bnQpLmRlcG9zaXQocmVzdWx0LnZhbHVlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2gocmVzdWx0LnJlYXNvbik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGF3YWl0IHdoZW4oYWxsVm93cyhyZXR1cm5QYXltZW50VnMpKTtcbiAgICAgIHRocm93IG1ha2VFcnJvcihgT25lIG9yIG1vcmUgd2l0aGRyYXdhbHMgZmFpbGVkICR7cXVvdGUoZXJyb3JzKX1gKTtcbiAgICB9XG4gICAgY29uc3QgcGF5bWVudEt3ciA9IGhhcmRlbihcbiAgICAgIGtleXMyKGFtb3VudHMpLnJlZHVjZShcbiAgICAgICAgKGFjYywga3csIGkzKSA9PiBhc3NpZ240KGFjYywge1xuICAgICAgICAgIFtrd106IChcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHNldHRsZWRXaXRoZHJhd2Fsc1tpM10udmFsdWVcbiAgICAgICAgICApXG4gICAgICAgIH0pLFxuICAgICAgICB7fVxuICAgICAgKVxuICAgICk7XG4gICAgY29uc3QgZGVwb3NpdFJlc3BvbnNlID0gYXdhaXQgZGVwb3NpdFRvU2VhdChcbiAgICAgIHpjZixcbiAgICAgIGRlc3RTZWF0LFxuICAgICAgYW1vdW50cyxcbiAgICAgIHBheW1lbnRLd3JcbiAgICApO1xuICAgIHRyYWNlMTAoXCJ3aXRoZHJhd1RvU2VhdCBkZXBvc2l0UmVzcG9uc2VcIiwgZGVwb3NpdFJlc3BvbnNlKTtcbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGxvY2FsVHJhbnNmZXIsXG4gICAgd2l0aGRyYXdUb1NlYXRcbiAgfSk7XG59O1xuXG4vL1xudmFyIEhhbmRsZXJTaGFwZSA9IE0ucmVtb3RhYmxlKFwiT2ZmZXJIYW5kbGVyXCIpO1xudmFyIG1ha2VaY2ZUb29scyA9ICh6Y2YsIHZvd1Rvb2xzKSA9PiBoYXJkZW4oe1xuICBtYWtlSW52aXRhdGlvbihvZmZlckhhbmRsZXIsIGRlc2NyaXB0aW9uLCBjdXN0b21EZXRhaWxzLCBwcm9wb3NhbFNoYXBlKSB7XG4gICAgbXVzdE1hdGNoKG9mZmVySGFuZGxlciwgSGFuZGxlclNoYXBlKTtcbiAgICByZXR1cm4gdm93VG9vbHMud2F0Y2goXG4gICAgICB6Y2YubWFrZUludml0YXRpb24oXG4gICAgICAgIG9mZmVySGFuZGxlcixcbiAgICAgICAgZGVzY3JpcHRpb24sXG4gICAgICAgIGN1c3RvbURldGFpbHMsXG4gICAgICAgIHByb3Bvc2FsU2hhcGVcbiAgICAgIClcbiAgICApO1xuICB9LFxuICBhdG9taWNSZWFycmFuZ2UodHJhbnNmZXJzKSB7XG4gICAgemNmLmF0b21pY1JlYXJyYW5nZSh0cmFuc2ZlcnMpO1xuICB9LFxuICBhc3NlcnRVbmlxdWVLZXl3b3JkKGtleXdvcmQpIHtcbiAgICB6Y2YuYXNzZXJ0VW5pcXVlS2V5d29yZChrZXl3b3JkKTtcbiAgfVxufSk7XG5cbi8vXG52YXIgcHJvdmlkZU9yY2hlc3RyYXRpb24gPSAoemNmLCBiYWdnYWdlLCByZW1vdGVQb3dlcnMsIG1hcnNoYWxsZXIsIG9wdHMgPSB7fSkgPT4ge1xuICBjb25zdCB6b25lcyA9ICgoKSA9PiB7XG4gICAgY29uc3Qgem9uZSA9IG1ha2VEdXJhYmxlWm9uZShiYWdnYWdlKTtcbiAgICByZXR1cm4ge1xuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgYXN5bmNGbG93OiB6b25lLnN1YlpvbmUoXCJhc3luY0Zsb3dcIiksXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBvcmNoZXN0cmF0aW9uOiB6b25lLnN1YlpvbmUoXCJvcmNoZXN0cmF0aW9uXCIpLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGNoYWluSHViOiB6b25lLnN1YlpvbmUoXCJjaGFpbkh1YlwiKSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHZvd3M6IHpvbmUuc3ViWm9uZShcInZvd3NcIiksXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgY29udHJhY3Q6IHpvbmUuc3ViWm9uZShcImNvbnRyYWN0XCIpXG4gICAgfTtcbiAgfSkoKTtcbiAgY29uc3QgeyBhZ29yaWNOYW1lcywgdGltZXJTZXJ2aWNlLCBsb2NhbGNoYWluIH0gPSByZW1vdGVQb3dlcnM7XG4gIGNvbnN0IHZvd1Rvb2xzID0gcHJlcGFyZVN3aW5nc2V0Vm93VG9vbHMoem9uZXMudm93cyk7XG4gIGNvbnN0IGNoYWluSHViID0gbWFrZUNoYWluSHViKHpvbmVzLmNoYWluSHViLCBhZ29yaWNOYW1lcywgdm93VG9vbHMsIHtcbiAgICBjaGFpbkluZm9WYWx1ZVNoYXBlOiBvcHRzLmNoYWluSW5mb1ZhbHVlU2hhcGVcbiAgfSk7XG4gIGNvbnN0IHpvZVRvb2xzID0gbWFrZVpvZVRvb2xzKHpjZiwgdm93VG9vbHMpO1xuICBjb25zdCB6Y2ZUb29scyA9IG1ha2VaY2ZUb29scyh6Y2YsIHZvd1Rvb2xzKTtcbiAgY29uc3QgeyBtYWtlUmVjb3JkZXJLaXQgfSA9IHByZXBhcmVSZWNvcmRlcktpdE1ha2VycyhiYWdnYWdlLCBtYXJzaGFsbGVyKTtcbiAgY29uc3QgbWFrZUxvY2FsT3JjaGVzdHJhdGlvbkFjY291bnRLaXQgPSBwcmVwYXJlTG9jYWxPcmNoZXN0cmF0aW9uQWNjb3VudEtpdChcbiAgICB6b25lcy5vcmNoZXN0cmF0aW9uLFxuICAgIHtcbiAgICAgIG1ha2VSZWNvcmRlcktpdCxcbiAgICAgIHpjZixcbiAgICAgIHRpbWVyU2VydmljZSxcbiAgICAgIHZvd1Rvb2xzLFxuICAgICAgY2hhaW5IdWIsXG4gICAgICBsb2NhbGNoYWluLFxuICAgICAgem9lVG9vbHNcbiAgICB9XG4gICk7XG4gIGNvbnN0IGFzeW5jRmxvd1Rvb2xzID0gcHJlcGFyZUFzeW5jRmxvd1Rvb2xzKHpvbmVzLmFzeW5jRmxvdywge1xuICAgIHZvd1Rvb2xzXG4gIH0pO1xuICBjb25zdCBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnQgPSBwcmVwYXJlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnQoXG4gICAgem9uZXMub3JjaGVzdHJhdGlvbixcbiAgICB7XG4gICAgICBjaGFpbkh1YixcbiAgICAgIG1ha2VSZWNvcmRlcktpdCxcbiAgICAgIHRpbWVyU2VydmljZSxcbiAgICAgIHZvd1Rvb2xzLFxuICAgICAgemNmXG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlUmVtb3RlQ2hhaW5GYWNhZGUgPSBwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGUoem9uZXMub3JjaGVzdHJhdGlvbiwge1xuICAgIG1ha2VDb3Ntb3NPcmNoZXN0cmF0aW9uQWNjb3VudCxcbiAgICBvcmNoZXN0cmF0aW9uOiByZW1vdGVQb3dlcnMub3JjaGVzdHJhdGlvblNlcnZpY2UsXG4gICAgc3RvcmFnZU5vZGU6IHJlbW90ZVBvd2Vycy5zdG9yYWdlTm9kZSxcbiAgICB0aW1lcjogcmVtb3RlUG93ZXJzLnRpbWVyU2VydmljZSxcbiAgICB2b3dUb29sc1xuICB9KTtcbiAgY29uc3QgbWFrZUxvY2FsQ2hhaW5GYWNhZGUgPSBwcmVwYXJlTG9jYWxDaGFpbkZhY2FkZSh6b25lcy5vcmNoZXN0cmF0aW9uLCB7XG4gICAgbWFrZUxvY2FsT3JjaGVzdHJhdGlvbkFjY291bnRLaXQsXG4gICAgbG9jYWxjaGFpbjogcmVtb3RlUG93ZXJzLmxvY2FsY2hhaW4sXG4gICAgLy9cbiAgICBzdG9yYWdlTm9kZTogcmVtb3RlUG93ZXJzLnN0b3JhZ2VOb2RlLFxuICAgIGFnb3JpY05hbWVzLFxuICAgIG9yY2hlc3RyYXRpb246IHJlbW90ZVBvd2Vycy5vcmNoZXN0cmF0aW9uU2VydmljZSxcbiAgICB0aW1lcjogcmVtb3RlUG93ZXJzLnRpbWVyU2VydmljZSxcbiAgICB2b3dUb29sc1xuICB9KTtcbiAgY29uc3QgbWFrZU9yY2hlc3RyYXRvciA9IHByZXBhcmVPcmNoZXN0cmF0b3Ioem9uZXMub3JjaGVzdHJhdGlvbiwge1xuICAgIGNoYWluSHViLFxuICAgIG1ha2VMb2NhbENoYWluRmFjYWRlLFxuICAgIG1ha2VSZW1vdGVDaGFpbkZhY2FkZSxcbiAgICB2b3dUb29sc1xuICB9KTtcbiAgY29uc3QgbWFrZU9yY2hlc3RyYXRlS2l0ID0gKHpvbmUpID0+IG1ha2VPcmNoZXN0cmF0aW9uRmFjYWRlKHtcbiAgICB6b25lLFxuICAgIHpjZixcbiAgICBtYWtlT3JjaGVzdHJhdG9yLFxuICAgIGFzeW5jRmxvd1Rvb2xzLFxuICAgIHZvd1Rvb2xzLFxuICAgIC4uLnJlbW90ZVBvd2Vyc1xuICB9KTtcbiAgY29uc3QgZGVmYXVsdE9yY2hlc3RyYXRlS2l0ID0gbWFrZU9yY2hlc3RyYXRlS2l0KFxuICAgIHpvbmVzLmNvbnRyYWN0LnN1YlpvbmUoXCJvcmNoZXN0cmF0aW9uXCIpXG4gICk7XG4gIHpjZi5zZXRUZXN0SmlnKCgpID0+ICh7XG4gICAgYmFnZ2FnZSxcbiAgICBjaGFpbkh1YlxuICB9KSk7XG4gIHJldHVybiB7XG4gICAgLi4uZGVmYXVsdE9yY2hlc3RyYXRlS2l0LFxuICAgIG1ha2VPcmNoZXN0cmF0ZUtpdCxcbiAgICBiYWdnYWdlLFxuICAgIGNoYWluSHViLFxuICAgIHZvd1Rvb2xzLFxuICAgIGFzeW5jRmxvd1Rvb2xzLFxuICAgIHpjZlRvb2xzLFxuICAgIHpvZVRvb2xzLFxuICAgIHpvbmU6IHpvbmVzLmNvbnRyYWN0XG4gIH07XG59O1xuaGFyZGVuKHByb3ZpZGVPcmNoZXN0cmF0aW9uKTtcbnZhciB3aXRoT3JjaGVzdHJhdGlvbiA9IChjb250cmFjdEZuLCBvcHRzKSA9PiBhc3luYyAoemNmLCBwcml2YXRlQXJncywgYmFnZ2FnZSkgPT4ge1xuICBjb25zdCB7IG1hcnNoYWxsZXIsIC4uLmFsbE9yY2hQb3dlcnMgfSA9IHByaXZhdGVBcmdzO1xuICBjb25zdCB7IHN0b3JhZ2VOb2RlOiBfLCAuLi5yZXF1aXJlZE9yY2hQb3dlcnMgfSA9IGFsbE9yY2hQb3dlcnM7XG4gIGNvbnN0IHsgcHVibGlzaEFjY291bnRJbmZvLCBjaGFpbkluZm9WYWx1ZVNoYXBlIH0gPSBvcHRzID8/IHt9O1xuICBjb25zdCB7IHpvbmUsIC4uLnRvb2xzIH0gPSBwcm92aWRlT3JjaGVzdHJhdGlvbihcbiAgICB6Y2YsXG4gICAgYmFnZ2FnZSxcbiAgICBwdWJsaXNoQWNjb3VudEluZm8gPyBhbGxPcmNoUG93ZXJzIDogcmVxdWlyZWRPcmNoUG93ZXJzLFxuICAgIG1hcnNoYWxsZXIsXG4gICAgeyBjaGFpbkluZm9WYWx1ZVNoYXBlIH1cbiAgKTtcbiAgcmV0dXJuIGNvbnRyYWN0Rm4oemNmLCBwcml2YXRlQXJncywgem9uZSwgdG9vbHMpO1xufTtcbmhhcmRlbih3aXRoT3JjaGVzdHJhdGlvbik7XG5cbi8vXG52YXIgSWNxRW5hYmxlZCA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIG9tbmlmbGl4aHViOiB0cnVlLFxuICAgIG9zbW9zaXM6IHRydWVcbiAgfVxuKTtcbmhhcmRlbihJY3FFbmFibGVkKTtcbnZhciBQZm1FbmFibGVkID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgYWdvcmljOiB0cnVlLFxuICAgIGNlbGVzdGlhOiB0cnVlLFxuICAgIGNvc21vc2h1YjogdHJ1ZSxcbiAgICBqdW5vOiB0cnVlLFxuICAgIG5ldXRyb246IHRydWUsXG4gICAgbm9ibGU6IHRydWUsXG4gICAgb21uaWZsaXhodWI6IHRydWUsXG4gICAgb3Ntb3NpczogdHJ1ZSxcbiAgICBzZWNyZXRuZXR3b3JrOiB0cnVlLFxuICAgIHN0YXJnYXplOiB0cnVlLFxuICAgIHN0cmlkZTogdHJ1ZSxcbiAgICB1bWVlOiB0cnVlXG4gIH1cbik7XG5oYXJkZW4oUGZtRW5hYmxlZCk7XG52YXIgSWNhRW5hYmxlZCA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIGNlbGVzdGlhOiB0cnVlLFxuICAgIGNvc21vc2h1YjogdHJ1ZSxcbiAgICBkeWR4OiB0cnVlLFxuICAgIGp1bm86IHRydWUsXG4gICAgbmV1dHJvbjogdHJ1ZSxcbiAgICBub2JsZTogdHJ1ZSxcbiAgICBvbW5pZmxpeGh1YjogdHJ1ZSxcbiAgICBvc21vc2lzOiB0cnVlLFxuICAgIHNlY3JldG5ldHdvcms6IHRydWUsXG4gICAgc3RhcmdhemU6IHRydWUsXG4gICAgc3RyaWRlOiB0cnVlLFxuICAgIHVtZWU6IHRydWVcbiAgfVxuKTtcbmhhcmRlbihJY2FFbmFibGVkKTtcblxuLy9cbnZhciByZWdpc3RlckNoYWluc0FuZEFzc2V0cyA9IChjaGFpbkh1YiwgYnJhbmRzLCBjaGFpbkluZm8sIGFzc2V0SW5mbywgeyBsb2cgPSAoKSA9PiB7XG59IH0gPSB7fSkgPT4ge1xuICBsb2coXCJjaGFpbkh1YjogcmVnaXN0ZXJpbmcgY2hhaW5zXCIsIE9iamVjdC5rZXlzKGNoYWluSW5mbyB8fCB7fSkpO1xuICBpZiAoIWNoYWluSW5mbykge1xuICAgIHJldHVybjtcbiAgfVxuICBjb25zdCBjb25ucyA9IHt9O1xuICBmb3IgKGNvbnN0IFtjaGFpbk5hbWUsIGFsbEluZm9dIG9mIE9iamVjdC5lbnRyaWVzKGNoYWluSW5mbykpIHtcbiAgICBpZiAoYWxsSW5mby5uYW1lc3BhY2UgPT09IFwiY29zbW9zXCIpIHtcbiAgICAgIGNvbnN0IHsgY29ubmVjdGlvbnMsIC4uLmluZm8gfSA9IGFsbEluZm87XG4gICAgICBjaGFpbkh1Yi5yZWdpc3RlckNoYWluKGNoYWluTmFtZSwgaW5mbyk7XG4gICAgICBpZiAoY29ubmVjdGlvbnMpIGNvbm5zW2luZm8uY2hhaW5JZF0gPSBjb25uZWN0aW9ucztcbiAgICB9IGVsc2Uge1xuICAgICAgY2hhaW5IdWIucmVnaXN0ZXJDaGFpbihjaGFpbk5hbWUsIGFsbEluZm8pO1xuICAgIH1cbiAgfVxuICBjb25zdCByZWdpc3RlcmVkUGFpcnMgPSAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICBmb3IgKGNvbnN0IFtwQ2hhaW5JZCwgY29ubkluZm9zXSBvZiBPYmplY3QuZW50cmllcyhjb25ucykpIHtcbiAgICBmb3IgKGNvbnN0IFtjQ2hhaW5JZCwgY29ubkluZm9dIG9mIE9iamVjdC5lbnRyaWVzKGNvbm5JbmZvcykpIHtcbiAgICAgIGNvbnN0IHBhaXIgPSBbcENoYWluSWQsIGNDaGFpbklkXS5zb3J0KCkuam9pbihcIjwtPlwiKTtcbiAgICAgIGlmICghcmVnaXN0ZXJlZFBhaXJzLmhhcyhwYWlyKSkge1xuICAgICAgICBjaGFpbkh1Yi5yZWdpc3RlckNvbm5lY3Rpb24ocENoYWluSWQsIGNDaGFpbklkLCBjb25uSW5mbyk7XG4gICAgICAgIHJlZ2lzdGVyZWRQYWlycy5hZGQocGFpcik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGxvZyhcImNoYWluSHViOiByZWdpc3RlcmVkIGNvbm5lY3Rpb25zXCIsIFsuLi5yZWdpc3RlcmVkUGFpcnNdLnNvcnQoKSk7XG4gIGxvZyhcbiAgICBcImNoYWluSHViOiByZWdpc3RlcmluZyBhc3NldHNcIixcbiAgICBhc3NldEluZm8/Lm1hcCgoW2Rlbm9tLCB7IGNoYWluTmFtZSB9XSkgPT4gYCR7Y2hhaW5OYW1lfTogJHtkZW5vbX1gKVxuICApO1xuICBpZiAoIWFzc2V0SW5mbykge1xuICAgIHJldHVybjtcbiAgfVxuICBmb3IgKGNvbnN0IFtkZW5vbSwgaW5mb10gb2YgYXNzZXRJbmZvKSB7XG4gICAgY29uc3QgeyBicmFuZEtleSwgLi4ucmVzdCB9ID0gaW5mbztcbiAgICBjb25zdCBpbmZvV2l0aEJyYW5kID0gYnJhbmRLZXkgPyB7IC4uLnJlc3QsIGJyYW5kOiBicmFuZHNbYnJhbmRLZXldIH0gOiByZXN0O1xuICAgIGNoYWluSHViLnJlZ2lzdGVyQXNzZXQoZGVub20sIGluZm9XaXRoQnJhbmQpO1xuICB9XG59O1xuXG4vL1xudmFyIFlpZWxkUHJvdG9jb2wgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBBYXZlOiBcIkFhdmVcIixcbiAgICBDb21wb3VuZDogXCJDb21wb3VuZFwiLFxuICAgIFVTRE46IFwiVVNETlwiLFxuICAgIEJlZWZ5OiBcIkJlZWZ5XCJcbiAgfVxuKTtcbmhhcmRlbihZaWVsZFByb3RvY29sKTtcbnZhciBBeGVsYXJDaGFpbiA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIEF2YWxhbmNoZTogXCJBdmFsYW5jaGVcIixcbiAgICBBcmJpdHJ1bTogXCJBcmJpdHJ1bVwiLFxuICAgIE9wdGltaXNtOiBcIk9wdGltaXNtXCIsXG4gICAgUG9seWdvbjogXCJQb2x5Z29uXCJcbiAgfVxuKTtcbmhhcmRlbihBeGVsYXJDaGFpbik7XG52YXIgU3VwcG9ydGVkQ2hhaW4gPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICAuLi5BeGVsYXJDaGFpbixcbiAgICBhZ29yaWM6IFwiYWdvcmljXCIsXG4gICAgbm9ibGU6IFwibm9ibGVcIlxuICAgIC8vXG4gIH1cbik7XG5oYXJkZW4oU3VwcG9ydGVkQ2hhaW4pO1xudmFyIFJlYmFsYW5jZVN0cmF0ZWd5ID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgLypcblxuXG4gICAgICovXG4gICAgUHJlc2V0OiBcInByZXNldFwiLFxuICAgIC8qXG5cblxuICAgICAqL1xuICAgIFByZXNlcnZlRXhpc3RpbmdQcm9wb3J0aW9uczogXCJwZXBcIlxuICB9XG4pO1xuaGFyZGVuKFJlYmFsYW5jZVN0cmF0ZWd5KTtcblxuLy9cbnZhciBBeGVsYXJHTVBNZXNzYWdlVHlwZSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIENvbnRyYWN0Q2FsbDogMSxcbiAgICBDb250cmFjdENhbGxXaXRoVG9rZW46IDIsXG4gICAgVG9rZW5UcmFuc2ZlcjogM1xuICB9XG4pO1xuaGFyZGVuKEF4ZWxhckdNUE1lc3NhZ2VUeXBlKTtcblxuLy9cbmluaXRfY2h1bmtfNEVGNEsyTUgoKTtcbmluaXRfY2h1bmtfWE40TFVPSUgoKTtcbmluaXRfY2h1bmtfNFZOUzVXUE0oKTtcblxuLy9cbnZhciB7IGtleXM6IGtleXMzIH0gPSBPYmplY3Q7XG52YXIgbWFrZU5hdEFtb3VudFNoYXBlID0gKGJyYW5kLCBtaW4pID0+IGhhcmRlbih7IGJyYW5kLCB2YWx1ZTogbWluID8gTS5ndGUobWluKSA6IE0ubmF0KCkgfSk7XG52YXIgbWFrZVByb3Bvc2FsU2hhcGVzID0gKHVzZGNCcmFuZCwgZmVlQnJhbmQsIGFjY2Vzc0JyYW5kKSA9PiB7XG4gIGNvbnN0ICRTaGFwZSA9IG1ha2VOYXRBbW91bnRTaGFwZSh1c2RjQnJhbmQpO1xuICBjb25zdCBGZWVTaGFwZSA9IG1ha2VOYXRBbW91bnRTaGFwZShmZWVCcmFuZCk7XG4gIGNvbnN0IGFjY2Vzc1NoYXBlID0gaGFyZGVuKHtcbiAgICAuLi4oYWNjZXNzQnJhbmQmJiB7IEFjY2VzczogbWFrZU5hdEFtb3VudFNoYXBlKGFjY2Vzc0JyYW5kLCAxbikgfSlcbiAgfSk7XG4gIGNvbnN0IG9wZW5Qb3J0Zm9saW8yID0gTS5zcGxpdFJlY29yZChcbiAgICB7XG4gICAgICBnaXZlOiBNLnNwbGl0UmVjb3JkKFxuICAgICAgICBhY2Nlc3NTaGFwZSxcbiAgICAgICAgeyBEZXBvc2l0OiAkU2hhcGUsIEdtcEZlZTogRmVlU2hhcGUgfSxcbiAgICAgICAge31cbiAgICAgIClcbiAgICB9LFxuICAgIHsgd2FudDoge30sIGV4aXQ6IE0uYW55KCkgfSxcbiAgICB7fVxuICApO1xuICBjb25zdCByZWJhbGFuY2UyID0gTS5vcihcbiAgICBNLnNwbGl0UmVjb3JkKFxuICAgICAgeyBnaXZlOiBNLnNwbGl0UmVjb3JkKHt9LCB7IERlcG9zaXQ6ICRTaGFwZSwgR21wRmVlOiBGZWVTaGFwZSB9LCB7fSkgfSxcbiAgICAgIHsgd2FudDoge30sIGV4aXQ6IE0uYW55KCkgfSxcbiAgICAgIHt9XG4gICAgKSxcbiAgICBNLnNwbGl0UmVjb3JkKFxuICAgICAgeyB3YW50OiBNLnNwbGl0UmVjb3JkKHsgQ2FzaDogJFNoYXBlIH0sIHt9LCB7fSkgfSxcbiAgICAgIHsgZ2l2ZTogTS5zcGxpdFJlY29yZCh7fSwgeyBHbXBGZWU6IEZlZVNoYXBlIH0sIHt9KSwgZXhpdDogTS5hbnkoKSB9LFxuICAgICAge31cbiAgICApXG4gICk7XG4gIHJldHVybiBoYXJkZW4oeyBvcGVuUG9ydGZvbGlvOiBvcGVuUG9ydGZvbGlvMiwgcmViYWxhbmNlOiByZWJhbGFuY2UyIH0pO1xufTtcbmhhcmRlbihtYWtlUHJvcG9zYWxTaGFwZXMpO1xudmFyIEJlZWZ5UG9vbFBsYWNlcyA9IHtcbiAgQmVlZnlfcmU3X0F2YWxhbmNoZToge1xuICAgIHByb3RvY29sOiBcIkJlZWZ5XCIsXG4gICAgY2hhaW5OYW1lOiBcIkF2YWxhbmNoZVwiXG4gIH1cbn07XG52YXIgUG9vbFBsYWNlcyA9IHtcbiAgVVNETjogeyBwcm90b2NvbDogXCJVU0ROXCIsIHZhdWx0OiBudWxsLCBjaGFpbk5hbWU6IFwibm9ibGVcIiB9LFxuICAvL1xuICBVU0ROVmF1bHQ6IHsgcHJvdG9jb2w6IFwiVVNETlwiLCB2YXVsdDogMSwgY2hhaW5OYW1lOiBcIm5vYmxlXCIgfSxcbiAgLy9cbiAgQWF2ZV9BdmFsYW5jaGU6IHsgcHJvdG9jb2w6IFwiQWF2ZVwiLCBjaGFpbk5hbWU6IFwiQXZhbGFuY2hlXCIgfSxcbiAgQWF2ZV9PcHRpbWlzbTogeyBwcm90b2NvbDogXCJBYXZlXCIsIGNoYWluTmFtZTogXCJPcHRpbWlzbVwiIH0sXG4gIEFhdmVfQXJiaXRydW06IHsgcHJvdG9jb2w6IFwiQWF2ZVwiLCBjaGFpbk5hbWU6IFwiQXJiaXRydW1cIiB9LFxuICBBYXZlX1BvbHlnb246IHsgcHJvdG9jb2w6IFwiQWF2ZVwiLCBjaGFpbk5hbWU6IFwiUG9seWdvblwiIH0sXG4gIENvbXBvdW5kX0F2YWxhbmNoZTogeyBwcm90b2NvbDogXCJDb21wb3VuZFwiLCBjaGFpbk5hbWU6IFwiQXZhbGFuY2hlXCIgfSxcbiAgQ29tcG91bmRfT3B0aW1pc206IHsgcHJvdG9jb2w6IFwiQ29tcG91bmRcIiwgY2hhaW5OYW1lOiBcIk9wdGltaXNtXCIgfSxcbiAgQ29tcG91bmRfQXJiaXRydW06IHsgcHJvdG9jb2w6IFwiQ29tcG91bmRcIiwgY2hhaW5OYW1lOiBcIkFyYml0cnVtXCIgfSxcbiAgQ29tcG91bmRfUG9seWdvbjogeyBwcm90b2NvbDogXCJDb21wb3VuZFwiLCBjaGFpbk5hbWU6IFwiUG9seWdvblwiIH0sXG4gIC4uLkJlZWZ5UG9vbFBsYWNlc1xufTtcbmhhcmRlbihQb29sUGxhY2VzKTtcbnZhciBQb29sS2V5U2hhcGVFeHQgPSBNLnN0cmluZygpO1xudmFyIFRhcmdldEFsbG9jYXRpb25TaGFwZSA9IE0ucmVjb3JkT2YoXG4gIE0ub3IoLi4ua2V5czMoUG9vbFBsYWNlcykpLFxuICBNLm5hdCgpXG4pO1xudmFyIFRhcmdldEFsbG9jYXRpb25TaGFwZUV4dCA9IE0ucmVjb3JkT2YoUG9vbEtleVNoYXBlRXh0LCBNLm5hdCgpKTtcbnZhciBtYWtlUG9ydGZvbGlvUGF0aCA9IChpZCkgPT4gW2Bwb3J0Zm9saW8ke2lkfWBdO1xudmFyIFBvcnRmb2xpb1N0YXR1c1NoYXBlRXh0ID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIHBvc2l0aW9uS2V5czogTS5hcnJheU9mKFBvb2xLZXlTaGFwZUV4dCksXG4gICAgZmxvd0NvdW50OiBNLm51bWJlcigpLFxuICAgIGFjY291bnRJZEJ5Q2hhaW46IE0ucmVjb3JkT2YoXG4gICAgICBNLm9yKFwiYWdvcmljXCIsIFwibm9ibGVcIiksXG4gICAgICAvL1xuICAgICAgTS5zdHJpbmcoKVxuICAgICAgLy9cbiAgICApXG4gIH0sXG4gIHsgdGFyZ2V0QWxsb2NhdGlvbjogVGFyZ2V0QWxsb2NhdGlvblNoYXBlRXh0IH1cbik7XG52YXIgbWFrZVBvc2l0aW9uUGF0aCA9IChwYXJlbnQsIGtleSkgPT4gW1xuICBgcG9ydGZvbGlvJHtwYXJlbnR9YCxcbiAgXCJwb3NpdGlvbnNcIixcbiAga2V5XG5dO1xudmFyIFBvc2l0aW9uU3RhdHVzU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHtcbiAgcHJvdG9jb2w6IE0ub3IoXCJVU0ROXCIsIFwiQWF2ZVwiLCBcIkNvbXBvdW5kXCIpLFxuICAvL1xuICBhY2NvdW50SWQ6IE0uc3RyaW5nKCksXG4gIC8vXG4gIG5ldFRyYW5zZmVyczogQW55TmF0QW1vdW50U2hhcGUsXG4gIC8vXG4gIHRvdGFsSW46IEFueU5hdEFtb3VudFNoYXBlLFxuICB0b3RhbE91dDogQW55TmF0QW1vdW50U2hhcGVcbn0pO1xudmFyIG1ha2VGbG93UGF0aCA9IChwYXJlbnQsIGlkKSA9PiBbXG4gIGBwb3J0Zm9saW8ke3BhcmVudH1gLFxuICBcImZsb3dzXCIsXG4gIGBmbG93JHtpZH1gXG5dO1xudmFyIEZsb3dTdGF0dXNTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBzdGVwOiBNLm5hdCgpLFxuICAgIGhvdzogTS5zdHJpbmcoKSxcbiAgICBzcmM6IE0uc3RyaW5nKCksXG4gICAgZGVzdDogTS5zdHJpbmcoKSxcbiAgICBhbW91bnQ6IEFueU5hdEFtb3VudFNoYXBlXG4gIH0sXG4gIHtcbiAgICB3aGVyZTogTS5zdHJpbmcoKSxcbiAgICBlcnJvcjogTS5zdHJpbmcoKVxuICB9XG4pO1xuXG4vL1xudmFyIHsgYXNzaWduOiBhc3NpZ241IH0gPSBPYmplY3Q7XG52YXIgeyBhZGQ6IGFkZDMsIHN1YnRyYWN0OiBzdWJ0cmFjdDMgfSA9IEFtb3VudE1hdGg7XG52YXIgcmVjb3JkVHJhbnNmZXJJbiA9IChhbW91bnQsIHN0YXRlLCBwb3NpdGlvbikgPT4ge1xuICBjb25zdCB7IG5ldFRyYW5zZmVycywgdG90YWxJbiB9ID0gc3RhdGU7XG4gIGFzc2lnbjUoc3RhdGUsIHtcbiAgICBuZXRUcmFuc2ZlcnM6IGFkZDMobmV0VHJhbnNmZXJzLCBhbW91bnQpLFxuICAgIHRvdGFsSW46IGFkZDModG90YWxJbiwgYW1vdW50KVxuICB9KTtcbiAgcG9zaXRpb24ucHVibGlzaFN0YXR1cygpO1xuICByZXR1cm4gc3RhdGUubmV0VHJhbnNmZXJzO1xufTtcbnZhciByZWNvcmRUcmFuc2Zlck91dCA9IChhbW91bnQsIHN0YXRlLCBwb3NpdGlvbikgPT4ge1xuICBjb25zdCB7IG5ldFRyYW5zZmVycywgdG90YWxPdXQgfSA9IHN0YXRlO1xuICBhc3NpZ241KHN0YXRlLCB7XG4gICAgbmV0VHJhbnNmZXJzOiBzdWJ0cmFjdDMobmV0VHJhbnNmZXJzLCBhbW91bnQpLFxuICAgIHRvdGFsT3V0OiBhZGQzKHRvdGFsT3V0LCBhbW91bnQpXG4gIH0pO1xuICBwb3NpdGlvbi5wdWJsaXNoU3RhdHVzKCk7XG4gIHJldHVybiBzdGF0ZS5uZXRUcmFuc2ZlcnM7XG59O1xudmFyIHByZXBhcmVQb3NpdGlvbiA9ICh6b25lLCBlbXB0eVRyYW5zZmVyU3RhdGUsIHB1Ymxpc2hTdGF0dXMpID0+IHpvbmUuZXhvQ2xhc3MoXG4gIFwiUG9zaXRpb25cIixcbiAgdm9pZCAwLFxuICAvL1xuICAocG9ydGZvbGlvSWQsIHBvb2xLZXksIHByb3RvY29sLCBhY2NvdW50SWQpID0+ICh7XG4gICAgcG9ydGZvbGlvSWQsXG4gICAgcHJvdG9jb2wsXG4gICAgLi4uZW1wdHlUcmFuc2ZlclN0YXRlLFxuICAgIHBvb2xLZXksXG4gICAgYWNjb3VudElkXG4gIH0pLFxuICB7XG4gICAgZ2V0UG9vbEtleSgpIHtcbiAgICAgIHJldHVybiB0aGlzLnN0YXRlLnBvb2xLZXk7XG4gICAgfSxcbiAgICBnZXRZaWVsZFByb3RvY29sKCkge1xuICAgICAgY29uc3QgeyBwcm90b2NvbCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgIHJldHVybiBwcm90b2NvbDtcbiAgICB9LFxuICAgIHJlY29yZFRyYW5zZmVySW4oYW1vdW50KSB7XG4gICAgICByZXR1cm4gcmVjb3JkVHJhbnNmZXJJbihhbW91bnQsIHRoaXMuc3RhdGUsIHRoaXMuc2VsZik7XG4gICAgfSxcbiAgICByZWNvcmRUcmFuc2Zlck91dChhbW91bnQpIHtcbiAgICAgIHJldHVybiByZWNvcmRUcmFuc2Zlck91dChhbW91bnQsIHRoaXMuc3RhdGUsIHRoaXMuc2VsZik7XG4gICAgfSxcbiAgICBwdWJsaXNoU3RhdHVzKCkge1xuICAgICAgY29uc3Qge1xuICAgICAgICBwb3J0Zm9saW9JZCxcbiAgICAgICAgcG9vbEtleSxcbiAgICAgICAgcHJvdG9jb2wsXG4gICAgICAgIGFjY291bnRJZCxcbiAgICAgICAgbmV0VHJhbnNmZXJzLFxuICAgICAgICB0b3RhbEluLFxuICAgICAgICB0b3RhbE91dFxuICAgICAgfSA9IHRoaXMuc3RhdGU7XG4gICAgICBjb25zdCBrZXkgPSBtYWtlUG9zaXRpb25QYXRoKHBvcnRmb2xpb0lkLCBwb29sS2V5KTtcbiAgICAgIGNvbnN0IHN0YXR1cyA9IGhhcmRlbih7XG4gICAgICAgIHByb3RvY29sLFxuICAgICAgICBhY2NvdW50SWQsXG4gICAgICAgIG5ldFRyYW5zZmVycyxcbiAgICAgICAgdG90YWxJbixcbiAgICAgICAgdG90YWxPdXRcbiAgICAgIH0pO1xuICAgICAgcHVibGlzaFN0YXR1cyhrZXksIHN0YXR1cyk7XG4gICAgfVxuICB9XG4pO1xuXG4vL1xudmFyIHRyYWNlMTEgPSBtYWtlVHJhY2VyKFwiUG9ydEV4b1wiKTtcbnZhciB7IHZhbHVlczogdmFsdWVzNiB9ID0gT2JqZWN0O1xudmFyIERFQ09ERV9DT05UUkFDVF9DQUxMX1JFU1VMVF9BQkkgPSBbXG4gIHtcbiAgICB0eXBlOiBcInR1cGxlXCIsXG4gICAgY29tcG9uZW50czogW1xuICAgICAgeyBuYW1lOiBcImlzQ29udHJhY3RDYWxsUmVzdWx0XCIsIHR5cGU6IFwiYm9vbFwiIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6IFwiZGF0YVwiLFxuICAgICAgICB0eXBlOiBcInR1cGxlW11cIixcbiAgICAgICAgY29tcG9uZW50czogW1xuICAgICAgICAgIHsgbmFtZTogXCJzdWNjZXNzXCIsIHR5cGU6IFwiYm9vbFwiIH0sXG4gICAgICAgICAgeyBuYW1lOiBcInJlc3VsdFwiLCB0eXBlOiBcImJ5dGVzXCIgfVxuICAgICAgICBdXG4gICAgICB9XG4gICAgXVxuICB9XG5dO1xuaGFyZGVuKERFQ09ERV9DT05UUkFDVF9DQUxMX1JFU1VMVF9BQkkpO1xudmFyIE9yY2hlc3RyYXRpb25BY2NvdW50U2hhcGUgPSBNLnJlbW90YWJsZShcIk9yY2hlc3RyYXRpb25BY2NvdW50XCIpO1xudmFyIFJlYWRlckkgPSBNLmludGVyZmFjZShcInJlYWRlclwiLCB7XG4gIGdldEdNUEFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoTS5hbnkoKSksXG4gIGdldExDQTogTS5jYWxsKCkucmV0dXJucyhPcmNoZXN0cmF0aW9uQWNjb3VudFNoYXBlKSxcbiAgZ2V0UG9zaXRpb25zOiBNLmNhbGwoKS5yZXR1cm5zKE0uYXJyYXlPZihNLnN0cmluZygpKSksXG4gIGdldFVTRE5JQ0E6IE0uY2FsbCgpLnJldHVybnMoT3JjaGVzdHJhdGlvbkFjY291bnRTaGFwZSlcbn0pO1xudmFyIE1hbmFnZXJJID0gTS5pbnRlcmZhY2UoXCJtYW5hZ2VyXCIsIHtcbiAgaW5pdEFhdmU6IE0uY2FsbChNLnN0cmluZygpKS5yZXR1cm5zKCksXG4gIGluaXRDb21wb3VuZDogTS5jYWxsKE0uc3RyaW5nKCkpLnJldHVybnMoKSxcbiAgd2FpdDogTS5jYWxsKE0uYmlnaW50KCkpLnJldHVybnMoVm93U2hhcGUpXG59KTtcbnZhciBhY2NvdW50SWRCeUNoYWluID0gKGFjY291bnRzKSA9PiB7XG4gIGNvbnN0IGJ5Q2hhaW4gPSB7fTtcbiAgZm9yIChjb25zdCBbbjIsIGluZm9dIG9mIGFjY291bnRzLmVudHJpZXMoKSkge1xuICAgIHN3aXRjaCAoaW5mby5uYW1lc3BhY2UpIHtcbiAgICAgIGNhc2UgXCJjb3Ntb3NcIjpcbiAgICAgICAgc3dpdGNoIChpbmZvLmNoYWluTmFtZSkge1xuICAgICAgICAgIGNhc2UgXCJhZ29yaWNcIjpcbiAgICAgICAgICAgIGJ5Q2hhaW5bbjJdID0gY29lcmNlQWNjb3VudElkKGluZm8ubGNhLmdldEFkZHJlc3MoKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwibm9ibGVcIjpcbiAgICAgICAgICAgIGJ5Q2hhaW5bbjJdID0gY29lcmNlQWNjb3VudElkKGluZm8uaWNhLmdldEFkZHJlc3MoKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJlaXAxNTVcIjpcbiAgICAgICAgYnlDaGFpbltuMl0gPSBgJHtpbmZvLmNoYWluSWR9OiR7aW5mby5yZW1vdGVBZGRyZXNzfWA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYXNzZXJ0LmZhaWwocmVkYWN0ZWRgbm8gc3VjaCB0eXBlOiAke2luZm99YCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBoYXJkZW4oYnlDaGFpbik7XG59O1xudmFyIHByZXBhcmVQb3J0Zm9saW9LaXQgPSAoem9uZSwge1xuICBheGVsYXJJZHMsXG4gIHJlYmFsYW5jZTogcmViYWxhbmNlMixcbiAgcmViYWxhbmNlRnJvbVRyYW5zZmVyOiByZWJhbGFuY2VGcm9tVHJhbnNmZXIyLFxuICB0aW1lcixcbiAgY2hhaW5IdWJUb29scyxcbiAgcHJvcG9zYWxTaGFwZXMsXG4gIG9mZmVyQXJnc1NoYXBlcyxcbiAgdm93VG9vbHMsXG4gIHpjZixcbiAgcG9ydGZvbGlvc05vZGUsXG4gIG1hcnNoYWxsZXIsXG4gIHVzZGNCcmFuZFxufSkgPT4ge1xuICBjb25zdCBub2RlcyA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGNvbnN0IHByb3ZpZGVQYXRoTm9kZSA9IChzZWdtZW50cykgPT4ge1xuICAgIGlmIChzZWdtZW50cy5sZW5ndGggPT09IDApIHJldHVybiBwb3J0Zm9saW9zTm9kZTtcbiAgICBjb25zdCBwYXRoID0gc2VnbWVudHMuam9pbihcIi5cIik7XG4gICAgaWYgKG5vZGVzLmhhcyhwYXRoKSkgcmV0dXJuIG5vZGVzLmdldChwYXRoKTtcbiAgICBjb25zdCBwYXJlbnQgPSBwcm92aWRlUGF0aE5vZGUoc2VnbWVudHMuc2xpY2UoMCwgLTEpKTtcbiAgICBjb25zdCBub2RlID0gRShwYXJlbnQpLm1ha2VDaGlsZE5vZGUoc2VnbWVudHMuYXQoLTEpKTtcbiAgICBub2Rlcy5zZXQocGF0aCwgbm9kZSk7XG4gICAgcmV0dXJuIG5vZGU7XG4gIH07XG4gIGNvbnN0IHB1Ymxpc2hTdGF0dXMgPSAocGF0aCwgc3RhdHVzKSA9PiB7XG4gICAgY29uc3Qgbm9kZSA9IHByb3ZpZGVQYXRoTm9kZShwYXRoKTtcbiAgICB2b2lkIEUud2hlbihcbiAgICAgIEUobWFyc2hhbGxlcikudG9DYXBEYXRhKHN0YXR1cyksXG4gICAgICAoY2FwRGF0YSkgPT4gRShub2RlKS5zZXRWYWx1ZShKU09OLnN0cmluZ2lmeShjYXBEYXRhKSlcbiAgICApO1xuICB9O1xuICBjb25zdCB1c2RjRW1wdHkgPSBBbW91bnRNYXRoLm1ha2VFbXB0eSh1c2RjQnJhbmQpO1xuICBjb25zdCBlbXB0eVRyYW5zZmVyU3RhdGUgPSBoYXJkZW4oe1xuICAgIHRvdGFsSW46IHVzZGNFbXB0eSxcbiAgICB0b3RhbE91dDogdXNkY0VtcHR5LFxuICAgIG5ldFRyYW5zZmVyczogdXNkY0VtcHR5XG4gIH0pO1xuICBjb25zdCBtYWtlUG9zaXRpb24gPSBwcmVwYXJlUG9zaXRpb24oem9uZSwgZW1wdHlUcmFuc2ZlclN0YXRlLCBwdWJsaXNoU3RhdHVzKTtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJQb3J0Zm9saW9cIixcbiAgICB2b2lkIDAsXG4gICAgKHsgcG9ydGZvbGlvSWQgfSkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcG9ydGZvbGlvSWQsXG4gICAgICAgIG5leHRGbG93SWQ6IDEsXG4gICAgICAgIGFjY291bnRzOiB6b25lLmRldGFjaGVkKCkubWFwU3RvcmUoXCJhY2NvdW50c1wiLCB7XG4gICAgICAgICAga2V5U2hhcGU6IE0uc3RyaW5nKCksXG4gICAgICAgICAgdmFsdWVTaGFwZTogTS5vcihcbiAgICAgICAgICAgIE0ucmVtb3RhYmxlKFwiQWNjb3VudFwiKSxcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBNLnJlY29yZCgpXG4gICAgICAgICAgKVxuICAgICAgICB9KSxcbiAgICAgICAgYWNjb3VudHNQZW5kaW5nOiB6b25lLmRldGFjaGVkKCkubWFwU3RvcmUoXCJhY2NvdW50c1BlbmRpbmdcIiksXG4gICAgICAgIC8vXG4gICAgICAgIHBvc2l0aW9uczogem9uZS5kZXRhY2hlZCgpLm1hcFN0b3JlKFwicG9zaXRpb25zXCIsIHtcbiAgICAgICAgICBrZXlTaGFwZTogUG9vbEtleVNoYXBlRXh0LFxuICAgICAgICAgIHZhbHVlU2hhcGU6IE0ucmVtb3RhYmxlKFwiUG9zaXRpb25cIilcbiAgICAgICAgfSksXG4gICAgICAgIHRhcmdldEFsbG9jYXRpb246IHZvaWQgMFxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIHRhcDoge1xuICAgICAgICBhc3luYyByZWNlaXZlVXBjYWxsKGV2ZW50KSB7XG4gICAgICAgICAgdHJhY2UxMShcInJlY2VpdmVVcGNhbGxcIiwgZXZlbnQpO1xuICAgICAgICAgIHJldHVybiB2b3dUb29scy53YXRjaChcbiAgICAgICAgICAgIHJlYmFsYW5jZUZyb21UcmFuc2ZlcjIoZXZlbnQucGFja2V0LCB0aGlzLmZhY2V0cyksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5yZWJhbGFuY2VGcm9tVHJhbnNmZXJXYXRjaGVyXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlYmFsYW5jZUZyb21UcmFuc2ZlcldhdGNoZXI6IHtcbiAgICAgICAgb25SZWplY3RlZChyZWFzb24pIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXCJcXHUyNkEwXFx1RkUwRiByZWJhbGFuY2VGcm9tVHJhbnNmZXIgZmFpbHVyZVwiLCByZWFzb24pO1xuICAgICAgICAgIHRocm93IHJlYXNvbjtcbiAgICAgICAgfSxcbiAgICAgICAgYXN5bmMgb25GdWxmaWxsZWQoeyBwYXJzZWQsIGhhbmRsZWQgfSkge1xuICAgICAgICAgIGlmIChoYW5kbGVkKSB7XG4gICAgICAgICAgICB0cmFjZTExKFwicmViYWxhbmNlRnJvbVRyYW5zZmVyIGhhbmRsZWQ7IHNraXBwaW5nIEdNUCBwcm9jZXNzaW5nXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIXBhcnNlZCkge1xuICAgICAgICAgICAgdHJhY2UxMShcIkdNUCBwcm9jZXNzaW5nIHNraXBwZWQ7IG5vIHBhcnNlZCBpbmJvdW5kIHRyYW5zZmVyXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB7IGV4dHJhIH0gPSBwYXJzZWQ7XG4gICAgICAgICAgaWYgKCFleHRyYS5tZW1vKSByZXR1cm47XG4gICAgICAgICAgY29uc3QgbWVtbyA9IEpTT04ucGFyc2UoZXh0cmEubWVtbyk7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gT2JqZWN0LmVudHJpZXMoYXhlbGFySWRzKS5maW5kKChbXzIsIGNoYWluSWRdKSA9PiBjaGFpbklkID09PSBtZW1vLnNvdXJjZV9jaGFpbik7XG4gICAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihcInVua25vd24gc291cmNlX2NoYWluXCIsIG1lbW8pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBbY2hhaW5OYW1lLCBfXSA9IHJlc3VsdDtcbiAgICAgICAgICBjb25zdCBwYXlsb2FkQnl0ZXMgPSBkZWNvZGVCYXNlNjQobWVtby5wYXlsb2FkKTtcbiAgICAgICAgICBjb25zdCBbeyBpc0NvbnRyYWN0Q2FsbFJlc3VsdCwgZGF0YSB9XSA9IGRlY29kZUFiaVBhcmFtZXRlcnMoXG4gICAgICAgICAgICBERUNPREVfQ09OVFJBQ1RfQ0FMTF9SRVNVTFRfQUJJLFxuICAgICAgICAgICAgcGF5bG9hZEJ5dGVzXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0cmFjZTExKFxuICAgICAgICAgICAgXCJyZWNlaXZlVXBjYWxsIERlY29kZWQ6XCIsXG4gICAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7IGlzQ29udHJhY3RDYWxsUmVzdWx0LCBkYXRhIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoaXNDb250cmFjdENhbGxSZXN1bHQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihcIlRPRE86IEhhbmRsZSB0aGUgcmVzdWx0IG9mIHRoZSBjb250cmFjdCBjYWxsXCIsIGRhdGEpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBbbWVzc2FnZV0gPSBkYXRhO1xuICAgICAgICAgICAgY29uc3QgeyBzdWNjZXNzLCByZXN1bHQ6IHJlc3VsdDIgfSA9IG1lc3NhZ2U7XG4gICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IFthZGRyZXNzXSA9IGRlY29kZUFiaVBhcmFtZXRlcnMoXG4gICAgICAgICAgICAgIFt7IHR5cGU6IFwiYWRkcmVzc1wiIH1dLFxuICAgICAgICAgICAgICByZXN1bHQyXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgY2hhaW5JbmZvID0gYXdhaXQgdm93VG9vbHMud2hlbihcbiAgICAgICAgICAgICAgY2hhaW5IdWJUb29scy5nZXRDaGFpbkluZm8oY2hhaW5OYW1lKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IGNhaXBJZCA9IGAke2NoYWluSW5mby5uYW1lc3BhY2V9OiR7Y2hhaW5JbmZvLnJlZmVyZW5jZX1gO1xuICAgICAgICAgICAgdGhpcy5mYWNldHMubWFuYWdlci5yZXNvbHZlQWNjb3VudCh7XG4gICAgICAgICAgICAgIG5hbWVzcGFjZTogXCJlaXAxNTVcIixcbiAgICAgICAgICAgICAgY2hhaW5OYW1lLFxuICAgICAgICAgICAgICBjaGFpbklkOiBjYWlwSWQsXG4gICAgICAgICAgICAgIHJlbW90ZUFkZHJlc3M6IGFkZHJlc3NcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdHJhY2UxMShgcmVtb3RlQWRkcmVzcyAke2FkZHJlc3N9YCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRyYWNlMTEoXCJyZWNlaXZlVXBjYWxsIGNvbXBsZXRlZFwiKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlYWRlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0TG9jYWxBY2NvdW50KCkge1xuICAgICAgICAgIGNvbnN0IHsgYWNjb3VudHMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgaW5mbyA9IGFjY291bnRzLmdldChcImFnb3JpY1wiKTtcbiAgICAgICAgICBhc3NlcnQuZXF1YWwoaW5mbz8uY2hhaW5OYW1lLCBcImFnb3JpY1wiKTtcbiAgICAgICAgICByZXR1cm4gaW5mby5sY2E7XG4gICAgICAgIH0sXG4gICAgICAgIGdldFN0b3JhZ2VQYXRoKCkge1xuICAgICAgICAgIGNvbnN0IHsgcG9ydGZvbGlvSWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3Qgbm9kZSA9IHByb3ZpZGVQYXRoTm9kZShtYWtlUG9ydGZvbGlvUGF0aChwb3J0Zm9saW9JZCkpO1xuICAgICAgICAgIHJldHVybiB2b3dUb29scy5hc1ZvdygoKSA9PiBFKG5vZGUpLmdldFBhdGgoKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldFBvcnRmb2xpb0lkKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnBvcnRmb2xpb0lkO1xuICAgICAgICB9LFxuICAgICAgICBnZXRHTVBJbmZvKGNoYWluTmFtZSkge1xuICAgICAgICAgIGNvbnN0IHsgYWNjb3VudHMsIGFjY291bnRzUGVuZGluZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoYWNjb3VudHMuaGFzKGNoYWluTmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB2b3dUb29scy5hc1ZvdyhcbiAgICAgICAgICAgICAgKCkgPT4gYWNjb3VudHMuZ2V0KGNoYWluTmFtZSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHsgdm93IH0gPSBhY2NvdW50c1BlbmRpbmcuZ2V0KGNoYWluTmFtZSk7XG4gICAgICAgICAgcmV0dXJuIHZvdztcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlcG9ydGVyOiB7XG4gICAgICAgIHB1Ymxpc2hTdGF0dXMoKSB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgcG9ydGZvbGlvSWQsXG4gICAgICAgICAgICBwb3NpdGlvbnMsXG4gICAgICAgICAgICBhY2NvdW50cyxcbiAgICAgICAgICAgIG5leHRGbG93SWQsXG4gICAgICAgICAgICB0YXJnZXRBbGxvY2F0aW9uXG4gICAgICAgICAgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgcHVibGlzaFN0YXR1cyhtYWtlUG9ydGZvbGlvUGF0aChwb3J0Zm9saW9JZCksIHtcbiAgICAgICAgICAgIHBvc2l0aW9uS2V5czogWy4uLnBvc2l0aW9ucy5rZXlzKCldLFxuICAgICAgICAgICAgZmxvd0NvdW50OiBuZXh0Rmxvd0lkIC0gMSxcbiAgICAgICAgICAgIGFjY291bnRJZEJ5Q2hhaW46IGFjY291bnRJZEJ5Q2hhaW4oYWNjb3VudHMpLFxuICAgICAgICAgICAgLi4uKHRhcmdldEFsbG9jYXRpb24mJiB7IHRhcmdldEFsbG9jYXRpb24gfSlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgYWxsb2NhdGVGbG93SWQoKSB7XG4gICAgICAgICAgY29uc3QgeyBuZXh0Rmxvd0lkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHRoaXMuc3RhdGUubmV4dEZsb3dJZCA9IG5leHRGbG93SWQgKyAxO1xuICAgICAgICAgIHRoaXMuZmFjZXRzLnJlcG9ydGVyLnB1Ymxpc2hTdGF0dXMoKTtcbiAgICAgICAgICByZXR1cm4gbmV4dEZsb3dJZDtcbiAgICAgICAgfSxcbiAgICAgICAgLy9cbiAgICAgICAgcHVibGlzaEZsb3dTdGF0dXMoaWQsIHN0YXR1cykge1xuICAgICAgICAgIGNvbnN0IHsgcG9ydGZvbGlvSWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgcHVibGlzaFN0YXR1cyhtYWtlRmxvd1BhdGgocG9ydGZvbGlvSWQsIGlkKSwgc3RhdHVzKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG1hbmFnZXI6IHtcbiAgICAgICAgcmVzZXJ2ZUFjY291bnQoY2hhaW5OYW1lKSB7XG4gICAgICAgICAgdHJhY2UxMShcInJlc2VydmVBY2NvdW50XCIsIGNoYWluTmFtZSk7XG4gICAgICAgICAgY29uc3QgeyBhY2NvdW50cywgYWNjb3VudHNQZW5kaW5nIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChhY2NvdW50cy5oYXMoY2hhaW5OYW1lKSkge1xuICAgICAgICAgICAgdHJhY2UxMShcImFjY291bnRzLmhhc1wiLCBjaGFpbk5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIHZvd1Rvb2xzLmFzVm93KGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgaW5mb0FueSA9IGFjY291bnRzLmdldChjaGFpbk5hbWUpO1xuICAgICAgICAgICAgICBhc3NlcnQuZXF1YWwoaW5mb0FueS5jaGFpbk5hbWUsIGNoYWluTmFtZSk7XG4gICAgICAgICAgICAgIGNvbnN0IGluZm8gPSBpbmZvQW55O1xuICAgICAgICAgICAgICByZXR1cm4gaW5mbztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoYWNjb3VudHNQZW5kaW5nLmhhcyhjaGFpbk5hbWUpKSB7XG4gICAgICAgICAgICB0cmFjZTExKFwiYWNjb3VudHNQZW5kaW5nLmhhc1wiLCBjaGFpbk5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIGFjY291bnRzUGVuZGluZy5nZXQoY2hhaW5OYW1lKS52b3c7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHBlbmRpbmcgPSB2b3dUb29scy5tYWtlVm93S2l0KCk7XG4gICAgICAgICAgdHJhY2UxMShcImFjY291bnRzUGVuZGluZy5pbml0XCIsIGNoYWluTmFtZSk7XG4gICAgICAgICAgYWNjb3VudHNQZW5kaW5nLmluaXQoY2hhaW5OYW1lLCBwZW5kaW5nKTtcbiAgICAgICAgICB0aGlzLmZhY2V0cy5yZXBvcnRlci5wdWJsaXNoU3RhdHVzKCk7XG4gICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgfSxcbiAgICAgICAgcmVzb2x2ZUFjY291bnQoaW5mbykge1xuICAgICAgICAgIGNvbnN0IHsgYWNjb3VudHMsIGFjY291bnRzUGVuZGluZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoYWNjb3VudHNQZW5kaW5nLmhhcyhpbmZvLmNoYWluTmFtZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IHZvdyA9IGFjY291bnRzUGVuZGluZy5nZXQoaW5mby5jaGFpbk5hbWUpO1xuICAgICAgICAgICAgdm93LnJlc29sdmVyLnJlc29sdmUoaW5mbyk7XG4gICAgICAgICAgICBhY2NvdW50c1BlbmRpbmcuZGVsZXRlKGluZm8uY2hhaW5OYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYWNjb3VudHMuaW5pdChpbmZvLmNoYWluTmFtZSwgaW5mbyk7XG4gICAgICAgICAgdGhpcy5mYWNldHMucmVwb3J0ZXIucHVibGlzaFN0YXR1cygpO1xuICAgICAgICB9LFxuICAgICAgICBwcm92aWRlUG9zaXRpb24ocG9vbEtleSwgcHJvdG9jb2wsIGFjY291bnRJZCkge1xuICAgICAgICAgIGNvbnN0IHsgcG9zaXRpb25zIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChwb3NpdGlvbnMuaGFzKHBvb2xLZXkpKSB7XG4gICAgICAgICAgICByZXR1cm4gcG9zaXRpb25zLmdldChwb29sS2V5KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgeyBwb3J0Zm9saW9JZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG1ha2VQb3NpdGlvbihcbiAgICAgICAgICAgIHBvcnRmb2xpb0lkLFxuICAgICAgICAgICAgcG9vbEtleSxcbiAgICAgICAgICAgIHByb3RvY29sLFxuICAgICAgICAgICAgYWNjb3VudElkXG4gICAgICAgICAgKTtcbiAgICAgICAgICBwb3NpdGlvbnMuaW5pdChwb29sS2V5LCBwb3NpdGlvbik7XG4gICAgICAgICAgcG9zaXRpb24ucHVibGlzaFN0YXR1cygpO1xuICAgICAgICAgIHRoaXMuZmFjZXRzLnJlcG9ydGVyLnB1Ymxpc2hTdGF0dXMoKTtcbiAgICAgICAgICByZXR1cm4gcG9zaXRpb247XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHdhaXRLTFVER0UodmFsKSB7XG4gICAgICAgICAgcmV0dXJuIHZvd1Rvb2xzLndhdGNoKEUodGltZXIpLmRlbGF5KHZhbCkpO1xuICAgICAgICB9LFxuICAgICAgICBzZXRUYXJnZXRBbGxvY2F0aW9uKGFsbG9jYXRpb24pIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLnRhcmdldEFsbG9jYXRpb24gPSBhbGxvY2F0aW9uO1xuICAgICAgICAgIHRoaXMuZmFjZXRzLnJlcG9ydGVyLnB1Ymxpc2hTdGF0dXMoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0VGFyZ2V0QWxsb2NhdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS50YXJnZXRBbGxvY2F0aW9uO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmViYWxhbmNlSGFuZGxlcjoge1xuICAgICAgICBhc3luYyBoYW5kbGUoc2VhdCwgb2ZmZXJBcmdzKSB7XG4gICAgICAgICAgbXVzdE1hdGNoMyhvZmZlckFyZ3MsIG9mZmVyQXJnc1NoYXBlcy5yZWJhbGFuY2UpO1xuICAgICAgICAgIHJldHVybiByZWJhbGFuY2UyKHNlYXQsIG9mZmVyQXJncywgdGhpcy5mYWNldHMpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaW52aXRhdGlvbk1ha2Vyczoge1xuICAgICAgICBSZWJhbGFuY2UoKSB7XG4gICAgICAgICAgY29uc3QgeyByZWJhbGFuY2VIYW5kbGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKFxuICAgICAgICAgICAgcmViYWxhbmNlSGFuZGxlcixcbiAgICAgICAgICAgIFwicmViYWxhbmNlXCIsXG4gICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICBwcm9wb3NhbFNoYXBlcy5yZWJhbGFuY2VcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBmaW5pc2goeyBmYWNldHMgfSkge1xuICAgICAgICBmYWNldHMucmVwb3J0ZXIucHVibGlzaFN0YXR1cygpO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZVBvcnRmb2xpb0tpdCk7XG5cbi8vXG52YXIgaW1wb3J0X2JlY2gzMiA9IF9fdG9FU00ocmVxdWlyZV9kaXN0KCksIDEpO1xuXG4vL1xudmFyIGJhc2VfZXhwb3J0cyA9IHt9O1xuX19leHBvcnQoYmFzZV9leHBvcnRzLCB7XG4gIGV4Y2x1ZGU6ICgpID0+IGV4Y2x1ZGUsXG4gIGV4dHJhY3Q6ICgpID0+IGV4dHJhY3QsXG4gIHBhcnNlOiAoKSA9PiBwYXJzZTIsXG4gIHBhcnNlVXJsOiAoKSA9PiBwYXJzZVVybCxcbiAgcGljazogKCkgPT4gcGljayxcbiAgc3RyaW5naWZ5OiAoKSA9PiBzdHJpbmdpZnkyLFxuICBzdHJpbmdpZnlVcmw6ICgpID0+IHN0cmluZ2lmeVVybFxufSk7XG5cbi8vXG52YXIgdG9rZW4gPSBcIiVbYS1mMC05XXsyfVwiO1xudmFyIHNpbmdsZU1hdGNoZXIgPSBuZXcgUmVnRXhwKFwiKFwiICsgdG9rZW4gKyBcIil8KFteJV0rPylcIiwgXCJnaVwiKTtcbnZhciBtdWx0aU1hdGNoZXIgPSBuZXcgUmVnRXhwKFwiKFwiICsgdG9rZW4gKyBcIikrXCIsIFwiZ2lcIik7XG5mdW5jdGlvbiBkZWNvZGVDb21wb25lbnRzKGNvbXBvbmVudHMsIHNwbGl0Mikge1xuICB0cnkge1xuICAgIHJldHVybiBbZGVjb2RlVVJJQ29tcG9uZW50KGNvbXBvbmVudHMuam9pbihcIlwiKSldO1xuICB9IGNhdGNoIHtcbiAgfVxuICBpZiAoY29tcG9uZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICByZXR1cm4gY29tcG9uZW50cztcbiAgfVxuICBzcGxpdDIgPSBzcGxpdDIgfHwgMTtcbiAgY29uc3QgbGVmdCA9IGNvbXBvbmVudHMuc2xpY2UoMCwgc3BsaXQyKTtcbiAgY29uc3QgcmlnaHQgPSBjb21wb25lbnRzLnNsaWNlKHNwbGl0Mik7XG4gIHJldHVybiBBcnJheS5wcm90b3R5cGUuY29uY2F0LmNhbGwoW10sIGRlY29kZUNvbXBvbmVudHMobGVmdCksIGRlY29kZUNvbXBvbmVudHMocmlnaHQpKTtcbn1cbmZ1bmN0aW9uIGRlY29kZShpbnB1dCkge1xuICB0cnkge1xuICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoaW5wdXQpO1xuICB9IGNhdGNoIHtcbiAgICBsZXQgdG9rZW5zID0gaW5wdXQubWF0Y2goc2luZ2xlTWF0Y2hlcikgfHwgW107XG4gICAgZm9yIChsZXQgaTMgPSAxOyBpMyA8IHRva2Vucy5sZW5ndGg7IGkzKyspIHtcbiAgICAgIGlucHV0ID0gZGVjb2RlQ29tcG9uZW50cyh0b2tlbnMsIGkzKS5qb2luKFwiXCIpO1xuICAgICAgdG9rZW5zID0gaW5wdXQubWF0Y2goc2luZ2xlTWF0Y2hlcikgfHwgW107XG4gICAgfVxuICAgIHJldHVybiBpbnB1dDtcbiAgfVxufVxuZnVuY3Rpb24gY3VzdG9tRGVjb2RlVVJJQ29tcG9uZW50KGlucHV0KSB7XG4gIGNvbnN0IHJlcGxhY2VNYXAgPSB7XG4gICAgXCIlRkUlRkZcIjogXCJcXHVGRkZEXFx1RkZGRFwiLFxuICAgIFwiJUZGJUZFXCI6IFwiXFx1RkZGRFxcdUZGRkRcIlxuICB9O1xuICBsZXQgbWF0Y2ggPSBtdWx0aU1hdGNoZXIuZXhlYyhpbnB1dCk7XG4gIHdoaWxlIChtYXRjaCkge1xuICAgIHRyeSB7XG4gICAgICByZXBsYWNlTWFwW21hdGNoWzBdXSA9IGRlY29kZVVSSUNvbXBvbmVudChtYXRjaFswXSk7XG4gICAgfSBjYXRjaCB7XG4gICAgICBjb25zdCByZXN1bHQgPSBkZWNvZGUobWF0Y2hbMF0pO1xuICAgICAgaWYgKHJlc3VsdCAhPT0gbWF0Y2hbMF0pIHtcbiAgICAgICAgcmVwbGFjZU1hcFttYXRjaFswXV0gPSByZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuICAgIG1hdGNoID0gbXVsdGlNYXRjaGVyLmV4ZWMoaW5wdXQpO1xuICB9XG4gIHJlcGxhY2VNYXBbXCIlQzJcIl0gPSBcIlxcdUZGRkRcIjtcbiAgY29uc3QgZW50cmllczEwID0gT2JqZWN0LmtleXMocmVwbGFjZU1hcCk7XG4gIGZvciAoY29uc3Qga2V5IG9mIGVudHJpZXMxMCkge1xuICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZShuZXcgUmVnRXhwKGtleSwgXCJnXCIpLCByZXBsYWNlTWFwW2tleV0pO1xuICB9XG4gIHJldHVybiBpbnB1dDtcbn1cbmZ1bmN0aW9uIGRlY29kZVVyaUNvbXBvbmVudChlbmNvZGVkVVJJKSB7XG4gIGlmICh0eXBlb2YgZW5jb2RlZFVSSSAhPT0gXCJzdHJpbmdcIikge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJFeHBlY3RlZCBgZW5jb2RlZFVSSWAgdG8gYmUgb2YgdHlwZSBgc3RyaW5nYCwgZ290IGBcIiArIHR5cGVvZiBlbmNvZGVkVVJJICsgXCJgXCIpO1xuICB9XG4gIHRyeSB7XG4gICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlbmNvZGVkVVJJKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIGN1c3RvbURlY29kZVVSSUNvbXBvbmVudChlbmNvZGVkVVJJKTtcbiAgfVxufVxuXG4vL1xuZnVuY3Rpb24gaW5jbHVkZUtleXMob2JqZWN0LCBwcmVkaWNhdGUpIHtcbiAgY29uc3QgcmVzdWx0ID0ge307XG4gIGlmIChBcnJheS5pc0FycmF5KHByZWRpY2F0ZSkpIHtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBwcmVkaWNhdGUpIHtcbiAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwga2V5KTtcbiAgICAgIGlmIChkZXNjcmlwdG9yPy5lbnVtZXJhYmxlKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXN1bHQsIGtleSwgZGVzY3JpcHRvcik7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZvciAoY29uc3Qga2V5IG9mIFJlZmxlY3Qub3duS2V5cyhvYmplY3QpKSB7XG4gICAgICBjb25zdCBkZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIGtleSk7XG4gICAgICBpZiAoZGVzY3JpcHRvci5lbnVtZXJhYmxlKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gb2JqZWN0W2tleV07XG4gICAgICAgIGlmIChwcmVkaWNhdGUoa2V5LCB2YWx1ZSwgb2JqZWN0KSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXN1bHQsIGtleSwgZGVzY3JpcHRvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLy9cbmZ1bmN0aW9uIHNwbGl0T25GaXJzdChzdHJpbmcsIHNlcGFyYXRvcikge1xuICBpZiAoISh0eXBlb2Ygc3RyaW5nID09PSBcInN0cmluZ1wiICYmIHR5cGVvZiBzZXBhcmF0b3IgPT09IFwic3RyaW5nXCIpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkV4cGVjdGVkIHRoZSBhcmd1bWVudHMgdG8gYmUgb2YgdHlwZSBgc3RyaW5nYFwiKTtcbiAgfVxuICBpZiAoc3RyaW5nID09PSBcIlwiIHx8IHNlcGFyYXRvciA9PT0gXCJcIikge1xuICAgIHJldHVybiBbXTtcbiAgfVxuICBjb25zdCBzZXBhcmF0b3JJbmRleCA9IHN0cmluZy5pbmRleE9mKHNlcGFyYXRvcik7XG4gIGlmIChzZXBhcmF0b3JJbmRleCA9PT0gLTEpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgcmV0dXJuIFtcbiAgICBzdHJpbmcuc2xpY2UoMCwgc2VwYXJhdG9ySW5kZXgpLFxuICAgIHN0cmluZy5zbGljZShzZXBhcmF0b3JJbmRleCArIHNlcGFyYXRvci5sZW5ndGgpXG4gIF07XG59XG5cbi8vXG52YXIgaXNOdWxsT3JVbmRlZmluZWQgPSAodmFsdWUpID0+IHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB2b2lkIDA7XG52YXIgc3RyaWN0VXJpRW5jb2RlID0gKHN0cmluZykgPT4gZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZykucmVwbGFjZUFsbCgvWyEnKCkqXS9nLCAoeCkgPT4gYCUke3guY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKX1gKTtcbnZhciBlbmNvZGVGcmFnbWVudElkZW50aWZpZXIgPSBTeW1ib2woXCJlbmNvZGVGcmFnbWVudElkZW50aWZpZXJcIik7XG5mdW5jdGlvbiBlbmNvZGVyRm9yQXJyYXlGb3JtYXQob3B0aW9ucykge1xuICBzd2l0Y2ggKG9wdGlvbnMuYXJyYXlGb3JtYXQpIHtcbiAgICBjYXNlIFwiaW5kZXhcIjoge1xuICAgICAgcmV0dXJuIChrZXkpID0+IChyZXN1bHQsIHZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gcmVzdWx0Lmxlbmd0aDtcbiAgICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDAgfHwgb3B0aW9ucy5za2lwTnVsbCAmJiB2YWx1ZSA9PT0gbnVsbCB8fCBvcHRpb25zLnNraXBFbXB0eVN0cmluZyAmJiB2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgXCJbXCIsIGluZGV4LCBcIl1cIl0uam9pbihcIlwiKVxuICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgW2VuY29kZShrZXksIG9wdGlvbnMpLCBcIltcIiwgZW5jb2RlKGluZGV4LCBvcHRpb25zKSwgXCJdPVwiLCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKFwiXCIpXG4gICAgICAgIF07XG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiYnJhY2tldFwiOiB7XG4gICAgICByZXR1cm4gKGtleSkgPT4gKHJlc3VsdCwgdmFsdWUpID0+IHtcbiAgICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDAgfHwgb3B0aW9ucy5za2lwTnVsbCAmJiB2YWx1ZSA9PT0gbnVsbCB8fCBvcHRpb25zLnNraXBFbXB0eVN0cmluZyAmJiB2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgXCJbXVwiXS5qb2luKFwiXCIpXG4gICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICBbZW5jb2RlKGtleSwgb3B0aW9ucyksIFwiW109XCIsIGVuY29kZSh2YWx1ZSwgb3B0aW9ucyldLmpvaW4oXCJcIilcbiAgICAgICAgXTtcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgXCJjb2xvbi1saXN0LXNlcGFyYXRvclwiOiB7XG4gICAgICByZXR1cm4gKGtleSkgPT4gKHJlc3VsdCwgdmFsdWUpID0+IHtcbiAgICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDAgfHwgb3B0aW9ucy5za2lwTnVsbCAmJiB2YWx1ZSA9PT0gbnVsbCB8fCBvcHRpb25zLnNraXBFbXB0eVN0cmluZyAmJiB2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgXCI6bGlzdD1cIl0uam9pbihcIlwiKVxuICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgW2VuY29kZShrZXksIG9wdGlvbnMpLCBcIjpsaXN0PVwiLCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKFwiXCIpXG4gICAgICAgIF07XG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiY29tbWFcIjpcbiAgICBjYXNlIFwic2VwYXJhdG9yXCI6XG4gICAgY2FzZSBcImJyYWNrZXQtc2VwYXJhdG9yXCI6IHtcbiAgICAgIGNvbnN0IGtleVZhbHVlU2VwYXJhdG9yID0gb3B0aW9ucy5hcnJheUZvcm1hdCA9PT0gXCJicmFja2V0LXNlcGFyYXRvclwiID8gXCJbXT1cIiA6IFwiPVwiO1xuICAgICAgcmV0dXJuIChrZXkpID0+IChyZXN1bHQsIHZhbHVlKSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwIHx8IG9wdGlvbnMuc2tpcE51bGwgJiYgdmFsdWUgPT09IG51bGwgfHwgb3B0aW9ucy5za2lwRW1wdHlTdHJpbmcgJiYgdmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIHZhbHVlID0gdmFsdWUgPT09IG51bGwgPyBcIlwiIDogdmFsdWU7XG4gICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIFtbZW5jb2RlKGtleSwgb3B0aW9ucyksIGtleVZhbHVlU2VwYXJhdG9yLCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKFwiXCIpXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW1tyZXN1bHQsIGVuY29kZSh2YWx1ZSwgb3B0aW9ucyldLmpvaW4ob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcildO1xuICAgICAgfTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgcmV0dXJuIChrZXkpID0+IChyZXN1bHQsIHZhbHVlKSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwIHx8IG9wdGlvbnMuc2tpcE51bGwgJiYgdmFsdWUgPT09IG51bGwgfHwgb3B0aW9ucy5za2lwRW1wdHlTdHJpbmcgJiYgdmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgICBlbmNvZGUoa2V5LCBvcHRpb25zKVxuICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgW2VuY29kZShrZXksIG9wdGlvbnMpLCBcIj1cIiwgZW5jb2RlKHZhbHVlLCBvcHRpb25zKV0uam9pbihcIlwiKVxuICAgICAgICBdO1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIHBhcnNlckZvckFycmF5Rm9ybWF0KG9wdGlvbnMpIHtcbiAgbGV0IHJlc3VsdDtcbiAgc3dpdGNoIChvcHRpb25zLmFycmF5Rm9ybWF0KSB7XG4gICAgY2FzZSBcImluZGV4XCI6IHtcbiAgICAgIHJldHVybiAoa2V5LCB2YWx1ZSwgYWNjdW11bGF0b3IpID0+IHtcbiAgICAgICAgcmVzdWx0ID0gL1xcWyhcXGQqKV0kLy5leGVjKGtleSk7XG4gICAgICAgIGtleSA9IGtleS5yZXBsYWNlKC9cXFtcXGQqXSQvLCBcIlwiKTtcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gdmFsdWU7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhY2N1bXVsYXRvcltrZXldID09PSB2b2lkIDApIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0ge307XG4gICAgICAgIH1cbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XVtyZXN1bHRbMV1dID0gdmFsdWU7XG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiYnJhY2tldFwiOiB7XG4gICAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG4gICAgICAgIHJlc3VsdCA9IC8oXFxbXSkkLy5leGVjKGtleSk7XG4gICAgICAgIGtleSA9IGtleS5yZXBsYWNlKC9cXFtdJC8sIFwiXCIpO1xuICAgICAgICBpZiAoIXJlc3VsdCkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFjY3VtdWxhdG9yW2tleV0gPT09IHZvaWQgMCkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSBbdmFsdWVdO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gWy4uLmFjY3VtdWxhdG9yW2tleV0sIHZhbHVlXTtcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgXCJjb2xvbi1saXN0LXNlcGFyYXRvclwiOiB7XG4gICAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG4gICAgICAgIHJlc3VsdCA9IC8oOmxpc3QpJC8uZXhlYyhrZXkpO1xuICAgICAgICBrZXkgPSBrZXkucmVwbGFjZSgvOmxpc3QkLywgXCJcIik7XG4gICAgICAgIGlmICghcmVzdWx0KSB7XG4gICAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IHZhbHVlO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWNjdW11bGF0b3Jba2V5XSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IFt2YWx1ZV07XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSBbLi4uYWNjdW11bGF0b3Jba2V5XSwgdmFsdWVdO1xuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBcImNvbW1hXCI6XG4gICAgY2FzZSBcInNlcGFyYXRvclwiOiB7XG4gICAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG4gICAgICAgIGNvbnN0IGlzQXJyYXk5ID0gdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluY2x1ZGVzKG9wdGlvbnMuYXJyYXlGb3JtYXRTZXBhcmF0b3IpO1xuICAgICAgICBjb25zdCBpc0VuY29kZWRBcnJheSA9IHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiAhaXNBcnJheTkgJiYgZGVjb2RlMih2YWx1ZSwgb3B0aW9ucykuaW5jbHVkZXMob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gICAgICAgIHZhbHVlID0gaXNFbmNvZGVkQXJyYXkgPyBkZWNvZGUyKHZhbHVlLCBvcHRpb25zKSA6IHZhbHVlO1xuICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IGlzQXJyYXk5IHx8IGlzRW5jb2RlZEFycmF5ID8gdmFsdWUuc3BsaXQob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcikubWFwKChpdGVtKSA9PiBkZWNvZGUyKGl0ZW0sIG9wdGlvbnMpKSA6IHZhbHVlID09PSBudWxsID8gdmFsdWUgOiBkZWNvZGUyKHZhbHVlLCBvcHRpb25zKTtcbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IG5ld1ZhbHVlO1xuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBcImJyYWNrZXQtc2VwYXJhdG9yXCI6IHtcbiAgICAgIHJldHVybiAoa2V5LCB2YWx1ZSwgYWNjdW11bGF0b3IpID0+IHtcbiAgICAgICAgY29uc3QgaXNBcnJheTkgPSAvKFxcW10pJC8udGVzdChrZXkpO1xuICAgICAgICBrZXkgPSBrZXkucmVwbGFjZSgvXFxbXSQvLCBcIlwiKTtcbiAgICAgICAgaWYgKCFpc0FycmF5OSkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSB2YWx1ZSA/IGRlY29kZTIodmFsdWUsIG9wdGlvbnMpIDogdmFsdWU7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFycmF5VmFsdWUgPSB2YWx1ZSA9PT0gbnVsbCA/IFtdIDogZGVjb2RlMih2YWx1ZSwgb3B0aW9ucykuc3BsaXQob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gICAgICAgIGlmIChhY2N1bXVsYXRvcltrZXldID09PSB2b2lkIDApIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gYXJyYXlWYWx1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IFsuLi5hY2N1bXVsYXRvcltrZXldLCAuLi5hcnJheVZhbHVlXTtcbiAgICAgIH07XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHJldHVybiAoa2V5LCB2YWx1ZSwgYWNjdW11bGF0b3IpID0+IHtcbiAgICAgICAgaWYgKGFjY3VtdWxhdG9yW2tleV0gPT09IHZvaWQgMCkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IFsuLi5bYWNjdW11bGF0b3Jba2V5XV0uZmxhdCgpLCB2YWx1ZV07XG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gdmFsaWRhdGVBcnJheUZvcm1hdFNlcGFyYXRvcih2YWx1ZSkge1xuICBpZiAodHlwZW9mIHZhbHVlICE9PSBcInN0cmluZ1wiIHx8IHZhbHVlLmxlbmd0aCAhPT0gMSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJhcnJheUZvcm1hdFNlcGFyYXRvciBtdXN0IGJlIHNpbmdsZSBjaGFyYWN0ZXIgc3RyaW5nXCIpO1xuICB9XG59XG5mdW5jdGlvbiBlbmNvZGUodmFsdWUsIG9wdGlvbnMpIHtcbiAgaWYgKG9wdGlvbnMuZW5jb2RlKSB7XG4gICAgcmV0dXJuIG9wdGlvbnMuc3RyaWN0ID8gc3RyaWN0VXJpRW5jb2RlKHZhbHVlKSA6IGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gZGVjb2RlMih2YWx1ZSwgb3B0aW9ucykge1xuICBpZiAob3B0aW9ucy5kZWNvZGUpIHtcbiAgICByZXR1cm4gZGVjb2RlVXJpQ29tcG9uZW50KHZhbHVlKTtcbiAgfVxuICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiBrZXlzU29ydGVyKGlucHV0KSB7XG4gIGlmIChBcnJheS5pc0FycmF5KGlucHV0KSkge1xuICAgIHJldHVybiBpbnB1dC5zb3J0KCk7XG4gIH1cbiAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gXCJvYmplY3RcIikge1xuICAgIHJldHVybiBrZXlzU29ydGVyKE9iamVjdC5rZXlzKGlucHV0KSkuc29ydCgoYTIsIGIzKSA9PiBOdW1iZXIoYTIpIC0gTnVtYmVyKGIzKSkubWFwKChrZXkpID0+IGlucHV0W2tleV0pO1xuICB9XG4gIHJldHVybiBpbnB1dDtcbn1cbmZ1bmN0aW9uIHJlbW92ZUhhc2goaW5wdXQpIHtcbiAgY29uc3QgaGFzaFN0YXJ0ID0gaW5wdXQuaW5kZXhPZihcIiNcIik7XG4gIGlmIChoYXNoU3RhcnQgIT09IC0xKSB7XG4gICAgaW5wdXQgPSBpbnB1dC5zbGljZSgwLCBoYXNoU3RhcnQpO1xuICB9XG4gIHJldHVybiBpbnB1dDtcbn1cbmZ1bmN0aW9uIGdldEhhc2godXJsKSB7XG4gIGxldCBoYXNoMiA9IFwiXCI7XG4gIGNvbnN0IGhhc2hTdGFydCA9IHVybC5pbmRleE9mKFwiI1wiKTtcbiAgaWYgKGhhc2hTdGFydCAhPT0gLTEpIHtcbiAgICBoYXNoMiA9IHVybC5zbGljZShoYXNoU3RhcnQpO1xuICB9XG4gIHJldHVybiBoYXNoMjtcbn1cbmZ1bmN0aW9uIHBhcnNlVmFsdWUodmFsdWUsIG9wdGlvbnMsIHR5cGUpIHtcbiAgaWYgKHR5cGUgPT09IFwic3RyaW5nXCIgJiYgdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIGlmICh0eXBlb2YgdHlwZSA9PT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiB0eXBlKHZhbHVlKTtcbiAgfVxuICBpZiAob3B0aW9ucy5wYXJzZUJvb2xlYW5zICYmIHZhbHVlICE9PSBudWxsICYmICh2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSBcInRydWVcIiB8fCB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSBcImZhbHNlXCIpKSB7XG4gICAgcmV0dXJuIHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IFwidHJ1ZVwiO1xuICB9XG4gIGlmICh0eXBlID09PSBcIm51bWJlclwiICYmICFOdW1iZXIuaXNOYU4oTnVtYmVyKHZhbHVlKSkgJiYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS50cmltKCkgIT09IFwiXCIpKSB7XG4gICAgcmV0dXJuIE51bWJlcih2YWx1ZSk7XG4gIH1cbiAgaWYgKG9wdGlvbnMucGFyc2VOdW1iZXJzICYmICFOdW1iZXIuaXNOYU4oTnVtYmVyKHZhbHVlKSkgJiYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS50cmltKCkgIT09IFwiXCIpKSB7XG4gICAgcmV0dXJuIE51bWJlcih2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gZXh0cmFjdChpbnB1dCkge1xuICBpbnB1dCA9IHJlbW92ZUhhc2goaW5wdXQpO1xuICBjb25zdCBxdWVyeVN0YXJ0ID0gaW5wdXQuaW5kZXhPZihcIj9cIik7XG4gIGlmIChxdWVyeVN0YXJ0ID09PSAtMSkge1xuICAgIHJldHVybiBcIlwiO1xuICB9XG4gIHJldHVybiBpbnB1dC5zbGljZShxdWVyeVN0YXJ0ICsgMSk7XG59XG5mdW5jdGlvbiBwYXJzZTIocXVlcnksIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IHtcbiAgICBkZWNvZGU6IHRydWUsXG4gICAgc29ydDogdHJ1ZSxcbiAgICBhcnJheUZvcm1hdDogXCJub25lXCIsXG4gICAgYXJyYXlGb3JtYXRTZXBhcmF0b3I6IFwiLFwiLFxuICAgIHBhcnNlTnVtYmVyczogZmFsc2UsXG4gICAgcGFyc2VCb29sZWFuczogZmFsc2UsXG4gICAgdHlwZXM6IC8qICAgICAgICAgICAqLyBPYmplY3QuY3JlYXRlKG51bGwpLFxuICAgIC4uLm9wdGlvbnNcbiAgfTtcbiAgdmFsaWRhdGVBcnJheUZvcm1hdFNlcGFyYXRvcihvcHRpb25zLmFycmF5Rm9ybWF0U2VwYXJhdG9yKTtcbiAgY29uc3QgZm9ybWF0dGVyID0gcGFyc2VyRm9yQXJyYXlGb3JtYXQob3B0aW9ucyk7XG4gIGNvbnN0IHJldHVyblZhbHVlID0gLyogICAgICAgICAgICovIE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIGlmICh0eXBlb2YgcXVlcnkgIT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gIH1cbiAgcXVlcnkgPSBxdWVyeS50cmltKCkucmVwbGFjZSgvXls/IyZdLywgXCJcIik7XG4gIGlmICghcXVlcnkpIHtcbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gIH1cbiAgZm9yIChjb25zdCBwYXJhbWV0ZXIgb2YgcXVlcnkuc3BsaXQoXCImXCIpKSB7XG4gICAgaWYgKHBhcmFtZXRlciA9PT0gXCJcIikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtZXRlcl8gPSBvcHRpb25zLmRlY29kZSA/IHBhcmFtZXRlci5yZXBsYWNlQWxsKFwiK1wiLCBcIiBcIikgOiBwYXJhbWV0ZXI7XG4gICAgbGV0IFtrZXksIHZhbHVlXSA9IHNwbGl0T25GaXJzdChwYXJhbWV0ZXJfLCBcIj1cIik7XG4gICAgaWYgKGtleSA9PT0gdm9pZCAwKSB7XG4gICAgICBrZXkgPSBwYXJhbWV0ZXJfO1xuICAgIH1cbiAgICB2YWx1ZSA9IHZhbHVlID09PSB2b2lkIDAgPyBudWxsIDogW1wiY29tbWFcIiwgXCJzZXBhcmF0b3JcIiwgXCJicmFja2V0LXNlcGFyYXRvclwiXS5pbmNsdWRlcyhvcHRpb25zLmFycmF5Rm9ybWF0KSA/IHZhbHVlIDogZGVjb2RlMih2YWx1ZSwgb3B0aW9ucyk7XG4gICAgZm9ybWF0dGVyKGRlY29kZTIoa2V5LCBvcHRpb25zKSwgdmFsdWUsIHJldHVyblZhbHVlKTtcbiAgfVxuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhyZXR1cm5WYWx1ZSkpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIHZhbHVlICE9PSBudWxsICYmIG9wdGlvbnMudHlwZXNba2V5XSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgZm9yIChjb25zdCBba2V5MiwgdmFsdWUyXSBvZiBPYmplY3QuZW50cmllcyh2YWx1ZSkpIHtcbiAgICAgICAgY29uc3QgdHlwZSA9IG9wdGlvbnMudHlwZXNba2V5XSA/IG9wdGlvbnMudHlwZXNba2V5XS5yZXBsYWNlKFwiW11cIiwgXCJcIikgOiB2b2lkIDA7XG4gICAgICAgIHZhbHVlW2tleTJdID0gcGFyc2VWYWx1ZSh2YWx1ZTIsIG9wdGlvbnMsIHR5cGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIHZhbHVlICE9PSBudWxsICYmIG9wdGlvbnMudHlwZXNba2V5XSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuVmFsdWVba2V5XSA9IE9iamVjdC52YWx1ZXModmFsdWUpLmpvaW4ob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVyblZhbHVlW2tleV0gPSBwYXJzZVZhbHVlKHZhbHVlLCBvcHRpb25zLCBvcHRpb25zLnR5cGVzW2tleV0pO1xuICAgIH1cbiAgfVxuICBpZiAob3B0aW9ucy5zb3J0ID09PSBmYWxzZSkge1xuICAgIHJldHVybiByZXR1cm5WYWx1ZTtcbiAgfVxuICByZXR1cm4gKG9wdGlvbnMuc29ydCA9PT0gdHJ1ZSA/IE9iamVjdC5rZXlzKHJldHVyblZhbHVlKS5zb3J0KCkgOiBPYmplY3Qua2V5cyhyZXR1cm5WYWx1ZSkuc29ydChvcHRpb25zLnNvcnQpKS5yZWR1Y2UoKHJlc3VsdCwga2V5KSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSByZXR1cm5WYWx1ZVtrZXldO1xuICAgIHJlc3VsdFtrZXldID0gQm9vbGVhbih2YWx1ZSkgJiYgdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmICFBcnJheS5pc0FycmF5KHZhbHVlKSA/IGtleXNTb3J0ZXIodmFsdWUpIDogdmFsdWU7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSwgLyogICAgICAgICAgICovIE9iamVjdC5jcmVhdGUobnVsbCkpO1xufVxuZnVuY3Rpb24gc3RyaW5naWZ5MihvYmplY3QsIG9wdGlvbnMpIHtcbiAgaWYgKCFvYmplY3QpIHtcbiAgICByZXR1cm4gXCJcIjtcbiAgfVxuICBvcHRpb25zID0ge1xuICAgIGVuY29kZTogdHJ1ZSxcbiAgICBzdHJpY3Q6IHRydWUsXG4gICAgYXJyYXlGb3JtYXQ6IFwibm9uZVwiLFxuICAgIGFycmF5Rm9ybWF0U2VwYXJhdG9yOiBcIixcIixcbiAgICAuLi5vcHRpb25zXG4gIH07XG4gIHZhbGlkYXRlQXJyYXlGb3JtYXRTZXBhcmF0b3Iob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gIGNvbnN0IHNob3VsZEZpbHRlciA9IChrZXkpID0+IG9wdGlvbnMuc2tpcE51bGwgJiYgaXNOdWxsT3JVbmRlZmluZWQob2JqZWN0W2tleV0pIHx8IG9wdGlvbnMuc2tpcEVtcHR5U3RyaW5nICYmIG9iamVjdFtrZXldID09PSBcIlwiO1xuICBjb25zdCBmb3JtYXR0ZXIgPSBlbmNvZGVyRm9yQXJyYXlGb3JtYXQob3B0aW9ucyk7XG4gIGNvbnN0IG9iamVjdENvcHkgPSB7fTtcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMob2JqZWN0KSkge1xuICAgIGlmICghc2hvdWxkRmlsdGVyKGtleSkpIHtcbiAgICAgIG9iamVjdENvcHlba2V5XSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuICBjb25zdCBrZXlzOCA9IE9iamVjdC5rZXlzKG9iamVjdENvcHkpO1xuICBpZiAob3B0aW9ucy5zb3J0ICE9PSBmYWxzZSkge1xuICAgIGtleXM4LnNvcnQob3B0aW9ucy5zb3J0KTtcbiAgfVxuICByZXR1cm4ga2V5czgubWFwKChrZXkpID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IG9iamVjdFtrZXldO1xuICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gZW5jb2RlKGtleSwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCAmJiBvcHRpb25zLmFycmF5Rm9ybWF0ID09PSBcImJyYWNrZXQtc2VwYXJhdG9yXCIpIHtcbiAgICAgICAgcmV0dXJuIGVuY29kZShrZXksIG9wdGlvbnMpICsgXCJbXVwiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZhbHVlLnJlZHVjZShmb3JtYXR0ZXIoa2V5KSwgW10pLmpvaW4oXCImXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZW5jb2RlKGtleSwgb3B0aW9ucykgKyBcIj1cIiArIGVuY29kZSh2YWx1ZSwgb3B0aW9ucyk7XG4gIH0pLmZpbHRlcigoeCkgPT4geC5sZW5ndGggPiAwKS5qb2luKFwiJlwiKTtcbn1cbmZ1bmN0aW9uIHBhcnNlVXJsKHVybCwgb3B0aW9ucykge1xuICBvcHRpb25zID0ge1xuICAgIGRlY29kZTogdHJ1ZSxcbiAgICAuLi5vcHRpb25zXG4gIH07XG4gIGxldCBbdXJsXywgaGFzaDJdID0gc3BsaXRPbkZpcnN0KHVybCwgXCIjXCIpO1xuICBpZiAodXJsXyA9PT0gdm9pZCAwKSB7XG4gICAgdXJsXyA9IHVybDtcbiAgfVxuICByZXR1cm4ge1xuICAgIHVybDogdXJsXz8uc3BsaXQoXCI/XCIpPy5bMF0gPz8gXCJcIixcbiAgICBxdWVyeTogcGFyc2UyKGV4dHJhY3QodXJsKSwgb3B0aW9ucyksXG4gICAgLi4uKG9wdGlvbnMmJiBvcHRpb25zLnBhcnNlRnJhZ21lbnRJZGVudGlmaWVyICYmIGhhc2gyID8geyBmcmFnbWVudElkZW50aWZpZXI6IGRlY29kZTIoaGFzaDIsIG9wdGlvbnMpIH0gOiB7fSlcbiAgfTtcbn1cbmZ1bmN0aW9uIHN0cmluZ2lmeVVybChvYmplY3QsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IHtcbiAgICBlbmNvZGU6IHRydWUsXG4gICAgc3RyaWN0OiB0cnVlLFxuICAgIFtlbmNvZGVGcmFnbWVudElkZW50aWZpZXJdOiB0cnVlLFxuICAgIC4uLm9wdGlvbnNcbiAgfTtcbiAgY29uc3QgdXJsID0gcmVtb3ZlSGFzaChvYmplY3QudXJsKS5zcGxpdChcIj9cIilbMF0gfHwgXCJcIjtcbiAgY29uc3QgcXVlcnlGcm9tVXJsID0gZXh0cmFjdChvYmplY3QudXJsKTtcbiAgY29uc3QgcXVlcnkgPSB7XG4gICAgLi4ucGFyc2UyKHF1ZXJ5RnJvbVVybCwgeyBzb3J0OiBmYWxzZSB9KSxcbiAgICAuLi5vYmplY3QucXVlcnlcbiAgfTtcbiAgbGV0IHF1ZXJ5U3RyaW5nID0gc3RyaW5naWZ5MihxdWVyeSwgb3B0aW9ucyk7XG4gIHF1ZXJ5U3RyaW5nICYmPSBgPyR7cXVlcnlTdHJpbmd9YDtcbiAgbGV0IGhhc2gyID0gZ2V0SGFzaChvYmplY3QudXJsKTtcbiAgaWYgKHR5cGVvZiBvYmplY3QuZnJhZ21lbnRJZGVudGlmaWVyID09PSBcInN0cmluZ1wiKSB7XG4gICAgY29uc3QgdXJsT2JqZWN0Rm9yRnJhZ21lbnRFbmNvZGUgPSBuZXcgVVJMKHVybCk7XG4gICAgdXJsT2JqZWN0Rm9yRnJhZ21lbnRFbmNvZGUuaGFzaCA9IG9iamVjdC5mcmFnbWVudElkZW50aWZpZXI7XG4gICAgaGFzaDIgPSBvcHRpb25zW2VuY29kZUZyYWdtZW50SWRlbnRpZmllcl0gPyB1cmxPYmplY3RGb3JGcmFnbWVudEVuY29kZS5oYXNoIDogYCMke29iamVjdC5mcmFnbWVudElkZW50aWZpZXJ9YDtcbiAgfVxuICByZXR1cm4gYCR7dXJsfSR7cXVlcnlTdHJpbmd9JHtoYXNoMn1gO1xufVxuZnVuY3Rpb24gcGljayhpbnB1dCwgZmlsdGVyLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSB7XG4gICAgcGFyc2VGcmFnbWVudElkZW50aWZpZXI6IHRydWUsXG4gICAgW2VuY29kZUZyYWdtZW50SWRlbnRpZmllcl06IGZhbHNlLFxuICAgIC4uLm9wdGlvbnNcbiAgfTtcbiAgY29uc3QgeyB1cmwsIHF1ZXJ5LCBmcmFnbWVudElkZW50aWZpZXIgfSA9IHBhcnNlVXJsKGlucHV0LCBvcHRpb25zKTtcbiAgcmV0dXJuIHN0cmluZ2lmeVVybCh7XG4gICAgdXJsLFxuICAgIHF1ZXJ5OiBpbmNsdWRlS2V5cyhxdWVyeSwgZmlsdGVyKSxcbiAgICBmcmFnbWVudElkZW50aWZpZXJcbiAgfSwgb3B0aW9ucyk7XG59XG5mdW5jdGlvbiBleGNsdWRlKGlucHV0LCBmaWx0ZXIsIG9wdGlvbnMpIHtcbiAgY29uc3QgZXhjbHVzaW9uRmlsdGVyID0gQXJyYXkuaXNBcnJheShmaWx0ZXIpID8gKGtleSkgPT4gIWZpbHRlci5pbmNsdWRlcyhrZXkpIDogKGtleSwgdmFsdWUpID0+ICFmaWx0ZXIoa2V5LCB2YWx1ZSk7XG4gIHJldHVybiBwaWNrKGlucHV0LCBleGNsdXNpb25GaWx0ZXIsIG9wdGlvbnMpO1xufVxuXG4vL1xudmFyIHF1ZXJ5X3N0cmluZ19kZWZhdWx0ID0gYmFzZV9leHBvcnRzO1xuXG4vL1xudmFyIHI0ID0gZ2xvYmFsVGhpcy5oYXJkZW4gfHwgT2JqZWN0LmZyZWV6ZTtcbnZhciB0NCA9IFsxMjAsIDI0MSwgMTEyXTtcbnI0KHQ0KTtcbnZhciBkZWNvZGVCZWNoMzIgPSAobzIsIHQ1ID0gMTAyNCkgPT4ge1xuICBjb25zdCB7IHByZWZpeDogczMsIHdvcmRzOiBkIH0gPSBpbXBvcnRfYmVjaDMyLmJlY2gzMi5kZWNvZGUobzIsIHQ1KSwgbjIgPSBpbXBvcnRfYmVjaDMyLmJlY2gzMi5mcm9tV29yZHMoZCksIGMyID0gbmV3IFVpbnQ4QXJyYXkobjIpO1xuICByZXR1cm4gcjQoeyBwcmVmaXg6IHMzLCBieXRlczogYzIgfSk7XG59O1xucjQoZGVjb2RlQmVjaDMyKTtcbnZhciBlbmNvZGVCZWNoMzIgPSAobzIsIHI1LCB0NSA9IDEwMjQpID0+IHtcbiAgY29uc3QgczMgPSBpbXBvcnRfYmVjaDMyLmJlY2gzMi50b1dvcmRzKHI1KTtcbiAgcmV0dXJuIGltcG9ydF9iZWNoMzIuYmVjaDMyLmVuY29kZShvMiwgczMsIHQ1KTtcbn07XG5yNChlbmNvZGVCZWNoMzIpO1xudmFyIGpvaW5Ib29rZWRBZGRyZXNzID0gKGUyLCBvMiwgcjUgPSAxMDI0KSA9PiB7XG4gIGNvbnN0IHsgcHJlZml4OiBzMywgYnl0ZXM6IGQgfSA9IGRlY29kZUJlY2gzMihlMiwgcjUpLCBuMiA9IGQubGVuZ3RoLCBjMiA9IG8yLmxlbmd0aCwgYTIgPSA2NTUzNjtcbiAgaWYgKG4yID49IGEyKSB0aHJvdyBSYW5nZUVycm9yKGBCYXNlIGFkZHJlc3MgbGVuZ3RoIDB4JHtuMi50b1N0cmluZygxNil9IGV4Y2VlZHMgbWF4aW11bSAweCR7YTIudG9TdHJpbmcoMTYpfWApO1xuICBpZiAoIU51bWJlci5pc1NhZmVJbnRlZ2VyKGMyKSB8fCBjMiA8IDApIHRocm93IFJhbmdlRXJyb3IoYEhvb2sgZGF0YSBsZW5ndGggJHtjMn0gaXMgbm90IGEgbm9uLW5lZ2F0aXZlIGludGVnZXJgKTtcbiAgY29uc3QgaTMgPSB0NC5sZW5ndGgsIGggPSBuZXcgVWludDhBcnJheShpMyArIG4yICsgYzIgKyAyKTtcbiAgaC5zZXQodDQsIDApLCBoW2kzIC0gMV0gfD0gMCwgaC5zZXQoZCwgaTMpLCBoLnNldChvMiwgaTMgKyBuMik7XG4gIGxldCBnMyA9IG4yO1xuICBmb3IgKGxldCBlMyA9IDA7IGUzIDwgMjsgZTMgKz0gMSkgaFtoLmxlbmd0aCAtIDEgLSBlM10gPSAyNTUgJiBnMywgZzMgPj4+PSA4O1xuICByZXR1cm4gZW5jb2RlQmVjaDMyKHMzLCBoLCByNSk7XG59O1xucjQoam9pbkhvb2tlZEFkZHJlc3MpO1xudmFyIGVuY29kZUFkZHJlc3NIb29rID0gKGUyLCByNSwgdDUpID0+IHtcbiAgY29uc3QgczMgPSBxdWVyeV9zdHJpbmdfZGVmYXVsdC5zdHJpbmdpZnkocjUpLCBkID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGA/JHtzM31gKTtcbiAgcmV0dXJuIGpvaW5Ib29rZWRBZGRyZXNzKGUyLCBkLCB0NSk7XG59O1xucjQoZW5jb2RlQWRkcmVzc0hvb2spO1xudmFyIG11c3REZWNvZGVBZGRyZXNzSG9vayA9IChlMiwgdDUpID0+IHtcbiAgY29uc3QgeyBiYXNlQWRkcmVzczogczMsIGhvb2tEYXRhOiBkIH0gPSBzcGxpdEhvb2tlZEFkZHJlc3MoZTIsIHQ1KSwgbjIgPSBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoZCk7XG4gIGlmIChuMiAmJiAhbjIuc3RhcnRzV2l0aChcIj9cIikpIHRocm93IEVycm9yKGBIb29rIGRhdGEgZm9yICR7ZTJ9IGRvZXMgbm90IHN0YXJ0IHdpdGggJz8nOiAke3MzfSR7bjJ9YCk7XG4gIGNvbnN0IGMyID0gcXVlcnlfc3RyaW5nX2RlZmF1bHQucGFyc2UobjIpLCBhMiA9IHI0KHsgLi4uYzIgfSk7XG4gIHJldHVybiByNCh7IGJhc2VBZGRyZXNzOiBzMywgcXVlcnk6IGEyIH0pO1xufTtcbnI0KG11c3REZWNvZGVBZGRyZXNzSG9vayk7XG52YXIgZGVjb2RlQWRkcmVzc0hvb2sgPSAoZTIsIG8yKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdDUgPSBtdXN0RGVjb2RlQWRkcmVzc0hvb2soZTIsIG8yKTtcbiAgICByZXR1cm4gcjQodDUpO1xuICB9IGNhdGNoIChvMykge1xuICAgIHJldHVybiByNCh7IGJhc2VBZGRyZXNzOiBlMiwgcXVlcnk6IHt9IH0pO1xuICB9XG59O1xucjQoZGVjb2RlQWRkcmVzc0hvb2spO1xudmFyIHNwbGl0SG9va2VkQWRkcmVzcyA9IChlMiwgbzIgPSAxMDI0KSA9PiB7XG4gIGNvbnN0IHsgcHJlZml4OiBzMywgYnl0ZXM6IGQgfSA9IGRlY29kZUJlY2gzMihlMiwgbzIpLCBuMiA9IHQ0Lmxlbmd0aDtcbiAgbGV0IGMyID0gMjU1O1xuICBmb3IgKGxldCBvMyA9IDA7IG8zIDwgbjI7IG8zICs9IDEpIHtcbiAgICBsZXQgczQgPSBkW28zXTtcbiAgICBpZiAobzMgPT09IG4yIC0gMSAmJiAoYzIgPSAxNSAmIHM0LCBzNCAmPSAyNDApLCBzNCAhPT0gdDRbbzNdKSByZXR1cm4gcjQoeyBiYXNlQWRkcmVzczogZTIsIGhvb2tEYXRhOiBuZXcgVWludDhBcnJheSgpIH0pO1xuICB9XG4gIGlmICgwICE9PSBjMikgdGhyb3cgVHlwZUVycm9yKGBVbnN1cHBvcnRlZCBhZGRyZXNzIGhvb2sgdmVyc2lvbiAke2MyfWApO1xuICBsZXQgYTIgPSAwO1xuICBmb3IgKGxldCBlMyA9IDE7IGUzID49IDA7IGUzIC09IDEpIHtcbiAgICBjb25zdCBvMyA9IGQuYXQoLWUzIC0gMSk7XG4gICAgaWYgKHZvaWQgMCA9PT0gbzMpIHRocm93IFR5cGVFcnJvcihgQ2Fubm90IGdldCBiYXNlIGFkZHJlc3MgbGVuZ3RoIGZyb20gYnl0ZSAkey1lMyAtIDF9IG9mICR7ZC5sZW5ndGh9YCk7XG4gICAgYTIgPDw9IDgsIGEyIHw9IG8zO1xuICB9XG4gIGNvbnN0IGkzID0gYTI7XG4gIGlmIChpMyA+IGQubGVuZ3RoIC0gMiAtIG4yKSB0aHJvdyBUeXBlRXJyb3IoYEJhc2UgYWRkcmVzcyBsZW5ndGggMHgke2kzLnRvU3RyaW5nKDE2KX0gaXMgbG9uZ2VyIHRoYW4gc3BlY2ltZW4gbGVuZ3RoICR7ZC5sZW5ndGggLSAyIC0gbjJ9YCk7XG4gIGNvbnN0IGggPSBkLnN1YmFycmF5KG4yLCBuMiArIGkzKSwgZzMgPSBlbmNvZGVCZWNoMzIoczMsIGgsIG8yKSwgbDMgPSBkLnN1YmFycmF5KG4yICsgaTMsIC0yKTtcbiAgcmV0dXJuIHI0KHsgYmFzZUFkZHJlc3M6IGczLCBob29rRGF0YTogbDMgfSk7XG59O1xucjQoc3BsaXRIb29rZWRBZGRyZXNzKTtcblxuLy9cbnZhciBlbmNvZGluZ3MgPSBBcnJheS5mcm9tKFxuICB7IGxlbmd0aDogMjU2IH0sXG4gIChfLCBiMykgPT4gKFxuICAgIC8vXG4gICAgYjMudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsIFwiMFwiKVxuICApXG4pO1xudmFyIGRlY29kaW5ncyA9IG5ldyBNYXAoXG4gIGVuY29kaW5ncy5mbGF0TWFwKChoZXhkaWdpdHMsIGIzKSA9PiB7XG4gICAgY29uc3QgbG8gPSBoZXhkaWdpdHMudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBVUCA9IGhleGRpZ2l0cy50b1VwcGVyQ2FzZSgpO1xuICAgIHJldHVybiBbXG4gICAgICBbbG8sIGIzXSxcbiAgICAgIFtgJHtsb1swXX0ke1VQWzFdfWAsIGIzXSxcbiAgICAgIFtgJHtVUFswXX0ke2xvWzFdfWAsIGIzXSxcbiAgICAgIFtVUCwgYjNdXG4gICAgXTtcbiAgfSlcbik7XG52YXIgbWFrZVBvcnRhYmxlSGV4Q29kZWMgPSAoKSA9PiB7XG4gIGNvbnN0IHBvcnRhYmxlSGV4Q29kZWMgPSB7XG4gICAgZW5jb2RlSGV4OiAoYnVmKSA9PiBBcnJheS5mcm9tKGJ1ZiwgKGIzKSA9PiBlbmNvZGluZ3NbYjNdKS5qb2luKFwiXCIpLFxuICAgIGRlY29kZUhleDogKGhleCkgPT4ge1xuICAgICAgY29uc3QgaW5wdXRMZW4gPSBoZXgubGVuZ3RoO1xuICAgICAgaWYgKGlucHV0TGVuICUgMiAhPT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgaGV4IHN0cmluZzogJHtoZXh9YCk7XG4gICAgICB9XG4gICAgICBjb25zdCBidWYgPSBuZXcgVWludDhBcnJheShpbnB1dExlbiAvIDIpO1xuICAgICAgZm9yIChsZXQgaTMgPSAwOyBpMyA8IGlucHV0TGVuOyBpMyArPSAyKSB7XG4gICAgICAgIGNvbnN0IGIzID0gZGVjb2RpbmdzLmdldChoZXguc2xpY2UoaTMsIGkzICsgMikpO1xuICAgICAgICBpZiAoYjMgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBoZXggc3RyaW5nOiAke2hleH1gKTtcbiAgICAgICAgfVxuICAgICAgICBidWZbaTMgPj4gMV0gPSBiMztcbiAgICAgIH1cbiAgICAgIHJldHVybiBidWY7XG4gICAgfVxuICB9O1xuICByZXR1cm4gcG9ydGFibGVIZXhDb2RlYztcbn07XG52YXIgbWFrZUJ1ZmZlcmlzaEhleENvZGVjID0gKEJ1ZmZlcmlzaCkgPT4ge1xuICBjb25zdCBhdHRlbnVhdGVkQnVmZmVySGV4Q29kZWMgPSB7XG4gICAgZW5jb2RlSGV4OiAoYnVmKSA9PiAoQnVmZmVyaXNoLmlzQnVmZmVyPy4oYnVmKSA/IGJ1ZiA6IEJ1ZmZlcmlzaC5mcm9tKGJ1ZikpLnRvU3RyaW5nKFwiaGV4XCIpLFxuICAgIGRlY29kZUhleDogKGhleCkgPT4ge1xuICAgICAgY29uc3QgYnVmID0gQnVmZmVyaXNoLmZyb20oaGV4LCBcImhleFwiKTtcbiAgICAgIGNvbnN0IHU4YSA9IG5ldyBVaW50OEFycmF5KFxuICAgICAgICBidWYuYnVmZmVyLFxuICAgICAgICBidWYuYnl0ZU9mZnNldCxcbiAgICAgICAgYnVmLmJ5dGVMZW5ndGggLyBVaW50OEFycmF5LkJZVEVTX1BFUl9FTEVNRU5UXG4gICAgICApO1xuICAgICAgcmV0dXJuIHU4YTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBhdHRlbnVhdGVkQnVmZmVySGV4Q29kZWM7XG59O1xudmFyIHsgZW5jb2RlSGV4LCBkZWNvZGVIZXggfSA9IHR5cGVvZiBCdWZmZXIgPT09IFwidW5kZWZpbmVkXCIgPyBtYWtlUG9ydGFibGVIZXhDb2RlYygpIDogbWFrZUJ1ZmZlcmlzaEhleENvZGVjKEJ1ZmZlcik7XG5cbi8vXG52YXIgaW1wb3J0X2VuY29kaW5nMiA9IF9fdG9FU00ocmVxdWlyZV9idWlsZCgpLCAxKTtcbnZhciBoZXhUb0J5dGVzMiA9IChoZXgpID0+ICgwLCBpbXBvcnRfZW5jb2RpbmcyLmZyb21IZXgpKGhleC5zbGljZSgyKSk7XG52YXIgY29uc3RydWN0Q29udHJhY3RDYWxsID0gKHsgdGFyZ2V0LCBmdW5jdGlvblNpZ25hdHVyZSwgYXJncyB9KSA9PiB7XG4gIGNvbnN0IFtuYW1lLCBwYXJhbXNSYXddID0gZnVuY3Rpb25TaWduYXR1cmUuc3BsaXQoXCIoXCIpO1xuICBjb25zdCBwYXJhbXMgPSBwYXJhbXNSYXcucmVwbGFjZShcIilcIiwgXCJcIikuc3BsaXQoXCIsXCIpLmZpbHRlcihCb29sZWFuKTtcbiAgcmV0dXJuIHtcbiAgICB0YXJnZXQsXG4gICAgZGF0YTogZW5jb2RlRnVuY3Rpb25EYXRhKHtcbiAgICAgIGFiaTogW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogXCJmdW5jdGlvblwiLFxuICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgaW5wdXRzOiBwYXJhbXMubWFwKCh0eXBlLCBpMykgPT4gKHsgdHlwZSwgbmFtZTogYGFyZyR7aTN9YCB9KSlcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIGZ1bmN0aW9uTmFtZTogbmFtZSxcbiAgICAgIGFyZ3NcbiAgICB9KVxuICB9O1xufTtcbnZhciBidWlsZEdNUFBheWxvYWQgPSAoY29udHJhY3RDYWxscykgPT4ge1xuICBjb25zdCBhYmlFbmNvZGVkQ29udHJhY3RDYWxscyA9IFtdO1xuICBmb3IgKGNvbnN0IGNhbGwgb2YgY29udHJhY3RDYWxscykge1xuICAgIGNvbnN0IHsgdGFyZ2V0LCBmdW5jdGlvblNpZ25hdHVyZSwgYXJncyB9ID0gY2FsbDtcbiAgICBhYmlFbmNvZGVkQ29udHJhY3RDYWxscy5wdXNoKFxuICAgICAgY29uc3RydWN0Q29udHJhY3RDYWxsKHsgdGFyZ2V0LCBmdW5jdGlvblNpZ25hdHVyZSwgYXJncyB9KVxuICAgICk7XG4gIH1cbiAgY29uc3QgYWJpRW5jb2RlZERhdGEgPSBlbmNvZGVBYmlQYXJhbWV0ZXJzKFxuICAgIFtcbiAgICAgIHtcbiAgICAgICAgdHlwZTogXCJ0dXBsZVtdXCIsXG4gICAgICAgIGNvbXBvbmVudHM6IFtcbiAgICAgICAgICB7IG5hbWU6IFwidGFyZ2V0XCIsIHR5cGU6IFwiYWRkcmVzc1wiIH0sXG4gICAgICAgICAgeyBuYW1lOiBcImRhdGFcIiwgdHlwZTogXCJieXRlc1wiIH1cbiAgICAgICAgXVxuICAgICAgfVxuICAgIF0sXG4gICAgW2FiaUVuY29kZWRDb250cmFjdENhbGxzXVxuICApO1xuICByZXR1cm4gQXJyYXkuZnJvbShoZXhUb0J5dGVzMihhYmlFbmNvZGVkRGF0YSkpO1xufTtcblxuLy9cbnZhciBpbXBvcnRfZW5jb2RpbmczID0gX190b0VTTShyZXF1aXJlX2J1aWxkKCksIDEpO1xuXG4vL1xudmFyIEVSQzIwID0ge1xuICBhcHByb3ZlOiBbXCJhZGRyZXNzXCIsIFwidWludDI1NlwiXVxufTtcbnZhciBtYWtlRVZNU2Vzc2lvbiA9ICgpID0+IHtcbiAgY29uc3QgY2FsbHMgPSBbXTtcbiAgY29uc3QgZmluaXNoID0gKCkgPT4gaGFyZGVuKGNhbGxzKTtcbiAgY29uc3QgbWFrZUNvbnRyYWN0ID0gKHRhcmdldCwgaWZhY2UpID0+IHtcbiAgICBjb25zdCBzdHVicyA9IHt9O1xuICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3Qua2V5cyhpZmFjZSkpIHtcbiAgICAgIGNvbnN0IHBzID0gaWZhY2VbbmFtZV07XG4gICAgICBjb25zdCBmdW5jdGlvblNpZ25hdHVyZSA9IGAke25hbWV9KCR7cHMuam9pbihcIixcIil9KWA7XG4gICAgICBjb25zdCBmbiA9ICguLi5hcmdzKSA9PiB7XG4gICAgICAgIGNhbGxzLnB1c2goeyB0YXJnZXQsIGFyZ3MsIGZ1bmN0aW9uU2lnbmF0dXJlIH0pO1xuICAgICAgfTtcbiAgICAgIHN0dWJzW25hbWVdID0gZm47XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oc3R1YnMpO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBtYWtlQ29udHJhY3QsXG4gICAgZmluaXNoXG4gIH0pO1xufTtcblxuLy9cbnZhciBpbXBvcnRfYmVjaDMyMiA9IF9fdG9FU00ocmVxdWlyZV9kaXN0KCksIDEpO1xudmFyIG1ha2VUZXN0QWRkcmVzcyA9IChpbmRleCA9IDAsIHByZWZpeCA9IFwiYWdvcmljXCIsIGJ5dGVMZW5ndGggPSAyMCkgPT4ge1xuICBjb25zdCBieXRlczIgPSBuZXcgVWludDhBcnJheShieXRlTGVuZ3RoKS5maWxsKDApO1xuICBpZiAoaW5kZXggIT09IDApIGJ5dGVzMlswXSA9IE51bWJlcihpbmRleCk7XG4gIGNvbnN0IHdvcmRzID0gaW1wb3J0X2JlY2gzMjIuYmVjaDMyLnRvV29yZHMoYnl0ZXMyKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgaW1wb3J0X2JlY2gzMjIuYmVjaDMyLmVuY29kZShwcmVmaXgsIHdvcmRzKVxuICApO1xufTtcblxuLy9cbnZhciB0cmFjZTEyID0gbWFrZVRyYWNlcihcIkdNUEZcIik7XG52YXIgeyBrZXlzOiBrZXlzNCB9ID0gT2JqZWN0O1xudmFyIGdtcEFkZHJlc3NlcyA9IHtcbiAgQVhFTEFSX0dNUDogXCJheGVsYXIxZHY0dTVrNzNwenFyeGx6dWp4ZzNxcDhrdmMzcGplN2p0ZHZ1NzJucG50NXpocTA1ZWpjc241cW1lNVwiLFxuICBBWEVMQVJfR0FTOiBcImF4ZWxhcjFheXRoeWduNno1dGh5bWo2dG16Zndla3poMDVld2czbDdkNnk4OVwiXG59O1xudmFyIHByb3ZpZGVFVk1BY2NvdW50ID0gYXN5bmMgKGNoYWluTmFtZSwgZ21wLCBsY2EsIGN0eCwgcGspID0+IHtcbiAgY29uc3QgZm91bmQgPSBway5tYW5hZ2VyLnJlc2VydmVBY2NvdW50KGNoYWluTmFtZSk7XG4gIGlmIChmb3VuZCkge1xuICAgIHJldHVybiBmb3VuZDtcbiAgfVxuICBjb25zdCBheGVsYXJJZCA9IGdtcC5heGVsYXJJZHNbY2hhaW5OYW1lXTtcbiAgY29uc3QgdGFyZ2V0ID0geyBheGVsYXJJZCwgcmVtb3RlQWRkcmVzczogY3R4LmNvbnRyYWN0c1tjaGFpbk5hbWVdLmZhY3RvcnkgfTtcbiAgY29uc3QgZmVlID0geyBkZW5vbTogY3R4LmdtcEZlZUluZm8uZGVub20sIHZhbHVlOiBnbXAuZmVlIH07XG4gIGF3YWl0IHNlbmRHTVBDb250cmFjdENhbGwodGFyZ2V0LCBbXSwgZmVlLCBsY2EsIGdtcC5jaGFpbik7XG4gIHJldHVybiBway5yZWFkZXIuZ2V0R01QSW5mbyhjaGFpbk5hbWUpO1xufTtcbnZhciBUb2tlbk1lc3NlbmdlciA9IHtcbiAgZGVwb3NpdEZvckJ1cm46IFtcInVpbnQyNTZcIiwgXCJ1aW50MzJcIiwgXCJieXRlczMyXCIsIFwiYWRkcmVzc1wiXVxufTtcbnZhciBub2JsZURvbWFpbiA9IDQ7XG52YXIgYmVjaDMyVG9CeXRlczMyID0gKGFkZHIpID0+IHtcbiAgaWYgKGFkZHIgPT09IFwiY29zbW9zMXRlc3RcIikge1xuICAgIHRyYWNlMTIoXCJYWFggcmVwbGFjaW5nIHRlc3QgYWRkcmVzcyB0byBjb252ZXJ0IHRvIGJ5dGVzMzJcIik7XG4gICAgYWRkciA9IG1ha2VUZXN0QWRkcmVzcygzLCBcIm5vYmxlXCIpO1xuICB9XG4gIGNvbnN0IHsgZGF0YSB9ID0gKDAsIGltcG9ydF9lbmNvZGluZzMuZnJvbUJlY2gzMikoYWRkcik7XG4gIGNvbnN0IGRoID0gZW5jb2RlSGV4KGRhdGEpO1xuICBjb25zdCB6ZXJvZXNOZWVkZWQgPSA2NCAtIGRoLmxlbmd0aDtcbiAgY29uc3QgcGFkZGVkQWRkcmVzcyA9IFwiMFwiLnJlcGVhdCh6ZXJvZXNOZWVkZWQpICsgZGg7XG4gIGNvbnN0IGJzID0gYDB4JHtwYWRkZWRBZGRyZXNzfWA7XG4gIHJldHVybiBicztcbn07XG52YXIgQ0NUUGZyb21FVk0gPSB7XG4gIGhvdzogXCJDQ1RQXCIsXG4gIGNvbm5lY3Rpb25zOiBrZXlzNChBeGVsYXJDaGFpbikubWFwKChzcmMpID0+ICh7XG4gICAgc3JjLFxuICAgIGRlc3Q6IFwibm9ibGVcIlxuICB9KSksXG4gIGFwcGx5OiBhc3luYyAoY3R4LCBhbW91bnQsIHNyYywgZGVzdCkgPT4ge1xuICAgIGNvbnN0IHsgYWRkcmVzc2VzOiBhMiwgbGNhLCBnbXBDaGFpbiwgZ21wRmVlIH0gPSBjdHg7XG4gICAgY29uc3QgeyBjaGFpbk5hbWUsIHJlbW90ZUFkZHJlc3MgfSA9IHNyYztcbiAgICBjb25zdCBtaW50UmVjaXBpZW50ID0gYmVjaDMyVG9CeXRlczMyKGRlc3QuaWNhLmdldEFkZHJlc3MoKS52YWx1ZSk7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IG1ha2VFVk1TZXNzaW9uKCk7XG4gICAgY29uc3QgdXNkYyA9IHNlc3Npb24ubWFrZUNvbnRyYWN0KGEyLnVzZGMsIEVSQzIwKTtcbiAgICBjb25zdCB0bSA9IHNlc3Npb24ubWFrZUNvbnRyYWN0KGEyLnRva2VuTWVzc2VuZ2VyLCBUb2tlbk1lc3Nlbmdlcik7XG4gICAgdXNkYy5hcHByb3ZlKGEyLnRva2VuTWVzc2VuZ2VyLCBhbW91bnQudmFsdWUpO1xuICAgIHRtLmRlcG9zaXRGb3JCdXJuKGFtb3VudC52YWx1ZSwgbm9ibGVEb21haW4sIG1pbnRSZWNpcGllbnQsIGEyLnVzZGMpO1xuICAgIGNvbnN0IGNhbGxzID0gc2Vzc2lvbi5maW5pc2goKTtcbiAgICBjb25zdCBheGVsYXJJZCA9IGN0eC5heGVsYXJJZHNbY2hhaW5OYW1lXTtcbiAgICBjb25zdCB0YXJnZXQgPSB7IGF4ZWxhcklkLCByZW1vdGVBZGRyZXNzIH07XG4gICAgYXdhaXQgc2VuZEdNUENvbnRyYWN0Q2FsbCh0YXJnZXQsIGNhbGxzLCBnbXBGZWUsIGxjYSwgZ21wQ2hhaW4pO1xuICB9LFxuICByZWNvdmVyOiBhc3luYyAoX2N0eCwgYW1vdW50LCBzcmMsIGRlc3QpID0+IHtcbiAgICByZXR1cm4gQ0NUUC5hcHBseShudWxsLCBhbW91bnQsIGRlc3QsIHNyYyk7XG4gIH1cbn07XG5oYXJkZW4oQ0NUUGZyb21FVk0pO1xudmFyIENDVFAgPSB7XG4gIGhvdzogXCJDQ1RQXCIsXG4gIGNvbm5lY3Rpb25zOiBrZXlzNChBeGVsYXJDaGFpbikubWFwKChkZXN0KSA9PiAoe1xuICAgIHNyYzogXCJub2JsZVwiLFxuICAgIGRlc3RcbiAgfSkpLFxuICBhcHBseTogYXN5bmMgKF9jdHgsIGFtb3VudCwgc3JjLCBkZXN0KSA9PiB7XG4gICAgY29uc3QgZGVub21BbW91bnQgPSB7IGRlbm9tOiBcInV1c2RjXCIsIHZhbHVlOiBhbW91bnQudmFsdWUgfTtcbiAgICBjb25zdCB7IGNoYWluSWQsIHJlbW90ZUFkZHJlc3MgfSA9IGRlc3Q7XG4gICAgY29uc3QgZGVzdGluYXRpb25BZGRyZXNzID0gYCR7Y2hhaW5JZH06JHtyZW1vdGVBZGRyZXNzfWA7XG4gICAgdHJhY2UxMihgQ0NUUCBkZXN0aW5hdGlvbkFkZHJlc3M6ICR7ZGVzdGluYXRpb25BZGRyZXNzfWApO1xuICAgIGNvbnN0IHsgaWNhIH0gPSBzcmM7XG4gICAgYXdhaXQgaWNhLmRlcG9zaXRGb3JCdXJuKGRlc3RpbmF0aW9uQWRkcmVzcywgZGVub21BbW91bnQpO1xuICB9LFxuICByZWNvdmVyOiBhc3luYyAoX2N0eCwgYW1vdW50LCBzcmMsIGRlc3QpID0+IHtcbiAgICB0aHJvdyBFcnJvcihcIlRPRE8oTHVxaSk6IGhvdyB0byByZWNvdmVyIGZyb20gQ0NUUCB0cmFuc2Zlcj9cIik7XG4gIH1cbn07XG5oYXJkZW4oQ0NUUCk7XG52YXIgc2VuZEdNUENvbnRyYWN0Q2FsbCA9IGFzeW5jIChkZXN0LCBjYWxscywgZmVlLCBsY2EsIGdtcENoYWluKSA9PiB7XG4gIGNvbnN0IHsgQVhFTEFSX0dNUCwgQVhFTEFSX0dBUyB9ID0gZ21wQWRkcmVzc2VzO1xuICBjb25zdCBtZW1vID0ge1xuICAgIGRlc3RpbmF0aW9uX2NoYWluOiBkZXN0LmF4ZWxhcklkLFxuICAgIGRlc3RpbmF0aW9uX2FkZHJlc3M6IGRlc3QucmVtb3RlQWRkcmVzcyxcbiAgICBwYXlsb2FkOiBidWlsZEdNUFBheWxvYWQoY2FsbHMpLFxuICAgIHR5cGU6IEF4ZWxhckdNUE1lc3NhZ2VUeXBlLkNvbnRyYWN0Q2FsbCxcbiAgICBmZWU6IHsgYW1vdW50OiBTdHJpbmcoZmVlLnZhbHVlKSwgcmVjaXBpZW50OiBBWEVMQVJfR0FTIH1cbiAgfTtcbiAgY29uc3QgeyBjaGFpbklkIH0gPSBhd2FpdCBnbXBDaGFpbi5nZXRDaGFpbkluZm8oKTtcbiAgY29uc3QgZ21wID0geyBjaGFpbklkLCB2YWx1ZTogQVhFTEFSX0dNUCwgZW5jb2Rpbmc6IFwiYmVjaDMyXCIgfTtcbiAgYXdhaXQgbGNhLnRyYW5zZmVyKGdtcCwgZmVlLCB7IG1lbW86IEpTT04uc3RyaW5naWZ5KG1lbW8pIH0pO1xufTtcbnZhciBBYXZlID0ge1xuICBzdXBwbHk6IFtcImFkZHJlc3NcIiwgXCJ1aW50MjU2XCIsIFwiYWRkcmVzc1wiLCBcInVpbnQxNlwiXSxcbiAgd2l0aGRyYXc6IFtcImFkZHJlc3NcIiwgXCJ1aW50MjU2XCIsIFwiYWRkcmVzc1wiXVxufTtcbnZhciBBYXZlUmV3YXJkc0NvbnRyb2xsZXIgPSB7XG4gIGNsYWltQWxsUmV3YXJkc1RvU2VsZjogW1wiYWRkcmVzc1tdXCJdXG59O1xudmFyIEFhdmVQcm90b2NvbCA9IHtcbiAgcHJvdG9jb2w6IFwiQWF2ZVwiLFxuICBjaGFpbnM6IGtleXM0KEF4ZWxhckNoYWluKSxcbiAgc3VwcGx5OiBhc3luYyAoY3R4LCBhbW91bnQsIHNyYykgPT4ge1xuICAgIGNvbnN0IHsgcmVtb3RlQWRkcmVzcyB9ID0gc3JjO1xuICAgIGNvbnN0IHsgYWRkcmVzc2VzOiBhMiwgbGNhLCBnbXBDaGFpbiwgZ21wRmVlIH0gPSBjdHg7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IG1ha2VFVk1TZXNzaW9uKCk7XG4gICAgY29uc3QgdXNkYyA9IHNlc3Npb24ubWFrZUNvbnRyYWN0KGEyLnVzZGMsIEVSQzIwKTtcbiAgICBjb25zdCBhYXZlID0gc2Vzc2lvbi5tYWtlQ29udHJhY3QoYTIuYWF2ZVBvb2wsIEFhdmUpO1xuICAgIHVzZGMuYXBwcm92ZShhMi5hYXZlUG9vbCwgYW1vdW50LnZhbHVlKTtcbiAgICBhYXZlLnN1cHBseShhMi51c2RjLCBhbW91bnQudmFsdWUsIHJlbW90ZUFkZHJlc3MsIDApO1xuICAgIGNvbnN0IGNhbGxzID0gc2Vzc2lvbi5maW5pc2goKTtcbiAgICBjb25zdCBheGVsYXJJZCA9IGN0eC5heGVsYXJJZHNbc3JjLmNoYWluTmFtZV07XG4gICAgY29uc3QgdGFyZ2V0ID0geyBheGVsYXJJZCwgcmVtb3RlQWRkcmVzcyB9O1xuICAgIGF3YWl0IHNlbmRHTVBDb250cmFjdENhbGwodGFyZ2V0LCBjYWxscywgZ21wRmVlLCBsY2EsIGdtcENoYWluKTtcbiAgfSxcbiAgd2l0aGRyYXc6IGFzeW5jIChjdHgsIGFtb3VudCwgZGVzdCwgY2xhaW0pID0+IHtcbiAgICBjb25zdCB7IHJlbW90ZUFkZHJlc3MgfSA9IGRlc3Q7XG4gICAgY29uc3QgeyBhZGRyZXNzZXM6IGEyLCBsY2EsIGdtcENoYWluLCBnbXBGZWUgfSA9IGN0eDtcbiAgICBjb25zdCBzZXNzaW9uID0gbWFrZUVWTVNlc3Npb24oKTtcbiAgICBpZiAoY2xhaW0pIHtcbiAgICAgIGNvbnN0IGFhdmVSZXdhcmRzQ29udHJvbGxlciA9IHNlc3Npb24ubWFrZUNvbnRyYWN0KFxuICAgICAgICBhMi5hYXZlUmV3YXJkc0NvbnRyb2xsZXIsXG4gICAgICAgIEFhdmVSZXdhcmRzQ29udHJvbGxlclxuICAgICAgKTtcbiAgICAgIGFhdmVSZXdhcmRzQ29udHJvbGxlci5jbGFpbUFsbFJld2FyZHNUb1NlbGYoW2EyLmFhdmVVU0RDXSk7XG4gICAgfVxuICAgIGNvbnN0IGFhdmUgPSBzZXNzaW9uLm1ha2VDb250cmFjdChhMi5hYXZlUG9vbCwgQWF2ZSk7XG4gICAgYWF2ZS53aXRoZHJhdyhhMi51c2RjLCBhbW91bnQudmFsdWUsIHJlbW90ZUFkZHJlc3MpO1xuICAgIGNvbnN0IGNhbGxzID0gc2Vzc2lvbi5maW5pc2goKTtcbiAgICBjb25zdCBheGVsYXJJZCA9IGN0eC5heGVsYXJJZHNbZGVzdC5jaGFpbk5hbWVdO1xuICAgIGNvbnN0IHRhcmdldCA9IHsgYXhlbGFySWQsIHJlbW90ZUFkZHJlc3MgfTtcbiAgICBhd2FpdCBzZW5kR01QQ29udHJhY3RDYWxsKHRhcmdldCwgY2FsbHMsIGdtcEZlZSwgbGNhLCBnbXBDaGFpbik7XG4gIH1cbn07XG52YXIgQ29tcG91bmQgPSB7XG4gIHN1cHBseTogW1wiYWRkcmVzc1wiLCBcInVpbnQyNTZcIl0sXG4gIHdpdGhkcmF3OiBbXCJhZGRyZXNzXCIsIFwidWludDI1NlwiXVxufTtcbnZhciBDb21wb3VuZFJld2FyZHNDb250cm9sbGVyID0ge1xuICBjbGFpbTogW1wiYWRkcmVzc1wiLCBcImFkZHJlc3NcIiwgXCJib29sXCJdXG59O1xudmFyIENvbXBvdW5kUHJvdG9jb2wgPSB7XG4gIHByb3RvY29sOiBcIkNvbXBvdW5kXCIsXG4gIGNoYWluczoga2V5czQoQXhlbGFyQ2hhaW4pLFxuICBzdXBwbHk6IGFzeW5jIChjdHgsIGFtb3VudCwgc3JjKSA9PiB7XG4gICAgY29uc3QgeyBhZGRyZXNzZXM6IGEyLCBsY2EsIGdtcENoYWluLCBnbXBGZWU6IGZlZSB9ID0gY3R4O1xuICAgIGNvbnN0IHNlc3Npb24gPSBtYWtlRVZNU2Vzc2lvbigpO1xuICAgIGNvbnN0IHVzZGMgPSBzZXNzaW9uLm1ha2VDb250cmFjdChhMi51c2RjLCBFUkMyMCk7XG4gICAgY29uc3QgY29tcG91bmQgPSBzZXNzaW9uLm1ha2VDb250cmFjdChhMi5jb21wb3VuZCwgQ29tcG91bmQpO1xuICAgIHVzZGMuYXBwcm92ZShhMi5jb21wb3VuZCwgYW1vdW50LnZhbHVlKTtcbiAgICBjb21wb3VuZC5zdXBwbHkoYTIudXNkYywgYW1vdW50LnZhbHVlKTtcbiAgICBjb25zdCBjYWxscyA9IHNlc3Npb24uZmluaXNoKCk7XG4gICAgY29uc3QgeyBjaGFpbk5hbWUsIHJlbW90ZUFkZHJlc3MgfSA9IHNyYztcbiAgICBjb25zdCBheGVsYXJJZCA9IGN0eC5heGVsYXJJZHNbY2hhaW5OYW1lXTtcbiAgICBjb25zdCB0YXJnZXQgPSB7IGF4ZWxhcklkLCByZW1vdGVBZGRyZXNzIH07XG4gICAgYXdhaXQgc2VuZEdNUENvbnRyYWN0Q2FsbCh0YXJnZXQsIGNhbGxzLCBmZWUsIGxjYSwgZ21wQ2hhaW4pO1xuICB9LFxuICB3aXRoZHJhdzogYXN5bmMgKGN0eCwgYW1vdW50LCBkZXN0LCBjbGFpbSkgPT4ge1xuICAgIGNvbnN0IHsgYWRkcmVzc2VzOiBhMiwgbGNhLCBnbXBDaGFpbiwgZ21wRmVlOiBmZWUgfSA9IGN0eDtcbiAgICBjb25zdCBzZXNzaW9uID0gbWFrZUVWTVNlc3Npb24oKTtcbiAgICBpZiAoY2xhaW0pIHtcbiAgICAgIGNvbnN0IGNvbXBvdW5kUmV3YXJkc0NvbnRyb2xsZXIgPSBzZXNzaW9uLm1ha2VDb250cmFjdChcbiAgICAgICAgYTIuY29tcG91bmRSZXdhcmRzQ29udHJvbGxlcixcbiAgICAgICAgQ29tcG91bmRSZXdhcmRzQ29udHJvbGxlclxuICAgICAgKTtcbiAgICAgIGNvbXBvdW5kUmV3YXJkc0NvbnRyb2xsZXIuY2xhaW0oYTIuY29tcG91bmQsIGRlc3QucmVtb3RlQWRkcmVzcywgdHJ1ZSk7XG4gICAgfVxuICAgIGNvbnN0IGNvbXBvdW5kID0gc2Vzc2lvbi5tYWtlQ29udHJhY3QoYTIuY29tcG91bmQsIENvbXBvdW5kKTtcbiAgICBjb21wb3VuZC53aXRoZHJhdyhhMi51c2RjLCBhbW91bnQudmFsdWUpO1xuICAgIGNvbnN0IGNhbGxzID0gc2Vzc2lvbi5maW5pc2goKTtcbiAgICBjb25zdCB7IGNoYWluTmFtZSwgcmVtb3RlQWRkcmVzcyB9ID0gZGVzdDtcbiAgICBjb25zdCBheGVsYXJJZCA9IGN0eC5heGVsYXJJZHNbY2hhaW5OYW1lXTtcbiAgICBjb25zdCB0YXJnZXQgPSB7IGF4ZWxhcklkLCByZW1vdGVBZGRyZXNzIH07XG4gICAgYXdhaXQgc2VuZEdNUENvbnRyYWN0Q2FsbCh0YXJnZXQsIGNhbGxzLCBmZWUsIGxjYSwgZ21wQ2hhaW4pO1xuICB9XG59O1xudmFyIEJlZWZ5VmF1bHQgPSB7XG4gIGRlcG9zaXQ6IFtcInVpbnQyNTZcIl0sXG4gIHdpdGhkcmF3OiBbXCJ1aW50MjU2XCJdXG59O1xudmFyIEJlZWZ5UHJvdG9jb2wgPSB7XG4gIHByb3RvY29sOiBcIkJlZWZ5XCIsXG4gIGNoYWluczoga2V5czQoQXhlbGFyQ2hhaW4pLFxuICBzdXBwbHk6IGFzeW5jIChjdHgsIGFtb3VudCwgc3JjKSA9PiB7XG4gICAgY29uc3QgeyBhZGRyZXNzZXM6IGEyLCBsY2EsIGdtcENoYWluLCBnbXBGZWU6IGZlZSwgcG9vbEtleSB9ID0gY3R4O1xuICAgIGNvbnN0IHNlc3Npb24gPSBtYWtlRVZNU2Vzc2lvbigpO1xuICAgIGNvbnN0IHVzZGMgPSBzZXNzaW9uLm1ha2VDb250cmFjdChhMi51c2RjLCBFUkMyMCk7XG4gICAgY29uc3QgdmF1bHRBZGRyZXNzID0gYTJbcG9vbEtleV0gfHwgYXNzZXJ0LmZhaWwocmVkYWN0ZWRgQmVlZnkgcG9vbCBrZXkgJHtxdW90ZShwb29sS2V5KX0gbm90IGZvdW5kIGluIGFkZHJlc3Nlc2ApO1xuICAgIGNvbnN0IHZhdWx0ID0gc2Vzc2lvbi5tYWtlQ29udHJhY3QodmF1bHRBZGRyZXNzLCBCZWVmeVZhdWx0KTtcbiAgICB1c2RjLmFwcHJvdmUodmF1bHRBZGRyZXNzLCBhbW91bnQudmFsdWUpO1xuICAgIHZhdWx0LmRlcG9zaXQoYW1vdW50LnZhbHVlKTtcbiAgICBjb25zdCBjYWxscyA9IHNlc3Npb24uZmluaXNoKCk7XG4gICAgY29uc3QgeyBjaGFpbk5hbWUsIHJlbW90ZUFkZHJlc3MgfSA9IHNyYztcbiAgICBjb25zdCBheGVsYXJJZCA9IGN0eC5heGVsYXJJZHNbY2hhaW5OYW1lXTtcbiAgICBjb25zdCB0YXJnZXQgPSB7IGF4ZWxhcklkLCByZW1vdGVBZGRyZXNzIH07XG4gICAgYXdhaXQgc2VuZEdNUENvbnRyYWN0Q2FsbCh0YXJnZXQsIGNhbGxzLCBmZWUsIGxjYSwgZ21wQ2hhaW4pO1xuICB9LFxuICB3aXRoZHJhdzogYXN5bmMgKGN0eCwgYW1vdW50LCBkZXN0KSA9PiB7XG4gICAgY29uc3QgeyBhZGRyZXNzZXM6IGEyLCBsY2EsIGdtcENoYWluLCBnbXBGZWU6IGZlZSwgcG9vbEtleSB9ID0gY3R4O1xuICAgIGNvbnN0IHNlc3Npb24gPSBtYWtlRVZNU2Vzc2lvbigpO1xuICAgIGNvbnN0IHZhdWx0QWRkcmVzcyA9IGEyW3Bvb2xLZXldIHx8IGFzc2VydC5mYWlsKHJlZGFjdGVkYEJlZWZ5IHBvb2wga2V5ICR7cXVvdGUocG9vbEtleSl9IG5vdCBmb3VuZCBpbiBhZGRyZXNzZXNgKTtcbiAgICBjb25zdCB2YXVsdCA9IHNlc3Npb24ubWFrZUNvbnRyYWN0KHZhdWx0QWRkcmVzcywgQmVlZnlWYXVsdCk7XG4gICAgdmF1bHQud2l0aGRyYXcoYW1vdW50LnZhbHVlKTtcbiAgICBjb25zdCBjYWxscyA9IHNlc3Npb24uZmluaXNoKCk7XG4gICAgY29uc3QgeyBjaGFpbk5hbWUsIHJlbW90ZUFkZHJlc3MgfSA9IGRlc3Q7XG4gICAgY29uc3QgYXhlbGFySWQgPSBjdHguYXhlbGFySWRzW2NoYWluTmFtZV07XG4gICAgY29uc3QgdGFyZ2V0ID0geyBheGVsYXJJZCwgcmVtb3RlQWRkcmVzcyB9O1xuICAgIGF3YWl0IHNlbmRHTVBDb250cmFjdENhbGwodGFyZ2V0LCBjYWxscywgZmVlLCBsY2EsIGdtcENoYWluKTtcbiAgfVxufTtcblxuLy9cbnZhciBWYXVsdFR5cGU7XG4hZnVuY3Rpb24oZTIpIHtcbiAgZTJbZTIuVU5TUEVDSUZJRUQgPSAwXSA9IFwiVU5TUEVDSUZJRURcIiwgZTJbZTIuU1RBS0VEID0gMV0gPSBcIlNUQUtFRFwiLCBlMltlMi5GTEVYSUJMRSA9IDJdID0gXCJGTEVYSUJMRVwiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShWYXVsdFR5cGUgfHwgKFZhdWx0VHlwZSA9IHt9KSk7XG5mdW5jdGlvbiB2YXVsdFR5cGVGcm9tSlNPTihlMikge1xuICBzd2l0Y2ggKGUyKSB7XG4gICAgY2FzZSAwOlxuICAgIGNhc2UgXCJVTlNQRUNJRklFRFwiOlxuICAgICAgcmV0dXJuIFZhdWx0VHlwZS5VTlNQRUNJRklFRDtcbiAgICBjYXNlIDE6XG4gICAgY2FzZSBcIlNUQUtFRFwiOlxuICAgICAgcmV0dXJuIFZhdWx0VHlwZS5TVEFLRUQ7XG4gICAgY2FzZSAyOlxuICAgIGNhc2UgXCJGTEVYSUJMRVwiOlxuICAgICAgcmV0dXJuIFZhdWx0VHlwZS5GTEVYSUJMRTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIFZhdWx0VHlwZS5VTlJFQ09HTklaRUQ7XG4gIH1cbn1cbmZ1bmN0aW9uIHZhdWx0VHlwZVRvSlNPTihlMikge1xuICBzd2l0Y2ggKGUyKSB7XG4gICAgY2FzZSBWYXVsdFR5cGUuVU5TUEVDSUZJRUQ6XG4gICAgICByZXR1cm4gXCJVTlNQRUNJRklFRFwiO1xuICAgIGNhc2UgVmF1bHRUeXBlLlNUQUtFRDpcbiAgICAgIHJldHVybiBcIlNUQUtFRFwiO1xuICAgIGNhc2UgVmF1bHRUeXBlLkZMRVhJQkxFOlxuICAgICAgcmV0dXJuIFwiRkxFWElCTEVcIjtcbiAgICBjYXNlIFZhdWx0VHlwZS5VTlJFQ09HTklaRUQ6XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBcIlVOUkVDT0dOSVpFRFwiO1xuICB9XG59XG52YXIgUGF1c2VkVHlwZTtcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5OT05FID0gMF0gPSBcIk5PTkVcIiwgZTJbZTIuTE9DSyA9IDFdID0gXCJMT0NLXCIsIGUyW2UyLlVOTE9DSyA9IDJdID0gXCJVTkxPQ0tcIiwgZTJbZTIuQUxMID0gM10gPSBcIkFMTFwiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShQYXVzZWRUeXBlIHx8IChQYXVzZWRUeXBlID0ge30pKTtcblxuLy9cbnZhciBNc2dMb2NrID0geyB0eXBlVXJsOiBcIi9ub2JsZS5kb2xsYXIudmF1bHRzLnYxLk1zZ0xvY2tcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuc2lnbmVyICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLnNpZ25lciksIDAgIT09IGUyLnZhdWx0ICYmIG8yLnVpbnQzMigxNikuaW50MzIoZTIudmF1bHQpLCBcIlwiICE9PSBlMi5hbW91bnQgJiYgbzIudWludDMyKDI2KS5zdHJpbmcoZTIuYW1vdW50KSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgczMgPSB2b2lkIDAgPT09IG8yID8gdDUubGVuIDogdDUucG9zICsgbzI7XG4gIGNvbnN0IG4yID0geyBzaWduZXI6IFwiXCIsIHZhdWx0OiAwLCBhbW91bnQ6IFwiXCIgfTtcbiAgZm9yICg7IHQ1LnBvcyA8IHMzOyApIHtcbiAgICBjb25zdCBlMyA9IHQ1LnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgbjIuc2lnbmVyID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBuMi52YXVsdCA9IHQ1LmludDMyKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBuMi5hbW91bnQgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbjI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBzaWduZXI6IGlzU2V0KGUyLnNpZ25lcikgPyBTdHJpbmcoZTIuc2lnbmVyKSA6IFwiXCIsIHZhdWx0OiBpc1NldChlMi52YXVsdCkgPyB2YXVsdFR5cGVGcm9tSlNPTihlMi52YXVsdCkgOiAtMSwgYW1vdW50OiBpc1NldChlMi5hbW91bnQpID8gU3RyaW5nKGUyLmFtb3VudCkgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuc2lnbmVyICYmIChvMi5zaWduZXIgPSBlMi5zaWduZXIpLCB2b2lkIDAgIT09IGUyLnZhdWx0ICYmIChvMi52YXVsdCA9IHZhdWx0VHlwZVRvSlNPTihlMi52YXVsdCkpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiAobzIuYW1vdW50ID0gZTIuYW1vdW50KSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgc2lnbmVyOiBcIlwiLCB2YXVsdDogMCwgYW1vdW50OiBcIlwiIH07XG4gIHJldHVybiBvMi5zaWduZXIgPSBlMi5zaWduZXIgPz8gXCJcIiwgbzIudmF1bHQgPSBlMi52YXVsdCA/PyAwLCBvMi5hbW91bnQgPSBlMi5hbW91bnQgPz8gXCJcIiwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gTXNnTG9jay5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IE1zZ0xvY2suZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9ub2JsZS5kb2xsYXIudmF1bHRzLnYxLk1zZ0xvY2tcIiwgdmFsdWU6IE1zZ0xvY2suZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIE1zZ1VubG9jayA9IHsgdHlwZVVybDogXCIvbm9ibGUuZG9sbGFyLnZhdWx0cy52MS5Nc2dVbmxvY2tcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuc2lnbmVyICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLnNpZ25lciksIDAgIT09IGUyLnZhdWx0ICYmIG8yLnVpbnQzMigxNikuaW50MzIoZTIudmF1bHQpLCBcIlwiICE9PSBlMi5hbW91bnQgJiYgbzIudWludDMyKDI2KS5zdHJpbmcoZTIuYW1vdW50KSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgczMgPSB2b2lkIDAgPT09IG8yID8gdDUubGVuIDogdDUucG9zICsgbzI7XG4gIGNvbnN0IG4yID0geyBzaWduZXI6IFwiXCIsIHZhdWx0OiAwLCBhbW91bnQ6IFwiXCIgfTtcbiAgZm9yICg7IHQ1LnBvcyA8IHMzOyApIHtcbiAgICBjb25zdCBlMyA9IHQ1LnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgbjIuc2lnbmVyID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBuMi52YXVsdCA9IHQ1LmludDMyKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBuMi5hbW91bnQgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbjI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBzaWduZXI6IGlzU2V0KGUyLnNpZ25lcikgPyBTdHJpbmcoZTIuc2lnbmVyKSA6IFwiXCIsIHZhdWx0OiBpc1NldChlMi52YXVsdCkgPyB2YXVsdFR5cGVGcm9tSlNPTihlMi52YXVsdCkgOiAtMSwgYW1vdW50OiBpc1NldChlMi5hbW91bnQpID8gU3RyaW5nKGUyLmFtb3VudCkgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuc2lnbmVyICYmIChvMi5zaWduZXIgPSBlMi5zaWduZXIpLCB2b2lkIDAgIT09IGUyLnZhdWx0ICYmIChvMi52YXVsdCA9IHZhdWx0VHlwZVRvSlNPTihlMi52YXVsdCkpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiAobzIuYW1vdW50ID0gZTIuYW1vdW50KSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgc2lnbmVyOiBcIlwiLCB2YXVsdDogMCwgYW1vdW50OiBcIlwiIH07XG4gIHJldHVybiBvMi5zaWduZXIgPSBlMi5zaWduZXIgPz8gXCJcIiwgbzIudmF1bHQgPSBlMi52YXVsdCA/PyAwLCBvMi5hbW91bnQgPSBlMi5hbW91bnQgPz8gXCJcIiwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gTXNnVW5sb2NrLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gTXNnVW5sb2NrLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvbm9ibGUuZG9sbGFyLnZhdWx0cy52MS5Nc2dVbmxvY2tcIiwgdmFsdWU6IE1zZ1VubG9jay5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG5mdW5jdGlvbiBpMigpIHtcbiAgcmV0dXJuIHsgcG9vbElkOiBCaWdJbnQoMCksIGRlbm9tVG86IFwiXCIgfTtcbn1cbnZhciBSb3V0ZSA9IHsgdHlwZVVybDogXCIvbm9ibGUuc3dhcC52MS5Sb3V0ZVwiLCBlbmNvZGU6IChvMiwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChvMi5wb29sSWQgIT09IEJpZ0ludCgwKSAmJiBlMi51aW50MzIoOCkudWludDY0KG8yLnBvb2xJZCksIFwiXCIgIT09IG8yLmRlbm9tVG8gJiYgZTIudWludDMyKDE4KS5zdHJpbmcobzIuZGVub21UbyksIGUyKSwgZGVjb2RlKG8yLCB0NSkge1xuICBjb25zdCBuMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IGQgPSB2b2lkIDAgPT09IHQ1ID8gbjIubGVuIDogbjIucG9zICsgdDU7XG4gIGNvbnN0IHI1ID0gaTIoKTtcbiAgZm9yICg7IG4yLnBvcyA8IGQ7ICkge1xuICAgIGNvbnN0IG8zID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5wb29sSWQgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LmRlbm9tVG8gPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgbzMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyBwb29sSWQ6IGlzU2V0KG8yLnBvb2xJZCkgPyBCaWdJbnQobzIucG9vbElkLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBkZW5vbVRvOiBpc1NldChvMi5kZW5vbVRvKSA/IFN0cmluZyhvMi5kZW5vbVRvKSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5wb29sSWQgJiYgKGUyLnBvb2xJZCA9IChvMi5wb29sSWQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBvMi5kZW5vbVRvICYmIChlMi5kZW5vbVRvID0gbzIuZGVub21UbyksIGUyO1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgZTIgPSBpMigpO1xuICByZXR1cm4gZTIucG9vbElkID0gdm9pZCAwICE9PSBvMi5wb29sSWQgJiYgbnVsbCAhPT0gbzIucG9vbElkID8gQmlnSW50KG8yLnBvb2xJZC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgZTIuZGVub21UbyA9IG8yLmRlbm9tVG8gPz8gXCJcIiwgZTI7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUm91dGUuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBSb3V0ZS5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL25vYmxlLnN3YXAudjEuUm91dGVcIiwgdmFsdWU6IFJvdXRlLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBBbGdvcml0aG07XG4hZnVuY3Rpb24oRTIpIHtcbiAgRTJbRTIuVU5TUEVDSUZJRUQgPSAwXSA9IFwiVU5TUEVDSUZJRURcIiwgRTJbRTIuU1RBQkxFU1dBUCA9IDFdID0gXCJTVEFCTEVTV0FQXCIsIEUyW0UyLlBFUkZFQ1RQUklDRSA9IDJdID0gXCJQRVJGRUNUUFJJQ0VcIiwgRTJbRTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0oQWxnb3JpdGhtIHx8IChBbGdvcml0aG0gPSB7fSkpO1xuXG4vL1xuZnVuY3Rpb24gcDMoKSB7XG4gIHJldHVybiB7IHNpZ25lcjogXCJcIiwgYW1vdW50OiBDb2luLmZyb21QYXJ0aWFsKHt9KSwgcm91dGVzOiBbXSwgbWluOiBDb2luLmZyb21QYXJ0aWFsKHt9KSB9O1xufVxudmFyIE1zZ1N3YXAgPSB7IHR5cGVVcmw6IFwiL25vYmxlLnN3YXAudjEuTXNnU3dhcFwiLCBlbmNvZGUoZTIsIHI1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIFwiXCIgIT09IGUyLnNpZ25lciAmJiByNS51aW50MzIoMTApLnN0cmluZyhlMi5zaWduZXIpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBDb2luLmVuY29kZShlMi5hbW91bnQsIHI1LnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgZm9yIChjb25zdCBvMiBvZiBlMi5yb3V0ZXMpIFJvdXRlLmVuY29kZShvMiwgcjUudWludDMyKDI2KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5taW4gJiYgQ29pbi5lbmNvZGUoZTIubWluLCByNS51aW50MzIoMzQpLmZvcmsoKSkubGRlbGltKCksIHI1O1xufSwgZGVjb2RlKGUyLCByNSkge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHQ1ID0gdm9pZCAwID09PSByNSA/IG4yLmxlbiA6IG4yLnBvcyArIHI1O1xuICBjb25zdCBhMiA9IHAzKCk7XG4gIGZvciAoOyBuMi5wb3MgPCB0NTsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGEyLnNpZ25lciA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgYTIuYW1vdW50ID0gQ29pbi5kZWNvZGUobjIsIG4yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGEyLnJvdXRlcy5wdXNoKFJvdXRlLmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGEyLm1pbiA9IENvaW4uZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGEyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgc2lnbmVyOiBpc1NldChlMi5zaWduZXIpID8gU3RyaW5nKGUyLnNpZ25lcikgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KGUyLmFtb3VudCkgPyBDb2luLmZyb21KU09OKGUyLmFtb3VudCkgOiB2b2lkIDAsIHJvdXRlczogQXJyYXkuaXNBcnJheShlMj8ucm91dGVzKSA/IGUyLnJvdXRlcy5tYXAoKG8yKSA9PiBSb3V0ZS5mcm9tSlNPTihvMikpIDogW10sIG1pbjogaXNTZXQoZTIubWluKSA/IENvaW4uZnJvbUpTT04oZTIubWluKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHI1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLnNpZ25lciAmJiAocjUuc2lnbmVyID0gZTIuc2lnbmVyKSwgdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgKHI1LmFtb3VudCA9IGUyLmFtb3VudCA/IENvaW4udG9KU09OKGUyLmFtb3VudCkgOiB2b2lkIDApLCBlMi5yb3V0ZXMgPyByNS5yb3V0ZXMgPSBlMi5yb3V0ZXMubWFwKChvMikgPT4gbzIgPyBSb3V0ZS50b0pTT04obzIpIDogdm9pZCAwKSA6IHI1LnJvdXRlcyA9IFtdLCB2b2lkIDAgIT09IGUyLm1pbiAmJiAocjUubWluID0gZTIubWluID8gQ29pbi50b0pTT04oZTIubWluKSA6IHZvaWQgMCksIHI1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgcjUgPSBwMygpO1xuICByZXR1cm4gcjUuc2lnbmVyID0gZTIuc2lnbmVyID8/IFwiXCIsIHI1LmFtb3VudCA9IHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIG51bGwgIT09IGUyLmFtb3VudCA/IENvaW4uZnJvbVBhcnRpYWwoZTIuYW1vdW50KSA6IHZvaWQgMCwgcjUucm91dGVzID0gZTIucm91dGVzPy5tYXAoKG8yKSA9PiBSb3V0ZS5mcm9tUGFydGlhbChvMikpIHx8IFtdLCByNS5taW4gPSB2b2lkIDAgIT09IGUyLm1pbiAmJiBudWxsICE9PSBlMi5taW4gPyBDb2luLmZyb21QYXJ0aWFsKGUyLm1pbikgOiB2b2lkIDAsIHI1O1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IE1zZ1N3YXAuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBNc2dTd2FwLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvbm9ibGUuc3dhcC52MS5Nc2dTd2FwXCIsIHZhbHVlOiBNc2dTd2FwLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciB7IGFkZDogYWRkNCB9ID0gQW1vdW50TWF0aDtcbnZhciB0cmFjZTEzID0gbWFrZVRyYWNlcihcIlVTRE5GXCIpO1xudmFyIG1ha2VTd2FwTG9ja01lc3NhZ2VzID0gKG5vYmxlQWRkciwgdXNkY0luLCB7XG4gIHBvb2xJZCA9IDBuLFxuICBkZW5vbSA9IFwidXVzZGNcIixcbiAgZGVub21UbyA9IFwidXVzZG5cIixcbiAgdmF1bHQgPSB2b2lkIDAsXG4gIHVzZG5PdXQgPSB2b2lkIDBcbn0gPSB7fSkgPT4ge1xuICBjb25zdCBtc2dTd2FwID0gTXNnU3dhcC5mcm9tUGFydGlhbCh7XG4gICAgc2lnbmVyOiBub2JsZUFkZHIudmFsdWUsXG4gICAgYW1vdW50OiB7IGRlbm9tLCBhbW91bnQ6IGAke3VzZGNJbn1gIH0sXG4gICAgcm91dGVzOiBbeyBwb29sSWQsIGRlbm9tVG8gfV0sXG4gICAgbWluOiB7IGRlbm9tOiBkZW5vbVRvLCBhbW91bnQ6IGAke3VzZG5PdXQgfHwgdXNkY0lufWAgfVxuICB9KTtcbiAgaWYgKHZhdWx0ID09PSB2b2lkIDApIHtcbiAgICBjb25zdCBwcm90b01lc3NhZ2VzMiA9IFtBbnkudG9KU09OKE1zZ1N3YXAudG9Qcm90b01zZyhtc2dTd2FwKSldO1xuICAgIHJldHVybiB7IG1zZ1N3YXAsIHByb3RvTWVzc2FnZXM6IHByb3RvTWVzc2FnZXMyIH07XG4gIH1cbiAgY29uc3QgbXNnTG9jayA9IE1zZ0xvY2suZnJvbVBhcnRpYWwoe1xuICAgIHNpZ25lcjogbm9ibGVBZGRyLnZhbHVlLFxuICAgIHZhdWx0LFxuICAgIGFtb3VudDogYCR7dXNkbk91dH1gXG4gIH0pO1xuICBjb25zdCBwcm90b01lc3NhZ2VzID0gW1xuICAgIEFueS50b0pTT04oTXNnU3dhcC50b1Byb3RvTXNnKG1zZ1N3YXApKSxcbiAgICBBbnkudG9KU09OKE1zZ0xvY2sudG9Qcm90b01zZyhtc2dMb2NrKSlcbiAgXTtcbiAgcmV0dXJuIHsgbXNnU3dhcCwgbXNnTG9jaywgcHJvdG9NZXNzYWdlcyB9O1xufTtcbnZhciBtYWtlVW5sb2NrU3dhcE1lc3NhZ2VzID0gKG5vYmxlQWRkciwgdXNkY091dCwge1xuICBwb29sSWQgPSAwbixcbiAgZGVub20gPSBcInV1c2RuXCIsXG4gIGRlbm9tVG8gPSBcInV1c2RjXCIsXG4gIHZhdWx0ID0gMSxcbiAgLy9cbiAgdXNkbk91dCA9IHZvaWQgMFxufSA9IHt9KSA9PiB7XG4gIGNvbnN0IG1zZ1N3YXAgPSBNc2dTd2FwLmZyb21QYXJ0aWFsKHtcbiAgICBzaWduZXI6IG5vYmxlQWRkci52YWx1ZSxcbiAgICBhbW91bnQ6IHsgZGVub20sIGFtb3VudDogYCR7dXNkbk91dCB8fCB1c2RjT3V0fWAgfSxcbiAgICByb3V0ZXM6IFt7IHBvb2xJZCwgZGVub21UbyB9XSxcbiAgICBtaW46IHsgZGVub206IGRlbm9tVG8sIGFtb3VudDogYCR7dXNkbk91dCB8fCB1c2RjT3V0fWAgfVxuICB9KTtcbiAgaWYgKHVzZG5PdXQgPT09IHZvaWQgMCkge1xuICAgIGNvbnN0IHByb3RvTWVzc2FnZXMyID0gW0FueS50b0pTT04oTXNnU3dhcC50b1Byb3RvTXNnKG1zZ1N3YXApKV07XG4gICAgcmV0dXJuIHsgbXNnU3dhcCwgcHJvdG9NZXNzYWdlczogcHJvdG9NZXNzYWdlczIgfTtcbiAgfVxuICBjb25zdCBtc2dVbmxvY2sgPSBNc2dVbmxvY2suZnJvbVBhcnRpYWwoe1xuICAgIHNpZ25lcjogbm9ibGVBZGRyLnZhbHVlLFxuICAgIHZhdWx0LFxuICAgIGFtb3VudDogYCR7dXNkbk91dH1gXG4gIH0pO1xuICBjb25zdCBwcm90b01lc3NhZ2VzID0gW1xuICAgIEFueS50b0pTT04oTXNnVW5sb2NrLnRvUHJvdG9Nc2cobXNnVW5sb2NrKSksXG4gICAgQW55LnRvSlNPTihNc2dTd2FwLnRvUHJvdG9Nc2cobXNnU3dhcCkpXG4gIF07XG4gIHJldHVybiB7IG1zZ1VubG9jaywgbXNnU3dhcCwgcHJvdG9NZXNzYWdlcyB9O1xufTtcbnZhciBwcm90b2NvbFVTRE4gPSB7XG4gIHByb3RvY29sOiBcIlVTRE5cIixcbiAgY2hhaW5zOiBbXCJub2JsZVwiXSxcbiAgc3VwcGx5OiBhc3luYyAoY3R4LCBhbW91bnQsIHNyYykgPT4ge1xuICAgIGNvbnN0IHsgdXNkbk91dCwgdmF1bHQgfSA9IGN0eDtcbiAgICBjb25zdCB7IGljYSB9ID0gc3JjO1xuICAgIGNvbnN0IG5vYmxlQWRkciA9IGljYS5nZXRBZGRyZXNzKCk7XG4gICAgY29uc3QgeyBtc2dTd2FwLCBtc2dMb2NrLCBwcm90b01lc3NhZ2VzIH0gPSBtYWtlU3dhcExvY2tNZXNzYWdlcyhcbiAgICAgIG5vYmxlQWRkcixcbiAgICAgIGFtb3VudC52YWx1ZSxcbiAgICAgIHsgdXNkbk91dCwgdmF1bHQgfVxuICAgICk7XG4gICAgdHJhY2UxMyhcImV4ZWN1dGluZ1wiLCBbbXNnU3dhcCwgbXNnTG9ja10uZmlsdGVyKEJvb2xlYW4pKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpY2EuZXhlY3V0ZUVuY29kZWRUeChwcm90b01lc3NhZ2VzKTtcbiAgICB0cmFjZTEzKFwic3VwcGx5IHJlc3VsdFwiLCByZXN1bHQpO1xuICB9LFxuICB3aXRoZHJhdzogYXN5bmMgKGN0eCwgYW1vdW50LCBkZXN0LCBjbGFpbSkgPT4ge1xuICAgIGlmIChjbGFpbSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY2xhaW1pbmcgVVNETiBpcyBub3Qgc3VwcG9ydGVkXCIpO1xuICAgIH1cbiAgICBjb25zdCB7IHVzZG5PdXQgfSA9IGN0eDtcbiAgICBjb25zdCB7IGljYSB9ID0gZGVzdDtcbiAgICBjb25zdCBhZGRyZXNzID0gaWNhLmdldEFkZHJlc3MoKTtcbiAgICBjb25zdCB7IG1zZ1VubG9jaywgbXNnU3dhcCwgcHJvdG9NZXNzYWdlcyB9ID0gbWFrZVVubG9ja1N3YXBNZXNzYWdlcyhcbiAgICAgIGFkZHJlc3MsXG4gICAgICBhbW91bnQudmFsdWUsXG4gICAgICB7IHVzZG5PdXQgfVxuICAgICk7XG4gICAgdHJhY2UxMyhcImV4ZWN1dGluZ1wiLCBbbXNnVW5sb2NrLCBtc2dTd2FwXS5maWx0ZXIoQm9vbGVhbikpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGljYS5leGVjdXRlRW5jb2RlZFR4KHByb3RvTWVzc2FnZXMpO1xuICAgIHRyYWNlMTMoXCJ3aXRoZHJhdyByZXN1bHRcIiwgcmVzdWx0KTtcbiAgfVxufTtcbmhhcmRlbihwcm90b2NvbFVTRE4pO1xudmFyIGFnb3JpY1RvTm9ibGUgPSB7XG4gIGhvdzogXCJJQkMgdG8gTm9ibGVcIixcbiAgY29ubmVjdGlvbnM6IFt7IHNyYzogXCJhZ29yaWNcIiwgZGVzdDogXCJub2JsZVwiIH1dLFxuICBhcHBseTogYXN5bmMgKGN0eCwgYW1vdW50LCBzcmMsIGRlc3QpID0+IHtcbiAgICBjb25zdCB7IGRlbm9tIH0gPSBjdHgudXNkYztcbiAgICBjb25zdCBkZW5vbUFtb3VudCA9IHsgdmFsdWU6IGFtb3VudC52YWx1ZSwgZGVub20gfTtcbiAgICBhd2FpdCBzcmMubGNhLnRyYW5zZmVyKGRlc3QuaWNhLmdldEFkZHJlc3MoKSwgZGVub21BbW91bnQpO1xuICB9LFxuICByZWNvdmVyOiBhc3luYyAoY3R4LCBhbW91bnQsIHNyYywgZGVzdCkgPT4ge1xuICAgIGNvbnN0IG5vYmxlQW1vdW50ID0geyB2YWx1ZTogYW1vdW50LnZhbHVlLCBkZW5vbTogXCJ1dXNkY1wiIH07XG4gICAgYXdhaXQgZGVzdC5pY2EudHJhbnNmZXIoc3JjLmxjYS5nZXRBZGRyZXNzKCksIG5vYmxlQW1vdW50KTtcbiAgfVxufTtcbmhhcmRlbihhZ29yaWNUb05vYmxlKTtcbnZhciBub2JsZVRvQWdvcmljID0ge1xuICBob3c6IFwiSUJDIGZyb20gTm9ibGVcIixcbiAgY29ubmVjdGlvbnM6IFt7IHNyYzogXCJub2JsZVwiLCBkZXN0OiBcImFnb3JpY1wiIH1dLFxuICBhcHBseTogYXN5bmMgKF9jdHgsIGFtb3VudCwgc3JjLCBkZXN0KSA9PiB7XG4gICAgY29uc3Qgbm9ibGVBbW91bnQgPSB7IHZhbHVlOiBhbW91bnQudmFsdWUsIGRlbm9tOiBcInV1c2RjXCIgfTtcbiAgICBhd2FpdCBzcmMuaWNhLnRyYW5zZmVyKGRlc3QubGNhLmdldEFkZHJlc3MoKSwgbm9ibGVBbW91bnQpO1xuICB9LFxuICByZWNvdmVyOiBhc3luYyAoY3R4LCBhbW91bnQsIHNyYywgZGVzdCkgPT4ge1xuICAgIGNvbnN0IHsgZGVub20gfSA9IGN0eC51c2RjO1xuICAgIGNvbnN0IGRlbm9tQW1vdW50ID0geyB2YWx1ZTogYW1vdW50LnZhbHVlLCBkZW5vbSB9O1xuICAgIGF3YWl0IGRlc3QubGNhLnRyYW5zZmVyKHNyYy5pY2EuZ2V0QWRkcmVzcygpLCBkZW5vbUFtb3VudCk7XG4gIH1cbn07XG5oYXJkZW4oYWdvcmljVG9Ob2JsZSk7XG5cbi8vXG52YXIgeyBrZXlzOiBrZXlzNSwgdmFsdWVzOiB2YWx1ZXM3IH0gPSBPYmplY3Q7XG52YXIgc2VhdEtleXdvcmRzID0gW1wiQ2FzaFwiLCBcIkRlcG9zaXRcIl07XG5oYXJkZW4oc2VhdEtleXdvcmRzKTtcbnZhciBBc3NldFBsYWNlUmVmU2hhcGUgPSBNLm9yKFxuICAuLi5zZWF0S2V5d29yZHMubWFwKChrdykgPT4gYDwke2t3fT5gKSxcbiAgLi4udmFsdWVzNyhTdXBwb3J0ZWRDaGFpbikubWFwKChjMikgPT4gYEAke2MyfWApLFxuICAuLi5rZXlzNShQb29sUGxhY2VzKVxuKTtcbnZhciBhY2NvdW50UmVmUGF0dGVybiA9IC9eQCg/PGNoYWluPlxcdyspJC87XG52YXIgZ2V0Q2hhaW5OYW1lT2ZQbGFjZVJlZiA9IChyZWYpID0+IHtcbiAgY29uc3QgbTIgPSByZWYubWF0Y2goYWNjb3VudFJlZlBhdHRlcm4pO1xuICBjb25zdCBjaGFpbiA9IG0yPy5ncm91cHM/LmNoYWluO1xuICBpZiAoIWNoYWluKSByZXR1cm4gdm9pZCAwO1xuICBhc3NlcnQoa2V5czUoU3VwcG9ydGVkQ2hhaW4pLmluY2x1ZGVzKGNoYWluKSwgYGJhZCByZWY6ICR7cmVmfWApO1xuICByZXR1cm4gY2hhaW47XG59O1xudmFyIHNlYXRSZWZQYXR0ZXJuID0gL148KD88a2V5d29yZD5cXHcrKT4kLztcbnZhciBnZXRLZXl3b3JkT2ZQbGFjZVJlZiA9IChyZWYpID0+IHtcbiAgY29uc3QgbTIgPSByZWYubWF0Y2goc2VhdFJlZlBhdHRlcm4pO1xuICBjb25zdCBrZXl3b3JkID0gbTI/Lmdyb3Vwcz8ua2V5d29yZDtcbiAgaWYgKCFrZXl3b3JkKSByZXR1cm4gdm9pZCAwO1xuICBhc3NlcnQoc2VhdEtleXdvcmRzLmluY2x1ZGVzKGtleXdvcmQpLCBgYmFkIHJlZjogJHtyZWZ9YCk7XG4gIHJldHVybiBrZXl3b3JkO1xufTtcbnZhciBtYWtlT2ZmZXJBcmdzU2hhcGVzID0gKHVzZGNCcmFuZCkgPT4ge1xuICBjb25zdCB1c2RjQW1vdW50U2hhcGUgPSBtYWtlTmF0QW1vdW50U2hhcGUodXNkY0JyYW5kLCAxbik7XG4gIGNvbnN0IG1vdmVtZW50RGVzY1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAgICB7XG4gICAgICBhbW91bnQ6IHVzZGNBbW91bnRTaGFwZSxcbiAgICAgIHNyYzogQXNzZXRQbGFjZVJlZlNoYXBlLFxuICAgICAgZGVzdDogQXNzZXRQbGFjZVJlZlNoYXBlXG4gICAgfSxcbiAgICB7XG4gICAgICBmZWU6IEFueU5hdEFtb3VudFNoYXBlLFxuICAgICAgZGV0YWlsOiBNLnJlY29yZE9mKE0uc3RyaW5nKCksIE0ubmF0KCkpLFxuICAgICAgY2xhaW06IE0uYm9vbGVhbigpXG4gICAgfSxcbiAgICB7fVxuICApO1xuICByZXR1cm4ge1xuICAgIG9wZW5Qb3J0Zm9saW86IE0uc3BsaXRSZWNvcmQoXG4gICAgICB7fSxcbiAgICAgIHtcbiAgICAgICAgZmxvdzogTS5hcnJheU9mKG1vdmVtZW50RGVzY1NoYXBlLCB7IGFycmF5TGVuZ3RoTGltaXQ6IDEyIH0pLFxuICAgICAgICBkZXN0aW5hdGlvbkVWTUNoYWluOiBNLm9yKC4uLmtleXM1KEF4ZWxhckNoYWluKSksXG4gICAgICAgIHRhcmdldEFsbG9jYXRpb246IFRhcmdldEFsbG9jYXRpb25TaGFwZVxuICAgICAgfSxcbiAgICAgIHt9XG4gICAgKSxcbiAgICByZWJhbGFuY2U6IE0uc3BsaXRSZWNvcmQoXG4gICAgICB7fSxcbiAgICAgIHtcbiAgICAgICAgZmxvdzogTS5hcnJheU9mKG1vdmVtZW50RGVzY1NoYXBlKSxcbiAgICAgICAgdGFyZ2V0QWxsb2NhdGlvbjogVGFyZ2V0QWxsb2NhdGlvblNoYXBlXG4gICAgICB9LFxuICAgICAge31cbiAgICApXG4gIH07XG59O1xuaGFyZGVuKG1ha2VPZmZlckFyZ3NTaGFwZXMpO1xuXG4vL1xudmFyIHRyYWNlMTQgPSBtYWtlVHJhY2VyKFwiUG9ydEZcIik7XG52YXIgeyBrZXlzOiBrZXlzNiB9ID0gT2JqZWN0O1xudmFyIHBsYWNlTGFiZWwgPSAocGxhY2UpID0+IHtcbiAgaWYgKFwicG9zXCIgaW4gcGxhY2UpIHJldHVybiBwbGFjZS5wb3MuZ2V0UG9vbEtleSgpO1xuICBpZiAoXCJhY2NvdW50XCIgaW4gcGxhY2UpIHJldHVybiBjb2VyY2VBY2NvdW50SWQocGxhY2UuYWNjb3VudC5nZXRBZGRyZXNzKCkpO1xuICBpZiAoXCJwcm94eVwiIGluIHBsYWNlKVxuICAgIHJldHVybiBgJHtwbGFjZS5wcm94eS5jaGFpbklkfToke3BsYWNlLnByb3h5LnJlbW90ZUFkZHJlc3N9YDtcbiAgcmV0dXJuIGBzZWF0OiR7cGxhY2Uua2V5d29yZH1gO1xufTtcbnZhciBtb3ZlU3RhdHVzID0gKHsgaG93LCBzcmMsIGRlc3QsIGFtb3VudCB9KSA9PiAoe1xuICBob3csXG4gIHNyYzogcGxhY2VMYWJlbChzcmMpLFxuICBkZXN0OiBwbGFjZUxhYmVsKGRlc3QpLFxuICBhbW91bnRcbn0pO1xudmFyIGVycm1zZyA9IChlcnIpID0+IFwibWVzc2FnZVwiIGluIGVyciA/IGVyci5tZXNzYWdlIDogYCR7ZXJyfWA7XG52YXIgdHJhY2tGbG93ID0gYXN5bmMgKHJlcG9ydGVyLCB0b2RvKSA9PiB7XG4gIGNvbnN0IGZsb3dJZCA9IHJlcG9ydGVyLmFsbG9jYXRlRmxvd0lkKCk7XG4gIGxldCBzdGVwID0gMTtcbiAgY29uc3QgbW92ZXMgPSBbXTtcbiAgdHJ5IHtcbiAgICBmb3IgKGNvbnN0IG1ha2VNb3ZlIG9mIHRvZG8pIHtcbiAgICAgIGNvbnN0IG1vdmUgPSBhd2FpdCBtYWtlTW92ZSgpO1xuICAgICAgbW92ZXMucHVzaChtb3ZlKTtcbiAgICAgIHRyYWNlMTQoc3RlcCwgXCJzdGVwIHN0YXJ0aW5nXCIsIG1vdmVTdGF0dXMobW92ZSkpO1xuICAgICAgcmVwb3J0ZXIucHVibGlzaEZsb3dTdGF0dXMoZmxvd0lkLCB7IHN0ZXAsIC4uLm1vdmVTdGF0dXMobW92ZSkgfSk7XG4gICAgICBhd2FpdCBtb3ZlLmFwcGx5KCk7XG4gICAgICB0cmFjZTE0KHN0ZXAsIFwic3RlcCBkb25lXCIpO1xuICAgICAgY29uc3QgeyBhbW91bnQsIHNyYywgZGVzdCB9ID0gbW92ZTtcbiAgICAgIGlmIChcInBvc1wiIGluIHNyYykge1xuICAgICAgICBzcmMucG9zLnJlY29yZFRyYW5zZmVyT3V0KGFtb3VudCk7XG4gICAgICB9XG4gICAgICBpZiAoXCJwb3NcIiBpbiBkZXN0KSB7XG4gICAgICAgIGRlc3QucG9zLnJlY29yZFRyYW5zZmVySW4oYW1vdW50KTtcbiAgICAgIH1cbiAgICAgIHN0ZXAgKz0gMTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJcXHUyNkEwXFx1RkUwRiBzdGVwXCIsIHN0ZXAsIFwiIGZhaWxlZFwiLCBlcnIpO1xuICAgIGNvbnN0IGZhaWx1cmUgPSBtb3Zlc1tzdGVwIC0gMV07XG4gICAgY29uc3QgZXJyU3RlcCA9IHN0ZXA7XG4gICAgd2hpbGUgKHN0ZXAgPiAxKSB7XG4gICAgICBzdGVwIC09IDE7XG4gICAgICBjb25zdCBtb3ZlID0gbW92ZXNbc3RlcCAtIDFdO1xuICAgICAgY29uc3QgaG93ID0gYHVud2luZDogJHttb3ZlLmhvd31gO1xuICAgICAgcmVwb3J0ZXIucHVibGlzaEZsb3dTdGF0dXMoZmxvd0lkLCB7IHN0ZXAsIC4uLm1vdmVTdGF0dXMobW92ZSksIGhvdyB9KTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IG1vdmUucmVjb3ZlcigpO1xuICAgICAgfSBjYXRjaCAoZXJyMikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiXFx1MjZBMFxcdUZFMEYgdW53aW5kIHN0ZXBcIiwgc3RlcCwgXCIgZmFpbGVkXCIsIGVycjIpO1xuICAgICAgICBjb25zdCB7IGRlc3Q6IHdoZXJlLCAuLi5tcyB9ID0gbW92ZVN0YXR1cyhtb3ZlKTtcbiAgICAgICAgY29uc3QgZmluYWwgPSB7IHN0ZXAsIC4uLm1zLCBob3csIHdoZXJlLCBlcnJvcjogZXJybXNnKGVycjIpIH07XG4gICAgICAgIHJlcG9ydGVyLnB1Ymxpc2hGbG93U3RhdHVzKGZsb3dJZCwgZmluYWwpO1xuICAgICAgICB0aHJvdyBlcnIyO1xuICAgICAgfVxuICAgIH1cbiAgICByZXBvcnRlci5wdWJsaXNoRmxvd1N0YXR1cyhmbG93SWQsIHtcbiAgICAgIHN0ZXA6IGVyclN0ZXAsXG4gICAgICAuLi5tb3ZlU3RhdHVzKGZhaWx1cmUpLFxuICAgICAgZXJyb3I6IGVycm1zZyhlcnIpXG4gICAgfSk7XG4gICAgdGhyb3cgZXJyO1xuICB9XG59O1xudmFyIHByb3ZpZGVDb3Ntb3NBY2NvdW50ID0gYXN5bmMgKG9yY2gsIGNoYWluTmFtZSwga2l0KSA9PiB7XG4gIGF3YWl0IG51bGw7XG4gIGxldCBwcm9taXNlTWF5YmUgPSBraXQubWFuYWdlci5yZXNlcnZlQWNjb3VudChjaGFpbk5hbWUpO1xuICBpZiAocHJvbWlzZU1heWJlKSB7XG4gICAgcmV0dXJuIHByb21pc2VNYXliZTtcbiAgfVxuICBzd2l0Y2ggKGNoYWluTmFtZSkge1xuICAgIGNhc2UgXCJub2JsZVwiOiB7XG4gICAgICBjb25zdCBub2JsZUNoYWluID0gYXdhaXQgb3JjaC5nZXRDaGFpbihcIm5vYmxlXCIpO1xuICAgICAgY29uc3QgaWNhID0gYXdhaXQgbm9ibGVDaGFpbi5tYWtlQWNjb3VudCgpO1xuICAgICAgY29uc3QgaW5mbyA9IHtcbiAgICAgICAgbmFtZXNwYWNlOiBcImNvc21vc1wiLFxuICAgICAgICBjaGFpbk5hbWU6IFwibm9ibGVcIixcbiAgICAgICAgaWNhXG4gICAgICB9O1xuICAgICAga2l0Lm1hbmFnZXIucmVzb2x2ZUFjY291bnQoaW5mbyk7XG4gICAgICByZXR1cm4gaW5mbztcbiAgICB9XG4gICAgY2FzZSBcImFnb3JpY1wiOiB7XG4gICAgICBjb25zdCBhZ29yaWNDaGFpbiA9IGF3YWl0IG9yY2guZ2V0Q2hhaW4oXCJhZ29yaWNcIik7XG4gICAgICBjb25zdCBsY2EgPSBhd2FpdCBhZ29yaWNDaGFpbi5tYWtlQWNjb3VudCgpO1xuICAgICAgY29uc3QgcmVnID0gYXdhaXQgbGNhLm1vbml0b3JUcmFuc2ZlcnMoa2l0LnRhcCk7XG4gICAgICB0cmFjZTE0KFwiTW9uaXRvcmluZyB0cmFuc2ZlcnMgZm9yXCIsIGxjYS5nZXRBZGRyZXNzKCkudmFsdWUpO1xuICAgICAgY29uc3QgaW5mbyA9IHtcbiAgICAgICAgbmFtZXNwYWNlOiBcImNvc21vc1wiLFxuICAgICAgICBjaGFpbk5hbWUsXG4gICAgICAgIGxjYSxcbiAgICAgICAgcmVnXG4gICAgICB9O1xuICAgICAga2l0Lm1hbmFnZXIucmVzb2x2ZUFjY291bnQoaW5mbyk7XG4gICAgICByZXR1cm4gaW5mbztcbiAgICB9XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IEVycm9yKFwidW5yZWFjaGFibGVcIik7XG4gIH1cbn07XG52YXIgZ2V0QXNzZXRQbGFjZVJlZktpbmQgPSAocmVmKSA9PiB7XG4gIGlmIChrZXlzNihQb29sUGxhY2VzKS5pbmNsdWRlcyhyZWYpKSByZXR1cm4gXCJwb3NcIjtcbiAgaWYgKGdldEtleXdvcmRPZlBsYWNlUmVmKHJlZikpIHJldHVybiBcInNlYXRcIjtcbiAgaWYgKGdldENoYWluTmFtZU9mUGxhY2VSZWYocmVmKSkgcmV0dXJuIFwiYWNjb3VudElkXCI7XG4gIHRocm93IHRocm93UmVkYWN0ZWRgYmFkIHJlZjogJHtyZWZ9YDtcbn07XG52YXIgd2F5RnJvbVNyY1RvRGVzYyA9IChtb3ZlRGVzYykgPT4ge1xuICBjb25zdCB7IHNyYyB9ID0gbW92ZURlc2M7XG4gIGNvbnN0IHsgZGVzdCB9ID0gbW92ZURlc2M7XG4gIGNvbnN0IHNyY0tpbmQgPSBnZXRBc3NldFBsYWNlUmVmS2luZChzcmMpO1xuICBzd2l0Y2ggKHNyY0tpbmQpIHtcbiAgICBjYXNlIFwicG9zXCI6IHtcbiAgICAgIGNvbnN0IGRlc3ROYW1lID0gZ2V0Q2hhaW5OYW1lT2ZQbGFjZVJlZihkZXN0KTtcbiAgICAgIGlmICghZGVzdE5hbWUpXG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgc3JjIHBvcyBtdXN0IGhhdmUgYWNjb3VudCBhcyBkZXN0ICR7cXVvdGUobW92ZURlc2MpfWA7XG4gICAgICBjb25zdCBwb29sS2V5ID0gc3JjO1xuICAgICAgY29uc3QgeyBwcm90b2NvbCB9ID0gUG9vbFBsYWNlc1twb29sS2V5XTtcbiAgICAgIGNvbnN0IGZlZVJlcXVpcmVkID0gW1wiQ29tcG91bmRcIiwgXCJBYXZlXCIsIFwiQmVlZnlcIl07XG4gICAgICBtb3ZlRGVzYy5mZWUgfHwgIWZlZVJlcXVpcmVkLmluY2x1ZGVzKHByb3RvY29sKSB8fCB0aHJvd1JlZGFjdGVkYG1pc3NpbmcgZmVlICR7cXVvdGUobW92ZURlc2MpfWA7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBob3c6IHByb3RvY29sLFxuICAgICAgICBwb29sS2V5LFxuICAgICAgICBkZXN0OiBkZXN0TmFtZSxcbiAgICAgICAgY2xhaW06IG1vdmVEZXNjLmNsYWltXG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwic2VhdFwiOlxuICAgICAgZ2V0QXNzZXRQbGFjZVJlZktpbmQoZGVzdCkgPT09IFwiYWNjb3VudElkXCIgfHwgLy9cbiAgICAgIHRocm93UmVkYWN0ZWRgc3JjIHNlYXQgbXVzdCBoYXZlIGFjY291bnQgYXMgZGVzdCAke3F1b3RlKG1vdmVEZXNjKX1gO1xuICAgICAgcmV0dXJuIHsgaG93OiBcImxvY2FsVHJhbnNmZXJcIiB9O1xuICAgIGNhc2UgXCJhY2NvdW50SWRcIjoge1xuICAgICAgY29uc3Qgc3JjTmFtZSA9IGdldENoYWluTmFtZU9mUGxhY2VSZWYoc3JjKTtcbiAgICAgIGFzc2VydDIoc3JjTmFtZSk7XG4gICAgICBjb25zdCBkZXN0S2luZCA9IGdldEFzc2V0UGxhY2VSZWZLaW5kKGRlc3QpO1xuICAgICAgc3dpdGNoIChkZXN0S2luZCkge1xuICAgICAgICBjYXNlIFwic2VhdFwiOlxuICAgICAgICAgIHJldHVybiB7IGhvdzogXCJ3aXRoZHJhd1RvU2VhdFwiIH07XG4gICAgICAgIC8vXG4gICAgICAgIGNhc2UgXCJhY2NvdW50SWRcIjpcbiAgICAgICAgICBjb25zdCBkZXN0TmFtZSA9IGdldENoYWluTmFtZU9mUGxhY2VSZWYoZGVzdCk7XG4gICAgICAgICAgYXNzZXJ0MihkZXN0TmFtZSk7XG4gICAgICAgICAgaWYgKGtleXM2KEF4ZWxhckNoYWluKS5pbmNsdWRlcyhkZXN0TmFtZSkpIHtcbiAgICAgICAgICAgIHNyY05hbWUgPT09IFwibm9ibGVcIiB8fCB0aHJvd1JlZGFjdGVkYHNyYyBmb3IgJHtxdW90ZShkZXN0TmFtZSl9IG11c3QgYmUgbm9ibGVgO1xuICAgICAgICAgICAgcmV0dXJuIHsgaG93OiBcIkNDVFBcIiwgZGVzdDogZGVzdE5hbWUgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGtleXM2KEF4ZWxhckNoYWluKS5pbmNsdWRlcyhzcmNOYW1lKSkge1xuICAgICAgICAgICAgZGVzdE5hbWUgPT09IFwibm9ibGVcIiB8fCB0aHJvd1JlZGFjdGVkYGRlc3QgZm9yICR7cXVvdGUoc3JjTmFtZSl9IG11c3QgYmUgbm9ibGVgO1xuICAgICAgICAgICAgcmV0dXJuIHsgaG93OiBcIkNDVFBcIiwgc3JjOiBzcmNOYW1lIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzcmNOYW1lID09PSBcImFnb3JpY1wiICYmIGRlc3ROYW1lID09PSBcIm5vYmxlXCIpIHtcbiAgICAgICAgICAgIHJldHVybiB7IGhvdzogXCJJQkNcIiwgc3JjOiBzcmNOYW1lLCBkZXN0OiBkZXN0TmFtZSB9O1xuICAgICAgICAgIH0gZWxzZSBpZiAoc3JjTmFtZSA9PT0gXCJub2JsZVwiICYmIGRlc3ROYW1lID09PSBcImFnb3JpY1wiKSB7XG4gICAgICAgICAgICByZXR1cm4geyBob3c6IFwiSUJDXCIsIHNyYzogc3JjTmFtZSwgZGVzdDogZGVzdE5hbWUgfTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBubyByb3V0ZSBiZXR3ZWVuIGNoYWluczogJHtxdW90ZShtb3ZlRGVzYyl9YDtcbiAgICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJwb3NcIjoge1xuICAgICAgICAgIGNvbnN0IHBvb2xLZXkgPSBkZXN0O1xuICAgICAgICAgIGNvbnN0IHsgcHJvdG9jb2wgfSA9IFBvb2xQbGFjZXNbcG9vbEtleV07XG4gICAgICAgICAgcmV0dXJuIHsgaG93OiBwcm90b2NvbCwgcG9vbEtleSwgc3JjOiBzcmNOYW1lIH07XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVucmVhY2hhYmxlOiR7ZGVzdEtpbmR9ICR7ZGVzdH1gO1xuICAgICAgfVxuICAgIH1cbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bnJlYWNoYWJsZTogJHtzcmNLaW5kfSAke3NyY31gO1xuICB9XG59O1xudmFyIHN0ZXBGbG93ID0gYXN5bmMgKG9yY2gsIGN0eCwgc2VhdCwgbW92ZXMsIGtpdCkgPT4ge1xuICBjb25zdCB0b2RvID0gW107XG4gIGNvbnN0IHByb3ZpZGVFVk1JbmZvID0gYXN5bmMgKGNoYWluLCBtb3ZlKSA9PiB7XG4gICAgY29uc3QgYXhlbGFyID0gYXdhaXQgb3JjaC5nZXRDaGFpbihcImF4ZWxhclwiKTtcbiAgICBjb25zdCB7IGRlbm9tIH0gPSBjdHguZ21wRmVlSW5mbztcbiAgICBjb25zdCBmZWUgPSB7IGRlbm9tLCB2YWx1ZTogbW92ZS5mZWUgPyBtb3ZlLmZlZS52YWx1ZSA6IDBuIH07XG4gICAgY29uc3QgeyBheGVsYXJJZHMgfSA9IGN0eDtcbiAgICBjb25zdCBnbXAgPSB7IGNoYWluOiBheGVsYXIsIGZlZTogbW92ZS5mZWU/LnZhbHVlIHx8IDBuLCBheGVsYXJJZHMgfTtcbiAgICBjb25zdCB7IGxjYSB9ID0gYXdhaXQgcHJvdmlkZUNvc21vc0FjY291bnQob3JjaCwgXCJhZ29yaWNcIiwga2l0KTtcbiAgICBjb25zdCBnSW5mbyA9IGF3YWl0IHByb3ZpZGVFVk1BY2NvdW50KGNoYWluLCBnbXAsIGxjYSwgY3R4LCBraXQpO1xuICAgIGNvbnN0IGFjY291bnRJZCA9IGAke2dJbmZvLmNoYWluSWR9OiR7Z0luZm8ucmVtb3RlQWRkcmVzc31gO1xuICAgIGNvbnN0IGV2bUN0eCA9IGhhcmRlbih7XG4gICAgICBhZGRyZXNzZXM6IGN0eC5jb250cmFjdHNbY2hhaW5dLFxuICAgICAgbGNhLFxuICAgICAgZ21wRmVlOiBmZWUsXG4gICAgICBnbXBDaGFpbjogYXhlbGFyLFxuICAgICAgYXhlbGFySWRzXG4gICAgfSk7XG4gICAgcmV0dXJuIHsgZXZtQ3R4LCBnSW5mbywgYWNjb3VudElkIH07XG4gIH07XG4gIGNvbnN0IG1ha2VFVk1Qcm90b2NvbFN0ZXAgPSBhc3luYyAod2F5LCBtb3ZlKSA9PiB7XG4gICAgY29uc3QgY2hhaW5OYW1lID0gXCJzcmNcIiBpbiB3YXkgPyB3YXkuc3JjIDogd2F5LmRlc3Q7XG4gICAgYXNzZXJ0MihrZXlzNihBeGVsYXJDaGFpbikuaW5jbHVkZXMoY2hhaW5OYW1lKSk7XG4gICAgY29uc3QgZXZtQ2hhaW4gPSBjaGFpbk5hbWU7XG4gICAgY29uc3QgcHJvdG9jb2xJbXBsTWFwID0ge1xuICAgICAgQ29tcG91bmQ6IENvbXBvdW5kUHJvdG9jb2wsXG4gICAgICBBYXZlOiBBYXZlUHJvdG9jb2wsXG4gICAgICBCZWVmeTogQmVlZnlQcm90b2NvbFxuICAgIH07XG4gICAgY29uc3QgcEltcGwgPSBwcm90b2NvbEltcGxNYXBbd2F5Lmhvd107XG4gICAgY29uc3QgeyBldm1DdHgsIGdJbmZvLCBhY2NvdW50SWQgfSA9IGF3YWl0IHByb3ZpZGVFVk1JbmZvKGV2bUNoYWluLCBtb3ZlKTtcbiAgICBjb25zdCBwb3MgPSBraXQubWFuYWdlci5wcm92aWRlUG9zaXRpb24od2F5LnBvb2xLZXksIHdheS5ob3csIGFjY291bnRJZCk7XG4gICAgY29uc3QgeyBhbW91bnQgfSA9IG1vdmU7XG4gICAgY29uc3QgY3R4MiA9IHsgLi4uZXZtQ3R4LCBwb29sS2V5OiB3YXkucG9vbEtleSB9O1xuICAgIGlmIChcInNyY1wiIGluIHdheSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaG93OiB3YXkuaG93LFxuICAgICAgICBhbW91bnQsXG4gICAgICAgIHNyYzogeyBwcm94eTogZ0luZm8gfSxcbiAgICAgICAgZGVzdDogeyBwb3MgfSxcbiAgICAgICAgYXBwbHk6ICgpID0+IHBJbXBsLnN1cHBseShjdHgyLCBhbW91bnQsIGdJbmZvKSxcbiAgICAgICAgcmVjb3ZlcjogKCkgPT4gYXNzZXJ0Mi5mYWlsKFwibGFzdCBzdGVwLiBjYW5ub3QgcmVjb3ZlclwiKVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaG93OiB3YXkuaG93LFxuICAgICAgICBhbW91bnQsXG4gICAgICAgIHNyYzogeyBwb3MgfSxcbiAgICAgICAgZGVzdDogeyBwcm94eTogZ0luZm8gfSxcbiAgICAgICAgYXBwbHk6ICgpID0+IHBJbXBsLndpdGhkcmF3KGN0eDIsIGFtb3VudCwgZ0luZm8sIHdheS5jbGFpbSksXG4gICAgICAgIHJlY292ZXI6ICgpID0+IHBJbXBsLnN1cHBseShjdHgyLCBhbW91bnQsIGdJbmZvKVxuICAgICAgfTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHByb3ZpZGVBZ29yaWNOb2JsZSA9ICgpID0+IFByb21pc2UuYWxsKFtcbiAgICBwcm92aWRlQ29zbW9zQWNjb3VudChvcmNoLCBcImFnb3JpY1wiLCBraXQpLFxuICAgIHByb3ZpZGVDb3Ntb3NBY2NvdW50KG9yY2gsIFwibm9ibGVcIiwga2l0KVxuICBdKTtcbiAgZm9yIChjb25zdCBtb3ZlIG9mIG1vdmVzKSB7XG4gICAgdHJhY2UxNChcIndheUZyb21TcmNUb0Rlc2M/XCIsIG1vdmUpO1xuICAgIGNvbnN0IHdheSA9IHdheUZyb21TcmNUb0Rlc2MobW92ZSk7XG4gICAgY29uc3QgeyBhbW91bnQgfSA9IG1vdmU7XG4gICAgc3dpdGNoICh3YXkuaG93KSB7XG4gICAgICBjYXNlIFwibG9jYWxUcmFuc2ZlclwiOiB7XG4gICAgICAgIGNvbnN0IHsgZ2l2ZSB9ID0gc2VhdC5nZXRQcm9wb3NhbCgpO1xuICAgICAgICBjb25zdCBhbW91bnRzID0gaGFyZGVuKHtcbiAgICAgICAgICBEZXBvc2l0OiBhbW91bnQsXG4gICAgICAgICAgLi4uKFwiR21wRmVlXCJpbiBnaXZlID8geyBHbXBGZWU6IGdpdmUuR21wRmVlIH0gOiB7fSlcbiAgICAgICAgfSk7XG4gICAgICAgIHRvZG8ucHVzaChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBsY2EgfSA9IGF3YWl0IHByb3ZpZGVDb3Ntb3NBY2NvdW50KG9yY2gsIFwiYWdvcmljXCIsIGtpdCk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGhvdzogXCJsb2NhbFRyYW5zZmVyXCIsXG4gICAgICAgICAgICBzcmM6IHsgc2VhdCwga2V5d29yZDogXCJEZXBvc2l0XCIgfSxcbiAgICAgICAgICAgIGRlc3Q6IHsgYWNjb3VudDogbGNhIH0sXG4gICAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgYXBwbHk6IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgYXdhaXQgY3R4LnpvZVRvb2xzLmxvY2FsVHJhbnNmZXIoc2VhdCwgbGNhLCBhbW91bnRzKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZWNvdmVyOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgIGF3YWl0IGN0eC56b2VUb29scy53aXRoZHJhd1RvU2VhdChsY2EsIHNlYXQsIGFtb3VudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ3aXRoZHJhd1RvU2VhdFwiOiB7XG4gICAgICAgIGNvbnN0IGFtb3VudHMgPSB7IENhc2g6IGFtb3VudCB9O1xuICAgICAgICB0b2RvLnB1c2goYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgbGNhIH0gPSBhd2FpdCBwcm92aWRlQ29zbW9zQWNjb3VudChvcmNoLCBcImFnb3JpY1wiLCBraXQpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBob3c6IFwid2l0aGRyYXdUb1NlYXRcIixcbiAgICAgICAgICAgIHNyYzogeyBhY2NvdW50OiBsY2EgfSxcbiAgICAgICAgICAgIGRlc3Q6IHsgc2VhdCwga2V5d29yZDogXCJDYXNoXCIgfSxcbiAgICAgICAgICAgIGFtb3VudCxcbiAgICAgICAgICAgIGFwcGx5OiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgIGF3YWl0IGN0eC56b2VUb29scy53aXRoZHJhd1RvU2VhdChsY2EsIHNlYXQsIGFtb3VudHMpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlY292ZXI6IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgYXdhaXQgY3R4LnpvZVRvb2xzLmxvY2FsVHJhbnNmZXIoc2VhdCwgbGNhLCBhbW91bnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiSUJDXCI6IHtcbiAgICAgICAgaWYgKHdheS5zcmMgPT09IFwiYWdvcmljXCIgJiYgd2F5LmRlc3QgPT09IFwibm9ibGVcIikge1xuICAgICAgICAgIGNvbnN0IHsgaG93LCBhcHBseTogYXBwbHk5LCByZWNvdmVyIH0gPSBhZ29yaWNUb05vYmxlO1xuICAgICAgICAgIHRvZG8ucHVzaChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBbYUluZm8sIG5JbmZvXSA9IGF3YWl0IHByb3ZpZGVBZ29yaWNOb2JsZSgpO1xuICAgICAgICAgICAgY29uc3QgY3R4SSA9IHsgdXNkYzogY3R4LnVzZGMgfTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGhvdyxcbiAgICAgICAgICAgICAgYW1vdW50LFxuICAgICAgICAgICAgICBzcmM6IHsgYWNjb3VudDogYUluZm8ubGNhIH0sXG4gICAgICAgICAgICAgIGRlc3Q6IHsgYWNjb3VudDogbkluZm8uaWNhIH0sXG4gICAgICAgICAgICAgIGFwcGx5OiAoKSA9PiBhcHBseTkoY3R4SSwgYW1vdW50LCBhSW5mbywgbkluZm8pLFxuICAgICAgICAgICAgICByZWNvdmVyOiAoKSA9PiByZWNvdmVyKGN0eEksIGFtb3VudCwgYUluZm8sIG5JbmZvKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICh3YXkuc3JjID09PSBcIm5vYmxlXCIgJiYgd2F5LmRlc3QgPT09IFwiYWdvcmljXCIpIHtcbiAgICAgICAgICBjb25zdCB7IGhvdywgYXBwbHk6IGFwcGx5OSwgcmVjb3ZlciB9ID0gbm9ibGVUb0Fnb3JpYztcbiAgICAgICAgICB0b2RvLnB1c2goYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgW2FJbmZvLCBuSW5mb10gPSBhd2FpdCBwcm92aWRlQWdvcmljTm9ibGUoKTtcbiAgICAgICAgICAgIGNvbnN0IGN0eEkgPSB7IHVzZGM6IGN0eC51c2RjIH07XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBob3csXG4gICAgICAgICAgICAgIGFtb3VudCxcbiAgICAgICAgICAgICAgc3JjOiB7IGFjY291bnQ6IG5JbmZvLmljYSB9LFxuICAgICAgICAgICAgICBkZXN0OiB7IGFjY291bnQ6IGFJbmZvLmxjYSB9LFxuICAgICAgICAgICAgICBhcHBseTogKCkgPT4gYXBwbHk5KGN0eEksIGFtb3VudCwgbkluZm8sIGFJbmZvKSxcbiAgICAgICAgICAgICAgcmVjb3ZlcjogKCkgPT4gcmVjb3ZlcihjdHhJLCBhbW91bnQsIG5JbmZvLCBhSW5mbylcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiQ0NUUFwiOiB7XG4gICAgICAgIHRvZG8ucHVzaChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBob3csIGFwcGx5OiBhcHBseTksIHJlY292ZXIgfSA9IENDVFA7XG4gICAgICAgICAgY29uc3QgW3sgbGNhIH0sIG5JbmZvLCBheGVsYXJdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgcHJvdmlkZUNvc21vc0FjY291bnQob3JjaCwgXCJhZ29yaWNcIiwga2l0KSxcbiAgICAgICAgICAgIHByb3ZpZGVDb3Ntb3NBY2NvdW50KG9yY2gsIFwibm9ibGVcIiwga2l0KSxcbiAgICAgICAgICAgIG9yY2guZ2V0Q2hhaW4oXCJheGVsYXJcIilcbiAgICAgICAgICBdKTtcbiAgICAgICAgICBjb25zdCBldm1DaGFpbiA9IFwiZGVzdFwiIGluIHdheSA/IHdheS5kZXN0IDogd2F5LnNyYztcbiAgICAgICAgICBjb25zdCB7IGV2bUN0eCwgZ0luZm8gfSA9IGF3YWl0IHByb3ZpZGVFVk1JbmZvKGV2bUNoYWluLCBtb3ZlKTtcbiAgICAgICAgICBpZiAoXCJkZXN0XCIgaW4gd2F5KSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBob3c6IENDVFAuaG93LFxuICAgICAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgICAgIHNyYzogeyBhY2NvdW50OiBuSW5mby5pY2EgfSxcbiAgICAgICAgICAgICAgZGVzdDogeyBwcm94eTogZ0luZm8gfSxcbiAgICAgICAgICAgICAgYXBwbHk6ICgpID0+IENDVFAuYXBwbHkobnVsbCwgYW1vdW50LCBuSW5mbywgZ0luZm8pLFxuICAgICAgICAgICAgICByZWNvdmVyOiAoKSA9PiBDQ1RQLnJlY292ZXIobnVsbCwgYW1vdW50LCBuSW5mbywgZ0luZm8pXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBob3c6IENDVFBmcm9tRVZNLmhvdyxcbiAgICAgICAgICAgICAgYW1vdW50LFxuICAgICAgICAgICAgICBzcmM6IHsgcHJveHk6IGdJbmZvIH0sXG4gICAgICAgICAgICAgIGRlc3Q6IHsgYWNjb3VudDogbkluZm8uaWNhIH0sXG4gICAgICAgICAgICAgIGFwcGx5OiAoKSA9PiBDQ1RQZnJvbUVWTS5hcHBseShldm1DdHgsIGFtb3VudCwgZ0luZm8sIG5JbmZvKSxcbiAgICAgICAgICAgICAgcmVjb3ZlcjogKCkgPT4gQ0NUUGZyb21FVk0ucmVjb3Zlcihldm1DdHgsIGFtb3VudCwgZ0luZm8sIG5JbmZvKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJVU0ROXCI6IHtcbiAgICAgICAgdG9kby5wdXNoKGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCBuSW5mbyA9IGF3YWl0IHByb3ZpZGVDb3Ntb3NBY2NvdW50KG9yY2gsIFwibm9ibGVcIiwga2l0KTtcbiAgICAgICAgICBjb25zdCBhY2N0SWQgPSBjb2VyY2VBY2NvdW50SWQobkluZm8uaWNhLmdldEFkZHJlc3MoKSk7XG4gICAgICAgICAgY29uc3QgcG9zID0ga2l0Lm1hbmFnZXIucHJvdmlkZVBvc2l0aW9uKFwiVVNETlwiLCBcIlVTRE5cIiwgYWNjdElkKTtcbiAgICAgICAgICBjb25zdCB2YXVsdCA9IHdheS5wb29sS2V5ID09PSBcIlVTRE5WYXVsdFwiID8gMSA6IHZvaWQgMDtcbiAgICAgICAgICBjb25zdCBjdHhVID0geyB1c2RuT3V0OiBtb3ZlPy5kZXRhaWw/LnVzZG5PdXQsIHZhdWx0IH07XG4gICAgICAgICAgaWYgKFwic3JjXCIgaW4gd2F5KSB7XG4gICAgICAgICAgICBjb25zdCB7IHN1cHBseSB9ID0gcHJvdG9jb2xVU0ROO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgaG93OiB3YXkuaG93LFxuICAgICAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgICAgIHNyYzogeyBhY2NvdW50OiBuSW5mby5pY2EgfSxcbiAgICAgICAgICAgICAgZGVzdDogeyBwb3MgfSxcbiAgICAgICAgICAgICAgYXBwbHk6ICgpID0+IHN1cHBseShjdHhVLCBhbW91bnQsIG5JbmZvKSxcbiAgICAgICAgICAgICAgcmVjb3ZlcjogKCkgPT4gdGhyb3dSZWRhY3RlZGBubyByZWNvdmVyeSBmcm9tIHN1cHBseSAoZmluYWwgc3RlcClgXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCB7IHdpdGhkcmF3LCBzdXBwbHkgfSA9IHByb3RvY29sVVNETjtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGhvdzogd2F5LmhvdyxcbiAgICAgICAgICAgICAgYW1vdW50LFxuICAgICAgICAgICAgICBzcmM6IHsgcG9zIH0sXG4gICAgICAgICAgICAgIGRlc3Q6IHsgYWNjb3VudDogbkluZm8uaWNhIH0sXG4gICAgICAgICAgICAgIGFwcGx5OiAoKSA9PiB3aXRoZHJhdyhjdHhVLCBhbW91bnQsIG5JbmZvLCB3YXkuY2xhaW0pLFxuICAgICAgICAgICAgICByZWNvdmVyOiAoKSA9PiBzdXBwbHkoY3R4VSwgYW1vdW50LCBuSW5mbylcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiQ29tcG91bmRcIjpcbiAgICAgICAgdG9kby5wdXNoKFxuICAgICAgICAgICgpID0+IG1ha2VFVk1Qcm90b2NvbFN0ZXAod2F5LCBtb3ZlKVxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJBYXZlXCI6XG4gICAgICAgIHRvZG8ucHVzaChcbiAgICAgICAgICAoKSA9PiBtYWtlRVZNUHJvdG9jb2xTdGVwKHdheSwgbW92ZSlcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiQmVlZnlcIjpcbiAgICAgICAgdG9kby5wdXNoKFxuICAgICAgICAgICgpID0+IG1ha2VFVk1Qcm90b2NvbFN0ZXAod2F5LCBtb3ZlKVxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgdW5yZWFjaGFibGU6ICR7d2F5fWA7XG4gICAgfVxuICB9XG4gIGF3YWl0IHRyYWNrRmxvdyhraXQucmVwb3J0ZXIsIHRvZG8pO1xuICB0cmFjZTE0KFwic3RlcEZsb3cgZG9uZVwiKTtcbn07XG52YXIgcmViYWxhbmNlID0gYXN5bmMgKG9yY2gsIGN0eCwgc2VhdCwgb2ZmZXJBcmdzLCBraXQpID0+IHtcbiAgY29uc3QgcHJvcG9zYWwgPSBzZWF0LmdldFByb3Bvc2FsKCk7XG4gIHRyYWNlMTQoXCJyZWJhbGFuY2UgcHJvcG9zYWxcIiwgcHJvcG9zYWwuZ2l2ZSwgcHJvcG9zYWwud2FudCwgb2ZmZXJBcmdzKTtcbiAgdHJ5IHtcbiAgICBpZiAob2ZmZXJBcmdzLnRhcmdldEFsbG9jYXRpb24pIHtcbiAgICAgIGtpdC5tYW5hZ2VyLnNldFRhcmdldEFsbG9jYXRpb24ob2ZmZXJBcmdzLnRhcmdldEFsbG9jYXRpb24pO1xuICAgIH1cbiAgICBpZiAob2ZmZXJBcmdzLmZsb3cpIHtcbiAgICAgIGF3YWl0IHN0ZXBGbG93KG9yY2gsIGN0eCwgc2VhdCwgb2ZmZXJBcmdzLmZsb3csIGtpdCk7XG4gICAgfVxuICAgIGlmICghc2VhdC5oYXNFeGl0ZWQoKSkge1xuICAgICAgc2VhdC5leGl0KCk7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBpZiAoIXNlYXQuaGFzRXhpdGVkKCkpIHtcbiAgICAgIHNlYXQuZmFpbChlcnIpO1xuICAgIH1cbiAgICB0aHJvdyBlcnI7XG4gIH1cbn07XG52YXIgcmViYWxhbmNlRnJvbVRyYW5zZmVyID0gYXN5bmMgKG9yY2gsIGN0eCwgcGFja2V0LCBraXQpID0+IHtcbiAgYXdhaXQgbnVsbDtcbiAgY29uc3QgeyByZWFkZXIgfSA9IGtpdDtcbiAgY29uc3QgbGNhID0gcmVhZGVyLmdldExvY2FsQWNjb3VudCgpO1xuICBjb25zdCBwYXJzZWQgPSBhd2FpdCBsY2EucGFyc2VJbmJvdW5kVHJhbnNmZXIocGFja2V0KTtcbiAgaWYgKCFwYXJzZWQpIHtcbiAgICByZXR1cm4gaGFyZGVuKHsgcGFyc2VkOiBudWxsLCBoYW5kbGVkOiBmYWxzZSB9KTtcbiAgfVxuICB0cmFjZTE0KFwicmViYWxhbmNlRnJvbVRyYW5zZmVyIHBhcnNlZFwiLCBwYXJzZWQpO1xuICBjb25zdCB7XG4gICAgYW1vdW50LFxuICAgIGV4dHJhOiB7IHJlY2VpdmVyIH1cbiAgfSA9IHBhcnNlZDtcbiAgY29uc3QgeyBiYXNlQWRkcmVzcywgcXVlcnkgfSA9IGRlY29kZUFkZHJlc3NIb29rKHJlY2VpdmVyKTtcbiAgY29uc3QgeyByZWJhbGFuY2U6IHN0cmF0ZWd5IH0gPSBxdWVyeTtcbiAgaWYgKHN0cmF0ZWd5ID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gaGFyZGVuKHsgcGFyc2VkLCBoYW5kbGVkOiBmYWxzZSB9KTtcbiAgfVxuICBzd2l0Y2ggKHN0cmF0ZWd5KSB7XG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgY2FzZSBSZWJhbGFuY2VTdHJhdGVneS5QcmVzZXQ6XG4gICAgY2FzZSBSZWJhbGFuY2VTdHJhdGVneS5QcmVzZXJ2ZUV4aXN0aW5nUHJvcG9ydGlvbnM6IHtcbiAgICAgIHRyYWNlMTQoXG4gICAgICAgIFwicmViYWxhbmNlRnJvbVRyYW5zZmVyIFByZXNlcnZlRXhpc3RpbmdQcm9wb3J0aW9uc1wiLFxuICAgICAgICBhbW91bnQsXG4gICAgICAgIHF1ZXJ5LFxuICAgICAgICBiYXNlQWRkcmVzc1xuICAgICAgKTtcbiAgICAgIHRocm93IGhhcmRlbih7XG4gICAgICAgIG1zZzogXCJyZWJhbGFuY2VGcm9tVHJhbnNmZXIgdW5pbXBsZW1lbnRlZCBQcmVzZXJ2ZUV4aXN0aW5nUHJvcG9ydGlvbnMgc3RyYXRlZ3lcIixcbiAgICAgICAgYW1vdW50LFxuICAgICAgICBxdWVyeSxcbiAgICAgICAgYmFzZUFkZHJlc3NcbiAgICAgIH0pO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICB0aHJvd1JlZGFjdGVkYHVua25vd24gcmViYWxhbmNlIHN0cmF0ZWd5ICR7c3RyYXRlZ3l9IGZvciAke2Ftb3VudH0gaW4gJHtiYXNlQWRkcmVzc31gO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaGFyZGVuKHsgcGFyc2VkLCBoYW5kbGVkOiB0cnVlIH0pO1xufTtcbnZhciBvcGVuUG9ydGZvbGlvID0gYXN5bmMgKG9yY2gsIGN0eCwgc2VhdCwgb2ZmZXJBcmdzKSA9PiB7XG4gIGF3YWl0IG51bGw7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBtYWtlUG9ydGZvbGlvS2l0LCAuLi5jdHhJIH0gPSBjdHg7XG4gICAgY29uc3QgeyBpbmVydFN1YnNjcmliZXIgfSA9IGN0eEk7XG4gICAgY29uc3Qga2l0ID0gbWFrZVBvcnRmb2xpb0tpdCgpO1xuICAgIGF3YWl0IHByb3ZpZGVDb3Ntb3NBY2NvdW50KG9yY2gsIFwiYWdvcmljXCIsIGtpdCk7XG4gICAgaWYgKG9mZmVyQXJncy50YXJnZXRBbGxvY2F0aW9uKSB7XG4gICAgICBraXQubWFuYWdlci5zZXRUYXJnZXRBbGxvY2F0aW9uKG9mZmVyQXJncy50YXJnZXRBbGxvY2F0aW9uKTtcbiAgICB9XG4gICAgaWYgKCFzZWF0Lmhhc0V4aXRlZCgpKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCByZWJhbGFuY2Uob3JjaCwgY3R4SSwgc2VhdCwgb2ZmZXJBcmdzLCBraXQpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJcXHUyNkEwXFx1RkUwRiByZWJhbGFuY2UgZmFpbGVkXCIsIGVycik7XG4gICAgICAgIGlmICghc2VhdC5oYXNFeGl0ZWQoKSkgc2VhdC5mYWlsKGVycik7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghc2VhdC5oYXNFeGl0ZWQoKSkgc2VhdC5leGl0KCk7XG4gICAgY29uc3QgcHVibGljU3Vic2NyaWJlcnMgPSB7XG4gICAgICBwb3J0Zm9saW86IHtcbiAgICAgICAgZGVzY3JpcHRpb246IFwiUG9ydGZvbGlvXCIsXG4gICAgICAgIHN0b3JhZ2VQYXRoOiBhd2FpdCBraXQucmVhZGVyLmdldFN0b3JhZ2VQYXRoKCksXG4gICAgICAgIHN1YnNjcmliZXI6IGluZXJ0U3Vic2NyaWJlclxuICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICBpbnZpdGF0aW9uTWFrZXJzOiBraXQuaW52aXRhdGlvbk1ha2VycyxcbiAgICAgIHB1YmxpY1N1YnNjcmliZXJzXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJcXHV7MUY2QTh9IG9wZW5Qb3J0Zm9saW8gZmxvdyBmYWlsZWRcIiwgZXJyKTtcbiAgICB0aHJvdyBlcnI7XG4gIH1cbn07XG5oYXJkZW4ob3BlblBvcnRmb2xpbyk7XG5cbi8vXG52YXIgdHJhY2UxNSA9IG1ha2VUcmFjZXIoXCJQb3J0Q1wiKTtcbnZhciB7IGZyb21FbnRyaWVzOiBmcm9tRW50cmllczE1LCBrZXlzOiBrZXlzNyB9ID0gT2JqZWN0O1xudmFyIGludGVyZmFjZVRPRE8gPSB2b2lkIDA7XG52YXIgRVZNQ29udHJhY3RBZGRyZXNzZXNTaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBhYXZlUG9vbDogTS5zdHJpbmcoKSxcbiAgY29tcG91bmQ6IE0uc3RyaW5nKCksXG4gIGZhY3Rvcnk6IE0uc3RyaW5nKCksXG4gIHVzZGM6IE0uc3RyaW5nKClcbn0pO1xudmFyIEF4ZWxhckNvbmZpZ1BhdHRlcm4gPSBNLnNwbGl0UmVjb3JkKHtcbiAgYXhlbGFySWQ6IE0uc3RyaW5nKCksXG4gIGNoYWluSW5mbzogQ2hhaW5JbmZvU2hhcGUsXG4gIGNvbnRyYWN0czogRVZNQ29udHJhY3RBZGRyZXNzZXNTaGFwZVxufSk7XG52YXIgJGPNj19BeGVsYXJDb25maWdTaGFwZT1NLnNwbGl0UmVjb3JkKFxuICBmcm9tRW50cmllczE1KFxuICAgIGtleXM3KEF4ZWxhckNoYWluKS5tYXAoKGNoYWluKSA9PiBbY2hhaW4sIEF4ZWxhckNvbmZpZ1BhdHRlcm5dKVxuICApXG4pO0F4ZWxhckNvbmZpZ1NoYXBlPSRjzY9fQXhlbGFyQ29uZmlnU2hhcGU7XG52YXIgRVZNQ29udHJhY3RBZGRyZXNzZXNNYXAgPSBNLnNwbGl0UmVjb3JkKFxuICBmcm9tRW50cmllczE1KFxuICAgIGtleXM3KEF4ZWxhckNoYWluKS5tYXAoKGNoYWluKSA9PiBbY2hhaW4sIEVWTUNvbnRyYWN0QWRkcmVzc2VzU2hhcGVdKVxuICApXG4pO1xudmFyIEF4ZWxhcklkc1BhdHRlcm4gPSBNLnN0cmluZygpO1xudmFyIEF4ZWxhcklkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICBmcm9tRW50cmllczE1KGtleXM3KEF4ZWxhckNoYWluKS5tYXAoKGNoYWluKSA9PiBbY2hhaW4sIEF4ZWxhcklkc1BhdHRlcm5dKSlcbik7XG52YXIgcHJpdmF0ZUFyZ3NTaGFwZSA9IHtcbiAgLi4uT3JjaGVzdHJhdGlvblBvd2Vyc1NoYXBlLFxuICBtYXJzaGFsbGVyOiBNLnJlbW90YWJsZShcIm1hcnNoYWxsZXJcIiksXG4gIHN0b3JhZ2VOb2RlOiBNLnJlbW90YWJsZShcInN0b3JhZ2VOb2RlXCIpLFxuICBjaGFpbkluZm86IE0uYW5kKFxuICAgIE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgQ2hhaW5JbmZvU2hhcGUpLFxuICAgIE0uc3BsaXRSZWNvcmQoeyBhZ29yaWM6IE0uYW55KCksIG5vYmxlOiBNLmFueSgpIH0pXG4gICksXG4gIGFzc2V0SW5mbzogTS5hcnJheU9mKFtNLnN0cmluZygpLCBEZW5vbURldGFpbFNoYXBlXSksXG4gIGF4ZWxhcklkczogQXhlbGFySWRTaGFwZSxcbiAgY29udHJhY3RzOiBFVk1Db250cmFjdEFkZHJlc3Nlc01hcFxufTtcbnZhciAkY82PX21ldGE9e1xuICBwcml2YXRlQXJnc1NoYXBlXG59O21ldGE9JGPNj19tZXRhO1xuaGFyZGVuKG1ldGEpO1xudmFyICRjzY9fY29udHJhY3Q9YXN5bmMoemNmLHByaXZhdGVBcmdzLCB6b25lLCB0b29scykgPT4ge1xuICBjb25zdCB7XG4gICAgY2hhaW5JbmZvLFxuICAgIGFzc2V0SW5mbyxcbiAgICBheGVsYXJJZHMsXG4gICAgY29udHJhY3RzLFxuICAgIHRpbWVyU2VydmljZSxcbiAgICBtYXJzaGFsbGVyLFxuICAgIHN0b3JhZ2VOb2RlXG4gIH0gPSBwcml2YXRlQXJncztcbiAgY29uc3QgeyBicmFuZHMgfSA9IHpjZi5nZXRUZXJtcygpO1xuICBjb25zdCB7IG9yY2hlc3RyYXRlQWxsLCB6b2VUb29scywgY2hhaW5IdWIsIHZvd1Rvb2xzIH0gPSB0b29scztcbiAgYXNzZXJ0KGJyYW5kcy5VU0RDLCBcIlVTREMgbWlzc2luZyBmcm9tIGJyYW5kcyBpbiB0ZXJtc1wiKTtcbiAgYXNzZXJ0KGJyYW5kcy5GZWUsIFwiRmVlIG1pc3NpbmcgZnJvbSBicmFuZHMgaW4gdGVybXNcIik7XG4gIGlmICghKFwiYXhlbGFyXCIgaW4gY2hhaW5JbmZvKSkge1xuICAgIHRyYWNlMTUoXCJcXHUyNkEwXFx1RkUwRiBubyBheGVsYXIgY2hhaW5JbmZvOyBHTVAgbm90IGF2YWlsYWJsZVwiLCBPYmplY3Qua2V5cyhjaGFpbkluZm8pKTtcbiAgfVxuICByZWdpc3RlckNoYWluc0FuZEFzc2V0cyhjaGFpbkh1YiwgYnJhbmRzLCBjaGFpbkluZm8sIGFzc2V0SW5mbywge1xuICAgIGxvZzogdHJhY2UxNVxuICB9KTtcbiAgY29uc3QgcHJvcG9zYWxTaGFwZXMgPSBtYWtlUHJvcG9zYWxTaGFwZXMoXG4gICAgYnJhbmRzLlVTREMsXG4gICAgYnJhbmRzLkZlZSxcbiAgICBicmFuZHMuQWNjZXNzXG4gICk7XG4gIGNvbnN0IG9mZmVyQXJnc1NoYXBlcyA9IG1ha2VPZmZlckFyZ3NTaGFwZXMoYnJhbmRzLlVTREMpO1xuICBjb25zdCBpbmVydFN1YnNjcmliZXIgPSB7XG4gICAgZ2V0VXBkYXRlU2luY2UoKSB7XG4gICAgICBhc3NlcnQuZmFpbChcInVzZSBvZmYtY2hhaW4gcXVlcmllc1wiKTtcbiAgICB9LFxuICAgIHN1YnNjcmliZUFmdGVyKCkge1xuICAgICAgYXNzZXJ0LmZhaWwoXCJ1c2Ugb2ZmLWNoYWluIHF1ZXJpZXNcIik7XG4gICAgfVxuICB9O1xuICBjb25zdCBjdHgxID0ge1xuICAgIHpvZVRvb2xzLFxuICAgIHVzZGM6IHtcbiAgICAgIGJyYW5kOiBicmFuZHMuVVNEQyxcbiAgICAgIGRlbm9tOiBOb25OdWxsaXNoKFxuICAgICAgICBjaGFpbkh1Yi5nZXREZW5vbShicmFuZHMuVVNEQyksXG4gICAgICAgIFwibm8gZGVub20gZm9yIFVTREMgYnJhbmRcIlxuICAgICAgKVxuICAgIH0sXG4gICAgZ21wRmVlSW5mbzoge1xuICAgICAgYnJhbmQ6IGJyYW5kcy5GZWUsXG4gICAgICBkZW5vbTogTm9uTnVsbGlzaChcbiAgICAgICAgY2hhaW5IdWIuZ2V0RGVub20oYnJhbmRzLkZlZSksXG4gICAgICAgIFwibm8gZGVub20gZm9yIEZlZSBicmFuZFwiXG4gICAgICApXG4gICAgfSxcbiAgICBheGVsYXJJZHMsXG4gICAgY29udHJhY3RzXG4gIH07XG4gIGNvbnN0IHsgcmViYWxhbmNlOiByZWJhbGFuY2UyLCByZWJhbGFuY2VGcm9tVHJhbnNmZXI6IHJlYmFsYW5jZUZyb21UcmFuc2ZlcjIgfSA9IG9yY2hlc3RyYXRlQWxsKFxuICAgIHtcbiAgICAgIHJlYmFsYW5jZSxcbiAgICAgIHJlYmFsYW5jZUZyb21UcmFuc2ZlclxuICAgIH0sXG4gICAgY3R4MVxuICApO1xuICBjb25zdCBtYWtlUG9ydGZvbGlvS2l0ID0gcHJlcGFyZVBvcnRmb2xpb0tpdCh6b25lLCB7XG4gICAgemNmLFxuICAgIHZvd1Rvb2xzLFxuICAgIGF4ZWxhcklkcyxcbiAgICByZWJhbGFuY2U6IHJlYmFsYW5jZTIsXG4gICAgcmViYWxhbmNlRnJvbVRyYW5zZmVyOiByZWJhbGFuY2VGcm9tVHJhbnNmZXIyLFxuICAgIHByb3Bvc2FsU2hhcGVzLFxuICAgIG9mZmVyQXJnc1NoYXBlcyxcbiAgICB0aW1lcjogdGltZXJTZXJ2aWNlLFxuICAgIGNoYWluSHViVG9vbHM6IHsgZ2V0Q2hhaW5JbmZvOiBjaGFpbkh1Yi5nZXRDaGFpbkluZm8uYmluZChjaGFpbkh1YikgfSxcbiAgICBwb3J0Zm9saW9zTm9kZTogRShzdG9yYWdlTm9kZSkubWFrZUNoaWxkTm9kZShcInBvcnRmb2xpb3NcIiksXG4gICAgbWFyc2hhbGxlcixcbiAgICB1c2RjQnJhbmQ6IGJyYW5kcy5VU0RDXG4gIH0pO1xuICBjb25zdCBwb3J0Zm9saW9zID0gem9uZS5tYXBTdG9yZShcInBvcnRmb2xpb3NcIik7XG4gIGNvbnN0IHsgb3BlblBvcnRmb2xpbzogb3BlblBvcnRmb2xpbzIgfSA9IG9yY2hlc3RyYXRlQWxsKFxuICAgIHsgb3BlblBvcnRmb2xpbyB9LFxuICAgIHtcbiAgICAgIC4uLmN0eDEsXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIG1ha2VQb3J0Zm9saW9LaXQ6ICgpID0+IHtcbiAgICAgICAgY29uc3QgcG9ydGZvbGlvSWQgPSBwb3J0Zm9saW9zLmdldFNpemUoKTtcbiAgICAgICAgY29uc3QgaXQgPSBtYWtlUG9ydGZvbGlvS2l0KHsgcG9ydGZvbGlvSWQgfSk7XG4gICAgICAgIHBvcnRmb2xpb3MuaW5pdChwb3J0Zm9saW9JZCwgaXQpO1xuICAgICAgICByZXR1cm4gaXQ7XG4gICAgICB9LFxuICAgICAgLy9cbiAgICAgIGluZXJ0U3Vic2NyaWJlclxuICAgIH1cbiAgKTtcbiAgdHJhY2UxNShcIlhYWCBORUVEU1RFU1Q6IGJhZ2dhZ2UgdGVzdFwiKTtcbiAgY29uc3QgcHVibGljRmFjZXQgPSB6b25lLmV4byhcIlBvcnRmb2xpb1B1YlwiLCBpbnRlcmZhY2VUT0RPLCB7XG4gICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIG1ha2VPcGVuUG9ydGZvbGlvSW52aXRhdGlvbigpIHtcbiAgICAgIHRyYWNlMTUoXCJtYWtlT3BlblBvcnRmb2xpb0ludml0YXRpb25cIik7XG4gICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKFxuICAgICAgICAoc2VhdCwgb2ZmZXJBcmdzKSA9PiB7XG4gICAgICAgICAgbXVzdE1hdGNoMyhvZmZlckFyZ3MsIG9mZmVyQXJnc1NoYXBlcy5vcGVuUG9ydGZvbGlvKTtcbiAgICAgICAgICByZXR1cm4gb3BlblBvcnRmb2xpbzIoc2VhdCwgb2ZmZXJBcmdzKTtcbiAgICAgICAgfSxcbiAgICAgICAgXCJvcGVuUG9ydGZvbGlvXCIsXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgcHJvcG9zYWxTaGFwZXMub3BlblBvcnRmb2xpb1xuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4geyBwdWJsaWNGYWNldCB9O1xufTtjb250cmFjdD0kY82PX2NvbnRyYWN0O1xuaGFyZGVuKGNvbnRyYWN0KTtcbnZhciAkY82PX3N0YXJ0PXdpdGhPcmNoZXN0cmF0aW9uKGNvbnRyYWN0KTtzdGFydD0kY82PX3N0YXJ0O1xuaGFyZGVuKHN0YXJ0KTtcbn0pKClcbiIsIl9fbGl2ZUV4cG9ydE1hcF9fIjp7IkF4ZWxhckNvbmZpZ1NoYXBlIjpbIkF4ZWxhckNvbmZpZ1NoYXBlIix0cnVlXSwibWV0YSI6WyJtZXRhIix0cnVlXSwiY29udHJhY3QiOlsiY29udHJhY3QiLHRydWVdLCJzdGFydCI6WyJzdGFydCIsdHJ1ZV19LCJfX3JlZXhwb3J0TWFwX18iOnt9LCJfX2ZpeGVkRXhwb3J0TWFwX18iOnt9LCJfX25lZWRzSW1wb3J0X18iOmZhbHNlLCJfX25lZWRzSW1wb3J0TWV0YV9fIjpmYWxzZX1QSwECHgMKAAAAAAAAAAAAOB9ZD7YCAAC2AgAAFAAAAAAAAAAAAAAApIEAAAAAY29tcGFydG1lbnQtbWFwLmpzb25QSwECHgMKAAAAAAAAAAAAp+/+GHshDgB7IQ4AQgAAAAAAAAAAAAAApIHoAgAAQGFnbG9jYWwvcG9ydGZvbGlvLWRlcGxveS12MC4xLjAvZGlzdC9wb3J0Zm9saW8uY29udHJhY3QuYnVuZGxlLmpzUEsFBgAAAAACAAIAsgAAAMMkDgAAAA==","endoZipBase64Sha512":"867596e047f55dcf08bafe36e4a6719adb36421ee4718f4c94f4747771fd0e89b3bd5db4dadaff29a837181d669b61332ef2a5c67e7feb28e5377d19ee2f16fc"}