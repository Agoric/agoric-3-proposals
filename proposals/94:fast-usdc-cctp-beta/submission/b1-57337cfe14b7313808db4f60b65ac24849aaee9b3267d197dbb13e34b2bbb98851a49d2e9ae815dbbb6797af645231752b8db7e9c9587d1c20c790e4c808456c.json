{
  "moduleFormat": "endoZipBase64",
  "endoZipBase64": "UEsDBAoAAAAAAAAAAABm8ROttgIAALYCAAAUAAAAY29tcGFydG1lbnQtbWFwLmpzb257CiAgInRhZ3MiOiBbXSwKICAiZW50cnkiOiB7CiAgICAiY29tcGFydG1lbnQiOiAiQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAiLAogICAgIm1vZHVsZSI6ICIuL2Rpc3QvZmFzdC11c2RjLmNvbnRyYWN0LmJ1bmRsZS5qcyIKICB9LAogICJjb21wYXJ0bWVudHMiOiB7CiAgICAiQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAiOiB7CiAgICAgICJuYW1lIjogIkBhZ2xvY2FsL2Zhc3QtdXNkYy1kZXBsb3kiLAogICAgICAibGFiZWwiOiAiQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAiLAogICAgICAibG9jYXRpb24iOiAiQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAiLAogICAgICAibW9kdWxlcyI6IHsKICAgICAgICAiLi9kaXN0L2Zhc3QtdXNkYy5jb250cmFjdC5idW5kbGUuanMiOiB7CiAgICAgICAgICAibG9jYXRpb24iOiAiZGlzdC9mYXN0LXVzZGMuY29udHJhY3QuYnVuZGxlLmpzIiwKICAgICAgICAgICJwYXJzZXIiOiAicHJlLW1qcy1qc29uIiwKICAgICAgICAgICJzaGE1MTIiOiAiNTgzZmZlMjg0NDY3MTI5MzE3YzQ0ODkxYzFhYzQxYTVlNmJhYzFjNWYwNmQ3ZTIzZGJkNzdmOGFmZDMwYWM3NGM1M2ZmY2UxNGRmMzRiMzljNzc0Y2VhMjBkOTUzOTRjZTUzNzNmMWUwMWUyNDY1Yzc4Njk1OWQ1MDhhNDU1ODIiCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9UEsDBAoAAAAAAAAAAABj3tPb6jANAOowDQBCAAAAQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAvZGlzdC9mYXN0LXVzZGMuY29udHJhY3QuYnVuZGxlLmpzeyJpbXBvcnRzIjpbXSwiZXhwb3J0cyI6WyJjb250cmFjdCIsIm1ldGEiLCJzdGFydCJdLCJyZWV4cG9ydHMiOltdLCJfX3N5bmNNb2R1bGVQcm9ncmFtX18iOiIoe2ltcG9ydHM6JGjNj19pbXBvcnRzLGxpdmVWYXI6JGjNj19saXZlLG9uY2VWYXI6JGjNj19vbmNlLGltcG9ydDokaM2PX2ltcG9ydCxpbXBvcnRNZXRhOiRozY9fX19fbWV0YX0pPT4oZnVuY3Rpb24oKXsndXNlIHN0cmljdCc7JGjNj19pbXBvcnRzKFtdKTskaM2PX2xpdmUubWV0YSgpOyRozY9fbGl2ZS5jb250cmFjdCgpOyRozY9fbGl2ZS5zdGFydCgpO3ZhciBfX2NyZWF0ZSA9IE9iamVjdC5jcmVhdGU7XG52YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5O1xudmFyIF9fZ2V0T3duUHJvcERlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO1xudmFyIF9fZ2V0T3duUHJvcE5hbWVzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXM7XG52YXIgX19nZXRQcm90b09mID0gT2JqZWN0LmdldFByb3RvdHlwZU9mO1xudmFyIF9faGFzT3duUHJvcCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG52YXIgX19jb21tb25KUyA9IChjYiwgbW9kKSA9PiBmdW5jdGlvbiBfX3JlcXVpcmUoKSB7XG4gIHJldHVybiBtb2QgfHwgKDAsIGNiW19fZ2V0T3duUHJvcE5hbWVzKGNiKVswXV0pKChtb2QgPSB7IGV4cG9ydHM6IHt9IH0pLmV4cG9ydHMsIG1vZCksIG1vZC5leHBvcnRzO1xufTtcbnZhciBfX2V4cG9ydCA9ICh0YXJnZXQsIGFsbCkgPT4ge1xuICBmb3IgKHZhciBuYW1lIGluIGFsbClcbiAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xufTtcbnZhciBfX2NvcHlQcm9wcyA9ICh0bywgZnJvbSwgZXhjZXB0LCBkZXNjKSA9PiB7XG4gIGlmIChmcm9tICYmIHR5cGVvZiBmcm9tID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBmcm9tID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBmb3IgKGxldCBrZXkgb2YgX19nZXRPd25Qcm9wTmFtZXMoZnJvbSkpXG4gICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KVxuICAgICAgICBfX2RlZlByb3AodG8sIGtleSwgeyBnZXQ6ICgpID0+IGZyb21ba2V5XSwgZW51bWVyYWJsZTogIShkZXNjID0gX19nZXRPd25Qcm9wRGVzYyhmcm9tLCBrZXkpKSB8fCBkZXNjLmVudW1lcmFibGUgfSk7XG4gIH1cbiAgcmV0dXJuIHRvO1xufTtcbnZhciBfX3RvRVNNID0gKG1vZCwgaXNOb2RlTW9kZSwgdGFyZ2V0KSA9PiAodGFyZ2V0ID0gbW9kICE9IG51bGwgPyBfX2NyZWF0ZShfX2dldFByb3RvT2YobW9kKSkgOiB7fSwgX19jb3B5UHJvcHMoXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIGlzTm9kZU1vZGUgfHwgIW1vZCB8fCAhbW9kLl9fZXNNb2R1bGUgPyBfX2RlZlByb3AodGFyZ2V0LCBcImRlZmF1bHRcIiwgeyB2YWx1ZTogbW9kLCBlbnVtZXJhYmxlOiB0cnVlIH0pIDogdGFyZ2V0LFxuICBtb2RcbikpO1xuXG4vL1xudmFyIHJlcXVpcmVfYXNjaWkgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi9vcmNoZXN0cmF0aW9uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL2FzY2lpLmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICBleHBvcnRzLmZyb21Bc2NpaSA9IGV4cG9ydHMudG9Bc2NpaSA9IHZvaWQgMDtcbiAgICBmdW5jdGlvbiB0b0FzY2lpKGlucHV0KSB7XG4gICAgICBjb25zdCB0b051bXMgPSAoc3RyKSA9PiBzdHIuc3BsaXQoXCJcIikubWFwKCh4KSA9PiB7XG4gICAgICAgIGNvbnN0IGNoYXJDb2RlID0geC5jaGFyQ29kZUF0KDApO1xuICAgICAgICBpZiAoY2hhckNvZGUgPCAzMiB8fCBjaGFyQ29kZSA+IDEyNikge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBlbmNvZGUgY2hhcmFjdGVyIHRoYXQgaXMgb3V0IG9mIHByaW50YWJsZSBBU0NJSSByYW5nZTogXCIgKyBjaGFyQ29kZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoYXJDb2RlO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gVWludDhBcnJheS5mcm9tKHRvTnVtcyhpbnB1dCkpO1xuICAgIH1cbiAgICBleHBvcnRzLnRvQXNjaWkgPSB0b0FzY2lpO1xuICAgIGZ1bmN0aW9uIGZyb21Bc2NpaShkYXRhKSB7XG4gICAgICBjb25zdCBmcm9tTnVtcyA9IChsaXN0T2ZOdW1iZXJzKSA9PiBsaXN0T2ZOdW1iZXJzLm1hcCgoeCkgPT4ge1xuICAgICAgICBpZiAoeCA8IDMyIHx8IHggPiAxMjYpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZGVjb2RlIGNoYXJhY3RlciB0aGF0IGlzIG91dCBvZiBwcmludGFibGUgQVNDSUkgcmFuZ2U6IFwiICsgeCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoeCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBmcm9tTnVtcyhBcnJheS5mcm9tKGRhdGEpKS5qb2luKFwiXCIpO1xuICAgIH1cbiAgICBleHBvcnRzLmZyb21Bc2NpaSA9IGZyb21Bc2NpaTtcbiAgfVxufSk7XG5cbi8vXG52YXIgcmVxdWlyZV9iYXNlNjRfanMgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvYmFzZTY0LWpzL2luZGV4LmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIGV4cG9ydHMuYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGg7XG4gICAgZXhwb3J0cy50b0J5dGVBcnJheSA9IHRvQnl0ZUFycmF5O1xuICAgIGV4cG9ydHMuZnJvbUJ5dGVBcnJheSA9IGZyb21CeXRlQXJyYXk7XG4gICAgdmFyIGxvb2t1cCA9IFtdO1xuICAgIHZhciByZXZMb29rdXAgPSBbXTtcbiAgICB2YXIgQXJyID0gdHlwZW9mIFVpbnQ4QXJyYXkgIT09IFwidW5kZWZpbmVkXCIgPyBVaW50OEFycmF5IDogQXJyYXk7XG4gICAgdmFyIGNvZGUgPSBcIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky9cIjtcbiAgICBmb3IgKGkyID0gMCwgbGVuID0gY29kZS5sZW5ndGg7IGkyIDwgbGVuOyArK2kyKSB7XG4gICAgICBsb29rdXBbaTJdID0gY29kZVtpMl07XG4gICAgICByZXZMb29rdXBbY29kZS5jaGFyQ29kZUF0KGkyKV0gPSBpMjtcbiAgICB9XG4gICAgdmFyIGkyO1xuICAgIHZhciBsZW47XG4gICAgcmV2TG9va3VwW1wiLVwiLmNoYXJDb2RlQXQoMCldID0gNjI7XG4gICAgcmV2TG9va3VwW1wiX1wiLmNoYXJDb2RlQXQoMCldID0gNjM7XG4gICAgZnVuY3Rpb24gZ2V0TGVucyhiNjQpIHtcbiAgICAgIHZhciBsZW4yID0gYjY0Lmxlbmd0aDtcbiAgICAgIGlmIChsZW4yICUgNCA+IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzdHJpbmcuIExlbmd0aCBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgNFwiKTtcbiAgICAgIH1cbiAgICAgIHZhciB2YWxpZExlbiA9IGI2NC5pbmRleE9mKFwiPVwiKTtcbiAgICAgIGlmICh2YWxpZExlbiA9PT0gLTEpIHZhbGlkTGVuID0gbGVuMjtcbiAgICAgIHZhciBwbGFjZUhvbGRlcnNMZW4gPSB2YWxpZExlbiA9PT0gbGVuMiA/IDAgOiA0IC0gdmFsaWRMZW4gJSA0O1xuICAgICAgcmV0dXJuIFt2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuXTtcbiAgICB9XG4gICAgZnVuY3Rpb24gYnl0ZUxlbmd0aChiNjQpIHtcbiAgICAgIHZhciBsZW5zID0gZ2V0TGVucyhiNjQpO1xuICAgICAgdmFyIHZhbGlkTGVuID0gbGVuc1swXTtcbiAgICAgIHZhciBwbGFjZUhvbGRlcnNMZW4gPSBsZW5zWzFdO1xuICAgICAgcmV0dXJuICh2YWxpZExlbiArIHBsYWNlSG9sZGVyc0xlbikgKiAzIC8gNCAtIHBsYWNlSG9sZGVyc0xlbjtcbiAgICB9XG4gICAgZnVuY3Rpb24gX2J5dGVMZW5ndGgoYjY0LCB2YWxpZExlbiwgcGxhY2VIb2xkZXJzTGVuKSB7XG4gICAgICByZXR1cm4gKHZhbGlkTGVuICsgcGxhY2VIb2xkZXJzTGVuKSAqIDMgLyA0IC0gcGxhY2VIb2xkZXJzTGVuO1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b0J5dGVBcnJheShiNjQpIHtcbiAgICAgIHZhciB0bXA7XG4gICAgICB2YXIgbGVucyA9IGdldExlbnMoYjY0KTtcbiAgICAgIHZhciB2YWxpZExlbiA9IGxlbnNbMF07XG4gICAgICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gbGVuc1sxXTtcbiAgICAgIHZhciBhcnIgPSBuZXcgQXJyKF9ieXRlTGVuZ3RoKGI2NCwgdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbikpO1xuICAgICAgdmFyIGN1ckJ5dGUgPSAwO1xuICAgICAgdmFyIGxlbjIgPSBwbGFjZUhvbGRlcnNMZW4gPiAwID8gdmFsaWRMZW4gLSA0IDogdmFsaWRMZW47XG4gICAgICB2YXIgaTM7XG4gICAgICBmb3IgKGkzID0gMDsgaTMgPCBsZW4yOyBpMyArPSA0KSB7XG4gICAgICAgIHRtcCA9IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyldIDw8IDE4IHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkzICsgMSldIDw8IDEyIHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkzICsgMildIDw8IDYgfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTMgKyAzKV07XG4gICAgICAgIGFycltjdXJCeXRlKytdID0gdG1wID4+IDE2ICYgMjU1O1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCA+PiA4ICYgMjU1O1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCAmIDI1NTtcbiAgICAgIH1cbiAgICAgIGlmIChwbGFjZUhvbGRlcnNMZW4gPT09IDIpIHtcbiAgICAgICAgdG1wID0gcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkzKV0gPDwgMiB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyArIDEpXSA+PiA0O1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCAmIDI1NTtcbiAgICAgIH1cbiAgICAgIGlmIChwbGFjZUhvbGRlcnNMZW4gPT09IDEpIHtcbiAgICAgICAgdG1wID0gcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkzKV0gPDwgMTAgfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTMgKyAxKV0gPDwgNCB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyArIDIpXSA+PiAyO1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCA+PiA4ICYgMjU1O1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCAmIDI1NTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhcnI7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHRyaXBsZXRUb0Jhc2U2NChudW0pIHtcbiAgICAgIHJldHVybiBsb29rdXBbbnVtID4+IDE4ICYgNjNdICsgbG9va3VwW251bSA+PiAxMiAmIDYzXSArIGxvb2t1cFtudW0gPj4gNiAmIDYzXSArIGxvb2t1cFtudW0gJiA2M107XG4gICAgfVxuICAgIGZ1bmN0aW9uIGVuY29kZUNodW5rKHVpbnQ4LCBzdGFydDIsIGVuZCkge1xuICAgICAgdmFyIHRtcDtcbiAgICAgIHZhciBvdXRwdXQgPSBbXTtcbiAgICAgIGZvciAodmFyIGkzID0gc3RhcnQyOyBpMyA8IGVuZDsgaTMgKz0gMykge1xuICAgICAgICB0bXAgPSAodWludDhbaTNdIDw8IDE2ICYgMTY3MTE2ODApICsgKHVpbnQ4W2kzICsgMV0gPDwgOCAmIDY1MjgwKSArICh1aW50OFtpMyArIDJdICYgMjU1KTtcbiAgICAgICAgb3V0cHV0LnB1c2godHJpcGxldFRvQmFzZTY0KHRtcCkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG91dHB1dC5qb2luKFwiXCIpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBmcm9tQnl0ZUFycmF5KHVpbnQ4KSB7XG4gICAgICB2YXIgdG1wO1xuICAgICAgdmFyIGxlbjIgPSB1aW50OC5sZW5ndGg7XG4gICAgICB2YXIgZXh0cmFCeXRlcyA9IGxlbjIgJSAzO1xuICAgICAgdmFyIHBhcnRzID0gW107XG4gICAgICB2YXIgbWF4Q2h1bmtMZW5ndGggPSAxNjM4MztcbiAgICAgIGZvciAodmFyIGkzID0gMCwgbGVuMjIgPSBsZW4yIC0gZXh0cmFCeXRlczsgaTMgPCBsZW4yMjsgaTMgKz0gbWF4Q2h1bmtMZW5ndGgpIHtcbiAgICAgICAgcGFydHMucHVzaChlbmNvZGVDaHVuayh1aW50OCwgaTMsIGkzICsgbWF4Q2h1bmtMZW5ndGggPiBsZW4yMiA/IGxlbjIyIDogaTMgKyBtYXhDaHVua0xlbmd0aCkpO1xuICAgICAgfVxuICAgICAgaWYgKGV4dHJhQnl0ZXMgPT09IDEpIHtcbiAgICAgICAgdG1wID0gdWludDhbbGVuMiAtIDFdO1xuICAgICAgICBwYXJ0cy5wdXNoKFxuICAgICAgICAgIGxvb2t1cFt0bXAgPj4gMl0gKyBsb29rdXBbdG1wIDw8IDQgJiA2M10gKyBcIj09XCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoZXh0cmFCeXRlcyA9PT0gMikge1xuICAgICAgICB0bXAgPSAodWludDhbbGVuMiAtIDJdIDw8IDgpICsgdWludDhbbGVuMiAtIDFdO1xuICAgICAgICBwYXJ0cy5wdXNoKFxuICAgICAgICAgIGxvb2t1cFt0bXAgPj4gMTBdICsgbG9va3VwW3RtcCA+PiA0ICYgNjNdICsgbG9va3VwW3RtcCA8PCAyICYgNjNdICsgXCI9XCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXJ0cy5qb2luKFwiXCIpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8vXG52YXIgcmVxdWlyZV9iYXNlNjQgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi9vcmNoZXN0cmF0aW9uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL2Jhc2U2NC5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICB2YXIgX19jcmVhdGVCaW5kaW5nID0gZXhwb3J0cyAmJiBleHBvcnRzLl9fY3JlYXRlQmluZGluZyB8fCAoT2JqZWN0LmNyZWF0ZSA/IGZ1bmN0aW9uKG8yLCBtMiwgaywgazIpIHtcbiAgICAgIGlmIChrMiA9PT0gdm9pZCAwKSBrMiA9IGs7XG4gICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobTIsIGspO1xuICAgICAgaWYgKCFkZXNjIHx8IChcImdldFwiIGluIGRlc2MgPyAhbTIuX19lc01vZHVsZSA6IGRlc2Mud3JpdGFibGUgfHwgZGVzYy5jb25maWd1cmFibGUpKSB7XG4gICAgICAgIGRlc2MgPSB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIG0yW2tdO1xuICAgICAgICB9IH07XG4gICAgICB9XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobzIsIGsyLCBkZXNjKTtcbiAgICB9IDogZnVuY3Rpb24obzIsIG0yLCBrLCBrMikge1xuICAgICAgaWYgKGsyID09PSB2b2lkIDApIGsyID0gaztcbiAgICAgIG8yW2syXSA9IG0yW2tdO1xuICAgIH0pO1xuICAgIHZhciBfX3NldE1vZHVsZURlZmF1bHQgPSBleHBvcnRzICYmIGV4cG9ydHMuX19zZXRNb2R1bGVEZWZhdWx0IHx8IChPYmplY3QuY3JlYXRlID8gZnVuY3Rpb24obzIsIHYyKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobzIsIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2MiB9KTtcbiAgICB9IDogZnVuY3Rpb24obzIsIHYyKSB7XG4gICAgICBvMltcImRlZmF1bHRcIl0gPSB2MjtcbiAgICB9KTtcbiAgICB2YXIgX19pbXBvcnRTdGFyID0gZXhwb3J0cyAmJiBleHBvcnRzLl9faW1wb3J0U3RhciB8fCBmdW5jdGlvbihtb2QpIHtcbiAgICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgICBpZiAobW9kICE9IG51bGwpIHtcbiAgICAgICAgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICAgIH1cbiAgICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMuZnJvbUJhc2U2NCA9IGV4cG9ydHMudG9CYXNlNjQgPSB2b2lkIDA7XG4gICAgdmFyIGJhc2U2NGpzID0gX19pbXBvcnRTdGFyKHJlcXVpcmVfYmFzZTY0X2pzKCkpO1xuICAgIGZ1bmN0aW9uIHRvQmFzZTY0KGRhdGEpIHtcbiAgICAgIHJldHVybiBiYXNlNjRqcy5mcm9tQnl0ZUFycmF5KGRhdGEpO1xuICAgIH1cbiAgICBleHBvcnRzLnRvQmFzZTY0ID0gdG9CYXNlNjQ7XG4gICAgZnVuY3Rpb24gZnJvbUJhc2U2NChiYXNlNjRTdHJpbmcpIHtcbiAgICAgIGlmICghYmFzZTY0U3RyaW5nLm1hdGNoKC9eW2EtekEtWjAtOSsvXSo9ezAsMn0kLykpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBiYXNlNjQgc3RyaW5nIGZvcm1hdFwiKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBiYXNlNjRqcy50b0J5dGVBcnJheShiYXNlNjRTdHJpbmcpO1xuICAgIH1cbiAgICBleHBvcnRzLmZyb21CYXNlNjQgPSBmcm9tQmFzZTY0O1xuICB9XG59KTtcblxuLy9cbnZhciByZXF1aXJlX2JlY2gzMiA9IF9fY29tbW9uSlMoe1xuICBcIi4uL29yY2hlc3RyYXRpb24vbm9kZV9tb2R1bGVzL0Bjb3NtanMvZW5jb2Rpbmcvbm9kZV9tb2R1bGVzL2JlY2gzMi9pbmRleC5qc1wiKGV4cG9ydHMsIG1vZHVsZSkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIHZhciBBTFBIQUJFVDIgPSBcInFwenJ5OXg4Z2YydHZkdzBzM2puNTRraGNlNm11YTdsXCI7XG4gICAgdmFyIEFMUEhBQkVUX01BUCA9IHt9O1xuICAgIGZvciAoeiA9IDA7IHogPCBBTFBIQUJFVDIubGVuZ3RoOyB6KyspIHtcbiAgICAgIHggPSBBTFBIQUJFVDIuY2hhckF0KHopO1xuICAgICAgaWYgKEFMUEhBQkVUX01BUFt4XSAhPT0gdm9pZCAwKSB0aHJvdyBuZXcgVHlwZUVycm9yKHggKyBcIiBpcyBhbWJpZ3VvdXNcIik7XG4gICAgICBBTFBIQUJFVF9NQVBbeF0gPSB6O1xuICAgIH1cbiAgICB2YXIgeDtcbiAgICB2YXIgejtcbiAgICBmdW5jdGlvbiBwb2x5bW9kU3RlcChwcmUpIHtcbiAgICAgIHZhciBiMyA9IHByZSA+PiAyNTtcbiAgICAgIHJldHVybiAocHJlICYgMzM1NTQ0MzEpIDw8IDUgXiAtKGIzID4+IDAgJiAxKSAmIDk5NjgyNTAxMCBeIC0oYjMgPj4gMSAmIDEpICYgNjQyODEzNTQ5IF4gLShiMyA+PiAyICYgMSkgJiA1MTM4NzQ0MjYgXiAtKGIzID4+IDMgJiAxKSAmIDEwMjc3NDg4MjkgXiAtKGIzID4+IDQgJiAxKSAmIDcwNTk3OTA1OTtcbiAgICB9XG4gICAgZnVuY3Rpb24gcHJlZml4Q2hrKHByZWZpeCkge1xuICAgICAgdmFyIGNoayA9IDE7XG4gICAgICBmb3IgKHZhciBpMiA9IDA7IGkyIDwgcHJlZml4Lmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YXIgYzIgPSBwcmVmaXguY2hhckNvZGVBdChpMik7XG4gICAgICAgIGlmIChjMiA8IDMzIHx8IGMyID4gMTI2KSByZXR1cm4gXCJJbnZhbGlkIHByZWZpeCAoXCIgKyBwcmVmaXggKyBcIilcIjtcbiAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIGMyID4+IDU7XG4gICAgICB9XG4gICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspO1xuICAgICAgZm9yIChpMiA9IDA7IGkyIDwgcHJlZml4Lmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YXIgdjIgPSBwcmVmaXguY2hhckNvZGVBdChpMik7XG4gICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoaykgXiB2MiAmIDMxO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNoaztcbiAgICB9XG4gICAgZnVuY3Rpb24gZW5jb2RlMihwcmVmaXgsIHdvcmRzLCBMSU1JVCkge1xuICAgICAgTElNSVQgPSBMSU1JVCB8fCA5MDtcbiAgICAgIGlmIChwcmVmaXgubGVuZ3RoICsgNyArIHdvcmRzLmxlbmd0aCA+IExJTUlUKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRXhjZWVkcyBsZW5ndGggbGltaXRcIik7XG4gICAgICBwcmVmaXggPSBwcmVmaXgudG9Mb3dlckNhc2UoKTtcbiAgICAgIHZhciBjaGsgPSBwcmVmaXhDaGsocHJlZml4KTtcbiAgICAgIGlmICh0eXBlb2YgY2hrID09PSBcInN0cmluZ1wiKSB0aHJvdyBuZXcgRXJyb3IoY2hrKTtcbiAgICAgIHZhciByZXN1bHQgPSBwcmVmaXggKyBcIjFcIjtcbiAgICAgIGZvciAodmFyIGkyID0gMDsgaTIgPCB3b3Jkcy5sZW5ndGg7ICsraTIpIHtcbiAgICAgICAgdmFyIHgyID0gd29yZHNbaTJdO1xuICAgICAgICBpZiAoeDIgPj4gNSAhPT0gMCkgdGhyb3cgbmV3IEVycm9yKFwiTm9uIDUtYml0IHdvcmRcIik7XG4gICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoaykgXiB4MjtcbiAgICAgICAgcmVzdWx0ICs9IEFMUEhBQkVUMi5jaGFyQXQoeDIpO1xuICAgICAgfVxuICAgICAgZm9yIChpMiA9IDA7IGkyIDwgNjsgKytpMikge1xuICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspO1xuICAgICAgfVxuICAgICAgY2hrIF49IDE7XG4gICAgICBmb3IgKGkyID0gMDsgaTIgPCA2OyArK2kyKSB7XG4gICAgICAgIHZhciB2MiA9IGNoayA+PiAoNSAtIGkyKSAqIDUgJiAzMTtcbiAgICAgICAgcmVzdWx0ICs9IEFMUEhBQkVUMi5jaGFyQXQodjIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgZnVuY3Rpb24gX19kZWNvZGUoc3RyLCBMSU1JVCkge1xuICAgICAgTElNSVQgPSBMSU1JVCB8fCA5MDtcbiAgICAgIGlmIChzdHIubGVuZ3RoIDwgOCkgcmV0dXJuIHN0ciArIFwiIHRvbyBzaG9ydFwiO1xuICAgICAgaWYgKHN0ci5sZW5ndGggPiBMSU1JVCkgcmV0dXJuIFwiRXhjZWVkcyBsZW5ndGggbGltaXRcIjtcbiAgICAgIHZhciBsb3dlcmVkID0gc3RyLnRvTG93ZXJDYXNlKCk7XG4gICAgICB2YXIgdXBwZXJlZCA9IHN0ci50b1VwcGVyQ2FzZSgpO1xuICAgICAgaWYgKHN0ciAhPT0gbG93ZXJlZCAmJiBzdHIgIT09IHVwcGVyZWQpIHJldHVybiBcIk1peGVkLWNhc2Ugc3RyaW5nIFwiICsgc3RyO1xuICAgICAgc3RyID0gbG93ZXJlZDtcbiAgICAgIHZhciBzcGxpdCA9IHN0ci5sYXN0SW5kZXhPZihcIjFcIik7XG4gICAgICBpZiAoc3BsaXQgPT09IC0xKSByZXR1cm4gXCJObyBzZXBhcmF0b3IgY2hhcmFjdGVyIGZvciBcIiArIHN0cjtcbiAgICAgIGlmIChzcGxpdCA9PT0gMCkgcmV0dXJuIFwiTWlzc2luZyBwcmVmaXggZm9yIFwiICsgc3RyO1xuICAgICAgdmFyIHByZWZpeCA9IHN0ci5zbGljZSgwLCBzcGxpdCk7XG4gICAgICB2YXIgd29yZENoYXJzID0gc3RyLnNsaWNlKHNwbGl0ICsgMSk7XG4gICAgICBpZiAod29yZENoYXJzLmxlbmd0aCA8IDYpIHJldHVybiBcIkRhdGEgdG9vIHNob3J0XCI7XG4gICAgICB2YXIgY2hrID0gcHJlZml4Q2hrKHByZWZpeCk7XG4gICAgICBpZiAodHlwZW9mIGNoayA9PT0gXCJzdHJpbmdcIikgcmV0dXJuIGNoaztcbiAgICAgIHZhciB3b3JkcyA9IFtdO1xuICAgICAgZm9yICh2YXIgaTIgPSAwOyBpMiA8IHdvcmRDaGFycy5sZW5ndGg7ICsraTIpIHtcbiAgICAgICAgdmFyIGMyID0gd29yZENoYXJzLmNoYXJBdChpMik7XG4gICAgICAgIHZhciB2MiA9IEFMUEhBQkVUX01BUFtjMl07XG4gICAgICAgIGlmICh2MiA9PT0gdm9pZCAwKSByZXR1cm4gXCJVbmtub3duIGNoYXJhY3RlciBcIiArIGMyO1xuICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspIF4gdjI7XG4gICAgICAgIGlmIChpMiArIDYgPj0gd29yZENoYXJzLmxlbmd0aCkgY29udGludWU7XG4gICAgICAgIHdvcmRzLnB1c2godjIpO1xuICAgICAgfVxuICAgICAgaWYgKGNoayAhPT0gMSkgcmV0dXJuIFwiSW52YWxpZCBjaGVja3N1bSBmb3IgXCIgKyBzdHI7XG4gICAgICByZXR1cm4geyBwcmVmaXgsIHdvcmRzIH07XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRlY29kZVVuc2FmZSgpIHtcbiAgICAgIHZhciByZXMgPSBfX2RlY29kZS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHR5cGVvZiByZXMgPT09IFwib2JqZWN0XCIpIHJldHVybiByZXM7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRlY29kZTMoc3RyKSB7XG4gICAgICB2YXIgcmVzID0gX19kZWNvZGUuYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0eXBlb2YgcmVzID09PSBcIm9iamVjdFwiKSByZXR1cm4gcmVzO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNvbnZlcnQoZGF0YSwgaW5CaXRzLCBvdXRCaXRzLCBwYWQpIHtcbiAgICAgIHZhciB2YWx1ZSA9IDA7XG4gICAgICB2YXIgYml0cyA9IDA7XG4gICAgICB2YXIgbWF4ViA9ICgxIDw8IG91dEJpdHMpIC0gMTtcbiAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgIGZvciAodmFyIGkyID0gMDsgaTIgPCBkYXRhLmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YWx1ZSA9IHZhbHVlIDw8IGluQml0cyB8IGRhdGFbaTJdO1xuICAgICAgICBiaXRzICs9IGluQml0cztcbiAgICAgICAgd2hpbGUgKGJpdHMgPj0gb3V0Qml0cykge1xuICAgICAgICAgIGJpdHMgLT0gb3V0Qml0cztcbiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSA+PiBiaXRzICYgbWF4Vik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChwYWQpIHtcbiAgICAgICAgaWYgKGJpdHMgPiAwKSB7XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUgPDwgb3V0Qml0cyAtIGJpdHMgJiBtYXhWKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGJpdHMgPj0gaW5CaXRzKSByZXR1cm4gXCJFeGNlc3MgcGFkZGluZ1wiO1xuICAgICAgICBpZiAodmFsdWUgPDwgb3V0Qml0cyAtIGJpdHMgJiBtYXhWKSByZXR1cm4gXCJOb24temVybyBwYWRkaW5nXCI7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b1dvcmRzVW5zYWZlKGJ5dGVzKSB7XG4gICAgICB2YXIgcmVzID0gY29udmVydChieXRlcywgOCwgNSwgdHJ1ZSk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpKSByZXR1cm4gcmVzO1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b1dvcmRzKGJ5dGVzKSB7XG4gICAgICB2YXIgcmVzID0gY29udmVydChieXRlcywgOCwgNSwgdHJ1ZSk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpKSByZXR1cm4gcmVzO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21Xb3Jkc1Vuc2FmZSh3b3Jkcykge1xuICAgICAgdmFyIHJlcyA9IGNvbnZlcnQod29yZHMsIDUsIDgsIGZhbHNlKTtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlcykpIHJldHVybiByZXM7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21Xb3Jkcyh3b3Jkcykge1xuICAgICAgdmFyIHJlcyA9IGNvbnZlcnQod29yZHMsIDUsIDgsIGZhbHNlKTtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlcykpIHJldHVybiByZXM7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzKTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgICBkZWNvZGVVbnNhZmUsXG4gICAgICBkZWNvZGU6IGRlY29kZTMsXG4gICAgICBlbmNvZGU6IGVuY29kZTIsXG4gICAgICB0b1dvcmRzVW5zYWZlLFxuICAgICAgdG9Xb3JkcyxcbiAgICAgIGZyb21Xb3Jkc1Vuc2FmZSxcbiAgICAgIGZyb21Xb3Jkc1xuICAgIH07XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYmVjaDMyMiA9IF9fY29tbW9uSlMoe1xuICBcIi4uL29yY2hlc3RyYXRpb24vbm9kZV9tb2R1bGVzL0Bjb3NtanMvZW5jb2RpbmcvYnVpbGQvYmVjaDMyLmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIHZhciBfX2NyZWF0ZUJpbmRpbmcgPSBleHBvcnRzICYmIGV4cG9ydHMuX19jcmVhdGVCaW5kaW5nIHx8IChPYmplY3QuY3JlYXRlID8gZnVuY3Rpb24obzIsIG0yLCBrLCBrMikge1xuICAgICAgaWYgKGsyID09PSB2b2lkIDApIGsyID0gaztcbiAgICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtMiwgayk7XG4gICAgICBpZiAoIWRlc2MgfHwgKFwiZ2V0XCIgaW4gZGVzYyA/ICFtMi5fX2VzTW9kdWxlIDogZGVzYy53cml0YWJsZSB8fCBkZXNjLmNvbmZpZ3VyYWJsZSkpIHtcbiAgICAgICAgZGVzYyA9IHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbTJba107XG4gICAgICAgIH0gfTtcbiAgICAgIH1cbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvMiwgazIsIGRlc2MpO1xuICAgIH0gOiBmdW5jdGlvbihvMiwgbTIsIGssIGsyKSB7XG4gICAgICBpZiAoazIgPT09IHZvaWQgMCkgazIgPSBrO1xuICAgICAgbzJbazJdID0gbTJba107XG4gICAgfSk7XG4gICAgdmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IGV4cG9ydHMgJiYgZXhwb3J0cy5fX3NldE1vZHVsZURlZmF1bHQgfHwgKE9iamVjdC5jcmVhdGUgPyBmdW5jdGlvbihvMiwgdjIpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvMiwgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYyIH0pO1xuICAgIH0gOiBmdW5jdGlvbihvMiwgdjIpIHtcbiAgICAgIG8yW1wiZGVmYXVsdFwiXSA9IHYyO1xuICAgIH0pO1xuICAgIHZhciBfX2ltcG9ydFN0YXIgPSBleHBvcnRzICYmIGV4cG9ydHMuX19pbXBvcnRTdGFyIHx8IGZ1bmN0aW9uKG1vZCkge1xuICAgICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICAgIGlmIChtb2QgIT0gbnVsbCkge1xuICAgICAgICBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgICAgfVxuICAgICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy5ub3JtYWxpemVCZWNoMzIgPSBleHBvcnRzLmZyb21CZWNoMzIgPSBleHBvcnRzLnRvQmVjaDMyID0gdm9pZCAwO1xuICAgIHZhciBiZWNoMzIgPSBfX2ltcG9ydFN0YXIocmVxdWlyZV9iZWNoMzIoKSk7XG4gICAgZnVuY3Rpb24gdG9CZWNoMzIocHJlZml4LCBkYXRhLCBsaW1pdDIpIHtcbiAgICAgIGNvbnN0IGFkZHJlc3MgPSBiZWNoMzIuZW5jb2RlKHByZWZpeCwgYmVjaDMyLnRvV29yZHMoZGF0YSksIGxpbWl0Mik7XG4gICAgICByZXR1cm4gYWRkcmVzcztcbiAgICB9XG4gICAgZXhwb3J0cy50b0JlY2gzMiA9IHRvQmVjaDMyO1xuICAgIGZ1bmN0aW9uIGZyb21CZWNoMzIyKGFkZHJlc3MsIGxpbWl0MiA9IEluZmluaXR5KSB7XG4gICAgICBjb25zdCBkZWNvZGVkQWRkcmVzcyA9IGJlY2gzMi5kZWNvZGUoYWRkcmVzcywgbGltaXQyKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByZWZpeDogZGVjb2RlZEFkZHJlc3MucHJlZml4LFxuICAgICAgICBkYXRhOiBuZXcgVWludDhBcnJheShiZWNoMzIuZnJvbVdvcmRzKGRlY29kZWRBZGRyZXNzLndvcmRzKSlcbiAgICAgIH07XG4gICAgfVxuICAgIGV4cG9ydHMuZnJvbUJlY2gzMiA9IGZyb21CZWNoMzIyO1xuICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZUJlY2gzMihhZGRyZXNzKSB7XG4gICAgICBjb25zdCB7IHByZWZpeCwgZGF0YSB9ID0gZnJvbUJlY2gzMjIoYWRkcmVzcyk7XG4gICAgICByZXR1cm4gdG9CZWNoMzIocHJlZml4LCBkYXRhKTtcbiAgICB9XG4gICAgZXhwb3J0cy5ub3JtYWxpemVCZWNoMzIgPSBub3JtYWxpemVCZWNoMzI7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfaGV4ID0gX19jb21tb25KUyh7XG4gIFwiLi4vb3JjaGVzdHJhdGlvbi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9idWlsZC9oZXguanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMuZnJvbUhleCA9IGV4cG9ydHMudG9IZXggPSB2b2lkIDA7XG4gICAgZnVuY3Rpb24gdG9IZXgoZGF0YSkge1xuICAgICAgbGV0IG91dCA9IFwiXCI7XG4gICAgICBmb3IgKGNvbnN0IGJ5dGUgb2YgZGF0YSkge1xuICAgICAgICBvdXQgKz0gKFwiMFwiICsgYnl0ZS50b1N0cmluZygxNikpLnNsaWNlKC0yKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvdXQ7XG4gICAgfVxuICAgIGV4cG9ydHMudG9IZXggPSB0b0hleDtcbiAgICBmdW5jdGlvbiBmcm9tSGV4MihoZXhzdHJpbmcpIHtcbiAgICAgIGlmIChoZXhzdHJpbmcubGVuZ3RoICUgMiAhPT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJoZXggc3RyaW5nIGxlbmd0aCBtdXN0IGJlIGEgbXVsdGlwbGUgb2YgMlwiKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG91dCA9IG5ldyBVaW50OEFycmF5KGhleHN0cmluZy5sZW5ndGggLyAyKTtcbiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBvdXQubGVuZ3RoOyBpMisrKSB7XG4gICAgICAgIGNvbnN0IGogPSAyICogaTI7XG4gICAgICAgIGNvbnN0IGhleEJ5dGVBc1N0cmluZyA9IGhleHN0cmluZy5zbGljZShqLCBqICsgMik7XG4gICAgICAgIGlmICghaGV4Qnl0ZUFzU3RyaW5nLm1hdGNoKC9bMC05YS1mXXsyfS9pKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImhleCBzdHJpbmcgY29udGFpbnMgaW52YWxpZCBjaGFyYWN0ZXJzXCIpO1xuICAgICAgICB9XG4gICAgICAgIG91dFtpMl0gPSBwYXJzZUludChoZXhCeXRlQXNTdHJpbmcsIDE2KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvdXQ7XG4gICAgfVxuICAgIGV4cG9ydHMuZnJvbUhleCA9IGZyb21IZXgyO1xuICB9XG59KTtcblxuLy9cbnZhciByZXF1aXJlX3JmYzMzMzkgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi9vcmNoZXN0cmF0aW9uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL3JmYzMzMzkuanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMudG9SZmMzMzM5ID0gZXhwb3J0cy5mcm9tUmZjMzMzOSA9IHZvaWQgMDtcbiAgICB2YXIgcmZjMzMzOU1hdGNoZXIgPSAvXihcXGR7NH0pLShcXGR7Mn0pLShcXGR7Mn0pW1QgXShcXGR7Mn0pOihcXGR7Mn0pOihcXGR7Mn0pKFxcLlxcZHsxLDl9KT8oKD86WystXVxcZHsyfTpcXGR7Mn0pfFopJC87XG4gICAgZnVuY3Rpb24gcGFkZGVkKGludGVnZXIsIGxlbmd0aCA9IDIpIHtcbiAgICAgIHJldHVybiBpbnRlZ2VyLnRvU3RyaW5nKCkucGFkU3RhcnQobGVuZ3RoLCBcIjBcIik7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21SZmMzMzM5KHN0cikge1xuICAgICAgY29uc3QgbWF0Y2hlczIgPSByZmMzMzM5TWF0Y2hlci5leGVjKHN0cik7XG4gICAgICBpZiAoIW1hdGNoZXMyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGUgc3RyaW5nIGlzIG5vdCBpbiBSRkMzMzM5IGZvcm1hdFwiKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHllYXIgPSArbWF0Y2hlczJbMV07XG4gICAgICBjb25zdCBtb250aCA9ICttYXRjaGVzMlsyXTtcbiAgICAgIGNvbnN0IGRheSA9ICttYXRjaGVzMlszXTtcbiAgICAgIGNvbnN0IGhvdXIgPSArbWF0Y2hlczJbNF07XG4gICAgICBjb25zdCBtaW51dGUgPSArbWF0Y2hlczJbNV07XG4gICAgICBjb25zdCBzZWNvbmQgPSArbWF0Y2hlczJbNl07XG4gICAgICBjb25zdCBtaWxsaVNlY29uZHMgPSBtYXRjaGVzMls3XSA/IE1hdGguZmxvb3IoK21hdGNoZXMyWzddICogMWUzKSA6IDA7XG4gICAgICBsZXQgdHpPZmZzZXRTaWduO1xuICAgICAgbGV0IHR6T2Zmc2V0SG91cnM7XG4gICAgICBsZXQgdHpPZmZzZXRNaW51dGVzO1xuICAgICAgaWYgKG1hdGNoZXMyWzhdID09PSBcIlpcIikge1xuICAgICAgICB0ek9mZnNldFNpZ24gPSAxO1xuICAgICAgICB0ek9mZnNldEhvdXJzID0gMDtcbiAgICAgICAgdHpPZmZzZXRNaW51dGVzID0gMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHR6T2Zmc2V0U2lnbiA9IG1hdGNoZXMyWzhdLnN1YnN0cmluZygwLCAxKSA9PT0gXCItXCIgPyAtMSA6IDE7XG4gICAgICAgIHR6T2Zmc2V0SG91cnMgPSArbWF0Y2hlczJbOF0uc3Vic3RyaW5nKDEsIDMpO1xuICAgICAgICB0ek9mZnNldE1pbnV0ZXMgPSArbWF0Y2hlczJbOF0uc3Vic3RyaW5nKDQsIDYpO1xuICAgICAgfVxuICAgICAgY29uc3QgdHpPZmZzZXQgPSB0ek9mZnNldFNpZ24gKiAodHpPZmZzZXRIb3VycyAqIDYwICsgdHpPZmZzZXRNaW51dGVzKSAqIDYwO1xuICAgICAgY29uc3QgZGF0ZSA9IC8qICAgICAgICAgICAqLyBuZXcgRGF0ZSgpO1xuICAgICAgZGF0ZS5zZXRVVENGdWxsWWVhcih5ZWFyLCBtb250aCAtIDEsIGRheSk7XG4gICAgICBkYXRlLnNldFVUQ0hvdXJzKGhvdXIsIG1pbnV0ZSwgc2Vjb25kLCBtaWxsaVNlY29uZHMpO1xuICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpIC0gdHpPZmZzZXQgKiAxZTMpO1xuICAgIH1cbiAgICBleHBvcnRzLmZyb21SZmMzMzM5ID0gZnJvbVJmYzMzMzk7XG4gICAgZnVuY3Rpb24gdG9SZmMzMzM5KGRhdGUpIHtcbiAgICAgIGNvbnN0IHllYXIgPSBkYXRlLmdldFVUQ0Z1bGxZZWFyKCk7XG4gICAgICBjb25zdCBtb250aCA9IHBhZGRlZChkYXRlLmdldFVUQ01vbnRoKCkgKyAxKTtcbiAgICAgIGNvbnN0IGRheSA9IHBhZGRlZChkYXRlLmdldFVUQ0RhdGUoKSk7XG4gICAgICBjb25zdCBob3VyID0gcGFkZGVkKGRhdGUuZ2V0VVRDSG91cnMoKSk7XG4gICAgICBjb25zdCBtaW51dGUgPSBwYWRkZWQoZGF0ZS5nZXRVVENNaW51dGVzKCkpO1xuICAgICAgY29uc3Qgc2Vjb25kID0gcGFkZGVkKGRhdGUuZ2V0VVRDU2Vjb25kcygpKTtcbiAgICAgIGNvbnN0IG1zID0gcGFkZGVkKGRhdGUuZ2V0VVRDTWlsbGlzZWNvbmRzKCksIDMpO1xuICAgICAgcmV0dXJuIGAke3llYXJ9LSR7bW9udGh9LSR7ZGF5fVQke2hvdXJ9OiR7bWludXRlfToke3NlY29uZH0uJHttc31aYDtcbiAgICB9XG4gICAgZXhwb3J0cy50b1JmYzMzMzkgPSB0b1JmYzMzMzk7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfdXRmOCA9IF9fY29tbW9uSlMoe1xuICBcIi4uL29yY2hlc3RyYXRpb24vbm9kZV9tb2R1bGVzL0Bjb3NtanMvZW5jb2RpbmcvYnVpbGQvdXRmOC5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy5mcm9tVXRmOCA9IGV4cG9ydHMudG9VdGY4ID0gdm9pZCAwO1xuICAgIGZ1bmN0aW9uIHRvVXRmOChzdHIpIHtcbiAgICAgIHJldHVybiBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoc3RyKTtcbiAgICB9XG4gICAgZXhwb3J0cy50b1V0ZjggPSB0b1V0Zjg7XG4gICAgZnVuY3Rpb24gZnJvbVV0ZjgoZGF0YSwgbG9zc3kgPSBmYWxzZSkge1xuICAgICAgY29uc3QgZmF0YWwgPSAhbG9zc3k7XG4gICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKFwidXRmLThcIiwgeyBmYXRhbCB9KS5kZWNvZGUoZGF0YSk7XG4gICAgfVxuICAgIGV4cG9ydHMuZnJvbVV0ZjggPSBmcm9tVXRmODtcbiAgfVxufSk7XG5cbi8vXG52YXIgcmVxdWlyZV9idWlsZCA9IF9fY29tbW9uSlMoe1xuICBcIi4uL29yY2hlc3RyYXRpb24vbm9kZV9tb2R1bGVzL0Bjb3NtanMvZW5jb2RpbmcvYnVpbGQvaW5kZXguanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMudG9VdGY4ID0gZXhwb3J0cy5mcm9tVXRmOCA9IGV4cG9ydHMudG9SZmMzMzM5ID0gZXhwb3J0cy5mcm9tUmZjMzMzOSA9IGV4cG9ydHMudG9IZXggPSBleHBvcnRzLmZyb21IZXggPSBleHBvcnRzLnRvQmVjaDMyID0gZXhwb3J0cy5ub3JtYWxpemVCZWNoMzIgPSBleHBvcnRzLmZyb21CZWNoMzIgPSBleHBvcnRzLnRvQmFzZTY0ID0gZXhwb3J0cy5mcm9tQmFzZTY0ID0gZXhwb3J0cy50b0FzY2lpID0gZXhwb3J0cy5mcm9tQXNjaWkgPSB2b2lkIDA7XG4gICAgdmFyIGFzY2lpXzEgPSByZXF1aXJlX2FzY2lpKCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiZnJvbUFzY2lpXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBhc2NpaV8xLmZyb21Bc2NpaTtcbiAgICB9IH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcInRvQXNjaWlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGFzY2lpXzEudG9Bc2NpaTtcbiAgICB9IH0pO1xuICAgIHZhciBiYXNlNjRfMSA9IHJlcXVpcmVfYmFzZTY0KCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiZnJvbUJhc2U2NFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYmFzZTY0XzEuZnJvbUJhc2U2NDtcbiAgICB9IH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcInRvQmFzZTY0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBiYXNlNjRfMS50b0Jhc2U2NDtcbiAgICB9IH0pO1xuICAgIHZhciBiZWNoMzJfMSA9IHJlcXVpcmVfYmVjaDMyMigpO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcImZyb21CZWNoMzJcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGJlY2gzMl8xLmZyb21CZWNoMzI7XG4gICAgfSB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJub3JtYWxpemVCZWNoMzJcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGJlY2gzMl8xLm5vcm1hbGl6ZUJlY2gzMjtcbiAgICB9IH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcInRvQmVjaDMyXCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBiZWNoMzJfMS50b0JlY2gzMjtcbiAgICB9IH0pO1xuICAgIHZhciBoZXhfMSA9IHJlcXVpcmVfaGV4KCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiZnJvbUhleFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gaGV4XzEuZnJvbUhleDtcbiAgICB9IH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcInRvSGV4XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBoZXhfMS50b0hleDtcbiAgICB9IH0pO1xuICAgIHZhciByZmMzMzM5XzEgPSByZXF1aXJlX3JmYzMzMzkoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tUmZjMzMzOVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gcmZjMzMzOV8xLmZyb21SZmMzMzM5O1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9SZmMzMzM5XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiByZmMzMzM5XzEudG9SZmMzMzM5O1xuICAgIH0gfSk7XG4gICAgdmFyIHV0ZjhfMSA9IHJlcXVpcmVfdXRmOCgpO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcImZyb21VdGY4XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB1dGY4XzEuZnJvbVV0Zjg7XG4gICAgfSB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJ0b1V0ZjhcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHV0ZjhfMS50b1V0Zjg7XG4gICAgfSB9KTtcbiAgfVxufSk7XG5cbi8vXG52YXIgcmVxdWlyZV9kaXN0ID0gX19jb21tb25KUyh7XG4gIFwiLi4vLi4vbm9kZV9tb2R1bGVzL2JlY2gzMi9kaXN0L2luZGV4LmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbiAgICBleHBvcnRzLmJlY2gzMm0gPSBleHBvcnRzLmJlY2gzMiA9IHZvaWQgMDtcbiAgICB2YXIgQUxQSEFCRVQyID0gXCJxcHpyeTl4OGdmMnR2ZHcwczNqbjU0a2hjZTZtdWE3bFwiO1xuICAgIHZhciBBTFBIQUJFVF9NQVAgPSB7fTtcbiAgICBmb3IgKGxldCB6ID0gMDsgeiA8IEFMUEhBQkVUMi5sZW5ndGg7IHorKykge1xuICAgICAgY29uc3QgeCA9IEFMUEhBQkVUMi5jaGFyQXQoeik7XG4gICAgICBBTFBIQUJFVF9NQVBbeF0gPSB6O1xuICAgIH1cbiAgICBmdW5jdGlvbiBwb2x5bW9kU3RlcChwcmUpIHtcbiAgICAgIGNvbnN0IGIzID0gcHJlID4+IDI1O1xuICAgICAgcmV0dXJuIChwcmUgJiAzMzU1NDQzMSkgPDwgNSBeIC0oYjMgPj4gMCAmIDEpICYgOTk2ODI1MDEwIF4gLShiMyA+PiAxICYgMSkgJiA2NDI4MTM1NDkgXiAtKGIzID4+IDIgJiAxKSAmIDUxMzg3NDQyNiBeIC0oYjMgPj4gMyAmIDEpICYgMTAyNzc0ODgyOSBeIC0oYjMgPj4gNCAmIDEpICYgNzA1OTc5MDU5O1xuICAgIH1cbiAgICBmdW5jdGlvbiBwcmVmaXhDaGsocHJlZml4KSB7XG4gICAgICBsZXQgY2hrID0gMTtcbiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBwcmVmaXgubGVuZ3RoOyArK2kyKSB7XG4gICAgICAgIGNvbnN0IGMyID0gcHJlZml4LmNoYXJDb2RlQXQoaTIpO1xuICAgICAgICBpZiAoYzIgPCAzMyB8fCBjMiA+IDEyNilcbiAgICAgICAgICByZXR1cm4gXCJJbnZhbGlkIHByZWZpeCAoXCIgKyBwcmVmaXggKyBcIilcIjtcbiAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIGMyID4+IDU7XG4gICAgICB9XG4gICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IHByZWZpeC5sZW5ndGg7ICsraTIpIHtcbiAgICAgICAgY29uc3QgdjIgPSBwcmVmaXguY2hhckNvZGVBdChpMik7XG4gICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoaykgXiB2MiAmIDMxO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNoaztcbiAgICB9XG4gICAgZnVuY3Rpb24gY29udmVydChkYXRhLCBpbkJpdHMsIG91dEJpdHMsIHBhZCkge1xuICAgICAgbGV0IHZhbHVlID0gMDtcbiAgICAgIGxldCBiaXRzID0gMDtcbiAgICAgIGNvbnN0IG1heFYgPSAoMSA8PCBvdXRCaXRzKSAtIDE7XG4gICAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBkYXRhLmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YWx1ZSA9IHZhbHVlIDw8IGluQml0cyB8IGRhdGFbaTJdO1xuICAgICAgICBiaXRzICs9IGluQml0cztcbiAgICAgICAgd2hpbGUgKGJpdHMgPj0gb3V0Qml0cykge1xuICAgICAgICAgIGJpdHMgLT0gb3V0Qml0cztcbiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSA+PiBiaXRzICYgbWF4Vik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChwYWQpIHtcbiAgICAgICAgaWYgKGJpdHMgPiAwKSB7XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUgPDwgb3V0Qml0cyAtIGJpdHMgJiBtYXhWKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGJpdHMgPj0gaW5CaXRzKVxuICAgICAgICAgIHJldHVybiBcIkV4Y2VzcyBwYWRkaW5nXCI7XG4gICAgICAgIGlmICh2YWx1ZSA8PCBvdXRCaXRzIC0gYml0cyAmIG1heFYpXG4gICAgICAgICAgcmV0dXJuIFwiTm9uLXplcm8gcGFkZGluZ1wiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgZnVuY3Rpb24gdG9Xb3JkcyhieXRlcykge1xuICAgICAgcmV0dXJuIGNvbnZlcnQoYnl0ZXMsIDgsIDUsIHRydWUpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBmcm9tV29yZHNVbnNhZmUod29yZHMpIHtcbiAgICAgIGNvbnN0IHJlcyA9IGNvbnZlcnQod29yZHMsIDUsIDgsIGZhbHNlKTtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlcykpXG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21Xb3Jkcyh3b3Jkcykge1xuICAgICAgY29uc3QgcmVzID0gY29udmVydCh3b3JkcywgNSwgOCwgZmFsc2UpO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVzKSlcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICAgIHRocm93IG5ldyBFcnJvcihyZXMpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBnZXRMaWJyYXJ5RnJvbUVuY29kaW5nKGVuY29kaW5nKSB7XG4gICAgICBsZXQgRU5DT0RJTkdfQ09OU1Q7XG4gICAgICBpZiAoZW5jb2RpbmcgPT09IFwiYmVjaDMyXCIpIHtcbiAgICAgICAgRU5DT0RJTkdfQ09OU1QgPSAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgRU5DT0RJTkdfQ09OU1QgPSA3MzQ1Mzk5Mzk7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBlbmNvZGUyKHByZWZpeCwgd29yZHMsIExJTUlUKSB7XG4gICAgICAgIExJTUlUID0gTElNSVQgfHwgOTA7XG4gICAgICAgIGlmIChwcmVmaXgubGVuZ3RoICsgNyArIHdvcmRzLmxlbmd0aCA+IExJTUlUKVxuICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJFeGNlZWRzIGxlbmd0aCBsaW1pdFwiKTtcbiAgICAgICAgcHJlZml4ID0gcHJlZml4LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGxldCBjaGsgPSBwcmVmaXhDaGsocHJlZml4KTtcbiAgICAgICAgaWYgKHR5cGVvZiBjaGsgPT09IFwic3RyaW5nXCIpXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGNoayk7XG4gICAgICAgIGxldCByZXN1bHQgPSBwcmVmaXggKyBcIjFcIjtcbiAgICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IHdvcmRzLmxlbmd0aDsgKytpMikge1xuICAgICAgICAgIGNvbnN0IHggPSB3b3Jkc1tpMl07XG4gICAgICAgICAgaWYgKHggPj4gNSAhPT0gMClcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vbiA1LWJpdCB3b3JkXCIpO1xuICAgICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoaykgXiB4O1xuICAgICAgICAgIHJlc3VsdCArPSBBTFBIQUJFVDIuY2hhckF0KHgpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCA2OyArK2kyKSB7XG4gICAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKTtcbiAgICAgICAgfVxuICAgICAgICBjaGsgXj0gRU5DT0RJTkdfQ09OU1Q7XG4gICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCA2OyArK2kyKSB7XG4gICAgICAgICAgY29uc3QgdjIgPSBjaGsgPj4gKDUgLSBpMikgKiA1ICYgMzE7XG4gICAgICAgICAgcmVzdWx0ICs9IEFMUEhBQkVUMi5jaGFyQXQodjIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBfX2RlY29kZShzdHIsIExJTUlUKSB7XG4gICAgICAgIExJTUlUID0gTElNSVQgfHwgOTA7XG4gICAgICAgIGlmIChzdHIubGVuZ3RoIDwgOClcbiAgICAgICAgICByZXR1cm4gc3RyICsgXCIgdG9vIHNob3J0XCI7XG4gICAgICAgIGlmIChzdHIubGVuZ3RoID4gTElNSVQpXG4gICAgICAgICAgcmV0dXJuIFwiRXhjZWVkcyBsZW5ndGggbGltaXRcIjtcbiAgICAgICAgY29uc3QgbG93ZXJlZCA9IHN0ci50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBjb25zdCB1cHBlcmVkID0gc3RyLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIGlmIChzdHIgIT09IGxvd2VyZWQgJiYgc3RyICE9PSB1cHBlcmVkKVxuICAgICAgICAgIHJldHVybiBcIk1peGVkLWNhc2Ugc3RyaW5nIFwiICsgc3RyO1xuICAgICAgICBzdHIgPSBsb3dlcmVkO1xuICAgICAgICBjb25zdCBzcGxpdCA9IHN0ci5sYXN0SW5kZXhPZihcIjFcIik7XG4gICAgICAgIGlmIChzcGxpdCA9PT0gLTEpXG4gICAgICAgICAgcmV0dXJuIFwiTm8gc2VwYXJhdG9yIGNoYXJhY3RlciBmb3IgXCIgKyBzdHI7XG4gICAgICAgIGlmIChzcGxpdCA9PT0gMClcbiAgICAgICAgICByZXR1cm4gXCJNaXNzaW5nIHByZWZpeCBmb3IgXCIgKyBzdHI7XG4gICAgICAgIGNvbnN0IHByZWZpeCA9IHN0ci5zbGljZSgwLCBzcGxpdCk7XG4gICAgICAgIGNvbnN0IHdvcmRDaGFycyA9IHN0ci5zbGljZShzcGxpdCArIDEpO1xuICAgICAgICBpZiAod29yZENoYXJzLmxlbmd0aCA8IDYpXG4gICAgICAgICAgcmV0dXJuIFwiRGF0YSB0b28gc2hvcnRcIjtcbiAgICAgICAgbGV0IGNoayA9IHByZWZpeENoayhwcmVmaXgpO1xuICAgICAgICBpZiAodHlwZW9mIGNoayA9PT0gXCJzdHJpbmdcIilcbiAgICAgICAgICByZXR1cm4gY2hrO1xuICAgICAgICBjb25zdCB3b3JkcyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgd29yZENoYXJzLmxlbmd0aDsgKytpMikge1xuICAgICAgICAgIGNvbnN0IGMyID0gd29yZENoYXJzLmNoYXJBdChpMik7XG4gICAgICAgICAgY29uc3QgdjIgPSBBTFBIQUJFVF9NQVBbYzJdO1xuICAgICAgICAgIGlmICh2MiA9PT0gdm9pZCAwKVxuICAgICAgICAgICAgcmV0dXJuIFwiVW5rbm93biBjaGFyYWN0ZXIgXCIgKyBjMjtcbiAgICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspIF4gdjI7XG4gICAgICAgICAgaWYgKGkyICsgNiA+PSB3b3JkQ2hhcnMubGVuZ3RoKVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgd29yZHMucHVzaCh2Mik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNoayAhPT0gRU5DT0RJTkdfQ09OU1QpXG4gICAgICAgICAgcmV0dXJuIFwiSW52YWxpZCBjaGVja3N1bSBmb3IgXCIgKyBzdHI7XG4gICAgICAgIHJldHVybiB7IHByZWZpeCwgd29yZHMgfTtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIGRlY29kZVVuc2FmZShzdHIsIExJTUlUKSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IF9fZGVjb2RlKHN0ciwgTElNSVQpO1xuICAgICAgICBpZiAodHlwZW9mIHJlcyA9PT0gXCJvYmplY3RcIilcbiAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gZGVjb2RlMyhzdHIsIExJTUlUKSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IF9fZGVjb2RlKHN0ciwgTElNSVQpO1xuICAgICAgICBpZiAodHlwZW9mIHJlcyA9PT0gXCJvYmplY3RcIilcbiAgICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRlY29kZVVuc2FmZSxcbiAgICAgICAgZGVjb2RlOiBkZWNvZGUzLFxuICAgICAgICBlbmNvZGU6IGVuY29kZTIsXG4gICAgICAgIHRvV29yZHMsXG4gICAgICAgIGZyb21Xb3Jkc1Vuc2FmZSxcbiAgICAgICAgZnJvbVdvcmRzXG4gICAgICB9O1xuICAgIH1cbiAgICBleHBvcnRzLmJlY2gzMiA9IGdldExpYnJhcnlGcm9tRW5jb2RpbmcoXCJiZWNoMzJcIik7XG4gICAgZXhwb3J0cy5iZWNoMzJtID0gZ2V0TGlicmFyeUZyb21FbmNvZGluZyhcImJlY2gzMm1cIik7XG4gIH1cbn0pO1xuXG4vL1xudmFyIGdsb2JhbEFzc2VydCA9IGdsb2JhbFRoaXMuYXNzZXJ0O1xuaWYgKGdsb2JhbEFzc2VydCA9PT0gdm9pZCAwKSB7XG4gIHRocm93IEVycm9yKFxuICAgIGBDYW5ub3QgaW5pdGlhbGl6ZSBAZW5kby9lcnJvcnMsIG1pc3NpbmcgZ2xvYmFsVGhpcy5hc3NlcnQsIGltcG9ydCAnc2VzJyBiZWZvcmUgJ0BlbmRvL2Vycm9ycydgXG4gICk7XG59XG52YXIgbWlzc2luZyA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgW1xuICAgIFwidHlwZW9mXCIsXG4gICAgXCJlcnJvclwiLFxuICAgIFwiZmFpbFwiLFxuICAgIFwiZXF1YWxcIixcbiAgICBcInN0cmluZ1wiLFxuICAgIFwibm90ZVwiLFxuICAgIFwiZGV0YWlsc1wiLFxuICAgIFwiRmFpbFwiLFxuICAgIFwicXVvdGVcIixcbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIFwibWFrZUFzc2VydFwiXG4gIF0uZmlsdGVyKChuYW1lKSA9PiBnbG9iYWxBc3NlcnRbbmFtZV0gPT09IHZvaWQgMClcbik7XG5pZiAobWlzc2luZy5sZW5ndGggPiAwKSB7XG4gIHRocm93IEVycm9yKFxuICAgIGBDYW5ub3QgaW5pdGlhbGl6ZSBAZW5kby9lcnJvcnMsIG1pc3NpbmcgZ2xvYmFsVGhpcy5hc3NlcnQgbWV0aG9kcyAke21pc3Npbmcuam9pbihcbiAgICAgIFwiLCBcIlxuICAgICl9YFxuICApO1xufVxudmFyIHtcbiAgYmFyZSxcbiAgZGV0YWlsczogcmVkYWN0ZWQsXG4gIGVycm9yOiBtYWtlRXJyb3IsXG4gIEZhaWw6IHRocm93UmVkYWN0ZWQsXG4gIG1ha2VBc3NlcnQ6IF9vbWl0dGVkTWFrZUFzc2VydCxcbiAgbm90ZSxcbiAgcXVvdGUsXG4gIC4uLmFzc2VydGlvbnNcbn0gPSBnbG9iYWxBc3NlcnQ7XG52YXIgYXNzZXJ0MiA9ICh2YWx1ZSwgb3B0RGV0YWlscywgZXJyQ29udHJ1Y3Rvciwgb3B0aW9ucykgPT4gZ2xvYmFsQXNzZXJ0KHZhbHVlLCBvcHREZXRhaWxzLCBlcnJDb250cnVjdG9yLCBvcHRpb25zKTtcbk9iamVjdC5hc3NpZ24oYXNzZXJ0MiwgYXNzZXJ0aW9ucyk7XG52YXIgYmFyZU9yUXVvdGUgPSBiYXJlIHx8IHF1b3RlO1xuXG4vL1xudmFyIHsgZnJlZXplIH0gPSBPYmplY3Q7XG52YXIgeyBhcHBseSB9ID0gUmVmbGVjdDtcbnZhciB1bmN1cnJ5VGhpcyA9IChmbikgPT4gKHJlY2VpdmVyLCAuLi5hcmdzKSA9PiBhcHBseShmbiwgcmVjZWl2ZXIsIGFyZ3MpO1xudmFyIGFycmF5UHVzaCA9IHVuY3VycnlUaGlzKEFycmF5LnByb3RvdHlwZS5wdXNoKTtcbnZhciBhcnJheUluY2x1ZGVzID0gdW5jdXJyeVRoaXMoQXJyYXkucHJvdG90eXBlLmluY2x1ZGVzKTtcbnZhciBzdHJpbmdTcGxpdCA9IHVuY3VycnlUaGlzKFN0cmluZy5wcm90b3R5cGUuc3BsaXQpO1xudmFyIHEgPSBKU09OLnN0cmluZ2lmeTtcbnZhciBGYWlsID0gKGxpdGVyYWxzLCAuLi5hcmdzKSA9PiB7XG4gIGxldCBtc2cgPSBsaXRlcmFsc1swXTtcbiAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGFyZ3MubGVuZ3RoOyBpMiArPSAxKSB7XG4gICAgbXNnID0gYCR7bXNnfSR7YXJnc1tpMl19JHtsaXRlcmFsc1tpMiArIDFdfWA7XG4gIH1cbiAgdGhyb3cgRXJyb3IobXNnKTtcbn07XG52YXIgbWFrZUVudmlyb25tZW50Q2FwdG9yID0gKGFHbG9iYWwsIGRyb3BOYW1lcyA9IGZhbHNlKSA9PiB7XG4gIGNvbnN0IGNhcHR1cmVkRW52aXJvbm1lbnRPcHRpb25OYW1lcyA9IFtdO1xuICBjb25zdCBnZXRFbnZpcm9ubWVudE9wdGlvbjIgPSAob3B0aW9uTmFtZSwgZGVmYXVsdFNldHRpbmcsIG9wdE90aGVyVmFsdWVzID0gdm9pZCAwKSA9PiB7XG4gICAgdHlwZW9mIG9wdGlvbk5hbWUgPT09IFwic3RyaW5nXCIgfHwgRmFpbGBFbnZpcm9ubWVudCBvcHRpb24gbmFtZSAke3Eob3B0aW9uTmFtZSl9IG11c3QgYmUgYSBzdHJpbmcuYDtcbiAgICB0eXBlb2YgZGVmYXVsdFNldHRpbmcgPT09IFwic3RyaW5nXCIgfHwgRmFpbGBFbnZpcm9ubWVudCBvcHRpb24gZGVmYXVsdCBzZXR0aW5nICR7cShcbiAgICAgIGRlZmF1bHRTZXR0aW5nXG4gICAgKX0gbXVzdCBiZSBhIHN0cmluZy5gO1xuICAgIGxldCBzZXR0aW5nID0gZGVmYXVsdFNldHRpbmc7XG4gICAgY29uc3QgZ2xvYmFsUHJvY2VzcyA9IGFHbG9iYWwucHJvY2VzcyB8fCB2b2lkIDA7XG4gICAgY29uc3QgZ2xvYmFsRW52ID0gdHlwZW9mIGdsb2JhbFByb2Nlc3MgPT09IFwib2JqZWN0XCIgJiYgZ2xvYmFsUHJvY2Vzcy5lbnYgfHwgdm9pZCAwO1xuICAgIGlmICh0eXBlb2YgZ2xvYmFsRW52ID09PSBcIm9iamVjdFwiKSB7XG4gICAgICBpZiAob3B0aW9uTmFtZSBpbiBnbG9iYWxFbnYpIHtcbiAgICAgICAgaWYgKCFkcm9wTmFtZXMpIHtcbiAgICAgICAgICBhcnJheVB1c2goY2FwdHVyZWRFbnZpcm9ubWVudE9wdGlvbk5hbWVzLCBvcHRpb25OYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvcHRpb25WYWx1ZSA9IGdsb2JhbEVudltvcHRpb25OYW1lXTtcbiAgICAgICAgdHlwZW9mIG9wdGlvblZhbHVlID09PSBcInN0cmluZ1wiIHx8IEZhaWxgRW52aXJvbm1lbnQgb3B0aW9uIG5hbWVkICR7cShcbiAgICAgICAgICBvcHRpb25OYW1lXG4gICAgICAgICl9LCBpZiBwcmVzZW50LCBtdXN0IGhhdmUgYSBjb3JyZXNwb25kaW5nIHN0cmluZyB2YWx1ZSwgZ290ICR7cShcbiAgICAgICAgICBvcHRpb25WYWx1ZVxuICAgICAgICApfWA7XG4gICAgICAgIHNldHRpbmcgPSBvcHRpb25WYWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgb3B0T3RoZXJWYWx1ZXMgPT09IHZvaWQgMCB8fCBzZXR0aW5nID09PSBkZWZhdWx0U2V0dGluZyB8fCBhcnJheUluY2x1ZGVzKG9wdE90aGVyVmFsdWVzLCBzZXR0aW5nKSB8fCBGYWlsYFVucmVjb2duaXplZCAke3Eob3B0aW9uTmFtZSl9IHZhbHVlICR7cShcbiAgICAgIHNldHRpbmdcbiAgICApfS4gRXhwZWN0ZWQgb25lIG9mICR7cShbZGVmYXVsdFNldHRpbmcsIC4uLm9wdE90aGVyVmFsdWVzXSl9YDtcbiAgICByZXR1cm4gc2V0dGluZztcbiAgfTtcbiAgZnJlZXplKGdldEVudmlyb25tZW50T3B0aW9uMik7XG4gIGNvbnN0IGdldEVudmlyb25tZW50T3B0aW9uc0xpc3QyID0gKG9wdGlvbk5hbWUpID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBnZXRFbnZpcm9ubWVudE9wdGlvbjIob3B0aW9uTmFtZSwgXCJcIik7XG4gICAgcmV0dXJuIGZyZWV6ZShvcHRpb24gPT09IFwiXCIgPyBbXSA6IHN0cmluZ1NwbGl0KG9wdGlvbiwgXCIsXCIpKTtcbiAgfTtcbiAgZnJlZXplKGdldEVudmlyb25tZW50T3B0aW9uc0xpc3QyKTtcbiAgY29uc3QgZW52aXJvbm1lbnRPcHRpb25zTGlzdEhhczIgPSAob3B0aW9uTmFtZSwgZWxlbWVudCkgPT4gYXJyYXlJbmNsdWRlcyhnZXRFbnZpcm9ubWVudE9wdGlvbnNMaXN0MihvcHRpb25OYW1lKSwgZWxlbWVudCk7XG4gIGNvbnN0IGdldENhcHR1cmVkRW52aXJvbm1lbnRPcHRpb25OYW1lcyA9ICgpID0+IHtcbiAgICByZXR1cm4gZnJlZXplKFsuLi5jYXB0dXJlZEVudmlyb25tZW50T3B0aW9uTmFtZXNdKTtcbiAgfTtcbiAgZnJlZXplKGdldENhcHR1cmVkRW52aXJvbm1lbnRPcHRpb25OYW1lcyk7XG4gIHJldHVybiBmcmVlemUoe1xuICAgIGdldEVudmlyb25tZW50T3B0aW9uOiBnZXRFbnZpcm9ubWVudE9wdGlvbjIsXG4gICAgZ2V0RW52aXJvbm1lbnRPcHRpb25zTGlzdDogZ2V0RW52aXJvbm1lbnRPcHRpb25zTGlzdDIsXG4gICAgZW52aXJvbm1lbnRPcHRpb25zTGlzdEhhczogZW52aXJvbm1lbnRPcHRpb25zTGlzdEhhczIsXG4gICAgZ2V0Q2FwdHVyZWRFbnZpcm9ubWVudE9wdGlvbk5hbWVzXG4gIH0pO1xufTtcbmZyZWV6ZShtYWtlRW52aXJvbm1lbnRDYXB0b3IpO1xudmFyIHtcbiAgZ2V0RW52aXJvbm1lbnRPcHRpb24sXG4gIGdldEVudmlyb25tZW50T3B0aW9uc0xpc3QsXG4gIGVudmlyb25tZW50T3B0aW9uc0xpc3RIYXNcbn0gPSBtYWtlRW52aXJvbm1lbnRDYXB0b3IoZ2xvYmFsVGhpcywgdHJ1ZSk7XG5cbi8vXG52YXIgeyBxdW90ZTogcTIsIEZhaWw6IEZhaWwyIH0gPSBhc3NlcnQ7XG52YXIgeyBoYXNPd24sIGZyZWV6ZTogZnJlZXplMiwgZW50cmllcyB9ID0gT2JqZWN0O1xudmFyIGlzSlNPTlJlY29yZCA9ICh2YWwpID0+IHR5cGVvZiB2YWwgPT09IFwib2JqZWN0XCIgJiYgdmFsICE9PSBudWxsICYmICFBcnJheS5pc0FycmF5KHZhbCk7XG52YXIgc2ltcGxpZnlUYWcgPSAodGFnKSA9PiB7XG4gIGZvciAoY29uc3QgcHJlZml4IG9mIFtcIkFsbGVnZWQ6IFwiLCBcIkRlYnVnTmFtZTogXCJdKSB7XG4gICAgaWYgKHRhZy5zdGFydHNXaXRoKHByZWZpeCkpIHtcbiAgICAgIHJldHVybiB0YWcuc2xpY2UocHJlZml4Lmxlbmd0aCk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0YWc7XG59O1xudmFyIG1ha2VNZXNzYWdlQnJlYWtwb2ludFRlc3RlciA9IChvcHRpb25OYW1lKSA9PiB7XG4gIGxldCBicmVha3BvaW50cyA9IEpTT04ucGFyc2UoZ2V0RW52aXJvbm1lbnRPcHRpb24ob3B0aW9uTmFtZSwgXCJudWxsXCIpKTtcbiAgaWYgKGJyZWFrcG9pbnRzID09PSBudWxsKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBsZXQgYnJlYWtwb2ludHNUYWJsZTtcbiAgY29uc3QgZ2V0QnJlYWtwb2ludHMgPSAoKSA9PiBicmVha3BvaW50cztcbiAgZnJlZXplMihnZXRCcmVha3BvaW50cyk7XG4gIGNvbnN0IHNldEJyZWFrcG9pbnRzID0gKG5ld0JyZWFrcG9pbnRzID0gYnJlYWtwb2ludHMpID0+IHtcbiAgICBpc0pTT05SZWNvcmQobmV3QnJlYWtwb2ludHMpIHx8IEZhaWwyYEV4cGVjdGVkICR7cTIob3B0aW9uTmFtZSl9IG9wdGlvbiB0byBiZSBhIEpTT04gYnJlYWtwb2ludHMgcmVjb3JkYDtcbiAgICBjb25zdCBuZXdCcmVha3BvaW50c1RhYmxlID0geyBfX3Byb3RvX186IG51bGwgfTtcbiAgICBmb3IgKGNvbnN0IFt0YWcsIG1ldGhvZEJQc10gb2YgZW50cmllcyhuZXdCcmVha3BvaW50cykpIHtcbiAgICAgIHRhZyA9PT0gc2ltcGxpZnlUYWcodGFnKSB8fCBGYWlsMmBKdXN0IHVzZSBzaW1wbGUgdGFnICR7cTIoc2ltcGxpZnlUYWcodGFnKSl9IHJhdGhlciB0aGFuICR7cTIodGFnKX1gO1xuICAgICAgaXNKU09OUmVjb3JkKG1ldGhvZEJQcykgfHwgRmFpbDJgRXhwZWN0ZWQgJHtxMihvcHRpb25OYW1lKX0gb3B0aW9uJ3MgJHtxMihcbiAgICAgICAgdGFnXG4gICAgICApfSB0byBiZSBhIEpTT04gbWV0aG9kcyBicmVha3BvaW50cyByZWNvcmRgO1xuICAgICAgZm9yIChjb25zdCBbbWV0aG9kTmFtZSwgY291bnRdIG9mIGVudHJpZXMobWV0aG9kQlBzKSkge1xuICAgICAgICBjb3VudCA9PT0gXCIqXCIgfHwgdHlwZW9mIGNvdW50ID09PSBcIm51bWJlclwiICYmIE51bWJlci5pc1NhZmVJbnRlZ2VyKGNvdW50KSAmJiBjb3VudCA+PSAwIHx8IEZhaWwyYEV4cGVjdGVkICR7cTIob3B0aW9uTmFtZSl9IG9wdGlvbidzICR7cTIodGFnKX0uJHtxMihcbiAgICAgICAgICBtZXRob2ROYW1lXG4gICAgICAgICl9IHRvIGJlIFwiKlwiIG9yIGEgbm9uLW5lZ2F0aXZlIGludGVnZXJgO1xuICAgICAgICBjb25zdCBjbGFzc0JQcyA9IGhhc093bihuZXdCcmVha3BvaW50c1RhYmxlLCBtZXRob2ROYW1lKSA/IG5ld0JyZWFrcG9pbnRzVGFibGVbbWV0aG9kTmFtZV0gOiBuZXdCcmVha3BvaW50c1RhYmxlW21ldGhvZE5hbWVdID0ge1xuICAgICAgICAgIC8vXG4gICAgICAgICAgX19wcm90b19fOiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIGNsYXNzQlBzW3RhZ10gPSBjb3VudDtcbiAgICAgIH1cbiAgICB9XG4gICAgYnJlYWtwb2ludHMgPSBuZXdCcmVha3BvaW50cztcbiAgICBicmVha3BvaW50c1RhYmxlID0gbmV3QnJlYWtwb2ludHNUYWJsZTtcbiAgfTtcbiAgZnJlZXplMihzZXRCcmVha3BvaW50cyk7XG4gIGNvbnN0IHNob3VsZEJyZWFrcG9pbnQgPSAocmVjaXBpZW50LCBtZXRob2ROYW1lKSA9PiB7XG4gICAgaWYgKG1ldGhvZE5hbWUgPT09IHZvaWQgMCB8fCBtZXRob2ROYW1lID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGNsYXNzQlBzID0gYnJlYWtwb2ludHNUYWJsZVttZXRob2ROYW1lXSB8fCBicmVha3BvaW50c1RhYmxlW1wiKlwiXTtcbiAgICBpZiAoY2xhc3NCUHMgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBsZXQgdGFnID0gc2ltcGxpZnlUYWcocmVjaXBpZW50W1N5bWJvbC50b1N0cmluZ1RhZ10pO1xuICAgIGxldCBjb3VudCA9IGNsYXNzQlBzW3RhZ107XG4gICAgaWYgKGNvdW50ID09PSB2b2lkIDApIHtcbiAgICAgIHRhZyA9IFwiKlwiO1xuICAgICAgY291bnQgPSBjbGFzc0JQc1t0YWddO1xuICAgICAgaWYgKGNvdW50ID09PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoY291bnQgPT09IFwiKlwiKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGNvdW50ID09PSAwKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgYXNzZXJ0KHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiAmJiBjb3VudCA+PSAxKTtcbiAgICBjbGFzc0JQc1t0YWddID0gY291bnQgLSAxO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgZnJlZXplMihzaG91bGRCcmVha3BvaW50KTtcbiAgY29uc3QgYnJlYWtwb2ludFRlc3RlciA9IGZyZWV6ZTIoe1xuICAgIGdldEJyZWFrcG9pbnRzLFxuICAgIHNldEJyZWFrcG9pbnRzLFxuICAgIHNob3VsZEJyZWFrcG9pbnRcbiAgfSk7XG4gIGJyZWFrcG9pbnRUZXN0ZXIuc2V0QnJlYWtwb2ludHMoKTtcbiAgcmV0dXJuIGJyZWFrcG9pbnRUZXN0ZXI7XG59O1xuZnJlZXplMihtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIpO1xuXG4vL1xudmFyIHsgZGV0YWlsczogWCwgcXVvdGU6IHEzLCBGYWlsOiBGYWlsMyB9ID0gYXNzZXJ0O1xudmFyIHsgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycywgZ2V0UHJvdG90eXBlT2YsIGZyZWV6ZTogZnJlZXplMyB9ID0gT2JqZWN0O1xudmFyIHsgYXBwbHk6IGFwcGx5Miwgb3duS2V5cyB9ID0gUmVmbGVjdDtcbnZhciBvbkRlbGl2ZXJ5ID0gbWFrZU1lc3NhZ2VCcmVha3BvaW50VGVzdGVyKFwiRU5ET19ERUxJVkVSWV9CUkVBS1BPSU5UU1wiKTtcbnZhciBpc09iamVjdCA9ICh2YWwpID0+IE9iamVjdCh2YWwpID09PSB2YWw7XG52YXIgY29tcGFyZVN0cmluZ2lmaWVkID0gKGEyLCBiMykgPT4ge1xuICBpZiAodHlwZW9mIGEyID09PSB0eXBlb2YgYjMpIHtcbiAgICBjb25zdCBsZWZ0ID0gU3RyaW5nKGEyKTtcbiAgICBjb25zdCByaWdodCA9IFN0cmluZyhiMyk7XG4gICAgcmV0dXJuIGxlZnQgPCByaWdodCA/IC0xIDogbGVmdCA+IHJpZ2h0ID8gMSA6IDA7XG4gIH1cbiAgaWYgKHR5cGVvZiBhMiA9PT0gXCJzeW1ib2xcIikge1xuICAgIGFzc2VydCh0eXBlb2YgYjMgPT09IFwic3RyaW5nXCIpO1xuICAgIHJldHVybiAtMTtcbiAgfVxuICBhc3NlcnQodHlwZW9mIGEyID09PSBcInN0cmluZ1wiKTtcbiAgYXNzZXJ0KHR5cGVvZiBiMyA9PT0gXCJzeW1ib2xcIik7XG4gIHJldHVybiAxO1xufTtcbnZhciBnZXRNZXRob2ROYW1lcyA9ICh2YWwpID0+IHtcbiAgbGV0IGxheWVyID0gdmFsO1xuICBjb25zdCBuYW1lcyA9IC8qICAgICAgICAgICAqLyBuZXcgU2V0KCk7XG4gIHdoaWxlIChsYXllciAhPT0gbnVsbCAmJiBsYXllciAhPT0gT2JqZWN0LnByb3RvdHlwZSkge1xuICAgIGNvbnN0IGRlc2NzID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhsYXllcik7XG4gICAgZm9yIChjb25zdCBuYW1lIG9mIG93bktleXMoZGVzY3MpKSB7XG4gICAgICBpZiAodHlwZW9mIHZhbFtuYW1lXSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIG5hbWVzLmFkZChuYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFpc09iamVjdCh2YWwpKSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgbGF5ZXIgPSBnZXRQcm90b3R5cGVPZihsYXllcik7XG4gIH1cbiAgcmV0dXJuIGhhcmRlbihbLi4ubmFtZXNdLnNvcnQoY29tcGFyZVN0cmluZ2lmaWVkKSk7XG59O1xuZnJlZXplMyhnZXRNZXRob2ROYW1lcyk7XG5cbi8vXG52YXIgeyBpc0FycmF5IH0gPSBBcnJheTtcbnZhciB7IHByb3RvdHlwZTogZnVuY3Rpb25Qcm90b3R5cGUgfSA9IEZ1bmN0aW9uO1xudmFyIHtcbiAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLFxuICBnZXRQcm90b3R5cGVPZjogZ2V0UHJvdG90eXBlT2YyLFxuICBoYXNPd25Qcm9wZXJ0eTogb2JqZWN0SGFzT3duUHJvcGVydHksXG4gIGlzRnJvemVuLFxuICBwcm90b3R5cGU6IG9iamVjdFByb3RvdHlwZVxufSA9IE9iamVjdDtcbnZhciB7IGFwcGx5OiBhcHBseTMgfSA9IFJlZmxlY3Q7XG52YXIgeyB0b1N0cmluZ1RhZzogdG9TdHJpbmdUYWdTeW1ib2wgfSA9IFN5bWJvbDtcbnZhciB0eXBlZEFycmF5UHJvdG90eXBlID0gZ2V0UHJvdG90eXBlT2YyKFVpbnQ4QXJyYXkucHJvdG90eXBlKTtcbnZhciB0eXBlZEFycmF5VG9TdHJpbmdUYWdEZXNjID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKFxuICB0eXBlZEFycmF5UHJvdG90eXBlLFxuICB0b1N0cmluZ1RhZ1N5bWJvbFxuKTtcbmFzc2VydCh0eXBlZEFycmF5VG9TdHJpbmdUYWdEZXNjKTtcbnZhciBnZXRUeXBlZEFycmF5VG9TdHJpbmdUYWcgPSB0eXBlZEFycmF5VG9TdHJpbmdUYWdEZXNjLmdldDtcbmFzc2VydCh0eXBlb2YgZ2V0VHlwZWRBcnJheVRvU3RyaW5nVGFnID09PSBcImZ1bmN0aW9uXCIpO1xudmFyIGhhc093blByb3BlcnR5T2YgPSAob2JqLCBwcm9wKSA9PiBhcHBseTMob2JqZWN0SGFzT3duUHJvcGVydHksIG9iaiwgW3Byb3BdKTtcbmhhcmRlbihoYXNPd25Qcm9wZXJ0eU9mKTtcbnZhciBpc09iamVjdDIgPSAodmFsKSA9PiBPYmplY3QodmFsKSA9PT0gdmFsO1xuaGFyZGVuKGlzT2JqZWN0Mik7XG52YXIgaXNUeXBlZEFycmF5ID0gKG9iamVjdCkgPT4ge1xuICBjb25zdCB0YWcgPSBhcHBseTMoZ2V0VHlwZWRBcnJheVRvU3RyaW5nVGFnLCBvYmplY3QsIFtdKTtcbiAgcmV0dXJuIHRhZyAhPT0gdm9pZCAwO1xufTtcbmhhcmRlbihpc1R5cGVkQXJyYXkpO1xudmFyIFBBU1NfU1RZTEUgPSBTeW1ib2wuZm9yKFwicGFzc1N0eWxlXCIpO1xudmFyIGNhbkJlTWV0aG9kID0gKGZ1bmMpID0+IHR5cGVvZiBmdW5jID09PSBcImZ1bmN0aW9uXCIgJiYgIShQQVNTX1NUWUxFIGluIGZ1bmMpO1xuaGFyZGVuKGNhbkJlTWV0aG9kKTtcbnZhciBhc3NlcnRDaGVja2VyID0gKGNvbmQsIGRldGFpbHMpID0+IHtcbiAgYXNzZXJ0KGNvbmQsIGRldGFpbHMpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG5oYXJkZW4oYXNzZXJ0Q2hlY2tlcik7XG52YXIgQ1ggPSAoY2hlY2spID0+IHtcbiAgY29uc3QgcmVqZWN0ID0gKFQsIC4uLnN1YnMpID0+IGNoZWNrKGZhbHNlLCByZWRhY3RlZChULCAuLi5zdWJzKSk7XG4gIHJldHVybiByZWplY3Q7XG59O1xuaGFyZGVuKENYKTtcbnZhciBnZXRPd25EYXRhRGVzY3JpcHRvciA9IChjYW5kaWRhdGUsIHByb3BOYW1lLCBzaG91bGRCZUVudW1lcmFibGUsIGNoZWNrKSA9PiB7XG4gIGNvbnN0IGRlc2MgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGNhbmRpZGF0ZSwgcHJvcE5hbWUpXG4gICk7XG4gIHJldHVybiAoZGVzYyAhPT0gdm9pZCAwIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYCR7cXVvdGUocHJvcE5hbWUpfSBwcm9wZXJ0eSBleHBlY3RlZDogJHtjYW5kaWRhdGV9YCkgJiYgKGhhc093blByb3BlcnR5T2YoZGVzYywgXCJ2YWx1ZVwiKSB8fCAhIWNoZWNrICYmIENYKFxuICAgIGNoZWNrXG4gIClgJHtxdW90ZShwcm9wTmFtZSl9IG11c3Qgbm90IGJlIGFuIGFjY2Vzc29yIHByb3BlcnR5OiAke2NhbmRpZGF0ZX1gKSAmJiAoc2hvdWxkQmVFbnVtZXJhYmxlID8gZGVzYy5lbnVtZXJhYmxlIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgY2hlY2tcbiAgKWAke3F1b3RlKHByb3BOYW1lKX0gbXVzdCBiZSBhbiBlbnVtZXJhYmxlIHByb3BlcnR5OiAke2NhbmRpZGF0ZX1gIDogIWRlc2MuZW51bWVyYWJsZSB8fCAhIWNoZWNrICYmIENYKFxuICAgIGNoZWNrXG4gIClgJHtxdW90ZShwcm9wTmFtZSl9IG11c3Qgbm90IGJlIGFuIGVudW1lcmFibGUgcHJvcGVydHk6ICR7Y2FuZGlkYXRlfWApID8gZGVzYyA6IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgdm9pZCAwXG4gICk7XG59O1xuaGFyZGVuKGdldE93bkRhdGFEZXNjcmlwdG9yKTtcbnZhciBnZXRUYWcgPSAodGFnUmVjb3JkKSA9PiB0YWdSZWNvcmRbU3ltYm9sLnRvU3RyaW5nVGFnXTtcbmhhcmRlbihnZXRUYWcpO1xudmFyIGNoZWNrUGFzc1N0eWxlID0gKG9iaiwgcGFzc1N0eWxlLCBleHBlY3RlZFBhc3NTdHlsZSwgY2hlY2spID0+IHtcbiAgcmV0dXJuIHBhc3NTdHlsZSA9PT0gZXhwZWN0ZWRQYXNzU3R5bGUgfHwgISFjaGVjayAmJiBDWChjaGVjaylgRXhwZWN0ZWQgJHtxdW90ZShleHBlY3RlZFBhc3NTdHlsZSl9LCBub3QgJHtxdW90ZShwYXNzU3R5bGUpfTogJHtvYmp9YDtcbn07XG5oYXJkZW4oY2hlY2tQYXNzU3R5bGUpO1xudmFyIG1ha2VDaGVja1RhZ1JlY29yZCA9IChjaGVja1Byb3RvKSA9PiB7XG4gIGNvbnN0IGNoZWNrVGFnUmVjb3JkMiA9ICh0YWdSZWNvcmQsIGV4cGVjdGVkUGFzc1N0eWxlLCBjaGVjaykgPT4ge1xuICAgIHJldHVybiAoaXNPYmplY3QyKHRhZ1JlY29yZCkgfHwgISFjaGVjayAmJiBDWChjaGVjaylgQSBub24tb2JqZWN0IGNhbm5vdCBiZSBhIHRhZ1JlY29yZDogJHt0YWdSZWNvcmR9YCkgJiYgKGlzRnJvemVuKHRhZ1JlY29yZCkgfHwgISFjaGVjayAmJiBDWChjaGVjaylgQSB0YWdSZWNvcmQgbXVzdCBiZSBmcm96ZW46ICR7dGFnUmVjb3JkfWApICYmICghaXNBcnJheSh0YWdSZWNvcmQpIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYEFuIGFycmF5IGNhbm5vdCBiZSBhIHRhZ1JlY29yZDogJHt0YWdSZWNvcmR9YCkgJiYgY2hlY2tQYXNzU3R5bGUoXG4gICAgICB0YWdSZWNvcmQsXG4gICAgICBnZXRPd25EYXRhRGVzY3JpcHRvcih0YWdSZWNvcmQsIFBBU1NfU1RZTEUsIGZhbHNlLCBjaGVjaykudmFsdWUsXG4gICAgICBleHBlY3RlZFBhc3NTdHlsZSxcbiAgICAgIGNoZWNrXG4gICAgKSAmJiAodHlwZW9mIGdldE93bkRhdGFEZXNjcmlwdG9yKHRhZ1JlY29yZCwgU3ltYm9sLnRvU3RyaW5nVGFnLCBmYWxzZSwgY2hlY2spLnZhbHVlID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgICBjaGVja1xuICAgIClgQSBbU3ltYm9sLnRvU3RyaW5nVGFnXS1uYW1lZCBwcm9wZXJ0eSBtdXN0IGJlIGEgc3RyaW5nOiAke3RhZ1JlY29yZH1gKSAmJiBjaGVja1Byb3RvKHRhZ1JlY29yZCwgZ2V0UHJvdG90eXBlT2YyKHRhZ1JlY29yZCksIGNoZWNrKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbihjaGVja1RhZ1JlY29yZDIpO1xufTtcbnZhciBjaGVja1RhZ1JlY29yZCA9IG1ha2VDaGVja1RhZ1JlY29yZChcbiAgKHZhbCwgcHJvdG8sIGNoZWNrKSA9PiBwcm90byA9PT0gb2JqZWN0UHJvdG90eXBlIHx8ICEhY2hlY2sgJiYgY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgdGFnUmVjb3JkIG11c3QgaW5oZXJpdCBmcm9tIE9iamVjdC5wcm90b3R5cGU6ICR7dmFsfWApXG4pO1xuaGFyZGVuKGNoZWNrVGFnUmVjb3JkKTtcbnZhciBjaGVja0Z1bmN0aW9uVGFnUmVjb3JkID0gbWFrZUNoZWNrVGFnUmVjb3JkKFxuICAodmFsLCBwcm90bywgY2hlY2spID0+IHByb3RvID09PSBmdW5jdGlvblByb3RvdHlwZSB8fCBwcm90byAhPT0gbnVsbCAmJiBnZXRQcm90b3R5cGVPZjIocHJvdG8pID09PSBmdW5jdGlvblByb3RvdHlwZSB8fCAhIWNoZWNrICYmIGNoZWNrKFxuICAgIGZhbHNlLFxuICAgIHJlZGFjdGVkYEZvciBmdW5jdGlvbnMsIGEgdGFnUmVjb3JkIG11c3QgaW5oZXJpdCBmcm9tIEZ1bmN0aW9uLnByb3RvdHlwZTogJHt2YWx9YFxuICApXG4pO1xuaGFyZGVuKGNoZWNrRnVuY3Rpb25UYWdSZWNvcmQpO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czIgfSA9IFJlZmxlY3Q7XG52YXIgeyBpc0FycmF5OiBpc0FycmF5MiB9ID0gQXJyYXk7XG52YXIge1xuICBnZXRQcm90b3R5cGVPZjogZ2V0UHJvdG90eXBlT2YzLFxuICBpc0Zyb3plbjogaXNGcm96ZW4yLFxuICBwcm90b3R5cGU6IG9iamVjdFByb3RvdHlwZTIsXG4gIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM6IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnMyXG59ID0gT2JqZWN0O1xudmFyIGNoZWNrSWZhY2UgPSAoaWZhY2UsIGNoZWNrKSA9PiB7XG4gIHJldHVybiAoXG4gICAgLy9cbiAgICAodHlwZW9mIGlmYWNlID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgICBjaGVja1xuICAgIClgRm9yIG5vdywgaW50ZXJmYWNlICR7aWZhY2V9IG11c3QgYmUgYSBzdHJpbmc7IHVuaW1wbGVtZW50ZWRgKSAmJiAoaWZhY2UgPT09IFwiUmVtb3RhYmxlXCIgfHwgaWZhY2Uuc3RhcnRzV2l0aChcIkFsbGVnZWQ6IFwiKSB8fCBpZmFjZS5zdGFydHNXaXRoKFwiRGVidWdOYW1lOiBcIikgfHwgISFjaGVjayAmJiBDWChjaGVjaylgRm9yIG5vdywgaWZhY2UgJHtxdW90ZShcbiAgICAgIGlmYWNlXG4gICAgKX0gbXVzdCBiZSBcIlJlbW90YWJsZVwiIG9yIGJlZ2luIHdpdGggXCJBbGxlZ2VkOiBcIiBvciBcIkRlYnVnTmFtZTogXCI7IHVuaW1wbGVtZW50ZWRgKVxuICApO1xufTtcbnZhciBhc3NlcnRJZmFjZSA9IChpZmFjZSkgPT4gY2hlY2tJZmFjZShpZmFjZSwgYXNzZXJ0Q2hlY2tlcik7XG5oYXJkZW4oYXNzZXJ0SWZhY2UpO1xudmFyIGNoZWNrUmVtb3RhYmxlUHJvdG9PZiA9IChvcmlnaW5hbCwgY2hlY2spID0+IHtcbiAgaXNPYmplY3QyKG9yaWdpbmFsKSB8fCB0aHJvd1JlZGFjdGVkYFJlbW90YWJsZXMgbXVzdCBiZSBvYmplY3RzIG9yIGZ1bmN0aW9uczogJHtvcmlnaW5hbH1gO1xuICBjb25zdCBwcm90byA9IGdldFByb3RvdHlwZU9mMyhvcmlnaW5hbCk7XG4gIGlmIChwcm90byA9PT0gb2JqZWN0UHJvdG90eXBlMiB8fCBwcm90byA9PT0gbnVsbCB8fCBwcm90byA9PT0gRnVuY3Rpb24ucHJvdG90eXBlKSB7XG4gICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goY2hlY2spYFJlbW90YWJsZXMgbXVzdCBiZSBleHBsaWNpdGx5IGRlY2xhcmVkOiAke3F1b3RlKG9yaWdpbmFsKX1gO1xuICB9XG4gIGlmICh0eXBlb2Ygb3JpZ2luYWwgPT09IFwib2JqZWN0XCIpIHtcbiAgICBjb25zdCBwcm90b1Byb3RvID0gZ2V0UHJvdG90eXBlT2YzKHByb3RvKTtcbiAgICBpZiAocHJvdG9Qcm90byAhPT0gb2JqZWN0UHJvdG90eXBlMiAmJiBwcm90b1Byb3RvICE9PSBudWxsKSB7XG4gICAgICByZXR1cm4gY2hlY2tSZW1vdGFibGUocHJvdG8sIGNoZWNrKTtcbiAgICB9XG4gICAgaWYgKCFjaGVja1RhZ1JlY29yZChwcm90bywgXCJyZW1vdGFibGVcIiwgY2hlY2spKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9IGVsc2UgaWYgKHR5cGVvZiBvcmlnaW5hbCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgaWYgKCFjaGVja0Z1bmN0aW9uVGFnUmVjb3JkKHByb3RvLCBcInJlbW90YWJsZVwiLCBjaGVjaykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgY29uc3QgcGFzc1N0eWxlS2V5ID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBQQVNTX1NUWUxFXG4gICk7XG4gIGNvbnN0IHRhZ0tleSA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgU3ltYm9sLnRvU3RyaW5nVGFnXG4gICk7XG4gIGNvbnN0IHtcbiAgICAvL1xuICAgIFtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgcGFzc1N0eWxlS2V5XG4gICAgXTogX3Bhc3NTdHlsZURlc2MsXG4gICAgW1xuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICB0YWdLZXlcbiAgICBdOiB7IHZhbHVlOiBpZmFjZSB9LFxuICAgIC4uLnJlc3REZXNjc1xuICB9ID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczIocHJvdG8pO1xuICByZXR1cm4gKG93bktleXMyKHJlc3REZXNjcykubGVuZ3RoID09PSAwIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgY2hlY2tcbiAgKWBVbmV4cGVjdGVkIHByb3BlcnRpZXMgb24gUmVtb3RhYmxlIFByb3RvICR7b3duS2V5czIocmVzdERlc2NzKX1gKSAmJiBjaGVja0lmYWNlKGlmYWNlLCBjaGVjayk7XG59O1xudmFyIGNvbmZpcm1lZFJlbW90YWJsZXMgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKTtcbnZhciBjaGVja1JlbW90YWJsZSA9ICh2YWwsIGNoZWNrKSA9PiB7XG4gIGlmIChjb25maXJtZWRSZW1vdGFibGVzLmhhcyh2YWwpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKCFpc0Zyb3plbjIodmFsKSkge1xuICAgIHJldHVybiAhIWNoZWNrICYmIENYKGNoZWNrKWBjYW5ub3Qgc2VyaWFsaXplIG5vbi1mcm96ZW4gb2JqZWN0cyBsaWtlICR7dmFsfWA7XG4gIH1cbiAgaWYgKCFSZW1vdGFibGVIZWxwZXIuY2FuQmVWYWxpZCh2YWwsIGNoZWNrKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSBjaGVja1JlbW90YWJsZVByb3RvT2YodmFsLCBjaGVjayk7XG4gIGlmIChyZXN1bHQpIHtcbiAgICBjb25maXJtZWRSZW1vdGFibGVzLmFkZCh2YWwpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xudmFyIGdldEludGVyZmFjZU9mID0gKHZhbCkgPT4ge1xuICBpZiAoIWlzT2JqZWN0Mih2YWwpIHx8IHZhbFtQQVNTX1NUWUxFXSAhPT0gXCJyZW1vdGFibGVcIiB8fCAhY2hlY2tSZW1vdGFibGUodmFsKSkge1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbiAgcmV0dXJuIGdldFRhZyh2YWwpO1xufTtcbmhhcmRlbihnZXRJbnRlcmZhY2VPZik7XG52YXIgUmVtb3RhYmxlSGVscGVyID0gaGFyZGVuKHtcbiAgc3R5bGVOYW1lOiBcInJlbW90YWJsZVwiLFxuICBjYW5CZVZhbGlkOiAoY2FuZGlkYXRlLCBjaGVjayA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkVHlwZSA9IChpc09iamVjdDIoY2FuZGlkYXRlKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBjYW5ub3Qgc2VyaWFsaXplIG5vbi1vYmplY3RzIGFzIFJlbW90YWJsZSAke2NhbmRpZGF0ZX1gKSAmJiAoIWlzQXJyYXkyKGNhbmRpZGF0ZSkgfHwgISFjaGVjayAmJiBDWChjaGVjaylgY2Fubm90IHNlcmlhbGl6ZSBhcnJheXMgYXMgUmVtb3RhYmxlICR7Y2FuZGlkYXRlfWApO1xuICAgIGlmICghdmFsaWRUeXBlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGRlc2NzID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczIoY2FuZGlkYXRlKTtcbiAgICBpZiAodHlwZW9mIGNhbmRpZGF0ZSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgcmV0dXJuIG93bktleXMyKGRlc2NzKS5ldmVyeSgoa2V5KSA9PiB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgLy9cbiAgICAgICAgICAoaGFzT3duUHJvcGVydHlPZihkZXNjc1tcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAga2V5XG4gICAgICAgICAgXSwgXCJ2YWx1ZVwiKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBjYW5ub3Qgc2VyaWFsaXplIFJlbW90YWJsZXMgd2l0aCBhY2Nlc3NvcnMgbGlrZSAke3F1b3RlKFxuICAgICAgICAgICAgU3RyaW5nKGtleSlcbiAgICAgICAgICApfSBpbiAke2NhbmRpZGF0ZX1gKSAmJiAoa2V5ID09PSBTeW1ib2wudG9TdHJpbmdUYWcgJiYgY2hlY2tJZmFjZShjYW5kaWRhdGVba2V5XSwgY2hlY2spIHx8IChjYW5CZU1ldGhvZChjYW5kaWRhdGVba2V5XSkgfHwgISFjaGVjayAmJiBDWChjaGVjaylgY2Fubm90IHNlcmlhbGl6ZSBSZW1vdGFibGVzIHdpdGggbm9uLW1ldGhvZHMgbGlrZSAke3F1b3RlKFxuICAgICAgICAgICAgU3RyaW5nKGtleSlcbiAgICAgICAgICApfSBpbiAke2NhbmRpZGF0ZX1gKSAmJiAoa2V5ICE9PSBQQVNTX1NUWUxFIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYEEgcGFzcy1ieS1yZW1vdGUgY2Fubm90IHNoYWRvdyAke3F1b3RlKFBBU1NfU1RZTEUpfWApKVxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgY2FuZGlkYXRlID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgbmFtZTogbmFtZURlc2MsXG4gICAgICAgIGxlbmd0aDogbGVuZ3RoRGVzYyxcbiAgICAgICAgLy9cbiAgICAgICAgW1N5bWJvbC50b1N0cmluZ1RhZ106IHRvU3RyaW5nVGFnRGVzYyxcbiAgICAgICAgLi4ucmVzdERlc2NzXG4gICAgICB9ID0gZGVzY3M7XG4gICAgICBjb25zdCByZXN0S2V5cyA9IG93bktleXMyKHJlc3REZXNjcyk7XG4gICAgICByZXR1cm4gKG5hbWVEZXNjICYmIHR5cGVvZiBuYW1lRGVzYy52YWx1ZSA9PT0gXCJzdHJpbmdcIiB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBGYXIgZnVuY3Rpb24gbmFtZSBtdXN0IGJlIGEgc3RyaW5nLCBpbiAke2NhbmRpZGF0ZX1gKSAmJiAobGVuZ3RoRGVzYyAmJiB0eXBlb2YgbGVuZ3RoRGVzYy52YWx1ZSA9PT0gXCJudW1iZXJcIiB8fCAhIWNoZWNrICYmIENYKFxuICAgICAgICBjaGVja1xuICAgICAgKWBGYXIgZnVuY3Rpb24gbGVuZ3RoIG11c3QgYmUgYSBudW1iZXIsIGluICR7Y2FuZGlkYXRlfWApICYmICh0b1N0cmluZ1RhZ0Rlc2MgPT09IHZvaWQgMCB8fCAodHlwZW9mIHRvU3RyaW5nVGFnRGVzYy52YWx1ZSA9PT0gXCJzdHJpbmdcIiB8fCAhIWNoZWNrICYmIENYKFxuICAgICAgICBjaGVja1xuICAgICAgKWBGYXIgZnVuY3Rpb24gQEB0b1N0cmluZ1RhZyBtdXN0IGJlIGEgc3RyaW5nLCBpbiAke2NhbmRpZGF0ZX1gKSAmJiBjaGVja0lmYWNlKHRvU3RyaW5nVGFnRGVzYy52YWx1ZSwgY2hlY2spKSAmJiAocmVzdEtleXMubGVuZ3RoID09PSAwIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgICAgIGNoZWNrXG4gICAgICApYEZhciBmdW5jdGlvbnMgdW5leHBlY3RlZCBwcm9wZXJ0aWVzIGJlc2lkZXMgLm5hbWUgYW5kIC5sZW5ndGggJHtyZXN0S2V5c31gKTtcbiAgICB9XG4gICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goY2hlY2spYHVucmVjb2duaXplZCB0eXBlb2YgJHtjYW5kaWRhdGV9YDtcbiAgfSxcbiAgYXNzZXJ0UmVzdFZhbGlkOiAoY2FuZGlkYXRlKSA9PiBjaGVja1JlbW90YWJsZShjYW5kaWRhdGUsIGFzc2VydENoZWNrZXIpLFxuICBldmVyeTogKF9wYXNzYWJsZSwgX2ZuKSA9PiB0cnVlXG59KTtcblxuLy9cbnZhciB7IHByb3RvdHlwZTogZnVuY3Rpb25Qcm90b3R5cGUyIH0gPSBGdW5jdGlvbjtcbnZhciB7XG4gIGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjQsXG4gIHNldFByb3RvdHlwZU9mLFxuICBjcmVhdGUsXG4gIGlzRnJvemVuOiBpc0Zyb3plbjMsXG4gIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlM1xufSA9IE9iamVjdDtcbnZhciBtYWtlUmVtb3RhYmxlUHJvdG8gPSAocmVtb3RhYmxlLCBpZmFjZSkgPT4ge1xuICBsZXQgb2xkUHJvdG8gPSBnZXRQcm90b3R5cGVPZjQocmVtb3RhYmxlKTtcbiAgaWYgKHR5cGVvZiByZW1vdGFibGUgPT09IFwib2JqZWN0XCIpIHtcbiAgICBpZiAob2xkUHJvdG8gPT09IG51bGwpIHtcbiAgICAgIG9sZFByb3RvID0gb2JqZWN0UHJvdG90eXBlMztcbiAgICB9XG4gICAgb2xkUHJvdG8gPT09IG9iamVjdFByb3RvdHlwZTMgfHwgdGhyb3dSZWRhY3RlZGBGb3Igbm93LCByZW1vdGFibGVzIGNhbm5vdCBpbmhlcml0IGZyb20gYW55dGhpbmcgdW51c3VhbCwgaW4gJHtyZW1vdGFibGV9YDtcbiAgfSBlbHNlIGlmICh0eXBlb2YgcmVtb3RhYmxlID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBvbGRQcm90byAhPT0gbnVsbCB8fCB0aHJvd1JlZGFjdGVkYE9yaWdpbmFsIGZ1bmN0aW9uIG11c3Qgbm90IGluaGVyaXQgZnJvbSBudWxsOiAke3JlbW90YWJsZX1gO1xuICAgIG9sZFByb3RvID09PSBmdW5jdGlvblByb3RvdHlwZTIgfHwgZ2V0UHJvdG90eXBlT2Y0KG9sZFByb3RvKSA9PT0gZnVuY3Rpb25Qcm90b3R5cGUyIHx8IHRocm93UmVkYWN0ZWRgRmFyIGZ1bmN0aW9ucyBtdXN0IG9yaWdpbmFsbHkgaW5oZXJpdCBmcm9tIEZ1bmN0aW9uLnByb3RvdHlwZSwgaW4gJHtyZW1vdGFibGV9YDtcbiAgfSBlbHNlIHtcbiAgICB0aHJvd1JlZGFjdGVkYHVucmVjb2duaXplZCB0eXBlb2YgJHtyZW1vdGFibGV9YDtcbiAgfVxuICByZXR1cm4gaGFyZGVuKFxuICAgIGNyZWF0ZShvbGRQcm90bywge1xuICAgICAgW1BBU1NfU1RZTEVdOiB7IHZhbHVlOiBcInJlbW90YWJsZVwiIH0sXG4gICAgICBbU3ltYm9sLnRvU3RyaW5nVGFnXTogeyB2YWx1ZTogaWZhY2UgfVxuICAgIH0pXG4gICk7XG59O1xudmFyIGFzc2VydENhbkJlUmVtb3RhYmxlID0gKGNhbmRpZGF0ZSkgPT4gUmVtb3RhYmxlSGVscGVyLmNhbkJlVmFsaWQoY2FuZGlkYXRlLCBhc3NlcnRDaGVja2VyKTtcbnZhciBSZW1vdGFibGUgPSAoaWZhY2UgPSBcIlJlbW90YWJsZVwiLCBwcm9wcyA9IHZvaWQgMCwgcmVtb3RhYmxlID0gKFxuICAvKiAgICAgICAgICAgICovXG4gIHt9XG4pKSA9PiB7XG4gIGFzc2VydElmYWNlKGlmYWNlKTtcbiAgYXNzZXJ0KGlmYWNlKTtcbiAgcHJvcHMgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYFJlbW90YWJsZSBwcm9wcyBub3QgeWV0IGltcGxlbWVudGVkICR7cHJvcHN9YDtcbiAgYXNzZXJ0Q2FuQmVSZW1vdGFibGUocmVtb3RhYmxlKTtcbiAgIShQQVNTX1NUWUxFIGluIHJlbW90YWJsZSkgfHwgdGhyb3dSZWRhY3RlZGBSZW1vdGFibGUgJHtyZW1vdGFibGV9IGlzIGFscmVhZHkgbWFya2VkIGFzIGEgJHtxdW90ZShcbiAgICByZW1vdGFibGVbUEFTU19TVFlMRV1cbiAgKX1gO1xuICBoYXJkZW4uaXNGYWtlIHx8IC8vXG4gICFpc0Zyb3plbjMocmVtb3RhYmxlKSB8fCB0aHJvd1JlZGFjdGVkYFJlbW90YWJsZSAke3JlbW90YWJsZX0gaXMgYWxyZWFkeSBmcm96ZW5gO1xuICBjb25zdCByZW1vdGFibGVQcm90byA9IG1ha2VSZW1vdGFibGVQcm90byhyZW1vdGFibGUsIGlmYWNlKTtcbiAgY29uc3QgbXV0YXRlSGFyZGVuQW5kQ2hlY2sgPSAodGFyZ2V0KSA9PiB7XG4gICAgc2V0UHJvdG90eXBlT2YodGFyZ2V0LCByZW1vdGFibGVQcm90byk7XG4gICAgaGFyZGVuKHRhcmdldCk7XG4gICAgYXNzZXJ0Q2FuQmVSZW1vdGFibGUodGFyZ2V0KTtcbiAgfTtcbiAgbXV0YXRlSGFyZGVuQW5kQ2hlY2soe30pO1xuICBtdXRhdGVIYXJkZW5BbmRDaGVjayhyZW1vdGFibGUpO1xuICBhc3NlcnQoaWZhY2UgIT09IHZvaWQgMCk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICovXG4gICAgcmVtb3RhYmxlXG4gICk7XG59O1xuaGFyZGVuKFJlbW90YWJsZSk7XG52YXIgR0VUX01FVEhPRF9OQU1FUyA9IFwiX19nZXRNZXRob2ROYW1lc19fXCI7XG52YXIgZ2V0TWV0aG9kTmFtZXNNZXRob2QgPSBoYXJkZW4oe1xuICBbR0VUX01FVEhPRF9OQU1FU10oKSB7XG4gICAgcmV0dXJuIGdldE1ldGhvZE5hbWVzKHRoaXMpO1xuICB9XG59KVtHRVRfTUVUSE9EX05BTUVTXTtcbnZhciBnZXRNZXRob2ROYW1lc0Rlc2NyaXB0b3IgPSBoYXJkZW4oe1xuICB2YWx1ZTogZ2V0TWV0aG9kTmFtZXNNZXRob2QsXG4gIGVudW1lcmFibGU6IGZhbHNlLFxuICBjb25maWd1cmFibGU6IGZhbHNlLFxuICB3cml0YWJsZTogZmFsc2Vcbn0pO1xudmFyIEZhciA9IChmYXJOYW1lLCByZW1vdGFibGUgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgcjUgPSByZW1vdGFibGUgPT09IHZvaWQgMCA/IChcbiAgICAvKiAgICAgICAgICAgICovXG4gICAge31cbiAgKSA6IHJlbW90YWJsZTtcbiAgaWYgKHR5cGVvZiByNSA9PT0gXCJvYmplY3RcIiAmJiAhKEdFVF9NRVRIT0RfTkFNRVMgaW4gcjUpKSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHI1LCBHRVRfTUVUSE9EX05BTUVTLCBnZXRNZXRob2ROYW1lc0Rlc2NyaXB0b3IpO1xuICB9XG4gIHJldHVybiBSZW1vdGFibGUoYEFsbGVnZWQ6ICR7ZmFyTmFtZX1gLCB2b2lkIDAsIHI1KTtcbn07XG5oYXJkZW4oRmFyKTtcbnZhciBUb0ZhckZ1bmN0aW9uID0gKGZhck5hbWUsIGZ1bmMpID0+IHtcbiAgaWYgKGdldEludGVyZmFjZU9mKGZ1bmMpICE9PSB2b2lkIDApIHtcbiAgICByZXR1cm4gZnVuYztcbiAgfVxuICByZXR1cm4gRmFyKGZhck5hbWUsICguLi5hcmdzKSA9PiBmdW5jKC4uLmFyZ3MpKTtcbn07XG5oYXJkZW4oVG9GYXJGdW5jdGlvbik7XG5cbi8vXG52YXIgbWFwSXRlcmFibGUgPSAoYmFzZUl0ZXJhYmxlLCBmdW5jKSA9PiAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gIEZhcihcIm1hcHBlZCBpdGVyYWJsZVwiLCB7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGNvbnN0IGJhc2VJdGVyYXRvciA9IGJhc2VJdGVyYWJsZVtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICByZXR1cm4gRmFyKFwibWFwcGVkIGl0ZXJhdG9yXCIsIHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgdmFsdWU6IGJhc2VWYWx1ZSwgZG9uZSB9ID0gYmFzZUl0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IGRvbmUgPyBiYXNlVmFsdWUgOiBmdW5jKGJhc2VWYWx1ZSk7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IHZhbHVlLCBkb25lIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pXG4pO1xuaGFyZGVuKG1hcEl0ZXJhYmxlKTtcbnZhciBmaWx0ZXJJdGVyYWJsZSA9IChiYXNlSXRlcmFibGUsIHByZWQpID0+IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgRmFyKFwiZmlsdGVyZWQgaXRlcmFibGVcIiwge1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBjb25zdCBiYXNlSXRlcmF0b3IgPSBiYXNlSXRlcmFibGVbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgcmV0dXJuIEZhcihcImZpbHRlcmVkIGl0ZXJhdG9yXCIsIHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGZvciAoOyA7ICkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYmFzZUl0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgICAgIGNvbnN0IHsgdmFsdWUsIGRvbmUgfSA9IHJlc3VsdDtcbiAgICAgICAgICAgIGlmIChkb25lIHx8IHByZWQodmFsdWUpKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pXG4pO1xuaGFyZGVuKGZpbHRlckl0ZXJhYmxlKTtcblxuLy9cbnZhciB7IGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjUsIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM6IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnMzLCBoYXNPd246IGhhc093bjIsIGVudHJpZXM6IGVudHJpZXMyIH0gPSBPYmplY3Q7XG52YXIgZXJyb3JDb25zdHJ1Y3RvcnMgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcChcbiAgLy9cbiAgLy9cbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIFtcbiAgICBbXCJFcnJvclwiLCBFcnJvcl0sXG4gICAgW1wiRXZhbEVycm9yXCIsIEV2YWxFcnJvcl0sXG4gICAgW1wiUmFuZ2VFcnJvclwiLCBSYW5nZUVycm9yXSxcbiAgICBbXCJSZWZlcmVuY2VFcnJvclwiLCBSZWZlcmVuY2VFcnJvcl0sXG4gICAgW1wiU3ludGF4RXJyb3JcIiwgU3ludGF4RXJyb3JdLFxuICAgIFtcIlR5cGVFcnJvclwiLCBUeXBlRXJyb3JdLFxuICAgIFtcIlVSSUVycm9yXCIsIFVSSUVycm9yXVxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gIF1cbik7XG5pZiAodHlwZW9mIEFnZ3JlZ2F0ZUVycm9yICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gIGVycm9yQ29uc3RydWN0b3JzLnNldChcIkFnZ3JlZ2F0ZUVycm9yXCIsIEFnZ3JlZ2F0ZUVycm9yKTtcbn1cbnZhciBnZXRFcnJvckNvbnN0cnVjdG9yID0gKG5hbWUpID0+IGVycm9yQ29uc3RydWN0b3JzLmdldChuYW1lKTtcbmhhcmRlbihnZXRFcnJvckNvbnN0cnVjdG9yKTtcbnZhciBjaGVja0Vycm9yTGlrZSA9IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiB7XG4gIHJldHVybiBjYW5kaWRhdGUgaW5zdGFuY2VvZiBFcnJvciB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBFcnJvciBleHBlY3RlZDogJHtjYW5kaWRhdGV9YDtcbn07XG5oYXJkZW4oY2hlY2tFcnJvckxpa2UpO1xudmFyIGlzRXJyb3JMaWtlID0gKGNhbmRpZGF0ZSkgPT4gY2hlY2tFcnJvckxpa2UoY2FuZGlkYXRlKTtcbmhhcmRlbihpc0Vycm9yTGlrZSk7XG52YXIgY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MgPSAocHJvcE5hbWUsIGRlc2MsIHBhc3NTdHlsZU9mUmVjdXIsIGNoZWNrID0gdm9pZCAwKSA9PiB7XG4gIGlmIChkZXNjLmVudW1lcmFibGUpIHtcbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgUGFzc2FibGUgRXJyb3IgJHtxdW90ZShcbiAgICAgIHByb3BOYW1lXG4gICAgKX0gb3duIHByb3BlcnR5IG11c3Qgbm90IGJlIGVudW1lcmFibGU6ICR7ZGVzY31gO1xuICB9XG4gIGlmICghaGFzT3duMihkZXNjLCBcInZhbHVlXCIpKSB7XG4gICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goY2hlY2spYFBhc3NhYmxlIEVycm9yICR7cXVvdGUoXG4gICAgICBwcm9wTmFtZVxuICAgICl9IG93biBwcm9wZXJ0eSBtdXN0IGJlIGEgZGF0YSBwcm9wZXJ0eTogJHtkZXNjfWA7XG4gIH1cbiAgY29uc3QgeyB2YWx1ZSB9ID0gZGVzYztcbiAgc3dpdGNoIChwcm9wTmFtZSkge1xuICAgIGNhc2UgXCJtZXNzYWdlXCI6XG4gICAgY2FzZSBcInN0YWNrXCI6IHtcbiAgICAgIHJldHVybiB0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgfHwgISFjaGVjayAmJiBDWChjaGVjaylgUGFzc2FibGUgRXJyb3IgJHtxdW90ZShcbiAgICAgICAgcHJvcE5hbWVcbiAgICAgICl9IG93biBwcm9wZXJ0eSBtdXN0IGJlIGEgc3RyaW5nOiAke3ZhbHVlfWA7XG4gICAgfVxuICAgIGNhc2UgXCJjYXVzZVwiOiB7XG4gICAgICByZXR1cm4gY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3IodmFsdWUsIHBhc3NTdHlsZU9mUmVjdXIsIGNoZWNrKTtcbiAgICB9XG4gICAgY2FzZSBcImVycm9yc1wiOiB7XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpIHx8IHBhc3NTdHlsZU9mUmVjdXIodmFsdWUpICE9PSBcImNvcHlBcnJheVwiKSB7XG4gICAgICAgIHJldHVybiAhIWNoZWNrICYmIENYKGNoZWNrKWBQYXNzYWJsZSBFcnJvciAke3F1b3RlKFxuICAgICAgICAgIHByb3BOYW1lXG4gICAgICAgICl9IG93biBwcm9wZXJ0eSBtdXN0IGJlIGEgY29weUFycmF5OiAke3ZhbHVlfWA7XG4gICAgICB9XG4gICAgICByZXR1cm4gdmFsdWUuZXZlcnkoXG4gICAgICAgIChlcnIpID0+IChcbiAgICAgICAgICAvL1xuICAgICAgICAgIGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yKGVyciwgcGFzc1N0eWxlT2ZSZWN1ciwgY2hlY2spXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgUGFzc2FibGUgRXJyb3IgaGFzIGV4dHJhIHVucGFzc2VkIHByb3BlcnR5ICR7cXVvdGUocHJvcE5hbWUpfWA7XG59O1xuaGFyZGVuKGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yUHJvcGVydHlEZXNjKTtcbnZhciBjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvciA9IChjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIsIGNoZWNrID0gdm9pZCAwKSA9PiB7XG4gIGlmICghY2hlY2tFcnJvckxpa2UoY2FuZGlkYXRlLCBjaGVjaykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgcHJvdG8gPSBnZXRQcm90b3R5cGVPZjUoY2FuZGlkYXRlKTtcbiAgY29uc3QgeyBuYW1lIH0gPSBwcm90bztcbiAgY29uc3QgZXJyQ29uc3RydWN0b3IgPSBnZXRFcnJvckNvbnN0cnVjdG9yKG5hbWUpO1xuICBpZiAoZXJyQ29uc3RydWN0b3IgPT09IHZvaWQgMCB8fCBlcnJDb25zdHJ1Y3Rvci5wcm90b3R5cGUgIT09IHByb3RvKSB7XG4gICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goXG4gICAgICBjaGVja1xuICAgIClgUGFzc2FibGUgRXJyb3IgbXVzdCBpbmhlcml0IGZyb20gYW4gZXJyb3IgY2xhc3MgLnByb3RvdHlwZTogJHtjYW5kaWRhdGV9YDtcbiAgfVxuICBjb25zdCBkZXNjcyA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnMzKGNhbmRpZGF0ZSk7XG4gIGlmICghKFwibWVzc2FnZVwiIGluIGRlc2NzKSkge1xuICAgIHJldHVybiAhIWNoZWNrICYmIENYKFxuICAgICAgY2hlY2tcbiAgICApYFBhc3NhYmxlIEVycm9yIG11c3QgaGF2ZSBhbiBvd24gXCJtZXNzYWdlXCIgc3RyaW5nIHByb3BlcnR5OiAke2NhbmRpZGF0ZX1gO1xuICB9XG4gIHJldHVybiBlbnRyaWVzMihkZXNjcykuZXZlcnkoXG4gICAgKFtwcm9wTmFtZSwgZGVzY10pID0+IGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yUHJvcGVydHlEZXNjKFxuICAgICAgcHJvcE5hbWUsXG4gICAgICBkZXNjLFxuICAgICAgcGFzc1N0eWxlT2ZSZWN1cixcbiAgICAgIGNoZWNrXG4gICAgKVxuICApO1xufTtcbmhhcmRlbihjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvcik7XG52YXIgRXJyb3JIZWxwZXIgPSBoYXJkZW4oe1xuICBzdHlsZU5hbWU6IFwiZXJyb3JcIixcbiAgY2FuQmVWYWxpZDogY2hlY2tFcnJvckxpa2UsXG4gIGFzc2VydFJlc3RWYWxpZDogKGNhbmRpZGF0ZSwgcGFzc1N0eWxlT2ZSZWN1cikgPT4gY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3IoY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyLCBhc3NlcnRDaGVja2VyKVxufSk7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzMyB9ID0gUmVmbGVjdDtcbnZhciB3ZWxsS25vd25TeW1ib2xOYW1lcyA9IG5ldyBNYXAoXG4gIG93bktleXMzKFN5bWJvbCkuZmlsdGVyKFxuICAgIChuYW1lKSA9PiB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIiAmJiB0eXBlb2YgU3ltYm9sW25hbWVdID09PSBcInN5bWJvbFwiXG4gICkuZmlsdGVyKChuYW1lKSA9PiB7XG4gICAgIW5hbWUuc3RhcnRzV2l0aChcIkBAXCIpIHx8IHRocm93UmVkYWN0ZWRgRGlkIG5vdCBleHBlY3QgU3ltYm9sIHRvIGhhdmUgYSBzeW1ib2wtdmFsdWVkIHByb3BlcnR5IG5hbWUgc3RhcnRpbmcgd2l0aCBcIkBAXCIgJHtxdW90ZShcbiAgICAgIG5hbWVcbiAgICApfWA7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0pLm1hcCgobmFtZSkgPT4gW1N5bWJvbFtuYW1lXSwgYEBAJHtuYW1lfWBdKVxuKTtcbnZhciBpc1Bhc3NhYmxlU3ltYm9sID0gKHN5bSkgPT4gdHlwZW9mIHN5bSA9PT0gXCJzeW1ib2xcIiAmJiAodHlwZW9mIFN5bWJvbC5rZXlGb3Ioc3ltKSA9PT0gXCJzdHJpbmdcIiB8fCB3ZWxsS25vd25TeW1ib2xOYW1lcy5oYXMoc3ltKSk7XG5oYXJkZW4oaXNQYXNzYWJsZVN5bWJvbCk7XG52YXIgYXNzZXJ0UGFzc2FibGVTeW1ib2wgPSAoc3ltKSA9PiBpc1Bhc3NhYmxlU3ltYm9sKHN5bSkgfHwgdGhyb3dSZWRhY3RlZGBPbmx5IHJlZ2lzdGVyZWQgc3ltYm9scyBvciB3ZWxsLWtub3duIHN5bWJvbHMgYXJlIHBhc3NhYmxlOiAke3F1b3RlKHN5bSl9YDtcbmhhcmRlbihhc3NlcnRQYXNzYWJsZVN5bWJvbCk7XG52YXIgbmFtZUZvclBhc3NhYmxlU3ltYm9sID0gKHN5bSkgPT4ge1xuICBjb25zdCBuYW1lID0gU3ltYm9sLmtleUZvcihzeW0pO1xuICBpZiAobmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHdlbGxLbm93blN5bWJvbE5hbWVzLmdldChzeW0pO1xuICB9XG4gIGlmIChuYW1lLnN0YXJ0c1dpdGgoXCJAQFwiKSkge1xuICAgIHJldHVybiBgQEAke25hbWV9YDtcbiAgfVxuICByZXR1cm4gbmFtZTtcbn07XG5oYXJkZW4obmFtZUZvclBhc3NhYmxlU3ltYm9sKTtcbnZhciBBdEF0UHJlZml4UGF0dGVybiA9IC9eQEAoLiopJC87XG5oYXJkZW4oQXRBdFByZWZpeFBhdHRlcm4pO1xudmFyIHBhc3NhYmxlU3ltYm9sRm9yTmFtZSA9IChuYW1lKSA9PiB7XG4gIGlmICh0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbiAgY29uc3QgbWF0Y2ggPSBBdEF0UHJlZml4UGF0dGVybi5leGVjKG5hbWUpO1xuICBpZiAobWF0Y2gpIHtcbiAgICBjb25zdCBzdWZmaXggPSBtYXRjaFsxXTtcbiAgICBpZiAoc3VmZml4LnN0YXJ0c1dpdGgoXCJAQFwiKSkge1xuICAgICAgcmV0dXJuIFN5bWJvbC5mb3Ioc3VmZml4KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3Qgc3ltID0gU3ltYm9sW3N1ZmZpeF07XG4gICAgICBpZiAodHlwZW9mIHN5bSA9PT0gXCJzeW1ib2xcIikge1xuICAgICAgICByZXR1cm4gc3ltO1xuICAgICAgfVxuICAgICAgdGhyb3dSZWRhY3RlZGBSZXNlcnZlZCBmb3Igd2VsbCBrbm93biBzeW1ib2wgJHtxdW90ZShzdWZmaXgpfTogJHtxdW90ZShuYW1lKX1gO1xuICAgIH1cbiAgfVxuICByZXR1cm4gU3ltYm9sLmZvcihuYW1lKTtcbn07XG5oYXJkZW4ocGFzc2FibGVTeW1ib2xGb3JOYW1lKTtcblxuLy9cbnZhciBoYXNXZWxsRm9ybWVkU3RyaW5nTWV0aG9kID0gISFTdHJpbmcucHJvdG90eXBlLmlzV2VsbEZvcm1lZDtcbnZhciBpc1dlbGxGb3JtZWRTdHJpbmcgPSBoYXNXZWxsRm9ybWVkU3RyaW5nTWV0aG9kID8gKHN0cikgPT4gdHlwZW9mIHN0ciA9PT0gXCJzdHJpbmdcIiAmJiBzdHIuaXNXZWxsRm9ybWVkKCkgOiAoc3RyKSA9PiB7XG4gIGlmICh0eXBlb2Ygc3RyICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGZvciAoY29uc3QgY2ggb2Ygc3RyKSB7XG4gICAgY29uc3QgY3AgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGNoLmNvZGVQb2ludEF0KDApXG4gICAgKTtcbiAgICBpZiAoY3AgPj0gNTUyOTYgJiYgY3AgPD0gNTczNDMpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuaGFyZGVuKGlzV2VsbEZvcm1lZFN0cmluZyk7XG52YXIgYXNzZXJ0V2VsbEZvcm1lZFN0cmluZyA9IChzdHIpID0+IHtcbiAgaXNXZWxsRm9ybWVkU3RyaW5nKHN0cikgfHwgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCB3ZWxsLWZvcm1lZCB1bmljb2RlIHN0cmluZzogJHtzdHJ9YDtcbn07XG5oYXJkZW4oYXNzZXJ0V2VsbEZvcm1lZFN0cmluZyk7XG52YXIgT05MWV9XRUxMX0ZPUk1FRF9TVFJJTkdTX1BBU1NBQkxFID0gZ2V0RW52aXJvbm1lbnRPcHRpb24oXCJPTkxZX1dFTExfRk9STUVEX1NUUklOR1NfUEFTU0FCTEVcIiwgXCJkaXNhYmxlZFwiLCBbXG4gIFwiZW5hYmxlZFwiXG5dKSA9PT0gXCJlbmFibGVkXCI7XG52YXIgYXNzZXJ0UGFzc2FibGVTdHJpbmcgPSAoc3RyKSA9PiB7XG4gIHR5cGVvZiBzdHIgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCBzdHJpbmcgJHtzdHJ9YDtcbiAgIU9OTFlfV0VMTF9GT1JNRURfU1RSSU5HU19QQVNTQUJMRSB8fCBhc3NlcnRXZWxsRm9ybWVkU3RyaW5nKHN0cik7XG59O1xuaGFyZGVuKGFzc2VydFBhc3NhYmxlU3RyaW5nKTtcblxuLy9cbnZhciBtYWtlUmVsZWFzaW5nRXhlY3V0b3JLaXQgPSAoKSA9PiB7XG4gIGxldCBpbnRlcm5hbFJlc29sdmU7XG4gIGxldCBpbnRlcm5hbFJlamVjdDtcbiAgY29uc3QgcmVzb2x2ZTIgPSAodmFsdWUpID0+IHtcbiAgICBpZiAoaW50ZXJuYWxSZXNvbHZlKSB7XG4gICAgICBpbnRlcm5hbFJlc29sdmUodmFsdWUpO1xuICAgICAgaW50ZXJuYWxSZXNvbHZlID0gbnVsbDtcbiAgICAgIGludGVybmFsUmVqZWN0ID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgYXNzZXJ0KGludGVybmFsUmVzb2x2ZSA9PT0gbnVsbCk7XG4gICAgfVxuICB9O1xuICBjb25zdCByZWplY3QgPSAocmVhc29uKSA9PiB7XG4gICAgaWYgKGludGVybmFsUmVqZWN0KSB7XG4gICAgICBpbnRlcm5hbFJlamVjdChyZWFzb24pO1xuICAgICAgaW50ZXJuYWxSZXNvbHZlID0gbnVsbDtcbiAgICAgIGludGVybmFsUmVqZWN0ID0gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgYXNzZXJ0KGludGVybmFsUmVqZWN0ID09PSBudWxsKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGV4ZWN1dG9yID0gKHJlcywgcmVqKSA9PiB7XG4gICAgYXNzZXJ0KGludGVybmFsUmVzb2x2ZSA9PT0gdm9pZCAwICYmIGludGVybmFsUmVqZWN0ID09PSB2b2lkIDApO1xuICAgIGludGVybmFsUmVzb2x2ZSA9IHJlcztcbiAgICBpbnRlcm5hbFJlamVjdCA9IHJlajtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QsIGV4ZWN1dG9yIH0pO1xufTtcbmhhcmRlbihtYWtlUmVsZWFzaW5nRXhlY3V0b3JLaXQpO1xuXG4vL1xudmFyIGlzT2JqZWN0MyA9ICh2YWx1ZSkgPT4gT2JqZWN0KHZhbHVlKSA9PT0gdmFsdWU7XG52YXIga25vd25Qcm9taXNlcyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xudmFyIG1hcmtTZXR0bGVkID0gKHJlY29yZCkgPT4ge1xuICBpZiAoIXJlY29yZCB8fCByZWNvcmQuc2V0dGxlZCkge1xuICAgIHJldHVybiAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICB9XG4gIGNvbnN0IHsgZGVmZXJyZWRzIH0gPSByZWNvcmQ7XG4gIE9iamVjdC5hc3NpZ24ocmVjb3JkLCB7XG4gICAgZGVmZXJyZWRzOiB2b2lkIDAsXG4gICAgc2V0dGxlZDogdHJ1ZVxuICB9KTtcbiAgT2JqZWN0LmZyZWV6ZShyZWNvcmQpO1xuICByZXR1cm4gZGVmZXJyZWRzO1xufTtcbnZhciBnZXRNZW1vUmVjb3JkID0gKHZhbHVlKSA9PiB7XG4gIGlmICghaXNPYmplY3QzKHZhbHVlKSkge1xuICAgIHJldHVybiBoYXJkZW4oeyBzZXR0bGVkOiB0cnVlIH0pO1xuICB9XG4gIGxldCByZWNvcmQgPSBrbm93blByb21pc2VzLmdldCh2YWx1ZSk7XG4gIGlmICghcmVjb3JkKSB7XG4gICAgcmVjb3JkID0geyBkZWZlcnJlZHM6IC8qICAgICAgICAgICAqLyBuZXcgU2V0KCksIHNldHRsZWQ6IGZhbHNlIH07XG4gICAga25vd25Qcm9taXNlcy5zZXQodmFsdWUsIHJlY29yZCk7XG4gICAgUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKFxuICAgICAgKHZhbCkgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IHsgcmVzb2x2ZTogcmVzb2x2ZTIgfSBvZiBtYXJrU2V0dGxlZChyZWNvcmQpKSB7XG4gICAgICAgICAgcmVzb2x2ZTIodmFsKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIChlcnIpID0+IHtcbiAgICAgICAgZm9yIChjb25zdCB7IHJlamVjdCB9IG9mIG1hcmtTZXR0bGVkKHJlY29yZCkpIHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHJlY29yZDtcbn07XG52YXIgeyByYWNlIH0gPSB7XG4gIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgKi9cbiAgcmFjZSh2YWx1ZXM2KSB7XG4gICAgbGV0IGRlZmVycmVkO1xuICAgIGNvbnN0IGNhY2hlZFZhbHVlcyA9IFtdO1xuICAgIGNvbnN0IEMgPSB0aGlzO1xuICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBDKChyZXNvbHZlMiwgcmVqZWN0KSA9PiB7XG4gICAgICBkZWZlcnJlZCA9IHsgcmVzb2x2ZTogcmVzb2x2ZTIsIHJlamVjdCB9O1xuICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiB2YWx1ZXM2KSB7XG4gICAgICAgIGNhY2hlZFZhbHVlcy5wdXNoKHZhbHVlKTtcbiAgICAgICAgY29uc3QgeyBzZXR0bGVkLCBkZWZlcnJlZHMgfSA9IGdldE1lbW9SZWNvcmQodmFsdWUpO1xuICAgICAgICBpZiAoc2V0dGxlZCkge1xuICAgICAgICAgIEMucmVzb2x2ZSh2YWx1ZSkudGhlbihyZXNvbHZlMiwgcmVqZWN0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkZWZlcnJlZHMuYWRkKGRlZmVycmVkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQuZmluYWxseSgoKSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIGNhY2hlZFZhbHVlcykge1xuICAgICAgICBjb25zdCB7IGRlZmVycmVkcyB9ID0gZ2V0TWVtb1JlY29yZCh2YWx1ZSk7XG4gICAgICAgIGlmIChkZWZlcnJlZHMpIHtcbiAgICAgICAgICBkZWZlcnJlZHMuZGVsZXRlKGRlZmVycmVkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG59O1xuXG4vL1xuZnVuY3Rpb24gaXNQcm9taXNlKG1heWJlUHJvbWlzZSkge1xuICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG1heWJlUHJvbWlzZSkgPT09IG1heWJlUHJvbWlzZTtcbn1cbmhhcmRlbihpc1Byb21pc2UpO1xuXG4vL1xudmFyIEJlc3RQaXBlbGluYWJsZVByb21pc2UgPSBnbG9iYWxUaGlzLkhhbmRsZWRQcm9taXNlIHx8IFByb21pc2U7XG5mdW5jdGlvbiBtYWtlUHJvbWlzZUtpdCgpIHtcbiAgY29uc3QgeyByZXNvbHZlOiByZXNvbHZlMiwgcmVqZWN0LCBleGVjdXRvciB9ID0gbWFrZVJlbGVhc2luZ0V4ZWN1dG9yS2l0KCk7XG4gIGNvbnN0IHByb21pc2UgPSBuZXcgQmVzdFBpcGVsaW5hYmxlUHJvbWlzZShleGVjdXRvcik7XG4gIHJldHVybiBoYXJkZW4oeyBwcm9taXNlLCByZXNvbHZlOiByZXNvbHZlMiwgcmVqZWN0IH0pO1xufVxuaGFyZGVuKG1ha2VQcm9taXNlS2l0KTtcbmZ1bmN0aW9uIHJhY2VQcm9taXNlcyh2YWx1ZXM2KSB7XG4gIHJldHVybiBoYXJkZW4ocmFjZS5jYWxsKEJlc3RQaXBlbGluYWJsZVByb21pc2UsIHZhbHVlczYpKTtcbn1cbmhhcmRlbihyYWNlUHJvbWlzZXMpO1xuXG4vL1xudmFyIHsgZ2V0UHJvdG90eXBlT2Y6IGdldFByb3RvdHlwZU9mNiB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czQgfSA9IFJlZmxlY3Q7XG52YXIgeyBpc0FycmF5OiBpc0FycmF5MywgcHJvdG90eXBlOiBhcnJheVByb3RvdHlwZSB9ID0gQXJyYXk7XG52YXIgQ29weUFycmF5SGVscGVyID0gaGFyZGVuKHtcbiAgc3R5bGVOYW1lOiBcImNvcHlBcnJheVwiLFxuICBjYW5CZVZhbGlkOiAoY2FuZGlkYXRlLCBjaGVjayA9IHZvaWQgMCkgPT4gaXNBcnJheTMoY2FuZGlkYXRlKSB8fCAhIWNoZWNrICYmIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBBcnJheSBleHBlY3RlZDogJHtjYW5kaWRhdGV9YCksXG4gIGFzc2VydFJlc3RWYWxpZDogKGNhbmRpZGF0ZSwgcGFzc1N0eWxlT2ZSZWN1cikgPT4ge1xuICAgIGdldFByb3RvdHlwZU9mNihjYW5kaWRhdGUpID09PSBhcnJheVByb3RvdHlwZSB8fCBhc3NlcnQuZmFpbChyZWRhY3RlZGBNYWxmb3JtZWQgYXJyYXk6ICR7Y2FuZGlkYXRlfWAsIFR5cGVFcnJvcik7XG4gICAgY29uc3QgbGVuID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICBnZXRPd25EYXRhRGVzY3JpcHRvcihjYW5kaWRhdGUsIFwibGVuZ3RoXCIsIGZhbHNlLCBhc3NlcnRDaGVja2VyKS52YWx1ZVxuICAgICk7XG4gICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlbjsgaTIgKz0gMSkge1xuICAgICAgcGFzc1N0eWxlT2ZSZWN1cihcbiAgICAgICAgZ2V0T3duRGF0YURlc2NyaXB0b3IoY2FuZGlkYXRlLCBpMiwgdHJ1ZSwgYXNzZXJ0Q2hlY2tlcikudmFsdWVcbiAgICAgICk7XG4gICAgfVxuICAgIG93bktleXM0KGNhbmRpZGF0ZSkubGVuZ3RoID09PSBsZW4gKyAxIHx8IGFzc2VydC5mYWlsKHJlZGFjdGVkYEFycmF5cyBtdXN0IG5vdCBoYXZlIG5vbi1pbmRleGVzOiAke2NhbmRpZGF0ZX1gLCBUeXBlRXJyb3IpO1xuICB9XG59KTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXM1IH0gPSBSZWZsZWN0O1xudmFyIHsgZ2V0UHJvdG90eXBlT2Y6IGdldFByb3RvdHlwZU9mNywgcHJvdG90eXBlOiBvYmplY3RQcm90b3R5cGU0IH0gPSBPYmplY3Q7XG52YXIgY2hlY2tPYmplY3RQcm90b3R5cGUgPSAoY2FuZGlkYXRlLCBjaGVjayA9IHZvaWQgMCkgPT4ge1xuICByZXR1cm4gZ2V0UHJvdG90eXBlT2Y3KGNhbmRpZGF0ZSkgPT09IG9iamVjdFByb3RvdHlwZTQgfHwgISFjaGVjayAmJiBDWChjaGVjaylgUmVjb3JkcyBtdXN0IGluaGVyaXQgZnJvbSBPYmplY3QucHJvdG90eXBlOiAke2NhbmRpZGF0ZX1gO1xufTtcbnZhciBjaGVja1Byb3BlcnR5Q2FuQmVWYWxpZCA9IChjYW5kaWRhdGUsIGtleSwgdmFsdWUsIGNoZWNrID0gdm9pZCAwKSA9PiB7XG4gIHJldHVybiAodHlwZW9mIGtleSA9PT0gXCJzdHJpbmdcIiB8fCAhIWNoZWNrICYmIENYKFxuICAgIGNoZWNrXG4gIClgUmVjb3JkcyBjYW4gb25seSBoYXZlIHN0cmluZy1uYW1lZCBwcm9wZXJ0aWVzOiAke2NhbmRpZGF0ZX1gKSAmJiAoIWNhbkJlTWV0aG9kKHZhbHVlKSB8fCAhIWNoZWNrICYmIC8vXG4gIENYKFxuICAgIGNoZWNrXG4gIClgUmVjb3JkcyBjYW5ub3QgY29udGFpbiBub24tZmFyIGZ1bmN0aW9ucyBiZWNhdXNlIHRoZXkgbWF5IGJlIG1ldGhvZHMgb2YgYW4gaW1wbGljaXQgUmVtb3RhYmxlOiAke2NhbmRpZGF0ZX1gKTtcbn07XG52YXIgQ29weVJlY29yZEhlbHBlciA9IGhhcmRlbih7XG4gIHN0eWxlTmFtZTogXCJjb3B5UmVjb3JkXCIsXG4gIGNhbkJlVmFsaWQ6IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiB7XG4gICAgcmV0dXJuIGNoZWNrT2JqZWN0UHJvdG90eXBlKGNhbmRpZGF0ZSwgY2hlY2spICYmIC8vXG4gICAgLy9cbiAgICBvd25LZXlzNShjYW5kaWRhdGUpLmV2ZXJ5KFxuICAgICAgKGtleSkgPT4gY2hlY2tQcm9wZXJ0eUNhbkJlVmFsaWQoY2FuZGlkYXRlLCBrZXksIGNhbmRpZGF0ZVtrZXldLCBjaGVjaylcbiAgICApO1xuICB9LFxuICBhc3NlcnRSZXN0VmFsaWQ6IChjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIpID0+IHtcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2Ygb3duS2V5czUoY2FuZGlkYXRlKSkge1xuICAgICAgY29uc3QgeyB2YWx1ZSB9ID0gZ2V0T3duRGF0YURlc2NyaXB0b3IoXG4gICAgICAgIGNhbmRpZGF0ZSxcbiAgICAgICAgbmFtZSxcbiAgICAgICAgdHJ1ZSxcbiAgICAgICAgYXNzZXJ0Q2hlY2tlclxuICAgICAgKTtcbiAgICAgIHBhc3NTdHlsZU9mUmVjdXIodmFsdWUpO1xuICAgIH1cbiAgfVxufSk7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzNiB9ID0gUmVmbGVjdDtcbnZhciB7IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM6IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM0IH0gPSBPYmplY3Q7XG52YXIgVGFnZ2VkSGVscGVyID0gaGFyZGVuKHtcbiAgc3R5bGVOYW1lOiBcInRhZ2dlZFwiLFxuICBjYW5CZVZhbGlkOiAoY2FuZGlkYXRlLCBjaGVjayA9IHZvaWQgMCkgPT4gY2hlY2tQYXNzU3R5bGUoY2FuZGlkYXRlLCBjYW5kaWRhdGVbUEFTU19TVFlMRV0sIFwidGFnZ2VkXCIsIGNoZWNrKSxcbiAgYXNzZXJ0UmVzdFZhbGlkOiAoY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyKSA9PiB7XG4gICAgY2hlY2tUYWdSZWNvcmQoY2FuZGlkYXRlLCBcInRhZ2dlZFwiLCBhc3NlcnRDaGVja2VyKTtcbiAgICBjb25zdCBwYXNzU3R5bGVLZXkgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICBQQVNTX1NUWUxFXG4gICAgKTtcbiAgICBjb25zdCB0YWdLZXkgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICBTeW1ib2wudG9TdHJpbmdUYWdcbiAgICApO1xuICAgIGNvbnN0IHtcbiAgICAgIC8vXG4gICAgICBbXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBwYXNzU3R5bGVLZXlcbiAgICAgIF06IF9wYXNzU3R5bGVEZXNjLFxuICAgICAgW1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdGFnS2V5XG4gICAgICBdOiBfbGFiZWxEZXNjLFxuICAgICAgcGF5bG9hZDogX3BheWxvYWREZXNjLFxuICAgICAgLy9cbiAgICAgIC4uLnJlc3REZXNjc1xuICAgIH0gPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNChjYW5kaWRhdGUpO1xuICAgIG93bktleXM2KHJlc3REZXNjcykubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCBwcm9wZXJ0aWVzIG9uIHRhZ2dlZCByZWNvcmQgJHtvd25LZXlzNihyZXN0RGVzY3MpfWA7XG4gICAgcGFzc1N0eWxlT2ZSZWN1cihcbiAgICAgIGdldE93bkRhdGFEZXNjcmlwdG9yKGNhbmRpZGF0ZSwgXCJwYXlsb2FkXCIsIHRydWUsIGFzc2VydENoZWNrZXIpLnZhbHVlXG4gICAgKTtcbiAgfVxufSk7XG5cbi8vXG52YXIgeyBpc0Zyb3plbjogaXNGcm96ZW40LCBnZXRQcm90b3R5cGVPZjogZ2V0UHJvdG90eXBlT2Y4LCBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6IGdldE93blByb3BlcnR5RGVzY3JpcHRvcjIgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IG93bktleXM3IH0gPSBSZWZsZWN0O1xudmFyIHsgdG9TdHJpbmdUYWcgfSA9IFN5bWJvbDtcbnZhciBjaGVja1Byb21pc2VPd25LZXlzID0gKHByLCBjaGVjaykgPT4ge1xuICBjb25zdCBrZXlzNCA9IG93bktleXM3KHByKTtcbiAgaWYgKGtleXM0Lmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IHVua25vd25LZXlzID0ga2V5czQuZmlsdGVyKFxuICAgIChrZXkpID0+IHR5cGVvZiBrZXkgIT09IFwic3ltYm9sXCIgfHwgIWhhc093blByb3BlcnR5T2YoUHJvbWlzZS5wcm90b3R5cGUsIGtleSlcbiAgKTtcbiAgaWYgKHVua25vd25LZXlzLmxlbmd0aCAhPT0gMCkge1xuICAgIHJldHVybiBDWChcbiAgICAgIGNoZWNrXG4gICAgKWAke3ByfSAtIE11c3Qgbm90IGhhdmUgYW55IG93biBwcm9wZXJ0aWVzOiAke3F1b3RlKHVua25vd25LZXlzKX1gO1xuICB9XG4gIGNvbnN0IGNoZWNrU2FmZU93bktleSA9IChrZXkpID0+IHtcbiAgICBpZiAoa2V5ID09PSB0b1N0cmluZ1RhZykge1xuICAgICAgY29uc3QgdGFnRGVzYyA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcjIocHIsIHRvU3RyaW5nVGFnKTtcbiAgICAgIGFzc2VydCh0YWdEZXNjICE9PSB2b2lkIDApO1xuICAgICAgcmV0dXJuIChoYXNPd25Qcm9wZXJ0eU9mKHRhZ0Rlc2MsIFwidmFsdWVcIikgfHwgQ1goXG4gICAgICAgIGNoZWNrXG4gICAgICApYE93biBAQHRvU3RyaW5nVGFnIG11c3QgYmUgYSBkYXRhIHByb3BlcnR5LCBub3QgYW4gYWNjZXNzb3I6ICR7cXVvdGUodGFnRGVzYyl9YCkgJiYgKHR5cGVvZiB0YWdEZXNjLnZhbHVlID09PSBcInN0cmluZ1wiIHx8IENYKFxuICAgICAgICBjaGVja1xuICAgICAgKWBPd24gQEB0b1N0cmluZ1RhZyB2YWx1ZSBtdXN0IGJlIGEgc3RyaW5nOiAke3F1b3RlKHRhZ0Rlc2MudmFsdWUpfWApICYmICghdGFnRGVzYy5lbnVtZXJhYmxlIHx8IENYKGNoZWNrKWBPd24gQEB0b1N0cmluZ1RhZyBtdXN0IG5vdCBiZSBlbnVtZXJhYmxlOiAke3F1b3RlKHRhZ0Rlc2MpfWApO1xuICAgIH1cbiAgICBjb25zdCB2YWwgPSBwcltrZXldO1xuICAgIGlmICh2YWwgPT09IHZvaWQgMCB8fCB0eXBlb2YgdmFsID09PSBcIm51bWJlclwiKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiB2YWwgPT09IFwib2JqZWN0XCIgJiYgdmFsICE9PSBudWxsICYmIGlzRnJvemVuNCh2YWwpICYmIGdldFByb3RvdHlwZU9mOCh2YWwpID09PSBPYmplY3QucHJvdG90eXBlKSB7XG4gICAgICBjb25zdCBzdWJLZXlzID0gb3duS2V5czcodmFsKTtcbiAgICAgIGlmIChzdWJLZXlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChzdWJLZXlzLmxlbmd0aCA9PT0gMSAmJiBzdWJLZXlzWzBdID09PSBcImRlc3Ryb3llZFwiICYmIHZhbC5kZXN0cm95ZWQgPT09IGZhbHNlKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gQ1goXG4gICAgICBjaGVja1xuICAgIClgVW5leHBlY3RlZCBOb2RlIGFzeW5jX2hvb2tzIGFkZGl0aW9ucyB0byBwcm9taXNlOiAke3ByfS4ke3F1b3RlKFxuICAgICAgU3RyaW5nKGtleSlcbiAgICApfSBpcyAke3ZhbH1gO1xuICB9O1xuICByZXR1cm4ga2V5czQuZXZlcnkoY2hlY2tTYWZlT3duS2V5KTtcbn07XG52YXIgY2hlY2tTYWZlUHJvbWlzZSA9IChwciwgY2hlY2spID0+IHtcbiAgcmV0dXJuIChpc0Zyb3plbjQocHIpIHx8IENYKGNoZWNrKWAke3ByfSAtIE11c3QgYmUgZnJvemVuYCkgJiYgKGlzUHJvbWlzZShwcikgfHwgQ1goY2hlY2spYCR7cHJ9IC0gTXVzdCBiZSBhIHByb21pc2VgKSAmJiAoZ2V0UHJvdG90eXBlT2Y4KHByKSA9PT0gUHJvbWlzZS5wcm90b3R5cGUgfHwgQ1goY2hlY2spYCR7cHJ9IC0gTXVzdCBpbmhlcml0IGZyb20gUHJvbWlzZS5wcm90b3R5cGU6ICR7cXVvdGUoXG4gICAgZ2V0UHJvdG90eXBlT2Y4KHByKVxuICApfWApICYmIGNoZWNrUHJvbWlzZU93bktleXMoXG4gICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgIHByLFxuICAgIGNoZWNrXG4gICk7XG59O1xuaGFyZGVuKGNoZWNrU2FmZVByb21pc2UpO1xudmFyIGlzU2FmZVByb21pc2UgPSAocHIpID0+IGNoZWNrU2FmZVByb21pc2UocHIsICh4KSA9PiB4KTtcbmhhcmRlbihpc1NhZmVQcm9taXNlKTtcbnZhciBhc3NlcnRTYWZlUHJvbWlzZSA9IChwcikgPT4gY2hlY2tTYWZlUHJvbWlzZShwciwgYXNzZXJ0Q2hlY2tlcik7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzOCB9ID0gUmVmbGVjdDtcbnZhciB7IGlzRnJvemVuOiBpc0Zyb3plbjUsIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM6IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM1LCB2YWx1ZXMgfSA9IE9iamVjdDtcbnZhciBtYWtlSGVscGVyVGFibGUgPSAocGFzc1N0eWxlSGVscGVycykgPT4ge1xuICBjb25zdCBIZWxwZXJUYWJsZSA9IHtcbiAgICBfX3Byb3RvX186IG51bGwsXG4gICAgY29weUFycmF5OiB2b2lkIDAsXG4gICAgY29weVJlY29yZDogdm9pZCAwLFxuICAgIHRhZ2dlZDogdm9pZCAwLFxuICAgIGVycm9yOiB2b2lkIDAsXG4gICAgcmVtb3RhYmxlOiB2b2lkIDBcbiAgfTtcbiAgZm9yIChjb25zdCBoZWxwZXIgb2YgcGFzc1N0eWxlSGVscGVycykge1xuICAgIGNvbnN0IHsgc3R5bGVOYW1lIH0gPSBoZWxwZXI7XG4gICAgc3R5bGVOYW1lIGluIEhlbHBlclRhYmxlIHx8IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIGhlbHBlcjogJHtxdW90ZShzdHlsZU5hbWUpfWA7XG4gICAgSGVscGVyVGFibGVbc3R5bGVOYW1lXSA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgY29uZmxpY3RpbmcgaGVscGVycyBmb3IgJHtxdW90ZShzdHlsZU5hbWUpfWA7XG4gICAgSGVscGVyVGFibGVbc3R5bGVOYW1lXSA9IGhlbHBlcjtcbiAgfVxuICBmb3IgKGNvbnN0IHN0eWxlTmFtZSBvZiBvd25LZXlzOChIZWxwZXJUYWJsZSkpIHtcbiAgICBIZWxwZXJUYWJsZVtzdHlsZU5hbWVdICE9PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBtaXNzaW5nIGhlbHBlciBmb3IgJHtxdW90ZShzdHlsZU5hbWUpfWA7XG4gIH1cbiAgcmV0dXJuIGhhcmRlbihIZWxwZXJUYWJsZSk7XG59O1xudmFyIGFzc2VydFZhbGlkID0gKGhlbHBlciwgY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyKSA9PiB7XG4gIGhlbHBlci5jYW5CZVZhbGlkKGNhbmRpZGF0ZSwgYXNzZXJ0Q2hlY2tlcik7XG4gIGhlbHBlci5hc3NlcnRSZXN0VmFsaWQoY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyKTtcbn07XG52YXIgbWFrZVBhc3NTdHlsZU9mID0gKHBhc3NTdHlsZUhlbHBlcnMpID0+IHtcbiAgY29uc3QgSGVscGVyVGFibGUgPSBtYWtlSGVscGVyVGFibGUocGFzc1N0eWxlSGVscGVycyk7XG4gIGNvbnN0IHJlbW90YWJsZUhlbHBlciA9IEhlbHBlclRhYmxlLnJlbW90YWJsZTtcbiAgY29uc3QgcGFzc1N0eWxlTWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCBwYXNzU3R5bGVPZjIgPSAocGFzc2FibGUpID0+IHtcbiAgICBjb25zdCBpblByb2dyZXNzID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgICBjb25zdCBwYXNzU3R5bGVPZlJlY3VyID0gKGlubmVyKSA9PiB7XG4gICAgICBjb25zdCBpbm5lcklzT2JqZWN0ID0gaXNPYmplY3QyKGlubmVyKTtcbiAgICAgIGlmIChpbm5lcklzT2JqZWN0KSB7XG4gICAgICAgIGNvbnN0IGlubmVyU3R5bGUgPSBwYXNzU3R5bGVNZW1vLmdldChpbm5lcik7XG4gICAgICAgIGlmIChpbm5lclN0eWxlKSB7XG4gICAgICAgICAgcmV0dXJuIGlubmVyU3R5bGU7XG4gICAgICAgIH1cbiAgICAgICAgIWluUHJvZ3Jlc3MuaGFzKGlubmVyKSB8fCB0aHJvd1JlZGFjdGVkYFBhc3MtYnktY29weSBkYXRhIGNhbm5vdCBiZSBjeWNsaWMgJHtpbm5lcn1gO1xuICAgICAgICBpblByb2dyZXNzLmFkZChpbm5lcik7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZkludGVybmFsKGlubmVyKTtcbiAgICAgIGlmIChpbm5lcklzT2JqZWN0KSB7XG4gICAgICAgIHBhc3NTdHlsZU1lbW8uc2V0KGlubmVyLCBwYXNzU3R5bGUpO1xuICAgICAgICBpblByb2dyZXNzLmRlbGV0ZShpbm5lcik7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGFzc1N0eWxlO1xuICAgIH07XG4gICAgY29uc3QgcGFzc1N0eWxlT2ZJbnRlcm5hbCA9IChpbm5lcikgPT4ge1xuICAgICAgY29uc3QgdHlwZXN0ciA9IHR5cGVvZiBpbm5lcjtcbiAgICAgIHN3aXRjaCAodHlwZXN0cikge1xuICAgICAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgICAgIGNhc2UgXCJib29sZWFuXCI6XG4gICAgICAgIGNhc2UgXCJudW1iZXJcIjpcbiAgICAgICAgY2FzZSBcImJpZ2ludFwiOiB7XG4gICAgICAgICAgcmV0dXJuIHR5cGVzdHI7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgICAgYXNzZXJ0UGFzc2FibGVTdHJpbmcoaW5uZXIpO1xuICAgICAgICAgIHJldHVybiBcInN0cmluZ1wiO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgICAgIGFzc2VydFBhc3NhYmxlU3ltYm9sKGlubmVyKTtcbiAgICAgICAgICByZXR1cm4gXCJzeW1ib2xcIjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwib2JqZWN0XCI6IHtcbiAgICAgICAgICBpZiAoaW5uZXIgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBcIm51bGxcIjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFpc0Zyb3plbjUoaW5uZXIpKSB7XG4gICAgICAgICAgICBhc3NlcnQuZmFpbChcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgaXNUeXBlZEFycmF5KGlubmVyKSA/IHJlZGFjdGVkYENhbm5vdCBwYXNzIG11dGFibGUgdHlwZWQgYXJyYXlzIGxpa2UgJHtpbm5lcn0uYCA6IHJlZGFjdGVkYENhbm5vdCBwYXNzIG5vbi1mcm96ZW4gb2JqZWN0cyBsaWtlICR7aW5uZXJ9LiBVc2UgaGFyZGVuKClgXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaXNQcm9taXNlKGlubmVyKSkge1xuICAgICAgICAgICAgYXNzZXJ0U2FmZVByb21pc2UoaW5uZXIpO1xuICAgICAgICAgICAgcmV0dXJuIFwicHJvbWlzZVwiO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0eXBlb2YgaW5uZXIudGhlbiAhPT0gXCJmdW5jdGlvblwiIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHBhc3Mgbm9uLXByb21pc2UgdGhlbmFibGVzYDtcbiAgICAgICAgICBjb25zdCBwYXNzU3R5bGVUYWcgPSBpbm5lcltQQVNTX1NUWUxFXTtcbiAgICAgICAgICBpZiAocGFzc1N0eWxlVGFnICE9PSB2b2lkIDApIHtcbiAgICAgICAgICAgIGFzc2VydC50eXBlb2YocGFzc1N0eWxlVGFnLCBcInN0cmluZ1wiKTtcbiAgICAgICAgICAgIGNvbnN0IGhlbHBlciA9IEhlbHBlclRhYmxlW3Bhc3NTdHlsZVRhZ107XG4gICAgICAgICAgICBoZWxwZXIgIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYFVucmVjb2duaXplZCBQYXNzU3R5bGU6ICR7cXVvdGUocGFzc1N0eWxlVGFnKX1gO1xuICAgICAgICAgICAgYXNzZXJ0VmFsaWQoaGVscGVyLCBpbm5lciwgcGFzc1N0eWxlT2ZSZWN1cik7XG4gICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgcGFzc1N0eWxlVGFnXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3IgKGNvbnN0IGhlbHBlciBvZiBwYXNzU3R5bGVIZWxwZXJzKSB7XG4gICAgICAgICAgICBpZiAoaGVscGVyLmNhbkJlVmFsaWQoaW5uZXIpKSB7XG4gICAgICAgICAgICAgIGhlbHBlci5hc3NlcnRSZXN0VmFsaWQoaW5uZXIsIHBhc3NTdHlsZU9mUmVjdXIpO1xuICAgICAgICAgICAgICByZXR1cm4gaGVscGVyLnN0eWxlTmFtZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgYXNzZXJ0VmFsaWQocmVtb3RhYmxlSGVscGVyLCBpbm5lciwgcGFzc1N0eWxlT2ZSZWN1cik7XG4gICAgICAgICAgcmV0dXJuIFwicmVtb3RhYmxlXCI7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImZ1bmN0aW9uXCI6IHtcbiAgICAgICAgICBpc0Zyb3plbjUoaW5uZXIpIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHBhc3Mgbm9uLWZyb3plbiBvYmplY3RzIGxpa2UgJHtpbm5lcn0uIFVzZSBoYXJkZW4oKWA7XG4gICAgICAgICAgdHlwZW9mIGlubmVyLnRoZW4gIT09IFwiZnVuY3Rpb25cIiB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCBwYXNzIG5vbi1wcm9taXNlIHRoZW5hYmxlc2A7XG4gICAgICAgICAgYXNzZXJ0VmFsaWQocmVtb3RhYmxlSGVscGVyLCBpbm5lciwgcGFzc1N0eWxlT2ZSZWN1cik7XG4gICAgICAgICAgcmV0dXJuIFwicmVtb3RhYmxlXCI7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRocm93IGFzc2VydC5mYWlsKHJlZGFjdGVkYFVucmVjb2duaXplZCB0eXBlb2YgJHtxdW90ZSh0eXBlc3RyKX1gLCBUeXBlRXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gcGFzc1N0eWxlT2ZSZWN1cihwYXNzYWJsZSk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4ocGFzc1N0eWxlT2YyKTtcbn07XG52YXIgUGFzc1N0eWxlT2ZFbmRvd21lbnRTeW1ib2wgPSBTeW1ib2wuZm9yKFwiQGVuZG8gcGFzc1N0eWxlT2ZcIik7XG52YXIgcGFzc1N0eWxlT2YgPSBnbG9iYWxUaGlzICYmIGdsb2JhbFRoaXNbUGFzc1N0eWxlT2ZFbmRvd21lbnRTeW1ib2xdIHx8IG1ha2VQYXNzU3R5bGVPZihbXG4gIENvcHlBcnJheUhlbHBlcixcbiAgQ29weVJlY29yZEhlbHBlcixcbiAgVGFnZ2VkSGVscGVyLFxuICBFcnJvckhlbHBlcixcbiAgUmVtb3RhYmxlSGVscGVyXG5dKTtcbnZhciBhc3NlcnRQYXNzYWJsZSA9ICh2YWwpID0+IHtcbiAgcGFzc1N0eWxlT2YodmFsKTtcbn07XG5oYXJkZW4oYXNzZXJ0UGFzc2FibGUpO1xudmFyIGlzUGFzc2FibGUgPSAoc3BlY2ltZW4pID0+IHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gcGFzc1N0eWxlT2Yoc3BlY2ltZW4pICE9PSB2b2lkIDA7XG4gIH0gY2F0Y2ggKF8pIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5oYXJkZW4oaXNQYXNzYWJsZSk7XG52YXIgaXNQYXNzYWJsZUVycm9yUHJvcGVydHlEZXNjID0gKG5hbWUsIGRlc2MpID0+IGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yUHJvcGVydHlEZXNjKG5hbWUsIGRlc2MsIHBhc3NTdHlsZU9mKTtcbnZhciB0b1Bhc3NhYmxlRXJyb3IgPSAoZXJyKSA9PiB7XG4gIGhhcmRlbihlcnIpO1xuICBpZiAoY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3IoZXJyLCBwYXNzU3R5bGVPZikpIHtcbiAgICByZXR1cm4gZXJyO1xuICB9XG4gIGNvbnN0IHsgbmFtZSwgbWVzc2FnZSB9ID0gZXJyO1xuICBjb25zdCB7IGNhdXNlOiBjYXVzZURlc2MsIGVycm9yczogZXJyb3JzRGVzYyB9ID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczUoZXJyKTtcbiAgbGV0IGNhdXNlO1xuICBsZXQgZXJyb3JzO1xuICBpZiAoY2F1c2VEZXNjICYmIGlzUGFzc2FibGVFcnJvclByb3BlcnR5RGVzYyhcImNhdXNlXCIsIGNhdXNlRGVzYykpIHtcbiAgICBjYXVzZSA9IGNhdXNlRGVzYy52YWx1ZTtcbiAgfVxuICBpZiAoZXJyb3JzRGVzYyAmJiBpc1Bhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MoXCJlcnJvcnNcIiwgZXJyb3JzRGVzYykpIHtcbiAgICBlcnJvcnMgPSBlcnJvcnNEZXNjLnZhbHVlO1xuICB9XG4gIGNvbnN0IGVyckNvbnN0cnVjdG9yID0gZ2V0RXJyb3JDb25zdHJ1Y3RvcihgJHtuYW1lfWApIHx8IEVycm9yO1xuICBjb25zdCBuZXdFcnJvciA9IG1ha2VFcnJvcihgJHttZXNzYWdlfWAsIGVyckNvbnN0cnVjdG9yLCB7XG4gICAgLy9cbiAgICBjYXVzZSxcbiAgICBlcnJvcnNcbiAgfSk7XG4gIGhhcmRlbihuZXdFcnJvcik7XG4gIG5vdGUobmV3RXJyb3IsIHJlZGFjdGVkYGNvcGllZCBmcm9tIGVycm9yICR7ZXJyfWApO1xuICBwYXNzU3R5bGVPZihuZXdFcnJvcikgPT09IFwiZXJyb3JcIiB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkICR7bmV3RXJyb3J9IHRvIGJlIGEgcGFzc2FibGUgZXJyb3JgO1xuICByZXR1cm4gbmV3RXJyb3I7XG59O1xuaGFyZGVuKHRvUGFzc2FibGVFcnJvcik7XG52YXIgdG9UaHJvd2FibGUgPSAoc3BlY2ltZW4pID0+IHtcbiAgaGFyZGVuKHNwZWNpbWVuKTtcbiAgaWYgKGlzRXJyb3JMaWtlKHNwZWNpbWVuKSkge1xuICAgIHJldHVybiB0b1Bhc3NhYmxlRXJyb3IoXG4gICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgc3BlY2ltZW5cbiAgICApO1xuICB9XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHNwZWNpbWVuKTtcbiAgaWYgKGlzT2JqZWN0MihzcGVjaW1lbikpIHtcbiAgICBzd2l0Y2ggKHBhc3NTdHlsZSkge1xuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIGNvbnN0IGVsZW1lbnRzID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHNwZWNpbWVuXG4gICAgICAgICk7XG4gICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbGVtZW50cykge1xuICAgICAgICAgIGVsZW1lbnQgPT09IHRvVGhyb3dhYmxlKGVsZW1lbnQpIHx8IHRocm93UmVkYWN0ZWRgbmVzdGVkIHRvVGhyb3dhYmxlIGNvZXJjaW9uIG5vdCB5ZXQgc3VwcG9ydGVkICR7ZWxlbWVudH1gO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICBjb25zdCByZWMgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHNwZWNpbWVuXG4gICAgICAgICk7XG4gICAgICAgIGZvciAoY29uc3QgdmFsIG9mIHZhbHVlcyhyZWMpKSB7XG4gICAgICAgICAgdmFsID09PSB0b1Rocm93YWJsZSh2YWwpIHx8IHRocm93UmVkYWN0ZWRgbmVzdGVkIHRvVGhyb3dhYmxlIGNvZXJjaW9uIG5vdCB5ZXQgc3VwcG9ydGVkICR7dmFsfWA7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgY29uc3QgdGcgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHNwZWNpbWVuXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHsgcGF5bG9hZCB9ID0gdGc7XG4gICAgICAgIHBheWxvYWQgPT09IHRvVGhyb3dhYmxlKHBheWxvYWQpIHx8IHRocm93UmVkYWN0ZWRgbmVzdGVkIHRvVGhyb3dhYmxlIGNvZXJjaW9uIG5vdCB5ZXQgc3VwcG9ydGVkICR7cGF5bG9hZH1gO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgIGNvbnN0IGVyID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgc3BlY2ltZW5cbiAgICAgICAgKTtcbiAgICAgICAgZXIgPT09IHRvVGhyb3dhYmxlKGVyKSB8fCB0aHJvd1JlZGFjdGVkYG5lc3RlZCB0b1Rocm93YWJsZSBjb2VyY2lvbiBub3QgeWV0IHN1cHBvcnRlZCAke2VyfWA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEEgJHtxdW90ZShwYXNzU3R5bGUpfSBpcyBub3QgdGhyb3dhYmxlOiAke3NwZWNpbWVufWA7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgc3BlY2ltZW5cbiAgKTtcbn07XG5oYXJkZW4odG9UaHJvd2FibGUpO1xuXG4vL1xudmFyIHsgY3JlYXRlOiBjcmVhdGUyLCBwcm90b3R5cGU6IG9iamVjdFByb3RvdHlwZTUgfSA9IE9iamVjdDtcbnZhciBtYWtlVGFnZ2VkID0gKHRhZywgcGF5bG9hZCkgPT4ge1xuICB0eXBlb2YgdGFnID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgVGhlIHRhZyBvZiBhIHRhZ2dlZCByZWNvcmQgbXVzdCBiZSBhIHN0cmluZzogJHt0YWd9YDtcbiAgYXNzZXJ0UGFzc2FibGUoaGFyZGVuKHBheWxvYWQpKTtcbiAgcmV0dXJuIGhhcmRlbihcbiAgICBjcmVhdGUyKG9iamVjdFByb3RvdHlwZTUsIHtcbiAgICAgIFtQQVNTX1NUWUxFXTogeyB2YWx1ZTogXCJ0YWdnZWRcIiB9LFxuICAgICAgW1N5bWJvbC50b1N0cmluZ1RhZ106IHsgdmFsdWU6IHRhZyB9LFxuICAgICAgcGF5bG9hZDogeyB2YWx1ZTogcGF5bG9hZCwgZW51bWVyYWJsZTogdHJ1ZSB9XG4gICAgfSlcbiAgKTtcbn07XG5oYXJkZW4obWFrZVRhZ2dlZCk7XG5cbi8vXG52YXIgaXNDb3B5QXJyYXkgPSAoYXJyKSA9PiBwYXNzU3R5bGVPZihhcnIpID09PSBcImNvcHlBcnJheVwiO1xuaGFyZGVuKGlzQ29weUFycmF5KTtcbnZhciBpc1JlY29yZCA9IChyZWNvcmQpID0+IHBhc3NTdHlsZU9mKHJlY29yZCkgPT09IFwiY29weVJlY29yZFwiO1xuaGFyZGVuKGlzUmVjb3JkKTtcbnZhciBpc1JlbW90YWJsZSA9IChyZW1vdGFibGUpID0+IHBhc3NTdHlsZU9mKHJlbW90YWJsZSkgPT09IFwicmVtb3RhYmxlXCI7XG5oYXJkZW4oaXNSZW1vdGFibGUpO1xudmFyIGFzc2VydENvcHlBcnJheSA9IChhcnIsIG9wdE5hbWVPZkFycmF5ID0gXCJBbGxlZ2VkIGFycmF5XCIpID0+IHtcbiAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YoYXJyKTtcbiAgcGFzc1N0eWxlID09PSBcImNvcHlBcnJheVwiIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShvcHROYW1lT2ZBcnJheSl9ICR7YXJyfSBtdXN0IGJlIGEgcGFzcy1ieS1jb3B5IGFycmF5LCBub3QgJHtxdW90ZShcbiAgICBwYXNzU3R5bGVcbiAgKX1gO1xufTtcbmhhcmRlbihhc3NlcnRDb3B5QXJyYXkpO1xudmFyIGFzc2VydFJlY29yZCA9IChyZWNvcmQsIG9wdE5hbWVPZlJlY29yZCA9IFwiQWxsZWdlZCByZWNvcmRcIikgPT4ge1xuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihyZWNvcmQpO1xuICBwYXNzU3R5bGUgPT09IFwiY29weVJlY29yZFwiIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShvcHROYW1lT2ZSZWNvcmQpfSAke3JlY29yZH0gbXVzdCBiZSBhIHBhc3MtYnktY29weSByZWNvcmQsIG5vdCAke3F1b3RlKFxuICAgIHBhc3NTdHlsZVxuICApfWA7XG59O1xuaGFyZGVuKGFzc2VydFJlY29yZCk7XG52YXIgYXNzZXJ0UmVtb3RhYmxlID0gKHJlbW90YWJsZSwgb3B0TmFtZU9mUmVtb3RhYmxlID0gXCJBbGxlZ2VkIHJlbW90YWJsZVwiKSA9PiB7XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHJlbW90YWJsZSk7XG4gIHBhc3NTdHlsZSA9PT0gXCJyZW1vdGFibGVcIiB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUob3B0TmFtZU9mUmVtb3RhYmxlKX0gJHtyZW1vdGFibGV9IG11c3QgYmUgYSByZW1vdGFibGUsIG5vdCAke3F1b3RlKFxuICAgIHBhc3NTdHlsZVxuICApfWA7XG59O1xuaGFyZGVuKGFzc2VydFJlbW90YWJsZSk7XG5cbi8vXG52YXIgaGlkZGVuUHJpb3JFcnJvcjtcbnZhciBoaWRkZW5DdXJyZW50VHVybiA9IDA7XG52YXIgaGlkZGVuQ3VycmVudEV2ZW50ID0gMDtcbnZhciBWRVJCT1NFID0gZW52aXJvbm1lbnRPcHRpb25zTGlzdEhhcyhcIkRFQlVHXCIsIFwidHJhY2stdHVybnNcIik7XG52YXIgRU5BQkxFRCA9IGdldEVudmlyb25tZW50T3B0aW9uKFwiVFJBQ0tfVFVSTlNcIiwgXCJkaXNhYmxlZFwiLCBbXCJlbmFibGVkXCJdKSA9PT0gXCJlbmFibGVkXCI7XG52YXIgYWRkUmVqZWN0aW9uTm90ZSA9IChkZXRhaWxzTm90ZSkgPT4gKHJlYXNvbikgPT4ge1xuICBpZiAocmVhc29uIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICBnbG9iYWxUaGlzLmFzc2VydC5ub3RlKHJlYXNvbiwgZGV0YWlsc05vdGUpO1xuICB9XG4gIGlmIChWRVJCT1NFKSB7XG4gICAgY29uc29sZS5sb2coXCJSRUpFQ1RFRCBhdCB0b3Agb2YgZXZlbnQgbG9vcFwiLCByZWFzb24pO1xuICB9XG59O1xudmFyIHdyYXBGdW5jdGlvbiA9IChmdW5jLCBzZW5kaW5nRXJyb3IsIFg1KSA9PiAoLi4uYXJncykgPT4ge1xuICBoaWRkZW5QcmlvckVycm9yID0gc2VuZGluZ0Vycm9yO1xuICBoaWRkZW5DdXJyZW50VHVybiArPSAxO1xuICBoaWRkZW5DdXJyZW50RXZlbnQgPSAwO1xuICB0cnkge1xuICAgIGxldCByZXN1bHQ7XG4gICAgdHJ5IHtcbiAgICAgIHJlc3VsdCA9IGZ1bmMoLi4uYXJncyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoZXJyIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgZ2xvYmFsVGhpcy5hc3NlcnQubm90ZShcbiAgICAgICAgICBlcnIsXG4gICAgICAgICAgWDVgVGhyb3duIGZyb206ICR7aGlkZGVuUHJpb3JFcnJvcn06JHtoaWRkZW5DdXJyZW50VHVybn0uJHtoaWRkZW5DdXJyZW50RXZlbnR9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKFZFUkJPU0UpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJUSFJPV04gdG8gdG9wIG9mIGV2ZW50IGxvb3BcIiwgZXJyKTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgY29uc3QgZGV0YWlsc05vdGUgPSBYNWBSZWplY3Rpb24gZnJvbTogJHtoaWRkZW5QcmlvckVycm9yfToke2hpZGRlbkN1cnJlbnRUdXJufS4ke2hpZGRlbkN1cnJlbnRFdmVudH1gO1xuICAgIFByb21pc2UucmVzb2x2ZShyZXN1bHQpLmNhdGNoKGFkZFJlamVjdGlvbk5vdGUoZGV0YWlsc05vdGUpKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9IGZpbmFsbHkge1xuICAgIGhpZGRlblByaW9yRXJyb3IgPSB2b2lkIDA7XG4gIH1cbn07XG52YXIgdHJhY2tUdXJucyA9IChmdW5jcykgPT4ge1xuICBpZiAoIUVOQUJMRUQgfHwgdHlwZW9mIGdsb2JhbFRoaXMgPT09IFwidW5kZWZpbmVkXCIgfHwgIWdsb2JhbFRoaXMuYXNzZXJ0KSB7XG4gICAgcmV0dXJuIGZ1bmNzO1xuICB9XG4gIGNvbnN0IHsgZGV0YWlsczogWDUsIG5vdGU6IGFubm90YXRlRXJyb3IgfSA9IGdsb2JhbFRoaXMuYXNzZXJ0O1xuICBoaWRkZW5DdXJyZW50RXZlbnQgKz0gMTtcbiAgY29uc3Qgc2VuZGluZ0Vycm9yID0gRXJyb3IoXG4gICAgYEV2ZW50OiAke2hpZGRlbkN1cnJlbnRUdXJufS4ke2hpZGRlbkN1cnJlbnRFdmVudH1gXG4gICk7XG4gIGlmIChoaWRkZW5QcmlvckVycm9yICE9PSB2b2lkIDApIHtcbiAgICBhbm5vdGF0ZUVycm9yKHNlbmRpbmdFcnJvciwgWDVgQ2F1c2VkIGJ5OiAke2hpZGRlblByaW9yRXJyb3J9YCk7XG4gIH1cbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICovXG4gICAgZnVuY3MubWFwKChmdW5jKSA9PiBmdW5jICYmIHdyYXBGdW5jdGlvbihmdW5jLCBzZW5kaW5nRXJyb3IsIFg1KSlcbiAgKTtcbn07XG5cbi8vXG52YXIgeyBkZXRhaWxzOiBYMiwgcXVvdGU6IHE0LCBGYWlsOiBGYWlsNCwgZXJyb3I6IG1ha2VFcnJvcjIgfSA9IGFzc2VydDtcbnZhciB7IGFzc2lnbiwgZnJlZXplOiBmcmVlemU0IH0gPSBPYmplY3Q7XG52YXIgb25TZW5kID0gbWFrZU1lc3NhZ2VCcmVha3BvaW50VGVzdGVyKFwiRU5ET19TRU5EX0JSRUFLUE9JTlRTXCIpO1xudmFyIGJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIgPSB7XG4gIHNldChfdGFyZ2V0LCBfcHJvcCwgX3ZhbHVlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBpc0V4dGVuc2libGUoX3RhcmdldCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgc2V0UHJvdG90eXBlT2YoX3RhcmdldCwgX3ZhbHVlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBkZWxldGVQcm9wZXJ0eShfdGFyZ2V0LCBfcHJvcCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcbnZhciBtYWtlRVByb3h5SGFuZGxlciA9IChyZWNpcGllbnQsIEhhbmRsZWRQcm9taXNlMikgPT4gaGFyZGVuKHtcbiAgLi4uYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlcixcbiAgZ2V0OiAoX3RhcmdldCwgcHJvcGVydHlLZXksIHJlY2VpdmVyKSA9PiB7XG4gICAgcmV0dXJuIGhhcmRlbihcbiAgICAgIHtcbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIFtwcm9wZXJ0eUtleV0oLi4uYXJncykge1xuICAgICAgICAgIGlmICh0aGlzICE9PSByZWNlaXZlcikge1xuICAgICAgICAgICAgcmV0dXJuIEhhbmRsZWRQcm9taXNlMi5yZWplY3QoXG4gICAgICAgICAgICAgIG1ha2VFcnJvcjIoXG4gICAgICAgICAgICAgICAgWDJgVW5leHBlY3RlZCByZWNlaXZlciBmb3IgXCIke3E0KHByb3BlcnR5S2V5KX1cIiBtZXRob2Qgb2YgRSgke3E0KFxuICAgICAgICAgICAgICAgICAgcmVjaXBpZW50XG4gICAgICAgICAgICAgICAgKX0pYFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob25TZW5kICYmIG9uU2VuZC5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgcHJvcGVydHlLZXkpKSB7XG4gICAgICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIEhhbmRsZWRQcm9taXNlMi5hcHBseU1ldGhvZChyZWNpcGllbnQsIHByb3BlcnR5S2V5LCBhcmdzKTtcbiAgICAgICAgfVxuICAgICAgICAvL1xuICAgICAgfVtwcm9wZXJ0eUtleV1cbiAgICApO1xuICB9LFxuICBhcHBseTogKF90YXJnZXQsIF90aGlzQXJnLCBhcmdBcnJheSA9IFtdKSA9PiB7XG4gICAgaWYgKG9uU2VuZCAmJiBvblNlbmQuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHZvaWQgMCkpIHtcbiAgICAgIGRlYnVnZ2VyO1xuICAgIH1cbiAgICByZXR1cm4gSGFuZGxlZFByb21pc2UyLmFwcGx5RnVuY3Rpb24ocmVjaXBpZW50LCBhcmdBcnJheSk7XG4gIH0sXG4gIGhhczogKF90YXJnZXQsIF9wKSA9PiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn0pO1xudmFyIG1ha2VFU2VuZE9ubHlQcm94eUhhbmRsZXIgPSAocmVjaXBpZW50LCBIYW5kbGVkUHJvbWlzZTIpID0+IGhhcmRlbih7XG4gIC4uLmJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIsXG4gIGdldDogKF90YXJnZXQsIHByb3BlcnR5S2V5LCByZWNlaXZlcikgPT4ge1xuICAgIHJldHVybiBoYXJkZW4oXG4gICAgICB7XG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIFtwcm9wZXJ0eUtleV0oLi4uYXJncykge1xuICAgICAgICAgIHRoaXMgPT09IHJlY2VpdmVyIHx8IEZhaWw0YFVuZXhwZWN0ZWQgcmVjZWl2ZXIgZm9yIFwiJHtxNChcbiAgICAgICAgICAgIHByb3BlcnR5S2V5XG4gICAgICAgICAgKX1cIiBtZXRob2Qgb2YgRS5zZW5kT25seSgke3E0KHJlY2lwaWVudCl9KWA7XG4gICAgICAgICAgaWYgKG9uU2VuZCAmJiBvblNlbmQuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHByb3BlcnR5S2V5KSkge1xuICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgfVxuICAgICAgICAgIEhhbmRsZWRQcm9taXNlMi5hcHBseU1ldGhvZFNlbmRPbmx5KHJlY2lwaWVudCwgcHJvcGVydHlLZXksIGFyZ3MpO1xuICAgICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgIH1bcHJvcGVydHlLZXldXG4gICAgKTtcbiAgfSxcbiAgYXBwbHk6IChfdGFyZ2V0LCBfdGhpc0FyZywgYXJnc0FycmF5ID0gW10pID0+IHtcbiAgICBpZiAob25TZW5kICYmIG9uU2VuZC5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgdm9pZCAwKSkge1xuICAgICAgZGVidWdnZXI7XG4gICAgfVxuICAgIEhhbmRsZWRQcm9taXNlMi5hcHBseUZ1bmN0aW9uU2VuZE9ubHkocmVjaXBpZW50LCBhcmdzQXJyYXkpO1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH0sXG4gIGhhczogKF90YXJnZXQsIF9wKSA9PiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn0pO1xudmFyIG1ha2VFR2V0UHJveHlIYW5kbGVyID0gKHgsIEhhbmRsZWRQcm9taXNlMikgPT4gaGFyZGVuKHtcbiAgLi4uYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlcixcbiAgaGFzOiAoX3RhcmdldCwgX3Byb3ApID0+IHRydWUsXG4gIGdldDogKF90YXJnZXQsIHByb3ApID0+IEhhbmRsZWRQcm9taXNlMi5nZXQoeCwgcHJvcClcbn0pO1xudmFyIGZ1bmNUYXJnZXQgPSBmcmVlemU0KCgpID0+IHtcbn0pO1xudmFyIG9ialRhcmdldCA9IGZyZWV6ZTQoeyBfX3Byb3RvX186IG51bGwgfSk7XG52YXIgbWFrZUUgPSAoSGFuZGxlZFByb21pc2UyKSA9PiB7XG4gIHJldHVybiBoYXJkZW4oXG4gICAgYXNzaWduKFxuICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgLy9cbiAgICAgICh4KSA9PiBuZXcgUHJveHkoZnVuY1RhcmdldCwgbWFrZUVQcm94eUhhbmRsZXIoeCwgSGFuZGxlZFByb21pc2UyKSksXG4gICAgICB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICAvL1xuICAgICAgICBnZXQ6ICh4KSA9PiBuZXcgUHJveHkob2JqVGFyZ2V0LCBtYWtlRUdldFByb3h5SGFuZGxlcih4LCBIYW5kbGVkUHJvbWlzZTIpKSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgcmVzb2x2ZTogSGFuZGxlZFByb21pc2UyLnJlc29sdmUsXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHNlbmRPbmx5OiAoeCkgPT4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgbmV3IFByb3h5KGZ1bmNUYXJnZXQsIG1ha2VFU2VuZE9ubHlQcm94eUhhbmRsZXIoeCwgSGFuZGxlZFByb21pc2UyKSlcbiAgICAgICAgKSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgd2hlbjogKHgsIG9uZnVsZmlsbGVkLCBvbnJlamVjdGVkKSA9PiBIYW5kbGVkUHJvbWlzZTIucmVzb2x2ZSh4KS50aGVuKFxuICAgICAgICAgIC4uLnRyYWNrVHVybnMoW29uZnVsZmlsbGVkLCBvbnJlamVjdGVkXSlcbiAgICAgICAgKVxuICAgICAgfVxuICAgIClcbiAgKTtcbn07XG52YXIgRV9kZWZhdWx0ID0gbWFrZUU7XG5cbi8vXG52YXIgaHAgPSBIYW5kbGVkUHJvbWlzZTtcbnZhciBFID0gRV9kZWZhdWx0KGhwKTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXM5IH0gPSBSZWZsZWN0O1xudmFyIHsgZnJvbUVudHJpZXMgfSA9IE9iamVjdDtcbnZhciBkZWVwbHlGdWxmaWxsZWQgPSBhc3luYyAodmFsKSA9PiB7XG4gIGlmICghaXNPYmplY3QyKHZhbCkpIHtcbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgdmFsXG4gICAgKTtcbiAgfVxuICBpZiAoaXNQcm9taXNlKHZhbCkpIHtcbiAgICByZXR1cm4gRS53aGVuKHZhbCwgKG5vbnApID0+IGRlZXBseUZ1bGZpbGxlZChub25wKSk7XG4gIH1cbiAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YodmFsKTtcbiAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICBjb25zdCByZWMgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApO1xuICAgICAgY29uc3QgbmFtZXMgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG93bktleXM5KHJlYylcbiAgICAgICk7XG4gICAgICBjb25zdCB2YWxQcyA9IG5hbWVzLm1hcCgobmFtZSkgPT4gZGVlcGx5RnVsZmlsbGVkKHJlY1tuYW1lXSkpO1xuICAgICAgcmV0dXJuIEUud2hlbihcbiAgICAgICAgUHJvbWlzZS5hbGwodmFsUHMpLFxuICAgICAgICAodmFscykgPT4gaGFyZGVuKGZyb21FbnRyaWVzKHZhbHMubWFwKChjMiwgaTIpID0+IFtuYW1lc1tpMl0sIGMyXSkpKVxuICAgICAgKTtcbiAgICB9XG4gICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICBjb25zdCBhcnIgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB2YWxcbiAgICAgICk7XG4gICAgICBjb25zdCB2YWxQcyA9IGFyci5tYXAoKHAzKSA9PiBkZWVwbHlGdWxmaWxsZWQocDMpKTtcbiAgICAgIHJldHVybiBFLndoZW4oUHJvbWlzZS5hbGwodmFsUHMpLCAodmFscykgPT4gaGFyZGVuKHZhbHMpKTtcbiAgICB9XG4gICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICBjb25zdCB0Z2QgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApO1xuICAgICAgY29uc3QgdGFnID0gZ2V0VGFnKHRnZCk7XG4gICAgICByZXR1cm4gRS53aGVuKFxuICAgICAgICBkZWVwbHlGdWxmaWxsZWQodGdkLnBheWxvYWQpLFxuICAgICAgICAocGF5bG9hZCkgPT4gbWFrZVRhZ2dlZCh0YWcsIHBheWxvYWQpXG4gICAgICApO1xuICAgIH1cbiAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgIGNvbnN0IHJlbSA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZhbFxuICAgICAgKTtcbiAgICAgIHJldHVybiByZW07XG4gICAgfVxuICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICBjb25zdCBlcnIgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZhbFxuICAgICAgKTtcbiAgICAgIHJldHVybiBlcnI7XG4gICAgfVxuICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgIGNvbnN0IHByb20gPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB2YWxcbiAgICAgICk7XG4gICAgICByZXR1cm4gRS53aGVuKHByb20sIChub25wKSA9PiBkZWVwbHlGdWxmaWxsZWQobm9ucCkpO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICB0aHJvdyBhc3NlcnQuZmFpbChyZWRhY3RlZGBVbmV4cGVjdGVkIHBhc3NTdHlsZSAke3F1b3RlKHBhc3NTdHlsZSl9YCwgVHlwZUVycm9yKTtcbiAgICB9XG4gIH1cbn07XG5oYXJkZW4oZGVlcGx5RnVsZmlsbGVkKTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXMxMCB9ID0gUmVmbGVjdDtcbnZhciB7IGlzQXJyYXk6IGlzQXJyYXk0IH0gPSBBcnJheTtcbnZhciB7XG4gIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM6IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM2LFxuICBkZWZpbmVQcm9wZXJ0aWVzLFxuICBpcyxcbiAgZW50cmllczogZW50cmllczMsXG4gIGZyb21FbnRyaWVzOiBmcm9tRW50cmllczIsXG4gIGZyZWV6ZTogZnJlZXplNVxufSA9IE9iamVjdDtcbnZhciBRQ0xBU1MgPSBcIkBxY2xhc3NcIjtcbnZhciBoYXNRQ2xhc3MgPSAoZW5jb2RlZCkgPT4gaGFzT3duUHJvcGVydHlPZihlbmNvZGVkLCBRQ0xBU1MpO1xudmFyIHFjbGFzc01hdGNoZXMgPSAoZW5jb2RlZCwgcWNsYXNzKSA9PiBpc09iamVjdDIoZW5jb2RlZCkgJiYgIWlzQXJyYXk0KGVuY29kZWQpICYmIGhhc1FDbGFzcyhlbmNvZGVkKSAmJiBlbmNvZGVkW1FDTEFTU10gPT09IHFjbGFzcztcbnZhciBkb250RW5jb2RlUmVtb3RhYmxlVG9DYXBEYXRhID0gKHJlbSkgPT4gdGhyb3dSZWRhY3RlZGByZW1vdGFibGUgdW5leHBlY3RlZDogJHtyZW19YDtcbnZhciBkb250RW5jb2RlUHJvbWlzZVRvQ2FwRGF0YSA9IChwcm9tKSA9PiB0aHJvd1JlZGFjdGVkYHByb21pc2UgdW5leHBlY3RlZDogJHtwcm9tfWA7XG52YXIgZG9udEVuY29kZUVycm9yVG9DYXBEYXRhID0gKGVycikgPT4gdGhyb3dSZWRhY3RlZGBlcnJvciBvYmplY3QgdW5leHBlY3RlZDogJHtlcnJ9YDtcbnZhciBtYWtlRW5jb2RlVG9DYXBEYXRhID0gKGVuY29kZU9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgZW5jb2RlUmVtb3RhYmxlVG9DYXBEYXRhID0gZG9udEVuY29kZVJlbW90YWJsZVRvQ2FwRGF0YSxcbiAgICBlbmNvZGVQcm9taXNlVG9DYXBEYXRhID0gZG9udEVuY29kZVByb21pc2VUb0NhcERhdGEsXG4gICAgZW5jb2RlRXJyb3JUb0NhcERhdGEgPSBkb250RW5jb2RlRXJyb3JUb0NhcERhdGFcbiAgfSA9IGVuY29kZU9wdGlvbnM7XG4gIGNvbnN0IGVuY29kZVRvQ2FwRGF0YVJlY3VyID0gKHBhc3NhYmxlKSA9PiB7XG4gICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocGFzc2FibGUpO1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwibnVsbFwiOlxuICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgIGNhc2UgXCJzdHJpbmdcIjoge1xuICAgICAgICByZXR1cm4gcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwidW5kZWZpbmVkXCI6IHtcbiAgICAgICAgcmV0dXJuIHsgW1FDTEFTU106IFwidW5kZWZpbmVkXCIgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJudW1iZXJcIjoge1xuICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKHBhc3NhYmxlKSkge1xuICAgICAgICAgIHJldHVybiB7IFtRQ0xBU1NdOiBcIk5hTlwiIH07XG4gICAgICAgIH0gZWxzZSBpZiAocGFzc2FibGUgPT09IEluZmluaXR5KSB7XG4gICAgICAgICAgcmV0dXJuIHsgW1FDTEFTU106IFwiSW5maW5pdHlcIiB9O1xuICAgICAgICB9IGVsc2UgaWYgKHBhc3NhYmxlID09PSAtSW5maW5pdHkpIHtcbiAgICAgICAgICByZXR1cm4geyBbUUNMQVNTXTogXCItSW5maW5pdHlcIiB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpcyhwYXNzYWJsZSwgLTApID8gMCA6IHBhc3NhYmxlO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJpZ2ludFwiOiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgW1FDTEFTU106IFwiYmlnaW50XCIsXG4gICAgICAgICAgZGlnaXRzOiBTdHJpbmcocGFzc2FibGUpXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgYXNzZXJ0UGFzc2FibGVTeW1ib2wocGFzc2FibGUpO1xuICAgICAgICBjb25zdCBuYW1lID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG5hbWVGb3JQYXNzYWJsZVN5bWJvbChwYXNzYWJsZSlcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBbUUNMQVNTXTogXCJzeW1ib2xcIixcbiAgICAgICAgICBuYW1lXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eU9mKHBhc3NhYmxlLCBRQ0xBU1MpKSB7XG4gICAgICAgICAgY29uc3QgeyBbUUNMQVNTXTogcWNsYXNzVmFsdWUsIC4uLnJlc3QgfSA9IHBhc3NhYmxlO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgICAgICAgIFtRQ0xBU1NdOiBcImhpbGJlcnRcIixcbiAgICAgICAgICAgIG9yaWdpbmFsOiBlbmNvZGVUb0NhcERhdGFSZWN1cihxY2xhc3NWYWx1ZSlcbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmIChvd25LZXlzMTAocmVzdCkubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICAgIHJlc3VsdC5yZXN0ID0gZW5jb2RlVG9DYXBEYXRhUmVjdXIoZnJlZXplNShyZXN0KSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbmFtZXMgPSBvd25LZXlzMTAocGFzc2FibGUpLnNvcnQoKTtcbiAgICAgICAgcmV0dXJuIGZyb21FbnRyaWVzMihcbiAgICAgICAgICBuYW1lcy5tYXAoKG5hbWUpID0+IFtuYW1lLCBlbmNvZGVUb0NhcERhdGFSZWN1cihwYXNzYWJsZVtuYW1lXSldKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIHJldHVybiBwYXNzYWJsZS5tYXAoZW5jb2RlVG9DYXBEYXRhUmVjdXIpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgW1FDTEFTU106IFwidGFnZ2VkXCIsXG4gICAgICAgICAgdGFnOiBnZXRUYWcocGFzc2FibGUpLFxuICAgICAgICAgIHBheWxvYWQ6IGVuY29kZVRvQ2FwRGF0YVJlY3VyKHBhc3NhYmxlLnBheWxvYWQpXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZVJlbW90YWJsZVRvQ2FwRGF0YShcbiAgICAgICAgICBwYXNzYWJsZSxcbiAgICAgICAgICBlbmNvZGVUb0NhcERhdGFSZWN1clxuICAgICAgICApO1xuICAgICAgICBpZiAocWNsYXNzTWF0Y2hlcyhlbmNvZGVkLCBcInNsb3RcIikpIHtcbiAgICAgICAgICByZXR1cm4gZW5jb2RlZDtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBSZW1vdGFibGUgZW5jb2RpbmcgbXVzdCBiZSBhbiBvYmplY3Qgd2l0aCAke3F1b3RlKFxuICAgICAgICAgIFFDTEFTU1xuICAgICAgICApfSAke3F1b3RlKFwic2xvdFwiKX06ICR7ZW5jb2RlZH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlUHJvbWlzZVRvQ2FwRGF0YShwYXNzYWJsZSwgZW5jb2RlVG9DYXBEYXRhUmVjdXIpO1xuICAgICAgICBpZiAocWNsYXNzTWF0Y2hlcyhlbmNvZGVkLCBcInNsb3RcIikpIHtcbiAgICAgICAgICByZXR1cm4gZW5jb2RlZDtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBQcm9taXNlIGVuY29kaW5nIG11c3QgYmUgYW4gb2JqZWN0IHdpdGggJHtxdW90ZShcbiAgICAgICAgICBRQ0xBU1MsXG4gICAgICAgICAgXCJzbG90XCJcbiAgICAgICAgKX06ICR7ZW5jb2RlZH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZUVycm9yVG9DYXBEYXRhKHBhc3NhYmxlLCBlbmNvZGVUb0NhcERhdGFSZWN1cik7XG4gICAgICAgIGlmIChxY2xhc3NNYXRjaGVzKGVuY29kZWQsIFwiZXJyb3JcIikpIHtcbiAgICAgICAgICByZXR1cm4gZW5jb2RlZDtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBFcnJvciBlbmNvZGluZyBtdXN0IGJlIGFuIG9iamVjdCB3aXRoICR7cXVvdGUoXG4gICAgICAgICAgUUNMQVNTLFxuICAgICAgICAgIFwiZXJyb3JcIlxuICAgICAgICApfTogJHtlbmNvZGVkfWA7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IGFzc2VydC5mYWlsKFxuICAgICAgICAgIHJlZGFjdGVkYGludGVybmFsOiBVbnJlY29nbml6ZWQgcGFzc1N0eWxlICR7cXVvdGUocGFzc1N0eWxlKX1gLFxuICAgICAgICAgIFR5cGVFcnJvclxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgZW5jb2RlVG9DYXBEYXRhID0gKHBhc3NhYmxlKSA9PiB7XG4gICAgaWYgKGlzRXJyb3JMaWtlKHBhc3NhYmxlKSkge1xuICAgICAgcmV0dXJuIGhhcmRlbihlbmNvZGVFcnJvclRvQ2FwRGF0YShwYXNzYWJsZSwgZW5jb2RlVG9DYXBEYXRhUmVjdXIpKTtcbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbihlbmNvZGVUb0NhcERhdGFSZWN1cihwYXNzYWJsZSkpO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKGVuY29kZVRvQ2FwRGF0YSk7XG59O1xuaGFyZGVuKG1ha2VFbmNvZGVUb0NhcERhdGEpO1xudmFyIGRvbnREZWNvZGVSZW1vdGFibGVPclByb21pc2VGcm9tQ2FwRGF0YSA9IChzbG90RW5jb2RpbmcpID0+IHRocm93UmVkYWN0ZWRgcmVtb3RhYmxlIG9yIHByb21pc2UgdW5leHBlY3RlZDogJHtzbG90RW5jb2Rpbmd9YDtcbnZhciBkb250RGVjb2RlRXJyb3JGcm9tQ2FwRGF0YSA9IChlcnJvckVuY29kaW5nKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIHVuZXhwZWN0ZWQ6ICR7ZXJyb3JFbmNvZGluZ31gO1xudmFyIG1ha2VEZWNvZGVGcm9tQ2FwRGF0YSA9IChkZWNvZGVPcHRpb25zID0ge30pID0+IHtcbiAgY29uc3Qge1xuICAgIGRlY29kZVJlbW90YWJsZUZyb21DYXBEYXRhID0gZG9udERlY29kZVJlbW90YWJsZU9yUHJvbWlzZUZyb21DYXBEYXRhLFxuICAgIGRlY29kZVByb21pc2VGcm9tQ2FwRGF0YSA9IGRvbnREZWNvZGVSZW1vdGFibGVPclByb21pc2VGcm9tQ2FwRGF0YSxcbiAgICBkZWNvZGVFcnJvckZyb21DYXBEYXRhID0gZG9udERlY29kZUVycm9yRnJvbUNhcERhdGFcbiAgfSA9IGRlY29kZU9wdGlvbnM7XG4gIGRlY29kZVJlbW90YWJsZUZyb21DYXBEYXRhID09PSBkZWNvZGVQcm9taXNlRnJvbUNhcERhdGEgfHwgdGhyb3dSZWRhY3RlZGBBbiBpbXBsZW1lbnRhdGlvbiByZXN0cmljdGlvbiBmb3Igbm93OiBJZiBlaXRoZXIgZGVjb2RlUmVtb3RhYmxlRnJvbUNhcERhdGEgb3IgZGVjb2RlUHJvbWlzZUZyb21DYXBEYXRhIGlzIHByb3ZpZGVkLCBib3RoIG11c3QgYmUgcHJvdmlkZWQgYW5kIHRoZXkgbXVzdCBiZSB0aGUgc2FtZTogJHtxdW90ZShcbiAgICBkZWNvZGVSZW1vdGFibGVGcm9tQ2FwRGF0YVxuICApfSB2cyAke3F1b3RlKGRlY29kZVByb21pc2VGcm9tQ2FwRGF0YSl9YDtcbiAgY29uc3QgZGVjb2RlRnJvbUNhcERhdGEgPSAoanNvbkVuY29kZWQpID0+IHtcbiAgICBpZiAoIWlzT2JqZWN0Mihqc29uRW5jb2RlZCkpIHtcbiAgICAgIHJldHVybiBqc29uRW5jb2RlZDtcbiAgICB9XG4gICAgaWYgKGlzQXJyYXk0KGpzb25FbmNvZGVkKSkge1xuICAgICAgcmV0dXJuIGpzb25FbmNvZGVkLm1hcCgoZW5jb2RlZFZhbCkgPT4gZGVjb2RlRnJvbUNhcERhdGEoZW5jb2RlZFZhbCkpO1xuICAgIH0gZWxzZSBpZiAoaGFzUUNsYXNzKGpzb25FbmNvZGVkKSkge1xuICAgICAgY29uc3QgcWNsYXNzID0ganNvbkVuY29kZWRbUUNMQVNTXTtcbiAgICAgIHR5cGVvZiBxY2xhc3MgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBpbnZhbGlkICR7cXVvdGUoUUNMQVNTKX0gdHlwZW9mICR7cXVvdGUodHlwZW9mIHFjbGFzcyl9YDtcbiAgICAgIHN3aXRjaCAocWNsYXNzKSB7XG4gICAgICAgIC8vXG4gICAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjoge1xuICAgICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcIk5hTlwiOiB7XG4gICAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiSW5maW5pdHlcIjoge1xuICAgICAgICAgIHJldHVybiBJbmZpbml0eTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiLUluZmluaXR5XCI6IHtcbiAgICAgICAgICByZXR1cm4gLUluZmluaXR5O1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJiaWdpbnRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgZGlnaXRzIH0gPSBqc29uRW5jb2RlZDtcbiAgICAgICAgICB0eXBlb2YgZGlnaXRzID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgaW52YWxpZCBkaWdpdHMgdHlwZW9mICR7cXVvdGUodHlwZW9mIGRpZ2l0cyl9YDtcbiAgICAgICAgICByZXR1cm4gQmlnSW50KGRpZ2l0cyk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcIkBAYXN5bmNJdGVyYXRvclwiOiB7XG4gICAgICAgICAgcmV0dXJuIFN5bWJvbC5hc3luY0l0ZXJhdG9yO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgICAgIGNvbnN0IHsgbmFtZSB9ID0ganNvbkVuY29kZWQ7XG4gICAgICAgICAgcmV0dXJuIHBhc3NhYmxlU3ltYm9sRm9yTmFtZShuYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgICBjb25zdCB7IHRhZywgcGF5bG9hZCB9ID0ganNvbkVuY29kZWQ7XG4gICAgICAgICAgcmV0dXJuIG1ha2VUYWdnZWQodGFnLCBkZWNvZGVGcm9tQ2FwRGF0YShwYXlsb2FkKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInNsb3RcIjoge1xuICAgICAgICAgIGNvbnN0IGRlY29kZWQgPSBkZWNvZGVSZW1vdGFibGVGcm9tQ2FwRGF0YShcbiAgICAgICAgICAgIGpzb25FbmNvZGVkLFxuICAgICAgICAgICAgZGVjb2RlRnJvbUNhcERhdGFcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiBkZWNvZGVkO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZUVycm9yRnJvbUNhcERhdGEoXG4gICAgICAgICAgICBqc29uRW5jb2RlZCxcbiAgICAgICAgICAgIGRlY29kZUZyb21DYXBEYXRhXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAocGFzc1N0eWxlT2YoZGVjb2RlZCkgPT09IFwiZXJyb3JcIikge1xuICAgICAgICAgICAgcmV0dXJuIGRlY29kZWQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGRlY29kZUVycm9yRnJvbUNhcERhdGEgb3B0aW9uIG11c3QgcmV0dXJuIGFuIGVycm9yOiAke2RlY29kZWR9YDtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiaGlsYmVydFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBvcmlnaW5hbCwgcmVzdCB9ID0ganNvbkVuY29kZWQ7XG4gICAgICAgICAgaGFzT3duUHJvcGVydHlPZihqc29uRW5jb2RlZCwgXCJvcmlnaW5hbFwiKSB8fCB0aHJvd1JlZGFjdGVkYEludmFsaWQgSGlsYmVydCBIb3RlbCBlbmNvZGluZyAke2pzb25FbmNvZGVkfWA7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0geyBbUUNMQVNTXTogZGVjb2RlRnJvbUNhcERhdGEob3JpZ2luYWwpIH07XG4gICAgICAgICAgaWYgKGhhc093blByb3BlcnR5T2YoanNvbkVuY29kZWQsIFwicmVzdFwiKSkge1xuICAgICAgICAgICAgY29uc3QgaXNOb25FbXB0eU9iamVjdCA9IHR5cGVvZiByZXN0ID09PSBcIm9iamVjdFwiICYmIHJlc3QgIT09IG51bGwgJiYgb3duS2V5czEwKHJlc3QpLmxlbmd0aCA+PSAxO1xuICAgICAgICAgICAgaWYgKCFpc05vbkVtcHR5T2JqZWN0KSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdCBlbmNvZGluZyBtdXN0IGJlIGEgbm9uLWVtcHR5IG9iamVjdDogJHtyZXN0fWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN0T2JqID0gZGVjb2RlRnJvbUNhcERhdGEocmVzdCk7XG4gICAgICAgICAgICAhaGFzT3duUHJvcGVydHlPZihyZXN0T2JqLCBRQ0xBU1MpIHx8IHRocm93UmVkYWN0ZWRgUmVzdCBtdXN0IG5vdCBjb250YWluIGl0cyBvd24gZGVmaW5pdGlvbiBvZiAke3F1b3RlKFFDTEFTUyl9YDtcbiAgICAgICAgICAgIGRlZmluZVByb3BlcnRpZXMocmVzdWx0LCBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNihyZXN0T2JqKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgICAgY2FzZSBcImliaWRcIjoge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgVGhlIGNhcERhdGEgcHJvdG9jb2wgbm8gbG9uZ2VyIHN1cHBvcnRzICR7cXVvdGUoUUNMQVNTKX0gJHtxdW90ZShcbiAgICAgICAgICAgIHFjbGFzc1xuICAgICAgICAgICl9YDtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgICByZWRhY3RlZGB1bnJlY29nbml6ZWQgJHtxdW90ZShRQ0xBU1MpfSAke3F1b3RlKHFjbGFzcyl9YCxcbiAgICAgICAgICAgIFR5cGVFcnJvclxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgYXNzZXJ0KHR5cGVvZiBqc29uRW5jb2RlZCA9PT0gXCJvYmplY3RcIiAmJiBqc29uRW5jb2RlZCAhPT0gbnVsbCk7XG4gICAgICBjb25zdCBkZWNvZGVFbnRyeSA9IChbbmFtZSwgZW5jb2RlZFZhbF0pID0+IHtcbiAgICAgICAgdHlwZW9mIG5hbWUgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBQcm9wZXJ0eSAke3F1b3RlKG5hbWUpfSBvZiAke2pzb25FbmNvZGVkfSBtdXN0IGJlIGEgc3RyaW5nYDtcbiAgICAgICAgcmV0dXJuIFtuYW1lLCBkZWNvZGVGcm9tQ2FwRGF0YShlbmNvZGVkVmFsKV07XG4gICAgICB9O1xuICAgICAgY29uc3QgZGVjb2RlZEVudHJpZXMgPSBlbnRyaWVzMyhqc29uRW5jb2RlZCkubWFwKGRlY29kZUVudHJ5KTtcbiAgICAgIHJldHVybiBmcm9tRW50cmllczIoZGVjb2RlZEVudHJpZXMpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGhhcmRlbihkZWNvZGVGcm9tQ2FwRGF0YSk7XG59O1xuXG4vL1xuZnVuY3Rpb24gaXNOYXQoYWxsZWdlZE51bSkge1xuICBpZiAodHlwZW9mIGFsbGVnZWROdW0gPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4gYWxsZWdlZE51bSA+PSAwO1xuICB9XG4gIGlmICh0eXBlb2YgYWxsZWdlZE51bSAhPT0gXCJudW1iZXJcIikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gTnVtYmVyLmlzU2FmZUludGVnZXIoYWxsZWdlZE51bSkgJiYgYWxsZWdlZE51bSA+PSAwO1xufVxuZnVuY3Rpb24gTmF0KGFsbGVnZWROdW0pIHtcbiAgaWYgKHR5cGVvZiBhbGxlZ2VkTnVtID09PSBcImJpZ2ludFwiKSB7XG4gICAgaWYgKGFsbGVnZWROdW0gPCAwbikge1xuICAgICAgdGhyb3cgUmFuZ2VFcnJvcihgJHthbGxlZ2VkTnVtfSBpcyBuZWdhdGl2ZWApO1xuICAgIH1cbiAgICByZXR1cm4gYWxsZWdlZE51bTtcbiAgfVxuICBpZiAodHlwZW9mIGFsbGVnZWROdW0gPT09IFwibnVtYmVyXCIpIHtcbiAgICBpZiAoIU51bWJlci5pc1NhZmVJbnRlZ2VyKGFsbGVnZWROdW0pKSB7XG4gICAgICB0aHJvdyBSYW5nZUVycm9yKGAke2FsbGVnZWROdW19IGlzIG5vdCBhIHNhZmUgaW50ZWdlcmApO1xuICAgIH1cbiAgICBpZiAoYWxsZWdlZE51bSA8IDApIHtcbiAgICAgIHRocm93IFJhbmdlRXJyb3IoYCR7YWxsZWdlZE51bX0gaXMgbmVnYXRpdmVgKTtcbiAgICB9XG4gICAgcmV0dXJuIEJpZ0ludChhbGxlZ2VkTnVtKTtcbiAgfVxuICB0aHJvdyBUeXBlRXJyb3IoXG4gICAgYCR7YWxsZWdlZE51bX0gaXMgYSAke3R5cGVvZiBhbGxlZ2VkTnVtfSBidXQgbXVzdCBiZSBhIGJpZ2ludCBvciBhIG51bWJlcmBcbiAgKTtcbn1cblxuLy9cbnZhciB7IGVudHJpZXM6IGVudHJpZXM0LCBmcm9tRW50cmllczogZnJvbUVudHJpZXMzIH0gPSBPYmplY3Q7XG52YXIgb2JqZWN0TWFwID0gKG9yaWdpbmFsLCBtYXBGbikgPT4ge1xuICBjb25zdCBlbnRzID0gZW50cmllczQob3JpZ2luYWwpO1xuICBjb25zdCBtYXBFbnRzID0gZW50cy5tYXAoXG4gICAgKFtrLCB2Ml0pID0+IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgW2ssIG1hcEZuKHYyLCBrKV1cbiAgICApXG4gICk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgaGFyZGVuKGZyb21FbnRyaWVzMyhtYXBFbnRzKSlcbiAgKTtcbn07XG5oYXJkZW4ob2JqZWN0TWFwKTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXMxMSB9ID0gUmVmbGVjdDtcbnZhciB7IGlzQXJyYXk6IGlzQXJyYXk1IH0gPSBBcnJheTtcbnZhciB7IGlzOiBpczIsIGVudHJpZXM6IGVudHJpZXM1LCBmcm9tRW50cmllczogZnJvbUVudHJpZXM0IH0gPSBPYmplY3Q7XG52YXIgQkFORyA9IFwiIVwiLmNoYXJDb2RlQXQoMCk7XG52YXIgREFTSCA9IFwiLVwiLmNoYXJDb2RlQXQoMCk7XG52YXIgc3RhcnRzU3BlY2lhbCA9IChlbmNvZGVkU3RyKSA9PiB7XG4gIGlmIChlbmNvZGVkU3RyID09PSBcIlwiKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IGNvZGUgPSBlbmNvZGVkU3RyLmNoYXJDb2RlQXQoMCk7XG4gIHJldHVybiBCQU5HIDw9IGNvZGUgJiYgY29kZSA8PSBEQVNIO1xufTtcbnZhciBkb250RW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMgPSAocmVtKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke3JlbX1gO1xudmFyIGRvbnRFbmNvZGVQcm9taXNlVG9TbWFsbGNhcHMgPSAocHJvbSkgPT4gdGhyb3dSZWRhY3RlZGBwcm9taXNlIHVuZXhwZWN0ZWQ6ICR7cHJvbX1gO1xudmFyIGRvbnRFbmNvZGVFcnJvclRvU21hbGxjYXBzID0gKGVycikgPT4gdGhyb3dSZWRhY3RlZGBlcnJvciBvYmplY3QgdW5leHBlY3RlZDogJHtxdW90ZShlcnIpfWA7XG52YXIgbWFrZUVuY29kZVRvU21hbGxjYXBzID0gKGVuY29kZU9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgZW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMgPSBkb250RW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMsXG4gICAgZW5jb2RlUHJvbWlzZVRvU21hbGxjYXBzID0gZG9udEVuY29kZVByb21pc2VUb1NtYWxsY2FwcyxcbiAgICBlbmNvZGVFcnJvclRvU21hbGxjYXBzID0gZG9udEVuY29kZUVycm9yVG9TbWFsbGNhcHNcbiAgfSA9IGVuY29kZU9wdGlvbnM7XG4gIGNvbnN0IGFzc2VydEVuY29kZWRFcnJvciA9IChlbmNvZGluZykgPT4ge1xuICAgIHR5cGVvZiBlbmNvZGluZyA9PT0gXCJvYmplY3RcIiAmJiBoYXNPd25Qcm9wZXJ0eU9mKGVuY29kaW5nLCBcIiNlcnJvclwiKSB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBFcnJvciBlbmNvZGluZyBtdXN0IGhhdmUgXCIjZXJyb3JcIiBwcm9wZXJ0eTogJHtxdW90ZShcbiAgICAgIGVuY29kaW5nXG4gICAgKX1gO1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBlbmNvZGluZ1tcIiNlcnJvclwiXTtcbiAgICB0eXBlb2YgbWVzc2FnZSA9PT0gXCJzdHJpbmdcIiAmJiAoIXN0YXJ0c1NwZWNpYWwobWVzc2FnZSkgfHwgbWVzc2FnZS5jaGFyQXQoMCkgPT09IFwiIVwiKSB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBFcnJvciBlbmNvZGluZyBtdXN0IGhhdmUgc3RyaW5nIG1lc3NhZ2U6ICR7cXVvdGUobWVzc2FnZSl9YDtcbiAgfTtcbiAgY29uc3QgZW5jb2RlVG9TbWFsbGNhcHNSZWN1ciA9IChwYXNzYWJsZSkgPT4ge1xuICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHBhc3NhYmxlKTtcbiAgICBzd2l0Y2ggKHBhc3NTdHlsZSkge1xuICAgICAgY2FzZSBcIm51bGxcIjpcbiAgICAgIGNhc2UgXCJib29sZWFuXCI6IHtcbiAgICAgICAgcmV0dXJuIHBhc3NhYmxlO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgIGlmIChzdGFydHNTcGVjaWFsKHBhc3NhYmxlKSkge1xuICAgICAgICAgIHJldHVybiBgISR7cGFzc2FibGV9YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwidW5kZWZpbmVkXCI6IHtcbiAgICAgICAgcmV0dXJuIFwiI3VuZGVmaW5lZFwiO1xuICAgICAgfVxuICAgICAgY2FzZSBcIm51bWJlclwiOiB7XG4gICAgICAgIGlmIChOdW1iZXIuaXNOYU4ocGFzc2FibGUpKSB7XG4gICAgICAgICAgcmV0dXJuIFwiI05hTlwiO1xuICAgICAgICB9IGVsc2UgaWYgKHBhc3NhYmxlID09PSBJbmZpbml0eSkge1xuICAgICAgICAgIHJldHVybiBcIiNJbmZpbml0eVwiO1xuICAgICAgICB9IGVsc2UgaWYgKHBhc3NhYmxlID09PSAtSW5maW5pdHkpIHtcbiAgICAgICAgICByZXR1cm4gXCIjLUluZmluaXR5XCI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzMihwYXNzYWJsZSwgLTApID8gMCA6IHBhc3NhYmxlO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJpZ2ludFwiOiB7XG4gICAgICAgIGNvbnN0IHN0ciA9IFN0cmluZyhwYXNzYWJsZSk7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgcGFzc2FibGUgPCAwbiA/IHN0ciA6IGArJHtzdHJ9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICAgIGFzc2VydFBhc3NhYmxlU3ltYm9sKHBhc3NhYmxlKTtcbiAgICAgICAgY29uc3QgbmFtZSA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBuYW1lRm9yUGFzc2FibGVTeW1ib2wocGFzc2FibGUpXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBgJSR7bmFtZX1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICBjb25zdCBuYW1lcyA9IG93bktleXMxMShwYXNzYWJsZSkuc29ydCgpO1xuICAgICAgICByZXR1cm4gZnJvbUVudHJpZXM0KFxuICAgICAgICAgIG5hbWVzLm1hcCgobmFtZSkgPT4gW1xuICAgICAgICAgICAgZW5jb2RlVG9TbWFsbGNhcHNSZWN1cihuYW1lKSxcbiAgICAgICAgICAgIGVuY29kZVRvU21hbGxjYXBzUmVjdXIocGFzc2FibGVbbmFtZV0pXG4gICAgICAgICAgXSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICByZXR1cm4gcGFzc2FibGUubWFwKGVuY29kZVRvU21hbGxjYXBzUmVjdXIpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgXCIjdGFnXCI6IGVuY29kZVRvU21hbGxjYXBzUmVjdXIoZ2V0VGFnKHBhc3NhYmxlKSksXG4gICAgICAgICAgcGF5bG9hZDogZW5jb2RlVG9TbWFsbGNhcHNSZWN1cihwYXNzYWJsZS5wYXlsb2FkKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGVuY29kZVJlbW90YWJsZVRvU21hbGxjYXBzKFxuICAgICAgICAgIHBhc3NhYmxlLFxuICAgICAgICAgIGVuY29kZVRvU21hbGxjYXBzUmVjdXJcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHR5cGVvZiByZXN1bHQgPT09IFwic3RyaW5nXCIgJiYgcmVzdWx0LmNoYXJBdCgwKSA9PT0gXCIkXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFJlbW90YWJsZSBlbmNvZGluZyBtdXN0IHN0YXJ0IHdpdGggXCIkXCI6ICR7cmVzdWx0fWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGVuY29kZVByb21pc2VUb1NtYWxsY2FwcyhcbiAgICAgICAgICBwYXNzYWJsZSxcbiAgICAgICAgICBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyXG4gICAgICAgICk7XG4gICAgICAgIGlmICh0eXBlb2YgcmVzdWx0ID09PSBcInN0cmluZ1wiICYmIHJlc3VsdC5jaGFyQXQoMCkgPT09IFwiJlwiKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBQcm9taXNlIGVuY29kaW5nIG11c3Qgc3RhcnQgd2l0aCBcIiZcIjogJHtyZXN1bHR9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGVuY29kZUVycm9yVG9TbWFsbGNhcHMocGFzc2FibGUsIGVuY29kZVRvU21hbGxjYXBzUmVjdXIpO1xuICAgICAgICBhc3NlcnRFbmNvZGVkRXJyb3IocmVzdWx0KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgcmVkYWN0ZWRgaW50ZXJuYWw6IFVucmVjb2duaXplZCBwYXNzU3R5bGUgJHtxdW90ZShwYXNzU3R5bGUpfWAsXG4gICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBlbmNvZGVUb1NtYWxsY2FwcyA9IChwYXNzYWJsZSkgPT4ge1xuICAgIGlmIChpc0Vycm9yTGlrZShwYXNzYWJsZSkpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGhhcmRlbihcbiAgICAgICAgZW5jb2RlRXJyb3JUb1NtYWxsY2FwcyhwYXNzYWJsZSwgZW5jb2RlVG9TbWFsbGNhcHNSZWN1cilcbiAgICAgICk7XG4gICAgICBhc3NlcnRFbmNvZGVkRXJyb3IocmVzdWx0KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oZW5jb2RlVG9TbWFsbGNhcHNSZWN1cihwYXNzYWJsZSkpO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKGVuY29kZVRvU21hbGxjYXBzKTtcbn07XG5oYXJkZW4obWFrZUVuY29kZVRvU21hbGxjYXBzKTtcbnZhciBkb250RGVjb2RlUmVtb3RhYmxlRnJvbVNtYWxsY2FwcyA9IChlbmNvZGluZykgPT4gdGhyb3dSZWRhY3RlZGByZW1vdGFibGUgdW5leHBlY3RlZDogJHtlbmNvZGluZ31gO1xudmFyIGRvbnREZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyA9IChlbmNvZGluZykgPT4gdGhyb3dSZWRhY3RlZGBwcm9taXNlIHVuZXhwZWN0ZWQ6ICR7ZW5jb2Rpbmd9YDtcbnZhciBkb250RGVjb2RlRXJyb3JGcm9tU21hbGxjYXBzID0gKGVuY29kaW5nKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIHVuZXhwZWN0ZWQ6ICR7cXVvdGUoZW5jb2RpbmcpfWA7XG52YXIgbWFrZURlY29kZUZyb21TbWFsbGNhcHMgPSAoZGVjb2RlT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBkZWNvZGVSZW1vdGFibGVGcm9tU21hbGxjYXBzID0gZG9udERlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMsXG4gICAgZGVjb2RlUHJvbWlzZUZyb21TbWFsbGNhcHMgPSBkb250RGVjb2RlUHJvbWlzZUZyb21TbWFsbGNhcHMsXG4gICAgZGVjb2RlRXJyb3JGcm9tU21hbGxjYXBzID0gZG9udERlY29kZUVycm9yRnJvbVNtYWxsY2Fwc1xuICB9ID0gZGVjb2RlT3B0aW9ucztcbiAgY29uc3QgZGVjb2RlRnJvbVNtYWxsY2FwcyA9IChlbmNvZGluZykgPT4ge1xuICAgIHN3aXRjaCAodHlwZW9mIGVuY29kaW5nKSB7XG4gICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgY2FzZSBcIm51bWJlclwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGluZztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJzdHJpbmdcIjoge1xuICAgICAgICBpZiAoIXN0YXJ0c1NwZWNpYWwoZW5jb2RpbmcpKSB7XG4gICAgICAgICAgcmV0dXJuIGVuY29kaW5nO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGMyID0gZW5jb2RpbmcuY2hhckF0KDApO1xuICAgICAgICBzd2l0Y2ggKGMyKSB7XG4gICAgICAgICAgY2FzZSBcIiFcIjoge1xuICAgICAgICAgICAgcmV0dXJuIGVuY29kaW5nLnNsaWNlKDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiJVwiOiB7XG4gICAgICAgICAgICByZXR1cm4gcGFzc2FibGVTeW1ib2xGb3JOYW1lKGVuY29kaW5nLnNsaWNlKDEpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcIiNcIjoge1xuICAgICAgICAgICAgc3dpdGNoIChlbmNvZGluZykge1xuICAgICAgICAgICAgICBjYXNlIFwiI3VuZGVmaW5lZFwiOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjYXNlIFwiI05hTlwiOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjYXNlIFwiI0luZmluaXR5XCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gSW5maW5pdHk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY2FzZSBcIiMtSW5maW5pdHlcIjoge1xuICAgICAgICAgICAgICAgIHJldHVybiAtSW5maW5pdHk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgICAgIHRocm93IGFzc2VydC5mYWlsKFxuICAgICAgICAgICAgICAgICAgcmVkYWN0ZWRgdW5rbm93biBjb25zdGFudCBcIiR7cXVvdGUoZW5jb2RpbmcpfVwiYCxcbiAgICAgICAgICAgICAgICAgIFR5cGVFcnJvclxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcIitcIjpcbiAgICAgICAgICBjYXNlIFwiLVwiOiB7XG4gICAgICAgICAgICByZXR1cm4gQmlnSW50KGVuY29kaW5nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcIiRcIjoge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGVjb2RlUmVtb3RhYmxlRnJvbVNtYWxsY2FwcyhcbiAgICAgICAgICAgICAgZW5jb2RpbmcsXG4gICAgICAgICAgICAgIGRlY29kZUZyb21TbWFsbGNhcHNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAocGFzc1N0eWxlT2YocmVzdWx0KSAhPT0gXCJyZW1vdGFibGVcIikge1xuICAgICAgICAgICAgICB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBkZWNvZGVSZW1vdGFibGVGcm9tU21hbGxjYXBzIG9wdGlvbiBtdXN0IHJldHVybiBhIHJlbW90YWJsZTogJHtyZXN1bHR9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgXCImXCI6IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGRlY29kZVByb21pc2VGcm9tU21hbGxjYXBzKFxuICAgICAgICAgICAgICBlbmNvZGluZyxcbiAgICAgICAgICAgICAgZGVjb2RlRnJvbVNtYWxsY2Fwc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChwYXNzU3R5bGVPZihyZXN1bHQpICE9PSBcInByb21pc2VcIikge1xuICAgICAgICAgICAgICB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBkZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyBvcHRpb24gbXVzdCByZXR1cm4gYSBwcm9taXNlOiAke3Jlc3VsdH1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBTcGVjaWFsIGNoYXIgJHtxdW90ZShcbiAgICAgICAgICAgICAgYzJcbiAgICAgICAgICAgICl9IHJlc2VydmVkIGZvciBmdXR1cmUgdXNlOiAke2VuY29kaW5nfWA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjYXNlIFwib2JqZWN0XCI6IHtcbiAgICAgICAgaWYgKGVuY29kaW5nID09PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIGVuY29kaW5nO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpc0FycmF5NShlbmNvZGluZykpIHtcbiAgICAgICAgICByZXR1cm4gZW5jb2RpbmcubWFwKCh2YWwpID0+IGRlY29kZUZyb21TbWFsbGNhcHModmFsKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGhhc093blByb3BlcnR5T2YoZW5jb2RpbmcsIFwiI3RhZ1wiKSkge1xuICAgICAgICAgIGNvbnN0IHsgXCIjdGFnXCI6IHRhZywgcGF5bG9hZCwgLi4ucmVzdCB9ID0gZW5jb2Rpbmc7XG4gICAgICAgICAgdHlwZW9mIHRhZyA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYFZhbHVlIG9mIFwiI3RhZ1wiLCB0aGUgdGFnLCBtdXN0IGJlIGEgc3RyaW5nOiAke2VuY29kaW5nfWA7XG4gICAgICAgICAgb3duS2V5czExKHJlc3QpLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYCN0YWcgcmVjb3JkIHVuZXhwZWN0ZWQgcHJvcGVydGllczogJHtxdW90ZShvd25LZXlzMTEocmVzdCkpfWA7XG4gICAgICAgICAgcmV0dXJuIG1ha2VUYWdnZWQoXG4gICAgICAgICAgICBkZWNvZGVGcm9tU21hbGxjYXBzKHRhZyksXG4gICAgICAgICAgICBkZWNvZGVGcm9tU21hbGxjYXBzKHBheWxvYWQpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGFzT3duUHJvcGVydHlPZihlbmNvZGluZywgXCIjZXJyb3JcIikpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBkZWNvZGVFcnJvckZyb21TbWFsbGNhcHMoXG4gICAgICAgICAgICBlbmNvZGluZyxcbiAgICAgICAgICAgIGRlY29kZUZyb21TbWFsbGNhcHNcbiAgICAgICAgICApO1xuICAgICAgICAgIHBhc3NTdHlsZU9mKHJlc3VsdCkgPT09IFwiZXJyb3JcIiB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBkZWNvZGVFcnJvckZyb21TbWFsbGNhcHMgb3B0aW9uIG11c3QgcmV0dXJuIGFuIGVycm9yOiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGVjb2RlRW50cnkgPSAoW2VuY29kZWROYW1lLCBlbmNvZGVkVmFsXSkgPT4ge1xuICAgICAgICAgIHR5cGVvZiBlbmNvZGVkTmFtZSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYFByb3BlcnR5IG5hbWUgJHtxdW90ZShcbiAgICAgICAgICAgIGVuY29kZWROYW1lXG4gICAgICAgICAgKX0gb2YgJHtlbmNvZGluZ30gbXVzdCBiZSBhIHN0cmluZ2A7XG4gICAgICAgICAgZW5jb2RlZE5hbWUuY2hhckF0KDApICE9PSBcIiNcIiB8fCB0aHJvd1JlZGFjdGVkYFVucmVjb2duaXplZCByZWNvcmQgdHlwZSAke3F1b3RlKGVuY29kZWROYW1lKX06ICR7ZW5jb2Rpbmd9YDtcbiAgICAgICAgICBjb25zdCBuYW1lID0gZGVjb2RlRnJvbVNtYWxsY2FwcyhlbmNvZGVkTmFtZSk7XG4gICAgICAgICAgdHlwZW9mIG5hbWUgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBEZWNvZGVkIHByb3BlcnR5IG5hbWUgJHtuYW1lfSBmcm9tICR7ZW5jb2Rpbmd9IG11c3QgYmUgYSBzdHJpbmdgO1xuICAgICAgICAgIHJldHVybiBbbmFtZSwgZGVjb2RlRnJvbVNtYWxsY2FwcyhlbmNvZGVkVmFsKV07XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGRlY29kZWRFbnRyaWVzID0gZW50cmllczUoZW5jb2RpbmcpLm1hcChkZWNvZGVFbnRyeSk7XG4gICAgICAgIHJldHVybiBmcm9tRW50cmllczQoZGVjb2RlZEVudHJpZXMpO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyBhc3NlcnQuZmFpbChcbiAgICAgICAgICByZWRhY3RlZGBpbnRlcm5hbDogdW5yZWNvZ25pemVkIEpTT04gdHlwZW9mICR7cXVvdGUoXG4gICAgICAgICAgICB0eXBlb2YgZW5jb2RpbmdcbiAgICAgICAgICApfTogJHtlbmNvZGluZ31gLFxuICAgICAgICAgIFR5cGVFcnJvclxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGhhcmRlbihkZWNvZGVGcm9tU21hbGxjYXBzKTtcbn07XG5cbi8vXG52YXIgeyBkZWZpbmVQcm9wZXJ0aWVzOiBkZWZpbmVQcm9wZXJ0aWVzMiB9ID0gT2JqZWN0O1xudmFyIHsgaXNBcnJheTogaXNBcnJheTYgfSA9IEFycmF5O1xudmFyIHsgb3duS2V5czogb3duS2V5czEyIH0gPSBSZWZsZWN0O1xudmFyIGRlZmF1bHRWYWxUb1Nsb3RGbiA9ICh4KSA9PiB4O1xudmFyIGRlZmF1bHRTbG90VG9WYWxGbiA9ICh4LCBfKSA9PiB4O1xudmFyIG1ha2VNYXJzaGFsID0gKGNvbnZlcnRWYWxUb1Nsb3QgPSBkZWZhdWx0VmFsVG9TbG90Rm4sIGNvbnZlcnRTbG90VG9WYWwgPSBkZWZhdWx0U2xvdFRvVmFsRm4sIHtcbiAgZXJyb3JUYWdnaW5nID0gXCJvblwiLFxuICBtYXJzaGFsTmFtZSA9IFwiYW5vbi1tYXJzaGFsXCIsXG4gIC8vXG4gIC8vXG4gIGVycm9ySWROdW0gPSAxZTQsXG4gIC8vXG4gIC8vXG4gIG1hcnNoYWxTYXZlRXJyb3IgPSAoZXJyKSA9PiBjb25zb2xlLmxvZyhcIlRlbXBvcmFyeSBsb2dnaW5nIG9mIHNlbnQgZXJyb3JcIiwgZXJyKSxcbiAgLy9cbiAgLy9cbiAgc2VyaWFsaXplQm9keUZvcm1hdCA9IFwiY2FwZGF0YVwiXG59ID0ge30pID0+IHtcbiAgYXNzZXJ0LnR5cGVvZihtYXJzaGFsTmFtZSwgXCJzdHJpbmdcIik7XG4gIGVycm9yVGFnZ2luZyA9PT0gXCJvblwiIHx8IGVycm9yVGFnZ2luZyA9PT0gXCJvZmZcIiB8fCB0aHJvd1JlZGFjdGVkYFRoZSBlcnJvclRhZ2dpbmcgb3B0aW9uIGNhbiBvbmx5IGJlIFwib25cIiBvciBcIm9mZlwiICR7ZXJyb3JUYWdnaW5nfWA7XG4gIGNvbnN0IG5leHRFcnJvcklkID0gKCkgPT4ge1xuICAgIGVycm9ySWROdW0gKz0gMTtcbiAgICByZXR1cm4gYGVycm9yOiR7bWFyc2hhbE5hbWV9IyR7ZXJyb3JJZE51bX1gO1xuICB9O1xuICBjb25zdCB0b0NhcERhdGEyID0gKHJvb3QpID0+IHtcbiAgICBjb25zdCBzbG90cyA9IFtdO1xuICAgIGNvbnN0IHNsb3RNYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICAgIGNvbnN0IGVuY29kZVNsb3RDb21tb24gPSAocGFzc2FibGUpID0+IHtcbiAgICAgIGxldCBpbmRleCA9IHNsb3RNYXAuZ2V0KHBhc3NhYmxlKTtcbiAgICAgIGlmIChpbmRleCAhPT0gdm9pZCAwKSB7XG4gICAgICAgIGFzc2VydC50eXBlb2YoaW5kZXgsIFwibnVtYmVyXCIpO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHsgaW5kZXgsIHJlcGVhdDogdHJ1ZSB9KTtcbiAgICAgIH1cbiAgICAgIGluZGV4ID0gc2xvdHMubGVuZ3RoO1xuICAgICAgY29uc3Qgc2xvdCA9IGNvbnZlcnRWYWxUb1Nsb3QocGFzc2FibGUpO1xuICAgICAgc2xvdHMucHVzaChzbG90KTtcbiAgICAgIHNsb3RNYXAuc2V0KHBhc3NhYmxlLCBpbmRleCk7XG4gICAgICByZXR1cm4gaGFyZGVuKHsgaW5kZXgsIHJlcGVhdDogZmFsc2UgfSk7XG4gICAgfTtcbiAgICBjb25zdCBlbmNvZGVFcnJvckNvbW1vbiA9IChlcnIsIGVuY29kZVJlY3VyKSA9PiB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gZW5jb2RlUmVjdXIoYCR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBhc3NlcnQudHlwZW9mKG1lc3NhZ2UsIFwic3RyaW5nXCIpO1xuICAgICAgY29uc3QgbmFtZSA9IGVuY29kZVJlY3VyKGAke2Vyci5uYW1lfWApO1xuICAgICAgYXNzZXJ0LnR5cGVvZihuYW1lLCBcInN0cmluZ1wiKTtcbiAgICAgIGlmIChlcnJvclRhZ2dpbmcgPT09IFwib25cIikge1xuICAgICAgICBjb25zdCBlcnJvcklkID0gZW5jb2RlUmVjdXIobmV4dEVycm9ySWQoKSk7XG4gICAgICAgIGFzc2VydC50eXBlb2YoZXJyb3JJZCwgXCJzdHJpbmdcIik7XG4gICAgICAgIG5vdGUoZXJyLCByZWRhY3RlZGBTZW50IGFzICR7ZXJyb3JJZH1gKTtcbiAgICAgICAgbWFyc2hhbFNhdmVFcnJvcihlcnIpO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHsgZXJyb3JJZCwgbWVzc2FnZSwgbmFtZSB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBtZXNzYWdlLCBuYW1lIH0pO1xuICAgICAgfVxuICAgIH07XG4gICAgaWYgKHNlcmlhbGl6ZUJvZHlGb3JtYXQgPT09IFwiY2FwZGF0YVwiKSB7XG4gICAgICBjb25zdCBlbmNvZGVTbG90VG9DYXBEYXRhID0gKHBhc3NhYmxlLCBpZmFjZSA9IHZvaWQgMCkgPT4ge1xuICAgICAgICBjb25zdCB7IGluZGV4LCByZXBlYXQgfSA9IGVuY29kZVNsb3RDb21tb24ocGFzc2FibGUpO1xuICAgICAgICBpZiAocmVwZWF0ID09PSB0cnVlIHx8IGlmYWNlID09PSB2b2lkIDApIHtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgW1FDTEFTU106IFwic2xvdFwiLCBpbmRleCB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgW1FDTEFTU106IFwic2xvdFwiLCBpZmFjZSwgaW5kZXggfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBjb25zdCBlbmNvZGVSZW1vdGFibGVUb0NhcERhdGEgPSAodmFsLCBfZW5jb2RlUmVjdXIpID0+IGVuY29kZVNsb3RUb0NhcERhdGEodmFsLCBnZXRJbnRlcmZhY2VPZih2YWwpKTtcbiAgICAgIGNvbnN0IGVuY29kZVByb21pc2VUb0NhcERhdGEgPSAocHJvbWlzZSwgX2VuY29kZVJlY3VyKSA9PiBlbmNvZGVTbG90VG9DYXBEYXRhKHByb21pc2UpO1xuICAgICAgY29uc3QgZW5jb2RlRXJyb3JUb0NhcERhdGEgPSAoZXJyLCBlbmNvZGVSZWN1cikgPT4ge1xuICAgICAgICBjb25zdCBlcnJEYXRhID0gZW5jb2RlRXJyb3JDb21tb24oZXJyLCBlbmNvZGVSZWN1cik7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBbUUNMQVNTXTogXCJlcnJvclwiLCAuLi5lcnJEYXRhIH0pO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGVuY29kZVRvQ2FwRGF0YSA9IG1ha2VFbmNvZGVUb0NhcERhdGEoe1xuICAgICAgICBlbmNvZGVSZW1vdGFibGVUb0NhcERhdGEsXG4gICAgICAgIGVuY29kZVByb21pc2VUb0NhcERhdGEsXG4gICAgICAgIGVuY29kZUVycm9yVG9DYXBEYXRhXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVUb0NhcERhdGEocm9vdCk7XG4gICAgICBjb25zdCBib2R5ID0gSlNPTi5zdHJpbmdpZnkoZW5jb2RlZCk7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgYm9keSxcbiAgICAgICAgc2xvdHNcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoc2VyaWFsaXplQm9keUZvcm1hdCA9PT0gXCJzbWFsbGNhcHNcIikge1xuICAgICAgY29uc3QgZW5jb2RlU2xvdFRvU21hbGxjYXBzID0gKHByZWZpeCwgcGFzc2FibGUsIGlmYWNlID0gdm9pZCAwKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaW5kZXgsIHJlcGVhdCB9ID0gZW5jb2RlU2xvdENvbW1vbihwYXNzYWJsZSk7XG4gICAgICAgIGlmIChyZXBlYXQgPT09IHRydWUgfHwgaWZhY2UgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiBgJHtwcmVmaXh9JHtpbmRleH1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHtwcmVmaXh9JHtpbmRleH0uJHtpZmFjZX1gO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGVuY29kZVJlbW90YWJsZVRvU21hbGxjYXBzID0gKHJlbW90YWJsZSwgX2VuY29kZVJlY3VyKSA9PiBlbmNvZGVTbG90VG9TbWFsbGNhcHMoXCIkXCIsIHJlbW90YWJsZSwgZ2V0SW50ZXJmYWNlT2YocmVtb3RhYmxlKSk7XG4gICAgICBjb25zdCBlbmNvZGVQcm9taXNlVG9TbWFsbGNhcHMgPSAocHJvbWlzZSwgX2VuY29kZVJlY3VyKSA9PiBlbmNvZGVTbG90VG9TbWFsbGNhcHMoXCImXCIsIHByb21pc2UpO1xuICAgICAgY29uc3QgZW5jb2RlRXJyb3JUb1NtYWxsY2FwcyA9IChlcnIsIGVuY29kZVJlY3VyKSA9PiB7XG4gICAgICAgIGNvbnN0IGVyckRhdGEgPSBlbmNvZGVFcnJvckNvbW1vbihlcnIsIGVuY29kZVJlY3VyKTtcbiAgICAgICAgY29uc3QgeyBtZXNzYWdlLCAuLi5yZXN0IH0gPSBlcnJEYXRhO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHsgXCIjZXJyb3JcIjogbWVzc2FnZSwgLi4ucmVzdCB9KTtcbiAgICAgIH07XG4gICAgICBjb25zdCBlbmNvZGVUb1NtYWxsY2FwcyA9IG1ha2VFbmNvZGVUb1NtYWxsY2Fwcyh7XG4gICAgICAgIGVuY29kZVJlbW90YWJsZVRvU21hbGxjYXBzLFxuICAgICAgICBlbmNvZGVQcm9taXNlVG9TbWFsbGNhcHMsXG4gICAgICAgIGVuY29kZUVycm9yVG9TbWFsbGNhcHNcbiAgICAgIH0pO1xuICAgICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZVRvU21hbGxjYXBzKHJvb3QpO1xuICAgICAgY29uc3Qgc21hbGxjYXBzQm9keSA9IEpTT04uc3RyaW5naWZ5KGVuY29kZWQpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIGJvZHk6IGAjJHtzbWFsbGNhcHNCb2R5fWAsXG4gICAgICAgIHNsb3RzXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBVbnJlY29nbml6ZWQgc2VyaWFsaXplQm9keUZvcm1hdDogJHtxdW90ZShzZXJpYWxpemVCb2R5Rm9ybWF0KX1gO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgbWFrZUZ1bGxSZXZpdmUgPSAoc2xvdHMpID0+IHtcbiAgICBjb25zdCB2YWxNYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICAgIGNvbnN0IGRlY29kZVNsb3RDb21tb24gPSAoc2xvdERhdGEpID0+IHtcbiAgICAgIGNvbnN0IHsgaWZhY2UgPSB2b2lkIDAsIGluZGV4LCAuLi5yZXN0IH0gPSBzbG90RGF0YTtcbiAgICAgIG93bktleXMxMihyZXN0KS5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGVuY29kZWQgc2xvdCBwcm9wZXJ0aWVzICR7cXVvdGUob3duS2V5czEyKHJlc3QpKX1gO1xuICAgICAgY29uc3QgZXh0YW50ID0gdmFsTWFwLmdldChpbmRleCk7XG4gICAgICBpZiAoZXh0YW50KSB7XG4gICAgICAgIHJldHVybiBleHRhbnQ7XG4gICAgICB9XG4gICAgICBjb25zdCBzbG90ID0gc2xvdHNbTnVtYmVyKE5hdChpbmRleCkpXTtcbiAgICAgIGNvbnN0IHZhbCA9IGNvbnZlcnRTbG90VG9WYWwoc2xvdCwgaWZhY2UpO1xuICAgICAgdmFsTWFwLnNldChpbmRleCwgdmFsKTtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfTtcbiAgICBjb25zdCBkZWNvZGVFcnJvckNvbW1vbiA9IChlcnJEYXRhLCBkZWNvZGVSZWN1cikgPT4ge1xuICAgICAgY29uc3Qge1xuICAgICAgICBlcnJvcklkID0gdm9pZCAwLFxuICAgICAgICBtZXNzYWdlLFxuICAgICAgICBuYW1lLFxuICAgICAgICBjYXVzZSA9IHZvaWQgMCxcbiAgICAgICAgZXJyb3JzID0gdm9pZCAwLFxuICAgICAgICAuLi5yZXN0XG4gICAgICB9ID0gZXJyRGF0YTtcbiAgICAgIGNvbnN0IGROYW1lID0gZGVjb2RlUmVjdXIobmFtZSk7XG4gICAgICBjb25zdCBkTWVzc2FnZSA9IGRlY29kZVJlY3VyKG1lc3NhZ2UpO1xuICAgICAgY29uc3QgZEVycm9ySWQgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBlcnJvcklkICYmIGRlY29kZVJlY3VyKGVycm9ySWQpXG4gICAgICApO1xuICAgICAgaWYgKHR5cGVvZiBkTmFtZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludmFsaWQgZXJyb3IgbmFtZSB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgZE5hbWUpfWA7XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGRNZXNzYWdlICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW52YWxpZCBlcnJvciBtZXNzYWdlIHR5cGVvZiAke3F1b3RlKHR5cGVvZiBkTWVzc2FnZSl9YDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGVyckNvbnN0cnVjdG9yID0gZ2V0RXJyb3JDb25zdHJ1Y3RvcihkTmFtZSkgfHwgRXJyb3I7XG4gICAgICBjb25zdCBlcnJvck5hbWUgPSBkRXJyb3JJZCA9PT0gdm9pZCAwID8gYFJlbW90ZSR7ZXJyQ29uc3RydWN0b3IubmFtZX1gIDogYFJlbW90ZSR7ZXJyQ29uc3RydWN0b3IubmFtZX0oJHtkRXJyb3JJZH0pYDtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgIGVycm9yTmFtZSxcbiAgICAgICAgc2FuaXRpemU6IGZhbHNlXG4gICAgICB9O1xuICAgICAgaWYgKGNhdXNlKSB7XG4gICAgICAgIG9wdGlvbnMuY2F1c2UgPSBkZWNvZGVSZWN1cihjYXVzZSk7XG4gICAgICB9XG4gICAgICBpZiAoZXJyb3JzKSB7XG4gICAgICAgIG9wdGlvbnMuZXJyb3JzID0gZGVjb2RlUmVjdXIoZXJyb3JzKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJhd0Vycm9yID0gbWFrZUVycm9yKGRNZXNzYWdlLCBlcnJDb25zdHJ1Y3Rvciwgb3B0aW9ucyk7XG4gICAgICBjb25zdCBkZXNjcyA9IG9iamVjdE1hcChyZXN0LCAoZGF0YSkgPT4gKHtcbiAgICAgICAgdmFsdWU6IGRlY29kZVJlY3VyKGRhdGEpLFxuICAgICAgICB3cml0YWJsZTogZmFsc2UsXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlXG4gICAgICB9KSk7XG4gICAgICBkZWZpbmVQcm9wZXJ0aWVzMihyYXdFcnJvciwgZGVzY3MpO1xuICAgICAgaGFyZGVuKHJhd0Vycm9yKTtcbiAgICAgIHJldHVybiB0b1Bhc3NhYmxlRXJyb3IocmF3RXJyb3IpO1xuICAgIH07XG4gICAgY29uc3QgZGVjb2RlUmVtb3RhYmxlT3JQcm9taXNlRnJvbUNhcERhdGEgPSAocmF3VHJlZSwgX2RlY29kZVJlY3VyKSA9PiB7XG4gICAgICBjb25zdCB7IFtRQ0xBU1NdOiBfLCAuLi5zbG90RGF0YSB9ID0gcmF3VHJlZTtcbiAgICAgIHJldHVybiBkZWNvZGVTbG90Q29tbW9uKHNsb3REYXRhKTtcbiAgICB9O1xuICAgIGNvbnN0IGRlY29kZUVycm9yRnJvbUNhcERhdGEgPSAocmF3VHJlZSwgZGVjb2RlUmVjdXIpID0+IHtcbiAgICAgIGNvbnN0IHsgW1FDTEFTU106IF8sIC4uLmVyckRhdGEgfSA9IHJhd1RyZWU7XG4gICAgICByZXR1cm4gZGVjb2RlRXJyb3JDb21tb24oZXJyRGF0YSwgZGVjb2RlUmVjdXIpO1xuICAgIH07XG4gICAgY29uc3QgcmV2aXZlRnJvbUNhcERhdGEgPSBtYWtlRGVjb2RlRnJvbUNhcERhdGEoe1xuICAgICAgZGVjb2RlUmVtb3RhYmxlRnJvbUNhcERhdGE6IGRlY29kZVJlbW90YWJsZU9yUHJvbWlzZUZyb21DYXBEYXRhLFxuICAgICAgZGVjb2RlUHJvbWlzZUZyb21DYXBEYXRhOiBkZWNvZGVSZW1vdGFibGVPclByb21pc2VGcm9tQ2FwRGF0YSxcbiAgICAgIGRlY29kZUVycm9yRnJvbUNhcERhdGFcbiAgICB9KTtcbiAgICBjb25zdCBtYWtlRGVjb2RlU2xvdEZyb21TbWFsbGNhcHMgPSAocHJlZml4KSA9PiB7XG4gICAgICByZXR1cm4gKHN0cmluZ0VuY29kaW5nLCBfZGVjb2RlUmVjdXIpID0+IHtcbiAgICAgICAgYXNzZXJ0KHN0cmluZ0VuY29kaW5nLmNoYXJBdCgwKSA9PT0gcHJlZml4KTtcbiAgICAgICAgY29uc3QgaTIgPSBzdHJpbmdFbmNvZGluZy5pbmRleE9mKFwiLlwiKTtcbiAgICAgICAgY29uc3QgaW5kZXggPSBOdW1iZXIoc3RyaW5nRW5jb2Rpbmcuc2xpY2UoMSwgaTIgPCAwID8gdm9pZCAwIDogaTIpKTtcbiAgICAgICAgY29uc3QgaWZhY2UgPSBpMiA8IDAgPyB2b2lkIDAgOiBzdHJpbmdFbmNvZGluZy5zbGljZShpMiArIDEpO1xuICAgICAgICByZXR1cm4gZGVjb2RlU2xvdENvbW1vbih7IGlmYWNlLCBpbmRleCB9KTtcbiAgICAgIH07XG4gICAgfTtcbiAgICBjb25zdCBkZWNvZGVSZW1vdGFibGVGcm9tU21hbGxjYXBzID0gbWFrZURlY29kZVNsb3RGcm9tU21hbGxjYXBzKFwiJFwiKTtcbiAgICBjb25zdCBkZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyA9IG1ha2VEZWNvZGVTbG90RnJvbVNtYWxsY2FwcyhcIiZcIik7XG4gICAgY29uc3QgZGVjb2RlRXJyb3JGcm9tU21hbGxjYXBzID0gKGVuY29kaW5nLCBkZWNvZGVSZWN1cikgPT4ge1xuICAgICAgY29uc3QgeyBcIiNlcnJvclwiOiBtZXNzYWdlLCAuLi5yZXN0RXJyRGF0YSB9ID0gZW5jb2Rpbmc7XG4gICAgICAhaGFzT3duUHJvcGVydHlPZihyZXN0RXJyRGF0YSwgXCJtZXNzYWdlXCIpIHx8IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBlbmNvZGVkIGVycm9yIHByb3BlcnR5ICR7cXVvdGUoXCJtZXNzYWdlXCIpfWA7XG4gICAgICByZXR1cm4gZGVjb2RlRXJyb3JDb21tb24oeyBtZXNzYWdlLCAuLi5yZXN0RXJyRGF0YSB9LCBkZWNvZGVSZWN1cik7XG4gICAgfTtcbiAgICBjb25zdCByZXZpdmVGcm9tU21hbGxjYXBzID0gbWFrZURlY29kZUZyb21TbWFsbGNhcHMoe1xuICAgICAgLy9cbiAgICAgIGRlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMsXG4gICAgICAvL1xuICAgICAgZGVjb2RlUHJvbWlzZUZyb21TbWFsbGNhcHMsXG4gICAgICBkZWNvZGVFcnJvckZyb21TbWFsbGNhcHNcbiAgICB9KTtcbiAgICByZXR1cm4gaGFyZGVuKHsgcmV2aXZlRnJvbUNhcERhdGEsIHJldml2ZUZyb21TbWFsbGNhcHMgfSk7XG4gIH07XG4gIGNvbnN0IGZyb21DYXBEYXRhID0gKGRhdGEpID0+IHtcbiAgICBjb25zdCB7IGJvZHksIHNsb3RzIH0gPSBkYXRhO1xuICAgIHR5cGVvZiBib2R5ID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgdW5zZXJpYWxpemUoKSBnaXZlbiBub24tY2FwZGF0YSAoLmJvZHkgaXMgJHtib2R5fSwgbm90IHN0cmluZylgO1xuICAgIGlzQXJyYXk2KGRhdGEuc2xvdHMpIHx8IHRocm93UmVkYWN0ZWRgdW5zZXJpYWxpemUoKSBnaXZlbiBub24tY2FwZGF0YSAoLnNsb3RzIGFyZSBub3QgQXJyYXkpYDtcbiAgICBjb25zdCB7IHJldml2ZUZyb21DYXBEYXRhLCByZXZpdmVGcm9tU21hbGxjYXBzIH0gPSBtYWtlRnVsbFJldml2ZShzbG90cyk7XG4gICAgbGV0IHJlc3VsdDtcbiAgICBpZiAoYm9keS5jaGFyQXQoMCkgPT09IFwiI1wiKSB7XG4gICAgICBjb25zdCBzbWFsbGNhcHNCb2R5ID0gYm9keS5zbGljZSgxKTtcbiAgICAgIGNvbnN0IGVuY29kaW5nID0gaGFyZGVuKEpTT04ucGFyc2Uoc21hbGxjYXBzQm9keSkpO1xuICAgICAgcmVzdWx0ID0gaGFyZGVuKHJldml2ZUZyb21TbWFsbGNhcHMoZW5jb2RpbmcpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgcmF3VHJlZSA9IGhhcmRlbihKU09OLnBhcnNlKGJvZHkpKTtcbiAgICAgIHJlc3VsdCA9IGhhcmRlbihyZXZpdmVGcm9tQ2FwRGF0YShyYXdUcmVlKSk7XG4gICAgfVxuICAgIGFzc2VydFBhc3NhYmxlKHJlc3VsdCk7XG4gICAgcmV0dXJuIChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICByZXN1bHRcbiAgICApO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICB0b0NhcERhdGE6IHRvQ2FwRGF0YTIsXG4gICAgZnJvbUNhcERhdGEsXG4gICAgLy9cbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHNlcmlhbGl6ZTogdG9DYXBEYXRhMixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgdW5zZXJpYWxpemU6IGZyb21DYXBEYXRhXG4gIH0pO1xufTtcblxuLy9cbnZhciB7IGZyZWV6ZTogZnJlZXplNiB9ID0gT2JqZWN0O1xudmFyIGRvTm90Q29udmVydFZhbFRvU2xvdCA9ICh2YWwpID0+IHRocm93UmVkYWN0ZWRgTWFyc2hhbCdzIHN0cmluZ2lmeSByZWplY3RzIHByZXNlbmNlcyBhbmQgcHJvbWlzZXMgJHt2YWx9YDtcbnZhciBkb05vdENvbnZlcnRTbG90VG9WYWwgPSAoc2xvdCwgX2lmYWNlKSA9PiB0aHJvd1JlZGFjdGVkYE1hcnNoYWwncyBwYXJzZSBtdXN0IG5vdCBlbmNvZGUgYW55IHNsb3RzICR7c2xvdH1gO1xudmFyIGJhZEFycmF5SGFuZGxlciA9IGhhcmRlbih7XG4gIGdldDogKF90YXJnZXQsIG5hbWUsIF9yZWNlaXZlcikgPT4ge1xuICAgIGlmIChuYW1lID09PSBcImxlbmd0aFwiKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBNYXJzaGFsJ3MgcGFyc2UgbXVzdCBub3QgZW5jb2RlIGFueSBzbG90IHBvc2l0aW9ucyAke25hbWV9YDtcbiAgfVxufSk7XG52YXIgYXJyYXlUYXJnZXQgPSBmcmVlemU2KFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBbXVxuKTtcbnZhciBiYWRBcnJheSA9IG5ldyBQcm94eShhcnJheVRhcmdldCwgYmFkQXJyYXlIYW5kbGVyKTtcbnZhciB7IHNlcmlhbGl6ZSwgdW5zZXJpYWxpemUgfSA9IG1ha2VNYXJzaGFsKFxuICBkb05vdENvbnZlcnRWYWxUb1Nsb3QsXG4gIGRvTm90Q29udmVydFNsb3RUb1ZhbCxcbiAge1xuICAgIGVycm9yVGFnZ2luZzogXCJvZmZcIixcbiAgICAvL1xuICAgIHNlcmlhbGl6ZUJvZHlGb3JtYXQ6IFwiY2FwZGF0YVwiXG4gIH1cbik7XG52YXIgc3RyaW5naWZ5ID0gKHZhbCkgPT4gc2VyaWFsaXplKHZhbCkuYm9keTtcbmhhcmRlbihzdHJpbmdpZnkpO1xudmFyIHBhcnNlID0gKHN0cikgPT4gdW5zZXJpYWxpemUoXG4gIC8vXG4gIC8vXG4gIC8vXG4gIGZyZWV6ZTYoe1xuICAgIGJvZHk6IHN0cixcbiAgICBzbG90czogYmFkQXJyYXlcbiAgfSlcbik7XG5oYXJkZW4ocGFyc2UpO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czEzIH0gPSBSZWZsZWN0O1xudmFyIHsgaXNBcnJheTogaXNBcnJheTcgfSA9IEFycmF5O1xudmFyIHsgc3RyaW5naWZ5OiBxdW90ZTIgfSA9IEpTT047XG52YXIgbWFrZVllc0luZGVudGVyID0gKCkgPT4ge1xuICBjb25zdCBzdHJpbmdzID0gW107XG4gIGxldCBsZXZlbCA9IDA7XG4gIGxldCBuZWVkU3BhY2UgPSBmYWxzZTtcbiAgY29uc3QgbGluZSA9ICgpID0+IHtcbiAgICBuZWVkU3BhY2UgPSBmYWxzZTtcbiAgICByZXR1cm4gc3RyaW5ncy5wdXNoKFwiXFxuXCIsIFwiICBcIi5yZXBlYXQobGV2ZWwpKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgb3BlbjogKG9wZW5CcmFja2V0KSA9PiB7XG4gICAgICBsZXZlbCArPSAxO1xuICAgICAgaWYgKG5lZWRTcGFjZSkge1xuICAgICAgICBzdHJpbmdzLnB1c2goXCIgXCIpO1xuICAgICAgfVxuICAgICAgbmVlZFNwYWNlID0gZmFsc2U7XG4gICAgICByZXR1cm4gc3RyaW5ncy5wdXNoKG9wZW5CcmFja2V0KTtcbiAgICB9LFxuICAgIGxpbmUsXG4gICAgbmV4dDogKHRva2VuMikgPT4ge1xuICAgICAgaWYgKG5lZWRTcGFjZSAmJiB0b2tlbjIgIT09IFwiLFwiKSB7XG4gICAgICAgIHN0cmluZ3MucHVzaChcIiBcIik7XG4gICAgICB9XG4gICAgICBuZWVkU3BhY2UgPSB0cnVlO1xuICAgICAgcmV0dXJuIHN0cmluZ3MucHVzaCh0b2tlbjIpO1xuICAgIH0sXG4gICAgY2xvc2U6IChjbG9zZUJyYWNrZXQpID0+IHtcbiAgICAgIGFzc2VydChsZXZlbCA+PSAxKTtcbiAgICAgIGxldmVsIC09IDE7XG4gICAgICBsaW5lKCk7XG4gICAgICByZXR1cm4gc3RyaW5ncy5wdXNoKGNsb3NlQnJhY2tldCk7XG4gICAgfSxcbiAgICBkb25lOiAoKSA9PiB7XG4gICAgICBhc3NlcnQuZXF1YWwobGV2ZWwsIDApO1xuICAgICAgcmV0dXJuIHN0cmluZ3Muam9pbihcIlwiKTtcbiAgICB9XG4gIH0pO1xufTtcbnZhciBiYWRQYWlyUGF0dGVybiA9IC9eKD86XFx3XFx3fDw8fD4+fFxcK1xcK3wtLXw8IXwtPikkLztcbnZhciBtYWtlTm9JbmRlbnRlciA9ICgpID0+IHtcbiAgY29uc3Qgc3RyaW5ncyA9IFtdO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBvcGVuOiAob3BlbkJyYWNrZXQpID0+IHN0cmluZ3MucHVzaChvcGVuQnJhY2tldCksXG4gICAgbGluZTogKCkgPT4gc3RyaW5ncy5sZW5ndGgsXG4gICAgbmV4dDogKHRva2VuMikgPT4ge1xuICAgICAgaWYgKHN0cmluZ3MubGVuZ3RoID49IDEpIHtcbiAgICAgICAgY29uc3QgbGFzdCA9IHN0cmluZ3Nbc3RyaW5ncy5sZW5ndGggLSAxXTtcbiAgICAgICAgaWYgKGxhc3QubGVuZ3RoID49IDEgJiYgdG9rZW4yLmxlbmd0aCA+PSAxKSB7XG4gICAgICAgICAgY29uc3QgcGFpciA9IGAke2xhc3RbbGFzdC5sZW5ndGggLSAxXX0ke3Rva2VuMlswXX1gO1xuICAgICAgICAgIGlmIChiYWRQYWlyUGF0dGVybi50ZXN0KHBhaXIpKSB7XG4gICAgICAgICAgICBzdHJpbmdzLnB1c2goXCIgXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHN0cmluZ3MucHVzaCh0b2tlbjIpO1xuICAgIH0sXG4gICAgY2xvc2U6IChjbG9zZUJyYWNrZXQpID0+IHtcbiAgICAgIGlmIChzdHJpbmdzLmxlbmd0aCA+PSAxICYmIHN0cmluZ3Nbc3RyaW5ncy5sZW5ndGggLSAxXSA9PT0gXCIsXCIpIHtcbiAgICAgICAgc3RyaW5ncy5wb3AoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdHJpbmdzLnB1c2goY2xvc2VCcmFja2V0KTtcbiAgICB9LFxuICAgIGRvbmU6ICgpID0+IHN0cmluZ3Muam9pbihcIlwiKVxuICB9KTtcbn07XG52YXIgaWRlbnRQYXR0ZXJuID0gL15bYS16QS1aXVxcdyokLztcbmhhcmRlbihpZGVudFBhdHRlcm4pO1xudmFyIEF0QXRQcmVmaXhQYXR0ZXJuMiA9IC9eQEAoLiopJC87XG5oYXJkZW4oQXRBdFByZWZpeFBhdHRlcm4yKTtcbnZhciBkZWNvZGVUb0p1c3RpbiA9IChlbmNvZGluZywgc2hvdWxkSW5kZW50ID0gZmFsc2UsIHNsb3RzID0gW10pID0+IHtcbiAgY29uc3QgcHJlcGFyZSA9IChyYXdUcmVlKSA9PiB7XG4gICAgaWYgKCFpc09iamVjdDIocmF3VHJlZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYXNzZXJ0LnR5cGVvZihyYXdUcmVlLCBcIm9iamVjdFwiKTtcbiAgICBhc3NlcnQocmF3VHJlZSAhPT0gbnVsbCk7XG4gICAgaWYgKFFDTEFTUyBpbiByYXdUcmVlKSB7XG4gICAgICBjb25zdCBxY2xhc3MgPSByYXdUcmVlW1FDTEFTU107XG4gICAgICB0eXBlb2YgcWNsYXNzID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgaW52YWxpZCBxY2xhc3MgdHlwZW9mICR7cXVvdGUodHlwZW9mIHFjbGFzcyl9YDtcbiAgICAgIGFzc2VydCghaXNBcnJheTcocmF3VHJlZSkpO1xuICAgICAgc3dpdGNoIChyYXdUcmVlW1wiQHFjbGFzc1wiXSkge1xuICAgICAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgICAgIGNhc2UgXCJOYU5cIjpcbiAgICAgICAgY2FzZSBcIkluZmluaXR5XCI6XG4gICAgICAgIGNhc2UgXCItSW5maW5pdHlcIjoge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgICBjb25zdCB7IGRpZ2l0cyB9ID0gcmF3VHJlZTtcbiAgICAgICAgICB0eXBlb2YgZGlnaXRzID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgaW52YWxpZCBkaWdpdHMgdHlwZW9mICR7cXVvdGUodHlwZW9mIGRpZ2l0cyl9YDtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcIkBAYXN5bmNJdGVyYXRvclwiOiB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgICAgIGNvbnN0IHsgbmFtZSB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKG5hbWUsIFwic3RyaW5nXCIpO1xuICAgICAgICAgIGNvbnN0IHN5bSA9IHBhc3NhYmxlU3ltYm9sRm9yTmFtZShuYW1lKTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKHN5bSwgXCJzeW1ib2xcIik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgdGFnLCBwYXlsb2FkIH0gPSByYXdUcmVlO1xuICAgICAgICAgIGFzc2VydC50eXBlb2YodGFnLCBcInN0cmluZ1wiKTtcbiAgICAgICAgICBwcmVwYXJlKHBheWxvYWQpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic2xvdFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBpbmRleCwgaWZhY2UgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZihpbmRleCwgXCJudW1iZXJcIik7XG4gICAgICAgICAgTmF0KGluZGV4KTtcbiAgICAgICAgICBpZiAoaWZhY2UgIT09IHZvaWQgMCkge1xuICAgICAgICAgICAgYXNzZXJ0LnR5cGVvZihpZmFjZSwgXCJzdHJpbmdcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiaGlsYmVydFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBvcmlnaW5hbCwgcmVzdCB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBcIm9yaWdpbmFsXCIgaW4gcmF3VHJlZSB8fCB0aHJvd1JlZGFjdGVkYEludmFsaWQgSGlsYmVydCBIb3RlbCBlbmNvZGluZyAke3Jhd1RyZWV9YDtcbiAgICAgICAgICBwcmVwYXJlKG9yaWdpbmFsKTtcbiAgICAgICAgICBpZiAoXCJyZXN0XCIgaW4gcmF3VHJlZSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiByZXN0ICE9PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdCAke3Jlc3R9IGVuY29kaW5nIG11c3QgYmUgYW4gb2JqZWN0YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN0ID09PSBudWxsKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdCAke3Jlc3R9IGVuY29kaW5nIG11c3Qgbm90IGJlIG51bGxgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzQXJyYXk3KHJlc3QpKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdCAke3Jlc3R9IGVuY29kaW5nIG11c3Qgbm90IGJlIGFuIGFycmF5YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChRQ0xBU1MgaW4gcmVzdCkge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3QgZW5jb2RpbmcgJHtyZXN0fSBtdXN0IG5vdCBjb250YWluICR7cXVvdGUoUUNMQVNTKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgbmFtZXMgPSBvd25LZXlzMTMocmVzdCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHtcbiAgICAgICAgICAgICAgdHlwZW9mIG5hbWUgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBQcm9wZXJ0eSBuYW1lICR7bmFtZX0gb2YgJHtyYXdUcmVlfSBtdXN0IGJlIGEgc3RyaW5nYDtcbiAgICAgICAgICAgICAgcHJlcGFyZShyZXN0W25hbWVdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgICAgY29uc3QgeyBuYW1lLCBtZXNzYWdlIH0gPSByYXdUcmVlO1xuICAgICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGVycm9yIG5hbWUgdHlwZW9mICR7cXVvdGUodHlwZW9mIG5hbWUpfWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGdldEVycm9yQ29uc3RydWN0b3IobmFtZSkgIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYE11c3QgYmUgdGhlIG5hbWUgb2YgYW4gRXJyb3IgY29uc3RydWN0b3IgJHtuYW1lfWA7XG4gICAgICAgICAgdHlwZW9mIG1lc3NhZ2UgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGVycm9yIG1lc3NhZ2UgdHlwZW9mICR7cXVvdGUodHlwZW9mIG1lc3NhZ2UpfWA7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICBhc3NlcnQuZmFpbChyZWRhY3RlZGB1bnJlY29nbml6ZWQgJHtxdW90ZShRQ0xBU1MpfSAke3F1b3RlKHFjbGFzcyl9YCwgVHlwZUVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoaXNBcnJheTcocmF3VHJlZSkpIHtcbiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSByYXdUcmVlO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlbmd0aDsgaTIgKz0gMSkge1xuICAgICAgICBwcmVwYXJlKHJhd1RyZWVbaTJdKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbmFtZXMgPSBvd25LZXlzMTMocmF3VHJlZSk7XG4gICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBQcm9wZXJ0eSBuYW1lICR7bmFtZX0gb2YgJHtyYXdUcmVlfSBtdXN0IGJlIGEgc3RyaW5nYDtcbiAgICAgICAgfVxuICAgICAgICBwcmVwYXJlKHJhd1RyZWVbbmFtZV0pO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgbWFrZUluZGVudGVyID0gc2hvdWxkSW5kZW50ID8gbWFrZVllc0luZGVudGVyIDogbWFrZU5vSW5kZW50ZXI7XG4gIGxldCBvdXQgPSBtYWtlSW5kZW50ZXIoKTtcbiAgY29uc3QgZGVjb2RlMyA9IChyYXdUcmVlKSA9PiB7XG4gICAgcmV0dXJuIHJlY3VyKHJhd1RyZWUpO1xuICB9O1xuICBjb25zdCBkZWNvZGVQcm9wZXJ0eSA9IChuYW1lLCB2YWx1ZSkgPT4ge1xuICAgIG91dC5saW5lKCk7XG4gICAgaWYgKG5hbWUgPT09IFwiX19wcm90b19fXCIpIHtcbiAgICAgIG91dC5uZXh0KGBbXCJfX3Byb3RvX19cIl06YCk7XG4gICAgfSBlbHNlIGlmIChpZGVudFBhdHRlcm4udGVzdChuYW1lKSkge1xuICAgICAgb3V0Lm5leHQoYCR7bmFtZX06YCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG91dC5uZXh0KGAke3F1b3RlMihuYW1lKX06YCk7XG4gICAgfVxuICAgIGRlY29kZTModmFsdWUpO1xuICAgIG91dC5uZXh0KFwiLFwiKTtcbiAgfTtcbiAgY29uc3QgcmVjdXIgPSAocmF3VHJlZSkgPT4ge1xuICAgIGlmICghaXNPYmplY3QyKHJhd1RyZWUpKSB7XG4gICAgICByZXR1cm4gb3V0Lm5leHQocXVvdGUyKHJhd1RyZWUpKTtcbiAgICB9XG4gICAgYXNzZXJ0LnR5cGVvZihyYXdUcmVlLCBcIm9iamVjdFwiKTtcbiAgICBhc3NlcnQocmF3VHJlZSAhPT0gbnVsbCk7XG4gICAgaWYgKFFDTEFTUyBpbiByYXdUcmVlKSB7XG4gICAgICBjb25zdCBxY2xhc3MgPSByYXdUcmVlW1FDTEFTU107XG4gICAgICBhc3NlcnQudHlwZW9mKHFjbGFzcywgXCJzdHJpbmdcIik7XG4gICAgICBhc3NlcnQoIWlzQXJyYXk3KHJhd1RyZWUpKTtcbiAgICAgIHN3aXRjaCAocmF3VHJlZVtcIkBxY2xhc3NcIl0pIHtcbiAgICAgICAgLy9cbiAgICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgICAgICBjYXNlIFwiTmFOXCI6XG4gICAgICAgIGNhc2UgXCJJbmZpbml0eVwiOlxuICAgICAgICBjYXNlIFwiLUluZmluaXR5XCI6IHtcbiAgICAgICAgICByZXR1cm4gb3V0Lm5leHQocWNsYXNzKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgICBjb25zdCB7IGRpZ2l0cyB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKGRpZ2l0cywgXCJzdHJpbmdcIik7XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGAke0JpZ0ludChkaWdpdHMpfW5gKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiQEBhc3luY0l0ZXJhdG9yXCI6IHtcbiAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoXCJTeW1ib2wuYXN5bmNJdGVyYXRvclwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgICBjb25zdCB7IG5hbWUgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZihuYW1lLCBcInN0cmluZ1wiKTtcbiAgICAgICAgICBjb25zdCBzeW0gPSBwYXNzYWJsZVN5bWJvbEZvck5hbWUobmFtZSk7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZihzeW0sIFwic3ltYm9sXCIpO1xuICAgICAgICAgIGNvbnN0IHJlZ2lzdGVyZWROYW1lID0gU3ltYm9sLmtleUZvcihzeW0pO1xuICAgICAgICAgIGlmIChyZWdpc3RlcmVkTmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICBjb25zdCBtYXRjaCA9IEF0QXRQcmVmaXhQYXR0ZXJuMi5leGVjKG5hbWUpO1xuICAgICAgICAgICAgYXNzZXJ0KG1hdGNoICE9PSBudWxsKTtcbiAgICAgICAgICAgIGNvbnN0IHN1ZmZpeCA9IG1hdGNoWzFdO1xuICAgICAgICAgICAgYXNzZXJ0KFN5bWJvbFtzdWZmaXhdID09PSBzeW0pO1xuICAgICAgICAgICAgYXNzZXJ0KGlkZW50UGF0dGVybi50ZXN0KHN1ZmZpeCkpO1xuICAgICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGBTeW1ib2wuJHtzdWZmaXh9YCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBvdXQubmV4dChgU3ltYm9sLmZvcigke3F1b3RlMihyZWdpc3RlcmVkTmFtZSl9KWApO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgdGFnLCBwYXlsb2FkIH0gPSByYXdUcmVlO1xuICAgICAgICAgIG91dC5uZXh0KGBtYWtlVGFnZ2VkKCR7cXVvdGUyKHRhZyl9LGApO1xuICAgICAgICAgIGRlY29kZTMocGF5bG9hZCk7XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KFwiKVwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic2xvdFwiOiB7XG4gICAgICAgICAgbGV0IHsgaWZhY2UgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgY29uc3QgaW5kZXggPSBOdW1iZXIoTmF0KHJhd1RyZWUuaW5kZXgpKTtcbiAgICAgICAgICBjb25zdCBuZXN0ZWRSZW5kZXIgPSAoYXJnKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBvbGRPdXQgPSBvdXQ7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBvdXQgPSBtYWtlTm9JbmRlbnRlcigpO1xuICAgICAgICAgICAgICBkZWNvZGUzKGFyZyk7XG4gICAgICAgICAgICAgIHJldHVybiBvdXQuZG9uZSgpO1xuICAgICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgb3V0ID0gb2xkT3V0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYgKGluZGV4IDwgc2xvdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBzbG90ID0gbmVzdGVkUmVuZGVyKHNsb3RzW2luZGV4XSk7XG4gICAgICAgICAgICBpZiAoaWZhY2UgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoYHNsb3RUb1ZhbCgke3Nsb3R9KWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWZhY2UgPSBuZXN0ZWRSZW5kZXIoaWZhY2UpO1xuICAgICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGBzbG90VG9WYWwoJHtzbG90fSwke2lmYWNlfSlgKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGlmYWNlID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIHJldHVybiBvdXQubmV4dChgc2xvdCgke2luZGV4fSlgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWZhY2UgPSBuZXN0ZWRSZW5kZXIoaWZhY2UpO1xuICAgICAgICAgIHJldHVybiBvdXQubmV4dChgc2xvdCgke2luZGV4fSwke2lmYWNlfSlgKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiaGlsYmVydFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBvcmlnaW5hbCwgcmVzdCB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBvdXQub3BlbihcIntcIik7XG4gICAgICAgICAgZGVjb2RlUHJvcGVydHkoUUNMQVNTLCBvcmlnaW5hbCk7XG4gICAgICAgICAgaWYgKFwicmVzdFwiIGluIHJhd1RyZWUpIHtcbiAgICAgICAgICAgIGFzc2VydC50eXBlb2YocmVzdCwgXCJvYmplY3RcIik7XG4gICAgICAgICAgICBhc3NlcnQocmVzdCAhPT0gbnVsbCk7XG4gICAgICAgICAgICBjb25zdCBuYW1lcyA9IG93bktleXMxMyhyZXN0KTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykge1xuICAgICAgICAgICAgICBpZiAodHlwZW9mIG5hbWUgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFByb3BlcnR5IG5hbWUgJHtxdW90ZShcbiAgICAgICAgICAgICAgICAgIG5hbWVcbiAgICAgICAgICAgICAgICApfSBvZiAke3Jlc3R9IG11c3QgYmUgYSBzdHJpbmdgO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGRlY29kZVByb3BlcnR5KG5hbWUsIHJlc3RbbmFtZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gb3V0LmNsb3NlKFwifVwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBtZXNzYWdlLFxuICAgICAgICAgICAgY2F1c2UgPSB2b2lkIDAsXG4gICAgICAgICAgICBlcnJvcnMgPSB2b2lkIDBcbiAgICAgICAgICB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBjYXVzZSA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgZXJyb3IgY2F1c2Ugbm90IHlldCBpbXBsZW1lbnRlZCBpbiBtYXJzaGFsLWp1c3RpbmA7XG4gICAgICAgICAgbmFtZSAhPT0gYEFnZ3JlZ2F0ZUVycm9yYCB8fCB0aHJvd1JlZGFjdGVkYEFnZ3JlZ2F0ZUVycm9yIG5vdCB5ZXQgaW1wbGVtZW50ZWQgaW4gbWFyc2hhbC1qdXN0aW5gO1xuICAgICAgICAgIGVycm9ycyA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgZXJyb3IgZXJyb3JzIG5vdCB5ZXQgaW1wbGVtZW50ZWQgaW4gbWFyc2hhbC1qdXN0aW5gO1xuICAgICAgICAgIHJldHVybiBvdXQubmV4dChgJHtuYW1lfSgke3F1b3RlMihtZXNzYWdlKX0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRocm93IGFzc2VydC5mYWlsKFxuICAgICAgICAgICAgcmVkYWN0ZWRgdW5yZWNvZ25pemVkICR7cXVvdGUoUUNMQVNTKX0gJHtxdW90ZShxY2xhc3MpfWAsXG4gICAgICAgICAgICBUeXBlRXJyb3JcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChpc0FycmF5NyhyYXdUcmVlKSkge1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHJhd1RyZWU7XG4gICAgICBpZiAobGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBvdXQubmV4dChcIltdXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3V0Lm9wZW4oXCJbXCIpO1xuICAgICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbGVuZ3RoOyBpMiArPSAxKSB7XG4gICAgICAgICAgb3V0LmxpbmUoKTtcbiAgICAgICAgICBkZWNvZGUzKHJhd1RyZWVbaTJdKTtcbiAgICAgICAgICBvdXQubmV4dChcIixcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dC5jbG9zZShcIl1cIik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG5hbWVzID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvd25LZXlzMTMocmF3VHJlZSlcbiAgICAgICk7XG4gICAgICBpZiAobmFtZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBvdXQubmV4dChcInt9XCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3V0Lm9wZW4oXCJ7XCIpO1xuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgbmFtZXMpIHtcbiAgICAgICAgICBkZWNvZGVQcm9wZXJ0eShuYW1lLCByYXdUcmVlW25hbWVdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0LmNsb3NlKFwifVwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHByZXBhcmUoZW5jb2RpbmcpO1xuICBkZWNvZGUzKGVuY29kaW5nKTtcbiAgcmV0dXJuIG91dC5kb25lKCk7XG59O1xuaGFyZGVuKGRlY29kZVRvSnVzdGluKTtcblxuLy9cbnZhciB7IGlzQXJyYXk6IGlzQXJyYXk4IH0gPSBBcnJheTtcbnZhciB7IGZyb21FbnRyaWVzOiBmcm9tRW50cmllczUsIGlzOiBpczMgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IG93bktleXMxNCB9ID0gUmVmbGVjdDtcbnZhciByQzAgPSAvW1xceDAwLVxceDFGXS87XG52YXIgZ2V0U3VmZml4ID0gKHN0ciwgaW5kZXgpID0+IGluZGV4ID09PSAwID8gc3RyIDogc3RyLnN1YnN0cmluZyhpbmRleCk7XG52YXIgcmVjb3JkTmFtZXMgPSAocmVjb3JkKSA9PiAoXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIGhhcmRlbihcbiAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgIG93bktleXMxNChyZWNvcmQpLnNvcnQoKS5yZXZlcnNlKClcbiAgKVxuKTtcbmhhcmRlbihyZWNvcmROYW1lcyk7XG52YXIgcmVjb3JkVmFsdWVzID0gKHJlY29yZCwgbmFtZXMpID0+IGhhcmRlbihuYW1lcy5tYXAoKG5hbWUpID0+IHJlY29yZFtuYW1lXSkpO1xuaGFyZGVuKHJlY29yZFZhbHVlcyk7XG52YXIgemVyb2VzID0gQXJyYXkoMTYpLmZpbGwodm9pZCAwKS5tYXAoKF8sIGkyKSA9PiBcIjBcIi5yZXBlYXQoaTIpKTtcbnZhciB6ZXJvUGFkID0gKG4yLCBzaXplKSA9PiB7XG4gIGNvbnN0IG5TdHIgPSBgJHtuMn1gO1xuICBjb25zdCBmaWxsTGVuID0gc2l6ZSAtIG5TdHIubGVuZ3RoO1xuICBpZiAoZmlsbExlbiA9PT0gMCkgcmV0dXJuIG5TdHI7XG4gIGFzc2VydChmaWxsTGVuID4gMCAmJiBmaWxsTGVuIDwgemVyb2VzLmxlbmd0aCk7XG4gIHJldHVybiBgJHt6ZXJvZXNbZmlsbExlbl19JHtuU3RyfWA7XG59O1xuaGFyZGVuKHplcm9QYWQpO1xudmFyIGFzTnVtYmVyID0gbmV3IEZsb2F0NjRBcnJheSgxKTtcbnZhciBhc0JpdHMgPSBuZXcgQmlnVWludDY0QXJyYXkoYXNOdW1iZXIuYnVmZmVyKTtcbnZhciBDYW5vbmljYWxOYU5CaXRzID0gXCJmZmY4MDAwMDAwMDAwMDAwXCI7XG52YXIgZW5jb2RlQmluYXJ5NjQgPSAobjIpID0+IHtcbiAgaWYgKGlzMyhuMiwgLTApKSB7XG4gICAgbjIgPSAwO1xuICB9IGVsc2UgaWYgKGlzMyhuMiwgTmFOKSkge1xuICAgIHJldHVybiBgZiR7Q2Fub25pY2FsTmFOQml0c31gO1xuICB9XG4gIGFzTnVtYmVyWzBdID0gbjI7XG4gIGxldCBiaXRzID0gYXNCaXRzWzBdO1xuICBpZiAobjIgPCAwKSB7XG4gICAgYml0cyBePSAweGZmZmZmZmZmZmZmZmZmZmZuO1xuICB9IGVsc2Uge1xuICAgIGJpdHMgXj0gMHg4MDAwMDAwMDAwMDAwMDAwbjtcbiAgfVxuICByZXR1cm4gYGYke3plcm9QYWQoYml0cy50b1N0cmluZygxNiksIDE2KX1gO1xufTtcbnZhciBkZWNvZGVCaW5hcnk2NCA9IChlbmNvZGVkLCBza2lwID0gMCkgPT4ge1xuICBlbmNvZGVkLmNoYXJBdChza2lwKSA9PT0gXCJmXCIgfHwgdGhyb3dSZWRhY3RlZGBFbmNvZGVkIG51bWJlciBleHBlY3RlZDogJHtlbmNvZGVkfWA7XG4gIGxldCBiaXRzID0gQmlnSW50KGAweCR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXAgKyAxKX1gKTtcbiAgaWYgKGVuY29kZWQuY2hhckF0KHNraXAgKyAxKSA8IFwiOFwiKSB7XG4gICAgYml0cyBePSAweGZmZmZmZmZmZmZmZmZmZmZuO1xuICB9IGVsc2Uge1xuICAgIGJpdHMgXj0gMHg4MDAwMDAwMDAwMDAwMDAwbjtcbiAgfVxuICBhc0JpdHNbMF0gPSBiaXRzO1xuICBjb25zdCByZXN1bHQgPSBhc051bWJlclswXTtcbiAgIWlzMyhyZXN1bHQsIC0wKSB8fCB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgbmVnYXRpdmUgemVybzogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgZW5jb2RlQmlnSW50ID0gKG4yKSA9PiB7XG4gIGNvbnN0IGFicyA9IG4yIDwgMG4gPyAtbjIgOiBuMjtcbiAgY29uc3QgbkRpZ2l0cyA9IGFicy50b1N0cmluZygpLmxlbmd0aDtcbiAgY29uc3QgbERpZ2l0cyA9IG5EaWdpdHMudG9TdHJpbmcoKS5sZW5ndGg7XG4gIGlmIChuMiA8IDBuKSB7XG4gICAgcmV0dXJuIGBuJHsvL1xuICAgIC8vXG4gICAgXCIjXCIucmVwZWF0KGxEaWdpdHMgLSAxKX0key8vXG4gICAgKDEwICoqIGxEaWdpdHMgLSBuRGlnaXRzKS50b1N0cmluZygpLnBhZFN0YXJ0KGxEaWdpdHMsIFwiMFwiKX06JHsvL1xuICAgICgxMG4gKiogQmlnSW50KG5EaWdpdHMpICsgbjIpLnRvU3RyaW5nKCkucGFkU3RhcnQobkRpZ2l0cywgXCIwXCIpfWA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGBwJHsvL1xuICAgIC8vXG4gICAgXCJ+XCIucmVwZWF0KGxEaWdpdHMgLSAxKX0key8vXG4gICAgbkRpZ2l0c306JHsvL1xuICAgIG4yfWA7XG4gIH1cbn07XG52YXIgckJpZ0ludFBheWxvYWQgPSAvKFswLTldKykoOihbMC05XSskfCl8KS9zO1xudmFyIGRlY29kZUJpZ0ludCA9IChlbmNvZGVkKSA9PiB7XG4gIGNvbnN0IHR5cGVQcmVmaXggPSBlbmNvZGVkLmNoYXJBdCgwKTtcbiAgdHlwZVByZWZpeCA9PT0gXCJwXCIgfHwgdHlwZVByZWZpeCA9PT0gXCJuXCIgfHwgdGhyb3dSZWRhY3RlZGBFbmNvZGVkIGJpZ2ludCBleHBlY3RlZDogJHtlbmNvZGVkfWA7XG4gIGNvbnN0IHtcbiAgICBpbmRleDogbERpZ2l0cyxcbiAgICAxOiBzbkRpZ2l0cyxcbiAgICAyOiB0YWlsLFxuICAgIDM6IGRpZ2l0c1xuICB9ID0gZW5jb2RlZC5tYXRjaChyQmlnSW50UGF5bG9hZCkgfHwgdGhyb3dSZWRhY3RlZGBEaWdpdCBjb3VudCBleHBlY3RlZDogJHtlbmNvZGVkfWA7XG4gIHNuRGlnaXRzLmxlbmd0aCA9PT0gbERpZ2l0cyB8fCB0aHJvd1JlZGFjdGVkYFVuYXJ5LXByZWZpeGVkIGRlY2ltYWwgZGlnaXQgY291bnQgZXhwZWN0ZWQ6ICR7ZW5jb2RlZH1gO1xuICBsZXQgbkRpZ2l0cyA9IHBhcnNlSW50KHNuRGlnaXRzLCAxMCk7XG4gIGlmICh0eXBlUHJlZml4ID09PSBcIm5cIikge1xuICAgIG5EaWdpdHMgPSAxMCAqKiAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICBsRGlnaXRzIC0gbkRpZ2l0cztcbiAgfVxuICB0YWlsLmNoYXJBdCgwKSA9PT0gXCI6XCIgfHwgdGhyb3dSZWRhY3RlZGBTZXBhcmF0b3IgZXhwZWN0ZWQ6ICR7ZW5jb2RlZH1gO1xuICBkaWdpdHMubGVuZ3RoID09PSBuRGlnaXRzIHx8IHRocm93UmVkYWN0ZWRgRml4ZWQtbGVuZ3RoIGRpZ2l0IHNlcXVlbmNlIGV4cGVjdGVkOiAke2VuY29kZWR9YDtcbiAgbGV0IG4yID0gQmlnSW50KGRpZ2l0cyk7XG4gIGlmICh0eXBlUHJlZml4ID09PSBcIm5cIikge1xuICAgIG4yID0gLSgxMG4gKiogQmlnSW50KG5EaWdpdHMpIC0gbjIpO1xuICB9XG4gIHJldHVybiBuMjtcbn07XG52YXIgc3RyaW5nRXNjYXBlcyA9IEFycmF5KDM0KS5maWxsKHZvaWQgMCkubWFwKChfLCBjcCkgPT4ge1xuICBzd2l0Y2ggKFN0cmluZy5mcm9tQ2hhckNvZGUoY3ApKSB7XG4gICAgY2FzZSBcIiBcIjpcbiAgICAgIHJldHVybiBcIiFfXCI7XG4gICAgY2FzZSBcIiFcIjpcbiAgICAgIHJldHVybiBcIiF8XCI7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBgISR7U3RyaW5nLmZyb21DaGFyQ29kZShjcCArIDMzKX1gO1xuICB9XG59KTtcbnN0cmluZ0VzY2FwZXNbXCJeXCIuY2hhckNvZGVBdCgwKV0gPSBcIl9AXCI7XG5zdHJpbmdFc2NhcGVzW1wiX1wiLmNoYXJDb2RlQXQoMCldID0gXCJfX1wiO1xudmFyIGVuY29kZUNvbXBhY3RTdHJpbmdTdWZmaXggPSAoc3RyKSA9PiBzdHIucmVwbGFjZSgvW1xcMC0hXl9dL2csIChjaCkgPT4gc3RyaW5nRXNjYXBlc1tjaC5jaGFyQ29kZUF0KDApXSk7XG52YXIgZGVjb2RlQ29tcGFjdFN0cmluZ1N1ZmZpeCA9IChlbmNvZGVkKSA9PiB7XG4gIHJldHVybiBlbmNvZGVkLnJlcGxhY2UoLyhbXFwwLSFfXSkoLnxcXG4pPy9nLCAoZXNjLCBwcmVmaXgsIHN1ZmZpeCkgPT4ge1xuICAgIHN3aXRjaCAoZXNjKSB7XG4gICAgICBjYXNlIFwiIV9cIjpcbiAgICAgICAgcmV0dXJuIFwiIFwiO1xuICAgICAgY2FzZSBcIiF8XCI6XG4gICAgICAgIHJldHVybiBcIiFcIjtcbiAgICAgIGNhc2UgXCJfQFwiOlxuICAgICAgICByZXR1cm4gXCJeXCI7XG4gICAgICBjYXNlIFwiX19cIjpcbiAgICAgICAgcmV0dXJuIFwiX1wiO1xuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBjb25zdCBjaCA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBzdWZmaXhcbiAgICAgICAgKTtcbiAgICAgICAgcHJlZml4ID09PSBcIiFcIiAmJiBzdWZmaXggIT09IHZvaWQgMCAmJiBjaCA+PSBcIiFcIiAmJiBjaCA8PSBcIkBcIiB8fCB0aHJvd1JlZGFjdGVkYGludmFsaWQgc3RyaW5nIGVzY2FwZTogJHtxdW90ZShlc2MpfWA7XG4gICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoLmNoYXJDb2RlQXQoMCkgLSAzMyk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgZW5jb2RlTGVnYWN5U3RyaW5nU3VmZml4ID0gKHN0cikgPT4gc3RyO1xudmFyIGRlY29kZUxlZ2FjeVN0cmluZ1N1ZmZpeCA9IChlbmNvZGVkKSA9PiBlbmNvZGVkO1xudmFyIGVuY29kZUNvbXBhY3RBcnJheSA9IChhcnJheSwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgY29uc3QgY2hhcnMgPSBbXCJeXCJdO1xuICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgYXJyYXkpIHtcbiAgICBjb25zdCBlbmMgPSBlbmNvZGVQYXNzYWJsZShlbGVtZW50KTtcbiAgICBjaGFycy5wdXNoKGVuYywgXCIgXCIpO1xuICB9XG4gIHJldHVybiBjaGFycy5qb2luKFwiXCIpO1xufTtcbnZhciBkZWNvZGVDb21wYWN0QXJyYXkgPSAoZW5jb2RlZCwgZGVjb2RlUGFzc2FibGUsIHNraXAgPSAwKSA9PiB7XG4gIGNvbnN0IGVsZW1lbnRzID0gW107XG4gIGxldCBkZXB0aCA9IDA7XG4gIGxldCBuZXh0SW5kZXggPSBza2lwICsgMTtcbiAgbGV0IGN1cnJlbnRFbGVtZW50U3RhcnQgPSBza2lwICsgMTtcbiAgZm9yIChjb25zdCB7IDA6IGNoLCBpbmRleDogaTIgfSBvZiBlbmNvZGVkLm1hdGNoQWxsKC9bXFxeIF0vZykpIHtcbiAgICBjb25zdCBpbmRleCA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgaTJcbiAgICApO1xuICAgIGlmIChpbmRleCA8PSBza2lwKSB7XG4gICAgICBpZiAoaW5kZXggPT09IHNraXApIHtcbiAgICAgICAgY2ggPT09IFwiXlwiIHx8IHRocm93UmVkYWN0ZWRgRW5jb2RlZCBhcnJheSBleHBlY3RlZDogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGNoID09PSBcIl5cIikge1xuICAgICAgZGVwdGggKz0gMTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGluZGV4ID09PSBuZXh0SW5kZXgpIHtcbiAgICAgICAgZGVwdGggLT0gMTtcbiAgICAgICAgZGVwdGggPj0gMCB8fCAvL1xuICAgICAgICB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgYXJyYXkgZWxlbWVudCB0ZXJtaW5hdG9yOiAke2VuY29kZWQuc2xpY2Uoc2tpcCwgaW5kZXggKyAyKX1gO1xuICAgICAgfVxuICAgICAgaWYgKGRlcHRoID09PSAwKSB7XG4gICAgICAgIGVsZW1lbnRzLnB1c2goXG4gICAgICAgICAgZGVjb2RlUGFzc2FibGUoZW5jb2RlZC5zbGljZShjdXJyZW50RWxlbWVudFN0YXJ0LCBpbmRleCkpXG4gICAgICAgICk7XG4gICAgICAgIGN1cnJlbnRFbGVtZW50U3RhcnQgPSBpbmRleCArIDE7XG4gICAgICB9XG4gICAgfVxuICAgIG5leHRJbmRleCA9IGluZGV4ICsgMTtcbiAgfVxuICBkZXB0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYHVudGVybWluYXRlZCBhcnJheTogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgbmV4dEluZGV4ID09PSBlbmNvZGVkLmxlbmd0aCB8fCB0aHJvd1JlZGFjdGVkYHVudGVybWluYXRlZCBhcnJheSBlbGVtZW50OiAke2dldFN1ZmZpeChcbiAgICBlbmNvZGVkLFxuICAgIGN1cnJlbnRFbGVtZW50U3RhcnRcbiAgKX1gO1xuICByZXR1cm4gaGFyZGVuKGVsZW1lbnRzKTtcbn07XG52YXIgZW5jb2RlTGVnYWN5QXJyYXkgPSAoYXJyYXksIGVuY29kZVBhc3NhYmxlKSA9PiB7XG4gIGNvbnN0IGNoYXJzID0gW1wiW1wiXTtcbiAgZm9yIChjb25zdCBlbGVtZW50IG9mIGFycmF5KSB7XG4gICAgY29uc3QgZW5jID0gZW5jb2RlUGFzc2FibGUoZWxlbWVudCk7XG4gICAgZm9yIChjb25zdCBjMiBvZiBlbmMpIHtcbiAgICAgIGlmIChjMiA9PT0gXCJcXDBcIiB8fCBjMiA9PT0gXCJcdTAwMDFcIikge1xuICAgICAgICBjaGFycy5wdXNoKFwiXHUwMDAxXCIpO1xuICAgICAgfVxuICAgICAgY2hhcnMucHVzaChjMik7XG4gICAgfVxuICAgIGNoYXJzLnB1c2goXCJcXDBcIik7XG4gIH1cbiAgcmV0dXJuIGNoYXJzLmpvaW4oXCJcIik7XG59O1xudmFyIGRlY29kZUxlZ2FjeUFycmF5ID0gKGVuY29kZWQsIGRlY29kZVBhc3NhYmxlLCBza2lwID0gMCkgPT4ge1xuICBjb25zdCBlbGVtZW50cyA9IFtdO1xuICBjb25zdCBlbGVtQ2hhcnMgPSBbXTtcbiAgbGV0IHN0aWxsVG9Ta2lwID0gc2tpcCArIDE7XG4gIGxldCBpbkVzY2FwZSA9IGZhbHNlO1xuICBmb3IgKGNvbnN0IGMyIG9mIGVuY29kZWQpIHtcbiAgICBpZiAoc3RpbGxUb1NraXAgPiAwKSB7XG4gICAgICBzdGlsbFRvU2tpcCAtPSAxO1xuICAgICAgaWYgKHN0aWxsVG9Ta2lwID09PSAwKSB7XG4gICAgICAgIGMyID09PSBcIltcIiB8fCB0aHJvd1JlZGFjdGVkYEVuY29kZWQgYXJyYXkgZXhwZWN0ZWQ6ICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChpbkVzY2FwZSkge1xuICAgICAgYzIgPT09IFwiXFwwXCIgfHwgYzIgPT09IFwiXHUwMDAxXCIgfHwgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIGNoYXJhY3RlciBhZnRlciB1MDAwMSBlc2NhcGU6ICR7YzJ9YDtcbiAgICAgIGVsZW1DaGFycy5wdXNoKGMyKTtcbiAgICB9IGVsc2UgaWYgKGMyID09PSBcIlxcMFwiKSB7XG4gICAgICBjb25zdCBlbmNvZGVkRWxlbWVudCA9IGVsZW1DaGFycy5qb2luKFwiXCIpO1xuICAgICAgZWxlbUNoYXJzLmxlbmd0aCA9IDA7XG4gICAgICBjb25zdCBlbGVtZW50ID0gZGVjb2RlUGFzc2FibGUoZW5jb2RlZEVsZW1lbnQpO1xuICAgICAgZWxlbWVudHMucHVzaChlbGVtZW50KTtcbiAgICB9IGVsc2UgaWYgKGMyID09PSBcIlx1MDAwMVwiKSB7XG4gICAgICBpbkVzY2FwZSA9IHRydWU7XG4gICAgICBjb250aW51ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgZWxlbUNoYXJzLnB1c2goYzIpO1xuICAgIH1cbiAgICBpbkVzY2FwZSA9IGZhbHNlO1xuICB9XG4gICFpbkVzY2FwZSB8fCB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZW5kIG9mIGVuY29kaW5nICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gIGVsZW1DaGFycy5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBlbmNvZGluZyB0ZXJtaW5hdGVkIGVhcmx5OiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICByZXR1cm4gaGFyZGVuKGVsZW1lbnRzKTtcbn07XG52YXIgZW5jb2RlUmVjb3JkID0gKHJlY29yZCwgZW5jb2RlQXJyYXksIGVuY29kZVBhc3NhYmxlKSA9PiB7XG4gIGNvbnN0IG5hbWVzID0gcmVjb3JkTmFtZXMocmVjb3JkKTtcbiAgY29uc3QgdmFsdWVzNiA9IHJlY29yZFZhbHVlcyhyZWNvcmQsIG5hbWVzKTtcbiAgcmV0dXJuIGAoJHtlbmNvZGVBcnJheShoYXJkZW4oW25hbWVzLCB2YWx1ZXM2XSksIGVuY29kZVBhc3NhYmxlKX1gO1xufTtcbnZhciBkZWNvZGVSZWNvcmQgPSAoZW5jb2RlZCwgZGVjb2RlQXJyYXksIGRlY29kZVBhc3NhYmxlLCBza2lwID0gMCkgPT4ge1xuICBhc3NlcnQoZW5jb2RlZC5jaGFyQXQoc2tpcCkgPT09IFwiKFwiKTtcbiAgY29uc3QgdW56aXBwZWRFbnRyaWVzID0gZGVjb2RlQXJyYXkoZW5jb2RlZCwgZGVjb2RlUGFzc2FibGUsIHNraXAgKyAxKTtcbiAgdW56aXBwZWRFbnRyaWVzLmxlbmd0aCA9PT0gMiB8fCB0aHJvd1JlZGFjdGVkYGV4cGVjdGVkIGtleXMsdmFsdWVzIHBhaXI6ICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gIGNvbnN0IFtrZXlzNCwgdmFsc10gPSB1bnppcHBlZEVudHJpZXM7XG4gIHBhc3NTdHlsZU9mKGtleXM0KSA9PT0gXCJjb3B5QXJyYXlcIiAmJiBwYXNzU3R5bGVPZih2YWxzKSA9PT0gXCJjb3B5QXJyYXlcIiAmJiBrZXlzNC5sZW5ndGggPT09IHZhbHMubGVuZ3RoICYmIGtleXM0LmV2ZXJ5KChrZXkpID0+IHR5cGVvZiBrZXkgPT09IFwic3RyaW5nXCIpIHx8IHRocm93UmVkYWN0ZWRgbm90IGEgdmFsaWQgcmVjb3JkIGVuY29kaW5nOiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICBjb25zdCBtYXBFbnRyaWVzID0ga2V5czQubWFwKChrZXksIGkyKSA9PiBba2V5LCB2YWxzW2kyXV0pO1xuICBjb25zdCByZWNvcmQgPSBoYXJkZW4oZnJvbUVudHJpZXM1KG1hcEVudHJpZXMpKTtcbiAgYXNzZXJ0UmVjb3JkKHJlY29yZCwgXCJkZWNvZGVkIHJlY29yZFwiKTtcbiAgcmV0dXJuIHJlY29yZDtcbn07XG52YXIgZW5jb2RlVGFnZ2VkID0gKHRhZ2dlZCwgZW5jb2RlQXJyYXksIGVuY29kZVBhc3NhYmxlKSA9PiBgOiR7ZW5jb2RlQXJyYXkoaGFyZGVuKFtnZXRUYWcodGFnZ2VkKSwgdGFnZ2VkLnBheWxvYWRdKSwgZW5jb2RlUGFzc2FibGUpfWA7XG52YXIgZGVjb2RlVGFnZ2VkID0gKGVuY29kZWQsIGRlY29kZUFycmF5LCBkZWNvZGVQYXNzYWJsZSwgc2tpcCA9IDApID0+IHtcbiAgYXNzZXJ0KGVuY29kZWQuY2hhckF0KHNraXApID09PSBcIjpcIik7XG4gIGNvbnN0IHRhZ2dlZFBheWxvYWQgPSBkZWNvZGVBcnJheShlbmNvZGVkLCBkZWNvZGVQYXNzYWJsZSwgc2tpcCArIDEpO1xuICB0YWdnZWRQYXlsb2FkLmxlbmd0aCA9PT0gMiB8fCB0aHJvd1JlZGFjdGVkYGV4cGVjdGVkIHRhZyxwYXlsb2FkIHBhaXI6ICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gIGNvbnN0IFt0YWcsIHBheWxvYWRdID0gdGFnZ2VkUGF5bG9hZDtcbiAgcGFzc1N0eWxlT2YodGFnKSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYG5vdCBhIHZhbGlkIHRhZ2dlZCBlbmNvZGluZzogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgcmV0dXJuIG1ha2VUYWdnZWQodGFnLCBwYXlsb2FkKTtcbn07XG52YXIgbWFrZUVuY29kZVJlbW90YWJsZSA9ICh1bnNhZmVFbmNvZGVSZW1vdGFibGUsIHZlcmlmeUVuY29kaW5nKSA9PiB7XG4gIGNvbnN0IGVuY29kZVJlbW90YWJsZSA9IChyNSwgaW5uZXJFbmNvZGUpID0+IHtcbiAgICBjb25zdCBlbmNvZGluZyA9IHVuc2FmZUVuY29kZVJlbW90YWJsZShyNSwgaW5uZXJFbmNvZGUpO1xuICAgIHR5cGVvZiBlbmNvZGluZyA9PT0gXCJzdHJpbmdcIiAmJiBlbmNvZGluZy5jaGFyQXQoMCkgPT09IFwiclwiIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlIGVuY29kaW5nIG11c3Qgc3RhcnQgd2l0aCBcInJcIjogJHtlbmNvZGluZ31gO1xuICAgIHZlcmlmeUVuY29kaW5nKGVuY29kaW5nLCBcIlJlbW90YWJsZVwiKTtcbiAgICByZXR1cm4gZW5jb2Rpbmc7XG4gIH07XG4gIHJldHVybiBlbmNvZGVSZW1vdGFibGU7XG59O1xudmFyIG1ha2VFbmNvZGVQcm9taXNlID0gKHVuc2FmZUVuY29kZVByb21pc2UsIHZlcmlmeUVuY29kaW5nKSA9PiB7XG4gIGNvbnN0IGVuY29kZVByb21pc2UgPSAocDMsIGlubmVyRW5jb2RlKSA9PiB7XG4gICAgY29uc3QgZW5jb2RpbmcgPSB1bnNhZmVFbmNvZGVQcm9taXNlKHAzLCBpbm5lckVuY29kZSk7XG4gICAgdHlwZW9mIGVuY29kaW5nID09PSBcInN0cmluZ1wiICYmIGVuY29kaW5nLmNoYXJBdCgwKSA9PT0gXCI/XCIgfHwgdGhyb3dSZWRhY3RlZGBQcm9taXNlIGVuY29kaW5nIG11c3Qgc3RhcnQgd2l0aCBcIj9cIjogJHtlbmNvZGluZ31gO1xuICAgIHZlcmlmeUVuY29kaW5nKGVuY29kaW5nLCBcIlByb21pc2VcIik7XG4gICAgcmV0dXJuIGVuY29kaW5nO1xuICB9O1xuICByZXR1cm4gZW5jb2RlUHJvbWlzZTtcbn07XG52YXIgbWFrZUVuY29kZUVycm9yID0gKHVuc2FmZUVuY29kZUVycm9yLCB2ZXJpZnlFbmNvZGluZykgPT4ge1xuICBjb25zdCBlbmNvZGVFcnJvciA9IChlcnIsIGlubmVyRW5jb2RlKSA9PiB7XG4gICAgY29uc3QgZW5jb2RpbmcgPSB1bnNhZmVFbmNvZGVFcnJvcihlcnIsIGlubmVyRW5jb2RlKTtcbiAgICB0eXBlb2YgZW5jb2RpbmcgPT09IFwic3RyaW5nXCIgJiYgZW5jb2RpbmcuY2hhckF0KDApID09PSBcIiFcIiB8fCB0aHJvd1JlZGFjdGVkYEVycm9yIGVuY29kaW5nIG11c3Qgc3RhcnQgd2l0aCBcIiFcIjogJHtlbmNvZGluZ31gO1xuICAgIHZlcmlmeUVuY29kaW5nKGVuY29kaW5nLCBcIkVycm9yXCIpO1xuICAgIHJldHVybiBlbmNvZGluZztcbiAgfTtcbiAgcmV0dXJuIGVuY29kZUVycm9yO1xufTtcbnZhciBtYWtlSW5uZXJFbmNvZGUgPSAoZW5jb2RlU3RyaW5nU3VmZml4LCBlbmNvZGVBcnJheSwgb3B0aW9ucykgPT4ge1xuICBjb25zdCB7XG4gICAgZW5jb2RlUmVtb3RhYmxlOiB1bnNhZmVFbmNvZGVSZW1vdGFibGUsXG4gICAgZW5jb2RlUHJvbWlzZTogdW5zYWZlRW5jb2RlUHJvbWlzZSxcbiAgICBlbmNvZGVFcnJvcjogdW5zYWZlRW5jb2RlRXJyb3IsXG4gICAgdmVyaWZ5RW5jb2RpbmcgPSAoKSA9PiB7XG4gICAgfVxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgZW5jb2RlUmVtb3RhYmxlID0gbWFrZUVuY29kZVJlbW90YWJsZShcbiAgICB1bnNhZmVFbmNvZGVSZW1vdGFibGUsXG4gICAgdmVyaWZ5RW5jb2RpbmdcbiAgKTtcbiAgY29uc3QgZW5jb2RlUHJvbWlzZSA9IG1ha2VFbmNvZGVQcm9taXNlKHVuc2FmZUVuY29kZVByb21pc2UsIHZlcmlmeUVuY29kaW5nKTtcbiAgY29uc3QgZW5jb2RlRXJyb3IgPSBtYWtlRW5jb2RlRXJyb3IodW5zYWZlRW5jb2RlRXJyb3IsIHZlcmlmeUVuY29kaW5nKTtcbiAgY29uc3QgaW5uZXJFbmNvZGUgPSAocGFzc2FibGUpID0+IHtcbiAgICBpZiAoaXNFcnJvckxpa2UocGFzc2FibGUpKSB7XG4gICAgICByZXR1cm4gZW5jb2RlRXJyb3IocGFzc2FibGUsIGlubmVyRW5jb2RlKTtcbiAgICB9XG4gICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocGFzc2FibGUpO1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwibnVsbFwiOiB7XG4gICAgICAgIHJldHVybiBcInZcIjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjoge1xuICAgICAgICByZXR1cm4gXCJ6XCI7XG4gICAgICB9XG4gICAgICBjYXNlIFwibnVtYmVyXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZUJpbmFyeTY0KHBhc3NhYmxlKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJzdHJpbmdcIjoge1xuICAgICAgICByZXR1cm4gYHMke2VuY29kZVN0cmluZ1N1ZmZpeChwYXNzYWJsZSl9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJib29sZWFuXCI6IHtcbiAgICAgICAgcmV0dXJuIGBiJHtwYXNzYWJsZX1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJpZ2ludFwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVCaWdJbnQocGFzc2FibGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVSZW1vdGFibGUocGFzc2FibGUsIGlubmVyRW5jb2RlKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVFcnJvcihwYXNzYWJsZSwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICByZXR1cm4gZW5jb2RlUHJvbWlzZShwYXNzYWJsZSwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBuYW1lRm9yUGFzc2FibGVTeW1ib2wocGFzc2FibGUpO1xuICAgICAgICBhc3NlcnQudHlwZW9mKG5hbWUsIFwic3RyaW5nXCIpO1xuICAgICAgICByZXR1cm4gYHkke2VuY29kZVN0cmluZ1N1ZmZpeChuYW1lKX1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVBcnJheShwYXNzYWJsZSwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICByZXR1cm4gZW5jb2RlUmVjb3JkKHBhc3NhYmxlLCBlbmNvZGVBcnJheSwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVUYWdnZWQocGFzc2FibGUsIGVuY29kZUFycmF5LCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgYSAke3F1b3RlKHBhc3NTdHlsZSl9IGNhbm5vdCBiZSB1c2VkIGFzIGEgY29sbGVjdGlvbiBwYXNzYWJsZWA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gaW5uZXJFbmNvZGU7XG59O1xudmFyIGxpYmVyYWxEZWNvZGVycyA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgLyogICAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgZGVjb2RlUmVtb3RhYmxlOiAoX2VuY29kaW5nLCBfaW5uZXJEZWNvZGUpID0+IHZvaWQgMCxcbiAgICBkZWNvZGVQcm9taXNlOiAoX2VuY29kaW5nLCBfaW5uZXJEZWNvZGUpID0+IHZvaWQgMCxcbiAgICBkZWNvZGVFcnJvcjogKF9lbmNvZGluZywgX2lubmVyRGVjb2RlKSA9PiB2b2lkIDBcbiAgfVxuKTtcbnZhciBtYWtlSW5uZXJEZWNvZGUgPSAoZGVjb2RlU3RyaW5nU3VmZml4LCBkZWNvZGVBcnJheSwgb3B0aW9ucykgPT4ge1xuICBjb25zdCB7IGRlY29kZVJlbW90YWJsZSwgZGVjb2RlUHJvbWlzZSwgZGVjb2RlRXJyb3IgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IGlubmVyRGVjb2RlID0gKGVuY29kZWQsIHNraXAgPSAwKSA9PiB7XG4gICAgc3dpdGNoIChlbmNvZGVkLmNoYXJBdChza2lwKSkge1xuICAgICAgY2FzZSBcInZcIjoge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ6XCI6IHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJmXCI6IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZUJpbmFyeTY0KGVuY29kZWQsIHNraXApO1xuICAgICAgfVxuICAgICAgY2FzZSBcInNcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlU3RyaW5nU3VmZml4KGdldFN1ZmZpeChlbmNvZGVkLCBza2lwICsgMSkpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJcIjoge1xuICAgICAgICBjb25zdCBzdWJzdHJpbmcgPSBnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCArIDEpO1xuICAgICAgICBpZiAoc3Vic3RyaW5nID09PSBcInRydWVcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHN1YnN0cmluZyA9PT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQgZW5jb2RlZCBib29sZWFuIHRvIGJlIFwiYnRydWVcIiBvciBcImJmYWxzZVwiOiAke3N1YnN0cmluZ31gO1xuICAgICAgfVxuICAgICAgY2FzZSBcIm5cIjpcbiAgICAgIGNhc2UgXCJwXCI6IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZUJpZ0ludChnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCkpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInJcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlUmVtb3RhYmxlKGdldFN1ZmZpeChlbmNvZGVkLCBza2lwKSwgaW5uZXJEZWNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcIj9cIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlUHJvbWlzZShnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCksIGlubmVyRGVjb2RlKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCIhXCI6IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZUVycm9yKGdldFN1ZmZpeChlbmNvZGVkLCBza2lwKSwgaW5uZXJEZWNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInlcIjoge1xuICAgICAgICBjb25zdCBuYW1lID0gZGVjb2RlU3RyaW5nU3VmZml4KGdldFN1ZmZpeChlbmNvZGVkLCBza2lwICsgMSkpO1xuICAgICAgICByZXR1cm4gcGFzc2FibGVTeW1ib2xGb3JOYW1lKG5hbWUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcIltcIjpcbiAgICAgIGNhc2UgXCJeXCI6IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZUFycmF5KGVuY29kZWQsIGlubmVyRGVjb2RlLCBza2lwKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCIoXCI6IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZVJlY29yZChlbmNvZGVkLCBkZWNvZGVBcnJheSwgaW5uZXJEZWNvZGUsIHNraXApO1xuICAgICAgfVxuICAgICAgY2FzZSBcIjpcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlVGFnZ2VkKGVuY29kZWQsIGRlY29kZUFycmF5LCBpbm5lckRlY29kZSwgc2tpcCk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW52YWxpZCBkYXRhYmFzZSBrZXk6ICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gaW5uZXJEZWNvZGU7XG59O1xudmFyIG1ha2VQYXNzYWJsZUtpdCA9IChvcHRpb25zID0ge30pID0+IHtcbiAgY29uc3Qge1xuICAgIGVuY29kZVJlbW90YWJsZSA9IChyNSwgXykgPT4gdGhyb3dSZWRhY3RlZGByZW1vdGFibGUgdW5leHBlY3RlZDogJHtyNX1gLFxuICAgIGVuY29kZVByb21pc2UgPSAocDMsIF8pID0+IHRocm93UmVkYWN0ZWRgcHJvbWlzZSB1bmV4cGVjdGVkOiAke3AzfWAsXG4gICAgZW5jb2RlRXJyb3IgPSAoZXJyLCBfKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIHVuZXhwZWN0ZWQ6ICR7ZXJyfWAsXG4gICAgZm9ybWF0ID0gXCJsZWdhY3lPcmRlcmVkXCIsXG4gICAgZGVjb2RlUmVtb3RhYmxlID0gKGVuY29kaW5nLCBfKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke2VuY29kaW5nfWAsXG4gICAgZGVjb2RlUHJvbWlzZSA9IChlbmNvZGluZywgXykgPT4gdGhyb3dSZWRhY3RlZGBwcm9taXNlIHVuZXhwZWN0ZWQ6ICR7ZW5jb2Rpbmd9YCxcbiAgICBkZWNvZGVFcnJvciA9IChlbmNvZGluZywgXykgPT4gdGhyb3dSZWRhY3RlZGBlcnJvciB1bmV4cGVjdGVkOiAke2VuY29kaW5nfWBcbiAgfSA9IG9wdGlvbnM7XG4gIGxldCBlbmNvZGVQYXNzYWJsZTtcbiAgY29uc3QgZW5jb2RlT3B0aW9ucyA9IHsgZW5jb2RlUmVtb3RhYmxlLCBlbmNvZGVQcm9taXNlLCBlbmNvZGVFcnJvciwgZm9ybWF0IH07XG4gIGlmIChmb3JtYXQgPT09IFwiY29tcGFjdE9yZGVyZWRcIikge1xuICAgIGNvbnN0IGxpYmVyYWxEZWNvZGUgPSBtYWtlSW5uZXJEZWNvZGUoXG4gICAgICBkZWNvZGVDb21wYWN0U3RyaW5nU3VmZml4LFxuICAgICAgZGVjb2RlQ29tcGFjdEFycmF5LFxuICAgICAgbGliZXJhbERlY29kZXJzXG4gICAgKTtcbiAgICBjb25zdCB2ZXJpZnlFbmNvZGluZyA9IChlbmNvZGluZywgbGFiZWwpID0+IHtcbiAgICAgICFlbmNvZGluZy5tYXRjaChyQzApIHx8IHRocm93UmVkYWN0ZWRgJHtiYXJlT3JRdW90ZShcbiAgICAgICAgbGFiZWxcbiAgICAgICl9IGVuY29kaW5nIG11c3Qgbm90IGNvbnRhaW4gYSBDMCBjb250cm9sIGNoYXJhY3RlcjogJHtlbmNvZGluZ31gO1xuICAgICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZUNvbXBhY3RBcnJheShgXnYgJHtlbmNvZGluZ30gdiBgLCBsaWJlcmFsRGVjb2RlKTtcbiAgICAgIGlzQXJyYXk4KGRlY29kZWQpICYmIGRlY29kZWQubGVuZ3RoID09PSAzICYmIGRlY29kZWRbMF0gPT09IG51bGwgJiYgZGVjb2RlZFsyXSA9PT0gbnVsbCB8fCB0aHJvd1JlZGFjdGVkYCR7YmFyZU9yUXVvdGUobGFiZWwpfSBlbmNvZGluZyBtdXN0IGJlIGVtYmVkZGFibGU6ICR7ZW5jb2Rpbmd9YDtcbiAgICB9O1xuICAgIGNvbnN0IGVuY29kZUNvbXBhY3QgPSBtYWtlSW5uZXJFbmNvZGUoXG4gICAgICBlbmNvZGVDb21wYWN0U3RyaW5nU3VmZml4LFxuICAgICAgZW5jb2RlQ29tcGFjdEFycmF5LFxuICAgICAgeyAuLi5lbmNvZGVPcHRpb25zLCB2ZXJpZnlFbmNvZGluZyB9XG4gICAgKTtcbiAgICBlbmNvZGVQYXNzYWJsZSA9IChwYXNzYWJsZSkgPT4gYH4ke2VuY29kZUNvbXBhY3QocGFzc2FibGUpfWA7XG4gIH0gZWxzZSBpZiAoZm9ybWF0ID09PSBcImxlZ2FjeU9yZGVyZWRcIikge1xuICAgIGVuY29kZVBhc3NhYmxlID0gbWFrZUlubmVyRW5jb2RlKFxuICAgICAgZW5jb2RlTGVnYWN5U3RyaW5nU3VmZml4LFxuICAgICAgZW5jb2RlTGVnYWN5QXJyYXksXG4gICAgICBlbmNvZGVPcHRpb25zXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFVucmVjb2duaXplZCBmb3JtYXQ6ICR7cXVvdGUoZm9ybWF0KX1gO1xuICB9XG4gIGNvbnN0IGRlY29kZU9wdGlvbnMgPSB7IGRlY29kZVJlbW90YWJsZSwgZGVjb2RlUHJvbWlzZSwgZGVjb2RlRXJyb3IgfTtcbiAgY29uc3QgZGVjb2RlQ29tcGFjdCA9IG1ha2VJbm5lckRlY29kZShcbiAgICBkZWNvZGVDb21wYWN0U3RyaW5nU3VmZml4LFxuICAgIGRlY29kZUNvbXBhY3RBcnJheSxcbiAgICBkZWNvZGVPcHRpb25zXG4gICk7XG4gIGNvbnN0IGRlY29kZUxlZ2FjeSA9IG1ha2VJbm5lckRlY29kZShcbiAgICBkZWNvZGVMZWdhY3lTdHJpbmdTdWZmaXgsXG4gICAgZGVjb2RlTGVnYWN5QXJyYXksXG4gICAgZGVjb2RlT3B0aW9uc1xuICApO1xuICBjb25zdCBkZWNvZGVQYXNzYWJsZSA9IChlbmNvZGVkKSA9PiB7XG4gICAgaWYgKGVuY29kZWQuY2hhckF0KDApID09PSBcIn5cIikge1xuICAgICAgcmV0dXJuIGRlY29kZUNvbXBhY3QoZW5jb2RlZCwgMSk7XG4gICAgfVxuICAgIHJldHVybiBkZWNvZGVMZWdhY3koZW5jb2RlZCk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oeyBlbmNvZGVQYXNzYWJsZSwgZGVjb2RlUGFzc2FibGUgfSk7XG59O1xuaGFyZGVuKG1ha2VQYXNzYWJsZUtpdCk7XG52YXIgbWFrZUVuY29kZVBhc3NhYmxlID0gKGVuY29kZU9wdGlvbnMpID0+IHtcbiAgY29uc3QgeyBlbmNvZGVQYXNzYWJsZSB9ID0gbWFrZVBhc3NhYmxlS2l0KGVuY29kZU9wdGlvbnMpO1xuICByZXR1cm4gZW5jb2RlUGFzc2FibGU7XG59O1xuaGFyZGVuKG1ha2VFbmNvZGVQYXNzYWJsZSk7XG52YXIgbWFrZURlY29kZVBhc3NhYmxlID0gKGRlY29kZU9wdGlvbnMpID0+IHtcbiAgY29uc3QgeyBkZWNvZGVQYXNzYWJsZSB9ID0gbWFrZVBhc3NhYmxlS2l0KGRlY29kZU9wdGlvbnMpO1xuICByZXR1cm4gZGVjb2RlUGFzc2FibGU7XG59O1xuaGFyZGVuKG1ha2VEZWNvZGVQYXNzYWJsZSk7XG52YXIgaXNFbmNvZGVkUmVtb3RhYmxlID0gKGVuY29kZWQpID0+IGVuY29kZWQuY2hhckF0KDApID09PSBcInJcIjtcbmhhcmRlbihpc0VuY29kZWRSZW1vdGFibGUpO1xudmFyIHBhc3NTdHlsZVByZWZpeGVzID0ge1xuICBlcnJvcjogXCIhXCIsXG4gIGNvcHlSZWNvcmQ6IFwiKFwiLFxuICB0YWdnZWQ6IFwiOlwiLFxuICBwcm9taXNlOiBcIj9cIixcbiAgY29weUFycmF5OiBcIlteXCIsXG4gIGJvb2xlYW46IFwiYlwiLFxuICBudW1iZXI6IFwiZlwiLFxuICBiaWdpbnQ6IFwibnBcIixcbiAgcmVtb3RhYmxlOiBcInJcIixcbiAgc3RyaW5nOiBcInNcIixcbiAgbnVsbDogXCJ2XCIsXG4gIHN5bWJvbDogXCJ5XCIsXG4gIC8vXG4gIC8vXG4gIC8vXG4gIHVuZGVmaW5lZDogXCJ6XCJcbn07XG5PYmplY3Quc2V0UHJvdG90eXBlT2YocGFzc1N0eWxlUHJlZml4ZXMsIG51bGwpO1xuaGFyZGVuKHBhc3NTdHlsZVByZWZpeGVzKTtcblxuLy9cbnZhciB7IGVudHJpZXM6IGVudHJpZXM2LCBmcm9tRW50cmllczogZnJvbUVudHJpZXM2LCBzZXRQcm90b3R5cGVPZjogc2V0UHJvdG90eXBlT2YyLCBpczogaXM0IH0gPSBPYmplY3Q7XG52YXIgc2FtZVZhbHVlWmVybyA9ICh4LCB5KSA9PiB4ID09PSB5IHx8IGlzNCh4LCB5KTtcbnZhciB0cml2aWFsQ29tcGFyYXRvciA9IChsZWZ0LCByaWdodCkgPT4gKFxuICAvL1xuICBsZWZ0IDwgcmlnaHQgPyAtMSA6IGxlZnQgPT09IHJpZ2h0ID8gMCA6IDFcbik7XG52YXIgcGFzc1N0eWxlUmFua3MgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIGZyb21FbnRyaWVzNihcbiAgICBlbnRyaWVzNihwYXNzU3R5bGVQcmVmaXhlcykuc29ydCgoW19sZWZ0U3R5bGUsIGxlZnRQcmVmaXhlc10sIFtfcmlnaHRTdHlsZSwgcmlnaHRQcmVmaXhlc10pID0+IHtcbiAgICAgIHJldHVybiB0cml2aWFsQ29tcGFyYXRvcihsZWZ0UHJlZml4ZXMsIHJpZ2h0UHJlZml4ZXMpO1xuICAgIH0pLm1hcCgoW3Bhc3NTdHlsZSwgcHJlZml4ZXNdLCBpbmRleCkgPT4ge1xuICAgICAgcHJlZml4ZXMgPT09IFsuLi5wcmVmaXhlc10uc29ydCgpLmpvaW4oXCJcIikgfHwgdGhyb3dSZWRhY3RlZGB1bnNvcnRlZCBwcmVmaXhlcyBmb3IgcGFzc1N0eWxlICR7cXVvdGUocGFzc1N0eWxlKX06ICR7cXVvdGUocHJlZml4ZXMpfWA7XG4gICAgICBjb25zdCBjb3ZlciA9IFtcbiAgICAgICAgcHJlZml4ZXMuY2hhckF0KDApLFxuICAgICAgICBTdHJpbmcuZnJvbUNoYXJDb2RlKHByZWZpeGVzLmNoYXJDb2RlQXQocHJlZml4ZXMubGVuZ3RoIC0gMSkgKyAxKVxuICAgICAgXTtcbiAgICAgIHJldHVybiBbcGFzc1N0eWxlLCB7IGluZGV4LCBjb3ZlciB9XTtcbiAgICB9KVxuICApXG4pO1xuc2V0UHJvdG90eXBlT2YyKHBhc3NTdHlsZVJhbmtzLCBudWxsKTtcbmhhcmRlbihwYXNzU3R5bGVSYW5rcyk7XG52YXIgZ2V0UGFzc1N0eWxlQ292ZXIgPSAocGFzc1N0eWxlKSA9PiBwYXNzU3R5bGVSYW5rc1twYXNzU3R5bGVdLmNvdmVyO1xuaGFyZGVuKGdldFBhc3NTdHlsZUNvdmVyKTtcbnZhciBtZW1vT2ZTb3J0ZWQgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbnZhciBjb21wYXJhdG9yTWlycm9ySW1hZ2VzID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG52YXIgbWFrZUNvbXBhcmF0b3JLaXQgPSAoY29tcGFyZVJlbW90YWJsZXMgPSAoX3gsIF95KSA9PiBOYU4pID0+IHtcbiAgY29uc3QgY29tcGFyYXRvciA9IChsZWZ0LCByaWdodCkgPT4ge1xuICAgIGlmIChzYW1lVmFsdWVaZXJvKGxlZnQsIHJpZ2h0KSkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIGNvbnN0IGxlZnRTdHlsZSA9IHBhc3NTdHlsZU9mKGxlZnQpO1xuICAgIGNvbnN0IHJpZ2h0U3R5bGUgPSBwYXNzU3R5bGVPZihyaWdodCk7XG4gICAgaWYgKGxlZnRTdHlsZSAhPT0gcmlnaHRTdHlsZSkge1xuICAgICAgcmV0dXJuIHRyaXZpYWxDb21wYXJhdG9yKFxuICAgICAgICBwYXNzU3R5bGVSYW5rc1tsZWZ0U3R5bGVdLmluZGV4LFxuICAgICAgICBwYXNzU3R5bGVSYW5rc1tyaWdodFN0eWxlXS5pbmRleFxuICAgICAgKTtcbiAgICB9XG4gICAgc3dpdGNoIChsZWZ0U3R5bGUpIHtcbiAgICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgICByZXR1cm4gY29tcGFyZVJlbW90YWJsZXMobGVmdCwgcmlnaHQpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgICAgY2FzZSBcIm51bGxcIjpcbiAgICAgIGNhc2UgXCJlcnJvclwiOlxuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJib29sZWFuXCI6XG4gICAgICBjYXNlIFwiYmlnaW50XCI6XG4gICAgICBjYXNlIFwic3RyaW5nXCI6IHtcbiAgICAgICAgaWYgKGxlZnQgPCByaWdodCkge1xuICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhc3NlcnQobGVmdCA+IHJpZ2h0KTtcbiAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICAgIHJldHVybiBjb21wYXJhdG9yKFxuICAgICAgICAgIG5hbWVGb3JQYXNzYWJsZVN5bWJvbChsZWZ0KSxcbiAgICAgICAgICBuYW1lRm9yUGFzc2FibGVTeW1ib2wocmlnaHQpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjYXNlIFwibnVtYmVyXCI6IHtcbiAgICAgICAgaWYgKE51bWJlci5pc05hTihsZWZ0KSkge1xuICAgICAgICAgIGFzc2VydCghTnVtYmVyLmlzTmFOKHJpZ2h0KSk7XG4gICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH0gZWxzZSBpZiAoTnVtYmVyLmlzTmFOKHJpZ2h0KSkge1xuICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGVmdCA8IHJpZ2h0KSB7XG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFzc2VydChsZWZ0ID4gcmlnaHQpO1xuICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGNvbnN0IGxlZnROYW1lcyA9IHJlY29yZE5hbWVzKGxlZnQpO1xuICAgICAgICBjb25zdCByaWdodE5hbWVzID0gcmVjb3JkTmFtZXMocmlnaHQpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21wYXJhdG9yKGxlZnROYW1lcywgcmlnaHROYW1lcyk7XG4gICAgICAgIGlmIChyZXN1bHQgIT09IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxlZnRWYWx1ZXMgPSByZWNvcmRWYWx1ZXMobGVmdCwgbGVmdE5hbWVzKTtcbiAgICAgICAgY29uc3QgcmlnaHRWYWx1ZXMgPSByZWNvcmRWYWx1ZXMocmlnaHQsIHJpZ2h0TmFtZXMpO1xuICAgICAgICByZXR1cm4gY29tcGFyYXRvcihsZWZ0VmFsdWVzLCByaWdodFZhbHVlcyk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgY29uc3QgbGVuID0gTWF0aC5taW4obGVmdC5sZW5ndGgsIHJpZ2h0Lmxlbmd0aCk7XG4gICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBsZW47IGkyICs9IDEpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBjb21wYXJhdG9yKGxlZnRbaTJdLCByaWdodFtpMl0pO1xuICAgICAgICAgIGlmIChyZXN1bHQgIT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb21wYXJhdG9yKGxlZnQubGVuZ3RoLCByaWdodC5sZW5ndGgpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgIGNvbnN0IGxhYmVsQ29tcCA9IGNvbXBhcmF0b3IoZ2V0VGFnKGxlZnQpLCBnZXRUYWcocmlnaHQpKTtcbiAgICAgICAgaWYgKGxhYmVsQ29tcCAhPT0gMCkge1xuICAgICAgICAgIHJldHVybiBsYWJlbENvbXA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbXBhcmF0b3IobGVmdC5wYXlsb2FkLCByaWdodC5wYXlsb2FkKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBVbnJlY29nbml6ZWQgcGFzc1N0eWxlOiAke3F1b3RlKGxlZnRTdHlsZSl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IG91dGVyQ29tcGFyYXRvciA9ICh4LCB5KSA9PiAoXG4gICAgLy9cbiAgICAvL1xuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBjb21wYXJhdG9yKHgsIHkpIHx8IDBcbiAgKTtcbiAgY29uc3QgYW50aUNvbXBhcmF0b3IgPSAoeCwgeSkgPT4gb3V0ZXJDb21wYXJhdG9yKHksIHgpO1xuICBtZW1vT2ZTb3J0ZWQuc2V0KG91dGVyQ29tcGFyYXRvciwgLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCkpO1xuICBtZW1vT2ZTb3J0ZWQuc2V0KGFudGlDb21wYXJhdG9yLCAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKSk7XG4gIGNvbXBhcmF0b3JNaXJyb3JJbWFnZXMuc2V0KG91dGVyQ29tcGFyYXRvciwgYW50aUNvbXBhcmF0b3IpO1xuICBjb21wYXJhdG9yTWlycm9ySW1hZ2VzLnNldChhbnRpQ29tcGFyYXRvciwgb3V0ZXJDb21wYXJhdG9yKTtcbiAgcmV0dXJuIGhhcmRlbih7IGNvbXBhcmF0b3I6IG91dGVyQ29tcGFyYXRvciwgYW50aUNvbXBhcmF0b3IgfSk7XG59O1xudmFyIGlzUmFua1NvcnRlZCA9IChwYXNzYWJsZXMsIGNvbXBhcmUpID0+IHtcbiAgY29uc3Qgc3ViTWVtb09mU29ydGVkID0gbWVtb09mU29ydGVkLmdldChjb21wYXJlKTtcbiAgYXNzZXJ0KHN1Yk1lbW9PZlNvcnRlZCAhPT0gdm9pZCAwKTtcbiAgaWYgKHN1Yk1lbW9PZlNvcnRlZC5oYXMocGFzc2FibGVzKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGFzc2VydChwYXNzU3R5bGVPZihwYXNzYWJsZXMpID09PSBcImNvcHlBcnJheVwiKTtcbiAgZm9yIChsZXQgaTIgPSAxOyBpMiA8IHBhc3NhYmxlcy5sZW5ndGg7IGkyICs9IDEpIHtcbiAgICBpZiAoY29tcGFyZShwYXNzYWJsZXNbaTIgLSAxXSwgcGFzc2FibGVzW2kyXSkgPj0gMSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICBzdWJNZW1vT2ZTb3J0ZWQuYWRkKHBhc3NhYmxlcyk7XG4gIHJldHVybiB0cnVlO1xufTtcbmhhcmRlbihpc1JhbmtTb3J0ZWQpO1xudmFyIGFzc2VydFJhbmtTb3J0ZWQgPSAoc29ydGVkLCBjb21wYXJlKSA9PiBpc1JhbmtTb3J0ZWQoc29ydGVkLCBjb21wYXJlKSB8fCAvL1xuLy9cbnRocm93UmVkYWN0ZWRgTXVzdCBiZSByYW5rIHNvcnRlZDogJHtzb3J0ZWR9IHZzICR7c29ydEJ5UmFuayhzb3J0ZWQsIGNvbXBhcmUpfWA7XG5oYXJkZW4oYXNzZXJ0UmFua1NvcnRlZCk7XG52YXIgc29ydEJ5UmFuayA9IChwYXNzYWJsZXMsIGNvbXBhcmUpID0+IHtcbiAgaWYgKEFycmF5LmlzQXJyYXkocGFzc2FibGVzKSkge1xuICAgIGhhcmRlbihwYXNzYWJsZXMpO1xuICAgIGlmIChpc1JhbmtTb3J0ZWQocGFzc2FibGVzLCBjb21wYXJlKSkge1xuICAgICAgcmV0dXJuIHBhc3NhYmxlcztcbiAgICB9XG4gIH1cbiAgY29uc3QgdW5zb3J0ZWQgPSBbLi4ucGFzc2FibGVzXTtcbiAgdW5zb3J0ZWQuZm9yRWFjaChoYXJkZW4pO1xuICBjb25zdCBzb3J0ZWQgPSB1bnNvcnRlZC5zb3J0KGNvbXBhcmUpO1xuICBpZiAoY29tcGFyZSh0cnVlLCB2b2lkIDApID4gMCkge1xuICAgIGxldCBpMiA9IHNvcnRlZC5sZW5ndGggLSAxO1xuICAgIHdoaWxlIChpMiA+PSAwICYmIHNvcnRlZFtpMl0gPT09IHZvaWQgMCkgaTIgLT0gMTtcbiAgICBjb25zdCBuMiA9IHNvcnRlZC5sZW5ndGggLSBpMiAtIDE7XG4gICAgaWYgKG4yID4gMCAmJiBuMiA8IHNvcnRlZC5sZW5ndGgpIHtcbiAgICAgIHNvcnRlZC5jb3B5V2l0aGluKG4yLCAwKTtcbiAgICAgIHNvcnRlZC5maWxsKFxuICAgICAgICAvKiAgICAgICAgICAgICovXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgMCxcbiAgICAgICAgbjJcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIGhhcmRlbihzb3J0ZWQpO1xuICBjb25zdCBzdWJNZW1vT2ZTb3J0ZWQgPSBtZW1vT2ZTb3J0ZWQuZ2V0KGNvbXBhcmUpO1xuICBhc3NlcnQoc3ViTWVtb09mU29ydGVkICE9PSB2b2lkIDApO1xuICBzdWJNZW1vT2ZTb3J0ZWQuYWRkKHNvcnRlZCk7XG4gIHJldHVybiBzb3J0ZWQ7XG59O1xuaGFyZGVuKHNvcnRCeVJhbmspO1xudmFyIHJhbmtTZWFyY2ggPSAoc29ydGVkLCBjb21wYXJlLCBrZXksIGJpYXMgPSBcImxlZnRNb3N0XCIpID0+IHtcbiAgYXNzZXJ0UmFua1NvcnRlZChzb3J0ZWQsIGNvbXBhcmUpO1xuICBsZXQgbGVmdCA9IDA7XG4gIGxldCByaWdodCA9IHNvcnRlZC5sZW5ndGg7XG4gIHdoaWxlIChsZWZ0IDwgcmlnaHQpIHtcbiAgICBjb25zdCBtMiA9IE1hdGguZmxvb3IoKGxlZnQgKyByaWdodCkgLyAyKTtcbiAgICBjb25zdCBjb21wID0gY29tcGFyZShzb3J0ZWRbbTJdLCBrZXkpO1xuICAgIGlmIChjb21wIDw9IC0xIHx8IGNvbXAgPT09IDAgJiYgYmlhcyA9PT0gXCJyaWdodE1vc3RcIikge1xuICAgICAgbGVmdCA9IG0yICsgMTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXNzZXJ0KGNvbXAgPj0gMSB8fCBjb21wID09PSAwICYmIGJpYXMgPT09IFwibGVmdE1vc3RcIik7XG4gICAgICByaWdodCA9IG0yO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYmlhcyA9PT0gXCJsZWZ0TW9zdFwiID8gbGVmdCA6IHJpZ2h0IC0gMTtcbn07XG52YXIgZ2V0SW5kZXhDb3ZlciA9IChzb3J0ZWQsIGNvbXBhcmUsIFtsZWZ0S2V5LCByaWdodEtleV0pID0+IHtcbiAgYXNzZXJ0UmFua1NvcnRlZChzb3J0ZWQsIGNvbXBhcmUpO1xuICBjb25zdCBsZWZ0SW5kZXggPSByYW5rU2VhcmNoKHNvcnRlZCwgY29tcGFyZSwgbGVmdEtleSwgXCJsZWZ0TW9zdFwiKTtcbiAgY29uc3QgcmlnaHRJbmRleCA9IHJhbmtTZWFyY2goc29ydGVkLCBjb21wYXJlLCByaWdodEtleSwgXCJyaWdodE1vc3RcIik7XG4gIHJldHVybiBbbGVmdEluZGV4LCByaWdodEluZGV4XTtcbn07XG5oYXJkZW4oZ2V0SW5kZXhDb3Zlcik7XG52YXIgRnVsbFJhbmtDb3ZlciA9IGhhcmRlbihbXCJcIiwgXCJ7XCJdKTtcbnZhciBjb3ZlcmVkRW50cmllcyA9IChzb3J0ZWQsIFtsZWZ0SW5kZXgsIHJpZ2h0SW5kZXhdKSA9PiB7XG4gIGNvbnN0IGl0ZXJhYmxlID0gaGFyZGVuKHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgbGV0IGkyID0gbGVmdEluZGV4O1xuICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBpZiAoaTIgPD0gcmlnaHRJbmRleCkge1xuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IHNvcnRlZFtpMl07XG4gICAgICAgICAgICBpMiArPSAxO1xuICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7IHZhbHVlOiBbaTIsIGVsZW1lbnRdLCBkb25lOiBmYWxzZSB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7IHZhbHVlOiB2b2lkIDAsIGRvbmU6IHRydWUgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gaXRlcmFibGU7XG59O1xuaGFyZGVuKGNvdmVyZWRFbnRyaWVzKTtcbnZhciBtYXhSYW5rID0gKGNvbXBhcmUsIGEyLCBiMykgPT4gY29tcGFyZShhMiwgYjMpID49IDAgPyBhMiA6IGIzO1xudmFyIG1pblJhbmsgPSAoY29tcGFyZSwgYTIsIGIzKSA9PiBjb21wYXJlKGEyLCBiMykgPD0gMCA/IGEyIDogYjM7XG52YXIgdW5pb25SYW5rQ292ZXJzID0gKGNvbXBhcmUsIGNvdmVycykgPT4ge1xuICBjb25zdCB1bmlvblJhbmtDb3ZlclBhaXIgPSAoW2xlZnRBLCByaWdodEFdLCBbbGVmdEIsIHJpZ2h0Ql0pID0+IFtcbiAgICBtaW5SYW5rKGNvbXBhcmUsIGxlZnRBLCBsZWZ0QiksXG4gICAgbWF4UmFuayhjb21wYXJlLCByaWdodEEsIHJpZ2h0QilcbiAgXTtcbiAgcmV0dXJuIGNvdmVycy5yZWR1Y2UodW5pb25SYW5rQ292ZXJQYWlyLCBbXCJ7XCIsIFwiXCJdKTtcbn07XG5oYXJkZW4odW5pb25SYW5rQ292ZXJzKTtcbnZhciBpbnRlcnNlY3RSYW5rQ292ZXJzID0gKGNvbXBhcmUsIGNvdmVycykgPT4ge1xuICBjb25zdCBpbnRlcnNlY3RSYW5rQ292ZXJQYWlyID0gKFtsZWZ0QSwgcmlnaHRBXSwgW2xlZnRCLCByaWdodEJdKSA9PiBbXG4gICAgbWF4UmFuayhjb21wYXJlLCBsZWZ0QSwgbGVmdEIpLFxuICAgIG1pblJhbmsoY29tcGFyZSwgcmlnaHRBLCByaWdodEIpXG4gIF07XG4gIHJldHVybiBjb3ZlcnMucmVkdWNlKGludGVyc2VjdFJhbmtDb3ZlclBhaXIsIFtcIlwiLCBcIntcIl0pO1xufTtcbnZhciB7IGNvbXBhcmF0b3I6IGNvbXBhcmVSYW5rLCBhbnRpQ29tcGFyYXRvcjogY29tcGFyZUFudGlSYW5rIH0gPSBtYWtlQ29tcGFyYXRvcktpdCgpO1xudmFyIG1ha2VGdWxsT3JkZXJDb21wYXJhdG9yS2l0ID0gKGxvbmdMaXZlZCA9IGZhbHNlKSA9PiB7XG4gIGxldCBudW1TZWVuID0gMDtcbiAgY29uc3QgTWFwQ29uc3RydWN0b3IgPSBsb25nTGl2ZWQgPyBXZWFrTWFwIDogTWFwO1xuICBjb25zdCBzZWVuID0gbmV3IE1hcENvbnN0cnVjdG9yKCk7XG4gIGNvbnN0IHRhZyA9IChyNSkgPT4ge1xuICAgIGlmIChzZWVuLmhhcyhyNSkpIHtcbiAgICAgIHJldHVybiBzZWVuLmdldChyNSk7XG4gICAgfVxuICAgIG51bVNlZW4gKz0gMTtcbiAgICBzZWVuLnNldChyNSwgbnVtU2Vlbik7XG4gICAgcmV0dXJuIG51bVNlZW47XG4gIH07XG4gIGNvbnN0IGNvbXBhcmVSZW1vdGFibGVzID0gKHgsIHkpID0+IGNvbXBhcmVSYW5rKHRhZyh4KSwgdGFnKHkpKTtcbiAgcmV0dXJuIG1ha2VDb21wYXJhdG9yS2l0KGNvbXBhcmVSZW1vdGFibGVzKTtcbn07XG5oYXJkZW4obWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQpO1xuXG4vL1xudmFyIGlkZW50Q2hlY2tlciA9IChjb25kLCBfZGV0YWlscykgPT4gY29uZDtcbmhhcmRlbihpZGVudENoZWNrZXIpO1xuXG4vL1xudmFyIGNoZWNrTm9EdXBsaWNhdGVzID0gKGVsZW1lbnRzLCBmdWxsQ29tcGFyZSwgY2hlY2spID0+IHtcbiAgZnVsbENvbXBhcmUgPSBmdWxsQ29tcGFyZSB8fCBtYWtlRnVsbE9yZGVyQ29tcGFyYXRvcktpdCgpLmFudGlDb21wYXJhdG9yO1xuICBlbGVtZW50cyA9IHNvcnRCeVJhbmsoZWxlbWVudHMsIGZ1bGxDb21wYXJlKTtcbiAgY29uc3QgeyBsZW5ndGggfSA9IGVsZW1lbnRzO1xuICBmb3IgKGxldCBpMiA9IDE7IGkyIDwgbGVuZ3RoOyBpMiArPSAxKSB7XG4gICAgY29uc3QgazAgPSBlbGVtZW50c1tpMiAtIDFdO1xuICAgIGNvbnN0IGsxID0gZWxlbWVudHNbaTJdO1xuICAgIGlmIChmdWxsQ29tcGFyZShrMCwgazEpID09PSAwKSB7XG4gICAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYHZhbHVlIGhhcyBkdXBsaWNhdGUga2V5czogJHtrMH1gKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xudmFyIGFzc2VydE5vRHVwbGljYXRlcyA9IChlbGVtZW50cywgZnVsbENvbXBhcmUgPSB2b2lkIDApID0+IHtcbiAgY2hlY2tOb0R1cGxpY2F0ZXMoZWxlbWVudHMsIGZ1bGxDb21wYXJlLCBhc3NlcnRDaGVja2VyKTtcbn07XG52YXIgY2hlY2tFbGVtZW50cyA9IChlbGVtZW50cywgY2hlY2spID0+IHtcbiAgaWYgKHBhc3NTdHlsZU9mKGVsZW1lbnRzKSAhPT0gXCJjb3B5QXJyYXlcIikge1xuICAgIHJldHVybiBjaGVjayhcbiAgICAgIGZhbHNlLFxuICAgICAgcmVkYWN0ZWRgVGhlIGtleXMgb2YgYSBjb3B5U2V0IG9yIGNvcHlNYXAgbXVzdCBiZSBhIGNvcHlBcnJheTogJHtlbGVtZW50c31gXG4gICAgKTtcbiAgfVxuICBpZiAoIWlzUmFua1NvcnRlZChlbGVtZW50cywgY29tcGFyZUFudGlSYW5rKSkge1xuICAgIHJldHVybiBjaGVjayhcbiAgICAgIGZhbHNlLFxuICAgICAgcmVkYWN0ZWRgVGhlIGtleXMgb2YgYSBjb3B5U2V0IG9yIGNvcHlNYXAgbXVzdCBiZSBzb3J0ZWQgaW4gcmV2ZXJzZSByYW5rIG9yZGVyOiAke2VsZW1lbnRzfWBcbiAgICApO1xuICB9XG4gIHJldHVybiBjaGVja05vRHVwbGljYXRlcyhlbGVtZW50cywgdm9pZCAwLCBjaGVjayk7XG59O1xuaGFyZGVuKGNoZWNrRWxlbWVudHMpO1xudmFyIGFzc2VydEVsZW1lbnRzID0gKGVsZW1lbnRzKSA9PiB7XG4gIGNoZWNrRWxlbWVudHMoZWxlbWVudHMsIGFzc2VydENoZWNrZXIpO1xufTtcbmhhcmRlbihhc3NlcnRFbGVtZW50cyk7XG52YXIgY29lcmNlVG9FbGVtZW50cyA9IChlbGVtZW50c0xpc3QpID0+IHtcbiAgY29uc3QgZWxlbWVudHMgPSBzb3J0QnlSYW5rKGVsZW1lbnRzTGlzdCwgY29tcGFyZUFudGlSYW5rKTtcbiAgYXNzZXJ0RWxlbWVudHMoZWxlbWVudHMpO1xuICByZXR1cm4gZWxlbWVudHM7XG59O1xuaGFyZGVuKGNvZXJjZVRvRWxlbWVudHMpO1xudmFyIG1ha2VTZXRPZkVsZW1lbnRzID0gKGVsZW1lbnRJdGVyKSA9PiBtYWtlVGFnZ2VkKFwiY29weVNldFwiLCBjb2VyY2VUb0VsZW1lbnRzKGVsZW1lbnRJdGVyKSk7XG5oYXJkZW4obWFrZVNldE9mRWxlbWVudHMpO1xuXG4vL1xudmFyIGNoZWNrTm9EdXBsaWNhdGVLZXlzID0gKGJhZ0VudHJpZXMsIGZ1bGxDb21wYXJlLCBjaGVjaykgPT4ge1xuICBmdWxsQ29tcGFyZSA9IGZ1bGxDb21wYXJlIHx8IG1ha2VGdWxsT3JkZXJDb21wYXJhdG9yS2l0KCkuYW50aUNvbXBhcmF0b3I7XG4gIGJhZ0VudHJpZXMgPSBzb3J0QnlSYW5rKGJhZ0VudHJpZXMsIGZ1bGxDb21wYXJlKTtcbiAgY29uc3QgeyBsZW5ndGggfSA9IGJhZ0VudHJpZXM7XG4gIGZvciAobGV0IGkyID0gMTsgaTIgPCBsZW5ndGg7IGkyICs9IDEpIHtcbiAgICBjb25zdCBrMCA9IGJhZ0VudHJpZXNbaTIgLSAxXVswXTtcbiAgICBjb25zdCBrMSA9IGJhZ0VudHJpZXNbaTJdWzBdO1xuICAgIGlmIChmdWxsQ29tcGFyZShrMCwgazEpID09PSAwKSB7XG4gICAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYHZhbHVlIGhhcyBkdXBsaWNhdGUga2V5czogJHtrMH1gKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xudmFyIGFzc2VydE5vRHVwbGljYXRlS2V5cyA9IChiYWdFbnRyaWVzLCBmdWxsQ29tcGFyZSA9IHZvaWQgMCkgPT4ge1xuICBjaGVja05vRHVwbGljYXRlS2V5cyhiYWdFbnRyaWVzLCBmdWxsQ29tcGFyZSwgYXNzZXJ0Q2hlY2tlcik7XG59O1xudmFyIGNoZWNrQmFnRW50cmllcyA9IChiYWdFbnRyaWVzLCBjaGVjaykgPT4ge1xuICBpZiAocGFzc1N0eWxlT2YoYmFnRW50cmllcykgIT09IFwiY29weUFycmF5XCIpIHtcbiAgICByZXR1cm4gY2hlY2soXG4gICAgICBmYWxzZSxcbiAgICAgIHJlZGFjdGVkYFRoZSBlbnRyaWVzIG9mIGEgY29weUJhZyBtdXN0IGJlIGEgY29weUFycmF5OiAke2JhZ0VudHJpZXN9YFxuICAgICk7XG4gIH1cbiAgaWYgKCFpc1JhbmtTb3J0ZWQoYmFnRW50cmllcywgY29tcGFyZUFudGlSYW5rKSkge1xuICAgIHJldHVybiBjaGVjayhcbiAgICAgIGZhbHNlLFxuICAgICAgcmVkYWN0ZWRgVGhlIGVudHJpZXMgb2YgYSBjb3B5QmFnIG11c3QgYmUgc29ydGVkIGluIHJldmVyc2UgcmFuayBvcmRlcjogJHtiYWdFbnRyaWVzfWBcbiAgICApO1xuICB9XG4gIGZvciAoY29uc3QgZW50cnkgb2YgYmFnRW50cmllcykge1xuICAgIGlmIChwYXNzU3R5bGVPZihlbnRyeSkgIT09IFwiY29weUFycmF5XCIgfHwgZW50cnkubGVuZ3RoICE9PSAyIHx8IHR5cGVvZiBlbnRyeVsxXSAhPT0gXCJiaWdpbnRcIikge1xuICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgcmVkYWN0ZWRgRWFjaCBlbnRyeSBvZiBhIGNvcHlCYWcgbXVzdCBiZSBwYWlyIG9mIGEga2V5IGFuZCBhIGJpZ2ludCByZXByZXNlbnRpbmcgYSBjb3VudDogJHtlbnRyeX1gXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAoZW50cnlbMV0gPCAxKSB7XG4gICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICByZWRhY3RlZGBFYWNoIGVudHJ5IG9mIGEgY29weUJhZyBtdXN0IGhhdmUgYSBwb3NpdGl2ZSBjb3VudDogJHtlbnRyeX1gXG4gICAgICApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gY2hlY2tOb0R1cGxpY2F0ZUtleXMoYmFnRW50cmllcywgdm9pZCAwLCBjaGVjayk7XG59O1xuaGFyZGVuKGNoZWNrQmFnRW50cmllcyk7XG52YXIgYXNzZXJ0QmFnRW50cmllcyA9IChiYWdFbnRyaWVzKSA9PiB7XG4gIGNoZWNrQmFnRW50cmllcyhiYWdFbnRyaWVzLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0QmFnRW50cmllcyk7XG52YXIgY29lcmNlVG9CYWdFbnRyaWVzID0gKGJhZ0VudHJpZXNMaXN0KSA9PiB7XG4gIGNvbnN0IGJhZ0VudHJpZXMgPSBzb3J0QnlSYW5rKGJhZ0VudHJpZXNMaXN0LCBjb21wYXJlQW50aVJhbmspO1xuICBhc3NlcnRCYWdFbnRyaWVzKGJhZ0VudHJpZXMpO1xuICByZXR1cm4gYmFnRW50cmllcztcbn07XG5oYXJkZW4oY29lcmNlVG9CYWdFbnRyaWVzKTtcbnZhciBtYWtlQmFnT2ZFbnRyaWVzID0gKGJhZ0VudHJ5SXRlcikgPT4gbWFrZVRhZ2dlZChcImNvcHlCYWdcIiwgY29lcmNlVG9CYWdFbnRyaWVzKGJhZ0VudHJ5SXRlcikpO1xuaGFyZGVuKG1ha2VCYWdPZkVudHJpZXMpO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czE1IH0gPSBSZWZsZWN0O1xudmFyIGNoZWNrUHJpbWl0aXZlS2V5ID0gKHZhbCwgY2hlY2spID0+IHtcbiAgaWYgKGlzT2JqZWN0Mih2YWwpKSB7XG4gICAgcmV0dXJuIGNoZWNrICE9PSBpZGVudENoZWNrZXIgJiYgY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgJHtxdW90ZSh0eXBlb2YgdmFsKX0gY2Fubm90IGJlIGEgcHJpbWl0aXZlOiAke3ZhbH1gKTtcbiAgfVxuICBhc3NlcnRQYXNzYWJsZSh2YWwpO1xuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgaXNQcmltaXRpdmVLZXkgPSAodmFsKSA9PiBjaGVja1ByaW1pdGl2ZUtleSh2YWwsIGlkZW50Q2hlY2tlcik7XG5oYXJkZW4oaXNQcmltaXRpdmVLZXkpO1xudmFyIGFzc2VydFByaW1pdGl2ZUtleSA9ICh2YWwpID0+IHtcbiAgY2hlY2tQcmltaXRpdmVLZXkodmFsLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0UHJpbWl0aXZlS2V5KTtcbnZhciBjaGVja1NjYWxhcktleSA9ICh2YWwsIGNoZWNrKSA9PiB7XG4gIGlmIChpc1ByaW1pdGl2ZUtleSh2YWwpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YodmFsKTtcbiAgaWYgKHBhc3NTdHlsZSA9PT0gXCJyZW1vdGFibGVcIikge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSAke3F1b3RlKHBhc3NTdHlsZSl9IGNhbm5vdCBiZSBhIHNjYWxhciBrZXk6ICR7dmFsfWApO1xufTtcbnZhciBpc1NjYWxhcktleSA9ICh2YWwpID0+IGNoZWNrU2NhbGFyS2V5KHZhbCwgaWRlbnRDaGVja2VyKTtcbmhhcmRlbihpc1NjYWxhcktleSk7XG52YXIgYXNzZXJ0U2NhbGFyS2V5ID0gKHZhbCkgPT4ge1xuICBjaGVja1NjYWxhcktleSh2YWwsIGFzc2VydENoZWNrZXIpO1xufTtcbmhhcmRlbihhc3NlcnRTY2FsYXJLZXkpO1xudmFyIGtleU1lbW8gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKTtcbnZhciBjaGVja0tleSA9ICh2YWwsIGNoZWNrKSA9PiB7XG4gIGlmICghaXNPYmplY3QyKHZhbCkpIHtcbiAgICBhc3NlcnRQYXNzYWJsZSh2YWwpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmIChrZXlNZW1vLmhhcyh2YWwpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgY29uc3QgcmVzdWx0ID0gY2hlY2tLZXlJbnRlcm5hbCh2YWwsIGNoZWNrKTtcbiAgaWYgKHJlc3VsdCkge1xuICAgIGtleU1lbW8uYWRkKHZhbCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4oY2hlY2tLZXkpO1xudmFyIGlzS2V5ID0gKHZhbCkgPT4gY2hlY2tLZXkodmFsLCBpZGVudENoZWNrZXIpO1xuaGFyZGVuKGlzS2V5KTtcbnZhciBhc3NlcnRLZXkgPSAodmFsKSA9PiB7XG4gIGNoZWNrS2V5KHZhbCwgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydEtleSk7XG52YXIgY29weVNldE1lbW8gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKTtcbnZhciBjaGVja0NvcHlTZXQgPSAoczMsIGNoZWNrKSA9PiB7XG4gIGlmIChjb3B5U2V0TWVtby5oYXMoczMpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgY29uc3QgcmVzdWx0ID0gKHBhc3NTdHlsZU9mKHMzKSA9PT0gXCJ0YWdnZWRcIiAmJiBnZXRUYWcoczMpID09PSBcImNvcHlTZXRcIiB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgTm90IGEgY29weVNldDogJHtzM31gKSkgJiYgY2hlY2tFbGVtZW50cyhzMy5wYXlsb2FkLCBjaGVjaykgJiYgY2hlY2tLZXkoczMucGF5bG9hZCwgY2hlY2spO1xuICBpZiAocmVzdWx0KSB7XG4gICAgY29weVNldE1lbW8uYWRkKHMzKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbmhhcmRlbihjaGVja0NvcHlTZXQpO1xudmFyIGlzQ29weVNldCA9IChzMykgPT4gY2hlY2tDb3B5U2V0KHMzLCBpZGVudENoZWNrZXIpO1xuaGFyZGVuKGlzQ29weVNldCk7XG52YXIgYXNzZXJ0Q29weVNldCA9IChzMykgPT4ge1xuICBjaGVja0NvcHlTZXQoczMsIGFzc2VydENoZWNrZXIpO1xufTtcbmhhcmRlbihhc3NlcnRDb3B5U2V0KTtcbnZhciBnZXRDb3B5U2V0S2V5cyA9IChzMykgPT4ge1xuICBhc3NlcnRDb3B5U2V0KHMzKTtcbiAgcmV0dXJuIHMzLnBheWxvYWQ7XG59O1xuaGFyZGVuKGdldENvcHlTZXRLZXlzKTtcbnZhciBldmVyeUNvcHlTZXRLZXkgPSAoczMsIGZuKSA9PiBnZXRDb3B5U2V0S2V5cyhzMykuZXZlcnkoKGtleSwgaW5kZXgpID0+IGZuKGtleSwgaW5kZXgpKTtcbmhhcmRlbihldmVyeUNvcHlTZXRLZXkpO1xudmFyIG1ha2VDb3B5U2V0ID0gKGVsZW1lbnRJdGVyKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VTZXRPZkVsZW1lbnRzKGVsZW1lbnRJdGVyKTtcbiAgYXNzZXJ0Q29weVNldChyZXN1bHQpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbmhhcmRlbihtYWtlQ29weVNldCk7XG52YXIgY29weUJhZ01lbW8gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKTtcbnZhciBjaGVja0NvcHlCYWcgPSAoYjMsIGNoZWNrKSA9PiB7XG4gIGlmIChjb3B5QmFnTWVtby5oYXMoYjMpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgY29uc3QgcmVzdWx0ID0gKHBhc3NTdHlsZU9mKGIzKSA9PT0gXCJ0YWdnZWRcIiAmJiBnZXRUYWcoYjMpID09PSBcImNvcHlCYWdcIiB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgTm90IGEgY29weUJhZzogJHtiM31gKSkgJiYgY2hlY2tCYWdFbnRyaWVzKGIzLnBheWxvYWQsIGNoZWNrKSAmJiBjaGVja0tleShiMy5wYXlsb2FkLCBjaGVjayk7XG4gIGlmIChyZXN1bHQpIHtcbiAgICBjb3B5QmFnTWVtby5hZGQoYjMpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuaGFyZGVuKGNoZWNrQ29weUJhZyk7XG52YXIgaXNDb3B5QmFnID0gKGIzKSA9PiBjaGVja0NvcHlCYWcoYjMsIGlkZW50Q2hlY2tlcik7XG5oYXJkZW4oaXNDb3B5QmFnKTtcbnZhciBhc3NlcnRDb3B5QmFnID0gKGIzKSA9PiB7XG4gIGNoZWNrQ29weUJhZyhiMywgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydENvcHlCYWcpO1xudmFyIGdldENvcHlCYWdFbnRyaWVzID0gKGIzKSA9PiB7XG4gIGFzc2VydENvcHlCYWcoYjMpO1xuICByZXR1cm4gYjMucGF5bG9hZDtcbn07XG5oYXJkZW4oZ2V0Q29weUJhZ0VudHJpZXMpO1xudmFyIGV2ZXJ5Q29weUJhZ0VudHJ5ID0gKGIzLCBmbikgPT4gZ2V0Q29weUJhZ0VudHJpZXMoYjMpLmV2ZXJ5KChlbnRyeSwgaW5kZXgpID0+IGZuKGVudHJ5LCBpbmRleCkpO1xuaGFyZGVuKGV2ZXJ5Q29weUJhZ0VudHJ5KTtcbnZhciBtYWtlQ29weUJhZyA9IChiYWdFbnRyeUl0ZXIpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gbWFrZUJhZ09mRW50cmllcyhiYWdFbnRyeUl0ZXIpO1xuICBhc3NlcnRDb3B5QmFnKHJlc3VsdCk7XG4gIHJldHVybiByZXN1bHQ7XG59O1xuaGFyZGVuKG1ha2VDb3B5QmFnKTtcbnZhciBtYWtlQ29weUJhZ0Zyb21FbGVtZW50cyA9IChlbGVtZW50SXRlcikgPT4ge1xuICBjb25zdCBmdWxsQ29tcGFyZSA9IG1ha2VGdWxsT3JkZXJDb21wYXJhdG9yS2l0KCkuYW50aUNvbXBhcmF0b3I7XG4gIGNvbnN0IHNvcnRlZCA9IHNvcnRCeVJhbmsoZWxlbWVudEl0ZXIsIGZ1bGxDb21wYXJlKTtcbiAgY29uc3QgZW50cmllczEwID0gW107XG4gIGZvciAobGV0IGkyID0gMDsgaTIgPCBzb3J0ZWQubGVuZ3RoOyApIHtcbiAgICBjb25zdCBrID0gc29ydGVkW2kyXTtcbiAgICBsZXQgaiA9IGkyICsgMTtcbiAgICB3aGlsZSAoaiA8IHNvcnRlZC5sZW5ndGggJiYgZnVsbENvbXBhcmUoaywgc29ydGVkW2pdKSA9PT0gMCkge1xuICAgICAgaiArPSAxO1xuICAgIH1cbiAgICBlbnRyaWVzMTAucHVzaChbaywgQmlnSW50KGogLSBpMildKTtcbiAgICBpMiA9IGo7XG4gIH1cbiAgcmV0dXJuIG1ha2VDb3B5QmFnKGVudHJpZXMxMCk7XG59O1xuaGFyZGVuKG1ha2VDb3B5QmFnRnJvbUVsZW1lbnRzKTtcbnZhciBjb3B5TWFwTWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrQ29weU1hcCA9IChtMiwgY2hlY2spID0+IHtcbiAgaWYgKGNvcHlNYXBNZW1vLmhhcyhtMikpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoIShwYXNzU3R5bGVPZihtMikgPT09IFwidGFnZ2VkXCIgJiYgZ2V0VGFnKG0yKSA9PT0gXCJjb3B5TWFwXCIpKSB7XG4gICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBOb3QgYSBjb3B5TWFwOiAke20yfWApO1xuICB9XG4gIGNvbnN0IHsgcGF5bG9hZCB9ID0gbTI7XG4gIGlmIChwYXNzU3R5bGVPZihwYXlsb2FkKSAhPT0gXCJjb3B5UmVjb3JkXCIpIHtcbiAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgY29weU1hcCdzIHBheWxvYWQgbXVzdCBiZSBhIHJlY29yZDogJHttMn1gKTtcbiAgfVxuICBjb25zdCB7IGtleXM6IGtleXM0LCB2YWx1ZXM6IHZhbHVlczYsIC4uLnJlc3QgfSA9IHBheWxvYWQ7XG4gIGNvbnN0IHJlc3VsdCA9IChvd25LZXlzMTUocmVzdCkubGVuZ3RoID09PSAwIHx8IGNoZWNrKFxuICAgIGZhbHNlLFxuICAgIHJlZGFjdGVkYEEgY29weU1hcCdzIHBheWxvYWQgbXVzdCBvbmx5IGhhdmUgLmtleXMgYW5kIC52YWx1ZXM6ICR7bTJ9YFxuICApKSAmJiBjaGVja0VsZW1lbnRzKGtleXM0LCBjaGVjaykgJiYgY2hlY2tLZXkoa2V5czQsIGNoZWNrKSAmJiAocGFzc1N0eWxlT2YodmFsdWVzNikgPT09IFwiY29weUFycmF5XCIgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgY29weU1hcCdzIC52YWx1ZXMgbXVzdCBiZSBhIGNvcHlBcnJheTogJHttMn1gKSkgJiYgKGtleXM0Lmxlbmd0aCA9PT0gdmFsdWVzNi5sZW5ndGggfHwgY2hlY2soXG4gICAgZmFsc2UsXG4gICAgcmVkYWN0ZWRgQSBjb3B5TWFwIG11c3QgaGF2ZSB0aGUgc2FtZSBudW1iZXIgb2Yga2V5cyBhbmQgdmFsdWVzOiAke20yfWBcbiAgKSk7XG4gIGlmIChyZXN1bHQpIHtcbiAgICBjb3B5TWFwTWVtby5hZGQobTIpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuaGFyZGVuKGNoZWNrQ29weU1hcCk7XG52YXIgaXNDb3B5TWFwID0gKG0yKSA9PiBjaGVja0NvcHlNYXAobTIsIGlkZW50Q2hlY2tlcik7XG5oYXJkZW4oaXNDb3B5TWFwKTtcbnZhciBhc3NlcnRDb3B5TWFwID0gKG0yKSA9PiB7XG4gIGNoZWNrQ29weU1hcChtMiwgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydENvcHlNYXApO1xudmFyIGdldENvcHlNYXBLZXlzID0gKG0yKSA9PiB7XG4gIGFzc2VydENvcHlNYXAobTIpO1xuICByZXR1cm4gbTIucGF5bG9hZC5rZXlzO1xufTtcbmhhcmRlbihnZXRDb3B5TWFwS2V5cyk7XG52YXIgZ2V0Q29weU1hcFZhbHVlcyA9IChtMikgPT4ge1xuICBhc3NlcnRDb3B5TWFwKG0yKTtcbiAgcmV0dXJuIG0yLnBheWxvYWQudmFsdWVzO1xufTtcbmhhcmRlbihnZXRDb3B5TWFwVmFsdWVzKTtcbnZhciBnZXRDb3B5TWFwRW50cnlBcnJheSA9IChtMikgPT4ge1xuICBhc3NlcnRDb3B5TWFwKG0yKTtcbiAgY29uc3Qge1xuICAgIHBheWxvYWQ6IHsga2V5czoga2V5czQsIHZhbHVlczogdmFsdWVzNiB9XG4gIH0gPSBtMjtcbiAgcmV0dXJuIGhhcmRlbihrZXlzNC5tYXAoKGtleSwgaTIpID0+IFtrZXksIHZhbHVlczZbaTJdXSkpO1xufTtcbmhhcmRlbihnZXRDb3B5TWFwRW50cnlBcnJheSk7XG52YXIgZ2V0Q29weU1hcEVudHJpZXMgPSAobTIpID0+IHtcbiAgYXNzZXJ0Q29weU1hcChtMik7XG4gIGNvbnN0IHtcbiAgICBwYXlsb2FkOiB7IGtleXM6IGtleXM0LCB2YWx1ZXM6IHZhbHVlczYgfVxuICB9ID0gbTI7XG4gIGNvbnN0IHsgbGVuZ3RoIH0gPSAoXG4gICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICBrZXlzNFxuICApO1xuICByZXR1cm4gRmFyKFwiQ29weU1hcCBlbnRyaWVzIGl0ZXJhYmxlXCIsIHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgbGV0IGkyID0gMDtcbiAgICAgIHJldHVybiBGYXIoXCJDb3B5TWFwIGVudHJpZXMgaXRlcmF0b3JcIiwge1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgbGV0IHJlc3VsdDtcbiAgICAgICAgICBpZiAoaTIgPCBsZW5ndGgpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZTogW2tleXM0W2kyXSwgdmFsdWVzNltpMl1dIH0pO1xuICAgICAgICAgICAgaTIgKz0gMTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlOiB2b2lkIDAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKGdldENvcHlNYXBFbnRyaWVzKTtcbnZhciBldmVyeUNvcHlNYXBLZXkgPSAobTIsIGZuKSA9PiBnZXRDb3B5TWFwS2V5cyhtMikuZXZlcnkoKGtleSwgaW5kZXgpID0+IGZuKGtleSwgaW5kZXgpKTtcbmhhcmRlbihldmVyeUNvcHlNYXBLZXkpO1xudmFyIGV2ZXJ5Q29weU1hcFZhbHVlID0gKG0yLCBmbikgPT4gZ2V0Q29weU1hcFZhbHVlcyhtMikuZXZlcnkoKHZhbHVlLCBpbmRleCkgPT4gZm4odmFsdWUsIGluZGV4KSk7XG5oYXJkZW4oZXZlcnlDb3B5TWFwVmFsdWUpO1xudmFyIGNvcHlNYXBLZXlTZXQgPSAobTIpID0+IChcbiAgLy9cbiAgbWFrZVRhZ2dlZChcImNvcHlTZXRcIiwgbTIucGF5bG9hZC5rZXlzKVxuKTtcbmhhcmRlbihjb3B5TWFwS2V5U2V0KTtcbnZhciBtYWtlQ29weU1hcCA9IChlbnRyaWVzMTApID0+IHtcbiAgY29uc3Qgc29ydGVkRW50cmllcyA9IHNvcnRCeVJhbmsoZW50cmllczEwLCBjb21wYXJlQW50aVJhbmspO1xuICBjb25zdCBrZXlzNCA9IHNvcnRlZEVudHJpZXMubWFwKChbaywgX3ZdKSA9PiBrKTtcbiAgY29uc3QgdmFsdWVzNiA9IHNvcnRlZEVudHJpZXMubWFwKChbX2ssIHYyXSkgPT4gdjIpO1xuICBjb25zdCByZXN1bHQgPSBtYWtlVGFnZ2VkKFwiY29weU1hcFwiLCB7IGtleXM6IGtleXM0LCB2YWx1ZXM6IHZhbHVlczYgfSk7XG4gIGFzc2VydENvcHlNYXAocmVzdWx0KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4obWFrZUNvcHlNYXApO1xudmFyIGNoZWNrS2V5SW50ZXJuYWwgPSAodmFsLCBjaGVjaykgPT4ge1xuICBjb25zdCBjaGVja0l0ID0gKGNoaWxkKSA9PiBjaGVja0tleShjaGlsZCwgY2hlY2spO1xuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZih2YWwpO1xuICBzd2l0Y2ggKHBhc3NTdHlsZSkge1xuICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHZhbCkuZXZlcnkoY2hlY2tJdCk7XG4gICAgfVxuICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgcmV0dXJuIHZhbC5ldmVyeShjaGVja0l0KTtcbiAgICB9XG4gICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICBjb25zdCB0YWcgPSBnZXRUYWcodmFsKTtcbiAgICAgIHN3aXRjaCAodGFnKSB7XG4gICAgICAgIGNhc2UgXCJjb3B5U2V0XCI6IHtcbiAgICAgICAgICByZXR1cm4gY2hlY2tDb3B5U2V0KHZhbCwgY2hlY2spO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJjb3B5QmFnXCI6IHtcbiAgICAgICAgICByZXR1cm4gY2hlY2tDb3B5QmFnKHZhbCwgY2hlY2spO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJjb3B5TWFwXCI6IHtcbiAgICAgICAgICByZXR1cm4gY2hlY2tDb3B5TWFwKHZhbCwgY2hlY2spICYmIC8vXG4gICAgICAgICAgLy9cbiAgICAgICAgICAvL1xuICAgICAgICAgIGV2ZXJ5Q29weU1hcFZhbHVlKHZhbCwgY2hlY2tJdCk7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHJldHVybiBjaGVjayAhPT0gaWRlbnRDaGVja2VyICYmIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBBIHBhc3NhYmxlIHRhZ2dlZCAke3F1b3RlKHRhZyl9IGlzIG5vdCBhIGtleTogJHt2YWx9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY2FzZSBcImVycm9yXCI6XG4gICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBBICR7cXVvdGUocGFzc1N0eWxlKX0gY2Fubm90IGJlIGEga2V5YCk7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBwYXNzU3R5bGUgJHtxdW90ZShwYXNzU3R5bGUpfTogJHt2YWx9YDtcbiAgICB9XG4gIH1cbn07XG5cbi8vXG52YXIgbWFrZUl0ZXJhdG9yID0gKG5leHQpID0+IHtcbiAgY29uc3QgaXRlciA9IGhhcmRlbih7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IGl0ZXIsXG4gICAgbmV4dFxuICB9KTtcbiAgcmV0dXJuIGl0ZXI7XG59O1xuaGFyZGVuKG1ha2VJdGVyYXRvcik7XG5cbi8vXG52YXIgbWFrZUFycmF5SXRlcmF0b3IgPSAoYXJyKSA9PiB7XG4gIGNvbnN0IHsgbGVuZ3RoIH0gPSBhcnI7XG4gIGxldCBpMiA9IDA7XG4gIHJldHVybiBtYWtlSXRlcmF0b3IoKCkgPT4ge1xuICAgIGxldCB2YWx1ZTtcbiAgICBpZiAoaTIgPCBsZW5ndGgpIHtcbiAgICAgIHZhbHVlID0gYXJyW2kyXTtcbiAgICAgIGkyICs9IDE7XG4gICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlIH0pO1xuICAgIH1cbiAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWUgfSk7XG4gIH0pO1xufTtcbmhhcmRlbihtYWtlQXJyYXlJdGVyYXRvcik7XG5cbi8vXG52YXIgZ2VuZXJhdGVGdWxsU29ydGVkRW50cmllcyA9IChlbnRyaWVzMTAsIHJhbmtDb21wYXJlLCBmdWxsQ29tcGFyZSkgPT4ge1xuICBhc3NlcnRSYW5rU29ydGVkKGVudHJpZXMxMCwgcmFua0NvbXBhcmUpO1xuICBjb25zdCB7IGxlbmd0aCB9ID0gZW50cmllczEwO1xuICBsZXQgaTIgPSAwO1xuICBsZXQgc2FtZVJhbmtJdGVyYXRvcjtcbiAgcmV0dXJuIG1ha2VJdGVyYXRvcigoKSA9PiB7XG4gICAgaWYgKHNhbWVSYW5rSXRlcmF0b3IpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHNhbWVSYW5rSXRlcmF0b3IubmV4dCgpO1xuICAgICAgaWYgKCFyZXN1bHQuZG9uZSkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgc2FtZVJhbmtJdGVyYXRvciA9IHZvaWQgMDtcbiAgICB9XG4gICAgaWYgKGkyIDwgbGVuZ3RoKSB7XG4gICAgICBjb25zdCBlbnRyeSA9IGVudHJpZXMxMFtpMl07XG4gICAgICBsZXQgaiA9IGkyICsgMTtcbiAgICAgIHdoaWxlIChqIDwgbGVuZ3RoICYmIHJhbmtDb21wYXJlKGVudHJ5WzBdLCBlbnRyaWVzMTBbal1bMF0pID09PSAwKSB7XG4gICAgICAgIGogKz0gMTtcbiAgICAgIH1cbiAgICAgIGlmIChqID09PSBpMiArIDEpIHtcbiAgICAgICAgaTIgPSBqO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlOiBlbnRyeSB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHRpZXMgPSBlbnRyaWVzMTAuc2xpY2UoaTIsIGopO1xuICAgICAgaTIgPSBqO1xuICAgICAgY29uc3Qgc29ydGVkVGllcyA9IHNvcnRCeVJhbmsodGllcywgZnVsbENvbXBhcmUpO1xuICAgICAgZm9yIChsZXQgayA9IDE7IGsgPCBzb3J0ZWRUaWVzLmxlbmd0aDsgayArPSAxKSB7XG4gICAgICAgIGNvbnN0IFtrZXkwXSA9IHNvcnRlZFRpZXNbayAtIDFdO1xuICAgICAgICBjb25zdCBba2V5MV0gPSBzb3J0ZWRUaWVzW2tdO1xuICAgICAgICBNYXRoLnNpZ24oZnVsbENvbXBhcmUoa2V5MCwga2V5MSkpIHx8IHRocm93UmVkYWN0ZWRgRHVwbGljYXRlIGVudHJ5IGtleTogJHtrZXkwfWA7XG4gICAgICB9XG4gICAgICBzYW1lUmFua0l0ZXJhdG9yID0gbWFrZUFycmF5SXRlcmF0b3Ioc29ydGVkVGllcyk7XG4gICAgICByZXR1cm4gc2FtZVJhbmtJdGVyYXRvci5uZXh0KCk7XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogdm9pZCAwIH0pO1xuICB9KTtcbn07XG5oYXJkZW4oZ2VuZXJhdGVGdWxsU29ydGVkRW50cmllcyk7XG52YXIgZ2VuZXJhdGVDb2xsZWN0aW9uUGFpckVudHJpZXMgPSAoYzEsIGMyLCBnZXRFbnRyaWVzLCBhYnNlbnRWYWx1ZSkgPT4ge1xuICBjb25zdCBlMSA9IGdldEVudHJpZXMoYzEpO1xuICBjb25zdCBlMiA9IGdldEVudHJpZXMoYzIpO1xuICBjb25zdCBmdWxsQ29tcGFyZSA9IG1ha2VGdWxsT3JkZXJDb21wYXJhdG9yS2l0KCkuYW50aUNvbXBhcmF0b3I7XG4gIGNvbnN0IHggPSBnZW5lcmF0ZUZ1bGxTb3J0ZWRFbnRyaWVzKGUxLCBjb21wYXJlQW50aVJhbmssIGZ1bGxDb21wYXJlKTtcbiAgY29uc3QgeSA9IGdlbmVyYXRlRnVsbFNvcnRlZEVudHJpZXMoZTIsIGNvbXBhcmVBbnRpUmFuaywgZnVsbENvbXBhcmUpO1xuICBsZXQgeERvbmU7XG4gIGxldCB4S2V5O1xuICBsZXQgeFZhbHVlO1xuICBsZXQgeURvbmU7XG4gIGxldCB5S2V5O1xuICBsZXQgeVZhbHVlO1xuICBjb25zdCBub25FbnRyeSA9IFt2b2lkIDAsIHZvaWQgMF07XG4gIGNvbnN0IG5leHRYID0gKCkgPT4ge1xuICAgICF4RG9uZSB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBuZXh0WCBtdXN0IG5vdCBiZSBjYWxsZWQgb25jZSBkb25lYDtcbiAgICBjb25zdCByZXN1bHQgPSB4VmFsdWU7XG4gICAgKHsgZG9uZTogeERvbmUsIHZhbHVlOiBbeEtleSwgeFZhbHVlXSA9IG5vbkVudHJ5IH0gPSB4Lm5leHQoKSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbiAgbmV4dFgoKTtcbiAgY29uc3QgbmV4dFkgPSAoKSA9PiB7XG4gICAgIXlEb25lIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IG5leHRZIG11c3Qgbm90IGJlIGNhbGxlZCBvbmNlIGRvbmVgO1xuICAgIGNvbnN0IHJlc3VsdCA9IHlWYWx1ZTtcbiAgICAoeyBkb25lOiB5RG9uZSwgdmFsdWU6IFt5S2V5LCB5VmFsdWVdID0gbm9uRW50cnkgfSA9IHkubmV4dCgpKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuICBuZXh0WSgpO1xuICByZXR1cm4gbWFrZUl0ZXJhdG9yKCgpID0+IHtcbiAgICBsZXQgZG9uZSA9IGZhbHNlO1xuICAgIGxldCB2YWx1ZTtcbiAgICBpZiAoeERvbmUgJiYgeURvbmUpIHtcbiAgICAgIGRvbmUgPSB0cnVlO1xuICAgICAgdmFsdWUgPSBbdm9pZCAwLCBhYnNlbnRWYWx1ZSwgYWJzZW50VmFsdWVdO1xuICAgIH0gZWxzZSBpZiAoeERvbmUpIHtcbiAgICAgIHZhbHVlID0gW3lLZXksIGFic2VudFZhbHVlLCBuZXh0WSgpXTtcbiAgICB9IGVsc2UgaWYgKHlEb25lKSB7XG4gICAgICB2YWx1ZSA9IFt4S2V5LCBuZXh0WCgpLCBhYnNlbnRWYWx1ZV07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGNvbXAgPSBmdWxsQ29tcGFyZSh4S2V5LCB5S2V5KTtcbiAgICAgIGlmIChjb21wID09PSAwKSB7XG4gICAgICAgIHZhbHVlID0gW3hLZXksIG5leHRYKCksIG5leHRZKCldO1xuICAgICAgfSBlbHNlIGlmIChjb21wIDwgMCkge1xuICAgICAgICB2YWx1ZSA9IFt4S2V5LCBuZXh0WCgpLCBhYnNlbnRWYWx1ZV07XG4gICAgICB9IGVsc2UgaWYgKGNvbXAgPiAwKSB7XG4gICAgICAgIHZhbHVlID0gW3lLZXksIGFic2VudFZhbHVlLCBuZXh0WSgpXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCBrZXkgY29tcGFyaXNvbiAke3F1b3RlKGNvbXApfSBmb3IgJHt4S2V5fSB2cyAke3lLZXl9YDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbih7IGRvbmUsIHZhbHVlIH0pO1xuICB9KTtcbn07XG5oYXJkZW4oZ2VuZXJhdGVDb2xsZWN0aW9uUGFpckVudHJpZXMpO1xudmFyIG1ha2VDb21wYXJlQ29sbGVjdGlvbiA9IChnZXRFbnRyaWVzLCBhYnNlbnRWYWx1ZSwgY29tcGFyZVZhbHVlczIpID0+IGhhcmRlbigobGVmdCwgcmlnaHQpID0+IHtcbiAgY29uc3QgbWVyZ2VkID0gZ2VuZXJhdGVDb2xsZWN0aW9uUGFpckVudHJpZXMoXG4gICAgbGVmdCxcbiAgICByaWdodCxcbiAgICBnZXRFbnRyaWVzLFxuICAgIGFic2VudFZhbHVlXG4gICk7XG4gIGxldCBsZWZ0SXNCaWdnZXIgPSBmYWxzZTtcbiAgbGV0IHJpZ2h0SXNCaWdnZXIgPSBmYWxzZTtcbiAgZm9yIChjb25zdCBbX2tleSwgbGVmdFZhbHVlLCByaWdodFZhbHVlXSBvZiBtZXJnZWQpIHtcbiAgICBjb25zdCBjb21wID0gY29tcGFyZVZhbHVlczIobGVmdFZhbHVlLCByaWdodFZhbHVlKTtcbiAgICBpZiAoY29tcCA9PT0gMCkge1xuICAgICAgY29udGludWU7XG4gICAgfSBlbHNlIGlmIChjb21wIDwgMCkge1xuICAgICAgcmlnaHRJc0JpZ2dlciA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChjb21wID4gMCkge1xuICAgICAgbGVmdElzQmlnZ2VyID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgTnVtYmVyLmlzTmFOKGNvbXApIHx8IC8vXG4gICAgICB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgdmFsdWUgY29tcGFyaXNvbiAke3F1b3RlKGNvbXApfSBmb3IgJHtsZWZ0VmFsdWV9IHZzICR7cmlnaHRWYWx1ZX1gO1xuICAgICAgcmV0dXJuIE5hTjtcbiAgICB9XG4gICAgaWYgKGxlZnRJc0JpZ2dlciAmJiByaWdodElzQmlnZ2VyKSB7XG4gICAgICByZXR1cm4gTmFOO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbGVmdElzQmlnZ2VyID8gMSA6IHJpZ2h0SXNCaWdnZXIgPyAtMSA6IDA7XG59KTtcbmhhcmRlbihtYWtlQ29tcGFyZUNvbGxlY3Rpb24pO1xuXG4vL1xudmFyIHNldENvbXBhcmUgPSBtYWtlQ29tcGFyZUNvbGxlY3Rpb24oXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIChzMykgPT4gaGFyZGVuKGdldENvcHlTZXRLZXlzKHMzKS5tYXAoKGtleSkgPT4gW2tleSwgMV0pKSxcbiAgMCxcbiAgdHJpdmlhbENvbXBhcmF0b3Jcbik7XG5oYXJkZW4oc2V0Q29tcGFyZSk7XG52YXIgYmFnQ29tcGFyZSA9IG1ha2VDb21wYXJlQ29sbGVjdGlvbihcbiAgZ2V0Q29weUJhZ0VudHJpZXMsXG4gIDBuLFxuICB0cml2aWFsQ29tcGFyYXRvclxuKTtcbmhhcmRlbihiYWdDb21wYXJlKTtcbnZhciBBQlNFTlQgPSBTeW1ib2woXCJhYnNlbnRcIik7XG52YXIgX21hcENvbXBhcmUgPSBtYWtlQ29tcGFyZUNvbGxlY3Rpb24oXG4gIGdldENvcHlNYXBFbnRyeUFycmF5LFxuICBBQlNFTlQsXG4gIChsZWZ0VmFsdWUsIHJpZ2h0VmFsdWUpID0+IHtcbiAgICBpZiAobGVmdFZhbHVlID09PSBBQlNFTlQgJiYgcmlnaHRWYWx1ZSA9PT0gQUJTRU5UKSB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBVbmV4cGVjdGVkIGFic2VudCBlbnRyeSBwYWlyYDtcbiAgICB9IGVsc2UgaWYgKGxlZnRWYWx1ZSA9PT0gQUJTRU5UKSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfSBlbHNlIGlmIChyaWdodFZhbHVlID09PSBBQlNFTlQpIHtcbiAgICAgIHJldHVybiAxO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gY29tcGFyZUtleXMobGVmdFZhbHVlLCByaWdodFZhbHVlKTtcbiAgICB9XG4gIH1cbik7XG5oYXJkZW4oX21hcENvbXBhcmUpO1xudmFyIGNvbXBhcmVLZXlzID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gIGFzc2VydEtleShsZWZ0KTtcbiAgYXNzZXJ0S2V5KHJpZ2h0KTtcbiAgY29uc3QgbGVmdFN0eWxlID0gcGFzc1N0eWxlT2YobGVmdCk7XG4gIGNvbnN0IHJpZ2h0U3R5bGUgPSBwYXNzU3R5bGVPZihyaWdodCk7XG4gIGlmIChsZWZ0U3R5bGUgIT09IHJpZ2h0U3R5bGUpIHtcbiAgICByZXR1cm4gTmFOO1xuICB9XG4gIHN3aXRjaCAobGVmdFN0eWxlKSB7XG4gICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgIGNhc2UgXCJudWxsXCI6XG4gICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICBjYXNlIFwiYmlnaW50XCI6XG4gICAgY2FzZSBcInN0cmluZ1wiOlxuICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgcmV0dXJuIGNvbXBhcmVSYW5rKGxlZnQsIHJpZ2h0KTtcbiAgICB9XG4gICAgY2FzZSBcIm51bWJlclwiOiB7XG4gICAgICBjb25zdCByYW5rQ29tcCA9IGNvbXBhcmVSYW5rKGxlZnQsIHJpZ2h0KTtcbiAgICAgIGlmIChyYW5rQ29tcCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH1cbiAgICAgIGlmIChOdW1iZXIuaXNOYU4obGVmdCkgfHwgTnVtYmVyLmlzTmFOKHJpZ2h0KSkge1xuICAgICAgICBhc3NlcnQoIU51bWJlci5pc05hTihsZWZ0KSB8fCAhTnVtYmVyLmlzTmFOKHJpZ2h0KSk7XG4gICAgICAgIHJldHVybiBOYU47XG4gICAgICB9XG4gICAgICByZXR1cm4gcmFua0NvbXA7XG4gICAgfVxuICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgaWYgKGxlZnQgPT09IHJpZ2h0KSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgcmV0dXJuIE5hTjtcbiAgICB9XG4gICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICBjb25zdCBsZW4gPSBNYXRoLm1pbihsZWZ0Lmxlbmd0aCwgcmlnaHQubGVuZ3RoKTtcbiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBsZW47IGkyICs9IDEpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY29tcGFyZUtleXMobGVmdFtpMl0sIHJpZ2h0W2kyXSk7XG4gICAgICAgIGlmIChyZXN1bHQgIT09IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gY29tcGFyZVJhbmsobGVmdC5sZW5ndGgsIHJpZ2h0Lmxlbmd0aCk7XG4gICAgfVxuICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgIGNvbnN0IGxlZnROYW1lcyA9IHJlY29yZE5hbWVzKGxlZnQpO1xuICAgICAgY29uc3QgcmlnaHROYW1lcyA9IHJlY29yZE5hbWVzKHJpZ2h0KTtcbiAgICAgIGlmICgha2V5RVEobGVmdE5hbWVzLCByaWdodE5hbWVzKSkge1xuICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgfVxuICAgICAgY29uc3QgbGVmdFZhbHVlcyA9IHJlY29yZFZhbHVlcyhsZWZ0LCBsZWZ0TmFtZXMpO1xuICAgICAgY29uc3QgcmlnaHRWYWx1ZXMgPSByZWNvcmRWYWx1ZXMocmlnaHQsIHJpZ2h0TmFtZXMpO1xuICAgICAgbGV0IHJlc3VsdCA9IDA7XG4gICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbGVmdFZhbHVlcy5sZW5ndGg7IGkyICs9IDEpIHtcbiAgICAgICAgY29uc3QgY29tcCA9IGNvbXBhcmVLZXlzKGxlZnRWYWx1ZXNbaTJdLCByaWdodFZhbHVlc1tpMl0pO1xuICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKGNvbXApKSB7XG4gICAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0ICE9PSBjb21wICYmIGNvbXAgIT09IDApIHtcbiAgICAgICAgICBpZiAocmVzdWx0ID09PSAwKSB7XG4gICAgICAgICAgICByZXN1bHQgPSBjb21wO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhc3NlcnQoXG4gICAgICAgICAgICAgIHJlc3VsdCA9PT0gLTEgJiYgY29tcCA9PT0gMSB8fCByZXN1bHQgPT09IDEgJiYgY29tcCA9PT0gLTFcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICBjb25zdCBsZWZ0VGFnID0gZ2V0VGFnKGxlZnQpO1xuICAgICAgY29uc3QgcmlnaHRUYWcgPSBnZXRUYWcocmlnaHQpO1xuICAgICAgaWYgKGxlZnRUYWcgIT09IHJpZ2h0VGFnKSB7XG4gICAgICAgIHJldHVybiBOYU47XG4gICAgICB9XG4gICAgICBzd2l0Y2ggKGxlZnRUYWcpIHtcbiAgICAgICAgY2FzZSBcImNvcHlTZXRcIjoge1xuICAgICAgICAgIHJldHVybiBzZXRDb21wYXJlKGxlZnQsIHJpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiY29weUJhZ1wiOiB7XG4gICAgICAgICAgcmV0dXJuIGJhZ0NvbXBhcmUobGVmdCwgcmlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJjb3B5TWFwXCI6IHtcbiAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYE1hcCBjb21wYXJpc29uIG5vdCB5ZXQgaW1wbGVtZW50ZWQ6ICR7bGVmdH0gdnMgJHtyaWdodH1gO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgdGFnICR7cXVvdGUobGVmdFRhZyl9OiAke2xlZnR9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgcGFzc1N0eWxlICR7cXVvdGUobGVmdFN0eWxlKX06ICR7bGVmdH1gO1xuICAgIH1cbiAgfVxufTtcbmhhcmRlbihjb21wYXJlS2V5cyk7XG52YXIga2V5TFQgPSAobGVmdCwgcmlnaHQpID0+IGNvbXBhcmVLZXlzKGxlZnQsIHJpZ2h0KSA8IDA7XG5oYXJkZW4oa2V5TFQpO1xudmFyIGtleUxURSA9IChsZWZ0LCByaWdodCkgPT4gY29tcGFyZUtleXMobGVmdCwgcmlnaHQpIDw9IDA7XG5oYXJkZW4oa2V5TFRFKTtcbnZhciBrZXlFUSA9IChsZWZ0LCByaWdodCkgPT4gY29tcGFyZUtleXMobGVmdCwgcmlnaHQpID09PSAwO1xuaGFyZGVuKGtleUVRKTtcbnZhciBrZXlHVEUgPSAobGVmdCwgcmlnaHQpID0+IGNvbXBhcmVLZXlzKGxlZnQsIHJpZ2h0KSA+PSAwO1xuaGFyZGVuKGtleUdURSk7XG52YXIga2V5R1QgPSAobGVmdCwgcmlnaHQpID0+IGNvbXBhcmVLZXlzKGxlZnQsIHJpZ2h0KSA+IDA7XG5oYXJkZW4oa2V5R1QpO1xuXG4vL1xudmFyIHdpbmRvd1Jlc29ydCA9IChlbGVtZW50cywgcmFua0NvbXBhcmUsIGZ1bGxDb21wYXJlKSA9PiB7XG4gIGFzc2VydFJhbmtTb3J0ZWQoZWxlbWVudHMsIHJhbmtDb21wYXJlKTtcbiAgY29uc3QgeyBsZW5ndGggfSA9IGVsZW1lbnRzO1xuICBsZXQgaTIgPSAwO1xuICBsZXQgb3B0SW5uZXJJdGVyYXRvcjtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IGhhcmRlbih7XG4gICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgIGlmIChvcHRJbm5lckl0ZXJhdG9yKSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gb3B0SW5uZXJJdGVyYXRvci5uZXh0KCk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICAgICAgICBvcHRJbm5lckl0ZXJhdG9yID0gdm9pZCAwO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaTIgPCBsZW5ndGgpIHtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IGVsZW1lbnRzW2kyXTtcbiAgICAgICAgICBsZXQgaiA9IGkyICsgMTtcbiAgICAgICAgICB3aGlsZSAoaiA8IGxlbmd0aCAmJiByYW5rQ29tcGFyZSh2YWx1ZSwgZWxlbWVudHNbal0pID09PSAwKSB7XG4gICAgICAgICAgICBqICs9IDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChqID09PSBpMiArIDEpIHtcbiAgICAgICAgICAgIGkyID0gajtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWUgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHNpbWlsYXJSdW4gPSBlbGVtZW50cy5zbGljZShpMiwgaik7XG4gICAgICAgICAgaTIgPSBqO1xuICAgICAgICAgIGNvbnN0IHJlc29ydGVkID0gc29ydEJ5UmFuayhzaW1pbGFyUnVuLCBmdWxsQ29tcGFyZSk7XG4gICAgICAgICAgYXNzZXJ0Tm9EdXBsaWNhdGVzKHJlc29ydGVkLCBmdWxsQ29tcGFyZSk7XG4gICAgICAgICAgb3B0SW5uZXJJdGVyYXRvciA9IHJlc29ydGVkW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgICAgICByZXR1cm4gb3B0SW5uZXJJdGVyYXRvci5uZXh0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlOiBudWxsIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSk7XG59O1xudmFyIG1lcmdlID0gKHhlbGVtZW50cywgeWVsZW1lbnRzKSA9PiB7XG4gIGNvbnN0IGZ1bGxDb21wYXJlID0gbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgY29uc3QgeHMgPSB3aW5kb3dSZXNvcnQoeGVsZW1lbnRzLCBjb21wYXJlQW50aVJhbmssIGZ1bGxDb21wYXJlKTtcbiAgY29uc3QgeXMgPSB3aW5kb3dSZXNvcnQoeWVsZW1lbnRzLCBjb21wYXJlQW50aVJhbmssIGZ1bGxDb21wYXJlKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGxldCB4O1xuICAgICAgbGV0IHhEb25lO1xuICAgICAgbGV0IHk7XG4gICAgICBsZXQgeURvbmU7XG4gICAgICBjb25zdCB4aSA9IHhzW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgIGNvbnN0IG5leHRYID0gKCkgPT4ge1xuICAgICAgICAheERvbmUgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogbmV4dFggc2hvdWxkIG5vdCBiZSBjYWxsZWQgb25jZSBkb25lYDtcbiAgICAgICAgKHsgZG9uZTogeERvbmUsIHZhbHVlOiB4IH0gPSB4aS5uZXh0KCkpO1xuICAgICAgfTtcbiAgICAgIG5leHRYKCk7XG4gICAgICBjb25zdCB5aSA9IHlzW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgIGNvbnN0IG5leHRZID0gKCkgPT4ge1xuICAgICAgICAheURvbmUgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogbmV4dFkgc2hvdWxkIG5vdCBiZSBjYWxsZWQgb25jZSBkb25lYDtcbiAgICAgICAgKHsgZG9uZTogeURvbmUsIHZhbHVlOiB5IH0gPSB5aS5uZXh0KCkpO1xuICAgICAgfTtcbiAgICAgIG5leHRZKCk7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGxldCBkb25lID0gZmFsc2U7XG4gICAgICAgICAgbGV0IHZhbHVlO1xuICAgICAgICAgIGlmICh4RG9uZSAmJiB5RG9uZSkge1xuICAgICAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgICAgICB2YWx1ZSA9IFtudWxsLCAwbiwgMG5dO1xuICAgICAgICAgIH0gZWxzZSBpZiAoeERvbmUpIHtcbiAgICAgICAgICAgIHZhbHVlID0gW3ksIDBuLCAxbl07XG4gICAgICAgICAgICBuZXh0WSgpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoeURvbmUpIHtcbiAgICAgICAgICAgIHZhbHVlID0gW3gsIDFuLCAwbl07XG4gICAgICAgICAgICBuZXh0WCgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBjb21wID0gZnVsbENvbXBhcmUoeCwgeSk7XG4gICAgICAgICAgICBpZiAoY29tcCA9PT0gMCkge1xuICAgICAgICAgICAgICB2YWx1ZSA9IFt4LCAxbiwgMW5dO1xuICAgICAgICAgICAgICBuZXh0WCgpO1xuICAgICAgICAgICAgICBuZXh0WSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wIDwgMCkge1xuICAgICAgICAgICAgICB2YWx1ZSA9IFt4LCAxbiwgMG5dO1xuICAgICAgICAgICAgICBuZXh0WCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29tcCA+IDAgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogVW5leHBlY3RlZCBjb21wICR7cXVvdGUoY29tcCl9YDtcbiAgICAgICAgICAgICAgdmFsdWUgPSBbeSwgMG4sIDFuXTtcbiAgICAgICAgICAgICAgbmV4dFkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmUsIHZhbHVlIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihtZXJnZSk7XG52YXIgaXRlcklzU3VwZXJzZXQgPSAoeHlpKSA9PiB7XG4gIGZvciAoY29uc3QgW19tLCB4YywgX3ljXSBvZiB4eWkpIHtcbiAgICBpZiAoeGMgPT09IDBuKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcbnZhciBpdGVySXNEaXNqb2ludCA9ICh4eWkpID0+IHtcbiAgZm9yIChjb25zdCBbX20sIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgaWYgKHhjID49IDFuICYmIHljID49IDFuKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufTtcbnZhciBpdGVyQ29tcGFyZSA9ICh4eWkpID0+IHtcbiAgbGV0IGxvbmVZID0gZmFsc2U7XG4gIGxldCBsb25lWCA9IGZhbHNlO1xuICBmb3IgKGNvbnN0IFtfbSwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICBpZiAoeGMgPT09IDBuKSB7XG4gICAgICBsb25lWSA9IHRydWU7XG4gICAgfVxuICAgIGlmICh5YyA9PT0gMG4pIHtcbiAgICAgIGxvbmVYID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGxvbmVYICYmIGxvbmVZKSB7XG4gICAgICByZXR1cm4gTmFOO1xuICAgIH1cbiAgfVxuICBpZiAobG9uZVgpIHtcbiAgICByZXR1cm4gMTtcbiAgfSBlbHNlIGlmIChsb25lWSkge1xuICAgIHJldHVybiAtMTtcbiAgfSBlbHNlIHtcbiAgICAhbG9uZVggJiYgIWxvbmVZIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IFVuZXhwZWN0ZWQgbG9uZSBwYWlyICR7cXVvdGUoW2xvbmVYLCBsb25lWV0pfWA7XG4gICAgcmV0dXJuIDA7XG4gIH1cbn07XG52YXIgaXRlclVuaW9uID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgaWYgKHhjID49IDBuKSB7XG4gICAgICByZXN1bHQucHVzaChtMik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHljID49IDBuIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IFVuZXhwZWN0ZWQgY291bnQgJHtxdW90ZSh5Yyl9YDtcbiAgICAgIHJlc3VsdC5wdXNoKG0yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgaXRlckRpc2pvaW50VW5pb24gPSAoeHlpKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3IgKGNvbnN0IFttMiwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICB4YyA9PT0gMG4gfHwgeWMgPT09IDBuIHx8IHRocm93UmVkYWN0ZWRgU2V0cyBtdXN0IG5vdCBoYXZlIGNvbW1vbiBlbGVtZW50czogJHttMn1gO1xuICAgIGlmICh4YyA+PSAxbikge1xuICAgICAgcmVzdWx0LnB1c2gobTIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB5YyA+PSAxbiB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBVbmV4cGVjdGVkIGNvdW50ICR7cXVvdGUoeWMpfWA7XG4gICAgICByZXN1bHQucHVzaChtMik7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xudmFyIGl0ZXJJbnRlcnNlY3Rpb24gPSAoeHlpKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3IgKGNvbnN0IFttMiwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICBpZiAoeGMgPj0gMW4gJiYgeWMgPj0gMW4pIHtcbiAgICAgIHJlc3VsdC5wdXNoKG0yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgaXRlckRpc2pvaW50U3VidHJhY3QgPSAoeHlpKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3IgKGNvbnN0IFttMiwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICB4YyA+PSAxbiB8fCB0aHJvd1JlZGFjdGVkYHJpZ2h0IGVsZW1lbnQgJHttMn0gd2FzIG5vdCBpbiBsZWZ0YDtcbiAgICBpZiAoeWMgPT09IDBuKSB7XG4gICAgICByZXN1bHQucHVzaChtMik7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xudmFyIG1lcmdlaWZ5ID0gKGl0ZXJPcCkgPT4gKHhlbGVtZW50cywgeWVsZW1lbnRzKSA9PiBpdGVyT3AobWVyZ2UoeGVsZW1lbnRzLCB5ZWxlbWVudHMpKTtcbnZhciBlbGVtZW50c0lzU3VwZXJzZXQgPSBtZXJnZWlmeShpdGVySXNTdXBlcnNldCk7XG52YXIgZWxlbWVudHNJc0Rpc2pvaW50ID0gbWVyZ2VpZnkoaXRlcklzRGlzam9pbnQpO1xudmFyIGVsZW1lbnRzQ29tcGFyZSA9IG1lcmdlaWZ5KGl0ZXJDb21wYXJlKTtcbnZhciBlbGVtZW50c1VuaW9uID0gbWVyZ2VpZnkoaXRlclVuaW9uKTtcbnZhciBlbGVtZW50c0Rpc2pvaW50VW5pb24gPSBtZXJnZWlmeShpdGVyRGlzam9pbnRVbmlvbik7XG52YXIgZWxlbWVudHNJbnRlcnNlY3Rpb24gPSBtZXJnZWlmeShpdGVySW50ZXJzZWN0aW9uKTtcbnZhciBlbGVtZW50c0Rpc2pvaW50U3VidHJhY3QgPSBtZXJnZWlmeShpdGVyRGlzam9pbnRTdWJ0cmFjdCk7XG52YXIgcmF3U2V0aWZ5ID0gKGVsZW1lbnRzT3ApID0+ICh4c2V0LCB5c2V0KSA9PiBlbGVtZW50c09wKHhzZXQucGF5bG9hZCwgeXNldC5wYXlsb2FkKTtcbnZhciBzZXRpZnkgPSAoZWxlbWVudHNPcCkgPT4gKHhzZXQsIHlzZXQpID0+IG1ha2VTZXRPZkVsZW1lbnRzKGVsZW1lbnRzT3AoeHNldC5wYXlsb2FkLCB5c2V0LnBheWxvYWQpKTtcbnZhciBzZXRJc1N1cGVyc2V0ID0gcmF3U2V0aWZ5KGVsZW1lbnRzSXNTdXBlcnNldCk7XG52YXIgc2V0SXNEaXNqb2ludCA9IHJhd1NldGlmeShlbGVtZW50c0lzRGlzam9pbnQpO1xudmFyIHNldFVuaW9uID0gc2V0aWZ5KGVsZW1lbnRzVW5pb24pO1xudmFyIHNldERpc2pvaW50VW5pb24gPSBzZXRpZnkoZWxlbWVudHNEaXNqb2ludFVuaW9uKTtcbnZhciBzZXRJbnRlcnNlY3Rpb24gPSBzZXRpZnkoZWxlbWVudHNJbnRlcnNlY3Rpb24pO1xudmFyIHNldERpc2pvaW50U3VidHJhY3QgPSBzZXRpZnkoZWxlbWVudHNEaXNqb2ludFN1YnRyYWN0KTtcblxuLy9cbnZhciBiYWdXaW5kb3dSZXNvcnQgPSAoYmFnRW50cmllcywgcmFua0NvbXBhcmUsIGZ1bGxDb21wYXJlKSA9PiB7XG4gIGFzc2VydFJhbmtTb3J0ZWQoYmFnRW50cmllcywgcmFua0NvbXBhcmUpO1xuICBjb25zdCB7IGxlbmd0aCB9ID0gYmFnRW50cmllcztcbiAgbGV0IGkyID0gMDtcbiAgbGV0IG9wdElubmVySXRlcmF0b3I7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiBoYXJkZW4oe1xuICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICBpZiAob3B0SW5uZXJJdGVyYXRvcikge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IG9wdElubmVySXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgICAgICAgb3B0SW5uZXJJdGVyYXRvciA9IHZvaWQgMDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGkyIDwgbGVuZ3RoKSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBiYWdFbnRyaWVzW2kyXTtcbiAgICAgICAgICBsZXQgaiA9IGkyICsgMTtcbiAgICAgICAgICB3aGlsZSAoaiA8IGxlbmd0aCAmJiByYW5rQ29tcGFyZShlbnRyeVswXSwgYmFnRW50cmllc1tqXVswXSkgPT09IDApIHtcbiAgICAgICAgICAgIGogKz0gMTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGogPT09IGkyICsgMSkge1xuICAgICAgICAgICAgaTIgPSBqO1xuICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZTogZW50cnkgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHNpbWlsYXJSdW4gPSBiYWdFbnRyaWVzLnNsaWNlKGkyLCBqKTtcbiAgICAgICAgICBpMiA9IGo7XG4gICAgICAgICAgY29uc3QgcmVzb3J0ZWQgPSBzb3J0QnlSYW5rKHNpbWlsYXJSdW4sIGZ1bGxDb21wYXJlKTtcbiAgICAgICAgICBhc3NlcnROb0R1cGxpY2F0ZUtleXMocmVzb3J0ZWQsIGZ1bGxDb21wYXJlKTtcbiAgICAgICAgICBvcHRJbm5lckl0ZXJhdG9yID0gcmVzb3J0ZWRbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgICAgIHJldHVybiBvcHRJbm5lckl0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IFtudWxsLCAwbl0gfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICB9KTtcbn07XG52YXIgbWVyZ2UyID0gKHhiYWdFbnRyaWVzLCB5YmFnRW50cmllcykgPT4ge1xuICBjb25zdCBmdWxsQ29tcGFyZSA9IG1ha2VGdWxsT3JkZXJDb21wYXJhdG9yS2l0KCkuYW50aUNvbXBhcmF0b3I7XG4gIGNvbnN0IHhzID0gYmFnV2luZG93UmVzb3J0KHhiYWdFbnRyaWVzLCBjb21wYXJlQW50aVJhbmssIGZ1bGxDb21wYXJlKTtcbiAgY29uc3QgeXMgPSBiYWdXaW5kb3dSZXNvcnQoeWJhZ0VudHJpZXMsIGNvbXBhcmVBbnRpUmFuaywgZnVsbENvbXBhcmUpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgbGV0IHg7XG4gICAgICBsZXQgeGM7XG4gICAgICBsZXQgeERvbmU7XG4gICAgICBsZXQgeTtcbiAgICAgIGxldCB5YztcbiAgICAgIGxldCB5RG9uZTtcbiAgICAgIGNvbnN0IHhpID0geHNbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgY29uc3QgbmV4dFggPSAoKSA9PiB7XG4gICAgICAgICF4RG9uZSB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBuZXh0WCBzaG91bGQgbm90IGJlIGNhbGxlZCBvbmNlIGRvbmVgO1xuICAgICAgICAoe1xuICAgICAgICAgIGRvbmU6IHhEb25lLFxuICAgICAgICAgIHZhbHVlOiBbeCwgeGNdXG4gICAgICAgIH0gPSB4aS5uZXh0KCkpO1xuICAgICAgfTtcbiAgICAgIG5leHRYKCk7XG4gICAgICBjb25zdCB5aSA9IHlzW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgIGNvbnN0IG5leHRZID0gKCkgPT4ge1xuICAgICAgICAheURvbmUgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogbmV4dFkgc2hvdWxkIG5vdCBiZSBjYWxsZWQgb25jZSBkb25lYDtcbiAgICAgICAgKHtcbiAgICAgICAgICBkb25lOiB5RG9uZSxcbiAgICAgICAgICB2YWx1ZTogW3ksIHljXVxuICAgICAgICB9ID0geWkubmV4dCgpKTtcbiAgICAgIH07XG4gICAgICBuZXh0WSgpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBsZXQgZG9uZSA9IGZhbHNlO1xuICAgICAgICAgIGxldCB2YWx1ZTtcbiAgICAgICAgICBpZiAoeERvbmUgJiYgeURvbmUpIHtcbiAgICAgICAgICAgIGRvbmUgPSB0cnVlO1xuICAgICAgICAgICAgdmFsdWUgPSBbbnVsbCwgMG4sIDBuXTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHhEb25lKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IFt5LCAwbiwgeWNdO1xuICAgICAgICAgICAgbmV4dFkoKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHlEb25lKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IFt4LCB4YywgMG5dO1xuICAgICAgICAgICAgbmV4dFgoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgY29tcCA9IGZ1bGxDb21wYXJlKHgsIHkpO1xuICAgICAgICAgICAgaWYgKGNvbXAgPT09IDApIHtcbiAgICAgICAgICAgICAgdmFsdWUgPSBbeCwgeGMsIHljXTtcbiAgICAgICAgICAgICAgbmV4dFgoKTtcbiAgICAgICAgICAgICAgbmV4dFkoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29tcCA8IDApIHtcbiAgICAgICAgICAgICAgdmFsdWUgPSBbeCwgeGMsIDBuXTtcbiAgICAgICAgICAgICAgbmV4dFgoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbXAgPiAwIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IFVuZXhwZWN0ZWQgY29tcCAke3F1b3RlKGNvbXApfWA7XG4gICAgICAgICAgICAgIHZhbHVlID0gW3ksIDBuLCB5Y107XG4gICAgICAgICAgICAgIG5leHRZKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lLCB2YWx1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWVyZ2UyKTtcbnZhciBiYWdJdGVySXNTdXBlcmJhZyA9ICh4eWkpID0+IHtcbiAgZm9yIChjb25zdCBbX20sIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgaWYgKHhjIDwgeWMpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xudmFyIGJhZ0l0ZXJJc0Rpc2pvaW50ID0gKHh5aSkgPT4ge1xuICBmb3IgKGNvbnN0IFtfbSwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICBpZiAoeGMgPj0gMW4gJiYgeWMgPj0gMW4pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xudmFyIGJhZ0l0ZXJVbmlvbiA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIHJlc3VsdC5wdXNoKFttMiwgeGMgKyB5Y10pO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xudmFyIGJhZ0l0ZXJJbnRlcnNlY3Rpb24gPSAoeHlpKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3IgKGNvbnN0IFttMiwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICBjb25zdCBtYyA9IHhjIDw9IHljID8geGMgOiB5YztcbiAgICByZXN1bHQucHVzaChbbTIsIG1jXSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgYmFnSXRlckRpc2pvaW50U3VidHJhY3QgPSAoeHlpKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3IgKGNvbnN0IFttMiwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICBjb25zdCBtYyA9IHhjIC0geWM7XG4gICAgbWMgPj0gMG4gfHwgdGhyb3dSZWRhY3RlZGByaWdodCBlbGVtZW50ICR7bTJ9IHdhcyBub3QgaW4gbGVmdGA7XG4gICAgaWYgKG1jID49IDFuKSB7XG4gICAgICByZXN1bHQucHVzaChbbTIsIG1jXSk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xudmFyIG1lcmdlaWZ5MiA9IChiYWdJdGVyT3ApID0+ICh4YmFnRW50cmllcywgeWJhZ0VudHJpZXMpID0+IGJhZ0l0ZXJPcChtZXJnZTIoeGJhZ0VudHJpZXMsIHliYWdFbnRyaWVzKSk7XG52YXIgYmFnRW50cmllc0lzU3VwZXJiYWcgPSBtZXJnZWlmeTIoYmFnSXRlcklzU3VwZXJiYWcpO1xudmFyIGJhZ0VudHJpZXNJc0Rpc2pvaW50ID0gbWVyZ2VpZnkyKGJhZ0l0ZXJJc0Rpc2pvaW50KTtcbnZhciBiYWdFbnRyaWVzVW5pb24gPSBtZXJnZWlmeTIoYmFnSXRlclVuaW9uKTtcbnZhciBiYWdFbnRyaWVzSW50ZXJzZWN0aW9uID0gbWVyZ2VpZnkyKGJhZ0l0ZXJJbnRlcnNlY3Rpb24pO1xudmFyIGJhZ0VudHJpZXNEaXNqb2ludFN1YnRyYWN0ID0gbWVyZ2VpZnkyKGJhZ0l0ZXJEaXNqb2ludFN1YnRyYWN0KTtcbnZhciByYXdCYWdpZnkgPSAoYmFnRW50cmllc09wKSA9PiAoeGJhZywgeWJhZykgPT4gYmFnRW50cmllc09wKHhiYWcucGF5bG9hZCwgeWJhZy5wYXlsb2FkKTtcbnZhciBiYWdpZnkgPSAoYmFnRW50cmllc09wKSA9PiAoeGJhZywgeWJhZykgPT4gbWFrZUJhZ09mRW50cmllcyhiYWdFbnRyaWVzT3AoeGJhZy5wYXlsb2FkLCB5YmFnLnBheWxvYWQpKTtcbnZhciBiYWdJc1N1cGVyYmFnID0gcmF3QmFnaWZ5KGJhZ0VudHJpZXNJc1N1cGVyYmFnKTtcbnZhciBiYWdJc0Rpc2pvaW50ID0gcmF3QmFnaWZ5KGJhZ0VudHJpZXNJc0Rpc2pvaW50KTtcbnZhciBiYWdVbmlvbiA9IGJhZ2lmeShiYWdFbnRyaWVzVW5pb24pO1xudmFyIGJhZ0ludGVyc2VjdGlvbiA9IGJhZ2lmeShiYWdFbnRyaWVzSW50ZXJzZWN0aW9uKTtcbnZhciBiYWdEaXNqb2ludFN1YnRyYWN0ID0gYmFnaWZ5KGJhZ0VudHJpZXNEaXNqb2ludFN1YnRyYWN0KTtcblxuLy9cbnZhciB0aHJvd0xhYmVsZWQgPSAoaW5uZXJFcnIsIGxhYmVsLCBlcnJDb25zdHJ1Y3RvciA9IHZvaWQgMCwgb3B0aW9ucyA9IHZvaWQgMCkgPT4ge1xuICBpZiAodHlwZW9mIGxhYmVsID09PSBcIm51bWJlclwiKSB7XG4gICAgbGFiZWwgPSBgWyR7bGFiZWx9XWA7XG4gIH1cbiAgY29uc3Qgb3V0ZXJFcnIgPSBtYWtlRXJyb3IoXG4gICAgYCR7bGFiZWx9OiAke2lubmVyRXJyLm1lc3NhZ2V9YCxcbiAgICBlcnJDb25zdHJ1Y3RvcixcbiAgICBvcHRpb25zXG4gICk7XG4gIG5vdGUob3V0ZXJFcnIsIHJlZGFjdGVkYENhdXNlZCBieSAke2lubmVyRXJyfWApO1xuICB0aHJvdyBvdXRlckVycjtcbn07XG5oYXJkZW4odGhyb3dMYWJlbGVkKTtcblxuLy9cbnZhciBhcHBseUxhYmVsaW5nRXJyb3IgPSAoZnVuYywgYXJncywgbGFiZWwgPSB2b2lkIDApID0+IHtcbiAgaWYgKGxhYmVsID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gZnVuYyguLi5hcmdzKTtcbiAgfVxuICBsZXQgcmVzdWx0O1xuICB0cnkge1xuICAgIHJlc3VsdCA9IGZ1bmMoLi4uYXJncyk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHRocm93TGFiZWxlZChlcnIsIGxhYmVsKTtcbiAgfVxuICBpZiAoaXNQcm9taXNlKHJlc3VsdCkpIHtcbiAgICByZXR1cm4gRS53aGVuKHJlc3VsdCwgdm9pZCAwLCAocmVhc29uKSA9PiB0aHJvd0xhYmVsZWQocmVhc29uLCBsYWJlbCkpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbn07XG5oYXJkZW4oYXBwbHlMYWJlbGluZ0Vycm9yKTtcblxuLy9cbnZhciB7IGZyb21FbnRyaWVzOiBmcm9tRW50cmllczcgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IG93bktleXMxNiB9ID0gUmVmbGVjdDtcbnZhciBmcm9tVW5pcXVlRW50cmllcyA9IChhbGxFbnRyaWVzKSA9PiB7XG4gIGNvbnN0IGVudHJpZXNBcnJheSA9IFsuLi5hbGxFbnRyaWVzXTtcbiAgY29uc3QgcmVzdWx0ID0gaGFyZGVuKGZyb21FbnRyaWVzNyhlbnRyaWVzQXJyYXkpKTtcbiAgaWYgKG93bktleXMxNihyZXN1bHQpLmxlbmd0aCA9PT0gZW50cmllc0FycmF5Lmxlbmd0aCkge1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgY29uc3QgbmFtZXMgPSAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICBmb3IgKGNvbnN0IFtuYW1lLCBfXSBvZiBlbnRyaWVzQXJyYXkpIHtcbiAgICBpZiAobmFtZXMuaGFzKG5hbWUpKSB7XG4gICAgICB0aHJvd1JlZGFjdGVkYGNvbGxpc2lvbiBvbiBwcm9wZXJ0eSBuYW1lICR7cXVvdGUobmFtZSl9OiAke2VudHJpZXNBcnJheX1gO1xuICAgIH1cbiAgICBuYW1lcy5hZGQobmFtZSk7XG4gIH1cbiAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogZmFpbGVkIHRvIGNyZWF0ZSBvYmplY3QgZnJvbSB1bmlxdWUgZW50cmllc2A7XG59O1xuaGFyZGVuKGZyb21VbmlxdWVFbnRyaWVzKTtcblxuLy9cbnZhciBsaXN0RGlmZmVyZW5jZSA9IChsZWZ0TGlzdCwgcmlnaHRMaXN0KSA9PiB7XG4gIGNvbnN0IHJpZ2h0U2V0ID0gbmV3IFNldChyaWdodExpc3QpO1xuICByZXR1cm4gbGVmdExpc3QuZmlsdGVyKChlbGVtZW50KSA9PiAhcmlnaHRTZXQuaGFzKGVsZW1lbnQpKTtcbn07XG5oYXJkZW4obGlzdERpZmZlcmVuY2UpO1xuXG4vL1xudmFyIHsgZW50cmllczogZW50cmllczcsIHZhbHVlczogdmFsdWVzMiB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czE3IH0gPSBSZWZsZWN0O1xudmFyIHBhdHRlcm5NZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCk7XG52YXIgTU07XG52YXIgZGVmYXVsdExpbWl0cyA9IGhhcmRlbih7XG4gIGRlY2ltYWxEaWdpdHNMaW1pdDogMTAwLFxuICBzdHJpbmdMZW5ndGhMaW1pdDogMWU1LFxuICBzeW1ib2xOYW1lTGVuZ3RoTGltaXQ6IDEwMCxcbiAgbnVtUHJvcGVydGllc0xpbWl0OiA4MCxcbiAgcHJvcGVydHlOYW1lTGVuZ3RoTGltaXQ6IDEwMCxcbiAgYXJyYXlMZW5ndGhMaW1pdDogMWU0LFxuICBudW1TZXRFbGVtZW50c0xpbWl0OiAxZTQsXG4gIG51bVVuaXF1ZUJhZ0VsZW1lbnRzTGltaXQ6IDFlNCxcbiAgbnVtTWFwRW50cmllc0xpbWl0OiA1ZTNcbn0pO1xudmFyIGxpbWl0ID0gKGxpbWl0cyA9IHt9KSA9PiAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICBoYXJkZW4oeyBfX3Byb3RvX186IGRlZmF1bHRMaW1pdHMsIC4uLmxpbWl0cyB9KVxuKTtcbnZhciBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdCA9IChwYXlsb2FkLCBtYWluUGF5bG9hZFNoYXBlLCBjaGVjaywgbGFiZWwpID0+IHtcbiAgYXNzZXJ0KEFycmF5LmlzQXJyYXkobWFpblBheWxvYWRTaGFwZSkpO1xuICBpZiAoIUFycmF5LmlzQXJyYXkocGF5bG9hZCkpIHtcbiAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7cXVvdGUobGFiZWwpfSBwYXlsb2FkIG11c3QgYmUgYW4gYXJyYXk6ICR7cGF5bG9hZH1gKTtcbiAgfVxuICBjb25zdCBtYWluTGVuZ3RoID0gbWFpblBheWxvYWRTaGFwZS5sZW5ndGg7XG4gIGlmICghKHBheWxvYWQubGVuZ3RoID09PSBtYWluTGVuZ3RoIHx8IHBheWxvYWQubGVuZ3RoID09PSBtYWluTGVuZ3RoICsgMSkpIHtcbiAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7cXVvdGUobGFiZWwpfSBwYXlsb2FkIHVuZXhwZWN0ZWQgc2l6ZTogJHtwYXlsb2FkfWApO1xuICB9XG4gIGNvbnN0IGxpbWl0cyA9IHBheWxvYWRbbWFpbkxlbmd0aF07XG4gIHBheWxvYWQgPSBoYXJkZW4ocGF5bG9hZC5zbGljZSgwLCBtYWluTGVuZ3RoKSk7XG4gIGlmICghY2hlY2tNYXRjaGVzKHBheWxvYWQsIG1haW5QYXlsb2FkU2hhcGUsIGNoZWNrLCBsYWJlbCkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKGxpbWl0cyA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIChwYXNzU3R5bGVPZihsaW1pdHMpID09PSBcImNvcHlSZWNvcmRcIiB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgTGltaXRzIG11c3QgYmUgYSByZWNvcmQ6ICR7cXVvdGUobGltaXRzKX1gKSkgJiYgZW50cmllczcobGltaXRzKS5ldmVyeShcbiAgICAoW2tleSwgdmFsdWVdKSA9PiBwYXNzU3R5bGVPZih2YWx1ZSkgPT09IFwibnVtYmVyXCIgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYFZhbHVlIG9mIGxpbWl0ICR7cXVvdGUoa2V5KX0gYnV0IGJlIGEgbnVtYmVyOiAke3F1b3RlKHZhbHVlKX1gKVxuICApO1xufTtcbnZhciBjaGVja0RlY2ltYWxEaWdpdHNMaW1pdCA9IChzcGVjaW1lbiwgZGVjaW1hbERpZ2l0c0xpbWl0LCBjaGVjaykgPT4ge1xuICBpZiAoTWF0aC5mbG9vcihNYXRoLmxvZzEwKE1hdGguYWJzKE51bWJlcihzcGVjaW1lbikpKSkgKyAxIDw9IGRlY2ltYWxEaWdpdHNMaW1pdCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBjaGVjayhcbiAgICBmYWxzZSxcbiAgICByZWRhY3RlZGBiaWdpbnQgJHtzcGVjaW1lbn0gbXVzdCBub3QgaGF2ZSBtb3JlIHRoYW4gJHtkZWNpbWFsRGlnaXRzTGltaXR9IGRpZ2l0c2BcbiAgKTtcbn07XG52YXIgbWFrZVBhdHRlcm5LaXQgPSAoKSA9PiB7XG4gIGNvbnN0IG1heWJlTWF0Y2hIZWxwZXIgPSAodGFnKSA9PiAoXG4gICAgLy9cbiAgICBIZWxwZXJzQnlNYXRjaFRhZ1t0YWddXG4gICk7XG4gIGNvbnN0IG1heWJlUGF5bG9hZFNoYXBlID0gKHRhZykgPT4gKFxuICAgIC8vXG4gICAgR3VhcmRQYXlsb2FkU2hhcGVzW3RhZ11cbiAgKTtcbiAgY29uc3Qgc2luZ2xldG9uS2luZHMgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcChbXG4gICAgW1wibnVsbFwiLCBudWxsXSxcbiAgICBbXCJ1bmRlZmluZWRcIiwgdm9pZCAwXVxuICBdKTtcbiAgY29uc3QgdGFnTWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCBjaGVja1RhZ2dlZCA9ICh0YWdnZWQsIHRhZywgY2hlY2spID0+IHtcbiAgICBjb25zdCBtYXRjaEhlbHBlciA9IG1heWJlTWF0Y2hIZWxwZXIodGFnKTtcbiAgICBpZiAobWF0Y2hIZWxwZXIpIHtcbiAgICAgIHJldHVybiBtYXRjaEhlbHBlci5jaGVja0lzV2VsbEZvcm1lZCh0YWdnZWQucGF5bG9hZCwgY2hlY2spO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBwYXlsb2FkU2hhcGUgPSBtYXliZVBheWxvYWRTaGFwZSh0YWcpO1xuICAgICAgaWYgKHBheWxvYWRTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiBjaGVja01hdGNoZXMyKHRhZ2dlZC5wYXlsb2FkLCBwYXlsb2FkU2hhcGUsIGNoZWNrLCB0YWcpO1xuICAgICAgfVxuICAgIH1cbiAgICBzd2l0Y2ggKHRhZykge1xuICAgICAgY2FzZSBcImNvcHlTZXRcIjoge1xuICAgICAgICByZXR1cm4gY2hlY2tDb3B5U2V0KHRhZ2dlZCwgY2hlY2spO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlCYWdcIjoge1xuICAgICAgICByZXR1cm4gY2hlY2tDb3B5QmFnKHRhZ2dlZCwgY2hlY2spO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICByZXR1cm4gY2hlY2tDb3B5TWFwKHRhZ2dlZCwgY2hlY2spO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcmVkYWN0ZWRgY2Fubm90IGNoZWNrIHVucmVjb2duaXplZCB0YWcgJHtxdW90ZSh0YWcpfTogJHt0YWdnZWR9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3Qga2luZE9mMiA9IChzcGVjaW1lbiwgY2hlY2sgPSBpZGVudENoZWNrZXIpID0+IHtcbiAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihzcGVjaW1lbik7XG4gICAgaWYgKHBhc3NTdHlsZSAhPT0gXCJ0YWdnZWRcIikge1xuICAgICAgcmV0dXJuIHBhc3NTdHlsZTtcbiAgICB9XG4gICAgaWYgKHRhZ01lbW8uaGFzKHNwZWNpbWVuKSkge1xuICAgICAgcmV0dXJuIHRhZ01lbW8uZ2V0KHNwZWNpbWVuKTtcbiAgICB9XG4gICAgY29uc3QgdGFnID0gZ2V0VGFnKHNwZWNpbWVuKTtcbiAgICBpZiAoY2hlY2tUYWdnZWQoc3BlY2ltZW4sIHRhZywgY2hlY2spKSB7XG4gICAgICB0YWdNZW1vLnNldChzcGVjaW1lbiwgdGFnKTtcbiAgICAgIHJldHVybiB0YWc7XG4gICAgfVxuICAgIGlmIChjaGVjayAhPT0gaWRlbnRDaGVja2VyKSB7XG4gICAgICBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgY2Fubm90IGNoZWNrIHVucmVjb2duaXplZCB0YWcgJHtxdW90ZSh0YWcpfWApO1xuICAgIH1cbiAgICByZXR1cm4gdm9pZCAwO1xuICB9O1xuICBoYXJkZW4oa2luZE9mMik7XG4gIGNvbnN0IGNoZWNrS2luZCA9IChzcGVjaW1lbiwga2luZDIsIGNoZWNrKSA9PiB7XG4gICAgaWYgKHNpbmdsZXRvbktpbmRzLmhhcyhraW5kMikpIHtcbiAgICAgIHJldHVybiBjaGVja0FzS2V5UGF0dChzcGVjaW1lbiwgc2luZ2xldG9uS2luZHMuZ2V0KGtpbmQyKSwgY2hlY2spO1xuICAgIH1cbiAgICBjb25zdCByZWFsS2luZCA9IGtpbmRPZjIoc3BlY2ltZW4sIGNoZWNrKTtcbiAgICBpZiAoa2luZDIgPT09IHJlYWxLaW5kKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGNoZWNrICE9PSBpZGVudENoZWNrZXIpIHtcbiAgICAgIGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke2JhcmVPclF1b3RlKHJlYWxLaW5kKX0gJHtzcGVjaW1lbn0gLSBNdXN0IGJlIGEgJHtiYXJlT3JRdW90ZShraW5kMil9YCk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgY29uc3QgaXNLaW5kID0gKHNwZWNpbWVuLCBraW5kMikgPT4gY2hlY2tLaW5kKHNwZWNpbWVuLCBraW5kMiwgaWRlbnRDaGVja2VyKTtcbiAgY29uc3QgY2hlY2tBc0tleVBhdHQgPSAoc3BlY2ltZW4sIGtleUFzUGF0dGVybiwgY2hlY2spID0+IHtcbiAgICBpZiAoaXNLZXkoc3BlY2ltZW4pICYmIGtleUVRKHNwZWNpbWVuLCBrZXlBc1BhdHRlcm4pKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGNoZWNrICE9PSBpZGVudENoZWNrZXIgJiYgLy9cbiAgICAvL1xuICAgIGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmU6ICR7a2V5QXNQYXR0ZXJufWApO1xuICB9O1xuICBjb25zdCBjaGVja1BhdHRlcm4gPSAocGF0dCwgY2hlY2spID0+IHtcbiAgICBpZiAoaXNLZXkocGF0dCkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAocGF0dGVybk1lbW8uaGFzKHBhdHQpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0ID0gY2hlY2tQYXR0ZXJuSW50ZXJuYWwocGF0dCwgY2hlY2spO1xuICAgIGlmIChyZXN1bHQpIHtcbiAgICAgIHBhdHRlcm5NZW1vLmFkZChwYXR0KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbiAgY29uc3QgY2hlY2tQYXR0ZXJuSW50ZXJuYWwgPSAocGF0dCwgY2hlY2spID0+IHtcbiAgICBjb25zdCBjaGVja0l0ID0gKGNoaWxkKSA9PiBjaGVja1BhdHRlcm4oY2hpbGQsIGNoZWNrKTtcbiAgICBjb25zdCBraW5kMiA9IGtpbmRPZjIocGF0dCwgY2hlY2spO1xuICAgIHN3aXRjaCAoa2luZDIpIHtcbiAgICAgIGNhc2Ugdm9pZCAwOiB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgcmV0dXJuIHZhbHVlczIocGF0dCkuZXZlcnkoY2hlY2tJdCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgcmV0dXJuIHBhdHQuZXZlcnkoY2hlY2tJdCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weU1hcFwiOiB7XG4gICAgICAgIHJldHVybiBjaGVja1BhdHRlcm4ocGF0dC52YWx1ZXMsIGNoZWNrKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlcnJvclwiOlxuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgJHtxdW90ZShraW5kMil9IGNhbm5vdCBiZSBhIHBhdHRlcm5gKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgaWYgKG1heWJlTWF0Y2hIZWxwZXIoa2luZDIpICE9PSB2b2lkIDApIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcmVkYWN0ZWRgQSBwYXNzYWJsZSBvZiBraW5kICR7cXVvdGUoa2luZDIpfSBpcyBub3QgYSBwYXR0ZXJuOiAke3BhdHR9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgaXNQYXR0ZXJuMiA9IChwYXR0KSA9PiBjaGVja1BhdHRlcm4ocGF0dCwgaWRlbnRDaGVja2VyKTtcbiAgY29uc3QgYXNzZXJ0UGF0dGVybjIgPSAocGF0dCkgPT4ge1xuICAgIGNoZWNrUGF0dGVybihwYXR0LCBhc3NlcnRDaGVja2VyKTtcbiAgfTtcbiAgY29uc3QgY2hlY2tNYXRjaGVzMiA9IChzcGVjaW1lbiwgcGF0dGVybiwgY2hlY2ssIGxhYmVsID0gdm9pZCAwKSA9PiAoXG4gICAgLy9cbiAgICBhcHBseUxhYmVsaW5nRXJyb3IoY2hlY2tNYXRjaGVzSW50ZXJuYWwsIFtzcGVjaW1lbiwgcGF0dGVybiwgY2hlY2tdLCBsYWJlbClcbiAgKTtcbiAgY29uc3QgY2hlY2tNYXRjaGVzSW50ZXJuYWwgPSAoc3BlY2ltZW4sIHBhdHQsIGNoZWNrKSA9PiB7XG4gICAgY29uc3QgcGF0dGVybktpbmQgPSBraW5kT2YyKHBhdHQsIGNoZWNrKTtcbiAgICBjb25zdCBzcGVjaW1lbktpbmQgPSBraW5kT2YyKHNwZWNpbWVuKTtcbiAgICBzd2l0Y2ggKHBhdHRlcm5LaW5kKSB7XG4gICAgICBjYXNlIHZvaWQgMDoge1xuICAgICAgICByZXR1cm4gdGhyb3dSZWRhY3RlZGBwYXR0ZXJuIGV4cGVjdGVkOiAke3BhdHR9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgcmV0dXJuIHRocm93UmVkYWN0ZWRgcHJvbWlzZXMgY2Fubm90IGJlIHBhdHRlcm5zOiAke3BhdHR9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgIHJldHVybiB0aHJvd1JlZGFjdGVkYGVycm9ycyBjYW5ub3QgYmUgcGF0dGVybnM6ICR7cGF0dH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOlxuICAgICAgY2FzZSBcIm51bGxcIjpcbiAgICAgIGNhc2UgXCJib29sZWFuXCI6XG4gICAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgICBjYXNlIFwiYmlnaW50XCI6XG4gICAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgICBjYXNlIFwic3ltYm9sXCI6XG4gICAgICBjYXNlIFwiY29weVNldFwiOlxuICAgICAgY2FzZSBcImNvcHlCYWdcIjpcbiAgICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgICByZXR1cm4gY2hlY2tBc0tleVBhdHQoc3BlY2ltZW4sIHBhdHQsIGNoZWNrKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICBpZiAoaXNLZXkocGF0dCkpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2tBc0tleVBhdHQoc3BlY2ltZW4sIHBhdHQsIGNoZWNrKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3BlY2ltZW5LaW5kICE9PSBcImNvcHlBcnJheVwiKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgYSBjb3B5QXJyYXkgdG8gbWF0Y2ggYSBjb3B5QXJyYXkgcGF0dGVybjogJHtxdW90ZShcbiAgICAgICAgICAgICAgcGF0dFxuICAgICAgICAgICAgKX1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGxlbmd0aCB9ID0gcGF0dDtcbiAgICAgICAgaWYgKHNwZWNpbWVuLmxlbmd0aCAhPT0gbGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICByZWRhY3RlZGBBcnJheSAke3NwZWNpbWVufSAtIE11c3QgYmUgYXMgbG9uZyBhcyBjb3B5QXJyYXkgcGF0dGVybjogJHtxdW90ZShcbiAgICAgICAgICAgICAgcGF0dFxuICAgICAgICAgICAgKX1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGF0dC5ldmVyeSgocDMsIGkyKSA9PiBjaGVja01hdGNoZXMyKHNwZWNpbWVuW2kyXSwgcDMsIGNoZWNrLCBpMikpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICBpZiAoaXNLZXkocGF0dCkpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2tBc0tleVBhdHQoc3BlY2ltZW4sIHBhdHQsIGNoZWNrKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3BlY2ltZW5LaW5kICE9PSBcImNvcHlSZWNvcmRcIikge1xuICAgICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIGEgY29weVJlY29yZCB0byBtYXRjaCBhIGNvcHlSZWNvcmQgcGF0dGVybjogJHtxdW90ZShcbiAgICAgICAgICAgICAgcGF0dFxuICAgICAgICAgICAgKX1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzcGVjaW1lbk5hbWVzID0gcmVjb3JkTmFtZXMoc3BlY2ltZW4pO1xuICAgICAgICBjb25zdCBwYXR0TmFtZXMgPSByZWNvcmROYW1lcyhwYXR0KTtcbiAgICAgICAgY29uc3QgbWlzc2luZzIgPSBsaXN0RGlmZmVyZW5jZShwYXR0TmFtZXMsIHNwZWNpbWVuTmFtZXMpO1xuICAgICAgICBpZiAobWlzc2luZzIubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBoYXZlIG1pc3NpbmcgcHJvcGVydGllcyAke3F1b3RlKG1pc3NpbmcyKX1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1bmV4cGVjdGVkID0gbGlzdERpZmZlcmVuY2Uoc3BlY2ltZW5OYW1lcywgcGF0dE5hbWVzKTtcbiAgICAgICAgaWYgKHVuZXhwZWN0ZWQubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBub3QgaGF2ZSB1bmV4cGVjdGVkIHByb3BlcnRpZXM6ICR7cXVvdGUoXG4gICAgICAgICAgICAgIHVuZXhwZWN0ZWRcbiAgICAgICAgICAgICl9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3BlY2ltZW5WYWx1ZXMgPSByZWNvcmRWYWx1ZXMoc3BlY2ltZW4sIHNwZWNpbWVuTmFtZXMpO1xuICAgICAgICBjb25zdCBwYXR0VmFsdWVzID0gcmVjb3JkVmFsdWVzKHBhdHQsIHBhdHROYW1lcyk7XG4gICAgICAgIHJldHVybiBwYXR0TmFtZXMuZXZlcnkoXG4gICAgICAgICAgKGxhYmVsLCBpMikgPT4gY2hlY2tNYXRjaGVzMihzcGVjaW1lblZhbHVlc1tpMl0sIHBhdHRWYWx1ZXNbaTJdLCBjaGVjaywgbGFiZWwpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weU1hcFwiOiB7XG4gICAgICAgIGlmIChpc0tleShwYXR0KSkge1xuICAgICAgICAgIHJldHVybiBjaGVja0FzS2V5UGF0dChzcGVjaW1lbiwgcGF0dCwgY2hlY2spO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzcGVjaW1lbktpbmQgIT09IFwiY29weU1hcFwiKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgYSBjb3B5TWFwIHRvIG1hdGNoIGEgY29weU1hcCBwYXR0ZXJuOiAke3F1b3RlKFxuICAgICAgICAgICAgICBwYXR0XG4gICAgICAgICAgICApfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhdHRLZXlTZXQgPSBjb3B5TWFwS2V5U2V0KHBhdHQpO1xuICAgICAgICBjb25zdCBzcGVjaW1lbktleVNldCA9IGNvcHlNYXBLZXlTZXQoc3BlY2ltZW4pO1xuICAgICAgICBpZiAoIWNoZWNrTWF0Y2hlczIoc3BlY2ltZW5LZXlTZXQsIHBhdHRLZXlTZXQsIGNoZWNrKSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwYXR0VmFsdWVzID0gW107XG4gICAgICAgIGNvbnN0IHNwZWNpbWVuVmFsdWVzID0gW107XG4gICAgICAgIGNvbnN0IGVudHJ5UGFpcnMgPSBnZW5lcmF0ZUNvbGxlY3Rpb25QYWlyRW50cmllcyhcbiAgICAgICAgICBwYXR0LFxuICAgICAgICAgIHNwZWNpbWVuLFxuICAgICAgICAgIGdldENvcHlNYXBFbnRyeUFycmF5LFxuICAgICAgICAgIHZvaWQgMFxuICAgICAgICApO1xuICAgICAgICBmb3IgKGNvbnN0IFtfa2V5LCBwYXR0VmFsdWUsIHNwZWNpbWVuVmFsdWVdIG9mIGVudHJ5UGFpcnMpIHtcbiAgICAgICAgICBwYXR0VmFsdWVzLnB1c2gocGF0dFZhbHVlKTtcbiAgICAgICAgICBzcGVjaW1lblZhbHVlcy5wdXNoKHNwZWNpbWVuVmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGVja01hdGNoZXMyKGhhcmRlbihzcGVjaW1lblZhbHVlcyksIGhhcmRlbihwYXR0VmFsdWVzKSwgY2hlY2spO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBjb25zdCBtYXRjaEhlbHBlciA9IG1heWJlTWF0Y2hIZWxwZXIocGF0dGVybktpbmQpO1xuICAgICAgICBpZiAobWF0Y2hIZWxwZXIpIHtcbiAgICAgICAgICByZXR1cm4gbWF0Y2hIZWxwZXIuY2hlY2tNYXRjaGVzKHNwZWNpbWVuLCBwYXR0LnBheWxvYWQsIGNoZWNrKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBzaG91bGQgaGF2ZSByZWNvZ25pemVkICR7cXVvdGUocGF0dGVybktpbmQpfSBgO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgbWF0Y2hlczIgPSAoc3BlY2ltZW4sIHBhdHQpID0+IGNoZWNrTWF0Y2hlczIoc3BlY2ltZW4sIHBhdHQsIGlkZW50Q2hlY2tlcik7XG4gIGNvbnN0IG11c3RNYXRjaDQgPSAoc3BlY2ltZW4sIHBhdHQsIGxhYmVsID0gdm9pZCAwKSA9PiB7XG4gICAgbGV0IGlubmVyRXJyb3I7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChjaGVja01hdGNoZXMyKHNwZWNpbWVuLCBwYXR0LCBpZGVudENoZWNrZXIsIHZvaWQgMCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVyKSB7XG4gICAgICBpbm5lckVycm9yID0gZXI7XG4gICAgfVxuICAgIGNoZWNrTWF0Y2hlczIoc3BlY2ltZW4sIHBhdHQsIGFzc2VydENoZWNrZXIsIGxhYmVsKTtcbiAgICBjb25zdCBvdXRlckVycm9yID0gbWFrZUVycm9yKFxuICAgICAgcmVkYWN0ZWRgaW50ZXJuYWw6ICR7bGFiZWx9OiBpbmNvbnNpc3RlbnQgcGF0dGVybiBtYXRjaDogJHtxdW90ZShwYXR0KX1gXG4gICAgKTtcbiAgICBpZiAoaW5uZXJFcnJvciAhPT0gdm9pZCAwKSB7XG4gICAgICBub3RlKG91dGVyRXJyb3IsIHJlZGFjdGVkYGNhdXNlZCBieSAke2lubmVyRXJyb3J9YCk7XG4gICAgfVxuICAgIHRocm93IG91dGVyRXJyb3I7XG4gIH07XG4gIGNvbnN0IGdldFJhbmtDb3ZlcjIgPSAocGF0dCwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgICBpZiAoaXNLZXkocGF0dCkpIHtcbiAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVQYXNzYWJsZShwYXR0KTtcbiAgICAgIGlmIChlbmNvZGVkICE9PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIFtlbmNvZGVkLCBgJHtlbmNvZGVkfX5gXTtcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocGF0dCk7XG4gICAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgY29uc3QgdGFnID0gZ2V0VGFnKHBhdHQpO1xuICAgICAgICBjb25zdCBtYXRjaEhlbHBlciA9IG1heWJlTWF0Y2hIZWxwZXIodGFnKTtcbiAgICAgICAgaWYgKG1hdGNoSGVscGVyKSB7XG4gICAgICAgICAgcmV0dXJuIG1hdGNoSGVscGVyLmdldFJhbmtDb3ZlcihwYXR0LnBheWxvYWQsIGVuY29kZVBhc3NhYmxlKTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKHRhZykge1xuICAgICAgICAgIGNhc2UgXCJjb3B5U2V0XCI6IHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiY29weU1hcFwiOiB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGdldFBhc3NTdHlsZUNvdmVyKHBhc3NTdHlsZSk7XG4gIH07XG4gIGNvbnN0IGFycmF5RXZlcnlNYXRjaFBhdHRlcm4gPSAoYXJyYXksIHBhdHQsIGNoZWNrLCBsYWJlbFByZWZpeCA9IFwiXCIpID0+IHtcbiAgICBpZiAoaXNLaW5kKHBhdHQsIFwibWF0Y2g6YW55XCIpKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGFycmF5LmV2ZXJ5KFxuICAgICAgKGVsLCBpMikgPT4gY2hlY2tNYXRjaGVzMihlbCwgcGF0dCwgY2hlY2ssIGAke2xhYmVsUHJlZml4fVske2kyfV1gKVxuICAgICk7XG4gIH07XG4gIGNvbnN0IG1hdGNoQW55SGVscGVyID0gRmFyKFwibWF0Y2g6YW55IGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoX3NwZWNpbWVuLCBfbWF0Y2hlclBheWxvYWQsIF9jaGVjaykgPT4gdHJ1ZSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKG1hdGNoZXJQYXlsb2FkLCBjaGVjaykgPT4gbWF0Y2hlclBheWxvYWQgPT09IHZvaWQgMCB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgbWF0Y2g6YW55IHBheWxvYWQ6ICR7bWF0Y2hlclBheWxvYWR9IC0gTXVzdCBiZSB1bmRlZmluZWRgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IFtcIlwiLCBcIntcIl1cbiAgfSk7XG4gIGNvbnN0IG1hdGNoQW5kSGVscGVyID0gRmFyKFwibWF0Y2g6YW5kIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIHBhdHRzLCBjaGVjaykgPT4ge1xuICAgICAgcmV0dXJuIHBhdHRzLmV2ZXJ5KChwYXR0KSA9PiBjaGVja01hdGNoZXMyKHNwZWNpbWVuLCBwYXR0LCBjaGVjaykpO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChhbGxlZ2VkUGF0dHMsIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCBjaGVja0l0ID0gKHBhdHQpID0+IGNoZWNrUGF0dGVybihwYXR0LCBjaGVjayk7XG4gICAgICByZXR1cm4gKHBhc3NTdHlsZU9mKGFsbGVnZWRQYXR0cykgPT09IFwiY29weUFycmF5XCIgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYE5lZWRzIGFycmF5IG9mIHN1Yi1wYXR0ZXJuczogJHtxdW90ZShhbGxlZ2VkUGF0dHMpfWApKSAmJiBhbGxlZ2VkUGF0dHMuZXZlcnkoY2hlY2tJdCk7XG4gICAgfSxcbiAgICBnZXRSYW5rQ292ZXI6IChwYXR0cywgZW5jb2RlUGFzc2FibGUpID0+IGludGVyc2VjdFJhbmtDb3ZlcnMoXG4gICAgICBjb21wYXJlUmFuayxcbiAgICAgIHBhdHRzLm1hcCgocDMpID0+IGdldFJhbmtDb3ZlcjIocDMsIGVuY29kZVBhc3NhYmxlKSlcbiAgICApXG4gIH0pO1xuICBjb25zdCBtYXRjaE9ySGVscGVyID0gRmFyKFwibWF0Y2g6b3IgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcGF0dHMsIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IGxlbmd0aCB9ID0gcGF0dHM7XG4gICAgICBpZiAobGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIG5vIHBhdHRlcm4gZGlzanVuY3RzIHRvIG1hdGNoOiAke3F1b3RlKHBhdHRzKX1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAocGF0dHMubGVuZ3RoID09PSAyICYmICFtYXRjaGVzMihzcGVjaW1lbiwgcGF0dHNbMF0pICYmIGlzS2luZChwYXR0c1swXSwgXCJtYXRjaDpraW5kXCIpICYmIHBhdHRzWzBdLnBheWxvYWQgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgcmV0dXJuIGNoZWNrTWF0Y2hlczIoc3BlY2ltZW4sIHBhdHRzWzFdLCBjaGVjayk7XG4gICAgICB9XG4gICAgICBpZiAocGF0dHMuc29tZSgocGF0dCkgPT4gbWF0Y2hlczIoc3BlY2ltZW4sIHBhdHQpKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IG1hdGNoIG9uZSBvZiAke3F1b3RlKHBhdHRzKX1gKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBtYXRjaEFuZEhlbHBlci5jaGVja0lzV2VsbEZvcm1lZCxcbiAgICBnZXRSYW5rQ292ZXI6IChwYXR0cywgZW5jb2RlUGFzc2FibGUpID0+IHVuaW9uUmFua0NvdmVycyhcbiAgICAgIGNvbXBhcmVSYW5rLFxuICAgICAgcGF0dHMubWFwKChwMykgPT4gZ2V0UmFua0NvdmVyMihwMywgZW5jb2RlUGFzc2FibGUpKVxuICAgIClcbiAgfSk7XG4gIGNvbnN0IG1hdGNoTm90SGVscGVyID0gRmFyKFwibWF0Y2g6bm90IGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIHBhdHQsIGNoZWNrKSA9PiB7XG4gICAgICBpZiAobWF0Y2hlczIoc3BlY2ltZW4sIHBhdHQpKSB7XG4gICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgZmFpbCBuZWdhdGVkIHBhdHRlcm46ICR7cXVvdGUocGF0dCl9YFxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogY2hlY2tQYXR0ZXJuLFxuICAgIGdldFJhbmtDb3ZlcjogKF9wYXR0LCBfZW5jb2RlUGFzc2FibGUpID0+IFtcIlwiLCBcIntcIl1cbiAgfSk7XG4gIGNvbnN0IG1hdGNoU2NhbGFySGVscGVyID0gRmFyKFwibWF0Y2g6c2NhbGFyIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIF9tYXRjaGVyUGF5bG9hZCwgY2hlY2spID0+IGNoZWNrU2NhbGFyS2V5KHNwZWNpbWVuLCBjaGVjayksXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IG1hdGNoQW55SGVscGVyLmNoZWNrSXNXZWxsRm9ybWVkLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gW1wiYVwiLCBcInp+XCJdXG4gIH0pO1xuICBjb25zdCBtYXRjaEtleUhlbHBlciA9IEZhcihcIm1hdGNoOmtleSBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBfbWF0Y2hlclBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0tleShzcGVjaW1lbiwgY2hlY2spLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBtYXRjaEFueUhlbHBlci5jaGVja0lzV2VsbEZvcm1lZCxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IFtcImFcIiwgXCJ6flwiXVxuICB9KTtcbiAgY29uc3QgbWF0Y2hQYXR0ZXJuSGVscGVyID0gRmFyKFwibWF0Y2g6cGF0dGVybiBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBfbWF0Y2hlclBheWxvYWQsIGNoZWNrKSA9PiBjaGVja1BhdHRlcm4oc3BlY2ltZW4sIGNoZWNrKSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogbWF0Y2hBbnlIZWxwZXIuY2hlY2tJc1dlbGxGb3JtZWQsXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBbXCJhXCIsIFwien5cIl1cbiAgfSk7XG4gIGNvbnN0IG1hdGNoS2luZEhlbHBlciA9IEZhcihcIm1hdGNoOmtpbmQgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IGNoZWNrS2luZCxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKGFsbGVnZWRLZXlLaW5kLCBjaGVjaykgPT4gdHlwZW9mIGFsbGVnZWRLZXlLaW5kID09PSBcInN0cmluZ1wiIHx8IGNoZWNrKFxuICAgICAgZmFsc2UsXG4gICAgICByZWRhY3RlZGBtYXRjaDpraW5kOiBwYXlsb2FkOiAke2FsbGVnZWRLZXlLaW5kfSAtIEEga2luZCBuYW1lIG11c3QgYmUgYSBzdHJpbmdgXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChraW5kMiwgX2VuY29kZVBhc3NhYmxlKSA9PiB7XG4gICAgICBsZXQgc3R5bGU7XG4gICAgICBzd2l0Y2ggKGtpbmQyKSB7XG4gICAgICAgIGNhc2UgXCJjb3B5U2V0XCI6XG4gICAgICAgIGNhc2UgXCJjb3B5TWFwXCI6IHtcbiAgICAgICAgICBzdHlsZSA9IFwidGFnZ2VkXCI7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHN0eWxlID0ga2luZDI7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBnZXRQYXNzU3R5bGVDb3ZlcihzdHlsZSk7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgbWF0Y2hUYWdnZWRIZWxwZXIgPSBGYXIoXCJtYXRjaDp0YWdnZWQgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW3RhZ1BhdHQsIHBheWxvYWRQYXR0XSwgY2hlY2spID0+IHtcbiAgICAgIGlmIChwYXNzU3R5bGVPZihzcGVjaW1lbikgIT09IFwidGFnZ2VkXCIpIHtcbiAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHJlZGFjdGVkYEV4cGVjdGVkIHRhZ2dlZCBvYmplY3QsIG5vdCAke3F1b3RlKFxuICAgICAgICAgICAgcGFzc1N0eWxlT2Yoc3BlY2ltZW4pXG4gICAgICAgICAgKX06ICR7c3BlY2ltZW59YFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNoZWNrTWF0Y2hlczIoZ2V0VGFnKHNwZWNpbWVuKSwgdGFnUGF0dCwgY2hlY2ssIFwidGFnXCIpICYmIGNoZWNrTWF0Y2hlczIoc3BlY2ltZW4ucGF5bG9hZCwgcGF5bG9hZFBhdHQsIGNoZWNrLCBcInBheWxvYWRcIik7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja01hdGNoZXMyKFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbTU0ucGF0dGVybigpLCBNTS5wYXR0ZXJuKCldKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDp0YWdnZWQgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfa2luZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInRhZ2dlZFwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hCaWdpbnRIZWxwZXIgPSBGYXIoXCJtYXRjaDpiaWdpbnQgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2xpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IGRlY2ltYWxEaWdpdHNMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiYmlnaW50XCIsIGNoZWNrKSAmJiBjaGVja0RlY2ltYWxEaWdpdHNMaW1pdChzcGVjaW1lbiwgZGVjaW1hbERpZ2l0c0xpbWl0LCBjaGVjayk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW10pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOmJpZ2ludCBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJiaWdpbnRcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoTmF0SGVscGVyID0gRmFyKFwibWF0Y2g6bmF0IGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBkZWNpbWFsRGlnaXRzTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImJpZ2ludFwiLCBjaGVjaykgJiYgY2hlY2soXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzcGVjaW1lbiA+PSAwbixcbiAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIG5vbi1uZWdhdGl2ZWBcbiAgICAgICkgJiYgY2hlY2tEZWNpbWFsRGlnaXRzTGltaXQoc3BlY2ltZW4sIGRlY2ltYWxEaWdpdHNMaW1pdCwgY2hlY2spO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtdKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpuYXQgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IChcbiAgICAgIC8vXG4gICAgICBnZXRQYXNzU3R5bGVDb3ZlcihcImJpZ2ludFwiKVxuICAgIClcbiAgfSk7XG4gIGNvbnN0IG1hdGNoU3RyaW5nSGVscGVyID0gRmFyKFwibWF0Y2g6c3RyaW5nIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBzdHJpbmdMZW5ndGhMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwic3RyaW5nXCIsIGNoZWNrKSAmJiAvL1xuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAoc3BlY2ltZW4ubGVuZ3RoIDw9IHN0cmluZ0xlbmd0aExpbWl0IHx8IGNoZWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgcmVkYWN0ZWRgc3RyaW5nICR7c3BlY2ltZW59IG11c3Qgbm90IGJlIGJpZ2dlciB0aGFuICR7c3RyaW5nTGVuZ3RoTGltaXR9YFxuICAgICAgKSk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW10pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOnN0cmluZyBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJzdHJpbmdcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoU3ltYm9sSGVscGVyID0gRmFyKFwibWF0Y2g6c3ltYm9sIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBzeW1ib2xOYW1lTGVuZ3RoTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICBpZiAoIWNoZWNrS2luZChzcGVjaW1lbiwgXCJzeW1ib2xcIiwgY2hlY2spKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHN5bWJvbE5hbWUgPSBuYW1lRm9yUGFzc2FibGVTeW1ib2woc3BlY2ltZW4pO1xuICAgICAgaWYgKHR5cGVvZiBzeW1ib2xOYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFBhc3NhYmxlIHN5bWJvbCAke3NwZWNpbWVufSBtdXN0IGhhdmUgYSBwYXNzYWJsZSBuYW1lYDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgc3ltYm9sTmFtZS5sZW5ndGggPD0gc3ltYm9sTmFtZUxlbmd0aExpbWl0LFxuICAgICAgICByZWRhY3RlZGBTeW1ib2wgbmFtZSAke3F1b3RlKFxuICAgICAgICAgIHN5bWJvbE5hbWVcbiAgICAgICAgKX0gbXVzdCBub3QgYmUgYmlnZ2VyIHRoYW4gJHtzeW1ib2xOYW1lTGVuZ3RoTGltaXR9YFxuICAgICAgKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6c3ltYm9sIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInN5bWJvbFwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hSZW1vdGFibGVIZWxwZXIgPSBGYXIoXCJtYXRjaDpyZW1vdGFibGUgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcmVtb3RhYmxlRGVzYywgY2hlY2spID0+IHtcbiAgICAgIGlmIChpc0tpbmQoc3BlY2ltZW4sIFwicmVtb3RhYmxlXCIpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKGNoZWNrID09PSBpZGVudENoZWNrZXIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBsYWJlbCB9ID0gcmVtb3RhYmxlRGVzYztcbiAgICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHNwZWNpbWVuKTtcbiAgICAgIGNvbnN0IGtpbmREZXRhaWxzID0gcGFzc1N0eWxlICE9PSBcInRhZ2dlZFwiID8gKFxuICAgICAgICAvL1xuICAgICAgICBiYXJlT3JRdW90ZShwYXNzU3R5bGUpXG4gICAgICApIDogKFxuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICBxdW90ZShnZXRUYWcoc3BlY2ltZW4pKVxuICAgICAgKTtcbiAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSBhIHJlbW90YWJsZSAke2JhcmVPclF1b3RlKGxhYmVsKX0sIG5vdCAke2tpbmREZXRhaWxzfWBcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKGFsbGVnZWRSZW1vdGFibGVEZXNjLCBjaGVjaykgPT4gY2hlY2tNYXRjaGVzMihcbiAgICAgIGFsbGVnZWRSZW1vdGFibGVEZXNjLFxuICAgICAgaGFyZGVuKHsgbGFiZWw6IE1NLnN0cmluZygpIH0pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOnJlbW90YWJsZSBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9yZW1vdGFibGVEZXNjLCBfZW5jb2RlUGFzc2FibGUpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwicmVtb3RhYmxlXCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaExURUhlbHBlciA9IEZhcihcIm1hdGNoOmx0ZSBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCByaWdodE9wZXJhbmQsIGNoZWNrKSA9PiBrZXlMVEUoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCkgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSA8PSAke3JpZ2h0T3BlcmFuZH1gKSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogY2hlY2tLZXksXG4gICAgZ2V0UmFua0NvdmVyOiAocmlnaHRPcGVyYW5kLCBlbmNvZGVQYXNzYWJsZSkgPT4ge1xuICAgICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocmlnaHRPcGVyYW5kKTtcbiAgICAgIGxldCBbbGVmdEJvdW5kLCByaWdodEJvdW5kXSA9IGdldFBhc3NTdHlsZUNvdmVyKHBhc3NTdHlsZSk7XG4gICAgICBjb25zdCBuZXdSaWdodEJvdW5kID0gYCR7ZW5jb2RlUGFzc2FibGUocmlnaHRPcGVyYW5kKX1+YDtcbiAgICAgIGlmIChuZXdSaWdodEJvdW5kICE9PSB2b2lkIDApIHtcbiAgICAgICAgcmlnaHRCb3VuZCA9IG5ld1JpZ2h0Qm91bmQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gW2xlZnRCb3VuZCwgcmlnaHRCb3VuZF07XG4gICAgfVxuICB9KTtcbiAgY29uc3QgbWF0Y2hMVEhlbHBlciA9IEZhcihcIm1hdGNoOmx0IGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCwgY2hlY2spID0+IGtleUxUKHNwZWNpbWVuLCByaWdodE9wZXJhbmQpIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgPCAke3JpZ2h0T3BlcmFuZH1gKSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogY2hlY2tLZXksXG4gICAgZ2V0UmFua0NvdmVyOiBtYXRjaExURUhlbHBlci5nZXRSYW5rQ292ZXJcbiAgfSk7XG4gIGNvbnN0IG1hdGNoR1RFSGVscGVyID0gRmFyKFwibWF0Y2g6Z3RlIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCwgY2hlY2spID0+IGtleUdURShzcGVjaW1lbiwgcmlnaHRPcGVyYW5kKSB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlID49ICR7cmlnaHRPcGVyYW5kfWApLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBjaGVja0tleSxcbiAgICBnZXRSYW5rQ292ZXI6IChyaWdodE9wZXJhbmQsIGVuY29kZVBhc3NhYmxlKSA9PiB7XG4gICAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihyaWdodE9wZXJhbmQpO1xuICAgICAgbGV0IFtsZWZ0Qm91bmQsIHJpZ2h0Qm91bmRdID0gZ2V0UGFzc1N0eWxlQ292ZXIocGFzc1N0eWxlKTtcbiAgICAgIGNvbnN0IG5ld0xlZnRCb3VuZCA9IGVuY29kZVBhc3NhYmxlKHJpZ2h0T3BlcmFuZCk7XG4gICAgICBpZiAobmV3TGVmdEJvdW5kICE9PSB2b2lkIDApIHtcbiAgICAgICAgbGVmdEJvdW5kID0gbmV3TGVmdEJvdW5kO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFtsZWZ0Qm91bmQsIHJpZ2h0Qm91bmRdO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IG1hdGNoR1RIZWxwZXIgPSBGYXIoXCJtYXRjaDpndCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCByaWdodE9wZXJhbmQsIGNoZWNrKSA9PiBrZXlHVChzcGVjaW1lbiwgcmlnaHRPcGVyYW5kKSB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlID4gJHtyaWdodE9wZXJhbmR9YCksXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IGNoZWNrS2V5LFxuICAgIGdldFJhbmtDb3ZlcjogbWF0Y2hHVEVIZWxwZXIuZ2V0UmFua0NvdmVyXG4gIH0pO1xuICBjb25zdCBtYXRjaFJlY29yZE9mSGVscGVyID0gRmFyKFwibWF0Y2g6cmVjb3JkT2YgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2tleVBhdHQsIHZhbHVlUGF0dCwgbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgbnVtUHJvcGVydGllc0xpbWl0LCBwcm9wZXJ0eU5hbWVMZW5ndGhMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiY29weVJlY29yZFwiLCBjaGVjaykgJiYgY2hlY2soXG4gICAgICAgIG93bktleXMxNyhzcGVjaW1lbikubGVuZ3RoIDw9IG51bVByb3BlcnRpZXNMaW1pdCxcbiAgICAgICAgcmVkYWN0ZWRgTXVzdCBub3QgaGF2ZSBtb3JlIHRoYW4gJHtxdW90ZShcbiAgICAgICAgICBudW1Qcm9wZXJ0aWVzTGltaXRcbiAgICAgICAgKX0gcHJvcGVydGllczogJHtzcGVjaW1lbn1gXG4gICAgICApICYmIGVudHJpZXM3KHNwZWNpbWVuKS5ldmVyeShcbiAgICAgICAgKFtrZXksIHZhbHVlXSkgPT4gYXBwbHlMYWJlbGluZ0Vycm9yKFxuICAgICAgICAgIGNoZWNrLFxuICAgICAgICAgIFtcbiAgICAgICAgICAgIGtleS5sZW5ndGggPD0gcHJvcGVydHlOYW1lTGVuZ3RoTGltaXQsXG4gICAgICAgICAgICByZWRhY3RlZGBQcm9wZXJ0eSBuYW1lIG11c3Qgbm90IGJlIGxvbmdlciB0aGFuICR7cXVvdGUoXG4gICAgICAgICAgICAgIHByb3BlcnR5TmFtZUxlbmd0aExpbWl0XG4gICAgICAgICAgICApfWBcbiAgICAgICAgICBdLFxuICAgICAgICAgIGtleVxuICAgICAgICApICYmIGNoZWNrTWF0Y2hlczIoXG4gICAgICAgICAgaGFyZGVuKFtrZXksIHZhbHVlXSksXG4gICAgICAgICAgaGFyZGVuKFtrZXlQYXR0LCB2YWx1ZVBhdHRdKSxcbiAgICAgICAgICBjaGVjayxcbiAgICAgICAgICBrZXlcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbTU0ucGF0dGVybigpLCBNTS5wYXR0ZXJuKCldKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpyZWNvcmRPZiBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9lbnRyeVBhdHQpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwiY29weVJlY29yZFwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hBcnJheU9mSGVscGVyID0gRmFyKFwibWF0Y2g6YXJyYXlPZiBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbc3ViUGF0dCwgbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgYXJyYXlMZW5ndGhMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiY29weUFycmF5XCIsIGNoZWNrKSAmJiAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgKHNwZWNpbWVuLmxlbmd0aCA8PSBhcnJheUxlbmd0aExpbWl0IHx8IGNoZWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgcmVkYWN0ZWRgQXJyYXkgbGVuZ3RoICR7c3BlY2ltZW4ubGVuZ3RofSBtdXN0IGJlIDw9IGxpbWl0ICR7YXJyYXlMZW5ndGhMaW1pdH1gXG4gICAgICApKSAmJiBhcnJheUV2ZXJ5TWF0Y2hQYXR0ZXJuKHNwZWNpbWVuLCBzdWJQYXR0LCBjaGVjayk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKV0pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOmFycmF5T2YgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6ICgpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwiY29weUFycmF5XCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaFNldE9mSGVscGVyID0gRmFyKFwibWF0Y2g6c2V0T2YgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2tleVBhdHQsIGxpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IG51bVNldEVsZW1lbnRzTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlTZXRcIiwgY2hlY2spICYmIGNoZWNrKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLmxlbmd0aCA8IG51bVNldEVsZW1lbnRzTGltaXQsXG4gICAgICAgIHJlZGFjdGVkYFNldCBtdXN0IG5vdCBoYXZlIG1vcmUgdGhhbiAke3F1b3RlKG51bVNldEVsZW1lbnRzTGltaXQpfSBlbGVtZW50czogJHtzcGVjaW1lbi5wYXlsb2FkLmxlbmd0aH1gXG4gICAgICApICYmIGFycmF5RXZlcnlNYXRjaFBhdHRlcm4oc3BlY2ltZW4ucGF5bG9hZCwga2V5UGF0dCwgY2hlY2ssIFwic2V0IGVsZW1lbnRzXCIpO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtNTS5wYXR0ZXJuKCldKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpzZXRPZiBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKCkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJ0YWdnZWRcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoQmFnT2ZIZWxwZXIgPSBGYXIoXCJtYXRjaDpiYWdPZiBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBba2V5UGF0dCwgY291bnRQYXR0LCBsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBudW1VbmlxdWVCYWdFbGVtZW50c0xpbWl0LCBkZWNpbWFsRGlnaXRzTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICByZXR1cm4gY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlCYWdcIiwgY2hlY2spICYmIGNoZWNrKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLmxlbmd0aCA8PSBudW1VbmlxdWVCYWdFbGVtZW50c0xpbWl0LFxuICAgICAgICByZWRhY3RlZGBCYWcgbXVzdCBub3QgaGF2ZSBtb3JlIHRoYW4gJHtxdW90ZShcbiAgICAgICAgICBudW1VbmlxdWVCYWdFbGVtZW50c0xpbWl0XG4gICAgICAgICl9IHVuaXF1ZSBlbGVtZW50czogJHtzcGVjaW1lbn1gXG4gICAgICApICYmIHNwZWNpbWVuLnBheWxvYWQuZXZlcnkoXG4gICAgICAgIChba2V5LCBjb3VudF0sIGkyKSA9PiBjaGVja01hdGNoZXMyKGtleSwga2V5UGF0dCwgY2hlY2ssIGBiYWcga2V5c1ske2kyfV1gKSAmJiBhcHBseUxhYmVsaW5nRXJyb3IoXG4gICAgICAgICAgY2hlY2tEZWNpbWFsRGlnaXRzTGltaXQsXG4gICAgICAgICAgW2NvdW50LCBkZWNpbWFsRGlnaXRzTGltaXQsIGNoZWNrXSxcbiAgICAgICAgICBgYmFnIGNvdW50c1ske2kyfV1gXG4gICAgICAgICkgJiYgY2hlY2tNYXRjaGVzMihjb3VudCwgY291bnRQYXR0LCBjaGVjaywgYGJhZyBjb3VudHNbJHtpMn1dYClcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0ucGF0dGVybigpXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6YmFnT2YgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6ICgpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwidGFnZ2VkXCIpXG4gIH0pO1xuICBjb25zdCBlbGVtZW50c0hhc1NwbGl0ID0gKGVsZW1lbnRzLCBlbGVtZW50UGF0dCwgYm91bmQsIGluUmVzdWx0cyA9IHZvaWQgMCwgb3V0UmVzdWx0cyA9IHZvaWQgMCwgY2hlY2sgPSBpZGVudENoZWNrZXIpID0+IHtcbiAgICBsZXQgY291bnQgPSAwbjtcbiAgICBmb3IgKGxldCBpMiA9IGVsZW1lbnRzLmxlbmd0aCAtIDE7IGkyID49IDA7IGkyIC09IDEpIHtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBlbGVtZW50c1tpMl07XG4gICAgICBpZiAoY291bnQgPCBib3VuZCkge1xuICAgICAgICBpZiAobWF0Y2hlczIoZWxlbWVudCwgZWxlbWVudFBhdHQpKSB7XG4gICAgICAgICAgY291bnQgKz0gMW47XG4gICAgICAgICAgaWYgKGluUmVzdWx0cykgaW5SZXN1bHRzLnB1c2goZWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAob3V0UmVzdWx0cykge1xuICAgICAgICAgIG91dFJlc3VsdHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChvdXRSZXN1bHRzID09PSB2b2lkIDApIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvdXRSZXN1bHRzLnB1c2goZWxlbWVudCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjaGVjayhcbiAgICAgIGNvdW50ID49IGJvdW5kLFxuICAgICAgcmVkYWN0ZWRgSGFzIG9ubHkgJHtxdW90ZShjb3VudCl9IG1hdGNoZXMsIGJ1dCBuZWVkcyAke3F1b3RlKGJvdW5kKX1gXG4gICAgKTtcbiAgfTtcbiAgY29uc3QgcGFpcnNIYXNTcGxpdCA9IChwYWlycywgZWxlbWVudFBhdHQsIGJvdW5kLCBpblJlc3VsdHMgPSB2b2lkIDAsIG91dFJlc3VsdHMgPSB2b2lkIDAsIGNoZWNrID0gaWRlbnRDaGVja2VyKSA9PiB7XG4gICAgbGV0IGNvdW50ID0gMG47XG4gICAgZm9yIChsZXQgaTIgPSBwYWlycy5sZW5ndGggLSAxOyBpMiA+PSAwOyBpMiAtPSAxKSB7XG4gICAgICBjb25zdCBbZWxlbWVudCwgbnVtXSA9IHBhaXJzW2kyXTtcbiAgICAgIGNvbnN0IG51bVJlc3QgPSBib3VuZCAtIGNvdW50O1xuICAgICAgaWYgKG51bVJlc3QgPj0gMW4pIHtcbiAgICAgICAgaWYgKG1hdGNoZXMyKGVsZW1lbnQsIGVsZW1lbnRQYXR0KSkge1xuICAgICAgICAgIGlmIChudW0gPD0gbnVtUmVzdCkge1xuICAgICAgICAgICAgY291bnQgKz0gbnVtO1xuICAgICAgICAgICAgaWYgKGluUmVzdWx0cykgaW5SZXN1bHRzLnB1c2goW2VsZW1lbnQsIG51bV0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBudW1JbiA9IG51bVJlc3Q7XG4gICAgICAgICAgICBjb3VudCArPSBudW1JbjtcbiAgICAgICAgICAgIGlmIChpblJlc3VsdHMpIGluUmVzdWx0cy5wdXNoKFtlbGVtZW50LCBudW1SZXN0XSk7XG4gICAgICAgICAgICBpZiAob3V0UmVzdWx0cykgb3V0UmVzdWx0cy5wdXNoKFtlbGVtZW50LCBudW0gLSBudW1SZXN0XSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKG91dFJlc3VsdHMpIHtcbiAgICAgICAgICBvdXRSZXN1bHRzLnB1c2goW2VsZW1lbnQsIG51bV0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKG91dFJlc3VsdHMgPT09IHZvaWQgMCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG91dFJlc3VsdHMucHVzaChbZWxlbWVudCwgbnVtXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjaGVjayhcbiAgICAgIGNvdW50ID49IGJvdW5kLFxuICAgICAgcmVkYWN0ZWRgSGFzIG9ubHkgJHtxdW90ZShjb3VudCl9IG1hdGNoZXMsIGJ1dCBuZWVkcyAke3F1b3RlKGJvdW5kKX1gXG4gICAgKTtcbiAgfTtcbiAgY29uc3QgY29udGFpbmVySGFzU3BsaXQyID0gKHNwZWNpbWVuLCBlbGVtZW50UGF0dCwgYm91bmQsIG5lZWRJblJlc3VsdHMgPSBmYWxzZSwgbmVlZE91dFJlc3VsdHMgPSBmYWxzZSwgY2hlY2sgPSBpZGVudENoZWNrZXIpID0+IHtcbiAgICBjb25zdCBpblJlc3VsdHMgPSBuZWVkSW5SZXN1bHRzID8gW10gOiB2b2lkIDA7XG4gICAgY29uc3Qgb3V0UmVzdWx0cyA9IG5lZWRPdXRSZXN1bHRzID8gW10gOiB2b2lkIDA7XG4gICAgY29uc3Qga2luZDIgPSBraW5kT2YyKHNwZWNpbWVuKTtcbiAgICBzd2l0Y2ggKGtpbmQyKSB7XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgaWYgKCFlbGVtZW50c0hhc1NwbGl0KFxuICAgICAgICAgIHNwZWNpbWVuLFxuICAgICAgICAgIGVsZW1lbnRQYXR0LFxuICAgICAgICAgIGJvdW5kLFxuICAgICAgICAgIGluUmVzdWx0cyxcbiAgICAgICAgICBvdXRSZXN1bHRzLFxuICAgICAgICAgIGNoZWNrXG4gICAgICAgICkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtpblJlc3VsdHMsIG91dFJlc3VsdHNdO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlTZXRcIjoge1xuICAgICAgICBpZiAoIWVsZW1lbnRzSGFzU3BsaXQoXG4gICAgICAgICAgc3BlY2ltZW4ucGF5bG9hZCxcbiAgICAgICAgICBlbGVtZW50UGF0dCxcbiAgICAgICAgICBib3VuZCxcbiAgICAgICAgICBpblJlc3VsdHMsXG4gICAgICAgICAgb3V0UmVzdWx0cyxcbiAgICAgICAgICBjaGVja1xuICAgICAgICApKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgaW5SZXN1bHRzICYmIG1ha2VDb3B5U2V0KGluUmVzdWx0cyksXG4gICAgICAgICAgb3V0UmVzdWx0cyAmJiBtYWtlQ29weVNldChvdXRSZXN1bHRzKVxuICAgICAgICBdO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlCYWdcIjoge1xuICAgICAgICBpZiAoIXBhaXJzSGFzU3BsaXQoXG4gICAgICAgICAgc3BlY2ltZW4ucGF5bG9hZCxcbiAgICAgICAgICBlbGVtZW50UGF0dCxcbiAgICAgICAgICBib3VuZCxcbiAgICAgICAgICBpblJlc3VsdHMsXG4gICAgICAgICAgb3V0UmVzdWx0cyxcbiAgICAgICAgICBjaGVja1xuICAgICAgICApKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgaW5SZXN1bHRzICYmIG1ha2VDb3B5QmFnKGluUmVzdWx0cyksXG4gICAgICAgICAgb3V0UmVzdWx0cyAmJiBtYWtlQ29weUJhZyhvdXRSZXN1bHRzKVxuICAgICAgICBdO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYHVuZXhwZWN0ZWQgJHtxdW90ZShraW5kMil9YCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBtYXRjaENvbnRhaW5lckhhc0hlbHBlciA9IEZhcihcIk0uY29udGFpbmVySGFzIGhlbHBlclwiLCB7XG4gICAgLypcblxuXG5cbiAgICAgKi9cbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2VsZW1lbnRQYXR0LCBib3VuZCwgbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IGtpbmQyID0ga2luZE9mMihzcGVjaW1lbiwgY2hlY2spO1xuICAgICAgY29uc3QgeyBkZWNpbWFsRGlnaXRzTGltaXQgfSA9IGxpbWl0KGxpbWl0cyk7XG4gICAgICBpZiAoIWFwcGx5TGFiZWxpbmdFcnJvcihcbiAgICAgICAgY2hlY2tEZWNpbWFsRGlnaXRzTGltaXQsXG4gICAgICAgIFtib3VuZCwgZGVjaW1hbERpZ2l0c0xpbWl0LCBjaGVja10sXG4gICAgICAgIGAke2tpbmQyfSBtYXRjaGVzYFxuICAgICAgKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gISFjb250YWluZXJIYXNTcGxpdDIoXG4gICAgICAgIHNwZWNpbWVuLFxuICAgICAgICBlbGVtZW50UGF0dCxcbiAgICAgICAgYm91bmQsXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgY2hlY2tcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0uZ3RlKDFuKV0pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIk0uY29udGFpbmVySGFzIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInRhZ2dlZFwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hNYXBPZkhlbHBlciA9IEZhcihcIm1hdGNoOm1hcE9mIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtrZXlQYXR0LCB2YWx1ZVBhdHQsIGxpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IG51bU1hcEVudHJpZXNMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiY29weU1hcFwiLCBjaGVjaykgJiYgY2hlY2soXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNwZWNpbWVuLnBheWxvYWQua2V5cy5sZW5ndGggPD0gbnVtTWFwRW50cmllc0xpbWl0LFxuICAgICAgICByZWRhY3RlZGBDb3B5TWFwIG11c3QgaGF2ZSBubyBtb3JlIHRoYW4gJHtxdW90ZShcbiAgICAgICAgICBudW1NYXBFbnRyaWVzTGltaXRcbiAgICAgICAgKX0gZW50cmllczogJHtzcGVjaW1lbn1gXG4gICAgICApICYmIGFycmF5RXZlcnlNYXRjaFBhdHRlcm4oXG4gICAgICAgIHNwZWNpbWVuLnBheWxvYWQua2V5cyxcbiAgICAgICAga2V5UGF0dCxcbiAgICAgICAgY2hlY2ssXG4gICAgICAgIFwibWFwIGtleXNcIlxuICAgICAgKSAmJiBhcnJheUV2ZXJ5TWF0Y2hQYXR0ZXJuKFxuICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLnZhbHVlcyxcbiAgICAgICAgdmFsdWVQYXR0LFxuICAgICAgICBjaGVjayxcbiAgICAgICAgXCJtYXAgdmFsdWVzXCJcbiAgICAgICk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKSwgTU0ucGF0dGVybigpXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6bWFwT2YgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfZW50cnlQYXR0KSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInRhZ2dlZFwiKVxuICB9KTtcbiAgY29uc3Qgc3BsaXRBcnJheVBhcnRzID0gKHNwZWNpbWVuLCByZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCkgPT4ge1xuICAgIGNvbnN0IG51bVJlcXVpcmVkID0gcmVxdWlyZWRQYXR0Lmxlbmd0aDtcbiAgICBjb25zdCBudW1PcHRpb25hbCA9IG9wdGlvbmFsUGF0dC5sZW5ndGg7XG4gICAgY29uc3QgcmVxdWlyZWRTcGVjaW1lbiA9IHNwZWNpbWVuLnNsaWNlKDAsIG51bVJlcXVpcmVkKTtcbiAgICBjb25zdCBvcHRpb25hbFNwZWNpbWVuID0gc3BlY2ltZW4uc2xpY2UoXG4gICAgICBudW1SZXF1aXJlZCxcbiAgICAgIG51bVJlcXVpcmVkICsgbnVtT3B0aW9uYWxcbiAgICApO1xuICAgIGNvbnN0IHJlc3RTcGVjaW1lbiA9IHNwZWNpbWVuLnNsaWNlKG51bVJlcXVpcmVkICsgbnVtT3B0aW9uYWwpO1xuICAgIHJldHVybiBoYXJkZW4oeyByZXF1aXJlZFNwZWNpbWVuLCBvcHRpb25hbFNwZWNpbWVuLCByZXN0U3BlY2ltZW4gfSk7XG4gIH07XG4gIGNvbnN0IGFkYXB0QXJyYXlQYXR0ZXJuID0gKG9wdGlvbmFsUGF0dCwgbGVuZ3RoKSA9PiBoYXJkZW4ob3B0aW9uYWxQYXR0LnNsaWNlKDAsIGxlbmd0aCkubWFwKChwYXR0KSA9PiBNTS5vcHQocGF0dCkpKTtcbiAgY29uc3QgbWF0Y2hTcGxpdEFycmF5SGVscGVyID0gRmFyKFwibWF0Y2g6c3BsaXRBcnJheSBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQgPSBbXSwgcmVzdFBhdHQgPSBNTS5hbnkoKV0sIGNoZWNrKSA9PiB7XG4gICAgICBpZiAoIWNoZWNrS2luZChzcGVjaW1lbiwgXCJjb3B5QXJyYXlcIiwgY2hlY2spKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgcmVxdWlyZWRTcGVjaW1lbiwgb3B0aW9uYWxTcGVjaW1lbiwgcmVzdFNwZWNpbWVuIH0gPSBzcGxpdEFycmF5UGFydHMoc3BlY2ltZW4sIHJlcXVpcmVkUGF0dCwgb3B0aW9uYWxQYXR0KTtcbiAgICAgIGNvbnN0IHBhcnRpYWxQYXR0ID0gYWRhcHRBcnJheVBhdHRlcm4oXG4gICAgICAgIG9wdGlvbmFsUGF0dCxcbiAgICAgICAgb3B0aW9uYWxTcGVjaW1lbi5sZW5ndGhcbiAgICAgICk7XG4gICAgICBsZXQgYXJnTnVtID0gMDtcbiAgICAgIHJldHVybiAocmVxdWlyZWRTcGVjaW1lbi5sZW5ndGggPT09IHJlcXVpcmVkUGF0dC5sZW5ndGggfHwgY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICByZWRhY3RlZGBFeHBlY3RlZCBhdCBsZWFzdCAke3F1b3RlKFxuICAgICAgICAgIHJlcXVpcmVkUGF0dC5sZW5ndGhcbiAgICAgICAgKX0gYXJndW1lbnRzOiAke3NwZWNpbWVufWBcbiAgICAgICkpICYmIHJlcXVpcmVkUGF0dC5ldmVyeShcbiAgICAgICAgKHAzLCBpMikgPT4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY2hlY2tNYXRjaGVzMihyZXF1aXJlZFNwZWNpbWVuW2kyXSwgcDMsIGNoZWNrLCBgYXJnICR7YXJnTnVtKyt9YClcbiAgICAgICAgKVxuICAgICAgKSAmJiBwYXJ0aWFsUGF0dC5ldmVyeShcbiAgICAgICAgKHAzLCBpMikgPT4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY2hlY2tNYXRjaGVzMihvcHRpb25hbFNwZWNpbWVuW2kyXSwgcDMsIGNoZWNrLCBgYXJnICR7YXJnTnVtKyt9P2ApXG4gICAgICAgIClcbiAgICAgICkgJiYgY2hlY2tNYXRjaGVzMihyZXN0U3BlY2ltZW4sIHJlc3RQYXR0LCBjaGVjaywgXCIuLi5yZXN0XCIpO1xuICAgIH0sXG4gICAgLypcblxuXG4gICAgICovXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChzcGxpdEFycmF5LCBjaGVjaykgPT4ge1xuICAgICAgaWYgKHBhc3NTdHlsZU9mKHNwbGl0QXJyYXkpID09PSBcImNvcHlBcnJheVwiICYmIChzcGxpdEFycmF5Lmxlbmd0aCA+PSAxIHx8IHNwbGl0QXJyYXkubGVuZ3RoIDw9IDMpKSB7XG4gICAgICAgIGNvbnN0IFtyZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCA9IHZvaWQgMCwgcmVzdFBhdHQgPSB2b2lkIDBdID0gc3BsaXRBcnJheTtcbiAgICAgICAgaWYgKGlzUGF0dGVybjIocmVxdWlyZWRQYXR0KSAmJiBwYXNzU3R5bGVPZihyZXF1aXJlZFBhdHQpID09PSBcImNvcHlBcnJheVwiICYmIChvcHRpb25hbFBhdHQgPT09IHZvaWQgMCB8fCBpc1BhdHRlcm4yKG9wdGlvbmFsUGF0dCkgJiYgcGFzc1N0eWxlT2Yob3B0aW9uYWxQYXR0KSA9PT0gXCJjb3B5QXJyYXlcIikgJiYgKHJlc3RQYXR0ID09PSB2b2lkIDAgfHwgaXNQYXR0ZXJuMihyZXN0UGF0dCkpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYE11c3QgYmUgYW4gYXJyYXkgb2YgYSByZXF1aXJlZFBhdHQgYXJyYXksIGFuIG9wdGlvbmFsIG9wdGlvbmFsUGF0dCBhcnJheSwgYW5kIGFuIG9wdGlvbmFsIHJlc3RQYXR0OiAke3F1b3RlKFxuICAgICAgICAgIHNwbGl0QXJyYXlcbiAgICAgICAgKX1gXG4gICAgICApO1xuICAgIH0sXG4gICAgZ2V0UmFua0NvdmVyOiAoW1xuICAgICAgX3JlcXVpcmVkUGF0dCxcbiAgICAgIF9vcHRpb25hbFBhdHQgPSB2b2lkIDAsXG4gICAgICBfcmVzdFBhdHQgPSB2b2lkIDBcbiAgICBdKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcImNvcHlBcnJheVwiKVxuICB9KTtcbiAgY29uc3Qgc3BsaXRSZWNvcmRQYXJ0cyA9IChzcGVjaW1lbiwgcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQpID0+IHtcbiAgICBjb25zdCByZXF1aXJlZEVudHJpZXMgPSBbXTtcbiAgICBjb25zdCBvcHRpb25hbEVudHJpZXMgPSBbXTtcbiAgICBjb25zdCByZXN0RW50cmllcyA9IFtdO1xuICAgIGZvciAoY29uc3QgW25hbWUsIHZhbHVlXSBvZiBlbnRyaWVzNyhzcGVjaW1lbikpIHtcbiAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eU9mKHJlcXVpcmVkUGF0dCwgbmFtZSkpIHtcbiAgICAgICAgcmVxdWlyZWRFbnRyaWVzLnB1c2goW25hbWUsIHZhbHVlXSk7XG4gICAgICB9IGVsc2UgaWYgKGhhc093blByb3BlcnR5T2Yob3B0aW9uYWxQYXR0LCBuYW1lKSkge1xuICAgICAgICBvcHRpb25hbEVudHJpZXMucHVzaChbbmFtZSwgdmFsdWVdKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3RFbnRyaWVzLnB1c2goW25hbWUsIHZhbHVlXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgcmVxdWlyZWRTcGVjaW1lbjogZnJvbVVuaXF1ZUVudHJpZXMocmVxdWlyZWRFbnRyaWVzKSxcbiAgICAgIG9wdGlvbmFsU3BlY2ltZW46IGZyb21VbmlxdWVFbnRyaWVzKG9wdGlvbmFsRW50cmllcyksXG4gICAgICByZXN0U3BlY2ltZW46IGZyb21VbmlxdWVFbnRyaWVzKHJlc3RFbnRyaWVzKVxuICAgIH0pO1xuICB9O1xuICBjb25zdCBhZGFwdFJlY29yZFBhdHRlcm4gPSAob3B0aW9uYWxQYXR0LCBuYW1lcykgPT4gZnJvbVVuaXF1ZUVudHJpZXMobmFtZXMubWFwKChuYW1lKSA9PiBbbmFtZSwgTU0ub3B0KG9wdGlvbmFsUGF0dFtuYW1lXSldKSk7XG4gIGNvbnN0IG1hdGNoU3BsaXRSZWNvcmRIZWxwZXIgPSBGYXIoXCJtYXRjaDpzcGxpdFJlY29yZCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQgPSB7fSwgcmVzdFBhdHQgPSBNTS5hbnkoKV0sIGNoZWNrKSA9PiB7XG4gICAgICBpZiAoIWNoZWNrS2luZChzcGVjaW1lbiwgXCJjb3B5UmVjb3JkXCIsIGNoZWNrKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25zdCB7IHJlcXVpcmVkU3BlY2ltZW4sIG9wdGlvbmFsU3BlY2ltZW4sIHJlc3RTcGVjaW1lbiB9ID0gc3BsaXRSZWNvcmRQYXJ0cyhzcGVjaW1lbiwgcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQpO1xuICAgICAgY29uc3QgcGFydGlhbE5hbWVzID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvd25LZXlzMTcob3B0aW9uYWxTcGVjaW1lbilcbiAgICAgICk7XG4gICAgICBjb25zdCBwYXJ0aWFsUGF0dCA9IGFkYXB0UmVjb3JkUGF0dGVybihvcHRpb25hbFBhdHQsIHBhcnRpYWxOYW1lcyk7XG4gICAgICByZXR1cm4gY2hlY2tNYXRjaGVzMihyZXF1aXJlZFNwZWNpbWVuLCByZXF1aXJlZFBhdHQsIGNoZWNrKSAmJiBwYXJ0aWFsTmFtZXMuZXZlcnkoXG4gICAgICAgIChuYW1lKSA9PiBjaGVja01hdGNoZXMyKFxuICAgICAgICAgIG9wdGlvbmFsU3BlY2ltZW5bbmFtZV0sXG4gICAgICAgICAgcGFydGlhbFBhdHRbbmFtZV0sXG4gICAgICAgICAgY2hlY2ssXG4gICAgICAgICAgYCR7bmFtZX0/YFxuICAgICAgICApXG4gICAgICApICYmIGNoZWNrTWF0Y2hlczIocmVzdFNwZWNpbWVuLCByZXN0UGF0dCwgY2hlY2ssIFwiLi4ucmVzdFwiKTtcbiAgICB9LFxuICAgIC8qXG5cblxuICAgICAqL1xuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAoc3BsaXRBcnJheSwgY2hlY2spID0+IHtcbiAgICAgIGlmIChwYXNzU3R5bGVPZihzcGxpdEFycmF5KSA9PT0gXCJjb3B5QXJyYXlcIiAmJiAoc3BsaXRBcnJheS5sZW5ndGggPj0gMSB8fCBzcGxpdEFycmF5Lmxlbmd0aCA8PSAzKSkge1xuICAgICAgICBjb25zdCBbcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQgPSB2b2lkIDAsIHJlc3RQYXR0ID0gdm9pZCAwXSA9IHNwbGl0QXJyYXk7XG4gICAgICAgIGlmIChpc1BhdHRlcm4yKHJlcXVpcmVkUGF0dCkgJiYgcGFzc1N0eWxlT2YocmVxdWlyZWRQYXR0KSA9PT0gXCJjb3B5UmVjb3JkXCIgJiYgKG9wdGlvbmFsUGF0dCA9PT0gdm9pZCAwIHx8IGlzUGF0dGVybjIob3B0aW9uYWxQYXR0KSAmJiBwYXNzU3R5bGVPZihvcHRpb25hbFBhdHQpID09PSBcImNvcHlSZWNvcmRcIikgJiYgKHJlc3RQYXR0ID09PSB2b2lkIDAgfHwgaXNQYXR0ZXJuMihyZXN0UGF0dCkpKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYE11c3QgYmUgYW4gYXJyYXkgb2YgYSByZXF1aXJlZFBhdHQgcmVjb3JkLCBhbiBvcHRpb25hbCBvcHRpb25hbFBhdHQgcmVjb3JkLCBhbmQgYW4gb3B0aW9uYWwgcmVzdFBhdHQ6ICR7cXVvdGUoXG4gICAgICAgICAgc3BsaXRBcnJheVxuICAgICAgICApfWBcbiAgICAgICk7XG4gICAgfSxcbiAgICBnZXRSYW5rQ292ZXI6IChbXG4gICAgICByZXF1aXJlZFBhdHQsXG4gICAgICBfb3B0aW9uYWxQYXR0ID0gdm9pZCAwLFxuICAgICAgX3Jlc3RQYXR0ID0gdm9pZCAwXG4gICAgXSkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIocGFzc1N0eWxlT2YocmVxdWlyZWRQYXR0KSlcbiAgfSk7XG4gIGNvbnN0IEhlbHBlcnNCeU1hdGNoVGFnID0gaGFyZGVuKHtcbiAgICBcIm1hdGNoOmFueVwiOiBtYXRjaEFueUhlbHBlcixcbiAgICBcIm1hdGNoOmFuZFwiOiBtYXRjaEFuZEhlbHBlcixcbiAgICBcIm1hdGNoOm9yXCI6IG1hdGNoT3JIZWxwZXIsXG4gICAgXCJtYXRjaDpub3RcIjogbWF0Y2hOb3RIZWxwZXIsXG4gICAgXCJtYXRjaDpzY2FsYXJcIjogbWF0Y2hTY2FsYXJIZWxwZXIsXG4gICAgXCJtYXRjaDprZXlcIjogbWF0Y2hLZXlIZWxwZXIsXG4gICAgXCJtYXRjaDpwYXR0ZXJuXCI6IG1hdGNoUGF0dGVybkhlbHBlcixcbiAgICBcIm1hdGNoOmtpbmRcIjogbWF0Y2hLaW5kSGVscGVyLFxuICAgIFwibWF0Y2g6dGFnZ2VkXCI6IG1hdGNoVGFnZ2VkSGVscGVyLFxuICAgIFwibWF0Y2g6YmlnaW50XCI6IG1hdGNoQmlnaW50SGVscGVyLFxuICAgIFwibWF0Y2g6bmF0XCI6IG1hdGNoTmF0SGVscGVyLFxuICAgIFwibWF0Y2g6c3RyaW5nXCI6IG1hdGNoU3RyaW5nSGVscGVyLFxuICAgIFwibWF0Y2g6c3ltYm9sXCI6IG1hdGNoU3ltYm9sSGVscGVyLFxuICAgIFwibWF0Y2g6cmVtb3RhYmxlXCI6IG1hdGNoUmVtb3RhYmxlSGVscGVyLFxuICAgIFwibWF0Y2g6bHRcIjogbWF0Y2hMVEhlbHBlcixcbiAgICBcIm1hdGNoOmx0ZVwiOiBtYXRjaExURUhlbHBlcixcbiAgICBcIm1hdGNoOmd0ZVwiOiBtYXRjaEdURUhlbHBlcixcbiAgICBcIm1hdGNoOmd0XCI6IG1hdGNoR1RIZWxwZXIsXG4gICAgXCJtYXRjaDphcnJheU9mXCI6IG1hdGNoQXJyYXlPZkhlbHBlcixcbiAgICBcIm1hdGNoOnJlY29yZE9mXCI6IG1hdGNoUmVjb3JkT2ZIZWxwZXIsXG4gICAgXCJtYXRjaDpzZXRPZlwiOiBtYXRjaFNldE9mSGVscGVyLFxuICAgIFwibWF0Y2g6YmFnT2ZcIjogbWF0Y2hCYWdPZkhlbHBlcixcbiAgICBcIm1hdGNoOmNvbnRhaW5lckhhc1wiOiBtYXRjaENvbnRhaW5lckhhc0hlbHBlcixcbiAgICBcIm1hdGNoOm1hcE9mXCI6IG1hdGNoTWFwT2ZIZWxwZXIsXG4gICAgXCJtYXRjaDpzcGxpdEFycmF5XCI6IG1hdGNoU3BsaXRBcnJheUhlbHBlcixcbiAgICBcIm1hdGNoOnNwbGl0UmVjb3JkXCI6IG1hdGNoU3BsaXRSZWNvcmRIZWxwZXJcbiAgfSk7XG4gIGNvbnN0IG1ha2VNYXRjaGVyID0gKHRhZywgcGF5bG9hZCkgPT4ge1xuICAgIGNvbnN0IG1hdGNoZXIgPSBtYWtlVGFnZ2VkKHRhZywgcGF5bG9hZCk7XG4gICAgYXNzZXJ0UGF0dGVybjIobWF0Y2hlcik7XG4gICAgcmV0dXJuIG1hdGNoZXI7XG4gIH07XG4gIGNvbnN0IG1ha2VLaW5kTWF0Y2hlciA9IChraW5kMikgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpraW5kXCIsIGtpbmQyKTtcbiAgY29uc3QgQW55U2hhcGUgPSBtYWtlTWF0Y2hlcihcIm1hdGNoOmFueVwiLCB2b2lkIDApO1xuICBjb25zdCBTY2FsYXJTaGFwZSA9IG1ha2VNYXRjaGVyKFwibWF0Y2g6c2NhbGFyXCIsIHZvaWQgMCk7XG4gIGNvbnN0IEtleVNoYXBlID0gbWFrZU1hdGNoZXIoXCJtYXRjaDprZXlcIiwgdm9pZCAwKTtcbiAgY29uc3QgUGF0dGVyblNoYXBlID0gbWFrZU1hdGNoZXIoXCJtYXRjaDpwYXR0ZXJuXCIsIHZvaWQgMCk7XG4gIGNvbnN0IEJvb2xlYW5TaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcImJvb2xlYW5cIik7XG4gIGNvbnN0IE51bWJlclNoYXBlID0gbWFrZUtpbmRNYXRjaGVyKFwibnVtYmVyXCIpO1xuICBjb25zdCBCaWdJbnRTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpiaWdpbnRcIiwgW10pO1xuICBjb25zdCBOYXRTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpuYXRcIiwgW10pO1xuICBjb25zdCBTdHJpbmdTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpzdHJpbmdcIiwgW10pO1xuICBjb25zdCBTeW1ib2xTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpzeW1ib2xcIiwgW10pO1xuICBjb25zdCBSZWNvcmRTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpyZWNvcmRPZlwiLCBbQW55U2hhcGUsIEFueVNoYXBlXSk7XG4gIGNvbnN0IEFycmF5U2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6YXJyYXlPZlwiLCBbQW55U2hhcGVdKTtcbiAgY29uc3QgU2V0U2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6c2V0T2ZcIiwgW0FueVNoYXBlXSk7XG4gIGNvbnN0IEJhZ1NoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOmJhZ09mXCIsIFtBbnlTaGFwZSwgQW55U2hhcGVdKTtcbiAgY29uc3QgTWFwU2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6bWFwT2ZcIiwgW0FueVNoYXBlLCBBbnlTaGFwZV0pO1xuICBjb25zdCBSZW1vdGFibGVTaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcInJlbW90YWJsZVwiKTtcbiAgY29uc3QgRXJyb3JTaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcImVycm9yXCIpO1xuICBjb25zdCBQcm9taXNlU2hhcGUgPSBtYWtlS2luZE1hdGNoZXIoXCJwcm9taXNlXCIpO1xuICBjb25zdCBVbmRlZmluZWRTaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcInVuZGVmaW5lZFwiKTtcbiAgY29uc3QgbWFrZUxpbWl0c01hdGNoZXIgPSAodGFnLCBwYXlsb2FkKSA9PiB7XG4gICAgaWYgKHBheWxvYWRbcGF5bG9hZC5sZW5ndGggLSAxXSA9PT0gdm9pZCAwKSB7XG4gICAgICBwYXlsb2FkID0gaGFyZGVuKHBheWxvYWQuc2xpY2UoMCwgcGF5bG9hZC5sZW5ndGggLSAxKSk7XG4gICAgfVxuICAgIHJldHVybiBtYWtlTWF0Y2hlcih0YWcsIHBheWxvYWQpO1xuICB9O1xuICBjb25zdCBtYWtlUmVtb3RhYmxlTWF0Y2hlciA9IChsYWJlbCA9IHZvaWQgMCkgPT4gbGFiZWwgPT09IHZvaWQgMCA/IFJlbW90YWJsZVNoYXBlIDogbWFrZU1hdGNoZXIoXCJtYXRjaDpyZW1vdGFibGVcIiwgaGFyZGVuKHsgbGFiZWwgfSkpO1xuICBjb25zdCBtYWtlU3BsaXRQYXlsb2FkID0gKGVtcHR5NSwgYmFzZTIsIG9wdGlvbmFsID0gdm9pZCAwLCByZXN0ID0gdm9pZCAwKSA9PiB7XG4gICAgaWYgKHJlc3QpIHtcbiAgICAgIHJldHVybiBbYmFzZTIsIG9wdGlvbmFsIHx8IGVtcHR5NSwgcmVzdF07XG4gICAgfVxuICAgIGlmIChvcHRpb25hbCkge1xuICAgICAgcmV0dXJuIFtiYXNlMiwgb3B0aW9uYWxdO1xuICAgIH1cbiAgICByZXR1cm4gW2Jhc2UyXTtcbiAgfTtcbiAgY29uc3QgTTMgPSBoYXJkZW4oe1xuICAgIGFueTogKCkgPT4gQW55U2hhcGUsXG4gICAgYW5kOiAoLi4ucGF0dHMpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6YW5kXCIsIHBhdHRzKSxcbiAgICBvcjogKC4uLnBhdHRzKSA9PiBtYWtlTWF0Y2hlcihcIm1hdGNoOm9yXCIsIHBhdHRzKSxcbiAgICBub3Q6IChzdWJQYXR0KSA9PiBtYWtlTWF0Y2hlcihcIm1hdGNoOm5vdFwiLCBzdWJQYXR0KSxcbiAgICBzY2FsYXI6ICgpID0+IFNjYWxhclNoYXBlLFxuICAgIGtleTogKCkgPT4gS2V5U2hhcGUsXG4gICAgcGF0dGVybjogKCkgPT4gUGF0dGVyblNoYXBlLFxuICAgIGtpbmQ6IG1ha2VLaW5kTWF0Y2hlcixcbiAgICB0YWdnZWQ6ICh0YWdQYXR0ID0gTTMuc3RyaW5nKCksIHBheWxvYWRQYXR0ID0gTTMuYW55KCkpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6dGFnZ2VkXCIsIGhhcmRlbihbdGFnUGF0dCwgcGF5bG9hZFBhdHRdKSksXG4gICAgYm9vbGVhbjogKCkgPT4gQm9vbGVhblNoYXBlLFxuICAgIG51bWJlcjogKCkgPT4gTnVtYmVyU2hhcGUsXG4gICAgYmlnaW50OiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOmJpZ2ludFwiLCBbbGltaXRzXSkgOiBCaWdJbnRTaGFwZSxcbiAgICBuYXQ6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6bmF0XCIsIFtsaW1pdHNdKSA6IE5hdFNoYXBlLFxuICAgIHN0cmluZzogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpzdHJpbmdcIiwgW2xpbWl0c10pIDogU3RyaW5nU2hhcGUsXG4gICAgc3ltYm9sOiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnN5bWJvbFwiLCBbbGltaXRzXSkgOiBTeW1ib2xTaGFwZSxcbiAgICByZWNvcmQ6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IE0zLnJlY29yZE9mKE0zLmFueSgpLCBNMy5hbnkoKSwgbGltaXRzKSA6IFJlY29yZFNoYXBlLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgYXJyYXk6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IE0zLmFycmF5T2YoTTMuYW55KCksIGxpbWl0cykgOiBBcnJheVNoYXBlLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIHNldDogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gTTMuc2V0T2YoTTMuYW55KCksIGxpbWl0cykgOiBTZXRTaGFwZSxcbiAgICBiYWc6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IE0zLmJhZ09mKE0zLmFueSgpLCBNMy5hbnkoKSwgbGltaXRzKSA6IEJhZ1NoYXBlLFxuICAgIG1hcDogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gTTMubWFwT2YoTTMuYW55KCksIE0zLmFueSgpLCBsaW1pdHMpIDogTWFwU2hhcGUsXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICByZW1vdGFibGU6IG1ha2VSZW1vdGFibGVNYXRjaGVyLFxuICAgIGVycm9yOiAoKSA9PiBFcnJvclNoYXBlLFxuICAgIHByb21pc2U6ICgpID0+IFByb21pc2VTaGFwZSxcbiAgICB1bmRlZmluZWQ6ICgpID0+IFVuZGVmaW5lZFNoYXBlLFxuICAgIG51bGw6ICgpID0+IG51bGwsXG4gICAgbHQ6IChyaWdodE9wZXJhbmQpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6bHRcIiwgcmlnaHRPcGVyYW5kKSxcbiAgICBsdGU6IChyaWdodE9wZXJhbmQpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6bHRlXCIsIHJpZ2h0T3BlcmFuZCksXG4gICAgZXE6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleShrZXkpO1xuICAgICAgcmV0dXJuIGtleSA9PT0gdm9pZCAwID8gTTMudW5kZWZpbmVkKCkgOiBrZXk7XG4gICAgfSxcbiAgICBuZXE6IChrZXkpID0+IE0zLm5vdChNMy5lcShrZXkpKSxcbiAgICBndGU6IChyaWdodE9wZXJhbmQpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6Z3RlXCIsIHJpZ2h0T3BlcmFuZCksXG4gICAgZ3Q6IChyaWdodE9wZXJhbmQpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6Z3RcIiwgcmlnaHRPcGVyYW5kKSxcbiAgICByZWNvcmRPZjogKGtleVBhdHQgPSBNMy5hbnkoKSwgdmFsdWVQYXR0ID0gTTMuYW55KCksIGxpbWl0cyA9IHZvaWQgMCkgPT4gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpyZWNvcmRPZlwiLCBba2V5UGF0dCwgdmFsdWVQYXR0LCBsaW1pdHNdKSxcbiAgICBhcnJheU9mOiAoc3ViUGF0dCA9IE0zLmFueSgpLCBsaW1pdHMgPSB2b2lkIDApID0+IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6YXJyYXlPZlwiLCBbc3ViUGF0dCwgbGltaXRzXSksXG4gICAgc2V0T2Y6IChrZXlQYXR0ID0gTTMuYW55KCksIGxpbWl0cyA9IHZvaWQgMCkgPT4gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpzZXRPZlwiLCBba2V5UGF0dCwgbGltaXRzXSksXG4gICAgYmFnT2Y6IChrZXlQYXR0ID0gTTMuYW55KCksIGNvdW50UGF0dCA9IE0zLmFueSgpLCBsaW1pdHMgPSB2b2lkIDApID0+IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6YmFnT2ZcIiwgW2tleVBhdHQsIGNvdW50UGF0dCwgbGltaXRzXSksXG4gICAgY29udGFpbmVySGFzOiAoZWxlbWVudFBhdHQgPSBNMy5hbnkoKSwgY291bnRQYXR0ID0gMW4sIGxpbWl0cyA9IHZvaWQgMCkgPT4gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpjb250YWluZXJIYXNcIiwgW2VsZW1lbnRQYXR0LCBjb3VudFBhdHQsIGxpbWl0c10pLFxuICAgIG1hcE9mOiAoa2V5UGF0dCA9IE0zLmFueSgpLCB2YWx1ZVBhdHQgPSBNMy5hbnkoKSwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOm1hcE9mXCIsIFtrZXlQYXR0LCB2YWx1ZVBhdHQsIGxpbWl0c10pLFxuICAgIHNwbGl0QXJyYXk6IChiYXNlMiwgb3B0aW9uYWwgPSB2b2lkIDAsIHJlc3QgPSB2b2lkIDApID0+IG1ha2VNYXRjaGVyKFxuICAgICAgXCJtYXRjaDpzcGxpdEFycmF5XCIsXG4gICAgICBtYWtlU3BsaXRQYXlsb2FkKFtdLCBiYXNlMiwgb3B0aW9uYWwsIHJlc3QpXG4gICAgKSxcbiAgICBzcGxpdFJlY29yZDogKGJhc2UyLCBvcHRpb25hbCA9IHZvaWQgMCwgcmVzdCA9IHZvaWQgMCkgPT4gbWFrZU1hdGNoZXIoXG4gICAgICBcIm1hdGNoOnNwbGl0UmVjb3JkXCIsXG4gICAgICBtYWtlU3BsaXRQYXlsb2FkKHt9LCBiYXNlMiwgb3B0aW9uYWwsIHJlc3QpXG4gICAgKSxcbiAgICBzcGxpdDogKGJhc2UyLCByZXN0ID0gdm9pZCAwKSA9PiB7XG4gICAgICBpZiAocGFzc1N0eWxlT2YoaGFyZGVuKGJhc2UyKSkgPT09IFwiY29weUFycmF5XCIpIHtcbiAgICAgICAgcmV0dXJuIE0zLnNwbGl0QXJyYXkoYmFzZTIsIHJlc3QgJiYgW10sIHJlc3QpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIE0zLnNwbGl0UmVjb3JkKGJhc2UyLCByZXN0ICYmIHt9LCByZXN0KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHBhcnRpYWw6IChiYXNlMiwgcmVzdCA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKHBhc3NTdHlsZU9mKGhhcmRlbihiYXNlMikpID09PSBcImNvcHlBcnJheVwiKSB7XG4gICAgICAgIHJldHVybiBNMy5zcGxpdEFycmF5KFtdLCBiYXNlMiwgcmVzdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gTTMuc3BsaXRSZWNvcmQoe30sIGJhc2UyLCByZXN0KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGVyZWY6ICh0NSkgPT4gTTMub3IodDUsIE0zLnByb21pc2UoKSksXG4gICAgb3B0OiAodDUpID0+IE0zLm9yKE0zLnVuZGVmaW5lZCgpLCB0NSksXG4gICAgaW50ZXJmYWNlOiAoaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCBvcHRpb25zKSA9PiAoXG4gICAgICAvL1xuICAgICAgbWFrZUludGVyZmFjZUd1YXJkKGludGVyZmFjZU5hbWUsIG1ldGhvZEd1YXJkcywgb3B0aW9ucylcbiAgICApLFxuICAgIGNhbGw6ICguLi5hcmdQYXR0ZXJucykgPT4gKFxuICAgICAgLy9cbiAgICAgIG1ha2VNZXRob2RHdWFyZE1ha2VyKFwic3luY1wiLCBhcmdQYXR0ZXJucylcbiAgICApLFxuICAgIGNhbGxXaGVuOiAoLi4uYXJnR3VhcmRzKSA9PiAoXG4gICAgICAvL1xuICAgICAgbWFrZU1ldGhvZEd1YXJkTWFrZXIoXCJhc3luY1wiLCBhcmdHdWFyZHMpXG4gICAgKSxcbiAgICBhd2FpdDogKGFyZ1BhdHRlcm4pID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlQXdhaXRBcmdHdWFyZChhcmdQYXR0ZXJuKVxuICAgICksXG4gICAgcmF3OiAoKSA9PiAoXG4gICAgICAvL1xuICAgICAgbWFrZVJhd0d1YXJkKClcbiAgICApXG4gIH0pO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBjaGVja01hdGNoZXM6IGNoZWNrTWF0Y2hlczIsXG4gICAgbWF0Y2hlczogbWF0Y2hlczIsXG4gICAgbXVzdE1hdGNoOiBtdXN0TWF0Y2g0LFxuICAgIGFzc2VydFBhdHRlcm46IGFzc2VydFBhdHRlcm4yLFxuICAgIGlzUGF0dGVybjogaXNQYXR0ZXJuMixcbiAgICBnZXRSYW5rQ292ZXI6IGdldFJhbmtDb3ZlcjIsXG4gICAgTTogTTMsXG4gICAga2luZE9mOiBraW5kT2YyLFxuICAgIGNvbnRhaW5lckhhc1NwbGl0OiBjb250YWluZXJIYXNTcGxpdDJcbiAgfSk7XG59O1xudmFyIHtcbiAgY2hlY2tNYXRjaGVzLFxuICBtYXRjaGVzLFxuICBtdXN0TWF0Y2gsXG4gIGFzc2VydFBhdHRlcm4sXG4gIGlzUGF0dGVybixcbiAgZ2V0UmFua0NvdmVyLFxuICBNLFxuICBraW5kT2YsXG4gIGNvbnRhaW5lckhhc1NwbGl0XG59ID0gbWFrZVBhdHRlcm5LaXQoKTtcbk1NID0gTTtcbnZhciBBd2FpdEFyZ0d1YXJkUGF5bG9hZFNoYXBlID0gaGFyZGVuKHtcbiAgYXJnR3VhcmQ6IE0ucGF0dGVybigpXG59KTtcbnZhciBBd2FpdEFyZ0d1YXJkU2hhcGUgPSBNLmtpbmQoXCJndWFyZDphd2FpdEFyZ0d1YXJkXCIpO1xudmFyIGlzQXdhaXRBcmdHdWFyZCA9IChzcGVjaW1lbikgPT4gbWF0Y2hlcyhzcGVjaW1lbiwgQXdhaXRBcmdHdWFyZFNoYXBlKTtcbmhhcmRlbihpc0F3YWl0QXJnR3VhcmQpO1xudmFyIGFzc2VydEF3YWl0QXJnR3VhcmQgPSAoc3BlY2ltZW4pID0+IHtcbiAgbXVzdE1hdGNoKHNwZWNpbWVuLCBBd2FpdEFyZ0d1YXJkU2hhcGUsIFwiYXdhaXRBcmdHdWFyZFwiKTtcbn07XG5oYXJkZW4oYXNzZXJ0QXdhaXRBcmdHdWFyZCk7XG52YXIgbWFrZUF3YWl0QXJnR3VhcmQgPSAoYXJnUGF0dGVybikgPT4ge1xuICBjb25zdCByZXN1bHQgPSBtYWtlVGFnZ2VkKFwiZ3VhcmQ6YXdhaXRBcmdHdWFyZFwiLCB7XG4gICAgYXJnR3VhcmQ6IGFyZ1BhdHRlcm5cbiAgfSk7XG4gIGFzc2VydEF3YWl0QXJnR3VhcmQocmVzdWx0KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgUmF3R3VhcmRQYXlsb2FkU2hhcGUgPSBNLnJlY29yZCgpO1xudmFyIFJhd0d1YXJkU2hhcGUgPSBNLmtpbmQoXCJndWFyZDpyYXdHdWFyZFwiKTtcbnZhciBpc1Jhd0d1YXJkID0gKHNwZWNpbWVuKSA9PiBtYXRjaGVzKHNwZWNpbWVuLCBSYXdHdWFyZFNoYXBlKTtcbnZhciBtYWtlUmF3R3VhcmQgPSAoKSA9PiBtYWtlVGFnZ2VkKFwiZ3VhcmQ6cmF3R3VhcmRcIiwge30pO1xudmFyIFN5bmNWYWx1ZUd1YXJkU2hhcGUgPSBNLm9yKFJhd0d1YXJkU2hhcGUsIE0ucGF0dGVybigpKTtcbnZhciBTeW5jVmFsdWVHdWFyZExpc3RTaGFwZSA9IE0uYXJyYXlPZihTeW5jVmFsdWVHdWFyZFNoYXBlKTtcbnZhciBBcmdHdWFyZFNoYXBlID0gTS5vcihSYXdHdWFyZFNoYXBlLCBBd2FpdEFyZ0d1YXJkU2hhcGUsIE0ucGF0dGVybigpKTtcbnZhciBBcmdHdWFyZExpc3RTaGFwZSA9IE0uYXJyYXlPZihBcmdHdWFyZFNoYXBlKTtcbnZhciBTeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUgPSBoYXJkZW4oe1xuICBjYWxsS2luZDogXCJzeW5jXCIsXG4gIGFyZ0d1YXJkczogU3luY1ZhbHVlR3VhcmRMaXN0U2hhcGUsXG4gIG9wdGlvbmFsQXJnR3VhcmRzOiBNLm9wdChTeW5jVmFsdWVHdWFyZExpc3RTaGFwZSksXG4gIHJlc3RBcmdHdWFyZDogTS5vcHQoU3luY1ZhbHVlR3VhcmRTaGFwZSksXG4gIHJldHVybkd1YXJkOiBTeW5jVmFsdWVHdWFyZFNoYXBlXG59KTtcbnZhciBBc3luY01ldGhvZEd1YXJkUGF5bG9hZFNoYXBlID0gaGFyZGVuKHtcbiAgY2FsbEtpbmQ6IFwiYXN5bmNcIixcbiAgYXJnR3VhcmRzOiBBcmdHdWFyZExpc3RTaGFwZSxcbiAgb3B0aW9uYWxBcmdHdWFyZHM6IE0ub3B0KEFyZ0d1YXJkTGlzdFNoYXBlKSxcbiAgcmVzdEFyZ0d1YXJkOiBNLm9wdChTeW5jVmFsdWVHdWFyZFNoYXBlKSxcbiAgcmV0dXJuR3VhcmQ6IFN5bmNWYWx1ZUd1YXJkU2hhcGVcbn0pO1xudmFyIE1ldGhvZEd1YXJkUGF5bG9hZFNoYXBlID0gTS5vcihcbiAgU3luY01ldGhvZEd1YXJkUGF5bG9hZFNoYXBlLFxuICBBc3luY01ldGhvZEd1YXJkUGF5bG9hZFNoYXBlXG4pO1xudmFyIE1ldGhvZEd1YXJkU2hhcGUgPSBNLmtpbmQoXCJndWFyZDptZXRob2RHdWFyZFwiKTtcbnZhciBhc3NlcnRNZXRob2RHdWFyZCA9IChzcGVjaW1lbikgPT4ge1xuICBtdXN0TWF0Y2goc3BlY2ltZW4sIE1ldGhvZEd1YXJkU2hhcGUsIFwibWV0aG9kR3VhcmRcIik7XG59O1xuaGFyZGVuKGFzc2VydE1ldGhvZEd1YXJkKTtcbnZhciBtYWtlTWV0aG9kR3VhcmRNYWtlciA9IChjYWxsS2luZCwgYXJnR3VhcmRzLCBvcHRpb25hbEFyZ0d1YXJkcyA9IHZvaWQgMCwgcmVzdEFyZ0d1YXJkID0gdm9pZCAwKSA9PiBoYXJkZW4oe1xuICBvcHRpb25hbDogKC4uLm9wdEFyZ0d1YXJkcykgPT4ge1xuICAgIG9wdGlvbmFsQXJnR3VhcmRzID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBDYW4gb25seSBoYXZlIG9uZSBzZXQgb2Ygb3B0aW9uYWwgZ3VhcmRzYDtcbiAgICByZXN0QXJnR3VhcmQgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYG9wdGlvbmFsIGFyZyBndWFyZHMgbXVzdCBjb21lIGJlZm9yZSByZXN0IGFyZ2A7XG4gICAgcmV0dXJuIG1ha2VNZXRob2RHdWFyZE1ha2VyKGNhbGxLaW5kLCBhcmdHdWFyZHMsIG9wdEFyZ0d1YXJkcyk7XG4gIH0sXG4gIHJlc3Q6IChyQXJnR3VhcmQpID0+IHtcbiAgICByZXN0QXJnR3VhcmQgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYENhbiBvbmx5IGhhdmUgb25lIHJlc3QgYXJnYDtcbiAgICByZXR1cm4gbWFrZU1ldGhvZEd1YXJkTWFrZXIoXG4gICAgICBjYWxsS2luZCxcbiAgICAgIGFyZ0d1YXJkcyxcbiAgICAgIG9wdGlvbmFsQXJnR3VhcmRzLFxuICAgICAgckFyZ0d1YXJkXG4gICAgKTtcbiAgfSxcbiAgcmV0dXJuczogKHJldHVybkd1YXJkID0gTS51bmRlZmluZWQoKSkgPT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IG1ha2VUYWdnZWQoXCJndWFyZDptZXRob2RHdWFyZFwiLCB7XG4gICAgICBjYWxsS2luZCxcbiAgICAgIGFyZ0d1YXJkcyxcbiAgICAgIG9wdGlvbmFsQXJnR3VhcmRzLFxuICAgICAgcmVzdEFyZ0d1YXJkLFxuICAgICAgcmV0dXJuR3VhcmRcbiAgICB9KTtcbiAgICBhc3NlcnRNZXRob2RHdWFyZChyZXN1bHQpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbn0pO1xudmFyIEludGVyZmFjZUd1YXJkUGF5bG9hZFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGludGVyZmFjZU5hbWU6IE0uc3RyaW5nKCksXG4gICAgbWV0aG9kR3VhcmRzOiBNLnJlY29yZE9mKE0uc3RyaW5nKCksIE1ldGhvZEd1YXJkU2hhcGUpXG4gIH0sXG4gIHtcbiAgICBkZWZhdWx0R3VhcmRzOiBNLm9yKE0udW5kZWZpbmVkKCksIFwicGFzc2FibGVcIiwgXCJyYXdcIiksXG4gICAgc2xvcHB5OiBNLmJvb2xlYW4oKSxcbiAgICBzeW1ib2xNZXRob2RHdWFyZHM6IE0ubWFwT2YoTS5zeW1ib2woKSwgTWV0aG9kR3VhcmRTaGFwZSlcbiAgfVxuKTtcbnZhciBJbnRlcmZhY2VHdWFyZFNoYXBlID0gTS5raW5kKFwiZ3VhcmQ6aW50ZXJmYWNlR3VhcmRcIik7XG52YXIgYXNzZXJ0SW50ZXJmYWNlR3VhcmQgPSAoc3BlY2ltZW4pID0+IHtcbiAgbXVzdE1hdGNoKHNwZWNpbWVuLCBJbnRlcmZhY2VHdWFyZFNoYXBlLCBcImludGVyZmFjZUd1YXJkXCIpO1xufTtcbmhhcmRlbihhc3NlcnRJbnRlcmZhY2VHdWFyZCk7XG52YXIgbWFrZUludGVyZmFjZUd1YXJkID0gKGludGVyZmFjZU5hbWUsIG1ldGhvZEd1YXJkcywgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHsgc2xvcHB5ID0gZmFsc2UsIGRlZmF1bHRHdWFyZHMgPSBzbG9wcHkgPyBcInBhc3NhYmxlXCIgOiB2b2lkIDAgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IHN0cmluZ01ldGhvZEd1YXJkcyA9IHt9O1xuICBjb25zdCBzeW1ib2xNZXRob2RHdWFyZHNFbnRyaWVzID0gW107XG4gIGZvciAoY29uc3Qga2V5IG9mIG93bktleXMxNyhtZXRob2RHdWFyZHMpKSB7XG4gICAgY29uc3QgdmFsdWUgPSBtZXRob2RHdWFyZHNbXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGtleVxuICAgIF07XG4gICAgaWYgKHR5cGVvZiBrZXkgPT09IFwic3ltYm9sXCIpIHtcbiAgICAgIHN5bWJvbE1ldGhvZEd1YXJkc0VudHJpZXMucHVzaChba2V5LCB2YWx1ZV0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdHJpbmdNZXRob2RHdWFyZHNba2V5XSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuICBjb25zdCByZXN1bHQgPSBtYWtlVGFnZ2VkKFwiZ3VhcmQ6aW50ZXJmYWNlR3VhcmRcIiwge1xuICAgIGludGVyZmFjZU5hbWUsXG4gICAgbWV0aG9kR3VhcmRzOiBzdHJpbmdNZXRob2RHdWFyZHMsXG4gICAgLi4uKHN5bWJvbE1ldGhvZEd1YXJkc0VudHJpZXMubGVuZ3RoPyB7IHN5bWJvbE1ldGhvZEd1YXJkczogbWFrZUNvcHlNYXAoc3ltYm9sTWV0aG9kR3VhcmRzRW50cmllcykgfSA6IHt9KSxcbiAgICBkZWZhdWx0R3VhcmRzXG4gIH0pO1xuICBhc3NlcnRJbnRlcmZhY2VHdWFyZChyZXN1bHQpO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgcmVzdWx0XG4gICk7XG59O1xudmFyIEd1YXJkUGF5bG9hZFNoYXBlcyA9IGhhcmRlbih7XG4gIFwiZ3VhcmQ6YXdhaXRBcmdHdWFyZFwiOiBBd2FpdEFyZ0d1YXJkUGF5bG9hZFNoYXBlLFxuICBcImd1YXJkOnJhd0d1YXJkXCI6IFJhd0d1YXJkUGF5bG9hZFNoYXBlLFxuICBcImd1YXJkOm1ldGhvZEd1YXJkXCI6IE1ldGhvZEd1YXJkUGF5bG9hZFNoYXBlLFxuICBcImd1YXJkOmludGVyZmFjZUd1YXJkXCI6IEludGVyZmFjZUd1YXJkUGF5bG9hZFNoYXBlXG59KTtcblxuLy9cbnZhciBMZWdhY3lBd2FpdEFyZ0d1YXJkU2hhcGUgPSBoYXJkZW4oe1xuICBrbGFzczogXCJhd2FpdEFyZ1wiLFxuICBhcmdHdWFyZDogTS5wYXR0ZXJuKClcbn0pO1xudmFyIGdldEF3YWl0QXJnR3VhcmRQYXlsb2FkID0gKGF3YWl0QXJnR3VhcmQpID0+IHtcbiAgaWYgKG1hdGNoZXMoYXdhaXRBcmdHdWFyZCwgTGVnYWN5QXdhaXRBcmdHdWFyZFNoYXBlKSkge1xuICAgIGNvbnN0IHsga2xhc3M6IF8sIC4uLnBheWxvYWQgfSA9IGF3YWl0QXJnR3VhcmQ7XG4gICAgcmV0dXJuIHBheWxvYWQ7XG4gIH1cbiAgYXNzZXJ0QXdhaXRBcmdHdWFyZChhd2FpdEFyZ0d1YXJkKTtcbiAgcmV0dXJuIGF3YWl0QXJnR3VhcmQucGF5bG9hZDtcbn07XG5oYXJkZW4oZ2V0QXdhaXRBcmdHdWFyZFBheWxvYWQpO1xudmFyIExlZ2FjeVN5bmNNZXRob2RHdWFyZFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGtsYXNzOiBcIm1ldGhvZEd1YXJkXCIsXG4gICAgY2FsbEtpbmQ6IFwic3luY1wiLFxuICAgIGFyZ0d1YXJkczogU3luY1ZhbHVlR3VhcmRMaXN0U2hhcGUsXG4gICAgcmV0dXJuR3VhcmQ6IFN5bmNWYWx1ZUd1YXJkU2hhcGVcbiAgfSxcbiAge1xuICAgIG9wdGlvbmFsQXJnR3VhcmRzOiBTeW5jVmFsdWVHdWFyZExpc3RTaGFwZSxcbiAgICByZXN0QXJnR3VhcmQ6IFN5bmNWYWx1ZUd1YXJkU2hhcGVcbiAgfVxuKTtcbnZhciBMZWdhY3lBcmdHdWFyZFNoYXBlID0gTS5vcihcbiAgUmF3R3VhcmRTaGFwZSxcbiAgQXdhaXRBcmdHdWFyZFNoYXBlLFxuICBMZWdhY3lBd2FpdEFyZ0d1YXJkU2hhcGUsXG4gIE0ucGF0dGVybigpXG4pO1xudmFyIExlZ2FjeUFyZ0d1YXJkTGlzdFNoYXBlID0gTS5hcnJheU9mKExlZ2FjeUFyZ0d1YXJkU2hhcGUpO1xudmFyIExlZ2FjeUFzeW5jTWV0aG9kR3VhcmRTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBrbGFzczogXCJtZXRob2RHdWFyZFwiLFxuICAgIGNhbGxLaW5kOiBcImFzeW5jXCIsXG4gICAgYXJnR3VhcmRzOiBMZWdhY3lBcmdHdWFyZExpc3RTaGFwZSxcbiAgICByZXR1cm5HdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxuICB9LFxuICB7XG4gICAgb3B0aW9uYWxBcmdHdWFyZHM6IEFyZ0d1YXJkTGlzdFNoYXBlLFxuICAgIHJlc3RBcmdHdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxuICB9XG4pO1xudmFyIExlZ2FjeU1ldGhvZEd1YXJkU2hhcGUgPSBNLm9yKFxuICBMZWdhY3lTeW5jTWV0aG9kR3VhcmRTaGFwZSxcbiAgTGVnYWN5QXN5bmNNZXRob2RHdWFyZFNoYXBlXG4pO1xudmFyIGFkYXB0TGVnYWN5QXJnR3VhcmQgPSAoYXJnR3VhcmQpID0+IG1hdGNoZXMoYXJnR3VhcmQsIExlZ2FjeUF3YWl0QXJnR3VhcmRTaGFwZSkgPyBNLmF3YWl0KGdldEF3YWl0QXJnR3VhcmRQYXlsb2FkKGFyZ0d1YXJkKS5hcmdHdWFyZCkgOiBhcmdHdWFyZDtcbnZhciBnZXRNZXRob2RHdWFyZFBheWxvYWQgPSAobWV0aG9kR3VhcmQpID0+IHtcbiAgaWYgKG1hdGNoZXMobWV0aG9kR3VhcmQsIE1ldGhvZEd1YXJkU2hhcGUpKSB7XG4gICAgcmV0dXJuIG1ldGhvZEd1YXJkLnBheWxvYWQ7XG4gIH1cbiAgbXVzdE1hdGNoKG1ldGhvZEd1YXJkLCBMZWdhY3lNZXRob2RHdWFyZFNoYXBlLCBcImxlZ2FjeU1ldGhvZEd1YXJkXCIpO1xuICBjb25zdCB7XG4gICAgLy9cbiAgICBrbGFzczogXyxcbiAgICAvL1xuICAgIGNhbGxLaW5kLFxuICAgIC8vXG4gICAgcmV0dXJuR3VhcmQsXG4gICAgLy9cbiAgICByZXN0QXJnR3VhcmRcbiAgfSA9IG1ldGhvZEd1YXJkO1xuICBsZXQge1xuICAgIC8vXG4gICAgYXJnR3VhcmRzLFxuICAgIC8vXG4gICAgb3B0aW9uYWxBcmdHdWFyZHNcbiAgfSA9IG1ldGhvZEd1YXJkO1xuICBpZiAoY2FsbEtpbmQgPT09IFwiYXN5bmNcIikge1xuICAgIGFyZ0d1YXJkcyA9IGFyZ0d1YXJkcy5tYXAoYWRhcHRMZWdhY3lBcmdHdWFyZCk7XG4gICAgb3B0aW9uYWxBcmdHdWFyZHMgPSBvcHRpb25hbEFyZ0d1YXJkcyAmJiBvcHRpb25hbEFyZ0d1YXJkcy5tYXAoYWRhcHRMZWdhY3lBcmdHdWFyZCk7XG4gIH1cbiAgY29uc3QgcGF5bG9hZCA9IGhhcmRlbih7XG4gICAgY2FsbEtpbmQsXG4gICAgYXJnR3VhcmRzLFxuICAgIG9wdGlvbmFsQXJnR3VhcmRzLFxuICAgIHJlc3RBcmdHdWFyZCxcbiAgICByZXR1cm5HdWFyZFxuICB9KTtcbiAgbXVzdE1hdGNoKHBheWxvYWQsIE1ldGhvZEd1YXJkUGF5bG9hZFNoYXBlLCBcImludGVybmFsTWV0aG9kR3VhcmRBZGFwdG9yXCIpO1xuICByZXR1cm4gcGF5bG9hZDtcbn07XG5oYXJkZW4oZ2V0TWV0aG9kR3VhcmRQYXlsb2FkKTtcbnZhciBMZWdhY3lJbnRlcmZhY2VHdWFyZFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGtsYXNzOiBcIkludGVyZmFjZVwiLFxuICAgIGludGVyZmFjZU5hbWU6IE0uc3RyaW5nKCksXG4gICAgbWV0aG9kR3VhcmRzOiBNLnJlY29yZE9mKFxuICAgICAgTS5zdHJpbmcoKSxcbiAgICAgIE0ub3IoTWV0aG9kR3VhcmRTaGFwZSwgTGVnYWN5TWV0aG9kR3VhcmRTaGFwZSlcbiAgICApXG4gIH0sXG4gIHtcbiAgICBkZWZhdWx0R3VhcmRzOiBNLm9yKE0udW5kZWZpbmVkKCksIFwicGFzc2FibGVcIiwgXCJyYXdcIiksXG4gICAgc2xvcHB5OiBNLmJvb2xlYW4oKSxcbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICBzeW1ib2xNZXRob2RHdWFyZHM6IE0ubWFwT2YoTS5zeW1ib2woKSwgTWV0aG9kR3VhcmRTaGFwZSlcbiAgfVxuKTtcbnZhciBhZGFwdE1ldGhvZEd1YXJkID0gKG1ldGhvZEd1YXJkKSA9PiB7XG4gIGlmIChtYXRjaGVzKG1ldGhvZEd1YXJkLCBMZWdhY3lNZXRob2RHdWFyZFNoYXBlKSkge1xuICAgIGNvbnN0IHtcbiAgICAgIGNhbGxLaW5kLFxuICAgICAgYXJnR3VhcmRzLFxuICAgICAgb3B0aW9uYWxBcmdHdWFyZHMgPSBbXSxcbiAgICAgIHJlc3RBcmdHdWFyZCA9IE0uYW55KCksXG4gICAgICByZXR1cm5HdWFyZFxuICAgIH0gPSBnZXRNZXRob2RHdWFyZFBheWxvYWQobWV0aG9kR3VhcmQpO1xuICAgIGNvbnN0IG1DYWxsID0gY2FsbEtpbmQgPT09IFwic3luY1wiID8gTS5jYWxsIDogTS5jYWxsV2hlbjtcbiAgICByZXR1cm4gbUNhbGwoLi4uYXJnR3VhcmRzKS5vcHRpb25hbCguLi5vcHRpb25hbEFyZ0d1YXJkcykucmVzdChyZXN0QXJnR3VhcmQpLnJldHVybnMocmV0dXJuR3VhcmQpO1xuICB9XG4gIHJldHVybiBtZXRob2RHdWFyZDtcbn07XG52YXIgZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkID0gKGludGVyZmFjZUd1YXJkKSA9PiB7XG4gIGlmIChtYXRjaGVzKGludGVyZmFjZUd1YXJkLCBJbnRlcmZhY2VHdWFyZFNoYXBlKSkge1xuICAgIHJldHVybiBpbnRlcmZhY2VHdWFyZC5wYXlsb2FkO1xuICB9XG4gIG11c3RNYXRjaChpbnRlcmZhY2VHdWFyZCwgTGVnYWN5SW50ZXJmYWNlR3VhcmRTaGFwZSwgXCJsZWdhY3lJbnRlcmZhY2VHdWFyZFwiKTtcbiAgbGV0IHsga2xhc3M6IF8sIGludGVyZmFjZU5hbWUsIG1ldGhvZEd1YXJkcywgLi4ucmVzdCB9ID0gaW50ZXJmYWNlR3VhcmQ7XG4gIG1ldGhvZEd1YXJkcyA9IG9iamVjdE1hcChtZXRob2RHdWFyZHMsIGFkYXB0TWV0aG9kR3VhcmQpO1xuICBjb25zdCBwYXlsb2FkID0gaGFyZGVuKHtcbiAgICBpbnRlcmZhY2VOYW1lLFxuICAgIG1ldGhvZEd1YXJkcyxcbiAgICAuLi5yZXN0XG4gIH0pO1xuICBtdXN0TWF0Y2goXG4gICAgcGF5bG9hZCxcbiAgICBJbnRlcmZhY2VHdWFyZFBheWxvYWRTaGFwZSxcbiAgICBcImludGVybmFsSW50ZXJmYWNlR3VhcmRBZGFwdG9yXCJcbiAgKTtcbiAgcmV0dXJuIHBheWxvYWQ7XG59O1xuaGFyZGVuKGdldEludGVyZmFjZUd1YXJkUGF5bG9hZCk7XG52YXIgZW1wdHlDb3B5TWFwID0gbWFrZUNvcHlNYXAoW10pO1xudmFyIGdldEludGVyZmFjZU1ldGhvZEtleXMgPSAoaW50ZXJmYWNlR3VhcmQpID0+IHtcbiAgY29uc3QgeyBtZXRob2RHdWFyZHMsIHN5bWJvbE1ldGhvZEd1YXJkcyA9IGVtcHR5Q29weU1hcCB9ID0gZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKGludGVyZmFjZUd1YXJkKTtcbiAgcmV0dXJuIGhhcmRlbihbXG4gICAgLi4uUmVmbGVjdC5vd25LZXlzKG1ldGhvZEd1YXJkcyksXG4gICAgLi4uZ2V0Q29weU1hcEtleXMoc3ltYm9sTWV0aG9kR3VhcmRzKVxuICBdKTtcbn07XG5oYXJkZW4oZ2V0SW50ZXJmYWNlTWV0aG9kS2V5cyk7XG5cbi8vXG52YXIgbWFrZVdlYWtTZXRTdG9yZU1ldGhvZHMgPSAoanNzZXQsIGFzc2VydEtleU9rVG9BZGQsIGFzc2VydEtleU9rVG9EZWxldGUgPSB2b2lkIDAsIGtleU5hbWUgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IGpzc2V0LmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShrZXlOYW1lKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiBqc3NldC5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGFkZDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5T2tUb0FkZChrZXkpO1xuICAgICAganNzZXQuYWRkKGtleSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgaWYgKGFzc2VydEtleU9rVG9EZWxldGUgIT09IHZvaWQgMCkge1xuICAgICAgICBhc3NlcnRLZXlPa1RvRGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgICBqc3NldC5kZWxldGUoa2V5KTtcbiAgICB9LFxuICAgIGFkZEFsbDogKGtleXM0KSA9PiB7XG4gICAgICBpZiAodHlwZW9mIGtleXM0W1N5bWJvbC5pdGVyYXRvcl0gIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBpZiAoT2JqZWN0LmlzRnJvemVuKGtleXM0KSAmJiBpc0NvcHlTZXQoa2V5czQpKSB7XG4gICAgICAgICAga2V5czQgPSBnZXRDb3B5U2V0S2V5cyhrZXlzNCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3dSZWRhY3RlZGBwcm92aWRlZCBkYXRhIHNvdXJjZSBpcyBub3QgaXRlcmFibGU6ICR7a2V5czR9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yIChcbiAgICAgICAgY29uc3Qga2V5IG9mXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGtleXM0XG4gICAgICApIHtcbiAgICAgICAgYXNzZXJ0S2V5T2tUb0FkZChrZXkpO1xuICAgICAgICBqc3NldC5hZGQoa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBtYWtlU2NhbGFyV2Vha1NldFN0b3JlID0gKHRhZyA9IFwia2V5XCIsIHsgbG9uZ0xpdmVkID0gdHJ1ZSwga2V5U2hhcGUgPSB2b2lkIDAgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGpzc2V0ID0gbmV3IChsb25nTGl2ZWQgPyBXZWFrU2V0IDogU2V0KSgpO1xuICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oa2V5U2hhcGUpO1xuICB9XG4gIGNvbnN0IGFzc2VydEtleU9rVG9BZGQgPSAoa2V5KSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgcGFzc1N0eWxlT2Yoa2V5KSA9PT0gXCJyZW1vdGFibGVcIiB8fCB0aHJvd1JlZGFjdGVkYE9ubHkgcmVtb3RhYmxlcyBjYW4gYmUga2V5cyBvZiBzY2FsYXIgV2Vha1N0b3JlczogJHtrZXl9YDtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwid2Vha1NldFN0b3JlIGtleVwiKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBGYXIoYHNjYWxhciBXZWFrU2V0U3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlV2Vha1NldFN0b3JlTWV0aG9kcyhqc3NldCwgYXNzZXJ0S2V5T2tUb0FkZCwgdm9pZCAwLCB0YWcpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyV2Vha1NldFN0b3JlKTtcblxuLy9cbnZhciBtYWtlQ3VycmVudEtleXNLaXQgPSAoZ2V0UmF3S2V5cywgY2hlY2tIYXMsIGNvbXBhcmUsIGFzc2VydE9rVG9BZGQsIGFzc2VydE9rVG9EZWxldGUgPSB2b2lkIDAsIGtleU5hbWUgPSBcImtleVwiKSA9PiB7XG4gIGxldCB1cGRhdGVDb3VudCA9IDA7XG4gIGxldCBzb3J0ZWRLZXlzTWVtbztcbiAgY29uc3QgYXNzZXJ0VXBkYXRlT25BZGQgPSAoaywgdjIgPSB2b2lkIDApID0+IHtcbiAgICBhc3NlcnRPa1RvQWRkKGssIHYyKTtcbiAgICB1cGRhdGVDb3VudCArPSAxO1xuICAgIHNvcnRlZEtleXNNZW1vID0gdm9pZCAwO1xuICB9O1xuICBjb25zdCBhc3NlcnRVcGRhdGVPbkRlbGV0ZSA9IChrKSA9PiBhc3NlcnRPa1RvRGVsZXRlICYmIGFzc2VydE9rVG9EZWxldGUoayk7XG4gIGNvbnN0IGdldFNvcnRlZEtleXMgPSAoKSA9PiB7XG4gICAgaWYgKHNvcnRlZEtleXNNZW1vID09PSB2b2lkIDApIHtcbiAgICAgIHNvcnRlZEtleXNNZW1vID0gaGFyZGVuKFsuLi5nZXRSYXdLZXlzKCldLnNvcnQoY29tcGFyZSkpO1xuICAgIH1cbiAgICByZXR1cm4gc29ydGVkS2V5c01lbW87XG4gIH07XG4gIGNvbnN0IGl0ZXJhYmxlS2V5cyA9IEZhcihcIkl0ZXJhYmxlIG9mIGtleXNcIiwge1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBjb25zdCBnZW5lcmF0aW9uID0gdXBkYXRlQ291bnQ7XG4gICAgICBnZXRTb3J0ZWRLZXlzKCk7XG4gICAgICBjb25zdCBsZW4gPSBzb3J0ZWRLZXlzTWVtby5sZW5ndGg7XG4gICAgICBsZXQgaTIgPSAwO1xuICAgICAgcmV0dXJuIEZhcihcIkl0ZXJhdG9yIG9mIGtleXNcIiwge1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgZ2VuZXJhdGlvbiA9PT0gdXBkYXRlQ291bnQgfHwgdGhyb3dSZWRhY3RlZGBTdG9yZSAke3F1b3RlKGtleU5hbWUpfSBjdXJzb3Igc3RhbGVgO1xuICAgICAgICAgIGZvciAoOyA7ICkge1xuICAgICAgICAgICAgaWYgKGkyIDwgbGVuKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gc29ydGVkS2V5c01lbW9baTJdO1xuICAgICAgICAgICAgICBpMiArPSAxO1xuICAgICAgICAgICAgICBpZiAoY2hlY2tIYXModmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZSB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlOiB2b2lkIDAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBhc3NlcnRVcGRhdGVPbkFkZCxcbiAgICBhc3NlcnRVcGRhdGVPbkRlbGV0ZSxcbiAgICBpdGVyYWJsZUtleXNcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VDdXJyZW50S2V5c0tpdCk7XG52YXIgcHJvdmlkZUxhenkgPSAobWFwU3RvcmUsIGtleSwgbWFrZVZhbHVlKSA9PiB7XG4gIGlmICghbWFwU3RvcmUuaGFzKGtleSkpIHtcbiAgICBtYXBTdG9yZS5pbml0KGtleSwgbWFrZVZhbHVlKGtleSkpO1xuICB9XG4gIHJldHVybiBtYXBTdG9yZS5nZXQoa2V5KTtcbn07XG5oYXJkZW4ocHJvdmlkZUxhenkpO1xudmFyIG1ha2VBdG9taWNQcm92aWRlciA9IChzdG9yZSkgPT4ge1xuICBjb25zdCBwZW5kaW5nID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbiAgY29uc3QgcHJvdmlkZUFzeW5jID0gKGtleSwgbWFrZVZhbHVlLCBmaW5pc2hWYWx1ZSkgPT4ge1xuICAgIGlmIChzdG9yZS5oYXMoa2V5KSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShzdG9yZS5nZXQoa2V5KSk7XG4gICAgfVxuICAgIGlmICghcGVuZGluZy5oYXMoa2V5KSkge1xuICAgICAgY29uc3QgdmFsUDIgPSBtYWtlVmFsdWUoa2V5KS50aGVuKCh2MikgPT4ge1xuICAgICAgICBzdG9yZS5pbml0KGtleSwgdjIpO1xuICAgICAgICByZXR1cm4gdjI7XG4gICAgICB9KS50aGVuKCh2MikgPT4ge1xuICAgICAgICBpZiAoZmluaXNoVmFsdWUpIHtcbiAgICAgICAgICByZXR1cm4gZmluaXNoVmFsdWUoa2V5LCB2MikudGhlbigoKSA9PiB2Mik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHYyO1xuICAgICAgfSkuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIHBlbmRpbmcuZGVsZXRlKGtleSk7XG4gICAgICB9KTtcbiAgICAgIHBlbmRpbmcuc2V0KGtleSwgdmFsUDIpO1xuICAgIH1cbiAgICBjb25zdCB2YWxQID0gcGVuZGluZy5nZXQoa2V5KTtcbiAgICBhc3NlcnQodmFsUCk7XG4gICAgcmV0dXJuIHZhbFA7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oeyBwcm92aWRlQXN5bmMgfSk7XG59O1xuaGFyZGVuKG1ha2VBdG9taWNQcm92aWRlcik7XG52YXIgYXBwZW5kVG9TdG9yZWRBcnJheSA9IChtYXBTdG9yZSwga2V5LCBpdGVtKSA9PiB7XG4gIGlmIChtYXBTdG9yZS5oYXMoa2V5KSkge1xuICAgIGNvbnN0IGV4dGFudCA9IG1hcFN0b3JlLmdldChrZXkpO1xuICAgIG1hcFN0b3JlLnNldChrZXksIGhhcmRlbihbLi4uZXh0YW50LCBpdGVtXSkpO1xuICB9IGVsc2Uge1xuICAgIG1hcFN0b3JlLmluaXQoa2V5LCBoYXJkZW4oW2l0ZW1dKSk7XG4gIH1cbn07XG5oYXJkZW4oYXBwZW5kVG9TdG9yZWRBcnJheSk7XG5cbi8vXG52YXIgbWFrZVNldFN0b3JlTWV0aG9kcyA9IChqc3NldCwgYXNzZXJ0S2V5T2tUb0FkZCwgYXNzZXJ0S2V5T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgeyBhc3NlcnRVcGRhdGVPbkFkZCwgYXNzZXJ0VXBkYXRlT25EZWxldGUsIGl0ZXJhYmxlS2V5cyB9ID0gbWFrZUN1cnJlbnRLZXlzS2l0KFxuICAgICgpID0+IGpzc2V0LmtleXMoKSxcbiAgICAoaykgPT4ganNzZXQuaGFzKGspLFxuICAgIGNvbXBhcmVSYW5rLFxuICAgIGFzc2VydEtleU9rVG9BZGQsXG4gICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZSxcbiAgICBrZXlOYW1lXG4gICk7XG4gIGNvbnN0IGtleXM0ID0gKGtleVBhdHQgPSB2b2lkIDApID0+IGtleVBhdHQgPT09IHZvaWQgMCA/IGl0ZXJhYmxlS2V5cyA6IGZpbHRlckl0ZXJhYmxlKGl0ZXJhYmxlS2V5cywgKGspID0+IG1hdGNoZXMoaywga2V5UGF0dCkpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICAuLi5tYWtlV2Vha1NldFN0b3JlTWV0aG9kcyhcbiAgICAgIGpzc2V0LFxuICAgICAgYXNzZXJ0VXBkYXRlT25BZGQsXG4gICAgICBhc3NlcnRVcGRhdGVPbkRlbGV0ZSxcbiAgICAgIGtleU5hbWVcbiAgICApLFxuICAgIGtleXM6IGtleXM0LFxuICAgIHZhbHVlczoga2V5czQsXG4gICAgc25hcHNob3Q6IChrZXlQYXR0ID0gdm9pZCAwKSA9PiBtYWtlQ29weVNldChrZXlzNChrZXlQYXR0KSksXG4gICAgZ2V0U2l6ZTogKGtleVBhdHQgPSB2b2lkIDApID0+IGtleVBhdHQgPT09IHZvaWQgMCA/IGpzc2V0LnNpemUgOiBbLi4ua2V5czQoa2V5UGF0dCldLmxlbmd0aCxcbiAgICBjbGVhcjogKGtleVBhdHQgPSB2b2lkIDApID0+IHtcbiAgICAgIGlmIChrZXlQYXR0ID09PSB2b2lkIDApIHtcbiAgICAgICAganNzZXQuY2xlYXIoKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXM0KGtleVBhdHQpKSB7XG4gICAgICAgIGpzc2V0LmRlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJTZXRTdG9yZSA9ICh0YWcgPSBcImtleVwiLCB7IGtleVNoYXBlID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBqc3NldCA9IC8qICAgICAgICAgICAqLyBuZXcgU2V0KCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S2V5T2tUb0FkZCA9IChrZXkpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBhc3NlcnRTY2FsYXJLZXkoa2V5KTtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwic2V0U3RvcmUga2V5XCIpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIEZhcihgc2NhbGFyIFNldFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZVNldFN0b3JlTWV0aG9kcyhqc3NldCwgYXNzZXJ0S2V5T2tUb0FkZCwgdm9pZCAwLCB0YWcpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyU2V0U3RvcmUpO1xuXG4vL1xudmFyIG1ha2VXZWFrTWFwU3RvcmVNZXRob2RzID0gKGpzbWFwLCBhc3NlcnRLVk9rVG9BZGQsIGFzc2VydEtWT2tUb1NldCwgYXNzZXJ0S2V5T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgYXNzZXJ0S2V5RG9lc05vdEV4aXN0ID0gKGtleSkgPT4gIWpzbWFwLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShrZXlOYW1lKX0gYWxyZWFkeSByZWdpc3RlcmVkOiAke2tleX1gO1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiBqc21hcC5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoa2V5TmFtZSl9IG5vdCBmb3VuZDogJHtrZXl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgaGFzOiAoa2V5KSA9PiB7XG4gICAgICByZXR1cm4ganNtYXAuaGFzKGtleSk7XG4gICAgfSxcbiAgICBnZXQ6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgICBqc21hcC5nZXQoa2V5KVxuICAgICAgKTtcbiAgICB9LFxuICAgIGluaXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlEb2VzTm90RXhpc3Qoa2V5KTtcbiAgICAgIGFzc2VydEtWT2tUb0FkZChrZXksIHZhbHVlKTtcbiAgICAgIGpzbWFwLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIHNldDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICAgICAganNtYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZGVsZXRlOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIGlmIChhc3NlcnRLZXlPa1RvRGVsZXRlICE9PSB2b2lkIDApIHtcbiAgICAgICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZShrZXkpO1xuICAgICAgfVxuICAgICAganNtYXAuZGVsZXRlKGtleSk7XG4gICAgfSxcbiAgICBhZGRBbGw6IChlbnRyaWVzMTApID0+IHtcbiAgICAgIGlmICh0eXBlb2YgZW50cmllczEwW1N5bWJvbC5pdGVyYXRvcl0gIT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBpZiAoT2JqZWN0LmlzRnJvemVuKGVudHJpZXMxMCkgJiYgaXNDb3B5TWFwKGVudHJpZXMxMCkpIHtcbiAgICAgICAgICBlbnRyaWVzMTAgPSBnZXRDb3B5TWFwRW50cmllcyhlbnRyaWVzMTApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93UmVkYWN0ZWRgcHJvdmlkZWQgZGF0YSBzb3VyY2UgaXMgbm90IGl0ZXJhYmxlOiAke2VudHJpZXMxMH1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKFxuICAgICAgICBjb25zdCBba2V5LCB2YWx1ZV0gb2ZcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBlbnRyaWVzMTBcbiAgICAgICkge1xuICAgICAgICBhc3NlcnRLVk9rVG9BZGQoa2V5LCB2YWx1ZSk7XG4gICAgICAgIGpzbWFwLnNldChrZXksIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBtYWtlU2NhbGFyV2Vha01hcFN0b3JlID0gKHRhZyA9IFwia2V5XCIsIHsgbG9uZ0xpdmVkID0gdHJ1ZSwga2V5U2hhcGUgPSB2b2lkIDAsIHZhbHVlU2hhcGUgPSB2b2lkIDAgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGpzbWFwID0gbmV3IChsb25nTGl2ZWQgPyBXZWFrTWFwIDogTWFwKSgpO1xuICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oa2V5U2hhcGUpO1xuICB9XG4gIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKHZhbHVlU2hhcGUpO1xuICB9XG4gIGNvbnN0IGFzc2VydEtWT2tUb1NldCA9IChfa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGhhcmRlbih2YWx1ZSk7XG4gICAgYXNzZXJ0UGFzc2FibGUodmFsdWUpO1xuICAgIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaCh2YWx1ZSwgdmFsdWVTaGFwZSwgXCJ3ZWFrTWFwU3RvcmUgdmFsdWVcIik7XG4gICAgfVxuICB9O1xuICBjb25zdCBhc3NlcnRLVk9rVG9BZGQgPSAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGhhcmRlbihrZXkpO1xuICAgIHBhc3NTdHlsZU9mKGtleSkgPT09IFwicmVtb3RhYmxlXCIgfHwgdGhyb3dSZWRhY3RlZGBPbmx5IHJlbW90YWJsZXMgY2FuIGJlIGtleXMgb2Ygc2NhbGFyIFdlYWtNYXBTdG9yZXM6ICR7a2V5fWA7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcIndlYWtNYXBTdG9yZSBrZXlcIik7XG4gICAgfVxuICAgIGFzc2VydEtWT2tUb1NldChrZXksIHZhbHVlKTtcbiAgfTtcbiAgcmV0dXJuIEZhcihgc2NhbGFyIFdlYWtNYXBTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VXZWFrTWFwU3RvcmVNZXRob2RzKFxuICAgICAganNtYXAsXG4gICAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgICBhc3NlcnRLVk9rVG9TZXQsXG4gICAgICB2b2lkIDAsXG4gICAgICB0YWdcbiAgICApXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyV2Vha01hcFN0b3JlKTtcblxuLy9cbnZhciBtYWtlTWFwU3RvcmVNZXRob2RzID0gKGpzbWFwLCBhc3NlcnRLVk9rVG9BZGQsIGFzc2VydEtWT2tUb1NldCwgYXNzZXJ0S2V5T2tUb0RlbGV0ZSA9IHZvaWQgMCwgdGFnID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCB7IGFzc2VydFVwZGF0ZU9uQWRkLCBhc3NlcnRVcGRhdGVPbkRlbGV0ZSwgaXRlcmFibGVLZXlzIH0gPSBtYWtlQ3VycmVudEtleXNLaXQoXG4gICAgKCkgPT4ganNtYXAua2V5cygpLFxuICAgIChrKSA9PiBqc21hcC5oYXMoayksXG4gICAgY29tcGFyZVJhbmssXG4gICAgYXNzZXJ0S1ZPa1RvQWRkLFxuICAgIGFzc2VydEtleU9rVG9EZWxldGUsXG4gICAgdGFnXG4gICk7XG4gIGNvbnN0IGtleXM0ID0gKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4ge1xuICAgIGlmIChrZXlQYXR0ID09PSB2b2lkIDAgJiYgdmFsdWVQYXR0ID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBpdGVyYWJsZUtleXM7XG4gICAgfVxuICAgIGNvbnN0IGZpbHRlciA9IChrKSA9PiB7XG4gICAgICBpZiAoa2V5UGF0dCAhPT0gdm9pZCAwICYmICFtYXRjaGVzKGssIGtleVBhdHQpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWx1ZVBhdHQgIT09IHZvaWQgMCAmJiAhbWF0Y2hlcyhqc21hcC5nZXQoayksIHZhbHVlUGF0dCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbiAgICByZXR1cm4gZmlsdGVySXRlcmFibGUoaXRlcmFibGVLZXlzLCBmaWx0ZXIpO1xuICB9O1xuICBjb25zdCB2YWx1ZXM2ID0gKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4gbWFwSXRlcmFibGUoa2V5czQoa2V5UGF0dCwgdmFsdWVQYXR0KSwgKGspID0+IChcbiAgICAvKiAgICAgICAgICAgICovXG4gICAganNtYXAuZ2V0KGspXG4gICkpO1xuICBjb25zdCBlbnRyaWVzMTAgPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBtYXBJdGVyYWJsZShrZXlzNChrZXlQYXR0LCB2YWx1ZVBhdHQpLCAoaykgPT4gW1xuICAgIGssXG4gICAgLyogICAgICAgICAgICAqL1xuICAgIGpzbWFwLmdldChrKVxuICBdKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgLi4ubWFrZVdlYWtNYXBTdG9yZU1ldGhvZHMoXG4gICAgICBqc21hcCxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBhc3NlcnRVcGRhdGVPbkFkZCxcbiAgICAgIGFzc2VydEtWT2tUb1NldCxcbiAgICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgICAgdGFnXG4gICAgKSxcbiAgICBrZXlzOiBrZXlzNCxcbiAgICB2YWx1ZXM6IHZhbHVlczYsXG4gICAgZW50cmllczogZW50cmllczEwLFxuICAgIHNuYXBzaG90OiAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBtYWtlQ29weU1hcChlbnRyaWVzMTAoa2V5UGF0dCwgdmFsdWVQYXR0KSksXG4gICAgZ2V0U2l6ZTogKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwICYmIHZhbHVlUGF0dCA9PT0gdm9pZCAwID8ganNtYXAuc2l6ZSA6IFsuLi5rZXlzNChrZXlQYXR0LCB2YWx1ZVBhdHQpXS5sZW5ndGgsXG4gICAgY2xlYXI6IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IHtcbiAgICAgIGlmIChrZXlQYXR0ID09PSB2b2lkIDAgJiYgdmFsdWVQYXR0ID09PSB2b2lkIDApIHtcbiAgICAgICAganNtYXAuY2xlYXIoKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXM0KGtleVBhdHQsIHZhbHVlUGF0dCkpIHtcbiAgICAgICAganNtYXAuZGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhck1hcFN0b3JlID0gKHRhZyA9IFwia2V5XCIsIHsga2V5U2hhcGUgPSB2b2lkIDAsIHZhbHVlU2hhcGUgPSB2b2lkIDAgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGpzbWFwID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbiAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGtleVNoYXBlKTtcbiAgfVxuICBpZiAodmFsdWVTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybih2YWx1ZVNoYXBlKTtcbiAgfVxuICBjb25zdCBhc3NlcnRLVk9rVG9TZXQgPSAoX2tleSwgdmFsdWUpID0+IHtcbiAgICBoYXJkZW4odmFsdWUpO1xuICAgIGFzc2VydFBhc3NhYmxlKHZhbHVlKTtcbiAgICBpZiAodmFsdWVTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2godmFsdWUsIHZhbHVlU2hhcGUsIFwibWFwU3RvcmUgdmFsdWVcIik7XG4gICAgfVxuICB9O1xuICBjb25zdCBhc3NlcnRLVk9rVG9BZGQgPSAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGhhcmRlbihrZXkpO1xuICAgIGFzc2VydFNjYWxhcktleShrZXkpO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJtYXBTdG9yZSBrZXlcIik7XG4gICAgfVxuICAgIGFzc2VydEtWT2tUb1NldChrZXksIHZhbHVlKTtcbiAgfTtcbiAgcmV0dXJuIEZhcihgc2NhbGFyIE1hcFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZU1hcFN0b3JlTWV0aG9kcyhcbiAgICAgIGpzbWFwLFxuICAgICAgYXNzZXJ0S1ZPa1RvQWRkLFxuICAgICAgYXNzZXJ0S1ZPa1RvU2V0LFxuICAgICAgdm9pZCAwLFxuICAgICAgdGFnXG4gICAgKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZVNjYWxhck1hcFN0b3JlKTtcblxuLy9cbnZhciBHRVRfSU5URVJGQUNFX0dVQVJEID0gXCJfX2dldEludGVyZmFjZUd1YXJkX19cIjtcblxuLy9cbnZhciB7IGFwcGx5OiBhcHBseTQsIG93bktleXM6IG93bktleXMxOCB9ID0gUmVmbGVjdDtcbnZhciB7IGRlZmluZVByb3BlcnRpZXM6IGRlZmluZVByb3BlcnRpZXMzLCBmcm9tRW50cmllczogZnJvbUVudHJpZXM4IH0gPSBPYmplY3Q7XG52YXIgUmF3TWV0aG9kR3VhcmQgPSBNLmNhbGwoKS5yZXN0KE0ucmF3KCkpLnJldHVybnMoTS5yYXcoKSk7XG52YXIgUkVEQUNURURfUkFXX0FSRyA9IFwiPHJlZGFjdGVkIHJhdyBhcmc+XCI7XG52YXIgUGFzc2FibGVNZXRob2RHdWFyZCA9IE0uY2FsbCgpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKTtcbnZhciBkZWZlbmRTeW5jQXJncyA9IChzeW5jQXJncywgbWF0Y2hDb25maWcsIGxhYmVsID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBkZWNsYXJlZExlbixcbiAgICBoYXNSZXN0QXJnR3VhcmQsXG4gICAgcmVzdEFyZ0d1YXJkSXNSYXcsXG4gICAgcGFyYW1zUGF0dGVybixcbiAgICByZWRhY3RlZEluZGljZXNcbiAgfSA9IG1hdGNoQ29uZmlnO1xuICBsZXQgbWF0Y2hhYmxlQXJncyA9IHN5bmNBcmdzO1xuICBpZiAocmVzdEFyZ0d1YXJkSXNSYXcgJiYgc3luY0FyZ3MubGVuZ3RoID4gZGVjbGFyZWRMZW4pIHtcbiAgICBjb25zdCByZXN0TGVuID0gc3luY0FyZ3MubGVuZ3RoIC0gZGVjbGFyZWRMZW47XG4gICAgY29uc3QgcmVkYWN0ZWRSZXN0ID0gQXJyYXkocmVzdExlbikuZmlsbChSRURBQ1RFRF9SQVdfQVJHKTtcbiAgICBtYXRjaGFibGVBcmdzID0gWy4uLnN5bmNBcmdzLnNsaWNlKDAsIGRlY2xhcmVkTGVuKSwgLi4ucmVkYWN0ZWRSZXN0XTtcbiAgfSBlbHNlIGlmIChyZWRhY3RlZEluZGljZXMubGVuZ3RoID4gMCAmJiByZWRhY3RlZEluZGljZXNbMF0gPCBzeW5jQXJncy5sZW5ndGgpIHtcbiAgICBtYXRjaGFibGVBcmdzID0gWy4uLnN5bmNBcmdzXTtcbiAgfVxuICBmb3IgKGNvbnN0IGkyIG9mIHJlZGFjdGVkSW5kaWNlcykge1xuICAgIGlmIChpMiA+PSBtYXRjaGFibGVBcmdzLmxlbmd0aCkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIG1hdGNoYWJsZUFyZ3NbaTJdID0gUkVEQUNURURfUkFXX0FSRztcbiAgfVxuICBtdXN0TWF0Y2goaGFyZGVuKG1hdGNoYWJsZUFyZ3MpLCBwYXJhbXNQYXR0ZXJuLCBsYWJlbCk7XG4gIGlmIChoYXNSZXN0QXJnR3VhcmQpIHtcbiAgICByZXR1cm4gc3luY0FyZ3M7XG4gIH1cbiAgc3luY0FyZ3MubGVuZ3RoIDw9IGRlY2xhcmVkTGVuIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShsYWJlbCl9IGFjY2VwdHMgYXQgbW9zdCAke3F1b3RlKGRlY2xhcmVkTGVuKX0gYXJndW1lbnRzLCBub3QgJHtxdW90ZShcbiAgICBzeW5jQXJncy5sZW5ndGhcbiAgKX06ICR7c3luY0FyZ3N9YDtcbiAgcmV0dXJuIHN5bmNBcmdzO1xufTtcbnZhciBidWlsZE1hdGNoQ29uZmlnID0gKG1ldGhvZEd1YXJkUGF5bG9hZCkgPT4ge1xuICBjb25zdCB7XG4gICAgYXJnR3VhcmRzLFxuICAgIG9wdGlvbmFsQXJnR3VhcmRzID0gW10sXG4gICAgcmVzdEFyZ0d1YXJkXG4gIH0gPSBtZXRob2RHdWFyZFBheWxvYWQ7XG4gIGNvbnN0IG1hdGNoYWJsZUFyZ0d1YXJkcyA9IFsuLi5hcmdHdWFyZHMsIC4uLm9wdGlvbmFsQXJnR3VhcmRzXTtcbiAgY29uc3QgcmVkYWN0ZWRJbmRpY2VzID0gW107XG4gIGZvciAobGV0IGkyID0gMDsgaTIgPCBtYXRjaGFibGVBcmdHdWFyZHMubGVuZ3RoOyBpMiArPSAxKSB7XG4gICAgaWYgKGlzUmF3R3VhcmQobWF0Y2hhYmxlQXJnR3VhcmRzW2kyXSkpIHtcbiAgICAgIG1hdGNoYWJsZUFyZ0d1YXJkc1tpMl0gPSBSRURBQ1RFRF9SQVdfQVJHO1xuICAgICAgcmVkYWN0ZWRJbmRpY2VzLnB1c2goaTIpO1xuICAgIH1cbiAgfVxuICBsZXQgbWF0Y2hhYmxlUmVzdEFyZ0d1YXJkID0gcmVzdEFyZ0d1YXJkO1xuICBpZiAoaXNSYXdHdWFyZChtYXRjaGFibGVSZXN0QXJnR3VhcmQpKSB7XG4gICAgbWF0Y2hhYmxlUmVzdEFyZ0d1YXJkID0gTS5hcnJheU9mKFJFREFDVEVEX1JBV19BUkcpO1xuICB9XG4gIGNvbnN0IG1hdGNoYWJsZU1ldGhvZEd1YXJkUGF5bG9hZCA9IGhhcmRlbih7XG4gICAgLi4ubWV0aG9kR3VhcmRQYXlsb2FkLFxuICAgIGFyZ0d1YXJkczogbWF0Y2hhYmxlQXJnR3VhcmRzLnNsaWNlKDAsIGFyZ0d1YXJkcy5sZW5ndGgpLFxuICAgIG9wdGlvbmFsQXJnR3VhcmRzOiBtYXRjaGFibGVBcmdHdWFyZHMuc2xpY2UoYXJnR3VhcmRzLmxlbmd0aCksXG4gICAgcmVzdEFyZ0d1YXJkOiBtYXRjaGFibGVSZXN0QXJnR3VhcmRcbiAgfSk7XG4gIGNvbnN0IHBhcmFtc1BhdHRlcm4gPSBNLnNwbGl0QXJyYXkoXG4gICAgbWF0Y2hhYmxlTWV0aG9kR3VhcmRQYXlsb2FkLmFyZ0d1YXJkcyxcbiAgICBtYXRjaGFibGVNZXRob2RHdWFyZFBheWxvYWQub3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgbWF0Y2hhYmxlTWV0aG9kR3VhcmRQYXlsb2FkLnJlc3RBcmdHdWFyZFxuICApO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBkZWNsYXJlZExlbjogbWF0Y2hhYmxlQXJnR3VhcmRzLmxlbmd0aCxcbiAgICBoYXNSZXN0QXJnR3VhcmQ6IHJlc3RBcmdHdWFyZCAhPT0gdm9pZCAwLFxuICAgIHJlc3RBcmdHdWFyZElzUmF3OiByZXN0QXJnR3VhcmQgIT09IG1hdGNoYWJsZVJlc3RBcmdHdWFyZCxcbiAgICBwYXJhbXNQYXR0ZXJuLFxuICAgIHJlZGFjdGVkSW5kaWNlcyxcbiAgICBtYXRjaGFibGVNZXRob2RHdWFyZFBheWxvYWRcbiAgfSk7XG59O1xudmFyIGRlZmVuZFN5bmNNZXRob2QgPSAoZ2V0Q29udGV4dCwgYmVoYXZpb3JNZXRob2QsIG1ldGhvZEd1YXJkUGF5bG9hZCwgbGFiZWwpID0+IHtcbiAgY29uc3QgeyByZXR1cm5HdWFyZCB9ID0gbWV0aG9kR3VhcmRQYXlsb2FkO1xuICBjb25zdCBpc1Jhd1JldHVybiA9IGlzUmF3R3VhcmQocmV0dXJuR3VhcmQpO1xuICBjb25zdCBtYXRjaENvbmZpZyA9IGJ1aWxkTWF0Y2hDb25maWcobWV0aG9kR3VhcmRQYXlsb2FkKTtcbiAgY29uc3QgeyBzeW5jTWV0aG9kIH0gPSB7XG4gICAgLy9cbiAgICBzeW5jTWV0aG9kKC4uLnN5bmNBcmdzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gZ2V0Q29udGV4dCh0aGlzKTtcbiAgICAgICAgY29uc3QgcmVhbEFyZ3MgPSBkZWZlbmRTeW5jQXJncyhzeW5jQXJncywgbWF0Y2hDb25maWcsIGxhYmVsKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXBwbHk0KGJlaGF2aW9yTWV0aG9kLCBjb250ZXh0LCByZWFsQXJncyk7XG4gICAgICAgIGlmICghaXNSYXdSZXR1cm4pIHtcbiAgICAgICAgICBtdXN0TWF0Y2goaGFyZGVuKHJlc3VsdCksIHJldHVybkd1YXJkLCBgJHtsYWJlbH06IHJlc3VsdGApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9IGNhdGNoICh0aHJvd25UaGluZykge1xuICAgICAgICB0aHJvdyB0b1Rocm93YWJsZSh0aHJvd25UaGluZyk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gc3luY01ldGhvZDtcbn07XG52YXIgZGVzeW5jID0gKG1ldGhvZEd1YXJkUGF5bG9hZCkgPT4ge1xuICBjb25zdCB7XG4gICAgYXJnR3VhcmRzLFxuICAgIG9wdGlvbmFsQXJnR3VhcmRzID0gW10sXG4gICAgcmVzdEFyZ0d1YXJkXG4gIH0gPSBtZXRob2RHdWFyZFBheWxvYWQ7XG4gICFpc0F3YWl0QXJnR3VhcmQocmVzdEFyZ0d1YXJkKSB8fCB0aHJvd1JlZGFjdGVkYFJlc3QgYXJncyBtYXkgbm90IGJlIGF3YWl0ZWQ6ICR7cmVzdEFyZ0d1YXJkfWA7XG4gIGNvbnN0IHJhd0FyZ0d1YXJkcyA9IFsuLi5hcmdHdWFyZHMsIC4uLm9wdGlvbmFsQXJnR3VhcmRzXTtcbiAgY29uc3QgYXdhaXRJbmRleGVzID0gW107XG4gIGZvciAobGV0IGkyID0gMDsgaTIgPCByYXdBcmdHdWFyZHMubGVuZ3RoOyBpMiArPSAxKSB7XG4gICAgY29uc3QgYXJnR3VhcmQgPSByYXdBcmdHdWFyZHNbaTJdO1xuICAgIGlmIChpc0F3YWl0QXJnR3VhcmQoYXJnR3VhcmQpKSB7XG4gICAgICByYXdBcmdHdWFyZHNbaTJdID0gZ2V0QXdhaXRBcmdHdWFyZFBheWxvYWQoYXJnR3VhcmQpLmFyZ0d1YXJkO1xuICAgICAgYXdhaXRJbmRleGVzLnB1c2goaTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4ge1xuICAgIGF3YWl0SW5kZXhlcyxcbiAgICByYXdNZXRob2RHdWFyZFBheWxvYWQ6IHtcbiAgICAgIC4uLm1ldGhvZEd1YXJkUGF5bG9hZCxcbiAgICAgIGFyZ0d1YXJkczogcmF3QXJnR3VhcmRzLnNsaWNlKDAsIGFyZ0d1YXJkcy5sZW5ndGgpLFxuICAgICAgb3B0aW9uYWxBcmdHdWFyZHM6IHJhd0FyZ0d1YXJkcy5zbGljZShhcmdHdWFyZHMubGVuZ3RoKVxuICAgIH1cbiAgfTtcbn07XG52YXIgZGVmZW5kQXN5bmNNZXRob2QgPSAoZ2V0Q29udGV4dCwgYmVoYXZpb3JNZXRob2QsIG1ldGhvZEd1YXJkUGF5bG9hZCwgbGFiZWwpID0+IHtcbiAgY29uc3QgeyByZXR1cm5HdWFyZCB9ID0gbWV0aG9kR3VhcmRQYXlsb2FkO1xuICBjb25zdCBpc1Jhd1JldHVybiA9IGlzUmF3R3VhcmQocmV0dXJuR3VhcmQpO1xuICBjb25zdCB7IGF3YWl0SW5kZXhlcywgcmF3TWV0aG9kR3VhcmRQYXlsb2FkIH0gPSBkZXN5bmMobWV0aG9kR3VhcmRQYXlsb2FkKTtcbiAgY29uc3QgbWF0Y2hDb25maWcgPSBidWlsZE1hdGNoQ29uZmlnKHJhd01ldGhvZEd1YXJkUGF5bG9hZCk7XG4gIGNvbnN0IHsgYXN5bmNNZXRob2QgfSA9IHtcbiAgICAvL1xuICAgIGFzeW5jTWV0aG9kKC4uLmFyZ3MpIHtcbiAgICAgIGNvbnN0IGF3YWl0TGlzdCA9IFtdO1xuICAgICAgZm9yIChjb25zdCBpMiBvZiBhd2FpdEluZGV4ZXMpIHtcbiAgICAgICAgaWYgKGkyID49IGFyZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXRMaXN0LnB1c2goYXJnc1tpMl0pO1xuICAgICAgfVxuICAgICAgY29uc3QgcDMgPSBQcm9taXNlLmFsbChhd2FpdExpc3QpO1xuICAgICAgY29uc3Qgc3luY0FyZ3MgPSBbLi4uYXJnc107XG4gICAgICBjb25zdCByZXN1bHRQID0gRS53aGVuKFxuICAgICAgICBwMyxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIChhd2FpdGVkQXJncykgPT4ge1xuICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYXdhaXRlZEFyZ3MubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgICAgICAgIHN5bmNBcmdzW2F3YWl0SW5kZXhlc1tqXV0gPSBhd2FpdGVkQXJnc1tqXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgY29udGV4dCA9IGdldENvbnRleHQodGhpcyk7XG4gICAgICAgICAgY29uc3QgcmVhbEFyZ3MgPSBkZWZlbmRTeW5jQXJncyhzeW5jQXJncywgbWF0Y2hDb25maWcsIGxhYmVsKTtcbiAgICAgICAgICByZXR1cm4gYXBwbHk0KGJlaGF2aW9yTWV0aG9kLCBjb250ZXh0LCByZWFsQXJncyk7XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gRS53aGVuKHJlc3VsdFAsIChmdWxmaWxsbWVudCkgPT4ge1xuICAgICAgICBpZiAoIWlzUmF3UmV0dXJuKSB7XG4gICAgICAgICAgbXVzdE1hdGNoKGhhcmRlbihmdWxmaWxsbWVudCksIHJldHVybkd1YXJkLCBgJHtsYWJlbH06IHJlc3VsdGApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmdWxmaWxsbWVudDtcbiAgICAgIH0pLmNhdGNoKFxuICAgICAgICAocmVhc29uKSA9PiAoXG4gICAgICAgICAgLy9cbiAgICAgICAgICAvL1xuICAgICAgICAgIFByb21pc2UucmVqZWN0KHRvVGhyb3dhYmxlKHJlYXNvbikpXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfVxuICB9O1xuICByZXR1cm4gYXN5bmNNZXRob2Q7XG59O1xudmFyIGRlZmVuZE1ldGhvZCA9IChnZXRDb250ZXh0LCBiZWhhdmlvck1ldGhvZCwgbWV0aG9kR3VhcmQsIGxhYmVsKSA9PiB7XG4gIGNvbnN0IG1ldGhvZEd1YXJkUGF5bG9hZCA9IGdldE1ldGhvZEd1YXJkUGF5bG9hZChtZXRob2RHdWFyZCk7XG4gIGNvbnN0IHsgY2FsbEtpbmQgfSA9IG1ldGhvZEd1YXJkUGF5bG9hZDtcbiAgaWYgKGNhbGxLaW5kID09PSBcInN5bmNcIikge1xuICAgIHJldHVybiBkZWZlbmRTeW5jTWV0aG9kKFxuICAgICAgZ2V0Q29udGV4dCxcbiAgICAgIGJlaGF2aW9yTWV0aG9kLFxuICAgICAgbWV0aG9kR3VhcmRQYXlsb2FkLFxuICAgICAgbGFiZWxcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIGFzc2VydChjYWxsS2luZCA9PT0gXCJhc3luY1wiKTtcbiAgICByZXR1cm4gZGVmZW5kQXN5bmNNZXRob2QoXG4gICAgICBnZXRDb250ZXh0LFxuICAgICAgYmVoYXZpb3JNZXRob2QsXG4gICAgICBtZXRob2RHdWFyZFBheWxvYWQsXG4gICAgICBsYWJlbFxuICAgICk7XG4gIH1cbn07XG52YXIgYmluZE1ldGhvZCA9IChtZXRob2RUYWcsIGNvbnRleHRQcm92aWRlciwgYmVoYXZpb3JNZXRob2QsIG1ldGhvZEd1YXJkKSA9PiB7XG4gIGFzc2VydC50eXBlb2YoYmVoYXZpb3JNZXRob2QsIFwiZnVuY3Rpb25cIik7XG4gIGNvbnN0IGdldENvbnRleHQgPSAocmVwcmVzZW50YXRpdmUpID0+IHtcbiAgICByZXByZXNlbnRhdGl2ZSB8fCAvL1xuICAgIHRocm93UmVkYWN0ZWRgTWV0aG9kICR7bWV0aG9kVGFnfSBjYWxsZWQgd2l0aG91dCAndGhpcycgb2JqZWN0YDtcbiAgICBjb25zdCBjb250ZXh0ID0gY29udGV4dFByb3ZpZGVyKHJlcHJlc2VudGF0aXZlKTtcbiAgICBpZiAoY29udGV4dCA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoXG4gICAgICAgIG1ldGhvZFRhZ1xuICAgICAgKX0gbWF5IG9ubHkgYmUgYXBwbGllZCB0byBhIHZhbGlkIGluc3RhbmNlOiAke3JlcHJlc2VudGF0aXZlfWA7XG4gICAgfVxuICAgIHJldHVybiBjb250ZXh0O1xuICB9O1xuICBjb25zdCBtZXRob2QgPSBkZWZlbmRNZXRob2QoXG4gICAgZ2V0Q29udGV4dCxcbiAgICBiZWhhdmlvck1ldGhvZCxcbiAgICBtZXRob2RHdWFyZCxcbiAgICBtZXRob2RUYWdcbiAgKTtcbiAgZGVmaW5lUHJvcGVydGllczMobWV0aG9kLCB7XG4gICAgbmFtZTogeyB2YWx1ZTogbWV0aG9kVGFnIH0sXG4gICAgbGVuZ3RoOiB7IHZhbHVlOiBiZWhhdmlvck1ldGhvZC5sZW5ndGggfVxuICB9KTtcbiAgcmV0dXJuIG1ldGhvZDtcbn07XG52YXIgZGVmZW5kUHJvdG90eXBlID0gKHRhZywgY29udGV4dFByb3ZpZGVyLCBiZWhhdmlvck1ldGhvZHMsIHRoaXNmdWxNZXRob2RzID0gZmFsc2UsIGludGVyZmFjZUd1YXJkID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IHByb3RvdHlwZSA9IHt9O1xuICBjb25zdCBtZXRob2ROYW1lcyA9IGdldE1ldGhvZE5hbWVzKGJlaGF2aW9yTWV0aG9kcykuZmlsdGVyKFxuICAgIC8vXG4gICAgLy9cbiAgICAoa2V5KSA9PiB7XG4gICAgICBpZiAoa2V5ICE9PSBcImNvbnN0cnVjdG9yXCIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBjb25zdCBjb25zdHJ1Y3RvciA9IGJlaGF2aW9yTWV0aG9kcy5jb25zdHJ1Y3RvcjtcbiAgICAgIHJldHVybiAhKGNvbnN0cnVjdG9yLnByb3RvdHlwZSAmJiBjb25zdHJ1Y3Rvci5wcm90b3R5cGUuY29uc3RydWN0b3IgPT09IGNvbnN0cnVjdG9yKTtcbiAgICB9XG4gICk7XG4gIGxldCBtZXRob2RHdWFyZHM7XG4gIGxldCBkZWZhdWx0R3VhcmRzO1xuICBpZiAoaW50ZXJmYWNlR3VhcmQpIHtcbiAgICBjb25zdCB7XG4gICAgICBpbnRlcmZhY2VOYW1lLFxuICAgICAgbWV0aG9kR3VhcmRzOiBtZyxcbiAgICAgIHN5bWJvbE1ldGhvZEd1YXJkcyxcbiAgICAgIHNsb3BweSxcbiAgICAgIGRlZmF1bHRHdWFyZHM6IGRnID0gc2xvcHB5ID8gXCJwYXNzYWJsZVwiIDogZGVmYXVsdEd1YXJkc1xuICAgIH0gPSBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoaW50ZXJmYWNlR3VhcmQpO1xuICAgIG1ldGhvZEd1YXJkcyA9IGhhcmRlbih7XG4gICAgICAuLi5tZyxcbiAgICAgIC4uLihzeW1ib2xNZXRob2RHdWFyZHMmJiBmcm9tRW50cmllczgoZ2V0Q29weU1hcEVudHJpZXMoc3ltYm9sTWV0aG9kR3VhcmRzKSkpXG4gICAgfSk7XG4gICAgZGVmYXVsdEd1YXJkcyA9IGRnO1xuICAgIHtcbiAgICAgIGNvbnN0IG1ldGhvZEd1YXJkTmFtZXMgPSBvd25LZXlzMTgobWV0aG9kR3VhcmRzKTtcbiAgICAgIGNvbnN0IHVuaW1wbGVtZW50ZWQgPSBsaXN0RGlmZmVyZW5jZShtZXRob2RHdWFyZE5hbWVzLCBtZXRob2ROYW1lcyk7XG4gICAgICB1bmltcGxlbWVudGVkLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZHMgJHtxdW90ZSh1bmltcGxlbWVudGVkKX0gbm90IGltcGxlbWVudGVkIGJ5ICR7cXVvdGUodGFnKX1gO1xuICAgICAgaWYgKGRlZmF1bHRHdWFyZHMgPT09IHZvaWQgMCkge1xuICAgICAgICBjb25zdCB1bmd1YXJkZWQgPSBsaXN0RGlmZmVyZW5jZShtZXRob2ROYW1lcywgbWV0aG9kR3VhcmROYW1lcyk7XG4gICAgICAgIHVuZ3VhcmRlZC5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBtZXRob2RzICR7cXVvdGUodW5ndWFyZGVkKX0gbm90IGd1YXJkZWQgYnkgJHtxdW90ZShpbnRlcmZhY2VOYW1lKX1gO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBmb3IgKGNvbnN0IHByb3Agb2YgbWV0aG9kTmFtZXMpIHtcbiAgICBjb25zdCBvcmlnaW5hbE1ldGhvZCA9IGJlaGF2aW9yTWV0aG9kc1twcm9wXTtcbiAgICBjb25zdCB7IHNoaWZ0ZWRNZXRob2QgfSA9IHtcbiAgICAgIHNoaWZ0ZWRNZXRob2QoLi4uYXJncykge1xuICAgICAgICByZXR1cm4gb3JpZ2luYWxNZXRob2QodGhpcywgLi4uYXJncyk7XG4gICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBiZWhhdmlvck1ldGhvZCA9IHRoaXNmdWxNZXRob2RzID8gb3JpZ2luYWxNZXRob2QgOiBzaGlmdGVkTWV0aG9kO1xuICAgIGxldCBtZXRob2RHdWFyZCA9IG1ldGhvZEd1YXJkcyAmJiBtZXRob2RHdWFyZHNbcHJvcF07XG4gICAgaWYgKCFtZXRob2RHdWFyZCkge1xuICAgICAgc3dpdGNoIChkZWZhdWx0R3VhcmRzKSB7XG4gICAgICAgIGNhc2Ugdm9pZCAwOiB7XG4gICAgICAgICAgaWYgKHRoaXNmdWxNZXRob2RzKSB7XG4gICAgICAgICAgICBtZXRob2RHdWFyZCA9IFBhc3NhYmxlTWV0aG9kR3VhcmQ7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1ldGhvZEd1YXJkID0gUmF3TWV0aG9kR3VhcmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJwYXNzYWJsZVwiOiB7XG4gICAgICAgICAgbWV0aG9kR3VhcmQgPSBQYXNzYWJsZU1ldGhvZEd1YXJkO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJyYXdcIjoge1xuICAgICAgICAgIG1ldGhvZEd1YXJkID0gUmF3TWV0aG9kR3VhcmQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIGRlZmF1bHRHdWFyZHMgJHtxdW90ZShkZWZhdWx0R3VhcmRzKX1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHByb3RvdHlwZVtwcm9wXSA9IGJpbmRNZXRob2QoXG4gICAgICBgSW4gJHtxdW90ZShwcm9wKX0gbWV0aG9kIG9mICgke3RhZ30pYCxcbiAgICAgIGNvbnRleHRQcm92aWRlcixcbiAgICAgIGJlaGF2aW9yTWV0aG9kLFxuICAgICAgbWV0aG9kR3VhcmRcbiAgICApO1xuICB9XG4gIGlmICghaGFzT3duUHJvcGVydHlPZihwcm90b3R5cGUsIEdFVF9JTlRFUkZBQ0VfR1VBUkQpKSB7XG4gICAgY29uc3QgZ2V0SW50ZXJmYWNlR3VhcmRNZXRob2QgPSB7XG4gICAgICBbR0VUX0lOVEVSRkFDRV9HVUFSRF0oKSB7XG4gICAgICAgIHJldHVybiBpbnRlcmZhY2VHdWFyZDtcbiAgICAgIH1cbiAgICB9W0dFVF9JTlRFUkZBQ0VfR1VBUkRdO1xuICAgIHByb3RvdHlwZVtHRVRfSU5URVJGQUNFX0dVQVJEXSA9IGJpbmRNZXRob2QoXG4gICAgICBgSW4gJHtxdW90ZShHRVRfSU5URVJGQUNFX0dVQVJEKX0gbWV0aG9kIG9mICgke3RhZ30pYCxcbiAgICAgIGNvbnRleHRQcm92aWRlcixcbiAgICAgIGdldEludGVyZmFjZUd1YXJkTWV0aG9kLFxuICAgICAgUGFzc2FibGVNZXRob2RHdWFyZFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIEZhcihcbiAgICB0YWcsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBwcm90b3R5cGVcbiAgKTtcbn07XG5oYXJkZW4oZGVmZW5kUHJvdG90eXBlKTtcbnZhciBkZWZlbmRQcm90b3R5cGVLaXQgPSAodGFnLCBjb250ZXh0UHJvdmlkZXJLaXQsIGJlaGF2aW9yTWV0aG9kc0tpdCwgdGhpc2Z1bE1ldGhvZHMgPSBmYWxzZSwgaW50ZXJmYWNlR3VhcmRLaXQgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgZmFjZXROYW1lcyA9IG93bktleXMxOChiZWhhdmlvck1ldGhvZHNLaXQpLnNvcnQoKTtcbiAgZmFjZXROYW1lcy5sZW5ndGggPiAxIHx8IHRocm93UmVkYWN0ZWRgQSBtdWx0aS1mYWNldCBvYmplY3QgbXVzdCBoYXZlIG11bHRpcGxlIGZhY2V0c2A7XG4gIGlmIChpbnRlcmZhY2VHdWFyZEtpdCkge1xuICAgIGNvbnN0IGludGVyZmFjZU5hbWVzID0gb3duS2V5czE4KGludGVyZmFjZUd1YXJkS2l0KTtcbiAgICBjb25zdCBleHRyYUludGVyZmFjZU5hbWVzID0gbGlzdERpZmZlcmVuY2UoZmFjZXROYW1lcywgaW50ZXJmYWNlTmFtZXMpO1xuICAgIGV4dHJhSW50ZXJmYWNlTmFtZXMubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJmYWNlcyAke3F1b3RlKGV4dHJhSW50ZXJmYWNlTmFtZXMpfSBub3QgaW1wbGVtZW50ZWQgYnkgJHtxdW90ZSh0YWcpfWA7XG4gICAgY29uc3QgZXh0cmFGYWNldE5hbWVzMiA9IGxpc3REaWZmZXJlbmNlKGludGVyZmFjZU5hbWVzLCBmYWNldE5hbWVzKTtcbiAgICBleHRyYUZhY2V0TmFtZXMyLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYEZhY2V0cyAke3F1b3RlKGV4dHJhRmFjZXROYW1lczIpfSBvZiAke3F1b3RlKHRhZyl9IG5vdCBndWFyZGVkIGJ5IGludGVyZmFjZXNgO1xuICB9XG4gIGNvbnN0IGNvbnRleHRNYXBOYW1lcyA9IG93bktleXMxOChjb250ZXh0UHJvdmlkZXJLaXQpO1xuICBjb25zdCBleHRyYUNvbnRleHROYW1lcyA9IGxpc3REaWZmZXJlbmNlKGZhY2V0TmFtZXMsIGNvbnRleHRNYXBOYW1lcyk7XG4gIGV4dHJhQ29udGV4dE5hbWVzLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYENvbnRleHRzICR7cXVvdGUoZXh0cmFDb250ZXh0TmFtZXMpfSBub3QgaW1wbGVtZW50ZWQgYnkgJHtxdW90ZSh0YWcpfWA7XG4gIGNvbnN0IGV4dHJhRmFjZXROYW1lcyA9IGxpc3REaWZmZXJlbmNlKGNvbnRleHRNYXBOYW1lcywgZmFjZXROYW1lcyk7XG4gIGV4dHJhRmFjZXROYW1lcy5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBGYWNldHMgJHtxdW90ZShleHRyYUZhY2V0TmFtZXMpfSBvZiAke3F1b3RlKHRhZyl9IG1pc3NpbmcgY29udGV4dHNgO1xuICBjb25zdCBwcm90b0tpdCA9IG9iamVjdE1hcChcbiAgICBiZWhhdmlvck1ldGhvZHNLaXQsXG4gICAgKGJlaGF2aW9yTWV0aG9kcywgZmFjZXROYW1lKSA9PiBkZWZlbmRQcm90b3R5cGUoXG4gICAgICBgJHt0YWd9ICR7U3RyaW5nKGZhY2V0TmFtZSl9YCxcbiAgICAgIGNvbnRleHRQcm92aWRlcktpdFtmYWNldE5hbWVdLFxuICAgICAgYmVoYXZpb3JNZXRob2RzLFxuICAgICAgdGhpc2Z1bE1ldGhvZHMsXG4gICAgICBpbnRlcmZhY2VHdWFyZEtpdCAmJiBpbnRlcmZhY2VHdWFyZEtpdFtmYWNldE5hbWVdXG4gICAgKVxuICApO1xuICByZXR1cm4gcHJvdG9LaXQ7XG59O1xuXG4vL1xudmFyIHsgY3JlYXRlOiBjcmVhdGUzLCBzZWFsLCBmcmVlemU6IGZyZWV6ZTcsIGRlZmluZVByb3BlcnR5LCB2YWx1ZXM6IHZhbHVlczMgfSA9IE9iamVjdDtcbnZhciBMQUJFTF9JTlNUQU5DRVMgPSBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzKFwiREVCVUdcIiwgXCJsYWJlbC1pbnN0YW5jZXNcIik7XG52YXIgbWFrZVNlbGYgPSAocHJvdG8sIGluc3RhbmNlQ291bnQpID0+IHtcbiAgY29uc3Qgc2VsZiA9IGNyZWF0ZTMocHJvdG8pO1xuICBpZiAoTEFCRUxfSU5TVEFOQ0VTKSB7XG4gICAgZGVmaW5lUHJvcGVydHkoc2VsZiwgU3ltYm9sLnRvU3RyaW5nVGFnLCB7XG4gICAgICB2YWx1ZTogYCR7cHJvdG9bU3ltYm9sLnRvU3RyaW5nVGFnXX0jJHtpbnN0YW5jZUNvdW50fWAsXG4gICAgICB3cml0YWJsZTogZmFsc2UsXG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2VcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gaGFyZGVuKHNlbGYpO1xufTtcbnZhciBlbXB0eVJlY29yZCA9IGhhcmRlbih7fSk7XG52YXIgaW5pdEVtcHR5ID0gKCkgPT4gZW1wdHlSZWNvcmQ7XG52YXIgZGVmaW5lRXhvQ2xhc3MgPSAodGFnLCBpbnRlcmZhY2VHdWFyZCwgaW5pdCwgbWV0aG9kcywgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGhhcmRlbihtZXRob2RzKTtcbiAgY29uc3Qge1xuICAgIGZpbmlzaCA9IHZvaWQgMCxcbiAgICByZWNlaXZlQW1wbGlmaWVyID0gdm9pZCAwLFxuICAgIHJlY2VpdmVJbnN0YW5jZVRlc3RlciA9IHZvaWQgMFxuICB9ID0gb3B0aW9ucztcbiAgcmVjZWl2ZUFtcGxpZmllciA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgT25seSBmYWNldHMgb2YgYW4gZXhvIGNsYXNzIGtpdCBjYW4gYmUgYW1wbGlmaWVkICR7cXVvdGUodGFnKX1gO1xuICBjb25zdCBjb250ZXh0TWFwID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IHByb3RvID0gZGVmZW5kUHJvdG90eXBlKFxuICAgIHRhZyxcbiAgICAoc2VsZikgPT4gKFxuICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICBjb250ZXh0TWFwLmdldChzZWxmKVxuICAgICksXG4gICAgbWV0aG9kcyxcbiAgICB0cnVlLFxuICAgIGludGVyZmFjZUd1YXJkXG4gICk7XG4gIGxldCBpbnN0YW5jZUNvdW50ID0gMDtcbiAgY29uc3QgbWFrZUluc3RhbmNlID0gKC4uLmFyZ3MpID0+IHtcbiAgICBjb25zdCBzdGF0ZSA9IHNlYWwoaW5pdCguLi5hcmdzKSk7XG4gICAgaW5zdGFuY2VDb3VudCArPSAxO1xuICAgIGNvbnN0IHNlbGYgPSBtYWtlU2VsZihwcm90bywgaW5zdGFuY2VDb3VudCk7XG4gICAgY29uc3QgY29udGV4dCA9IGZyZWV6ZTcoeyBzdGF0ZSwgc2VsZiB9KTtcbiAgICBjb250ZXh0TWFwLnNldChzZWxmLCBjb250ZXh0KTtcbiAgICBpZiAoZmluaXNoKSB7XG4gICAgICBmaW5pc2goY29udGV4dCk7XG4gICAgfVxuICAgIHJldHVybiBzZWxmO1xuICB9O1xuICBpZiAocmVjZWl2ZUluc3RhbmNlVGVzdGVyKSB7XG4gICAgY29uc3QgaXNJbnN0YW5jZSA9IChleG8sIGZhY2V0TmFtZSA9IHZvaWQgMCkgPT4ge1xuICAgICAgZmFjZXROYW1lID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBmYWNldE5hbWUgY2FuIG9ubHkgYmUgdXNlZCB3aXRoIGFuIGV4byBjbGFzcyBraXQ6ICR7cXVvdGUoXG4gICAgICAgIHRhZ1xuICAgICAgKX0gaGFzIG5vIGZhY2V0ICR7cXVvdGUoZmFjZXROYW1lKX1gO1xuICAgICAgcmV0dXJuIGNvbnRleHRNYXAuaGFzKGV4byk7XG4gICAgfTtcbiAgICBoYXJkZW4oaXNJbnN0YW5jZSk7XG4gICAgcmVjZWl2ZUluc3RhbmNlVGVzdGVyKGlzSW5zdGFuY2UpO1xuICB9XG4gIHJldHVybiBoYXJkZW4obWFrZUluc3RhbmNlKTtcbn07XG5oYXJkZW4oZGVmaW5lRXhvQ2xhc3MpO1xudmFyIGRlZmluZUV4b0NsYXNzS2l0ID0gKHRhZywgaW50ZXJmYWNlR3VhcmRLaXQsIGluaXQsIG1ldGhvZHNLaXQsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICBoYXJkZW4obWV0aG9kc0tpdCk7XG4gIGNvbnN0IHtcbiAgICBmaW5pc2ggPSB2b2lkIDAsXG4gICAgcmVjZWl2ZUFtcGxpZmllciA9IHZvaWQgMCxcbiAgICByZWNlaXZlSW5zdGFuY2VUZXN0ZXIgPSB2b2lkIDBcbiAgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IGNvbnRleHRNYXBLaXQgPSBvYmplY3RNYXAobWV0aG9kc0tpdCwgKCkgPT4gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCkpO1xuICBjb25zdCBnZXRDb250ZXh0S2l0ID0gb2JqZWN0TWFwKFxuICAgIGNvbnRleHRNYXBLaXQsXG4gICAgKGNvbnRleHRNYXApID0+IChmYWNldCkgPT4gY29udGV4dE1hcC5nZXQoZmFjZXQpXG4gICk7XG4gIGNvbnN0IHByb3RvdHlwZUtpdCA9IGRlZmVuZFByb3RvdHlwZUtpdChcbiAgICB0YWcsXG4gICAgZ2V0Q29udGV4dEtpdCxcbiAgICBtZXRob2RzS2l0LFxuICAgIHRydWUsXG4gICAgaW50ZXJmYWNlR3VhcmRLaXRcbiAgKTtcbiAgbGV0IGluc3RhbmNlQ291bnQgPSAwO1xuICBjb25zdCBtYWtlSW5zdGFuY2VLaXQgPSAoLi4uYXJncykgPT4ge1xuICAgIGNvbnN0IHN0YXRlID0gc2VhbChpbml0KC4uLmFyZ3MpKTtcbiAgICBjb25zdCBjb250ZXh0ID0geyBzdGF0ZSwgZmFjZXRzOiBudWxsIH07XG4gICAgaW5zdGFuY2VDb3VudCArPSAxO1xuICAgIGNvbnN0IGZhY2V0cyA9IG9iamVjdE1hcChwcm90b3R5cGVLaXQsIChwcm90bywgZmFjZXROYW1lKSA9PiB7XG4gICAgICBjb25zdCBzZWxmID0gbWFrZVNlbGYocHJvdG8sIGluc3RhbmNlQ291bnQpO1xuICAgICAgY29udGV4dE1hcEtpdFtmYWNldE5hbWVdLnNldChzZWxmLCBjb250ZXh0KTtcbiAgICAgIHJldHVybiBzZWxmO1xuICAgIH0pO1xuICAgIGNvbnRleHQuZmFjZXRzID0gZmFjZXRzO1xuICAgIGZyZWV6ZTcoY29udGV4dCk7XG4gICAgaWYgKGZpbmlzaCkge1xuICAgICAgZmluaXNoKGNvbnRleHQpO1xuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgY29udGV4dC5mYWNldHNcbiAgICApO1xuICB9O1xuICBpZiAocmVjZWl2ZUFtcGxpZmllcikge1xuICAgIGNvbnN0IGFtcGxpZnkgPSAoZXhvRmFjZXQpID0+IHtcbiAgICAgIGZvciAoY29uc3QgY29udGV4dE1hcCBvZiB2YWx1ZXMzKGNvbnRleHRNYXBLaXQpKSB7XG4gICAgICAgIGlmIChjb250ZXh0TWFwLmhhcyhleG9GYWNldCkpIHtcbiAgICAgICAgICBjb25zdCB7IGZhY2V0cyB9ID0gY29udGV4dE1hcC5nZXQoZXhvRmFjZXQpO1xuICAgICAgICAgIHJldHVybiBmYWNldHM7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgTXVzdCBiZSBhIGZhY2V0IG9mICR7cXVvdGUodGFnKX06ICR7ZXhvRmFjZXR9YDtcbiAgICB9O1xuICAgIGhhcmRlbihhbXBsaWZ5KTtcbiAgICByZWNlaXZlQW1wbGlmaWVyKGFtcGxpZnkpO1xuICB9XG4gIGlmIChyZWNlaXZlSW5zdGFuY2VUZXN0ZXIpIHtcbiAgICBjb25zdCBpc0luc3RhbmNlID0gKGV4b0ZhY2V0LCBmYWNldE5hbWUgPSB2b2lkIDApID0+IHtcbiAgICAgIGlmIChmYWNldE5hbWUgPT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gdmFsdWVzMyhjb250ZXh0TWFwS2l0KS5zb21lKFxuICAgICAgICAgIChjb250ZXh0TWFwMikgPT4gY29udGV4dE1hcDIuaGFzKGV4b0ZhY2V0KVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgYXNzZXJ0LnR5cGVvZihmYWNldE5hbWUsIFwic3RyaW5nXCIpO1xuICAgICAgY29uc3QgY29udGV4dE1hcCA9IGNvbnRleHRNYXBLaXRbZmFjZXROYW1lXTtcbiAgICAgIGNvbnRleHRNYXAgIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYGV4byBjbGFzcyBraXQgJHtxdW90ZSh0YWcpfSBoYXMgbm8gZmFjZXQgbmFtZWQgJHtxdW90ZShmYWNldE5hbWUpfWA7XG4gICAgICByZXR1cm4gY29udGV4dE1hcC5oYXMoZXhvRmFjZXQpO1xuICAgIH07XG4gICAgaGFyZGVuKGlzSW5zdGFuY2UpO1xuICAgIHJlY2VpdmVJbnN0YW5jZVRlc3Rlcihpc0luc3RhbmNlKTtcbiAgfVxuICByZXR1cm4gaGFyZGVuKG1ha2VJbnN0YW5jZUtpdCk7XG59O1xuaGFyZGVuKGRlZmluZUV4b0NsYXNzS2l0KTtcbnZhciBtYWtlRXhvID0gKHRhZywgaW50ZXJmYWNlR3VhcmQsIG1ldGhvZHMsIG9wdGlvbnMgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgbWFrZUluc3RhbmNlID0gZGVmaW5lRXhvQ2xhc3MoXG4gICAgdGFnLFxuICAgIGludGVyZmFjZUd1YXJkLFxuICAgIGluaXRFbXB0eSxcbiAgICBtZXRob2RzLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgcmV0dXJuIG1ha2VJbnN0YW5jZSgpO1xufTtcbmhhcmRlbihtYWtlRXhvKTtcblxuLy9cbnZhciBtYWtlTGVnYWN5TWFwID0gKHRhZyA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgbTIgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBjb25zdCBhc3NlcnRLZXlEb2VzTm90RXhpc3QgPSAoa2V5KSA9PiAhbTIuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKHRhZyl9IGFscmVhZHkgcmVnaXN0ZXJlZDogJHtrZXl9YDtcbiAgY29uc3QgYXNzZXJ0S2V5RXhpc3RzID0gKGtleSkgPT4gbTIuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKHRhZyl9IG5vdCBmb3VuZDogJHtrZXl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgaGFzOiAoa2V5KSA9PiB7XG4gICAgICByZXR1cm4gbTIuaGFzKGtleSk7XG4gICAgfSxcbiAgICBpbml0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RG9lc05vdEV4aXN0KGtleSk7XG4gICAgICBtMi5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBnZXQ6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgcmV0dXJuIG0yLmdldChrZXkpO1xuICAgIH0sXG4gICAgc2V0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBtMi5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgbTIuZGVsZXRlKGtleSk7XG4gICAgfSxcbiAgICBrZXlzOiAoKSA9PiBtMi5rZXlzKCksXG4gICAgdmFsdWVzOiAoKSA9PiBtMi52YWx1ZXMoKSxcbiAgICBlbnRyaWVzOiAoKSA9PiBtMi5lbnRyaWVzKCksXG4gICAgZ2V0U2l6ZTogKCkgPT4gbTIuc2l6ZSxcbiAgICBjbGVhcjogKCkgPT4gbTIuY2xlYXIoKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUxlZ2FjeU1hcCk7XG5cbi8vXG52YXIgbWFrZUxlZ2FjeVdlYWtNYXAgPSAodGFnID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCB3bSA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCBhc3NlcnRLZXlEb2VzTm90RXhpc3QgPSAoa2V5KSA9PiAhd20uaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKHRhZyl9IGFscmVhZHkgcmVnaXN0ZXJlZDogJHtrZXl9YDtcbiAgY29uc3QgYXNzZXJ0S2V5RXhpc3RzID0gKGtleSkgPT4gd20uaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKHRhZyl9IG5vdCBmb3VuZDogJHtrZXl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgaGFzOiAoa2V5KSA9PiB7XG4gICAgICByZXR1cm4gd20uaGFzKGtleSk7XG4gICAgfSxcbiAgICBpbml0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RG9lc05vdEV4aXN0KGtleSk7XG4gICAgICB3bS5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBnZXQ6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgICB3bS5nZXQoa2V5KVxuICAgICAgKTtcbiAgICB9LFxuICAgIHNldDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgd20uc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZGVsZXRlOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIHdtLmRlbGV0ZShrZXkpO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VMZWdhY3lXZWFrTWFwKTtcblxuLy9cbnZhciBtdXN0TWF0Y2gyID0gbXVzdE1hdGNoO1xuXG4vL1xudmFyIGVtcHR5ID0gMG47XG52YXIgbmF0TWF0aEhlbHBlcnMgPSBoYXJkZW4oe1xuICBkb0NvZXJjZTogKG5hdCkgPT4ge1xuICAgIGFzc2VydC50eXBlb2YobmF0LCBcImJpZ2ludFwiKTtcbiAgICBpc05hdChuYXQpIHx8IHRocm93UmVkYWN0ZWRgdmFsdWUgJHtuYXR9IG11c3QgYmUgYSBuYXR1cmFsIG51bWJlcmA7XG4gICAgcmV0dXJuIE5hdChuYXQpO1xuICB9LFxuICBkb01ha2VFbXB0eTogKCkgPT4gZW1wdHksXG4gIGRvSXNFbXB0eTogKG5hdCkgPT4gbmF0ID09PSBlbXB0eSxcbiAgZG9Jc0dURTogKGxlZnQsIHJpZ2h0KSA9PiBsZWZ0ID49IHJpZ2h0LFxuICBkb0lzRXF1YWw6IChsZWZ0LCByaWdodCkgPT4gbGVmdCA9PT0gcmlnaHQsXG4gIC8vXG4gIGRvQWRkOiAobGVmdCwgcmlnaHQpID0+IGxlZnQgKyByaWdodCxcbiAgZG9TdWJ0cmFjdDogKGxlZnQsIHJpZ2h0KSA9PiBOYXQobGVmdCAtIHJpZ2h0KVxufSk7XG5cbi8vXG52YXIgZW1wdHkyID0gaGFyZGVuKFtdKTtcbnZhciBzZXRNYXRoSGVscGVycyA9IGhhcmRlbih7XG4gIGRvQ29lcmNlOiAobGlzdCkgPT4ge1xuICAgIGxpc3QgPSBjb2VyY2VUb0VsZW1lbnRzKGxpc3QpO1xuICAgIGFzc2VydEtleShsaXN0KTtcbiAgICByZXR1cm4gbGlzdDtcbiAgfSxcbiAgZG9NYWtlRW1wdHk6ICgpID0+IGVtcHR5MixcbiAgZG9Jc0VtcHR5OiAobGlzdCkgPT4gcGFzc1N0eWxlT2YobGlzdCkgPT09IFwiY29weUFycmF5XCIgJiYgbGlzdC5sZW5ndGggPT09IDAsXG4gIGRvSXNHVEU6IGVsZW1lbnRzSXNTdXBlcnNldCxcbiAgZG9Jc0VxdWFsOiAoeCwgeSkgPT4gZWxlbWVudHNDb21wYXJlKHgsIHkpID09PSAwLFxuICBkb0FkZDogZWxlbWVudHNEaXNqb2ludFVuaW9uLFxuICBkb1N1YnRyYWN0OiBlbGVtZW50c0Rpc2pvaW50U3VidHJhY3Rcbn0pO1xuXG4vL1xudmFyIGVtcHR5MyA9IG1ha2VDb3B5U2V0KFtdKTtcbnZhciBjb3B5U2V0TWF0aEhlbHBlcnMgPSBoYXJkZW4oe1xuICBkb0NvZXJjZTogKHNldCkgPT4ge1xuICAgIG11c3RNYXRjaDIoc2V0LCBNLnNldCgpLCBcInNldCBvZiBhbW91bnRcIik7XG4gICAgcmV0dXJuIHNldDtcbiAgfSxcbiAgZG9NYWtlRW1wdHk6ICgpID0+IGVtcHR5MyxcbiAgZG9Jc0VtcHR5OiAoc2V0KSA9PiBnZXRDb3B5U2V0S2V5cyhzZXQpLmxlbmd0aCA9PT0gMCxcbiAgZG9Jc0dURTogc2V0SXNTdXBlcnNldCxcbiAgZG9Jc0VxdWFsOiBrZXlFUSxcbiAgZG9BZGQ6IHNldERpc2pvaW50VW5pb24sXG4gIGRvU3VidHJhY3Q6IHNldERpc2pvaW50U3VidHJhY3Rcbn0pO1xuXG4vL1xudmFyIGVtcHR5NCA9IG1ha2VDb3B5QmFnKFtdKTtcbnZhciBjb3B5QmFnTWF0aEhlbHBlcnMgPSBoYXJkZW4oe1xuICBkb0NvZXJjZTogKGJhZykgPT4ge1xuICAgIG11c3RNYXRjaDIoYmFnLCBNLmJhZygpLCBcImJhZyBvZiBhbW91bnRcIik7XG4gICAgcmV0dXJuIGJhZztcbiAgfSxcbiAgZG9NYWtlRW1wdHk6ICgpID0+IGVtcHR5NCxcbiAgZG9Jc0VtcHR5OiAoYmFnKSA9PiBnZXRDb3B5QmFnRW50cmllcyhiYWcpLmxlbmd0aCA9PT0gMCxcbiAgZG9Jc0dURTogYmFnSXNTdXBlcmJhZyxcbiAgZG9Jc0VxdWFsOiBrZXlFUSxcbiAgZG9BZGQ6IGJhZ1VuaW9uLFxuICBkb1N1YnRyYWN0OiBiYWdEaXNqb2ludFN1YnRyYWN0XG59KTtcblxuLy9cbnZhciBBc3NldEtpbmQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBOQVQ6IFwibmF0XCIsXG4gICAgU0VUOiBcInNldFwiLFxuICAgIENPUFlfU0VUOiBcImNvcHlTZXRcIixcbiAgICBDT1BZX0JBRzogXCJjb3B5QmFnXCJcbiAgfVxuKTtcbmhhcmRlbihBc3NldEtpbmQpO1xudmFyIGFzc2V0S2luZE5hbWVzID0gaGFyZGVuKE9iamVjdC52YWx1ZXMoQXNzZXRLaW5kKS5zb3J0KCkpO1xudmFyIGFzc2VydEFzc2V0S2luZCA9IChhbGxlZ2VkQUspID0+IHtcbiAgYXNzZXRLaW5kTmFtZXMuaW5jbHVkZXMoYWxsZWdlZEFLKSB8fCB0aHJvd1JlZGFjdGVkYFRoZSBhc3NldEtpbmQgJHthbGxlZ2VkQUt9IG11c3QgYmUgb25lIG9mICR7cXVvdGUoYXNzZXRLaW5kTmFtZXMpfWA7XG59O1xuaGFyZGVuKGFzc2VydEFzc2V0S2luZCk7XG52YXIgaGVscGVycyA9IHtcbiAgbmF0OiBuYXRNYXRoSGVscGVycyxcbiAgc2V0OiBzZXRNYXRoSGVscGVycyxcbiAgY29weVNldDogY29weVNldE1hdGhIZWxwZXJzLFxuICBjb3B5QmFnOiBjb3B5QmFnTWF0aEhlbHBlcnNcbn07XG52YXIgYXNzZXJ0VmFsdWVHZXRBc3NldEtpbmQgPSAodmFsdWUpID0+IHtcbiAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YodmFsdWUpO1xuICBpZiAocGFzc1N0eWxlID09PSBcImJpZ2ludFwiKSB7XG4gICAgcmV0dXJuIFwibmF0XCI7XG4gIH1cbiAgaWYgKHBhc3NTdHlsZSA9PT0gXCJjb3B5QXJyYXlcIikge1xuICAgIHJldHVybiBcInNldFwiO1xuICB9XG4gIGlmIChtYXRjaGVzKHZhbHVlLCBNLnNldCgpKSkge1xuICAgIHJldHVybiBcImNvcHlTZXRcIjtcbiAgfVxuICBpZiAobWF0Y2hlcyh2YWx1ZSwgTS5iYWcoKSkpIHtcbiAgICByZXR1cm4gXCJjb3B5QmFnXCI7XG4gIH1cbiAgdGhyb3cgdGhyb3dSZWRhY3RlZGB2YWx1ZSAke3ZhbHVlfSBtdXN0IGJlIGEgYmlnaW50LCBjb3B5U2V0LCBjb3B5QmFnLCBvciBhbiBhcnJheSwgbm90ICR7cXVvdGUoXG4gICAgcGFzc1N0eWxlXG4gICl9YDtcbn07XG52YXIgYXNzZXJ0VmFsdWVHZXRIZWxwZXJzID0gKHZhbHVlKSA9PiAoXG4gIC8vXG4gIGhlbHBlcnNbYXNzZXJ0VmFsdWVHZXRBc3NldEtpbmQodmFsdWUpXVxuKTtcbnZhciBvcHRpb25hbEJyYW5kQ2hlY2sgPSAoYWxsZWdlZEJyYW5kLCBicmFuZCkgPT4ge1xuICBpZiAoYnJhbmQgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFJlbW90YWJsZShicmFuZCwgXCJicmFuZFwiKTtcbiAgICBhbGxlZ2VkQnJhbmQgPT09IGJyYW5kIHx8IHRocm93UmVkYWN0ZWRgYW1vdW50J3MgYnJhbmQgJHtxdW90ZShhbGxlZ2VkQnJhbmQpfSBkaWQgbm90IG1hdGNoIGV4cGVjdGVkIGJyYW5kICR7cXVvdGUoXG4gICAgICBicmFuZFxuICAgICl9YDtcbiAgfVxufTtcbnZhciBjaGVja0xSQW5kR2V0SGVscGVycyA9IChsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQgPSB2b2lkIDApID0+IHtcbiAgYXNzZXJ0UmVjb3JkKGxlZnRBbW91bnQsIFwibGVmdEFtb3VudFwiKTtcbiAgYXNzZXJ0UmVjb3JkKHJpZ2h0QW1vdW50LCBcInJpZ2h0QW1vdW50XCIpO1xuICBjb25zdCB7IHZhbHVlOiBsZWZ0VmFsdWUsIGJyYW5kOiBsZWZ0QnJhbmQgfSA9IGxlZnRBbW91bnQ7XG4gIGNvbnN0IHsgdmFsdWU6IHJpZ2h0VmFsdWUsIGJyYW5kOiByaWdodEJyYW5kIH0gPSByaWdodEFtb3VudDtcbiAgYXNzZXJ0UmVtb3RhYmxlKGxlZnRCcmFuZCwgXCJsZWZ0QnJhbmRcIik7XG4gIGFzc2VydFJlbW90YWJsZShyaWdodEJyYW5kLCBcInJpZ2h0QnJhbmRcIik7XG4gIG9wdGlvbmFsQnJhbmRDaGVjayhsZWZ0QnJhbmQsIGJyYW5kKTtcbiAgb3B0aW9uYWxCcmFuZENoZWNrKHJpZ2h0QnJhbmQsIGJyYW5kKTtcbiAgbGVmdEJyYW5kID09PSByaWdodEJyYW5kIHx8IHRocm93UmVkYWN0ZWRgQnJhbmRzIGluIGxlZnQgJHtxdW90ZShsZWZ0QnJhbmQpfSBhbmQgcmlnaHQgJHtxdW90ZShcbiAgICByaWdodEJyYW5kXG4gICl9IHNob3VsZCBtYXRjaCBidXQgZG8gbm90YDtcbiAgY29uc3QgbGVmdEhlbHBlcnMgPSBhc3NlcnRWYWx1ZUdldEhlbHBlcnMobGVmdFZhbHVlKTtcbiAgY29uc3QgcmlnaHRIZWxwZXJzID0gYXNzZXJ0VmFsdWVHZXRIZWxwZXJzKHJpZ2h0VmFsdWUpO1xuICBsZWZ0SGVscGVycyA9PT0gcmlnaHRIZWxwZXJzIHx8IHRocm93UmVkYWN0ZWRgVGhlIGxlZnQgJHtsZWZ0QW1vdW50fSBhbmQgcmlnaHQgYW1vdW50ICR7cmlnaHRBbW91bnR9IGhhZCBkaWZmZXJlbnQgYXNzZXRLaW5kc2A7XG4gIHJldHVybiBsZWZ0SGVscGVycztcbn07XG52YXIgY29lcmNlTFIgPSAoaCwgbGVmdEFtb3VudCwgcmlnaHRBbW91bnQpID0+IHtcbiAgcmV0dXJuIFtoLmRvQ29lcmNlKGxlZnRBbW91bnQudmFsdWUpLCBoLmRvQ29lcmNlKHJpZ2h0QW1vdW50LnZhbHVlKV07XG59O1xudmFyIGlzR1RFID0gKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCBoID0gY2hlY2tMUkFuZEdldEhlbHBlcnMobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kKTtcbiAgcmV0dXJuIGguZG9Jc0dURSguLi5jb2VyY2VMUihoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkpO1xufTtcbnZhciBBbW91bnRNYXRoID0ge1xuICAvL1xuICAvL1xuICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAqL1xuICBtYWtlOiAoYnJhbmQsIGFsbGVnZWRWYWx1ZSkgPT4ge1xuICAgIGFzc2VydFJlbW90YWJsZShicmFuZCwgXCJicmFuZFwiKTtcbiAgICBjb25zdCBoID0gYXNzZXJ0VmFsdWVHZXRIZWxwZXJzKGFsbGVnZWRWYWx1ZSk7XG4gICAgY29uc3QgdmFsdWUgPSBoLmRvQ29lcmNlKGFsbGVnZWRWYWx1ZSk7XG4gICAgcmV0dXJuIGhhcmRlbih7IGJyYW5kLCB2YWx1ZSB9KTtcbiAgfSxcbiAgLypcblxuXG5cblxuXG5cblxuICAgKi9cbiAgY29lcmNlOiAoYnJhbmQsIGFsbGVnZWRBbW91bnQpID0+IHtcbiAgICBhc3NlcnRSZW1vdGFibGUoYnJhbmQsIFwiYnJhbmRcIik7XG4gICAgYXNzZXJ0UmVjb3JkKGFsbGVnZWRBbW91bnQsIFwiYW1vdW50XCIpO1xuICAgIGNvbnN0IHsgYnJhbmQ6IGFsbGVnZWRCcmFuZCwgdmFsdWU6IGFsbGVnZWRWYWx1ZSB9ID0gYWxsZWdlZEFtb3VudDtcbiAgICBicmFuZCA9PT0gYWxsZWdlZEJyYW5kIHx8IHRocm93UmVkYWN0ZWRgVGhlIGJyYW5kIGluIHRoZSBhbGxlZ2VkQW1vdW50ICR7YWxsZWdlZEFtb3VudH0gaW4gJ2NvZXJjZScgZGlkbid0IG1hdGNoIHRoZSBzcGVjaWZpZWQgYnJhbmQgJHticmFuZH0uYDtcbiAgICByZXR1cm4gQW1vdW50TWF0aC5tYWtlKGJyYW5kLCBhbGxlZ2VkVmFsdWUpO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuICAgKi9cbiAgZ2V0VmFsdWU6IChicmFuZCwgYW1vdW50KSA9PiBBbW91bnRNYXRoLmNvZXJjZShicmFuZCwgYW1vdW50KS52YWx1ZSxcbiAgLypcblxuXG5cblxuXG5cblxuICAgKi9cbiAgbWFrZUVtcHR5OiAoYnJhbmQsIGFzc2V0S2luZCA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgIFwibmF0XCJcbiAgKSkgPT4ge1xuICAgIGFzc2VydFJlbW90YWJsZShicmFuZCwgXCJicmFuZFwiKTtcbiAgICBhc3NlcnRBc3NldEtpbmQoYXNzZXRLaW5kKTtcbiAgICBjb25zdCB2YWx1ZSA9IGhlbHBlcnNbYXNzZXRLaW5kXS5kb01ha2VFbXB0eSgpO1xuICAgIHJldHVybiBoYXJkZW4oeyBicmFuZCwgdmFsdWUgfSk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuXG4gICAqL1xuICBtYWtlRW1wdHlGcm9tQW1vdW50OiAoYW1vdW50KSA9PiB7XG4gICAgYXNzZXJ0UmVjb3JkKGFtb3VudCwgXCJhbW91bnRcIik7XG4gICAgY29uc3QgeyBicmFuZCwgdmFsdWUgfSA9IGFtb3VudDtcbiAgICBjb25zdCBhc3NldEtpbmQgPSBhc3NlcnRWYWx1ZUdldEFzc2V0S2luZCh2YWx1ZSk7XG4gICAgcmV0dXJuIEFtb3VudE1hdGgubWFrZUVtcHR5KGJyYW5kLCBhc3NldEtpbmQpO1xuICB9LFxuICAvKlxuXG5cblxuXG5cbiAgICovXG4gIGlzRW1wdHk6IChhbW91bnQsIGJyYW5kID0gdm9pZCAwKSA9PiB7XG4gICAgYXNzZXJ0UmVjb3JkKGFtb3VudCwgXCJhbW91bnRcIik7XG4gICAgY29uc3QgeyBicmFuZDogYWxsZWdlZEJyYW5kLCB2YWx1ZSB9ID0gYW1vdW50O1xuICAgIGFzc2VydFJlbW90YWJsZShhbGxlZ2VkQnJhbmQsIFwiYnJhbmRcIik7XG4gICAgb3B0aW9uYWxCcmFuZENoZWNrKGFsbGVnZWRCcmFuZCwgYnJhbmQpO1xuICAgIGNvbnN0IGggPSBhc3NlcnRWYWx1ZUdldEhlbHBlcnModmFsdWUpO1xuICAgIHJldHVybiBoLmRvSXNFbXB0eShoLmRvQ29lcmNlKHZhbHVlKSk7XG4gIH0sXG4gIGlzR1RFLFxuICAvKlxuXG5cblxuXG5cblxuXG5cbiAgICovXG4gIGlzRXF1YWw6IChsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQgPSB2b2lkIDApID0+IHtcbiAgICBjb25zdCBoID0gY2hlY2tMUkFuZEdldEhlbHBlcnMobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kKTtcbiAgICByZXR1cm4gaC5kb0lzRXF1YWwoLi4uY29lcmNlTFIoaCwgbGVmdEFtb3VudCwgcmlnaHRBbW91bnQpKTtcbiAgfSxcbiAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAqL1xuICBhZGQ6IChsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQgPSB2b2lkIDApID0+IHtcbiAgICBjb25zdCBoID0gY2hlY2tMUkFuZEdldEhlbHBlcnMobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kKTtcbiAgICBjb25zdCB2YWx1ZSA9IGguZG9BZGQoLi4uY29lcmNlTFIoaCwgbGVmdEFtb3VudCwgcmlnaHRBbW91bnQpKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgYnJhbmQ6IGxlZnRBbW91bnQuYnJhbmQsIHZhbHVlIH0pO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgKi9cbiAgc3VidHJhY3Q6IChsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQgPSB2b2lkIDApID0+IHtcbiAgICBjb25zdCBoID0gY2hlY2tMUkFuZEdldEhlbHBlcnMobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kKTtcbiAgICBjb25zdCB2YWx1ZSA9IGguZG9TdWJ0cmFjdCguLi5jb2VyY2VMUihoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkpO1xuICAgIHJldHVybiBoYXJkZW4oeyBicmFuZDogbGVmdEFtb3VudC5icmFuZCwgdmFsdWUgfSk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuXG5cbiAgICovXG4gIG1pbjogKHgsIHksIGJyYW5kID0gdm9pZCAwKSA9PiAoXG4gICAgLy9cbiAgICBpc0dURSh4LCB5LCBicmFuZCkgPyB5IDogaXNHVEUoeSwgeCwgYnJhbmQpID8geCA6IHRocm93UmVkYWN0ZWRgJHt4fSBhbmQgJHt5fSBhcmUgaW5jb21wYXJhYmxlYFxuICApLFxuICAvKlxuXG5cblxuXG5cblxuXG4gICAqL1xuICBtYXg6ICh4LCB5LCBicmFuZCA9IHZvaWQgMCkgPT4gKFxuICAgIC8vXG4gICAgaXNHVEUoeCwgeSwgYnJhbmQpID8geCA6IGlzR1RFKHksIHgpID8geSA6IHRocm93UmVkYWN0ZWRgJHt4fSBhbmQgJHt5fSBhcmUgaW5jb21wYXJhYmxlYFxuICApXG59O1xuaGFyZGVuKEFtb3VudE1hdGgpO1xudmFyIGdldEFzc2V0S2luZCA9IChhbW91bnQpID0+IHtcbiAgYXNzZXJ0UmVjb3JkKGFtb3VudCwgXCJhbW91bnRcIik7XG4gIGNvbnN0IHsgdmFsdWUgfSA9IGFtb3VudDtcbiAgcmV0dXJuIGFzc2VydFZhbHVlR2V0QXNzZXRLaW5kKHZhbHVlKTtcbn07XG5oYXJkZW4oZ2V0QXNzZXRLaW5kKTtcblxuLy9cbnZhciBWYXREYXRhR2xvYmFsO1xuaWYgKFwiVmF0RGF0YVwiIGluIGdsb2JhbFRoaXMpIHtcbiAgZ2xvYmFsVGhpcy5WYXREYXRhIHx8IHRocm93UmVkYWN0ZWRgVmF0RGF0YSBkZWZpbmVkIGluIGdsb2JhbCBhcyBudWxsIG9yIHVuZGVmaW5lZGA7XG4gIFZhdERhdGFHbG9iYWwgPSAvKiAgICAgICAgICAgICAgKi9cbiAgZ2xvYmFsVGhpcy5WYXREYXRhO1xufSBlbHNlIHtcbiAgY29uc3QgdW5hdmFpbGFibGUgPSAoKSA9PiB0aHJvd1JlZGFjdGVkYFZhdERhdGEgdW5hdmFpbGFibGVgO1xuICBWYXREYXRhR2xvYmFsID0ge1xuICAgIGRlZmluZUtpbmQ6IHVuYXZhaWxhYmxlLFxuICAgIGRlZmluZUtpbmRNdWx0aTogdW5hdmFpbGFibGUsXG4gICAgZGVmaW5lRHVyYWJsZUtpbmQ6IHVuYXZhaWxhYmxlLFxuICAgIGRlZmluZUR1cmFibGVLaW5kTXVsdGk6IHVuYXZhaWxhYmxlLFxuICAgIG1ha2VLaW5kSGFuZGxlOiB1bmF2YWlsYWJsZSxcbiAgICBwcm92aWRlUHJvbWlzZVdhdGNoZXI6IHVuYXZhaWxhYmxlLFxuICAgIHdhdGNoUHJvbWlzZTogdW5hdmFpbGFibGUsXG4gICAgbWFrZVNjYWxhckJpZ01hcFN0b3JlOiB1bmF2YWlsYWJsZSxcbiAgICBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlOiB1bmF2YWlsYWJsZSxcbiAgICBtYWtlU2NhbGFyQmlnU2V0U3RvcmU6IHVuYXZhaWxhYmxlLFxuICAgIG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmU6IHVuYXZhaWxhYmxlLFxuICAgIGNhbkJlRHVyYWJsZTogdW5hdmFpbGFibGVcbiAgfTtcbn1cbnZhciBWYXREYXRhRXhwb3J0ID0gVmF0RGF0YUdsb2JhbDtcbnZhciB7XG4gIGRlZmluZUtpbmQsXG4gIGRlZmluZUtpbmRNdWx0aSxcbiAgZGVmaW5lRHVyYWJsZUtpbmQsXG4gIGRlZmluZUR1cmFibGVLaW5kTXVsdGlcbn0gPSBWYXREYXRhR2xvYmFsO1xudmFyIHtcbiAgbWFrZUtpbmRIYW5kbGUsXG4gIHByb3ZpZGVQcm9taXNlV2F0Y2hlcixcbiAgd2F0Y2hQcm9taXNlLFxuICBtYWtlU2NhbGFyQmlnTWFwU3RvcmUsXG4gIG1ha2VTY2FsYXJCaWdXZWFrTWFwU3RvcmUsXG4gIG1ha2VTY2FsYXJCaWdTZXRTdG9yZSxcbiAgbWFrZVNjYWxhckJpZ1dlYWtTZXRTdG9yZSxcbiAgY2FuQmVEdXJhYmxlXG59ID0gVmF0RGF0YUdsb2JhbDtcbnZhciBwaWNrRmFjZXQgPSAobWFrZXIsIGZhY2V0TmFtZSkgPT4gKC4uLmFyZ3MpID0+IG1ha2VyKC4uLmFyZ3MpW2ZhY2V0TmFtZV07XG5oYXJkZW4ocGlja0ZhY2V0KTtcbnZhciBwYXJ0aWFsQXNzaWduID0gKHRhcmdldCwgc291cmNlKSA9PiB7XG4gIE9iamVjdC5hc3NpZ24odGFyZ2V0LCBzb3VyY2UpO1xufTtcbmhhcmRlbihwYXJ0aWFsQXNzaWduKTtcbnZhciBwcm92aWRlID0gKFxuICAvL1xuICAvKlxuXG5cblxuXG5cbiAgICovXG4gIHByb3ZpZGVMYXp5XG4pO1xudmFyIG1ha2VTdG9yZVV0aWxzID0gKFZhdERhdGEpID0+IHtcbiAgY29uc3Qge1xuICAgIC8vXG4gICAgbWFrZVNjYWxhckJpZ01hcFN0b3JlOiBtYWtlU2NhbGFyQmlnTWFwU3RvcmUyLFxuICAgIC8vXG4gICAgbWFrZVNjYWxhckJpZ1dlYWtNYXBTdG9yZTogbWFrZVNjYWxhckJpZ1dlYWtNYXBTdG9yZTIsXG4gICAgLy9cbiAgICBtYWtlU2NhbGFyQmlnU2V0U3RvcmU6IG1ha2VTY2FsYXJCaWdTZXRTdG9yZTIsXG4gICAgLy9cbiAgICBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlOiBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlMlxuICB9ID0gVmF0RGF0YTtcbiAgY29uc3QgcHJvdmlkZUR1cmFibGVNYXBTdG9yZTIgPSAoYmFnZ2FnZSwgbmFtZSwgb3B0aW9ucyA9IHt9KSA9PiBwcm92aWRlKFxuICAgIGJhZ2dhZ2UsXG4gICAgbmFtZSxcbiAgICAoKSA9PiBtYWtlU2NhbGFyQmlnTWFwU3RvcmUyKG5hbWUsIHsgZHVyYWJsZTogdHJ1ZSwgLi4ub3B0aW9ucyB9KVxuICApO1xuICBoYXJkZW4ocHJvdmlkZUR1cmFibGVNYXBTdG9yZTIpO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTIgPSAoYmFnZ2FnZSwgbmFtZSwgb3B0aW9ucyA9IHt9KSA9PiBwcm92aWRlKFxuICAgIGJhZ2dhZ2UsXG4gICAgbmFtZSxcbiAgICAoKSA9PiBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlMihuYW1lLCB7IGR1cmFibGU6IHRydWUsIC4uLm9wdGlvbnMgfSlcbiAgKTtcbiAgaGFyZGVuKHByb3ZpZGVEdXJhYmxlV2Vha01hcFN0b3JlMik7XG4gIGNvbnN0IHByb3ZpZGVEdXJhYmxlU2V0U3RvcmUyID0gKGJhZ2dhZ2UsIG5hbWUsIG9wdGlvbnMgPSB7fSkgPT4gcHJvdmlkZShcbiAgICBiYWdnYWdlLFxuICAgIG5hbWUsXG4gICAgKCkgPT4gbWFrZVNjYWxhckJpZ1NldFN0b3JlMihuYW1lLCB7IGR1cmFibGU6IHRydWUsIC4uLm9wdGlvbnMgfSlcbiAgKTtcbiAgaGFyZGVuKHByb3ZpZGVEdXJhYmxlU2V0U3RvcmUyKTtcbiAgY29uc3QgcHJvdmlkZUR1cmFibGVXZWFrU2V0U3RvcmUyID0gKGJhZ2dhZ2UsIG5hbWUsIG9wdGlvbnMgPSB7fSkgPT4gcHJvdmlkZShcbiAgICBiYWdnYWdlLFxuICAgIG5hbWUsXG4gICAgKCkgPT4gbWFrZVNjYWxhckJpZ1dlYWtTZXRTdG9yZTIobmFtZSwgeyBkdXJhYmxlOiB0cnVlLCAuLi5vcHRpb25zIH0pXG4gICk7XG4gIGhhcmRlbihwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTIpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBwcm92aWRlRHVyYWJsZU1hcFN0b3JlOiBwcm92aWRlRHVyYWJsZU1hcFN0b3JlMixcbiAgICBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTogcHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmUyLFxuICAgIHByb3ZpZGVEdXJhYmxlU2V0U3RvcmU6IHByb3ZpZGVEdXJhYmxlU2V0U3RvcmUyLFxuICAgIHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlOiBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTJcbiAgfSk7XG59O1xudmFyIGdsb2JhbFN0b3JlVXRpbHMgPSBtYWtlU3RvcmVVdGlscyhWYXREYXRhR2xvYmFsKTtcbnZhciB7XG4gIHByb3ZpZGVEdXJhYmxlTWFwU3RvcmUsXG4gIHByb3ZpZGVEdXJhYmxlV2Vha01hcFN0b3JlLFxuICBwcm92aWRlRHVyYWJsZVNldFN0b3JlLFxuICBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZVxufSA9IGdsb2JhbFN0b3JlVXRpbHM7XG5cbi8vXG52YXIgaWdub3JlQ29udGV4dCA9IChmbikgPT4gKF9jb250ZXh0LCAuLi5hcmdzKSA9PiBmbiguLi5hcmdzKTtcbmhhcmRlbihpZ25vcmVDb250ZXh0KTtcbnZhciBtYWtlRXhvVXRpbHMgPSAoVmF0RGF0YSkgPT4ge1xuICBjb25zdCB7XG4gICAgZGVmaW5lS2luZDogZGVmaW5lS2luZDIsXG4gICAgZGVmaW5lS2luZE11bHRpOiBkZWZpbmVLaW5kTXVsdGkyLFxuICAgIGRlZmluZUR1cmFibGVLaW5kOiBkZWZpbmVEdXJhYmxlS2luZDIsXG4gICAgZGVmaW5lRHVyYWJsZUtpbmRNdWx0aTogZGVmaW5lRHVyYWJsZUtpbmRNdWx0aTIsXG4gICAgbWFrZUtpbmRIYW5kbGU6IG1ha2VLaW5kSGFuZGxlMlxuICB9ID0gVmF0RGF0YTtcbiAgY29uc3QgcHJvdmlkZUtpbmRIYW5kbGUyID0gKGJhZ2dhZ2UsIGtpbmROYW1lKSA9PiBwcm92aWRlKGJhZ2dhZ2UsIGAke2tpbmROYW1lfV9raW5kSGFuZGxlYCwgKCkgPT4gbWFrZUtpbmRIYW5kbGUyKGtpbmROYW1lKSk7XG4gIGhhcmRlbihwcm92aWRlS2luZEhhbmRsZTIpO1xuICBjb25zdCBwcmVwYXJlS2luZDIgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGluaXQsIGJlaGF2aW9yLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlS2luZDIoXG4gICAgcHJvdmlkZUtpbmRIYW5kbGUyKGJhZ2dhZ2UsIGtpbmROYW1lKSxcbiAgICBpbml0LFxuICAgIGJlaGF2aW9yLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgaGFyZGVuKHByZXBhcmVLaW5kMik7XG4gIGNvbnN0IHByZXBhcmVLaW5kTXVsdGkyID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbml0LCBiZWhhdmlvciwgb3B0aW9ucyA9IHZvaWQgMCkgPT4gZGVmaW5lRHVyYWJsZUtpbmRNdWx0aTIoXG4gICAgcHJvdmlkZUtpbmRIYW5kbGUyKGJhZ2dhZ2UsIGtpbmROYW1lKSxcbiAgICBpbml0LFxuICAgIGJlaGF2aW9yLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgaGFyZGVuKHByZXBhcmVLaW5kTXVsdGkyKTtcbiAgY29uc3QgZGVmaW5lVmlydHVhbEV4b0NsYXNzMiA9ICh0YWcsIGludGVyZmFjZUd1YXJkLCBpbml0LCBtZXRob2RzLCBvcHRpb25zKSA9PiAoXG4gICAgLy9cbiAgICBkZWZpbmVLaW5kMih0YWcsIGluaXQsIG1ldGhvZHMsIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICB0aGlzZnVsTWV0aG9kczogdHJ1ZSxcbiAgICAgIGludGVyZmFjZUd1YXJkXG4gICAgfSlcbiAgKTtcbiAgaGFyZGVuKGRlZmluZVZpcnR1YWxFeG9DbGFzczIpO1xuICBjb25zdCBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3NLaXQyID0gKHRhZywgaW50ZXJmYWNlR3VhcmRLaXQsIGluaXQsIGZhY2V0cywgb3B0aW9ucykgPT4gKFxuICAgIC8vXG4gICAgZGVmaW5lS2luZE11bHRpMih0YWcsIGluaXQsIGZhY2V0cywge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHRoaXNmdWxNZXRob2RzOiB0cnVlLFxuICAgICAgaW50ZXJmYWNlR3VhcmRLaXRcbiAgICB9KVxuICApO1xuICBoYXJkZW4oZGVmaW5lVmlydHVhbEV4b0NsYXNzS2l0Mik7XG4gIGNvbnN0IGRlZmluZUR1cmFibGVFeG9DbGFzczIgPSAoa2luZEhhbmRsZSwgaW50ZXJmYWNlR3VhcmQsIGluaXQsIG1ldGhvZHMsIG9wdGlvbnMpID0+IChcbiAgICAvL1xuICAgIGRlZmluZUR1cmFibGVLaW5kMihraW5kSGFuZGxlLCBpbml0LCBtZXRob2RzLCB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgdGhpc2Z1bE1ldGhvZHM6IHRydWUsXG4gICAgICBpbnRlcmZhY2VHdWFyZFxuICAgIH0pXG4gICk7XG4gIGhhcmRlbihkZWZpbmVEdXJhYmxlRXhvQ2xhc3MyKTtcbiAgY29uc3QgZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0MiA9IChraW5kSGFuZGxlLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgZmFjZXRzLCBvcHRpb25zKSA9PiAoXG4gICAgLy9cbiAgICBkZWZpbmVEdXJhYmxlS2luZE11bHRpMihraW5kSGFuZGxlLCBpbml0LCBmYWNldHMsIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICB0aGlzZnVsTWV0aG9kczogdHJ1ZSxcbiAgICAgIGludGVyZmFjZUd1YXJkS2l0XG4gICAgfSlcbiAgKTtcbiAgaGFyZGVuKGRlZmluZUR1cmFibGVFeG9DbGFzc0tpdDIpO1xuICBjb25zdCBwcmVwYXJlRXhvQ2xhc3MyID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbnRlcmZhY2VHdWFyZCwgaW5pdCwgbWV0aG9kcywgb3B0aW9ucyA9IHZvaWQgMCkgPT4gZGVmaW5lRHVyYWJsZUV4b0NsYXNzMihcbiAgICBwcm92aWRlS2luZEhhbmRsZTIoYmFnZ2FnZSwga2luZE5hbWUpLFxuICAgIGludGVyZmFjZUd1YXJkLFxuICAgIGluaXQsXG4gICAgbWV0aG9kcyxcbiAgICBvcHRpb25zXG4gICk7XG4gIGhhcmRlbihwcmVwYXJlRXhvQ2xhc3MyKTtcbiAgY29uc3QgcHJlcGFyZUV4b0NsYXNzS2l0MiA9IChiYWdnYWdlLCBraW5kTmFtZSwgaW50ZXJmYWNlR3VhcmRLaXQsIGluaXQsIGZhY2V0cywgb3B0aW9ucyA9IHZvaWQgMCkgPT4gZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0MihcbiAgICBwcm92aWRlS2luZEhhbmRsZTIoYmFnZ2FnZSwga2luZE5hbWUpLFxuICAgIGludGVyZmFjZUd1YXJkS2l0LFxuICAgIGluaXQsXG4gICAgZmFjZXRzLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgaGFyZGVuKHByZXBhcmVFeG9DbGFzc0tpdDIpO1xuICBjb25zdCBwcmVwYXJlRXhvMiA9IChiYWdnYWdlLCBraW5kTmFtZSwgaW50ZXJmYWNlR3VhcmQsIG1ldGhvZHMsIG9wdGlvbnMgPSB2b2lkIDApID0+IHtcbiAgICBjb25zdCBtYWtlU2luZ2xldG9uID0gcHJlcGFyZUV4b0NsYXNzMihcbiAgICAgIGJhZ2dhZ2UsXG4gICAgICBraW5kTmFtZSxcbiAgICAgIGludGVyZmFjZUd1YXJkLFxuICAgICAgaW5pdEVtcHR5LFxuICAgICAgbWV0aG9kcyxcbiAgICAgIG9wdGlvbnNcbiAgICApO1xuICAgIHJldHVybiBwcm92aWRlKGJhZ2dhZ2UsIGAke2tpbmROYW1lfV9zaW5nbGV0b25gLCAoKSA9PiBtYWtlU2luZ2xldG9uKCkpO1xuICB9O1xuICBoYXJkZW4ocHJlcGFyZUV4bzIpO1xuICBjb25zdCBwcmVwYXJlU2luZ2xldG9uMiA9IChiYWdnYWdlLCBraW5kTmFtZSwgbWV0aG9kcywgb3B0aW9ucyA9IHZvaWQgMCkgPT4gcHJlcGFyZUV4bzIoYmFnZ2FnZSwga2luZE5hbWUsIHZvaWQgMCwgbWV0aG9kcywgb3B0aW9ucyk7XG4gIGhhcmRlbihwcmVwYXJlU2luZ2xldG9uMik7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGRlZmluZVZpcnR1YWxFeG9DbGFzczogZGVmaW5lVmlydHVhbEV4b0NsYXNzMixcbiAgICBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3NLaXQ6IGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDIsXG4gICAgZGVmaW5lRHVyYWJsZUV4b0NsYXNzOiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3MyLFxuICAgIGRlZmluZUR1cmFibGVFeG9DbGFzc0tpdDogZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0MixcbiAgICBwcmVwYXJlRXhvQ2xhc3M6IHByZXBhcmVFeG9DbGFzczIsXG4gICAgcHJlcGFyZUV4b0NsYXNzS2l0OiBwcmVwYXJlRXhvQ2xhc3NLaXQyLFxuICAgIHByZXBhcmVFeG86IHByZXBhcmVFeG8yLFxuICAgIHByZXBhcmVTaW5nbGV0b246IHByZXBhcmVTaW5nbGV0b24yLFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlOiBwcm92aWRlS2luZEhhbmRsZTIsXG4gICAgcHJlcGFyZUtpbmQ6IHByZXBhcmVLaW5kMixcbiAgICBwcmVwYXJlS2luZE11bHRpOiBwcmVwYXJlS2luZE11bHRpMlxuICB9KTtcbn07XG52YXIgZ2xvYmFsRXhvVXRpbHMgPSBtYWtlRXhvVXRpbHMoVmF0RGF0YUV4cG9ydCk7XG52YXIge1xuICBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3MsXG4gIGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdCxcbiAgZGVmaW5lRHVyYWJsZUV4b0NsYXNzLFxuICBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQsXG4gIHByZXBhcmVFeG9DbGFzcyxcbiAgcHJlcGFyZUV4b0NsYXNzS2l0LFxuICBwcmVwYXJlRXhvLFxuICBwcmVwYXJlU2luZ2xldG9uXG59ID0gZ2xvYmFsRXhvVXRpbHM7XG52YXIgeyBwcm92aWRlS2luZEhhbmRsZSwgcHJlcGFyZUtpbmQsIHByZXBhcmVLaW5kTXVsdGkgfSA9IGdsb2JhbEV4b1V0aWxzO1xuXG4vL1xudmFyIGRlZmF1bHRMYWJlbFRvS2V5cyA9IChsYWJlbCkgPT4gaGFyZGVuKFtsYWJlbF0pO1xuaGFyZGVuKGRlZmF1bHRMYWJlbFRvS2V5cyk7XG52YXIgbWFrZU9uY2VLaXQgPSAoZGVidWdOYW1lLCBzdG9yZXMsIGJhY2tpbmdTdG9yZSA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCB1c2VkS2V5cyA9IHN0b3Jlcy5kZXRhY2hlZCgpLnNldFN0b3JlKGAke2RlYnVnTmFtZX0gdXNlZCBrZXlzYCk7XG4gIGNvbnN0IGFzc2VydE9ubHlPbmNlID0gKGtleSkgPT4ge1xuICAgIHR5cGVvZiBrZXkgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBrZXkgJHtrZXl9IG11c3QgYmUgYSBzdHJpbmdgO1xuICAgICF1c2VkS2V5cy5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYGtleSAke2tleX0gaGFzIGFscmVhZHkgYmVlbiB1c2VkIGluIHRoaXMgem9uZSBhbmQgaW5jYXJuYXRpb25gO1xuICAgIHVzZWRLZXlzLmFkZChrZXkpO1xuICB9O1xuICBjb25zdCB3cmFwUHJvdmlkZXIgPSAocHJvdmlkZXIsIGxhYmVsVG9LZXlzID0gZGVmYXVsdExhYmVsVG9LZXlzKSA9PiB7XG4gICAgY29uc3Qgd3JhcHBlciA9IChsYWJlbCwgLi4ucmVzdCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBrZXkgb2YgbGFiZWxUb0tleXMobGFiZWwpKSB7XG4gICAgICAgIGFzc2VydE9ubHlPbmNlKGtleSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcHJvdmlkZXIobGFiZWwsIC4uLnJlc3QpO1xuICAgIH07XG4gICAgcmV0dXJuIChcbiAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgIHdyYXBwZXJcbiAgICApO1xuICB9O1xuICBjb25zdCBtYWtlT25jZSA9IChrZXksIG1ha2VyKSA9PiB7XG4gICAgYXNzZXJ0T25seU9uY2Uoa2V5KTtcbiAgICBpZiAoYmFja2luZ1N0b3JlICYmIGJhY2tpbmdTdG9yZS5oYXMoa2V5KSkge1xuICAgICAgcmV0dXJuIGJhY2tpbmdTdG9yZS5nZXQoa2V5KTtcbiAgICB9XG4gICAgY29uc3QgdmFsdWUgPSBtYWtlcihrZXkpO1xuICAgIHN0b3Jlcy5pc1N0b3JhYmxlKHZhbHVlKSB8fCB0aHJvd1JlZGFjdGVkYG1ha2VyIHJldHVybiB2YWx1ZSAke3ZhbHVlfSBpcyBub3Qgc3RvcmFibGVgO1xuICAgIGJhY2tpbmdTdG9yZSAmJiBiYWNraW5nU3RvcmUuaW5pdChrZXksIHZhbHVlKTtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oeyBtYWtlT25jZSwgd3JhcFByb3ZpZGVyIH0pO1xufTtcbmhhcmRlbihtYWtlT25jZUtpdCk7XG5cbi8vXG52YXIga2luZCA9IChsYWJlbCkgPT4gYCR7bGFiZWx9X2tpbmRIYW5kbGVgO1xudmFyIHNpbmdsZXRvbiA9IChsYWJlbCkgPT4gYCR7bGFiZWx9X3NpbmdsZXRvbmA7XG52YXIgYWdvcmljVmF0RGF0YUtleXMgPSB7XG4gIGV4b0NsYXNzOiAobGFiZWwpID0+IGhhcmRlbihba2luZChsYWJlbCldKSxcbiAgZXhvQ2xhc3NLaXQ6IChsYWJlbCkgPT4gaGFyZGVuKFtraW5kKGxhYmVsKV0pLFxuICBleG86IChsYWJlbCkgPT4gaGFyZGVuKFtraW5kKGxhYmVsKSwgc2luZ2xldG9uKGxhYmVsKV0pLFxuICBzdG9yZTogKGxhYmVsKSA9PiBoYXJkZW4oW2xhYmVsXSksXG4gIHpvbmU6IChsYWJlbCkgPT4gaGFyZGVuKFtsYWJlbF0pXG59O1xuaGFyZGVuKGFnb3JpY1ZhdERhdGFLZXlzKTtcblxuLy9cbnZhciB7IGFwcGx5OiBhcHBseTUgfSA9IFJlZmxlY3Q7XG52YXIgUHJvbWlzZVdhdGNoZXJIYW5kbGVyID0gTS5jYWxsKE0ucmF3KCkpLnJlc3QoTS5yYXcoKSkucmV0dXJucygpO1xudmFyIFByb21pc2VXYXRjaGVySSA9IE0uaW50ZXJmYWNlKFwiUHJvbWlzZVdhdGNoZXJcIiwge1xuICBvbkZ1bGZpbGxlZDogUHJvbWlzZVdhdGNoZXJIYW5kbGVyLFxuICBvblJlamVjdGVkOiBQcm9taXNlV2F0Y2hlckhhbmRsZXJcbn0pO1xudmFyIFByb21pc2VXYXRjaGVyRnVsZmlsbGVkSSA9IE0uaW50ZXJmYWNlKFwiUHJvbWlzZVdhdGNoZXJGdWxmaWxsZWRcIiwge1xuICBvbkZ1bGZpbGxlZDogUHJvbWlzZVdhdGNoZXJIYW5kbGVyXG59KTtcbnZhciBQcm9taXNlV2F0Y2hlclJlamVjdGVkSSA9IE0uaW50ZXJmYWNlKFwiUHJvbWlzZVdhdGNoZXJSZWplY3RlZFwiLCB7XG4gIG9uUmVqZWN0ZWQ6IFByb21pc2VXYXRjaGVySGFuZGxlclxufSk7XG52YXIgY2FsbE1lTWF5YmUgPSAodGhhdCwgcHJvcCwgcG9zdEFyZ3MpID0+IHtcbiAgY29uc3QgZm4gPSB0aGF0W3Byb3BdO1xuICBpZiAoIWZuKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBhc3NlcnQudHlwZW9mKGZuLCBcImZ1bmN0aW9uXCIpO1xuICBjb25zdCB3cmFwcGVkID0gKGFyZykgPT4ge1xuICAgIGFwcGx5NShmbiwgdGhhdCwgW2FyZywgLi4ucG9zdEFyZ3NdKTtcbiAgfTtcbiAgcmV0dXJuIHdyYXBwZWQ7XG59O1xudmFyIHdhdGNoUHJvbWlzZTIgPSAocDMsIHdhdGNoZXIsIC4uLndhdGNoZXJBcmdzKSA9PiB7XG4gIFByb21pc2UucmVzb2x2ZShwMykgPT09IHAzIHx8IHRocm93UmVkYWN0ZWRgd2F0Y2hQcm9taXNlIG9ubHkgd2F0Y2hlcyBwcm9taXNlc2A7XG4gIGNvbnN0IG9uRnVsZmlsbGVkID0gY2FsbE1lTWF5YmUod2F0Y2hlciwgXCJvbkZ1bGZpbGxlZFwiLCB3YXRjaGVyQXJncyk7XG4gIGNvbnN0IG9uUmVqZWN0ZWQgPSBjYWxsTWVNYXliZSh3YXRjaGVyLCBcIm9uUmVqZWN0ZWRcIiwgd2F0Y2hlckFyZ3MpO1xuICBvbkZ1bGZpbGxlZCB8fCBvblJlamVjdGVkIHx8IHRocm93UmVkYWN0ZWRgcHJvbWlzZSB3YXRjaGVyIG11c3QgaW1wbGVtZW50IGF0IGxlYXN0IG9uZSBoYW5kbGVyIG1ldGhvZGA7XG4gIHZvaWQgRS53aGVuKHAzLCBvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCk7XG59O1xuaGFyZGVuKHdhdGNoUHJvbWlzZTIpO1xuXG4vL1xudmFyIGlzU3RvcmFibGUgPSAoc3BlY2ltZW4pID0+IGlzUGFzc2FibGUoc3BlY2ltZW4pICYmIGNhbkJlRHVyYWJsZShzcGVjaW1lbik7XG5oYXJkZW4oaXNTdG9yYWJsZSk7XG52YXIgYXR0YWNoRHVyYWJsZVN0b3JlcyA9IChnZXRCYWdnYWdlKSA9PiB7XG4gIGNvbnN0IG1hcFN0b3JlID0gKGxhYmVsLCBvcHRpb25zKSA9PiB7XG4gICAgY29uc3QgYmFnZ2FnZSA9IGdldEJhZ2dhZ2UoKTtcbiAgICBjb25zdCByZXQgPSBwcm92aWRlRHVyYWJsZU1hcFN0b3JlKGJhZ2dhZ2UsIGxhYmVsLCBvcHRpb25zKTtcbiAgICByZXR1cm4gcmV0O1xuICB9O1xuICBjb25zdCBzZXRTdG9yZSA9IChsYWJlbCwgb3B0aW9ucykgPT4gcHJvdmlkZUR1cmFibGVTZXRTdG9yZShnZXRCYWdnYWdlKCksIGxhYmVsLCBvcHRpb25zKTtcbiAgY29uc3Qgd2Vha1NldFN0b3JlID0gKGxhYmVsLCBvcHRpb25zKSA9PiBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZShnZXRCYWdnYWdlKCksIGxhYmVsLCBvcHRpb25zKTtcbiAgY29uc3Qgd2Vha01hcFN0b3JlID0gKGxhYmVsLCBvcHRpb25zKSA9PiBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZShnZXRCYWdnYWdlKCksIGxhYmVsLCBvcHRpb25zKTtcbiAgcmV0dXJuIEZhcihcImR1cmFibGVTdG9yZXNcIiwge1xuICAgIGRldGFjaGVkOiAoKSA9PiBkZXRhY2hlZER1cmFibGVTdG9yZXMsXG4gICAgaXNTdG9yYWJsZSxcbiAgICBtYXBTdG9yZSxcbiAgICBzZXRTdG9yZSxcbiAgICB3ZWFrTWFwU3RvcmUsXG4gICAgd2Vha1NldFN0b3JlXG4gIH0pO1xufTtcbnZhciBkZXRhY2hlZER1cmFibGVTdG9yZXMgPSBhdHRhY2hEdXJhYmxlU3RvcmVzKFxuICAoKSA9PiBtYWtlU2NhbGFyTWFwU3RvcmUoXCJkZXRhY2hlZFwiKVxuKTtcbnZhciBtYWtlRHVyYWJsZVpvbmUgPSAoYmFnZ2FnZSwgYmFzZUxhYmVsID0gXCJkdXJhYmxlWm9uZVwiKSA9PiB7XG4gIGJhZ2dhZ2UgfHwgdGhyb3dSZWRhY3RlZGBiYWdnYWdlIHJlcXVpcmVkYDtcbiAgY29uc3QgYXR0YWNoZWRTdG9yZXMgPSBhdHRhY2hEdXJhYmxlU3RvcmVzKCgpID0+IGJhZ2dhZ2UpO1xuICBjb25zdCB7IG1ha2VPbmNlLCB3cmFwUHJvdmlkZXIgfSA9IG1ha2VPbmNlS2l0KFxuICAgIGJhc2VMYWJlbCxcbiAgICBhdHRhY2hlZFN0b3JlcyxcbiAgICBiYWdnYWdlXG4gICk7XG4gIGNvbnN0IGV4b0NsYXNzID0gKC4uLmFyZ3MpID0+IHByZXBhcmVFeG9DbGFzcyhiYWdnYWdlLCAuLi5hcmdzKTtcbiAgY29uc3QgZXhvQ2xhc3NLaXQgPSAoLi4uYXJncykgPT4gcHJlcGFyZUV4b0NsYXNzS2l0KGJhZ2dhZ2UsIC4uLmFyZ3MpO1xuICBjb25zdCBleG8gPSAoLi4uYXJncykgPT4gcHJlcGFyZUV4byhiYWdnYWdlLCAuLi5hcmdzKTtcbiAgY29uc3Qgc3ViWm9uZVN0b3JlID0gd3JhcFByb3ZpZGVyKGF0dGFjaGVkU3RvcmVzLm1hcFN0b3JlLCBhZ29yaWNWYXREYXRhS2V5cy56b25lKTtcbiAgY29uc3Qgc3ViWm9uZSA9IChsYWJlbCwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gICAgY29uc3Qgc3ViQmFnZ2FnZSA9IHN1YlpvbmVTdG9yZShsYWJlbCwgb3B0aW9ucyk7XG4gICAgcmV0dXJuIG1ha2VEdXJhYmxlWm9uZShzdWJCYWdnYWdlLCBgJHtiYXNlTGFiZWx9LiR7bGFiZWx9YCk7XG4gIH07XG4gIHJldHVybiBGYXIoXCJkdXJhYmxlWm9uZVwiLCB7XG4gICAgZXhvOiB3cmFwUHJvdmlkZXIoZXhvLCBhZ29yaWNWYXREYXRhS2V5cy5leG8pLFxuICAgIGV4b0NsYXNzOiB3cmFwUHJvdmlkZXIoZXhvQ2xhc3MsIGFnb3JpY1ZhdERhdGFLZXlzLmV4b0NsYXNzKSxcbiAgICBleG9DbGFzc0tpdDogd3JhcFByb3ZpZGVyKGV4b0NsYXNzS2l0LCBhZ29yaWNWYXREYXRhS2V5cy5leG9DbGFzc0tpdCksXG4gICAgc3ViWm9uZSxcbiAgICBtYWtlT25jZSxcbiAgICB3YXRjaFByb21pc2UsXG4gICAgZGV0YWNoZWQ6IGF0dGFjaGVkU3RvcmVzLmRldGFjaGVkLFxuICAgIGlzU3RvcmFibGU6IGF0dGFjaGVkU3RvcmVzLmlzU3RvcmFibGUsXG4gICAgbWFwU3RvcmU6IHdyYXBQcm92aWRlcihhdHRhY2hlZFN0b3Jlcy5tYXBTdG9yZSwgYWdvcmljVmF0RGF0YUtleXMuc3RvcmUpLFxuICAgIHNldFN0b3JlOiB3cmFwUHJvdmlkZXIoYXR0YWNoZWRTdG9yZXMuc2V0U3RvcmUsIGFnb3JpY1ZhdERhdGFLZXlzLnN0b3JlKSxcbiAgICB3ZWFrTWFwU3RvcmU6IHdyYXBQcm92aWRlcihhdHRhY2hlZFN0b3Jlcy53ZWFrTWFwU3RvcmUsIGFnb3JpY1ZhdERhdGFLZXlzLnN0b3JlKSxcbiAgICB3ZWFrU2V0U3RvcmU6IHdyYXBQcm92aWRlcihhdHRhY2hlZFN0b3Jlcy53ZWFrU2V0U3RvcmUsIGFnb3JpY1ZhdERhdGFLZXlzLnN0b3JlKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUR1cmFibGVab25lKTtcblxuLy9cbnZhciBCcmFuZFNoYXBlID0gTS5yZW1vdGFibGUoXCJCcmFuZFwiKTtcbnZhciBJc3N1ZXJTaGFwZSA9IE0ucmVtb3RhYmxlKFwiSXNzdWVyXCIpO1xudmFyIFBheW1lbnRTaGFwZSA9IE0ucmVtb3RhYmxlKFwiUGF5bWVudFwiKTtcbnZhciBQdXJzZVNoYXBlID0gTS5yZW1vdGFibGUoXCJQdXJzZVwiKTtcbnZhciBEZXBvc2l0RmFjZXRTaGFwZSA9IE0ucmVtb3RhYmxlKFwiRGVwb3NpdEZhY2V0XCIpO1xudmFyIE5vdGlmaWVyU2hhcGUgPSBNLnJlbW90YWJsZShcIk5vdGlmaWVyXCIpO1xudmFyIE1pbnRTaGFwZSA9IE0ucmVtb3RhYmxlKFwiTWludFwiKTtcbnZhciBOYXRWYWx1ZVNoYXBlID0gTS5uYXQoKTtcbnZhciBDb3B5U2V0VmFsdWVTaGFwZSA9IE0uc2V0KCk7XG52YXIgU2V0VmFsdWVTaGFwZSA9IE0uYXJyYXlPZihNLmtleSgpKTtcbnZhciBDb3B5QmFnVmFsdWVTaGFwZSA9IE0uYmFnKCk7XG52YXIgQW1vdW50VmFsdWVTaGFwZSA9IE0ub3IoXG4gIE5hdFZhbHVlU2hhcGUsXG4gIENvcHlTZXRWYWx1ZVNoYXBlLFxuICBTZXRWYWx1ZVNoYXBlLFxuICBDb3B5QmFnVmFsdWVTaGFwZVxuKTtcbnZhciBBbW91bnRTaGFwZSA9IHsgYnJhbmQ6IEJyYW5kU2hhcGUsIHZhbHVlOiBBbW91bnRWYWx1ZVNoYXBlIH07XG5oYXJkZW4oQW1vdW50U2hhcGUpO1xudmFyIEFtb3VudFBhdHRlcm5TaGFwZSA9IE0ucGF0dGVybigpO1xudmFyIFJhdGlvU2hhcGUgPSB7IG51bWVyYXRvcjogQW1vdW50U2hhcGUsIGRlbm9taW5hdG9yOiBBbW91bnRTaGFwZSB9O1xuaGFyZGVuKFJhdGlvU2hhcGUpO1xudmFyIGlzTmF0VmFsdWUgPSAodmFsdWUpID0+IG1hdGNoZXModmFsdWUsIE5hdFZhbHVlU2hhcGUpO1xuaGFyZGVuKGlzTmF0VmFsdWUpO1xudmFyIGlzQ29weVNldFZhbHVlID0gKHZhbHVlKSA9PiBtYXRjaGVzKHZhbHVlLCBDb3B5U2V0VmFsdWVTaGFwZSk7XG5oYXJkZW4oaXNDb3B5U2V0VmFsdWUpO1xudmFyIGlzU2V0VmFsdWUgPSAodmFsdWUpID0+IG1hdGNoZXModmFsdWUsIFNldFZhbHVlU2hhcGUpO1xuaGFyZGVuKGlzU2V0VmFsdWUpO1xudmFyIGlzQ29weUJhZ1ZhbHVlID0gKHZhbHVlKSA9PiBtYXRjaGVzKHZhbHVlLCBDb3B5QmFnVmFsdWVTaGFwZSk7XG5oYXJkZW4oaXNDb3B5QmFnVmFsdWUpO1xudmFyIE1BWF9BQlNPTFVURV9ERUNJTUFMX1BMQUNFUyA9IDEwMDtcbnZhciBBc3NldEtpbmRTaGFwZSA9IE0ub3IoXCJuYXRcIiwgXCJzZXRcIiwgXCJjb3B5U2V0XCIsIFwiY29weUJhZ1wiKTtcbnZhciBEaXNwbGF5SW5mb1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge30sXG4gIHtcbiAgICBkZWNpbWFsUGxhY2VzOiBNLmFuZChcbiAgICAgIE0uZ3RlKC1NQVhfQUJTT0xVVEVfREVDSU1BTF9QTEFDRVMpLFxuICAgICAgTS5sdGUoTUFYX0FCU09MVVRFX0RFQ0lNQUxfUExBQ0VTKVxuICAgICksXG4gICAgYXNzZXRLaW5kOiBBc3NldEtpbmRTaGFwZVxuICB9LFxuICB7XG4gICAgLy9cbiAgICAvL1xuICB9XG4pO1xudmFyIElzc3VlcktpdFNoYXBlID0ge1xuICBicmFuZDogQnJhbmRTaGFwZSxcbiAgbWludDogTWludFNoYXBlLFxuICBtaW50UmVjb3ZlcnlQdXJzZTogUHVyc2VTaGFwZSxcbiAgaXNzdWVyOiBJc3N1ZXJTaGFwZSxcbiAgZGlzcGxheUluZm86IERpc3BsYXlJbmZvU2hhcGVcbn07XG5oYXJkZW4oSXNzdWVyS2l0U2hhcGUpO1xudmFyIEJyYW5kSSA9IE0uaW50ZXJmYWNlKFwiQnJhbmRcIiwge1xuICBpc015SXNzdWVyOiBNLmNhbGxXaGVuKE0uYXdhaXQoSXNzdWVyU2hhcGUpKS5yZXR1cm5zKE0uYm9vbGVhbigpKSxcbiAgZ2V0QWxsZWdlZE5hbWU6IE0uY2FsbCgpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIGdldERpc3BsYXlJbmZvOiBNLmNhbGwoKS5yZXR1cm5zKERpc3BsYXlJbmZvU2hhcGUpLFxuICBnZXRBbW91bnRTaGFwZTogTS5jYWxsKCkucmV0dXJucyhNLnBhdHRlcm4oKSlcbn0pO1xudmFyIG1ha2VJc3N1ZXJJbnRlcmZhY2VzID0gKGJyYW5kU2hhcGUgPSBCcmFuZFNoYXBlLCBhc3NldEtpbmRTaGFwZSA9IEFzc2V0S2luZFNoYXBlLCBhbW91bnRTaGFwZSA9IEFtb3VudFNoYXBlKSA9PiB7XG4gIGNvbnN0IElzc3VlckkgPSBNLmludGVyZmFjZShcIklzc3VlclwiLCB7XG4gICAgZ2V0QnJhbmQ6IE0uY2FsbCgpLnJldHVybnMoYnJhbmRTaGFwZSksXG4gICAgZ2V0QWxsZWdlZE5hbWU6IE0uY2FsbCgpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gICAgZ2V0QXNzZXRLaW5kOiBNLmNhbGwoKS5yZXR1cm5zKGFzc2V0S2luZFNoYXBlKSxcbiAgICBnZXREaXNwbGF5SW5mbzogTS5jYWxsKCkucmV0dXJucyhEaXNwbGF5SW5mb1NoYXBlKSxcbiAgICBtYWtlRW1wdHlQdXJzZTogTS5jYWxsKCkucmV0dXJucyhQdXJzZVNoYXBlKSxcbiAgICBpc0xpdmU6IE0uY2FsbFdoZW4oTS5hd2FpdChQYXltZW50U2hhcGUpKS5yZXR1cm5zKE0uYm9vbGVhbigpKSxcbiAgICBnZXRBbW91bnRPZjogTS5jYWxsV2hlbihNLmF3YWl0KFBheW1lbnRTaGFwZSkpLnJldHVybnMoYW1vdW50U2hhcGUpLFxuICAgIGJ1cm46IE0uY2FsbFdoZW4oTS5hd2FpdChQYXltZW50U2hhcGUpKS5vcHRpb25hbChBbW91bnRQYXR0ZXJuU2hhcGUpLnJldHVybnMoYW1vdW50U2hhcGUpXG4gIH0pO1xuICBjb25zdCBNaW50SSA9IE0uaW50ZXJmYWNlKFwiTWludFwiLCB7XG4gICAgZ2V0SXNzdWVyOiBNLmNhbGwoKS5yZXR1cm5zKElzc3VlclNoYXBlKSxcbiAgICBtaW50UGF5bWVudDogTS5jYWxsKGFtb3VudFNoYXBlKS5yZXR1cm5zKFBheW1lbnRTaGFwZSlcbiAgfSk7XG4gIGNvbnN0IFBheW1lbnRJID0gTS5pbnRlcmZhY2UoXCJQYXltZW50XCIsIHtcbiAgICBnZXRBbGxlZ2VkQnJhbmQ6IE0uY2FsbCgpLnJldHVybnMoYnJhbmRTaGFwZSlcbiAgfSk7XG4gIGNvbnN0IFB1cnNlSSA9IE0uaW50ZXJmYWNlKFwiUHVyc2VcIiwge1xuICAgIGdldEFsbGVnZWRCcmFuZDogTS5jYWxsKCkucmV0dXJucyhicmFuZFNoYXBlKSxcbiAgICBnZXRDdXJyZW50QW1vdW50OiBNLmNhbGwoKS5yZXR1cm5zKGFtb3VudFNoYXBlKSxcbiAgICBnZXRDdXJyZW50QW1vdW50Tm90aWZpZXI6IE0uY2FsbCgpLnJldHVybnMoTm90aWZpZXJTaGFwZSksXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICBkZXBvc2l0OiBNLmNhbGwoUGF5bWVudFNoYXBlKS5vcHRpb25hbChBbW91bnRQYXR0ZXJuU2hhcGUpLnJldHVybnMoYW1vdW50U2hhcGUpLFxuICAgIGdldERlcG9zaXRGYWNldDogTS5jYWxsKCkucmV0dXJucyhEZXBvc2l0RmFjZXRTaGFwZSksXG4gICAgd2l0aGRyYXc6IE0uY2FsbChhbW91bnRTaGFwZSkucmV0dXJucyhQYXltZW50U2hhcGUpLFxuICAgIGdldFJlY292ZXJ5U2V0OiBNLmNhbGwoKS5yZXR1cm5zKE0uc2V0T2YoUGF5bWVudFNoYXBlKSksXG4gICAgcmVjb3ZlckFsbDogTS5jYWxsKCkucmV0dXJucyhhbW91bnRTaGFwZSlcbiAgfSk7XG4gIGNvbnN0IERlcG9zaXRGYWNldEkgPSBNLmludGVyZmFjZShcIkRlcG9zaXRGYWNldFwiLCB7XG4gICAgcmVjZWl2ZTogZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKFB1cnNlSSkubWV0aG9kR3VhcmRzLmRlcG9zaXRcbiAgfSk7XG4gIGNvbnN0IFB1cnNlSUtpdCA9IHtcbiAgICBwdXJzZTogUHVyc2VJLFxuICAgIGRlcG9zaXRGYWNldDogRGVwb3NpdEZhY2V0SVxuICB9O1xuICBoYXJkZW4oUHVyc2VJS2l0KTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgSXNzdWVySSxcbiAgICBNaW50SSxcbiAgICBQYXltZW50SSxcbiAgICBQdXJzZUlLaXRcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VJc3N1ZXJJbnRlcmZhY2VzKTtcblxuLy9cbnZhciBjb2VyY2VEaXNwbGF5SW5mbyA9IChhbGxlZ2VkRGlzcGxheUluZm8sIGFzc2V0S2luZCkgPT4ge1xuICBtdXN0TWF0Y2gyKGFsbGVnZWREaXNwbGF5SW5mbywgRGlzcGxheUluZm9TaGFwZSwgXCJkaXNwbGF5SW5mb1wiKTtcbiAgaWYgKGFsbGVnZWREaXNwbGF5SW5mby5hc3NldEtpbmQgIT09IHZvaWQgMCkge1xuICAgIGFsbGVnZWREaXNwbGF5SW5mby5hc3NldEtpbmQgPT09IGFzc2V0S2luZCB8fCB0aHJvd1JlZGFjdGVkYGRpc3BsYXlJbmZvLmFzc2V0S2luZCB3YXMgcHJlc2VudCAoJHthbGxlZ2VkRGlzcGxheUluZm8uYXNzZXRLaW5kfSkgYW5kIGRpZCBub3QgbWF0Y2ggdGhlIGFzc2V0S2luZCBhcmd1bWVudCAoJHthc3NldEtpbmR9KWA7XG4gIH1cbiAgY29uc3QgZGlzcGxheUluZm8gPSBoYXJkZW4oeyAuLi5hbGxlZ2VkRGlzcGxheUluZm8sIGFzc2V0S2luZCB9KTtcbiAgaWYgKGRpc3BsYXlJbmZvLmRlY2ltYWxQbGFjZXMgIT09IHZvaWQgMCkge1xuICAgIE51bWJlci5pc1NhZmVJbnRlZ2VyKGRpc3BsYXlJbmZvLmRlY2ltYWxQbGFjZXMpIHx8IHRocm93UmVkYWN0ZWRgZGVjaW1hbFBsYWNlcyAke2Rpc3BsYXlJbmZvLmRlY2ltYWxQbGFjZXN9IGlzIG5vdCBhIHNhZmUgaW50ZWdlcmA7XG4gIH1cbiAgcmV0dXJuIGRpc3BsYXlJbmZvO1xufTtcblxuLy9cbnZhciBwcmVwYXJlUGF5bWVudEtpbmQgPSAoaXNzdWVyWm9uZSwgbmFtZSwgYnJhbmQsIFBheW1lbnRJKSA9PiB7XG4gIGNvbnN0IG1ha2VQYXltZW50ID0gaXNzdWVyWm9uZS5leG9DbGFzcyhcbiAgICBgJHtuYW1lfSBwYXltZW50YCxcbiAgICBQYXltZW50SSxcbiAgICBpbml0RW1wdHksXG4gICAge1xuICAgICAgZ2V0QWxsZWdlZEJyYW5kKCkge1xuICAgICAgICByZXR1cm4gYnJhbmQ7XG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4gbWFrZVBheW1lbnQ7XG59O1xuaGFyZGVuKHByZXBhcmVQYXltZW50S2luZCk7XG5cbi8vXG52YXIgc2luayA9ICgpID0+IHtcbn07XG52YXIgbWFrZVF1aWV0UmVqZWN0aW9uID0gKHJlYXNvbikgPT4ge1xuICBjb25zdCByZWplY3Rpb24gPSBoYXJkZW4oUHJvbWlzZS5yZWplY3QocmVhc29uKSk7XG4gIHZvaWQgRS53aGVuKHJlamVjdGlvbiwgc2luaywgc2luayk7XG4gIHJldHVybiByZWplY3Rpb247XG59O1xudmFyIHRvb0ZhclJlamVjdGlvbiA9IG1ha2VRdWlldFJlamVjdGlvbihcbiAgaGFyZGVuKEVycm9yKFwiQ2Fubm90IHJlYWQgcGFzdCBlbmQgb2YgaXRlcmF0aW9uLlwiKSlcbik7XG52YXIgUHVibGlzaGVySSA9IE0uaW50ZXJmYWNlKFwiUHVibGlzaGVyXCIsIHtcbiAgcHVibGlzaDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoKSxcbiAgZmluaXNoOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpLFxuICBmYWlsOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpXG59KTtcbnZhciBVcGRhdGVDb3VudFNoYXBlID0gTS5vcihNLmJpZ2ludCgpLCBNLm51bWJlcigpKTtcbnZhciBTdWJzY3JpYmVySSA9IE0uaW50ZXJmYWNlKFwiU3Vic2NyaWJlclwiLCB7XG4gIHN1YnNjcmliZUFmdGVyOiBNLmNhbGwoKS5vcHRpb25hbChNLmJpZ2ludCgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0VXBkYXRlU2luY2U6IE0uY2FsbCgpLm9wdGlvbmFsKFVwZGF0ZUNvdW50U2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpXG59KTtcbnZhciBwdWJsaXNoS2l0SUtpdCA9IGhhcmRlbih7XG4gIHB1Ymxpc2hlcjogUHVibGlzaGVySSxcbiAgc3Vic2NyaWJlcjogU3Vic2NyaWJlcklcbn0pO1xudmFyIEZvcmthYmxlQXN5bmNJdGVyYWJsZUl0ZXJhdG9yU2hhcGUgPSBNLmludGVyZmFjZShcbiAgXCJGb3JrYWJsZUFzeW5jSXRlcmFibGVJdGVyYXRvclwiLFxuICB7XG4gICAgZm9yazogTS5jYWxsKCkucmV0dXJucyhNLmFueSgpKSxcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiBNLmNhbGwoKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgIC8vXG4gICAgbmV4dDogTS5jYWxsV2hlbigpLnJldHVybnMoTS5hbnkoKSlcbiAgfVxuKTtcbnZhciBJdGVyYWJsZUVhY2hUb3BpY0kgPSBNLmludGVyZmFjZShcIkl0ZXJhYmxlRWFjaFRvcGljXCIsIHtcbiAgc3Vic2NyaWJlQWZ0ZXI6IGdldEludGVyZmFjZUd1YXJkUGF5bG9hZChTdWJzY3JpYmVySSkubWV0aG9kR3VhcmRzLnN1YnNjcmliZUFmdGVyLFxuICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiBNLmNhbGwoKS5yZXR1cm5zKFxuICAgIE0ucmVtb3RhYmxlKFwiRm9ya2FibGVBc3luY0l0ZXJhYmxlSXRlcmF0b3JcIilcbiAgKVxufSk7XG52YXIgSXRlcmFibGVMYXRlc3RUb3BpY0kgPSBNLmludGVyZmFjZShcIkl0ZXJhYmxlTGF0ZXN0VG9waWNcIiwge1xuICBnZXRVcGRhdGVTaW5jZTogZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKFN1YnNjcmliZXJJKS5tZXRob2RHdWFyZHMuZ2V0VXBkYXRlU2luY2UsXG4gIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06IE0uY2FsbCgpLnJldHVybnMoXG4gICAgTS5yZW1vdGFibGUoXCJGb3JrYWJsZUFzeW5jSXRlcmFibGVJdGVyYXRvclwiKVxuICApXG59KTtcbnZhciB3ZWFrTWVtb2l6ZVVuYXJ5ID0gKGZuKSA9PiB7XG4gIGNvbnN0IGNhY2hlID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIHJldHVybiAoYXJnKSA9PiB7XG4gICAgY29uc3Qgb2FyZyA9IGFyZztcbiAgICBpZiAoY2FjaGUuaGFzKG9hcmcpKSB7XG4gICAgICByZXR1cm4gY2FjaGUuZ2V0KG9hcmcpO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQgPSBmbihhcmcpO1xuICAgIGNhY2hlLnNldChvYXJnLCByZXN1bHQpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG59O1xudmFyIG1ha2VVcGRhdGVSZWNvcmRGcm9tUHVibGljYXRpb25SZWNvcmQgPSAocmVjb3JkKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBoZWFkOiB7IHZhbHVlLCBkb25lIH0sXG4gICAgcHVibGlzaENvdW50XG4gIH0gPSByZWNvcmQ7XG4gIGlmIChkb25lKSB7XG4gICAgcmV0dXJuIGhhcmRlbih7IHZhbHVlLCB1cGRhdGVDb3VudDogdm9pZCAwIH0pO1xuICB9XG4gIHJldHVybiBoYXJkZW4oeyB2YWx1ZSwgdXBkYXRlQ291bnQ6IHB1Ymxpc2hDb3VudCB9KTtcbn07XG52YXIgbWFrZVB1Ymxpc2hLaXQgPSAoKSA9PiB7XG4gIGxldCB0YWlsUDtcbiAgbGV0IHRhaWxSO1xuICAoeyBwcm9taXNlOiB0YWlsUCwgcmVzb2x2ZTogdGFpbFIgfSA9IG1ha2VQcm9taXNlS2l0KCkpO1xuICBsZXQgY3VycmVudFB1Ymxpc2hDb3VudCA9IDBuO1xuICBsZXQgY3VycmVudFAgPSB0YWlsUDtcbiAgY29uc3QgYWR2YW5jZUN1cnJlbnQgPSAoZG9uZSwgdmFsdWUsIHJlamVjdGlvbikgPT4ge1xuICAgIGlmICh0YWlsUiA9PT0gdm9pZCAwKSB7XG4gICAgICB0aHJvdyBFcnJvcihcIkNhbm5vdCB1cGRhdGUgc3RhdGUgYWZ0ZXIgdGVybWluYXRpb24uXCIpO1xuICAgIH1cbiAgICBjdXJyZW50UHVibGlzaENvdW50ICs9IDFuO1xuICAgIGN1cnJlbnRQID0gdGFpbFA7XG4gICAgY29uc3QgcmVzb2x2ZUN1cnJlbnQgPSB0YWlsUjtcbiAgICBpZiAoZG9uZSkge1xuICAgICAgdGFpbFAgPSB0b29GYXJSZWplY3Rpb247XG4gICAgICB0YWlsUiA9IHZvaWQgMDtcbiAgICB9IGVsc2Uge1xuICAgICAgKHsgcHJvbWlzZTogdGFpbFAsIHJlc29sdmU6IHRhaWxSIH0gPSBtYWtlUHJvbWlzZUtpdCgpKTtcbiAgICB9XG4gICAgaWYgKHJlamVjdGlvbikge1xuICAgICAgcmVzb2x2ZUN1cnJlbnQocmVqZWN0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzb2x2ZUN1cnJlbnQoXG4gICAgICAgIGhhcmRlbih7XG4gICAgICAgICAgaGVhZDogeyB2YWx1ZSwgZG9uZSB9LFxuICAgICAgICAgIHB1Ymxpc2hDb3VudDogY3VycmVudFB1Ymxpc2hDb3VudCxcbiAgICAgICAgICB0YWlsOiB0YWlsUFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IG1ha2VNZW1vaXplZFVwZGF0ZVJlY29yZCA9IHdlYWtNZW1vaXplVW5hcnkoXG4gICAgbWFrZVVwZGF0ZVJlY29yZEZyb21QdWJsaWNhdGlvblJlY29yZFxuICApO1xuICBjb25zdCBzdWJzY3JpYmVyID0gRmFyKFwiU3Vic2NyaWJlclwiLCB7XG4gICAgc3Vic2NyaWJlQWZ0ZXI6IChwdWJsaXNoQ291bnQgPSAtMW4pID0+IHtcbiAgICAgIGFzc2VydC50eXBlb2YocHVibGlzaENvdW50LCBcImJpZ2ludFwiKTtcbiAgICAgIGlmIChwdWJsaXNoQ291bnQgPT09IGN1cnJlbnRQdWJsaXNoQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIHRhaWxQO1xuICAgICAgfSBlbHNlIGlmIChwdWJsaXNoQ291bnQgPCBjdXJyZW50UHVibGlzaENvdW50KSB7XG4gICAgICAgIHJldHVybiBjdXJyZW50UDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgIFwic3Vic2NyaWJlQWZ0ZXIgYXJndW1lbnQgbXVzdCBiZSBhIHByZXZpb3VzbHktaXNzdWVkIHB1Ymxpc2hDb3VudC5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG4gICAgZ2V0VXBkYXRlU2luY2U6ICh1cGRhdGVDb3VudCkgPT4ge1xuICAgICAgaWYgKHVwZGF0ZUNvdW50ID09PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIHN1YnNjcmliZXIuc3Vic2NyaWJlQWZ0ZXIoKS50aGVuKG1ha2VNZW1vaXplZFVwZGF0ZVJlY29yZCk7XG4gICAgICB9XG4gICAgICB1cGRhdGVDb3VudCA9IEJpZ0ludCh1cGRhdGVDb3VudCk7XG4gICAgICByZXR1cm4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcih1cGRhdGVDb3VudCkudGhlbigoKSA9PiBzdWJzY3JpYmVyLmdldFVwZGF0ZVNpbmNlKCkpO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IHB1Ymxpc2hlciA9IEZhcihcIlB1Ymxpc2hlclwiLCB7XG4gICAgcHVibGlzaDogKHZhbHVlKSA9PiB7XG4gICAgICBhZHZhbmNlQ3VycmVudChmYWxzZSwgdmFsdWUpO1xuICAgIH0sXG4gICAgZmluaXNoOiAoZmluYWxWYWx1ZSkgPT4ge1xuICAgICAgYWR2YW5jZUN1cnJlbnQodHJ1ZSwgZmluYWxWYWx1ZSk7XG4gICAgfSxcbiAgICBmYWlsOiAocmVhc29uKSA9PiB7XG4gICAgICBhZHZhbmNlQ3VycmVudCh0cnVlLCB2b2lkIDAsIG1ha2VRdWlldFJlamVjdGlvbihyZWFzb24pKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gaGFyZGVuKHsgcHVibGlzaGVyLCBzdWJzY3JpYmVyIH0pO1xufTtcbmhhcmRlbihtYWtlUHVibGlzaEtpdCk7XG52YXIgRHVyYWJsZVB1Ymxpc2hLaXRTdGF0ZVNoYXBlID0gaGFyZGVuKHtcbiAgdmFsdWVEdXJhYmlsaXR5OiBNLmFueSgpLFxuICBwdWJsaXNoQ291bnQ6IE0uYW55KCksXG4gIHN0YXR1czogTS5hbnkoKSxcbiAgaGFzVmFsdWU6IE0uYW55KCksXG4gIHZhbHVlOiBNLmFueSgpXG59KTtcbnZhciBpbml0RHVyYWJsZVB1Ymxpc2hLaXRTdGF0ZSA9IChvcHRpb25zID0ge30pID0+IHtcbiAgY29uc3QgeyB2YWx1ZUR1cmFiaWxpdHkgPSBcIm1hbmRhdG9yeVwiIH0gPSBvcHRpb25zO1xuICBhc3NlcnQuZXF1YWwodmFsdWVEdXJhYmlsaXR5LCBcIm1hbmRhdG9yeVwiKTtcbiAgcmV0dXJuIHtcbiAgICAvL1xuICAgIHZhbHVlRHVyYWJpbGl0eSxcbiAgICAvL1xuICAgIHB1Ymxpc2hDb3VudDogMG4sXG4gICAgc3RhdHVzOiBcImxpdmVcIixcbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIGhhc1ZhbHVlOiBmYWxzZSxcbiAgICB2YWx1ZTogdm9pZCAwXG4gIH07XG59O1xudmFyIGdldEVwaGVtZXJhbEtleSA9IChmYWNldHMpID0+IGZhY2V0cy5wdWJsaXNoZXI7XG52YXIgZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG52YXIgcHJvdmlkZUN1cnJlbnRQID0gKHN0YXRlLCBmYWNldHMsIHRhaWwpID0+IHtcbiAgY29uc3QgZXBoZW1lcmFsS2V5ID0gZ2V0RXBoZW1lcmFsS2V5KGZhY2V0cyk7XG4gIGNvbnN0IGZvdW5kRGF0YSA9IGR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YS5nZXQoZXBoZW1lcmFsS2V5KTtcbiAgY29uc3QgY3VycmVudFAgPSBmb3VuZERhdGEgJiYgZm91bmREYXRhLmN1cnJlbnRQO1xuICBpZiAoY3VycmVudFApIHtcbiAgICByZXR1cm4gY3VycmVudFA7XG4gIH1cbiAgY29uc3QgeyBwdWJsaXNoQ291bnQsIHN0YXR1cywgaGFzVmFsdWUsIHZhbHVlIH0gPSBzdGF0ZTtcbiAgaWYgKCFoYXNWYWx1ZSkge1xuICAgIGFzc2VydChzdGF0dXMgPT09IFwibGl2ZVwiKTtcbiAgICByZXR1cm4gdGFpbDtcbiAgfVxuICBpZiAoc3RhdHVzID09PSBcImxpdmVcIiB8fCBzdGF0dXMgPT09IFwiZmluaXNoZWRcIikge1xuICAgIGNvbnN0IGNlbGwgPSBoYXJkZW4oe1xuICAgICAgaGVhZDogeyB2YWx1ZSwgZG9uZTogc3RhdHVzICE9PSBcImxpdmVcIiB9LFxuICAgICAgcHVibGlzaENvdW50LFxuICAgICAgdGFpbFxuICAgIH0pO1xuICAgIHJldHVybiBFLnJlc29sdmUoY2VsbCk7XG4gIH0gZWxzZSBpZiAoc3RhdHVzID09PSBcImZhaWxlZFwiKSB7XG4gICAgcmV0dXJuIG1ha2VRdWlldFJlamVjdGlvbih2YWx1ZSk7XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBJbnZhbGlkIGR1cmFibGUgcHJvbWlzZSBraXQgc3RhdHVzOiAke3F1b3RlKHN0YXR1cyl9YDtcbiAgfVxufTtcbnZhciBwcm92aWRlRHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhID0gKHN0YXRlLCBmYWNldHMpID0+IHtcbiAgY29uc3QgZXBoZW1lcmFsS2V5ID0gZ2V0RXBoZW1lcmFsS2V5KGZhY2V0cyk7XG4gIGNvbnN0IGZvdW5kRGF0YSA9IGR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YS5nZXQoZXBoZW1lcmFsS2V5KTtcbiAgaWYgKGZvdW5kRGF0YSkge1xuICAgIHJldHVybiBmb3VuZERhdGE7XG4gIH1cbiAgY29uc3QgeyBzdGF0dXMgfSA9IHN0YXRlO1xuICBsZXQgdGFpbFA7XG4gIGxldCB0YWlsUjtcbiAgaWYgKHN0YXR1cyA9PT0gXCJsaXZlXCIpIHtcbiAgICAoeyBwcm9taXNlOiB0YWlsUCwgcmVzb2x2ZTogdGFpbFIgfSA9IG1ha2VQcm9taXNlS2l0KCkpO1xuICAgIHZvaWQgRS53aGVuKHRhaWxQLCBzaW5rLCBzaW5rKTtcbiAgfSBlbHNlIGlmIChzdGF0dXMgPT09IFwiZmluaXNoZWRcIiB8fCBzdGF0dXMgPT09IFwiZmFpbGVkXCIpIHtcbiAgICB0YWlsUCA9IHRvb0ZhclJlamVjdGlvbjtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEludmFsaWQgZHVyYWJsZSBwcm9taXNlIGtpdCBzdGF0dXM6ICR7cXVvdGUoc3RhdHVzKX1gO1xuICB9XG4gIGNvbnN0IG9iaiA9IGhhcmRlbih7IGN1cnJlbnRQOiB2b2lkIDAsIHRhaWxQLCB0YWlsUiB9KTtcbiAgZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhLnNldChlcGhlbWVyYWxLZXksIG9iaik7XG4gIHJldHVybiBvYmo7XG59O1xudmFyIGFkdmFuY2VEdXJhYmxlUHVibGlzaEtpdCA9IChjb250ZXh0LCB2YWx1ZSwgdGFyZ2V0U3RhdHVzID0gXCJsaXZlXCIpID0+IHtcbiAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSBjb250ZXh0O1xuICBjb25zdCB7IHZhbHVlRHVyYWJpbGl0eSwgc3RhdHVzIH0gPSBzdGF0ZTtcbiAgaWYgKHN0YXR1cyAhPT0gXCJsaXZlXCIpIHtcbiAgICB0aHJvdyBFcnJvcihcIkNhbm5vdCB1cGRhdGUgc3RhdGUgYWZ0ZXIgdGVybWluYXRpb24uXCIpO1xuICB9XG4gIGNvbnN0IGRvbmUgPSB0YXJnZXRTdGF0dXMgIT09IFwibGl2ZVwiO1xuICBpZiAoZG9uZSB8fCB2YWx1ZUR1cmFiaWxpdHkgPT09IFwibWFuZGF0b3J5XCIpIHtcbiAgICBjYW5CZUR1cmFibGUodmFsdWUpIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IGFjY2VwdCBub24tZHVyYWJsZSB2YWx1ZTogJHt2YWx1ZX1gO1xuICB9XG4gIGNvbnN0IHsgdGFpbFA6IG9sZFRhaWxQLCB0YWlsUjogcmVzb2x2ZU9sZFRhaWwgfSA9IHByb3ZpZGVEdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEoc3RhdGUsIGZhY2V0cyk7XG4gIGFzc2VydC50eXBlb2YocmVzb2x2ZU9sZFRhaWwsIFwiZnVuY3Rpb25cIik7XG4gIGNvbnN0IHB1Ymxpc2hDb3VudCA9IHN0YXRlLnB1Ymxpc2hDb3VudCArIDFuO1xuICBzdGF0ZS5wdWJsaXNoQ291bnQgPSBwdWJsaXNoQ291bnQ7XG4gIGxldCB0YWlsUDtcbiAgbGV0IHRhaWxSO1xuICBpZiAoZG9uZSkge1xuICAgIHN0YXRlLnN0YXR1cyA9IHRhcmdldFN0YXR1cztcbiAgICB0YWlsUCA9IHRvb0ZhclJlamVjdGlvbjtcbiAgICB0YWlsUiA9IHZvaWQgMDtcbiAgfSBlbHNlIHtcbiAgICAoeyBwcm9taXNlOiB0YWlsUCwgcmVzb2x2ZTogdGFpbFIgfSA9IG1ha2VQcm9taXNlS2l0KCkpO1xuICAgIHZvaWQgRS53aGVuKHRhaWxQLCBzaW5rLCBzaW5rKTtcbiAgfVxuICBsZXQgY3VycmVudFA7XG4gIGlmICh0YXJnZXRTdGF0dXMgPT09IFwiZmFpbGVkXCIpIHtcbiAgICBzdGF0ZS5oYXNWYWx1ZSA9IHRydWU7XG4gICAgc3RhdGUudmFsdWUgPSB2YWx1ZTtcbiAgICBjb25zdCByZWplY3Rpb24gPSBtYWtlUXVpZXRSZWplY3Rpb24odmFsdWUpO1xuICAgIHJlc29sdmVPbGRUYWlsKHJlamVjdGlvbik7XG4gIH0gZWxzZSB7XG4gICAgaWYgKGRvbmUgfHwgdmFsdWVEdXJhYmlsaXR5ICE9PSBcImlnbm9yZWRcIiAmJiBjYW5CZUR1cmFibGUodmFsdWUpKSB7XG4gICAgICBzdGF0ZS5oYXNWYWx1ZSA9IHRydWU7XG4gICAgICBzdGF0ZS52YWx1ZSA9IHZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdGF0ZS5oYXNWYWx1ZSA9IGZhbHNlO1xuICAgICAgc3RhdGUudmFsdWUgPSB2b2lkIDA7XG4gICAgICBjdXJyZW50UCA9IG9sZFRhaWxQO1xuICAgIH1cbiAgICByZXNvbHZlT2xkVGFpbChcbiAgICAgIGhhcmRlbih7XG4gICAgICAgIGhlYWQ6IHsgdmFsdWUsIGRvbmUgfSxcbiAgICAgICAgcHVibGlzaENvdW50LFxuICAgICAgICB0YWlsOiB0YWlsUFxuICAgICAgfSlcbiAgICApO1xuICB9XG4gIGR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YS5zZXQoXG4gICAgZ2V0RXBoZW1lcmFsS2V5KGZhY2V0cyksXG4gICAgaGFyZGVuKHsgY3VycmVudFAsIHRhaWxQLCB0YWlsUiB9KVxuICApO1xufTtcbnZhciBwcmVwYXJlRHVyYWJsZVB1Ymxpc2hLaXQgPSAoYmFnZ2FnZSwga2luZE5hbWUpID0+IHtcbiAgY29uc3QgbWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkID0gbWFrZVVwZGF0ZVJlY29yZEZyb21QdWJsaWNhdGlvblJlY29yZDtcbiAgcmV0dXJuIHByZXBhcmVFeG9DbGFzc0tpdChcbiAgICBiYWdnYWdlLFxuICAgIGtpbmROYW1lLFxuICAgIHB1Ymxpc2hLaXRJS2l0LFxuICAgIGluaXREdXJhYmxlUHVibGlzaEtpdFN0YXRlLFxuICAgIHtcbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgcHVibGlzaGVyOiB7XG4gICAgICAgIHB1Ymxpc2godmFsdWUpIHtcbiAgICAgICAgICBhZHZhbmNlRHVyYWJsZVB1Ymxpc2hLaXQodGhpcywgdmFsdWUpO1xuICAgICAgICB9LFxuICAgICAgICBmaW5pc2goZmluYWxWYWx1ZSkge1xuICAgICAgICAgIGFkdmFuY2VEdXJhYmxlUHVibGlzaEtpdCh0aGlzLCBmaW5hbFZhbHVlLCBcImZpbmlzaGVkXCIpO1xuICAgICAgICB9LFxuICAgICAgICBmYWlsKHJlYXNvbikge1xuICAgICAgICAgIGFkdmFuY2VEdXJhYmxlUHVibGlzaEtpdCh0aGlzLCByZWFzb24sIFwiZmFpbGVkXCIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICBzdWJzY3JpYmVyOiB7XG4gICAgICAgIHN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudCA9IC0xbikge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICBjb25zdCB7IHB1Ymxpc2hDb3VudDogY3VycmVudFB1Ymxpc2hDb3VudCB9ID0gc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyBjdXJyZW50UCwgdGFpbFAgfSA9IHByb3ZpZGVEdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEoXG4gICAgICAgICAgICBzdGF0ZSxcbiAgICAgICAgICAgIGZhY2V0c1xuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHB1Ymxpc2hDb3VudCA9PT0gY3VycmVudFB1Ymxpc2hDb3VudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRhaWxQO1xuICAgICAgICAgIH0gZWxzZSBpZiAocHVibGlzaENvdW50IDwgY3VycmVudFB1Ymxpc2hDb3VudCkge1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRQIHx8IHByb3ZpZGVDdXJyZW50UChzdGF0ZSwgZmFjZXRzLCB0YWlsUCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFxuICAgICAgICAgICAgICBcInN1YnNjcmliZUFmdGVyIGFyZ3VtZW50IG11c3QgYmUgYSBwcmV2aW91c2x5LWlzc3VlZCBwdWJsaXNoQ291bnQuXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBnZXRVcGRhdGVTaW5jZSh1cGRhdGVDb3VudCkge1xuICAgICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIGZhY2V0czogeyBzdWJzY3JpYmVyIH1cbiAgICAgICAgICB9ID0gdGhpcztcbiAgICAgICAgICBpZiAodXBkYXRlQ291bnQgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgcmV0dXJuIHN1YnNjcmliZXIuc3Vic2NyaWJlQWZ0ZXIoKS50aGVuKG1ha2VNZW1vaXplZFVwZGF0ZVJlY29yZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHVwZGF0ZUNvdW50ID0gQmlnSW50KHVwZGF0ZUNvdW50KTtcbiAgICAgICAgICByZXR1cm4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcih1cGRhdGVDb3VudCkudGhlbigoKSA9PiBzdWJzY3JpYmVyLmdldFVwZGF0ZVNpbmNlKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBzdGF0ZVNoYXBlOiBEdXJhYmxlUHVibGlzaEtpdFN0YXRlU2hhcGVcbiAgICB9XG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVEdXJhYmxlUHVibGlzaEtpdCk7XG52YXIgU3Vic2NyaWJlclNoYXBlID0gTS5yZW1vdGFibGUoXCJTdWJzY3JpYmVyXCIpO1xuXG4vL1xudmFyIHsgaXNGcm96ZW46IGlzRnJvemVuNiB9ID0gT2JqZWN0O1xudmFyIFVwZ3JhZGVEaXNjb25uZWN0aW9uU2hhcGUgPSBoYXJkZW4oe1xuICBuYW1lOiBcInZhdFVwZ3JhZGVkXCIsXG4gIHVwZ3JhZGVNZXNzYWdlOiBNLnN0cmluZygpLFxuICBpbmNhcm5hdGlvbk51bWJlcjogTS5udW1iZXIoKVxufSk7XG52YXIgbWFrZVVwZ3JhZGVEaXNjb25uZWN0aW9uID0gKHVwZ3JhZGVNZXNzYWdlLCB0b0luY2FybmF0aW9uTnVtYmVyKSA9PiBoYXJkZW4oe1xuICBuYW1lOiBcInZhdFVwZ3JhZGVkXCIsXG4gIHVwZ3JhZGVNZXNzYWdlLFxuICBpbmNhcm5hdGlvbk51bWJlcjogdG9JbmNhcm5hdGlvbk51bWJlclxufSk7XG5oYXJkZW4obWFrZVVwZ3JhZGVEaXNjb25uZWN0aW9uKTtcbnZhciBpc1VwZ3JhZGVEaXNjb25uZWN0aW9uID0gKHJlYXNvbikgPT4gcmVhc29uICE9IG51bGwgJiYgLy9cbmlzRnJvemVuNihyZWFzb24pICYmIG1hdGNoZXMocmVhc29uLCBVcGdyYWRlRGlzY29ubmVjdGlvblNoYXBlKTtcbmhhcmRlbihpc1VwZ3JhZGVEaXNjb25uZWN0aW9uKTtcbnZhciBpc0FiYW5kb25lZEVycm9yID0gKHJlYXNvbikgPT4gcmVhc29uICE9IG51bGwgJiYgLy9cbmlzRnJvemVuNihyZWFzb24pICYmIG1hdGNoZXMocmVhc29uLCBNLmVycm9yKCkpICYmIC8vXG4vL1xucmVhc29uLm1lc3NhZ2UgPT09IFwidmF0IHRlcm1pbmF0ZWRcIjtcbmhhcmRlbihpc0FiYW5kb25lZEVycm9yKTtcblxuLy9cbnZhciBzaW5rMiA9ICgpID0+IHtcbn07XG52YXIgcmVjb25uZWN0QXNOZWVkZWQgPSBhc3luYyAoZ2V0dGVyLCBzZWVkID0gW10pID0+IHtcbiAgbGV0IGRpc2Nvbm5lY3Rpb247XG4gIGxldCBsYXN0VmVyc2lvbiA9IC1JbmZpbml0eTtcbiAgYXdhaXQgbnVsbDtcbiAgZm9yIChsZXQgaTIgPSAwOyA7IGkyICs9IDEpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0UCA9IGkyIDwgc2VlZC5sZW5ndGggPyBzZWVkW2kyXSA6IGdldHRlcigpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzdWx0UDtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoaXNVcGdyYWRlRGlzY29ubmVjdGlvbihlcnIpKSB7XG4gICAgICAgIGlmICghZGlzY29ubmVjdGlvbikge1xuICAgICAgICAgIGRpc2Nvbm5lY3Rpb24gPSBlcnI7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBpbmNhcm5hdGlvbk51bWJlcjogdmVyc2lvbiB9ID0gZXJyO1xuICAgICAgICBpZiAodmVyc2lvbiA+IGxhc3RWZXJzaW9uKSB7XG4gICAgICAgICAgbGFzdFZlcnNpb24gPSB2ZXJzaW9uO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoaXNPYmplY3QyKGVycikgJiYgZGlzY29ubmVjdGlvbiAmJiBkaXNjb25uZWN0aW9uICE9PSBlcnIpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBub3RlKFxuICAgICAgICAgICAgZXJyLFxuICAgICAgICAgICAgcmVkYWN0ZWRgQXR0ZW1wdGluZyB0byByZWNvdmVyIGZyb20gZGlzY29ubmVjdGlvbjogJHtkaXNjb25uZWN0aW9ufWBcbiAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIChfZXJyKSB7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cbn07XG52YXIgbWFrZUVhY2hJdGVyYXRvciA9ICh0b3BpYywgbmV4dENlbGxQKSA9PiB7XG4gIGNvbnN0IHNlbGYgPSBGYXIoXCJFYWNoSXRlcmF0b3JcIiwge1xuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IHNlbGYsXG4gICAgbmV4dDogKCkgPT4ge1xuICAgICAgY29uc3Qge1xuICAgICAgICBoZWFkOiByZXN1bHRQLFxuICAgICAgICBwdWJsaXNoQ291bnQ6IHB1Ymxpc2hDb3VudFAsXG4gICAgICAgIHRhaWw6IHRhaWxQXG4gICAgICB9ID0gRS5nZXQobmV4dENlbGxQKTtcbiAgICAgIGNvbnN0IGdldFN1Y2Nlc3NvciA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcHVibGlzaENvdW50ID0gYXdhaXQgcHVibGlzaENvdW50UDtcbiAgICAgICAgYXNzZXJ0LnR5cGVvZihwdWJsaXNoQ291bnQsIFwiYmlnaW50XCIpO1xuICAgICAgICBjb25zdCBzdWNjZXNzb3IgPSBhd2FpdCBFKHRvcGljKS5zdWJzY3JpYmVBZnRlcihwdWJsaXNoQ291bnQpO1xuICAgICAgICBjb25zdCBuZXdQdWJsaXNoQ291bnQgPSBzdWNjZXNzb3IucHVibGlzaENvdW50O1xuICAgICAgICBpZiAobmV3UHVibGlzaENvdW50ICE9PSBwdWJsaXNoQ291bnQgKyAxbikge1xuICAgICAgICAgIHRocm93UmVkYWN0ZWRgZWFjaEl0ZXJhdG9yIGJyb2tlbiBieSBnYXAgZnJvbSBwdWJsaXNoQ291bnQgJHtwdWJsaXNoQ291bnR9IHRvICR7bmV3UHVibGlzaENvdW50fWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN1Y2Nlc3NvcjtcbiAgICAgIH07XG4gICAgICBuZXh0Q2VsbFAgPSByZWNvbm5lY3RBc05lZWRlZChnZXRTdWNjZXNzb3IsIFt0YWlsUF0pO1xuICAgICAgdm9pZCBFLndoZW4ocHVibGlzaENvdW50UCwgc2luazIsIHNpbmsyKTtcbiAgICAgIHZvaWQgRS53aGVuKG5leHRDZWxsUCwgc2luazIsIHNpbmsyKTtcbiAgICAgIHJldHVybiByZXN1bHRQO1xuICAgIH0sXG4gICAgZm9yazogKCkgPT4gbWFrZUVhY2hJdGVyYXRvcih0b3BpYywgbmV4dENlbGxQKVxuICB9KTtcbiAgcmV0dXJuIHNlbGY7XG59O1xudmFyIHN1YnNjcmliZUVhY2ggPSAodG9waWMpID0+IHtcbiAgY29uc3QgaXRlcmFibGUgPSBGYXIoXCJFYWNoSXRlcmFibGVcIiwge1xuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGNvbnN0IGZpcnN0Q2VsbFAgPSByZWNvbm5lY3RBc05lZWRlZCgoKSA9PiBFKHRvcGljKS5zdWJzY3JpYmVBZnRlcigpKTtcbiAgICAgIHJldHVybiBtYWtlRWFjaEl0ZXJhdG9yKHRvcGljLCBmaXJzdENlbGxQKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gaXRlcmFibGU7XG59O1xuaGFyZGVuKHN1YnNjcmliZUVhY2gpO1xudmFyIGNsb25lTGF0ZXN0SXRlcmF0b3IgPSAodG9waWMsIGxvY2FsVXBkYXRlQ291bnQsIHRlcm1pbmFsUmVzdWx0KSA9PiB7XG4gIGxldCBtdXRleCA9IFByb21pc2UucmVzb2x2ZSgpO1xuICBjb25zdCBtYXliZVJlcXVlc3ROZXh0UmVzdWx0ID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICh0ZXJtaW5hbFJlc3VsdCkge1xuICAgICAgcmV0dXJuIHRlcm1pbmFsUmVzdWx0O1xuICAgIH1cbiAgICBjb25zdCB7IHZhbHVlLCB1cGRhdGVDb3VudCB9ID0gYXdhaXQgcmVjb25uZWN0QXNOZWVkZWQoXG4gICAgICAoKSA9PiBFKHRvcGljKS5nZXRVcGRhdGVTaW5jZShsb2NhbFVwZGF0ZUNvdW50KVxuICAgICk7XG4gICAgbG9jYWxVcGRhdGVDb3VudCA9IHVwZGF0ZUNvdW50O1xuICAgIGlmICh1cGRhdGVDb3VudCA9PT0gdm9pZCAwKSB7XG4gICAgICB0ZXJtaW5hbFJlc3VsdCA9IGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlIH0pO1xuICAgICAgcmV0dXJuIHRlcm1pbmFsUmVzdWx0O1xuICAgIH1cbiAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlIH0pO1xuICB9O1xuICBjb25zdCBzZWxmID0gRmFyKFwiTGF0ZXN0SXRlcmF0b3JcIiwge1xuICAgIGZvcms6ICgpID0+IGNsb25lTGF0ZXN0SXRlcmF0b3IodG9waWMsIGxvY2FsVXBkYXRlQ291bnQsIHRlcm1pbmFsUmVzdWx0KSxcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiAoKSA9PiBzZWxmLFxuICAgIG5leHQ6IGFzeW5jICgpID0+IHtcbiAgICAgIGlmICh0ZXJtaW5hbFJlc3VsdCkge1xuICAgICAgICByZXR1cm4gdGVybWluYWxSZXN1bHQ7XG4gICAgICB9XG4gICAgICBjb25zdCBuZXh0UmVzdWx0ID0gbXV0ZXgudGhlbihtYXliZVJlcXVlc3ROZXh0UmVzdWx0KTtcbiAgICAgIG11dGV4ID0gbmV4dFJlc3VsdC50aGVuKHNpbmsyLCBzaW5rMik7XG4gICAgICByZXR1cm4gbmV4dFJlc3VsdDtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gc2VsZjtcbn07XG52YXIgbWFrZUxhdGVzdEl0ZXJhdG9yID0gKHRvcGljKSA9PiBjbG9uZUxhdGVzdEl0ZXJhdG9yKHRvcGljKTtcbnZhciBzdWJzY3JpYmVMYXRlc3QgPSAodG9waWMpID0+IHtcbiAgY29uc3QgaXRlcmFibGUgPSBGYXIoXCJMYXRlc3RJdGVyYWJsZVwiLCB7XG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogKCkgPT4gbWFrZUxhdGVzdEl0ZXJhdG9yKHRvcGljKVxuICB9KTtcbiAgcmV0dXJuIGl0ZXJhYmxlO1xufTtcbmhhcmRlbihzdWJzY3JpYmVMYXRlc3QpO1xuXG4vL1xudmFyIG1ha2VOb3RpZmllciA9IChzaGFyYWJsZUludGVybmFsc1ApID0+IHtcbiAgY29uc3Qgbm90aWZpZXIgPSBGYXIoXCJub3RpZmllclwiLCB7XG4gICAgLi4uc3Vic2NyaWJlTGF0ZXN0KHNoYXJhYmxlSW50ZXJuYWxzUCksXG4gICAgZ2V0VXBkYXRlU2luY2U6IGFzeW5jICh1cGRhdGVDb3VudCkgPT4gRShzaGFyYWJsZUludGVybmFsc1ApLmdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KSxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgZ2V0U2hhcmFibGVOb3RpZmllckludGVybmFsczogYXN5bmMgKCkgPT4gc2hhcmFibGVJbnRlcm5hbHNQLFxuICAgIC8qXG5cblxuXG4gICAgICovXG4gICAgZ2V0U3RvcmVLZXk6ICgpID0+IGhhcmRlbih7IG5vdGlmaWVyIH0pXG4gIH0pO1xuICByZXR1cm4gbm90aWZpZXI7XG59O1xudmFyIG1ha2VOb3RpZmllckZyb21TdWJzY3JpYmVyID0gKHN1YnNjcmliZXIpID0+IHtcbiAgY29uc3QgYmFzZU5vdGlmaWVyID0gaGFyZGVuKHtcbiAgICBnZXRVcGRhdGVTaW5jZTogKHVwZGF0ZUNvdW50ID0gdm9pZCAwKSA9PiBFKHN1YnNjcmliZXIpLmdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KVxuICB9KTtcbiAgY29uc3Qgbm90aWZpZXIgPSBGYXIoXCJub3RpZmllclwiLCB7XG4gICAgLi4ubWFrZU5vdGlmaWVyKGJhc2VOb3RpZmllciksXG4gICAgLi4uYmFzZU5vdGlmaWVyXG4gIH0pO1xuICByZXR1cm4gbm90aWZpZXI7XG59O1xuaGFyZGVuKG1ha2VOb3RpZmllckZyb21TdWJzY3JpYmVyKTtcbnZhciBtYWtlTm90aWZpZXJLaXQgPSAoLi4uaW5pdGlhbFN0YXRlQXJyKSA9PiB7XG4gIGNvbnN0IHsgcHVibGlzaGVyLCBzdWJzY3JpYmVyIH0gPSBtYWtlUHVibGlzaEtpdCgpO1xuICBjb25zdCBub3RpZmllciA9IG1ha2VOb3RpZmllckZyb21TdWJzY3JpYmVyKHN1YnNjcmliZXIpO1xuICBjb25zdCB1cGRhdGVyID0gRmFyKFwidXBkYXRlclwiLCB7XG4gICAgdXBkYXRlU3RhdGU6IChzdGF0ZSkgPT4gcHVibGlzaGVyLnB1Ymxpc2goc3RhdGUpLFxuICAgIGZpbmlzaDogKGNvbXBsZXRpb24pID0+IHB1Ymxpc2hlci5maW5pc2goY29tcGxldGlvbiksXG4gICAgZmFpbDogKHJlYXNvbikgPT4gcHVibGlzaGVyLmZhaWwocmVhc29uKVxuICB9KTtcbiAgYXNzZXJ0Mihpbml0aWFsU3RhdGVBcnIubGVuZ3RoIDw9IDEsIFwidG9vIG1hbnkgYXJndW1lbnRzXCIpO1xuICBpZiAoaW5pdGlhbFN0YXRlQXJyLmxlbmd0aCA9PT0gMSkge1xuICAgIHVwZGF0ZXIudXBkYXRlU3RhdGUoaW5pdGlhbFN0YXRlQXJyWzBdKTtcbiAgfVxuICByZXR1cm4gaGFyZGVuKHsgbm90aWZpZXIsIHVwZGF0ZXIgfSk7XG59O1xudmFyIG1ha2VOb3RpZmllckZyb21Bc3luY0l0ZXJhYmxlID0gKGFzeW5jSXRlcmFibGVQKSA9PiB7XG4gIGNvbnN0IGl0ZXJhdG9yUCA9IEUoYXN5bmNJdGVyYWJsZVApW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpO1xuICBsZXQgb3B0TmV4dFByb21pc2U7XG4gIGxldCBjdXJyZW50VXBkYXRlQ291bnQgPSAwbjtcbiAgbGV0IGN1cnJlbnRSZXNwb25zZTtcbiAgbGV0IGZpbmFsID0gZmFsc2U7XG4gIGNvbnN0IGJhc2VOb3RpZmllciA9IEZhcihcImJhc2VOb3RpZmllclwiLCB7XG4gICAgZ2V0VXBkYXRlU2luY2UodXBkYXRlQ291bnQgPSAtMW4pIHtcbiAgICAgIGlmICh1cGRhdGVDb3VudCA8IGN1cnJlbnRVcGRhdGVDb3VudCkge1xuICAgICAgICBpZiAoY3VycmVudFJlc3BvbnNlKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjdXJyZW50UmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHVwZGF0ZUNvdW50ICE9PSBjdXJyZW50VXBkYXRlQ291bnQpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgXCJnZXRVcGRhdGVTaW5jZSBhcmd1bWVudCBtdXN0IGJlIGEgcHJldmlvdXNseS1pc3N1ZWQgdXBkYXRlQ291bnQuXCJcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChmaW5hbCkge1xuICAgICAgICBhc3NlcnQyKGN1cnJlbnRSZXNwb25zZSAhPT0gdm9pZCAwKTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjdXJyZW50UmVzcG9uc2UpO1xuICAgICAgfVxuICAgICAgaWYgKCFvcHROZXh0UHJvbWlzZSkge1xuICAgICAgICBjb25zdCBuZXh0SXRlclJlc3VsdFAgPSBFKGl0ZXJhdG9yUCkubmV4dCgpO1xuICAgICAgICBvcHROZXh0UHJvbWlzZSA9IEUud2hlbihcbiAgICAgICAgICBuZXh0SXRlclJlc3VsdFAsXG4gICAgICAgICAgKHsgZG9uZSwgdmFsdWUgfSkgPT4ge1xuICAgICAgICAgICAgYXNzZXJ0MighZmluYWwpO1xuICAgICAgICAgICAgaWYgKGRvbmUpIHtcbiAgICAgICAgICAgICAgZmluYWwgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3VycmVudFVwZGF0ZUNvdW50ICs9IDFuO1xuICAgICAgICAgICAgY3VycmVudFJlc3BvbnNlID0gaGFyZGVuKHtcbiAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgIHVwZGF0ZUNvdW50OiBkb25lID8gdm9pZCAwIDogY3VycmVudFVwZGF0ZUNvdW50XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG9wdE5leHRQcm9taXNlID0gdm9pZCAwO1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRSZXNwb25zZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIChfcmVhc29uKSA9PiB7XG4gICAgICAgICAgICBmaW5hbCA9IHRydWU7XG4gICAgICAgICAgICBjdXJyZW50UmVzcG9uc2UgPSAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG5leHRJdGVyUmVzdWx0UDtcbiAgICAgICAgICAgIG9wdE5leHRQcm9taXNlID0gdm9pZCAwO1xuICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRSZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3B0TmV4dFByb21pc2U7XG4gICAgfVxuICB9KTtcbiAgY29uc3Qgbm90aWZpZXIgPSBGYXIoXCJub3RpZmllclwiLCB7XG4gICAgLy9cbiAgICAvL1xuICAgIC4uLm1ha2VOb3RpZmllcihiYXNlTm90aWZpZXIpLFxuICAgIC4uLmJhc2VOb3RpZmllclxuICB9KTtcbiAgcmV0dXJuIG5vdGlmaWVyO1xufTtcbmhhcmRlbihtYWtlTm90aWZpZXJGcm9tQXN5bmNJdGVyYWJsZSk7XG5cbi8vXG52YXIgbWFrZVBpbm5lZEhpc3RvcnlUb3BpYyA9ICh0b3BpYykgPT4ge1xuICBjb25zdCBwaW5uZWRQdWJMaXN0ID0gdG9waWMuc3Vic2NyaWJlQWZ0ZXIoKTtcbiAgcmV0dXJuIEZhcihcIlBpbm5lZEhpc3RvcnlUb3BpY1wiLCB7XG4gICAgc3Vic2NyaWJlQWZ0ZXI6IGFzeW5jIChwdWJsaXNoQ291bnQgPSAtMW4pID0+IHtcbiAgICAgIGlmIChwdWJsaXNoQ291bnQgPT09IC0xbikge1xuICAgICAgICByZXR1cm4gcGlubmVkUHViTGlzdDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0b3BpYy5zdWJzY3JpYmVBZnRlcihwdWJsaXNoQ291bnQpO1xuICAgIH0sXG4gICAgZ2V0VXBkYXRlU2luY2U6IGFzeW5jICh1cGRhdGVDb3VudCA9IHZvaWQgMCkgPT4ge1xuICAgICAgcmV0dXJuIHRvcGljLmdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihtYWtlUGlubmVkSGlzdG9yeVRvcGljKTtcblxuLy9cbnZhciBtYWtlU3Vic2NyaXB0aW9uID0gKHRvcGljKSA9PiB7XG4gIGNvbnN0IHN1YnNjcmlwdGlvbiA9IEZhcihcIlN1YnNjcmlwdGlvblwiLCB7XG4gICAgLi4uc3Vic2NyaWJlRWFjaCh0b3BpYyksXG4gICAgc3Vic2NyaWJlQWZ0ZXI6IGFzeW5jIChwdWJsaXNoQ291bnQpID0+IEUodG9waWMpLnN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudCksXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgIGdldFNoYXJhYmxlU3Vic2NyaXB0aW9uSW50ZXJuYWxzOiBhc3luYyAoKSA9PiB0b3BpYyxcbiAgICBnZXRTdG9yZUtleTogKCkgPT4gaGFyZGVuKHsgc3Vic2NyaXB0aW9uIH0pXG4gIH0pO1xuICByZXR1cm4gc3Vic2NyaXB0aW9uO1xufTtcbmhhcmRlbihtYWtlU3Vic2NyaXB0aW9uKTtcbnZhciBtYWtlU3Vic2NyaXB0aW9uS2l0ID0gKCkgPT4ge1xuICBjb25zdCB7IHB1Ymxpc2hlciwgc3Vic2NyaWJlciB9ID0gbWFrZVB1Ymxpc2hLaXQoKTtcbiAgY29uc3QgcGlubmVkSGlzdG9yeVRvcGljID0gbWFrZVBpbm5lZEhpc3RvcnlUb3BpYyhzdWJzY3JpYmVyKTtcbiAgY29uc3Qgc3Vic2NyaXB0aW9uID0gbWFrZVN1YnNjcmlwdGlvbihwaW5uZWRIaXN0b3J5VG9waWMpO1xuICBjb25zdCBwdWJsaWNhdGlvbiA9IEZhcihcInB1YmxpY2F0aW9uXCIsIHtcbiAgICB1cGRhdGVTdGF0ZTogKG5vbkZpbmFsVmFsdWUpID0+IHB1Ymxpc2hlci5wdWJsaXNoKG5vbkZpbmFsVmFsdWUpLFxuICAgIGZpbmlzaDogKGNvbXBsZXRpb24pID0+IHB1Ymxpc2hlci5maW5pc2goY29tcGxldGlvbiksXG4gICAgZmFpbDogKHJlYXNvbikgPT4gcHVibGlzaGVyLmZhaWwocmVhc29uKVxuICB9KTtcbiAgcmV0dXJuIGhhcmRlbih7IHB1YmxpY2F0aW9uLCBzdWJzY3JpcHRpb24gfSk7XG59O1xuaGFyZGVuKG1ha2VTdWJzY3JpcHRpb25LaXQpO1xuXG4vL1xudmFyIG9ic2VydmVJdGVyYXRvciA9IChhc3luY0l0ZXJhdG9yUCwgaXRlcmF0aW9uT2JzZXJ2ZXIpID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChhY2ssIG9ic2VydmVyRXJyb3IpID0+IHtcbiAgICBjb25zdCByZWN1ciA9ICgpID0+IHtcbiAgICAgIEUud2hlbihcbiAgICAgICAgRShhc3luY0l0ZXJhdG9yUCkubmV4dCgpLFxuICAgICAgICAoeyB2YWx1ZSwgZG9uZSB9KSA9PiB7XG4gICAgICAgICAgaWYgKGRvbmUpIHtcbiAgICAgICAgICAgIGl0ZXJhdGlvbk9ic2VydmVyLmZpbmlzaCAmJiBpdGVyYXRpb25PYnNlcnZlci5maW5pc2godmFsdWUpO1xuICAgICAgICAgICAgYWNrKHZvaWQgMCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGl0ZXJhdGlvbk9ic2VydmVyLnVwZGF0ZVN0YXRlICYmIGl0ZXJhdGlvbk9ic2VydmVyLnVwZGF0ZVN0YXRlKHZhbHVlKTtcbiAgICAgICAgICAgIHJlY3VyKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAocmVhc29uKSA9PiB7XG4gICAgICAgICAgaXRlcmF0aW9uT2JzZXJ2ZXIuZmFpbCAmJiBpdGVyYXRpb25PYnNlcnZlci5mYWlsKHJlYXNvbik7XG4gICAgICAgICAgYWNrKHZvaWQgMCk7XG4gICAgICAgIH1cbiAgICAgICkuY2F0Y2gob2JzZXJ2ZXJFcnJvcik7XG4gICAgfTtcbiAgICByZWN1cigpO1xuICB9KTtcbn07XG52YXIgb2JzZXJ2ZUl0ZXJhdGlvbiA9IChhc3luY0l0ZXJhYmxlUCwgaXRlcmF0aW9uT2JzZXJ2ZXIpID0+IHtcbiAgY29uc3QgaXRlcmF0b3JQID0gRShhc3luY0l0ZXJhYmxlUClbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCk7XG4gIHJldHVybiBvYnNlcnZlSXRlcmF0b3IoaXRlcmF0b3JQLCBpdGVyYXRpb25PYnNlcnZlcik7XG59O1xuXG4vL1xudmFyIEJyaWRnZUlkID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgQkFOSzogXCJiYW5rXCIsXG4gICAgQ09SRTogXCJjb3JlXCIsXG4gICAgRElCQzogXCJkaWJjXCIsXG4gICAgU1RPUkFHRTogXCJzdG9yYWdlXCIsXG4gICAgUFJPVklTSU9OOiBcInByb3Zpc2lvblwiLFxuICAgIFBST1ZJU0lPTl9TTUFSVF9XQUxMRVQ6IFwicHJvdmlzaW9uV2FsbGV0XCIsXG4gICAgVkxPQ0FMQ0hBSU46IFwidmxvY2FsY2hhaW5cIixcbiAgICBWVFJBTlNGRVI6IFwidnRyYW5zZmVyXCIsXG4gICAgV0FMTEVUOiBcIndhbGxldFwiXG4gIH1cbik7XG5oYXJkZW4oQnJpZGdlSWQpO1xudmFyIENvc21vc0luaXRLZXlUb0JyaWRnZUlkID0ge1xuICB2YmFua1BvcnQ6IFwiYmFua1wiLFxuICB2aWJjUG9ydDogXCJkaWJjXCJcbn07XG5oYXJkZW4oQ29zbW9zSW5pdEtleVRvQnJpZGdlSWQpO1xudmFyIFdhbGxldE5hbWUgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBkZXBvc2l0RmFjZXQ6IFwiZGVwb3NpdEZhY2V0XCJcbiAgfVxuKTtcbmhhcmRlbihXYWxsZXROYW1lKTtcbnZhciBWQmFua0FjY291bnQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICByZXNlcnZlOiB7XG4gICAgICBtb2R1bGU6IFwidmJhbmsvcmVzZXJ2ZVwiLFxuICAgICAgYWRkcmVzczogXCJhZ29yaWMxYWUwbG10emxncmNubGE5eGprcGFhcnE1ZDVkZmV6NjNoM251Y2xcIlxuICAgIH0sXG4gICAgcHJvdmlzaW9uOiB7XG4gICAgICBtb2R1bGU6IFwidmJhbmsvcHJvdmlzaW9uXCIsXG4gICAgICBhZGRyZXNzOiBcImFnb3JpYzFtZWd6eXRnNjVjeXJnenM2ZnZ6eGdyY3F2d3dsN3VncHQ2MjM0NlwiXG4gICAgfVxuICB9XG4pO1xuaGFyZGVuKFZCYW5rQWNjb3VudCk7XG5cbi8vXG52YXIgZGVidWdJbnN0YW5jZSA9IDE7XG52YXIgbWFrZVRyYWNlciA9IChuYW1lLCBlbmFibGUgPSB0cnVlKSA9PiB7XG4gIGRlYnVnSW5zdGFuY2UgKz0gMTtcbiAgbGV0IGRlYnVnQ291bnQgPSAxO1xuICBjb25zdCBrZXkgPSBgLS0tLS0gJHtuYW1lfS4ke2RlYnVnSW5zdGFuY2V9IGA7XG4gIHN3aXRjaCAoZW5hYmxlKSB7XG4gICAgY2FzZSBmYWxzZToge1xuICAgICAgY29uc3QgbG9nRGlzYWJsZWQgPSAoLi4uX2FyZ3MpID0+IHtcbiAgICAgIH07XG4gICAgICByZXR1cm4gbG9nRGlzYWJsZWQ7XG4gICAgfVxuICAgIGNhc2UgXCJ2ZXJib3NlXCI6IHtcbiAgICAgIGNvbnN0IGluZm9UaWNrID0gKG9wdExvZywgLi4uYXJncykgPT4ge1xuICAgICAgICBpZiAob3B0TG9nLmxvZykge1xuICAgICAgICAgIGNvbnNvbGUuaW5mbyhrZXksIGRlYnVnQ291bnQgKz0gMSwgLi4uYXJncyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5pbmZvKGtleSwgZGVidWdDb3VudCArPSAxLCBvcHRMb2csIC4uLmFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGluZm9UaWNrO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICBjb25zdCBkZWJ1Z1RpY2sgPSAob3B0TG9nLCAuLi5hcmdzKSA9PiB7XG4gICAgICAgIGlmIChvcHRMb2cubG9nKSB7XG4gICAgICAgICAgb3B0TG9nLmxvZyhrZXksIGRlYnVnQ291bnQgKz0gMSwgLi4uYXJncyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5pbmZvKGtleSwgZGVidWdDb3VudCArPSAxLCBvcHRMb2csIC4uLmFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIGRlYnVnVGljaztcbiAgICB9XG4gIH1cbn07XG5oYXJkZW4obWFrZVRyYWNlcik7XG5cbi8vXG52YXIgTm9uTnVsbGlzaCA9ICh2YWwsIG9wdERldGFpbHMgPSBgdW5leHBlY3RlZCAke3F1b3RlKHZhbCl9YCkgPT4ge1xuICBpZiAodmFsICE9IG51bGwpIHtcbiAgICByZXR1cm4gdmFsO1xuICB9XG4gIGFzc2VydC5mYWlsKG9wdERldGFpbHMpO1xufTtcbmhhcmRlbihOb25OdWxsaXNoKTtcblxuLy9cbnZhciB7IGRlZmluZVByb3BlcnR5OiBkZWZpbmVQcm9wZXJ0eTIgfSA9IE9iamVjdDtcbnZhciB0eXBlZEVudHJpZXMgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAqL1xuICBPYmplY3QuZW50cmllc1xuKTtcbnZhciBmcm9tVHlwZWRFbnRyaWVzID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIE9iamVjdC5mcm9tRW50cmllc1xuKTtcbnZhciB0eXBlZE1hcCA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgRnVuY3Rpb24ucHJvdG90eXBlLmNhbGwuYmluZChBcnJheS5wcm90b3R5cGUubWFwKVxuKTtcbnZhciBsb2dMZXZlbHMgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIFtcbiAgICBcImRlYnVnXCIsXG4gICAgXCJsb2dcIixcbiAgICBcImluZm9cIixcbiAgICBcIndhcm5cIixcbiAgICBcImVycm9yXCJcbiAgXVxuKTtcbk9iamVjdC5mcmVlemUobG9nTGV2ZWxzKTtcbnZhciBkZWVwTWFwT2JqZWN0SW50ZXJuYWwgPSAodmFsdWUsIG5hbWUsIGNvbnRhaW5lciwgbWFwcGVyKSA9PiB7XG4gIGlmIChjb250YWluZXIgJiYgdHlwZW9mIG5hbWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICBjb25zdCBtYXBwZWQgPSBtYXBwZXIodmFsdWUsIG5hbWUsIGNvbnRhaW5lcik7XG4gICAgaWYgKG1hcHBlZCAhPT0gdmFsdWUpIHtcbiAgICAgIHJldHVybiBtYXBwZWQ7XG4gICAgfVxuICB9XG4gIGlmICh0eXBlb2YgdmFsdWUgIT09IFwib2JqZWN0XCIgfHwgIXZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIGxldCB3YXNNYXBwZWQgPSBmYWxzZTtcbiAgY29uc3QgdmFsdWVPYmogPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICB2YWx1ZVxuICApO1xuICBjb25zdCBtYXBFbnRyeSA9IChbaW5uZXJOYW1lLCBpbm5lclZhbHVlXSkgPT4ge1xuICAgIGNvbnN0IG1hcHBlZElubmVyVmFsdWUgPSBkZWVwTWFwT2JqZWN0SW50ZXJuYWwoXG4gICAgICBpbm5lclZhbHVlLFxuICAgICAgaW5uZXJOYW1lLFxuICAgICAgdmFsdWVPYmosXG4gICAgICBtYXBwZXJcbiAgICApO1xuICAgIHdhc01hcHBlZCB8fD0gbWFwcGVkSW5uZXJWYWx1ZSAhPT0gaW5uZXJWYWx1ZTtcbiAgICByZXR1cm4gW1xuICAgICAgaW5uZXJOYW1lLFxuICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICBtYXBwZWRJbm5lclZhbHVlXG4gICAgXTtcbiAgfTtcbiAgY29uc3QgbWFwcGVkRW50cmllcyA9IHR5cGVkRW50cmllcyh2YWx1ZU9iaikubWFwKG1hcEVudHJ5KTtcbiAgaWYgKCF3YXNNYXBwZWQpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgY29uc3QgbWFwcGVkT2JqID0gZnJvbVR5cGVkRW50cmllcyhtYXBwZWRFbnRyaWVzKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICBtYXBwZWRPYmpcbiAgKTtcbn07XG52YXIgZGVlcE1hcE9iamVjdCA9IChvYmosIG1hcHBlcikgPT4gKFxuICAvKiAgICAgICAgICAgICAgKi9cbiAgZGVlcE1hcE9iamVjdEludGVybmFsKG9iaiwgdm9pZCAwLCB2b2lkIDAsIG1hcHBlcilcbik7XG52YXIgcHJvdmlkZUxhenlNYXAgPSAobWFwLCBrZXksIG1ha2VWYWx1ZSkgPT4ge1xuICBjb25zdCBmb3VuZCA9IG1hcC5nZXQoa2V5KTtcbiAgaWYgKGZvdW5kICE9PSB2b2lkIDAgfHwgbWFwLmhhcyhrZXkpKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgIGZvdW5kXG4gICAgKTtcbiAgfVxuICBjb25zdCB2YWx1ZSA9IG1ha2VWYWx1ZShrZXkpO1xuICBtYXAuc2V0KGtleSwgdmFsdWUpO1xuICByZXR1cm4gdmFsdWU7XG59O1xuXG4vL1xudmFyIGRldGFjaGVkSGVhcFN0b3JlcyA9IEZhcihcImhlYXBTdG9yZXNcIiwge1xuICBkZXRhY2hlZDogKCkgPT4gZGV0YWNoZWRIZWFwU3RvcmVzLFxuICBpc1N0b3JhYmxlOiBpc1Bhc3NhYmxlLFxuICBzZXRTdG9yZTogbWFrZVNjYWxhclNldFN0b3JlLFxuICBtYXBTdG9yZTogbWFrZVNjYWxhck1hcFN0b3JlLFxuICB3ZWFrTWFwU3RvcmU6IG1ha2VTY2FsYXJXZWFrTWFwU3RvcmUsXG4gIHdlYWtTZXRTdG9yZTogbWFrZVNjYWxhcldlYWtTZXRTdG9yZVxufSk7XG52YXIgbWFrZUhlYXBab25lID0gKGJhc2VMYWJlbCA9IFwiaGVhcFpvbmVcIikgPT4ge1xuICBjb25zdCB7IG1ha2VPbmNlLCB3cmFwUHJvdmlkZXIgfSA9IG1ha2VPbmNlS2l0KGJhc2VMYWJlbCwgZGV0YWNoZWRIZWFwU3RvcmVzKTtcbiAgY29uc3QgbWFrZVN1YlpvbmUgPSAobGFiZWwsIF9vcHRpb25zKSA9PiBtYWtlSGVhcFpvbmUoYCR7YmFzZUxhYmVsfS4ke2xhYmVsfWApO1xuICByZXR1cm4gRmFyKFwiaGVhcFpvbmVcIiwge1xuICAgIGV4bzogd3JhcFByb3ZpZGVyKG1ha2VFeG8sIGFnb3JpY1ZhdERhdGFLZXlzLmV4byksXG4gICAgZXhvQ2xhc3M6IHdyYXBQcm92aWRlcihkZWZpbmVFeG9DbGFzcywgYWdvcmljVmF0RGF0YUtleXMuZXhvQ2xhc3MpLFxuICAgIGV4b0NsYXNzS2l0OiB3cmFwUHJvdmlkZXIoZGVmaW5lRXhvQ2xhc3NLaXQsIGFnb3JpY1ZhdERhdGFLZXlzLmV4b0NsYXNzS2l0KSxcbiAgICBzdWJab25lOiB3cmFwUHJvdmlkZXIobWFrZVN1YlpvbmUpLFxuICAgIG1ha2VPbmNlLFxuICAgIHdhdGNoUHJvbWlzZTogd2F0Y2hQcm9taXNlMixcbiAgICBkZXRhY2hlZDogZGV0YWNoZWRIZWFwU3RvcmVzLmRldGFjaGVkLFxuICAgIGlzU3RvcmFibGU6IGRldGFjaGVkSGVhcFN0b3Jlcy5pc1N0b3JhYmxlLFxuICAgIG1hcFN0b3JlOiB3cmFwUHJvdmlkZXIoZGV0YWNoZWRIZWFwU3RvcmVzLm1hcFN0b3JlKSxcbiAgICBzZXRTdG9yZTogd3JhcFByb3ZpZGVyKGRldGFjaGVkSGVhcFN0b3Jlcy5zZXRTdG9yZSksXG4gICAgd2Vha01hcFN0b3JlOiB3cmFwUHJvdmlkZXIoZGV0YWNoZWRIZWFwU3RvcmVzLndlYWtNYXBTdG9yZSksXG4gICAgd2Vha1NldFN0b3JlOiB3cmFwUHJvdmlkZXIoZGV0YWNoZWRIZWFwU3RvcmVzLndlYWtTZXRTdG9yZSlcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VIZWFwWm9uZSk7XG5cbi8vXG52YXIgeyBmcm9tRW50cmllczogZnJvbUVudHJpZXM5IH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiByYXdPd25LZXlzIH0gPSBSZWZsZWN0O1xudmFyIG93bktleXMxOSA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgcmF3T3duS2V5c1xuKTtcbnZhciBpc1Byb3BlcnR5S2V5ID0gKGtleSkgPT4ge1xuICBzd2l0Y2ggKHR5cGVvZiBrZXkpIHtcbiAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgY2FzZSBcIm51bWJlclwiOlxuICAgIGNhc2UgXCJzeW1ib2xcIjpcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG52YXIgY2FsbFN5bmMgPSAoY2FsbGJhY2ssIC4uLmFyZ3MpID0+IHtcbiAgY29uc3QgeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0gPSBjYWxsYmFjaztcbiAgaWYgKG1ldGhvZE5hbWUgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiB0YXJnZXQoLi4uYm91bmQsIC4uLmFyZ3MpO1xuICB9XG4gIHJldHVybiB0YXJnZXRbbWV0aG9kTmFtZV0oLi4uYm91bmQsIC4uLmFyZ3MpO1xufTtcbmhhcmRlbihjYWxsU3luYyk7XG52YXIgY2FsbEUgPSAoY2FsbGJhY2ssIC4uLmFyZ3MpID0+IHtcbiAgY29uc3QgeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0gPSBjYWxsYmFjaztcbiAgaWYgKG1ldGhvZE5hbWUgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiBFKHRhcmdldCkoLi4uYm91bmQsIC4uLmFyZ3MpO1xuICB9XG4gIHJldHVybiBFKHRhcmdldClbbWV0aG9kTmFtZV0oLi4uYm91bmQsIC4uLmFyZ3MpO1xufTtcbmhhcmRlbihjYWxsRSk7XG52YXIgbWFrZVN5bmNGdW5jdGlvbkNhbGxiYWNrID0gKHRhcmdldCwgLi4uYm91bmQpID0+IHtcbiAgdHlwZW9mIHRhcmdldCA9PT0gXCJmdW5jdGlvblwiIHx8IHRocm93UmVkYWN0ZWRgc3luYyBmdW5jdGlvbiBjYWxsYmFjayB0YXJnZXQgbXVzdCBiZSBhIGZ1bmN0aW9uOiAke3RhcmdldH1gO1xuICBjb25zdCBjYiA9IGhhcmRlbih7IHRhcmdldCwgYm91bmQsIGlzU3luYzogdHJ1ZSB9KTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBjYlxuICApO1xufTtcbmhhcmRlbihtYWtlU3luY0Z1bmN0aW9uQ2FsbGJhY2spO1xudmFyIG1ha2VGdW5jdGlvbkNhbGxiYWNrID0gKHRhcmdldCwgLi4uYm91bmQpID0+IHtcbiAgaXNPYmplY3QyKHRhcmdldCkgfHwgdGhyb3dSZWRhY3RlZGBmdW5jdGlvbiBjYWxsYmFjayB0YXJnZXQgbXVzdCBiZSBhIGZ1bmN0aW9uIHByZXNlbmNlOiAke3RhcmdldH1gO1xuICBjb25zdCBjYiA9IGhhcmRlbih7IHRhcmdldCwgYm91bmQgfSk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBjYlxuICApO1xufTtcbmhhcmRlbihtYWtlRnVuY3Rpb25DYWxsYmFjayk7XG52YXIgbWFrZVN5bmNNZXRob2RDYWxsYmFjayA9ICh0YXJnZXQsIG1ldGhvZE5hbWUsIC4uLmJvdW5kKSA9PiB7XG4gIGlzT2JqZWN0Mih0YXJnZXQpIHx8IHRocm93UmVkYWN0ZWRgc3luYyBtZXRob2QgY2FsbGJhY2sgdGFyZ2V0IG11c3QgYmUgYW4gb2JqZWN0OiAke3RhcmdldH1gO1xuICB0eXBlb2YgbWV0aG9kTmFtZSA9PT0gXCJzdHJpbmdcIiB8fCBpc1Bhc3NhYmxlU3ltYm9sKG1ldGhvZE5hbWUpIHx8IHRocm93UmVkYWN0ZWRgbWV0aG9kIG5hbWUgbXVzdCBiZSBhIHN0cmluZyBvciBwYXNzYWJsZSBzeW1ib2w6ICR7bWV0aG9kTmFtZX1gO1xuICBjb25zdCBjYiA9IGhhcmRlbih7IHRhcmdldCwgbWV0aG9kTmFtZSwgYm91bmQsIGlzU3luYzogdHJ1ZSB9KTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBjYlxuICApO1xufTtcbmhhcmRlbihtYWtlU3luY01ldGhvZENhbGxiYWNrKTtcbnZhciBtYWtlTWV0aG9kQ2FsbGJhY2sgPSAodGFyZ2V0LCBtZXRob2ROYW1lLCAuLi5ib3VuZCkgPT4ge1xuICBpc09iamVjdDIodGFyZ2V0KSB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZCBjYWxsYmFjayB0YXJnZXQgbXVzdCBiZSBhbiBvYmplY3Q6ICR7dGFyZ2V0fWA7XG4gIHR5cGVvZiBtZXRob2ROYW1lID09PSBcInN0cmluZ1wiIHx8IGlzUGFzc2FibGVTeW1ib2wobWV0aG9kTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBtZXRob2QgbmFtZSBtdXN0IGJlIGEgc3RyaW5nIG9yIHBhc3NhYmxlIHN5bWJvbDogJHttZXRob2ROYW1lfWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBtZXRob2ROYW1lLCBib3VuZCB9KTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VNZXRob2RDYWxsYmFjayk7XG52YXIgaXNDYWxsYmFjayA9IChjYWxsYmFjaykgPT4ge1xuICBpZiAoIWlzT2JqZWN0MihjYWxsYmFjaykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0gPSBjYWxsYmFjaztcbiAgcmV0dXJuIGlzT2JqZWN0Mih0YXJnZXQpICYmIChtZXRob2ROYW1lID09PSB2b2lkIDAgfHwgdHlwZW9mIG1ldGhvZE5hbWUgPT09IFwic3RyaW5nXCIgfHwgaXNQYXNzYWJsZVN5bWJvbChtZXRob2ROYW1lKSkgJiYgQXJyYXkuaXNBcnJheShib3VuZCk7XG59O1xuaGFyZGVuKGlzQ2FsbGJhY2spO1xudmFyIHByZXBhcmVBdHRlbnVhdG9yID0gKHpvbmUsIG1ldGhvZE5hbWVzLCB7IGludGVyZmFjZUd1YXJkLCB0YWcgPSBcIkF0dGVudWF0b3JcIiB9ID0ge30pID0+IHtcbiAgY29uc3QgbWV0aG9kcyA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgZnJvbUVudHJpZXM5KFxuICAgICAgbWV0aG9kTmFtZXMubWFwKChrZXkpID0+IHtcbiAgICAgICAgaWYgKCFpc1Byb3BlcnR5S2V5KGtleSkpIHtcbiAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGtleSAke3F1b3RlKGtleSl9IGlzIG5vdCBhIFByb3BlcnR5S2V5YDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtMiA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIFtrZXldKC4uLmFyZ3MpIHtcbiAgICAgICAgICAgICAgY29uc3QgY2IgPSB0aGlzLnN0YXRlLmNic1trZXldO1xuICAgICAgICAgICAgICBpZiAoIWNiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXJyID0gbWFrZUVycm9yKGB1bmltcGxlbWVudGVkICR7cXVvdGUodGFnKX0gbWV0aG9kICR7cXVvdGUoa2V5KX1gKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5pc1N5bmMpIHtcbiAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGNiLmlzU3luYykge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsU3luYyhjYiwgLi4uYXJncyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxFKGNiLCAuLi5hcmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9W2tleV1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIFtrZXksIG0yXVxuICAgICAgICApO1xuICAgICAgfSlcbiAgICApXG4gICk7XG4gIGNvbnN0IG1ha2VBdHRlbnVhdG9yID0gem9uZS5leG9DbGFzcyhcbiAgICB0YWcsXG4gICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgICh7XG4gICAgICB0YXJnZXQgPSBudWxsLFxuICAgICAgaXNTeW5jID0gZmFsc2UsXG4gICAgICBvdmVycmlkZXMgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB7fVxuICAgICAgKVxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IGNicyA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHt9XG4gICAgICApO1xuICAgICAgY29uc3QgcmVtYWluaW5nID0gbmV3IFNldChtZXRob2ROYW1lcyk7XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBvd25LZXlzMTkob3ZlcnJpZGVzKSkge1xuICAgICAgICByZW1haW5pbmcuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKHRhZyl9IG92ZXJyaWRlc1ske3F1b3RlKGtleSl9XSBub3QgYWxsb3dlZCBieSBtZXRob2ROYW1lc2A7XG4gICAgICAgIHJlbWFpbmluZy5kZWxldGUoa2V5KTtcbiAgICAgICAgY29uc3QgY2IgPSBvdmVycmlkZXNba2V5XTtcbiAgICAgICAgY2IgPT0gbnVsbCB8fCBpc0NhbGxiYWNrKGNiKSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gb3ZlcnJpZGVzWyR7cXVvdGUoa2V5KX1dIGlzIG5vdCBhIGNhbGxiYWNrOyBnb3QgJHtjYn1gO1xuICAgICAgICBjYnNba2V5XSA9IGNiO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBrZXkgb2YgcmVtYWluaW5nKSB7XG4gICAgICAgIGlmIChpc1N5bmMpIHtcbiAgICAgICAgICBjYnNba2V5XSA9IG1ha2VTeW5jTWV0aG9kQ2FsbGJhY2sodGFyZ2V0LCBrZXkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNic1trZXldID0gbWFrZU1ldGhvZENhbGxiYWNrKHRhcmdldCwga2V5KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGhhcmRlbih7IGNicywgaXNTeW5jIH0pO1xuICAgIH0sXG4gICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgIG1ldGhvZHNcbiAgKTtcbiAgcmV0dXJuIG1ha2VBdHRlbnVhdG9yO1xufTtcbmhhcmRlbihwcmVwYXJlQXR0ZW51YXRvcik7XG52YXIgcHJlcGFyZUd1YXJkZWRBdHRlbnVhdG9yID0gKHpvbmUsIGludGVyZmFjZUd1YXJkLCBvcHRzID0ge30pID0+IHtcbiAgY29uc3QgbWV0aG9kTmFtZXMgPSBnZXRJbnRlcmZhY2VNZXRob2RLZXlzKGludGVyZmFjZUd1YXJkKTtcbiAgY29uc3QgbWFrZUF0dGVudWF0b3IgPSBwcmVwYXJlQXR0ZW51YXRvcih6b25lLCBtZXRob2ROYW1lcywge1xuICAgIC4uLm9wdHMsXG4gICAgaW50ZXJmYWNlR3VhcmRcbiAgfSk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIG1ha2VBdHRlbnVhdG9yXG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVHdWFyZGVkQXR0ZW51YXRvcik7XG5cbi8vXG52YXIgU3RyZWFtQ2VsbFNoYXBlID0gaGFyZGVuKHtcbiAgYmxvY2tIZWlnaHQ6IE0uc3RyaW5nKCksXG4gIHZhbHVlczogTS5hcnJheSgpXG59KTtcbnZhciBDaGFpblN0b3JhZ2VOb2RlSSA9IE0uaW50ZXJmYWNlKFwiU3RvcmFnZU5vZGVcIiwge1xuICBzZXRWYWx1ZTogTS5jYWxsV2hlbihNLnN0cmluZygpKS5yZXR1cm5zKCksXG4gIGdldFBhdGg6IE0uY2FsbCgpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIGdldFN0b3JlS2V5OiBNLmNhbGxXaGVuKCkucmV0dXJucyhNLnJlY29yZCgpKSxcbiAgbWFrZUNoaWxkTm9kZTogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3BsaXRSZWNvcmQoe30sIHsgc2VxdWVuY2U6IE0uYm9vbGVhbigpIH0sIHt9KSkucmV0dXJucyhNLnJlbW90YWJsZShcIlN0b3JhZ2VOb2RlXCIpKVxufSk7XG52YXIgaXNTdHJlYW1DZWxsID0gKGNlbGwpID0+IGNlbGwgJiYgdHlwZW9mIGNlbGwgPT09IFwib2JqZWN0XCIgJiYgQXJyYXkuaXNBcnJheShjZWxsLnZhbHVlcykgJiYgdHlwZW9mIGNlbGwuYmxvY2tIZWlnaHQgPT09IFwic3RyaW5nXCIgJiYgL14wJHxeWzEtOV1bMC05XSokLy50ZXN0KGNlbGwuYmxvY2tIZWlnaHQpO1xuaGFyZGVuKGlzU3RyZWFtQ2VsbCk7XG52YXIgcGF0aFNlZ21lbnRQYXR0ZXJuID0gL15bYS16QS1aMC05Xy1dezEsMTAwfSQvO1xudmFyIGFzc2VydFBhdGhTZWdtZW50ID0gKG5hbWUpID0+IHtcbiAgcGF0aFNlZ21lbnRQYXR0ZXJuLnRlc3QobmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBQYXRoIHNlZ21lbnQgbmFtZXMgbXVzdCBjb25zaXN0IG9mIDEgdG8gMTAwIGNoYXJhY3RlcnMgbGltaXRlZCB0byBBU0NJSSBhbHBoYW51bWVyaWNzLCB1bmRlcnNjb3JlcywgYW5kL29yIGRhc2hlczogJHtuYW1lfWA7XG59O1xuaGFyZGVuKGFzc2VydFBhdGhTZWdtZW50KTtcbnZhciBwcmVwYXJlQ2hhaW5TdG9yYWdlTm9kZSA9ICh6b25lKSA9PiB7XG4gIGNvbnN0IG1ha2VDaGFpblN0b3JhZ2VOb2RlID0gem9uZS5leG9DbGFzcyhcbiAgICBcIkNoYWluU3RvcmFnZU5vZGVcIixcbiAgICBDaGFpblN0b3JhZ2VOb2RlSSxcbiAgICAvKlxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIChtZXNzZW5nZXIsIHBhdGgsIHsgc2VxdWVuY2UgPSBmYWxzZSB9ID0ge30pID0+IHtcbiAgICAgIGFzc2VydC50eXBlb2YocGF0aCwgXCJzdHJpbmdcIik7XG4gICAgICBhc3NlcnQudHlwZW9mKHNlcXVlbmNlLCBcImJvb2xlYW5cIik7XG4gICAgICByZXR1cm4gaGFyZGVuKHsgcGF0aCwgbWVzc2VuZ2VyLCBzZXF1ZW5jZSB9KTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGdldFBhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnBhdGg7XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIGdldFN0b3JlS2V5KCkge1xuICAgICAgICBjb25zdCB7IHBhdGgsIG1lc3NlbmdlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgcmV0dXJuIGNhbGxFKG1lc3Nlbmdlciwge1xuICAgICAgICAgIG1ldGhvZDogXCJnZXRTdG9yZUtleVwiLFxuICAgICAgICAgIGFyZ3M6IFtwYXRoXVxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG1ha2VDaGlsZE5vZGUobmFtZSwgY2hpbGROb2RlT3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIGNvbnN0IHsgc2VxdWVuY2UsIHBhdGgsIG1lc3NlbmdlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgYXNzZXJ0UGF0aFNlZ21lbnQobmFtZSk7XG4gICAgICAgIGNvbnN0IG1lcmdlZE9wdGlvbnMgPSB7IHNlcXVlbmNlLCAuLi5jaGlsZE5vZGVPcHRpb25zIH07XG4gICAgICAgIHJldHVybiBtYWtlQ2hhaW5TdG9yYWdlTm9kZShcbiAgICAgICAgICBtZXNzZW5nZXIsXG4gICAgICAgICAgYCR7cGF0aH0uJHtuYW1lfWAsXG4gICAgICAgICAgbWVyZ2VkT3B0aW9uc1xuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBhc3luYyBzZXRWYWx1ZSh2YWx1ZSkge1xuICAgICAgICBjb25zdCB7IHNlcXVlbmNlLCBwYXRoLCBtZXNzZW5nZXIgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGFzc2VydC50eXBlb2YodmFsdWUsIFwic3RyaW5nXCIpO1xuICAgICAgICBsZXQgZW50cnk7XG4gICAgICAgIGlmICghc2VxdWVuY2UgJiYgIXZhbHVlKSB7XG4gICAgICAgICAgZW50cnkgPSBbcGF0aF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZW50cnkgPSBbcGF0aCwgdmFsdWVdO1xuICAgICAgICB9XG4gICAgICAgIGF3YWl0IGNhbGxFKG1lc3Nlbmdlciwge1xuICAgICAgICAgIG1ldGhvZDogc2VxdWVuY2UgPyBcImFwcGVuZFwiIDogXCJzZXRcIixcbiAgICAgICAgICBhcmdzOiBbZW50cnldXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlQ2hhaW5TdG9yYWdlTm9kZTtcbn07XG52YXIgbWFrZUhlYXBDaGFpblN0b3JhZ2VOb2RlID0gcHJlcGFyZUNoYWluU3RvcmFnZU5vZGUobWFrZUhlYXBab25lKCkpO1xuZnVuY3Rpb24gbWFrZUNoYWluU3RvcmFnZVJvb3QoaGFuZGxlU3RvcmFnZU1lc3NhZ2UsIHJvb3RQYXRoLCByb290T3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IG1lc3NlbmdlciA9IG1ha2VGdW5jdGlvbkNhbGxiYWNrKGhhbmRsZVN0b3JhZ2VNZXNzYWdlKTtcbiAgY29uc3Qgcm9vdE5vZGUgPSBtYWtlSGVhcENoYWluU3RvcmFnZU5vZGUobWVzc2VuZ2VyLCByb290UGF0aCwgcm9vdE9wdGlvbnMpO1xuICByZXR1cm4gcm9vdE5vZGU7XG59XG52YXIgbWFrZU51bGxTdG9yYWdlTm9kZSA9ICgpID0+IHtcbiAgcmV0dXJuIG1ha2VDaGFpblN0b3JhZ2VSb290KFxuICAgIEZhcihcIk51bGxNZXNzZW5nZXJcIiwgKCkgPT4gbnVsbCksXG4gICAgXCJudWxsXCJcbiAgKTtcbn07XG5hc3luYyBmdW5jdGlvbiBtYWtlU3RvcmFnZU5vZGVDaGlsZChzdG9yYWdlTm9kZVJlZiwgY2hpbGROYW1lKSB7XG4gIGNvbnN0IGV4aXN0aW5nU3RvcmFnZU5vZGUgPSBhd2FpdCBzdG9yYWdlTm9kZVJlZjtcbiAgY29uc3Qgc3RvcmFnZU5vZGUgPSBleGlzdGluZ1N0b3JhZ2VOb2RlIHx8IG1ha2VOdWxsU3RvcmFnZU5vZGUoKTtcbiAgcmV0dXJuIEUoc3RvcmFnZU5vZGUpLm1ha2VDaGlsZE5vZGUoY2hpbGROYW1lKTtcbn1cbmhhcmRlbihtYWtlU3RvcmFnZU5vZGVDaGlsZCk7XG52YXIgbWFrZVNlcmlhbGl6ZVRvU3RvcmFnZSA9IChzdG9yYWdlTm9kZSwgbWFyc2hhbGxlcikgPT4ge1xuICByZXR1cm4gYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgY29uc3QgbWFyc2hhbGxlZCA9IGF3YWl0IEUobWFyc2hhbGxlcikudG9DYXBEYXRhKHZhbHVlKTtcbiAgICBjb25zdCBzZXJpYWxpemVkID0gSlNPTi5zdHJpbmdpZnkobWFyc2hhbGxlZCk7XG4gICAgcmV0dXJuIEUoc3RvcmFnZU5vZGUpLnNldFZhbHVlKHNlcmlhbGl6ZWQpO1xuICB9O1xufTtcblxuLy9cbnZhciBDYXBEYXRhU2hhcGUgPSB7IGJvZHk6IE0uc3RyaW5nKCksIHNsb3RzOiBNLmFycmF5KCkgfTtcbmhhcmRlbihDYXBEYXRhU2hhcGUpO1xudmFyIGFzc2VydENhcERhdGEgPSAoZGF0YSkgPT4ge1xuICBhc3NlcnQudHlwZW9mKGRhdGEsIFwib2JqZWN0XCIpO1xuICBhc3NlcnQoZGF0YSk7XG4gIHR5cGVvZiBkYXRhLmJvZHkgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBkYXRhIGhhcyBub24tc3RyaW5nIC5ib2R5ICR7ZGF0YS5ib2R5fWA7XG4gIEFycmF5LmlzQXJyYXkoZGF0YS5zbG90cykgfHwgdGhyb3dSZWRhY3RlZGBkYXRhIGhhcyBub24tQXJyYXkgc2xvdHMgJHtkYXRhLnNsb3RzfWA7XG59O1xuaGFyZGVuKGFzc2VydENhcERhdGEpO1xudmFyIHVubWFyc2hhbEZyb21Wc3RvcmFnZSA9IChkYXRhLCBrZXksIGZyb21DYXBEYXRhLCBpbmRleCkgPT4ge1xuICBjb25zdCBzZXJpYWxpemVkID0gZGF0YS5nZXQoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYG5vIGRhdGEgZm9yICR7a2V5fWA7XG4gIGFzc2VydC50eXBlb2Yoc2VyaWFsaXplZCwgXCJzdHJpbmdcIik7XG4gIGFzc2VydC50eXBlb2YoaW5kZXgsIFwibnVtYmVyXCIpO1xuICBjb25zdCBzdHJlYW1DZWxsID0gSlNPTi5wYXJzZShzZXJpYWxpemVkKTtcbiAgaWYgKCFpc1N0cmVhbUNlbGwoc3RyZWFtQ2VsbCkpIHtcbiAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYG5vdCBhIFN0cmVhbUNlbGw6ICR7c3RyZWFtQ2VsbH1gO1xuICB9XG4gIGNvbnN0IHsgdmFsdWVzOiB2YWx1ZXM2IH0gPSBzdHJlYW1DZWxsO1xuICB2YWx1ZXM2Lmxlbmd0aCA+IDAgfHwgdGhyb3dSZWRhY3RlZGBubyBTdHJlYW1DZWxsIHZhbHVlczogJHtzdHJlYW1DZWxsfWA7XG4gIGNvbnN0IG1hcnNoYWxsZWQgPSB2YWx1ZXM2LmF0KGluZGV4KTtcbiAgYXNzZXJ0LnR5cGVvZihtYXJzaGFsbGVkLCBcInN0cmluZ1wiKTtcbiAgY29uc3QgY2FwRGF0YSA9IGhhcmRlbihKU09OLnBhcnNlKG1hcnNoYWxsZWQpKTtcbiAgYXNzZXJ0Q2FwRGF0YShjYXBEYXRhKTtcbiAgY29uc3QgdW5tYXJzaGFsbGVkID0gZnJvbUNhcERhdGEoY2FwRGF0YSk7XG4gIHJldHVybiB1bm1hcnNoYWxsZWQ7XG59O1xuaGFyZGVuKHVubWFyc2hhbEZyb21Wc3RvcmFnZSk7XG52YXIgcmVqZWN0T0NhcCA9IChjYXApID0+IHRocm93UmVkYWN0ZWRgJHtjYXB9IGlzIG5vdCBwdXJlIGRhdGFgO1xudmFyIHB1cmVEYXRhTWFyc2hhbGxlciA9IG1ha2VNYXJzaGFsKHJlamVjdE9DYXAsIHJlamVjdE9DYXAsIHtcbiAgc2VyaWFsaXplQm9keUZvcm1hdDogXCJzbWFsbGNhcHNcIlxufSk7XG5oYXJkZW4ocHVyZURhdGFNYXJzaGFsbGVyKTtcblxuLy9cbnZhciB7IGNyZWF0ZTogY3JlYXRlNCwgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTAgfSA9IE9iamVjdDtcbnZhciB7IGFwcGx5OiBhcHBseTYgfSA9IFJlZmxlY3Q7XG52YXIgZ2V0TWV0aG9kTmFtZXMyID0gKHZhbCkgPT4gKFxuICAvKiAgICAgICAgICAgICAgKi9cbiAgZ2V0TWV0aG9kTmFtZXModmFsKVxuKTtcbmhhcmRlbihnZXRNZXRob2ROYW1lczIpO1xudmFyIGJpbmRBbGxNZXRob2RzID0gKG9iaikgPT4gaGFyZGVuKFxuICBjcmVhdGU0KFxuICAgIG9iaixcbiAgICBmcm9tRW50cmllczEwKFxuICAgICAgZ2V0TWV0aG9kTmFtZXMob2JqKS5tYXAoKG5hbWUpID0+IFtcbiAgICAgICAgbmFtZSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiAoLi4uYXJncykgPT4gYXBwbHk2KG9ialtuYW1lXSwgb2JqLCBhcmdzKSxcbiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlXG4gICAgICAgIH1cbiAgICAgIF0pXG4gICAgKVxuICApXG4pO1xuaGFyZGVuKGJpbmRBbGxNZXRob2RzKTtcblxuLy9cbnZhciBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTID0gW1xuICA1LFxuICAxMCxcbiAgMjUsXG4gIDUwLFxuICAxMDAsXG4gIDI1MCxcbiAgNTAwLFxuICAxZTMsXG4gIDI1MDAsXG4gIDVlMyxcbiAgMWU0LFxuICBJbmZpbml0eVxuXTtcbnZhciBISVNUT0dSQU1fU0VDT05EU19MQVRFTkNZX0JPVU5EQVJJRVMgPSBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTLm1hcCgobXMpID0+IG1zIC8gMWUzKTtcbnZhciBISVNUT0dSQU1fTUVUUklDUyA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIHN3aW5nc2V0X2NyYW5rX3Byb2Nlc3NpbmdfdGltZToge1xuICAgICAgZGVzY3JpcHRpb246IFwiUHJvY2Vzc2luZyB0aW1lIHBlciBjcmFuayAobXMpXCIsXG4gICAgICB1bml0OiBcIm1zXCIsXG4gICAgICBib3VuZGFyaWVzOiBBcnJheS5vZigxLCAxMSwgMjEsIDMxLCA0MSwgNTEsIDYxLCA3MSwgODEsIDkxLCBJbmZpbml0eSlcbiAgICB9LFxuICAgIHN3aW5nc2V0X2Jsb2NrX3Byb2Nlc3Npbmdfc2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUHJvY2Vzc2luZyB0aW1lIHBlciBibG9ja1wiLFxuICAgICAgdW5pdDogXCJzXCIsXG4gICAgICBib3VuZGFyaWVzOiBISVNUT0dSQU1fU0VDT05EU19MQVRFTkNZX0JPVU5EQVJJRVNcbiAgICB9LFxuICAgIHN3aW5nc2V0X3ZhdF9zdGFydHVwOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJWYXQgc3RhcnR1cCB0aW1lIChtcylcIixcbiAgICAgIHVuaXQ6IFwibXNcIixcbiAgICAgIGJvdW5kYXJpZXM6IEhJU1RPR1JBTV9NU19MQVRFTkNZX0JPVU5EQVJJRVNcbiAgICB9LFxuICAgIHN3aW5nc2V0X3ZhdF9kZWxpdmVyeToge1xuICAgICAgZGVzY3JpcHRpb246IFwiVmF0IGRlbGl2ZXJ5IHRpbWUgKG1zKVwiLFxuICAgICAgdW5pdDogXCJtc1wiLFxuICAgICAgYm91bmRhcmllczogSElTVE9HUkFNX01TX0xBVEVOQ1lfQk9VTkRBUklFU1xuICAgIH0sXG4gICAgc3dpbmdzZXRfbWV0ZXJfdXNhZ2U6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlZhdCBtZXRlciB1c2FnZVwiLFxuICAgICAgdW5pdDogXCJtc1wiLFxuICAgICAgYm91bmRhcmllczogSElTVE9HUkFNX01TX0xBVEVOQ1lfQk9VTkRBUklFU1xuICAgIH1cbiAgfVxuKTtcbnZhciBibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MgPSB7XG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIHVuaXQ6IFwic1wiLFxuICBhZHZpY2U6IHtcbiAgICBleHBsaWNpdEJ1Y2tldEJvdW5kYXJpZXM6IFtcbiAgICAgIDAuMSxcbiAgICAgIDAuMixcbiAgICAgIDAuMyxcbiAgICAgIDAuNCxcbiAgICAgIDAuNSxcbiAgICAgIDEsXG4gICAgICAyLFxuICAgICAgMyxcbiAgICAgIDQsXG4gICAgICA1LFxuICAgICAgNixcbiAgICAgIDcsXG4gICAgICAxMCxcbiAgICAgIDE1LFxuICAgICAgMzBcbiAgICBdXG4gIH1cbn07XG52YXIgQkxPQ0tfSElTVE9HUkFNX01FVFJJQ1MgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBzd2luZ3NldFJ1blNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IGV4ZWN1dGluZyBTd2luZ1NldFwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjXG4gICAgfSxcbiAgICBzd2luZ3NldENoYWluU2F2ZVNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IHByb3BhZ2F0aW5nIFN3aW5nU2V0IHN0YXRlIGludG8gY29zbW9zXCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2NcbiAgICB9LFxuICAgIHN3aW5nc2V0Q29tbWl0U2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgY29tbWl0dGluZyBTd2luZ1NldCBzdGF0ZSB0byBob3N0IHN0b3JhZ2VcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgY29zbW9zQ29tbWl0U2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgY29tbWl0dGluZyBjb3Ntb3Mgc3RhdGVcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgZnVsbENvbW1pdFNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IGNvbW1pdHRpbmcgc3RhdGUsIGluY2x1c2l2ZSBvZiBDT01NSVRfQkxPQ0sgcHJvY2Vzc2luZyBwbHVzIHRpbWUgc3BlbnQgW291dHNpZGUgb2YgY29zbWljLXN3aW5nc2V0XSBiZWZvcmUgYW5kIGFmdGVyIGl0XCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2NcbiAgICB9LFxuICAgIGludGVyQmxvY2tTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJUaW1lIHNwZW50IGlkbGUgYmV0d2VlbiBibG9ja3NcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgYWZ0ZXJDb21taXRIYW5nb3ZlclNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IHdhaXRpbmcgZm9yIHByZXZpb3VzLWJsb2NrIGFmdGVyQ29tbWl0IHdvcmtcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgYmxvY2tMYWdTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJUaGUgZGVsYXkgb2YgZWFjaCBibG9jayBmcm9tIGl0cyBleHBlY3RlZCBiZWdpbiB0aW1lXCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MsXG4gICAgICAvL1xuICAgICAgYWR2aWNlOiB7XG4gICAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzYy5hZHZpY2UsXG4gICAgICAgIGV4cGxpY2l0QnVja2V0Qm91bmRhcmllczogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgW1xuICAgICAgICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjLmFkdmljZS5leHBsaWNpdEJ1Y2tldEJvdW5kYXJpZXMsXG4gICAgICAgICAgICAuLi5bNjAsIDEyMCwgMTgwLCAyNDAsIDMwMCwgNjAwLCAzNjAwXVxuICAgICAgICAgIF1cbiAgICAgICAgKVxuICAgICAgfVxuICAgIH1cbiAgfVxuKTtcbnZhciBNZXRyaWNUeXBlID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgQ291bnRlcjogXCJjb3VudGVyXCIsXG4gICAgR2F1Z2U6IFwiZ2F1Z2VcIlxuICB9XG4pO1xudmFyIEtFUk5FTF9TVEFUU19TVU1fTUVUUklDUyA9IFtcbiAge1xuICAgIGtleTogXCJzeXNjYWxsc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfYWxsX3N5c2NhbGxfdG90YWxcIixcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsU2VuZFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJzZW5kXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgbWVzc2FnZSBzZW5kIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbENhbGxOb3dcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwiY2FsbE5vd1wiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHN5bmNocm9ub3VzIGRldmljZSBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxTdWJzY3JpYmVcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwic3Vic2NyaWJlXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgcHJvbWlzZSBzdWJzY3JpcHRpb24ga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsUmVzb2x2ZVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJyZXNvbHZlXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgcHJvbWlzZSByZXNvbHV0aW9uIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbEV4aXRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwiZXhpdFwiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdCBleGl0IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFZhdHN0b3JlR2V0XCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInZhdHN0b3JlR2V0XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0c3RvcmUgZ2V0IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFZhdHN0b3JlU2V0XCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInZhdHN0b3JlU2V0XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0c3RvcmUgc2V0IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFZhdHN0b3JlR2V0TmV4dEtleVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJ2YXRzdG9yZUdldE5leHRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXRzdG9yZSBnZXROZXh0S2V5IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFZhdHN0b3JlRGVsZXRlXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInZhdHN0b3JlRGVsZXRlXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0c3RvcmUgZGVsZXRlIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbERyb3BJbXBvcnRzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcImRyb3BJbXBvcnRzXCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgZHJvcCBpbXBvcnRzIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwiZGlzcGF0Y2hlc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfZGlzcGF0Y2hfdG90YWxcIixcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0IGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJkaXNwYXRjaERlbGl2ZXJcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2Rpc3BhdGNoX2RlbGl2ZXJfdG90YWxcIixcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0IG1lc3NhZ2UgZGVsaXZlcmllc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwiZGlzcGF0Y2hOb3RpZnlcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2Rpc3BhdGNoX25vdGlmeV90b3RhbFwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXQgcHJvbWlzZSBub3RpZmljYXRpb25zXCJcbiAgfVxuXTtcbnZhciBLRVJORUxfU1RBVFNfVVBET1dOX01FVFJJQ1MgPSBbXG4gIHtcbiAgICBrZXk6IFwia2VybmVsT2JqZWN0c1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfa2VybmVsX29iamVjdHNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJBY3RpdmUga2VybmVsIG9iamVjdHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImtlcm5lbERldmljZXNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2tlcm5lbF9kZXZpY2VzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiQWN0aXZlIGtlcm5lbCBkZXZpY2VzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJrZXJuZWxQcm9taXNlc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfa2VybmVsX3Byb21pc2VzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiQWN0aXZlIGtlcm5lbCBwcm9taXNlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwia3BVbnJlc29sdmVkXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF91bnJlc29sdmVkX2tlcm5lbF9wcm9taXNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlVucmVzb2x2ZWQga2VybmVsIHByb21pc2VzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJrcEZ1bGZpbGxlZFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfZnVsZmlsbGVkX2tlcm5lbF9wcm9taXNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIkZ1bGZpbGxlZCBrZXJuZWwgcHJvbWlzZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImtwUmVqZWN0ZWRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3JlamVjdGVkX2tlcm5lbF9wcm9taXNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlJlamVjdGVkIGtlcm5lbCBwcm9taXNlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwicnVuUXVldWVMZW5ndGhcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3J1bl9xdWV1ZV9sZW5ndGhcIixcbiAgICBjb25zZW5zdXM6IHRydWUsXG4gICAgZGVzY3JpcHRpb246IFwiTGVuZ3RoIG9mIHRoZSBrZXJuZWwgcnVuIHF1ZXVlXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJhY2NlcHRhbmNlUXVldWVMZW5ndGhcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2FjY2VwdGFuY2VfcXVldWVfbGVuZ3RoXCIsXG4gICAgY29uc2Vuc3VzOiB0cnVlLFxuICAgIGRlc2NyaXB0aW9uOiBcIkxlbmd0aCBvZiB0aGUga2VybmVsIGFjY2VwdGFuY2UgcXVldWVcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInByb21pc2VRdWV1ZXNMZW5ndGhcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3Byb21pc2VfcXVldWVzX2xlbmd0aFwiLFxuICAgIGNvbnNlbnN1czogdHJ1ZSxcbiAgICBkZXNjcmlwdGlvbjogXCJDb21iaW5lZCBsZW5ndGggb2YgYWxsIGtlcm5lbCBwcm9taXNlIHF1ZXVlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwiY2xpc3RFbnRyaWVzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9jbGlzdF9lbnRyaWVzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiTnVtYmVyIG9mIGVudHJpZXMgaW4gdGhlIGtlcm5lbCBjLWxpc3RcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInZhdHNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3ZhdHNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJOdW1iZXIgb2YgYWN0aXZlIHZhdHNcIlxuICB9XG5dO1xudmFyIHsgQ291bnRlciwgR2F1Z2UgfSA9IE1ldHJpY1R5cGU7XG52YXIgS0VSTkVMX1NUQVRTX01FVFJJQ1MgPSBoYXJkZW4oW1xuICAuLi5LRVJORUxfU1RBVFNfU1VNX01FVFJJQ1MubWFwKChtMikgPT4gKHsgLi4ubTIsIG1ldHJpY1R5cGU6IENvdW50ZXIgfSkpLFxuICAuLi5LRVJORUxfU1RBVFNfVVBET1dOX01FVFJJQ1MubWFwKChtMikgPT4gKHsgLi4ubTIsIG1ldHJpY1R5cGU6IEdhdWdlIH0pKVxuXSk7XG52YXIga2VybmVsU3RhdHNLZXlzID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbmZvciAoY29uc3QgeyBrZXkgfSBvZiBLRVJORUxfU1RBVFNfTUVUUklDUykge1xuICBrZXJuZWxTdGF0c0tleXMuc2V0KGtleSwgKGtlcm5lbFN0YXRzS2V5cy5nZXQoa2V5KSB8fCAwKSArIDEpO1xufVxudmFyIGR1cGxpY2F0ZUtlcm5lbFN0YXRzS2V5cyA9IFsuLi5rZXJuZWxTdGF0c0tleXMuZW50cmllcygpXS5mbGF0TWFwKFxuICAoW2tleSwgdmFsdWVdKSA9PiB2YWx1ZSA+IDEgPyBba2V5XSA6IFtdXG4pO1xuaWYgKGR1cGxpY2F0ZUtlcm5lbFN0YXRzS2V5cy5sZW5ndGggPiAwKSB7XG4gIGNvbnN0IG1zZyA9IGBEdXBsaWNhdGUga2VybmVsIHN0YXRzIGtleXMgJHtKU09OLnN0cmluZ2lmeShkdXBsaWNhdGVLZXJuZWxTdGF0c0tleXMpfWA7XG4gIHRocm93IEVycm9yKG1zZyk7XG59XG5cbi8vXG52YXIgY29tcGFyZU5hdHMgPSAoYTIsIGIzKSA9PiB7XG4gIGNvbnN0IGRpZmYgPSArYTIgLSArYjM7XG4gIGNvbnN0IGZpbml0ZURpZmYgPSBOdW1iZXIuaXNGaW5pdGUoZGlmZikgJiYgZGlmZiB8fCAoYTIgPT09IGIzID8gMCA6IE51bWJlcihCaWdJbnQoYTIpIC0gQmlnSW50KGIzKSkgfHwgYTIubGVuZ3RoIC0gYjMubGVuZ3RoKTtcbiAgcmV0dXJuIE1hdGguc2lnbihmaW5pdGVEaWZmKTtcbn07XG52YXIgY29tcGFyZVN0cmluZ3MgPSAoYTIsIGIzKSA9PiBhMiA+IGIzID8gMSA6IGEyIDwgYjMgPyAtMSA6IDA7XG52YXIgclByZWZpeGVkRGlnaXRzID0gL14oXFxEKikoXFxkKykoXFxELip8KS9zO1xudmFyIG5hdHVyYWxDb21wYXJlID0gKGEyLCBiMykgPT4ge1xuICBjb25zdCBbX2EsIGFQcmVmaXgsIGFEaWdpdHMsIGFTdWZmaXhdID0gclByZWZpeGVkRGlnaXRzLmV4ZWMoYTIpIHx8IFtdO1xuICBpZiAoYVByZWZpeCAhPT0gdm9pZCAwKSB7XG4gICAgY29uc3QgW19iLCBiUHJlZml4LCBiRGlnaXRzLCBiU3VmZml4XSA9IHJQcmVmaXhlZERpZ2l0cy5leGVjKGIzKSB8fCBbXTtcbiAgICBpZiAoYlByZWZpeCA9PT0gYVByZWZpeCkge1xuICAgICAgcmV0dXJuIGNvbXBhcmVOYXRzKGFEaWdpdHMsIGJEaWdpdHMpIHx8IGNvbXBhcmVTdHJpbmdzKGFTdWZmaXgsIGJTdWZmaXgpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gY29tcGFyZVN0cmluZ3MoYTIsIGIzKTtcbn07XG5oYXJkZW4obmF0dXJhbENvbXBhcmUpO1xuXG4vL1xudmFyIHsgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczcsIGNyZWF0ZTogY3JlYXRlNSwgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTEgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IG93bktleXMyMCB9ID0gUmVmbGVjdDtcbnZhciBvYmplY3RNZXRhTWFwID0gKG9yaWdpbmFsLCBtZXRhTWFwRm4sIHByb3RvID0gT2JqZWN0LnByb3RvdHlwZSkgPT4ge1xuICBjb25zdCBkZXNjcyA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM3KG9yaWdpbmFsKTtcbiAgY29uc3Qga2V5czQgPSBvd25LZXlzMjAob3JpZ2luYWwpO1xuICBjb25zdCBkZXNjRW50cmllcyA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAga2V5czQubWFwKChrZXkpID0+IFtrZXksIG1ldGFNYXBGbihkZXNjc1trZXldLCBrZXkpXSkuZmlsdGVyKChbX2tleSwgb3B0RGVzY10pID0+IG9wdERlc2MgIT09IHZvaWQgMClcbiAgKTtcbiAgcmV0dXJuIGhhcmRlbihjcmVhdGU1KHByb3RvLCBmcm9tRW50cmllczExKGRlc2NFbnRyaWVzKSkpO1xufTtcbmhhcmRlbihvYmplY3RNZXRhTWFwKTtcblxuLy9cbnZhciBmcmVlemU4ID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIE9iamVjdC5mcmVlemVcbik7XG52YXIgbWFrZVF1ZXVlID0gKCkgPT4ge1xuICBsZXQgeyBwcm9taXNlOiB0YWlsUHJvbWlzZSwgcmVzb2x2ZTogdGFpbFJlc29sdmUgfSA9IG1ha2VQcm9taXNlS2l0KCk7XG4gIHJldHVybiB7XG4gICAgcHV0KHZhbHVlKSB7XG4gICAgICBjb25zdCB7IHJlc29sdmU6IHJlc29sdmUyLCBwcm9taXNlIH0gPSBtYWtlUHJvbWlzZUtpdCgpO1xuICAgICAgdGFpbFJlc29sdmUoZnJlZXplOCh7IHZhbHVlLCBwcm9taXNlIH0pKTtcbiAgICAgIHRhaWxSZXNvbHZlID0gcmVzb2x2ZTI7XG4gICAgfSxcbiAgICBnZXQoKSB7XG4gICAgICBjb25zdCBwcm9taXNlID0gdGFpbFByb21pc2UudGhlbigobmV4dCkgPT4gbmV4dC52YWx1ZSk7XG4gICAgICB0YWlsUHJvbWlzZSA9IHRhaWxQcm9taXNlLnRoZW4oKG5leHQpID0+IG5leHQucHJvbWlzZSk7XG4gICAgICByZXR1cm4gaGFyZGVuKHByb21pc2UpO1xuICAgIH1cbiAgfTtcbn07XG5oYXJkZW4obWFrZVF1ZXVlKTtcbnZhciBtYWtlU3RyZWFtID0gKGFja3MsIGRhdGEpID0+IHtcbiAgY29uc3Qgc3RyZWFtID0gaGFyZGVuKHtcbiAgICAvKlxuXG4gICAgICovXG4gICAgbmV4dCh2YWx1ZSkge1xuICAgICAgZGF0YS5wdXQoZnJlZXplOCh7IHZhbHVlLCBkb25lOiBmYWxzZSB9KSk7XG4gICAgICByZXR1cm4gYWNrcy5nZXQoKTtcbiAgICB9LFxuICAgIC8qXG5cbiAgICAgKi9cbiAgICByZXR1cm4odmFsdWUpIHtcbiAgICAgIGRhdGEucHV0KGZyZWV6ZTgoeyB2YWx1ZSwgZG9uZTogdHJ1ZSB9KSk7XG4gICAgICByZXR1cm4gYWNrcy5nZXQoKTtcbiAgICB9LFxuICAgIC8qXG5cbiAgICAgKi9cbiAgICB0aHJvdyhlcnJvcikge1xuICAgICAgZGF0YS5wdXQoaGFyZGVuKFByb21pc2UucmVqZWN0KGVycm9yKSkpO1xuICAgICAgcmV0dXJuIGFja3MuZ2V0KCk7XG4gICAgfSxcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgICAgcmV0dXJuIHN0cmVhbTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gc3RyZWFtO1xufTtcbmhhcmRlbihtYWtlU3RyZWFtKTtcbnZhciBtYWtlUGlwZSA9ICgpID0+IHtcbiAgY29uc3QgZGF0YSA9IG1ha2VRdWV1ZSgpO1xuICBjb25zdCBhY2tzID0gbWFrZVF1ZXVlKCk7XG4gIGNvbnN0IHJlYWRlciA9IG1ha2VTdHJlYW0oYWNrcywgZGF0YSk7XG4gIGNvbnN0IHdyaXRlciA9IG1ha2VTdHJlYW0oZGF0YSwgYWNrcyk7XG4gIHJldHVybiBoYXJkZW4oW3dyaXRlciwgcmVhZGVyXSk7XG59O1xuaGFyZGVuKG1ha2VQaXBlKTtcbnZhciBwdW1wID0gYXN5bmMgKHdyaXRlciwgcmVhZGVyLCBwcmltZXIpID0+IHtcbiAgY29uc3QgdGljayA9IChwcm9taXNlKSA9PiBFLndoZW4oXG4gICAgcHJvbWlzZSxcbiAgICAocmVzdWx0KSA9PiB7XG4gICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgcmV0dXJuIHdyaXRlci5yZXR1cm4ocmVzdWx0LnZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0b2NrKHdyaXRlci5uZXh0KHJlc3VsdC52YWx1ZSkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgKGVycm9yKSA9PiB7XG4gICAgICByZXR1cm4gd3JpdGVyLnRocm93KGVycm9yKTtcbiAgICB9XG4gICk7XG4gIGNvbnN0IHRvY2sgPSAocHJvbWlzZSkgPT4gRS53aGVuKFxuICAgIHByb21pc2UsXG4gICAgKHJlc3VsdCkgPT4ge1xuICAgICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICAgIHJldHVybiByZWFkZXIucmV0dXJuKHJlc3VsdC52YWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGljayhyZWFkZXIubmV4dChyZXN1bHQudmFsdWUpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIChlcnJvcikgPT4ge1xuICAgICAgcmV0dXJuIHJlYWRlci50aHJvdyhlcnJvcik7XG4gICAgfVxuICApO1xuICBhd2FpdCB0aWNrKHJlYWRlci5uZXh0KHByaW1lcikpO1xuICByZXR1cm4gdm9pZCAwO1xufTtcbmhhcmRlbihwdW1wKTtcbnZhciBwcmltZSA9IChnZW5lcmF0b3IsIHByaW1lcikgPT4ge1xuICBjb25zdCBmaXJzdCA9IGdlbmVyYXRvci5uZXh0KHByaW1lcik7XG4gIGxldCByZXN1bHQ7XG4gIGNvbnN0IHByaW1lZCA9IGhhcmRlbih7XG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGFzeW5jIG5leHQodmFsdWUpIHtcbiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCBmaXJzdDtcbiAgICAgICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGdlbmVyYXRvci5uZXh0KHZhbHVlKTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgYXN5bmMgcmV0dXJuKHZhbHVlKSB7XG4gICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHtcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgZmlyc3Q7XG4gICAgICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBnZW5lcmF0b3IucmV0dXJuKHZhbHVlKTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGFzeW5jIHRocm93KGVycm9yKSB7XG4gICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHtcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgZmlyc3Q7XG4gICAgICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZ2VuZXJhdG9yLnRocm93KGVycm9yKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gcHJpbWVkO1xufTtcbmhhcmRlbihwcmltZSk7XG52YXIgbWFwUmVhZGVyID0gKHJlYWRlciwgdHJhbnNmb3JtKSA9PiB7XG4gIGFzeW5jIGZ1bmN0aW9uKiB0cmFuc2Zvcm1HZW5lcmF0b3IoKSB7XG4gICAgZm9yIGF3YWl0IChjb25zdCB2YWx1ZSBvZiByZWFkZXIpIHtcbiAgICAgIHlpZWxkIHRyYW5zZm9ybSh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbiAgaGFyZGVuKHRyYW5zZm9ybUdlbmVyYXRvcik7XG4gIHJldHVybiBoYXJkZW4odHJhbnNmb3JtR2VuZXJhdG9yKCkpO1xufTtcbmhhcmRlbihtYXBSZWFkZXIpO1xudmFyIG1hcFdyaXRlciA9ICh3cml0ZXIsIHRyYW5zZm9ybSkgPT4ge1xuICBjb25zdCB0cmFuc2Zvcm1lZFdyaXRlciA9IGhhcmRlbih7XG4gICAgLypcblxuICAgICAqL1xuICAgIGFzeW5jIG5leHQodmFsdWUpIHtcbiAgICAgIHJldHVybiB3cml0ZXIubmV4dCh0cmFuc2Zvcm0odmFsdWUpKTtcbiAgICB9LFxuICAgIC8qXG5cbiAgICAgKi9cbiAgICBhc3luYyB0aHJvdyhlcnJvcikge1xuICAgICAgcmV0dXJuIHdyaXRlci50aHJvdyhlcnJvcik7XG4gICAgfSxcbiAgICAvKlxuXG4gICAgICovXG4gICAgYXN5bmMgcmV0dXJuKHZhbHVlKSB7XG4gICAgICByZXR1cm4gd3JpdGVyLnJldHVybih2YWx1ZSk7XG4gICAgfSxcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkV3JpdGVyO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiB0cmFuc2Zvcm1lZFdyaXRlcjtcbn07XG5oYXJkZW4obWFwV3JpdGVyKTtcblxuLy9cbnZhciBtYWtlUHJvbWlzZSA9IChleGVjdXRvcikgPT4gaGFyZGVuKG5ldyBQcm9taXNlKGV4ZWN1dG9yKSk7XG5oYXJkZW4obWFrZVByb21pc2UpO1xudmFyIG1ha2VNYXAgPSAoZW50cmllc09ySXRlcmFibGUpID0+IGhhcmRlbihuZXcgTWFwKGVudHJpZXNPckl0ZXJhYmxlKSk7XG5oYXJkZW4obWFrZU1hcCk7XG52YXIgbWFrZVNldCA9ICh2YWx1ZXM2KSA9PiBoYXJkZW4obmV3IFNldCh2YWx1ZXM2KSk7XG5oYXJkZW4obWFrZVNldCk7XG52YXIgbWFrZVdlYWtNYXAgPSAoZW50cmllczEwKSA9PiBoYXJkZW4obmV3IFdlYWtNYXAoZW50cmllczEwKSk7XG5oYXJkZW4obWFrZVdlYWtNYXApO1xudmFyIG1ha2VXZWFrU2V0ID0gKHZhbHVlczYpID0+IGhhcmRlbihuZXcgV2Vha1NldCh2YWx1ZXM2KSk7XG5oYXJkZW4obWFrZVdlYWtTZXQpO1xuXG4vL1xudmFyIGFzeW5jR2VuZXJhdGUgPSAobmV4dCkgPT4ge1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgbmV4dDogYXN5bmMgKCkgPT4gaGFyZGVuKG5leHQoKSlcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKGFzeW5jR2VuZXJhdGUpO1xuXG4vL1xudmFyIGFzeW5jRG9XaGlsZSA9IChib2R5KSA9PiB7XG4gIHJldHVybiBtYWtlUHJvbWlzZSgocmVzb2x2ZTIsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IGxvb3AgPSBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkb0NvbnRpbnVlID0gYXdhaXQgYm9keSgpO1xuICAgICAgaWYgKCFkb0NvbnRpbnVlKSB7XG4gICAgICAgIHJlc29sdmUyKHZvaWQgMCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGxvb3AoKS5jYXRjaChyZWplY3QpO1xuICAgIH07XG4gICAgbG9vcCgpLmNhdGNoKHJlamVjdCk7XG4gIH0pO1xufTtcbmhhcmRlbihhc3luY0RvV2hpbGUpO1xuXG4vL1xudmFyIHsgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTIsIGtleXMsIHZhbHVlczogdmFsdWVzNCB9ID0gT2JqZWN0O1xudmFyIG1ha2VMaW1pdGVkQ29uc29sZSA9IChtYWtlTG9nZ2VyKSA9PiB7XG4gIGNvbnN0IGxpbWl0ZWRDb25zb2xlID0gKFxuICAgIC8qICAgICAgICAgICAgICAqL1xuICAgIGZyb21FbnRyaWVzMTIobG9nTGV2ZWxzLm1hcCgobGV2ZWwpID0+IFtsZXZlbCwgbWFrZUxvZ2dlcihsZXZlbCldKSlcbiAgKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGhhcmRlbihsaW1pdGVkQ29uc29sZSlcbiAgKTtcbn07XG5oYXJkZW4obWFrZUxpbWl0ZWRDb25zb2xlKTtcbnZhciBhc3NlcnRBbGxEZWZpbmVkID0gKG9iaikgPT4ge1xuICBjb25zdCBtaXNzaW5nMiA9IFtdO1xuICBmb3IgKGNvbnN0IFtrZXksIHZhbF0gb2YgT2JqZWN0LmVudHJpZXMob2JqKSkge1xuICAgIGlmICh2YWwgPT09IHZvaWQgMCkge1xuICAgICAgbWlzc2luZzIucHVzaChrZXkpO1xuICAgIH1cbiAgfVxuICBpZiAobWlzc2luZzIubGVuZ3RoID4gMCkge1xuICAgIHRocm93UmVkYWN0ZWRgbWlzc2luZyAke3F1b3RlKG1pc3NpbmcyKX1gO1xuICB9XG59O1xudmFyIG5vdERvbmUgPSBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWU6IHZvaWQgMCB9KTtcbnZhciBhbHdheXNEb25lID0gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHZvaWQgMCB9KTtcbnZhciBmb3JldmVyID0gYXN5bmNHZW5lcmF0ZSgoKSA9PiBub3REb25lKTtcbnZhciB6aXAgPSAoeHMsIHlzKSA9PiBoYXJkZW4oeHMubWFwKCh4LCBpMikgPT4gW3gsIHlzWytpMl1dKSk7XG52YXIgYWxsVmFsdWVzID0gYXN5bmMgKG9iaikgPT4ge1xuICBjb25zdCByZXNvbHZlZCA9IGF3YWl0IFByb21pc2UuYWxsKHZhbHVlczQob2JqKSk7XG4gIHJldHVybiBoYXJkZW4oZnJvbUVudHJpZXMxMih6aXAoa2V5cyhvYmopLCByZXNvbHZlZCkpKTtcbn07XG5cbi8vXG52YXIgbXVzdE1hdGNoMyA9IG11c3RNYXRjaDtcblxuLy9cbnZhciBTdG9yYWdlTm9kZVNoYXBlID0gTS5yZW1vdGFibGUoXCJTdG9yYWdlTm9kZVwiKTtcbnZhciBVbmd1YXJkZWRIZWxwZXJJID0gTS5pbnRlcmZhY2UoXG4gIFwiaGVscGVyXCIsXG4gIHt9LFxuICAvL1xuICB7IHNsb3BweTogdHJ1ZSB9XG4pO1xudmFyIEJyaWRnZUJpZ0ludFNoYXBlID0gTS5vcihNLm51bWJlcigpLCBNLnN0cmluZygpKTtcblxuLy9cbnZhciBmb3JFYWNoUHVibGljYXRpb25SZWNvcmQgPSBhc3luYyAoc3Vic2NyaWJlciwgY29uc3VtZVZhbHVlKSA9PiB7XG4gIGNvbnN0IGl0ZXJhdG9yID0gc3Vic2NyaWJlRWFjaChzdWJzY3JpYmVyKVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKTtcbiAgbGV0IGZpbmlzaGVkID0gZmFsc2U7XG4gIGF3YWl0IG51bGw7XG4gIHdoaWxlICghZmluaXNoZWQpIHtcbiAgICBjb25zdCB7IHZhbHVlLCBkb25lIH0gPSBhd2FpdCBpdGVyYXRvci5uZXh0KCk7XG4gICAgYXdhaXQgY29uc3VtZVZhbHVlKHZhbHVlKTtcbiAgICBmaW5pc2hlZCA9ICEhZG9uZTtcbiAgfVxufTtcbnZhciBtYWtlU3RvcmVkU3Vic2NyaWJlciA9IChzdWJzY3JpYmVyLCBzdG9yYWdlTm9kZSwgbWFyc2hhbGxlcikgPT4ge1xuICBhc3NlcnRBbGxEZWZpbmVkKHsgc3Vic2NyaWJlciwgc3RvcmFnZU5vZGUsIG1hcnNoYWxsZXIgfSk7XG4gIGNvbnN0IG1hcnNoYWxsVG9TdG9yYWdlID0gbWFrZVNlcmlhbGl6ZVRvU3RvcmFnZShzdG9yYWdlTm9kZSwgbWFyc2hhbGxlcik7XG4gIGZvckVhY2hQdWJsaWNhdGlvblJlY29yZChzdWJzY3JpYmVyLCBtYXJzaGFsbFRvU3RvcmFnZSkuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTdG9yZWRTdWJzY3JpYmVyIGZhaWxlZCB0byBpdGVyYXRlXCIsIGVycik7XG4gIH0pO1xuICBjb25zdCB1bnNlcmlhbGl6ZXIgPSBGYXIoXCJ1bnNlcmlhbGl6ZXJcIiwge1xuICAgIGZyb21DYXBEYXRhOiAoZGF0YSkgPT4gRShtYXJzaGFsbGVyKS5mcm9tQ2FwRGF0YShkYXRhKSxcbiAgICB1bnNlcmlhbGl6ZTogKGRhdGEpID0+IEUobWFyc2hhbGxlcikuZnJvbUNhcERhdGEoZGF0YSlcbiAgfSk7XG4gIGNvbnN0IHN0b3Jlc3ViID0gRmFyKFwiU3RvcmVkU3Vic2NyaWJlclwiLCB7XG4gICAgc3Vic2NyaWJlQWZ0ZXI6IChwdWJsaXNoQ291bnQpID0+IHN1YnNjcmliZXIuc3Vic2NyaWJlQWZ0ZXIocHVibGlzaENvdW50KSxcbiAgICBnZXRVcGRhdGVTaW5jZTogKHVwZGF0ZUNvdW50KSA9PiBzdWJzY3JpYmVyLmdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KSxcbiAgICBnZXRQYXRoOiAoKSA9PiBFKHN0b3JhZ2VOb2RlKS5nZXRQYXRoKCksXG4gICAgZ2V0U3RvcmVLZXk6ICgpID0+IEUoc3RvcmFnZU5vZGUpLmdldFN0b3JlS2V5KCksXG4gICAgZ2V0VW5zZXJpYWxpemVyOiAoKSA9PiB1bnNlcmlhbGl6ZXJcbiAgfSk7XG4gIHJldHVybiBzdG9yZXN1Yjtcbn07XG52YXIgbWFrZVN0b3JlZFN1YnNjcmlwdGlvbiA9IChzdWJzY3JpcHRpb24sIHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyID0gbWFrZU1hcnNoYWwodm9pZCAwLCB2b2lkIDAsIHtcbiAgbWFyc2hhbFNhdmVFcnJvcjogKCkgPT4ge1xuICB9LFxuICBzZXJpYWxpemVCb2R5Rm9ybWF0OiBcInNtYWxsY2Fwc1wiXG59KSkgPT4ge1xuICBjb25zdCB1bnNlcmlhbGl6ZXIgPSBGYXIoXCJ1bnNlcmlhbGl6ZXJcIiwge1xuICAgIGZyb21DYXBEYXRhOiAoZGF0YSkgPT4gRShtYXJzaGFsbGVyKS5mcm9tQ2FwRGF0YShkYXRhKSxcbiAgICB1bnNlcmlhbGl6ZTogKGRhdGEpID0+IEUobWFyc2hhbGxlcikuZnJvbUNhcERhdGEoZGF0YSlcbiAgfSk7XG4gIGxldCBwdWJsaXNoRmFpbGVkID0gZmFsc2U7XG4gIGxldCBwdWJsaXNoRXhjZXB0aW9uO1xuICBjb25zdCBmYWlsID0gKGVycikgPT4ge1xuICAgIHB1Ymxpc2hGYWlsZWQgPSB0cnVlO1xuICAgIHB1Ymxpc2hFeGNlcHRpb24gPSBlcnI7XG4gIH07XG4gIGNvbnN0IHB1Ymxpc2hWYWx1ZSA9IChvYmopID0+IHtcbiAgICBhc3NlcnQoc3RvcmFnZU5vZGUpO1xuICAgIGlmIChwdWJsaXNoRmFpbGVkKSB7XG4gICAgICB0aHJvdyBwdWJsaXNoRXhjZXB0aW9uO1xuICAgIH1cbiAgICBFKG1hcnNoYWxsZXIpLnRvQ2FwRGF0YShvYmopLnRoZW4oKHNlcmlhbGl6ZWQpID0+IHtcbiAgICAgIGNvbnN0IGVuY29kZWQgPSBKU09OLnN0cmluZ2lmeShzZXJpYWxpemVkKTtcbiAgICAgIHJldHVybiBFKHN0b3JhZ2VOb2RlKS5zZXRWYWx1ZShlbmNvZGVkKTtcbiAgICB9KS5jYXRjaChmYWlsKTtcbiAgfTtcbiAgaWYgKHN0b3JhZ2VOb2RlKSB7XG4gICAgb2JzZXJ2ZUl0ZXJhdGlvbihzdWJzY3JpcHRpb24sIHtcbiAgICAgIHVwZGF0ZVN0YXRlOiBwdWJsaXNoVmFsdWUsXG4gICAgICBmaW5pc2g6IHB1Ymxpc2hWYWx1ZVxuICAgIH0pLmNhdGNoKGZhaWwpO1xuICB9XG4gIGNvbnN0IHN0b3Jlc3ViID0gRmFyKFwiU3RvcmVkU3Vic2NyaXB0aW9uXCIsIHtcbiAgICAvL1xuICAgIGdldFN0b3JlS2V5OiBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIXN0b3JhZ2VOb2RlKSB7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBzdWJzY3JpcHRpb24gfSk7XG4gICAgICB9XG4gICAgICBjb25zdCBzdG9yZUtleSA9IGF3YWl0IEUoc3RvcmFnZU5vZGUpLmdldFN0b3JlS2V5KCk7XG4gICAgICByZXR1cm4gaGFyZGVuKHsgLi4uc3RvcmVLZXksIHN1YnNjcmlwdGlvbiB9KTtcbiAgICB9LFxuICAgIGdldFVuc2VyaWFsaXplcjogKCkgPT4gdW5zZXJpYWxpemVyLFxuICAgIGdldFNoYXJhYmxlU3Vic2NyaXB0aW9uSW50ZXJuYWxzOiAoKSA9PiBzdWJzY3JpcHRpb24uZ2V0U2hhcmFibGVTdWJzY3JpcHRpb25JbnRlcm5hbHMoKSxcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiAoKSA9PiBzdWJzY3JpcHRpb25bU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCksXG4gICAgc3Vic2NyaWJlQWZ0ZXI6IChwdWJsaXNoQ291bnQpID0+IHN1YnNjcmlwdGlvbi5zdWJzY3JpYmVBZnRlcihwdWJsaXNoQ291bnQpXG4gIH0pO1xuICByZXR1cm4gc3RvcmVzdWI7XG59O1xuaGFyZGVuKG1ha2VTdG9yZWRTdWJzY3JpcHRpb24pO1xudmFyIG1ha2VTdG9yZWRQdWJsaXNoS2l0ID0gKHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKSA9PiB7XG4gIGNvbnN0IHsgcHVibGlzaGVyLCBzdWJzY3JpYmVyIH0gPSBtYWtlUHVibGlzaEtpdCgpO1xuICByZXR1cm4ge1xuICAgIHB1Ymxpc2hlcixcbiAgICAvL1xuICAgIHN1YnNjcmliZXI6IG1ha2VTdG9yZWRTdWJzY3JpYmVyKHN1YnNjcmliZXIsIHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKVxuICB9O1xufTtcbmhhcmRlbihtYWtlU3RvcmVkUHVibGlzaEtpdCk7XG5cbi8vXG52YXIgbWFrZVRyYW5zaWVudE5vdGlmaWVyS2l0ID0gKCkgPT4ge1xuICBjb25zdCB0cmFuc2llbnROb3RpZmVyS2l0cyA9IG1ha2VTY2FsYXJCaWdXZWFrTWFwU3RvcmUoXG4gICAgXCJ0cmFuc2llbnROb3RpZmVyS2l0c1wiXG4gICk7XG4gIGNvbnN0IHByb3ZpZGVOb3RpZmllcktpdCA9IChrZXkpID0+IHByb3ZpZGVMYXp5KFxuICAgIHRyYW5zaWVudE5vdGlmZXJLaXRzLFxuICAgIGtleSxcbiAgICAoKSA9PiBtYWtlTm90aWZpZXJLaXQoa2V5LmdldEN1cnJlbnRBbW91bnQoKSlcbiAgKTtcbiAgY29uc3QgcHJvdmlkZU5vdGlmaWVyID0gKGtleSkgPT4gcHJvdmlkZU5vdGlmaWVyS2l0KGtleSkubm90aWZpZXI7XG4gIGNvbnN0IHVwZGF0ZSA9IChrZXksIG5ld1ZhbHVlKSA9PiB7XG4gICAgaWYgKHRyYW5zaWVudE5vdGlmZXJLaXRzLmhhcyhrZXkpKSB7XG4gICAgICBjb25zdCB7IHVwZGF0ZXIgfSA9IHRyYW5zaWVudE5vdGlmZXJLaXRzLmdldChrZXkpO1xuICAgICAgdXBkYXRlci51cGRhdGVTdGF0ZShuZXdWYWx1ZSk7XG4gICAgfVxuICB9O1xuICByZXR1cm4geyBwcm92aWRlTm90aWZpZXIsIHVwZGF0ZSB9O1xufTtcbmhhcmRlbihtYWtlVHJhbnNpZW50Tm90aWZpZXJLaXQpO1xuXG4vL1xudmFyIG1ha2VBbW91bnRTdG9yZSA9IChzdGF0ZSwga2V5KSA9PiB7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGdldEFtb3VudDogKCkgPT4gc3RhdGVba2V5XSxcbiAgICBpbmNyZW1lbnQ6IChkZWx0YSkgPT4ge1xuICAgICAgc3RhdGVba2V5XSA9IEFtb3VudE1hdGguYWRkKHN0YXRlW2tleV0sIGRlbHRhKTtcbiAgICB9LFxuICAgIGRlY3JlbWVudDogKGRlbHRhKSA9PiB7XG4gICAgICBpZiAoQW1vdW50TWF0aC5pc0dURShzdGF0ZVtrZXldLCBkZWx0YSkpIHtcbiAgICAgICAgc3RhdGVba2V5XSA9IEFtb3VudE1hdGguc3VidHJhY3Qoc3RhdGVba2V5XSwgZGVsdGEpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihtYWtlQW1vdW50U3RvcmUpO1xuXG4vL1xudmFyIEVNUFRZX0NPUFlfU0VUID0gbWFrZUNvcHlTZXQoW10pO1xudmFyIHByZXBhcmVQdXJzZUtpbmQgPSAoaXNzdWVyWm9uZSwgbmFtZSwgYXNzZXRLaW5kLCBicmFuZCwgUHVyc2VJS2l0LCBwdXJzZU1ldGhvZHMsIHJlY292ZXJ5U2V0c1N0YXRlLCBwYXltZW50UmVjb3ZlcnlTZXRzKSA9PiB7XG4gIGNvbnN0IGFtb3VudFNoYXBlID0gYnJhbmQuZ2V0QW1vdW50U2hhcGUoKTtcbiAgY29uc3QgeyBwcm92aWRlTm90aWZpZXIsIHVwZGF0ZTogdXBkYXRlQmFsYW5jZSB9ID0gbWFrZVRyYW5zaWVudE5vdGlmaWVyS2l0KCk7XG4gIGNvbnN0IG1heWJlUmVjb3ZlcnlTZXQgPSAoc3RhdGUpID0+IHtcbiAgICBjb25zdCB7IHJlY292ZXJ5U2V0IH0gPSBzdGF0ZTtcbiAgICBpZiAocmVjb3ZlcnlTZXRzU3RhdGUgPT09IFwiaGFzUmVjb3ZlcnlTZXRzXCIpIHtcbiAgICAgIHJldHVybiByZWNvdmVyeVNldDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVjb3ZlcnlTZXRzU3RhdGUgPT09IFwibm9SZWNvdmVyeVNldHNcIiB8fCB0aHJvd1JlZGFjdGVkYHJlY292ZXJTZXRzU3RhdGUgbXVzdCBiZSBub1JlY292ZXJ5U2V0cyBpZiBpdCBpc24ndCBoYXNSZWNvdmVyU2V0c2A7XG4gICAgICBwYXltZW50UmVjb3ZlcnlTZXRzICE9PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBwYXltZW50UmVjb3ZlcnlTZXRzIG11c3QgYWx3YXlzIGJlIGRlZmluZWRgO1xuICAgICAgcmVjb3ZlcnlTZXQuZ2V0U2l6ZSgpID09PSAwIHx8IHRocm93UmVkYWN0ZWRgV2l0aCBub1JlY292ZXJ5U2V0cywgcmVjb3ZlcnlTZXQgbXVzdCBiZSBlbXB0eWA7XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgeyBkZXBvc2l0SW50ZXJuYWwsIHdpdGhkcmF3SW50ZXJuYWwgfSA9IHB1cnNlTWV0aG9kcztcbiAgY29uc3QgbWFrZVB1cnNlS2l0ID0gaXNzdWVyWm9uZS5leG9DbGFzc0tpdChcbiAgICBgJHtuYW1lfSBQdXJzZWAsXG4gICAgUHVyc2VJS2l0LFxuICAgICgpID0+IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRCYWxhbmNlID0gQW1vdW50TWF0aC5tYWtlRW1wdHkoYnJhbmQsIGFzc2V0S2luZCk7XG4gICAgICBjb25zdCByZWNvdmVyeVNldCA9IGlzc3VlclpvbmUuZGV0YWNoZWQoKS5zZXRTdG9yZShcInJlY292ZXJ5IHNldFwiKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGN1cnJlbnRCYWxhbmNlLFxuICAgICAgICByZWNvdmVyeVNldFxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIHB1cnNlOiB7XG4gICAgICAgIGRlcG9zaXQoc3JjUGF5bWVudCwgb3B0QW1vdW50U2hhcGUgPSB2b2lkIDApIHtcbiAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgIGNvbnN0IHsgcHVyc2UgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IGJhbGFuY2VTdG9yZSA9IG1ha2VBbW91bnRTdG9yZShzdGF0ZSwgXCJjdXJyZW50QmFsYW5jZVwiKTtcbiAgICAgICAgICBjb25zdCBzcmNQYXltZW50QmFsYW5jZSA9IGRlcG9zaXRJbnRlcm5hbChcbiAgICAgICAgICAgIGJhbGFuY2VTdG9yZSxcbiAgICAgICAgICAgIHNyY1BheW1lbnQsXG4gICAgICAgICAgICBvcHRBbW91bnRTaGFwZVxuICAgICAgICAgICk7XG4gICAgICAgICAgdXBkYXRlQmFsYW5jZShwdXJzZSwgYmFsYW5jZVN0b3JlLmdldEFtb3VudCgpKTtcbiAgICAgICAgICByZXR1cm4gc3JjUGF5bWVudEJhbGFuY2U7XG4gICAgICAgIH0sXG4gICAgICAgIHdpdGhkcmF3KGFtb3VudCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgY29uc3QgeyBwdXJzZSB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3Qgb3B0UmVjb3ZlcnlTZXQgPSBtYXliZVJlY292ZXJ5U2V0KHN0YXRlKTtcbiAgICAgICAgICBjb25zdCBiYWxhbmNlU3RvcmUgPSBtYWtlQW1vdW50U3RvcmUoc3RhdGUsIFwiY3VycmVudEJhbGFuY2VcIik7XG4gICAgICAgICAgY29uc3QgcGF5bWVudCA9IHdpdGhkcmF3SW50ZXJuYWwoXG4gICAgICAgICAgICBiYWxhbmNlU3RvcmUsXG4gICAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgICBvcHRSZWNvdmVyeVNldFxuICAgICAgICAgICk7XG4gICAgICAgICAgdXBkYXRlQmFsYW5jZShwdXJzZSwgYmFsYW5jZVN0b3JlLmdldEFtb3VudCgpKTtcbiAgICAgICAgICByZXR1cm4gcGF5bWVudDtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0Q3VycmVudEFtb3VudCgpIHtcbiAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgIGNvbnN0IGJhbGFuY2VTdG9yZSA9IG1ha2VBbW91bnRTdG9yZShzdGF0ZSwgXCJjdXJyZW50QmFsYW5jZVwiKTtcbiAgICAgICAgICByZXR1cm4gYmFsYW5jZVN0b3JlLmdldEFtb3VudCgpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRDdXJyZW50QW1vdW50Tm90aWZpZXIoKSB7XG4gICAgICAgICAgcmV0dXJuIHByb3ZpZGVOb3RpZmllcih0aGlzLmZhY2V0cy5wdXJzZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEFsbGVnZWRCcmFuZCgpIHtcbiAgICAgICAgICByZXR1cm4gYnJhbmQ7XG4gICAgICAgIH0sXG4gICAgICAgIGdldERlcG9zaXRGYWNldCgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5mYWNldHMuZGVwb3NpdEZhY2V0O1xuICAgICAgICB9LFxuICAgICAgICBnZXRSZWNvdmVyeVNldCgpIHtcbiAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgIGNvbnN0IG9wdFJlY292ZXJ5U2V0ID0gbWF5YmVSZWNvdmVyeVNldChzdGF0ZSk7XG4gICAgICAgICAgaWYgKG9wdFJlY292ZXJ5U2V0ID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIHJldHVybiBFTVBUWV9DT1BZX1NFVDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG9wdFJlY292ZXJ5U2V0LnNuYXBzaG90KCk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlY292ZXJBbGwoKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgIGxldCBhbW91bnQgPSBBbW91bnRNYXRoLm1ha2VFbXB0eShicmFuZCwgYXNzZXRLaW5kKTtcbiAgICAgICAgICBjb25zdCBvcHRSZWNvdmVyeVNldCA9IG1heWJlUmVjb3ZlcnlTZXQoc3RhdGUpO1xuICAgICAgICAgIGlmIChvcHRSZWNvdmVyeVNldCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gYW1vdW50O1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3IgKGNvbnN0IHBheW1lbnQgb2Ygb3B0UmVjb3ZlcnlTZXQua2V5cygpKSB7XG4gICAgICAgICAgICBjb25zdCBkZWx0YSA9IGZhY2V0cy5wdXJzZS5kZXBvc2l0KHBheW1lbnQpO1xuICAgICAgICAgICAgYW1vdW50ID0gQW1vdW50TWF0aC5hZGQoYW1vdW50LCBkZWx0YSwgYnJhbmQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBvcHRSZWNvdmVyeVNldC5nZXRTaXplKCkgPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogUmVtYWluaW5nIHVucmVjb3ZlcmVkIHBheW1lbnRzOiAke2ZhY2V0cy5wdXJzZS5nZXRSZWNvdmVyeVNldCgpfWA7XG4gICAgICAgICAgcmV0dXJuIGFtb3VudDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlcG9zaXRGYWNldDoge1xuICAgICAgICByZWNlaXZlKC4uLmFyZ3MpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5mYWNldHMucHVyc2UuZGVwb3NpdCguLi5hcmdzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgc3RhdGVTaGFwZToge1xuICAgICAgICBjdXJyZW50QmFsYW5jZTogYW1vdW50U2hhcGUsXG4gICAgICAgIHJlY292ZXJ5U2V0OiBNLnJlbW90YWJsZShcInJlY292ZXJ5U2V0XCIpXG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4gKCkgPT4gbWFrZVB1cnNlS2l0KCkucHVyc2U7XG59O1xuaGFyZGVuKHByZXBhcmVQdXJzZUtpbmQpO1xuXG4vL1xudmFyIGFtb3VudFNoYXBlRnJvbUVsZW1lbnRTaGFwZSA9IChicmFuZCwgYXNzZXRLaW5kLCBlbGVtZW50U2hhcGUpID0+IHtcbiAgbGV0IHZhbHVlU2hhcGU7XG4gIHN3aXRjaCAoYXNzZXRLaW5kKSB7XG4gICAgY2FzZSBcIm5hdFwiOiB7XG4gICAgICB2YWx1ZVNoYXBlID0gTS5uYXQoKTtcbiAgICAgIGVsZW1lbnRTaGFwZSA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgRnVuZ2libGUgYXNzZXRzIGNhbm5vdCBoYXZlIGFuIGVsZW1lbnRTaGFwZTogJHtxdW90ZShlbGVtZW50U2hhcGUpfWA7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSBcInNldFwiOiB7XG4gICAgICBpZiAoZWxlbWVudFNoYXBlID09PSB2b2lkIDApIHtcbiAgICAgICAgdmFsdWVTaGFwZSA9IE0uYXJyYXlPZihNLmtleSgpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlU2hhcGUgPSBNLmFycmF5T2YoTS5hbmQoTS5rZXkoKSwgZWxlbWVudFNoYXBlKSk7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSBcImNvcHlTZXRcIjoge1xuICAgICAgaWYgKGVsZW1lbnRTaGFwZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHZhbHVlU2hhcGUgPSBNLnNldCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWVTaGFwZSA9IE0uc2V0T2YoZWxlbWVudFNoYXBlKTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIFwiY29weUJhZ1wiOiB7XG4gICAgICBpZiAoZWxlbWVudFNoYXBlID09PSB2b2lkIDApIHtcbiAgICAgICAgdmFsdWVTaGFwZSA9IE0uYmFnKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5iYWdPZihlbGVtZW50U2hhcGUpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBhc3NldCBraW5kICR7cXVvdGUoYXNzZXRLaW5kKX1gO1xuICAgIH1cbiAgfVxuICBjb25zdCBhbW91bnRTaGFwZSA9IGhhcmRlbih7XG4gICAgYnJhbmQsXG4gICAgLy9cbiAgICB2YWx1ZTogdmFsdWVTaGFwZVxuICB9KTtcbiAgcmV0dXJuIGFtb3VudFNoYXBlO1xufTtcbnZhciBwcmVwYXJlUGF5bWVudExlZGdlciA9IChpc3N1ZXJab25lLCBuYW1lLCBhc3NldEtpbmQsIGRpc3BsYXlJbmZvLCBlbGVtZW50U2hhcGUsIHJlY292ZXJ5U2V0c1N0YXRlLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IGJyYW5kID0gaXNzdWVyWm9uZS5leG8oYCR7bmFtZX0gYnJhbmRgLCBCcmFuZEksIHtcbiAgICBpc015SXNzdWVyKGFsbGVnZWRJc3N1ZXIpIHtcbiAgICAgIHJldHVybiBhbGxlZ2VkSXNzdWVyID09PSBpc3N1ZXI7XG4gICAgfSxcbiAgICBnZXRBbGxlZ2VkTmFtZSgpIHtcbiAgICAgIHJldHVybiBuYW1lO1xuICAgIH0sXG4gICAgLy9cbiAgICBnZXREaXNwbGF5SW5mbygpIHtcbiAgICAgIHJldHVybiBkaXNwbGF5SW5mbztcbiAgICB9LFxuICAgIGdldEFtb3VudFNoYXBlKCkge1xuICAgICAgcmV0dXJuIGFtb3VudFNoYXBlO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IGFtb3VudFNoYXBlID0gYW1vdW50U2hhcGVGcm9tRWxlbWVudFNoYXBlKFxuICAgIGJyYW5kLFxuICAgIGFzc2V0S2luZCxcbiAgICBlbGVtZW50U2hhcGVcbiAgKTtcbiAgY29uc3QgeyBJc3N1ZXJJLCBNaW50SSwgUGF5bWVudEksIFB1cnNlSUtpdCB9ID0gbWFrZUlzc3VlckludGVyZmFjZXMoXG4gICAgYnJhbmQsXG4gICAgYXNzZXRLaW5kLFxuICAgIGFtb3VudFNoYXBlXG4gICk7XG4gIGNvbnN0IG1ha2VQYXltZW50ID0gcHJlcGFyZVBheW1lbnRLaW5kKGlzc3VlclpvbmUsIG5hbWUsIGJyYW5kLCBQYXltZW50SSk7XG4gIGNvbnN0IHNodXRkb3duTGVkZ2VyV2l0aEZhaWx1cmUgPSAocmVhc29uKSA9PiB7XG4gICAgaWYgKG9wdFNodXRkb3duV2l0aEZhaWx1cmUgIT09IHZvaWQgMCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgb3B0U2h1dGRvd25XaXRoRmFpbHVyZShyZWFzb24pO1xuICAgICAgfSBjYXRjaCAoZXJySW5TaHV0ZG93bikge1xuICAgICAgICBub3RlKGVyckluU2h1dGRvd24sIHJlZGFjdGVkYENhdXNlZCBieTogJHtyZWFzb259YCk7XG4gICAgICAgIHRocm93IGVyckluU2h1dGRvd247XG4gICAgICB9XG4gICAgfVxuICAgIHRocm93IHJlYXNvbjtcbiAgfTtcbiAgY29uc3QgcGF5bWVudExlZGdlciA9IGlzc3VlclpvbmUud2Vha01hcFN0b3JlKFwicGF5bWVudExlZGdlclwiLCB7XG4gICAgdmFsdWVTaGFwZTogYW1vdW50U2hhcGVcbiAgfSk7XG4gIGNvbnN0IHBheW1lbnRSZWNvdmVyeVNldHMgPSBpc3N1ZXJab25lLndlYWtNYXBTdG9yZShcInBheW1lbnRSZWNvdmVyeVNldHNcIik7XG4gIGNvbnN0IGluaXRQYXltZW50ID0gKHBheW1lbnQsIGFtb3VudCwgb3B0UmVjb3ZlcnlTZXQgPSB2b2lkIDApID0+IHtcbiAgICBpZiAocmVjb3ZlcnlTZXRzU3RhdGUgPT09IFwibm9SZWNvdmVyeVNldHNcIikge1xuICAgICAgb3B0UmVjb3ZlcnlTZXQgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYHdoZW4gcmVjb3ZlclNldHNTdGF0ZSA9PT0gJ25vUmVjb3ZlcnlTZXRzJywgb3B0UmVjb3ZlcnlTZXQgbXVzdCBiZSBlbXB0eWA7XG4gICAgfVxuICAgIGlmIChvcHRSZWNvdmVyeVNldCAhPT0gdm9pZCAwICYmICFBbW91bnRNYXRoLmlzRW1wdHkoYW1vdW50KSkge1xuICAgICAgb3B0UmVjb3ZlcnlTZXQuYWRkKHBheW1lbnQpO1xuICAgICAgcGF5bWVudFJlY292ZXJ5U2V0cy5pbml0KHBheW1lbnQsIG9wdFJlY292ZXJ5U2V0KTtcbiAgICB9XG4gICAgcGF5bWVudExlZGdlci5pbml0KHBheW1lbnQsIGFtb3VudCk7XG4gIH07XG4gIGNvbnN0IGRlbGV0ZVBheW1lbnQgPSAocGF5bWVudCkgPT4ge1xuICAgIHBheW1lbnRMZWRnZXIuZGVsZXRlKHBheW1lbnQpO1xuICAgIGlmIChwYXltZW50UmVjb3ZlcnlTZXRzLmhhcyhwYXltZW50KSkge1xuICAgICAgY29uc3QgcmVjb3ZlcnlTZXQgPSBwYXltZW50UmVjb3ZlcnlTZXRzLmdldChwYXltZW50KTtcbiAgICAgIHBheW1lbnRSZWNvdmVyeVNldHMuZGVsZXRlKHBheW1lbnQpO1xuICAgICAgcmVjb3ZlcnlTZXQuZGVsZXRlKHBheW1lbnQpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgY29lcmNlID0gKGFsbGVnZWRBbW91bnQpID0+IEFtb3VudE1hdGguY29lcmNlKGJyYW5kLCBhbGxlZ2VkQW1vdW50KTtcbiAgY29uc3QgYXNzZXJ0QW1vdW50Q29uc2lzdGVudCA9IChwYXltZW50QmFsYW5jZSwgb3B0QW1vdW50U2hhcGUpID0+IHtcbiAgICBpZiAob3B0QW1vdW50U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKHBheW1lbnRCYWxhbmNlLCBvcHRBbW91bnRTaGFwZSwgXCJhbW91bnRcIik7XG4gICAgfVxuICB9O1xuICBjb25zdCBhc3NlcnRMaXZlUGF5bWVudCA9IChwYXltZW50KSA9PiB7XG4gICAgcGF5bWVudExlZGdlci5oYXMocGF5bWVudCkgfHwgdGhyb3dSZWRhY3RlZGAke3BheW1lbnR9IHdhcyBub3QgYSBsaXZlIHBheW1lbnQgZm9yIGJyYW5kICR7cXVvdGUoXG4gICAgICBicmFuZFxuICAgICl9LiBJdCBjb3VsZCBiZSBhIHVzZWQtdXAgcGF5bWVudCwgYSBwYXltZW50IGZvciBhbm90aGVyIGJyYW5kLCBvciBpdCBtaWdodCBub3QgYmUgYSBwYXltZW50IGF0IGFsbC5gO1xuICB9O1xuICBjb25zdCBkZXBvc2l0SW50ZXJuYWwgPSAoYmFsYW5jZVN0b3JlLCBzcmNQYXltZW50LCBvcHRBbW91bnRTaGFwZSA9IHZvaWQgMCkgPT4ge1xuICAgICFpc1Byb21pc2Uoc3JjUGF5bWVudCkgfHwgYXNzZXJ0LmZhaWwoXG4gICAgICBgZGVwb3NpdCBkb2VzIG5vdCBhY2NlcHQgcHJvbWlzZXMgYXMgZmlyc3QgYXJndW1lbnQuIEluc3RlYWQgb2YgcGFzc2luZyB0aGUgcHJvbWlzZSAoZGVwb3NpdChwYXltZW50UHJvbWlzZSkpLCBjb25zaWRlciB1bndyYXBwaW5nIHRoZSBwcm9taXNlIGZpcnN0OiBFLndoZW4ocGF5bWVudFByb21pc2UsIChhY3R1YWxQYXltZW50ID0+IGRlcG9zaXQoYWN0dWFsUGF5bWVudCkpYCxcbiAgICAgIFR5cGVFcnJvclxuICAgICk7XG4gICAgYXNzZXJ0TGl2ZVBheW1lbnQoc3JjUGF5bWVudCk7XG4gICAgY29uc3Qgc3JjUGF5bWVudEJhbGFuY2UgPSBwYXltZW50TGVkZ2VyLmdldChzcmNQYXltZW50KTtcbiAgICBhc3NlcnRBbW91bnRDb25zaXN0ZW50KHNyY1BheW1lbnRCYWxhbmNlLCBvcHRBbW91bnRTaGFwZSk7XG4gICAgdHJ5IHtcbiAgICAgIGRlbGV0ZVBheW1lbnQoc3JjUGF5bWVudCk7XG4gICAgICBiYWxhbmNlU3RvcmUuaW5jcmVtZW50KHNyY1BheW1lbnRCYWxhbmNlKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHNodXRkb3duTGVkZ2VyV2l0aEZhaWx1cmUoZXJyKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgcmV0dXJuIHNyY1BheW1lbnRCYWxhbmNlO1xuICB9O1xuICBjb25zdCB3aXRoZHJhd0ludGVybmFsID0gKGJhbGFuY2VTdG9yZSwgYW1vdW50LCByZWNvdmVyeVNldCA9IHZvaWQgMCkgPT4ge1xuICAgIGFtb3VudCA9IGNvZXJjZShhbW91bnQpO1xuICAgIGNvbnN0IHBheW1lbnQgPSBtYWtlUGF5bWVudCgpO1xuICAgIGJhbGFuY2VTdG9yZS5kZWNyZW1lbnQoYW1vdW50KSB8fCB0aHJvd1JlZGFjdGVkYFdpdGhkcmF3YWwgb2YgJHthbW91bnR9IGZhaWxlZCBiZWNhdXNlIHRoZSBwdXJzZSBvbmx5IGNvbnRhaW5lZCAke2JhbGFuY2VTdG9yZS5nZXRBbW91bnQoKX1gO1xuICAgIHRyeSB7XG4gICAgICBpbml0UGF5bWVudChwYXltZW50LCBhbW91bnQsIHJlY292ZXJ5U2V0KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHNodXRkb3duTGVkZ2VyV2l0aEZhaWx1cmUoZXJyKTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgcmV0dXJuIHBheW1lbnQ7XG4gIH07XG4gIGNvbnN0IG1ha2VFbXB0eVB1cnNlID0gcHJlcGFyZVB1cnNlS2luZChcbiAgICBpc3N1ZXJab25lLFxuICAgIG5hbWUsXG4gICAgYXNzZXRLaW5kLFxuICAgIGJyYW5kLFxuICAgIFB1cnNlSUtpdCxcbiAgICBoYXJkZW4oe1xuICAgICAgZGVwb3NpdEludGVybmFsLFxuICAgICAgd2l0aGRyYXdJbnRlcm5hbFxuICAgIH0pLFxuICAgIHJlY292ZXJ5U2V0c1N0YXRlLFxuICAgIHBheW1lbnRSZWNvdmVyeVNldHNcbiAgKTtcbiAgY29uc3QgaXNzdWVyID0gaXNzdWVyWm9uZS5leG8oYCR7bmFtZX0gaXNzdWVyYCwgSXNzdWVySSwge1xuICAgIGdldEJyYW5kKCkge1xuICAgICAgcmV0dXJuIGJyYW5kO1xuICAgIH0sXG4gICAgZ2V0QWxsZWdlZE5hbWUoKSB7XG4gICAgICByZXR1cm4gbmFtZTtcbiAgICB9LFxuICAgIGdldEFzc2V0S2luZCgpIHtcbiAgICAgIHJldHVybiBhc3NldEtpbmQ7XG4gICAgfSxcbiAgICBnZXREaXNwbGF5SW5mbygpIHtcbiAgICAgIHJldHVybiBkaXNwbGF5SW5mbztcbiAgICB9LFxuICAgIG1ha2VFbXB0eVB1cnNlKCkge1xuICAgICAgcmV0dXJuIG1ha2VFbXB0eVB1cnNlKCk7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBpc0xpdmUocGF5bWVudCkge1xuICAgICAgcmV0dXJuIHBheW1lbnRMZWRnZXIuaGFzKHBheW1lbnQpO1xuICAgIH0sXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgZ2V0QW1vdW50T2YocGF5bWVudCkge1xuICAgICAgYXNzZXJ0TGl2ZVBheW1lbnQocGF5bWVudCk7XG4gICAgICByZXR1cm4gcGF5bWVudExlZGdlci5nZXQocGF5bWVudCk7XG4gICAgfSxcbiAgICAvKlxuXG5cbiAgICAgKi9cbiAgICBidXJuKHBheW1lbnQsIG9wdEFtb3VudFNoYXBlID0gdm9pZCAwKSB7XG4gICAgICBhc3NlcnRMaXZlUGF5bWVudChwYXltZW50KTtcbiAgICAgIGNvbnN0IHBheW1lbnRCYWxhbmNlID0gcGF5bWVudExlZGdlci5nZXQocGF5bWVudCk7XG4gICAgICBhc3NlcnRBbW91bnRDb25zaXN0ZW50KHBheW1lbnRCYWxhbmNlLCBvcHRBbW91bnRTaGFwZSk7XG4gICAgICB0cnkge1xuICAgICAgICBkZWxldGVQYXltZW50KHBheW1lbnQpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHNodXRkb3duTGVkZ2VyV2l0aEZhaWx1cmUoZXJyKTtcbiAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHBheW1lbnRCYWxhbmNlO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IG1pbnRSZWNvdmVyeVB1cnNlID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgaXNzdWVyWm9uZS5tYWtlT25jZShcIm1pbnRSZWNvdmVyeVB1cnNlXCIsICgpID0+IG1ha2VFbXB0eVB1cnNlKCkpXG4gICk7XG4gIGNvbnN0IG1pbnQgPSBpc3N1ZXJab25lLmV4byhgJHtuYW1lfSBtaW50YCwgTWludEksIHtcbiAgICBnZXRJc3N1ZXIoKSB7XG4gICAgICByZXR1cm4gaXNzdWVyO1xuICAgIH0sXG4gICAgbWludFBheW1lbnQobmV3QW1vdW50KSB7XG4gICAgICBuZXdBbW91bnQgPSBjb2VyY2UobmV3QW1vdW50KTtcbiAgICAgIG11c3RNYXRjaChuZXdBbW91bnQsIGFtb3VudFNoYXBlLCBcIm1pbnRlZCBhbW91bnRcIik7XG4gICAgICBjb25zdCByYXdQYXltZW50ID0gbWFrZVBheW1lbnQoKTtcbiAgICAgIGluaXRQYXltZW50KHJhd1BheW1lbnQsIG5ld0Ftb3VudCwgdm9pZCAwKTtcbiAgICAgIGNvbnN0IG1pbnRSZWNvdmVyeVB1cnNlQmVmb3JlID0gbWludFJlY292ZXJ5UHVyc2UuZ2V0Q3VycmVudEFtb3VudCgpO1xuICAgICAgbWludFJlY292ZXJ5UHVyc2UuZGVwb3NpdChyYXdQYXltZW50LCBuZXdBbW91bnQpO1xuICAgICAgY29uc3QgcGF5bWVudCA9IG1pbnRSZWNvdmVyeVB1cnNlLndpdGhkcmF3KG5ld0Ftb3VudCk7XG4gICAgICBjb25zdCBtaW50UmVjb3ZlcnlQdXJzZUFmdGVyID0gbWludFJlY292ZXJ5UHVyc2UuZ2V0Q3VycmVudEFtb3VudCgpO1xuICAgICAgYXNzZXJ0KGtleUVRKG1pbnRSZWNvdmVyeVB1cnNlQmVmb3JlLCBtaW50UmVjb3ZlcnlQdXJzZUFmdGVyKSk7XG4gICAgICByZXR1cm4gcGF5bWVudDtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBpc3N1ZXJLaXQgPSBoYXJkZW4oeyBpc3N1ZXIsIG1pbnQsIGJyYW5kLCBtaW50UmVjb3ZlcnlQdXJzZSB9KTtcbiAgcmV0dXJuIGlzc3VlcktpdDtcbn07XG5oYXJkZW4ocHJlcGFyZVBheW1lbnRMZWRnZXIpO1xuXG4vL1xudmFyIHNldHVwSXNzdWVyS2l0ID0gKHsgbmFtZSwgYXNzZXRLaW5kLCBkaXNwbGF5SW5mbywgZWxlbWVudFNoYXBlIH0sIGlzc3VlclpvbmUsIHJlY292ZXJ5U2V0c1N0YXRlLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwKSA9PiB7XG4gIGFzc2VydDIudHlwZW9mKG5hbWUsIFwic3RyaW5nXCIpO1xuICBhc3NlcnRBc3NldEtpbmQoYXNzZXRLaW5kKTtcbiAgY29uc3QgY2xlYW5EaXNwbGF5SW5mbyA9IGNvZXJjZURpc3BsYXlJbmZvKGRpc3BsYXlJbmZvLCBhc3NldEtpbmQpO1xuICBpZiAob3B0U2h1dGRvd25XaXRoRmFpbHVyZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0Mi50eXBlb2Yob3B0U2h1dGRvd25XaXRoRmFpbHVyZSwgXCJmdW5jdGlvblwiKTtcbiAgfVxuICBpZiAoZWxlbWVudFNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGVsZW1lbnRTaGFwZSk7XG4gIH1cbiAgY29uc3QgeyBpc3N1ZXIsIG1pbnQsIGJyYW5kLCBtaW50UmVjb3ZlcnlQdXJzZSB9ID0gcHJlcGFyZVBheW1lbnRMZWRnZXIoXG4gICAgaXNzdWVyWm9uZSxcbiAgICBuYW1lLFxuICAgIGFzc2V0S2luZCxcbiAgICBjbGVhbkRpc3BsYXlJbmZvLFxuICAgIGVsZW1lbnRTaGFwZSxcbiAgICByZWNvdmVyeVNldHNTdGF0ZSxcbiAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlXG4gICk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGJyYW5kLFxuICAgIGlzc3VlcixcbiAgICBtaW50LFxuICAgIG1pbnRSZWNvdmVyeVB1cnNlLFxuICAgIGRpc3BsYXlJbmZvOiBjbGVhbkRpc3BsYXlJbmZvXG4gIH0pO1xufTtcbmhhcmRlbihzZXR1cElzc3VlcktpdCk7XG52YXIgSU5TVEFOQ0VfS0VZID0gXCJpc3N1ZXJcIjtcbnZhciBSRUNPVkVSWV9TRVRTX1NUQVRFID0gXCJyZWNvdmVyeVNldHNTdGF0ZVwiO1xudmFyIHVwZ3JhZGVJc3N1ZXJLaXQgPSAoaXNzdWVyQmFnZ2FnZSwgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSA9IHZvaWQgMCwgcmVjb3ZlcnlTZXRzT3B0aW9uID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IGlzc3VlclJlY29yZCA9IGlzc3VlckJhZ2dhZ2UuZ2V0KElOU1RBTkNFX0tFWSk7XG4gIGNvbnN0IGlzc3VlclpvbmUgPSBtYWtlRHVyYWJsZVpvbmUoaXNzdWVyQmFnZ2FnZSk7XG4gIGNvbnN0IG9sZFJlY292ZXJ5U2V0c1N0YXRlID0gaXNzdWVyQmFnZ2FnZS5oYXMoUkVDT1ZFUllfU0VUU19TVEFURSkgPyBpc3N1ZXJCYWdnYWdlLmdldChSRUNPVkVSWV9TRVRTX1NUQVRFKSA6IFwiaGFzUmVjb3ZlcnlTZXRzXCI7XG4gIGlmIChvbGRSZWNvdmVyeVNldHNTdGF0ZSA9PT0gXCJub1JlY292ZXJ5U2V0c1wiICYmIHJlY292ZXJ5U2V0c09wdGlvbiA9PT0gXCJoYXNSZWNvdmVyeVNldHNcIikge1xuICAgIHRocm93UmVkYWN0ZWRgQ2Fubm90ICh5ZXQ/KSB1cGdyYWRlIGZyb20gJ25vUmVjb3ZlcnlTZXRzJyB0byAnaGFzUmVjb3ZlcnlTZXRzJ2A7XG4gIH1cbiAgY29uc3QgcmVjb3ZlcnlTZXRzU3RhdGUgPSByZWNvdmVyeVNldHNPcHRpb24gfHwgb2xkUmVjb3ZlcnlTZXRzU3RhdGU7XG4gIHJldHVybiBzZXR1cElzc3VlcktpdChcbiAgICBpc3N1ZXJSZWNvcmQsXG4gICAgaXNzdWVyWm9uZSxcbiAgICByZWNvdmVyeVNldHNTdGF0ZSxcbiAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlXG4gICk7XG59O1xuaGFyZGVuKHVwZ3JhZGVJc3N1ZXJLaXQpO1xudmFyIGhhc0lzc3VlciA9IChiYWdnYWdlKSA9PiBiYWdnYWdlLmhhcyhJTlNUQU5DRV9LRVkpO1xudmFyIG1ha2VEdXJhYmxlSXNzdWVyS2l0ID0gKGlzc3VlckJhZ2dhZ2UsIG5hbWUsIGFzc2V0S2luZCA9IEFzc2V0S2luZC5OQVQsIGRpc3BsYXlJbmZvID0gaGFyZGVuKHt9KSwgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSA9IHZvaWQgMCwgeyBlbGVtZW50U2hhcGUgPSB2b2lkIDAsIHJlY292ZXJ5U2V0c09wdGlvbiA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QgaXNzdWVyRGF0YSA9IGhhcmRlbih7XG4gICAgbmFtZSxcbiAgICBhc3NldEtpbmQsXG4gICAgZGlzcGxheUluZm8sXG4gICAgZWxlbWVudFNoYXBlXG4gIH0pO1xuICBpc3N1ZXJCYWdnYWdlLmluaXQoSU5TVEFOQ0VfS0VZLCBpc3N1ZXJEYXRhKTtcbiAgY29uc3QgaXNzdWVyWm9uZSA9IG1ha2VEdXJhYmxlWm9uZShpc3N1ZXJCYWdnYWdlKTtcbiAgY29uc3QgcmVjb3ZlcnlTZXRzU3RhdGUgPSByZWNvdmVyeVNldHNPcHRpb24gfHwgXCJoYXNSZWNvdmVyeVNldHNcIjtcbiAgaXNzdWVyQmFnZ2FnZS5pbml0KFJFQ09WRVJZX1NFVFNfU1RBVEUsIHJlY292ZXJ5U2V0c1N0YXRlKTtcbiAgcmV0dXJuIHNldHVwSXNzdWVyS2l0KFxuICAgIGlzc3VlckRhdGEsXG4gICAgaXNzdWVyWm9uZSxcbiAgICByZWNvdmVyeVNldHNTdGF0ZSxcbiAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlXG4gICk7XG59O1xuaGFyZGVuKG1ha2VEdXJhYmxlSXNzdWVyS2l0KTtcbnZhciBwcmVwYXJlSXNzdWVyS2l0ID0gKGlzc3VlckJhZ2dhZ2UsIG5hbWUsIGFzc2V0S2luZCA9IEFzc2V0S2luZC5OQVQsIGRpc3BsYXlJbmZvID0gaGFyZGVuKHt9KSwgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSA9IHZvaWQgMCwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGlmIChoYXNJc3N1ZXIoaXNzdWVyQmFnZ2FnZSkpIHtcbiAgICBjb25zdCB7IGVsZW1lbnRTaGFwZTogXyA9IHZvaWQgMCwgcmVjb3ZlcnlTZXRzT3B0aW9uID0gdm9pZCAwIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IGlzc3VlcktpdCA9IHVwZ3JhZGVJc3N1ZXJLaXQoXG4gICAgICBpc3N1ZXJCYWdnYWdlLFxuICAgICAgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSxcbiAgICAgIHJlY292ZXJ5U2V0c09wdGlvblxuICAgICk7XG4gICAgcmV0dXJuIGlzc3VlcktpdDtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBpc3N1ZXJLaXQgPSBtYWtlRHVyYWJsZUlzc3VlcktpdChcbiAgICAgIGlzc3VlckJhZ2dhZ2UsXG4gICAgICBuYW1lLFxuICAgICAgYXNzZXRLaW5kLFxuICAgICAgZGlzcGxheUluZm8sXG4gICAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gICAgcmV0dXJuIGlzc3VlcktpdDtcbiAgfVxufTtcbmhhcmRlbihwcmVwYXJlSXNzdWVyS2l0KTtcbnZhciBtYWtlSXNzdWVyS2l0ID0gKG5hbWUsIGFzc2V0S2luZCA9IEFzc2V0S2luZC5OQVQsIGRpc3BsYXlJbmZvID0gaGFyZGVuKHt9KSwgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSA9IHZvaWQgMCwgeyBlbGVtZW50U2hhcGUgPSB2b2lkIDAsIHJlY292ZXJ5U2V0c09wdGlvbiA9IHZvaWQgMCB9ID0ge30pID0+IChcbiAgLy9cbiAgbWFrZUR1cmFibGVJc3N1ZXJLaXQoXG4gICAgbWFrZVNjYWxhckJpZ01hcFN0b3JlKFwiZHJvcHBlZCBpc3N1ZXIga2l0XCIsIHsgZHVyYWJsZTogdHJ1ZSB9KSxcbiAgICBuYW1lLFxuICAgIGFzc2V0S2luZCxcbiAgICBkaXNwbGF5SW5mbyxcbiAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlLFxuICAgIHsgZWxlbWVudFNoYXBlLCByZWNvdmVyeVNldHNPcHRpb24gfVxuICApXG4pO1xuaGFyZGVuKG1ha2VJc3N1ZXJLaXQpO1xuXG4vL1xudmFyIHBhZGRpbmcgPSBcIj1cIjtcbnZhciBhbHBoYWJldDY0ID0gXCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvXCI7XG52YXIgbW9ub2R1NjQgPSB7fTtcbmZvciAobGV0IGkyID0gMDsgaTIgPCBhbHBoYWJldDY0Lmxlbmd0aDsgaTIgKz0gMSkge1xuICBjb25zdCBjMiA9IGFscGhhYmV0NjRbaTJdO1xuICBtb25vZHU2NFtjMl0gPSBpMjtcbn1cblxuLy9cbnZhciBqc0VuY29kZUJhc2U2NCA9IChkYXRhKSA9PiB7XG4gIGxldCBzdHJpbmcgPSBcIlwiO1xuICBsZXQgcmVnaXN0ZXIgPSAwO1xuICBsZXQgcXVhbnR1bSA9IDA7XG4gIGZvciAobGV0IGkyID0gMDsgaTIgPCBkYXRhLmxlbmd0aDsgaTIgKz0gMSkge1xuICAgIGNvbnN0IGIzID0gZGF0YVtpMl07XG4gICAgcmVnaXN0ZXIgPSByZWdpc3RlciA8PCA4IHwgYjM7XG4gICAgcXVhbnR1bSArPSA4O1xuICAgIGlmIChxdWFudHVtID09PSAyNCkge1xuICAgICAgc3RyaW5nICs9IGFscGhhYmV0NjRbcmVnaXN0ZXIgPj4+IDE4ICYgNjNdICsgYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gMTIgJiA2M10gKyBhbHBoYWJldDY0W3JlZ2lzdGVyID4+PiA2ICYgNjNdICsgYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gMCAmIDYzXTtcbiAgICAgIHJlZ2lzdGVyID0gMDtcbiAgICAgIHF1YW50dW0gPSAwO1xuICAgIH1cbiAgfVxuICBzd2l0Y2ggKHF1YW50dW0pIHtcbiAgICBjYXNlIDA6XG4gICAgICBicmVhaztcbiAgICBjYXNlIDg6XG4gICAgICBzdHJpbmcgKz0gYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gMiAmIDYzXSArIGFscGhhYmV0NjRbcmVnaXN0ZXIgPDwgNCAmIDYzXSArIHBhZGRpbmcgKyBwYWRkaW5nO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAxNjpcbiAgICAgIHN0cmluZyArPSBhbHBoYWJldDY0W3JlZ2lzdGVyID4+PiAxMCAmIDYzXSArIGFscGhhYmV0NjRbcmVnaXN0ZXIgPj4+IDQgJiA2M10gKyBhbHBoYWJldDY0W3JlZ2lzdGVyIDw8IDIgJiA2M10gKyBwYWRkaW5nO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IEVycm9yKGBpbnRlcm5hbDogYmFkIHF1YW50dW0gJHtxdWFudHVtfWApO1xuICB9XG4gIHJldHVybiBzdHJpbmc7XG59O1xudmFyIGVuY29kZUJhc2U2NCA9IGdsb2JhbFRoaXMuQmFzZTY0ICE9PSB2b2lkIDAgPyBnbG9iYWxUaGlzLkJhc2U2NC5lbmNvZGUgOiBqc0VuY29kZUJhc2U2NDtcblxuLy9cbnZhciBqc0RlY29kZUJhc2U2NCA9IChzdHJpbmcsIG5hbWUgPSBcIjx1bmtub3duPlwiKSA9PiB7XG4gIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShNYXRoLmNlaWwoc3RyaW5nLmxlbmd0aCAqIDQgLyAzKSk7XG4gIGxldCByZWdpc3RlciA9IDA7XG4gIGxldCBxdWFudHVtID0gMDtcbiAgbGV0IGkyID0gMDtcbiAgbGV0IGogPSAwO1xuICB3aGlsZSAoaTIgPCBzdHJpbmcubGVuZ3RoICYmIHN0cmluZ1tpMl0gIT09IHBhZGRpbmcpIHtcbiAgICBjb25zdCBudW1iZXIgPSBtb25vZHU2NFtzdHJpbmdbaTJdXTtcbiAgICBpZiAobnVtYmVyID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IEVycm9yKGBJbnZhbGlkIGJhc2U2NCBjaGFyYWN0ZXIgJHtzdHJpbmdbaTJdfSBpbiBzdHJpbmcgJHtuYW1lfWApO1xuICAgIH1cbiAgICByZWdpc3RlciA9IHJlZ2lzdGVyIDw8IDYgfCBudW1iZXI7XG4gICAgcXVhbnR1bSArPSA2O1xuICAgIGlmIChxdWFudHVtID49IDgpIHtcbiAgICAgIHF1YW50dW0gLT0gODtcbiAgICAgIGRhdGFbal0gPSByZWdpc3RlciA+Pj4gcXVhbnR1bTtcbiAgICAgIGogKz0gMTtcbiAgICAgIHJlZ2lzdGVyICY9ICgxIDw8IHF1YW50dW0pIC0gMTtcbiAgICB9XG4gICAgaTIgKz0gMTtcbiAgfVxuICB3aGlsZSAocXVhbnR1bSA+IDApIHtcbiAgICBpZiAoaTIgPT09IHN0cmluZy5sZW5ndGggfHwgc3RyaW5nW2kyXSAhPT0gcGFkZGluZykge1xuICAgICAgdGhyb3cgRXJyb3IoYE1pc3NpbmcgcGFkZGluZyBhdCBvZmZzZXQgJHtpMn0gb2Ygc3RyaW5nICR7bmFtZX1gKTtcbiAgICB9XG4gICAgaTIgKz0gMTtcbiAgICBxdWFudHVtIC09IDI7XG4gIH1cbiAgaWYgKGkyIDwgc3RyaW5nLmxlbmd0aCkge1xuICAgIHRocm93IEVycm9yKFxuICAgICAgYEJhc2U2NCBzdHJpbmcgaGFzIHRyYWlsaW5nIGdhcmJhZ2UgJHtzdHJpbmcuc3Vic3RyKFxuICAgICAgICBpMlxuICAgICAgKX0gaW4gc3RyaW5nICR7bmFtZX1gXG4gICAgKTtcbiAgfVxuICByZXR1cm4gZGF0YS5zdWJhcnJheSgwLCBqKTtcbn07XG52YXIgYWRhcHREZWNvZGVyID0gKG5hdGl2ZURlY29kZUJhc2U2NCkgPT4gKC4uLmFyZ3MpID0+IHtcbiAgY29uc3QgZGVjb2RlZCA9IG5hdGl2ZURlY29kZUJhc2U2NCguLi5hcmdzKTtcbiAgaWYgKGRlY29kZWQgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG4gICAgcmV0dXJuIGRlY29kZWQ7XG4gIH1cbiAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGRlY29kZWQpO1xufTtcbnZhciBkZWNvZGVCYXNlNjQgPSBnbG9iYWxUaGlzLkJhc2U2NCAhPT0gdm9pZCAwID8gYWRhcHREZWNvZGVyKGdsb2JhbFRoaXMuQmFzZTY0LmRlY29kZSkgOiBqc0RlY29kZUJhc2U2NDtcblxuLy9cbnZhciBhdG9iMiA9IChlbmNvZGVkRGF0YSkgPT4ge1xuICBjb25zdCBidWYgPSBkZWNvZGVCYXNlNjQoZW5jb2RlZERhdGEpO1xuICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSguLi5idWYpO1xufTtcblxuLy9cbnZhciBjb2VyY2VUb0J5dGVBcnJheSA9IChjb250ZW50cykgPT4ge1xuICBpZiAodHlwZW9mIGNvbnRlbnRzID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIFVpbnQ4QXJyYXkuZnJvbShjb250ZW50cywgKGMyKSA9PiB7XG4gICAgICBjb25zdCBiMyA9IGMyLmNoYXJDb2RlQXQoMCk7XG4gICAgICBiMyA8PSAyNTUgfHwgdGhyb3dSZWRhY3RlZGBjaGFyYWN0ZXIgY2Fubm90IGJlIGNvZXJjZWQgdG8gYW4gb2N0ZXQ6ICR7YzJ9YDtcbiAgICAgIHJldHVybiBiMztcbiAgICB9KTtcbiAgfSBlbHNlIGlmIChjb250ZW50cyBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHtcbiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoXG4gICAgICBjb250ZW50cy5idWZmZXIsXG4gICAgICBjb250ZW50cy5ieXRlT2Zmc2V0LFxuICAgICAgY29udGVudHMuYnl0ZUxlbmd0aFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGNvbnRlbnRzKTtcbn07XG5mdW5jdGlvbiB0b0J5dGVzKGJ5dGVTb3VyY2UpIHtcbiAgY29uc3QgYnVmID0gY29lcmNlVG9CeXRlQXJyYXkoYnl0ZVNvdXJjZSk7XG4gIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLmJ1Zik7XG59XG5mdW5jdGlvbiBiYXNlNjRUb0J5dGVzKHN0cmluZykge1xuICByZXR1cm4gdG9CeXRlcyhkZWNvZGVCYXNlNjQoc3RyaW5nKSk7XG59XG5cbi8vXG52YXIgU2hhcGUxID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgLypcblxuXG4gICAgICovXG4gICAgRGF0YTogTS5zdHJpbmcoKSxcbiAgICBCeXRlczogTS5zdHJpbmcoKSxcbiAgICBFbmRwb2ludDogTS5zdHJpbmcoKSxcbiAgICBWb3c6IE0udGFnZ2VkKFxuICAgICAgXCJWb3dcIixcbiAgICAgIGhhcmRlbih7XG4gICAgICAgIHZvd1YwOiBNLnJlbW90YWJsZShcIlZvd1YwXCIpXG4gICAgICB9KVxuICAgICksXG4gICAgQ29ubmVjdGlvbkhhbmRsZXI6IE0ucmVtb3RhYmxlKFwiQ29ubmVjdGlvbkhhbmRsZXJcIiksXG4gICAgQ29ubmVjdGlvbjogTS5yZW1vdGFibGUoXCJDb25uZWN0aW9uXCIpLFxuICAgIEluYm91bmRBdHRlbXB0OiBNLnJlbW90YWJsZShcIkluYm91bmRBdHRlbXB0XCIpLFxuICAgIExpc3RlbmVyOiBNLnJlbW90YWJsZShcIkxpc3RlbmVyXCIpLFxuICAgIExpc3RlbkhhbmRsZXI6IE0ucmVtb3RhYmxlKFwiTGlzdGVuSGFuZGxlclwiKSxcbiAgICBQb3J0OiBNLnJlbW90YWJsZShcIlBvcnRcIiksXG4gICAgUHJvdG9jb2xIYW5kbGVyOiBNLnJlbW90YWJsZShcIlByb3RvY29sSGFuZGxlclwiKSxcbiAgICBQcm90b2NvbEltcGw6IE0ucmVtb3RhYmxlKFwiUHJvdG9jb2xJbXBsXCIpXG4gIH1cbik7XG52YXIgU2VuZE9wdGlvbnNTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHt9LFxuICB7IHJlbGF0aXZlVGltZW91dE5zOiBNLmJpZ2ludCgpIH1cbik7XG52YXIgU2hhcGUyID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgLi4uU2hhcGUxLFxuICAgIFZvdyQ6IChzaGFwZSkgPT4gTS5vcihzaGFwZSwgU2hhcGUxLlZvdyksXG4gICAgQXR0ZW1wdERlc2NyaXB0aW9uOiBNLnNwbGl0UmVjb3JkKFxuICAgICAgeyBoYW5kbGVyOiBTaGFwZTEuQ29ubmVjdGlvbkhhbmRsZXIgfSxcbiAgICAgIHsgcmVtb3RlQWRkcmVzczogU2hhcGUxLkVuZHBvaW50LCBsb2NhbEFkZHJlc3M6IFNoYXBlMS5FbmRwb2ludCB9XG4gICAgKSxcbiAgICBPcHRzOiBTZW5kT3B0aW9uc1NoYXBlXG4gIH1cbik7XG52YXIgU2hhcGUgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIGhhcmRlbih7XG4gICAgLi4uU2hhcGUyLFxuICAgIENvbm5lY3Rpb25JOiB7XG4gICAgICBjb25uZWN0aW9uOiBNLmludGVyZmFjZShcIkNvbm5lY3Rpb25cIiwge1xuICAgICAgICBzZW5kOiBNLmNhbGxXaGVuKFNoYXBlMi5EYXRhKS5vcHRpb25hbChTaGFwZTIuT3B0cykucmV0dXJucyhTaGFwZTIuVm93JChTaGFwZTIuQnl0ZXMpKSxcbiAgICAgICAgY2xvc2U6IE0uY2FsbFdoZW4oKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpKSxcbiAgICAgICAgZ2V0TG9jYWxBZGRyZXNzOiBNLmNhbGwoKS5yZXR1cm5zKFNoYXBlMi5FbmRwb2ludCksXG4gICAgICAgIGdldFJlbW90ZUFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoU2hhcGUyLkVuZHBvaW50KVxuICAgICAgfSksXG4gICAgICBvcGVuQ29ubmVjdGlvbkFja1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiT3BlbkNvbm5lY3Rpb25BY2tXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyOiBNLmludGVyZmFjZShcIlJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgc2lua1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiU2lua1dhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucygpXG4gICAgICB9KVxuICAgIH0sXG4gICAgSW5ib3VuZEF0dGVtcHRJOiB7XG4gICAgICBpbmJvdW5kQXR0ZW1wdDogTS5pbnRlcmZhY2UoXCJJbmJvdW5kQXR0ZW1wdFwiLCB7XG4gICAgICAgIGFjY2VwdDogTS5jYWxsV2hlbihTaGFwZTIuQXR0ZW1wdERlc2NyaXB0aW9uKS5yZXR1cm5zKFxuICAgICAgICAgIFNoYXBlMi5Wb3ckKFNoYXBlMi5Db25uZWN0aW9uKVxuICAgICAgICApLFxuICAgICAgICBnZXRMb2NhbEFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoU2hhcGUyLkVuZHBvaW50KSxcbiAgICAgICAgZ2V0UmVtb3RlQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhTaGFwZTIuRW5kcG9pbnQpLFxuICAgICAgICBjbG9zZTogTS5jYWxsV2hlbigpLnJldHVybnMoU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSkpXG4gICAgICB9KSxcbiAgICAgIGluYm91bmRBdHRlbXB0QWNjZXB0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJJbmJvdW5kQXR0ZW1wdEFjY2VwdFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICByZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyXCIsIHtcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBzaW5rV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJTaW5rV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKClcbiAgICAgIH0pXG4gICAgfSxcbiAgICBQb3J0SToge1xuICAgICAgcG9ydDogTS5pbnRlcmZhY2UoXCJQb3J0XCIsIHtcbiAgICAgICAgZ2V0TG9jYWxBZGRyZXNzOiBNLmNhbGwoKS5yZXR1cm5zKFNoYXBlMi5FbmRwb2ludCksXG4gICAgICAgIGFkZExpc3RlbmVyOiBNLmNhbGxXaGVuKFNoYXBlMi5MaXN0ZW5lcikucmV0dXJucyhcbiAgICAgICAgICBTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKVxuICAgICAgICApLFxuICAgICAgICBjb25uZWN0OiBNLmNhbGxXaGVuKFNoYXBlMi5FbmRwb2ludCkub3B0aW9uYWwoU2hhcGUyLkNvbm5lY3Rpb25IYW5kbGVyKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKFNoYXBlMi5Db25uZWN0aW9uKSksXG4gICAgICAgIHJlbW92ZUxpc3RlbmVyOiBNLmNhbGxXaGVuKFNoYXBlMi5MaXN0ZW5lcikucmV0dXJucyhcbiAgICAgICAgICBTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKVxuICAgICAgICApLFxuICAgICAgICByZXZva2U6IE0uY2FsbFdoZW4oKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpKVxuICAgICAgfSksXG4gICAgICBwb3J0QWRkTGlzdGVuZXJXYXRjaGVyOiBNLmludGVyZmFjZShcIlBvcnRBZGRMaXN0ZW5lcldhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBwb3J0UmVtb3ZlTGlzdGVuZXJXYXRjaGVyOiBNLmludGVyZmFjZShcIlBvcnRSZW1vdmVMaXN0ZW5lcldhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBwb3J0Q29ubmVjdFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUG9ydENvbm5lY3RXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcG9ydFJldm9rZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUG9ydFJldm9rZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBwb3J0UmV2b2tlQ2xlYW51cFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUG9ydFJldm9rZUNsZWFudXBXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyOiBNLmludGVyZmFjZShcIlJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgc2lua1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiU2lua1dhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucygpLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KVxuICAgIH0sXG4gICAgUHJvdG9jb2xIYW5kbGVySToge1xuICAgICAgcHJvdG9jb2xIYW5kbGVyOiBNLmludGVyZmFjZShcIlByb3RvY29sSGFuZGxlclwiLCB7XG4gICAgICAgIG9uQ3JlYXRlOiBNLmNhbGxXaGVuKE0ucmVtb3RhYmxlKCksIFNoYXBlMi5Qcm90b2NvbEhhbmRsZXIpLnJldHVybnMoXG4gICAgICAgICAgU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSlcbiAgICAgICAgKSxcbiAgICAgICAgZ2VuZXJhdGVQb3J0SUQ6IE0uY2FsbFdoZW4oXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5Qcm90b2NvbEhhbmRsZXJcbiAgICAgICAgKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0uc3RyaW5nKCkpKSxcbiAgICAgICAgb25CaW5kOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSksXG4gICAgICAgIG9uTGlzdGVuOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuTGlzdGVuSGFuZGxlcixcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSksXG4gICAgICAgIG9uTGlzdGVuUmVtb3ZlOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuTGlzdGVuSGFuZGxlcixcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSksXG4gICAgICAgIG9uSW5zdGFudGlhdGU6IE0uY2FsbFdoZW4oXG4gICAgICAgICAgU2hhcGUyLlBvcnQsXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChTaGFwZTIuRW5kcG9pbnQpKSxcbiAgICAgICAgb25Db25uZWN0OiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLkNvbm5lY3Rpb25IYW5kbGVyLFxuICAgICAgICAgIFNoYXBlMi5Qcm90b2NvbEhhbmRsZXJcbiAgICAgICAgKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKFNoYXBlMi5BdHRlbXB0RGVzY3JpcHRpb24pKSxcbiAgICAgICAgb25SZXZva2U6IE0uY2FsbFdoZW4oXG4gICAgICAgICAgU2hhcGUyLlBvcnQsXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5Qcm90b2NvbEhhbmRsZXJcbiAgICAgICAgKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpKVxuICAgICAgfSksXG4gICAgICBwcm90b2NvbEhhbmRsZXJBY2NlcHRXYXRjaGVyOiBNLmludGVyZmFjZShcIlByb3RvY29sSGFuZGxlckFjY2VwdFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBwcm90b2NvbEhhbmRsZXJJbnN0YW50aWF0ZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgICBcIlByb3RvY29sSGFuZGxlckluc3RhbnRpYXRlV2F0Y2hlclwiLFxuICAgICAgICB7XG4gICAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHByb3RvY29sSGFuZGxlckNvbm5lY3RXYXRjaGVyOiBNLmludGVyZmFjZShcbiAgICAgICAgXCJQcm90b2NvbEhhbmRsZXJDb25uZWN0V2F0Y2hlclwiLFxuICAgICAgICB7XG4gICAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJSZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXJcIiwge1xuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KVxuICAgIH0sXG4gICAgUHJvdG9jb2xJbXBsSTogTS5pbnRlcmZhY2UoXCJQcm90b2NvbEltcGxcIiwge1xuICAgICAgYmluZFBvcnQ6IE0uY2FsbFdoZW4oU2hhcGUyLkVuZHBvaW50KS5yZXR1cm5zKFNoYXBlMi5Wb3ckKFNoYXBlMi5Qb3J0KSksXG4gICAgICBpbmJvdW5kOiBNLmNhbGxXaGVuKFNoYXBlMi5FbmRwb2ludCwgU2hhcGUyLkVuZHBvaW50KS5yZXR1cm5zKFxuICAgICAgICBTaGFwZTIuVm93JChTaGFwZTIuSW5ib3VuZEF0dGVtcHQpXG4gICAgICApLFxuICAgICAgb3V0Ym91bmQ6IE0uY2FsbFdoZW4oXG4gICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgIFNoYXBlMi5Db25uZWN0aW9uSGFuZGxlclxuICAgICAgKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKFNoYXBlMi5Db25uZWN0aW9uKSlcbiAgICB9KVxuICB9KVxuKTtcblxuLy9cbnZhciBzaW5rMyA9ICgpID0+IHtcbn07XG5oYXJkZW4oc2luazMpO1xudmFyIENMT1NFX1JFQVNPTl9GSU5BTElaRVIgPSBcImNsb3NlZC1ieS1maW5hbGl6ZXJcIjtcbnZhciBSZXZva2VTdGF0ZSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIE5PVF9SRVZPS0VEOiAwLFxuICAgIFJFVk9LSU5HOiAxLFxuICAgIFJFVk9LRUQ6IDJcbiAgfVxuKTtcbmhhcmRlbihSZXZva2VTdGF0ZSk7XG52YXIgcHJlcGFyZUZpbmFsaXplciA9ICh6b25lLCB7IHdhdGNoIH0pID0+IHtcbiAgY29uc3Qgb2JqVG9GaW5hbGl6ZXJJbmZvID0gem9uZS5tYXBTdG9yZShcIm9ialRvRmluYWxpemVySW5mb1wiKTtcbiAgcmV0dXJuIHpvbmUuZXhvKFwiTmV0d29ya0ZpbmFsaXplclwiLCB2b2lkIDAsIHtcbiAgICBoYXMob2JqKSB7XG4gICAgICByZXR1cm4gb2JqVG9GaW5hbGl6ZXJJbmZvLmhhcyhvYmopO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgIGluaXRDb25uZWN0aW9uKGNvbm4sIGhhbmRsZXIpIHtcbiAgICAgIG9ialRvRmluYWxpemVySW5mby5pbml0KGNvbm4sIGhhcmRlbih7IGNvbm4sIGhhbmRsZXIgfSkpO1xuICAgIH0sXG4gICAgLypcblxuXG5cbiAgICAgKi9cbiAgICBpbml0Q2xvc2VyKGNsb3Nlcikge1xuICAgICAgb2JqVG9GaW5hbGl6ZXJJbmZvLmluaXQoY2xvc2VyLCBoYXJkZW4oeyBjbG9zZXIgfSkpO1xuICAgIH0sXG4gICAgZmluYWxpemUob2JqKSB7XG4gICAgICBpZiAoIW9ialRvRmluYWxpemVySW5mby5oYXMob2JqKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBkaXNwb3NlSW5mbyA9IG9ialRvRmluYWxpemVySW5mby5nZXQob2JqKTtcbiAgICAgIGlmIChcImNvbm5cIiBpbiBkaXNwb3NlSW5mbykge1xuICAgICAgICBjb25zdCB7IGNvbm4sIGhhbmRsZXIgfSA9IGRpc3Bvc2VJbmZvO1xuICAgICAgICBvYmpUb0ZpbmFsaXplckluZm8uZGVsZXRlKG9iaik7XG4gICAgICAgIHJldHVybiB3YXRjaChFKGhhbmRsZXIpLm9uQ2xvc2UoY29ubiwgQ0xPU0VfUkVBU09OX0ZJTkFMSVpFUiwgaGFuZGxlcikpO1xuICAgICAgfSBlbHNlIGlmIChcImNsb3NlclwiIGluIGRpc3Bvc2VJbmZvKSB7XG4gICAgICAgIGNvbnN0IHsgY2xvc2VyIH0gPSBkaXNwb3NlSW5mbztcbiAgICAgICAgb2JqVG9GaW5hbGl6ZXJJbmZvLmRlbGV0ZShvYmopO1xuICAgICAgICByZXR1cm4gd2F0Y2goRShjbG9zZXIpLmNsb3NlKCkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgdW5waW4ob2JqKSB7XG4gICAgICBvYmpUb0ZpbmFsaXplckluZm8uZGVsZXRlKG9iaik7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZUZpbmFsaXplcik7XG5cbi8vXG52YXIgUm91dGVySSA9IE0uaW50ZXJmYWNlKFwiUm91dGVyXCIsIHtcbiAgZ2V0Um91dGVzOiBNLmNhbGwoU2hhcGUuRW5kcG9pbnQpLnJldHVybnMoTS5hcnJheU9mKFtNLnN0cmluZygpLCBNLmFueSgpXSkpLFxuICByZWdpc3RlcjogTS5jYWxsKE0uc3RyaW5nKCksIE0uYW55KCkpLnJldHVybnMoTS51bmRlZmluZWQoKSksXG4gIHVucmVnaXN0ZXI6IE0uY2FsbChNLnN0cmluZygpLCBNLmFueSgpKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpXG59KTtcblxuLy9cbnZhciBzaW5rNCA9ICgpID0+IHtcbn07XG5oYXJkZW4oc2luazQpO1xudmFyIFZvd1NoYXBlID0gTS50YWdnZWQoXG4gIFwiVm93XCIsXG4gIE0uc3BsaXRSZWNvcmQoe1xuICAgIHZvd1YwOiBNLnJlbW90YWJsZShcIlZvd1YwXCIpXG4gIH0pXG4pO1xudmFyIGlzVm93ID0gKHNwZWNpbWVuKSA9PiBpc1Bhc3NhYmxlKHNwZWNpbWVuKSAmJiBtYXRjaGVzKHNwZWNpbWVuLCBWb3dTaGFwZSk7XG5oYXJkZW4oaXNWb3cpO1xudmFyIGdldFZvd1BheWxvYWQgPSAoc3BlY2ltZW4pID0+IHtcbiAgaWYgKCFpc1ZvdyhzcGVjaW1lbikpIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIGNvbnN0IHZvdyA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgc3BlY2ltZW5cbiAgKTtcbiAgcmV0dXJuIHZvdy5wYXlsb2FkO1xufTtcbmhhcmRlbihnZXRWb3dQYXlsb2FkKTtcbnZhciB0b1Bhc3NhYmxlQ2FwID0gKGspID0+IHtcbiAgY29uc3QgcGF5bG9hZCA9IGdldFZvd1BheWxvYWQoayk7XG4gIGlmIChwYXlsb2FkID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGtcbiAgICApO1xuICB9XG4gIGNvbnN0IHsgdm93VjAgfSA9IHBheWxvYWQ7XG4gIHJldHVybiB2b3dWMDtcbn07XG5oYXJkZW4odG9QYXNzYWJsZUNhcCk7XG52YXIgbWFrZUFzVm93ID0gKG1ha2VWb3dLaXQpID0+IHtcbiAgY29uc3QgYXNWb3cgPSAoZm4pID0+IHtcbiAgICBsZXQgcmVzdWx0O1xuICAgIHRyeSB7XG4gICAgICByZXN1bHQgPSBmbigpO1xuICAgIH0gY2F0Y2ggKGUyKSB7XG4gICAgICByZXN1bHQgPSBQcm9taXNlLnJlamVjdChlMik7XG4gICAgfVxuICAgIGlmIChpc1ZvdyhyZXN1bHQpKSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBjb25zdCB7IHZvdywgcmVzb2x2ZXIgfSA9IG1ha2VWb3dLaXQoKTtcbiAgICByZXNvbHZlci5yZXNvbHZlKHJlc3VsdCk7XG4gICAgcmV0dXJuIHZvdztcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbihhc1Zvdyk7XG59O1xuaGFyZGVuKG1ha2VBc1Zvdyk7XG5cbi8vXG52YXIgeyBkZXRhaWxzOiBYMyB9ID0gYXNzZXJ0O1xudmFyIG5vb3AgPSAoKSA9PiB7XG59O1xuaGFyZGVuKG5vb3ApO1xudmFyIHByZXBhcmVWb3dLaXQgPSAoem9uZSwgdm93UmVqZWN0aW9uVHJhY2tlcikgPT4ge1xuICBjb25zdCByZXNvbHZlclRvRXBoZW1lcmEgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgcmVzb2x2ZXJUb05vblN0b3JlZFZhbHVlID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IHByb3ZpZGVFcGhlbWVyYSA9IChyZXNvbHZlciwgb3B0aW9ucykgPT4ge1xuICAgIGxldCBlcGhlbWVyYSA9IHJlc29sdmVyVG9FcGhlbWVyYS5nZXQocmVzb2x2ZXIpO1xuICAgIGlmICghZXBoZW1lcmEpIHtcbiAgICAgIGVwaGVtZXJhID0gbWFrZVByb21pc2VLaXQoKTtcbiAgICAgIGVwaGVtZXJhLnByb21pc2UuY2F0Y2gobm9vcCk7XG4gICAgfVxuICAgIGVwaGVtZXJhID0gaGFyZGVuKHsgLi4uZXBoZW1lcmEsIC4uLm9wdGlvbnMgfSk7XG4gICAgcmVzb2x2ZXJUb0VwaGVtZXJhLnNldChyZXNvbHZlciwgZXBoZW1lcmEpO1xuICAgIHJldHVybiBlcGhlbWVyYTtcbiAgfTtcbiAgY29uc3QgcHJvdmlkZUVwaGVtZXJhRm9yUmVzb2x1dGlvbiA9IChyZXNvbHZlcikgPT4ge1xuICAgIGNvbnN0IGVwaGVtZXJhID0gcHJvdmlkZUVwaGVtZXJhKHJlc29sdmVyKTtcbiAgICBpZiAoZXBoZW1lcmEucmVzb2x2ZSkge1xuICAgICAgY29uc3QgeyByZXNvbHZlOiBfMSwgcmVqZWN0OiBfMiwgLi4ucmVzdCB9ID0gZXBoZW1lcmE7XG4gICAgICByZXNvbHZlclRvRXBoZW1lcmEuc2V0KHJlc29sdmVyLCBoYXJkZW4ocmVzdCkpO1xuICAgIH1cbiAgICByZXR1cm4gZXBoZW1lcmE7XG4gIH07XG4gIGNvbnN0IG1ha2VWb3dJbnRlcm5hbHNLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiVm93SW50ZXJuYWxzS2l0XCIsXG4gICAge1xuICAgICAgdm93VjA6IE0uaW50ZXJmYWNlKFwiVm93VjBcIiwge1xuICAgICAgICBzaG9ydGVuOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgICAgfSksXG4gICAgICByZXNvbHZlcjogTS5pbnRlcmZhY2UoXCJWb3dSZXNvbHZlclwiLCB7XG4gICAgICAgIHJlc29sdmU6IE0uY2FsbCgpLm9wdGlvbmFsKE0ucmF3KCkpLnJldHVybnMoKSxcbiAgICAgICAgcmVqZWN0OiBNLmNhbGwoKS5vcHRpb25hbChNLnJhdygpKS5yZXR1cm5zKClcbiAgICAgIH0pLFxuICAgICAgd2F0Y2hOZXh0U3RlcDogUHJvbWlzZVdhdGNoZXJJXG4gICAgfSxcbiAgICAoKSA9PiAoe1xuICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICB2YWx1ZTogdm9pZCAwLFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIHN0ZXBTdGF0dXM6IG51bGwsXG4gICAgICBpc1N0b3JlZFZhbHVlOiBmYWxzZSxcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHZvd0lzSGFuZGxlZDogZmFsc2UsXG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBleHRyYTogdm9pZCAwXG4gICAgfSksXG4gICAge1xuICAgICAgdm93VjA6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgYXN5bmMgc2hvcnRlbigpIHtcbiAgICAgICAgICBjb25zdCB7IHN0ZXBTdGF0dXMsIGlzU3RvcmVkVmFsdWUsIHZhbHVlLCB2b3dJc0hhbmRsZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyByZXNvbHZlciwgdm93VjAgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIHN3aXRjaCAoc3RlcFN0YXR1cykge1xuICAgICAgICAgICAgY2FzZSBcImZ1bGZpbGxlZFwiOiB7XG4gICAgICAgICAgICAgIGlmICh2b3dJc0hhbmRsZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS52b3dJc0hhbmRsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChpc1N0b3JlZFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc29sdmVyVG9Ob25TdG9yZWRWYWx1ZS5oYXMocmVzb2x2ZXIpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmVyVG9Ob25TdG9yZWRWYWx1ZS5nZXQocmVzb2x2ZXIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRocm93IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBcInJlamVjdGVkXCI6IHtcbiAgICAgICAgICAgICAgaWYgKHZvd0lzSGFuZGxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnZvd0lzSGFuZGxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdm93UmVqZWN0aW9uVHJhY2tlcj8uaGFuZGxlKHZvd1YwKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zdCByZWFzb24gPSByZXNvbHZlclRvTm9uU3RvcmVkVmFsdWUuaGFzKHJlc29sdmVyKSA/IHJlc29sdmVyVG9Ob25TdG9yZWRWYWx1ZS5nZXQocmVzb2x2ZXIpIDogdmFsdWU7XG4gICAgICAgICAgICAgIHRocm93IHJlYXNvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgbnVsbDpcbiAgICAgICAgICAgIGNhc2UgXCJwZW5kaW5nXCI6XG4gICAgICAgICAgICAgIHJldHVybiBwcm92aWRlRXBoZW1lcmEodGhpcy5mYWNldHMucmVzb2x2ZXIsIHtcbiAgICAgICAgICAgICAgICBwb3RlbnRpYWxseUhhbmRsZWQ6IHRydWVcbiAgICAgICAgICAgICAgfSkucHJvbWlzZTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHRocm93IFR5cGVFcnJvcihgdW5leHBlY3RlZCBzdGVwU3RhdHVzICR7c3RlcFN0YXR1c31gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXNvbHZlcjoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICByZXNvbHZlKHZhbHVlKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGVwU3RhdHVzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChzdGVwU3RhdHVzICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuc3RhdGUuc3RlcFN0YXR1cyA9IFwicGVuZGluZ1wiO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZTogcmVzb2x2ZTIgfSA9IHByb3ZpZGVFcGhlbWVyYUZvclJlc29sdXRpb24ocmVzb2x2ZXIpO1xuICAgICAgICAgIHJlc29sdmUyICYmIHJlc29sdmUyKHZhbHVlKTtcbiAgICAgICAgICB6b25lLndhdGNoUHJvbWlzZShcbiAgICAgICAgICAgIEhhbmRsZWRQcm9taXNlLnJlc29sdmUodmFsdWUpLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMud2F0Y2hOZXh0U3RlcFxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIHJlamVjdChyZWFzb24pIHtcbiAgICAgICAgICBjb25zdCB7IHN0ZXBTdGF0dXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKHN0ZXBTdGF0dXMgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zdGF0ZS5zdGVwU3RhdHVzID0gXCJyZWplY3RlZFwiO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZXIsIHdhdGNoTmV4dFN0ZXAgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IHsgcmVqZWN0IH0gPSBwcm92aWRlRXBoZW1lcmFGb3JSZXNvbHV0aW9uKHJlc29sdmVyKTtcbiAgICAgICAgICByZWplY3QgJiYgcmVqZWN0KHJlYXNvbik7XG4gICAgICAgICAgd2F0Y2hOZXh0U3RlcC5vblJlamVjdGVkKHJlYXNvbik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3YXRjaE5leHRTdGVwOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKHZhbHVlKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5zdGVwU3RhdHVzID0gXCJmdWxmaWxsZWRcIjtcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmU6IHJlc29sdmUyIH0gPSBwcm92aWRlRXBoZW1lcmFGb3JSZXNvbHV0aW9uKHJlc29sdmVyKTtcbiAgICAgICAgICBoYXJkZW4odmFsdWUpO1xuICAgICAgICAgIHJlc29sdmUyICYmIHJlc29sdmUyKHZhbHVlKTtcbiAgICAgICAgICB0aGlzLnN0YXRlLmlzU3RvcmVkVmFsdWUgPSB6b25lLmlzU3RvcmFibGUodmFsdWUpO1xuICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmlzU3RvcmVkVmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUudmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzb2x2ZXJUb05vblN0b3JlZFZhbHVlLnNldChyZXNvbHZlciwgdmFsdWUpO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS52YWx1ZSA9IGFzc2VydC5lcnJvcihcbiAgICAgICAgICAgICAgWDNgVm93IGZ1bGZpbGxtZW50IHZhbHVlIHdhcyBub3Qgc3RvcmVkOiAke3ZhbHVlfWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvblJlamVjdGVkKHJlYXNvbikge1xuICAgICAgICAgIHRoaXMuc3RhdGUuc3RlcFN0YXR1cyA9IFwicmVqZWN0ZWRcIjtcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmVyLCB2b3dWMCB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgeyByZWplY3QsIHBvdGVudGlhbGx5SGFuZGxlZCB9ID0gcHJvdmlkZUVwaGVtZXJhRm9yUmVzb2x1dGlvbihyZXNvbHZlcik7XG4gICAgICAgICAgaGFyZGVuKHJlYXNvbik7XG4gICAgICAgICAgcmVqZWN0ICYmIHJlamVjdChyZWFzb24pO1xuICAgICAgICAgIGlmICh0aGlzLnN0YXRlLnZvd0lzSGFuZGxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGlmIChwb3RlbnRpYWxseUhhbmRsZWQpIHtcbiAgICAgICAgICAgICAgdGhpcy5zdGF0ZS52b3dJc0hhbmRsZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdm93UmVqZWN0aW9uVHJhY2tlcj8ucmVqZWN0KHZvd1YwLCByZWFzb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnN0YXRlLmlzU3RvcmVkVmFsdWUgPSB6b25lLmlzU3RvcmFibGUocmVhc29uKTtcbiAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5pc1N0b3JlZFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gcmVhc29uO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlclRvTm9uU3RvcmVkVmFsdWUuc2V0KHJlc29sdmVyLCByZWFzb24pO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS52YWx1ZSA9IGFzc2VydC5lcnJvcihcbiAgICAgICAgICAgICAgWDNgVm93IHJlamVjdGlvbiByZWFzb24gd2FzIG5vdCBzdG9yZWQ6ICR7cmVhc29ufWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlVm93S2l0ID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgcmVzb2x2ZXIsIHZvd1YwIH0gPSBtYWtlVm93SW50ZXJuYWxzS2l0KCk7XG4gICAgY29uc3Qgdm93ID0gbWFrZVRhZ2dlZChcIlZvd1wiLCBoYXJkZW4oeyB2b3dWMCB9KSk7XG4gICAgcmV0dXJuIGhhcmRlbih7IHJlc29sdmVyLCB2b3cgfSk7XG4gIH07XG4gIHJldHVybiBtYWtlVm93S2l0O1xufTtcbmhhcmRlbihwcmVwYXJlVm93S2l0KTtcblxuLy9cbnZhciB7IEZhaWw6IEZhaWw1LCBiYXJlOiBiYXJlMiwgZGV0YWlsczogWDQgfSA9IGFzc2VydDtcbnZhciBWb3dTaGFwZTIgPSBNLnRhZ2dlZChcbiAgXCJWb3dcIixcbiAgaGFyZGVuKHtcbiAgICB2b3dWMDogTS5yZW1vdGFibGUoXCJWb3dWMFwiKVxuICB9KVxuKTtcbnZhciBwcmVwYXJlV2F0Y2hVdGlscyA9ICh6b25lLCB7IHdhdGNoLCB3aGVuLCBtYWtlVm93S2l0LCBpc1JldHJ5YWJsZVJlYXNvbjogaXNSZXRyeWFibGVSZWFzb24yIH0pID0+IHtcbiAgY29uc3QgZGV0YWNoZWQgPSB6b25lLmRldGFjaGVkKCk7XG4gIGNvbnN0IHV0aWxzVG9Ob25TdG9yYWJsZVJlc3VsdHMgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgbWFrZVdhdGNoVXRpbHNLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiV2F0Y2hVdGlsc1wiLFxuICAgIHtcbiAgICAgIHV0aWxzOiBNLmludGVyZmFjZShcIlV0aWxzXCIsIHtcbiAgICAgICAgYWxsOiBNLmNhbGwoTS5hcnJheU9mKE0uYW55KCkpKS5yZXR1cm5zKFZvd1NoYXBlMiksXG4gICAgICAgIGFsbFNldHRsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5hbnkoKSkpLnJldHVybnMoVm93U2hhcGUyKSxcbiAgICAgICAgYXNQcm9taXNlOiBNLmNhbGwoTS5yYXcoKSkucmVzdChNLnJhdygpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgICAgfSksXG4gICAgICB3YXRjaGVyOiBNLmludGVyZmFjZShcIldhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmF3KCkpLnJlc3QoTS5yYXcoKSkucmV0dXJucyhNLnJhdygpKSxcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0ucmF3KCkpLnJlc3QoTS5yYXcoKSkucmV0dXJucyhNLnJhdygpKVxuICAgICAgfSksXG4gICAgICBoZWxwZXI6IE0uaW50ZXJmYWNlKFwiSGVscGVyXCIsIHtcbiAgICAgICAgY3JlYXRlVm93OiBNLmNhbGwoTS5hcnJheU9mKE0uYW55KCkpLCBNLmJvb2xlYW4oKSkucmV0dXJucyhWb3dTaGFwZTIpLFxuICAgICAgICBwcm9jZXNzUmVzdWx0OiBNLmNhbGwoTS5yYXcoKSkucmVzdChNLnJhdygpKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpXG4gICAgICB9KSxcbiAgICAgIHJldHJ5UmVqZWN0aW9uUHJvbWlzZVdhdGNoZXI6IFByb21pc2VXYXRjaGVySVxuICAgIH0sXG4gICAgKCkgPT4ge1xuICAgICAgY29uc3QgaWRUb1Zvd1N0YXRlID0gZGV0YWNoZWQubWFwU3RvcmUoXCJpZFRvVm93U3RhdGVcIik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBuZXh0SWQ6IDBuLFxuICAgICAgICBpZFRvVm93U3RhdGVcbiAgICAgIH07XG4gICAgfSxcbiAgICB7XG4gICAgICB1dGlsczoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBhbGwoc3BlY2ltZW5zKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmFjZXRzLmhlbHBlci5jcmVhdGVWb3coc3BlY2ltZW5zLCBmYWxzZSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGFsbFNldHRsZWQoc3BlY2ltZW5zKSB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgdGhpcy5mYWNldHMuaGVscGVyLmNyZWF0ZVZvdyhzcGVjaW1lbnMsIHRydWUpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYXNQcm9taXNlKHNwZWNpbWVuUCwgLi4ud2F0Y2hlckFyZ3MpIHtcbiAgICAgICAgICBjb25zdCB2b3cgPSB3YXRjaChzcGVjaW1lblAsIC4uLndhdGNoZXJBcmdzKTtcbiAgICAgICAgICBjb25zdCBwcm9taXNlID0gd2hlbih2b3cpO1xuICAgICAgICAgIHpvbmUud2F0Y2hQcm9taXNlKHByb21pc2UsIHRoaXMuZmFjZXRzLnJldHJ5UmVqZWN0aW9uUHJvbWlzZVdhdGNoZXIpO1xuICAgICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQodmFsdWUsIGN0eCkge1xuICAgICAgICAgIHRoaXMuZmFjZXRzLmhlbHBlci5wcm9jZXNzUmVzdWx0KHZhbHVlLCBjdHgsIFwiZnVsZmlsbGVkXCIpO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25SZWplY3RlZChyZWFzb24sIGN0eCkge1xuICAgICAgICAgIHRoaXMuZmFjZXRzLmhlbHBlci5wcm9jZXNzUmVzdWx0KHJlYXNvbiwgY3R4LCBcInJlamVjdGVkXCIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaGVscGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgY3JlYXRlVm93KHNwZWNpbWVucywgaXNBbGxTZXR0bGVkKSB7XG4gICAgICAgICAgY29uc3QgeyBuZXh0SWQ6IGlkLCBpZFRvVm93U3RhdGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3Qga2l0ID0gbWFrZVZvd0tpdCgpO1xuICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBzcGVjaW1lbnMubGVuZ3RoOyBpbmRleCArPSAxKSB7XG4gICAgICAgICAgICB3YXRjaChzcGVjaW1lbnNbaW5kZXhdLCB0aGlzLmZhY2V0cy53YXRjaGVyLCB7XG4gICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICBpbmRleCxcbiAgICAgICAgICAgICAgbnVtUmVzdWx0czogc3BlY2ltZW5zLmxlbmd0aCxcbiAgICAgICAgICAgICAgaXNBbGxTZXR0bGVkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNwZWNpbWVucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLm5leHRJZCArPSAxbjtcbiAgICAgICAgICAgIGlkVG9Wb3dTdGF0ZS5pbml0KFxuICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgaGFyZGVuKHtcbiAgICAgICAgICAgICAgICByZXNvbHZlcjoga2l0LnJlc29sdmVyLFxuICAgICAgICAgICAgICAgIHJlbWFpbmluZzogc3BlY2ltZW5zLmxlbmd0aCxcbiAgICAgICAgICAgICAgICByZXN1bHRzTWFwOiBkZXRhY2hlZC5tYXBTdG9yZShcInJlc3VsdHNNYXBcIiksXG4gICAgICAgICAgICAgICAgaXNBbGxTZXR0bGVkXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgaWRUb05vblN0b3JhYmxlUmVzdWx0cyA9IHByb3ZpZGVMYXp5TWFwKFxuICAgICAgICAgICAgICB1dGlsc1RvTm9uU3RvcmFibGVSZXN1bHRzLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy51dGlscyxcbiAgICAgICAgICAgICAgKCkgPT4gLyogICAgICAgICAgICovIG5ldyBNYXAoKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlkVG9Ob25TdG9yYWJsZVJlc3VsdHMuc2V0KGlkLCAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAga2l0LnJlc29sdmVyLnJlc29sdmUoaGFyZGVuKFtdKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBraXQudm93O1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBwcm9jZXNzUmVzdWx0KHJlc3VsdCwgeyBpZCwgaW5kZXgsIG51bVJlc3VsdHMsIGlzQWxsU2V0dGxlZCB9LCBzdGF0dXMpIHtcbiAgICAgICAgICBjb25zdCB7IGlkVG9Wb3dTdGF0ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoIWlkVG9Wb3dTdGF0ZS5oYXMoaWQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGlkVG9Ob25TdG9yYWJsZVJlc3VsdHMgPSBwcm92aWRlTGF6eU1hcChcbiAgICAgICAgICAgIHV0aWxzVG9Ob25TdG9yYWJsZVJlc3VsdHMsXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy51dGlscyxcbiAgICAgICAgICAgICgpID0+IC8qICAgICAgICAgICAqLyBuZXcgTWFwKClcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHsgcmVtYWluaW5nLCByZXN1bHRzTWFwLCByZXNvbHZlciB9ID0gaWRUb1Zvd1N0YXRlLmdldChpZCk7XG4gICAgICAgICAgaWYgKCFpc0FsbFNldHRsZWQgJiYgc3RhdHVzID09PSBcInJlamVjdGVkXCIpIHtcbiAgICAgICAgICAgIGlkVG9Wb3dTdGF0ZS5kZWxldGUoaWQpO1xuICAgICAgICAgICAgaWRUb05vblN0b3JhYmxlUmVzdWx0cy5kZWxldGUoaWQpO1xuICAgICAgICAgICAgcmVzb2x2ZXIucmVqZWN0KHJlc3VsdCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHBvc3NpYmx5V3JhcHBlZFJlc3VsdCA9IGlzQWxsU2V0dGxlZCA/IGhhcmRlbih7XG4gICAgICAgICAgICBzdGF0dXMsXG4gICAgICAgICAgICBbc3RhdHVzID09PSBcImZ1bGZpbGxlZFwiID8gXCJ2YWx1ZVwiIDogXCJyZWFzb25cIl06IHJlc3VsdFxuICAgICAgICAgIH0pIDogcmVzdWx0O1xuICAgICAgICAgIGNvbnN0IG5vblN0b3JhYmxlUmVzdWx0cyA9IHByb3ZpZGVMYXp5TWFwKFxuICAgICAgICAgICAgaWRUb05vblN0b3JhYmxlUmVzdWx0cyxcbiAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgKCkgPT4gLyogICAgICAgICAgICovIG5ldyBNYXAoKVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHpvbmUuaXNTdG9yYWJsZShwb3NzaWJseVdyYXBwZWRSZXN1bHQpKSB7XG4gICAgICAgICAgICByZXN1bHRzTWFwLmluaXQoaW5kZXgsIHBvc3NpYmx5V3JhcHBlZFJlc3VsdCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5vblN0b3JhYmxlUmVzdWx0cy5zZXQoaW5kZXgsIHBvc3NpYmx5V3JhcHBlZFJlc3VsdCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHZvd1N0YXRlID0gaGFyZGVuKHtcbiAgICAgICAgICAgIHJlbWFpbmluZzogcmVtYWluaW5nIC0gMSxcbiAgICAgICAgICAgIHJlc3VsdHNNYXAsXG4gICAgICAgICAgICByZXNvbHZlcixcbiAgICAgICAgICAgIGlzQWxsU2V0dGxlZFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmICh2b3dTdGF0ZS5yZW1haW5pbmcgPiAwKSB7XG4gICAgICAgICAgICBpZFRvVm93U3RhdGUuc2V0KGlkLCB2b3dTdGF0ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGlkVG9Wb3dTdGF0ZS5kZWxldGUoaWQpO1xuICAgICAgICAgIGlkVG9Ob25TdG9yYWJsZVJlc3VsdHMuZGVsZXRlKGlkKTtcbiAgICAgICAgICBjb25zdCByZXN1bHRzID0gbmV3IEFycmF5KG51bVJlc3VsdHMpO1xuICAgICAgICAgIGxldCBudW1Mb3N0ID0gMDtcbiAgICAgICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbnVtUmVzdWx0czsgaTIgKz0gMSkge1xuICAgICAgICAgICAgaWYgKG5vblN0b3JhYmxlUmVzdWx0cy5oYXMoaTIpKSB7XG4gICAgICAgICAgICAgIHJlc3VsdHNbaTJdID0gbm9uU3RvcmFibGVSZXN1bHRzLmdldChpMik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdHNNYXAuaGFzKGkyKSkge1xuICAgICAgICAgICAgICByZXN1bHRzW2kyXSA9IHJlc3VsdHNNYXAuZ2V0KGkyKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIG51bUxvc3QgKz0gMTtcbiAgICAgICAgICAgICAgcmVzdWx0c1tpMl0gPSBpc0FsbFNldHRsZWQgPyB7IHN0YXR1czogXCJyZWplY3RlZFwiLCByZWFzb246IFwiVW5zdG9yYWJsZSByZXN1bHQgd2FzIGxvc3RcIiB9IDogdm9pZCAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobnVtTG9zdCA+IDAgJiYgIWlzQWxsU2V0dGxlZCkge1xuICAgICAgICAgICAgcmVzb2x2ZXIucmVqZWN0KFxuICAgICAgICAgICAgICBhc3NlcnQuZXJyb3IoWDRgJHtudW1Mb3N0fSB1bnN0b3JhYmxlIHJlc3VsdHMgd2VyZSBsb3N0YClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc29sdmVyLnJlc29sdmUoaGFyZGVuKHJlc3VsdHMpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXRyeVJlamVjdGlvblByb21pc2VXYXRjaGVyOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKF9yZXN1bHQpIHtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZWplY3RlZChyZWFzb24sIGZhaWxlZE9wKSB7XG4gICAgICAgICAgaWYgKGlzUmV0cnlhYmxlUmVhc29uMihyZWFzb24sIHZvaWQgMCkpIHtcbiAgICAgICAgICAgIEZhaWw1YFBlbmRpbmcgJHtiYXJlMihmYWlsZWRPcCl9IGNvdWxkIG5vdCByZXRyeTsgJHtyZWFzb259YDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VXYXRjaFV0aWwgPSAoKSA9PiB7XG4gICAgY29uc3QgeyB1dGlscyB9ID0gbWFrZVdhdGNoVXRpbHNLaXQoKTtcbiAgICByZXR1cm4gaGFyZGVuKHV0aWxzKTtcbiAgfTtcbiAgcmV0dXJuIG1ha2VXYXRjaFV0aWw7XG59O1xuaGFyZGVuKHByZXBhcmVXYXRjaFV0aWxzKTtcblxuLy9cbnZhciB7IGFwcGx5OiBhcHBseTcgfSA9IFJlZmxlY3Q7XG52YXIgbWFrZVdhdGNoTmV4dFN0ZXAgPSAoem9uZSkgPT4gKFxuICAvKlxuXG5cblxuXG5cblxuICAgKi9cbiAgKHNwZWNpbWVuLCBwcm9taXNlV2F0Y2hlcikgPT4ge1xuICAgIGxldCBwcm9taXNlO1xuICAgIGNvbnN0IHBheWxvYWQgPSBnZXRWb3dQYXlsb2FkKHNwZWNpbWVuKTtcbiAgICBpZiAocGF5bG9hZCkge1xuICAgICAgcHJvbWlzZSA9IEUocGF5bG9hZC52b3dWMCkuc2hvcnRlbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwcm9taXNlID0gRS5yZXNvbHZlKHNwZWNpbWVuKTtcbiAgICB9XG4gICAgem9uZS53YXRjaFByb21pc2UocHJvbWlzZSwgcHJvbWlzZVdhdGNoZXIpO1xuICB9XG4pO1xudmFyIHNldHRsZSA9IGFzeW5jIChyZXNvbHZlciwgd2F0Y2hlciwgd2NiLCB2YWx1ZSwgd2F0Y2hlckFyZ3MgPSBbXSkgPT4ge1xuICBhd2FpdCBudWxsO1xuICB0cnkge1xuICAgIGxldCBjaGFpbmVkVmFsdWUgPSB2YWx1ZTtcbiAgICBjb25zdCB3MiA9IHdhdGNoZXIgJiYgd2F0Y2hlclt3Y2JdO1xuICAgIGlmICh3Mikge1xuICAgICAgY2hhaW5lZFZhbHVlID0gYXBwbHk3KHcyLCB3YXRjaGVyLCBbdmFsdWUsIC4uLndhdGNoZXJBcmdzXSk7XG4gICAgfSBlbHNlIGlmICh3Y2IgPT09IFwib25SZWplY3RlZFwiKSB7XG4gICAgICB0aHJvdyB2YWx1ZTtcbiAgICB9XG4gICAgaWYgKHJlc29sdmVyKSB7XG4gICAgICByZXNvbHZlci5yZXNvbHZlKGNoYWluZWRWYWx1ZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGF3YWl0IGNoYWluZWRWYWx1ZTtcbiAgfSBjYXRjaCAoZTIpIHtcbiAgICBpZiAocmVzb2x2ZXIpIHtcbiAgICAgIHJlc29sdmVyLnJlamVjdChlMik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRocm93IGUyO1xuICB9XG59O1xudmFyIHByZXBhcmVQcm9taXNlV2F0Y2hlciA9ICh6b25lLCBpc1JldHJ5YWJsZVJlYXNvbjIsIHdhdGNoTmV4dFN0ZXApID0+IHtcbiAgY29uc3Qgd2F0Y2hlclNlZW5QYXlsb2FkcyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCBnZXRTZWVuUGF5bG9hZHMgPSAod2F0Y2hlcikgPT4ge1xuICAgIGxldCBzZWVuUGF5bG9hZHMgPSB3YXRjaGVyU2VlblBheWxvYWRzLmdldCh3YXRjaGVyKTtcbiAgICBpZiAoIXNlZW5QYXlsb2Fkcykge1xuICAgICAgc2VlblBheWxvYWRzID0gLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCk7XG4gICAgICB3YXRjaGVyU2VlblBheWxvYWRzLnNldCh3YXRjaGVyLCBzZWVuUGF5bG9hZHMpO1xuICAgIH1cbiAgICByZXR1cm4gc2VlblBheWxvYWRzO1xuICB9O1xuICByZXR1cm4gem9uZS5leG9DbGFzcyhcbiAgICBcIlByb21pc2VXYXRjaGVyXCIsXG4gICAgUHJvbWlzZVdhdGNoZXJJLFxuICAgIC8qXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgKHJlc29sdmVyLCB3YXRjaGVyLCB3YXRjaGVyQXJncykgPT4ge1xuICAgICAgY29uc3Qgc3RhdGUgPSB7XG4gICAgICAgIHZvdzogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB2b2lkIDBcbiAgICAgICAgKSxcbiAgICAgICAgcHJpb3JSZXRyeVZhbHVlOiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICAgICAgdm9pZCAwXG4gICAgICAgICksXG4gICAgICAgIHJlc29sdmVyLFxuICAgICAgICB3YXRjaGVyLFxuICAgICAgICB3YXRjaGVyQXJnczogaGFyZGVuKHdhdGNoZXJBcmdzKVxuICAgICAgfTtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzdGF0ZVxuICAgICAgKTtcbiAgICB9LFxuICAgIHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQodmFsdWUpIHtcbiAgICAgICAgY29uc3QgeyB3YXRjaGVyLCB3YXRjaGVyQXJncywgcmVzb2x2ZXIgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICghcmVzb2x2ZXIpIHtcbiAgICAgICAgICB0aHJvdyBFcnJvcihcIlVuZXhwZWN0ZWQgbXVsdGlwbGUgY2FsbHMgdG8gUHJvbWlzZVdhdGNoZXJcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGF5bG9hZCA9IGdldFZvd1BheWxvYWQodmFsdWUpO1xuICAgICAgICBpZiAocGF5bG9hZCkge1xuICAgICAgICAgIGNvbnN0IHNlZW5QYXlsb2FkcyA9IGdldFNlZW5QYXlsb2Fkcyh0aGlzLnNlbGYpO1xuICAgICAgICAgIGlmIChzZWVuUGF5bG9hZHMuaGFzKHBheWxvYWQudm93VjApKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZWxmLm9uUmVqZWN0ZWQoRXJyb3IoXCJWb3cgcmVzb2x1dGlvbiBjeWNsZSBkZXRlY3RlZFwiKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNlZW5QYXlsb2Fkcy5hZGQocGF5bG9hZC52b3dWMCk7XG4gICAgICAgICAgdGhpcy5zdGF0ZS52b3cgPSB2YWx1ZTtcbiAgICAgICAgICB3YXRjaE5leHRTdGVwKHZhbHVlLCB0aGlzLnNlbGYpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB3YXRjaGVyU2VlblBheWxvYWRzLmRlbGV0ZSh0aGlzLnNlbGYpO1xuICAgICAgICB0aGlzLnN0YXRlLnByaW9yUmV0cnlWYWx1ZSA9IHZvaWQgMDtcbiAgICAgICAgdGhpcy5zdGF0ZS53YXRjaGVyID0gdm9pZCAwO1xuICAgICAgICB0aGlzLnN0YXRlLnJlc29sdmVyID0gdm9pZCAwO1xuICAgICAgICB2b2lkIHNldHRsZShyZXNvbHZlciwgd2F0Y2hlciwgXCJvbkZ1bGZpbGxlZFwiLCB2YWx1ZSwgd2F0Y2hlckFyZ3MpO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBvblJlamVjdGVkKHJlYXNvbikge1xuICAgICAgICBjb25zdCB7IHZvdywgd2F0Y2hlciwgd2F0Y2hlckFyZ3MsIHJlc29sdmVyLCBwcmlvclJldHJ5VmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGlmICghcmVzb2x2ZXIpIHtcbiAgICAgICAgICB0aHJvdyBFcnJvcihcIlVuZXhwZWN0ZWQgbXVsdGlwbGUgY2FsbHMgdG8gUHJvbWlzZVdhdGNoZXJcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmV0cnlWYWx1ZSA9IGlzUmV0cnlhYmxlUmVhc29uMihyZWFzb24sIHByaW9yUmV0cnlWYWx1ZSk7XG4gICAgICAgIGlmIChyZXRyeVZhbHVlKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5wcmlvclJldHJ5VmFsdWUgPSByZXRyeVZhbHVlO1xuICAgICAgICAgIGlmICh2b3cpIHtcbiAgICAgICAgICAgIHdhdGNoTmV4dFN0ZXAodm93LCB0aGlzLnNlbGYpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB3YXRjaGVyU2VlblBheWxvYWRzLmRlbGV0ZSh0aGlzLnNlbGYpO1xuICAgICAgICB0aGlzLnN0YXRlLnByaW9yUmV0cnlWYWx1ZSA9IHZvaWQgMDtcbiAgICAgICAgdGhpcy5zdGF0ZS5yZXNvbHZlciA9IHZvaWQgMDtcbiAgICAgICAgdGhpcy5zdGF0ZS53YXRjaGVyID0gdm9pZCAwO1xuICAgICAgICB2b2lkIHNldHRsZShyZXNvbHZlciwgd2F0Y2hlciwgXCJvblJlamVjdGVkXCIsIHJlYXNvbiwgd2F0Y2hlckFyZ3MpO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbn07XG52YXIgcHJlcGFyZVdhdGNoID0gKHpvbmUsIG1ha2VWb3dLaXQsIGlzUmV0cnlhYmxlUmVhc29uMiA9IChfcmVhc29uLCBfbGFzdFZhbHVlKSA9PiB2b2lkIDApID0+IHtcbiAgY29uc3Qgd2F0Y2hOZXh0U3RlcCA9IG1ha2VXYXRjaE5leHRTdGVwKHpvbmUpO1xuICBjb25zdCBtYWtlUHJvbWlzZVdhdGNoZXIgPSBwcmVwYXJlUHJvbWlzZVdhdGNoZXIoXG4gICAgem9uZSxcbiAgICBpc1JldHJ5YWJsZVJlYXNvbjIsXG4gICAgd2F0Y2hOZXh0U3RlcFxuICApO1xuICBjb25zdCB3YXRjaCA9IChzcGVjaW1lblAsIHdhdGNoZXIsIC4uLndhdGNoZXJBcmdzKSA9PiB7XG4gICAgY29uc3QgeyByZXNvbHZlciwgdm93IH0gPSBtYWtlVm93S2l0KCk7XG4gICAgY29uc3QgcHJvbWlzZVdhdGNoZXIgPSBtYWtlUHJvbWlzZVdhdGNoZXIocmVzb2x2ZXIsIHdhdGNoZXIsIHdhdGNoZXJBcmdzKTtcbiAgICBjb25zdCBwcm9taXNlID0gRS5yZXNvbHZlKHNwZWNpbWVuUCk7XG4gICAgem9uZS53YXRjaFByb21pc2UocHJvbWlzZSwgcHJvbWlzZVdhdGNoZXIpO1xuICAgIHJldHVybiB2b3c7XG4gIH07XG4gIGhhcmRlbih3YXRjaCk7XG4gIHJldHVybiB3YXRjaDtcbn07XG5oYXJkZW4ocHJlcGFyZVdhdGNoKTtcblxuLy9cbnZhciBtYWtlVW5oYW5kbGVkUmVqZWN0aW9uQ2FuY2VsbGVyID0gKHJlamVjdGVkLCB1cGdyYWRlZFBLKSA9PiB7XG4gIHJldHVybiAoKSA9PiB7XG4gICAgcmVqZWN0ZWQ/LmNhdGNoKHNpbms0KTtcbiAgICB1cGdyYWRlZFBLPy5yZXNvbHZlKCk7XG4gIH07XG59O1xudmFyIHByZXBhcmVWb3dSZWplY3Rpb25UcmFja2VyID0gKHpvbmUpID0+IHtcbiAgY29uc3Qgdm93VG9DYW5jZWxVbmhhbmRsZWRSZWplY3Rpb24gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgdXBncmFkZVJlamVjdGlvbldhdGNoZXIgPSB6b25lLmV4byhcbiAgICBcIlVwZ3JhZGVSZWplY3Rpb25XYXRjaGVyXCIsXG4gICAgTS5pbnRlcmZhY2UoXCJVcGdyYWRlUmVqZWN0aW9uV2F0Y2hlclwiLCB7XG4gICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5yYXcoKSwgTS5yYXcoKSkucmV0dXJucygpXG4gICAgfSksXG4gICAge1xuICAgICAgb25SZWplY3RlZCh1cGdyYWRlUmVhc29uLCBiYXNlUmVhc29uKSB7XG4gICAgICAgIGNvbnN0IHJlYXNvbiA9IGFzc2VydC5lcnJvcihcbiAgICAgICAgICByZWRhY3RlZGBWT1dfUkVKRUNUSU9OICR7YmFzZVJlYXNvbn0gbm90IGhhbmRsZWQgYmVmb3JlIHVwZ3JhZGUgJHt1cGdyYWRlUmVhc29ufWBcbiAgICAgICAgKTtcbiAgICAgICAgdGhyb3cgcmVhc29uO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3Qgdm93UmVqZWN0aW9uVHJhY2tlciA9IHpvbmUuZXhvKFxuICAgIFwiVm93UmVqZWN0aW9uVHJhY2tlclwiLFxuICAgIE0uaW50ZXJmYWNlKFwiVm93UmVqZWN0aW9uVHJhY2tlclwiLCB7XG4gICAgICBoYW5kbGU6IE0uY2FsbChNLnJlbW90YWJsZSgpKS5yZXR1cm5zKCksXG4gICAgICByZWplY3Q6IE0uY2FsbChNLnJlbW90YWJsZSgpLCBNLnJhdygpKS5yZXR1cm5zKClcbiAgICB9KSxcbiAgICB7XG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIGhhbmRsZSh2b3dDYXApIHtcbiAgICAgICAgY29uc3QgY2FuY2VsID0gdm93VG9DYW5jZWxVbmhhbmRsZWRSZWplY3Rpb24uZ2V0KHZvd0NhcCk7XG4gICAgICAgIGlmICghY2FuY2VsKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgYXNzZXJ0LmVycm9yKFxuICAgICAgICAgICAgICByZWRhY3RlZGBOb3cgaGFuZGxpbmcgYSBWT1dfUkVKRUNUSU9OIGZyb20gYSBwcmlvciBpbmNhcm5hdGlvbiBmb3IgJHt2b3dDYXB9YFxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZvd1RvQ2FuY2VsVW5oYW5kbGVkUmVqZWN0aW9uLmRlbGV0ZSh2b3dDYXApO1xuICAgICAgICBjYW5jZWwoKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgcmVqZWN0KHZvd0NhcCwgcmVhc29uKSB7XG4gICAgICAgIGlmICh2b3dUb0NhbmNlbFVuaGFuZGxlZFJlamVjdGlvbi5oYXModm93Q2FwKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBoYXJkZW4ocmVhc29uKTtcbiAgICAgICAgY29uc3QgYmFzZVJlYXNvbiA9IHpvbmUuaXNTdG9yYWJsZShyZWFzb24pID8gcmVhc29uIDogYXNzZXJ0LmVycm9yKHJlZGFjdGVkYFZvdyByZWplY3Rpb24gcmVhc29uIHdhcyBub3Qgc3RvcmVkOiAke3JlYXNvbn1gKTtcbiAgICAgICAgY29uc3QgdXBncmFkZWRQSyA9IG1ha2VQcm9taXNlS2l0KCk7XG4gICAgICAgIHpvbmUud2F0Y2hQcm9taXNlKFxuICAgICAgICAgIHVwZ3JhZGVkUEsucHJvbWlzZSxcbiAgICAgICAgICB1cGdyYWRlUmVqZWN0aW9uV2F0Y2hlcixcbiAgICAgICAgICBiYXNlUmVhc29uXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHJlamVjdGVkID0gUHJvbWlzZS5yZWplY3QocmVhc29uKTtcbiAgICAgICAgY29uc3QgY2FuY2VsID0gbWFrZVVuaGFuZGxlZFJlamVjdGlvbkNhbmNlbGxlcihyZWplY3RlZCwgdXBncmFkZWRQSyk7XG4gICAgICAgIHZvd1RvQ2FuY2VsVW5oYW5kbGVkUmVqZWN0aW9uLnNldCh2b3dDYXAsIGNhbmNlbCk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4gdm93UmVqZWN0aW9uVHJhY2tlcjtcbn07XG5cbi8vXG52YXIgeyBkZWZpbmVQcm9wZXJ0aWVzOiBkZWZpbmVQcm9wZXJ0aWVzNCB9ID0gT2JqZWN0O1xudmFyIFJldHJ5YWJsZUZsb3dJS2l0ID0gaGFyZGVuKHtcbiAgZmxvdzogTS5pbnRlcmZhY2UoXCJGbG93XCIsIHtcbiAgICByZXN0YXJ0OiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gICAgZ2V0T3V0Y29tZTogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSlcbiAgfSksXG4gIHJlc3VsdFdhdGNoZXI6IFByb21pc2VXYXRjaGVySVxufSk7XG52YXIgQWRtaW5SZXRyeWFibGVGbG93SSA9IE0uaW50ZXJmYWNlKFwiUmV0cnlhYmxlRmxvd0FkbWluXCIsIHtcbiAgZ2V0Rmxvd0Zvck91dGNvbWVWb3c6IE0uY2FsbChWb3dTaGFwZSkucmV0dXJucyhNLm9wdChNLnJlbW90YWJsZShcImZsb3dcIikpKVxufSk7XG52YXIgcHJlcGFyZVJldHJ5YWJsZVRvb2xzID0gKG91dGVyWm9uZSwgb3V0ZXJPcHRpb25zKSA9PiB7XG4gIGNvbnN0IHsgbWFrZVZvd0tpdCwgaXNSZXRyeWFibGVSZWFzb246IGlzUmV0cnlhYmxlUmVhc29uMiB9ID0gb3V0ZXJPcHRpb25zO1xuICBjb25zdCBhc1ZvdyA9IG1ha2VBc1ZvdyhtYWtlVm93S2l0KTtcbiAgY29uc3QgZmxvd0Zvck91dGNvbWVWb3dLZXkgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgb3V0ZXJab25lLm1hcFN0b3JlKFwicmV0cnlhYmxlRmxvd0Zvck91dGNvbWVWb3dcIiwge1xuICAgICAga2V5U2hhcGU6IE0ucmVtb3RhYmxlKFwidG9QYXNzYWJsZUNhcFwiKSxcbiAgICAgIHZhbHVlU2hhcGU6IE0ucmVtb3RhYmxlKFwiZmxvd1wiKVxuICAgICAgLy9cbiAgICB9KVxuICApO1xuICBjb25zdCBwcmVwYXJlUmV0cnlhYmxlRmxvd0tpdCA9ICh6b25lLCB0YWcsIHJldHJ5YWJsZUZ1bmMpID0+IHtcbiAgICB0eXBlb2YgcmV0cnlhYmxlRnVuYyA9PT0gXCJmdW5jdGlvblwiIHx8IHRocm93UmVkYWN0ZWRgcmV0cnlhYmxlRnVuYyBtdXN0IGJlIGEgY2FsbGFibGUgZnVuY3Rpb24gJHtyZXRyeWFibGVGdW5jfWA7XG4gICAgY29uc3QgaW50ZXJuYWxNYWtlUmV0cnlhYmxlRmxvd0tpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgICB0YWcsXG4gICAgICBSZXRyeWFibGVGbG93SUtpdCxcbiAgICAgIChhY3RpdmF0aW9uQXJncykgPT4ge1xuICAgICAgICBoYXJkZW4oYWN0aXZhdGlvbkFyZ3MpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFjdGl2YXRpb25BcmdzLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgb3V0Y29tZUtpdDogbWFrZVZvd0tpdCgpLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgbGFzdFJldHJ5UmVhc29uOiB2b2lkIDAsXG4gICAgICAgICAgcnVuczogMG4sXG4gICAgICAgICAgaXNEb25lOiBmYWxzZVxuICAgICAgICAgIC8vXG4gICAgICAgIH07XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBmbG93OiB7XG4gICAgICAgICAgLypcblxuXG4gICAgICAgICAgICovXG4gICAgICAgICAgcmVzdGFydCgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgYWN0aXZhdGlvbkFyZ3MsIGlzRG9uZSB9ID0gc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3csIHJlc3VsdFdhdGNoZXIgfSA9IGZhY2V0cztcbiAgICAgICAgICAgICFpc0RvbmUgfHwgLy9cbiAgICAgICAgICAgIHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlc3RhcnQgYSBkb25lIHJldHJ5YWJsZSBmbG93ICR7Zmxvd31gO1xuICAgICAgICAgICAgY29uc3QgcnVuSWQgPSBzdGF0ZS5ydW5zICsgMW47XG4gICAgICAgICAgICBzdGF0ZS5ydW5zID0gcnVuSWQ7XG4gICAgICAgICAgICBsZXQgcmVzdWx0UDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIHJlc3VsdFAgPSBQcm9taXNlLnJlc29sdmUocmV0cnlhYmxlRnVuYyguLi5hY3RpdmF0aW9uQXJncykpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgIHJlc3VsdFAgPSBQcm9taXNlLnJlamVjdChlcnIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgb3V0ZXJab25lLndhdGNoUHJvbWlzZShoYXJkZW4ocmVzdWx0UCksIHJlc3VsdFdhdGNoZXIsIHJ1bklkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldE91dGNvbWUoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBvdXRjb21lS2l0IH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIHJldHVybiBvdXRjb21lS2l0LnZvdztcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJlc3VsdFdhdGNoZXI6IHtcbiAgICAgICAgICBvbkZ1bGZpbGxlZCh2YWx1ZSwgcnVuSWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IHJ1bnMsIG91dGNvbWVLaXQgfSA9IHN0YXRlO1xuICAgICAgICAgICAgaWYgKHJ1bklkICE9PSBydW5zKSByZXR1cm47XG4gICAgICAgICAgICAhc3RhdGUuaXNEb25lIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlc29sdmUgYSBkb25lIHJldHJ5YWJsZSBmbG93ICR7dGhpcy5mYWNldHMuZmxvd31gO1xuICAgICAgICAgICAgb3V0Y29tZUtpdC5yZXNvbHZlci5yZXNvbHZlKHZhbHVlKTtcbiAgICAgICAgICAgIGZsb3dGb3JPdXRjb21lVm93S2V5LmRlbGV0ZSh0b1Bhc3NhYmxlQ2FwKG91dGNvbWVLaXQudm93KSk7XG4gICAgICAgICAgICBzdGF0ZS5pc0RvbmUgPSB0cnVlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25SZWplY3RlZChyZWFzb24sIHJ1bklkKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBydW5zLCBvdXRjb21lS2l0IH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGlmIChydW5JZCAhPT0gcnVucykgcmV0dXJuO1xuICAgICAgICAgICAgIXN0YXRlLmlzRG9uZSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCByZWplY3QgYSBkb25lIHJldHJ5YWJsZSBmbG93ICR7dGhpcy5mYWNldHMuZmxvd31gO1xuICAgICAgICAgICAgY29uc3QgcmV0cnlSZWFzb24gPSBpc1JldHJ5YWJsZVJlYXNvbjIoXG4gICAgICAgICAgICAgIHJlYXNvbixcbiAgICAgICAgICAgICAgc3RhdGUubGFzdFJldHJ5UmVhc29uXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKHJldHJ5UmVhc29uKSB7XG4gICAgICAgICAgICAgIHN0YXRlLmxhc3RSZXRyeVJlYXNvbiA9IHJldHJ5UmVhc29uO1xuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5mbG93LnJlc3RhcnQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIG91dGNvbWVLaXQucmVzb2x2ZXIucmVqZWN0KHJlYXNvbik7XG4gICAgICAgICAgICAgIGZsb3dGb3JPdXRjb21lVm93S2V5LmRlbGV0ZSh0b1Bhc3NhYmxlQ2FwKG91dGNvbWVLaXQudm93KSk7XG4gICAgICAgICAgICAgIHN0YXRlLmlzRG9uZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgICBjb25zdCBtYWtlUmV0cnlhYmxlRmxvd0tpdCA9IChhY3RpdmF0aW9uQXJncykgPT4ge1xuICAgICAgY29uc3QgcmV0cnlhYmxlS2l0ID0gaW50ZXJuYWxNYWtlUmV0cnlhYmxlRmxvd0tpdChhY3RpdmF0aW9uQXJncyk7XG4gICAgICBjb25zdCB7IGZsb3cgfSA9IHJldHJ5YWJsZUtpdDtcbiAgICAgIGNvbnN0IHZvdyA9IGZsb3cuZ2V0T3V0Y29tZSgpO1xuICAgICAgZmxvd0Zvck91dGNvbWVWb3dLZXkuaW5pdCh0b1Bhc3NhYmxlQ2FwKHZvdyksIGZsb3cpO1xuICAgICAgZmxvdy5yZXN0YXJ0KCk7XG4gICAgICByZXR1cm4gcmV0cnlhYmxlS2l0O1xuICAgIH07XG4gICAgcmV0dXJuIGhhcmRlbihtYWtlUmV0cnlhYmxlRmxvd0tpdCk7XG4gIH07XG4gIGNvbnN0IHJldHJ5YWJsZSA9ICh6b25lLCB0YWcsIHJldHJ5YWJsZUZ1bmMpID0+IHtcbiAgICBjb25zdCBtYWtlUmV0cnlhYmxlS2l0ID0gcHJlcGFyZVJldHJ5YWJsZUZsb3dLaXQoem9uZSwgdGFnLCByZXRyeWFibGVGdW5jKTtcbiAgICBjb25zdCB3cmFwcGVyRnVuY05hbWUgPSBgJHt0YWd9X3JldHJ5YWJsZWA7XG4gICAgY29uc3Qgd3JhcHBlckZ1bmMgPSB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgW3dyYXBwZXJGdW5jTmFtZV0oLi4uYXJncykge1xuICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgIHpvbmUuaXNTdG9yYWJsZShoYXJkZW4oYXJncykpIHx8IHRocm93UmVkYWN0ZWRgcmV0cnlhYmxlIGFyZ3VtZW50cyBtdXN0IGJlIHN0b3JhYmxlICR7YXJnc31gO1xuICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gbWFrZVJldHJ5YWJsZUtpdChhcmdzKTtcbiAgICAgICAgICByZXR1cm4gZmxvdy5nZXRPdXRjb21lKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1bd3JhcHBlckZ1bmNOYW1lXTtcbiAgICBkZWZpbmVQcm9wZXJ0aWVzNCh3cmFwcGVyRnVuYywge1xuICAgICAgbGVuZ3RoOiB7IHZhbHVlOiByZXRyeWFibGVGdW5jLmxlbmd0aCB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGhhcmRlbih3cmFwcGVyRnVuYyk7XG4gIH07XG4gIGNvbnN0IGFkbWluUmV0cnlhYmxlRmxvdyA9IG91dGVyWm9uZS5leG8oXG4gICAgXCJBZG1pblJldHJ5YWJsZUZsb3dcIixcbiAgICBBZG1pblJldHJ5YWJsZUZsb3dJLFxuICAgIHtcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgZ2V0Rmxvd0Zvck91dGNvbWVWb3cob3V0Y29tZVZvdykge1xuICAgICAgICByZXR1cm4gZmxvd0Zvck91dGNvbWVWb3dLZXkuZ2V0KHRvUGFzc2FibGVDYXAob3V0Y29tZVZvdykpO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgcHJlcGFyZVJldHJ5YWJsZUZsb3dLaXQsXG4gICAgYWRtaW5SZXRyeWFibGVGbG93LFxuICAgIHJldHJ5YWJsZVxuICB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZVJldHJ5YWJsZVRvb2xzKTtcblxuLy9cbnZhciBtYWtlV2hlbiA9IChpc1JldHJ5YWJsZVJlYXNvbjIgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICgpID0+IGZhbHNlXG4pKSA9PiB7XG4gIGNvbnN0IHVud3JhcCA9IGFzeW5jIChzcGVjaW1lblApID0+IHtcbiAgICBhd2FpdCBudWxsO1xuICAgIGxldCByZXN1bHQgPSBhd2FpdCBzcGVjaW1lblA7XG4gICAgbGV0IHBheWxvYWQgPSBnZXRWb3dQYXlsb2FkKHJlc3VsdCk7XG4gICAgbGV0IHByaW9yUmV0cnlWYWx1ZTtcbiAgICBjb25zdCBzZWVuUGF5bG9hZHMgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKTtcbiAgICB3aGlsZSAocGF5bG9hZCkge1xuICAgICAgY29uc3QgeyB2b3dWMCB9ID0gcGF5bG9hZDtcbiAgICAgIGlmIChzZWVuUGF5bG9hZHMuaGFzKHZvd1YwKSkge1xuICAgICAgICB0aHJvdyBFcnJvcihcIlZvdyByZXNvbHV0aW9uIGN5Y2xlIGRldGVjdGVkXCIpO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgRSh2b3dWMCkuc2hvcnRlbigpO1xuICAgICAgICBzZWVuUGF5bG9hZHMuYWRkKHZvd1YwKTtcbiAgICAgICAgcHJpb3JSZXRyeVZhbHVlID0gdm9pZCAwO1xuICAgICAgICByZXN1bHQgPSByZXM7XG4gICAgICB9IGNhdGNoIChlMikge1xuICAgICAgICBjb25zdCBuZXh0UmV0cnlWYWx1ZSA9IGlzUmV0cnlhYmxlUmVhc29uMihlMiwgcHJpb3JSZXRyeVZhbHVlKTtcbiAgICAgICAgaWYgKCFuZXh0UmV0cnlWYWx1ZSkge1xuICAgICAgICAgIHRocm93IGUyO1xuICAgICAgICB9XG4gICAgICAgIHByaW9yUmV0cnlWYWx1ZSA9IG5leHRSZXRyeVZhbHVlO1xuICAgICAgfVxuICAgICAgcGF5bG9hZCA9IGdldFZvd1BheWxvYWQocmVzdWx0KTtcbiAgICB9XG4gICAgY29uc3QgdW53cmFwcGVkID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgcmVzdWx0XG4gICAgKTtcbiAgICByZXR1cm4gdW53cmFwcGVkO1xuICB9O1xuICBjb25zdCB3aGVuID0gKHNwZWNpbWVuUCwgb25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpID0+IHtcbiAgICBjb25zdCB1bndyYXBwZWQgPSB1bndyYXAoc3BlY2ltZW5QKTtcbiAgICBpZiAob25GdWxmaWxsZWQgPT0gbnVsbCAmJiBvblJlamVjdGVkID09IG51bGwpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHVud3JhcHBlZFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIEUucmVzb2x2ZSh1bndyYXBwZWQpLnRoZW4ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpO1xuICB9O1xuICBoYXJkZW4od2hlbik7XG4gIHJldHVybiB3aGVuO1xufTtcbmhhcmRlbihtYWtlV2hlbik7XG5cbi8vXG52YXIgcHJlcGFyZUJhc2ljVm93VG9vbHMgPSAoem9uZSwgcG93ZXJzID0ge30pID0+IHtcbiAgY29uc3QgeyBpc1JldHJ5YWJsZVJlYXNvbjogaXNSZXRyeWFibGVSZWFzb24yID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgKCkgPT4gZmFsc2VcbiAgKSB9ID0gcG93ZXJzO1xuICBjb25zdCB2b3dSZWplY3Rpb25UcmFja2VyID0gcHJlcGFyZVZvd1JlamVjdGlvblRyYWNrZXIoem9uZSk7XG4gIGNvbnN0IG1ha2VWb3dLaXQgPSBwcmVwYXJlVm93S2l0KHpvbmUsIHZvd1JlamVjdGlvblRyYWNrZXIpO1xuICBjb25zdCB3aGVuID0gbWFrZVdoZW4oaXNSZXRyeWFibGVSZWFzb24yKTtcbiAgY29uc3Qgd2F0Y2ggPSBwcmVwYXJlV2F0Y2goem9uZSwgbWFrZVZvd0tpdCwgaXNSZXRyeWFibGVSZWFzb24yKTtcbiAgY29uc3QgbWFrZVdhdGNoVXRpbHMgPSBwcmVwYXJlV2F0Y2hVdGlscyh6b25lLCB7XG4gICAgd2F0Y2gsXG4gICAgd2hlbixcbiAgICBtYWtlVm93S2l0LFxuICAgIGlzUmV0cnlhYmxlUmVhc29uOiBpc1JldHJ5YWJsZVJlYXNvbjJcbiAgfSk7XG4gIGNvbnN0IHdhdGNoVXRpbHMgPSBtYWtlV2F0Y2hVdGlscygpO1xuICBjb25zdCBhc1ZvdyA9IG1ha2VBc1ZvdyhtYWtlVm93S2l0KTtcbiAgY29uc3QgeyByZXRyeWFibGUgfSA9IHByZXBhcmVSZXRyeWFibGVUb29scyh6b25lLCB7XG4gICAgbWFrZVZvd0tpdCxcbiAgICBpc1JldHJ5YWJsZVJlYXNvbjogaXNSZXRyeWFibGVSZWFzb24yXG4gIH0pO1xuICBjb25zdCBhbGwgPSAobWF5YmVWb3dzKSA9PiB3YXRjaFV0aWxzLmFsbChtYXliZVZvd3MpO1xuICBjb25zdCBhbGxWb3dzID0gYWxsO1xuICBjb25zdCBhbGxTZXR0bGVkID0gKG1heWJlVm93cykgPT4gd2F0Y2hVdGlscy5hbGxTZXR0bGVkKG1heWJlVm93cyk7XG4gIGNvbnN0IGFzUHJvbWlzZSA9IChzcGVjaW1lblAsIC4uLndhdGNoZXJBcmdzKSA9PiB3YXRjaFV0aWxzLmFzUHJvbWlzZShzcGVjaW1lblAsIC4uLndhdGNoZXJBcmdzKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgd2hlbixcbiAgICB3YXRjaCxcbiAgICBtYWtlVm93S2l0LFxuICAgIGFsbCxcbiAgICBhbGxWb3dzLFxuICAgIGFsbFNldHRsZWQsXG4gICAgYXNWb3csXG4gICAgYXNQcm9taXNlLFxuICAgIHJldHJ5YWJsZSxcbiAgICByZXRyaWFibGU6IHJldHJ5YWJsZVxuICAgIC8vXG4gIH0pO1xufTtcbmhhcmRlbihwcmVwYXJlQmFzaWNWb3dUb29scyk7XG5cbi8vXG52YXIgaGlkZGVuUHJpb3JFcnJvcjI7XG52YXIgaGlkZGVuQ3VycmVudFR1cm4yID0gMDtcbnZhciBoaWRkZW5DdXJyZW50RXZlbnQyID0gMDtcbnZhciBWRVJCT1NFMiA9IGVudmlyb25tZW50T3B0aW9uc0xpc3RIYXMoXCJERUJVR1wiLCBcInRyYWNrLXR1cm5zXCIpO1xudmFyIEVOQUJMRUQyID0gZ2V0RW52aXJvbm1lbnRPcHRpb24oXCJUUkFDS19UVVJOU1wiLCBcImRpc2FibGVkXCIsIFtcImVuYWJsZWRcIl0pID09PSBcImVuYWJsZWRcIjtcbnZhciBhZGRSZWplY3Rpb25Ob3RlMiA9IChkZXRhaWxzTm90ZSkgPT4gKHJlYXNvbikgPT4ge1xuICBpZiAocmVhc29uIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICBub3RlKHJlYXNvbiwgZGV0YWlsc05vdGUpO1xuICB9XG4gIGlmIChWRVJCT1NFMikge1xuICAgIGNvbnNvbGUubG9nKFwiUkVKRUNURUQgYXQgdG9wIG9mIGV2ZW50IGxvb3BcIiwgcmVhc29uKTtcbiAgfVxufTtcbnZhciB3cmFwRnVuY3Rpb24yID0gKGZ1bmMsIHNlbmRpbmdFcnJvcikgPT4gKC4uLmFyZ3MpID0+IHtcbiAgaGlkZGVuUHJpb3JFcnJvcjIgPSBzZW5kaW5nRXJyb3I7XG4gIGhpZGRlbkN1cnJlbnRUdXJuMiArPSAxO1xuICBoaWRkZW5DdXJyZW50RXZlbnQyID0gMDtcbiAgdHJ5IHtcbiAgICBsZXQgcmVzdWx0O1xuICAgIHRyeSB7XG4gICAgICByZXN1bHQgPSBmdW5jKC4uLmFyZ3MpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgIG5vdGUoXG4gICAgICAgICAgZXJyLFxuICAgICAgICAgIHJlZGFjdGVkYFRocm93biBmcm9tOiAke2hpZGRlblByaW9yRXJyb3IyfToke2hpZGRlbkN1cnJlbnRUdXJuMn0uJHtoaWRkZW5DdXJyZW50RXZlbnQyfWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChWRVJCT1NFMikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlRIUk9XTiB0byB0b3Agb2YgZXZlbnQgbG9vcFwiLCBlcnIpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICBjb25zdCBkZXRhaWxzTm90ZSA9IHJlZGFjdGVkYFJlamVjdGlvbiBmcm9tOiAke2hpZGRlblByaW9yRXJyb3IyfToke2hpZGRlbkN1cnJlbnRUdXJuMn0uJHtoaWRkZW5DdXJyZW50RXZlbnQyfWA7XG4gICAgUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCkuY2F0Y2goYWRkUmVqZWN0aW9uTm90ZTIoZGV0YWlsc05vdGUpKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9IGZpbmFsbHkge1xuICAgIGhpZGRlblByaW9yRXJyb3IyID0gdm9pZCAwO1xuICB9XG59O1xudmFyIHRyYWNrVHVybnMyID0gKGZ1bmNzKSA9PiB7XG4gIGlmICghRU5BQkxFRDIgfHwgdHlwZW9mIGdsb2JhbFRoaXMgPT09IFwidW5kZWZpbmVkXCIgfHwgIWdsb2JhbFRoaXMuYXNzZXJ0KSB7XG4gICAgcmV0dXJuIGZ1bmNzO1xuICB9XG4gIGhpZGRlbkN1cnJlbnRFdmVudDIgKz0gMTtcbiAgY29uc3Qgc2VuZGluZ0Vycm9yID0gRXJyb3IoXG4gICAgYEV2ZW50OiAke2hpZGRlbkN1cnJlbnRUdXJuMn0uJHtoaWRkZW5DdXJyZW50RXZlbnQyfWBcbiAgKTtcbiAgaWYgKGhpZGRlblByaW9yRXJyb3IyICE9PSB2b2lkIDApIHtcbiAgICBub3RlKHNlbmRpbmdFcnJvciwgcmVkYWN0ZWRgQ2F1c2VkIGJ5OiAke2hpZGRlblByaW9yRXJyb3IyfWApO1xuICB9XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAqL1xuICAgIGZ1bmNzLm1hcCgoZnVuYykgPT4gZnVuYyAmJiB3cmFwRnVuY3Rpb24yKGZ1bmMsIHNlbmRpbmdFcnJvcikpXG4gICk7XG59O1xuXG4vL1xudmFyIHsgaGFzT3duOiBoYXNPd24zLCBmcmVlemU6IGZyZWV6ZTksIGVudHJpZXM6IGVudHJpZXM4IH0gPSBPYmplY3Q7XG52YXIgaXNKU09OUmVjb3JkMiA9ICh2YWwpID0+IHR5cGVvZiB2YWwgPT09IFwib2JqZWN0XCIgJiYgdmFsICE9PSBudWxsICYmICFBcnJheS5pc0FycmF5KHZhbCk7XG52YXIgc2ltcGxpZnlUYWcyID0gKHRhZykgPT4ge1xuICBmb3IgKGNvbnN0IHByZWZpeCBvZiBbXCJBbGxlZ2VkOiBcIiwgXCJEZWJ1Z05hbWU6IFwiXSkge1xuICAgIGlmICh0YWcuc3RhcnRzV2l0aChwcmVmaXgpKSB7XG4gICAgICByZXR1cm4gdGFnLnNsaWNlKHByZWZpeC5sZW5ndGgpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdGFnO1xufTtcbnZhciBtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIyID0gKG9wdGlvbk5hbWUpID0+IHtcbiAgbGV0IGJyZWFrcG9pbnRzID0gSlNPTi5wYXJzZShnZXRFbnZpcm9ubWVudE9wdGlvbihvcHRpb25OYW1lLCBcIm51bGxcIikpO1xuICBpZiAoYnJlYWtwb2ludHMgPT09IG51bGwpIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIGxldCBicmVha3BvaW50c1RhYmxlO1xuICBjb25zdCBnZXRCcmVha3BvaW50cyA9ICgpID0+IGJyZWFrcG9pbnRzO1xuICBmcmVlemU5KGdldEJyZWFrcG9pbnRzKTtcbiAgY29uc3Qgc2V0QnJlYWtwb2ludHMgPSAobmV3QnJlYWtwb2ludHMgPSBicmVha3BvaW50cykgPT4ge1xuICAgIGlzSlNPTlJlY29yZDIobmV3QnJlYWtwb2ludHMpIHx8IHRocm93UmVkYWN0ZWRgRXhwZWN0ZWQgJHtxdW90ZShvcHRpb25OYW1lKX0gb3B0aW9uIHRvIGJlIGEgSlNPTiBicmVha3BvaW50cyByZWNvcmRgO1xuICAgIGNvbnN0IG5ld0JyZWFrcG9pbnRzVGFibGUgPSB7IF9fcHJvdG9fXzogbnVsbCB9O1xuICAgIGZvciAoY29uc3QgW3RhZywgbWV0aG9kQlBzXSBvZiBlbnRyaWVzOChuZXdCcmVha3BvaW50cykpIHtcbiAgICAgIHRhZyA9PT0gc2ltcGxpZnlUYWcyKHRhZykgfHwgdGhyb3dSZWRhY3RlZGBKdXN0IHVzZSBzaW1wbGUgdGFnICR7cXVvdGUoc2ltcGxpZnlUYWcyKHRhZykpfSByYXRoZXIgdGhhbiAke3F1b3RlKHRhZyl9YDtcbiAgICAgIGlzSlNPTlJlY29yZDIobWV0aG9kQlBzKSB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkICR7cXVvdGUob3B0aW9uTmFtZSl9IG9wdGlvbidzICR7cXVvdGUoXG4gICAgICAgIHRhZ1xuICAgICAgKX0gdG8gYmUgYSBKU09OIG1ldGhvZHMgYnJlYWtwb2ludHMgcmVjb3JkYDtcbiAgICAgIGZvciAoY29uc3QgW21ldGhvZE5hbWUsIGNvdW50XSBvZiBlbnRyaWVzOChtZXRob2RCUHMpKSB7XG4gICAgICAgIGNvdW50ID09PSBcIipcIiB8fCB0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIgJiYgTnVtYmVyLmlzU2FmZUludGVnZXIoY291bnQpICYmIGNvdW50ID49IDAgfHwgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCAke3F1b3RlKG9wdGlvbk5hbWUpfSBvcHRpb24ncyAke3F1b3RlKHRhZyl9LiR7cXVvdGUoXG4gICAgICAgICAgbWV0aG9kTmFtZVxuICAgICAgICApfSB0byBiZSBcIipcIiBvciBhIG5vbi1uZWdhdGl2ZSBpbnRlZ2VyYDtcbiAgICAgICAgY29uc3QgY2xhc3NCUHMgPSBoYXNPd24zKG5ld0JyZWFrcG9pbnRzVGFibGUsIG1ldGhvZE5hbWUpID8gbmV3QnJlYWtwb2ludHNUYWJsZVttZXRob2ROYW1lXSA6IG5ld0JyZWFrcG9pbnRzVGFibGVbbWV0aG9kTmFtZV0gPSB7XG4gICAgICAgICAgLy9cbiAgICAgICAgICBfX3Byb3RvX186IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgY2xhc3NCUHNbdGFnXSA9IGNvdW50O1xuICAgICAgfVxuICAgIH1cbiAgICBicmVha3BvaW50cyA9IG5ld0JyZWFrcG9pbnRzO1xuICAgIGJyZWFrcG9pbnRzVGFibGUgPSBuZXdCcmVha3BvaW50c1RhYmxlO1xuICB9O1xuICBmcmVlemU5KHNldEJyZWFrcG9pbnRzKTtcbiAgY29uc3Qgc2hvdWxkQnJlYWtwb2ludCA9IChyZWNpcGllbnQsIG1ldGhvZE5hbWUpID0+IHtcbiAgICBpZiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwIHx8IG1ldGhvZE5hbWUgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgY2xhc3NCUHMgPSBicmVha3BvaW50c1RhYmxlW21ldGhvZE5hbWVdIHx8IGJyZWFrcG9pbnRzVGFibGVbXCIqXCJdO1xuICAgIGlmIChjbGFzc0JQcyA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGxldCB0YWcgPSBzaW1wbGlmeVRhZzIocmVjaXBpZW50W1N5bWJvbC50b1N0cmluZ1RhZ10pO1xuICAgIGxldCBjb3VudCA9IGNsYXNzQlBzW3RhZ107XG4gICAgaWYgKGNvdW50ID09PSB2b2lkIDApIHtcbiAgICAgIHRhZyA9IFwiKlwiO1xuICAgICAgY291bnQgPSBjbGFzc0JQc1t0YWddO1xuICAgICAgaWYgKGNvdW50ID09PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoY291bnQgPT09IFwiKlwiKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGNvdW50ID09PSAwKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgYXNzZXJ0KHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiAmJiBjb3VudCA+PSAxKTtcbiAgICBjbGFzc0JQc1t0YWddID0gY291bnQgLSAxO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgZnJlZXplOShzaG91bGRCcmVha3BvaW50KTtcbiAgY29uc3QgYnJlYWtwb2ludFRlc3RlciA9IGZyZWV6ZTkoe1xuICAgIGdldEJyZWFrcG9pbnRzLFxuICAgIHNldEJyZWFrcG9pbnRzLFxuICAgIHNob3VsZEJyZWFrcG9pbnRcbiAgfSk7XG4gIGJyZWFrcG9pbnRUZXN0ZXIuc2V0QnJlYWtwb2ludHMoKTtcbiAgcmV0dXJuIGJyZWFrcG9pbnRUZXN0ZXI7XG59O1xuZnJlZXplOShtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIyKTtcblxuLy9cbnZhciB7IGFzc2lnbjogYXNzaWduMiwgY3JlYXRlOiBjcmVhdGU2IH0gPSBPYmplY3Q7XG52YXIgb25TZW5kMiA9IG1ha2VNZXNzYWdlQnJlYWtwb2ludFRlc3RlcjIoXCJFTkRPX1NFTkRfQlJFQUtQT0lOVFNcIik7XG52YXIgYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlcjIgPSB7XG4gIHNldChfdGFyZ2V0LCBfcHJvcCwgX3ZhbHVlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBpc0V4dGVuc2libGUoX3RhcmdldCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgc2V0UHJvdG90eXBlT2YoX3RhcmdldCwgX3ZhbHVlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBkZWxldGVQcm9wZXJ0eShfdGFyZ2V0LCBfcHJvcCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcbnZhciBtYWtlRVByb3h5SGFuZGxlcjIgPSAocmVjaXBpZW50LCBIYW5kbGVkUHJvbWlzZTIsIHVud3JhcCkgPT4gaGFyZGVuKHtcbiAgLi4uYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlcjIsXG4gIGdldDogKF90YXJnZXQsIHByb3BlcnR5S2V5LCByZWNlaXZlcikgPT4ge1xuICAgIHJldHVybiBoYXJkZW4oXG4gICAgICB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgW3Byb3BlcnR5S2V5XSguLi5hcmdzKSB7XG4gICAgICAgICAgaWYgKHRoaXMgIT09IHJlY2VpdmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gSGFuZGxlZFByb21pc2UyLnJlamVjdChcbiAgICAgICAgICAgICAgbWFrZUVycm9yKFxuICAgICAgICAgICAgICAgIHJlZGFjdGVkYFVuZXhwZWN0ZWQgcmVjZWl2ZXIgZm9yIFwiJHtxdW90ZShwcm9wZXJ0eUtleSl9XCIgbWV0aG9kIG9mIEUoJHtxdW90ZShcbiAgICAgICAgICAgICAgICAgIHJlY2lwaWVudFxuICAgICAgICAgICAgICAgICl9KWBcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG9uU2VuZDIgJiYgb25TZW5kMi5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgcHJvcGVydHlLZXkpKSB7XG4gICAgICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHVud3JhcChcbiAgICAgICAgICAgIEhhbmRsZWRQcm9taXNlMi5hcHBseU1ldGhvZCh1bndyYXAocmVjaXBpZW50KSwgcHJvcGVydHlLZXksIGFyZ3MpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICAvL1xuICAgICAgfVtwcm9wZXJ0eUtleV1cbiAgICApO1xuICB9LFxuICBhcHBseTogKF90YXJnZXQsIF90aGlzQXJnLCBhcmdBcnJheSA9IFtdKSA9PiB7XG4gICAgaWYgKG9uU2VuZDIgJiYgb25TZW5kMi5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgdm9pZCAwKSkge1xuICAgICAgZGVidWdnZXI7XG4gICAgfVxuICAgIHJldHVybiB1bndyYXAoSGFuZGxlZFByb21pc2UyLmFwcGx5RnVuY3Rpb24odW53cmFwKHJlY2lwaWVudCksIGFyZ0FycmF5KSk7XG4gIH0sXG4gIGhhczogKF90YXJnZXQsIF9wKSA9PiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn0pO1xudmFyIG1ha2VFU2VuZE9ubHlQcm94eUhhbmRsZXIyID0gKHJlY2lwaWVudCwgSGFuZGxlZFByb21pc2UyLCB1bndyYXApID0+IGhhcmRlbih7XG4gIC4uLmJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIyLFxuICBnZXQ6IChfdGFyZ2V0LCBwcm9wZXJ0eUtleSwgcmVjZWl2ZXIpID0+IHtcbiAgICByZXR1cm4gaGFyZGVuKFxuICAgICAge1xuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFtwcm9wZXJ0eUtleV0oLi4uYXJncykge1xuICAgICAgICAgIHRoaXMgPT09IHJlY2VpdmVyIHx8IHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCByZWNlaXZlciBmb3IgXCIke3F1b3RlKFxuICAgICAgICAgICAgcHJvcGVydHlLZXlcbiAgICAgICAgICApfVwiIG1ldGhvZCBvZiBFLnNlbmRPbmx5KCR7cXVvdGUocmVjaXBpZW50KX0pYDtcbiAgICAgICAgICBpZiAob25TZW5kMiAmJiBvblNlbmQyLnNob3VsZEJyZWFrcG9pbnQocmVjaXBpZW50LCBwcm9wZXJ0eUtleSkpIHtcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgIH1cbiAgICAgICAgICBIYW5kbGVkUHJvbWlzZTIuYXBwbHlNZXRob2RTZW5kT25seShcbiAgICAgICAgICAgIHVud3JhcChyZWNpcGllbnQpLFxuICAgICAgICAgICAgcHJvcGVydHlLZXksXG4gICAgICAgICAgICBhcmdzXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICB9XG4gICAgICAgIC8vXG4gICAgICB9W3Byb3BlcnR5S2V5XVxuICAgICk7XG4gIH0sXG4gIGFwcGx5OiAoX3RhcmdldCwgX3RoaXNBcmcsIGFyZ3NBcnJheSA9IFtdKSA9PiB7XG4gICAgaWYgKG9uU2VuZDIgJiYgb25TZW5kMi5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgdm9pZCAwKSkge1xuICAgICAgZGVidWdnZXI7XG4gICAgfVxuICAgIEhhbmRsZWRQcm9taXNlMi5hcHBseUZ1bmN0aW9uU2VuZE9ubHkodW53cmFwKHJlY2lwaWVudCksIGFyZ3NBcnJheSk7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfSxcbiAgaGFzOiAoX3RhcmdldCwgX3ApID0+IHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufSk7XG52YXIgbWFrZUVHZXRQcm94eUhhbmRsZXIyID0gKHgsIEhhbmRsZWRQcm9taXNlMiwgdW53cmFwKSA9PiBoYXJkZW4oe1xuICAuLi5iYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyMixcbiAgaGFzOiAoX3RhcmdldCwgX3Byb3ApID0+IHRydWUsXG4gIGdldDogKF90YXJnZXQsIHByb3ApID0+IEhhbmRsZWRQcm9taXNlMi5nZXQodW53cmFwKHgpLCBwcm9wKVxufSk7XG52YXIgcmVzb2x2ZSA9ICh4KSA9PiBIYW5kbGVkUHJvbWlzZS5yZXNvbHZlKHgpO1xudmFyIG1ha2VFMiA9IChIYW5kbGVkUHJvbWlzZTIsIHBvd2VycyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBhZGRpdGlvbmFsID0gKFxuICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAge31cbiAgICApLFxuICAgIHVud3JhcCA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgcmVzb2x2ZVxuICAgIClcbiAgfSA9IHBvd2VycztcbiAgcmV0dXJuIGhhcmRlbihcbiAgICBhc3NpZ24yKFxuICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICAoeCkgPT4gaGFyZGVuKFxuICAgICAgICBuZXcgUHJveHkoKCkgPT4ge1xuICAgICAgICB9LCBtYWtlRVByb3h5SGFuZGxlcjIoeCwgSGFuZGxlZFByb21pc2UyLCB1bndyYXApKVxuICAgICAgKSxcbiAgICAgIHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGdldDogKHgpID0+IGhhcmRlbihcbiAgICAgICAgICBuZXcgUHJveHkoXG4gICAgICAgICAgICBjcmVhdGU2KG51bGwpLFxuICAgICAgICAgICAgbWFrZUVHZXRQcm94eUhhbmRsZXIyKHgsIEhhbmRsZWRQcm9taXNlMiwgdW53cmFwKVxuICAgICAgICAgIClcbiAgICAgICAgKSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgcmVzb2x2ZTogKHgpID0+IHJlc29sdmUodW53cmFwKHgpKSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZE9ubHk6ICh4KSA9PiBoYXJkZW4oXG4gICAgICAgICAgbmV3IFByb3h5KFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1ha2VFU2VuZE9ubHlQcm94eUhhbmRsZXIyKHgsIEhhbmRsZWRQcm9taXNlMiwgdW53cmFwKVxuICAgICAgICAgIClcbiAgICAgICAgKSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICB3aGVuOiAoeCwgb25mdWxmaWxsZWQsIG9ucmVqZWN0ZWQpID0+IHtcbiAgICAgICAgICBjb25zdCB1bndyYXBwZWQgPSByZXNvbHZlKHVud3JhcCh4KSk7XG4gICAgICAgICAgaWYgKG9uZnVsZmlsbGVkID09IG51bGwgJiYgb25yZWplY3RlZCA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gdW53cmFwcGVkO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdW53cmFwcGVkLnRoZW4oXG4gICAgICAgICAgICAuLi50cmFja1R1cm5zMihcbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgW29uZnVsZmlsbGVkLCBvbnJlamVjdGVkXVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBhZGRpdGlvbmFsXG4gICAgKVxuICApO1xufTtcbnZhciBFX2RlZmF1bHQyID0gbWFrZUUyO1xuXG4vL1xudmFyIGlzUmV0cnlhYmxlUmVhc29uID0gKHJlYXNvbiwgcHJpb3JSZXRyeVZhbHVlKSA9PiB7XG4gIGlmIChpc1VwZ3JhZGVEaXNjb25uZWN0aW9uKHJlYXNvbikgJiYgKCFpc1VwZ3JhZGVEaXNjb25uZWN0aW9uKHByaW9yUmV0cnlWYWx1ZSkgfHwgcmVhc29uLmluY2FybmF0aW9uTnVtYmVyID4gcHJpb3JSZXRyeVZhbHVlLmluY2FybmF0aW9uTnVtYmVyKSkge1xuICAgIHJldHVybiByZWFzb247XG4gIH1cbiAgaWYgKGlzQWJhbmRvbmVkRXJyb3IocmVhc29uKSAmJiAhaXNBYmFuZG9uZWRFcnJvcihwcmlvclJldHJ5VmFsdWUpKSB7XG4gICAgcmV0dXJuIHJlYXNvbjtcbiAgfVxuICByZXR1cm4gdm9pZCAwO1xufTtcbnZhciBkZWZhdWx0UG93ZXJzID0gaGFyZGVuKHtcbiAgaXNSZXRyeWFibGVSZWFzb25cbn0pO1xudmFyIHByZXBhcmVTd2luZ3NldFZvd1Rvb2xzID0gKHpvbmUsIHBvd2VycyA9IHt9KSA9PiBwcmVwYXJlQmFzaWNWb3dUb29scyh6b25lLCB7IC4uLmRlZmF1bHRQb3dlcnMsIC4uLnBvd2VycyB9KTtcbmhhcmRlbihwcmVwYXJlU3dpbmdzZXRWb3dUb29scyk7XG52YXIgaGVhcFZvd1Rvb2xzID0gcHJlcGFyZVN3aW5nc2V0Vm93VG9vbHMobWFrZUhlYXBab25lKCkpO1xudmFyIGhlYXBWb3dFID0gRV9kZWZhdWx0MihnbG9iYWxUaGlzLkhhbmRsZWRQcm9taXNlLCB7XG4gIHVud3JhcDogaGVhcFZvd1Rvb2xzLndoZW4sXG4gIGFkZGl0aW9uYWw6IHsgd2hlbjogaGVhcFZvd1Rvb2xzLndoZW4gfVxufSk7XG5cbi8vXG52YXIgT3V0Ym91bmRDb25uZWN0aW9uSGFuZGxlckkgPSBNLmludGVyZmFjZShcbiAgXCJPdXRib3VuZENvbm5lY3Rpb25IYW5kbGVyXCIsXG4gIHtcbiAgICBvbk9wZW46IE0uY2FsbFdoZW4oTS5hbnkoKSwgTS5zdHJpbmcoKSwgTS5zdHJpbmcoKSwgTS5hbnkoKSkucmV0dXJucyhcbiAgICAgIE0uYW55KClcbiAgICApLFxuICAgIG9uQ2xvc2U6IE0uY2FsbFdoZW4oTS5hbnkoKSwgTS5hbnkoKSwgTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICB9XG4pO1xudmFyIENvc21vc0NoYWluQWRkcmVzc1NoYXBlID0ge1xuICBjaGFpbklkOiBNLnN0cmluZygpLFxuICAvL1xuICBlbmNvZGluZzogTS5zdHJpbmcoKSxcbiAgdmFsdWU6IE0uc3RyaW5nKClcbn07XG5oYXJkZW4oQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpO1xudmFyIENhaXAxMFJlY29yZFNoYXBlID0ge1xuICBuYW1lc3BhY2U6IE0uc3RyaW5nKCksXG4gIHJlZmVyZW5jZTogTS5zdHJpbmcoKSxcbiAgYWNjb3VudEFkZHJlc3M6IE0uc3RyaW5nKClcbn07XG5oYXJkZW4oQ2FpcDEwUmVjb3JkU2hhcGUpO1xudmFyIEFjY291bnRJZEFyZ1NoYXBlID0gTS5vcihNLnN0cmluZygpLCBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSk7XG52YXIgUHJvdG8zU2hhcGUgPSB7IHR5cGVVcmw6IE0uc3RyaW5nKCksIHZhbHVlOiBNLnN0cmluZygpIH07XG5oYXJkZW4oUHJvdG8zU2hhcGUpO1xudmFyIElCQ0NoYW5uZWxJRFNoYXBlID0gTS5zdHJpbmcoKTtcbnZhciBJQkNDaGFubmVsSW5mb1NoYXBlID0gTS5zcGxpdFJlY29yZCh7XG4gIHBvcnRJZDogTS5zdHJpbmcoKSxcbiAgY2hhbm5lbElkOiBJQkNDaGFubmVsSURTaGFwZSxcbiAgY291bnRlclBhcnR5UG9ydElkOiBNLnN0cmluZygpLFxuICBjb3VudGVyUGFydHlDaGFubmVsSWQ6IElCQ0NoYW5uZWxJRFNoYXBlLFxuICBvcmRlcmluZzogTS5zY2FsYXIoKSxcbiAgLy9cbiAgc3RhdGU6IE0uc2NhbGFyKCksXG4gIC8vXG4gIHZlcnNpb246IE0uc3RyaW5nKClcbn0pO1xudmFyIElCQ0Nvbm5lY3Rpb25JRFNoYXBlID0gTS5zdHJpbmcoKTtcbnZhciBJQkNDb25uZWN0aW9uSW5mb1NoYXBlID0gTS5zcGxpdFJlY29yZCh7XG4gIGlkOiBJQkNDb25uZWN0aW9uSURTaGFwZSxcbiAgY2xpZW50X2lkOiBNLnN0cmluZygpLFxuICBzdGF0ZTogTS5zY2FsYXIoKSxcbiAgLy9cbiAgY291bnRlcnBhcnR5OiB7XG4gICAgY2xpZW50X2lkOiBNLnN0cmluZygpLFxuICAgIGNvbm5lY3Rpb25faWQ6IElCQ0Nvbm5lY3Rpb25JRFNoYXBlXG4gIH0sXG4gIHRyYW5zZmVyQ2hhbm5lbDogSUJDQ2hhbm5lbEluZm9TaGFwZVxufSk7XG52YXIgQ29zbW9zQXNzZXRJbmZvU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHtcbiAgYmFzZTogTS5zdHJpbmcoKSxcbiAgbmFtZTogTS5zdHJpbmcoKSxcbiAgZGlzcGxheTogTS5zdHJpbmcoKSxcbiAgc3ltYm9sOiBNLnN0cmluZygpLFxuICBkZW5vbV91bml0czogTS5hcnJheU9mKFxuICAgIE0uc3BsaXRSZWNvcmQoeyBkZW5vbTogTS5zdHJpbmcoKSwgZXhwb25lbnQ6IE0ubnVtYmVyKCkgfSlcbiAgKVxufSk7XG52YXIgQ2hhaW5JbmZvUmVxdWlyZWRTaGFwZSA9IHtcbiAgbmFtZXNwYWNlOiBNLnN0cmluZygpLFxuICByZWZlcmVuY2U6IE0uc3RyaW5nKClcbn07XG52YXIgQ2hhaW5JbmZvT3B0aW9uYWxTaGFwZSA9IHtcbiAgY2N0cERlc3RpbmF0aW9uRG9tYWluOiBNLm51bWJlcigpXG59O1xudmFyIEJhc2VDaGFpbkluZm9TaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIENoYWluSW5mb1JlcXVpcmVkU2hhcGUsXG4gIENoYWluSW5mb09wdGlvbmFsU2hhcGVcbik7XG5oYXJkZW4oQmFzZUNoYWluSW5mb1NoYXBlKTtcbnZhciBDb3Ntb3NDaGFpbkluZm9TaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBjaGFpbklkOiBNLnN0cmluZygpLFxuICAgIGJlY2gzMlByZWZpeDogTS5zdHJpbmcoKSxcbiAgICAuLi5DaGFpbkluZm9SZXF1aXJlZFNoYXBlXG4gIH0sXG4gIHtcbiAgICBjb25uZWN0aW9uczogTS5yZWNvcmQoKSxcbiAgICAvL1xuICAgIGljcUVuYWJsZWQ6IE0uYm9vbGVhbigpLFxuICAgIHBmbUVuYWJsZWQ6IE0uYm9vbGVhbigpLFxuICAgIHN0YWtpbmdUb2tlbnM6IE0uYXJyYXlPZih7IGRlbm9tOiBNLnN0cmluZygpIH0pLFxuICAgIC4uLkNoYWluSW5mb09wdGlvbmFsU2hhcGVcbiAgfVxuKTtcbmhhcmRlbihDb3Ntb3NDaGFpbkluZm9TaGFwZSk7XG52YXIgQ2hhaW5JbmZvU2hhcGUgPSBNLm9yKENvc21vc0NoYWluSW5mb1NoYXBlLCBCYXNlQ2hhaW5JbmZvU2hhcGUpO1xuaGFyZGVuKENoYWluSW5mb1NoYXBlKTtcbnZhciBEZW5vbVNoYXBlID0gTS5zdHJpbmcoKTtcbnZhciBDb2luU2hhcGUgPSB7XG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIGFtb3VudDogTS5zdHJpbmcoKSxcbiAgZGVub206IERlbm9tU2hhcGVcbn07XG5oYXJkZW4oQ29pblNoYXBlKTtcbnZhciBEZW5vbUluZm9TaGFwZSA9IHtcbiAgY2hhaW46IE0ucmVtb3RhYmxlKFwiQ2hhaW5cIiksXG4gIGJhc2U6IE0ucmVtb3RhYmxlKFwiQ2hhaW5cIiksXG4gIGJyYW5kOiBNLm9yKE0ucmVtb3RhYmxlKFwiQnJhbmRcIiksIE0udW5kZWZpbmVkKCkpLFxuICBiYXNlRGVub206IE0uc3RyaW5nKClcbn07XG5oYXJkZW4oRGVub21JbmZvU2hhcGUpO1xudmFyIERlbm9tRGV0YWlsU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7IGNoYWluTmFtZTogTS5zdHJpbmcoKSwgYmFzZU5hbWU6IE0uc3RyaW5nKCksIGJhc2VEZW5vbTogTS5zdHJpbmcoKSB9LFxuICB7IGJyYW5kOiBCcmFuZFNoYXBlIH1cbik7XG5oYXJkZW4oRGVub21EZXRhaWxTaGFwZSk7XG52YXIgRGVub21BbW91bnRTaGFwZSA9IHsgZGVub206IERlbm9tU2hhcGUsIHZhbHVlOiBNLm5hdCgpIH07XG5oYXJkZW4oRGVub21BbW91bnRTaGFwZSk7XG52YXIgQW55TmF0QW1vdW50U2hhcGUgPSB7XG4gIGJyYW5kOiBNLnJlbW90YWJsZShcIkJyYW5kXCIpLFxuICB2YWx1ZTogTS5uYXQoKVxufTtcbmhhcmRlbihBbnlOYXRBbW91bnRTaGFwZSk7XG52YXIgQW1vdW50QXJnU2hhcGUgPSBNLm9yKEFueU5hdEFtb3VudFNoYXBlLCBEZW5vbUFtb3VudFNoYXBlKTtcbnZhciBEZWxlZ2F0aW9uU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgdmFsaWRhdG9yOiBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICBhbW91bnQ6IEFtb3VudEFyZ1NoYXBlXG4gIH0sXG4gIHsgZGVsZWdhdG9yOiBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSB9XG4pO1xudmFyIElDUU1zZ1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAgeyBwYXRoOiBNLnN0cmluZygpLCBkYXRhOiBNLnN0cmluZygpIH0sXG4gIHsgaGVpZ2h0OiBNLnN0cmluZygpLCBwcm92ZTogTS5ib29sZWFuKCkgfVxuKTtcbnZhciBUeXBlZEpzb25TaGFwZSA9IE0uc3BsaXRSZWNvcmQoeyBcIkB0eXBlXCI6IE0uc3RyaW5nKCkgfSk7XG52YXIgY2hhaW5GYWNhZGVNZXRob2RzID0ge1xuICBnZXRDaGFpbkluZm86IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpLFxuICBtYWtlQWNjb3VudDogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSlcbn07XG5oYXJkZW4oY2hhaW5GYWNhZGVNZXRob2RzKTtcbnZhciBUaW1lc3RhbXBQcm90b1NoYXBlID0geyBzZWNvbmRzOiBNLnN0cmluZygpLCBuYW5vczogTS5udW1iZXIoKSB9O1xuaGFyZGVuKFRpbWVzdGFtcFByb3RvU2hhcGUpO1xudmFyIEV4ZWN1dGVJQ0FUeE9wdHNTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHt9LFxuICB7XG4gICAgbWVtbzogTS5zdHJpbmcoKSxcbiAgICB0aW1lb3V0SGVpZ2h0OiBNLmJpZ2ludCgpLFxuICAgIGV4dGVuc2lvbk9wdGlvbnM6IE0uYXJyYXlPZihNLmFueSgpKSxcbiAgICBub25Dcml0aWNhbEV4dGVuc2lvbk9wdGlvbnM6IE0uYXJyYXlPZihNLmFueSgpKSxcbiAgICBzZW5kT3B0czogU2VuZE9wdGlvbnNTaGFwZVxuICB9XG4pO1xudmFyIEFueU5hdEFtb3VudHNSZWNvcmQgPSBNLmFuZChcbiAgTS5yZWNvcmRPZihNLnN0cmluZygpLCBBbnlOYXRBbW91bnRTaGFwZSksXG4gIE0ubm90KHt9KVxuKTtcbnZhciBPcmNoZXN0cmF0aW9uUG93ZXJzU2hhcGUgPSB7XG4gIGFnb3JpY05hbWVzOiBNLnJlbW90YWJsZSgpLFxuICBsb2NhbGNoYWluOiBNLnJlbW90YWJsZSgpLFxuICBvcmNoZXN0cmF0aW9uU2VydmljZTogTS5yZW1vdGFibGUoKSxcbiAgc3RvcmFnZU5vZGU6IE0ucmVtb3RhYmxlKCksXG4gIHRpbWVyU2VydmljZTogTS5yZW1vdGFibGUoKVxufTtcbmhhcmRlbihPcmNoZXN0cmF0aW9uUG93ZXJzU2hhcGUpO1xudmFyIEZvcndhcmRBcmdzU2hhcGUgPSB7XG4gIHJlY2VpdmVyOiBNLnN0cmluZygpLFxuICBwb3J0OiBcInRyYW5zZmVyXCIsXG4gIGNoYW5uZWw6IE0uc3RyaW5nKCksXG4gIHRpbWVvdXQ6IE0uc3RyaW5nKCksXG4gIHJldHJpZXM6IE0ubnVtYmVyKClcbn07XG5oYXJkZW4oRm9yd2FyZEFyZ3NTaGFwZSk7XG52YXIgRm9yd2FyZEluZm9TaGFwZSA9IHtcbiAgZm9yd2FyZDogTS5zcGxpdFJlY29yZChGb3J3YXJkQXJnc1NoYXBlLCB7XG4gICAgLypcblxuXG4gICAgICovXG4gICAgbmV4dDoge1xuICAgICAgZm9yd2FyZDogRm9yd2FyZEFyZ3NTaGFwZVxuICAgIH1cbiAgfSlcbn07XG5oYXJkZW4oRm9yd2FyZEluZm9TaGFwZSk7XG52YXIgRm9yd2FyZE9wdHNTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHt9LFxuICB7XG4gICAgdGltZW91dDogTS5zdHJpbmcoKSxcbiAgICByZXRyaWVzOiBNLm51bWJlcigpLFxuICAgIGludGVybWVkaWF0ZVJlY2lwaWVudDogQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGVcbiAgfSxcbiAge31cbik7XG52YXIgSUJDVHJhbnNmZXJPcHRpb25zU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7fSxcbiAge1xuICAgIHRpbWVvdXRUaW1lc3RhbXA6IE0uYmlnaW50KCksXG4gICAgdGltZW91dEhlaWdodDoge1xuICAgICAgcmV2aXNpb25IZWlnaHQ6IE0uYmlnaW50KCksXG4gICAgICByZXZpc2lvbk51bWJlcjogTS5iaWdpbnQoKVxuICAgIH0sXG4gICAgdGltZW91dFJlbGF0aXZlU2Vjb25kczogTS5iaWdpbnQoKSxcbiAgICBtZW1vOiBNLnN0cmluZygpLFxuICAgIGZvcndhcmRPcHRzOiBGb3J3YXJkT3B0c1NoYXBlXG4gIH1cbik7XG5cbi8vXG52YXIgVHhTdGF0dXMgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBPYnNlcnZlZDogXCJPQlNFUlZFRFwiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQWR2YW5jaW5nOiBcIkFEVkFOQ0lOR1wiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBBZHZhbmNlZDogXCJBRFZBTkNFRFwiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQWR2YW5jZUZhaWxlZDogXCJBRFZBTkNFX0ZBSUxFRFwiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBBZHZhbmNlU2tpcHBlZDogXCJBRFZBTkNFX1NLSVBQRURcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgRGlzYnVyc2VkOiBcIkRJU0JVUlNFRFwiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgRm9yd2FyZGVkU2tpcHBlZDogXCJGT1JXQVJEX1NLSVBQRURcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBGb3J3YXJkZWQ6IFwiRk9SV0FSREVEXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEZvcndhcmRGYWlsZWQ6IFwiRk9SV0FSRF9GQUlMRURcIlxuICB9XG4pO1xuaGFyZGVuKFR4U3RhdHVzKTtcbnZhciBUZXJtaW5hbFR4U3RhdHVzID0ge1xuICBbVHhTdGF0dXMuRm9yd2FyZGVkXTogdHJ1ZSxcbiAgW1R4U3RhdHVzLkZvcndhcmRGYWlsZWRdOiB0cnVlLFxuICBbVHhTdGF0dXMuRGlzYnVyc2VkXTogdHJ1ZVxufTtcbnZhciBQZW5kaW5nVHhTdGF0dXMgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEFkdmFuY2luZzogXCJBRFZBTkNJTkdcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEFkdmFuY2VGYWlsZWQ6IFwiQURWQU5DRV9GQUlMRURcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQWR2YW5jZWQ6IFwiQURWQU5DRURcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQWR2YW5jZVNraXBwZWQ6IFwiQURWQU5DRV9TS0lQUEVEXCJcbiAgfVxuKTtcbmhhcmRlbihQZW5kaW5nVHhTdGF0dXMpO1xuXG4vL1xudmFyIG1ha2VOYXRBbW91bnRTaGFwZSA9IChicmFuZCwgbWluKSA9PiBoYXJkZW4oeyBicmFuZCwgdmFsdWU6IG1pbiA/IE0uZ3RlKG1pbikgOiBNLm5hdCgpIH0pO1xudmFyIG1ha2VQcm9wb3NhbFNoYXBlcyA9ICh7IFBvb2xTaGFyZXMsIFVTREMgfSkgPT4ge1xuICBjb25zdCBkZXBvc2l0ID0gTS5zcGxpdFJlY29yZCh7XG4gICAgZ2l2ZTogeyBVU0RDOiBtYWtlTmF0QW1vdW50U2hhcGUoVVNEQywgMW4pIH0sXG4gICAgd2FudDogeyBQb29sU2hhcmU6IG1ha2VOYXRBbW91bnRTaGFwZShQb29sU2hhcmVzKSB9XG4gIH0pO1xuICBjb25zdCB3aXRoZHJhdyA9IE0uc3BsaXRSZWNvcmQoe1xuICAgIGdpdmU6IHsgUG9vbFNoYXJlOiBtYWtlTmF0QW1vdW50U2hhcGUoUG9vbFNoYXJlcywgMW4pIH0sXG4gICAgd2FudDogeyBVU0RDOiBtYWtlTmF0QW1vdW50U2hhcGUoVVNEQywgMW4pIH1cbiAgfSk7XG4gIGNvbnN0IHdpdGhkcmF3RmVlcyA9IE0uc3BsaXRSZWNvcmQoe1xuICAgIHdhbnQ6IHsgVVNEQzogbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDFuKSB9XG4gIH0pO1xuICByZXR1cm4gaGFyZGVuKHsgZGVwb3NpdCwgd2l0aGRyYXcsIHdpdGhkcmF3RmVlcyB9KTtcbn07XG52YXIgRmFzdFVTRENUZXJtc1NoYXBlID0gaGFyZGVuKHtcbiAgdXNkY0Rlbm9tOiBNLnN0cmluZygpXG59KTtcbnZhciBFdm1BZGRyZXNzU2hhcGUgPSBNLnN0cmluZyh7XG4gIC8vXG4gIHN0cmluZ0xlbmd0aExpbWl0OiA0MlxufSk7XG5oYXJkZW4oRXZtQWRkcmVzc1NoYXBlKTtcbnZhciBFdm1IYXNoU2hhcGUgPSBNLnN0cmluZyh7XG4gIHN0cmluZ0xlbmd0aExpbWl0OiA2NlxufSk7XG5oYXJkZW4oRXZtSGFzaFNoYXBlKTtcbnZhciBSaXNrQXNzZXNzbWVudFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge30sXG4gIHtcbiAgICByaXNrc0lkZW50aWZpZWQ6IE0uYXJyYXlPZihNLnN0cmluZygpKVxuICB9XG4pO1xuaGFyZGVuKFJpc2tBc3Nlc3NtZW50U2hhcGUpO1xudmFyIENjdHBUeEV2aWRlbmNlU2hhcGUgPSB7XG4gIGF1eDoge1xuICAgIGZvcndhcmRpbmdDaGFubmVsOiBNLnN0cmluZygpLFxuICAgIHJlY2lwaWVudEFkZHJlc3M6IE0uc3RyaW5nKClcbiAgfSxcbiAgYmxvY2tIYXNoOiBFdm1IYXNoU2hhcGUsXG4gIGJsb2NrTnVtYmVyOiBNLm5hdCgpLFxuICBibG9ja1RpbWVzdGFtcDogTS5uYXQoKSxcbiAgY2hhaW5JZDogTS5udW1iZXIoKSxcbiAgdHg6IHtcbiAgICBhbW91bnQ6IE0ubmF0KCksXG4gICAgZm9yd2FyZGluZ0FkZHJlc3M6IE0uc3RyaW5nKCksXG4gICAgc2VuZGVyOiBFdm1BZGRyZXNzU2hhcGVcbiAgfSxcbiAgdHhIYXNoOiBFdm1IYXNoU2hhcGVcbn07XG5oYXJkZW4oQ2N0cFR4RXZpZGVuY2VTaGFwZSk7XG52YXIgRXZpZGVuY2VXaXRoUmlza1NoYXBlID0ge1xuICBldmlkZW5jZTogQ2N0cFR4RXZpZGVuY2VTaGFwZSxcbiAgcmlzazogUmlza0Fzc2Vzc21lbnRTaGFwZVxufTtcbmhhcmRlbihFdmlkZW5jZVdpdGhSaXNrU2hhcGUpO1xudmFyIFBlbmRpbmdUeFNoYXBlID0ge1xuICAuLi5DY3RwVHhFdmlkZW5jZVNoYXBlLFxuICBzdGF0dXM6IE0ub3IoLi4uT2JqZWN0LnZhbHVlcyhQZW5kaW5nVHhTdGF0dXMpKVxufTtcbmhhcmRlbihQZW5kaW5nVHhTaGFwZSk7XG52YXIgQWRkcmVzc0hvb2tTaGFwZSA9IHtcbiAgYmFzZUFkZHJlc3M6IE0uc3RyaW5nKCksXG4gIHF1ZXJ5OiB7IEVVRDogTS5zdHJpbmcoKSB9XG59O1xuaGFyZGVuKEFkZHJlc3NIb29rU2hhcGUpO1xudmFyIE5hdEFtb3VudFNoYXBlID0geyBicmFuZDogQnJhbmRTaGFwZSwgdmFsdWU6IE0ubmF0KCkgfTtcbnZhciBEZXN0aW5hdGlvbk92ZXJyaWRlc1NoYXBlID0gTS5yZWNvcmRPZihcbiAgTS5zdHJpbmcoKSxcbiAgTS5zcGxpdFJlY29yZChcbiAgICB7fSxcbiAgICB7XG4gICAgICBmbGF0OiBOYXRBbW91bnRTaGFwZSxcbiAgICAgIHZhcmlhYmxlUmF0ZTogUmF0aW9TaGFwZSxcbiAgICAgIGNvbnRyYWN0UmF0ZTogUmF0aW9TaGFwZSxcbiAgICAgIHJlbGF5OiBOYXRBbW91bnRTaGFwZVxuICAgIH1cbiAgKVxuKTtcbnZhciBGZWVDb25maWdTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBmbGF0OiBOYXRBbW91bnRTaGFwZSxcbiAgICB2YXJpYWJsZVJhdGU6IFJhdGlvU2hhcGUsXG4gICAgY29udHJhY3RSYXRlOiBSYXRpb1NoYXBlXG4gIH0sXG4gIHtcbiAgICByZWxheTogTmF0QW1vdW50U2hhcGUsXG4gICAgZGVzdGluYXRpb25PdmVycmlkZXM6IERlc3RpbmF0aW9uT3ZlcnJpZGVzU2hhcGVcbiAgfSxcbiAge31cbik7XG52YXIgUG9vbE1ldHJpY3NTaGFwZSA9IHtcbiAgZW5jdW1iZXJlZEJhbGFuY2U6IEFtb3VudFNoYXBlLFxuICBzaGFyZVdvcnRoOiBSYXRpb1NoYXBlLFxuICB0b3RhbENvbnRyYWN0RmVlczogQW1vdW50U2hhcGUsXG4gIHRvdGFsUG9vbEZlZXM6IEFtb3VudFNoYXBlLFxuICB0b3RhbEJvcnJvd3M6IEFtb3VudFNoYXBlLFxuICB0b3RhbFJlcGF5czogQW1vdW50U2hhcGVcbn07XG5oYXJkZW4oUG9vbE1ldHJpY3NTaGFwZSk7XG52YXIgQ2hhaW5Qb2xpY3lTaGFwZSA9IHtcbiAgYXR0ZW51YXRlZEN0dHBCcmlkZ2VBZGRyZXNzZXM6IE0uc3BsaXRBcnJheShcbiAgICBbRXZtSGFzaFNoYXBlXSxcbiAgICB2b2lkIDAsXG4gICAgTS5hcnJheU9mKEV2bUhhc2hTaGFwZSlcbiAgKSxcbiAgY2N0cFRva2VuTWVzc2VuZ2VyQWRkcmVzczogRXZtSGFzaFNoYXBlLFxuICBjb25maXJtYXRpb25zOiBNLm51bWJlcigpLFxuICBjaGFpbklkOiBNLm51bWJlcigpLFxuICByYXRlTGltaXRzOiB7XG4gICAgdHg6IE0uYmlnaW50KCksXG4gICAgYmxvY2tXaW5kb3c6IE0uYmlnaW50KCksXG4gICAgYmxvY2tXaW5kb3dTaXplOiBNLm51bWJlcigpXG4gIH1cbn07XG5oYXJkZW4oQ2hhaW5Qb2xpY3lTaGFwZSk7XG52YXIgRmVlZFBvbGljeVNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIG5vYmxlRG9tYWluSWQ6IE0ubnVtYmVyKCksXG4gICAgbm9ibGVBZ29yaWNDaGFubmVsSWQ6IE0uc3RyaW5nKCksXG4gICAgY2hhaW5Qb2xpY2llczogTS5yZWNvcmRPZihNLnN0cmluZygpLCBDaGFpblBvbGljeVNoYXBlKVxuICB9LFxuICB7IGV2ZW50RmlsdGVyOiBNLnN0cmluZygpIH1cbik7XG5oYXJkZW4oRmVlZFBvbGljeVNoYXBlKTtcbnZhciBDb3Ntb3NDaGFpbkluZm9TaGFwZVYxID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGNoYWluSWQ6IE0uc3RyaW5nKClcbiAgfSxcbiAge1xuICAgIGJlY2gzMlByZWZpeDogTS5zdHJpbmcoKSxcbiAgICBjb25uZWN0aW9uczogTS5yZWNvcmQoKSxcbiAgICBzdGFraW5nVG9rZW5zOiBNLmFycmF5T2YoeyBkZW5vbTogTS5zdHJpbmcoKSB9KSxcbiAgICAvL1xuICAgIGljcUVuYWJsZWQ6IE0uYm9vbGVhbigpLFxuICAgIHBmbUVuYWJsZWQ6IE0uYm9vbGVhbigpXG4gIH1cbik7XG52YXIgRmFzdFVTRENDb25maWdTaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICB0ZXJtczogRmFzdFVTRENUZXJtc1NoYXBlLFxuICBvcmFjbGVzOiBNLnJlY29yZE9mKE0uc3RyaW5nKCksIE0uc3RyaW5nKCkpLFxuICBmZWVDb25maWc6IEZlZUNvbmZpZ1NoYXBlLFxuICBmZWVkUG9saWN5OiBGZWVkUG9saWN5U2hhcGUsXG4gIGNoYWluSW5mbzogTS5yZWNvcmRPZihNLnN0cmluZygpLCBDb3Ntb3NDaGFpbkluZm9TaGFwZVYxKSxcbiAgYXNzZXRJbmZvOiBNLmFycmF5T2YoW0Rlbm9tU2hhcGUsIERlbm9tRGV0YWlsU2hhcGVdKVxufSk7XG5cbi8vXG52YXIgaW1wb3J0X2VuY29kaW5nID0gX190b0VTTShyZXF1aXJlX2J1aWxkKCksIDEpO1xuXG4vL1xuZnVuY3Rpb24gYmFzZShBTFBIQUJFVDIpIHtcbiAgaWYgKEFMUEhBQkVUMi5sZW5ndGggPj0gMjU1KSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFscGhhYmV0IHRvbyBsb25nXCIpO1xuICB9XG4gIGNvbnN0IEJBU0VfTUFQID0gbmV3IFVpbnQ4QXJyYXkoMjU2KTtcbiAgZm9yIChsZXQgaiA9IDA7IGogPCBCQVNFX01BUC5sZW5ndGg7IGorKykge1xuICAgIEJBU0VfTUFQW2pdID0gMjU1O1xuICB9XG4gIGZvciAobGV0IGkyID0gMDsgaTIgPCBBTFBIQUJFVDIubGVuZ3RoOyBpMisrKSB7XG4gICAgY29uc3QgeCA9IEFMUEhBQkVUMi5jaGFyQXQoaTIpO1xuICAgIGNvbnN0IHhjID0geC5jaGFyQ29kZUF0KDApO1xuICAgIGlmIChCQVNFX01BUFt4Y10gIT09IDI1NSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcih4ICsgXCIgaXMgYW1iaWd1b3VzXCIpO1xuICAgIH1cbiAgICBCQVNFX01BUFt4Y10gPSBpMjtcbiAgfVxuICBjb25zdCBCQVNFID0gQUxQSEFCRVQyLmxlbmd0aDtcbiAgY29uc3QgTEVBREVSID0gQUxQSEFCRVQyLmNoYXJBdCgwKTtcbiAgY29uc3QgRkFDVE9SID0gTWF0aC5sb2coQkFTRSkgLyBNYXRoLmxvZygyNTYpO1xuICBjb25zdCBpRkFDVE9SID0gTWF0aC5sb2coMjU2KSAvIE1hdGgubG9nKEJBU0UpO1xuICBmdW5jdGlvbiBlbmNvZGUyKHNvdXJjZSkge1xuICAgIGlmIChzb3VyY2UgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG4gICAgfSBlbHNlIGlmIChBcnJheUJ1ZmZlci5pc1ZpZXcoc291cmNlKSkge1xuICAgICAgc291cmNlID0gbmV3IFVpbnQ4QXJyYXkoc291cmNlLmJ1ZmZlciwgc291cmNlLmJ5dGVPZmZzZXQsIHNvdXJjZS5ieXRlTGVuZ3RoKTtcbiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoc291cmNlKSkge1xuICAgICAgc291cmNlID0gVWludDhBcnJheS5mcm9tKHNvdXJjZSk7XG4gICAgfVxuICAgIGlmICghKHNvdXJjZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRXhwZWN0ZWQgVWludDhBcnJheVwiKTtcbiAgICB9XG4gICAgaWYgKHNvdXJjZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgICBsZXQgemVyb2VzMiA9IDA7XG4gICAgbGV0IGxlbmd0aCA9IDA7XG4gICAgbGV0IHBiZWdpbiA9IDA7XG4gICAgY29uc3QgcGVuZCA9IHNvdXJjZS5sZW5ndGg7XG4gICAgd2hpbGUgKHBiZWdpbiAhPT0gcGVuZCAmJiBzb3VyY2VbcGJlZ2luXSA9PT0gMCkge1xuICAgICAgcGJlZ2luKys7XG4gICAgICB6ZXJvZXMyKys7XG4gICAgfVxuICAgIGNvbnN0IHNpemUgPSAocGVuZCAtIHBiZWdpbikgKiBpRkFDVE9SICsgMSA+Pj4gMDtcbiAgICBjb25zdCBiNTggPSBuZXcgVWludDhBcnJheShzaXplKTtcbiAgICB3aGlsZSAocGJlZ2luICE9PSBwZW5kKSB7XG4gICAgICBsZXQgY2FycnkgPSBzb3VyY2VbcGJlZ2luXTtcbiAgICAgIGxldCBpMiA9IDA7XG4gICAgICBmb3IgKGxldCBpdDEgPSBzaXplIC0gMTsgKGNhcnJ5ICE9PSAwIHx8IGkyIDwgbGVuZ3RoKSAmJiBpdDEgIT09IC0xOyBpdDEtLSwgaTIrKykge1xuICAgICAgICBjYXJyeSArPSAyNTYgKiBiNThbaXQxXSA+Pj4gMDtcbiAgICAgICAgYjU4W2l0MV0gPSBjYXJyeSAlIEJBU0UgPj4+IDA7XG4gICAgICAgIGNhcnJ5ID0gY2FycnkgLyBCQVNFID4+PiAwO1xuICAgICAgfVxuICAgICAgaWYgKGNhcnJ5ICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vbi16ZXJvIGNhcnJ5XCIpO1xuICAgICAgfVxuICAgICAgbGVuZ3RoID0gaTI7XG4gICAgICBwYmVnaW4rKztcbiAgICB9XG4gICAgbGV0IGl0MiA9IHNpemUgLSBsZW5ndGg7XG4gICAgd2hpbGUgKGl0MiAhPT0gc2l6ZSAmJiBiNThbaXQyXSA9PT0gMCkge1xuICAgICAgaXQyKys7XG4gICAgfVxuICAgIGxldCBzdHIgPSBMRUFERVIucmVwZWF0KHplcm9lczIpO1xuICAgIGZvciAoOyBpdDIgPCBzaXplOyArK2l0Mikge1xuICAgICAgc3RyICs9IEFMUEhBQkVUMi5jaGFyQXQoYjU4W2l0Ml0pO1xuICAgIH1cbiAgICByZXR1cm4gc3RyO1xuICB9XG4gIGZ1bmN0aW9uIGRlY29kZVVuc2FmZShzb3VyY2UpIHtcbiAgICBpZiAodHlwZW9mIHNvdXJjZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkV4cGVjdGVkIFN0cmluZ1wiKTtcbiAgICB9XG4gICAgaWYgKHNvdXJjZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSgpO1xuICAgIH1cbiAgICBsZXQgcHN6ID0gMDtcbiAgICBsZXQgemVyb2VzMiA9IDA7XG4gICAgbGV0IGxlbmd0aCA9IDA7XG4gICAgd2hpbGUgKHNvdXJjZVtwc3pdID09PSBMRUFERVIpIHtcbiAgICAgIHplcm9lczIrKztcbiAgICAgIHBzeisrO1xuICAgIH1cbiAgICBjb25zdCBzaXplID0gKHNvdXJjZS5sZW5ndGggLSBwc3opICogRkFDVE9SICsgMSA+Pj4gMDtcbiAgICBjb25zdCBiMjU2ID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZSk7XG4gICAgd2hpbGUgKHBzeiA8IHNvdXJjZS5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IGNoYXJDb2RlID0gc291cmNlLmNoYXJDb2RlQXQocHN6KTtcbiAgICAgIGlmIChjaGFyQ29kZSA+IDI1NSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsZXQgY2FycnkgPSBCQVNFX01BUFtjaGFyQ29kZV07XG4gICAgICBpZiAoY2FycnkgPT09IDI1NSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsZXQgaTIgPSAwO1xuICAgICAgZm9yIChsZXQgaXQzID0gc2l6ZSAtIDE7IChjYXJyeSAhPT0gMCB8fCBpMiA8IGxlbmd0aCkgJiYgaXQzICE9PSAtMTsgaXQzLS0sIGkyKyspIHtcbiAgICAgICAgY2FycnkgKz0gQkFTRSAqIGIyNTZbaXQzXSA+Pj4gMDtcbiAgICAgICAgYjI1NltpdDNdID0gY2FycnkgJSAyNTYgPj4+IDA7XG4gICAgICAgIGNhcnJ5ID0gY2FycnkgLyAyNTYgPj4+IDA7XG4gICAgICB9XG4gICAgICBpZiAoY2FycnkgIT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm9uLXplcm8gY2FycnlcIik7XG4gICAgICB9XG4gICAgICBsZW5ndGggPSBpMjtcbiAgICAgIHBzeisrO1xuICAgIH1cbiAgICBsZXQgaXQ0ID0gc2l6ZSAtIGxlbmd0aDtcbiAgICB3aGlsZSAoaXQ0ICE9PSBzaXplICYmIGIyNTZbaXQ0XSA9PT0gMCkge1xuICAgICAgaXQ0Kys7XG4gICAgfVxuICAgIGNvbnN0IHZjaCA9IG5ldyBVaW50OEFycmF5KHplcm9lczIgKyAoc2l6ZSAtIGl0NCkpO1xuICAgIGxldCBqID0gemVyb2VzMjtcbiAgICB3aGlsZSAoaXQ0ICE9PSBzaXplKSB7XG4gICAgICB2Y2hbaisrXSA9IGIyNTZbaXQ0KytdO1xuICAgIH1cbiAgICByZXR1cm4gdmNoO1xuICB9XG4gIGZ1bmN0aW9uIGRlY29kZTMoc3RyaW5nKSB7XG4gICAgY29uc3QgYnVmZmVyID0gZGVjb2RlVW5zYWZlKHN0cmluZyk7XG4gICAgaWYgKGJ1ZmZlcikge1xuICAgICAgcmV0dXJuIGJ1ZmZlcjtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTm9uLWJhc2VcIiArIEJBU0UgKyBcIiBjaGFyYWN0ZXJcIik7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBlbmNvZGU6IGVuY29kZTIsXG4gICAgZGVjb2RlVW5zYWZlLFxuICAgIGRlY29kZTogZGVjb2RlM1xuICB9O1xufVxudmFyIGVzbV9kZWZhdWx0ID0gYmFzZTtcblxuLy9cbnZhciBBTFBIQUJFVCA9IFwiMTIzNDU2Nzg5QUJDREVGR0hKS0xNTlBRUlNUVVZXWFlaYWJjZGVmZ2hpamttbm9wcXJzdHV2d3h5elwiO1xudmFyIGVzbV9kZWZhdWx0MiA9IGVzbV9kZWZhdWx0KEFMUEhBQkVUKTtcblxuLy9cbnZhciBtYWtlSUNBQ2hhbm5lbEFkZHJlc3MgPSAoaG9zdENvbm5lY3Rpb25JZCwgY29udHJvbGxlckNvbm5lY3Rpb25JZCwge1xuICB2ZXJzaW9uID0gXCJpY3MyNy0xXCIsXG4gIGVuY29kaW5nID0gXCJwcm90bzNcIixcbiAgb3JkZXJpbmcgPSBcIm9yZGVyZWRcIixcbiAgdHhUeXBlID0gXCJzZGtfbXVsdGlfbXNnXCJcbn0gPSB7fSkgPT4ge1xuICBob3N0Q29ubmVjdGlvbklkIHx8IHRocm93UmVkYWN0ZWRgaG9zdENvbm5lY3Rpb25JZCBpcyByZXF1aXJlZGA7XG4gIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQgfHwgdGhyb3dSZWRhY3RlZGBjb250cm9sbGVyQ29ubmVjdGlvbklkIGlzIHJlcXVpcmVkYDtcbiAgY29uc3QgY29ublN0cmluZyA9IEpTT04uc3RyaW5naWZ5KHtcbiAgICB2ZXJzaW9uLFxuICAgIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsXG4gICAgaG9zdENvbm5lY3Rpb25JZCxcbiAgICBhZGRyZXNzOiBcIlwiLFxuICAgIC8vXG4gICAgZW5jb2RpbmcsXG4gICAgdHhUeXBlXG4gIH0pO1xuICByZXR1cm4gYC9pYmMtaG9wLyR7Y29udHJvbGxlckNvbm5lY3Rpb25JZH0vaWJjLXBvcnQvaWNhaG9zdC8ke29yZGVyaW5nfS8ke2Nvbm5TdHJpbmd9YDtcbn07XG5oYXJkZW4obWFrZUlDQUNoYW5uZWxBZGRyZXNzKTtcbnZhciBERUZBVUxUX0lDUV9WRVJTSU9OID0gXCJpY3EtMVwiO1xudmFyIG1ha2VJQ1FDaGFubmVsQWRkcmVzcyA9IChjb250cm9sbGVyQ29ubmVjdGlvbklkLCB2ZXJzaW9uID0gREVGQVVMVF9JQ1FfVkVSU0lPTikgPT4ge1xuICBjb250cm9sbGVyQ29ubmVjdGlvbklkIHx8IHRocm93UmVkYWN0ZWRgY29udHJvbGxlckNvbm5lY3Rpb25JZCBpcyByZXF1aXJlZGA7XG4gIHJldHVybiBgL2liYy1ob3AvJHtjb250cm9sbGVyQ29ubmVjdGlvbklkfS9pYmMtcG9ydC9pY3Fob3N0L3Vub3JkZXJlZC8ke3ZlcnNpb259YDtcbn07XG5oYXJkZW4obWFrZUlDUUNoYW5uZWxBZGRyZXNzKTtcbnZhciBmaW5kQWRkcmVzc0ZpZWxkID0gKHJlbW90ZUFkZHJlc3NTdHJpbmcpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBqc29uU3RyID0gcmVtb3RlQWRkcmVzc1N0cmluZz8ubWF0Y2goL3suKj99Lyk/LlswXTtcbiAgICBjb25zdCBqc29uT2JqID0ganNvblN0ciA/IEpTT04ucGFyc2UoanNvblN0cikgOiB2b2lkIDA7XG4gICAgaWYgKCFqc29uT2JqPy5hZGRyZXNzPy5sZW5ndGgpIHJldHVybiB2b2lkIDA7XG4gICAgcmV0dXJuIGpzb25PYmouYWRkcmVzcztcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG59O1xuaGFyZGVuKGZpbmRBZGRyZXNzRmllbGQpO1xudmFyIGdldEJlY2gzMlByZWZpeCA9IChhZGRyZXNzKSA9PiB7XG4gIGFzc2VydChhZGRyZXNzLCBcImFkZHJlc3MgaXMgcmVxdWlyZWRcIik7XG4gIGNvbnN0IHNwbGl0ID0gYWRkcmVzcy5sYXN0SW5kZXhPZihcIjFcIik7XG4gIGlmIChzcGxpdCA9PT0gLTEpIHJldHVybiB0aHJvd1JlZGFjdGVkYE5vIHNlcGFyYXRvciBjaGFyYWN0ZXIgZm9yICR7cXVvdGUoYWRkcmVzcyl9YDtcbiAgaWYgKHNwbGl0ID09PSAwKSByZXR1cm4gdGhyb3dSZWRhY3RlZGBNaXNzaW5nIHByZWZpeCBmb3IgJHtxdW90ZShhZGRyZXNzKX1gO1xuICByZXR1cm4gYWRkcmVzcy5zbGljZSgwLCBzcGxpdCk7XG59O1xudmFyIGNvZXJjZUFjY291bnRJZCA9IChpZEFyZykgPT4ge1xuICBpZiAodHlwZW9mIGlkQXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIGlkQXJnO1xuICB9XG4gIHJldHVybiBgY29zbW9zOiR7aWRBcmcuY2hhaW5JZH06JHtpZEFyZy52YWx1ZX1gO1xufTtcbmhhcmRlbihjb2VyY2VBY2NvdW50SWQpO1xudmFyIHBhcnNlQWNjb3VudElkQXJnID0gKGlkQXJnKSA9PiB7XG4gIGlmICh0eXBlb2YgaWRBcmcgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gcGFyc2VBY2NvdW50SWQoaWRBcmcpO1xuICB9XG4gIHJldHVybiB7XG4gICAgbmFtZXNwYWNlOiBcImNvc21vc1wiLFxuICAgIHJlZmVyZW5jZTogaWRBcmcuY2hhaW5JZCxcbiAgICBhY2NvdW50QWRkcmVzczogaWRBcmcudmFsdWVcbiAgfTtcbn07XG5oYXJkZW4ocGFyc2VBY2NvdW50SWRBcmcpO1xudmFyIHBhcnNlQWNjb3VudElkID0gKGFjY291bnRJZCkgPT4ge1xuICBjb25zdCBwYXJ0cyA9IGFjY291bnRJZC5zcGxpdChcIjpcIik7XG4gIHBhcnRzLmxlbmd0aCA9PT0gMyB8fCB0aHJvd1JlZGFjdGVkYG1hbGZvcm1lZCBDQUlQLTEwIGFjY291bnRJZDogJHtxdW90ZShhY2NvdW50SWQpfWA7XG4gIGNvbnN0IFtuYW1lc3BhY2UsIHJlZmVyZW5jZSwgYWNjb3VudEFkZHJlc3NdID0gcGFydHM7XG4gIHJldHVybiB7XG4gICAgbmFtZXNwYWNlLFxuICAgIHJlZmVyZW5jZSxcbiAgICBhY2NvdW50QWRkcmVzc1xuICB9O1xufTtcbmhhcmRlbihwYXJzZUFjY291bnRJZCk7XG52YXIgY2hhaW5PZkFjY291bnQgPSAoYWNjb3VudElkQXJnKSA9PiB7XG4gIGNvbnN0IHsgbmFtZXNwYWNlLCByZWZlcmVuY2UgfSA9IHBhcnNlQWNjb3VudElkQXJnKGFjY291bnRJZEFyZyk7XG4gIHJldHVybiBgJHtuYW1lc3BhY2V9OiR7cmVmZXJlbmNlfWA7XG59O1xudmFyIGlzQmVjaDMyQWRkcmVzcyA9IChhZGRyZXNzKSA9PiB7XG4gIGlmICh0eXBlb2YgYWRkcmVzcyAhPT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICB0cnkge1xuICAgIGNvbnN0IGRlY29kZWQgPSAoMCwgaW1wb3J0X2VuY29kaW5nLmZyb21CZWNoMzIpKGFkZHJlc3MpO1xuICAgIHJldHVybiAhIWRlY29kZWQgJiYgZGVjb2RlZC5kYXRhLmxlbmd0aCA+IDA7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuaGFyZGVuKGlzQmVjaDMyQWRkcmVzcyk7XG52YXIgYXNzZXJ0QmVjaDMyQWRkcmVzcyA9IChhZGRyZXNzKSA9PiB7XG4gIGlmICghaXNCZWNoMzJBZGRyZXNzKGFkZHJlc3MpKSB7XG4gICAgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCBhIHZhbGlkIEJlY2gzMiBhZGRyZXNzLCBnb3QgJHtxdW90ZShhZGRyZXNzKX1gO1xuICB9XG59O1xuaGFyZGVuKGFzc2VydEJlY2gzMkFkZHJlc3MpO1xudmFyIGxlZnRQYWRFdGhBZGRyZXNzVG8zMkJ5dGVzID0gKHJhd0FkZHJlc3MpID0+IHtcbiAgY29uc3QgY2xlYW5lZEFkZHJlc3MgPSByYXdBZGRyZXNzLnJlcGxhY2UoL14weC8sIFwiXCIpO1xuICBjb25zdCB6ZXJvZXNOZWVkZWQgPSA2NCAtIGNsZWFuZWRBZGRyZXNzLmxlbmd0aDtcbiAgY29uc3QgcGFkZGVkQWRkcmVzcyA9IFwiMFwiLnJlcGVhdCh6ZXJvZXNOZWVkZWQpICsgY2xlYW5lZEFkZHJlc3M7XG4gIHJldHVybiAoMCwgaW1wb3J0X2VuY29kaW5nLmZyb21IZXgpKHBhZGRlZEFkZHJlc3MpO1xufTtcbnZhciBzb2xhbmFBZGRyZXNzVG9DY3RwUmVjaXBpZW50ID0gKHNvbGFuYUFkZHJlc3MpID0+IGVzbV9kZWZhdWx0Mi5kZWNvZGUoc29sYW5hQWRkcmVzcyk7XG52YXIgYWNjb3VudElkVG8zMkJ5dGVzID0gKGFjY291bnRJZCkgPT4ge1xuICBjb25zdCB7IG5hbWVzcGFjZSwgYWNjb3VudEFkZHJlc3MgfSA9IHBhcnNlQWNjb3VudElkKGFjY291bnRJZCk7XG4gIHN3aXRjaCAobmFtZXNwYWNlKSB7XG4gICAgY2FzZSBcImVpcDE1NVwiOlxuICAgICAgcmV0dXJuIGxlZnRQYWRFdGhBZGRyZXNzVG8zMkJ5dGVzKGFjY291bnRBZGRyZXNzKTtcbiAgICBjYXNlIFwic29sYW5hXCI6XG4gICAgICByZXR1cm4gc29sYW5hQWRkcmVzc1RvQ2N0cFJlY2lwaWVudChhY2NvdW50QWRkcmVzcyk7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgbmFtZXNwYWNlICR7bmFtZXNwYWNlfSBub3Qgc3VwcG9ydGVkYCk7XG4gIH1cbn07XG5cbi8vXG5mdW5jdGlvbiB1dGY4TGVuZ3RoKHQ1KSB7XG4gIGxldCByNSA9IDAsIGUyID0gMDtcbiAgZm9yIChsZXQgbzIgPSAwOyBvMiA8IHQ1Lmxlbmd0aDsgKytvMikgZTIgPSB0NS5jaGFyQ29kZUF0KG8yKSwgZTIgPCAxMjggPyByNSArPSAxIDogZTIgPCAyMDQ4ID8gcjUgKz0gMiA6IDU1Mjk2ID09ICg2NDUxMiAmIGUyKSAmJiA1NjMyMCA9PSAoNjQ1MTIgJiB0NS5jaGFyQ29kZUF0KG8yICsgMSkpID8gKCsrbzIsIHI1ICs9IDQpIDogcjUgKz0gMztcbiAgcmV0dXJuIHI1O1xufVxuZnVuY3Rpb24gdXRmOFJlYWQodDUsIHI1LCBlMikge1xuICBpZiAoZTIgLSByNSA8IDEpIHJldHVybiBcIlwiO1xuICBjb25zdCBvMiA9IFtdO1xuICBsZXQgbjIsIGYyID0gW10sIGggPSAwO1xuICBmb3IgKDsgcjUgPCBlMjsgKSBuMiA9IHQ1W3I1KytdLCBuMiA8IDEyOCA/IG8yW2grK10gPSBuMiA6IG4yID4gMTkxICYmIG4yIDwgMjI0ID8gbzJbaCsrXSA9ICgzMSAmIG4yKSA8PCA2IHwgNjMgJiB0NVtyNSsrXSA6IG4yID4gMjM5ICYmIG4yIDwgMzY1ID8gKG4yID0gKCg3ICYgbjIpIDw8IDE4IHwgKDYzICYgdDVbcjUrK10pIDw8IDEyIHwgKDYzICYgdDVbcjUrK10pIDw8IDYgfCA2MyAmIHQ1W3I1KytdKSAtIDY1NTM2LCBvMltoKytdID0gNTUyOTYgKyAobjIgPj4gMTApLCBvMltoKytdID0gNTYzMjAgKyAoMTAyMyAmIG4yKSkgOiBvMltoKytdID0gKDE1ICYgbjIpIDw8IDEyIHwgKDYzICYgdDVbcjUrK10pIDw8IDYgfCA2MyAmIHQ1W3I1KytdLCBoID4gODE5MSAmJiAoKGYyIHx8IChmMiA9IFtdKSkucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLm8yKSksIGggPSAwKTtcbiAgcmV0dXJuIGYyID8gKGggJiYgZjIucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLm8yLnNsaWNlKDAsIGgpKSksIGYyLmpvaW4oXCJcIikpIDogU3RyaW5nLmZyb21DaGFyQ29kZSguLi5vMi5zbGljZSgwLCBoKSk7XG59XG5mdW5jdGlvbiB1dGY4V3JpdGUodDUsIHI1LCBlMikge1xuICBjb25zdCBvMiA9IGUyO1xuICBsZXQgbjIsIGYyO1xuICBmb3IgKGxldCBvMyA9IDA7IG8zIDwgdDUubGVuZ3RoOyArK28zKSBuMiA9IHQ1LmNoYXJDb2RlQXQobzMpLCBuMiA8IDEyOCA/IHI1W2UyKytdID0gbjIgOiBuMiA8IDIwNDggPyAocjVbZTIrK10gPSBuMiA+PiA2IHwgMTkyLCByNVtlMisrXSA9IDYzICYgbjIgfCAxMjgpIDogNTUyOTYgPT0gKDY0NTEyICYgbjIpICYmIDU2MzIwID09ICg2NDUxMiAmIChmMiA9IHQ1LmNoYXJDb2RlQXQobzMgKyAxKSkpID8gKG4yID0gNjU1MzYgKyAoKDEwMjMgJiBuMikgPDwgMTApICsgKDEwMjMgJiBmMiksICsrbzMsIHI1W2UyKytdID0gbjIgPj4gMTggfCAyNDAsIHI1W2UyKytdID0gbjIgPj4gMTIgJiA2MyB8IDEyOCwgcjVbZTIrK10gPSBuMiA+PiA2ICYgNjMgfCAxMjgsIHI1W2UyKytdID0gNjMgJiBuMiB8IDEyOCkgOiAocjVbZTIrK10gPSBuMiA+PiAxMiB8IDIyNCwgcjVbZTIrK10gPSBuMiA+PiA2ICYgNjMgfCAxMjgsIHI1W2UyKytdID0gNjMgJiBuMiB8IDEyOCk7XG4gIHJldHVybiBlMiAtIG8yO1xufVxuXG4vL1xuZnVuY3Rpb24gdmFyaW50NjRyZWFkKCkge1xuICBsZXQgdDUgPSAwLCByNSA9IDA7XG4gIGZvciAobGV0IG4zID0gMDsgbjMgPCAyODsgbjMgKz0gNykge1xuICAgIGxldCBvMiA9IHRoaXMuYnVmW3RoaXMucG9zKytdO1xuICAgIGlmICh0NSB8PSAoMTI3ICYgbzIpIDw8IG4zLCAhKDEyOCAmIG8yKSkgcmV0dXJuIHRoaXMuYXNzZXJ0Qm91bmRzKCksIFt0NSwgcjVdO1xuICB9XG4gIGxldCBuMiA9IHRoaXMuYnVmW3RoaXMucG9zKytdO1xuICBpZiAodDUgfD0gKDE1ICYgbjIpIDw8IDI4LCByNSA9ICgxMTIgJiBuMikgPj4gNCwgISgxMjggJiBuMikpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCBbdDUsIHI1XTtcbiAgZm9yIChsZXQgbjMgPSAzOyBuMyA8PSAzMTsgbjMgKz0gNykge1xuICAgIGxldCBvMiA9IHRoaXMuYnVmW3RoaXMucG9zKytdO1xuICAgIGlmIChyNSB8PSAoMTI3ICYgbzIpIDw8IG4zLCAhKDEyOCAmIG8yKSkgcmV0dXJuIHRoaXMuYXNzZXJ0Qm91bmRzKCksIFt0NSwgcjVdO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihcImludmFsaWQgdmFyaW50XCIpO1xufVxudmFyIHQgPSA0Mjk0OTY3Mjk2O1xuZnVuY3Rpb24gaW50NjRGcm9tU3RyaW5nKG8yKSB7XG4gIGNvbnN0IGkyID0gXCItXCIgPT09IG8yWzBdO1xuICBpMiAmJiAobzIgPSBvMi5zbGljZSgxKSk7XG4gIGNvbnN0IGUyID0gMWU2O1xuICBsZXQgczMgPSAwLCB1ID0gMDtcbiAgZnVuY3Rpb24gZjIocjUsIG4yKSB7XG4gICAgY29uc3QgaTMgPSBOdW1iZXIobzIuc2xpY2UocjUsIG4yKSk7XG4gICAgdSAqPSBlMiwgczMgPSBzMyAqIGUyICsgaTMsIHMzID49IHQgJiYgKHUgKz0gczMgLyB0IHwgMCwgczMgJT0gdCk7XG4gIH1cbiAgcmV0dXJuIGYyKC0yNCwgLTE4KSwgZjIoLTE4LCAtMTIpLCBmMigtMTIsIC02KSwgZjIoLTYpLCBpMiA/IG4oczMsIHUpIDogcihzMywgdSk7XG59XG5mdW5jdGlvbiBpbnQ2NFRvU3RyaW5nKHQ1LCBvMikge1xuICBsZXQgaTIgPSByKHQ1LCBvMik7XG4gIGNvbnN0IGUyID0gMjE0NzQ4MzY0OCAmIGkyLmhpO1xuICBlMiAmJiAoaTIgPSBuKGkyLmxvLCBpMi5oaSkpO1xuICBjb25zdCBzMyA9IHVJbnQ2NFRvU3RyaW5nKGkyLmxvLCBpMi5oaSk7XG4gIHJldHVybiBlMiA/IFwiLVwiICsgczMgOiBzMztcbn1cbmZ1bmN0aW9uIHVJbnQ2NFRvU3RyaW5nKHI1LCBuMikge1xuICBpZiAoeyBsbzogcjUsIGhpOiBuMiB9ID0gZnVuY3Rpb24odDUsIHI2KSB7XG4gICAgcmV0dXJuIHsgbG86IHQ1ID4+PiAwLCBoaTogcjYgPj4+IDAgfTtcbiAgfShyNSwgbjIpLCBuMiA8PSAyMDk3MTUxKSByZXR1cm4gU3RyaW5nKHQgKiBuMiArIHI1KTtcbiAgY29uc3QgaTIgPSAxNjc3NzIxNSAmIChyNSA+Pj4gMjQgfCBuMiA8PCA4KSwgZTIgPSBuMiA+PiAxNiAmIDY1NTM1O1xuICBsZXQgczMgPSAoMTY3NzcyMTUgJiByNSkgKyA2Nzc3MjE2ICogaTIgKyA2NzEwNjU2ICogZTIsIHUgPSBpMiArIDgxNDc0OTcgKiBlMiwgZjIgPSAyICogZTI7XG4gIGNvbnN0IGggPSAxZTc7XG4gIHJldHVybiBzMyA+PSBoICYmICh1ICs9IE1hdGguZmxvb3IoczMgLyBoKSwgczMgJT0gaCksIHUgPj0gaCAmJiAoZjIgKz0gTWF0aC5mbG9vcih1IC8gaCksIHUgJT0gaCksIGYyLnRvU3RyaW5nKCkgKyBvKHUpICsgbyhzMyk7XG59XG5mdW5jdGlvbiByKHQ1LCByNSkge1xuICByZXR1cm4geyBsbzogMCB8IHQ1LCBoaTogMCB8IHI1IH07XG59XG5mdW5jdGlvbiBuKHQ1LCBuMikge1xuICByZXR1cm4gbjIgPSB+bjIsIHQ1ID8gdDUgPSAxICsgfnQ1IDogbjIgKz0gMSwgcih0NSwgbjIpO1xufVxudmFyIG8gPSAodDUpID0+IHtcbiAgY29uc3QgcjUgPSBTdHJpbmcodDUpO1xuICByZXR1cm4gXCIwMDAwMDAwXCIuc2xpY2UocjUubGVuZ3RoKSArIHI1O1xufTtcbmZ1bmN0aW9uIHZhcmludDMycmVhZCgpIHtcbiAgbGV0IHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI1ID0gMTI3ICYgdDU7XG4gIGlmICghKDEyOCAmIHQ1KSkgcmV0dXJuIHRoaXMuYXNzZXJ0Qm91bmRzKCksIHI1O1xuICBpZiAodDUgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXSwgcjUgfD0gKDEyNyAmIHQ1KSA8PCA3LCAhKDEyOCAmIHQ1KSkgcmV0dXJuIHRoaXMuYXNzZXJ0Qm91bmRzKCksIHI1O1xuICBpZiAodDUgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXSwgcjUgfD0gKDEyNyAmIHQ1KSA8PCAxNCwgISgxMjggJiB0NSkpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCByNTtcbiAgaWYgKHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI1IHw9ICgxMjcgJiB0NSkgPDwgMjEsICEoMTI4ICYgdDUpKSByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgcjU7XG4gIHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI1IHw9ICgxNSAmIHQ1KSA8PCAyODtcbiAgZm9yIChsZXQgcjYgPSA1OyAxMjggJiB0NSAmJiByNiA8IDEwOyByNisrKSB0NSA9IHRoaXMuYnVmW3RoaXMucG9zKytdO1xuICBpZiAoMTI4ICYgdDUpIHRocm93IG5ldyBFcnJvcihcImludmFsaWQgdmFyaW50XCIpO1xuICByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgcjUgPj4+IDA7XG59XG5mdW5jdGlvbiB6ekVuY29kZSh0NSwgcjUpIHtcbiAgbGV0IG4yID0gcjUgPj4gMzE7XG4gIHJldHVybiByNSA9ICgocjUgPDwgMSB8IHQ1ID4+PiAzMSkgXiBuMikgPj4+IDAsIFt0NSA9ICh0NSA8PCAxIF4gbjIpID4+PiAwLCByNV07XG59XG5mdW5jdGlvbiB6ekRlY29kZSh0NSwgcjUpIHtcbiAgbGV0IG4yID0gLSgxICYgdDUpO1xuICByZXR1cm4gW3Q1ID0gKCh0NSA+Pj4gMSB8IHI1IDw8IDMxKSBeIG4yKSA+Pj4gMCwgcjUgPSAocjUgPj4+IDEgXiBuMikgPj4+IDBdO1xufVxuZnVuY3Rpb24gcmVhZFVJbnQzMih0NSwgcjUpIHtcbiAgcmV0dXJuICh0NVtyNV0gfCB0NVtyNSArIDFdIDw8IDggfCB0NVtyNSArIDJdIDw8IDE2KSArIDE2Nzc3MjE2ICogdDVbcjUgKyAzXTtcbn1cbmZ1bmN0aW9uIHJlYWRJbnQzMih0NSwgcjUpIHtcbiAgcmV0dXJuICh0NVtyNV0gfCB0NVtyNSArIDFdIDw8IDggfCB0NVtyNSArIDJdIDw8IDE2KSArICh0NVtyNSArIDNdIDw8IDI0KTtcbn1cbmZ1bmN0aW9uIHdyaXRlVmFyaW50MzIodDUsIHI1LCBuMikge1xuICBmb3IgKDsgdDUgPiAxMjc7ICkgcjVbbjIrK10gPSAxMjcgJiB0NSB8IDEyOCwgdDUgPj4+PSA3O1xuICByNVtuMl0gPSB0NTtcbn1cbmZ1bmN0aW9uIHdyaXRlVmFyaW50NjQodDUsIHI1LCBuMikge1xuICBmb3IgKDsgdDUuaGk7ICkgcjVbbjIrK10gPSAxMjcgJiB0NS5sbyB8IDEyOCwgdDUubG8gPSAodDUubG8gPj4+IDcgfCB0NS5oaSA8PCAyNSkgPj4+IDAsIHQ1LmhpID4+Pj0gNztcbiAgZm9yICg7IHQ1LmxvID4gMTI3OyApIHI1W24yKytdID0gMTI3ICYgdDUubG8gfCAxMjgsIHQ1LmxvID0gdDUubG8gPj4+IDc7XG4gIHI1W24yKytdID0gdDUubG87XG59XG5mdW5jdGlvbiBpbnQ2NExlbmd0aCh0NSwgcjUpIHtcbiAgbGV0IG4yID0gKHQ1ID4+PiAyOCB8IHI1IDw8IDQpID4+PiAwLCBvMiA9IHI1ID4+PiAyNDtcbiAgcmV0dXJuIDAgPT09IG8yID8gMCA9PT0gbjIgPyB0NSA8IDE2Mzg0ID8gdDUgPCAxMjggPyAxIDogMiA6IHQ1IDwgMjA5NzE1MiA/IDMgOiA0IDogbjIgPCAxNjM4NCA/IG4yIDwgMTI4ID8gNSA6IDYgOiBuMiA8IDIwOTcxNTIgPyA3IDogOCA6IG8yIDwgMTI4ID8gOSA6IDEwO1xufVxuZnVuY3Rpb24gd3JpdGVGaXhlZDMyKHQ1LCByNSwgbjIpIHtcbiAgcjVbbjJdID0gMjU1ICYgdDUsIHI1W24yICsgMV0gPSB0NSA+Pj4gOCAmIDI1NSwgcjVbbjIgKyAyXSA9IHQ1ID4+PiAxNiAmIDI1NSwgcjVbbjIgKyAzXSA9IHQ1ID4+PiAyNDtcbn1cbmZ1bmN0aW9uIHdyaXRlQnl0ZSh0NSwgcjUsIG4yKSB7XG4gIHI1W24yXSA9IDI1NSAmIHQ1O1xufVxuXG4vL1xudmFyIFdpcmVUeXBlO1xuIWZ1bmN0aW9uKHQ1KSB7XG4gIHQ1W3Q1LlZhcmludCA9IDBdID0gXCJWYXJpbnRcIiwgdDVbdDUuRml4ZWQ2NCA9IDFdID0gXCJGaXhlZDY0XCIsIHQ1W3Q1LkJ5dGVzID0gMl0gPSBcIkJ5dGVzXCIsIHQ1W3Q1LkZpeGVkMzIgPSA1XSA9IFwiRml4ZWQzMlwiO1xufShXaXJlVHlwZSB8fCAoV2lyZVR5cGUgPSB7fSkpO1xudmFyIEJpbmFyeVJlYWRlciA9IGNsYXNzIHtcbiAgYnVmO1xuICBwb3M7XG4gIHR5cGU7XG4gIGxlbjtcbiAgYXNzZXJ0Qm91bmRzKCkge1xuICAgIGlmICh0aGlzLnBvcyA+IHRoaXMubGVuKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcInByZW1hdHVyZSBFT0ZcIik7XG4gIH1cbiAgY29uc3RydWN0b3IodDUpIHtcbiAgICB0aGlzLmJ1ZiA9IHQ1ID8gbmV3IFVpbnQ4QXJyYXkodDUpIDogbmV3IFVpbnQ4QXJyYXkoMCksIHRoaXMucG9zID0gMCwgdGhpcy50eXBlID0gMCwgdGhpcy5sZW4gPSB0aGlzLmJ1Zi5sZW5ndGg7XG4gIH1cbiAgdGFnKCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy51aW50MzIoKSwgaTIgPSB0NSA+Pj4gMywgczMgPSA3ICYgdDU7XG4gICAgaWYgKGkyIDw9IDAgfHwgczMgPCAwIHx8IHMzID4gNSkgdGhyb3cgbmV3IEVycm9yKFwiaWxsZWdhbCB0YWc6IGZpZWxkIG5vIFwiICsgaTIgKyBcIiB3aXJlIHR5cGUgXCIgKyBzMyk7XG4gICAgcmV0dXJuIFtpMiwgczMsIHQ1XTtcbiAgfVxuICBza2lwKHQ1KSB7XG4gICAgaWYgKFwibnVtYmVyXCIgPT0gdHlwZW9mIHQ1KSB7XG4gICAgICBpZiAodGhpcy5wb3MgKyB0NSA+IHRoaXMubGVuKSB0aHJvdyBCKHRoaXMsIHQ1KTtcbiAgICAgIHRoaXMucG9zICs9IHQ1O1xuICAgIH0gZWxzZSBkbyB7XG4gICAgICBpZiAodGhpcy5wb3MgPj0gdGhpcy5sZW4pIHRocm93IEIodGhpcyk7XG4gICAgfSB3aGlsZSAoMTI4ICYgdGhpcy5idWZbdGhpcy5wb3MrK10pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHNraXBUeXBlKHQ1KSB7XG4gICAgc3dpdGNoICh0NSkge1xuICAgICAgY2FzZSBXaXJlVHlwZS5WYXJpbnQ6XG4gICAgICAgIHRoaXMuc2tpcCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgV2lyZVR5cGUuRml4ZWQ2NDpcbiAgICAgICAgdGhpcy5za2lwKDgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgV2lyZVR5cGUuQnl0ZXM6XG4gICAgICAgIHRoaXMuc2tpcCh0aGlzLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGZvciAoOyA0ICE9ICh0NSA9IDcgJiB0aGlzLnVpbnQzMigpKTsgKSB0aGlzLnNraXBUeXBlKHQ1KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFdpcmVUeXBlLkZpeGVkMzI6XG4gICAgICAgIHRoaXMuc2tpcCg0KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBFcnJvcihcImludmFsaWQgd2lyZSB0eXBlIFwiICsgdDUgKyBcIiBhdCBvZmZzZXQgXCIgKyB0aGlzLnBvcyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHVpbnQzMigpIHtcbiAgICByZXR1cm4gdmFyaW50MzJyZWFkLmJpbmQodGhpcykoKTtcbiAgfVxuICBpbnQzMigpIHtcbiAgICByZXR1cm4gMCB8IHRoaXMudWludDMyKCk7XG4gIH1cbiAgc2ludDMyKCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy51aW50MzIoKTtcbiAgICByZXR1cm4gdDUgJSAyID09IDEgPyAodDUgKyAxKSAvIC0yIDogdDUgLyAyO1xuICB9XG4gIGZpeGVkMzIoKSB7XG4gICAgY29uc3QgdDUgPSByZWFkVUludDMyKHRoaXMuYnVmLCB0aGlzLnBvcyk7XG4gICAgcmV0dXJuIHRoaXMucG9zICs9IDQsIHQ1O1xuICB9XG4gIHNmaXhlZDMyKCkge1xuICAgIGNvbnN0IHQ1ID0gcmVhZEludDMyKHRoaXMuYnVmLCB0aGlzLnBvcyk7XG4gICAgcmV0dXJuIHRoaXMucG9zICs9IDQsIHQ1O1xuICB9XG4gIGludDY0KCkge1xuICAgIGNvbnN0IFt0NSwgaTJdID0gdmFyaW50NjRyZWFkLmJpbmQodGhpcykoKTtcbiAgICByZXR1cm4gQmlnSW50KGludDY0VG9TdHJpbmcodDUsIGkyKSk7XG4gIH1cbiAgdWludDY0KCkge1xuICAgIGNvbnN0IFt0NSwgaTJdID0gdmFyaW50NjRyZWFkLmJpbmQodGhpcykoKTtcbiAgICByZXR1cm4gQmlnSW50KHVJbnQ2NFRvU3RyaW5nKHQ1LCBpMikpO1xuICB9XG4gIHNpbnQ2NCgpIHtcbiAgICBsZXQgW3Q1LCBpMl0gPSB2YXJpbnQ2NHJlYWQuYmluZCh0aGlzKSgpO1xuICAgIHJldHVybiBbdDUsIGkyXSA9IHp6RGVjb2RlKHQ1LCBpMiksIEJpZ0ludChpbnQ2NFRvU3RyaW5nKHQ1LCBpMikpO1xuICB9XG4gIGZpeGVkNjQoKSB7XG4gICAgY29uc3QgdDUgPSB0aGlzLnNmaXhlZDMyKCksIGkyID0gdGhpcy5zZml4ZWQzMigpO1xuICAgIHJldHVybiBCaWdJbnQodUludDY0VG9TdHJpbmcodDUsIGkyKSk7XG4gIH1cbiAgc2ZpeGVkNjQoKSB7XG4gICAgY29uc3QgdDUgPSB0aGlzLnNmaXhlZDMyKCksIGkyID0gdGhpcy5zZml4ZWQzMigpO1xuICAgIHJldHVybiBCaWdJbnQoaW50NjRUb1N0cmluZyh0NSwgaTIpKTtcbiAgfVxuICBmbG9hdCgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJmbG9hdCBub3Qgc3VwcG9ydGVkXCIpO1xuICB9XG4gIGRvdWJsZSgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJkb3VibGUgbm90IHN1cHBvcnRlZFwiKTtcbiAgfVxuICBib29sKCkge1xuICAgIGNvbnN0IFt0NSwgaTJdID0gdmFyaW50NjRyZWFkLmJpbmQodGhpcykoKTtcbiAgICByZXR1cm4gMCAhPT0gdDUgfHwgMCAhPT0gaTI7XG4gIH1cbiAgYnl0ZXMoKSB7XG4gICAgY29uc3QgdDUgPSB0aGlzLnVpbnQzMigpLCBpMiA9IHRoaXMucG9zO1xuICAgIHJldHVybiB0aGlzLnBvcyArPSB0NSwgdGhpcy5hc3NlcnRCb3VuZHMoKSwgdGhpcy5idWYuc3ViYXJyYXkoaTIsIGkyICsgdDUpO1xuICB9XG4gIHN0cmluZygpIHtcbiAgICBjb25zdCB0NSA9IHRoaXMuYnl0ZXMoKTtcbiAgICByZXR1cm4gdXRmOFJlYWQodDUsIDAsIHQ1Lmxlbmd0aCk7XG4gIH1cbn07XG52YXIgdyA9IGNsYXNzIHtcbiAgZm47XG4gIGxlbjtcbiAgdmFsO1xuICBuZXh0O1xuICBjb25zdHJ1Y3Rvcih0NSwgaTIsIHMzKSB7XG4gICAgdGhpcy5mbiA9IHQ1LCB0aGlzLmxlbiA9IGkyLCB0aGlzLnZhbCA9IHMzO1xuICB9XG4gIHByb2NlZWQodDUsIGkyKSB7XG4gICAgdGhpcy5mbiAmJiB0aGlzLmZuKHRoaXMudmFsLCB0NSwgaTIpO1xuICB9XG59O1xudmFyIGIgPSBjbGFzcyB7XG4gIGhlYWQ7XG4gIHRhaWw7XG4gIGxlbjtcbiAgbmV4dDtcbiAgY29uc3RydWN0b3IodDUpIHtcbiAgICB0aGlzLmhlYWQgPSB0NS5oZWFkLCB0aGlzLnRhaWwgPSB0NS50YWlsLCB0aGlzLmxlbiA9IHQ1LmxlbiwgdGhpcy5uZXh0ID0gdDUuc3RhdGVzO1xuICB9XG59O1xudmFyIEJpbmFyeVdyaXRlciA9IGNsYXNzIF9CaW5hcnlXcml0ZXIge1xuICBsZW4gPSAwO1xuICBoZWFkO1xuICB0YWlsO1xuICBzdGF0ZXM7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaGVhZCA9IG5ldyB3KG51bGwsIDAsIDApLCB0aGlzLnRhaWwgPSB0aGlzLmhlYWQsIHRoaXMuc3RhdGVzID0gbnVsbDtcbiAgfVxuICBzdGF0aWMgY3JlYXRlKCkge1xuICAgIHJldHVybiBuZXcgX0JpbmFyeVdyaXRlcigpO1xuICB9XG4gIHN0YXRpYyBhbGxvYyh0NSkge1xuICAgIHJldHVybiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBVaW50OEFycmF5ID8gZnVuY3Rpb24odDYsIGkyLCBzMykge1xuICAgICAgY29uc3QgZTIgPSBzMyB8fCA4MTkyLCBuMiA9IGUyID4+PiAxO1xuICAgICAgbGV0IHI1ID0gbnVsbCwgaCA9IGUyO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKHM0KSB7XG4gICAgICAgIGlmIChzNCA8IDEgfHwgczQgPiBuMikgcmV0dXJuIHQ2KHM0KTtcbiAgICAgICAgaCArIHM0ID4gZTIgJiYgKHI1ID0gdDYoZTIpLCBoID0gMCk7XG4gICAgICAgIGNvbnN0IG8yID0gaTIuY2FsbChyNSwgaCwgaCArPSBzNCk7XG4gICAgICAgIHJldHVybiA3ICYgaCAmJiAoaCA9IDEgKyAoNyB8IGgpKSwgbzI7XG4gICAgICB9O1xuICAgIH0oKHQ2KSA9PiBuZXcgVWludDhBcnJheSh0NiksIFVpbnQ4QXJyYXkucHJvdG90eXBlLnN1YmFycmF5KSh0NSkgOiBuZXcgQXJyYXkodDUpO1xuICB9XG4gIF9wdXNoKHQ1LCBpMiwgczMpIHtcbiAgICByZXR1cm4gdGhpcy50YWlsID0gdGhpcy50YWlsLm5leHQgPSBuZXcgdyh0NSwgaTIsIHMzKSwgdGhpcy5sZW4gKz0gaTIsIHRoaXM7XG4gIH1cbiAgZmluaXNoKCkge1xuICAgIGxldCB0NSA9IHRoaXMuaGVhZC5uZXh0LCBpMiA9IDA7XG4gICAgY29uc3QgczMgPSBfQmluYXJ5V3JpdGVyLmFsbG9jKHRoaXMubGVuKTtcbiAgICBmb3IgKDsgdDU7ICkgdDUucHJvY2VlZChzMywgaTIpLCBpMiArPSB0NS5sZW4sIHQ1ID0gdDUubmV4dDtcbiAgICByZXR1cm4gczM7XG4gIH1cbiAgZm9yaygpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZXMgPSBuZXcgYih0aGlzKSwgdGhpcy5oZWFkID0gdGhpcy50YWlsID0gbmV3IHcobnVsbCwgMCwgMCksIHRoaXMubGVuID0gMCwgdGhpcztcbiAgfVxuICByZXNldCgpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZXMgPyAodGhpcy5oZWFkID0gdGhpcy5zdGF0ZXMuaGVhZCwgdGhpcy50YWlsID0gdGhpcy5zdGF0ZXMudGFpbCwgdGhpcy5sZW4gPSB0aGlzLnN0YXRlcy5sZW4sIHRoaXMuc3RhdGVzID0gdGhpcy5zdGF0ZXMubmV4dCkgOiAodGhpcy5oZWFkID0gdGhpcy50YWlsID0gbmV3IHcobnVsbCwgMCwgMCksIHRoaXMubGVuID0gMCksIHRoaXM7XG4gIH1cbiAgbGRlbGltKCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy5oZWFkLCBpMiA9IHRoaXMudGFpbCwgczMgPSB0aGlzLmxlbjtcbiAgICByZXR1cm4gdGhpcy5yZXNldCgpLnVpbnQzMihzMyksIHMzICYmICh0aGlzLnRhaWwubmV4dCA9IHQ1Lm5leHQsIHRoaXMudGFpbCA9IGkyLCB0aGlzLmxlbiArPSBzMyksIHRoaXM7XG4gIH1cbiAgdGFnKHQ1LCBpMikge1xuICAgIHJldHVybiB0aGlzLnVpbnQzMigodDUgPDwgMyB8IGkyKSA+Pj4gMCk7XG4gIH1cbiAgdWludDMyKHQ1KSB7XG4gICAgcmV0dXJuIHRoaXMubGVuICs9ICh0aGlzLnRhaWwgPSB0aGlzLnRhaWwubmV4dCA9IG5ldyB3KHdyaXRlVmFyaW50MzIsICh0NSA+Pj49IDApIDwgMTI4ID8gMSA6IHQ1IDwgMTYzODQgPyAyIDogdDUgPCAyMDk3MTUyID8gMyA6IHQ1IDwgMjY4NDM1NDU2ID8gNCA6IDUsIHQ1KSkubGVuLCB0aGlzO1xuICB9XG4gIGludDMyKHQ1KSB7XG4gICAgcmV0dXJuIHQ1IDwgMCA/IHRoaXMuX3B1c2god3JpdGVWYXJpbnQ2NCwgMTAsIGludDY0RnJvbVN0cmluZyh0NS50b1N0cmluZygpKSkgOiB0aGlzLnVpbnQzMih0NSk7XG4gIH1cbiAgc2ludDMyKHQ1KSB7XG4gICAgcmV0dXJuIHRoaXMudWludDMyKCh0NSA8PCAxIF4gdDUgPj4gMzEpID4+PiAwKTtcbiAgfVxuICBpbnQ2NCh0NSkge1xuICAgIGNvbnN0IHsgbG86IGkyLCBoaTogczMgfSA9IGludDY0RnJvbVN0cmluZyh0NS50b1N0cmluZygpKTtcbiAgICByZXR1cm4gdGhpcy5fcHVzaCh3cml0ZVZhcmludDY0LCBpbnQ2NExlbmd0aChpMiwgczMpLCB7IGxvOiBpMiwgaGk6IHMzIH0pO1xuICB9XG4gIHVpbnQ2NCA9IF9CaW5hcnlXcml0ZXIucHJvdG90eXBlLmludDY0O1xuICBzaW50NjQodDUpIHtcbiAgICBsZXQgeyBsbzogaTIsIGhpOiBzMyB9ID0gaW50NjRGcm9tU3RyaW5nKHQ1LnRvU3RyaW5nKCkpO1xuICAgIHJldHVybiBbaTIsIHMzXSA9IHp6RW5jb2RlKGkyLCBzMyksIHRoaXMuX3B1c2god3JpdGVWYXJpbnQ2NCwgaW50NjRMZW5ndGgoaTIsIHMzKSwgeyBsbzogaTIsIGhpOiBzMyB9KTtcbiAgfVxuICBmaXhlZDY0KHQ1KSB7XG4gICAgY29uc3QgeyBsbzogaTIsIGhpOiBzMyB9ID0gaW50NjRGcm9tU3RyaW5nKHQ1LnRvU3RyaW5nKCkpO1xuICAgIHJldHVybiB0aGlzLl9wdXNoKHdyaXRlRml4ZWQzMiwgNCwgaTIpLl9wdXNoKHdyaXRlRml4ZWQzMiwgNCwgczMpO1xuICB9XG4gIHNmaXhlZDY0ID0gX0JpbmFyeVdyaXRlci5wcm90b3R5cGUuZml4ZWQ2NDtcbiAgYm9vbCh0NSkge1xuICAgIHJldHVybiB0aGlzLl9wdXNoKHdyaXRlQnl0ZSwgMSwgdDUgPyAxIDogMCk7XG4gIH1cbiAgZml4ZWQzMih0NSkge1xuICAgIHJldHVybiB0aGlzLl9wdXNoKHdyaXRlRml4ZWQzMiwgNCwgdDUgPj4+IDApO1xuICB9XG4gIHNmaXhlZDMyID0gX0JpbmFyeVdyaXRlci5wcm90b3R5cGUuZml4ZWQzMjtcbiAgZmxvYXQodDUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJmbG9hdCBub3Qgc3VwcG9ydGVkXCIgKyB0NSk7XG4gIH1cbiAgZG91YmxlKHQ1KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiZG91YmxlIG5vdCBzdXBwb3J0ZWRcIiArIHQ1KTtcbiAgfVxuICBieXRlcyh0NSkge1xuICAgIGNvbnN0IGkyID0gdDUubGVuZ3RoID4+PiAwO1xuICAgIHJldHVybiBpMiA/IHRoaXMudWludDMyKGkyKS5fcHVzaChnLCBpMiwgdDUpIDogdGhpcy5fcHVzaCh3cml0ZUJ5dGUsIDEsIDApO1xuICB9XG4gIHN0cmluZyhpMikge1xuICAgIGNvbnN0IGUyID0gdXRmOExlbmd0aChpMik7XG4gICAgcmV0dXJuIGUyID8gdGhpcy51aW50MzIoZTIpLl9wdXNoKHV0ZjhXcml0ZSwgZTIsIGkyKSA6IHRoaXMuX3B1c2god3JpdGVCeXRlLCAxLCAwKTtcbiAgfVxufTtcbmZ1bmN0aW9uIGcodDUsIGkyLCBzMykge1xuICBpZiAoXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgVWludDhBcnJheSkgaTIuc2V0KHQ1LCBzMyk7XG4gIGVsc2UgZm9yIChsZXQgZTIgPSAwOyBlMiA8IHQ1Lmxlbmd0aDsgKytlMikgaTJbczMgKyBlMl0gPSB0NVtlMl07XG59XG5mdW5jdGlvbiBCKHQ1LCBpMikge1xuICByZXR1cm4gUmFuZ2VFcnJvcihcImluZGV4IG91dCBvZiByYW5nZTogXCIgKyB0NS5wb3MgKyBcIiArIFwiICsgKGkyIHx8IDEpICsgXCIgPiBcIiArIHQ1Lmxlbik7XG59XG5cbi8vXG5mdW5jdGlvbiBpc1NldCh0NSkge1xuICByZXR1cm4gbnVsbCAhPSB0NTtcbn1cbmZ1bmN0aW9uIHRvVGltZXN0YW1wKHQ1KSB7XG4gIHZhciBuMjtcbiAgcmV0dXJuIHsgc2Vjb25kczogKG4yID0gdDUuZ2V0VGltZSgpIC8gMWUzLCBCaWdJbnQoTWF0aC50cnVuYyhuMikpKSwgbmFub3M6IHQ1LmdldFRpbWUoKSAlIDFlMyAqIDFlNiB9O1xufVxuZnVuY3Rpb24gZnJvbVRpbWVzdGFtcCh0NSkge1xuICBsZXQgbjIgPSAxZTMgKiBOdW1iZXIodDUuc2Vjb25kcyk7XG4gIHJldHVybiBuMiArPSB0NS5uYW5vcyAvIDFlNiwgbmV3IERhdGUobjIpO1xufVxuZnVuY3Rpb24gZnJvbUpzb25UaW1lc3RhbXAodDUpIHtcbiAgcmV0dXJuIHQ1IGluc3RhbmNlb2YgRGF0ZSA/IHRvVGltZXN0YW1wKHQ1KSA6IFwic3RyaW5nXCIgPT0gdHlwZW9mIHQ1ID8gdG9UaW1lc3RhbXAobmV3IERhdGUodDUpKSA6IHsgc2Vjb25kczogaXNTZXQoKG4yID0gdDUpLnNlY29uZHMpID8gQmlnSW50KG4yLnNlY29uZHMudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG5hbm9zOiBpc1NldChuMi5uYW5vcykgPyBOdW1iZXIobjIubmFub3MpIDogMCB9O1xuICB2YXIgbjI7XG59XG5cbi8vXG5mdW5jdGlvbiBsKCkge1xuICByZXR1cm4geyAkdHlwZVVybDogXCIvZ29vZ2xlLnByb3RvYnVmLkFueVwiLCB0eXBlVXJsOiBcIlwiLCB2YWx1ZTogbmV3IFVpbnQ4QXJyYXkoKSB9O1xufVxudmFyIEFueSA9IHsgdHlwZVVybDogXCIvZ29vZ2xlLnByb3RvYnVmLkFueVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi50eXBlVXJsICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLnR5cGVVcmwpLCAwICE9PSBlMi52YWx1ZS5sZW5ndGggJiYgbzIudWludDMyKDE4KS5ieXRlcyhlMi52YWx1ZSksIG8yKSwgZGVjb2RlKHI1LCBvMikge1xuICBjb25zdCB0NSA9IHI1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gcjUgOiBuZXcgQmluYXJ5UmVhZGVyKHI1KTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSBvMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIG8yO1xuICBjb25zdCBhMiA9IGwoKTtcbiAgZm9yICg7IHQ1LnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBlMiA9IHQ1LnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTIgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgYTIudHlwZVVybCA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgYTIudmFsdWUgPSB0NS5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHQ1LnNraXBUeXBlKDcgJiBlMik7XG4gICAgfVxuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IHR5cGVVcmw6IGlzU2V0KGUyLnR5cGVVcmwpID8gU3RyaW5nKGUyLnR5cGVVcmwpIDogXCJcIiwgdmFsdWU6IGlzU2V0KGUyLnZhbHVlKSA/IGRlY29kZUJhc2U2NChlMi52YWx1ZSkgOiBuZXcgVWludDhBcnJheSgpIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgcjUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIudHlwZVVybCAmJiAocjUudHlwZVVybCA9IGUyLnR5cGVVcmwpLCB2b2lkIDAgIT09IGUyLnZhbHVlICYmIChyNS52YWx1ZSA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IGUyLnZhbHVlID8gZTIudmFsdWUgOiBuZXcgVWludDhBcnJheSgpKSksIHI1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgcjUgPSBsKCk7XG4gIHJldHVybiByNS50eXBlVXJsID0gZTIudHlwZVVybCA/PyBcIlwiLCByNS52YWx1ZSA9IGUyLnZhbHVlID8/IG5ldyBVaW50OEFycmF5KCksIHI1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IEFueS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IEFueS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2dvb2dsZS5wcm90b2J1Zi5BbnlcIiwgdmFsdWU6IEFueS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgU2lnbk1vZGU7XG4hZnVuY3Rpb24oZTIpIHtcbiAgZTJbZTIuU0lHTl9NT0RFX1VOU1BFQ0lGSUVEID0gMF0gPSBcIlNJR05fTU9ERV9VTlNQRUNJRklFRFwiLCBlMltlMi5TSUdOX01PREVfRElSRUNUID0gMV0gPSBcIlNJR05fTU9ERV9ESVJFQ1RcIiwgZTJbZTIuU0lHTl9NT0RFX1RFWFRVQUwgPSAyXSA9IFwiU0lHTl9NT0RFX1RFWFRVQUxcIiwgZTJbZTIuU0lHTl9NT0RFX0RJUkVDVF9BVVggPSAzXSA9IFwiU0lHTl9NT0RFX0RJUkVDVF9BVVhcIiwgZTJbZTIuU0lHTl9NT0RFX0xFR0FDWV9BTUlOT19KU09OID0gMTI3XSA9IFwiU0lHTl9NT0RFX0xFR0FDWV9BTUlOT19KU09OXCIsIGUyW2UyLlNJR05fTU9ERV9FSVBfMTkxID0gMTkxXSA9IFwiU0lHTl9NT0RFX0VJUF8xOTFcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0oU2lnbk1vZGUgfHwgKFNpZ25Nb2RlID0ge30pKTtcblxuLy9cbnZhciBEZWNpbWFsID0gY2xhc3MgX0RlY2ltYWwge1xuICBzdGF0aWMgZnJvbVVzZXJJbnB1dCh0NSwgaTIpIHtcbiAgICBfRGVjaW1hbC52ZXJpZnlGcmFjdGlvbmFsRGlnaXRzKGkyKTtcbiAgICBjb25zdCByNSA9IHQ1Lm1hdGNoKC9bXjAtOS5dLyk7XG4gICAgaWYgKHI1KSB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgY2hhcmFjdGVyIGF0IHBvc2l0aW9uICR7cjUuaW5kZXggKyAxfWApO1xuICAgIGxldCBhMiwgZTI7XG4gICAgaWYgKFwiXCIgPT09IHQ1KSBhMiA9IFwiMFwiLCBlMiA9IFwiXCI7XG4gICAgZWxzZSBpZiAoLTEgPT09IHQ1LnNlYXJjaCgvXFwuLykpIGEyID0gdDUsIGUyID0gXCJcIjtcbiAgICBlbHNlIHtcbiAgICAgIGNvbnN0IGkzID0gdDUuc3BsaXQoXCIuXCIpO1xuICAgICAgc3dpdGNoIChpMy5sZW5ndGgpIHtcbiAgICAgICAgY2FzZSAwOlxuICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmV3ZXIgdGhhbiB0d28gZWxlbWVudHMgaW4gc3BsaXQgcmVzdWx0LiBUaGlzIG11c3Qgbm90IGhhcHBlbiBoZXJlLlwiKTtcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgIGlmICghaTNbMV0pIHRocm93IG5ldyBFcnJvcihcIkZyYWN0aW9uYWwgcGFydCBtaXNzaW5nXCIpO1xuICAgICAgICAgIGEyID0gaTNbMF0sIGUyID0gaTNbMV0ucmVwbGFjZSgvMCskLywgXCJcIik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTW9yZSB0aGFuIG9uZSBzZXBhcmF0b3IgZm91bmRcIik7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChlMi5sZW5ndGggPiBpMikgdGhyb3cgbmV3IEVycm9yKFwiR290IG1vcmUgZnJhY3Rpb25hbCBkaWdpdHMgdGhhbiBzdXBwb3J0ZWRcIik7XG4gICAgY29uc3QgbjIgPSBgJHthMn0ke2UyLnBhZEVuZChpMiwgXCIwXCIpfWA7XG4gICAgcmV0dXJuIG5ldyBfRGVjaW1hbChuMiwgaTIpO1xuICB9XG4gIHN0YXRpYyBmcm9tQXRvbWljcyh0NSwgaTIpIHtcbiAgICByZXR1cm4gX0RlY2ltYWwudmVyaWZ5RnJhY3Rpb25hbERpZ2l0cyhpMiksIG5ldyBfRGVjaW1hbCh0NSwgaTIpO1xuICB9XG4gIHN0YXRpYyB2ZXJpZnlGcmFjdGlvbmFsRGlnaXRzKHQ1KSB7XG4gICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKHQ1KSkgdGhyb3cgbmV3IEVycm9yKFwiRnJhY3Rpb25hbCBkaWdpdHMgaXMgbm90IGFuIGludGVnZXJcIik7XG4gICAgaWYgKHQ1IDwgMCkgdGhyb3cgbmV3IEVycm9yKFwiRnJhY3Rpb25hbCBkaWdpdHMgbXVzdCBub3QgYmUgbmVnYXRpdmVcIik7XG4gICAgaWYgKHQ1ID4gMzApIHRocm93IG5ldyBFcnJvcihcIkZyYWN0aW9uYWwgZGlnaXRzIG11c3Qgbm90IGV4Y2VlZCAzMFwiKTtcbiAgfVxuICBnZXQgYXRvbWljcygpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLmF0b21pY3MudG9TdHJpbmcoKTtcbiAgfVxuICBnZXQgZnJhY3Rpb25hbERpZ2l0cygpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLmZyYWN0aW9uYWxEaWdpdHM7XG4gIH1cbiAgZGF0YTtcbiAgY29uc3RydWN0b3IodDUsIGkyKSB7XG4gICAgaWYgKCF0NS5tYXRjaCgvXlswLTldKyQvKSkgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzdHJpbmcgZm9ybWF0LiBPbmx5IG5vbi1uZWdhdGl2ZSBpbnRlZ2VycyBpbiBkZWNpbWFsIHJlcHJlc2VudGF0aW9uIHN1cHBvcnRlZC5cIik7XG4gICAgdGhpcy5kYXRhID0geyBhdG9taWNzOiBCaWdJbnQodDUpLCBmcmFjdGlvbmFsRGlnaXRzOiBpMiB9O1xuICB9XG4gIHRvU3RyaW5nKCkge1xuICAgIGNvbnN0IHQ1ID0gQmlnSW50KDEwKSAqKiBCaWdJbnQodGhpcy5kYXRhLmZyYWN0aW9uYWxEaWdpdHMpLCBpMiA9IHRoaXMuZGF0YS5hdG9taWNzIC8gdDUsIHI1ID0gdGhpcy5kYXRhLmF0b21pY3MgJSB0NTtcbiAgICBpZiAoMG4gPT09IHI1KSByZXR1cm4gaTIudG9TdHJpbmcoKTtcbiAgICB7XG4gICAgICBjb25zdCB0NiA9IHI1LnRvU3RyaW5nKCkucGFkU3RhcnQodGhpcy5kYXRhLmZyYWN0aW9uYWxEaWdpdHMsIFwiMFwiKS5yZXBsYWNlKC8wKyQvLCBcIlwiKTtcbiAgICAgIHJldHVybiBgJHtpMi50b1N0cmluZygpfS4ke3Q2fWA7XG4gICAgfVxuICB9XG59O1xuXG4vL1xudmFyIENvaW4gPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnYxYmV0YTEuQ29pblwiLCBlbmNvZGU6IChvMiwgbjIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5kZW5vbSAmJiBuMi51aW50MzIoMTApLnN0cmluZyhvMi5kZW5vbSksIFwiXCIgIT09IG8yLmFtb3VudCAmJiBuMi51aW50MzIoMTgpLnN0cmluZyhvMi5hbW91bnQpLCBuMiksIGRlY29kZSh0NSwgbjIpIHtcbiAgY29uc3QgZTIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCByNSA9IHZvaWQgMCA9PT0gbjIgPyBlMi5sZW4gOiBlMi5wb3MgKyBuMjtcbiAgY29uc3QgczMgPSB7IGRlbm9tOiBcIlwiLCBhbW91bnQ6IFwiXCIgfTtcbiAgZm9yICg7IGUyLnBvcyA8IHI1OyApIHtcbiAgICBjb25zdCBvMiA9IGUyLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzIgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczMuZGVub20gPSBlMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHMzLmFtb3VudCA9IGUyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGUyLnNraXBUeXBlKDcgJiBvMik7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMztcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGRlbm9tOiBpc1NldChvMi5kZW5vbSkgPyBTdHJpbmcobzIuZGVub20pIDogXCJcIiwgYW1vdW50OiBpc1NldChvMi5hbW91bnQpID8gU3RyaW5nKG8yLmFtb3VudCkgOiBcIlwiIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZGVub20gJiYgKHQ1LmRlbm9tID0gbzIuZGVub20pLCB2b2lkIDAgIT09IG8yLmFtb3VudCAmJiAodDUuYW1vdW50ID0gbzIuYW1vdW50KSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgZGVub206IFwiXCIsIGFtb3VudDogXCJcIiB9O1xuICByZXR1cm4gdDUuZGVub20gPSBvMi5kZW5vbSA/PyBcIlwiLCB0NS5hbW91bnQgPSBvMi5hbW91bnQgPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gQ29pbi5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IENvaW4uZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS52MWJldGExLkNvaW5cIiwgdmFsdWU6IENvaW4uZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIERlY0NvaW4gPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnYxYmV0YTEuRGVjQ29pblwiLCBlbmNvZGU6IChvMiwgbjIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5kZW5vbSAmJiBuMi51aW50MzIoMTApLnN0cmluZyhvMi5kZW5vbSksIFwiXCIgIT09IG8yLmFtb3VudCAmJiBuMi51aW50MzIoMTgpLnN0cmluZyhEZWNpbWFsLmZyb21Vc2VySW5wdXQobzIuYW1vdW50LCAxOCkuYXRvbWljcyksIG4yKSwgZGVjb2RlKHQ1LCBuMikge1xuICBjb25zdCByNSA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IHMzID0gdm9pZCAwID09PSBuMiA/IHI1LmxlbiA6IHI1LnBvcyArIG4yO1xuICBjb25zdCBpMiA9IHsgZGVub206IFwiXCIsIGFtb3VudDogXCJcIiB9O1xuICBmb3IgKDsgcjUucG9zIDwgczM7ICkge1xuICAgIGNvbnN0IG8yID0gcjUudWludDMyKCk7XG4gICAgc3dpdGNoIChvMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5kZW5vbSA9IHI1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIuYW1vdW50ID0gRGVjaW1hbC5mcm9tQXRvbWljcyhyNS5zdHJpbmcoKSwgMTgpLnRvU3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcjUuc2tpcFR5cGUoNyAmIG8yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVub206IGlzU2V0KG8yLmRlbm9tKSA/IFN0cmluZyhvMi5kZW5vbSkgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KG8yLmFtb3VudCkgPyBTdHJpbmcobzIuYW1vdW50KSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZW5vbSAmJiAodDUuZGVub20gPSBvMi5kZW5vbSksIHZvaWQgMCAhPT0gbzIuYW1vdW50ICYmICh0NS5hbW91bnQgPSBvMi5hbW91bnQpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyBkZW5vbTogXCJcIiwgYW1vdW50OiBcIlwiIH07XG4gIHJldHVybiB0NS5kZW5vbSA9IG8yLmRlbm9tID8/IFwiXCIsIHQ1LmFtb3VudCA9IG8yLmFtb3VudCA/PyBcIlwiLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBEZWNDb2luLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gRGVjQ29pbi5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnYxYmV0YTEuRGVjQ29pblwiLCB2YWx1ZTogRGVjQ29pbi5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG5mdW5jdGlvbiBnMigpIHtcbiAgcmV0dXJuIHsgbWVzc2FnZXM6IFtdLCBtZW1vOiBcIlwiLCB0aW1lb3V0SGVpZ2h0OiBCaWdJbnQoMCksIGV4dGVuc2lvbk9wdGlvbnM6IFtdLCBub25Dcml0aWNhbEV4dGVuc2lvbk9wdGlvbnM6IFtdIH07XG59XG52YXIgVHhCb2R5ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MudHgudjFiZXRhMS5UeEJvZHlcIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IG4yIG9mIGUyLm1lc3NhZ2VzKSBBbnkuZW5jb2RlKG4yLCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIFwiXCIgIT09IGUyLm1lbW8gJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIubWVtbyksIGUyLnRpbWVvdXRIZWlnaHQgIT09IEJpZ0ludCgwKSAmJiB0NS51aW50MzIoMjQpLnVpbnQ2NChlMi50aW1lb3V0SGVpZ2h0KTtcbiAgZm9yIChjb25zdCBuMiBvZiBlMi5leHRlbnNpb25PcHRpb25zKSBBbnkuZW5jb2RlKG4yLCB0NS51aW50MzIoODE4NikuZm9yaygpKS5sZGVsaW0oKTtcbiAgZm9yIChjb25zdCBuMiBvZiBlMi5ub25Dcml0aWNhbEV4dGVuc2lvbk9wdGlvbnMpIEFueS5lbmNvZGUobjIsIHQ1LnVpbnQzMigxNjM3OCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHQ1O1xufSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSB0NSA/IG4yLmxlbiA6IG4yLnBvcyArIHQ1O1xuICBjb25zdCByNSA9IGcyKCk7XG4gIGZvciAoOyBuMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1Lm1lc3NhZ2VzLnB1c2goQW55LmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1Lm1lbW8gPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHI1LnRpbWVvdXRIZWlnaHQgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDEwMjM6XG4gICAgICAgIHI1LmV4dGVuc2lvbk9wdGlvbnMucHVzaChBbnkuZGVjb2RlKG4yLCBuMi51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjA0NzpcbiAgICAgICAgcjUubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zLnB1c2goQW55LmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBtZXNzYWdlczogQXJyYXkuaXNBcnJheShlMj8ubWVzc2FnZXMpID8gZTIubWVzc2FnZXMubWFwKChlMykgPT4gQW55LmZyb21KU09OKGUzKSkgOiBbXSwgbWVtbzogaXNTZXQoZTIubWVtbykgPyBTdHJpbmcoZTIubWVtbykgOiBcIlwiLCB0aW1lb3V0SGVpZ2h0OiBpc1NldChlMi50aW1lb3V0SGVpZ2h0KSA/IEJpZ0ludChlMi50aW1lb3V0SGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBleHRlbnNpb25PcHRpb25zOiBBcnJheS5pc0FycmF5KGUyPy5leHRlbnNpb25PcHRpb25zKSA/IGUyLmV4dGVuc2lvbk9wdGlvbnMubWFwKChlMykgPT4gQW55LmZyb21KU09OKGUzKSkgOiBbXSwgbm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zOiBBcnJheS5pc0FycmF5KGUyPy5ub25Dcml0aWNhbEV4dGVuc2lvbk9wdGlvbnMpID8gZTIubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zLm1hcCgoZTMpID0+IEFueS5mcm9tSlNPTihlMykpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gZTIubWVzc2FnZXMgPyB0NS5tZXNzYWdlcyA9IGUyLm1lc3NhZ2VzLm1hcCgoZTMpID0+IGUzID8gQW55LnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUubWVzc2FnZXMgPSBbXSwgdm9pZCAwICE9PSBlMi5tZW1vICYmICh0NS5tZW1vID0gZTIubWVtbyksIHZvaWQgMCAhPT0gZTIudGltZW91dEhlaWdodCAmJiAodDUudGltZW91dEhlaWdodCA9IChlMi50aW1lb3V0SGVpZ2h0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIGUyLmV4dGVuc2lvbk9wdGlvbnMgPyB0NS5leHRlbnNpb25PcHRpb25zID0gZTIuZXh0ZW5zaW9uT3B0aW9ucy5tYXAoKGUzKSA9PiBlMyA/IEFueS50b0pTT04oZTMpIDogdm9pZCAwKSA6IHQ1LmV4dGVuc2lvbk9wdGlvbnMgPSBbXSwgZTIubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zID8gdDUubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zID0gZTIubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zLm1hcCgoZTMpID0+IGUzID8gQW55LnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zID0gW10sIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSBnMigpO1xuICByZXR1cm4gdDUubWVzc2FnZXMgPSBlMi5tZXNzYWdlcz8ubWFwKChlMykgPT4gQW55LmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1Lm1lbW8gPSBlMi5tZW1vID8/IFwiXCIsIHQ1LnRpbWVvdXRIZWlnaHQgPSB2b2lkIDAgIT09IGUyLnRpbWVvdXRIZWlnaHQgJiYgbnVsbCAhPT0gZTIudGltZW91dEhlaWdodCA/IEJpZ0ludChlMi50aW1lb3V0SGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB0NS5leHRlbnNpb25PcHRpb25zID0gZTIuZXh0ZW5zaW9uT3B0aW9ucz8ubWFwKChlMykgPT4gQW55LmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1Lm5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9ucyA9IGUyLm5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9ucz8ubWFwKChlMykgPT4gQW55LmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IFR4Qm9keS5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFR4Qm9keS5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy50eC52MWJldGExLlR4Qm9keVwiLCB2YWx1ZTogVHhCb2R5LmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbmZ1bmN0aW9uIHMoKSB7XG4gIHJldHVybiB7IHR5cGU6IFwiXCIsIGtleTogbmV3IFVpbnQ4QXJyYXkoKSwgZGF0YTogbmV3IFVpbnQ4QXJyYXkoKSB9O1xufVxudmFyIFByb29mT3AgPSB7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuY3J5cHRvLlByb29mT3BcIiwgZW5jb2RlOiAodDUsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gdDUudHlwZSAmJiBlMi51aW50MzIoMTApLnN0cmluZyh0NS50eXBlKSwgMCAhPT0gdDUua2V5Lmxlbmd0aCAmJiBlMi51aW50MzIoMTgpLmJ5dGVzKHQ1LmtleSksIDAgIT09IHQ1LmRhdGEubGVuZ3RoICYmIGUyLnVpbnQzMigyNikuYnl0ZXModDUuZGF0YSksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCBuMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IHI1ID0gdm9pZCAwID09PSBlMiA/IG4yLmxlbiA6IG4yLnBvcyArIGUyO1xuICBjb25zdCBpMiA9IHMoKTtcbiAgZm9yICg7IG4yLnBvcyA8IHI1OyApIHtcbiAgICBjb25zdCB0NSA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAodDUgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTIudHlwZSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIua2V5ID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGkyLmRhdGEgPSBuMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiB0NSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAodDUpID0+ICh7IHR5cGU6IGlzU2V0KHQ1LnR5cGUpID8gU3RyaW5nKHQ1LnR5cGUpIDogXCJcIiwga2V5OiBpc1NldCh0NS5rZXkpID8gZGVjb2RlQmFzZTY0KHQ1LmtleSkgOiBuZXcgVWludDhBcnJheSgpLCBkYXRhOiBpc1NldCh0NS5kYXRhKSA/IGRlY29kZUJhc2U2NCh0NS5kYXRhKSA6IG5ldyBVaW50OEFycmF5KCkgfSksIHRvSlNPTih0NSkge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSB0NS50eXBlICYmIChvMi50eXBlID0gdDUudHlwZSksIHZvaWQgMCAhPT0gdDUua2V5ICYmIChvMi5rZXkgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSB0NS5rZXkgPyB0NS5rZXkgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gdDUuZGF0YSAmJiAobzIuZGF0YSA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IHQ1LmRhdGEgPyB0NS5kYXRhIDogbmV3IFVpbnQ4QXJyYXkoKSkpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKHQ1KSB7XG4gIGNvbnN0IG8yID0gcygpO1xuICByZXR1cm4gbzIudHlwZSA9IHQ1LnR5cGUgPz8gXCJcIiwgbzIua2V5ID0gdDUua2V5ID8/IG5ldyBVaW50OEFycmF5KCksIG8yLmRhdGEgPSB0NS5kYXRhID8/IG5ldyBVaW50OEFycmF5KCksIG8yO1xufSwgZnJvbVByb3RvTXNnOiAodDUpID0+IFByb29mT3AuZGVjb2RlKHQ1LnZhbHVlKSwgdG9Qcm90bzogKHQ1KSA9PiBQcm9vZk9wLmVuY29kZSh0NSkuZmluaXNoKCksIHRvUHJvdG9Nc2c6ICh0NSkgPT4gKHsgdHlwZVVybDogXCIvdGVuZGVybWludC5jcnlwdG8uUHJvb2ZPcFwiLCB2YWx1ZTogUHJvb2ZPcC5lbmNvZGUodDUpLmZpbmlzaCgpIH0pIH07XG52YXIgUHJvb2ZPcHMgPSB7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuY3J5cHRvLlByb29mT3BzXCIsIGVuY29kZSh0NSwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBvMiBvZiB0NS5vcHMpIFByb29mT3AuZW5jb2RlKG8yLCBlMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiBlMjtcbn0sIGRlY29kZShvMiwgZTIpIHtcbiAgY29uc3QgbjIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCByNSA9IHZvaWQgMCA9PT0gZTIgPyBuMi5sZW4gOiBuMi5wb3MgKyBlMjtcbiAgY29uc3QgaTIgPSB7IG9wczogW10gfTtcbiAgZm9yICg7IG4yLnBvcyA8IHI1OyApIHtcbiAgICBjb25zdCB0NSA9IG4yLnVpbnQzMigpO1xuICAgIGlmICh0NSA+Pj4gMyA9PSAxKSBpMi5vcHMucHVzaChQcm9vZk9wLmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICBlbHNlIG4yLnNraXBUeXBlKDcgJiB0NSk7XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046ICh0NSkgPT4gKHsgb3BzOiBBcnJheS5pc0FycmF5KHQ1Py5vcHMpID8gdDUub3BzLm1hcCgodDYpID0+IFByb29mT3AuZnJvbUpTT04odDYpKSA6IFtdIH0pLCB0b0pTT04odDUpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHQ1Lm9wcyA/IG8yLm9wcyA9IHQ1Lm9wcy5tYXAoKHQ2KSA9PiB0NiA/IFByb29mT3AudG9KU09OKHQ2KSA6IHZvaWQgMCkgOiBvMi5vcHMgPSBbXSwgbzI7XG59LCBmcm9tUGFydGlhbCh0NSkge1xuICBjb25zdCBvMiA9IHsgb3BzOiBbXSB9O1xuICByZXR1cm4gbzIub3BzID0gdDUub3BzPy5tYXAoKHQ2KSA9PiBQcm9vZk9wLmZyb21QYXJ0aWFsKHQ2KSkgfHwgW10sIG8yO1xufSwgZnJvbVByb3RvTXNnOiAodDUpID0+IFByb29mT3BzLmRlY29kZSh0NS52YWx1ZSksIHRvUHJvdG86ICh0NSkgPT4gUHJvb2ZPcHMuZW5jb2RlKHQ1KS5maW5pc2goKSwgdG9Qcm90b01zZzogKHQ1KSA9PiAoeyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmNyeXB0by5Qcm9vZk9wc1wiLCB2YWx1ZTogUHJvb2ZPcHMuZW5jb2RlKHQ1KS5maW5pc2goKSB9KSB9O1xuXG4vL1xuZnVuY3Rpb24gdDIoKSB7XG4gIHJldHVybiB7IHNlY29uZHM6IEJpZ0ludCgwKSwgbmFub3M6IDAgfTtcbn1cbnZhciBUaW1lc3RhbXAgPSB7IHR5cGVVcmw6IFwiL2dvb2dsZS5wcm90b2J1Zi5UaW1lc3RhbXBcIiwgZW5jb2RlOiAobjIsIHMzID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAobjIuc2Vjb25kcyAhPT0gQmlnSW50KDApICYmIHMzLnVpbnQzMig4KS5pbnQ2NChuMi5zZWNvbmRzKSwgMCAhPT0gbjIubmFub3MgJiYgczMudWludDMyKDE2KS5pbnQzMihuMi5uYW5vcyksIHMzKSwgZGVjb2RlKG8yLCBzMykge1xuICBjb25zdCBlMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBzMyA/IGUyLmxlbiA6IGUyLnBvcyArIHMzO1xuICBjb25zdCByNSA9IHQyKCk7XG4gIGZvciAoOyBlMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgbjIgPSBlMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG4yID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LnNlY29uZHMgPSBlMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUubmFub3MgPSBlMi5pbnQzMigpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGUyLnNraXBUeXBlKDcgJiBuMik7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAobjIpID0+ICh7IHNlY29uZHM6IGlzU2V0KG4yLnNlY29uZHMpID8gQmlnSW50KG4yLnNlY29uZHMudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG5hbm9zOiBpc1NldChuMi5uYW5vcykgPyBOdW1iZXIobjIubmFub3MpIDogMCB9KSwgdG9KU09OKG4yKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG4yLnNlY29uZHMgJiYgKG8yLnNlY29uZHMgPSAobjIuc2Vjb25kcyB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IG4yLm5hbm9zICYmIChvMi5uYW5vcyA9IE1hdGgucm91bmQobjIubmFub3MpKSwgbzI7XG59LCBmcm9tUGFydGlhbChuMikge1xuICBjb25zdCBvMiA9IHQyKCk7XG4gIHJldHVybiBvMi5zZWNvbmRzID0gdm9pZCAwICE9PSBuMi5zZWNvbmRzICYmIG51bGwgIT09IG4yLnNlY29uZHMgPyBCaWdJbnQobjIuc2Vjb25kcy50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbzIubmFub3MgPSBuMi5uYW5vcyA/PyAwLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKG4yKSA9PiBUaW1lc3RhbXAuZGVjb2RlKG4yLnZhbHVlKSwgdG9Qcm90bzogKG4yKSA9PiBUaW1lc3RhbXAuZW5jb2RlKG4yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG4yKSA9PiAoeyB0eXBlVXJsOiBcIi9nb29nbGUucHJvdG9idWYuVGltZXN0YW1wXCIsIHZhbHVlOiBUaW1lc3RhbXAuZW5jb2RlKG4yKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIEJsb2NrSURGbGFnO1xuIWZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLkJMT0NLX0lEX0ZMQUdfVU5LTk9XTiA9IDBdID0gXCJCTE9DS19JRF9GTEFHX1VOS05PV05cIiwgZTJbZTIuQkxPQ0tfSURfRkxBR19BQlNFTlQgPSAxXSA9IFwiQkxPQ0tfSURfRkxBR19BQlNFTlRcIiwgZTJbZTIuQkxPQ0tfSURfRkxBR19DT01NSVQgPSAyXSA9IFwiQkxPQ0tfSURfRkxBR19DT01NSVRcIiwgZTJbZTIuQkxPQ0tfSURfRkxBR19OSUwgPSAzXSA9IFwiQkxPQ0tfSURfRkxBR19OSUxcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0oQmxvY2tJREZsYWcgfHwgKEJsb2NrSURGbGFnID0ge30pKTtcbnZhciBTaWduZWRNc2dUeXBlO1xuIWZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLlNJR05FRF9NU0dfVFlQRV9VTktOT1dOID0gMF0gPSBcIlNJR05FRF9NU0dfVFlQRV9VTktOT1dOXCIsIGUyW2UyLlNJR05FRF9NU0dfVFlQRV9QUkVWT1RFID0gMV0gPSBcIlNJR05FRF9NU0dfVFlQRV9QUkVWT1RFXCIsIGUyW2UyLlNJR05FRF9NU0dfVFlQRV9QUkVDT01NSVQgPSAyXSA9IFwiU0lHTkVEX01TR19UWVBFX1BSRUNPTU1JVFwiLCBlMltlMi5TSUdORURfTVNHX1RZUEVfUFJPUE9TQUwgPSAzMl0gPSBcIlNJR05FRF9NU0dfVFlQRV9QUk9QT1NBTFwiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShTaWduZWRNc2dUeXBlIHx8IChTaWduZWRNc2dUeXBlID0ge30pKTtcblxuLy9cbnZhciBDaGVja1R4VHlwZTtcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5ORVcgPSAwXSA9IFwiTkVXXCIsIGUyW2UyLlJFQ0hFQ0sgPSAxXSA9IFwiUkVDSEVDS1wiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShDaGVja1R4VHlwZSB8fCAoQ2hlY2tUeFR5cGUgPSB7fSkpO1xudmFyIEV2aWRlbmNlVHlwZTtcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5VTktOT1dOID0gMF0gPSBcIlVOS05PV05cIiwgZTJbZTIuRFVQTElDQVRFX1ZPVEUgPSAxXSA9IFwiRFVQTElDQVRFX1ZPVEVcIiwgZTJbZTIuTElHSFRfQ0xJRU5UX0FUVEFDSyA9IDJdID0gXCJMSUdIVF9DTElFTlRfQVRUQUNLXCIsIGUyW2UyLlVOUkVDT0dOSVpFRCA9IC0xXSA9IFwiVU5SRUNPR05JWkVEXCI7XG59KEV2aWRlbmNlVHlwZSB8fCAoRXZpZGVuY2VUeXBlID0ge30pKTtcbmZ1bmN0aW9uIHAoKSB7XG4gIHJldHVybiB7IGRhdGE6IG5ldyBVaW50OEFycmF5KCksIHBhdGg6IFwiXCIsIGhlaWdodDogQmlnSW50KDApLCBwcm92ZTogZmFsc2UgfTtcbn1cbnZhciBSZXF1ZXN0UXVlcnkgPSB7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuYWJjaS5SZXF1ZXN0UXVlcnlcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoMCAhPT0gZTIuZGF0YS5sZW5ndGggJiYgdDUudWludDMyKDEwKS5ieXRlcyhlMi5kYXRhKSwgXCJcIiAhPT0gZTIucGF0aCAmJiB0NS51aW50MzIoMTgpLnN0cmluZyhlMi5wYXRoKSwgZTIuaGVpZ2h0ICE9PSBCaWdJbnQoMCkgJiYgdDUudWludDMyKDI0KS5pbnQ2NChlMi5oZWlnaHQpLCB0cnVlID09PSBlMi5wcm92ZSAmJiB0NS51aW50MzIoMzIpLmJvb2woZTIucHJvdmUpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbzIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gdDUgPyBvMi5sZW4gOiBvMi5wb3MgKyB0NTtcbiAgY29uc3QgaTIgPSBwKCk7XG4gIGZvciAoOyBvMi5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTMgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRhdGEgPSBvMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIucGF0aCA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgaTIuaGVpZ2h0ID0gbzIuaW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGkyLnByb3ZlID0gbzIuYm9vbCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRhdGE6IGlzU2V0KGUyLmRhdGEpID8gZGVjb2RlQmFzZTY0KGUyLmRhdGEpIDogbmV3IFVpbnQ4QXJyYXkoKSwgcGF0aDogaXNTZXQoZTIucGF0aCkgPyBTdHJpbmcoZTIucGF0aCkgOiBcIlwiLCBoZWlnaHQ6IGlzU2V0KGUyLmhlaWdodCkgPyBCaWdJbnQoZTIuaGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBwcm92ZTogISFpc1NldChlMi5wcm92ZSkgJiYgQm9vbGVhbihlMi5wcm92ZSkgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kYXRhICYmICh0NS5kYXRhID0gZW5jb2RlQmFzZTY0KHZvaWQgMCAhPT0gZTIuZGF0YSA/IGUyLmRhdGEgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gZTIucGF0aCAmJiAodDUucGF0aCA9IGUyLnBhdGgpLCB2b2lkIDAgIT09IGUyLmhlaWdodCAmJiAodDUuaGVpZ2h0ID0gKGUyLmhlaWdodCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLnByb3ZlICYmICh0NS5wcm92ZSA9IGUyLnByb3ZlKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHAoKTtcbiAgcmV0dXJuIHQ1LmRhdGEgPSBlMi5kYXRhID8/IG5ldyBVaW50OEFycmF5KCksIHQ1LnBhdGggPSBlMi5wYXRoID8/IFwiXCIsIHQ1LmhlaWdodCA9IHZvaWQgMCAhPT0gZTIuaGVpZ2h0ICYmIG51bGwgIT09IGUyLmhlaWdodCA/IEJpZ0ludChlMi5oZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIHQ1LnByb3ZlID0gZTIucHJvdmUgPz8gZmFsc2UsIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFJlcXVlc3RRdWVyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlcXVlc3RRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuYWJjaS5SZXF1ZXN0UXVlcnlcIiwgdmFsdWU6IFJlcXVlc3RRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBtKCkge1xuICByZXR1cm4geyBjb2RlOiAwLCBsb2c6IFwiXCIsIGluZm86IFwiXCIsIGluZGV4OiBCaWdJbnQoMCksIGtleTogbmV3IFVpbnQ4QXJyYXkoKSwgdmFsdWU6IG5ldyBVaW50OEFycmF5KCksIHByb29mT3BzOiB2b2lkIDAsIGhlaWdodDogQmlnSW50KDApLCBjb2Rlc3BhY2U6IFwiXCIgfTtcbn1cbnZhciBSZXNwb25zZVF1ZXJ5ID0geyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmFiY2kuUmVzcG9uc2VRdWVyeVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICgwICE9PSBlMi5jb2RlICYmIG8yLnVpbnQzMig4KS51aW50MzIoZTIuY29kZSksIFwiXCIgIT09IGUyLmxvZyAmJiBvMi51aW50MzIoMjYpLnN0cmluZyhlMi5sb2cpLCBcIlwiICE9PSBlMi5pbmZvICYmIG8yLnVpbnQzMigzNCkuc3RyaW5nKGUyLmluZm8pLCBlMi5pbmRleCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMig0MCkuaW50NjQoZTIuaW5kZXgpLCAwICE9PSBlMi5rZXkubGVuZ3RoICYmIG8yLnVpbnQzMig1MCkuYnl0ZXMoZTIua2V5KSwgMCAhPT0gZTIudmFsdWUubGVuZ3RoICYmIG8yLnVpbnQzMig1OCkuYnl0ZXMoZTIudmFsdWUpLCB2b2lkIDAgIT09IGUyLnByb29mT3BzICYmIFByb29mT3BzLmVuY29kZShlMi5wcm9vZk9wcywgbzIudWludDMyKDY2KS5mb3JrKCkpLmxkZWxpbSgpLCBlMi5oZWlnaHQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoNzIpLmludDY0KGUyLmhlaWdodCksIFwiXCIgIT09IGUyLmNvZGVzcGFjZSAmJiBvMi51aW50MzIoODIpLnN0cmluZyhlMi5jb2Rlc3BhY2UpLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgbjIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gbzIgPyBuMi5sZW4gOiBuMi5wb3MgKyBvMjtcbiAgY29uc3QgYTIgPSBtKCk7XG4gIGZvciAoOyBuMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGEyLmNvZGUgPSBuMi51aW50MzIoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGEyLmxvZyA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgYTIuaW5mbyA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgYTIuaW5kZXggPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNjpcbiAgICAgICAgYTIua2V5ID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDc6XG4gICAgICAgIGEyLnZhbHVlID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDg6XG4gICAgICAgIGEyLnByb29mT3BzID0gUHJvb2ZPcHMuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA5OlxuICAgICAgICBhMi5oZWlnaHQgPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMTA6XG4gICAgICAgIGEyLmNvZGVzcGFjZSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGNvZGU6IGlzU2V0KGUyLmNvZGUpID8gTnVtYmVyKGUyLmNvZGUpIDogMCwgbG9nOiBpc1NldChlMi5sb2cpID8gU3RyaW5nKGUyLmxvZykgOiBcIlwiLCBpbmZvOiBpc1NldChlMi5pbmZvKSA/IFN0cmluZyhlMi5pbmZvKSA6IFwiXCIsIGluZGV4OiBpc1NldChlMi5pbmRleCkgPyBCaWdJbnQoZTIuaW5kZXgudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGtleTogaXNTZXQoZTIua2V5KSA/IGRlY29kZUJhc2U2NChlMi5rZXkpIDogbmV3IFVpbnQ4QXJyYXkoKSwgdmFsdWU6IGlzU2V0KGUyLnZhbHVlKSA/IGRlY29kZUJhc2U2NChlMi52YWx1ZSkgOiBuZXcgVWludDhBcnJheSgpLCBwcm9vZk9wczogaXNTZXQoZTIucHJvb2ZPcHMpID8gUHJvb2ZPcHMuZnJvbUpTT04oZTIucHJvb2ZPcHMpIDogdm9pZCAwLCBoZWlnaHQ6IGlzU2V0KGUyLmhlaWdodCkgPyBCaWdJbnQoZTIuaGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBjb2Rlc3BhY2U6IGlzU2V0KGUyLmNvZGVzcGFjZSkgPyBTdHJpbmcoZTIuY29kZXNwYWNlKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5jb2RlICYmIChvMi5jb2RlID0gTWF0aC5yb3VuZChlMi5jb2RlKSksIHZvaWQgMCAhPT0gZTIubG9nICYmIChvMi5sb2cgPSBlMi5sb2cpLCB2b2lkIDAgIT09IGUyLmluZm8gJiYgKG8yLmluZm8gPSBlMi5pbmZvKSwgdm9pZCAwICE9PSBlMi5pbmRleCAmJiAobzIuaW5kZXggPSAoZTIuaW5kZXggfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi5rZXkgJiYgKG8yLmtleSA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IGUyLmtleSA/IGUyLmtleSA6IG5ldyBVaW50OEFycmF5KCkpKSwgdm9pZCAwICE9PSBlMi52YWx1ZSAmJiAobzIudmFsdWUgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSBlMi52YWx1ZSA/IGUyLnZhbHVlIDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB2b2lkIDAgIT09IGUyLnByb29mT3BzICYmIChvMi5wcm9vZk9wcyA9IGUyLnByb29mT3BzID8gUHJvb2ZPcHMudG9KU09OKGUyLnByb29mT3BzKSA6IHZvaWQgMCksIHZvaWQgMCAhPT0gZTIuaGVpZ2h0ICYmIChvMi5oZWlnaHQgPSAoZTIuaGVpZ2h0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuY29kZXNwYWNlICYmIChvMi5jb2Rlc3BhY2UgPSBlMi5jb2Rlc3BhY2UpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0gbSgpO1xuICByZXR1cm4gbzIuY29kZSA9IGUyLmNvZGUgPz8gMCwgbzIubG9nID0gZTIubG9nID8/IFwiXCIsIG8yLmluZm8gPSBlMi5pbmZvID8/IFwiXCIsIG8yLmluZGV4ID0gdm9pZCAwICE9PSBlMi5pbmRleCAmJiBudWxsICE9PSBlMi5pbmRleCA/IEJpZ0ludChlMi5pbmRleC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbzIua2V5ID0gZTIua2V5ID8/IG5ldyBVaW50OEFycmF5KCksIG8yLnZhbHVlID0gZTIudmFsdWUgPz8gbmV3IFVpbnQ4QXJyYXkoKSwgbzIucHJvb2ZPcHMgPSB2b2lkIDAgIT09IGUyLnByb29mT3BzICYmIG51bGwgIT09IGUyLnByb29mT3BzID8gUHJvb2ZPcHMuZnJvbVBhcnRpYWwoZTIucHJvb2ZPcHMpIDogdm9pZCAwLCBvMi5oZWlnaHQgPSB2b2lkIDAgIT09IGUyLmhlaWdodCAmJiBudWxsICE9PSBlMi5oZWlnaHQgPyBCaWdJbnQoZTIuaGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBvMi5jb2Rlc3BhY2UgPSBlMi5jb2Rlc3BhY2UgPz8gXCJcIiwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUmVzcG9uc2VRdWVyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlc3BvbnNlUXVlcnkuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmFiY2kuUmVzcG9uc2VRdWVyeVwiLCB2YWx1ZTogUmVzcG9uc2VRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgQ29zbW9zUXVlcnkgPSB7IHR5cGVVcmw6IFwiL2ljcS52MS5Db3Ntb3NRdWVyeVwiLCBlbmNvZGUobzIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgcjUgb2YgbzIucmVxdWVzdHMpIFJlcXVlc3RRdWVyeS5lbmNvZGUocjUsIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHQ1O1xufSwgZGVjb2RlKG8yLCByNSkge1xuICBjb25zdCBzMyA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSByNSA/IHMzLmxlbiA6IHMzLnBvcyArIHI1O1xuICBjb25zdCBhMiA9IHsgcmVxdWVzdHM6IFtdIH07XG4gIGZvciAoOyBzMy5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgbzMgPSBzMy51aW50MzIoKTtcbiAgICBpZiAobzMgPj4+IDMgPT0gMSkgYTIucmVxdWVzdHMucHVzaChSZXF1ZXN0UXVlcnkuZGVjb2RlKHMzLCBzMy51aW50MzIoKSkpO1xuICAgIGVsc2UgczMuc2tpcFR5cGUoNyAmIG8zKTtcbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyByZXF1ZXN0czogQXJyYXkuaXNBcnJheShvMj8ucmVxdWVzdHMpID8gbzIucmVxdWVzdHMubWFwKChvMykgPT4gUmVxdWVzdFF1ZXJ5LmZyb21KU09OKG8zKSkgOiBbXSB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiBvMi5yZXF1ZXN0cyA/IHQ1LnJlcXVlc3RzID0gbzIucmVxdWVzdHMubWFwKChvMykgPT4gbzMgPyBSZXF1ZXN0UXVlcnkudG9KU09OKG8zKSA6IHZvaWQgMCkgOiB0NS5yZXF1ZXN0cyA9IFtdLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyByZXF1ZXN0czogW10gfTtcbiAgcmV0dXJuIHQ1LnJlcXVlc3RzID0gbzIucmVxdWVzdHM/Lm1hcCgobzMpID0+IFJlcXVlc3RRdWVyeS5mcm9tUGFydGlhbChvMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBDb3Ntb3NRdWVyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IENvc21vc1F1ZXJ5LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvaWNxLnYxLkNvc21vc1F1ZXJ5XCIsIHZhbHVlOiBDb3Ntb3NRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgQ29zbW9zUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2ljcS52MS5Db3Ntb3NSZXNwb25zZVwiLCBlbmNvZGUoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgcjUgb2YgZTIucmVzcG9uc2VzKSBSZXNwb25zZVF1ZXJ5LmVuY29kZShyNSwgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdDU7XG59LCBkZWNvZGUoZTIsIHI1KSB7XG4gIGNvbnN0IHMzID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHI1ID8gczMubGVuIDogczMucG9zICsgcjU7XG4gIGNvbnN0IGEyID0geyByZXNwb25zZXM6IFtdIH07XG4gIGZvciAoOyBzMy5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTMgPSBzMy51aW50MzIoKTtcbiAgICBpZiAoZTMgPj4+IDMgPT0gMSkgYTIucmVzcG9uc2VzLnB1c2goUmVzcG9uc2VRdWVyeS5kZWNvZGUoczMsIHMzLnVpbnQzMigpKSk7XG4gICAgZWxzZSBzMy5za2lwVHlwZSg3ICYgZTMpO1xuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IHJlc3BvbnNlczogQXJyYXkuaXNBcnJheShlMj8ucmVzcG9uc2VzKSA/IGUyLnJlc3BvbnNlcy5tYXAoKGUzKSA9PiBSZXNwb25zZVF1ZXJ5LmZyb21KU09OKGUzKSkgOiBbXSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiBlMi5yZXNwb25zZXMgPyB0NS5yZXNwb25zZXMgPSBlMi5yZXNwb25zZXMubWFwKChlMykgPT4gZTMgPyBSZXNwb25zZVF1ZXJ5LnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUucmVzcG9uc2VzID0gW10sIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSB7IHJlc3BvbnNlczogW10gfTtcbiAgcmV0dXJuIHQ1LnJlc3BvbnNlcyA9IGUyLnJlc3BvbnNlcz8ubWFwKChlMykgPT4gUmVzcG9uc2VRdWVyeS5mcm9tUGFydGlhbChlMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBDb3Ntb3NSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IENvc21vc1Jlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvaWNxLnYxLkNvc21vc1Jlc3BvbnNlXCIsIHZhbHVlOiBDb3Ntb3NSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgVHlwZTtcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5UWVBFX1VOU1BFQ0lGSUVEID0gMF0gPSBcIlRZUEVfVU5TUEVDSUZJRURcIiwgZTJbZTIuVFlQRV9FWEVDVVRFX1RYID0gMV0gPSBcIlRZUEVfRVhFQ1VURV9UWFwiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShUeXBlIHx8IChUeXBlID0ge30pKTtcblxuLy9cbmZ1bmN0aW9uIG1ha2VUeFBhY2tldChtc2dzLCBvcHRzKSB7XG4gIGNvbnN0IG1lc3NhZ2VzID0gbXNncy5tYXAoQW55LmZyb21KU09OKTtcbiAgY29uc3QgYnl0ZXMgPSBUeEJvZHkuZW5jb2RlKFxuICAgIFR4Qm9keS5mcm9tUGFydGlhbCh7XG4gICAgICBtZXNzYWdlcyxcbiAgICAgIC4uLm9wdHNcbiAgICB9KVxuICApLmZpbmlzaCgpO1xuICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHtcbiAgICAgIHR5cGU6IFR5cGUuVFlQRV9FWEVDVVRFX1RYLFxuICAgICAgZGF0YTogZW5jb2RlQmFzZTY0KGJ5dGVzKSxcbiAgICAgIG1lbW86IFwiXCJcbiAgICB9XG4gICk7XG59XG5oYXJkZW4obWFrZVR4UGFja2V0KTtcbmZ1bmN0aW9uIG1ha2VRdWVyeVBhY2tldChtc2dzKSB7XG4gIGNvbnN0IGJ5dGVzID0gQ29zbW9zUXVlcnkuZW5jb2RlKFxuICAgIENvc21vc1F1ZXJ5LmZyb21QYXJ0aWFsKHtcbiAgICAgIHJlcXVlc3RzOiBtc2dzLm1hcChSZXF1ZXN0UXVlcnkuZnJvbUpTT04pXG4gICAgfSlcbiAgKS5maW5pc2goKTtcbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAge1xuICAgICAgZGF0YTogZW5jb2RlQmFzZTY0KGJ5dGVzKSxcbiAgICAgIG1lbW86IFwiXCJcbiAgICB9XG4gICk7XG59XG5oYXJkZW4obWFrZVF1ZXJ5UGFja2V0KTtcbmZ1bmN0aW9uIHBhcnNlVHhQYWNrZXQocmVzcG9uc2UpIHtcbiAgY29uc3QgeyByZXN1bHQsIGVycm9yIH0gPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcbiAgaWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDtcbiAgZWxzZSBpZiAoZXJyb3IpIHRocm93IEVycm9yKGVycm9yKTtcbiAgZWxzZSB0aHJvdyB0aHJvd1JlZGFjdGVkYGV4cGVjdGVkIGVpdGhlciByZXN1bHQgb3IgZXJyb3I6ICR7cmVzcG9uc2V9YDtcbn1cbmhhcmRlbihwYXJzZVR4UGFja2V0KTtcbmZ1bmN0aW9uIHBhcnNlUXVlcnlQYWNrZXQocmVzcG9uc2UpIHtcbiAgY29uc3QgcmVzdWx0ID0gcGFyc2VUeFBhY2tldChyZXNwb25zZSk7XG4gIGNvbnN0IHsgZGF0YSB9ID0gSlNPTi5wYXJzZShhdG9iMihyZXN1bHQpKTtcbiAgY29uc3QgeyByZXNwb25zZXMgPSBbXSB9ID0gQ29zbW9zUmVzcG9uc2UuZGVjb2RlKGRlY29kZUJhc2U2NChkYXRhKSk7XG4gIHJldHVybiBoYXJkZW4ocmVzcG9uc2VzLm1hcChSZXNwb25zZVF1ZXJ5LnRvSlNPTikpO1xufVxuaGFyZGVuKHBhcnNlUXVlcnlQYWNrZXQpO1xuXG4vL1xudmFyIHRyYWNlID0gbWFrZVRyYWNlcihcIkljYUFjY291bnRLaXRcIik7XG52YXIgVU5QQVJTQUJMRV9DSEFJTl9BRERSRVNTID0gXCJVTlBBUlNBQkxFX0NIQUlOX0FERFJFU1NcIjtcbnZhciBJY2FBY2NvdW50SSA9IE0uaW50ZXJmYWNlKFwiSWNhQWNjb3VudFwiLCB7XG4gIGdldEFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpLFxuICBnZXRMb2NhbEFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIGdldFJlbW90ZUFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIGdldFBvcnQ6IE0uY2FsbCgpLnJldHVybnMoTS5yZW1vdGFibGUoXCJQb3J0XCIpKSxcbiAgZXhlY3V0ZVR4OiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZXhlY3V0ZUVuY29kZWRUeDogTS5jYWxsKE0uYXJyYXlPZihQcm90bzNTaGFwZSkpLm9wdGlvbmFsKEV4ZWN1dGVJQ0FUeE9wdHNTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGRlYWN0aXZhdGU6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpLFxuICByZWFjdGl2YXRlOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKVxufSk7XG52YXIgcHJlcGFyZUljYUFjY291bnRLaXQgPSAoem9uZSwgeyB3YXRjaCwgYXNWb3cgfSkgPT4gem9uZS5leG9DbGFzc0tpdChcbiAgXCJJY2FBY2NvdW50S2l0XCIsXG4gIHtcbiAgICBhY2NvdW50OiBJY2FBY2NvdW50SSxcbiAgICBjb25uZWN0aW9uSGFuZGxlcjogT3V0Ym91bmRDb25uZWN0aW9uSGFuZGxlckksXG4gICAgcGFyc2VUeFBhY2tldFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUGFyc2VUeFBhY2tldFdhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnN0cmluZygpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS5zdHJpbmcoKSlcbiAgICB9KVxuICB9LFxuICAvKlxuXG5cblxuICAgKi9cbiAgKGNoYWluSWQsIHBvcnQsIHJlcXVlc3RlZFJlbW90ZUFkZHJlc3MpID0+IChcbiAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgIHtcbiAgICAgIGNoYWluSWQsXG4gICAgICBwb3J0LFxuICAgICAgY29ubmVjdGlvbjogdm9pZCAwLFxuICAgICAgcmVxdWVzdGVkUmVtb3RlQWRkcmVzcyxcbiAgICAgIHJlbW90ZUFkZHJlc3M6IHZvaWQgMCxcbiAgICAgIGNoYWluQWRkcmVzczogdm9pZCAwLFxuICAgICAgbG9jYWxBZGRyZXNzOiB2b2lkIDAsXG4gICAgICBpc0luaXRpYXRpbmdDbG9zZTogZmFsc2VcbiAgICB9XG4gICksXG4gIHtcbiAgICBwYXJzZVR4UGFja2V0V2F0Y2hlcjoge1xuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKGFjaykge1xuICAgICAgICByZXR1cm4gcGFyc2VUeFBhY2tldChhY2spO1xuICAgICAgfVxuICAgIH0sXG4gICAgYWNjb3VudDoge1xuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBnZXRBZGRyZXNzKCkge1xuICAgICAgICByZXR1cm4gTm9uTnVsbGlzaChcbiAgICAgICAgICB0aGlzLnN0YXRlLmNoYWluQWRkcmVzcyxcbiAgICAgICAgICBcIklDQSBjaGFubmVsIGNyZWF0aW9uIGFja25vd2xlZGdlbWVudCBub3QgeWV0IHJlY2VpdmVkLlwiXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgZ2V0TG9jYWxBZGRyZXNzKCkge1xuICAgICAgICByZXR1cm4gTm9uTnVsbGlzaChcbiAgICAgICAgICB0aGlzLnN0YXRlLmxvY2FsQWRkcmVzcyxcbiAgICAgICAgICBcImxvY2FsIGFkZHJlc3Mgbm90IGF2YWlsYWJsZVwiXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgZ2V0UmVtb3RlQWRkcmVzcygpIHtcbiAgICAgICAgcmV0dXJuIE5vbk51bGxpc2goXG4gICAgICAgICAgdGhpcy5zdGF0ZS5yZW1vdGVBZGRyZXNzLFxuICAgICAgICAgIFwicmVtb3RlIGFkZHJlc3Mgbm90IGF2YWlsYWJsZVwiXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgZ2V0UG9ydCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUucG9ydDtcbiAgICAgIH0sXG4gICAgICBleGVjdXRlVHgoKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB0aHJvd1JlZGFjdGVkYG5vdCB5ZXQgaW1wbGVtZW50ZWRgKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBleGVjdXRlRW5jb2RlZFR4KG1zZ3MsIG9wdHMgPSB7fSkge1xuICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgY29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoIWNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgQWNjb3VudCBub3QgYXZhaWxhYmxlIG9yIGRlYWN0aXZhdGVkLmA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHsgc2VuZE9wdHMsIC4uLnR4Qm9keU9wdHMgfSA9IG9wdHM7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgRShjb25uZWN0aW9uKS5zZW5kKG1ha2VUeFBhY2tldChtc2dzLCB0eEJvZHlPcHRzKSwgc2VuZE9wdHMpLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMucGFyc2VUeFBhY2tldFdhdGNoZXJcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgZGVhY3RpdmF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBjb25zdCB7IGNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKCFjb25uZWN0aW9uKSB0aHJvdyB0aHJvd1JlZGFjdGVkYEFjY291bnQgbm90IGF2YWlsYWJsZSBvciBkZWFjdGl2YXRlZC5gO1xuICAgICAgICAgIHRoaXMuc3RhdGUuaXNJbml0aWF0aW5nQ2xvc2UgPSB0cnVlO1xuICAgICAgICAgIHJldHVybiBFKGNvbm5lY3Rpb24pLmNsb3NlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICByZWFjdGl2YXRlKCkge1xuICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgY29ubmVjdGlvbiwgcG9ydCwgcmVxdWVzdGVkUmVtb3RlQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoY29ubmVjdGlvbikge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBBY2NvdW50IGlzIGFscmVhZHkgYWN0aXZlLmA7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUocG9ydCkuY29ubmVjdChcbiAgICAgICAgICAgICAgcmVxdWVzdGVkUmVtb3RlQWRkcmVzcyxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMuY29ubmVjdGlvbkhhbmRsZXJcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGNvbm5lY3Rpb25IYW5kbGVyOiB7XG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBhc3luYyBvbk9wZW4oY29ubmVjdGlvbiwgbG9jYWxBZGRyLCByZW1vdGVBZGRyKSB7XG4gICAgICAgIHRyYWNlKGBJQ0EgQ2hhbm5lbCBPcGVuZWQgZm9yICR7bG9jYWxBZGRyfSBhdCAke3JlbW90ZUFkZHJ9YCk7XG4gICAgICAgIHRoaXMuc3RhdGUuY29ubmVjdGlvbiA9IGNvbm5lY3Rpb247XG4gICAgICAgIHRoaXMuc3RhdGUucmVtb3RlQWRkcmVzcyA9IHJlbW90ZUFkZHI7XG4gICAgICAgIHRoaXMuc3RhdGUubG9jYWxBZGRyZXNzID0gbG9jYWxBZGRyO1xuICAgICAgICBjb25zdCBhZGRyZXNzID0gZmluZEFkZHJlc3NGaWVsZChyZW1vdGVBZGRyKTtcbiAgICAgICAgaWYgKCFhZGRyZXNzKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIlxcdTI2QTBcXHVGRTBGIGZhaWxlZCB0byBwYXJzZSBjaGFpbiBhZGRyZXNzXCIsIHJlbW90ZUFkZHIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc3RhdGUuY2hhaW5BZGRyZXNzID0gaGFyZGVuKHtcbiAgICAgICAgICB2YWx1ZTogYWRkcmVzcyB8fCBVTlBBUlNBQkxFX0NIQUlOX0FERFJFU1MsXG4gICAgICAgICAgY2hhaW5JZDogdGhpcy5zdGF0ZS5jaGFpbklkLFxuICAgICAgICAgIGVuY29kaW5nOiBcImJlY2gzMlwiXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIG9uQ2xvc2UoX2Nvbm5lY3Rpb24sIHJlYXNvbikge1xuICAgICAgICB0cmFjZShgSUNBIENoYW5uZWwgY2xvc2VkLiBSZWFzb246ICR7cmVhc29ufWApO1xuICAgICAgICB0aGlzLnN0YXRlLmNvbm5lY3Rpb24gPSB2b2lkIDA7XG4gICAgICAgIHRoaXMuc3RhdGUubG9jYWxBZGRyZXNzID0gdm9pZCAwO1xuICAgICAgICB0aGlzLnN0YXRlLnJlbW90ZUFkZHJlc3MgPSB2b2lkIDA7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmlzSW5pdGlhdGluZ0Nsb3NlID09PSB0cnVlKSB7XG4gICAgICAgICAgdHJhY2UoXCJBY2NvdW50IGRlYWN0aXZhdGVkIGJ5IGhvbGRlci4gU2tpcHBpbmcgcmVhY3RpdmF0aW9uLlwiKTtcbiAgICAgICAgICB0aGlzLnN0YXRlLmlzSW5pdGlhdGluZ0Nsb3NlID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdHJhY2UoXCJBY2NvdW50IGNsb3NlZCB1bmV4cGVjdGVkbHkuIEF1dG9tYXRpY2FsbHkgcmVhY3RpdmF0aW5nLlwiKTtcbiAgICAgICAgICB2b2lkIHdhdGNoKHRoaXMuZmFjZXRzLmFjY291bnQucmVhY3RpdmF0ZSgpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuKTtcblxuLy9cbnZhciB0cmFjZTIgPSBtYWtlVHJhY2VyKFwiT3JjaGVzdHJhdGlvbjpJQ1FDb25uZWN0aW9uXCIpO1xudmFyIElDUUNvbm5lY3Rpb25JID0gTS5pbnRlcmZhY2UoXCJJQ1FDb25uZWN0aW9uXCIsIHtcbiAgZ2V0TG9jYWxBZGRyZXNzOiBNLmNhbGwoKS5yZXR1cm5zKE0uc3RyaW5nKCkpLFxuICBnZXRSZW1vdGVBZGRyZXNzOiBNLmNhbGwoKS5yZXR1cm5zKE0uc3RyaW5nKCkpLFxuICBxdWVyeTogTS5jYWxsKE0uYXJyYXlPZihJQ1FNc2dTaGFwZSkpLnJldHVybnMoVm93U2hhcGUpXG59KTtcbnZhciBwcmVwYXJlSUNRQ29ubmVjdGlvbktpdCA9ICh6b25lLCB7IHdhdGNoLCBhc1ZvdyB9KSA9PiB6b25lLmV4b0NsYXNzS2l0KFxuICBcIklDUUNvbm5lY3Rpb25LaXRcIixcbiAge1xuICAgIGNvbm5lY3Rpb246IElDUUNvbm5lY3Rpb25JLFxuICAgIGNvbm5lY3Rpb25IYW5kbGVyOiBPdXRib3VuZENvbm5lY3Rpb25IYW5kbGVySSxcbiAgICBwYXJzZVF1ZXJ5UGFja2V0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQYXJzZVF1ZXJ5UGFja2V0V2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhNLmFycmF5T2YoTS5yZWNvcmQoKSkpXG4gICAgfSlcbiAgfSxcbiAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAocG9ydCkgPT4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHtcbiAgICAgIHBvcnQsXG4gICAgICBjb25uZWN0aW9uOiB2b2lkIDAsXG4gICAgICByZW1vdGVBZGRyZXNzOiB2b2lkIDAsXG4gICAgICBsb2NhbEFkZHJlc3M6IHZvaWQgMFxuICAgIH1cbiAgKSxcbiAge1xuICAgIGNvbm5lY3Rpb246IHtcbiAgICAgIGdldExvY2FsQWRkcmVzcygpIHtcbiAgICAgICAgcmV0dXJuIE5vbk51bGxpc2goXG4gICAgICAgICAgdGhpcy5zdGF0ZS5sb2NhbEFkZHJlc3MsXG4gICAgICAgICAgXCJsb2NhbCBhZGRyZXNzIG5vdCBhdmFpbGFibGVcIlxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIGdldFJlbW90ZUFkZHJlc3MoKSB7XG4gICAgICAgIHJldHVybiBOb25OdWxsaXNoKFxuICAgICAgICAgIHRoaXMuc3RhdGUucmVtb3RlQWRkcmVzcyxcbiAgICAgICAgICBcInJlbW90ZSBhZGRyZXNzIG5vdCBhdmFpbGFibGVcIlxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgcXVlcnkobXNncykge1xuICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgY29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoIWNvbm5lY3Rpb24pIHRocm93IHRocm93UmVkYWN0ZWRgY29ubmVjdGlvbiBub3QgYXZhaWxhYmxlYDtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKGNvbm5lY3Rpb24pLnNlbmQobWFrZVF1ZXJ5UGFja2V0KG1zZ3MpKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnBhcnNlUXVlcnlQYWNrZXRXYXRjaGVyXG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBwYXJzZVF1ZXJ5UGFja2V0V2F0Y2hlcjoge1xuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKGFjaykge1xuICAgICAgICByZXR1cm4gcGFyc2VRdWVyeVBhY2tldChhY2spO1xuICAgICAgfVxuICAgIH0sXG4gICAgY29ubmVjdGlvbkhhbmRsZXI6IHtcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIG9uT3Blbihjb25uZWN0aW9uLCBsb2NhbEFkZHIsIHJlbW90ZUFkZHIpIHtcbiAgICAgICAgdHJhY2UyKGBJQ1EgQ2hhbm5lbCBPcGVuZWQgZm9yICR7bG9jYWxBZGRyfSBhdCAke3JlbW90ZUFkZHJ9YCk7XG4gICAgICAgIHRoaXMuc3RhdGUuY29ubmVjdGlvbiA9IGNvbm5lY3Rpb247XG4gICAgICAgIHRoaXMuc3RhdGUucmVtb3RlQWRkcmVzcyA9IHJlbW90ZUFkZHI7XG4gICAgICAgIHRoaXMuc3RhdGUubG9jYWxBZGRyZXNzID0gbG9jYWxBZGRyO1xuICAgICAgfSxcbiAgICAgIGFzeW5jIG9uQ2xvc2UoX2Nvbm5lY3Rpb24sIHJlYXNvbikge1xuICAgICAgICB0cmFjZTIoYElDUSBDaGFubmVsIGNsb3NlZC4gUmVhc29uOiAke3JlYXNvbn1gKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG5cbi8vXG52YXIgeyBWb3ckIH0gPSBTaGFwZTtcbnZhciBnZXRJQ1FDb25uZWN0aW9uS2V5ID0gKGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsIHZlcnNpb24pID0+IHtcbiAgcmV0dXJuIGAke2NvbnRyb2xsZXJDb25uZWN0aW9uSWR9OiR7dmVyc2lvbiB8fCBERUZBVUxUX0lDUV9WRVJTSU9OfWA7XG59O1xudmFyIHByZXBhcmVDb3Ntb3NPcmNoZXN0cmF0aW9uU2VydmljZUtpdCA9ICh6b25lLCB7IHdhdGNoLCBhc1ZvdyB9LCBtYWtlSWNhQWNjb3VudEtpdCwgbWFrZUlDUUNvbm5lY3Rpb25LaXQpID0+IHpvbmUuZXhvQ2xhc3NLaXQoXG4gIFwiT3JjaGVzdHJhdGlvblwiLFxuICB7XG4gICAgcmVxdWVzdElDQUNoYW5uZWxXYXRjaGVyOiBNLmludGVyZmFjZShcIlJlcXVlc3RJQ0FDaGFubmVsV2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVtb3RhYmxlKFwiUG9ydFwiKSkub3B0aW9uYWwoeyBjaGFpbklkOiBNLnN0cmluZygpLCByZW1vdGVDb25uQWRkcjogTS5zdHJpbmcoKSB9KS5yZXR1cm5zKFZvdyQoU2hhcGUuQ29ubmVjdGlvbikpXG4gICAgfSksXG4gICAgcmVxdWVzdElDUUNoYW5uZWxXYXRjaGVyOiBNLmludGVyZmFjZShcIlJlcXVlc3RJQ1FDaGFubmVsV2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVtb3RhYmxlKFwiUG9ydFwiKSkub3B0aW9uYWwoe1xuICAgICAgICByZW1vdGVDb25uQWRkcjogTS5zdHJpbmcoKSxcbiAgICAgICAgaWNxTG9va3VwS2V5OiBNLnN0cmluZygpXG4gICAgICB9KS5yZXR1cm5zKFZvdyQoU2hhcGUuQ29ubmVjdGlvbikpXG4gICAgfSksXG4gICAgY2hhbm5lbE9wZW5XYXRjaGVyOiBNLmludGVyZmFjZShcIkNoYW5uZWxPcGVuV2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVtb3RhYmxlKFwiQ29ubmVjdGlvblwiKSkub3B0aW9uYWwoXG4gICAgICAgIE0uc3BsaXRSZWNvcmQoXG4gICAgICAgICAgeyBjb25uZWN0aW9uS2l0OiBNLnJlY29yZCgpLCByZXR1cm5GYWNldDogTS5zdHJpbmcoKSB9LFxuICAgICAgICAgIHsgaWNxTG9va3VwS2V5OiBNLnN0cmluZygpIH1cbiAgICAgICAgKVxuICAgICAgKS5yZXR1cm5zKE0ucmVtb3RhYmxlKFwiQ29ubmVjdGlvbktpdCBIb2xkZXIgZmFjZXRcIikpXG4gICAgfSksXG4gICAgcHVibGljOiBNLmludGVyZmFjZShcIkNvc21vc0ludGVyY2hhaW5TZXJ2aWNlXCIsIHtcbiAgICAgIG1ha2VBY2NvdW50OiBNLmNhbGwoTS5zdHJpbmcoKSwgTS5zdHJpbmcoKSwgTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5yZWNvcmQoKSkucmV0dXJucyhWb3ckKE0ucmVtb3RhYmxlKFwiSWNhQWNjb3VudEtpdFwiKSkpLFxuICAgICAgcHJvdmlkZUlDUUNvbm5lY3Rpb246IE0uY2FsbChNLnN0cmluZygpKS5vcHRpb25hbChNLnN0cmluZygpKS5yZXR1cm5zKFZvdyQoTS5yZW1vdGFibGUoXCJJQ1FDb25uZWN0aW9uXCIpKSlcbiAgICB9KVxuICB9LFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgKHBvd2VycykgPT4ge1xuICAgIG11c3RNYXRjaChwb3dlcnM/LnBvcnRBbGxvY2F0b3IsIE0ucmVtb3RhYmxlKFwiUG9ydEFsbG9jYXRvclwiKSk7XG4gICAgY29uc3QgaWNxQ29ubmVjdGlvbnMgPSB6b25lLmRldGFjaGVkKCkubWFwU3RvcmUoXCJJQ1FDb25uZWN0aW9uc1wiKTtcbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICB7XG4gICAgICAgIGljcUNvbm5lY3Rpb25zLFxuICAgICAgICBzaGFyZWRJQ1FQb3J0OiB2b2lkIDAsXG4gICAgICAgIHJlc2VydmVkOiB2b2lkIDAsXG4gICAgICAgIC4uLnBvd2Vyc1xuICAgICAgfVxuICAgICk7XG4gIH0sXG4gIHtcbiAgICByZXF1ZXN0SUNBQ2hhbm5lbFdhdGNoZXI6IHtcbiAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChwb3J0LCB7IGNoYWluSWQsIHJlbW90ZUNvbm5BZGRyIH0pIHtcbiAgICAgICAgY29uc3QgY29ubmVjdGlvbktpdCA9IG1ha2VJY2FBY2NvdW50S2l0KFxuICAgICAgICAgIGNoYWluSWQsXG4gICAgICAgICAgcG9ydCxcbiAgICAgICAgICByZW1vdGVDb25uQWRkclxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgRShwb3J0KS5jb25uZWN0KHJlbW90ZUNvbm5BZGRyLCBjb25uZWN0aW9uS2l0LmNvbm5lY3Rpb25IYW5kbGVyKSxcbiAgICAgICAgICB0aGlzLmZhY2V0cy5jaGFubmVsT3BlbldhdGNoZXIsXG4gICAgICAgICAgeyByZXR1cm5GYWNldDogXCJhY2NvdW50XCIsIGNvbm5lY3Rpb25LaXQgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG4gICAgcmVxdWVzdElDUUNoYW5uZWxXYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQocG9ydCwgeyByZW1vdGVDb25uQWRkciwgaWNxTG9va3VwS2V5IH0pIHtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLnNoYXJlZElDUVBvcnQpIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLnNoYXJlZElDUVBvcnQgPSBwb3J0O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb25LaXQgPSBtYWtlSUNRQ29ubmVjdGlvbktpdChwb3J0KTtcbiAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgIEUocG9ydCkuY29ubmVjdChyZW1vdGVDb25uQWRkciwgY29ubmVjdGlvbktpdC5jb25uZWN0aW9uSGFuZGxlciksXG4gICAgICAgICAgdGhpcy5mYWNldHMuY2hhbm5lbE9wZW5XYXRjaGVyLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGNvbm5lY3Rpb25LaXQsXG4gICAgICAgICAgICByZXR1cm5GYWNldDogXCJjb25uZWN0aW9uXCIsXG4gICAgICAgICAgICBpY3FMb29rdXBLZXlcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKlxuXG5cblxuICAgICAqL1xuICAgIGNoYW5uZWxPcGVuV2F0Y2hlcjoge1xuICAgICAgLypcblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoX2Nvbm5lY3Rpb24sIHsgY29ubmVjdGlvbktpdCwgcmV0dXJuRmFjZXQsIGljcUxvb2t1cEtleSB9KSB7XG4gICAgICAgIGlmIChpY3FMb29rdXBLZXkpIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLmljcUNvbm5lY3Rpb25zLmluaXQoXG4gICAgICAgICAgICBpY3FMb29rdXBLZXksXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICBjb25uZWN0aW9uS2l0XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29ubmVjdGlvbktpdFtyZXR1cm5GYWNldF07XG4gICAgICB9XG4gICAgfSxcbiAgICBwdWJsaWM6IHtcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBtYWtlQWNjb3VudChjaGFpbklkLCBob3N0Q29ubmVjdGlvbklkLCBjb250cm9sbGVyQ29ubmVjdGlvbklkLCBvcHRzKSB7XG4gICAgICAgIGNvbnN0IHJlbW90ZUNvbm5BZGRyID0gbWFrZUlDQUNoYW5uZWxBZGRyZXNzKFxuICAgICAgICAgIGhvc3RDb25uZWN0aW9uSWQsXG4gICAgICAgICAgY29udHJvbGxlckNvbm5lY3Rpb25JZCxcbiAgICAgICAgICBvcHRzXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHsgcG9ydEFsbG9jYXRvciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgIEUocG9ydEFsbG9jYXRvcikuYWxsb2NhdGVJQ0FDb250cm9sbGVyUG9ydCgpLFxuICAgICAgICAgIHRoaXMuZmFjZXRzLnJlcXVlc3RJQ0FDaGFubmVsV2F0Y2hlcixcbiAgICAgICAgICB7XG4gICAgICAgICAgICBjaGFpbklkLFxuICAgICAgICAgICAgcmVtb3RlQ29ubkFkZHJcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuICAgICAgICovXG4gICAgICBwcm92aWRlSUNRQ29ubmVjdGlvbihjb250cm9sbGVyQ29ubmVjdGlvbklkLCB2ZXJzaW9uKSB7XG4gICAgICAgIGNvbnN0IGljcUxvb2t1cEtleSA9IGdldElDUUNvbm5lY3Rpb25LZXkoXG4gICAgICAgICAgY29udHJvbGxlckNvbm5lY3Rpb25JZCxcbiAgICAgICAgICB2ZXJzaW9uXG4gICAgICAgICk7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLmljcUNvbm5lY3Rpb25zLmhhcyhpY3FMb29rdXBLZXkpKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KFxuICAgICAgICAgICAgKCkgPT4gdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9ucy5nZXQoaWNxTG9va3VwS2V5KS5jb25uZWN0aW9uXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZW1vdGVDb25uQWRkciA9IG1ha2VJQ1FDaGFubmVsQWRkcmVzcyhcbiAgICAgICAgICBjb250cm9sbGVyQ29ubmVjdGlvbklkLFxuICAgICAgICAgIHZlcnNpb25cbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgeyBwb3J0QWxsb2NhdG9yLCBzaGFyZWRJQ1FQb3J0IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCBwb3J0T3JQb3J0Vm93ID0gc2hhcmVkSUNRUG9ydCB8fCBFKHBvcnRBbGxvY2F0b3IpLmFsbG9jYXRlSUNRQ29udHJvbGxlclBvcnQoKTtcbiAgICAgICAgcmV0dXJuIHdhdGNoKHBvcnRPclBvcnRWb3csIHRoaXMuZmFjZXRzLnJlcXVlc3RJQ1FDaGFubmVsV2F0Y2hlciwge1xuICAgICAgICAgIHJlbW90ZUNvbm5BZGRyLFxuICAgICAgICAgIGljcUxvb2t1cEtleVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHtcbiAgICBzdGF0ZVNoYXBlOiB7XG4gICAgICBpY3FDb25uZWN0aW9uczogTS5yZW1vdGFibGUoXCJpY3FDb25uZWN0aW9ucyBtYXBTdG9yZVwiKSxcbiAgICAgIHNoYXJlZElDUVBvcnQ6IE0ub3IoTS5yZW1vdGFibGUoXCJQb3J0XCIpLCBNLnVuZGVmaW5lZCgpKSxcbiAgICAgIHBvcnRBbGxvY2F0b3I6IE0ucmVtb3RhYmxlKFwiUG9ydEFsbG9jYXRvclwiKSxcbiAgICAgIHJlc2VydmVkOiBNLmFueSgpXG4gICAgfVxuICB9XG4pO1xudmFyIHByZXBhcmVDb3Ntb3NJbnRlcmNoYWluU2VydmljZSA9ICh6b25lLCB2b3dUb29scykgPT4ge1xuICBjb25zdCBtYWtlSWNhQWNjb3VudEtpdCA9IHByZXBhcmVJY2FBY2NvdW50S2l0KHpvbmUsIHZvd1Rvb2xzKTtcbiAgY29uc3QgbWFrZUlDUUNvbm5lY3Rpb25LaXQgPSBwcmVwYXJlSUNRQ29ubmVjdGlvbktpdCh6b25lLCB2b3dUb29scyk7XG4gIGNvbnN0IG1ha2VDb3Ntb3NPcmNoZXN0cmF0aW9uU2VydmljZUtpdCA9IHByZXBhcmVDb3Ntb3NPcmNoZXN0cmF0aW9uU2VydmljZUtpdChcbiAgICB6b25lLFxuICAgIHZvd1Rvb2xzLFxuICAgIG1ha2VJY2FBY2NvdW50S2l0LFxuICAgIG1ha2VJQ1FDb25uZWN0aW9uS2l0XG4gICk7XG4gIGNvbnN0IG1ha2VDb3Ntb3NJbnRlcmNoYWluU2VydmljZSA9IHBpY2tGYWNldChcbiAgICBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvblNlcnZpY2VLaXQsXG4gICAgXCJwdWJsaWNcIlxuICApO1xuICByZXR1cm4gbWFrZUNvc21vc0ludGVyY2hhaW5TZXJ2aWNlO1xufTtcbmhhcmRlbihwcmVwYXJlQ29zbW9zSW50ZXJjaGFpblNlcnZpY2UpO1xuXG4vL1xudmFyIG1ha2VDb252ZXJ0ID0gKGNvbnZlcnRSZW1vdGFibGUsIGNvbnZlcnRQcm9taXNlT3JWb3csIGNvbnZlcnRFcnJvcikgPT4ge1xuICBjb25zdCBjb252ZXJ0UmVjdXIgPSAoc3BlY2ltZW4sIGxhYmVsKSA9PiB7XG4gICAgaWYgKGxhYmVsID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBpbm5lckNvbnZlcnQoc3BlY2ltZW4pO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGlubmVyQ29udmVydChzcGVjaW1lbik7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICB0aHJvd0xhYmVsZWQoZXJyLCBsYWJlbCk7XG4gICAgfVxuICB9O1xuICBjb25zdCBpbm5lckNvbnZlcnQgPSAoc3BlY2ltZW4pID0+IHtcbiAgICBpZiAoIWlzT2JqZWN0MihzcGVjaW1lbikpIHtcbiAgICAgIHJldHVybiBzcGVjaW1lbjtcbiAgICB9XG4gICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2Yoc3BlY2ltZW4pO1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgcmV0dXJuIHNwZWNpbWVuLm1hcCgoZWxlbWVudCwgaTIpID0+IGNvbnZlcnRSZWN1cihlbGVtZW50LCBpMikpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICByZXR1cm4gb2JqZWN0TWFwKHNwZWNpbWVuLCAodmFsdWUsIG5hbWUpID0+IGNvbnZlcnRSZWN1cih2YWx1ZSwgbmFtZSkpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgIGlmIChpc1ZvdyhzcGVjaW1lbikpIHtcbiAgICAgICAgICByZXR1cm4gY29udmVydFByb21pc2VPclZvdyhzcGVjaW1lbik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdGFnID0gZ2V0VGFnKHNwZWNpbWVuKTtcbiAgICAgICAgY29uc3QgeyBwYXlsb2FkIH0gPSBzcGVjaW1lbjtcbiAgICAgICAgcmV0dXJuIG1ha2VUYWdnZWQodGFnLCBjb252ZXJ0UmVjdXIocGF5bG9hZCwgYCR7dGFnfSBwYXlsb2FkYCkpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgcmV0dXJuIGNvbnZlcnRFcnJvcihzcGVjaW1lbik7XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgICAgcmV0dXJuIGNvbnZlcnRSZW1vdGFibGUoc3BlY2ltZW4pO1xuICAgICAgfVxuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICByZXR1cm4gY29udmVydFByb21pc2VPclZvdyhzcGVjaW1lbik7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBwYXNzU3R5bGUgJHtxdW90ZShwYXNzU3R5bGUpfWA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBjb252ZXJ0ID0gKHNwZWNpbWVuLCBsYWJlbCA9IHZvaWQgMCkgPT4gY29udmVydFJlY3VyKGhhcmRlbihzcGVjaW1lbiksIGxhYmVsKTtcbiAgcmV0dXJuIGhhcmRlbihjb252ZXJ0KTtcbn07XG52YXIgbWFrZUNvbnZlcnRLaXQgPSAoYmlqZWN0aW9uLCBtYWtlR3Vlc3RGb3JIb3N0UmVtb3RhYmxlLCBtYWtlR3Vlc3RGb3JIb3N0Vm93KSA9PiB7XG4gIGNvbnN0IGd1ZXN0VG9Ib3N0ID0gbWFrZUNvbnZlcnQoXG4gICAgKGdSZW0pID0+IHtcbiAgICAgIGlmIChiaWplY3Rpb24uaGFzR3Vlc3QoZ1JlbSkpIHtcbiAgICAgICAgcmV0dXJuIGJpamVjdGlvbi5ndWVzdFRvSG9zdChnUmVtKTtcbiAgICAgIH1cbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgY2Fubm90IHlldCBzZW5kIGd1ZXN0IHJlbW90YWJsZXMgJHtnUmVtfWA7XG4gICAgfSxcbiAgICAoZ1Byb20pID0+IHtcbiAgICAgIGlmIChiaWplY3Rpb24uaGFzR3Vlc3QoZ1Byb20pKSB7XG4gICAgICAgIHJldHVybiBiaWplY3Rpb24uZ3Vlc3RUb0hvc3QoZ1Byb20pO1xuICAgICAgfVxuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBjYW5ub3QgeWV0IHNlbmQgZ3Vlc3QgcHJvbWlzZXMgJHtnUHJvbX1gO1xuICAgIH0sXG4gICAgKGdFcnIpID0+IHtcbiAgICAgIGNvbnN0IGhFcnIgPSBoYXJkZW4oXG4gICAgICAgIG1ha2VFcnJvcihnRXJyLm1lc3NhZ2UsIGdldEVycm9yQ29uc3RydWN0b3IoZ0Vyci5uYW1lKSlcbiAgICAgICk7XG4gICAgICBub3RlKGhFcnIsIHJlZGFjdGVkYGZyb20gZ3Vlc3QgZXJyb3IgJHtnRXJyfWApO1xuICAgICAgcmV0dXJuIGhFcnI7XG4gICAgfVxuICApO1xuICBjb25zdCBob3N0VG9HdWVzdCA9IG1ha2VDb252ZXJ0KFxuICAgIChoUmVtKSA9PiB7XG4gICAgICBpZiAoYmlqZWN0aW9uLmhhc0hvc3QoaFJlbSkpIHtcbiAgICAgICAgcmV0dXJuIGJpamVjdGlvbi5ob3N0VG9HdWVzdChoUmVtKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGdSZW0gPSBtYWtlR3Vlc3RGb3JIb3N0UmVtb3RhYmxlKGhSZW0pO1xuICAgICAgcmV0dXJuIGJpamVjdGlvbi51bndyYXBJbml0KGdSZW0sIGhSZW0pO1xuICAgIH0sXG4gICAgKGhWb3cpID0+IHtcbiAgICAgIGlmIChiaWplY3Rpb24uaGFzSG9zdChoVm93KSkge1xuICAgICAgICByZXR1cm4gYmlqZWN0aW9uLmhvc3RUb0d1ZXN0KGhWb3cpO1xuICAgICAgfVxuICAgICAgY29uc3QgZ1AgPSBtYWtlR3Vlc3RGb3JIb3N0Vm93KGhWb3cpO1xuICAgICAgcmV0dXJuIGJpamVjdGlvbi51bndyYXBJbml0KGdQLCBoVm93KTtcbiAgICB9LFxuICAgIChoRXJyKSA9PiB7XG4gICAgICBjb25zdCBnRXJyID0gaGFyZGVuKFxuICAgICAgICBtYWtlRXJyb3IoaEVyci5tZXNzYWdlLCBnZXRFcnJvckNvbnN0cnVjdG9yKGhFcnIubmFtZSkpXG4gICAgICApO1xuICAgICAgbm90ZShnRXJyLCByZWRhY3RlZGBmcm9tIGhvc3QgZXJyb3IgJHtoRXJyfWApO1xuICAgICAgcmV0dXJuIGdFcnI7XG4gICAgfVxuICApO1xuICByZXR1cm4gaGFyZGVuKHsgZ3Vlc3RUb0hvc3QsIGhvc3RUb0d1ZXN0IH0pO1xufTtcbmhhcmRlbihtYWtlQ29udmVydEtpdCk7XG5cbi8vXG52YXIgeyBpczogaXM1IH0gPSBPYmplY3Q7XG52YXIgbWFrZUVxdWF0ZSA9IChiaWplY3Rpb24pID0+IHtcbiAgY29uc3QgZXF1YXRlID0gKGczLCBoLCBsYWJlbCkgPT4ge1xuICAgIGlmIChsYWJlbCA9PT0gdm9pZCAwKSB7XG4gICAgICBpbm5lckVxdWF0ZShnMywgaCk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBpbm5lckVxdWF0ZShnMywgaCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICB0aHJvd0xhYmVsZWQoZXJyLCBsYWJlbCk7XG4gICAgfVxuICB9O1xuICBjb25zdCBpbm5lckVxdWF0ZSA9IChnMywgaCkgPT4ge1xuICAgIGlmICghaXNPYmplY3QyKGczKSkge1xuICAgICAgaXM1KGczLCBoKSB8fCAvL1xuICAgICAgdGhyb3dSZWRhY3RlZGB1bmVxdWFsICR7ZzN9IHZzICR7aH1gO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoYmlqZWN0aW9uLmhhc0d1ZXN0KGczKSAmJiBiaWplY3Rpb24uZ3Vlc3RUb0hvc3QoZzMpID09PSBoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGdQYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihnMyk7XG4gICAgaWYgKGdQYXNzU3R5bGUgPT09IFwicHJvbWlzZVwiICYmIGlzVm93KGgpKSB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGd1ZXN0IHByb21pc2VzIG5vdCB5ZXQgcGFzc2FibGVgO1xuICAgIH1cbiAgICBjb25zdCBoUGFzc1N0eWxlID0gcGFzc1N0eWxlT2YoaCk7XG4gICAgZ1Bhc3NTdHlsZSA9PT0gaFBhc3NTdHlsZSB8fCB0aHJvd1JlZGFjdGVkYHVuZXF1YWwgcGFzc1N0eWxlcyAke3F1b3RlKGdQYXNzU3R5bGUpfSB2cyAke3F1b3RlKGhQYXNzU3R5bGUpfWA7XG4gICAgc3dpdGNoIChnUGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgZXF1YXRlKGczLmxlbmd0aCwgaC5sZW5ndGgsIFwibGVuZ3RoXCIpO1xuICAgICAgICBnMy5mb3JFYWNoKChnRWwsIGkyKSA9PiBlcXVhdGUoZ0VsLCBoW2kyXSwgaTIpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICBjb25zdCBnTmFtZXMgPSByZWNvcmROYW1lcyhnMyk7XG4gICAgICAgIGNvbnN0IGhOYW1lcyA9IHJlY29yZE5hbWVzKGgpO1xuICAgICAgICBlcXVhdGUoZ05hbWVzLCBoTmFtZXMsIFwicHJvcGVydHlOYW1lc1wiKTtcbiAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIGdOYW1lcykge1xuICAgICAgICAgIGVxdWF0ZShnM1tuYW1lXSwgaFtuYW1lXSwgbmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgIGVxdWF0ZShnZXRUYWcoZzMpLCBnZXRUYWcoaCksIFwidGFnXCIpO1xuICAgICAgICBlcXVhdGUoZzMucGF5bG9hZCwgaC5wYXlsb2FkLCBcInBheWxvYWRcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgIGVxdWF0ZShnMy5uYW1lLCBoLm5hbWUsIFwiZXJyb3IgbmFtZVwiKTtcbiAgICAgICAgbm90ZShnMywgcmVkYWN0ZWRgcmVwbGF5IG9mIGVycm9yICR7aH1gKTtcbiAgICAgICAgbm90ZShoLCByZWRhY3RlZGByZXBsYXllZCBhcyBlcnJvciAke2czfWApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBjYW5ub3QgeWV0IHNlbmQgZ3Vlc3QgcmVtb3RhYmxlcyB0byBob3N0ICR7ZzN9IHZzICR7aH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGNhbm5vdCB5ZXQgc2VuZCBndWVzdCBwcm9taXNlcyB0byBob3N0ICR7ZzN9IHZzICR7aH1gO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgcGFzc1N0eWxlICR7cXVvdGUoZ1Bhc3NTdHlsZSl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiBoYXJkZW4oZXF1YXRlKTtcbn07XG5oYXJkZW4obWFrZUVxdWF0ZSk7XG5cbi8vXG52YXIgeyBmcm9tRW50cmllczogZnJvbUVudHJpZXMxMywgZGVmaW5lUHJvcGVydGllczogZGVmaW5lUHJvcGVydGllczUsIGFzc2lnbjogYXNzaWduMyB9ID0gT2JqZWN0O1xudmFyIG1ha2VSZXBsYXlNZW1icmFuZSA9IChhcmcpID0+IHtcbiAgY29uc3Qgbm9EdW5kZXJBcmcgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgIE9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyhhcmcpLmZpbHRlcigoW2tdKSA9PiAhay5zdGFydHNXaXRoKFwiX19cIikpKVxuICApO1xuICByZXR1cm4gbWFrZVJlcGxheU1lbWJyYW5lRm9yVGVzdGluZyhub0R1bmRlckFyZyk7XG59O1xudmFyIG1ha2VSZXBsYXlNZW1icmFuZUZvclRlc3RpbmcgPSAoe1xuICBsb2csXG4gIGJpamVjdGlvbixcbiAgdm93VG9vbHMsXG4gIHdhdGNoV2FrZSxcbiAgcGFuaWMsXG4gIF9fZXZlbnR1YWxTZW5kRm9yVGVzdGluZ1xufSkgPT4ge1xuICBjb25zdCB7IHdoZW4sIG1ha2VWb3dLaXQgfSA9IHZvd1Rvb2xzO1xuICBjb25zdCBlcXVhdGUgPSBtYWtlRXF1YXRlKGJpamVjdGlvbik7XG4gIGNvbnN0IGd1ZXN0UHJvbWlzZU1hcCA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBsZXQgc3RvcHBlZCA9IGZhbHNlO1xuICBjb25zdCBQYW5pYyA9ICh0ZW1wbGF0ZSwgLi4uYXJncykgPT4gcGFuaWMobWFrZUVycm9yKHJlZGFjdGVkKHRlbXBsYXRlLCAuLi5hcmdzKSkpO1xuICBjb25zdCBzdGFydEdlbmVyYXRpb24gPSAoZ2VuZXJhdGlvbikgPT4ge1xuICAgIE51bWJlci5pc1NhZmVJbnRlZ2VyKGdlbmVyYXRpb24pIHx8IHRocm93UmVkYWN0ZWRgZ2VuZXJhdGlvbiBleHBlY3RlZCBpbnRlZ2VyOyBnb3QgJHtnZW5lcmF0aW9ufWA7XG4gICAgZ2VuZXJhdGlvbiA+PSAwIHx8IHRocm93UmVkYWN0ZWRgZ2VuZXJhdGlvbiBleHBlY3RlZCBub24tbmVnYXRpdmU7IGdvdCAke2dlbmVyYXRpb259YDtcbiAgfTtcbiAgY29uc3QgZG9GdWxmaWxsID0gKGhvc3RWb3csIGhvc3RGdWxmaWxsbWVudCkgPT4ge1xuICAgIGNvbnN0IGd1ZXN0UHJvbWlzZSA9IGhvc3RUb0d1ZXN0KGhvc3RWb3cpO1xuICAgIGNvbnN0IHN0YXR1cyA9IGd1ZXN0UHJvbWlzZU1hcC5nZXQoZ3Vlc3RQcm9taXNlKTtcbiAgICBpZiAoIXN0YXR1cyB8fCBzdGF0dXMgPT09IFwic2V0dGxlZFwiKSB7XG4gICAgICB0aHJvd1JlZGFjdGVkYGRvRnVsZmlsbCBzaG91bGQgb25seSBiZSBjYWxsZWQgb24gYSByZWdpc3RlcmVkIHVucmVzb2x2ZWQgcHJvbWlzZWA7XG4gICAgfVxuICAgIGNvbnN0IGd1ZXN0RnVsZmlsbG1lbnQgPSBob3N0VG9HdWVzdChob3N0RnVsZmlsbG1lbnQpO1xuICAgIHN0YXR1cy5yZXNvbHZlKGd1ZXN0RnVsZmlsbG1lbnQpO1xuICAgIGd1ZXN0UHJvbWlzZU1hcC5zZXQoZ3Vlc3RQcm9taXNlLCBcInNldHRsZWRcIik7XG4gIH07XG4gIGNvbnN0IGRvUmVqZWN0ID0gKGhvc3RWb3csIGhvc3RSZWFzb24pID0+IHtcbiAgICBjb25zdCBndWVzdFByb21pc2UgPSBob3N0VG9HdWVzdChob3N0Vm93KTtcbiAgICBjb25zdCBzdGF0dXMgPSBndWVzdFByb21pc2VNYXAuZ2V0KGd1ZXN0UHJvbWlzZSk7XG4gICAgaWYgKCFzdGF0dXMgfHwgc3RhdHVzID09PSBcInNldHRsZWRcIikge1xuICAgICAgdGhyb3dSZWRhY3RlZGBkb1JlamVjdCBzaG91bGQgb25seSBiZSBjYWxsZWQgb24gYSByZWdpc3RlcmVkIHVucmVzb2x2ZWQgcHJvbWlzZWA7XG4gICAgfVxuICAgIGNvbnN0IGd1ZXN0UmVhc29uID0gaG9zdFRvR3Vlc3QoaG9zdFJlYXNvbik7XG4gICAgc3RhdHVzLnJlamVjdChndWVzdFJlYXNvbik7XG4gICAgZ3Vlc3RQcm9taXNlTWFwLnNldChndWVzdFByb21pc2UsIFwic2V0dGxlZFwiKTtcbiAgfTtcbiAgY29uc3QgZG9SZXR1cm4gPSAoY2FsbEluZGV4LCBob3N0UmVzdWx0KSA9PiB7XG4gICAgdW5uZXN0SW50ZXJwcmV0ZXIoY2FsbEluZGV4KTtcbiAgICBjb25zdCBndWVzdFJlc3VsdCA9IGhvc3RUb0d1ZXN0KGhvc3RSZXN1bHQpO1xuICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAga2luZDogXCJyZXR1cm5cIixcbiAgICAgIHJlc3VsdDogZ3Vlc3RSZXN1bHRcbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgZG9UaHJvdyA9IChjYWxsSW5kZXgsIGhvc3RQcm9ibGVtKSA9PiB7XG4gICAgdW5uZXN0SW50ZXJwcmV0ZXIoY2FsbEluZGV4KTtcbiAgICBjb25zdCBndWVzdFByb2JsZW0gPSBob3N0VG9HdWVzdChob3N0UHJvYmxlbSk7XG4gICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICBraW5kOiBcInRocm93XCIsXG4gICAgICBwcm9ibGVtOiBndWVzdFByb2JsZW1cbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgcGVyZm9ybUNhbGwgPSAoaG9zdFRhcmdldCwgb3B0VmVyYiwgaG9zdEFyZ3MsIGNhbGxJbmRleCkgPT4ge1xuICAgIGxldCBob3N0UmVzdWx0O1xuICAgIHRyeSB7XG4gICAgICBob3N0UmVzdWx0ID0gb3B0VmVyYiA/IGhvc3RUYXJnZXRbb3B0VmVyYl0oLi4uaG9zdEFyZ3MpIDogaG9zdFRhcmdldCguLi5ob3N0QXJncyk7XG4gICAgICBob3N0VG9HdWVzdChob3N0UmVzdWx0LCBgY29udmVydGluZyAke29wdFZlcmIgfHwgXCJob3N0XCJ9IHJlc3VsdGApO1xuICAgIH0gY2F0Y2ggKGhvc3RQcm9ibGVtKSB7XG4gICAgICByZXR1cm4gbG9nRG8obmVzdERpc3BhdGNoLCBoYXJkZW4oW1wiZG9UaHJvd1wiLCBjYWxsSW5kZXgsIGhvc3RQcm9ibGVtXSkpO1xuICAgIH1cbiAgICByZXR1cm4gbG9nRG8obmVzdERpc3BhdGNoLCBoYXJkZW4oW1wiZG9SZXR1cm5cIiwgY2FsbEluZGV4LCBob3N0UmVzdWx0XSkpO1xuICB9O1xuICBjb25zdCBndWVzdENhbGxzSG9zdCA9IChndWVzdFRhcmdldCwgb3B0VmVyYiwgZ3Vlc3RBcmdzLCBjYWxsSW5kZXgpID0+IHtcbiAgICBpZiAoc3RvcHBlZCB8fCAhYmlqZWN0aW9uLmhhc0d1ZXN0KGd1ZXN0VGFyZ2V0KSkge1xuICAgICAgY29uc3QgZXh0cmFEaWFnbm9zdGljID0gY2FsbFN0YWNrLmxlbmd0aCA9PT0gMCA/IFwiXCIgOiAoXG4gICAgICAgIC8vXG4gICAgICAgIGAgd2l0aCBub24tZW1wdHkgY2FsbHN0YWNrICR7cXVvdGUoY2FsbFN0YWNrKX07YFxuICAgICAgKTtcbiAgICAgIHRocm93UmVkYWN0ZWRgQ2FsbGVkIGZyb20gYSBwcmV2aW91cyBydW46ICR7Z3Vlc3RUYXJnZXR9JHtiYXJlT3JRdW90ZShleHRyYURpYWdub3N0aWMpfWA7XG4gICAgfVxuICAgIGxldCBvdXRjb21lO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBndWVzdEVudHJ5ID0gaGFyZGVuKFtcbiAgICAgICAgXCJjaGVja0NhbGxcIixcbiAgICAgICAgZ3Vlc3RUYXJnZXQsXG4gICAgICAgIG9wdFZlcmIsXG4gICAgICAgIGd1ZXN0QXJncyxcbiAgICAgICAgY2FsbEluZGV4XG4gICAgICBdKTtcbiAgICAgIGlmIChsb2cuaXNSZXBsYXlpbmcoKSkge1xuICAgICAgICBjb25zdCBlbnRyeSA9IGxvZy5uZXh0RW50cnkoKTtcbiAgICAgICAgZXF1YXRlKFxuICAgICAgICAgIGd1ZXN0RW50cnksXG4gICAgICAgICAgZW50cnksXG4gICAgICAgICAgYHJlcGxheSAke2NhbGxJbmRleH06XG4gICAgICR7cXVvdGUoZ3Vlc3RFbnRyeSl9XG4gIHZzICR7cXVvdGUoZW50cnkpfVxuICAgIGBcbiAgICAgICAgKTtcbiAgICAgICAgb3V0Y29tZSA9IC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgbmVzdEludGVycHJldGVyKGNhbGxJbmRleCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBlbnRyeSA9IGd1ZXN0VG9Ib3N0KGd1ZXN0RW50cnkpO1xuICAgICAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICAgICAgY29uc3QgW18sIC4uLmFyZ3NdID0gZW50cnk7XG4gICAgICAgIG5lc3RJbnRlcnByZXRlcihjYWxsSW5kZXgpO1xuICAgICAgICBvdXRjb21lID0gcGVyZm9ybUNhbGwoLi4uYXJncyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZmF0YWxFcnJvcikge1xuICAgICAgdGhyb3cgcGFuaWMoZmF0YWxFcnJvcik7XG4gICAgfVxuICAgIHN3aXRjaCAob3V0Y29tZS5raW5kKSB7XG4gICAgICBjYXNlIFwicmV0dXJuXCI6IHtcbiAgICAgICAgcmV0dXJuIG91dGNvbWUucmVzdWx0O1xuICAgICAgfVxuICAgICAgY2FzZSBcInRocm93XCI6IHtcbiAgICAgICAgdGhyb3cgb3V0Y29tZS5wcm9ibGVtO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyBQYW5pY2B1bmV4cGVjdGVkIG91dGNvbWUga2luZCAke3F1b3RlKG91dGNvbWUua2luZCl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IHBlcmZvcm1TZW5kT25seSA9IChob3N0VGFyZ2V0LCBvcHRWZXJiLCBob3N0QXJncykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBvcHRWZXJiID09PSB2b2lkIDAgPyBoZWFwVm93RS5zZW5kT25seShob3N0VGFyZ2V0KSguLi5ob3N0QXJncykgOiBoZWFwVm93RS5zZW5kT25seShob3N0VGFyZ2V0KVtvcHRWZXJiXSguLi5ob3N0QXJncyk7XG4gICAgfSBjYXRjaCAoaG9zdFByb2JsZW0pIHtcbiAgICAgIHRocm93IFBhbmljYGludGVybmFsOiBldmVudHVhbCBzZW5kT25seSBzeW5jaHJvbm91c2x5IGZhaWxlZCAke2hvc3RQcm9ibGVtfWA7XG4gICAgfVxuICB9O1xuICBjb25zdCBwZXJmb3JtU2VuZCA9IChob3N0VGFyZ2V0LCBvcHRWZXJiLCBob3N0QXJncywgY2FsbEluZGV4LCBob3N0UmVzdWx0S2l0LCBndWVzdFJldHVybmVkUCkgPT4ge1xuICAgIGNvbnN0IHsgdm93LCByZXNvbHZlciB9ID0gaG9zdFJlc3VsdEtpdDtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaG9zdFByb21pc2UgPSBvcHRWZXJiID09PSB2b2lkIDAgPyBoZWFwVm93RShob3N0VGFyZ2V0KSguLi5ob3N0QXJncykgOiBoZWFwVm93RShob3N0VGFyZ2V0KVtvcHRWZXJiXSguLi5ob3N0QXJncyk7XG4gICAgICByZXNvbHZlci5yZXNvbHZlKGhvc3RQcm9taXNlKTtcbiAgICB9IGNhdGNoIChob3N0UHJvYmxlbSkge1xuICAgICAgdGhyb3cgUGFuaWNgaW50ZXJuYWw6IGV2ZW50dWFsIHNlbmQgc3luY2hyb25vdXNseSBmYWlsZWQgJHtob3N0UHJvYmxlbX1gO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgZW50cnkgPSBoYXJkZW4oW1wiZG9SZXR1cm5cIiwgY2FsbEluZGV4LCB2b3ddKTtcbiAgICAgIGxvZy5wdXNoRW50cnkoZW50cnkpO1xuICAgICAgY29uc3QgZ3Vlc3RQcm9taXNlID0gbWFrZUd1ZXN0Rm9ySG9zdFZvdyh2b3csIGd1ZXN0UmV0dXJuZWRQKTtcbiAgICAgIGRvUmV0dXJuKGNhbGxJbmRleCwgdm93KTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBraW5kOiBcInJldHVyblwiLFxuICAgICAgICByZXN1bHQ6IGd1ZXN0UHJvbWlzZVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAocHJvYmxlbSkge1xuICAgICAgdGhyb3cgcGFuaWMocHJvYmxlbSk7XG4gICAgfVxuICB9O1xuICBjb25zdCBndWVzdEhhbmRsZXIgPSBoYXJkZW4oe1xuICAgIGFwcGx5TWV0aG9kU2VuZE9ubHkoZ3Vlc3RUYXJnZXQsIG9wdFZlcmIsIGd1ZXN0QXJncykge1xuICAgICAgX19ldmVudHVhbFNlbmRGb3JUZXN0aW5nIHx8IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGFwcGx5TWV0aG9kU2VuZE9ubHkgbm90IHlldCBzdXBwb3J0ZWQ6ICR7Z3Vlc3RUYXJnZXR9LiR7YmFyZU9yUXVvdGUob3B0VmVyYil9YDtcbiAgICAgIGNvbnN0IGNhbGxJbmRleCA9IGxvZy5nZXRJbmRleCgpO1xuICAgICAgaWYgKHN0b3BwZWQgfHwgIWJpamVjdGlvbi5oYXNHdWVzdChndWVzdFRhcmdldCkpIHtcbiAgICAgICAgdGhyb3dSZWRhY3RlZGBTZW50IGZyb20gYSBwcmV2aW91cyBydW46ICR7Z3Vlc3RUYXJnZXR9YDtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGd1ZXN0RW50cnkgPSBoYXJkZW4oW1xuICAgICAgICAgIFwiY2hlY2tTZW5kT25seVwiLFxuICAgICAgICAgIGd1ZXN0VGFyZ2V0LFxuICAgICAgICAgIG9wdFZlcmIsXG4gICAgICAgICAgZ3Vlc3RBcmdzLFxuICAgICAgICAgIGNhbGxJbmRleFxuICAgICAgICBdKTtcbiAgICAgICAgaWYgKGxvZy5pc1JlcGxheWluZygpKSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBsb2cubmV4dEVudHJ5KCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGVxdWF0ZShndWVzdEVudHJ5LCBlbnRyeSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXF1YXRlRXJyKSB7XG4gICAgICAgICAgICB0aHJvd0xhYmVsZWQoXG4gICAgICAgICAgICAgIGVxdWF0ZUVycixcbiAgICAgICAgICAgICAgYHJlcGxheSAke2NhbGxJbmRleH06XG4gICAgICR7cXVvdGUoZ3Vlc3RFbnRyeSl9XG4gIHZzICR7cXVvdGUoZW50cnkpfVxuICAgIGBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gZ3Vlc3RUb0hvc3QoZ3Vlc3RFbnRyeSk7XG4gICAgICAgICAgbG9nLnB1c2hFbnRyeShlbnRyeSk7XG4gICAgICAgICAgY29uc3QgW19vcCwgaG9zdFRhcmdldCwgX29wdFZlcmIsIGhvc3RBcmdzLCBfY2FsbEluZGV4XSA9IGVudHJ5O1xuICAgICAgICAgIHBlcmZvcm1TZW5kT25seShob3N0VGFyZ2V0LCBvcHRWZXJiLCBob3N0QXJncyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGZhdGFsRXJyb3IpIHtcbiAgICAgICAgdGhyb3cgcGFuaWMoZmF0YWxFcnJvcik7XG4gICAgICB9XG4gICAgfSxcbiAgICBhcHBseU1ldGhvZChndWVzdFRhcmdldCwgb3B0VmVyYiwgZ3Vlc3RBcmdzLCBndWVzdFJldHVybmVkUCkge1xuICAgICAgX19ldmVudHVhbFNlbmRGb3JUZXN0aW5nIHx8IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGFwcGx5TWV0aG9kIG5vdCB5ZXQgc3VwcG9ydGVkOiAke2d1ZXN0VGFyZ2V0fS4ke2JhcmVPclF1b3RlKG9wdFZlcmIpfSAtPiAke2JhcmVPclF1b3RlKGd1ZXN0UmV0dXJuZWRQKX1gO1xuICAgICAgY29uc3QgY2FsbEluZGV4ID0gbG9nLmdldEluZGV4KCk7XG4gICAgICBpZiAoc3RvcHBlZCB8fCAhYmlqZWN0aW9uLmhhc0d1ZXN0KGd1ZXN0VGFyZ2V0KSkge1xuICAgICAgICB0aHJvd1JlZGFjdGVkYFNlbnQgZnJvbSBhIHByZXZpb3VzIHJ1bjogJHtndWVzdFRhcmdldH1gO1xuICAgICAgfVxuICAgICAgY29uc3QgaG9zdFJlc3VsdEtpdCA9IG1ha2VWb3dLaXQoKTtcbiAgICAgIGNvbnN0IGczID0gYmlqZWN0aW9uLnVud3JhcEluaXQoZ3Vlc3RSZXR1cm5lZFAsIGhvc3RSZXN1bHRLaXQudm93KTtcbiAgICAgIGczID09PSBndWVzdFJldHVybmVkUCB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBndWVzdFJldHVybmVkUCBzaG91bGQgbm90IHVud3JhcDogJHtnM30gdnMgJHtndWVzdFJldHVybmVkUH1gO1xuICAgICAgbGV0IG91dGNvbWU7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBndWVzdEVudHJ5ID0gaGFyZGVuKFtcbiAgICAgICAgICBcImNoZWNrU2VuZFwiLFxuICAgICAgICAgIGd1ZXN0VGFyZ2V0LFxuICAgICAgICAgIG9wdFZlcmIsXG4gICAgICAgICAgZ3Vlc3RBcmdzLFxuICAgICAgICAgIGNhbGxJbmRleFxuICAgICAgICBdKTtcbiAgICAgICAgaWYgKGxvZy5pc1JlcGxheWluZygpKSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBsb2cubmV4dEVudHJ5KCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGVxdWF0ZShndWVzdEVudHJ5LCBlbnRyeSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXF1YXRlRXJyKSB7XG4gICAgICAgICAgICB0aHJvd0xhYmVsZWQoXG4gICAgICAgICAgICAgIGVxdWF0ZUVycixcbiAgICAgICAgICAgICAgYHJlcGxheSAke2NhbGxJbmRleH06XG4gICAgICR7cXVvdGUoZ3Vlc3RFbnRyeSl9XG4gIHZzICR7cXVvdGUoZW50cnkpfVxuICAgIGBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG91dGNvbWUgPSAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgbmVzdEludGVycHJldGVyKGNhbGxJbmRleCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBndWVzdFRvSG9zdChndWVzdEVudHJ5KTtcbiAgICAgICAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICAgICAgICBjb25zdCBbX29wLCBob3N0VGFyZ2V0LCBfb3B0VmVyYiwgaG9zdEFyZ3MsIF9jYWxsSW5kZXhdID0gZW50cnk7XG4gICAgICAgICAgbmVzdEludGVycHJldGVyKGNhbGxJbmRleCk7XG4gICAgICAgICAgb3V0Y29tZSA9IHBlcmZvcm1TZW5kKFxuICAgICAgICAgICAgaG9zdFRhcmdldCxcbiAgICAgICAgICAgIG9wdFZlcmIsXG4gICAgICAgICAgICBob3N0QXJncyxcbiAgICAgICAgICAgIGNhbGxJbmRleCxcbiAgICAgICAgICAgIGhvc3RSZXN1bHRLaXQsXG4gICAgICAgICAgICBndWVzdFJldHVybmVkUFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGZhdGFsRXJyb3IpIHtcbiAgICAgICAgdGhyb3cgcGFuaWMoZmF0YWxFcnJvcik7XG4gICAgICB9XG4gICAgICBzd2l0Y2ggKG91dGNvbWUua2luZCkge1xuICAgICAgICBjYXNlIFwicmV0dXJuXCI6IHtcbiAgICAgICAgICByZXR1cm4gb3V0Y29tZS5yZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInRocm93XCI6IHtcbiAgICAgICAgICB0aHJvdyBvdXRjb21lLnByb2JsZW07XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRocm93IFBhbmljYHVuZXhwZWN0ZWQgb3V0Y29tZSBraW5kICR7cXVvdGUob3V0Y29tZS5raW5kKX1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBhcHBseUZ1bmN0aW9uU2VuZE9ubHkoZ3Vlc3RUYXJnZXQsIGd1ZXN0QXJncykge1xuICAgICAgX19ldmVudHVhbFNlbmRGb3JUZXN0aW5nIHx8IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGFwcGx5RnVuY3Rpb25TZW5kT25seSBub3QgeWV0IHN1cHBvcnRlZDogJHtndWVzdFRhcmdldH1gO1xuICAgICAgcmV0dXJuIGd1ZXN0SGFuZGxlci5hcHBseU1ldGhvZFNlbmRPbmx5KFxuICAgICAgICBndWVzdFRhcmdldCxcbiAgICAgICAgdm9pZCAwLFxuICAgICAgICBndWVzdEFyZ3NcbiAgICAgICk7XG4gICAgfSxcbiAgICBhcHBseUZ1bmN0aW9uKGd1ZXN0VGFyZ2V0LCBndWVzdEFyZ3MsIGd1ZXN0UmV0dXJuZWRQKSB7XG4gICAgICBfX2V2ZW50dWFsU2VuZEZvclRlc3RpbmcgfHwgUGFuaWNgZ3Vlc3QgZXZlbnR1YWwgYXBwbHlGdW5jdGlvbiBub3QgeWV0IHN1cHBvcnRlZDogJHtndWVzdFRhcmdldH0gLT4gJHtiYXJlT3JRdW90ZShndWVzdFJldHVybmVkUCl9YDtcbiAgICAgIHJldHVybiBndWVzdEhhbmRsZXIuYXBwbHlNZXRob2QoXG4gICAgICAgIGd1ZXN0VGFyZ2V0LFxuICAgICAgICB2b2lkIDAsXG4gICAgICAgIGd1ZXN0QXJncyxcbiAgICAgICAgZ3Vlc3RSZXR1cm5lZFBcbiAgICAgICk7XG4gICAgfSxcbiAgICBnZXRTZW5kT25seShndWVzdFRhcmdldCwgcHJvcCkge1xuICAgICAgdGhyb3cgUGFuaWNgZ3Vlc3QgZXZlbnR1YWwgZ2V0U2VuZE9ubHkgbm90IHlldCBzdXBwb3J0ZWQ6ICR7Z3Vlc3RUYXJnZXR9LiR7YmFyZU9yUXVvdGUocHJvcCl9YDtcbiAgICB9LFxuICAgIGdldChndWVzdFRhcmdldCwgcHJvcCwgZ3Vlc3RSZXR1cm5lZFApIHtcbiAgICAgIHRocm93IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGdldCBub3QgeWV0IHN1cHBvcnRlZDogJHtndWVzdFRhcmdldH0uJHtiYXJlT3JRdW90ZShwcm9wKX0gLT4gJHtiYXJlT3JRdW90ZShndWVzdFJldHVybmVkUCl9YDtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBtYWtlR3Vlc3RQcmVzZW5jZSA9IChpZmFjZSwgbWV0aG9kRW50cmllcykgPT4ge1xuICAgIGxldCBndWVzdFByZXNlbmNlO1xuICAgIHZvaWQgbmV3IEhhbmRsZWRQcm9taXNlKChfcmVzLCBfcmVqLCByZXNvbHZlV2l0aFByZXNlbmNlKSA9PiB7XG4gICAgICBndWVzdFByZXNlbmNlID0gcmVzb2x2ZVdpdGhQcmVzZW5jZShndWVzdEhhbmRsZXIpO1xuICAgIH0pO1xuICAgIGlmICh0eXBlb2YgZ3Vlc3RQcmVzZW5jZSAhPT0gXCJvYmplY3RcIikge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBwcmVzZW5jZSBleHBlY3RlZCB0byBiZSBvYmplY3QgJHtndWVzdFByZXNlbmNlfWA7XG4gICAgfVxuICAgIGFzc2lnbjMoZ3Vlc3RQcmVzZW5jZSwgZnJvbUVudHJpZXMxMyhtZXRob2RFbnRyaWVzKSk7XG4gICAgY29uc3QgcmVzdWx0ID0gUmVtb3RhYmxlKGlmYWNlLCB2b2lkIDAsIGd1ZXN0UHJlc2VuY2UpO1xuICAgIHJlc3VsdCA9PT0gZ3Vlc3RQcmVzZW5jZSB8fCB0aHJvd1JlZGFjdGVkYFJlbW90YWJsZSBleHBlY3RlZCB0byBtYWtlIHByZXNlbmNlIGluIHBsYWNlOiAke2d1ZXN0UHJlc2VuY2V9IHZzICR7cmVzdWx0fWA7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbiAgY29uc3QgbWFrZUd1ZXN0UHJvbWlzZUtpdCA9ICgpID0+IHtcbiAgICBsZXQgcmVzb2x2ZTI7XG4gICAgbGV0IHJlamVjdDtcbiAgICBjb25zdCBwcm9taXNlID0gbmV3IEhhbmRsZWRQcm9taXNlKChyZXMsIHJlaiwgX3Jlc1ByZXMpID0+IHtcbiAgICAgIHJlc29sdmUyID0gcmVzO1xuICAgICAgcmVqZWN0ID0gcmVqO1xuICAgIH0sIGd1ZXN0SGFuZGxlcik7XG4gICAgcmV0dXJuIGhhcmRlbih7IHByb21pc2UsIHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QgfSk7XG4gIH07XG4gIGNvbnN0IG1ha2VHdWVzdEZvckhvc3RSZW1vdGFibGUgPSAoaFJlbSkgPT4ge1xuICAgIGxldCBnUmVtO1xuICAgIGNvbnN0IG1ha2VHdWVzdE1ldGhvZCA9IChvcHRWZXJiID0gdm9pZCAwKSA9PiB7XG4gICAgICBjb25zdCBndWVzdE1ldGhvZCA9ICguLi5ndWVzdEFyZ3MpID0+IHtcbiAgICAgICAgY29uc3QgY2FsbEluZGV4ID0gbG9nLmdldEluZGV4KCk7XG4gICAgICAgIHJldHVybiBndWVzdENhbGxzSG9zdChnUmVtLCBvcHRWZXJiLCBndWVzdEFyZ3MsIGNhbGxJbmRleCk7XG4gICAgICB9O1xuICAgICAgaWYgKG9wdFZlcmIpIHtcbiAgICAgICAgZGVmaW5lUHJvcGVydGllczUoZ3Vlc3RNZXRob2QsIHtcbiAgICAgICAgICBuYW1lOiB7IHZhbHVlOiBTdHJpbmcoaFJlbVtvcHRWZXJiXS5uYW1lIHx8IG9wdFZlcmIpIH0sXG4gICAgICAgICAgbGVuZ3RoOiB7IHZhbHVlOiBOdW1iZXIoaFJlbVtvcHRWZXJiXS5sZW5ndGggfHwgMCkgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlZmluZVByb3BlcnRpZXM1KGd1ZXN0TWV0aG9kLCB7XG4gICAgICAgICAgbmFtZTogeyB2YWx1ZTogU3RyaW5nKGhSZW0ubmFtZSB8fCBcImFub25cIikgfSxcbiAgICAgICAgICBsZW5ndGg6IHsgdmFsdWU6IE51bWJlcihoUmVtLmxlbmd0aCB8fCAwKSB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGd1ZXN0TWV0aG9kO1xuICAgIH07XG4gICAgY29uc3QgaWZhY2UgPSBTdHJpbmcoZ2V0SW50ZXJmYWNlT2YoaFJlbSkgfHwgXCJyZW1vdGFibGVcIik7XG4gICAgY29uc3QgZ3Vlc3RJZmFjZSA9IGAke2lmYWNlfSBndWVzdCB3cmFwcGVyYDtcbiAgICBpZiAodHlwZW9mIGhSZW0gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgZ1JlbSA9IFJlbW90YWJsZShndWVzdElmYWNlLCB2b2lkIDAsIG1ha2VHdWVzdE1ldGhvZCgpKTtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaG9zdCBmYXIgZnVuY3Rpb25zIG5vdCB5ZXQgcGFzc2FibGVgO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBtZXRob2ROYW1lcyA9IGdldE1ldGhvZE5hbWVzKGhSZW0pO1xuICAgICAgY29uc3QgZ3Vlc3RNZXRob2RzID0gbWV0aG9kTmFtZXMubWFwKChuYW1lKSA9PiBbXG4gICAgICAgIG5hbWUsXG4gICAgICAgIG1ha2VHdWVzdE1ldGhvZChuYW1lKVxuICAgICAgXSk7XG4gICAgICBnUmVtID0gbWFrZUd1ZXN0UHJlc2VuY2UoZ3Vlc3RJZmFjZSwgZ3Vlc3RNZXRob2RzKTtcbiAgICB9XG4gICAgaFJlbSA9IHZvaWQgMDtcbiAgICByZXR1cm4gZ1JlbTtcbiAgfTtcbiAgaGFyZGVuKG1ha2VHdWVzdEZvckhvc3RSZW1vdGFibGUpO1xuICBjb25zdCBtYWtlR3Vlc3RGb3JIb3N0Vm93ID0gKGhWb3csIHByb21pc2VLZXkgPSB2b2lkIDApID0+IHtcbiAgICBpc1ZvdyhoVm93KSB8fCB0aHJvd1JlZGFjdGVkYHZvdyBleHBlY3RlZCAke2hWb3d9YDtcbiAgICBjb25zdCB7IHByb21pc2UsIHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QgfSA9IG1ha2VHdWVzdFByb21pc2VLaXQoKTtcbiAgICBwcm9taXNlS2V5ID8/PSBwcm9taXNlO1xuICAgIGd1ZXN0UHJvbWlzZU1hcC5zZXQocHJvbWlzZUtleSwgaGFyZGVuKHsgcmVzb2x2ZTogcmVzb2x2ZTIsIHJlamVjdCB9KSk7XG4gICAgd2F0Y2hXYWtlKGhWb3cpO1xuICAgIHZvaWQgd2hlbihcbiAgICAgIGhWb3csXG4gICAgICBhc3luYyAoaG9zdEZ1bGZpbGxtZW50KSA9PiB7XG4gICAgICAgIGF3YWl0IGxvZy5wcm9taXNlUmVwbGF5RG9uZSgpO1xuICAgICAgICBpZiAoIXN0b3BwZWQgJiYgZ3Vlc3RQcm9taXNlTWFwLmdldChwcm9taXNlS2V5KSAhPT0gXCJzZXR0bGVkXCIpIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGhhcmRlbihbXCJkb0Z1bGZpbGxcIiwgaFZvdywgaG9zdEZ1bGZpbGxtZW50XSk7XG4gICAgICAgICAgbG9nLnB1c2hFbnRyeShlbnRyeSk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGludGVycHJldE9uZSh0b3BEaXNwYXRjaCwgZW50cnkpO1xuICAgICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGFzeW5jIChob3N0UmVhc29uKSA9PiB7XG4gICAgICAgIGF3YWl0IGxvZy5wcm9taXNlUmVwbGF5RG9uZSgpO1xuICAgICAgICBpZiAoIXN0b3BwZWQgJiYgZ3Vlc3RQcm9taXNlTWFwLmdldChwcm9taXNlS2V5KSAhPT0gXCJzZXR0bGVkXCIpIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGhhcmRlbihbXCJkb1JlamVjdFwiLCBoVm93LCBob3N0UmVhc29uXSk7XG4gICAgICAgICAgbG9nLnB1c2hFbnRyeShlbnRyeSk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGludGVycHJldE9uZSh0b3BEaXNwYXRjaCwgZW50cnkpO1xuICAgICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuIHByb21pc2U7XG4gIH07XG4gIGhhcmRlbihtYWtlR3Vlc3RGb3JIb3N0Vm93KTtcbiAgY29uc3QgeyBndWVzdFRvSG9zdCwgaG9zdFRvR3Vlc3QgfSA9IG1ha2VDb252ZXJ0S2l0KFxuICAgIGJpamVjdGlvbixcbiAgICBtYWtlR3Vlc3RGb3JIb3N0UmVtb3RhYmxlLFxuICAgIG1ha2VHdWVzdEZvckhvc3RWb3dcbiAgKTtcbiAgY29uc3QgdG9wRGlzcGF0Y2ggPSBoYXJkZW4oe1xuICAgIHN0YXJ0R2VuZXJhdGlvbixcbiAgICBkb0Z1bGZpbGwsXG4gICAgZG9SZWplY3RcbiAgICAvL1xuICB9KTtcbiAgY29uc3QgbmVzdERpc3BhdGNoID0gaGFyZGVuKHtcbiAgICBkb1JldHVybixcbiAgICBkb1Rocm93XG4gICAgLy9cbiAgfSk7XG4gIGNvbnN0IGludGVycHJldE9uZSA9IChkaXNwYXRjaCwgW29wLCAuLi5hcmdzXSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBvcCBpbiBkaXNwYXRjaCB8fCAvL1xuICAgICAgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGRpc3BhdGNoIG9wOiAke3F1b3RlKG9wKX1gO1xuICAgICAgcmV0dXJuIGRpc3BhdGNoW29wXSguLi5hcmdzKTtcbiAgICB9IGNhdGNoIChwcm9ibGVtKSB7XG4gICAgICB0aHJvdyBwYW5pYyhwcm9ibGVtKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGxvZ0RvID0gKGRpc3BhdGNoLCBlbnRyeSkgPT4ge1xuICAgIGxvZy5wdXNoRW50cnkoZW50cnkpO1xuICAgIHJldHVybiBpbnRlcnByZXRPbmUoZGlzcGF0Y2gsIGVudHJ5KTtcbiAgfTtcbiAgY29uc3QgY2FsbFN0YWNrID0gW107XG4gIGxldCB1bm5lc3RGbGFnID0gZmFsc2U7XG4gIGNvbnN0IG5lc3RJbnRlcnByZXRlciA9IChjYWxsSW5kZXgpID0+IHtcbiAgICBjYWxsU3RhY2sucHVzaChjYWxsSW5kZXgpO1xuICAgIHdoaWxlIChsb2cuaXNSZXBsYXlpbmcoKSAmJiAhc3RvcHBlZCkge1xuICAgICAgY29uc3QgZW50cnkgPSBsb2cubmV4dFVuZmlsdGVyZWRFbnRyeSgpO1xuICAgICAgY29uc3Qgb3B0T3V0Y29tZSA9IGludGVycHJldE9uZShuZXN0RGlzcGF0Y2gsIGVudHJ5KTtcbiAgICAgIGlmICh1bm5lc3RGbGFnKSB7XG4gICAgICAgIG9wdE91dGNvbWUgfHwgLy9cbiAgICAgICAgdGhyb3dSZWRhY3RlZGBvbmx5IHVubmVzdCB3aXRoIGFuIG91dGNvbWU6ICR7cXVvdGUoZW50cnlbMF0pfWA7XG4gICAgICAgIHVubmVzdEZsYWcgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIG9wdE91dGNvbWU7XG4gICAgICB9XG4gICAgfVxuICAgIHVubmVzdEZsYWcgPSBmYWxzZTtcbiAgfTtcbiAgY29uc3QgdW5uZXN0SW50ZXJwcmV0ZXIgPSAoY2FsbEluZGV4KSA9PiB7XG4gICAgIXN0b3BwZWQgfHwgdGhyb3dSZWRhY3RlZGBUaGlzIG1lbWJyYW5lIHN0b3BwZWQuIFJlc3RhcnQgd2l0aCBuZXcgbWVtYnJhbmUgJHtyZXBsYXlNZW1icmFuZX1gO1xuICAgIGNhbGxTdGFjay5sZW5ndGggPj0gMSB8fCAvL1xuICAgIHRocm93UmVkYWN0ZWRgVW5tYXRjaGVkIHVubmVzdDogJHtxdW90ZShjYWxsSW5kZXgpfWA7XG4gICAgY29uc3QgaTIgPSBjYWxsU3RhY2sucG9wKCk7XG4gICAgaTIgPT09IGNhbGxJbmRleCB8fCAvL1xuICAgIHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCB1bm5lc3Q6ICR7cXVvdGUoY2FsbEluZGV4KX0gdnMgJHtxdW90ZShpMil9YDtcbiAgICB1bm5lc3RGbGFnID0gdHJ1ZTtcbiAgICBpZiAoY2FsbFN0YWNrLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdm9pZCBFLndoZW4odm9pZCAwLCB3YWtlKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHdha2UgPSAoKSA9PiB7XG4gICAgd2hpbGUgKGxvZy5pc1JlcGxheWluZygpICYmICFzdG9wcGVkKSB7XG4gICAgICBjYWxsU3RhY2subGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgd2FrZSBvbmx5IHdpdGggZW1wdHkgY2FsbFN0YWNrOiAke3F1b3RlKGNhbGxTdGFjayl9YDtcbiAgICAgIGNvbnN0IGVudHJ5ID0gbG9nLnBlZWtFbnRyeSgpO1xuICAgICAgY29uc3Qgb3AgPSBlbnRyeVswXTtcbiAgICAgIGlmICghKG9wIGluIHRvcERpc3BhdGNoKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2b2lkIGxvZy5uZXh0VW5maWx0ZXJlZEVudHJ5KCk7XG4gICAgICBpbnRlcnByZXRPbmUodG9wRGlzcGF0Y2gsIGVudHJ5KTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHN0b3AgPSAoKSA9PiB7XG4gICAgc3RvcHBlZCA9IHRydWU7XG4gIH07XG4gIGNvbnN0IHJlcGxheU1lbWJyYW5lID0gRmFyKFwicmVwbGF5TWVtYnJhbmVcIiwge1xuICAgIGhvc3RUb0d1ZXN0LFxuICAgIGd1ZXN0VG9Ib3N0LFxuICAgIHdha2UsXG4gICAgc3RvcFxuICB9KTtcbiAgcmV0dXJuIHJlcGxheU1lbWJyYW5lO1xufTtcbmhhcmRlbihtYWtlUmVwbGF5TWVtYnJhbmUpO1xuXG4vL1xudmFyIEZsb3dTdGF0ZVNoYXBlID0gTS5vcihcbiAgXCJSdW5uaW5nXCIsXG4gIFwiU2xlZXBpbmdcIixcbiAgXCJSZXBsYXlpbmdcIixcbiAgXCJGYWlsZWRcIixcbiAgXCJEb25lXCJcbik7XG52YXIgUHJvcGVydHlLZXlTaGFwZSA9IE0ub3IoTS5zdHJpbmcoKSwgTS5zeW1ib2woKSk7XG52YXIgTG9nRW50cnlTaGFwZSA9IE0ub3IoXG4gIFtcInN0YXJ0R2VuZXJhdGlvblwiLCBNLm51bWJlcigpXSxcbiAgLy9cbiAgW1wiZG9GdWxmaWxsXCIsIFZvd1NoYXBlLCBNLmFueSgpXSxcbiAgW1wiZG9SZWplY3RcIiwgVm93U2hhcGUsIE0uYW55KCldLFxuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICBbXCJkb1JldHVyblwiLCBNLm51bWJlcigpLCBNLmFueSgpXSxcbiAgW1wiZG9UaHJvd1wiLCBNLm51bWJlcigpLCBNLmFueSgpXSxcbiAgLy9cbiAgLy9cbiAgLy9cbiAgW1xuICAgIFwiY2hlY2tDYWxsXCIsXG4gICAgTS5yZW1vdGFibGUoXCJob3N0IHRhcmdldFwiKSxcbiAgICBNLm9wdChQcm9wZXJ0eUtleVNoYXBlKSxcbiAgICBNLmFycmF5T2YoTS5hbnkoKSksXG4gICAgTS5udW1iZXIoKVxuICBdLFxuICBbXG4gICAgXCJjaGVja1NlbmRPbmx5XCIsXG4gICAgTS5vcihNLnJlbW90YWJsZShcImhvc3QgdGFyZ2V0XCIpLCBWb3dTaGFwZSksXG4gICAgTS5vcHQoUHJvcGVydHlLZXlTaGFwZSksXG4gICAgTS5hcnJheU9mKE0uYW55KCkpLFxuICAgIE0ubnVtYmVyKClcbiAgXSxcbiAgW1xuICAgIFwiY2hlY2tTZW5kXCIsXG4gICAgTS5vcihNLnJlbW90YWJsZShcImhvc3QgdGFyZ2V0XCIpLCBWb3dTaGFwZSksXG4gICAgTS5vcHQoUHJvcGVydHlLZXlTaGFwZSksXG4gICAgTS5hcnJheU9mKE0uYW55KCkpLFxuICAgIE0ubnVtYmVyKClcbiAgXVxuICAvL1xuICAvL1xuKTtcblxuLy9cbnZhciBtYWtlRXBoZW1lcmEgPSAocmVpbml0KSA9PiB7XG4gIGNvbnN0IG1hcCA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBmb3Ioc2VsZikge1xuICAgICAgaWYgKCFtYXAuaGFzKHNlbGYpKSB7XG4gICAgICAgIG1hcC5zZXQoc2VsZiwgcmVpbml0KHNlbGYpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAoXG4gICAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgICAgbWFwLmdldChzZWxmKVxuICAgICAgKTtcbiAgICB9LFxuICAgIHJlc2V0Rm9yKHNlbGYpIHtcbiAgICAgIHJldHVybiBtYXAuZGVsZXRlKHNlbGYpO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VFcGhlbWVyYSk7XG5cbi8vXG52YXIgTG9nU3RvcmVJID0gTS5pbnRlcmZhY2UoXCJMb2dTdG9yZVwiLCB7XG4gIHJlc2V0OiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gIGRpc3Bvc2U6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgZ2V0VW5maWx0ZXJlZEluZGV4OiBNLmNhbGwoKS5yZXR1cm5zKE0ubnVtYmVyKCkpLFxuICBnZXRJbmRleDogTS5jYWxsKCkucmV0dXJucyhNLm51bWJlcigpKSxcbiAgZ2V0TGVuZ3RoOiBNLmNhbGwoKS5yZXR1cm5zKE0ubnVtYmVyKCkpLFxuICBpc1JlcGxheWluZzogTS5jYWxsKCkucmV0dXJucyhNLmJvb2xlYW4oKSksXG4gIHBlZWtFbnRyeTogTS5jYWxsKCkucmV0dXJucyhMb2dFbnRyeVNoYXBlKSxcbiAgbmV4dEVudHJ5OiBNLmNhbGwoKS5yZXR1cm5zKExvZ0VudHJ5U2hhcGUpLFxuICBuZXh0VW5maWx0ZXJlZEVudHJ5OiBNLmNhbGwoKS5yZXR1cm5zKExvZ0VudHJ5U2hhcGUpLFxuICBwdXNoRW50cnk6IE0uY2FsbChMb2dFbnRyeVNoYXBlKS5yZXR1cm5zKE0ubnVtYmVyKCkpLFxuICBkdW1wVW5maWx0ZXJlZDogTS5jYWxsKCkucmV0dXJucyhNLmFycmF5T2YoTG9nRW50cnlTaGFwZSkpLFxuICBkdW1wOiBNLmNhbGwoKS5yZXR1cm5zKE0uYXJyYXlPZihMb2dFbnRyeVNoYXBlKSksXG4gIHByb21pc2VSZXBsYXlEb25lOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxufSk7XG52YXIgbmV4dEdlbmVyYXRpb24gPSAoem9uZSkgPT4ge1xuICBjb25zdCBsb2dTdG9yZU1ldGFkYXRhID0gem9uZS5tYXBTdG9yZShcIkxvZ1N0b3JlTWV0YWRhdGFcIik7XG4gIGNvbnN0IGdlbmVyYXRpb25LZXkgPSBcImdlbmVyYXRpb25cIjtcbiAgaWYgKCFsb2dTdG9yZU1ldGFkYXRhLmhhcyhnZW5lcmF0aW9uS2V5KSkge1xuICAgIGNvbnN0IGZpcnN0R2VuID0gMDtcbiAgICBsb2dTdG9yZU1ldGFkYXRhLmluaXQoZ2VuZXJhdGlvbktleSwgZmlyc3RHZW4pO1xuICAgIHJldHVybiBmaXJzdEdlbjtcbiAgfVxuICBjb25zdCBuZXh0R2VuID0gbG9nU3RvcmVNZXRhZGF0YS5nZXQoZ2VuZXJhdGlvbktleSkgKyAxO1xuICBsb2dTdG9yZU1ldGFkYXRhLnNldChnZW5lcmF0aW9uS2V5LCBuZXh0R2VuKTtcbiAgcmV0dXJuIG5leHRHZW47XG59O1xudmFyIHByZXBhcmVMb2dTdG9yZSA9ICh6b25lKSA9PiB7XG4gIGNvbnN0IGluaXRpYWxQdXNoID0gaGFyZGVuKFtbXCJzdGFydEdlbmVyYXRpb25cIiwgbmV4dEdlbmVyYXRpb24oem9uZSldXSk7XG4gIGNvbnN0IGVudHJ5SXNWaXNpYmxlID0gKGVudHJ5KSA9PiBlbnRyeVswXSAhPT0gXCJzdGFydEdlbmVyYXRpb25cIjtcbiAgY29uc3QgdG1wID0gbWFrZUVwaGVtZXJhKChsb2cpID0+IHtcbiAgICBjb25zdCByZXN1bHQgPSB7XG4gICAgICBpbmRleDogMCxcbiAgICAgIHVuZmlsdGVyZWRJbmRleDogMCxcbiAgICAgIGluaXRpYWxQdXNoLFxuICAgICAgcmVwbGF5RG9uZUtpdDogbWFrZVByb21pc2VLaXQoKVxuICAgIH07XG4gICAgaWYgKGxvZy5nZXRMZW5ndGgoKSA9PT0gMCkge1xuICAgICAgcmVzdWx0LnJlcGxheURvbmVLaXQucmVzb2x2ZSh2b2lkIDApO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9KTtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3MoXG4gICAgXCJMb2dTdG9yZVwiLFxuICAgIExvZ1N0b3JlSSxcbiAgICAoKSA9PiB7XG4gICAgICBjb25zdCBtYXBTdG9yZSA9IHpvbmUuZGV0YWNoZWQoKS5tYXBTdG9yZShcImxvZ01hcFN0b3JlXCIsIHtcbiAgICAgICAga2V5U2hhcGU6IE0ubnVtYmVyKCksXG4gICAgICAgIHZhbHVlU2hhcGU6IExvZ0VudHJ5U2hhcGVcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbWFwU3RvcmVcbiAgICAgIH07XG4gICAgfSxcbiAgICB7XG4gICAgICByZXNldCgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICB0bXAucmVzZXRGb3Ioc2VsZik7XG4gICAgICB9LFxuICAgICAgZGlzcG9zZSgpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSwgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtYXBTdG9yZSB9ID0gc3RhdGU7XG4gICAgICAgIHRtcC5yZXNldEZvcihzZWxmKTtcbiAgICAgICAgbWFwU3RvcmUuY2xlYXIoKTtcbiAgICAgIH0sXG4gICAgICBnZXRVbmZpbHRlcmVkSW5kZXgoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgcmV0dXJuIGVwaC51bmZpbHRlcmVkSW5kZXg7XG4gICAgICB9LFxuICAgICAgZ2V0SW5kZXgoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgcmV0dXJuIGVwaC5pbmRleDtcbiAgICAgIH0sXG4gICAgICBnZXRMZW5ndGgoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbWFwU3RvcmUgfSA9IHN0YXRlO1xuICAgICAgICByZXR1cm4gbWFwU3RvcmUuZ2V0U2l6ZSgpO1xuICAgICAgfSxcbiAgICAgIGlzUmVwbGF5aW5nKCkge1xuICAgICAgICBjb25zdCB7IHN0YXRlLCBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IG1hcFN0b3JlIH0gPSBzdGF0ZTtcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgcmV0dXJuIGVwaC51bmZpbHRlcmVkSW5kZXggPCBtYXBTdG9yZS5nZXRTaXplKCk7XG4gICAgICB9LFxuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBwZWVrRW50cnkoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUsIHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbWFwU3RvcmUgfSA9IHN0YXRlO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICBzZWxmLmlzUmVwbGF5aW5nKCkgfHwgdGhyb3dSZWRhY3RlZGBObyBsb25nZXIgcmVwbGF5aW5nOiAke3F1b3RlKGVwaC51bmZpbHRlcmVkSW5kZXgpfSB2cyAke3F1b3RlKFxuICAgICAgICAgIG1hcFN0b3JlLmdldFNpemUoKVxuICAgICAgICApfWA7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IG1hcFN0b3JlLmdldChlcGgudW5maWx0ZXJlZEluZGV4KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0sXG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIG5leHRVbmZpbHRlcmVkRW50cnkoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gc2VsZi5wZWVrRW50cnkoKTtcbiAgICAgICAgZXBoLnVuZmlsdGVyZWRJbmRleCArPSAxO1xuICAgICAgICBpZiAoZW50cnlJc1Zpc2libGUocmVzdWx0KSkge1xuICAgICAgICAgIGVwaC5pbmRleCArPSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmICghc2VsZi5pc1JlcGxheWluZygpKSB7XG4gICAgICAgICAgZXBoLnJlcGxheURvbmVLaXQucmVzb2x2ZSh2b2lkIDApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9LFxuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBuZXh0RW50cnkoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgbGV0IHJlc3VsdCA9IHNlbGYubmV4dFVuZmlsdGVyZWRFbnRyeSgpO1xuICAgICAgICB3aGlsZSAoIWVudHJ5SXNWaXNpYmxlKHJlc3VsdCkpIHtcbiAgICAgICAgICBzZWxmLmlzUmVwbGF5aW5nKCkgfHwgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIGVudHJ5IGF0IGxvZyB0YWlsOiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJlc3VsdCA9IHNlbGYubmV4dFVuZmlsdGVyZWRFbnRyeSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9LFxuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBwdXNoRW50cnkobGF0ZXN0RW50cnkpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSwgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtYXBTdG9yZSB9ID0gc3RhdGU7XG4gICAgICAgIGNvbnN0IGVwaCA9IHRtcC5mb3Ioc2VsZik7XG4gICAgICAgICFzZWxmLmlzUmVwbGF5aW5nKCkgfHwgdGhyb3dSZWRhY3RlZGBzdGlsbCByZXBsYXlpbmc6ICR7cXVvdGUoZXBoLnVuZmlsdGVyZWRJbmRleCl9IHZzICR7cXVvdGUobWFwU3RvcmUuZ2V0U2l6ZSgpKX1gO1xuICAgICAgICBjb25zdCBwdXNoT25lID0gKGVudHJ5KSA9PiB7XG4gICAgICAgICAgZXBoLnVuZmlsdGVyZWRJbmRleCA9PT0gbWFwU3RvcmUuZ2V0U2l6ZSgpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IHVuZmlsdGVyZWRJbmRleCBjb25mdXNpb24gJHtxdW90ZShlcGgudW5maWx0ZXJlZEluZGV4KX0gdnMgJHtxdW90ZShcbiAgICAgICAgICAgIG1hcFN0b3JlLmdldFNpemUoKVxuICAgICAgICAgICl9YDtcbiAgICAgICAgICBtYXBTdG9yZS5pbml0KGVwaC51bmZpbHRlcmVkSW5kZXgsIGVudHJ5KTtcbiAgICAgICAgICBlcGgudW5maWx0ZXJlZEluZGV4ICs9IDE7XG4gICAgICAgICAgaWYgKGVudHJ5SXNWaXNpYmxlKGVudHJ5KSkge1xuICAgICAgICAgICAgZXBoLmluZGV4ICs9IDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVwaC51bmZpbHRlcmVkSW5kZXggPT09IG1hcFN0b3JlLmdldFNpemUoKSB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiB1bmZpbHRlcmVkSW5kZXggY29uZnVzaW9uICR7cXVvdGUoZXBoLnVuZmlsdGVyZWRJbmRleCl9IHZzICR7cXVvdGUoXG4gICAgICAgICAgICBtYXBTdG9yZS5nZXRTaXplKClcbiAgICAgICAgICApfWA7XG4gICAgICAgIH07XG4gICAgICAgIGlmIChlcGguaW5pdGlhbFB1c2gpIHtcbiAgICAgICAgICBjb25zdCBpbml0aWFsRW50cmllcyA9IGVwaC5pbml0aWFsUHVzaDtcbiAgICAgICAgICBlcGguaW5pdGlhbFB1c2ggPSB2b2lkIDA7XG4gICAgICAgICAgZm9yIChjb25zdCBpbml0aWFsRW50cnkgb2YgaW5pdGlhbEVudHJpZXMpIHtcbiAgICAgICAgICAgIHB1c2hPbmUoaW5pdGlhbEVudHJ5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcHVzaE9uZShsYXRlc3RFbnRyeSk7XG4gICAgICAgIHJldHVybiBlcGgudW5maWx0ZXJlZEluZGV4O1xuICAgICAgfSxcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgZHVtcFVuZmlsdGVyZWQoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbWFwU3RvcmUgfSA9IHN0YXRlO1xuICAgICAgICBjb25zdCBsZW4gPSBtYXBTdG9yZS5nZXRTaXplKCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbGVuOyBpMiArPSAxKSB7XG4gICAgICAgICAgcmVzdWx0LnB1c2gobWFwU3RvcmUuZ2V0KGkyKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGhhcmRlbihyZXN1bHQpO1xuICAgICAgfSxcbiAgICAgIGR1bXAoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIGhhcmRlbihzZWxmLmR1bXBVbmZpbHRlcmVkKCkuZmlsdGVyKGVudHJ5SXNWaXNpYmxlKSk7XG4gICAgICB9LFxuICAgICAgcHJvbWlzZVJlcGxheURvbmUoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgcmV0dXJuIGVwaC5yZXBsYXlEb25lS2l0LnByb21pc2U7XG4gICAgICB9XG4gICAgfVxuICApO1xufTtcblxuLy9cbnZhciBCaWplY3Rpb25JID0gTS5pbnRlcmZhY2UoXCJCaWplY3Rpb25cIiwge1xuICByZXNldDogTS5jYWxsKCkucmV0dXJucygpLFxuICB1bndyYXBJbml0OiBNLmNhbGwoTS5yYXcoKSwgTS5hbnkoKSkucmV0dXJucyhNLnJhdygpKSxcbiAgaGFzR3Vlc3Q6IE0uY2FsbChNLnJhdygpKS5yZXR1cm5zKE0uYm9vbGVhbigpKSxcbiAgaGFzSG9zdDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICBoYXM6IE0uY2FsbChNLnJhdygpLCBNLmFueSgpKS5yZXR1cm5zKE0uYm9vbGVhbigpKSxcbiAgZ3Vlc3RUb0hvc3Q6IE0uY2FsbChNLnJhdygpKS5yZXR1cm5zKE0uYW55KCkpLFxuICBob3N0VG9HdWVzdDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoTS5yYXcoKSlcbn0pO1xudmFyIHRvS2V5ID0gKGspID0+IChcbiAgLy9cbiAgaXNQYXNzYWJsZShrKSA/IHRvUGFzc2FibGVDYXAoaykgOiBrXG4pO1xudmFyIG1ha2VWb3dpc2hTdG9yZSA9IChuYW1lKSA9PiB7XG4gIGNvbnN0IG1hcCA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIHJldHVybiBGYXIobmFtZSwge1xuICAgIGluaXQ6IChrLCB2MikgPT4ge1xuICAgICAgY29uc3QgazIgPSB0b0tleShrKTtcbiAgICAgICFtYXAuaGFzKGsyKSB8fCAvL1xuICAgICAgdGhyb3dSZWRhY3RlZGAke2JhcmVPclF1b3RlKG5hbWUpfSBrZXkgYWxyZWFkeSBib3VuZDogJHtrfSAtPiAke21hcC5nZXQoazIpfSB2cyAke3YyfWA7XG4gICAgICBtYXAuc2V0KGsyLCB2Mik7XG4gICAgfSxcbiAgICBoYXM6IChrKSA9PiBtYXAuaGFzKHRvS2V5KGspKSxcbiAgICBnZXQ6IChrKSA9PiB7XG4gICAgICBjb25zdCBrMiA9IHRvS2V5KGspO1xuICAgICAgbWFwLmhhcyhrMikgfHwgLy9cbiAgICAgIHRocm93UmVkYWN0ZWRgJHtiYXJlT3JRdW90ZShuYW1lKX0ga2V5IG5vdCBmb3VuZDogJHtrfWA7XG4gICAgICByZXR1cm4gbWFwLmdldChrMik7XG4gICAgfVxuICB9KTtcbn07XG52YXIgcHJlcGFyZUJpamVjdGlvbiA9ICh6b25lLCB1bndyYXAgPSAoX2hvc3RXcmFwcGVyLCBndWVzdFdyYXBwZXIpID0+IGd1ZXN0V3JhcHBlcikgPT4ge1xuICBjb25zdCBnMmggPSBtYWtlRXBoZW1lcmEoKCkgPT4gbWFrZVZvd2lzaFN0b3JlKFwiZ3Vlc3RUb0hvc3RcIikpO1xuICBjb25zdCBoMmcgPSBtYWtlRXBoZW1lcmEoKCkgPT4gbWFrZVZvd2lzaFN0b3JlKFwiaG9zdFRvR3Vlc3RcIikpO1xuICByZXR1cm4gem9uZS5leG9DbGFzcyhcIkJpamVjdGlvblwiLCBCaWplY3Rpb25JLCAoKSA9PiAoe30pLCB7XG4gICAgcmVzZXQoKSB7XG4gICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICBnMmgucmVzZXRGb3Ioc2VsZik7XG4gICAgICBoMmcucmVzZXRGb3Ioc2VsZik7XG4gICAgfSxcbiAgICB1bndyYXBJbml0KGczLCBoKSB7XG4gICAgICBoYXJkZW4oZzMpO1xuICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgY29uc3QgZ3Vlc3RUb0hvc3QgPSBnMmguZm9yKHNlbGYpO1xuICAgICAgY29uc3QgaG9zdFRvR3Vlc3QgPSBoMmcuZm9yKHNlbGYpO1xuICAgICAgY29uc3QgZ1Vud3JhcHBlZCA9IHVud3JhcChoLCBnMyk7XG4gICAgICAhaG9zdFRvR3Vlc3QuaGFzKGgpIHx8IHRocm93UmVkYWN0ZWRgaG9zdFRvR3Vlc3Qga2V5IGFscmVhZHkgYm91bmQ6ICR7aH0gLT4gJHtob3N0VG9HdWVzdC5nZXQoaCl9IHZzICR7Z1Vud3JhcHBlZH1gO1xuICAgICAgZ3Vlc3RUb0hvc3QuaW5pdChnVW53cmFwcGVkLCBoKTtcbiAgICAgIGhvc3RUb0d1ZXN0LmluaXQoaCwgZ1Vud3JhcHBlZCk7XG4gICAgICBzZWxmLmhhcyhnVW53cmFwcGVkLCBoKSB8fCAvL1xuICAgICAgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogJHtnM30gPC0+ICR7aH1gO1xuICAgICAgaWYgKGczICE9PSBnVW53cmFwcGVkKSB7XG4gICAgICAgICFndWVzdFRvSG9zdC5oYXMoZzMpIHx8IC8vXG4gICAgICAgIHRocm93UmVkYWN0ZWRgaGlkZGVuIGd1ZXN0IHdyYXBwZXIgYWxyZWFkeSBib3VuZCAke2czfWA7XG4gICAgICAgIGd1ZXN0VG9Ib3N0LmluaXQoZzMsIGgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGdVbndyYXBwZWQ7XG4gICAgfSxcbiAgICBoYXNHdWVzdChnMykge1xuICAgICAgaGFyZGVuKGczKTtcbiAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgIGNvbnN0IGd1ZXN0VG9Ib3N0ID0gZzJoLmZvcihzZWxmKTtcbiAgICAgIHJldHVybiBndWVzdFRvSG9zdC5oYXMoZzMpO1xuICAgIH0sXG4gICAgaGFzSG9zdChoKSB7XG4gICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICBjb25zdCBob3N0VG9HdWVzdCA9IGgyZy5mb3Ioc2VsZik7XG4gICAgICByZXR1cm4gaG9zdFRvR3Vlc3QuaGFzKGgpO1xuICAgIH0sXG4gICAgaGFzKGczLCBoKSB7XG4gICAgICBoYXJkZW4oZzMpO1xuICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgY29uc3QgZ3Vlc3RUb0hvc3QgPSBnMmguZm9yKHNlbGYpO1xuICAgICAgY29uc3QgaG9zdFRvR3Vlc3QgPSBoMmcuZm9yKHNlbGYpO1xuICAgICAgaWYgKGd1ZXN0VG9Ib3N0LmhhcyhnMykpIHtcbiAgICAgICAgdG9QYXNzYWJsZUNhcChndWVzdFRvSG9zdC5nZXQoZzMpKSA9PT0gdG9QYXNzYWJsZUNhcChoKSB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBnLT5oICR7ZzN9IC0+ICR7aH0gdnMgJHtndWVzdFRvSG9zdC5nZXQoZzMpfWA7XG4gICAgICAgIGhvc3RUb0d1ZXN0LmdldChoKSA9PT0gZzMgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbCBoLT5nOiAke2h9IC0+ICR7ZzN9IHZzICR7aG9zdFRvR3Vlc3QuZ2V0KGgpfWA7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgIWhvc3RUb0d1ZXN0LmhhcyhoKSB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiB1bmV4cGVjdGVkIGgtPmcgJHtofSAtPiAke2hvc3RUb0d1ZXN0LmdldChoKX1gO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfSxcbiAgICBndWVzdFRvSG9zdChnMykge1xuICAgICAgaGFyZGVuKGczKTtcbiAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgIGNvbnN0IGd1ZXN0VG9Ib3N0ID0gZzJoLmZvcihzZWxmKTtcbiAgICAgIHJldHVybiBndWVzdFRvSG9zdC5nZXQoZzMpO1xuICAgIH0sXG4gICAgaG9zdFRvR3Vlc3QoaCkge1xuICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgY29uc3QgaG9zdFRvR3Vlc3QgPSBoMmcuZm9yKHNlbGYpO1xuICAgICAgcmV0dXJuIGhvc3RUb0d1ZXN0LmdldChoKTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihwcmVwYXJlQmlqZWN0aW9uKTtcblxuLy9cbnZhciB7XG4gIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMyxcbiAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczgsXG4gIGNyZWF0ZTogY3JlYXRlNyxcbiAgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTQsXG4gIGVudHJpZXM6IGVudHJpZXM5LFxuICBwcm90b3R5cGU6IG9iamVjdFByb3RvdHlwZTZcbn0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzMjEgfSA9IFJlZmxlY3Q7XG52YXIgRnVuY3Rpb25XcmFwcGVySSA9IE0uaW50ZXJmYWNlKFwiRnVuY3Rpb25XcmFwcGVyXCIsIHtcbiAgYXBwbHk6IE0uY2FsbChNLmFycmF5KCkpLnJldHVybnMoTS5hbnkoKSlcbn0pO1xudmFyIFN0YXRlQWNjZXNzb3JJID0gTS5pbnRlcmZhY2UoXCJTdGF0ZUFjY2Vzc29yXCIsIHtcbiAgZ2V0OiBNLmNhbGwoUHJvcGVydHlLZXlTaGFwZSkucmV0dXJucyhNLmFueSgpKSxcbiAgc2V0OiBNLmNhbGwoUHJvcGVydHlLZXlTaGFwZSwgTS5hbnkoKSkucmV0dXJucygpXG59KTtcbnZhciBVbndyYXBwZXJJID0gTS5pbnRlcmZhY2UoXCJVbndyYXBwZXJcIiwge1xuICB1bndyYXA6IE0uY2FsbChNLnJlbW90YWJsZShcImd1ZXN0V3JhcHBlZFwiKSkucmV0dXJucyhNLnJhdygpKVxufSk7XG52YXIgZm9yd2FyZGluZ01ldGhvZHMgPSAocmVtKSA9PiB7XG4gIGNvbnN0IGtleXM0ID0gcmVtW0dFVF9NRVRIT0RfTkFNRVNdKCk7XG4gIGNvbnN0IG1ha2VNZXRob2RFbnRyeSA9IChrZXkpID0+IGVudHJpZXM5KHtcbiAgICBba2V5XSguLi5hcmdzKSB7XG4gICAgICByZXR1cm4gcmVtW2tleV0oLi4uYXJncyk7XG4gICAgfVxuICB9KVswXTtcbiAgcmV0dXJuIGZyb21FbnRyaWVzMTQoa2V5czQubWFwKG1ha2VNZXRob2RFbnRyeSkpO1xufTtcbnZhciBwcmVwYXJlRW5kb3dtZW50VG9vbHMgPSAob3V0ZXJab25lLCBvdXRlck9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IHZvd1Rvb2xzID0gcHJlcGFyZVN3aW5nc2V0Vm93VG9vbHMob3V0ZXJab25lKSB9ID0gb3V0ZXJPcHRpb25zO1xuICBjb25zdCB7IG1ha2VWb3dLaXQgfSA9IHZvd1Rvb2xzO1xuICBjb25zdCBmdW5jdGlvblVud3JhcHBlciA9IG91dGVyWm9uZS5leG8oXCJGdW5jdGlvblVud3JhcHBlclwiLCBVbndyYXBwZXJJLCB7XG4gICAgdW53cmFwKGd1ZXN0V3JhcHBlZCkge1xuICAgICAgcmV0dXJuIEZhcihcIlVud3JhcHBlZEZ1bmN0aW9uXCIsICguLi5hcmdzKSA9PiBndWVzdFdyYXBwZWQuYXBwbHkoYXJncykpO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IG1ha2VTdGF0ZVVud3JhcHBlciA9IG91dGVyWm9uZS5leG9DbGFzcyhcbiAgICBcIlN0YXRlVW53cmFwcGVyXCIsXG4gICAgVW53cmFwcGVySSxcbiAgICAoa2V5czQpID0+ICh7IGtleXM6IGtleXM0IH0pLFxuICAgIHtcbiAgICAgIHVud3JhcChndWVzdFdyYXBwZWQpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBrZXlzOiBrZXlzNCB9ID0gc3RhdGU7XG4gICAgICAgIHJldHVybiBoYXJkZW4oXG4gICAgICAgICAgY3JlYXRlNyhcbiAgICAgICAgICAgIG9iamVjdFByb3RvdHlwZTYsXG4gICAgICAgICAgICBmcm9tRW50cmllczE0KFxuICAgICAgICAgICAgICBrZXlzNC5mbGF0TWFwKFxuICAgICAgICAgICAgICAgIChrZXkpID0+IGVudHJpZXM5KFxuICAgICAgICAgICAgICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczgoe1xuICAgICAgICAgICAgICAgICAgICBnZXQgW2tleV0oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGd1ZXN0V3JhcHBlZC5nZXQoa2V5KTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgc2V0IFtrZXldKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgZ3Vlc3RXcmFwcGVkLnNldChrZXksIG5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBlbmRvd21lbnRLaW5kT2YgPSAoZTIpID0+IHtcbiAgICBoYXJkZW4oZTIpO1xuICAgIGlmIChpc1Byb21pc2UoZTIpKSB7XG4gICAgICByZXR1cm4gXCJwcm9taXNlXCI7XG4gICAgfSBlbHNlIGlmIChvdXRlclpvbmUuaXNTdG9yYWJsZShlMikpIHtcbiAgICAgIHJldHVybiBcInN0b3JhYmxlXCI7XG4gICAgfSBlbHNlIGlmIChpc1Bhc3NhYmxlKGUyKSAmJiBpc1JlbW90YWJsZShlMikpIHtcbiAgICAgIHJldHVybiBcImZhclwiO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGUyID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIHJldHVybiBcImZ1bmN0aW9uXCI7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZTIgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGlmIChlMiA9PT0gbnVsbCkge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBudWxsIGlzIGFsd2F5cyBzdG9yYWJsZWA7XG4gICAgICB9XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShlMikpIHtcbiAgICAgICAgcmV0dXJuIFwiYXJyYXlcIjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGtleXM0ID0gb3duS2V5czIxKGUyKTtcbiAgICAgIGtleXM0Lmxlbmd0aCA+PSAxIHx8IHRocm93UmVkYWN0ZWRgZW1wdHkgcmVjb3JkIHNob3VsZCBiZSBzdG9yYWJsZSAke2UyfWA7XG4gICAgICBjb25zdCBkZXNjID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMyhlMiwga2V5czRbMF0pXG4gICAgICApO1xuICAgICAgaWYgKFwidmFsdWVcIiBpbiBkZXNjKSB7XG4gICAgICAgIHJldHVybiBcInJlY29yZFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgXCJnZXRcIiBpbiBkZXNjIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IHVuZXhwZWN0ZWQgZGVzY3JpcHRvciAke2Rlc2N9YDtcbiAgICAgICAgcmV0dXJuIFwic3RhdGVcIjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGVuZG93bWVudCAke2UyfWA7XG4gICAgfVxuICB9O1xuICBoYXJkZW4oZW5kb3dtZW50S2luZE9mKTtcbiAgY29uc3QgdW53cmFwTWFwID0gb3V0ZXJab25lLndlYWtNYXBTdG9yZShcInVud3JhcE1hcFwiLCB7XG4gICAga2V5U2hhcGU6IE0ucmVtb3RhYmxlKFwid3JhcHBlZFwiKSxcbiAgICB2YWx1ZVNoYXBlOiBNLnJlbW90YWJsZShcInVud3JhcHBlclwiKVxuICB9KTtcbiAgY29uc3QgdW53cmFwTWFwSGFzID0gKGspID0+IHtcbiAgICBpZiAoaXNWb3coaykgfHwgaXNSZW1vdGFibGUoaykpIHtcbiAgICAgIHJldHVybiB1bndyYXBNYXAuaGFzKHRvUGFzc2FibGVDYXAoaykpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xuICBjb25zdCB1bndyYXBNYXBHZXQgPSAoaykgPT4gdW53cmFwTWFwLmdldCh0b1Bhc3NhYmxlQ2FwKGspKTtcbiAgY29uc3QgdW53cmFwTWFwU2V0ID0gKGssIHYyKSA9PiB7XG4gICAgY29uc3QgazIgPSB0b1Bhc3NhYmxlQ2FwKGspO1xuICAgIGlmICh1bndyYXBNYXBIYXMoaykpIHtcbiAgICAgIHVud3JhcE1hcC5zZXQoazIsIHYyKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdW53cmFwTWFwLmluaXQoazIsIHYyKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHByZXBhcmVFbmRvd21lbnQgPSAoem9uZSwgdGFnLCBlMikgPT4ge1xuICAgIGNvbnN0IGVLaW5kID0gZW5kb3dtZW50S2luZE9mKGUyKTtcbiAgICBzd2l0Y2ggKGVLaW5kKSB7XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIGNvbnN0IHAzID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBlMlxuICAgICAgICApO1xuICAgICAgICBjb25zdCB7IHZvdywgcmVzb2x2ZXIgfSA9IG1ha2VWb3dLaXQoKTtcbiAgICAgICAgdm9pZCBFLndoZW4oXG4gICAgICAgICAgcDMsXG4gICAgICAgICAgKHYyKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlci5yZXNvbHZlKHYyKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIChyZWFzb24pID0+IHtcbiAgICAgICAgICAgIGlmICghaXNVcGdyYWRlRGlzY29ubmVjdGlvbihyZWFzb24pKSB7XG4gICAgICAgICAgICAgIHJlc29sdmVyLnJlamVjdChyZWFzb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHZvdztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJzdG9yYWJsZVwiOiB7XG4gICAgICAgIHJldHVybiBlMjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJmYXJcIjoge1xuICAgICAgICBjb25zdCByNSA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBlMlxuICAgICAgICApO1xuICAgICAgICBjb25zdCBtZXRob2RzID0gZm9yd2FyZGluZ01ldGhvZHMocjUpO1xuICAgICAgICByZXR1cm4gem9uZS5leG8oXG4gICAgICAgICAgdGFnLFxuICAgICAgICAgIE0uaW50ZXJmYWNlKFwiRmFyV3JhcHBlZFwiLCB7fSwgeyBkZWZhdWx0R3VhcmRzOiBcInJhd1wiIH0pLFxuICAgICAgICAgIG1ldGhvZHNcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJmdW5jdGlvblwiOiB7XG4gICAgICAgIGNvbnN0IGYyID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgZTJcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3Qgd3JhcHBlZCA9IHpvbmUuZXhvKHRhZywgRnVuY3Rpb25XcmFwcGVySSwge1xuICAgICAgICAgIGFwcGx5KGFyZ3MpIHtcbiAgICAgICAgICAgIHJldHVybiBmMiguLi5hcmdzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB1bndyYXBNYXBTZXQod3JhcHBlZCwgZnVuY3Rpb25VbndyYXBwZXIpO1xuICAgICAgICByZXR1cm4gd3JhcHBlZDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJhcnJheVwiOiB7XG4gICAgICAgIGNvbnN0IGEyID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGUyXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHN1YlpvbmUgPSB6b25lLnN1YlpvbmUodGFnKTtcbiAgICAgICAgcmV0dXJuIGEyLm1hcCgoc3ViRSwgaTIpID0+IHByZXBhcmVFbmRvd21lbnQoc3ViWm9uZSwgYCR7aTJ9YCwgc3ViRSkpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInJlY29yZFwiOiB7XG4gICAgICAgIGNvbnN0IHI1ID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBlMlxuICAgICAgICApO1xuICAgICAgICBjb25zdCBzdWJab25lID0gem9uZS5zdWJab25lKHRhZyk7XG4gICAgICAgIHJldHVybiBvYmplY3RNYXAoXG4gICAgICAgICAgcjUsXG4gICAgICAgICAgKHN1YkUsIGspID0+IHByZXBhcmVFbmRvd21lbnQoc3ViWm9uZSwgU3RyaW5nKGspLCBzdWJFKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0YXRlXCI6IHtcbiAgICAgICAgY29uc3Qgc3RhdGUgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGUyXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGtleXM0ID0gaGFyZGVuKG93bktleXMyMShzdGF0ZSkpO1xuICAgICAgICBjb25zdCB3cmFwcGVkID0gem9uZS5leG8odGFnLCBTdGF0ZUFjY2Vzc29ySSwge1xuICAgICAgICAgIGdldChrZXkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZVtrZXldO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2V0KGtleSwgbmV3VmFsdWUpIHtcbiAgICAgICAgICAgIHN0YXRlW2tleV0gPSBuZXdWYWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBzdGF0ZVVud3JhcHBlciA9IG1ha2VTdGF0ZVVud3JhcHBlcihrZXlzNCk7XG4gICAgICAgIHVud3JhcE1hcFNldCh3cmFwcGVkLCBzdGF0ZVVud3JhcHBlcik7XG4gICAgICAgIHJldHVybiB3cmFwcGVkO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZW5kb3dtZW50ICR7ZTJ9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IHVud3JhcCA9ICh3cmFwcGVkLCBndWVzdFdyYXBwZWQpID0+IHtcbiAgICBpZiAodW53cmFwTWFwSGFzKHdyYXBwZWQpKSB7XG4gICAgICBjb25zdCB1bndyYXBwZXIgPSB1bndyYXBNYXBHZXQod3JhcHBlZCk7XG4gICAgICByZXR1cm4gdW53cmFwcGVyLnVud3JhcChndWVzdFdyYXBwZWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZ3Vlc3RXcmFwcGVkO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IHByZXBhcmVFbmRvd21lbnQsIHVud3JhcCB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZUVuZG93bWVudFRvb2xzKTtcblxuLy9cbnZhciB7IGRlZmluZVByb3BlcnRpZXM6IGRlZmluZVByb3BlcnRpZXM2IH0gPSBPYmplY3Q7XG52YXIgQXN5bmNGbG93SUtpdCA9IGhhcmRlbih7XG4gIGZsb3c6IE0uaW50ZXJmYWNlKFwiRmxvd1wiLCB7XG4gICAgZ2V0Rmxvd1N0YXRlOiBNLmNhbGwoKS5yZXR1cm5zKEZsb3dTdGF0ZVNoYXBlKSxcbiAgICByZXN0YXJ0OiBNLmNhbGwoKS5vcHRpb25hbChNLmJvb2xlYW4oKSkucmV0dXJucygpLFxuICAgIHdha2U6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgICBnZXRPdXRjb21lOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgICBkdW1wOiBNLmNhbGwoKS5yZXR1cm5zKE0uYXJyYXlPZihMb2dFbnRyeVNoYXBlKSksXG4gICAgZ2V0T3B0RmF0YWxQcm9ibGVtOiBNLmNhbGwoKS5yZXR1cm5zKE0ub3B0KE0uZXJyb3IoKSkpXG4gIH0pLFxuICBhZG1pbjogTS5pbnRlcmZhY2UoXCJGbG93QWRtaW5cIiwge1xuICAgIHJlc2V0OiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gICAgY29tcGxldGU6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgICBwYW5pYzogTS5jYWxsKE0uZXJyb3IoKSkucmV0dXJucyhNLm5vdChNLmFueSgpKSlcbiAgICAvL1xuICB9KSxcbiAgd2FrZVdhdGNoZXI6IFByb21pc2VXYXRjaGVySVxufSk7XG52YXIgQWRtaW5Bc3luY0Zsb3dJID0gTS5pbnRlcmZhY2UoXCJBc3luY0Zsb3dBZG1pblwiLCB7XG4gIGdldEZhaWx1cmVzOiBNLmNhbGwoKS5yZXR1cm5zKE0ubWFwT2YoTS5yZW1vdGFibGUoXCJhc3luY0Zsb3dcIiksIE0uZXJyb3IoKSkpLFxuICB3YWtlQWxsOiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gIGdldEZsb3dGb3JPdXRjb21lVm93OiBNLmNhbGwoVm93U2hhcGUpLnJldHVybnMoTS5vcHQoTS5yZW1vdGFibGUoXCJmbG93XCIpKSlcbn0pO1xudmFyIHByZXBhcmVBc3luY0Zsb3dUb29scyA9IChvdXRlclpvbmUsIG91dGVyT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICB2b3dUb29scyA9IHByZXBhcmVTd2luZ3NldFZvd1Rvb2xzKG91dGVyWm9uZSksXG4gICAgbWFrZUxvZ1N0b3JlID0gcHJlcGFyZUxvZ1N0b3JlKG91dGVyWm9uZSksXG4gICAgZW5kb3dtZW50VG9vbHM6IHsgcHJlcGFyZUVuZG93bWVudCwgdW53cmFwIH0gPSBwcmVwYXJlRW5kb3dtZW50VG9vbHMoXG4gICAgICBvdXRlclpvbmUsXG4gICAgICB7IHZvd1Rvb2xzIH1cbiAgICApLFxuICAgIG1ha2VCaWplY3Rpb24gPSBwcmVwYXJlQmlqZWN0aW9uKG91dGVyWm9uZSwgdW53cmFwKSxcbiAgICBwYW5pY0hhbmRsZXIgPSAoZXJyKSA9PiB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9ID0gb3V0ZXJPcHRpb25zO1xuICBjb25zdCB7IHdhdGNoLCBtYWtlVm93S2l0IH0gPSB2b3dUb29scztcbiAgY29uc3QgZmFpbHVyZXMgPSBvdXRlclpvbmUubWFwU3RvcmUoXCJhc3luY0Z1bmNGYWlsdXJlc1wiLCB7XG4gICAga2V5U2hhcGU6IE0ucmVtb3RhYmxlKFwiZmxvd1wiKSxcbiAgICAvL1xuICAgIHZhbHVlU2hhcGU6IE0uZXJyb3IoKVxuICB9KTtcbiAgY29uc3QgZWFnZXJXYWtlcnMgPSBvdXRlclpvbmUuc2V0U3RvcmUoYGFzeW5jRnVuY0VhZ2VyV2FrZXJzYCwge1xuICAgIGtleVNoYXBlOiBNLnJlbW90YWJsZShcImZsb3dcIilcbiAgICAvL1xuICB9KTtcbiAgY29uc3QgbWVtYnJhbmVNYXAgPSBtYWtlU2NhbGFyV2Vha01hcFN0b3JlKFwibWVtYnJhbmVGb3JcIiwge1xuICAgIGtleVNoYXBlOiBNLnJlbW90YWJsZShcImZsb3dcIiksXG4gICAgdmFsdWVTaGFwZTogTS5yZW1vdGFibGUoXCJtZW1icmFuZVwiKVxuICB9KTtcbiAgY29uc3QgaGFzTWVtYnJhbmUgPSAoZmxvdykgPT4gbWVtYnJhbmVNYXAuaGFzKGZsb3cpO1xuICBjb25zdCBnZXRNZW1icmFuZSA9IChmbG93KSA9PiBtZW1icmFuZU1hcC5nZXQoZmxvdyk7XG4gIGNvbnN0IGluaXRNZW1icmFuZSA9IChmbG93LCBtZW1icmFuZSkgPT4gbWVtYnJhbmVNYXAuaW5pdChmbG93LCBtZW1icmFuZSk7XG4gIGNvbnN0IGRlbGV0ZU1lbWJyYW5lID0gKGZsb3cpID0+IG1lbWJyYW5lTWFwLmRlbGV0ZShmbG93KTtcbiAgY29uc3QgZmxvd0Zvck91dGNvbWVWb3dLZXkgPSBvdXRlclpvbmUubWFwU3RvcmUoXCJmbG93Rm9yT3V0Y29tZVZvd1wiLCB7XG4gICAga2V5U2hhcGU6IE0ucmVtb3RhYmxlKFwidG9QYXNzYWJsZUNhcFwiKSxcbiAgICB2YWx1ZVNoYXBlOiBNLnJlbW90YWJsZShcImZsb3dcIilcbiAgICAvL1xuICB9KTtcbiAgY29uc3QgcHJlcGFyZUFzeW5jRmxvd0tpdCA9ICh6b25lLCB0YWcsIGd1ZXN0QXN5bmNGdW5jLCBvcHRpb25zID0ge30pID0+IHtcbiAgICB0eXBlb2YgZ3Vlc3RBc3luY0Z1bmMgPT09IFwiZnVuY3Rpb25cIiB8fCB0aHJvd1JlZGFjdGVkYGd1ZXN0QXN5bmNGdW5jIG11c3QgYmUgYSBjYWxsYWJsZSBmdW5jdGlvbiAke2d1ZXN0QXN5bmNGdW5jfWA7XG4gICAgY29uc3Qge1xuICAgICAgLy9cbiAgICAgIHN0YXJ0RWFnZXIgPSB0cnVlXG4gICAgfSA9IG9wdGlvbnM7XG4gICAgY29uc3QgaW50ZXJuYWxNYWtlQXN5bmNGbG93S2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICAgIHRhZyxcbiAgICAgIEFzeW5jRmxvd0lLaXQsXG4gICAgICAoYWN0aXZhdGlvbkFyZ3MpID0+IHtcbiAgICAgICAgaGFyZGVuKGFjdGl2YXRpb25BcmdzKTtcbiAgICAgICAgY29uc3QgbG9nID0gbWFrZUxvZ1N0b3JlKCk7XG4gICAgICAgIGNvbnN0IGJpamVjdGlvbiA9IG1ha2VCaWplY3Rpb24oKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhY3RpdmF0aW9uQXJncyxcbiAgICAgICAgICAvL1xuICAgICAgICAgIGxvZyxcbiAgICAgICAgICAvL1xuICAgICAgICAgIGJpamVjdGlvbixcbiAgICAgICAgICAvL1xuICAgICAgICAgIG91dGNvbWVLaXQ6IG1ha2VWb3dLaXQoKSxcbiAgICAgICAgICAvL1xuICAgICAgICAgIGlzRG9uZTogZmFsc2VcbiAgICAgICAgICAvL1xuICAgICAgICB9O1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgZmxvdzoge1xuICAgICAgICAgIC8qXG5cbiAgICAgICAgICAgKi9cbiAgICAgICAgICBnZXRGbG93U3RhdGUoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGxvZywgb3V0Y29tZUtpdCwgaXNEb25lIH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgaWYgKGlzRG9uZSkge1xuICAgICAgICAgICAgICAhaGFzTWVtYnJhbmUoZmxvdykgfHwgdGhyb3dSZWRhY3RlZGBEb25lIGZsb3cgbXVzdCBkcm9wIG1lbWJyYW5lICR7Zmxvd30gJHtnZXRNZW1icmFuZShmbG93KX1gO1xuICAgICAgICAgICAgICAhZmFpbHVyZXMuaGFzKGZsb3cpIHx8IHRocm93UmVkYWN0ZWRgRG9uZSBmbG93IG11c3Qgbm90IGJlIGluIGZhaWx1cmVzICR7Zmxvd30gJHtmYWlsdXJlcy5nZXQoZmxvdyl9YDtcbiAgICAgICAgICAgICAgIWVhZ2VyV2FrZXJzLmhhcyhmbG93KSB8fCB0aHJvd1JlZGFjdGVkYERvbmUgZmxvdyBtdXN0IG5vdCBiZSBpbiBlYWdlcldha2VycyAke2Zsb3d9YDtcbiAgICAgICAgICAgICAgIWZsb3dGb3JPdXRjb21lVm93S2V5LmhhcyhvdXRjb21lS2l0LnZvdykgfHwgdGhyb3dSZWRhY3RlZGBEb25lIGZsb3cgbXVzdCBkcm9wIGZsb3cgbG9va3VwIGZyb20gdm93ICR7b3V0Y29tZUtpdC52b3d9YDtcbiAgICAgICAgICAgICAgbG9nLmdldEluZGV4KCkgPT09IDAgJiYgbG9nLmdldExlbmd0aCgpID09PSAwIHx8IHRocm93UmVkYWN0ZWRgRG9uZSBmbG93IG11c3QgZW1wdHkgbG9nICR7Zmxvd30gJHtsb2d9YDtcbiAgICAgICAgICAgICAgcmV0dXJuIFwiRG9uZVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZhaWx1cmVzLmhhcyhmbG93KSkge1xuICAgICAgICAgICAgICByZXR1cm4gXCJGYWlsZWRcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghaGFzTWVtYnJhbmUoZmxvdykpIHtcbiAgICAgICAgICAgICAgbG9nLmdldEluZGV4KCkgPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBTbGVlcGluZyBmbG93IG11c3QgcGxheSBmcm9tIGxvZyBzdGFydCAke2Zsb3d9ICR7bG9nLmdldEluZGV4KCl9YDtcbiAgICAgICAgICAgICAgcmV0dXJuIFwiU2xlZXBpbmdcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChsb2cuaXNSZXBsYXlpbmcoKSkge1xuICAgICAgICAgICAgICByZXR1cm4gXCJSZXBsYXlpbmdcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBcIlJ1bm5pbmdcIjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8qXG5cblxuXG5cbiAgICAgICAgICAgKi9cbiAgICAgICAgICByZXN0YXJ0KGVhZ2VyID0gc3RhcnRFYWdlcikge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBhY3RpdmF0aW9uQXJncywgbG9nLCBiaWplY3Rpb24sIG91dGNvbWVLaXQgfSA9IHN0YXRlO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93LCBhZG1pbiwgd2FrZVdhdGNoZXIgfSA9IGZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0Rmxvd1N0YXRlID0gZmxvdy5nZXRGbG93U3RhdGUoKTtcbiAgICAgICAgICAgIHN0YXJ0Rmxvd1N0YXRlICE9PSBcIkRvbmVcIiB8fCAvL1xuICAgICAgICAgICAgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcmVzdGFydCBhIGRvbmUgZmxvdyAke2Zsb3d9YDtcbiAgICAgICAgICAgIGFkbWluLnJlc2V0KCk7XG4gICAgICAgICAgICBpZiAoZWFnZXIpIHtcbiAgICAgICAgICAgICAgZWFnZXJXYWtlcnMuYWRkKGZsb3cpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlYWdlcldha2Vycy5oYXMoZmxvdykpIHtcbiAgICAgICAgICAgICAgZWFnZXJXYWtlcnMuZGVsZXRlKGZsb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgd2F0Y2hXYWtlID0gKHZvd2lzaCkgPT4ge1xuICAgICAgICAgICAgICB6b25lLmlzU3RvcmFibGUodm93aXNoKSB8fCB0aHJvd1JlZGFjdGVkYHZvd2lzaCBtdXN0IGJlIHN0b3JhYmxlIGluIHRoaXMgem9uZSAodXN1YWxseSwgbXVzdCBiZSBkdXJhYmxlKTogJHt2b3dpc2h9YDtcbiAgICAgICAgICAgICAgem9uZS5pc1N0b3JhYmxlKHdha2VXYXRjaGVyKSB8fCB0aHJvd1JlZGFjdGVkYHdha2VXYXRjaGVyIG11c3QgYmUgc3RvcmFibGUgaW4gdGhpcyB6b25lICh1c3VhbGx5LCBtdXN0IGJlIGR1cmFibGUpOiAke3dha2VXYXRjaGVyfWA7XG4gICAgICAgICAgICAgIHdhdGNoKHZvd2lzaCwgd2FrZVdhdGNoZXIpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IHBhbmljID0gKGVycikgPT4gYWRtaW4ucGFuaWMoZXJyKTtcbiAgICAgICAgICAgIGNvbnN0IG1lbWJyYW5lID0gbWFrZVJlcGxheU1lbWJyYW5lKHtcbiAgICAgICAgICAgICAgbG9nLFxuICAgICAgICAgICAgICBiaWplY3Rpb24sXG4gICAgICAgICAgICAgIHZvd1Rvb2xzLFxuICAgICAgICAgICAgICB3YXRjaFdha2UsXG4gICAgICAgICAgICAgIHBhbmljXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGluaXRNZW1icmFuZShmbG93LCBtZW1icmFuZSk7XG4gICAgICAgICAgICBjb25zdCBndWVzdEFyZ3MgPSBtZW1icmFuZS5ob3N0VG9HdWVzdChhY3RpdmF0aW9uQXJncyk7XG4gICAgICAgICAgICBjb25zdCBmbG93U3RhdGUgPSBmbG93LmdldEZsb3dTdGF0ZSgpO1xuICAgICAgICAgICAgZmxvd1N0YXRlID09PSBcIlJ1bm5pbmdcIiB8fCBmbG93U3RhdGUgPT09IFwiUmVwbGF5aW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBSZXN0YXJ0ZWQgZmxvdyBtdXN0IGJlIFJ1bm5pbmcgb3IgUmVwbGF5aW5nICR7Zmxvd31gO1xuICAgICAgICAgICAgbWVtYnJhbmUud2FrZSgpO1xuICAgICAgICAgICAgY29uc3QgZ3Vlc3RSZXN1bHRQID0gKGFzeW5jICgpID0+IChcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgZ3Vlc3RBc3luY0Z1bmMoLi4uZ3Vlc3RBcmdzKVxuICAgICAgICAgICAgKSkoKTtcbiAgICAgICAgICAgIGlmIChmbG93LmdldEZsb3dTdGF0ZSgpICE9PSBcIkZhaWxlZFwiKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGczID0gYmlqZWN0aW9uLnVud3JhcEluaXQoZ3Vlc3RSZXN1bHRQLCBvdXRjb21lS2l0LnZvdyk7XG4gICAgICAgICAgICAgIGczID09PSBndWVzdFJlc3VsdFAgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogcHJvbWlzZXMgc2hvdWxkIG5vdCBiZSB1bndyYXBwZWQgJHtnM31gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdm9pZCBFLndoZW4oXG4gICAgICAgICAgICAgIGd1ZXN0UmVzdWx0UCxcbiAgICAgICAgICAgICAgKGdGdWxmaWxsbWVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChiaWplY3Rpb24uaGFzR3Vlc3QoZ3Vlc3RSZXN1bHRQKSkge1xuICAgICAgICAgICAgICAgICAgIWxvZy5pc1JlcGxheWluZygpIHx8IHBhbmljKFxuICAgICAgICAgICAgICAgICAgICBtYWtlRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgcmVkYWN0ZWRgZ3Vlc3QgZnVsZmlsbGVkIHdpdGggJHtnRnVsZmlsbG1lbnR9IGJlZm9yZSBmaW5pc2hpbmcgcmVwbGF5YFxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgb3V0Y29tZUtpdC5yZXNvbHZlci5yZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICBtZW1icmFuZS5ndWVzdFRvSG9zdChnRnVsZmlsbG1lbnQpXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgYWRtaW4uY29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIChndWVzdFJlYXNvbikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChiaWplY3Rpb24uaGFzR3Vlc3QoZ3Vlc3RSZXN1bHRQKSkge1xuICAgICAgICAgICAgICAgICAgIWxvZy5pc1JlcGxheWluZygpIHx8IHBhbmljKFxuICAgICAgICAgICAgICAgICAgICBtYWtlRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgcmVkYWN0ZWRgZ3Vlc3QgcmVqZWN0ZWQgd2l0aCAke2d1ZXN0UmVhc29ufSBiZWZvcmUgZmluaXNoaW5nIHJlcGxheWBcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIG91dGNvbWVLaXQucmVzb2x2ZXIucmVqZWN0KG1lbWJyYW5lLmd1ZXN0VG9Ib3N0KGd1ZXN0UmVhc29uKSk7XG4gICAgICAgICAgICAgICAgICBhZG1pbi5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKS50aGVuKFxuICAgICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZsb3cuZ2V0Rmxvd1N0YXRlKCkgPT09IFwiRmFpbGVkXCIpIHtcbiAgICAgICAgICAgICAgICAgIHRocm93IGZsb3cuZ2V0T3B0RmF0YWxQcm9ibGVtKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAobWF5YmVQYW5pY1JlYXNvbikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmbG93LmdldEZsb3dTdGF0ZSgpID09PSBcIkZhaWxlZFwiKSB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBlcnIyID0gZmxvdy5nZXRPcHRGYXRhbFByb2JsZW0oKTtcbiAgICAgICAgICAgICAgICAgIHRocm93IGVycjI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IGVyciA9IG1ha2VFcnJvcihcbiAgICAgICAgICAgICAgICAgIHJlZGFjdGVkYGludGVybmFsOiB1bmV4cGVjdGVkIGVycm9yIGluIGd1ZXN0IGNvbXBsZXRpb24gaGFuZGxpbmcgJHttYXliZVBhbmljUmVhc29ufWBcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBwYW5pYyhlcnIpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKF9lKSB7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLmNhdGNoKHBhbmljSGFuZGxlcik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB3YWtlKCkge1xuICAgICAgICAgICAgY29uc3QgeyBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3cgfSA9IGZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IGZsb3dTdGF0ZSA9IGZsb3cuZ2V0Rmxvd1N0YXRlKCk7XG4gICAgICAgICAgICBzd2l0Y2ggKGZsb3dTdGF0ZSkge1xuICAgICAgICAgICAgICBjYXNlIFwiRG9uZVwiOlxuICAgICAgICAgICAgICBjYXNlIFwiRmFpbGVkXCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY2FzZSBcIlJ1bm5pbmdcIjpcbiAgICAgICAgICAgICAgY2FzZSBcIlJlcGxheWluZ1wiOiB7XG4gICAgICAgICAgICAgICAgZ2V0TWVtYnJhbmUoZmxvdykud2FrZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjYXNlIFwiU2xlZXBpbmdcIjoge1xuICAgICAgICAgICAgICAgIGZsb3cucmVzdGFydCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGZsb3dTdGF0ZSAke3F1b3RlKGZsb3dTdGF0ZSl9YDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0T3V0Y29tZSgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IG91dGNvbWVLaXQgfSA9IHN0YXRlO1xuICAgICAgICAgICAgcmV0dXJuIG91dGNvbWVLaXQudm93O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZHVtcCgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGxvZyB9ID0gc3RhdGU7XG4gICAgICAgICAgICByZXR1cm4gbG9nLmR1bXAoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldE9wdEZhdGFsUHJvYmxlbSgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93IH0gPSBmYWNldHM7XG4gICAgICAgICAgICByZXR1cm4gZmFpbHVyZXMuaGFzKGZsb3cpID8gZmFpbHVyZXMuZ2V0KGZsb3cpIDogdm9pZCAwO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgYWRtaW46IHtcbiAgICAgICAgICByZXNldCgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgYmlqZWN0aW9uLCBsb2cgfSA9IHN0YXRlO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93IH0gPSBmYWNldHM7XG4gICAgICAgICAgICAhc3RhdGUuaXNEb25lIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlc2V0IGEgZG9uZSBmbG93YDtcbiAgICAgICAgICAgIGlmIChmYWlsdXJlcy5oYXMoZmxvdykpIHtcbiAgICAgICAgICAgICAgZmFpbHVyZXMuZGVsZXRlKGZsb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGhhc01lbWJyYW5lKGZsb3cpKSB7XG4gICAgICAgICAgICAgIGdldE1lbWJyYW5lKGZsb3cpLnN0b3AoKTtcbiAgICAgICAgICAgICAgZGVsZXRlTWVtYnJhbmUoZmxvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2cucmVzZXQoKTtcbiAgICAgICAgICAgIGJpamVjdGlvbi5yZXNldCgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY29tcGxldGUoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGxvZyB9ID0gc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3csIGFkbWluIH0gPSBmYWNldHM7XG4gICAgICAgICAgICBhZG1pbi5yZXNldCgpO1xuICAgICAgICAgICAgaWYgKGVhZ2VyV2FrZXJzLmhhcyhmbG93KSkge1xuICAgICAgICAgICAgICBlYWdlcldha2Vycy5kZWxldGUoZmxvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmbG93Rm9yT3V0Y29tZVZvd0tleS5kZWxldGUodG9QYXNzYWJsZUNhcChmbG93LmdldE91dGNvbWUoKSkpO1xuICAgICAgICAgICAgc3RhdGUuaXNEb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIGxvZy5kaXNwb3NlKCk7XG4gICAgICAgICAgICBmbG93LmdldEZsb3dTdGF0ZSgpID09PSBcIkRvbmVcIiB8fCB0aHJvd1JlZGFjdGVkYENvbXBsZXRlIGZsb3cgbXVzdCBiZSBEb25lICR7Zmxvd31gO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcGFuaWMoZmF0YWxQcm9ibGVtKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGJpamVjdGlvbiwgbG9nIH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgaWYgKGZhaWx1cmVzLmhhcyhmbG93KSkge1xuICAgICAgICAgICAgICBjb25zdCBwcmV2RXJyID0gZmFpbHVyZXMuZ2V0KGZsb3cpO1xuICAgICAgICAgICAgICBub3RlKFxuICAgICAgICAgICAgICAgIHByZXZFcnIsXG4gICAgICAgICAgICAgICAgcmVkYWN0ZWRgZG91Ymx5IGZhaWxlZCBzb21laG93IHdpdGggJHtmYXRhbFByb2JsZW19YFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBmYXRhbFByb2JsZW0gPSBwcmV2RXJyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZmFpbHVyZXMuaW5pdChmbG93LCBmYXRhbFByb2JsZW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGhhc01lbWJyYW5lKGZsb3cpKSB7XG4gICAgICAgICAgICAgIGdldE1lbWJyYW5lKGZsb3cpLnN0b3AoKTtcbiAgICAgICAgICAgICAgZGVsZXRlTWVtYnJhbmUoZmxvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsb2cucmVzZXQoKTtcbiAgICAgICAgICAgIGJpamVjdGlvbi5yZXNldCgpO1xuICAgICAgICAgICAgZmxvdy5nZXRGbG93U3RhdGUoKSA9PT0gXCJGYWlsZWRcIiB8fCB0aHJvd1JlZGFjdGVkYFBhbmlja2VkIGZsb3cgbXVzdCBiZSBGYWlsZWQgJHtmbG93fWA7XG4gICAgICAgICAgICBjb25zdCBlcnIgPSBtYWtlRXJyb3IoXG4gICAgICAgICAgICAgIHJlZGFjdGVkYEluIGEgRmFpbGVkIHN0YXRlOiBzZWUgZ2V0RmFpbHVyZXMoKSBvciBnZXRPcHRGYXRhbFByb2JsZW0oKSBmb3IgbW9yZSBpbmZvcm1hdGlvbmBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBub3RlKGVyciwgcmVkYWN0ZWRgZHVlIHRvICR7ZmF0YWxQcm9ibGVtfWApO1xuICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgd2FrZVdhdGNoZXI6IHtcbiAgICAgICAgICBvbkZ1bGZpbGxlZChfZnVsZmlsbG1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgZmFjZXRzLmZsb3cud2FrZSgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25SZWplY3RlZChfZnVsZmlsbG1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgZmFjZXRzLmZsb3cud2FrZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gICAgY29uc3QgbWFrZUFzeW5jRmxvd0tpdCA9IChhY3RpdmF0aW9uQXJncykgPT4ge1xuICAgICAgY29uc3QgYXN5bmNGbG93S2l0ID0gaW50ZXJuYWxNYWtlQXN5bmNGbG93S2l0KGFjdGl2YXRpb25BcmdzKTtcbiAgICAgIGNvbnN0IHsgZmxvdyB9ID0gYXN5bmNGbG93S2l0O1xuICAgICAgY29uc3Qgdm93ID0gZmxvdy5nZXRPdXRjb21lKCk7XG4gICAgICBmbG93Rm9yT3V0Y29tZVZvd0tleS5pbml0KHRvUGFzc2FibGVDYXAodm93KSwgZmxvdyk7XG4gICAgICBmbG93LnJlc3RhcnQoKTtcbiAgICAgIHJldHVybiBhc3luY0Zsb3dLaXQ7XG4gICAgfTtcbiAgICByZXR1cm4gaGFyZGVuKG1ha2VBc3luY0Zsb3dLaXQpO1xuICB9O1xuICBjb25zdCBhc3luY0Zsb3cgPSAoem9uZSwgdGFnLCBndWVzdEZ1bmMsIG9wdGlvbnMgPSB2b2lkIDApID0+IHtcbiAgICBjb25zdCBtYWtlQXN5bmNGbG93S2l0ID0gcHJlcGFyZUFzeW5jRmxvd0tpdCh6b25lLCB0YWcsIGd1ZXN0RnVuYywgb3B0aW9ucyk7XG4gICAgY29uc3QgaG9zdEZ1bmNOYW1lID0gYCR7dGFnfV9ob3N0Rmxvd2A7XG4gICAgY29uc3Qgd3JhcHBlckZ1bmMgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHtcbiAgICAgICAgW2hvc3RGdW5jTmFtZV0oLi4uYXJncykge1xuICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gbWFrZUFzeW5jRmxvd0tpdChhcmdzKTtcbiAgICAgICAgICByZXR1cm4gZmxvdy5nZXRPdXRjb21lKCk7XG4gICAgICAgIH1cbiAgICAgIH1baG9zdEZ1bmNOYW1lXVxuICAgICk7XG4gICAgZGVmaW5lUHJvcGVydGllczYod3JhcHBlckZ1bmMsIHtcbiAgICAgIGxlbmd0aDogeyB2YWx1ZTogZ3Vlc3RGdW5jLmxlbmd0aCB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGhhcmRlbih3cmFwcGVyRnVuYyk7XG4gIH07XG4gIGNvbnN0IGFkbWluQXN5bmNGbG93ID0gb3V0ZXJab25lLmV4byhcIkFkbWluQXN5bmNGbG93XCIsIEFkbWluQXN5bmNGbG93SSwge1xuICAgIGdldEZhaWx1cmVzKCkge1xuICAgICAgcmV0dXJuIGZhaWx1cmVzLnNuYXBzaG90KCk7XG4gICAgfSxcbiAgICB3YWtlQWxsKCkge1xuICAgICAgY29uc3QgZmFpbHVyZXNUb1Jlc3RhcnQgPSBbLi4uZmFpbHVyZXMua2V5cygpXTtcbiAgICAgIGNvbnN0IGZsb3dzVG9XYWtlID0gWy4uLmVhZ2VyV2FrZXJzLmtleXMoKV07XG4gICAgICBmb3IgKGNvbnN0IGZsb3cgb2YgZmFpbHVyZXNUb1Jlc3RhcnQpIHtcbiAgICAgICAgZmxvdy5yZXN0YXJ0KCk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGZsb3cgb2YgZmxvd3NUb1dha2UpIHtcbiAgICAgICAgZmxvdy53YWtlKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBnZXRGbG93Rm9yT3V0Y29tZVZvdyhvdXRjb21lVm93KSB7XG4gICAgICByZXR1cm4gZmxvd0Zvck91dGNvbWVWb3dLZXkuZ2V0KHRvUGFzc2FibGVDYXAob3V0Y29tZVZvdykpO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IGFsbFdva2VuUCA9IEUud2hlbihudWxsLCAoKSA9PiBhZG1pbkFzeW5jRmxvdy53YWtlQWxsKCkpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBwcmVwYXJlQXN5bmNGbG93S2l0LFxuICAgIGFzeW5jRmxvdyxcbiAgICBhZG1pbkFzeW5jRmxvdyxcbiAgICBhbGxXb2tlblAsXG4gICAgcHJlcGFyZUVuZG93bWVudFxuICB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZUFzeW5jRmxvd1Rvb2xzKTtcblxuLy9cbnZhciBldmVudExvb3BJdGVyYXRpb24gPSBhc3luYyAoKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZTIpID0+IHNldEltbWVkaWF0ZShyZXNvbHZlMikpO1xuaGFyZGVuKGV2ZW50TG9vcEl0ZXJhdGlvbik7XG52YXIgc3RyaW5nT3JUYWcgPSAodmFsdWUpID0+IHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgU3ltYm9sLnRvU3RyaW5nVGFnIGluIHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlW1N5bWJvbC50b1N0cmluZ1RhZ107XG4gIH1cbiAgcmV0dXJuIFN0cmluZyh2YWx1ZSk7XG59O1xudmFyIGluc3BlY3RNYXBTdG9yZSA9IChzdG9yZSkgPT4ge1xuICBjb25zdCBvYmogPSB7fTtcbiAgZm9yIChjb25zdCBrZXkgb2Ygc3RvcmUua2V5cygpKSB7XG4gICAgY29uc3QgdmFsdWUgPSBzdG9yZS5nZXQoa2V5KTtcbiAgICBjb25zdCBoYXNLZXlzID0gdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIFwia2V5c1wiIGluIHZhbHVlO1xuICAgIGNvbnN0IGluZGV4ID0gc3RyaW5nT3JUYWcoa2V5KTtcbiAgICBpZiAoaGFzS2V5cyAmJiBcImdldFwiIGluIHZhbHVlKSB7XG4gICAgICBvYmpbaW5kZXhdID0gaW5zcGVjdE1hcFN0b3JlKHZhbHVlKTtcbiAgICB9IGVsc2UgaWYgKGhhc0tleXMpIHtcbiAgICAgIG9ialtpbmRleF0gPSBBcnJheS5mcm9tKHZhbHVlLmtleXMoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9ialtpbmRleF0gPSB2YWx1ZSBpbnN0YW5jZW9mIE9iamVjdCAmJiBTeW1ib2wudG9TdHJpbmdUYWcgaW4gdmFsdWUgPyB2YWx1ZVtTeW1ib2wudG9TdHJpbmdUYWddIDogdmFsdWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBvYmo7XG59O1xuaGFyZGVuKGluc3BlY3RNYXBTdG9yZSk7XG5cbi8vXG52YXIgbWFrZUZha2VTdG9yYWdlID0gKHBhdGgsIHB1YmxpY2F0aW9uKSA9PiB7XG4gIGxldCBzZXRWYWx1ZUNhbGxzID0gMDtcbiAgY29uc3QgZnVsbFBhdGggPSBgcHVibGlzaC4ke3BhdGh9YDtcbiAgY29uc3Qgc3RvcmVLZXkgPSBoYXJkZW4oe1xuICAgIHN0b3JlTmFtZTogXCJzd2luZ3NldFwiLFxuICAgIHN0b3JlU3Via2V5OiBgc3dpbmdzZXQvZGF0YToke2Z1bGxQYXRofWAsXG4gICAgZGF0YVByZWZpeEJ5dGVzOiBcIlwiXG4gIH0pO1xuICBjb25zdCBzdG9yYWdlID0gRmFyKFwiU3RvcmFnZU5vZGVcIiwge1xuICAgIGdldFBhdGg6ICgpID0+IHBhdGgsXG4gICAgZ2V0U3RvcmVLZXk6IGFzeW5jICgpID0+IHN0b3JlS2V5LFxuICAgIHNldFZhbHVlOiBhc3luYyAodmFsdWUpID0+IHtcbiAgICAgIHNldFZhbHVlQ2FsbHMgKz0gMTtcbiAgICAgIGFzc2VydC50eXBlb2YodmFsdWUsIFwic3RyaW5nXCIpO1xuICAgICAgaWYgKHB1YmxpY2F0aW9uKSB7XG4gICAgICAgIHB1YmxpY2F0aW9uLnVwZGF0ZVN0YXRlKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1ha2VDaGlsZE5vZGU6ICgpID0+IHN0b3JhZ2UsXG4gICAgY291bnRTZXRWYWx1ZUNhbGxzOiAoKSA9PiBzZXRWYWx1ZUNhbGxzXG4gIH0pO1xuICByZXR1cm4gc3RvcmFnZTtcbn07XG5oYXJkZW4obWFrZUZha2VTdG9yYWdlKTtcbnZhciBtYWtlRmFrZU1hcnNoYWxsZXIgPSAoKSA9PiBtYWtlTWFyc2hhbCh2b2lkIDAsIHZvaWQgMCwge1xuICBtYXJzaGFsU2F2ZUVycm9yOiAoKSA9PiB7XG4gIH1cbn0pO1xuaGFyZGVuKG1ha2VGYWtlTWFyc2hhbGxlcik7XG5cbi8vXG52YXIgcHJlcGFyZVJlY29yZGVyID0gKGJhZ2dhZ2UsIG1hcnNoYWxsZXIpID0+IHtcbiAgY29uc3QgbWFrZVJlY29yZGVyID0gcHJlcGFyZUV4b0NsYXNzKFxuICAgIGJhZ2dhZ2UsXG4gICAgXCJSZWNvcmRlclwiLFxuICAgIE0uaW50ZXJmYWNlKFwiUmVjb3JkZXJcIiwge1xuICAgICAgZ2V0U3RvcmFnZU5vZGU6IE0uY2FsbCgpLnJldHVybnMoU3RvcmFnZU5vZGVTaGFwZSksXG4gICAgICBnZXRTdG9yYWdlUGF0aDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoXG4gICAgICAgIC8qICAgICAgICAqL1xuICAgICAgKSksXG4gICAgICB3cml0ZTogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgd3JpdGVGaW5hbDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoTS5wcm9taXNlKCkpXG4gICAgfSksXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgIChwdWJsaXNoZXIsIHN0b3JhZ2VOb2RlLCB2YWx1ZVNoYXBlID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIE0uYW55KClcbiAgICApKSA9PiB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjbG9zZWQ6IGZhbHNlLFxuICAgICAgICBwdWJsaXNoZXIsXG4gICAgICAgIHN0b3JhZ2VOb2RlLFxuICAgICAgICBzdG9yYWdlUGF0aDogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHZvaWQgMFxuICAgICAgICApLFxuICAgICAgICB2YWx1ZVNoYXBlXG4gICAgICB9O1xuICAgIH0sXG4gICAge1xuICAgICAgZ2V0U3RvcmFnZU5vZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnN0b3JhZ2VOb2RlO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIGdldFN0b3JhZ2VQYXRoKCkge1xuICAgICAgICBjb25zdCB7IHN0b3JhZ2VQYXRoOiBoZWxkUGF0aCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgYXdhaXQgbnVsbDtcbiAgICAgICAgaWYgKGhlbGRQYXRoICE9PSB2b2lkIDApIHtcbiAgICAgICAgICByZXR1cm4gaGVsZFBhdGg7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGF0aCA9IGF3YWl0IEUodGhpcy5zdGF0ZS5zdG9yYWdlTm9kZSkuZ2V0UGF0aCgpO1xuICAgICAgICB0aGlzLnN0YXRlLnN0b3JhZ2VQYXRoID0gcGF0aDtcbiAgICAgICAgcmV0dXJuIHBhdGg7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuICAgICAgICovXG4gICAgICBhc3luYyB3cml0ZSh2YWx1ZSkge1xuICAgICAgICBjb25zdCB7IGNsb3NlZCwgcHVibGlzaGVyLCBzdG9yYWdlTm9kZSwgdmFsdWVTaGFwZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgIWNsb3NlZCB8fCB0aHJvd1JlZGFjdGVkYGNhbm5vdCB3cml0ZSB0byBjbG9zZWQgcmVjb3JkZXJgO1xuICAgICAgICBtdXN0TWF0Y2gyKHZhbHVlLCB2YWx1ZVNoYXBlKTtcbiAgICAgICAgY29uc3QgZW5jb2RlZCA9IGF3YWl0IEUobWFyc2hhbGxlcikudG9DYXBEYXRhKHZhbHVlKTtcbiAgICAgICAgY29uc3Qgc2VyaWFsaXplZCA9IEpTT04uc3RyaW5naWZ5KGVuY29kZWQpO1xuICAgICAgICBhd2FpdCBFKHN0b3JhZ2VOb2RlKS5zZXRWYWx1ZShzZXJpYWxpemVkKTtcbiAgICAgICAgcmV0dXJuIHB1Ymxpc2hlci5wdWJsaXNoKHZhbHVlKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIHdyaXRlRmluYWwodmFsdWUpIHtcbiAgICAgICAgY29uc3QgeyBjbG9zZWQsIHB1Ymxpc2hlciwgc3RvcmFnZU5vZGUsIHZhbHVlU2hhcGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICFjbG9zZWQgfHwgdGhyb3dSZWRhY3RlZGBjYW5ub3Qgd3JpdGUgdG8gY2xvc2VkIHJlY29yZGVyYDtcbiAgICAgICAgbXVzdE1hdGNoMih2YWx1ZSwgdmFsdWVTaGFwZSk7XG4gICAgICAgIGNvbnN0IGVuY29kZWQgPSBhd2FpdCBFKG1hcnNoYWxsZXIpLnRvQ2FwRGF0YSh2YWx1ZSk7XG4gICAgICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSBKU09OLnN0cmluZ2lmeShlbmNvZGVkKTtcbiAgICAgICAgYXdhaXQgRShzdG9yYWdlTm9kZSkuc2V0VmFsdWUoc2VyaWFsaXplZCk7XG4gICAgICAgIHRoaXMuc3RhdGUuY2xvc2VkID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHB1Ymxpc2hlci5maW5pc2godmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuIG1ha2VSZWNvcmRlcjtcbn07XG5oYXJkZW4ocHJlcGFyZVJlY29yZGVyKTtcbnZhciBkZWZpbmVSZWNvcmRlcktpdCA9ICh7IG1ha2VSZWNvcmRlciwgbWFrZUR1cmFibGVQdWJsaXNoS2l0IH0pID0+IHtcbiAgY29uc3QgbWFrZVJlY29yZGVyS2l0ID0gKHN0b3JhZ2VOb2RlLCB2YWx1ZVNoYXBlKSA9PiB7XG4gICAgY29uc3QgeyBzdWJzY3JpYmVyLCBwdWJsaXNoZXIgfSA9IG1ha2VEdXJhYmxlUHVibGlzaEtpdCgpO1xuICAgIGNvbnN0IHJlY29yZGVyID0gbWFrZVJlY29yZGVyKFxuICAgICAgcHVibGlzaGVyLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHN0b3JhZ2VOb2RlLFxuICAgICAgdmFsdWVTaGFwZVxuICAgICk7XG4gICAgcmV0dXJuIGhhcmRlbih7IHN1YnNjcmliZXIsIHJlY29yZGVyIH0pO1xuICB9O1xuICByZXR1cm4gbWFrZVJlY29yZGVyS2l0O1xufTtcbnZhciBkZWZpbmVFUmVjb3JkZXJLaXQgPSAoeyBtYWtlUmVjb3JkZXIsIG1ha2VEdXJhYmxlUHVibGlzaEtpdCB9KSA9PiB7XG4gIGNvbnN0IG1ha2VFUmVjb3JkZXJLaXQgPSAoc3RvcmFnZU5vZGVQLCB2YWx1ZVNoYXBlKSA9PiB7XG4gICAgY29uc3QgeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSA9IG1ha2VEdXJhYmxlUHVibGlzaEtpdCgpO1xuICAgIGNvbnN0IHJlY29yZGVyUCA9IEUud2hlbihcbiAgICAgIHN0b3JhZ2VOb2RlUCxcbiAgICAgIChzdG9yYWdlTm9kZSkgPT4gbWFrZVJlY29yZGVyKFxuICAgICAgICBwdWJsaXNoZXIsXG4gICAgICAgIC8vXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHN0b3JhZ2VOb2RlLFxuICAgICAgICB2YWx1ZVNoYXBlXG4gICAgICApXG4gICAgKTtcbiAgICByZXR1cm4geyBzdWJzY3JpYmVyLCByZWNvcmRlclAgfTtcbiAgfTtcbiAgcmV0dXJuIG1ha2VFUmVjb3JkZXJLaXQ7XG59O1xuaGFyZGVuKGRlZmluZUVSZWNvcmRlcktpdCk7XG52YXIgcHJlcGFyZVJlY29yZGVyS2l0TWFrZXJzID0gKGJhZ2dhZ2UsIG1hcnNoYWxsZXIpID0+IHtcbiAgY29uc3QgbWFrZUR1cmFibGVQdWJsaXNoS2l0ID0gcHJlcGFyZUR1cmFibGVQdWJsaXNoS2l0KFxuICAgIGJhZ2dhZ2UsXG4gICAgXCJEdXJhYmxlIFB1Ymxpc2ggS2l0XCJcbiAgKTtcbiAgY29uc3QgbWFrZVJlY29yZGVyID0gcHJlcGFyZVJlY29yZGVyKGJhZ2dhZ2UsIG1hcnNoYWxsZXIpO1xuICBjb25zdCBtYWtlUmVjb3JkZXJLaXQgPSBkZWZpbmVSZWNvcmRlcktpdCh7XG4gICAgbWFrZVJlY29yZGVyLFxuICAgIG1ha2VEdXJhYmxlUHVibGlzaEtpdFxuICB9KTtcbiAgY29uc3QgbWFrZUVSZWNvcmRlcktpdCA9IGRlZmluZUVSZWNvcmRlcktpdCh7XG4gICAgbWFrZVJlY29yZGVyLFxuICAgIG1ha2VEdXJhYmxlUHVibGlzaEtpdFxuICB9KTtcbiAgcmV0dXJuIHtcbiAgICBtYWtlRHVyYWJsZVB1Ymxpc2hLaXQsXG4gICAgbWFrZVJlY29yZGVyLFxuICAgIG1ha2VSZWNvcmRlcktpdCxcbiAgICBtYWtlRVJlY29yZGVyS2l0XG4gIH07XG59O1xudmFyIFJlY29yZGVyS2l0U2hhcGUgPSB7XG4gIHJlY29yZGVyOiBNLnJlbW90YWJsZSgpLFxuICBzdWJzY3JpYmVyOiBNLnJlbW90YWJsZSgpXG59O1xuaGFyZGVuKFJlY29yZGVyS2l0U2hhcGUpO1xuXG4vL1xudmFyIGNhaXBJZEZyb21JbmZvID0gKGluZm8pID0+IHtcbiAgcmV0dXJuIGAke2luZm8ubmFtZXNwYWNlfToke2luZm8ucmVmZXJlbmNlfWA7XG59O1xuXG4vL1xudmFyIFBGTV9SRUNFSVZFUiA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgXCJwZm1cIlxuKTtcbnZhciBIdWJOYW1lID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIENoYWluOiBcImNoYWluXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQ2hhaW5Bc3NldHM6IFwiY2hhaW5Bc3NldHNcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQ2hhaW5Db25uZWN0aW9uOiBcImNoYWluQ29ubmVjdGlvblwiXG4gIH1cbik7XG5oYXJkZW4oSHViTmFtZSk7XG52YXIgQ0hBSU5fS0VZID0gSHViTmFtZS5DaGFpbjtcbnZhciBDT05ORUNUSU9OU19LRVkgPSBIdWJOYW1lLkNoYWluQ29ubmVjdGlvbjtcbnZhciBBU1NFVFNfS0VZID0gSHViTmFtZS5DaGFpbkFzc2V0cztcbnZhciBDSEFJTl9JRF9TRVBBUkFUT1IgPSBcIl9cIjtcbnZhciBlbmNvZGVDaGFpbklkID0gKGNoYWluSWQpID0+IGNoYWluSWQucmVwbGFjZUFsbChcbiAgQ0hBSU5fSURfU0VQQVJBVE9SLFxuICBgJHtDSEFJTl9JRF9TRVBBUkFUT1J9JHtDSEFJTl9JRF9TRVBBUkFUT1J9YFxuKTtcbnZhciBjb25uZWN0aW9uS2V5ID0gKGNoYWluSWQxLCBjaGFpbklkMikgPT4ge1xuICBjb25zdCBjaGFpbklkMVNhbml0aXplZCA9IGVuY29kZUNoYWluSWQoY2hhaW5JZDEpO1xuICBjb25zdCBjaGFpbklkMlNhbml0aXplZCA9IGVuY29kZUNoYWluSWQoY2hhaW5JZDIpO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBbY2hhaW5JZDFTYW5pdGl6ZWQsIGNoYWluSWQyU2FuaXRpemVkXS5zb3J0KCkuam9pbihDSEFJTl9JRF9TRVBBUkFUT1IpXG4gICk7XG59O1xudmFyIHJldmVyc2VDb25uSW5mbyA9IChjb25uSW5mbykgPT4ge1xuICBjb25zdCB7IHRyYW5zZmVyQ2hhbm5lbCB9ID0gY29ubkluZm87XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGlkOiBjb25uSW5mby5jb3VudGVycGFydHkuY29ubmVjdGlvbl9pZCxcbiAgICBjbGllbnRfaWQ6IGNvbm5JbmZvLmNvdW50ZXJwYXJ0eS5jbGllbnRfaWQsXG4gICAgY291bnRlcnBhcnR5OiB7XG4gICAgICBjbGllbnRfaWQ6IGNvbm5JbmZvLmNsaWVudF9pZCxcbiAgICAgIGNvbm5lY3Rpb25faWQ6IGNvbm5JbmZvLmlkXG4gICAgfSxcbiAgICBzdGF0ZTogY29ubkluZm8uc3RhdGUsXG4gICAgdHJhbnNmZXJDaGFubmVsOiB7XG4gICAgICAuLi50cmFuc2ZlckNoYW5uZWwsXG4gICAgICBjaGFubmVsSWQ6IHRyYW5zZmVyQ2hhbm5lbC5jb3VudGVyUGFydHlDaGFubmVsSWQsXG4gICAgICBjb3VudGVyUGFydHlDaGFubmVsSWQ6IHRyYW5zZmVyQ2hhbm5lbC5jaGFubmVsSWQsXG4gICAgICBwb3J0SWQ6IHRyYW5zZmVyQ2hhbm5lbC5jb3VudGVyUGFydHlQb3J0SWQsXG4gICAgICBjb3VudGVyUGFydHlQb3J0SWQ6IHRyYW5zZmVyQ2hhbm5lbC5wb3J0SWRcbiAgICB9XG4gIH0pO1xufTtcbnZhciBub3JtYWxpemVDb25uZWN0aW9uSW5mbyA9IChwcmltYXJ5Q2hhaW5JZCwgY291bnRlckNoYWluSWQsIGRpcmVjdGVkKSA9PiB7XG4gIGNvbnN0IGtleSA9IGNvbm5lY3Rpb25LZXkocHJpbWFyeUNoYWluSWQsIGNvdW50ZXJDaGFpbklkKTtcbiAgaWYgKHByaW1hcnlDaGFpbklkIDwgY291bnRlckNoYWluSWQpIHtcbiAgICByZXR1cm4gW2tleSwgZGlyZWN0ZWRdO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBba2V5LCByZXZlcnNlQ29ubkluZm8oZGlyZWN0ZWQpXTtcbiAgfVxufTtcbnZhciBkZW5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvID0gKHByaW1hcnlDaGFpbklkLCBjb3VudGVyQ2hhaW5JZCwgbm9ybWFsaXplZCkgPT4ge1xuICBpZiAocHJpbWFyeUNoYWluSWQgPCBjb3VudGVyQ2hhaW5JZCkge1xuICAgIHJldHVybiBub3JtYWxpemVkO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiByZXZlcnNlQ29ubkluZm8obm9ybWFsaXplZCk7XG4gIH1cbn07XG52YXIgQ2hhaW5JZEFyZ1NoYXBlID0gTS5vcihcbiAgTS5zdHJpbmcoKSxcbiAgTS5zcGxpdFJlY29yZChcbiAgICB7XG4gICAgICBjaGFpbklkOiBNLnN0cmluZygpXG4gICAgfSxcbiAgICB2b2lkIDAsXG4gICAgTS5hbnkoKVxuICApXG4pO1xudmFyIERlZmF1bHRQZm1UaW1lb3V0T3B0cyA9IGhhcmRlbihcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIHJldHJpZXM6IDMsXG4gICAgdGltZW91dDogKFxuICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgIFwiMTBtXCJcbiAgICApXG4gIH1cbik7XG52YXIgVHJhbnNmZXJSb3V0ZVNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIHNvdXJjZVBvcnQ6IE0uc3RyaW5nKCksXG4gICAgc291cmNlQ2hhbm5lbDogSUJDQ2hhbm5lbElEU2hhcGUsXG4gICAgdG9rZW46IENvaW5TaGFwZSxcbiAgICByZWNlaXZlcjogTS5zdHJpbmcoKVxuICB9LFxuICB7IGZvcndhcmRJbmZvOiBGb3J3YXJkSW5mb1NoYXBlIH0sXG4gIHt9XG4pO1xudmFyIENoYWluSHViSSA9IE0uaW50ZXJmYWNlKFwiQ2hhaW5IdWJcIiwge1xuICByZWdpc3RlckNoYWluOiBNLmNhbGwoTS5zdHJpbmcoKSwgQ2hhaW5JbmZvU2hhcGUpLnJldHVybnMoKSxcbiAgdXBkYXRlQ2hhaW46IE0uY2FsbChNLnN0cmluZygpLCBDaGFpbkluZm9TaGFwZSkucmV0dXJucygpLFxuICBnZXRDaGFpbkluZm86IE0uY2FsbChNLnN0cmluZygpKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0Q2hhaW5JbmZvQnlDaGFpbklkOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhDaGFpbkluZm9TaGFwZSksXG4gIHJlZ2lzdGVyQ29ubmVjdGlvbjogTS5jYWxsKFxuICAgIE0uc3RyaW5nKCksXG4gICAgTS5zdHJpbmcoKSxcbiAgICBJQkNDb25uZWN0aW9uSW5mb1NoYXBlXG4gICkucmV0dXJucygpLFxuICB1cGRhdGVDb25uZWN0aW9uOiBNLmNhbGwoXG4gICAgTS5zdHJpbmcoKSxcbiAgICBNLnN0cmluZygpLFxuICAgIElCQ0Nvbm5lY3Rpb25JbmZvU2hhcGVcbiAgKS5yZXR1cm5zKCksXG4gIGdldENvbm5lY3Rpb25JbmZvOiBNLmNhbGwoQ2hhaW5JZEFyZ1NoYXBlLCBDaGFpbklkQXJnU2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICBnZXRDaGFpbnNBbmRDb25uZWN0aW9uOiBNLmNhbGwoTS5zdHJpbmcoKSwgTS5zdHJpbmcoKSkucmV0dXJucyhWb3dTaGFwZSksXG4gIHJlZ2lzdGVyQXNzZXQ6IE0uY2FsbChNLnN0cmluZygpLCBEZW5vbURldGFpbFNoYXBlKS5yZXR1cm5zKCksXG4gIHVwZGF0ZUFzc2V0OiBNLmNhbGwoTS5zdHJpbmcoKSwgRGVub21EZXRhaWxTaGFwZSkucmV0dXJucygpLFxuICBnZXRBc3NldDogTS5jYWxsKE0uc3RyaW5nKCksIE0uc3RyaW5nKCkpLnJldHVybnMoXG4gICAgTS5vcihEZW5vbURldGFpbFNoYXBlLCBNLnVuZGVmaW5lZCgpKVxuICApLFxuICBnZXREZW5vbTogTS5jYWxsKEJyYW5kU2hhcGUpLnJldHVybnMoTS5vcihNLnN0cmluZygpLCBNLnVuZGVmaW5lZCgpKSksXG4gIGNvZXJjZUNvc21vc0FkZHJlc3M6IE0uY2FsbChBY2NvdW50SWRBcmdTaGFwZSkucmV0dXJucyhcbiAgICBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZVxuICApLFxuICByZXNvbHZlQWNjb3VudElkOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgbWFrZVRyYW5zZmVyUm91dGU6IE0uY2FsbChBY2NvdW50SWRBcmdTaGFwZSwgRGVub21BbW91bnRTaGFwZSwgTS5zdHJpbmcoKSkub3B0aW9uYWwoRm9yd2FyZE9wdHNTaGFwZSkucmV0dXJucyhNLm9yKE0udW5kZWZpbmVkKCksIFRyYW5zZmVyUm91dGVTaGFwZSkpXG59KTtcbnZhciBtYWtlQ2hhaW5IdWIgPSAoem9uZSwgYWdvcmljTmFtZXMsIHZvd1Rvb2xzLCB7IGNoYWluSW5mb1ZhbHVlU2hhcGUgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgQ2hhaW5JbmZvU2hhcGVcbikgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGNoYWluSW5mb3MgPSB6b25lLm1hcFN0b3JlKFwiY2hhaW5JbmZvc1wiLCB7XG4gICAga2V5U2hhcGU6IE0uc3RyaW5nKCksXG4gICAgdmFsdWVTaGFwZTogY2hhaW5JbmZvVmFsdWVTaGFwZVxuICB9KTtcbiAgY29uc3QgY29ubmVjdGlvbkluZm9zID0gem9uZS5tYXBTdG9yZShcImNvbm5lY3Rpb25JbmZvc1wiLCB7XG4gICAga2V5U2hhcGU6IE0uc3RyaW5nKCksXG4gICAgdmFsdWVTaGFwZTogSUJDQ29ubmVjdGlvbkluZm9TaGFwZVxuICB9KTtcbiAgY29uc3QgZGVub21EZXRhaWxzID0gem9uZS5tYXBTdG9yZShcImRlbm9tXCIsIHtcbiAgICBrZXlTaGFwZTogTS5zdHJpbmcoKSxcbiAgICB2YWx1ZVNoYXBlOiBEZW5vbURldGFpbFNoYXBlXG4gIH0pO1xuICBjb25zdCBicmFuZERlbm9tcyA9IHpvbmUubWFwU3RvcmUoXCJicmFuZERlbm9tXCIsIHtcbiAgICBrZXlTaGFwZTogQnJhbmRTaGFwZSxcbiAgICB2YWx1ZVNoYXBlOiBNLnN0cmluZygpXG4gIH0pO1xuICBjb25zdCBiZWNoMzJQcmVmaXhUb0NoYWluTmFtZSA9IHpvbmUubWFwU3RvcmUoXCJiZWNoMzJQcmVmaXhUb0NoYWluTmFtZVwiLCB7XG4gICAga2V5U2hhcGU6IE0uc3RyaW5nKCksXG4gICAgdmFsdWVTaGFwZTogTS5zdHJpbmcoKVxuICB9KTtcbiAgY29uc3QgY2hhaW5JZFRvQ2hhaW5OYW1lID0gem9uZS5tYXBTdG9yZShcImNoYWluSWRUb0NoYWluTmFtZVwiLCB7XG4gICAga2V5U2hhcGU6IE0uc3RyaW5nKCksXG4gICAgdmFsdWVTaGFwZTogTS5zdHJpbmcoKVxuICB9KTtcbiAgY29uc3QgbWFrZURlbm9tS2V5ID0gKGRlbm9tLCBzcmNDaGFpbk5hbWUpID0+IGAke3NyY0NoYWluTmFtZX06JHtkZW5vbX1gO1xuICBjb25zdCByZXNvbHZlQ29zbW9zQ2hhaW5JZCA9IChhZGRyZXNzKSA9PiB7XG4gICAgY29uc3QgcHJlZml4ID0gZ2V0QmVjaDMyUHJlZml4KGFkZHJlc3MpO1xuICAgIGlmICghYmVjaDMyUHJlZml4VG9DaGFpbk5hbWUuaGFzKHByZWZpeCkpIHtcbiAgICAgIHRocm93IG1ha2VFcnJvcihgQ2hhaW4gaW5mbyBub3QgZm91bmQgZm9yIGJlY2gzMlByZWZpeCAke3F1b3RlKHByZWZpeCl9YCk7XG4gICAgfVxuICAgIGNvbnN0IGNoYWluTmFtZSA9IGJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lLmdldChwcmVmaXgpO1xuICAgIGNvbnN0IHsgY2hhaW5JZCB9ID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBjaGFpbkluZm9zLmdldChjaGFpbk5hbWUpXG4gICAgKTtcbiAgICByZXR1cm4gY2hhaW5JZDtcbiAgfTtcbiAgY29uc3QgbG9va3VwQ2hhaW5JbmZvID0gdm93VG9vbHMucmV0cnlhYmxlKFxuICAgIHpvbmUsXG4gICAgXCJsb29rdXBDaGFpbkluZm9cIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIC8vXG4gICAgYXN5bmMgKGNoYWluTmFtZSkgPT4ge1xuICAgICAgYXdhaXQgbnVsbDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNoYWluSW5mbyA9IGF3YWl0IEUoYWdvcmljTmFtZXMpLmxvb2t1cChIdWJOYW1lLkNoYWluLCBjaGFpbk5hbWUpO1xuICAgICAgICBpZiAoIWNoYWluSW5mb3MuaGFzKGNoYWluTmFtZSkpIHtcbiAgICAgICAgICBjaGFpbkluZm9zLmluaXQoY2hhaW5OYW1lLCBjaGFpbkluZm8pO1xuICAgICAgICAgIGNoYWluSWRUb0NoYWluTmFtZS5pbml0KGNhaXBJZEZyb21JbmZvKGNoYWluSW5mbyksIGNoYWluTmFtZSk7XG4gICAgICAgICAgaWYgKGNoYWluSW5mby5iZWNoMzJQcmVmaXgpIHtcbiAgICAgICAgICAgIGJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lLmluaXQoY2hhaW5JbmZvLmJlY2gzMlByZWZpeCwgY2hhaW5OYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoYWluSW5mbztcbiAgICAgIH0gY2F0Y2ggKGUyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJsb29rdXBDaGFpbkluZm9cIiwgY2hhaW5OYW1lLCBcImVycm9yXCIsIGUyKTtcbiAgICAgICAgdGhyb3cgbWFrZUVycm9yKGBjaGFpbiBub3QgZm91bmQ6JHtjaGFpbk5hbWV9YCk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBsb29rdXBDb25uZWN0aW9uSW5mbyA9IHZvd1Rvb2xzLnJldHJ5YWJsZShcbiAgICB6b25lLFxuICAgIFwibG9va3VwQ29ubmVjdGlvbkluZm9cIixcbiAgICAvKlxuXG5cbiAgICAgKi9cbiAgICAvL1xuICAgIGFzeW5jIChjaGFpbklkMSwgY2hhaW5JZDIpID0+IHtcbiAgICAgIGF3YWl0IG51bGw7XG4gICAgICBjb25zdCBrZXkgPSBjb25uZWN0aW9uS2V5KGNoYWluSWQxLCBjaGFpbklkMik7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uSW5mbyA9IGF3YWl0IEUoYWdvcmljTmFtZXMpLmxvb2t1cChcbiAgICAgICAgICBIdWJOYW1lLkNoYWluQ29ubmVjdGlvbixcbiAgICAgICAgICBrZXlcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKCFjb25uZWN0aW9uSW5mb3MuaGFzKGtleSkpIHtcbiAgICAgICAgICBjb25uZWN0aW9uSW5mb3MuaW5pdChrZXksIGNvbm5lY3Rpb25JbmZvKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGVub3JtYWxpemVDb25uZWN0aW9uSW5mbyhjaGFpbklkMSwgY2hhaW5JZDIsIGNvbm5lY3Rpb25JbmZvKTtcbiAgICAgIH0gY2F0Y2ggKGUyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJsb29rdXBDb25uZWN0aW9uSW5mb1wiLCBjaGFpbklkMSwgY2hhaW5JZDIsIFwiZXJyb3JcIiwgZTIpO1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoYGNvbm5lY3Rpb24gbm90IGZvdW5kOiAke2NoYWluSWQxfTwtPiR7Y2hhaW5JZDJ9YCk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBsb29rdXBDaGFpbnNBbmRDb25uZWN0aW9uID0gdm93VG9vbHMucmV0cnlhYmxlKFxuICAgIHpvbmUsXG4gICAgXCJsb29rdXBDaGFpbnNBbmRDb25uZWN0aW9uXCIsXG4gICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgLy9cbiAgICBhc3luYyAocHJpbWFyeU5hbWUsIGNvdW50ZXJOYW1lKSA9PiB7XG4gICAgICBjb25zdCBbcHJpbWFyeSwgY291bnRlcl0gPSBhd2FpdCB2b3dUb29scy5hc1Byb21pc2UoXG4gICAgICAgIHZvd1Rvb2xzLmFsbFZvd3MoW1xuICAgICAgICAgIGNoYWluSHViLmdldENoYWluSW5mbyhwcmltYXJ5TmFtZSksXG4gICAgICAgICAgY2hhaW5IdWIuZ2V0Q2hhaW5JbmZvKGNvdW50ZXJOYW1lKVxuICAgICAgICBdKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb25JbmZvID0gcHJpbWFyeS5uYW1lc3BhY2UgPT09IFwiY29zbW9zXCIgJiYgY291bnRlci5uYW1lc3BhY2UgPT09IFwiY29zbW9zXCIgPyBhd2FpdCB2b3dUb29scy5hc1Byb21pc2UoXG4gICAgICAgIGNoYWluSHViLmdldENvbm5lY3Rpb25JbmZvKHByaW1hcnksIGNvdW50ZXIpXG4gICAgICApIDogdm9pZCAwO1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgLypcblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBbcHJpbWFyeSwgY291bnRlciwgY29ubmVjdGlvbkluZm9dXG4gICAgICApO1xuICAgIH1cbiAgKTtcbiAgY29uc3QgY2hhaW5IdWIgPSB6b25lLmV4byhcIkNoYWluSHViXCIsIENoYWluSHViSSwge1xuICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICByZWdpc3RlckNoYWluKG5hbWUsIGNoYWluSW5mbykge1xuICAgICAgY2hhaW5JbmZvcy5pbml0KG5hbWUsIGNoYWluSW5mbyk7XG4gICAgICBjaGFpbklkVG9DaGFpbk5hbWUuaW5pdChjYWlwSWRGcm9tSW5mbyhjaGFpbkluZm8pLCBuYW1lKTtcbiAgICAgIGlmIChjaGFpbkluZm8ubmFtZXNwYWNlID09PSBcImNvc21vc1wiICYmIGNoYWluSW5mby5iZWNoMzJQcmVmaXgpIHtcbiAgICAgICAgYmVjaDMyUHJlZml4VG9DaGFpbk5hbWUuaW5pdChjaGFpbkluZm8uYmVjaDMyUHJlZml4LCBuYW1lKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuICAgICAqL1xuICAgIHVwZGF0ZUNoYWluKGNoYWluTmFtZSwgY2hhaW5JbmZvKSB7XG4gICAgICBpZiAoIWNoYWluSW5mb3MuaGFzKGNoYWluTmFtZSkpIHtcbiAgICAgICAgdGhyb3cgbWFrZUVycm9yKGBDaGFpbiAke3F1b3RlKGNoYWluTmFtZSl9IG5vdCByZWdpc3RlcmVkYCk7XG4gICAgICB9XG4gICAgICBjb25zdCBvbGRJbmZvID0gY2hhaW5JbmZvcy5nZXQoY2hhaW5OYW1lKTtcbiAgICAgIGlmIChjaGFpbklkVG9DaGFpbk5hbWUuaGFzKGNhaXBJZEZyb21JbmZvKG9sZEluZm8pKSkge1xuICAgICAgICBjaGFpbklkVG9DaGFpbk5hbWUuZGVsZXRlKGNhaXBJZEZyb21JbmZvKG9sZEluZm8pKTtcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG9sZEluZm8uYmVjaDMyUHJlZml4XG4gICAgICApIHtcbiAgICAgICAgYmVjaDMyUHJlZml4VG9DaGFpbk5hbWUuZGVsZXRlKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG9sZEluZm8uYmVjaDMyUHJlZml4XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjaGFpbkluZm9zLnNldChjaGFpbk5hbWUsIGNoYWluSW5mbyk7XG4gICAgICBjaGFpbklkVG9DaGFpbk5hbWUuaW5pdChjYWlwSWRGcm9tSW5mbyhjaGFpbkluZm8pLCBjaGFpbk5hbWUpO1xuICAgICAgaWYgKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgY2hhaW5JbmZvLmJlY2gzMlByZWZpeFxuICAgICAgKSB7XG4gICAgICAgIGJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lLmluaXQoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgY2hhaW5JbmZvLmJlY2gzMlByZWZpeCxcbiAgICAgICAgICBjaGFpbk5hbWVcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qXG5cblxuXG4gICAgICovXG4gICAgZ2V0Q2hhaW5JbmZvKGNoYWluTmFtZSkge1xuICAgICAgY2hhaW5OYW1lLmluY2x1ZGVzKFwiOlwiKSAmJiB0aHJvd1JlZGFjdGVkYCR7Y2hhaW5OYW1lfSBtdXN0IGJlIGEgYmFyZSBjaGFpbiBuYW1lLiBNYXliZSB0cnkgZ2V0Q2hhaW5JbmZvQnlDaGFpbklkKClgO1xuICAgICAgaWYgKGNoYWluSW5mb3MuaGFzKGNoYWluTmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHZvd1Rvb2xzLmFzVm93KFxuICAgICAgICAgICAgKCkgPT4gKFxuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBjaGFpbkluZm9zLmdldChjaGFpbk5hbWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGxvb2t1cENoYWluSW5mbyhjaGFpbk5hbWUpO1xuICAgIH0sXG4gICAgLypcblxuXG4gICAgICovXG4gICAgZ2V0Q2hhaW5JbmZvQnlDaGFpbklkKGNoYWluSWQpIHtcbiAgICAgIGNoYWluSWRUb0NoYWluTmFtZS5oYXMoY2hhaW5JZCkgfHwgdGhyb3dSZWRhY3RlZGBDaGFpbiBuYW1lIG5vdCBmb3VuZCBmb3IgJHtxdW90ZShjaGFpbklkKX1gO1xuICAgICAgY29uc3QgY2hhaW5OYW1lID0gY2hhaW5JZFRvQ2hhaW5OYW1lLmdldChjaGFpbklkKTtcbiAgICAgIGNoYWluSW5mb3MuaGFzKGNoYWluTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBDaGFpbiBJbmZvIG5vdCBmb3VuZCBmb3IgJHtxdW90ZShjaGFpbklkKX1gO1xuICAgICAgcmV0dXJuIGNoYWluSW5mb3MuZ2V0KGNoYWluTmFtZSk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cbiAgICAgKi9cbiAgICByZWdpc3RlckNvbm5lY3Rpb24ocHJpbWFyeUNoYWluSWQsIGNvdW50ZXJwYXJ0eUNoYWluSWQsIGNvbm5lY3Rpb25JbmZvKSB7XG4gICAgICBjb25zdCBba2V5LCBub3JtYWxpemVkXSA9IG5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvKFxuICAgICAgICBwcmltYXJ5Q2hhaW5JZCxcbiAgICAgICAgY291bnRlcnBhcnR5Q2hhaW5JZCxcbiAgICAgICAgY29ubmVjdGlvbkluZm9cbiAgICAgICk7XG4gICAgICBjb25uZWN0aW9uSW5mb3MuaW5pdChrZXksIG5vcm1hbGl6ZWQpO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIHVwZGF0ZUNvbm5lY3Rpb24ocHJpbWFyeUNoYWluSWQsIGNvdW50ZXJwYXJ0eUNoYWluSWQsIGNvbm5lY3Rpb25JbmZvKSB7XG4gICAgICBjb25zdCBrZXkgPSBjb25uZWN0aW9uS2V5KHByaW1hcnlDaGFpbklkLCBjb3VudGVycGFydHlDaGFpbklkKTtcbiAgICAgIGlmICghY29ubmVjdGlvbkluZm9zLmhhcyhrZXkpKSB7XG4gICAgICAgIHRocm93IG1ha2VFcnJvcihcbiAgICAgICAgICBgQ29ubmVjdGlvbiAke3F1b3RlKHByaW1hcnlDaGFpbklkKX08LT4ke3F1b3RlKGNvdW50ZXJwYXJ0eUNoYWluSWQpfSBub3QgcmVnaXN0ZXJlZGBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IFtfLCBub3JtYWxpemVkSW5mb10gPSBub3JtYWxpemVDb25uZWN0aW9uSW5mbyhcbiAgICAgICAgcHJpbWFyeUNoYWluSWQsXG4gICAgICAgIGNvdW50ZXJwYXJ0eUNoYWluSWQsXG4gICAgICAgIGNvbm5lY3Rpb25JbmZvXG4gICAgICApO1xuICAgICAgY29ubmVjdGlvbkluZm9zLnNldChrZXksIG5vcm1hbGl6ZWRJbmZvKTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG4gICAgICovXG4gICAgZ2V0Q29ubmVjdGlvbkluZm8ocHJpbWFyeSwgY291bnRlcikge1xuICAgICAgY29uc3QgcHJpbWFyeUlkID0gdHlwZW9mIHByaW1hcnkgPT09IFwic3RyaW5nXCIgPyBwcmltYXJ5IDogcHJpbWFyeS5jaGFpbklkO1xuICAgICAgY29uc3QgY291bnRlcklkID0gdHlwZW9mIGNvdW50ZXIgPT09IFwic3RyaW5nXCIgPyBjb3VudGVyIDogY291bnRlci5jaGFpbklkO1xuICAgICAgY29uc3Qga2V5ID0gY29ubmVjdGlvbktleShwcmltYXJ5SWQsIGNvdW50ZXJJZCk7XG4gICAgICBpZiAoY29ubmVjdGlvbkluZm9zLmhhcyhrZXkpKSB7XG4gICAgICAgIHJldHVybiB2b3dUb29scy5hc1ZvdyhcbiAgICAgICAgICAoKSA9PiBkZW5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvKFxuICAgICAgICAgICAgcHJpbWFyeUlkLFxuICAgICAgICAgICAgY291bnRlcklkLFxuICAgICAgICAgICAgY29ubmVjdGlvbkluZm9zLmdldChrZXkpXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGxvb2t1cENvbm5lY3Rpb25JbmZvKHByaW1hcnlJZCwgY291bnRlcklkKTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICBnZXRDaGFpbnNBbmRDb25uZWN0aW9uKHByaW1hcnlOYW1lLCBjb3VudGVyTmFtZSkge1xuICAgICAgcmV0dXJuIGxvb2t1cENoYWluc0FuZENvbm5lY3Rpb24ocHJpbWFyeU5hbWUsIGNvdW50ZXJOYW1lKTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgcmVnaXN0ZXJBc3NldChkZW5vbSwgZGV0YWlsKSB7XG4gICAgICBjb25zdCB7IGNoYWluTmFtZSwgYmFzZU5hbWUgfSA9IGRldGFpbDtcbiAgICAgIGNoYWluSW5mb3MuaGFzKGNoYWluTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBtdXN0IHJlZ2lzdGVyIGNoYWluICR7cXVvdGUoY2hhaW5OYW1lKX0gZmlyc3RgO1xuICAgICAgY2hhaW5JbmZvcy5oYXMoYmFzZU5hbWUpIHx8IHRocm93UmVkYWN0ZWRgbXVzdCByZWdpc3RlciBjaGFpbiAke3F1b3RlKGJhc2VOYW1lKX0gZmlyc3RgO1xuICAgICAgY29uc3QgZGVub21LZXkgPSBtYWtlRGVub21LZXkoZGVub20sIGRldGFpbC5jaGFpbk5hbWUpO1xuICAgICAgZGVub21EZXRhaWxzLmhhcyhkZW5vbUtleSkgJiYgdGhyb3dSZWRhY3RlZGBhbHJlYWR5IHJlZ2lzdGVyZWQgJHtxdW90ZShkZW5vbSl9IG9uICR7cXVvdGUoY2hhaW5OYW1lKX1gO1xuICAgICAgZGVub21EZXRhaWxzLmluaXQoZGVub21LZXksIGRldGFpbCk7XG4gICAgICBpZiAoZGV0YWlsLmJyYW5kKSB7XG4gICAgICAgIGNoYWluTmFtZSA9PT0gXCJhZ29yaWNcIiB8fCB0aHJvd1JlZGFjdGVkYGJyYW5kcyBvbmx5IHJlZ2lzdGVyYWJsZSBmb3IgYWdvcmljLWhlbGQgYXNzZXRzYDtcbiAgICAgICAgYnJhbmREZW5vbXMuaW5pdChkZXRhaWwuYnJhbmQsIGRlbm9tKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgdXBkYXRlQXNzZXQoZGVub20sIGRldGFpbCkge1xuICAgICAgY29uc3QgeyBiYXNlTmFtZSwgYnJhbmQsIGNoYWluTmFtZSB9ID0gZGV0YWlsO1xuICAgICAgY29uc3QgZGVub21LZXkgPSBtYWtlRGVub21LZXkoZGVub20sIGNoYWluTmFtZSk7XG4gICAgICBpZiAoIWRlbm9tRGV0YWlscy5oYXMoZGVub21LZXkpKSB7XG4gICAgICAgIHRocm93IG1ha2VFcnJvcihgQXNzZXQgJHtxdW90ZShkZW5vbSl9IG9uICR7cXVvdGUoY2hhaW5OYW1lKX0gbm90IHJlZ2lzdGVyZWRgKTtcbiAgICAgIH1cbiAgICAgIGlmICghY2hhaW5JbmZvcy5oYXMoY2hhaW5OYW1lKSkge1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoYENoYWluICR7cXVvdGUoY2hhaW5OYW1lKX0gbm90IHJlZ2lzdGVyZWRgKTtcbiAgICAgIH1cbiAgICAgIGlmICghY2hhaW5JbmZvcy5oYXMoYmFzZU5hbWUpKSB7XG4gICAgICAgIHRocm93IG1ha2VFcnJvcihgQ2hhaW4gJHtxdW90ZShiYXNlTmFtZSl9IG5vdCByZWdpc3RlcmVkYCk7XG4gICAgICB9XG4gICAgICBpZiAoYnJhbmQpIHtcbiAgICAgICAgaWYgKGNoYWluTmFtZSAhPT0gXCJhZ29yaWNcIikge1xuICAgICAgICAgIHRocm93IG1ha2VFcnJvcihcIkJyYW5kcyBvbmx5IHJlZ2lzdGVyYWJsZSBmb3IgYWdvcmljLWhlbGQgYXNzZXRzXCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zdCBvbGREZXRhaWwgPSBkZW5vbURldGFpbHMuZ2V0KGRlbm9tS2V5KTtcbiAgICAgIGlmIChvbGREZXRhaWwuYnJhbmQpIHtcbiAgICAgICAgYnJhbmREZW5vbXMuZGVsZXRlKG9sZERldGFpbC5icmFuZCk7XG4gICAgICB9XG4gICAgICBkZW5vbURldGFpbHMuc2V0KGRlbm9tS2V5LCBkZXRhaWwpO1xuICAgICAgaWYgKGJyYW5kKSB7XG4gICAgICAgIGJyYW5kRGVub21zLmluaXQoYnJhbmQsIGRlbm9tKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuICAgICAqL1xuICAgIGdldEFzc2V0KGRlbm9tLCBzcmNDaGFpbk5hbWUpIHtcbiAgICAgIGNvbnN0IGRlbm9tS2V5ID0gbWFrZURlbm9tS2V5KGRlbm9tLCBzcmNDaGFpbk5hbWUpO1xuICAgICAgaWYgKGRlbm9tRGV0YWlscy5oYXMoZGVub21LZXkpKSB7XG4gICAgICAgIHJldHVybiBkZW5vbURldGFpbHMuZ2V0KGRlbm9tS2V5KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgZ2V0RGVub20oYnJhbmQpIHtcbiAgICAgIGlmIChicmFuZERlbm9tcy5oYXMoYnJhbmQpKSB7XG4gICAgICAgIHJldHVybiBicmFuZERlbm9tcy5nZXQoYnJhbmQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICByZXNvbHZlQWNjb3VudElkKHBhcnRpYWxJZCkge1xuICAgICAgaWYgKHBhcnRpYWxJZC5zcGxpdChcIjpcIikubGVuZ3RoID09PSAzKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgcGFydGlhbElkXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjb25zdCBjb3Ntb3NDaGFpbklkID0gcmVzb2x2ZUNvc21vc0NoYWluSWQoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgcGFydGlhbElkXG4gICAgICApO1xuICAgICAgcmV0dXJuIGBjb3Ntb3M6JHtjb3Ntb3NDaGFpbklkfToke3BhcnRpYWxJZH1gO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICBjb2VyY2VDb3Ntb3NBZGRyZXNzKHBhcnRpYWxJZCkge1xuICAgICAgaWYgKHR5cGVvZiBwYXJ0aWFsSWQgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgcmV0dXJuIHBhcnRpYWxJZDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHBhcnRzID0gcGFydGlhbElkLnNwbGl0KFwiOlwiKTtcbiAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgYXNzZXJ0LmVxdWFsKHBhcnRzWzBdLCBcImNvc21vc1wiKTtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgICAgY2hhaW5JZDogcGFydHNbMV0sXG4gICAgICAgICAgZW5jb2Rpbmc6IFwiYmVjaDMyXCIsXG4gICAgICAgICAgdmFsdWU6IChcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHBhcnRzWzJdXG4gICAgICAgICAgKVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGFzc2VydC5lcXVhbChwYXJ0cy5sZW5ndGgsIDEpO1xuICAgICAgY29uc3QgdmFsdWUgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgcGFydGlhbElkXG4gICAgICApO1xuICAgICAgY29uc3QgY29zbW9zQ2hhaW5JZCA9IHJlc29sdmVDb3Ntb3NDaGFpbklkKHZhbHVlKTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBjaGFpbklkOiBjb3Ntb3NDaGFpbklkLFxuICAgICAgICB2YWx1ZSxcbiAgICAgICAgZW5jb2Rpbmc6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIFwiYmVjaDMyXCJcbiAgICAgICAgKVxuICAgICAgfSk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICBtYWtlVHJhbnNmZXJSb3V0ZShkZXN0aW5hdGlvbiwgZGVub21BbW91bnQsIHNyY0NoYWluTmFtZSwgZm9yd2FyZE9wdHMpIHtcbiAgICAgIGNoYWluSW5mb3MuaGFzKHNyY0NoYWluTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBjaGFpbiBpbmZvIG5vdCBmb3VuZCBmb3IgaG9sZGluZyBjaGFpbjogJHtxdW90ZShzcmNDaGFpbk5hbWUpfWA7XG4gICAgICBjb25zdCBkZW5vbURldGFpbCA9IGNoYWluSHViLmdldEFzc2V0KGRlbm9tQW1vdW50LmRlbm9tLCBzcmNDaGFpbk5hbWUpO1xuICAgICAgZGVub21EZXRhaWwgfHwgdGhyb3dSZWRhY3RlZGBubyBkZW5vbSBkZXRhaWwgZm9yOiAke3F1b3RlKGRlbm9tQW1vdW50LmRlbm9tKX0gb24gJHtxdW90ZShzcmNDaGFpbk5hbWUpfS4gZW5zdXJlIGl0IGlzIHJlZ2lzdGVyZWQgaW4gY2hhaW5IdWIuYDtcbiAgICAgIGNvbnN0IHsgYmFzZU5hbWUsIGNoYWluTmFtZSB9ID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBkZW5vbURldGFpbFxuICAgICAgKTtcbiAgICAgIGNoYWluTmFtZSA9PT0gc3JjQ2hhaW5OYW1lIHx8IHRocm93UmVkYWN0ZWRgY2Fubm90IHRyYW5zZmVyIGFzc2V0ICR7cXVvdGUoZGVub21BbW91bnQuZGVub20pfS4gaGVsZCBvbiAke3F1b3RlKGNoYWluTmFtZSl9IG5vdCAke3F1b3RlKHNyY0NoYWluTmFtZSl9LmA7XG4gICAgICBjaGFpbkluZm9zLmhhcyhiYXNlTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBjaGFpbiBpbmZvIG5vdCBmb3VuZCBmb3IgaXNzdWluZyBjaGFpbjogJHtxdW90ZShiYXNlTmFtZSl9YDtcbiAgICAgIGNvbnN0IGJhc2VDaGFpbkluZm8gPSBjaGFpbkluZm9zLmdldChiYXNlTmFtZSk7XG4gICAgICBpZiAoYmFzZUNoYWluSW5mby5uYW1lc3BhY2UgIT09IFwiY29zbW9zXCIpXG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgT25seSBjb3Ntb3Mgc3VwcG9ydGVkOyBnb3QgJHtxdW90ZShiYXNlQ2hhaW5JbmZvLm5hbWVzcGFjZSl9YDtcbiAgICAgIGNvbnN0IHsgY2hhaW5JZDogYmFzZUNoYWluSWQsIHBmbUVuYWJsZWQgfSA9IGJhc2VDaGFpbkluZm87XG4gICAgICBjb25zdCBob2xkaW5nQ2hhaW5JbmZvID0gY2hhaW5JbmZvcy5nZXQoc3JjQ2hhaW5OYW1lKTtcbiAgICAgIGlmIChob2xkaW5nQ2hhaW5JbmZvLm5hbWVzcGFjZSAhPT0gXCJjb3Ntb3NcIikge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYE9ubHkgY29zbW9zIHN1cHBvcnRlZDsgZ290ICR7cXVvdGUoaG9sZGluZ0NoYWluSW5mby5uYW1lc3BhY2UpfWA7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGNoYWluSWQ6IGhvbGRpbmdDaGFpbklkIH0gPSBob2xkaW5nQ2hhaW5JbmZvO1xuICAgICAgY29uc3QgY29zbW9zRGVzdCA9IGNoYWluSHViLmNvZXJjZUNvc21vc0FkZHJlc3MoZGVzdGluYXRpb24pO1xuICAgICAgaWYgKGJhc2VDaGFpbklkID09PSBjb3Ntb3NEZXN0LmNoYWluSWQgfHwgYmFzZU5hbWUgPT09IHNyY0NoYWluTmFtZSkge1xuICAgICAgICBjb25zdCBjb25uS2V5ID0gY29ubmVjdGlvbktleShob2xkaW5nQ2hhaW5JZCwgY29zbW9zRGVzdC5jaGFpbklkKTtcbiAgICAgICAgY29ubmVjdGlvbkluZm9zLmhhcyhjb25uS2V5KSB8fCB0aHJvd1JlZGFjdGVkYG5vIGNvbm5lY3Rpb24gaW5mbyBmb3VuZCBmb3IgJHtob2xkaW5nQ2hhaW5JZH08LT4ke2Nvc21vc0Rlc3QuY2hhaW5JZH1gO1xuICAgICAgICBjb25zdCB7IHRyYW5zZmVyQ2hhbm5lbCB9ID0gZGVub3JtYWxpemVDb25uZWN0aW9uSW5mbyhcbiAgICAgICAgICBob2xkaW5nQ2hhaW5JZCxcbiAgICAgICAgICAvL1xuICAgICAgICAgIGNvc21vc0Rlc3QuY2hhaW5JZCxcbiAgICAgICAgICAvL1xuICAgICAgICAgIGNvbm5lY3Rpb25JbmZvcy5nZXQoY29ubktleSlcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgICAgc291cmNlUG9ydDogdHJhbnNmZXJDaGFubmVsLnBvcnRJZCxcbiAgICAgICAgICBzb3VyY2VDaGFubmVsOiB0cmFuc2ZlckNoYW5uZWwuY2hhbm5lbElkLFxuICAgICAgICAgIHRva2VuOiB7XG4gICAgICAgICAgICBhbW91bnQ6IFN0cmluZyhkZW5vbUFtb3VudC52YWx1ZSksXG4gICAgICAgICAgICBkZW5vbTogZGVub21BbW91bnQuZGVub21cbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlY2VpdmVyOiBjb3Ntb3NEZXN0LnZhbHVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcGZtRW5hYmxlZCB8fCB0aHJvd1JlZGFjdGVkYHBmbSBub3QgZW5hYmxlZCBvbiBpc3N1aW5nIGNoYWluOiAke3F1b3RlKGJhc2VOYW1lKX1gO1xuICAgICAgY29uc3QgY3VyclRvSXNzdWVyS2V5ID0gY29ubmVjdGlvbktleShob2xkaW5nQ2hhaW5JZCwgYmFzZUNoYWluSWQpO1xuICAgICAgY29ubmVjdGlvbkluZm9zLmhhcyhjdXJyVG9Jc3N1ZXJLZXkpIHx8IHRocm93UmVkYWN0ZWRgbm8gY29ubmVjdGlvbiBpbmZvIGZvdW5kIGZvciAke2hvbGRpbmdDaGFpbklkfTwtPiR7YmFzZUNoYWluSWR9YDtcbiAgICAgIGNvbnN0IGlzc3VlclRvRGVzdEtleSA9IGNvbm5lY3Rpb25LZXkoYmFzZUNoYWluSWQsIGNvc21vc0Rlc3QuY2hhaW5JZCk7XG4gICAgICBjb25uZWN0aW9uSW5mb3MuaGFzKGlzc3VlclRvRGVzdEtleSkgfHwgdGhyb3dSZWRhY3RlZGBubyBjb25uZWN0aW9uIGluZm8gZm91bmQgZm9yICR7YmFzZUNoYWluSWR9PC0+JHtjb3Ntb3NEZXN0LmNoYWluSWR9YDtcbiAgICAgIGNvbnN0IGN1cnJUb0lzc3VlciA9IGRlbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oXG4gICAgICAgIGhvbGRpbmdDaGFpbklkLFxuICAgICAgICBiYXNlQ2hhaW5JZCxcbiAgICAgICAgY29ubmVjdGlvbkluZm9zLmdldChjdXJyVG9Jc3N1ZXJLZXkpXG4gICAgICApO1xuICAgICAgY29uc3QgaXNzdWVyVG9EZXN0ID0gZGVub3JtYWxpemVDb25uZWN0aW9uSW5mbyhcbiAgICAgICAgYmFzZUNoYWluSWQsXG4gICAgICAgIGNvc21vc0Rlc3QuY2hhaW5JZCxcbiAgICAgICAgY29ubmVjdGlvbkluZm9zLmdldChpc3N1ZXJUb0Rlc3RLZXkpXG4gICAgICApO1xuICAgICAgY29uc3QgeyBpbnRlcm1lZGlhdGVSZWNpcGllbnQsIC4uLnJlc3QgfSA9IGZvcndhcmRPcHRzID8/IHt9O1xuICAgICAgY29uc3QgZm9yd2FyZEluZm8gPSBoYXJkZW4oe1xuICAgICAgICBmb3J3YXJkOiB7XG4gICAgICAgICAgcmVjZWl2ZXI6IGNvc21vc0Rlc3QudmFsdWUsXG4gICAgICAgICAgcG9ydDogaXNzdWVyVG9EZXN0LnRyYW5zZmVyQ2hhbm5lbC5wb3J0SWQsXG4gICAgICAgICAgY2hhbm5lbDogaXNzdWVyVG9EZXN0LnRyYW5zZmVyQ2hhbm5lbC5jaGFubmVsSWQsXG4gICAgICAgICAgLi4uRGVmYXVsdFBmbVRpbWVvdXRPcHRzLFxuICAgICAgICAgIC4uLi8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgcmVzdFxuICAgICAgICAgIC8vXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgIHNvdXJjZVBvcnQ6IGN1cnJUb0lzc3Vlci50cmFuc2ZlckNoYW5uZWwucG9ydElkLFxuICAgICAgICBzb3VyY2VDaGFubmVsOiBjdXJyVG9Jc3N1ZXIudHJhbnNmZXJDaGFubmVsLmNoYW5uZWxJZCxcbiAgICAgICAgdG9rZW46IHtcbiAgICAgICAgICBhbW91bnQ6IFN0cmluZyhkZW5vbUFtb3VudC52YWx1ZSksXG4gICAgICAgICAgZGVub206IGRlbm9tQW1vdW50LmRlbm9tXG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgcmVjZWl2ZXI6IGludGVybWVkaWF0ZVJlY2lwaWVudD8udmFsdWUgfHwgUEZNX1JFQ0VJVkVSLFxuICAgICAgICBmb3J3YXJkSW5mb1xuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGNoYWluSHViO1xufTtcblxuLy9cbnZhciB0eXBlZEpzb24gPSAoZTIsIHQ1KSA9PiAoeyBcIkB0eXBlXCI6IGUyLCAuLi50NSB9KTtcbnZhciB0MyA9IC9eXFwvKD88c2VydmljZU5hbWU+XFx3Kyg/OlxcLlxcdyspKilcXC5RdWVyeSg/PG1ldGhvZE5hbWU+XFx3KylSZXF1ZXN0JC87XG52YXIgdHlwZVVybFRvR3JwY1BhdGggPSAoZTIpID0+IHtcbiAgY29uc3QgcjUgPSBlMi5tYXRjaCh0Myk7XG4gIGlmICghcjUgfHwgIXI1Lmdyb3VwcykgdGhyb3cgVHlwZUVycm9yKGBJbnZhbGlkIHR5cGVVcmw6ICR7ZTJ9LiBNdXN0IGJlIGEgUXVlcnkgUmVxdWVzdC5gKTtcbiAgY29uc3QgeyBzZXJ2aWNlTmFtZTogbzIsIG1ldGhvZE5hbWU6IHMzIH0gPSByNS5ncm91cHM7XG4gIHJldHVybiBgLyR7bzJ9LlF1ZXJ5LyR7czN9YDtcbn07XG52YXIgdG9SZXF1ZXN0UXVlcnlKc29uID0gKHQ1LCByNSA9IHt9KSA9PiBSZXF1ZXN0UXVlcnkudG9KU09OKFJlcXVlc3RRdWVyeS5mcm9tUGFydGlhbCh7IHBhdGg6IHR5cGVVcmxUb0dycGNQYXRoKHQ1LnR5cGVVcmwpLCBkYXRhOiB0NS52YWx1ZSwgLi4ucjUgfSkpO1xuXG4vL1xuZnVuY3Rpb24gcjIoKSB7XG4gIHJldHVybiB7IGZyb206IFwiXCIsIGFtb3VudDogXCJcIiwgZGVzdGluYXRpb25Eb21haW46IDAsIG1pbnRSZWNpcGllbnQ6IG5ldyBVaW50OEFycmF5KCksIGJ1cm5Ub2tlbjogXCJcIiB9O1xufVxudmFyIE1zZ0RlcG9zaXRGb3JCdXJuID0geyB0eXBlVXJsOiBcIi9jaXJjbGUuY2N0cC52MS5Nc2dEZXBvc2l0Rm9yQnVyblwiLCBlbmNvZGU6IChuMiwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBuMi5mcm9tICYmIGUyLnVpbnQzMigxMCkuc3RyaW5nKG4yLmZyb20pLCBcIlwiICE9PSBuMi5hbW91bnQgJiYgZTIudWludDMyKDE4KS5zdHJpbmcobjIuYW1vdW50KSwgMCAhPT0gbjIuZGVzdGluYXRpb25Eb21haW4gJiYgZTIudWludDMyKDI0KS51aW50MzIobjIuZGVzdGluYXRpb25Eb21haW4pLCAwICE9PSBuMi5taW50UmVjaXBpZW50Lmxlbmd0aCAmJiBlMi51aW50MzIoMzQpLmJ5dGVzKG4yLm1pbnRSZWNpcGllbnQpLCBcIlwiICE9PSBuMi5idXJuVG9rZW4gJiYgZTIudWludDMyKDQyKS5zdHJpbmcobjIuYnVyblRva2VuKSwgZTIpLCBkZWNvZGUodDUsIGUyKSB7XG4gIGNvbnN0IG8yID0gdDUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyB0NSA6IG5ldyBCaW5hcnlSZWFkZXIodDUpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IGUyID8gbzIubGVuIDogbzIucG9zICsgZTI7XG4gIGNvbnN0IHMzID0gcjIoKTtcbiAgZm9yICg7IG8yLnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCBuMiA9IG8yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobjIgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczMuZnJvbSA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgczMuYW1vdW50ID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBzMy5kZXN0aW5hdGlvbkRvbWFpbiA9IG8yLnVpbnQzMigpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgczMubWludFJlY2lwaWVudCA9IG8yLmJ5dGVzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA1OlxuICAgICAgICBzMy5idXJuVG9rZW4gPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgbjIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gczM7XG59LCBmcm9tSlNPTjogKG4yKSA9PiAoeyBmcm9tOiBpc1NldChuMi5mcm9tKSA/IFN0cmluZyhuMi5mcm9tKSA6IFwiXCIsIGFtb3VudDogaXNTZXQobjIuYW1vdW50KSA/IFN0cmluZyhuMi5hbW91bnQpIDogXCJcIiwgZGVzdGluYXRpb25Eb21haW46IGlzU2V0KG4yLmRlc3RpbmF0aW9uRG9tYWluKSA/IE51bWJlcihuMi5kZXN0aW5hdGlvbkRvbWFpbikgOiAwLCBtaW50UmVjaXBpZW50OiBpc1NldChuMi5taW50UmVjaXBpZW50KSA/IGRlY29kZUJhc2U2NChuMi5taW50UmVjaXBpZW50KSA6IG5ldyBVaW50OEFycmF5KCksIGJ1cm5Ub2tlbjogaXNTZXQobjIuYnVyblRva2VuKSA/IFN0cmluZyhuMi5idXJuVG9rZW4pIDogXCJcIiB9KSwgdG9KU09OKG4yKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG4yLmZyb20gJiYgKHQ1LmZyb20gPSBuMi5mcm9tKSwgdm9pZCAwICE9PSBuMi5hbW91bnQgJiYgKHQ1LmFtb3VudCA9IG4yLmFtb3VudCksIHZvaWQgMCAhPT0gbjIuZGVzdGluYXRpb25Eb21haW4gJiYgKHQ1LmRlc3RpbmF0aW9uRG9tYWluID0gTWF0aC5yb3VuZChuMi5kZXN0aW5hdGlvbkRvbWFpbikpLCB2b2lkIDAgIT09IG4yLm1pbnRSZWNpcGllbnQgJiYgKHQ1Lm1pbnRSZWNpcGllbnQgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSBuMi5taW50UmVjaXBpZW50ID8gbjIubWludFJlY2lwaWVudCA6IG5ldyBVaW50OEFycmF5KCkpKSwgdm9pZCAwICE9PSBuMi5idXJuVG9rZW4gJiYgKHQ1LmJ1cm5Ub2tlbiA9IG4yLmJ1cm5Ub2tlbiksIHQ1O1xufSwgZnJvbVBhcnRpYWwobjIpIHtcbiAgY29uc3QgdDUgPSByMigpO1xuICByZXR1cm4gdDUuZnJvbSA9IG4yLmZyb20gPz8gXCJcIiwgdDUuYW1vdW50ID0gbjIuYW1vdW50ID8/IFwiXCIsIHQ1LmRlc3RpbmF0aW9uRG9tYWluID0gbjIuZGVzdGluYXRpb25Eb21haW4gPz8gMCwgdDUubWludFJlY2lwaWVudCA9IG4yLm1pbnRSZWNpcGllbnQgPz8gbmV3IFVpbnQ4QXJyYXkoKSwgdDUuYnVyblRva2VuID0gbjIuYnVyblRva2VuID8/IFwiXCIsIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAobjIpID0+IE1zZ0RlcG9zaXRGb3JCdXJuLmRlY29kZShuMi52YWx1ZSksIHRvUHJvdG86IChuMikgPT4gTXNnRGVwb3NpdEZvckJ1cm4uZW5jb2RlKG4yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG4yKSA9PiAoeyB0eXBlVXJsOiBcIi9jaXJjbGUuY2N0cC52MS5Nc2dEZXBvc2l0Rm9yQnVyblwiLCB2YWx1ZTogTXNnRGVwb3NpdEZvckJ1cm4uZW5jb2RlKG4yKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gYSgpIHtcbiAgcmV0dXJuIHsgZnJvbTogXCJcIiwgYW1vdW50OiBcIlwiLCBkZXN0aW5hdGlvbkRvbWFpbjogMCwgbWludFJlY2lwaWVudDogbmV3IFVpbnQ4QXJyYXkoKSwgYnVyblRva2VuOiBcIlwiLCBkZXN0aW5hdGlvbkNhbGxlcjogbmV3IFVpbnQ4QXJyYXkoKSB9O1xufVxudmFyIE1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlciA9IHsgdHlwZVVybDogXCIvY2lyY2xlLmNjdHAudjEuTXNnRGVwb3NpdEZvckJ1cm5XaXRoQ2FsbGVyXCIsIGVuY29kZTogKG4yLCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG4yLmZyb20gJiYgZTIudWludDMyKDEwKS5zdHJpbmcobjIuZnJvbSksIFwiXCIgIT09IG4yLmFtb3VudCAmJiBlMi51aW50MzIoMTgpLnN0cmluZyhuMi5hbW91bnQpLCAwICE9PSBuMi5kZXN0aW5hdGlvbkRvbWFpbiAmJiBlMi51aW50MzIoMjQpLnVpbnQzMihuMi5kZXN0aW5hdGlvbkRvbWFpbiksIDAgIT09IG4yLm1pbnRSZWNpcGllbnQubGVuZ3RoICYmIGUyLnVpbnQzMigzNCkuYnl0ZXMobjIubWludFJlY2lwaWVudCksIFwiXCIgIT09IG4yLmJ1cm5Ub2tlbiAmJiBlMi51aW50MzIoNDIpLnN0cmluZyhuMi5idXJuVG9rZW4pLCAwICE9PSBuMi5kZXN0aW5hdGlvbkNhbGxlci5sZW5ndGggJiYgZTIudWludDMyKDUwKS5ieXRlcyhuMi5kZXN0aW5hdGlvbkNhbGxlciksIGUyKSwgZGVjb2RlKHQ1LCBlMikge1xuICBjb25zdCBvMiA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBlMiA/IG8yLmxlbiA6IG8yLnBvcyArIGUyO1xuICBjb25zdCByNSA9IGEoKTtcbiAgZm9yICg7IG8yLnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCBuMiA9IG8yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobjIgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjUuZnJvbSA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUuYW1vdW50ID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICByNS5kZXN0aW5hdGlvbkRvbWFpbiA9IG8yLnVpbnQzMigpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgcjUubWludFJlY2lwaWVudCA9IG8yLmJ5dGVzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA1OlxuICAgICAgICByNS5idXJuVG9rZW4gPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDY6XG4gICAgICAgIHI1LmRlc3RpbmF0aW9uQ2FsbGVyID0gbzIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgbjIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKG4yKSA9PiAoeyBmcm9tOiBpc1NldChuMi5mcm9tKSA/IFN0cmluZyhuMi5mcm9tKSA6IFwiXCIsIGFtb3VudDogaXNTZXQobjIuYW1vdW50KSA/IFN0cmluZyhuMi5hbW91bnQpIDogXCJcIiwgZGVzdGluYXRpb25Eb21haW46IGlzU2V0KG4yLmRlc3RpbmF0aW9uRG9tYWluKSA/IE51bWJlcihuMi5kZXN0aW5hdGlvbkRvbWFpbikgOiAwLCBtaW50UmVjaXBpZW50OiBpc1NldChuMi5taW50UmVjaXBpZW50KSA/IGRlY29kZUJhc2U2NChuMi5taW50UmVjaXBpZW50KSA6IG5ldyBVaW50OEFycmF5KCksIGJ1cm5Ub2tlbjogaXNTZXQobjIuYnVyblRva2VuKSA/IFN0cmluZyhuMi5idXJuVG9rZW4pIDogXCJcIiwgZGVzdGluYXRpb25DYWxsZXI6IGlzU2V0KG4yLmRlc3RpbmF0aW9uQ2FsbGVyKSA/IGRlY29kZUJhc2U2NChuMi5kZXN0aW5hdGlvbkNhbGxlcikgOiBuZXcgVWludDhBcnJheSgpIH0pLCB0b0pTT04objIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbjIuZnJvbSAmJiAodDUuZnJvbSA9IG4yLmZyb20pLCB2b2lkIDAgIT09IG4yLmFtb3VudCAmJiAodDUuYW1vdW50ID0gbjIuYW1vdW50KSwgdm9pZCAwICE9PSBuMi5kZXN0aW5hdGlvbkRvbWFpbiAmJiAodDUuZGVzdGluYXRpb25Eb21haW4gPSBNYXRoLnJvdW5kKG4yLmRlc3RpbmF0aW9uRG9tYWluKSksIHZvaWQgMCAhPT0gbjIubWludFJlY2lwaWVudCAmJiAodDUubWludFJlY2lwaWVudCA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IG4yLm1pbnRSZWNpcGllbnQgPyBuMi5taW50UmVjaXBpZW50IDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB2b2lkIDAgIT09IG4yLmJ1cm5Ub2tlbiAmJiAodDUuYnVyblRva2VuID0gbjIuYnVyblRva2VuKSwgdm9pZCAwICE9PSBuMi5kZXN0aW5hdGlvbkNhbGxlciAmJiAodDUuZGVzdGluYXRpb25DYWxsZXIgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSBuMi5kZXN0aW5hdGlvbkNhbGxlciA/IG4yLmRlc3RpbmF0aW9uQ2FsbGVyIDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG4yKSB7XG4gIGNvbnN0IHQ1ID0gYSgpO1xuICByZXR1cm4gdDUuZnJvbSA9IG4yLmZyb20gPz8gXCJcIiwgdDUuYW1vdW50ID0gbjIuYW1vdW50ID8/IFwiXCIsIHQ1LmRlc3RpbmF0aW9uRG9tYWluID0gbjIuZGVzdGluYXRpb25Eb21haW4gPz8gMCwgdDUubWludFJlY2lwaWVudCA9IG4yLm1pbnRSZWNpcGllbnQgPz8gbmV3IFVpbnQ4QXJyYXkoKSwgdDUuYnVyblRva2VuID0gbjIuYnVyblRva2VuID8/IFwiXCIsIHQ1LmRlc3RpbmF0aW9uQ2FsbGVyID0gbjIuZGVzdGluYXRpb25DYWxsZXIgPz8gbmV3IFVpbnQ4QXJyYXkoKSwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChuMikgPT4gTXNnRGVwb3NpdEZvckJ1cm5XaXRoQ2FsbGVyLmRlY29kZShuMi52YWx1ZSksIHRvUHJvdG86IChuMikgPT4gTXNnRGVwb3NpdEZvckJ1cm5XaXRoQ2FsbGVyLmVuY29kZShuMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChuMikgPT4gKHsgdHlwZVVybDogXCIvY2lyY2xlLmNjdHAudjEuTXNnRGVwb3NpdEZvckJ1cm5XaXRoQ2FsbGVyXCIsIHZhbHVlOiBNc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXIuZW5jb2RlKG4yKS5maW5pc2goKSB9KSB9O1xuXG4vL1xuZnVuY3Rpb24gcjMoKSB7XG4gIHJldHVybiB7IGtleTogbmV3IFVpbnQ4QXJyYXkoKSwgb2Zmc2V0OiBCaWdJbnQoMCksIGxpbWl0OiBCaWdJbnQoMCksIGNvdW50VG90YWw6IGZhbHNlLCByZXZlcnNlOiBmYWxzZSB9O1xufVxudmFyIFBhZ2VSZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS5xdWVyeS52MWJldGExLlBhZ2VSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKDAgIT09IGUyLmtleS5sZW5ndGggJiYgbzIudWludDMyKDEwKS5ieXRlcyhlMi5rZXkpLCBlMi5vZmZzZXQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoMTYpLnVpbnQ2NChlMi5vZmZzZXQpLCBlMi5saW1pdCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMigyNCkudWludDY0KGUyLmxpbWl0KSwgdHJ1ZSA9PT0gZTIuY291bnRUb3RhbCAmJiBvMi51aW50MzIoMzIpLmJvb2woZTIuY291bnRUb3RhbCksIHRydWUgPT09IGUyLnJldmVyc2UgJiYgbzIudWludDMyKDQwKS5ib29sKGUyLnJldmVyc2UpLCBvMiksIGRlY29kZSh0NSwgbzIpIHtcbiAgY29uc3QgbjIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gbzIgPyBuMi5sZW4gOiBuMi5wb3MgKyBvMjtcbiAgY29uc3QgczMgPSByMygpO1xuICBmb3IgKDsgbjIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUyID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzMy5rZXkgPSBuMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgczMub2Zmc2V0ID0gbjIudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBzMy5saW1pdCA9IG4yLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgczMuY291bnRUb3RhbCA9IG4yLmJvb2woKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDU6XG4gICAgICAgIHMzLnJldmVyc2UgPSBuMi5ib29sKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUyKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHMzO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsga2V5OiBpc1NldChlMi5rZXkpID8gZGVjb2RlQmFzZTY0KGUyLmtleSkgOiBuZXcgVWludDhBcnJheSgpLCBvZmZzZXQ6IGlzU2V0KGUyLm9mZnNldCkgPyBCaWdJbnQoZTIub2Zmc2V0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBsaW1pdDogaXNTZXQoZTIubGltaXQpID8gQmlnSW50KGUyLmxpbWl0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBjb3VudFRvdGFsOiAhIWlzU2V0KGUyLmNvdW50VG90YWwpICYmIEJvb2xlYW4oZTIuY291bnRUb3RhbCksIHJldmVyc2U6ICEhaXNTZXQoZTIucmV2ZXJzZSkgJiYgQm9vbGVhbihlMi5yZXZlcnNlKSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmtleSAmJiAodDUua2V5ID0gZW5jb2RlQmFzZTY0KHZvaWQgMCAhPT0gZTIua2V5ID8gZTIua2V5IDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB2b2lkIDAgIT09IGUyLm9mZnNldCAmJiAodDUub2Zmc2V0ID0gKGUyLm9mZnNldCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLmxpbWl0ICYmICh0NS5saW1pdCA9IChlMi5saW1pdCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLmNvdW50VG90YWwgJiYgKHQ1LmNvdW50VG90YWwgPSBlMi5jb3VudFRvdGFsKSwgdm9pZCAwICE9PSBlMi5yZXZlcnNlICYmICh0NS5yZXZlcnNlID0gZTIucmV2ZXJzZSksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSByMygpO1xuICByZXR1cm4gdDUua2V5ID0gZTIua2V5ID8/IG5ldyBVaW50OEFycmF5KCksIHQ1Lm9mZnNldCA9IHZvaWQgMCAhPT0gZTIub2Zmc2V0ICYmIG51bGwgIT09IGUyLm9mZnNldCA/IEJpZ0ludChlMi5vZmZzZXQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIHQ1LmxpbWl0ID0gdm9pZCAwICE9PSBlMi5saW1pdCAmJiBudWxsICE9PSBlMi5saW1pdCA/IEJpZ0ludChlMi5saW1pdC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgdDUuY291bnRUb3RhbCA9IGUyLmNvdW50VG90YWwgPz8gZmFsc2UsIHQ1LnJldmVyc2UgPSBlMi5yZXZlcnNlID8/IGZhbHNlLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBQYWdlUmVxdWVzdC5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFBhZ2VSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhc2UucXVlcnkudjFiZXRhMS5QYWdlUmVxdWVzdFwiLCB2YWx1ZTogUGFnZVJlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gczIoKSB7XG4gIHJldHVybiB7IG5leHRLZXk6IG5ldyBVaW50OEFycmF5KCksIHRvdGFsOiBCaWdJbnQoMCkgfTtcbn1cbnZhciBQYWdlUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnF1ZXJ5LnYxYmV0YTEuUGFnZVJlc3BvbnNlXCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKDAgIT09IGUyLm5leHRLZXkubGVuZ3RoICYmIG8yLnVpbnQzMigxMCkuYnl0ZXMoZTIubmV4dEtleSksIGUyLnRvdGFsICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDE2KS51aW50NjQoZTIudG90YWwpLCBvMiksIGRlY29kZSh0NSwgbzIpIHtcbiAgY29uc3QgbjIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gbzIgPyBuMi5sZW4gOiBuMi5wb3MgKyBvMjtcbiAgY29uc3QgcjUgPSBzMigpO1xuICBmb3IgKDsgbjIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUyID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5uZXh0S2V5ID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LnRvdGFsID0gbjIudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUyKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgbmV4dEtleTogaXNTZXQoZTIubmV4dEtleSkgPyBkZWNvZGVCYXNlNjQoZTIubmV4dEtleSkgOiBuZXcgVWludDhBcnJheSgpLCB0b3RhbDogaXNTZXQoZTIudG90YWwpID8gQmlnSW50KGUyLnRvdGFsLnRvU3RyaW5nKCkpIDogQmlnSW50KDApIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIubmV4dEtleSAmJiAodDUubmV4dEtleSA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IGUyLm5leHRLZXkgPyBlMi5uZXh0S2V5IDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB2b2lkIDAgIT09IGUyLnRvdGFsICYmICh0NS50b3RhbCA9IChlMi50b3RhbCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0gczIoKTtcbiAgcmV0dXJuIHQ1Lm5leHRLZXkgPSBlMi5uZXh0S2V5ID8/IG5ldyBVaW50OEFycmF5KCksIHQ1LnRvdGFsID0gdm9pZCAwICE9PSBlMi50b3RhbCAmJiBudWxsICE9PSBlMi50b3RhbCA/IEJpZ0ludChlMi50b3RhbC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUGFnZVJlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUGFnZVJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhc2UucXVlcnkudjFiZXRhMS5QYWdlUmVzcG9uc2VcIiwgdmFsdWU6IFBhZ2VSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgUXVlcnlCYWxhbmNlUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUJhbGFuY2VSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmFkZHJlc3MgJiYgbzIudWludDMyKDEwKS5zdHJpbmcoZTIuYWRkcmVzcyksIFwiXCIgIT09IGUyLmRlbm9tICYmIG8yLnVpbnQzMigxOCkuc3RyaW5nKGUyLmRlbm9tKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IG4yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgYTIgPSB2b2lkIDAgPT09IG8yID8gbjIubGVuIDogbjIucG9zICsgbzI7XG4gIGNvbnN0IHQ1ID0geyBhZGRyZXNzOiBcIlwiLCBkZW5vbTogXCJcIiB9O1xuICBmb3IgKDsgbjIucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IGUzID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICB0NS5hZGRyZXNzID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICB0NS5kZW5vbSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0NTtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGFkZHJlc3M6IGlzU2V0KGUyLmFkZHJlc3MpID8gU3RyaW5nKGUyLmFkZHJlc3MpIDogXCJcIiwgZGVub206IGlzU2V0KGUyLmRlbm9tKSA/IFN0cmluZyhlMi5kZW5vbSkgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuYWRkcmVzcyAmJiAobzIuYWRkcmVzcyA9IGUyLmFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmRlbm9tICYmIChvMi5kZW5vbSA9IGUyLmRlbm9tKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgYWRkcmVzczogXCJcIiwgZGVub206IFwiXCIgfTtcbiAgcmV0dXJuIG8yLmFkZHJlc3MgPSBlMi5hZGRyZXNzID8/IFwiXCIsIG8yLmRlbm9tID0gZTIuZGVub20gPz8gXCJcIiwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlCYWxhbmNlUmVxdWVzdC5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5QmFsYW5jZVJlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QmFsYW5jZVJlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5QmFsYW5jZVJlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5QmFsYW5jZVJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QmFsYW5jZVJlc3BvbnNlXCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiBDb2luLmVuY29kZShlMi5iYWxhbmNlLCBvMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBhMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHQ1ID0gdm9pZCAwID09PSBvMiA/IGEyLmxlbiA6IGEyLnBvcyArIG8yO1xuICBjb25zdCBzMyA9IHsgYmFsYW5jZTogdm9pZCAwIH07XG4gIGZvciAoOyBhMi5wb3MgPCB0NTsgKSB7XG4gICAgY29uc3QgZTMgPSBhMi51aW50MzIoKTtcbiAgICBpZiAoZTMgPj4+IDMgPT0gMSkgczMuYmFsYW5jZSA9IENvaW4uZGVjb2RlKGEyLCBhMi51aW50MzIoKSk7XG4gICAgZWxzZSBhMi5za2lwVHlwZSg3ICYgZTMpO1xuICB9XG4gIHJldHVybiBzMztcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGJhbGFuY2U6IGlzU2V0KGUyLmJhbGFuY2UpID8gQ29pbi5mcm9tSlNPTihlMi5iYWxhbmNlKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgKG8yLmJhbGFuY2UgPSBlMi5iYWxhbmNlID8gQ29pbi50b0pTT04oZTIuYmFsYW5jZSkgOiB2b2lkIDApLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0geyBiYWxhbmNlOiB2b2lkIDAgfTtcbiAgcmV0dXJuIG8yLmJhbGFuY2UgPSB2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgbnVsbCAhPT0gZTIuYmFsYW5jZSA/IENvaW4uZnJvbVBhcnRpYWwoZTIuYmFsYW5jZSkgOiB2b2lkIDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5QmFsYW5jZVJlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlCYWxhbmNlUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QmFsYW5jZVJlc3BvbnNlXCIsIHZhbHVlOiBRdWVyeUJhbGFuY2VSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3RcIiwgZW5jb2RlOiAobzIsIG4yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbzIuYWRkcmVzcyAmJiBuMi51aW50MzIoMTApLnN0cmluZyhvMi5hZGRyZXNzKSwgdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXF1ZXN0LmVuY29kZShvMi5wYWdpbmF0aW9uLCBuMi51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIG4yKSwgZGVjb2RlKG8yLCBuMikge1xuICBjb25zdCBhMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IHQ1ID0gdm9pZCAwID09PSBuMiA/IGEyLmxlbiA6IGEyLnBvcyArIG4yO1xuICBjb25zdCBzMyA9IHsgYWRkcmVzczogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyBhMi5wb3MgPCB0NTsgKSB7XG4gICAgY29uc3QgbzMgPSBhMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG8zID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHMzLmFkZHJlc3MgPSBhMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHMzLnBhZ2luYXRpb24gPSBQYWdlUmVxdWVzdC5kZWNvZGUoYTIsIGEyLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBhMi5za2lwVHlwZSg3ICYgbzMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gczM7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyBhZGRyZXNzOiBpc1NldChvMi5hZGRyZXNzKSA/IFN0cmluZyhvMi5hZGRyZXNzKSA6IFwiXCIsIHBhZ2luYXRpb246IGlzU2V0KG8yLnBhZ2luYXRpb24pID8gUGFnZVJlcXVlc3QuZnJvbUpTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBuMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5hZGRyZXNzICYmIChuMi5hZGRyZXNzID0gbzIuYWRkcmVzcyksIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiAobjIucGFnaW5hdGlvbiA9IG8yLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC50b0pTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDApLCBuMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IG4yID0geyBhZGRyZXNzOiBcIlwiLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIG4yLmFkZHJlc3MgPSBvMi5hZGRyZXNzID8/IFwiXCIsIG4yLnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXF1ZXN0LmZyb21QYXJ0aWFsKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwLCBuMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeUFsbEJhbGFuY2VzUmVxdWVzdC5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUFsbEJhbGFuY2VzUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5QWxsQmFsYW5jZXNSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUFsbEJhbGFuY2VzUmVzcG9uc2VcIiwgZW5jb2RlKGUyLCBhMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IG8yIG9mIGUyLmJhbGFuY2VzKSBDb2luLmVuY29kZShvMiwgYTIudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXNwb25zZS5lbmNvZGUoZTIucGFnaW5hdGlvbiwgYTIudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCBhMjtcbn0sIGRlY29kZShlMiwgYTIpIHtcbiAgY29uc3QgdDUgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBzMyA9IHZvaWQgMCA9PT0gYTIgPyB0NS5sZW4gOiB0NS5wb3MgKyBhMjtcbiAgY29uc3QgcjUgPSB7IGJhbGFuY2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyB0NS5wb3MgPCBzMzsgKSB7XG4gICAgY29uc3QgZTMgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LmJhbGFuY2VzLnB1c2goQ29pbi5kZWNvZGUodDUsIHQ1LnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNS5wYWdpbmF0aW9uID0gUGFnZVJlc3BvbnNlLmRlY29kZSh0NSwgdDUudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHQ1LnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGJhbGFuY2VzOiBBcnJheS5pc0FycmF5KGUyPy5iYWxhbmNlcykgPyBlMi5iYWxhbmNlcy5tYXAoKGUzKSA9PiBDb2luLmZyb21KU09OKGUzKSkgOiBbXSwgcGFnaW5hdGlvbjogaXNTZXQoZTIucGFnaW5hdGlvbikgPyBQYWdlUmVzcG9uc2UuZnJvbUpTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBhMiA9IHt9O1xuICByZXR1cm4gZTIuYmFsYW5jZXMgPyBhMi5iYWxhbmNlcyA9IGUyLmJhbGFuY2VzLm1hcCgoZTMpID0+IGUzID8gQ29pbi50b0pTT04oZTMpIDogdm9pZCAwKSA6IGEyLmJhbGFuY2VzID0gW10sIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiAoYTIucGFnaW5hdGlvbiA9IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVzcG9uc2UudG9KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgYTI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBhMiA9IHsgYmFsYW5jZXM6IFtdLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIGEyLmJhbGFuY2VzID0gZTIuYmFsYW5jZXM/Lm1hcCgoZTMpID0+IENvaW4uZnJvbVBhcnRpYWwoZTMpKSB8fCBbXSwgYTIucGFnaW5hdGlvbiA9IHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiBudWxsICE9PSBlMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLmZyb21QYXJ0aWFsKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwLCBhMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeUFsbEJhbGFuY2VzUmVzcG9uc2UuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeUFsbEJhbGFuY2VzUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QWxsQmFsYW5jZXNSZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBNc2dTZW5kID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLk1zZ1NlbmRcIiwgZW5jb2RlKG8yLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBcIlwiICE9PSBvMi5mcm9tQWRkcmVzcyAmJiB0NS51aW50MzIoMTApLnN0cmluZyhvMi5mcm9tQWRkcmVzcyksIFwiXCIgIT09IG8yLnRvQWRkcmVzcyAmJiB0NS51aW50MzIoMTgpLnN0cmluZyhvMi50b0FkZHJlc3MpO1xuICBmb3IgKGNvbnN0IHMzIG9mIG8yLmFtb3VudCkgQ29pbi5lbmNvZGUoczMsIHQ1LnVpbnQzMigyNikuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHQ1O1xufSwgZGVjb2RlKG8yLCB0NSkge1xuICBjb25zdCBzMyA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSB0NSA/IHMzLmxlbiA6IHMzLnBvcyArIHQ1O1xuICBjb25zdCBhMiA9IHsgZnJvbUFkZHJlc3M6IFwiXCIsIHRvQWRkcmVzczogXCJcIiwgYW1vdW50OiBbXSB9O1xuICBmb3IgKDsgczMucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IG8zID0gczMudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBhMi5mcm9tQWRkcmVzcyA9IHMzLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgYTIudG9BZGRyZXNzID0gczMuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBhMi5hbW91bnQucHVzaChDb2luLmRlY29kZShzMywgczMudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBzMy5za2lwVHlwZSg3ICYgbzMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyBmcm9tQWRkcmVzczogaXNTZXQobzIuZnJvbUFkZHJlc3MpID8gU3RyaW5nKG8yLmZyb21BZGRyZXNzKSA6IFwiXCIsIHRvQWRkcmVzczogaXNTZXQobzIudG9BZGRyZXNzKSA/IFN0cmluZyhvMi50b0FkZHJlc3MpIDogXCJcIiwgYW1vdW50OiBBcnJheS5pc0FycmF5KG8yPy5hbW91bnQpID8gbzIuYW1vdW50Lm1hcCgobzMpID0+IENvaW4uZnJvbUpTT04obzMpKSA6IFtdIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZnJvbUFkZHJlc3MgJiYgKHQ1LmZyb21BZGRyZXNzID0gbzIuZnJvbUFkZHJlc3MpLCB2b2lkIDAgIT09IG8yLnRvQWRkcmVzcyAmJiAodDUudG9BZGRyZXNzID0gbzIudG9BZGRyZXNzKSwgbzIuYW1vdW50ID8gdDUuYW1vdW50ID0gbzIuYW1vdW50Lm1hcCgobzMpID0+IG8zID8gQ29pbi50b0pTT04obzMpIDogdm9pZCAwKSA6IHQ1LmFtb3VudCA9IFtdLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyBmcm9tQWRkcmVzczogXCJcIiwgdG9BZGRyZXNzOiBcIlwiLCBhbW91bnQ6IFtdIH07XG4gIHJldHVybiB0NS5mcm9tQWRkcmVzcyA9IG8yLmZyb21BZGRyZXNzID8/IFwiXCIsIHQ1LnRvQWRkcmVzcyA9IG8yLnRvQWRkcmVzcyA/PyBcIlwiLCB0NS5hbW91bnQgPSBvMi5hbW91bnQ/Lm1hcCgobzMpID0+IENvaW4uZnJvbVBhcnRpYWwobzMpKSB8fCBbXSwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gTXNnU2VuZC5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IE1zZ1NlbmQuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLk1zZ1NlbmRcIiwgdmFsdWU6IE1zZ1NlbmQuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5EZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkXCIsIGVuY29kZSh0NSwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgXCJcIiAhPT0gdDUudmFsaWRhdG9yQWRkcmVzcyAmJiBlMi51aW50MzIoMTApLnN0cmluZyh0NS52YWxpZGF0b3JBZGRyZXNzKTtcbiAgZm9yIChjb25zdCByNSBvZiB0NS5yZXdhcmQpIERlY0NvaW4uZW5jb2RlKHI1LCBlMi51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiBlMjtcbn0sIGRlY29kZSh0NSwgcjUpIHtcbiAgY29uc3QgaTIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gcjUgPyBpMi5sZW4gOiBpMi5wb3MgKyByNTtcbiAgY29uc3QgYTIgPSB7IHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIHJld2FyZDogW10gfTtcbiAgZm9yICg7IGkyLnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCB0NiA9IGkyLnVpbnQzMigpO1xuICAgIHN3aXRjaCAodDYgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgYTIudmFsaWRhdG9yQWRkcmVzcyA9IGkyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgYTIucmV3YXJkLnB1c2goRGVjQ29pbi5kZWNvZGUoaTIsIGkyLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgaTIuc2tpcFR5cGUoNyAmIHQ2KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGEyO1xufSwgZnJvbUpTT046ICh0NSkgPT4gKHsgdmFsaWRhdG9yQWRkcmVzczogaXNTZXQodDUudmFsaWRhdG9yQWRkcmVzcykgPyBTdHJpbmcodDUudmFsaWRhdG9yQWRkcmVzcykgOiBcIlwiLCByZXdhcmQ6IEFycmF5LmlzQXJyYXkodDU/LnJld2FyZCkgPyB0NS5yZXdhcmQubWFwKCh0NikgPT4gRGVjQ29pbi5mcm9tSlNPTih0NikpIDogW10gfSksIHRvSlNPTih0NSkge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSB0NS52YWxpZGF0b3JBZGRyZXNzICYmIChlMi52YWxpZGF0b3JBZGRyZXNzID0gdDUudmFsaWRhdG9yQWRkcmVzcyksIHQ1LnJld2FyZCA/IGUyLnJld2FyZCA9IHQ1LnJld2FyZC5tYXAoKHQ2KSA9PiB0NiA/IERlY0NvaW4udG9KU09OKHQ2KSA6IHZvaWQgMCkgOiBlMi5yZXdhcmQgPSBbXSwgZTI7XG59LCBmcm9tUGFydGlhbCh0NSkge1xuICBjb25zdCBlMiA9IHsgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgcmV3YXJkOiBbXSB9O1xuICByZXR1cm4gZTIudmFsaWRhdG9yQWRkcmVzcyA9IHQ1LnZhbGlkYXRvckFkZHJlc3MgPz8gXCJcIiwgZTIucmV3YXJkID0gdDUucmV3YXJkPy5tYXAoKHQ2KSA9PiBEZWNDb2luLmZyb21QYXJ0aWFsKHQ2KSkgfHwgW10sIGUyO1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLkRlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmRcIiwgdmFsdWU6IERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1JlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgXCJcIiAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTgpLnN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHMzID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgcjUgPSB2b2lkIDAgPT09IG8yID8gczMubGVuIDogczMucG9zICsgbzI7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiIH07XG4gIGZvciAoOyBzMy5wb3MgPCByNTsgKSB7XG4gICAgY29uc3QgZTMgPSBzMy51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHQ1LmRlbGVnYXRvckFkZHJlc3MgPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHQ1LnZhbGlkYXRvckFkZHJlc3MgPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBzMy5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdDU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpIDogXCJcIiB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIChvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIgfTtcbiAgcmV0dXJuIG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzID8/IFwiXCIsIG8yLnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzID8/IFwiXCIsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0LmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1JlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2VcIiwgZW5jb2RlKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IHMzIG9mIGUyLnJld2FyZHMpIERlY0NvaW4uZW5jb2RlKHMzLCBvMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiBvMjtcbn0sIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgczMgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCByNSA9IHZvaWQgMCA9PT0gbzIgPyBzMy5sZW4gOiBzMy5wb3MgKyBvMjtcbiAgY29uc3QgdDUgPSB7IHJld2FyZHM6IFtdIH07XG4gIGZvciAoOyBzMy5wb3MgPCByNTsgKSB7XG4gICAgY29uc3QgZTMgPSBzMy51aW50MzIoKTtcbiAgICBpZiAoZTMgPj4+IDMgPT0gMSkgdDUucmV3YXJkcy5wdXNoKERlY0NvaW4uZGVjb2RlKHMzLCBzMy51aW50MzIoKSkpO1xuICAgIGVsc2UgczMuc2tpcFR5cGUoNyAmIGUzKTtcbiAgfVxuICByZXR1cm4gdDU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyByZXdhcmRzOiBBcnJheS5pc0FycmF5KGUyPy5yZXdhcmRzKSA/IGUyLnJld2FyZHMubWFwKChlMykgPT4gRGVjQ29pbi5mcm9tSlNPTihlMykpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gZTIucmV3YXJkcyA/IG8yLnJld2FyZHMgPSBlMi5yZXdhcmRzLm1hcCgoZTMpID0+IGUzID8gRGVjQ29pbi50b0pTT04oZTMpIDogdm9pZCAwKSA6IG8yLnJld2FyZHMgPSBbXSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgcmV3YXJkczogW10gfTtcbiAgcmV0dXJuIG8yLnJld2FyZHMgPSBlMi5yZXdhcmRzPy5tYXAoKGUzKSA9PiBEZWNDb2luLmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1JlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHMzID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgcjUgPSB2b2lkIDAgPT09IG8yID8gczMubGVuIDogczMucG9zICsgbzI7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiIH07XG4gIGZvciAoOyBzMy5wb3MgPCByNTsgKSB7XG4gICAgY29uc3QgZTMgPSBzMy51aW50MzIoKTtcbiAgICBpZiAoZTMgPj4+IDMgPT0gMSkgdDUuZGVsZWdhdG9yQWRkcmVzcyA9IHMzLnN0cmluZygpO1xuICAgIGVsc2UgczMuc2tpcFR5cGUoNyAmIGUzKTtcbiAgfVxuICByZXR1cm4gdDU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIChvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIgfTtcbiAgcmV0dXJuIG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzID8/IFwiXCIsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1JlcXVlc3QuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1JlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1Jlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVzcG9uc2VcIiwgZW5jb2RlKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IHMzIG9mIGUyLnJld2FyZHMpIERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQuZW5jb2RlKHMzLCBvMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIGZvciAoY29uc3QgczMgb2YgZTIudG90YWwpIERlY0NvaW4uZW5jb2RlKHMzLCBvMi51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiBvMjtcbn0sIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgczMgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCByNSA9IHZvaWQgMCA9PT0gbzIgPyBzMy5sZW4gOiBzMy5wb3MgKyBvMjtcbiAgY29uc3QgdDUgPSB7IHJld2FyZHM6IFtdLCB0b3RhbDogW10gfTtcbiAgZm9yICg7IHMzLnBvcyA8IHI1OyApIHtcbiAgICBjb25zdCBlMyA9IHMzLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgdDUucmV3YXJkcy5wdXNoKERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQuZGVjb2RlKHMzLCBzMy51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgdDUudG90YWwucHVzaChEZWNDb2luLmRlY29kZShzMywgczMudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBzMy5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdDU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyByZXdhcmRzOiBBcnJheS5pc0FycmF5KGUyPy5yZXdhcmRzKSA/IGUyLnJld2FyZHMubWFwKChlMykgPT4gRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZC5mcm9tSlNPTihlMykpIDogW10sIHRvdGFsOiBBcnJheS5pc0FycmF5KGUyPy50b3RhbCkgPyBlMi50b3RhbC5tYXAoKGUzKSA9PiBEZWNDb2luLmZyb21KU09OKGUzKSkgOiBbXSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiBlMi5yZXdhcmRzID8gbzIucmV3YXJkcyA9IGUyLnJld2FyZHMubWFwKChlMykgPT4gZTMgPyBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLnRvSlNPTihlMykgOiB2b2lkIDApIDogbzIucmV3YXJkcyA9IFtdLCBlMi50b3RhbCA/IG8yLnRvdGFsID0gZTIudG90YWwubWFwKChlMykgPT4gZTMgPyBEZWNDb2luLnRvSlNPTihlMykgOiB2b2lkIDApIDogbzIudG90YWwgPSBbXSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgcmV3YXJkczogW10sIHRvdGFsOiBbXSB9O1xuICByZXR1cm4gbzIucmV3YXJkcyA9IGUyLnJld2FyZHM/Lm1hcCgoZTMpID0+IERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQuZnJvbVBhcnRpYWwoZTMpKSB8fCBbXSwgbzIudG90YWwgPSBlMi50b3RhbD8ubWFwKChlMykgPT4gRGVjQ29pbi5mcm9tUGFydGlhbChlMykpIHx8IFtdLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1Jlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1Jlc3BvbnNlXCIsIHZhbHVlOiBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmQgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5Nc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFwiLCBlbmNvZGU6IChvMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5kZWxlZ2F0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxMCkuc3RyaW5nKG8yLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBvMi52YWxpZGF0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxOCkuc3RyaW5nKG8yLnZhbGlkYXRvckFkZHJlc3MpLCB0NSksIGRlY29kZShvMiwgdDUpIHtcbiAgY29uc3QgczMgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCByNSA9IHZvaWQgMCA9PT0gdDUgPyBzMy5sZW4gOiBzMy5wb3MgKyB0NTtcbiAgY29uc3QgZCA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiB9O1xuICBmb3IgKDsgczMucG9zIDwgcjU7ICkge1xuICAgIGNvbnN0IG8zID0gczMudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBkLmRlbGVnYXRvckFkZHJlc3MgPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGQudmFsaWRhdG9yQWRkcmVzcyA9IHMzLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHMzLnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBkO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQobzIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcobzIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldChvMi52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyhvMi52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZWxlZ2F0b3JBZGRyZXNzICYmICh0NS5kZWxlZ2F0b3JBZGRyZXNzID0gbzIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gbzIudmFsaWRhdG9yQWRkcmVzcyAmJiAodDUudmFsaWRhdG9yQWRkcmVzcyA9IG8yLnZhbGlkYXRvckFkZHJlc3MpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyZXNzID0gbzIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCB0NS52YWxpZGF0b3JBZGRyZXNzID0gbzIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLk1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkXCIsIHZhbHVlOiBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLk1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2VcIiwgZW5jb2RlKHQ1LCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IHMzIG9mIHQ1LmFtb3VudCkgQ29pbi5lbmNvZGUoczMsIGUyLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIGUyO1xufSwgZGVjb2RlKHQ1LCBzMykge1xuICBjb25zdCByNSA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IGQgPSB2b2lkIDAgPT09IHMzID8gcjUubGVuIDogcjUucG9zICsgczM7XG4gIGNvbnN0IGkyID0geyBhbW91bnQ6IFtdIH07XG4gIGZvciAoOyByNS5wb3MgPCBkOyApIHtcbiAgICBjb25zdCB0NiA9IHI1LnVpbnQzMigpO1xuICAgIGlmICh0NiA+Pj4gMyA9PSAxKSBpMi5hbW91bnQucHVzaChDb2luLmRlY29kZShyNSwgcjUudWludDMyKCkpKTtcbiAgICBlbHNlIHI1LnNraXBUeXBlKDcgJiB0Nik7XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046ICh0NSkgPT4gKHsgYW1vdW50OiBBcnJheS5pc0FycmF5KHQ1Py5hbW91bnQpID8gdDUuYW1vdW50Lm1hcCgodDYpID0+IENvaW4uZnJvbUpTT04odDYpKSA6IFtdIH0pLCB0b0pTT04odDUpIHtcbiAgY29uc3QgZTIgPSB7fTtcbiAgcmV0dXJuIHQ1LmFtb3VudCA/IGUyLmFtb3VudCA9IHQ1LmFtb3VudC5tYXAoKHQ2KSA9PiB0NiA/IENvaW4udG9KU09OKHQ2KSA6IHZvaWQgMCkgOiBlMi5hbW91bnQgPSBbXSwgZTI7XG59LCBmcm9tUGFydGlhbCh0NSkge1xuICBjb25zdCBlMiA9IHsgYW1vdW50OiBbXSB9O1xuICByZXR1cm4gZTIuYW1vdW50ID0gdDUuYW1vdW50Py5tYXAoKHQ2KSA9PiBDb2luLmZyb21QYXJ0aWFsKHQ2KSkgfHwgW10sIGUyO1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2UuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLk1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2VcIiwgdmFsdWU6IE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIEJvbmRTdGF0dXM7XG4hZnVuY3Rpb24oZTIpIHtcbiAgZTJbZTIuQk9ORF9TVEFUVVNfVU5TUEVDSUZJRUQgPSAwXSA9IFwiQk9ORF9TVEFUVVNfVU5TUEVDSUZJRURcIiwgZTJbZTIuQk9ORF9TVEFUVVNfVU5CT05ERUQgPSAxXSA9IFwiQk9ORF9TVEFUVVNfVU5CT05ERURcIiwgZTJbZTIuQk9ORF9TVEFUVVNfVU5CT05ESU5HID0gMl0gPSBcIkJPTkRfU1RBVFVTX1VOQk9ORElOR1wiLCBlMltlMi5CT05EX1NUQVRVU19CT05ERUQgPSAzXSA9IFwiQk9ORF9TVEFUVVNfQk9OREVEXCIsIGUyW2UyLlVOUkVDT0dOSVpFRCA9IC0xXSA9IFwiVU5SRUNPR05JWkVEXCI7XG59KEJvbmRTdGF0dXMgfHwgKEJvbmRTdGF0dXMgPSB7fSkpO1xudmFyIEluZnJhY3Rpb247XG4hZnVuY3Rpb24oZTIpIHtcbiAgZTJbZTIuSU5GUkFDVElPTl9VTlNQRUNJRklFRCA9IDBdID0gXCJJTkZSQUNUSU9OX1VOU1BFQ0lGSUVEXCIsIGUyW2UyLklORlJBQ1RJT05fRE9VQkxFX1NJR04gPSAxXSA9IFwiSU5GUkFDVElPTl9ET1VCTEVfU0lHTlwiLCBlMltlMi5JTkZSQUNUSU9OX0RPV05USU1FID0gMl0gPSBcIklORlJBQ1RJT05fRE9XTlRJTUVcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0oSW5mcmFjdGlvbiB8fCAoSW5mcmFjdGlvbiA9IHt9KSk7XG52YXIgRGVsZWdhdGlvbiA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5EZWxlZ2F0aW9uXCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgdDUudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcyksIFwiXCIgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcyksIFwiXCIgIT09IGUyLnNoYXJlcyAmJiB0NS51aW50MzIoMjYpLnN0cmluZyhEZWNpbWFsLmZyb21Vc2VySW5wdXQoZTIuc2hhcmVzLCAxOCkuYXRvbWljcyksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBvMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSB0NSA/IG8yLmxlbiA6IG8yLnBvcyArIHQ1O1xuICBjb25zdCBpMiA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgc2hhcmVzOiBcIlwiIH07XG4gIGZvciAoOyBvMi5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTMgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRlbGVnYXRvckFkZHJlc3MgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkyLnZhbGlkYXRvckFkZHJlc3MgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGkyLnNoYXJlcyA9IERlY2ltYWwuZnJvbUF0b21pY3MobzIuc3RyaW5nKCksIDE4KS50b1N0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcykgOiBcIlwiLCBzaGFyZXM6IGlzU2V0KGUyLnNoYXJlcykgPyBTdHJpbmcoZTIuc2hhcmVzKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmICh0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiAodDUudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnNoYXJlcyAmJiAodDUuc2hhcmVzID0gZTIuc2hhcmVzKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgc2hhcmVzOiBcIlwiIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCB0NS52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCB0NS5zaGFyZXMgPSBlMi5zaGFyZXMgPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gRGVsZWdhdGlvbi5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IERlbGVnYXRpb24uZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLkRlbGVnYXRpb25cIiwgdmFsdWU6IERlbGVnYXRpb24uZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFVuYm9uZGluZ0RlbGVnYXRpb24gPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuVW5ib25kaW5nRGVsZWdhdGlvblwiLCBlbmNvZGUoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgdDUudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcyksIFwiXCIgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcyk7XG4gIGZvciAoY29uc3QgbzIgb2YgZTIuZW50cmllcykgVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LmVuY29kZShvMiwgdDUudWludDMyKDI2KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdDU7XG59LCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IGkyID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiLCBlbnRyaWVzOiBbXSB9O1xuICBmb3IgKDsgbzIucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5kZWxlZ2F0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMi52YWxpZGF0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBpMi5lbnRyaWVzLnB1c2goVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LmRlY29kZShvMiwgbzIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpIDogXCJcIiwgZW50cmllczogQXJyYXkuaXNBcnJheShlMj8uZW50cmllcykgPyBlMi5lbnRyaWVzLm1hcCgoZTMpID0+IFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5mcm9tSlNPTihlMykpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmICh0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiAodDUudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MpLCBlMi5lbnRyaWVzID8gdDUuZW50cmllcyA9IGUyLmVudHJpZXMubWFwKChlMykgPT4gZTMgPyBVbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnkudG9KU09OKGUzKSA6IHZvaWQgMCkgOiB0NS5lbnRyaWVzID0gW10sIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIGVudHJpZXM6IFtdIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCB0NS52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCB0NS5lbnRyaWVzID0gZTIuZW50cmllcz8ubWFwKChlMykgPT4gVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFVuYm9uZGluZ0RlbGVnYXRpb24uZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5VbmJvbmRpbmdEZWxlZ2F0aW9uXCIsIHZhbHVlOiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIGYoKSB7XG4gIHJldHVybiB7IGNyZWF0aW9uSGVpZ2h0OiBCaWdJbnQoMCksIGNvbXBsZXRpb25UaW1lOiBUaW1lc3RhbXAuZnJvbVBhcnRpYWwoe30pLCBpbml0aWFsQmFsYW5jZTogXCJcIiwgYmFsYW5jZTogXCJcIiwgdW5ib25kaW5nSWQ6IEJpZ0ludCgwKSwgdW5ib25kaW5nT25Ib2xkUmVmQ291bnQ6IEJpZ0ludCgwKSB9O1xufVxudmFyIFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5VbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnlcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoZTIuY3JlYXRpb25IZWlnaHQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoOCkuaW50NjQoZTIuY3JlYXRpb25IZWlnaHQpLCB2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmIFRpbWVzdGFtcC5lbmNvZGUoZTIuY29tcGxldGlvblRpbWUsIG8yLnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgXCJcIiAhPT0gZTIuaW5pdGlhbEJhbGFuY2UgJiYgbzIudWludDMyKDI2KS5zdHJpbmcoZTIuaW5pdGlhbEJhbGFuY2UpLCBcIlwiICE9PSBlMi5iYWxhbmNlICYmIG8yLnVpbnQzMigzNCkuc3RyaW5nKGUyLmJhbGFuY2UpLCBlMi51bmJvbmRpbmdJZCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMig0MCkudWludDY0KGUyLnVuYm9uZGluZ0lkKSwgZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoNDgpLmludDY0KGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50KSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IG4yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IG8yID8gbjIubGVuIDogbjIucG9zICsgbzI7XG4gIGNvbnN0IHMzID0gZigpO1xuICBmb3IgKDsgbjIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUzID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzMy5jcmVhdGlvbkhlaWdodCA9IG4yLmludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBzMy5jb21wbGV0aW9uVGltZSA9IFRpbWVzdGFtcC5kZWNvZGUobjIsIG4yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHMzLmluaXRpYWxCYWxhbmNlID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBzMy5iYWxhbmNlID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA1OlxuICAgICAgICBzMy51bmJvbmRpbmdJZCA9IG4yLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNjpcbiAgICAgICAgczMudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMztcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGNyZWF0aW9uSGVpZ2h0OiBpc1NldChlMi5jcmVhdGlvbkhlaWdodCkgPyBCaWdJbnQoZTIuY3JlYXRpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGNvbXBsZXRpb25UaW1lOiBpc1NldChlMi5jb21wbGV0aW9uVGltZSkgPyBmcm9tSnNvblRpbWVzdGFtcChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIGluaXRpYWxCYWxhbmNlOiBpc1NldChlMi5pbml0aWFsQmFsYW5jZSkgPyBTdHJpbmcoZTIuaW5pdGlhbEJhbGFuY2UpIDogXCJcIiwgYmFsYW5jZTogaXNTZXQoZTIuYmFsYW5jZSkgPyBTdHJpbmcoZTIuYmFsYW5jZSkgOiBcIlwiLCB1bmJvbmRpbmdJZDogaXNTZXQoZTIudW5ib25kaW5nSWQpID8gQmlnSW50KGUyLnVuYm9uZGluZ0lkLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB1bmJvbmRpbmdPbkhvbGRSZWZDb3VudDogaXNTZXQoZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQpID8gQmlnSW50KGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50LnRvU3RyaW5nKCkpIDogQmlnSW50KDApIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgJiYgKHQ1LmNyZWF0aW9uSGVpZ2h0ID0gKGUyLmNyZWF0aW9uSGVpZ2h0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuY29tcGxldGlvblRpbWUgJiYgKHQ1LmNvbXBsZXRpb25UaW1lID0gZnJvbVRpbWVzdGFtcChlMi5jb21wbGV0aW9uVGltZSkudG9JU09TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuaW5pdGlhbEJhbGFuY2UgJiYgKHQ1LmluaXRpYWxCYWxhbmNlID0gZTIuaW5pdGlhbEJhbGFuY2UpLCB2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgKHQ1LmJhbGFuY2UgPSBlMi5iYWxhbmNlKSwgdm9pZCAwICE9PSBlMi51bmJvbmRpbmdJZCAmJiAodDUudW5ib25kaW5nSWQgPSAoZTIudW5ib25kaW5nSWQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCAmJiAodDUudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgPSAoZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IGYoKTtcbiAgcmV0dXJuIG8yLmNyZWF0aW9uSGVpZ2h0ID0gdm9pZCAwICE9PSBlMi5jcmVhdGlvbkhlaWdodCAmJiBudWxsICE9PSBlMi5jcmVhdGlvbkhlaWdodCA/IEJpZ0ludChlMi5jcmVhdGlvbkhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbzIuY29tcGxldGlvblRpbWUgPSB2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmIG51bGwgIT09IGUyLmNvbXBsZXRpb25UaW1lID8gVGltZXN0YW1wLmZyb21QYXJ0aWFsKGUyLmNvbXBsZXRpb25UaW1lKSA6IHZvaWQgMCwgbzIuaW5pdGlhbEJhbGFuY2UgPSBlMi5pbml0aWFsQmFsYW5jZSA/PyBcIlwiLCBvMi5iYWxhbmNlID0gZTIuYmFsYW5jZSA/PyBcIlwiLCBvMi51bmJvbmRpbmdJZCA9IHZvaWQgMCAhPT0gZTIudW5ib25kaW5nSWQgJiYgbnVsbCAhPT0gZTIudW5ib25kaW5nSWQgPyBCaWdJbnQoZTIudW5ib25kaW5nSWQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG8yLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50ID0gdm9pZCAwICE9PSBlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCAmJiBudWxsICE9PSBlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCA/IEJpZ0ludChlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5VbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnlcIiwgdmFsdWU6IFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBiMigpIHtcbiAgcmV0dXJuIHsgY3JlYXRpb25IZWlnaHQ6IEJpZ0ludCgwKSwgY29tcGxldGlvblRpbWU6IFRpbWVzdGFtcC5mcm9tUGFydGlhbCh7fSksIGluaXRpYWxCYWxhbmNlOiBcIlwiLCBzaGFyZXNEc3Q6IFwiXCIsIHVuYm9uZGluZ0lkOiBCaWdJbnQoMCksIHVuYm9uZGluZ09uSG9sZFJlZkNvdW50OiBCaWdJbnQoMCkgfTtcbn1cbnZhciBSZWRlbGVnYXRpb25FbnRyeSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25FbnRyeVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChlMi5jcmVhdGlvbkhlaWdodCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMig4KS5pbnQ2NChlMi5jcmVhdGlvbkhlaWdodCksIHZvaWQgMCAhPT0gZTIuY29tcGxldGlvblRpbWUgJiYgVGltZXN0YW1wLmVuY29kZShlMi5jb21wbGV0aW9uVGltZSwgbzIudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCBcIlwiICE9PSBlMi5pbml0aWFsQmFsYW5jZSAmJiBvMi51aW50MzIoMjYpLnN0cmluZyhlMi5pbml0aWFsQmFsYW5jZSksIFwiXCIgIT09IGUyLnNoYXJlc0RzdCAmJiBvMi51aW50MzIoMzQpLnN0cmluZyhEZWNpbWFsLmZyb21Vc2VySW5wdXQoZTIuc2hhcmVzRHN0LCAxOCkuYXRvbWljcyksIGUyLnVuYm9uZGluZ0lkICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDQwKS51aW50NjQoZTIudW5ib25kaW5nSWQpLCBlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMig0OCkuaW50NjQoZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQpLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgbjIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gbzIgPyBuMi5sZW4gOiBuMi5wb3MgKyBvMjtcbiAgY29uc3QgczMgPSBiMigpO1xuICBmb3IgKDsgbjIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUzID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzMy5jcmVhdGlvbkhlaWdodCA9IG4yLmludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBzMy5jb21wbGV0aW9uVGltZSA9IFRpbWVzdGFtcC5kZWNvZGUobjIsIG4yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHMzLmluaXRpYWxCYWxhbmNlID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBzMy5zaGFyZXNEc3QgPSBEZWNpbWFsLmZyb21BdG9taWNzKG4yLnN0cmluZygpLCAxOCkudG9TdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDU6XG4gICAgICAgIHMzLnVuYm9uZGluZ0lkID0gbjIudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA2OlxuICAgICAgICBzMy51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCA9IG4yLmludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHMzO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgY3JlYXRpb25IZWlnaHQ6IGlzU2V0KGUyLmNyZWF0aW9uSGVpZ2h0KSA/IEJpZ0ludChlMi5jcmVhdGlvbkhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgY29tcGxldGlvblRpbWU6IGlzU2V0KGUyLmNvbXBsZXRpb25UaW1lKSA/IGZyb21Kc29uVGltZXN0YW1wKGUyLmNvbXBsZXRpb25UaW1lKSA6IHZvaWQgMCwgaW5pdGlhbEJhbGFuY2U6IGlzU2V0KGUyLmluaXRpYWxCYWxhbmNlKSA/IFN0cmluZyhlMi5pbml0aWFsQmFsYW5jZSkgOiBcIlwiLCBzaGFyZXNEc3Q6IGlzU2V0KGUyLnNoYXJlc0RzdCkgPyBTdHJpbmcoZTIuc2hhcmVzRHN0KSA6IFwiXCIsIHVuYm9uZGluZ0lkOiBpc1NldChlMi51bmJvbmRpbmdJZCkgPyBCaWdJbnQoZTIudW5ib25kaW5nSWQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIHVuYm9uZGluZ09uSG9sZFJlZkNvdW50OiBpc1NldChlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCkgPyBCaWdJbnQoZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCkgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5jcmVhdGlvbkhlaWdodCAmJiAodDUuY3JlYXRpb25IZWlnaHQgPSAoZTIuY3JlYXRpb25IZWlnaHQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiAodDUuY29tcGxldGlvblRpbWUgPSBmcm9tVGltZXN0YW1wKGUyLmNvbXBsZXRpb25UaW1lKS50b0lTT1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi5pbml0aWFsQmFsYW5jZSAmJiAodDUuaW5pdGlhbEJhbGFuY2UgPSBlMi5pbml0aWFsQmFsYW5jZSksIHZvaWQgMCAhPT0gZTIuc2hhcmVzRHN0ICYmICh0NS5zaGFyZXNEc3QgPSBlMi5zaGFyZXNEc3QpLCB2b2lkIDAgIT09IGUyLnVuYm9uZGluZ0lkICYmICh0NS51bmJvbmRpbmdJZCA9IChlMi51bmJvbmRpbmdJZCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLnVuYm9uZGluZ09uSG9sZFJlZkNvdW50ICYmICh0NS51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCA9IChlMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0gYjIoKTtcbiAgcmV0dXJuIG8yLmNyZWF0aW9uSGVpZ2h0ID0gdm9pZCAwICE9PSBlMi5jcmVhdGlvbkhlaWdodCAmJiBudWxsICE9PSBlMi5jcmVhdGlvbkhlaWdodCA/IEJpZ0ludChlMi5jcmVhdGlvbkhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbzIuY29tcGxldGlvblRpbWUgPSB2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmIG51bGwgIT09IGUyLmNvbXBsZXRpb25UaW1lID8gVGltZXN0YW1wLmZyb21QYXJ0aWFsKGUyLmNvbXBsZXRpb25UaW1lKSA6IHZvaWQgMCwgbzIuaW5pdGlhbEJhbGFuY2UgPSBlMi5pbml0aWFsQmFsYW5jZSA/PyBcIlwiLCBvMi5zaGFyZXNEc3QgPSBlMi5zaGFyZXNEc3QgPz8gXCJcIiwgbzIudW5ib25kaW5nSWQgPSB2b2lkIDAgIT09IGUyLnVuYm9uZGluZ0lkICYmIG51bGwgIT09IGUyLnVuYm9uZGluZ0lkID8gQmlnSW50KGUyLnVuYm9uZGluZ0lkLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBvMi51bmJvbmRpbmdPbkhvbGRSZWZDb3VudCA9IHZvaWQgMCAhPT0gZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgJiYgbnVsbCAhPT0gZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQgPyBCaWdJbnQoZTIudW5ib25kaW5nT25Ib2xkUmVmQ291bnQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFJlZGVsZWdhdGlvbkVudHJ5LmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUmVkZWxlZ2F0aW9uRW50cnkuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvbkVudHJ5XCIsIHZhbHVlOiBSZWRlbGVnYXRpb25FbnRyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgUmVkZWxlZ2F0aW9uID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvblwiLCBlbmNvZGUoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgdDUudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcyksIFwiXCIgIT09IGUyLnZhbGlkYXRvclNyY0FkZHJlc3MgJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIudmFsaWRhdG9yU3JjQWRkcmVzcyksIFwiXCIgIT09IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MgJiYgdDUudWludDMyKDI2KS5zdHJpbmcoZTIudmFsaWRhdG9yRHN0QWRkcmVzcyk7XG4gIGZvciAoY29uc3QgbzIgb2YgZTIuZW50cmllcykgUmVkZWxlZ2F0aW9uRW50cnkuZW5jb2RlKG8yLCB0NS51aW50MzIoMzQpLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB0NTtcbn0sIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbzIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gdDUgPyBvMi5sZW4gOiBvMi5wb3MgKyB0NTtcbiAgY29uc3QgaTIgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvclNyY0FkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckRzdEFkZHJlc3M6IFwiXCIsIGVudHJpZXM6IFtdIH07XG4gIGZvciAoOyBvMi5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTMgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRlbGVnYXRvckFkZHJlc3MgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkyLnZhbGlkYXRvclNyY0FkZHJlc3MgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGkyLnZhbGlkYXRvckRzdEFkZHJlc3MgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGkyLmVudHJpZXMucHVzaChSZWRlbGVnYXRpb25FbnRyeS5kZWNvZGUobzIsIG8yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JTcmNBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JTcmNBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JTcmNBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckRzdEFkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpIDogXCJcIiwgZW50cmllczogQXJyYXkuaXNBcnJheShlMj8uZW50cmllcykgPyBlMi5lbnRyaWVzLm1hcCgoZTMpID0+IFJlZGVsZWdhdGlvbkVudHJ5LmZyb21KU09OKGUzKSkgOiBbXSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKHQ1LmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzICYmICh0NS52YWxpZGF0b3JTcmNBZGRyZXNzID0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyAmJiAodDUudmFsaWRhdG9yRHN0QWRkcmVzcyA9IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpLCBlMi5lbnRyaWVzID8gdDUuZW50cmllcyA9IGUyLmVudHJpZXMubWFwKChlMykgPT4gZTMgPyBSZWRlbGVnYXRpb25FbnRyeS50b0pTT04oZTMpIDogdm9pZCAwKSA6IHQ1LmVudHJpZXMgPSBbXSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yU3JjQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yRHN0QWRkcmVzczogXCJcIiwgZW50cmllczogW10gfTtcbiAgcmV0dXJuIHQ1LmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzID8/IFwiXCIsIHQ1LnZhbGlkYXRvclNyY0FkZHJlc3MgPSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzID8/IFwiXCIsIHQ1LnZhbGlkYXRvckRzdEFkZHJlc3MgPSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzID8/IFwiXCIsIHQ1LmVudHJpZXMgPSBlMi5lbnRyaWVzPy5tYXAoKGUzKSA9PiBSZWRlbGVnYXRpb25FbnRyeS5mcm9tUGFydGlhbChlMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBSZWRlbGVnYXRpb24uZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBSZWRlbGVnYXRpb24uZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvblwiLCB2YWx1ZTogUmVkZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIFMoKSB7XG4gIHJldHVybiB7IGRlbGVnYXRpb246IERlbGVnYXRpb24uZnJvbVBhcnRpYWwoe30pLCBiYWxhbmNlOiBDb2luLmZyb21QYXJ0aWFsKHt9KSB9O1xufVxudmFyIERlbGVnYXRpb25SZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5EZWxlZ2F0aW9uUmVzcG9uc2VcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodm9pZCAwICE9PSBlMi5kZWxlZ2F0aW9uICYmIERlbGVnYXRpb24uZW5jb2RlKGUyLmRlbGVnYXRpb24sIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKSwgdm9pZCAwICE9PSBlMi5iYWxhbmNlICYmIENvaW4uZW5jb2RlKGUyLmJhbGFuY2UsIHQ1LnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgdDUpLCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IHMzID0gUygpO1xuICBmb3IgKDsgbzIucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzMy5kZWxlZ2F0aW9uID0gRGVsZWdhdGlvbi5kZWNvZGUobzIsIG8yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHMzLmJhbGFuY2UgPSBDb2luLmRlY29kZShvMiwgbzIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMztcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRpb246IGlzU2V0KGUyLmRlbGVnYXRpb24pID8gRGVsZWdhdGlvbi5mcm9tSlNPTihlMi5kZWxlZ2F0aW9uKSA6IHZvaWQgMCwgYmFsYW5jZTogaXNTZXQoZTIuYmFsYW5jZSkgPyBDb2luLmZyb21KU09OKGUyLmJhbGFuY2UpIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdGlvbiAmJiAodDUuZGVsZWdhdGlvbiA9IGUyLmRlbGVnYXRpb24gPyBEZWxlZ2F0aW9uLnRvSlNPTihlMi5kZWxlZ2F0aW9uKSA6IHZvaWQgMCksIHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiAodDUuYmFsYW5jZSA9IGUyLmJhbGFuY2UgPyBDb2luLnRvSlNPTihlMi5iYWxhbmNlKSA6IHZvaWQgMCksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSBTKCk7XG4gIHJldHVybiB0NS5kZWxlZ2F0aW9uID0gdm9pZCAwICE9PSBlMi5kZWxlZ2F0aW9uICYmIG51bGwgIT09IGUyLmRlbGVnYXRpb24gPyBEZWxlZ2F0aW9uLmZyb21QYXJ0aWFsKGUyLmRlbGVnYXRpb24pIDogdm9pZCAwLCB0NS5iYWxhbmNlID0gdm9pZCAwICE9PSBlMi5iYWxhbmNlICYmIG51bGwgIT09IGUyLmJhbGFuY2UgPyBDb2luLmZyb21QYXJ0aWFsKGUyLmJhbGFuY2UpIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBEZWxlZ2F0aW9uUmVzcG9uc2UuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLkRlbGVnYXRpb25SZXNwb25zZVwiLCB2YWx1ZTogRGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIEEoKSB7XG4gIHJldHVybiB7IHJlZGVsZWdhdGlvbkVudHJ5OiBSZWRlbGVnYXRpb25FbnRyeS5mcm9tUGFydGlhbCh7fSksIGJhbGFuY2U6IFwiXCIgfTtcbn1cbnZhciBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2VcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb25FbnRyeSAmJiBSZWRlbGVnYXRpb25FbnRyeS5lbmNvZGUoZTIucmVkZWxlZ2F0aW9uRW50cnksIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKSwgXCJcIiAhPT0gZTIuYmFsYW5jZSAmJiB0NS51aW50MzIoMzQpLnN0cmluZyhlMi5iYWxhbmNlKSwgdDUpLCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IGkyID0gQSgpO1xuICBmb3IgKDsgbzIucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5yZWRlbGVnYXRpb25FbnRyeSA9IFJlZGVsZWdhdGlvbkVudHJ5LmRlY29kZShvMiwgbzIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgaTIuYmFsYW5jZSA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IHJlZGVsZWdhdGlvbkVudHJ5OiBpc1NldChlMi5yZWRlbGVnYXRpb25FbnRyeSkgPyBSZWRlbGVnYXRpb25FbnRyeS5mcm9tSlNPTihlMi5yZWRlbGVnYXRpb25FbnRyeSkgOiB2b2lkIDAsIGJhbGFuY2U6IGlzU2V0KGUyLmJhbGFuY2UpID8gU3RyaW5nKGUyLmJhbGFuY2UpIDogXCJcIiB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLnJlZGVsZWdhdGlvbkVudHJ5ICYmICh0NS5yZWRlbGVnYXRpb25FbnRyeSA9IGUyLnJlZGVsZWdhdGlvbkVudHJ5ID8gUmVkZWxlZ2F0aW9uRW50cnkudG9KU09OKGUyLnJlZGVsZWdhdGlvbkVudHJ5KSA6IHZvaWQgMCksIHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiAodDUuYmFsYW5jZSA9IGUyLmJhbGFuY2UpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0gQSgpO1xuICByZXR1cm4gdDUucmVkZWxlZ2F0aW9uRW50cnkgPSB2b2lkIDAgIT09IGUyLnJlZGVsZWdhdGlvbkVudHJ5ICYmIG51bGwgIT09IGUyLnJlZGVsZWdhdGlvbkVudHJ5ID8gUmVkZWxlZ2F0aW9uRW50cnkuZnJvbVBhcnRpYWwoZTIucmVkZWxlZ2F0aW9uRW50cnkpIDogdm9pZCAwLCB0NS5iYWxhbmNlID0gZTIuYmFsYW5jZSA/PyBcIlwiLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZVwiLCB2YWx1ZTogUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBEKCkge1xuICByZXR1cm4geyByZWRlbGVnYXRpb246IFJlZGVsZWdhdGlvbi5mcm9tUGFydGlhbCh7fSksIGVudHJpZXM6IFtdIH07XG59XG52YXIgUmVkZWxlZ2F0aW9uUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUmVkZWxlZ2F0aW9uUmVzcG9uc2VcIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICB2b2lkIDAgIT09IGUyLnJlZGVsZWdhdGlvbiAmJiBSZWRlbGVnYXRpb24uZW5jb2RlKGUyLnJlZGVsZWdhdGlvbiwgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICBmb3IgKGNvbnN0IG8yIG9mIGUyLmVudHJpZXMpIFJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2UuZW5jb2RlKG8yLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB0NTtcbn0sIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbzIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gdDUgPyBvMi5sZW4gOiBvMi5wb3MgKyB0NTtcbiAgY29uc3QgaTIgPSBEKCk7XG4gIGZvciAoOyBvMi5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTMgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLnJlZGVsZWdhdGlvbiA9IFJlZGVsZWdhdGlvbi5kZWNvZGUobzIsIG8yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkyLmVudHJpZXMucHVzaChSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLmRlY29kZShvMiwgbzIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyByZWRlbGVnYXRpb246IGlzU2V0KGUyLnJlZGVsZWdhdGlvbikgPyBSZWRlbGVnYXRpb24uZnJvbUpTT04oZTIucmVkZWxlZ2F0aW9uKSA6IHZvaWQgMCwgZW50cmllczogQXJyYXkuaXNBcnJheShlMj8uZW50cmllcykgPyBlMi5lbnRyaWVzLm1hcCgoZTMpID0+IFJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2UuZnJvbUpTT04oZTMpKSA6IFtdIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIucmVkZWxlZ2F0aW9uICYmICh0NS5yZWRlbGVnYXRpb24gPSBlMi5yZWRlbGVnYXRpb24gPyBSZWRlbGVnYXRpb24udG9KU09OKGUyLnJlZGVsZWdhdGlvbikgOiB2b2lkIDApLCBlMi5lbnRyaWVzID8gdDUuZW50cmllcyA9IGUyLmVudHJpZXMubWFwKChlMykgPT4gZTMgPyBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUuZW50cmllcyA9IFtdLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0gRCgpO1xuICByZXR1cm4gdDUucmVkZWxlZ2F0aW9uID0gdm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb24gJiYgbnVsbCAhPT0gZTIucmVkZWxlZ2F0aW9uID8gUmVkZWxlZ2F0aW9uLmZyb21QYXJ0aWFsKGUyLnJlZGVsZWdhdGlvbikgOiB2b2lkIDAsIHQ1LmVudHJpZXMgPSBlMi5lbnRyaWVzPy5tYXAoKGUzKSA9PiBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFJlZGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUmVkZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvblJlc3BvbnNlXCIsIHZhbHVlOiBSZWRlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRpb25SZXF1ZXN0XCIsIGVuY29kZTogKG8yLCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG8yLmRlbGVnYXRvckFkZHIgJiYgZTIudWludDMyKDEwKS5zdHJpbmcobzIuZGVsZWdhdG9yQWRkciksIFwiXCIgIT09IG8yLnZhbGlkYXRvckFkZHIgJiYgZTIudWludDMyKDE4KS5zdHJpbmcobzIudmFsaWRhdG9yQWRkciksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCB0NSA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSBlMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIGUyO1xuICBjb25zdCBhMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgdmFsaWRhdG9yQWRkcjogXCJcIiB9O1xuICBmb3IgKDsgdDUucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IG8zID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBhMi5kZWxlZ2F0b3JBZGRyID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBhMi52YWxpZGF0b3JBZGRyID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGEyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVsZWdhdG9yQWRkcjogaXNTZXQobzIuZGVsZWdhdG9yQWRkcikgPyBTdHJpbmcobzIuZGVsZWdhdG9yQWRkcikgOiBcIlwiLCB2YWxpZGF0b3JBZGRyOiBpc1NldChvMi52YWxpZGF0b3JBZGRyKSA/IFN0cmluZyhvMi52YWxpZGF0b3JBZGRyKSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZWxlZ2F0b3JBZGRyICYmIChlMi5kZWxlZ2F0b3JBZGRyID0gbzIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gbzIudmFsaWRhdG9yQWRkciAmJiAoZTIudmFsaWRhdG9yQWRkciA9IG8yLnZhbGlkYXRvckFkZHIpLCBlMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IGUyID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCB2YWxpZGF0b3JBZGRyOiBcIlwiIH07XG4gIHJldHVybiBlMi5kZWxlZ2F0b3JBZGRyID0gbzIuZGVsZWdhdG9yQWRkciA/PyBcIlwiLCBlMi52YWxpZGF0b3JBZGRyID0gbzIudmFsaWRhdG9yQWRkciA/PyBcIlwiLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeURlbGVnYXRpb25SZXF1ZXN0LmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2VcIiwgZW5jb2RlOiAobzIsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodm9pZCAwICE9PSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2UgJiYgRGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShvMi5kZWxlZ2F0aW9uUmVzcG9uc2UsIGUyLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKSwgZTIpLCBkZWNvZGUobzIsIGUyKSB7XG4gIGNvbnN0IHQ1ID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgYTIgPSB2b2lkIDAgPT09IGUyID8gdDUubGVuIDogdDUucG9zICsgZTI7XG4gIGNvbnN0IGkyID0geyBkZWxlZ2F0aW9uUmVzcG9uc2U6IHZvaWQgMCB9O1xuICBmb3IgKDsgdDUucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IG8zID0gdDUudWludDMyKCk7XG4gICAgaWYgKG8zID4+PiAzID09IDEpIGkyLmRlbGVnYXRpb25SZXNwb25zZSA9IERlbGVnYXRpb25SZXNwb25zZS5kZWNvZGUodDUsIHQ1LnVpbnQzMigpKTtcbiAgICBlbHNlIHQ1LnNraXBUeXBlKDcgJiBvMyk7XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVsZWdhdGlvblJlc3BvbnNlOiBpc1NldChvMi5kZWxlZ2F0aW9uUmVzcG9uc2UpID8gRGVsZWdhdGlvblJlc3BvbnNlLmZyb21KU09OKG8yLmRlbGVnYXRpb25SZXNwb25zZSkgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2UgJiYgKGUyLmRlbGVnYXRpb25SZXNwb25zZSA9IG8yLmRlbGVnYXRpb25SZXNwb25zZSA/IERlbGVnYXRpb25SZXNwb25zZS50b0pTT04obzIuZGVsZWdhdGlvblJlc3BvbnNlKSA6IHZvaWQgMCksIGUyO1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgZTIgPSB7IGRlbGVnYXRpb25SZXNwb25zZTogdm9pZCAwIH07XG4gIHJldHVybiBlMi5kZWxlZ2F0aW9uUmVzcG9uc2UgPSB2b2lkIDAgIT09IG8yLmRlbGVnYXRpb25SZXNwb25zZSAmJiBudWxsICE9PSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2UgPyBEZWxlZ2F0aW9uUmVzcG9uc2UuZnJvbVBhcnRpYWwobzIuZGVsZWdhdGlvblJlc3BvbnNlKSA6IHZvaWQgMCwgZTI7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2UuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeURlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlcXVlc3RcIiwgZW5jb2RlOiAobzIsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbzIuZGVsZWdhdG9yQWRkciAmJiBlMi51aW50MzIoMTApLnN0cmluZyhvMi5kZWxlZ2F0b3JBZGRyKSwgXCJcIiAhPT0gbzIudmFsaWRhdG9yQWRkciAmJiBlMi51aW50MzIoMTgpLnN0cmluZyhvMi52YWxpZGF0b3JBZGRyKSwgZTIpLCBkZWNvZGUobzIsIGUyKSB7XG4gIGNvbnN0IHQ1ID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IGUyID8gdDUubGVuIDogdDUucG9zICsgZTI7XG4gIGNvbnN0IGEyID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCB2YWxpZGF0b3JBZGRyOiBcIlwiIH07XG4gIGZvciAoOyB0NS5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgbzMgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG8zID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGEyLmRlbGVnYXRvckFkZHIgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGEyLnZhbGlkYXRvckFkZHIgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgbzMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyBkZWxlZ2F0b3JBZGRyOiBpc1NldChvMi5kZWxlZ2F0b3JBZGRyKSA/IFN0cmluZyhvMi5kZWxlZ2F0b3JBZGRyKSA6IFwiXCIsIHZhbGlkYXRvckFkZHI6IGlzU2V0KG8yLnZhbGlkYXRvckFkZHIpID8gU3RyaW5nKG8yLnZhbGlkYXRvckFkZHIpIDogXCJcIiB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IGUyID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLmRlbGVnYXRvckFkZHIgJiYgKGUyLmRlbGVnYXRvckFkZHIgPSBvMi5kZWxlZ2F0b3JBZGRyKSwgdm9pZCAwICE9PSBvMi52YWxpZGF0b3JBZGRyICYmIChlMi52YWxpZGF0b3JBZGRyID0gbzIudmFsaWRhdG9yQWRkciksIGUyO1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgZTIgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHZhbGlkYXRvckFkZHI6IFwiXCIgfTtcbiAgcmV0dXJuIGUyLmRlbGVnYXRvckFkZHIgPSBvMi5kZWxlZ2F0b3JBZGRyID8/IFwiXCIsIGUyLnZhbGlkYXRvckFkZHIgPSBvMi52YWxpZGF0b3JBZGRyID8/IFwiXCIsIGUyO1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlcXVlc3QuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0LmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0XCIsIHZhbHVlOiBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0LmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIGMoKSB7XG4gIHJldHVybiB7IHVuYm9uZDogVW5ib25kaW5nRGVsZWdhdGlvbi5mcm9tUGFydGlhbCh7fSkgfTtcbn1cbnZhciBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZVwiLCBlbmNvZGU6IChvMiwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICh2b2lkIDAgIT09IG8yLnVuYm9uZCAmJiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmVuY29kZShvMi51bmJvbmQsIGUyLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKSwgZTIpLCBkZWNvZGUobzIsIGUyKSB7XG4gIGNvbnN0IHQ1ID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IGUyID8gdDUubGVuIDogdDUucG9zICsgZTI7XG4gIGNvbnN0IGkyID0gYygpO1xuICBmb3IgKDsgdDUucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IG8zID0gdDUudWludDMyKCk7XG4gICAgaWYgKG8zID4+PiAzID09IDEpIGkyLnVuYm9uZCA9IFVuYm9uZGluZ0RlbGVnYXRpb24uZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgZWxzZSB0NS5za2lwVHlwZSg3ICYgbzMpO1xuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IHVuYm9uZDogaXNTZXQobzIudW5ib25kKSA/IFVuYm9uZGluZ0RlbGVnYXRpb24uZnJvbUpTT04obzIudW5ib25kKSA6IHZvaWQgMCB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IGUyID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLnVuYm9uZCAmJiAoZTIudW5ib25kID0gbzIudW5ib25kID8gVW5ib25kaW5nRGVsZWdhdGlvbi50b0pTT04obzIudW5ib25kKSA6IHZvaWQgMCksIGUyO1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgZTIgPSBjKCk7XG4gIHJldHVybiBlMi51bmJvbmQgPSB2b2lkIDAgIT09IG8yLnVuYm9uZCAmJiBudWxsICE9PSBvMi51bmJvbmQgPyBVbmJvbmRpbmdEZWxlZ2F0aW9uLmZyb21QYXJ0aWFsKG8yLnVuYm9uZCkgOiB2b2lkIDAsIGUyO1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlc3BvbnNlXCIsIHZhbHVlOiBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkciAmJiB0NS51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXF1ZXN0LmVuY29kZShlMi5wYWdpbmF0aW9uLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSB0NSA/IG4yLmxlbiA6IG4yLnBvcyArIHQ1O1xuICBjb25zdCBpMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyBuMi5wb3MgPCBhMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRlbGVnYXRvckFkZHIgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkyLnBhZ2luYXRpb24gPSBQYWdlUmVxdWVzdC5kZWNvZGUobjIsIG4yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSA6IFwiXCIsIHBhZ2luYXRpb246IGlzU2V0KGUyLnBhZ2luYXRpb24pID8gUGFnZVJlcXVlc3QuZnJvbUpTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyICYmICh0NS5kZWxlZ2F0b3JBZGRyID0gZTIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiAodDUucGFnaW5hdGlvbiA9IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC50b0pTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIHQ1LmRlbGVnYXRvckFkZHIgPSBlMi5kZWxlZ2F0b3JBZGRyID8/IFwiXCIsIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXF1ZXN0LmZyb21QYXJ0aWFsKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVxdWVzdC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0LmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2VcIiwgZW5jb2RlKG8yLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IGUyIG9mIG8yLmRlbGVnYXRpb25SZXNwb25zZXMpIERlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUoZTIsIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBQYWdlUmVzcG9uc2UuZW5jb2RlKG8yLnBhZ2luYXRpb24sIHQ1LnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgdDU7XG59LCBkZWNvZGUobzIsIHQ1KSB7XG4gIGNvbnN0IGEyID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IHQ1ID8gYTIubGVuIDogYTIucG9zICsgdDU7XG4gIGNvbnN0IHI1ID0geyBkZWxlZ2F0aW9uUmVzcG9uc2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyBhMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgbzMgPSBhMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG8zID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LmRlbGVnYXRpb25SZXNwb25zZXMucHVzaChEZWxlZ2F0aW9uUmVzcG9uc2UuZGVjb2RlKGEyLCBhMi51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUucGFnaW5hdGlvbiA9IFBhZ2VSZXNwb25zZS5kZWNvZGUoYTIsIGEyLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBhMi5za2lwVHlwZSg3ICYgbzMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyBkZWxlZ2F0aW9uUmVzcG9uc2VzOiBBcnJheS5pc0FycmF5KG8yPy5kZWxlZ2F0aW9uUmVzcG9uc2VzKSA/IG8yLmRlbGVnYXRpb25SZXNwb25zZXMubWFwKChvMykgPT4gRGVsZWdhdGlvblJlc3BvbnNlLmZyb21KU09OKG8zKSkgOiBbXSwgcGFnaW5hdGlvbjogaXNTZXQobzIucGFnaW5hdGlvbikgPyBQYWdlUmVzcG9uc2UuZnJvbUpTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gbzIuZGVsZWdhdGlvblJlc3BvbnNlcyA/IHQ1LmRlbGVnYXRpb25SZXNwb25zZXMgPSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcCgobzMpID0+IG8zID8gRGVsZWdhdGlvblJlc3BvbnNlLnRvSlNPTihvMykgOiB2b2lkIDApIDogdDUuZGVsZWdhdGlvblJlc3BvbnNlcyA9IFtdLCB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgKHQ1LnBhZ2luYXRpb24gPSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLnRvSlNPTihvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCksIHQ1O1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgdDUgPSB7IGRlbGVnYXRpb25SZXNwb25zZXM6IFtdLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIHQ1LmRlbGVnYXRpb25SZXNwb25zZXMgPSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2VzPy5tYXAoKG8zKSA9PiBEZWxlZ2F0aW9uUmVzcG9uc2UuZnJvbVBhcnRpYWwobzMpKSB8fCBbXSwgdDUucGFnaW5hdGlvbiA9IHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBudWxsICE9PSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLmZyb21QYXJ0aWFsKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2UuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdFwiLCBlbmNvZGU6IChlMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyICYmIHQ1LnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHIpLCB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgUGFnZVJlcXVlc3QuZW5jb2RlKGUyLnBhZ2luYXRpb24sIHQ1LnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgdDUpLCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG4yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgYTIgPSB2b2lkIDAgPT09IHQ1ID8gbjIubGVuIDogbjIucG9zICsgdDU7XG4gIGNvbnN0IGkyID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgZm9yICg7IG4yLnBvcyA8IGEyOyApIHtcbiAgICBjb25zdCBlMyA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTIuZGVsZWdhdG9yQWRkciA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIucGFnaW5hdGlvbiA9IFBhZ2VSZXF1ZXN0LmRlY29kZShuMiwgbjIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHI6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHIpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHIpIDogXCJcIiwgcGFnaW5hdGlvbjogaXNTZXQoZTIucGFnaW5hdGlvbikgPyBQYWdlUmVxdWVzdC5mcm9tSlNPTihlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHIgJiYgKHQ1LmRlbGVnYXRvckFkZHIgPSBlMi5kZWxlZ2F0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmICh0NS5wYWdpbmF0aW9uID0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXF1ZXN0LnRvSlNPTihlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICByZXR1cm4gdDUuZGVsZWdhdG9yQWRkciA9IGUyLmRlbGVnYXRvckFkZHIgPz8gXCJcIiwgdDUucGFnaW5hdGlvbiA9IHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiBudWxsICE9PSBlMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QuZnJvbVBhcnRpYWwoZTIucGFnaW5hdGlvbikgOiB2b2lkIDAsIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXF1ZXN0LmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXF1ZXN0XCIsIHZhbHVlOiBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1Jlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXNwb25zZVwiLCBlbmNvZGUobzIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgZTIgb2YgbzIudW5ib25kaW5nUmVzcG9uc2VzKSBVbmJvbmRpbmdEZWxlZ2F0aW9uLmVuY29kZShlMiwgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXNwb25zZS5lbmNvZGUobzIucGFnaW5hdGlvbiwgdDUudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCB0NTtcbn0sIGRlY29kZShvMiwgdDUpIHtcbiAgY29uc3QgbjIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gdDUgPyBuMi5sZW4gOiBuMi5wb3MgKyB0NTtcbiAgY29uc3QgcjUgPSB7IHVuYm9uZGluZ1Jlc3BvbnNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgbjIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IG8zID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS51bmJvbmRpbmdSZXNwb25zZXMucHVzaChVbmJvbmRpbmdEZWxlZ2F0aW9uLmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LnBhZ2luYXRpb24gPSBQYWdlUmVzcG9uc2UuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgdW5ib25kaW5nUmVzcG9uc2VzOiBBcnJheS5pc0FycmF5KG8yPy51bmJvbmRpbmdSZXNwb25zZXMpID8gbzIudW5ib25kaW5nUmVzcG9uc2VzLm1hcCgobzMpID0+IFVuYm9uZGluZ0RlbGVnYXRpb24uZnJvbUpTT04obzMpKSA6IFtdLCBwYWdpbmF0aW9uOiBpc1NldChvMi5wYWdpbmF0aW9uKSA/IFBhZ2VSZXNwb25zZS5mcm9tSlNPTihvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiBvMi51bmJvbmRpbmdSZXNwb25zZXMgPyB0NS51bmJvbmRpbmdSZXNwb25zZXMgPSBvMi51bmJvbmRpbmdSZXNwb25zZXMubWFwKChvMykgPT4gbzMgPyBVbmJvbmRpbmdEZWxlZ2F0aW9uLnRvSlNPTihvMykgOiB2b2lkIDApIDogdDUudW5ib25kaW5nUmVzcG9uc2VzID0gW10sIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiAodDUucGFnaW5hdGlvbiA9IG8yLnBhZ2luYXRpb24gPyBQYWdlUmVzcG9uc2UudG9KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgdW5ib25kaW5nUmVzcG9uc2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiB0NS51bmJvbmRpbmdSZXNwb25zZXMgPSBvMi51bmJvbmRpbmdSZXNwb25zZXM/Lm1hcCgobzMpID0+IFVuYm9uZGluZ0RlbGVnYXRpb24uZnJvbVBhcnRpYWwobzMpKSB8fCBbXSwgdDUucGFnaW5hdGlvbiA9IHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBudWxsICE9PSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLmZyb21QYXJ0aWFsKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2UuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeVJlZGVsZWdhdGlvbnNSZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkciAmJiB0NS51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSwgXCJcIiAhPT0gZTIuc3JjVmFsaWRhdG9yQWRkciAmJiB0NS51aW50MzIoMTgpLnN0cmluZyhlMi5zcmNWYWxpZGF0b3JBZGRyKSwgXCJcIiAhPT0gZTIuZHN0VmFsaWRhdG9yQWRkciAmJiB0NS51aW50MzIoMjYpLnN0cmluZyhlMi5kc3RWYWxpZGF0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXF1ZXN0LmVuY29kZShlMi5wYWdpbmF0aW9uLCB0NS51aW50MzIoMzQpLmZvcmsoKSkubGRlbGltKCksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSB0NSA/IG4yLmxlbiA6IG4yLnBvcyArIHQ1O1xuICBjb25zdCBpMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgc3JjVmFsaWRhdG9yQWRkcjogXCJcIiwgZHN0VmFsaWRhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyBuMi5wb3MgPCBhMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRlbGVnYXRvckFkZHIgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkyLnNyY1ZhbGlkYXRvckFkZHIgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGkyLmRzdFZhbGlkYXRvckFkZHIgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGkyLnBhZ2luYXRpb24gPSBQYWdlUmVxdWVzdC5kZWNvZGUobjIsIG4yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSA6IFwiXCIsIHNyY1ZhbGlkYXRvckFkZHI6IGlzU2V0KGUyLnNyY1ZhbGlkYXRvckFkZHIpID8gU3RyaW5nKGUyLnNyY1ZhbGlkYXRvckFkZHIpIDogXCJcIiwgZHN0VmFsaWRhdG9yQWRkcjogaXNTZXQoZTIuZHN0VmFsaWRhdG9yQWRkcikgPyBTdHJpbmcoZTIuZHN0VmFsaWRhdG9yQWRkcikgOiBcIlwiLCBwYWdpbmF0aW9uOiBpc1NldChlMi5wYWdpbmF0aW9uKSA/IFBhZ2VSZXF1ZXN0LmZyb21KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkciAmJiAodDUuZGVsZWdhdG9yQWRkciA9IGUyLmRlbGVnYXRvckFkZHIpLCB2b2lkIDAgIT09IGUyLnNyY1ZhbGlkYXRvckFkZHIgJiYgKHQ1LnNyY1ZhbGlkYXRvckFkZHIgPSBlMi5zcmNWYWxpZGF0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5kc3RWYWxpZGF0b3JBZGRyICYmICh0NS5kc3RWYWxpZGF0b3JBZGRyID0gZTIuZHN0VmFsaWRhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiAodDUucGFnaW5hdGlvbiA9IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC50b0pTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCBzcmNWYWxpZGF0b3JBZGRyOiBcIlwiLCBkc3RWYWxpZGF0b3JBZGRyOiBcIlwiLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIHQ1LmRlbGVnYXRvckFkZHIgPSBlMi5kZWxlZ2F0b3JBZGRyID8/IFwiXCIsIHQ1LnNyY1ZhbGlkYXRvckFkZHIgPSBlMi5zcmNWYWxpZGF0b3JBZGRyID8/IFwiXCIsIHQ1LmRzdFZhbGlkYXRvckFkZHIgPSBlMi5kc3RWYWxpZGF0b3JBZGRyID8/IFwiXCIsIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXF1ZXN0LmZyb21QYXJ0aWFsKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeVJlZGVsZWdhdGlvbnNSZXF1ZXN0LmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2VcIiwgZW5jb2RlKG8yLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IGUyIG9mIG8yLnJlZGVsZWdhdGlvblJlc3BvbnNlcykgUmVkZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKGUyLCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgUGFnZVJlc3BvbnNlLmVuY29kZShvMi5wYWdpbmF0aW9uLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1O1xufSwgZGVjb2RlKG8yLCB0NSkge1xuICBjb25zdCBuMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSB0NSA/IG4yLmxlbiA6IG4yLnBvcyArIHQ1O1xuICBjb25zdCByNSA9IHsgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyBuMi5wb3MgPCBhMjsgKSB7XG4gICAgY29uc3QgbzMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG8zID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LnJlZGVsZWdhdGlvblJlc3BvbnNlcy5wdXNoKFJlZGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LnBhZ2luYXRpb24gPSBQYWdlUmVzcG9uc2UuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzOiBBcnJheS5pc0FycmF5KG8yPy5yZWRlbGVnYXRpb25SZXNwb25zZXMpID8gbzIucmVkZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcCgobzMpID0+IFJlZGVsZWdhdGlvblJlc3BvbnNlLmZyb21KU09OKG8zKSkgOiBbXSwgcGFnaW5hdGlvbjogaXNTZXQobzIucGFnaW5hdGlvbikgPyBQYWdlUmVzcG9uc2UuZnJvbUpTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gbzIucmVkZWxlZ2F0aW9uUmVzcG9uc2VzID8gdDUucmVkZWxlZ2F0aW9uUmVzcG9uc2VzID0gbzIucmVkZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcCgobzMpID0+IG8zID8gUmVkZWxlZ2F0aW9uUmVzcG9uc2UudG9KU09OKG8zKSA6IHZvaWQgMCkgOiB0NS5yZWRlbGVnYXRpb25SZXNwb25zZXMgPSBbXSwgdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmICh0NS5wYWdpbmF0aW9uID0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS50b0pTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyByZWRlbGVnYXRpb25SZXNwb25zZXM6IFtdLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIHQ1LnJlZGVsZWdhdGlvblJlc3BvbnNlcyA9IG8yLnJlZGVsZWdhdGlvblJlc3BvbnNlcz8ubWFwKChvMykgPT4gUmVkZWxlZ2F0aW9uUmVzcG9uc2UuZnJvbVBhcnRpYWwobzMpKSB8fCBbXSwgdDUucGFnaW5hdGlvbiA9IHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBudWxsICE9PSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLmZyb21QYXJ0aWFsKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeVJlZGVsZWdhdGlvbnNSZXNwb25zZS5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVJlZGVsZWdhdGlvbnNSZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xuXG4vL1xuZnVuY3Rpb24gdigpIHtcbiAgcmV0dXJuIHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgYW1vdW50OiBDb2luLmZyb21QYXJ0aWFsKHt9KSB9O1xufVxudmFyIE1zZ0RlbGVnYXRlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ0RlbGVnYXRlXCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgbzIudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcyksIFwiXCIgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgbzIudWludDMyKDE4KS5zdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIENvaW4uZW5jb2RlKGUyLmFtb3VudCwgbzIudWludDMyKDI2KS5mb3JrKCkpLmxkZWxpbSgpLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgdDUgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBzMyA9IHZvaWQgMCA9PT0gbzIgPyB0NS5sZW4gOiB0NS5wb3MgKyBvMjtcbiAgY29uc3QgaTIgPSB2KCk7XG4gIGZvciAoOyB0NS5wb3MgPCBzMzsgKSB7XG4gICAgY29uc3QgZTMgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRlbGVnYXRvckFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkyLnZhbGlkYXRvckFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGkyLmFtb3VudCA9IENvaW4uZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIsIGFtb3VudDogaXNTZXQoZTIuYW1vdW50KSA/IENvaW4uZnJvbUpTT04oZTIuYW1vdW50KSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIChvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIChvMi5hbW91bnQgPSBlMi5hbW91bnQgPyBDb2luLnRvSlNPTihlMi5hbW91bnQpIDogdm9pZCAwKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHYoKTtcbiAgcmV0dXJuIG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzID8/IFwiXCIsIG8yLnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzID8/IFwiXCIsIG8yLmFtb3VudCA9IHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIG51bGwgIT09IGUyLmFtb3VudCA/IENvaW4uZnJvbVBhcnRpYWwoZTIuYW1vdW50KSA6IHZvaWQgMCwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gTXNnRGVsZWdhdGUuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBNc2dEZWxlZ2F0ZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnRGVsZWdhdGVcIiwgdmFsdWU6IE1zZ0RlbGVnYXRlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIHAyKCkge1xuICByZXR1cm4geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JTcmNBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JEc3RBZGRyZXNzOiBcIlwiLCBhbW91bnQ6IENvaW4uZnJvbVBhcnRpYWwoe30pIH07XG59XG52YXIgTXNnQmVnaW5SZWRlbGVnYXRlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ0JlZ2luUmVkZWxlZ2F0ZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzICYmIG8yLnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzICYmIG8yLnVpbnQzMigyNikuc3RyaW5nKGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBDb2luLmVuY29kZShlMi5hbW91bnQsIG8yLnVpbnQzMigzNCkuZm9yaygpKS5sZGVsaW0oKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgczMgPSB2b2lkIDAgPT09IG8yID8gdDUubGVuIDogdDUucG9zICsgbzI7XG4gIGNvbnN0IGkyID0gcDIoKTtcbiAgZm9yICg7IHQ1LnBvcyA8IHMzOyApIHtcbiAgICBjb25zdCBlMyA9IHQ1LnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTIuZGVsZWdhdG9yQWRkcmVzcyA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIudmFsaWRhdG9yU3JjQWRkcmVzcyA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgaTIudmFsaWRhdG9yRHN0QWRkcmVzcyA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgaTIuYW1vdW50ID0gQ29pbi5kZWNvZGUodDUsIHQ1LnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvclNyY0FkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yRHN0QWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yRHN0QWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yRHN0QWRkcmVzcykgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KGUyLmFtb3VudCkgPyBDb2luLmZyb21KU09OKGUyLmFtb3VudCkgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIChvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyAmJiAobzIudmFsaWRhdG9yU3JjQWRkcmVzcyA9IGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MgJiYgKG8yLnZhbGlkYXRvckRzdEFkZHJlc3MgPSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgKG8yLmFtb3VudCA9IGUyLmFtb3VudCA/IENvaW4udG9KU09OKGUyLmFtb3VudCkgOiB2b2lkIDApLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0gcDIoKTtcbiAgcmV0dXJuIG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzID8/IFwiXCIsIG8yLnZhbGlkYXRvclNyY0FkZHJlc3MgPSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzID8/IFwiXCIsIG8yLnZhbGlkYXRvckRzdEFkZHJlc3MgPSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzID8/IFwiXCIsIG8yLmFtb3VudCA9IHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIG51bGwgIT09IGUyLmFtb3VudCA/IENvaW4uZnJvbVBhcnRpYWwoZTIuYW1vdW50KSA6IHZvaWQgMCwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gTXNnQmVnaW5SZWRlbGVnYXRlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gTXNnQmVnaW5SZWRlbGVnYXRlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dCZWdpblJlZGVsZWdhdGVcIiwgdmFsdWU6IE1zZ0JlZ2luUmVkZWxlZ2F0ZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBBMigpIHtcbiAgcmV0dXJuIHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgYW1vdW50OiBDb2luLmZyb21QYXJ0aWFsKHt9KSB9O1xufVxudmFyIE1zZ1VuZGVsZWdhdGUgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnVW5kZWxlZ2F0ZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBDb2luLmVuY29kZShlMi5hbW91bnQsIG8yLnVpbnQzMigyNikuZm9yaygpKS5sZGVsaW0oKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgczMgPSB2b2lkIDAgPT09IG8yID8gdDUubGVuIDogdDUucG9zICsgbzI7XG4gIGNvbnN0IGkyID0gQTIoKTtcbiAgZm9yICg7IHQ1LnBvcyA8IHMzOyApIHtcbiAgICBjb25zdCBlMyA9IHQ1LnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTIuZGVsZWdhdG9yQWRkcmVzcyA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIudmFsaWRhdG9yQWRkcmVzcyA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgaTIuYW1vdW50ID0gQ29pbi5kZWNvZGUodDUsIHQ1LnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpIDogXCJcIiwgYW1vdW50OiBpc1NldChlMi5hbW91bnQpID8gQ29pbi5mcm9tSlNPTihlMi5hbW91bnQpIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiAobzIuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgKG8yLnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgKG8yLmFtb3VudCA9IGUyLmFtb3VudCA/IENvaW4udG9KU09OKGUyLmFtb3VudCkgOiB2b2lkIDApLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0gQTIoKTtcbiAgcmV0dXJuIG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzID8/IFwiXCIsIG8yLnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzID8/IFwiXCIsIG8yLmFtb3VudCA9IHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIG51bGwgIT09IGUyLmFtb3VudCA/IENvaW4uZnJvbVBhcnRpYWwoZTIuYW1vdW50KSA6IHZvaWQgMCwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gTXNnVW5kZWxlZ2F0ZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IE1zZ1VuZGVsZWdhdGUuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ1VuZGVsZWdhdGVcIiwgdmFsdWU6IE1zZ1VuZGVsZWdhdGUuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gTTIoKSB7XG4gIHJldHVybiB7IGNvbXBsZXRpb25UaW1lOiBUaW1lc3RhbXAuZnJvbVBhcnRpYWwoe30pIH07XG59XG52YXIgTXNnVW5kZWxlZ2F0ZVJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ1VuZGVsZWdhdGVSZXNwb25zZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICh2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmIFRpbWVzdGFtcC5lbmNvZGUoZTIuY29tcGxldGlvblRpbWUsIG8yLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgczMgPSB2b2lkIDAgPT09IG8yID8gdDUubGVuIDogdDUucG9zICsgbzI7XG4gIGNvbnN0IHI1ID0gTTIoKTtcbiAgZm9yICg7IHQ1LnBvcyA8IHMzOyApIHtcbiAgICBjb25zdCBlMyA9IHQ1LnVpbnQzMigpO1xuICAgIGlmIChlMyA+Pj4gMyA9PSAxKSByNS5jb21wbGV0aW9uVGltZSA9IFRpbWVzdGFtcC5kZWNvZGUodDUsIHQ1LnVpbnQzMigpKTtcbiAgICBlbHNlIHQ1LnNraXBUeXBlKDcgJiBlMyk7XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgY29tcGxldGlvblRpbWU6IGlzU2V0KGUyLmNvbXBsZXRpb25UaW1lKSA/IGZyb21Kc29uVGltZXN0YW1wKGUyLmNvbXBsZXRpb25UaW1lKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmIChvMi5jb21wbGV0aW9uVGltZSA9IGZyb21UaW1lc3RhbXAoZTIuY29tcGxldGlvblRpbWUpLnRvSVNPU3RyaW5nKCkpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0gTTIoKTtcbiAgcmV0dXJuIG8yLmNvbXBsZXRpb25UaW1lID0gdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBudWxsICE9PSBlMi5jb21wbGV0aW9uVGltZSA/IFRpbWVzdGFtcC5mcm9tUGFydGlhbChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ1VuZGVsZWdhdGVSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IE1zZ1VuZGVsZWdhdGVSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnVW5kZWxlZ2F0ZVJlc3BvbnNlXCIsIHZhbHVlOiBNc2dVbmRlbGVnYXRlUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xuZnVuY3Rpb24gbDIoKSB7XG4gIHJldHVybiB7IHJldmlzaW9uTnVtYmVyOiBCaWdJbnQoMCksIHJldmlzaW9uSGVpZ2h0OiBCaWdJbnQoMCkgfTtcbn1cbnZhciBIZWlnaHQgPSB7IHR5cGVVcmw6IFwiL2liYy5jb3JlLmNsaWVudC52MS5IZWlnaHRcIiwgZW5jb2RlOiAodDUsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodDUucmV2aXNpb25OdW1iZXIgIT09IEJpZ0ludCgwKSAmJiBlMi51aW50MzIoOCkudWludDY0KHQ1LnJldmlzaW9uTnVtYmVyKSwgdDUucmV2aXNpb25IZWlnaHQgIT09IEJpZ0ludCgwKSAmJiBlMi51aW50MzIoMTYpLnVpbnQ2NCh0NS5yZXZpc2lvbkhlaWdodCksIGUyKSwgZGVjb2RlKHQ1LCBlMikge1xuICBjb25zdCBuMiA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IG8yID0gdm9pZCAwID09PSBlMiA/IG4yLmxlbiA6IG4yLnBvcyArIGUyO1xuICBjb25zdCBzMyA9IGwyKCk7XG4gIGZvciAoOyBuMi5wb3MgPCBvMjsgKSB7XG4gICAgY29uc3QgdDYgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKHQ2ID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHMzLnJldmlzaW9uTnVtYmVyID0gbjIudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBzMy5yZXZpc2lvbkhlaWdodCA9IG4yLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiB0Nik7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMztcbn0sIGZyb21KU09OOiAodDUpID0+ICh7IHJldmlzaW9uTnVtYmVyOiBpc1NldCh0NS5yZXZpc2lvbk51bWJlcikgPyBCaWdJbnQodDUucmV2aXNpb25OdW1iZXIudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIHJldmlzaW9uSGVpZ2h0OiBpc1NldCh0NS5yZXZpc2lvbkhlaWdodCkgPyBCaWdJbnQodDUucmV2aXNpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCkgfSksIHRvSlNPTih0NSkge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSB0NS5yZXZpc2lvbk51bWJlciAmJiAoZTIucmV2aXNpb25OdW1iZXIgPSAodDUucmV2aXNpb25OdW1iZXIgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSB0NS5yZXZpc2lvbkhlaWdodCAmJiAoZTIucmV2aXNpb25IZWlnaHQgPSAodDUucmV2aXNpb25IZWlnaHQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgZTI7XG59LCBmcm9tUGFydGlhbCh0NSkge1xuICBjb25zdCBlMiA9IGwyKCk7XG4gIHJldHVybiBlMi5yZXZpc2lvbk51bWJlciA9IHZvaWQgMCAhPT0gdDUucmV2aXNpb25OdW1iZXIgJiYgbnVsbCAhPT0gdDUucmV2aXNpb25OdW1iZXIgPyBCaWdJbnQodDUucmV2aXNpb25OdW1iZXIudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGUyLnJldmlzaW9uSGVpZ2h0ID0gdm9pZCAwICE9PSB0NS5yZXZpc2lvbkhlaWdodCAmJiBudWxsICE9PSB0NS5yZXZpc2lvbkhlaWdodCA/IEJpZ0ludCh0NS5yZXZpc2lvbkhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgZTI7XG59LCBmcm9tUHJvdG9Nc2c6ICh0NSkgPT4gSGVpZ2h0LmRlY29kZSh0NS52YWx1ZSksIHRvUHJvdG86ICh0NSkgPT4gSGVpZ2h0LmVuY29kZSh0NSkuZmluaXNoKCksIHRvUHJvdG9Nc2c6ICh0NSkgPT4gKHsgdHlwZVVybDogXCIvaWJjLmNvcmUuY2xpZW50LnYxLkhlaWdodFwiLCB2YWx1ZTogSGVpZ2h0LmVuY29kZSh0NSkuZmluaXNoKCkgfSkgfTtcblxuLy9cbmZ1bmN0aW9uIGkoKSB7XG4gIHJldHVybiB7IHNvdXJjZVBvcnQ6IFwiXCIsIHNvdXJjZUNoYW5uZWw6IFwiXCIsIHRva2VuOiBDb2luLmZyb21QYXJ0aWFsKHt9KSwgc2VuZGVyOiBcIlwiLCByZWNlaXZlcjogXCJcIiwgdGltZW91dEhlaWdodDogSGVpZ2h0LmZyb21QYXJ0aWFsKHt9KSwgdGltZW91dFRpbWVzdGFtcDogQmlnSW50KDApLCBtZW1vOiBcIlwiIH07XG59XG52YXIgTXNnVHJhbnNmZXIgPSB7IHR5cGVVcmw6IFwiL2liYy5hcHBsaWNhdGlvbnMudHJhbnNmZXIudjEuTXNnVHJhbnNmZXJcIiwgZW5jb2RlOiAobzIsIG4yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbzIuc291cmNlUG9ydCAmJiBuMi51aW50MzIoMTApLnN0cmluZyhvMi5zb3VyY2VQb3J0KSwgXCJcIiAhPT0gbzIuc291cmNlQ2hhbm5lbCAmJiBuMi51aW50MzIoMTgpLnN0cmluZyhvMi5zb3VyY2VDaGFubmVsKSwgdm9pZCAwICE9PSBvMi50b2tlbiAmJiBDb2luLmVuY29kZShvMi50b2tlbiwgbjIudWludDMyKDI2KS5mb3JrKCkpLmxkZWxpbSgpLCBcIlwiICE9PSBvMi5zZW5kZXIgJiYgbjIudWludDMyKDM0KS5zdHJpbmcobzIuc2VuZGVyKSwgXCJcIiAhPT0gbzIucmVjZWl2ZXIgJiYgbjIudWludDMyKDQyKS5zdHJpbmcobzIucmVjZWl2ZXIpLCB2b2lkIDAgIT09IG8yLnRpbWVvdXRIZWlnaHQgJiYgSGVpZ2h0LmVuY29kZShvMi50aW1lb3V0SGVpZ2h0LCBuMi51aW50MzIoNTApLmZvcmsoKSkubGRlbGltKCksIG8yLnRpbWVvdXRUaW1lc3RhbXAgIT09IEJpZ0ludCgwKSAmJiBuMi51aW50MzIoNTYpLnVpbnQ2NChvMi50aW1lb3V0VGltZXN0YW1wKSwgXCJcIiAhPT0gbzIubWVtbyAmJiBuMi51aW50MzIoNjYpLnN0cmluZyhvMi5tZW1vKSwgbjIpLCBkZWNvZGUocjUsIG4yKSB7XG4gIGNvbnN0IHMzID0gcjUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyByNSA6IG5ldyBCaW5hcnlSZWFkZXIocjUpO1xuICBsZXQgbTIgPSB2b2lkIDAgPT09IG4yID8gczMubGVuIDogczMucG9zICsgbjI7XG4gIGNvbnN0IGMyID0gaSgpO1xuICBmb3IgKDsgczMucG9zIDwgbTI7ICkge1xuICAgIGNvbnN0IG8yID0gczMudWludDMyKCk7XG4gICAgc3dpdGNoIChvMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBjMi5zb3VyY2VQb3J0ID0gczMuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBjMi5zb3VyY2VDaGFubmVsID0gczMuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBjMi50b2tlbiA9IENvaW4uZGVjb2RlKHMzLCBzMy51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBjMi5zZW5kZXIgPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDU6XG4gICAgICAgIGMyLnJlY2VpdmVyID0gczMuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA2OlxuICAgICAgICBjMi50aW1lb3V0SGVpZ2h0ID0gSGVpZ2h0LmRlY29kZShzMywgczMudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNzpcbiAgICAgICAgYzIudGltZW91dFRpbWVzdGFtcCA9IHMzLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgODpcbiAgICAgICAgYzIubWVtbyA9IHMzLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHMzLnNraXBUeXBlKDcgJiBvMik7XG4gICAgfVxuICB9XG4gIHJldHVybiBjMjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IHNvdXJjZVBvcnQ6IGlzU2V0KG8yLnNvdXJjZVBvcnQpID8gU3RyaW5nKG8yLnNvdXJjZVBvcnQpIDogXCJcIiwgc291cmNlQ2hhbm5lbDogaXNTZXQobzIuc291cmNlQ2hhbm5lbCkgPyBTdHJpbmcobzIuc291cmNlQ2hhbm5lbCkgOiBcIlwiLCB0b2tlbjogaXNTZXQobzIudG9rZW4pID8gQ29pbi5mcm9tSlNPTihvMi50b2tlbikgOiB2b2lkIDAsIHNlbmRlcjogaXNTZXQobzIuc2VuZGVyKSA/IFN0cmluZyhvMi5zZW5kZXIpIDogXCJcIiwgcmVjZWl2ZXI6IGlzU2V0KG8yLnJlY2VpdmVyKSA/IFN0cmluZyhvMi5yZWNlaXZlcikgOiBcIlwiLCB0aW1lb3V0SGVpZ2h0OiBpc1NldChvMi50aW1lb3V0SGVpZ2h0KSA/IEhlaWdodC5mcm9tSlNPTihvMi50aW1lb3V0SGVpZ2h0KSA6IHZvaWQgMCwgdGltZW91dFRpbWVzdGFtcDogaXNTZXQobzIudGltZW91dFRpbWVzdGFtcCkgPyBCaWdJbnQobzIudGltZW91dFRpbWVzdGFtcC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbWVtbzogaXNTZXQobzIubWVtbykgPyBTdHJpbmcobzIubWVtbykgOiBcIlwiIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgcjUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuc291cmNlUG9ydCAmJiAocjUuc291cmNlUG9ydCA9IG8yLnNvdXJjZVBvcnQpLCB2b2lkIDAgIT09IG8yLnNvdXJjZUNoYW5uZWwgJiYgKHI1LnNvdXJjZUNoYW5uZWwgPSBvMi5zb3VyY2VDaGFubmVsKSwgdm9pZCAwICE9PSBvMi50b2tlbiAmJiAocjUudG9rZW4gPSBvMi50b2tlbiA/IENvaW4udG9KU09OKG8yLnRva2VuKSA6IHZvaWQgMCksIHZvaWQgMCAhPT0gbzIuc2VuZGVyICYmIChyNS5zZW5kZXIgPSBvMi5zZW5kZXIpLCB2b2lkIDAgIT09IG8yLnJlY2VpdmVyICYmIChyNS5yZWNlaXZlciA9IG8yLnJlY2VpdmVyKSwgdm9pZCAwICE9PSBvMi50aW1lb3V0SGVpZ2h0ICYmIChyNS50aW1lb3V0SGVpZ2h0ID0gbzIudGltZW91dEhlaWdodCA/IEhlaWdodC50b0pTT04obzIudGltZW91dEhlaWdodCkgOiB2b2lkIDApLCB2b2lkIDAgIT09IG8yLnRpbWVvdXRUaW1lc3RhbXAgJiYgKHI1LnRpbWVvdXRUaW1lc3RhbXAgPSAobzIudGltZW91dFRpbWVzdGFtcCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IG8yLm1lbW8gJiYgKHI1Lm1lbW8gPSBvMi5tZW1vKSwgcjU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCByNSA9IGkoKTtcbiAgcmV0dXJuIHI1LnNvdXJjZVBvcnQgPSBvMi5zb3VyY2VQb3J0ID8/IFwiXCIsIHI1LnNvdXJjZUNoYW5uZWwgPSBvMi5zb3VyY2VDaGFubmVsID8/IFwiXCIsIHI1LnRva2VuID0gdm9pZCAwICE9PSBvMi50b2tlbiAmJiBudWxsICE9PSBvMi50b2tlbiA/IENvaW4uZnJvbVBhcnRpYWwobzIudG9rZW4pIDogdm9pZCAwLCByNS5zZW5kZXIgPSBvMi5zZW5kZXIgPz8gXCJcIiwgcjUucmVjZWl2ZXIgPSBvMi5yZWNlaXZlciA/PyBcIlwiLCByNS50aW1lb3V0SGVpZ2h0ID0gdm9pZCAwICE9PSBvMi50aW1lb3V0SGVpZ2h0ICYmIG51bGwgIT09IG8yLnRpbWVvdXRIZWlnaHQgPyBIZWlnaHQuZnJvbVBhcnRpYWwobzIudGltZW91dEhlaWdodCkgOiB2b2lkIDAsIHI1LnRpbWVvdXRUaW1lc3RhbXAgPSB2b2lkIDAgIT09IG8yLnRpbWVvdXRUaW1lc3RhbXAgJiYgbnVsbCAhPT0gbzIudGltZW91dFRpbWVzdGFtcCA/IEJpZ0ludChvMi50aW1lb3V0VGltZXN0YW1wLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCByNS5tZW1vID0gbzIubWVtbyA/PyBcIlwiLCByNTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBNc2dUcmFuc2Zlci5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IE1zZ1RyYW5zZmVyLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvaWJjLmFwcGxpY2F0aW9ucy50cmFuc2Zlci52MS5Nc2dUcmFuc2ZlclwiLCB2YWx1ZTogTXNnVHJhbnNmZXIuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIGNvZXJjZURlbm9tID0gKGNoYWluSHViLCBkZW5vbUFyZykgPT4ge1xuICBpZiAodHlwZW9mIGRlbm9tQXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIGRlbm9tQXJnO1xuICB9XG4gIGNvbnN0IGRlbm9tID0gY2hhaW5IdWIuZ2V0RGVub20oZGVub21BcmcpO1xuICBpZiAoIWRlbm9tKSB7XG4gICAgdGhyb3cgbWFrZUVycm9yKGBObyBkZW5vbSBmb3IgYnJhbmQgJHtkZW5vbUFyZ31gKTtcbiAgfVxuICByZXR1cm4gZGVub207XG59O1xudmFyIGNvZXJjZURlbm9tQW1vdW50ID0gKGNoYWluSHViLCBhbW91bnQpID0+IHtcbiAgaWYgKFwiZGVub21cIiBpbiBhbW91bnQpIHtcbiAgICByZXR1cm4gYW1vdW50O1xuICB9XG4gIGNvbnN0IGRlbm9tID0gY29lcmNlRGVub20oY2hhaW5IdWIsIGFtb3VudC5icmFuZCk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGRlbm9tLFxuICAgIHZhbHVlOiBhbW91bnQudmFsdWVcbiAgfSk7XG59O1xudmFyIGNvZXJjZUNvaW4gPSAoY2hhaW5IdWIsIGFtb3VudCkgPT4ge1xuICBjb25zdCBkZW5vbSA9IFwiZGVub21cIiBpbiBhbW91bnQgPyBhbW91bnQuZGVub20gOiBjb2VyY2VEZW5vbShjaGFpbkh1YiwgYW1vdW50LmJyYW5kKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgZGVub20sXG4gICAgYW1vdW50OiBTdHJpbmcoYW1vdW50LnZhbHVlKVxuICB9KTtcbn07XG5cbi8vXG52YXIgbWF4Q2xvY2tTa2V3ID0gMTBuICogNjBuO1xudmFyIHRyeURlY29kZVJlc3BvbnNlID0gKGFja1N0ciwgZnJvbVByb3RvTXNnKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgYW55ID0gQW55LmRlY29kZShkZWNvZGVCYXNlNjQoYWNrU3RyKSk7XG4gICAgY29uc3QgcHJvdG9Nc2cgPSBBbnkuZGVjb2RlKGFueS52YWx1ZSk7XG4gICAgY29uc3QgbXNnID0gZnJvbVByb3RvTXNnKHByb3RvTXNnKTtcbiAgICByZXR1cm4gbXNnO1xuICB9IGNhdGNoIChjYXVzZSkge1xuICAgIHRocm93IG1ha2VFcnJvcihgYmFkIHJlc3BvbnNlOiAke2Fja1N0cn1gLCB2b2lkIDAsIHsgY2F1c2UgfSk7XG4gIH1cbn07XG52YXIgdG9EZW5vbUFtb3VudCA9IChjMikgPT4gKHsgZGVub206IGMyLmRlbm9tLCB2YWx1ZTogQmlnSW50KGMyLmFtb3VudCkgfSk7XG52YXIgdG9UcnVuY2F0ZWREZW5vbUFtb3VudCA9IChjMikgPT4gKHtcbiAgZGVub206IGMyLmRlbm9tLFxuICB2YWx1ZTogQmlnSW50KGMyLmFtb3VudC5zcGxpdChcIi5cIilbMF0pXG59KTtcbnZhciB0b0Nvc21vc1ZhbGlkYXRvckFkZHJlc3MgPSAocjUsIGNoYWluSWQpID0+ICh7XG4gIGVuY29kaW5nOiBcImJlY2gzMlwiLFxuICB2YWx1ZTogKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICByNS52YWxpZGF0b3JBZGRyZXNzXG4gICksXG4gIGNoYWluSWRcbn0pO1xudmFyIHRvQ29zbW9zRGVsZWdhdGlvblJlc3BvbnNlID0gKHsgY2hhaW5JZCB9LCByNSkgPT4gKHtcbiAgZGVsZWdhdG9yOiB7XG4gICAgY2hhaW5JZCxcbiAgICBlbmNvZGluZzogXCJiZWNoMzJcIixcbiAgICB2YWx1ZTogKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgcjUuZGVsZWdhdGlvbi5kZWxlZ2F0b3JBZGRyZXNzXG4gICAgKVxuICB9LFxuICB2YWxpZGF0b3I6IHRvQ29zbW9zVmFsaWRhdG9yQWRkcmVzcyhyNS5kZWxlZ2F0aW9uLCBjaGFpbklkKSxcbiAgYW1vdW50OiB0b0Rlbm9tQW1vdW50KHI1LmJhbGFuY2UpXG59KTtcblxuLy9cbnZhciBQdWJsaWNUb3BpY1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIHN1YnNjcmliZXI6IFN1YnNjcmliZXJTaGFwZSxcbiAgICBzdG9yYWdlUGF0aDogTS5vcihNLnByb21pc2UoXG4gICAgICAvKiAgICAgICAgKi9cbiAgICApLCBNLnN0cmluZygpKVxuICB9LFxuICB7IGRlc2NyaXB0aW9uOiBNLnN0cmluZygpIH1cbik7XG52YXIgVG9waWNzUmVjb3JkU2hhcGUgPSBNLnJlY29yZE9mKE0uc3RyaW5nKCksIFB1YmxpY1RvcGljU2hhcGUpO1xudmFyIG1ha2VSZWNvcmRlclRvcGljID0gKGRlc2NyaXB0aW9uLCByZWNvcmRlcktpdCkgPT4ge1xuICBjb25zdCByZWNQID0gXCJyZWNvcmRlclwiIGluIHJlY29yZGVyS2l0ID8gcmVjb3JkZXJLaXQucmVjb3JkZXIgOiByZWNvcmRlcktpdC5yZWNvcmRlclA7XG4gIHJldHVybiB7XG4gICAgZGVzY3JpcHRpb24sXG4gICAgc3Vic2NyaWJlcjogcmVjb3JkZXJLaXQuc3Vic2NyaWJlcixcbiAgICBzdG9yYWdlUGF0aDogRShyZWNQKS5nZXRTdG9yYWdlUGF0aCgpXG4gIH07XG59O1xuXG4vL1xudmFyIHsgVm93JDogVm93JDIgfSA9IFNoYXBlO1xudmFyIG9yY2hlc3RyYXRpb25BY2NvdW50TWV0aG9kcyA9IHtcbiAgZ2V0QWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSksXG4gIGdldEJhbGFuY2U6IE0uY2FsbChNLm9yKEJyYW5kU2hhcGUsIE0uc3RyaW5nKCkpKS5yZXR1cm5zKFxuICAgIFZvdyQyKERlbm9tQW1vdW50U2hhcGUpXG4gICksXG4gIGdldEJhbGFuY2VzOiBNLmNhbGwoKS5yZXR1cm5zKFZvdyQyKE0uYXJyYXlPZihEZW5vbUFtb3VudFNoYXBlKSkpLFxuICBzZW5kOiBNLmNhbGwoQWNjb3VudElkQXJnU2hhcGUsIEFtb3VudEFyZ1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgc2VuZEFsbDogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlLCBNLmFycmF5T2YoQW1vdW50QXJnU2hhcGUpKS5yZXR1cm5zKFxuICAgIFZvd1NoYXBlXG4gICksXG4gIHRyYW5zZmVyOiBNLmNhbGwoQWNjb3VudElkQXJnU2hhcGUsIEFtb3VudEFyZ1NoYXBlKS5vcHRpb25hbChJQkNUcmFuc2Zlck9wdGlvbnNTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIHRyYW5zZmVyU3RlcHM6IE0uY2FsbChBbW91bnRBcmdTaGFwZSwgTS5hbnkoKSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGFzQ29udGludWluZ09mZmVyOiBNLmNhbGwoKS5yZXR1cm5zKFxuICAgIFZvdyQyKHtcbiAgICAgIHB1YmxpY1N1YnNjcmliZXJzOiBUb3BpY3NSZWNvcmRTaGFwZSxcbiAgICAgIGludml0YXRpb25NYWtlcnM6IE0uYW55KCksXG4gICAgICBob2xkZXI6IE0ucmVtb3RhYmxlKClcbiAgICB9KVxuICApLFxuICBnZXRQdWJsaWNUb3BpY3M6IE0uY2FsbCgpLnJldHVybnMoVm93JDIoVG9waWNzUmVjb3JkU2hhcGUpKVxufTtcblxuLy9cbnZhciBUaW1lckJyYW5kU2hhcGUgPSBNLnJlbW90YWJsZShcIlRpbWVyQnJhbmRcIik7XG52YXIgVGltZXN0YW1wVmFsdWVTaGFwZSA9IE0ubmF0KCk7XG52YXIgUmVsYXRpdmVUaW1lVmFsdWVTaGFwZSA9IE0ubmF0KCk7XG52YXIgVGltZXN0YW1wUmVjb3JkU2hhcGUgPSB7XG4gIHRpbWVyQnJhbmQ6IFRpbWVyQnJhbmRTaGFwZSxcbiAgYWJzVmFsdWU6IFRpbWVzdGFtcFZhbHVlU2hhcGVcbn07XG5oYXJkZW4oVGltZXN0YW1wUmVjb3JkU2hhcGUpO1xudmFyIFJlbGF0aXZlVGltZVJlY29yZFNoYXBlID0ge1xuICB0aW1lckJyYW5kOiBUaW1lckJyYW5kU2hhcGUsXG4gIHJlbFZhbHVlOiBSZWxhdGl2ZVRpbWVWYWx1ZVNoYXBlXG59O1xuaGFyZGVuKFJlbGF0aXZlVGltZVJlY29yZFNoYXBlKTtcbnZhciBUaW1lc3RhbXBTaGFwZSA9IE0ub3IoVGltZXN0YW1wUmVjb3JkU2hhcGUsIFRpbWVzdGFtcFZhbHVlU2hhcGUpO1xudmFyIFJlbGF0aXZlVGltZVNoYXBlID0gTS5vcihcbiAgUmVsYXRpdmVUaW1lUmVjb3JkU2hhcGUsXG4gIFJlbGF0aXZlVGltZVZhbHVlU2hhcGVcbik7XG52YXIgVGltZXJTZXJ2aWNlU2hhcGUgPSBNLnJlbW90YWJsZShcIlRpbWVyU2VydmljZVwiKTtcblxuLy9cbnZhciBhZ3JlZWRUaW1lckJyYW5kID0gKGxlZnRCcmFuZCwgcmlnaHRCcmFuZCkgPT4ge1xuICBpZiAobGVmdEJyYW5kID09PSB2b2lkIDApIHtcbiAgICBpZiAocmlnaHRCcmFuZCA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcmlnaHRCcmFuZDtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmlnaHRCcmFuZCA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIGxlZnRCcmFuZDtcbiAgfSBlbHNlIHtcbiAgICBsZWZ0QnJhbmQgPT09IHJpZ2h0QnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBUaW1lckJyYW5kcyBtdXN0IG1hdGNoOiAke3F1b3RlKGxlZnRCcmFuZCl9IHZzICR7cXVvdGUocmlnaHRCcmFuZCl9YDtcbiAgICByZXR1cm4gbGVmdEJyYW5kO1xuICB9XG59O1xudmFyIHNoYXJlZFRpbWVyQnJhbmQgPSAobGVmdCwgcmlnaHQpID0+IHtcbiAgY29uc3QgbGVmdEJyYW5kID0gdHlwZW9mIGxlZnQgPT09IFwiYmlnaW50XCIgPyB2b2lkIDAgOiBsZWZ0LnRpbWVyQnJhbmQ7XG4gIGNvbnN0IHJpZ2h0QnJhbmQgPSB0eXBlb2YgcmlnaHQgPT09IFwiYmlnaW50XCIgPyB2b2lkIDAgOiByaWdodC50aW1lckJyYW5kO1xuICByZXR1cm4gYWdyZWVkVGltZXJCcmFuZChsZWZ0QnJhbmQsIHJpZ2h0QnJhbmQpO1xufTtcbnZhciBhYnNMaWtlID0gKGxlZnQsIHJpZ2h0LCBhYnNWYWx1ZTIpID0+IHtcbiAgTmF0KGFic1ZhbHVlMik7XG4gIGNvbnN0IHRpbWVyQnJhbmQgPSBzaGFyZWRUaW1lckJyYW5kKGxlZnQsIHJpZ2h0KTtcbiAgaWYgKHRpbWVyQnJhbmQpIHtcbiAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgIHRpbWVyQnJhbmQsXG4gICAgICBhYnNWYWx1ZTogYWJzVmFsdWUyXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGFic1ZhbHVlMjtcbiAgfVxufTtcbnZhciByZWxMaWtlID0gKGxlZnQsIHJpZ2h0LCByZWxWYWx1ZTIpID0+IHtcbiAgTmF0KHJlbFZhbHVlMik7XG4gIGNvbnN0IHRpbWVyQnJhbmQgPSBzaGFyZWRUaW1lckJyYW5kKGxlZnQsIHJpZ2h0KTtcbiAgaWYgKHRpbWVyQnJhbmQpIHtcbiAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgIHRpbWVyQnJhbmQsXG4gICAgICByZWxWYWx1ZTogcmVsVmFsdWUyXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHJlbFZhbHVlMjtcbiAgfVxufTtcbnZhciBhYnNWYWx1ZSA9IChhYnMpID0+IHtcbiAgaWYgKHR5cGVvZiBhYnMgPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4gTmF0KGFicyk7XG4gIH1cbiAgbXVzdE1hdGNoMihhYnMsIFRpbWVzdGFtcFJlY29yZFNoYXBlLCBcInRpbWVzdGFtcFwiKTtcbiAgcmV0dXJuIE5hdChhYnMuYWJzVmFsdWUpO1xufTtcbnZhciByZWxWYWx1ZSA9IChyZWwpID0+IHtcbiAgaWYgKHR5cGVvZiByZWwgPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4gTmF0KHJlbCk7XG4gIH1cbiAgbXVzdE1hdGNoMihyZWwsIFJlbGF0aXZlVGltZVJlY29yZFNoYXBlLCBcInJlbGF0aXZlXCIpO1xuICByZXR1cm4gTmF0KHJlbC5yZWxWYWx1ZSk7XG59O1xudmFyIG1ha2VUaW1lc3RhbXBSZWNvcmQgPSAoYWJzLCB0aW1lckJyYW5kKSA9PiBoYXJkZW4oeyBhYnNWYWx1ZTogYWJzLCB0aW1lckJyYW5kIH0pO1xudmFyIG1ha2VSZWxhdGl2ZVRpbWVSZWNvcmQgPSAocmVsLCB0aW1lckJyYW5kKSA9PiBoYXJkZW4oeyByZWxWYWx1ZTogcmVsLCB0aW1lckJyYW5kIH0pO1xudmFyIGNvZXJjZVRpbWVzdGFtcFJlY29yZCA9ICh0cywgYnJhbmQpID0+IHtcbiAgYnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBtdXN0IGhhdmUgYSBicmFuZGA7XG4gIGlmICh0eXBlb2YgdHMgPT09IFwibnVtYmVyXCIpIHtcbiAgICB0cyA9IE5hdCh0cyk7XG4gIH1cbiAgaWYgKHR5cGVvZiB0cyA9PT0gXCJiaWdpbnRcIikge1xuICAgIHJldHVybiBtYWtlVGltZXN0YW1wUmVjb3JkKHRzLCBicmFuZCk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgeyB0aW1lckJyYW5kIH0gPSB0cztcbiAgICBtdXN0TWF0Y2gyKHRzLCBUaW1lc3RhbXBSZWNvcmRTaGFwZSwgXCJ0aW1lc3RhbXBcIik7XG4gICAgYWdyZWVkVGltZXJCcmFuZCh0aW1lckJyYW5kLCBicmFuZCk7XG4gICAgcmV0dXJuIHRzO1xuICB9XG59O1xudmFyIGNvZXJjZVJlbGF0aXZlVGltZVJlY29yZCA9IChydCwgYnJhbmQpID0+IHtcbiAgYnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBtdXN0IGhhdmUgYSBicmFuZGA7XG4gIGlmICh0eXBlb2YgcnQgPT09IFwibnVtYmVyXCIpIHtcbiAgICBydCA9IE5hdChydCk7XG4gIH1cbiAgaWYgKHR5cGVvZiBydCA9PT0gXCJiaWdpbnRcIikge1xuICAgIHJldHVybiBtYWtlUmVsYXRpdmVUaW1lUmVjb3JkKHJ0LCBicmFuZCk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgeyB0aW1lckJyYW5kIH0gPSBydDtcbiAgICBtdXN0TWF0Y2gyKHJ0LCBSZWxhdGl2ZVRpbWVSZWNvcmRTaGFwZSwgXCJyZWxhdGl2ZVRpbWVcIik7XG4gICAgYWdyZWVkVGltZXJCcmFuZCh0aW1lckJyYW5kLCBicmFuZCk7XG4gICAgcmV0dXJuIHJ0O1xuICB9XG59O1xudmFyIGFkZEFic1JlbCA9IChhYnMsIHJlbCkgPT4gYWJzTGlrZShhYnMsIHJlbCwgYWJzVmFsdWUoYWJzKSArIHJlbFZhbHVlKHJlbCkpO1xudmFyIGFkZFJlbFJlbCA9IChyZWwxLCByZWwyKSA9PiByZWxMaWtlKHJlbDEsIHJlbDIsIHJlbFZhbHVlKHJlbDEpICsgcmVsVmFsdWUocmVsMikpO1xudmFyIHN1YnRyYWN0QWJzQWJzID0gKGFiczEsIGFiczIpID0+IHJlbExpa2UoYWJzMSwgYWJzMiwgYWJzVmFsdWUoYWJzMSkgLSBhYnNWYWx1ZShhYnMyKSk7XG52YXIgY2xhbXBlZFN1YnRyYWN0QWJzQWJzID0gKGFiczEsIGFiczIpID0+IHtcbiAgY29uc3QgdmFsMSA9IGFic1ZhbHVlKGFiczEpO1xuICBjb25zdCB2YWwyID0gYWJzVmFsdWUoYWJzMik7XG4gIHJldHVybiByZWxMaWtlKGFiczEsIGFiczIsIHZhbDEgPiB2YWwyID8gdmFsMSAtIHZhbDIgOiAwbik7XG59O1xudmFyIHN1YnRyYWN0QWJzUmVsID0gKGFicywgcmVsKSA9PiBhYnNMaWtlKGFicywgcmVsLCBhYnNWYWx1ZShhYnMpIC0gcmVsVmFsdWUocmVsKSk7XG52YXIgc3VidHJhY3RSZWxSZWwgPSAocmVsMSwgcmVsMikgPT4gcmVsTGlrZShyZWwxLCByZWwyLCByZWxWYWx1ZShyZWwxKSAtIHJlbFZhbHVlKHJlbDIpKTtcbnZhciBpc1JlbFplcm8gPSAocmVsKSA9PiByZWxWYWx1ZShyZWwpID09PSAwbjtcbnZhciBtdWx0aXBseVJlbE5hdCA9IChyZWwsIG5hdCkgPT4gcmVsTGlrZShyZWwsIG5hdCwgcmVsVmFsdWUocmVsKSAqIG5hdCk7XG52YXIgZGl2aWRlUmVsTmF0ID0gKHJlbCwgbmF0KSA9PiByZWxMaWtlKHJlbCwgbmF0LCByZWxWYWx1ZShyZWwpIC8gbmF0KTtcbnZhciBkaXZpZGVSZWxSZWwgPSAocmVsMSwgcmVsMikgPT4ge1xuICBzaGFyZWRUaW1lckJyYW5kKHJlbDEsIHJlbDIpO1xuICByZXR1cm4gcmVsVmFsdWUocmVsMSkgLyByZWxWYWx1ZShyZWwyKTtcbn07XG52YXIgbW9kQWJzUmVsID0gKGFicywgc3RlcCkgPT4gcmVsTGlrZShhYnMsIHN0ZXAsIGFic1ZhbHVlKGFicykgJSByZWxWYWx1ZShzdGVwKSk7XG52YXIgbW9kUmVsUmVsID0gKHJlbCwgc3RlcCkgPT4gcmVsTGlrZShyZWwsIHN0ZXAsIHJlbFZhbHVlKHJlbCkgJSByZWxWYWx1ZShzdGVwKSk7XG52YXIgY29tcGFyZVZhbHVlcyA9IChsZWZ0LCByaWdodCwgdjEsIHYyKSA9PiB7XG4gIHNoYXJlZFRpbWVyQnJhbmQobGVmdCwgcmlnaHQpO1xuICBpZiAodjEgPCB2Mikge1xuICAgIHJldHVybiAtMTtcbiAgfSBlbHNlIGlmICh2MSA9PT0gdjIpIHtcbiAgICByZXR1cm4gMDtcbiAgfSBlbHNlIHtcbiAgICBhc3NlcnQodjEgPiB2Mik7XG4gICAgcmV0dXJuIDE7XG4gIH1cbn07XG52YXIgVGltZU1hdGggPSBoYXJkZW4oe1xuICBhYnNWYWx1ZSxcbiAgcmVsVmFsdWUsXG4gIGNvZXJjZVRpbWVzdGFtcFJlY29yZCxcbiAgY29lcmNlUmVsYXRpdmVUaW1lUmVjb3JkLFxuICAvL1xuICBhZGRBYnNSZWwsXG4gIC8vXG4gIGFkZFJlbFJlbCxcbiAgc3VidHJhY3RBYnNBYnMsXG4gIGNsYW1wZWRTdWJ0cmFjdEFic0FicyxcbiAgc3VidHJhY3RBYnNSZWwsXG4gIHN1YnRyYWN0UmVsUmVsLFxuICBpc1JlbFplcm8sXG4gIG11bHRpcGx5UmVsTmF0LFxuICBkaXZpZGVSZWxOYXQsXG4gIGRpdmlkZVJlbFJlbCxcbiAgbW9kQWJzUmVsLFxuICBtb2RSZWxSZWwsXG4gIGNvbXBhcmVBYnM6IChhYnMxLCBhYnMyKSA9PiBjb21wYXJlVmFsdWVzKGFiczEsIGFiczIsIGFic1ZhbHVlKGFiczEpLCBhYnNWYWx1ZShhYnMyKSksXG4gIGNvbXBhcmVSZWw6IChyZWwxLCByZWwyKSA9PiBjb21wYXJlVmFsdWVzKHJlbDEsIHJlbDIsIHJlbFZhbHVlKHJlbDEpLCByZWxWYWx1ZShyZWwyKSlcbn0pO1xuXG4vL1xudmFyIFNFQ09ORFNfUEVSX01JTlVURSA9IDYwbjtcbnZhciBOQU5PU0VDT05EU19QRVJfU0VDT05EID0gMTAwMDAwMDAwMG47XG5mdW5jdGlvbiBtYWtlVGltZXN0YW1wSGVscGVyKHRpbWVyKSB7XG4gIGNvbnN0IHNlbGYgPSBoYXJkZW4oe1xuICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgYXN5bmMgZ2V0VGltZW91dFRpbWVzdGFtcE5TKHNlY29uZHNJbkZ1dHVyZSA9IFNFQ09ORFNfUEVSX01JTlVURSAqIDVuKSB7XG4gICAgICBjb25zdCBjdXJyZW50VGltZSA9IGF3YWl0IEUodGltZXIpLmdldEN1cnJlbnRUaW1lc3RhbXAoKTtcbiAgICAgIGNvbnN0IHRpbWVvdXQgPSBUaW1lTWF0aC5jb2VyY2VSZWxhdGl2ZVRpbWVSZWNvcmQoXG4gICAgICAgIHNlY29uZHNJbkZ1dHVyZSxcbiAgICAgICAgY3VycmVudFRpbWUudGltZXJCcmFuZFxuICAgICAgKTtcbiAgICAgIHJldHVybiBUaW1lTWF0aC5hZGRBYnNSZWwoY3VycmVudFRpbWUsIHRpbWVvdXQpLmFic1ZhbHVlICogTkFOT1NFQ09ORFNfUEVSX1NFQ09ORDtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgdm93T3JWYWx1ZUZyb21PcHRzKG9wdHMpIHtcbiAgICAgIGlmIChvcHRzICYmIFwidGltZW91dFRpbWVzdGFtcFwiIGluIG9wdHMpIHJldHVybiBvcHRzLnRpbWVvdXRUaW1lc3RhbXA7XG4gICAgICBpZiAob3B0cyAmJiBcInRpbWVvdXRIZWlnaHRcIiBpbiBvcHRzKSByZXR1cm4gMG47XG4gICAgICByZXR1cm4gc2VsZi5nZXRUaW1lb3V0VGltZXN0YW1wTlMoXG4gICAgICAgIG9wdHMgJiYgXCJ0aW1lb3V0UmVsYXRpdmVTZWNvbmRzXCIgaW4gb3B0cyA/IG9wdHMudGltZW91dFJlbGF0aXZlU2Vjb25kcyA6IHZvaWQgMFxuICAgICAgKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gc2VsZjtcbn1cblxuLy9cbnZhciB0cmFjZTMgPSBtYWtlVHJhY2VyKFwiQ29zbW9zT3JjaEFjY291bnRcIik7XG52YXIgeyBWb3ckOiBWb3ckMyB9ID0gU2hhcGU7XG52YXIgc3Rha2luZ0FjY291bnRBY3Rpb25zTWV0aG9kcyA9IHtcbiAgZGVsZWdhdGU6IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSwgQW1vdW50QXJnU2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICByZWRlbGVnYXRlOiBNLmNhbGwoXG4gICAgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsXG4gICAgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsXG4gICAgQW1vdW50QXJnU2hhcGVcbiAgKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgdW5kZWxlZ2F0ZTogTS5jYWxsKE0uYXJyYXlPZihEZWxlZ2F0aW9uU2hhcGUpKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgd2l0aGRyYXdSZXdhcmQ6IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSkucmV0dXJucyhcbiAgICBWb3ckMyhNLmFycmF5T2YoRGVub21BbW91bnRTaGFwZSkpXG4gICksXG4gIHdpdGhkcmF3UmV3YXJkczogTS5jYWxsKCkucmV0dXJucyhWb3ckMyhNLmFycmF5T2YoRGVub21BbW91bnRTaGFwZSkpKVxufTtcbnZhciBzdGFraW5nQWNjb3VudFF1ZXJpZXNNZXRob2RzID0ge1xuICBnZXREZWxlZ2F0aW9uOiBNLmNhbGwoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICBnZXREZWxlZ2F0aW9uczogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldFVuYm9uZGluZ0RlbGVnYXRpb246IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldFVuYm9uZGluZ0RlbGVnYXRpb25zOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0UmVkZWxlZ2F0aW9uczogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldFJld2FyZDogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0UmV3YXJkczogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSlcbn07XG52YXIgbm9ibGVNZXRob2RzID0ge1xuICBkZXBvc2l0Rm9yQnVybjogTS5jYWxsKE0uc3RyaW5nKCksIEFtb3VudEFyZ1NoYXBlKS5vcHRpb25hbChNLnN0cmluZygpKS5yZXR1cm5zKFZvd1NoYXBlKVxufTtcbnZhciBJY2FBY2NvdW50SG9sZGVySSA9IE0uaW50ZXJmYWNlKFwiSWNhQWNjb3VudEhvbGRlclwiLCB7XG4gIC4uLm5vYmxlTWV0aG9kcyxcbiAgLi4ub3JjaGVzdHJhdGlvbkFjY291bnRNZXRob2RzLFxuICAuLi5zdGFraW5nQWNjb3VudEFjdGlvbnNNZXRob2RzLFxuICAuLi5zdGFraW5nQWNjb3VudFF1ZXJpZXNNZXRob2RzLFxuICBkZWFjdGl2YXRlOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgcmVhY3RpdmF0ZTogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIGV4ZWN1dGVFbmNvZGVkVHg6IE0uY2FsbChNLmFycmF5T2YoUHJvdG8zU2hhcGUpKS5vcHRpb25hbChFeGVjdXRlSUNBVHhPcHRzU2hhcGUpLnJldHVybnMoVm93U2hhcGUpXG59KTtcbnZhciBQVUJMSUNfVE9QSUNTID0ge1xuICBhY2NvdW50OiBbXCJTdGFraW5nIEFjY291bnQgaG9sZGVyIHN0YXR1c1wiLCBNLmFueSgpXVxufTtcbnZhciBDb3Ntb3NPcmNoZXN0cmF0aW9uSW52aXRhdGlvbk1ha2Vyc0kgPSBNLmludGVyZmFjZShcbiAgXCJpbnZpdGF0aW9uTWFrZXJzXCIsXG4gIHtcbiAgICBEZWxlZ2F0ZTogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlLCBBbW91bnRBcmdTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ucHJvbWlzZSgpXG4gICAgKSxcbiAgICBSZWRlbGVnYXRlOiBNLmNhbGwoXG4gICAgICBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICAgIENvc21vc0NoYWluQWRkcmVzc1NoYXBlLFxuICAgICAgQW1vdW50QXJnU2hhcGVcbiAgICApLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFdpdGhkcmF3UmV3YXJkOiBNLmNhbGwoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFVuZGVsZWdhdGU6IE0uY2FsbChNLmFycmF5T2YoRGVsZWdhdGlvblNoYXBlKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgRGVhY3RpdmF0ZUFjY291bnQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFJlYWN0aXZhdGVBY2NvdW50OiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICBUcmFuc2ZlckFjY291bnQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFNlbmQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFNlbmRBbGw6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFRyYW5zZmVyOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICB9XG4pO1xuaGFyZGVuKENvc21vc09yY2hlc3RyYXRpb25JbnZpdGF0aW9uTWFrZXJzSSk7XG52YXIgcHJlcGFyZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50S2l0ID0gKHpvbmUsIHtcbiAgY2hhaW5IdWIsXG4gIG1ha2VSZWNvcmRlcktpdCxcbiAgdGltZXJTZXJ2aWNlLFxuICB2b3dUb29sczogeyB3YXRjaCwgYXNWb3csIHdoZW4sIGFsbFZvd3MgfSxcbiAgemNmXG59KSA9PiB7XG4gIGNvbnN0IHRpbWVzdGFtcEhlbHBlciA9IG1ha2VUaW1lc3RhbXBIZWxwZXIodGltZXJTZXJ2aWNlKTtcbiAgY29uc3QgbWFrZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50S2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIkNvc21vcyBPcmNoZXN0cmF0aW9uIEFjY291bnQgSG9sZGVyXCIsXG4gICAge1xuICAgICAgaGVscGVyOiBNLmludGVyZmFjZShcImhlbHBlclwiLCB7XG4gICAgICAgIG93bmVkOiBNLmNhbGwoKS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpLFxuICAgICAgICBnZXRVcGRhdGVyOiBNLmNhbGwoKS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpLFxuICAgICAgICBhbW91bnRUb0NvaW46IE0uY2FsbChBbW91bnRBcmdTaGFwZSkucmV0dXJucyhNLnJlY29yZCgpKVxuICAgICAgfSksXG4gICAgICByZXR1cm5Wb2lkV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZXR1cm5Wb2lkV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpXG4gICAgICB9KSxcbiAgICAgIGJhbGFuY2VRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiYmFsYW5jZVF1ZXJ5V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS5vcihNLnJlY29yZCgpLCBNLnVuZGVmaW5lZCgpKSlcbiAgICAgIH0pLFxuICAgICAgYWxsQmFsYW5jZXNRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiYWxsQmFsYW5jZXNRdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICB1bmRlbGVnYXRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJ1bmRlbGVnYXRlV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKFZvdyQzKE0ucHJvbWlzZSgpKSlcbiAgICAgIH0pLFxuICAgICAgd2l0aGRyYXdSZXdhcmRXYXRjaGVyOiBNLmludGVyZmFjZShcIndpdGhkcmF3UmV3YXJkV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKE0uYXJyYXlPZihEZW5vbUFtb3VudFNoYXBlKSlcbiAgICAgIH0pLFxuICAgICAgdHJhbnNmZXJXYXRjaGVyOiBNLmludGVyZmFjZShcInRyYW5zZmVyV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoW00ucmVjb3JkKCksIE0ubmF0KCldKS5vcHRpb25hbCh7XG4gICAgICAgICAgZGVzdGluYXRpb246IENvc21vc0NoYWluQWRkcmVzc1NoYXBlLFxuICAgICAgICAgIG9wdHM6IE0ub3IoTS51bmRlZmluZWQoKSwgSUJDVHJhbnNmZXJPcHRpb25zU2hhcGUpLFxuICAgICAgICAgIHRva2VuOiB7XG4gICAgICAgICAgICBkZW5vbTogTS5zdHJpbmcoKSxcbiAgICAgICAgICAgIGFtb3VudDogTS5zdHJpbmcoKVxuICAgICAgICAgIH1cbiAgICAgICAgfSkucmV0dXJucyhWb3ckMyhNLnJlY29yZCgpKSlcbiAgICAgIH0pLFxuICAgICAgZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJkZWxlZ2F0aW9uUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoTS5yZWNvcmQoKSlcbiAgICAgIH0pLFxuICAgICAgZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICB1bmJvbmRpbmdEZWxlZ2F0aW9uUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcbiAgICAgICAgXCJ1bmJvbmRpbmdEZWxlZ2F0aW9uUXVlcnlXYXRjaGVyXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhNLnJlY29yZCgpKVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgdW5ib25kaW5nRGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgICBcInVuYm9uZGluZ0RlbGVnYXRpb25zUXVlcnlXYXRjaGVyXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICAgIE0uYXJyYXlPZihNLnJlY29yZCgpKVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHJlZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZWRlbGVnYXRpb25RdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICByZWRlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcInJlZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICByZXdhcmRRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmV3YXJkUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoXG4gICAgICAgICAgTS5hcnJheU9mKE0ucmVjb3JkKCkpXG4gICAgICAgIClcbiAgICAgIH0pLFxuICAgICAgcmV3YXJkc1F1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZXdhcmRzUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoTS5yZWNvcmQoKSlcbiAgICAgIH0pLFxuICAgICAgaG9sZGVyOiBJY2FBY2NvdW50SG9sZGVySSxcbiAgICAgIGludml0YXRpb25NYWtlcnM6IENvc21vc09yY2hlc3RyYXRpb25JbnZpdGF0aW9uTWFrZXJzSVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgICh7IGNoYWluQWRkcmVzcywgbG9jYWxBZGRyZXNzLCByZW1vdGVBZGRyZXNzIH0sIGlvKSA9PiB7XG4gICAgICB0cmFjZTMoXCJjb3Ntb3Mgb3JjaCBhY2N0IGluaXRcIiwge1xuICAgICAgICBjaGFpbkFkZHJlc3MsXG4gICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgcmVtb3RlQWRkcmVzc1xuICAgICAgfSk7XG4gICAgICBjb25zdCB7IHN0b3JhZ2VOb2RlIH0gPSBpbztcbiAgICAgIGNvbnN0IHRvcGljS2l0ID0gc3RvcmFnZU5vZGUgPyBtYWtlUmVjb3JkZXJLaXQoc3RvcmFnZU5vZGUsIFBVQkxJQ19UT1BJQ1MuYWNjb3VudFsxXSkgOiB2b2lkIDA7XG4gICAgICBpZiAodG9waWNLaXQpIHtcbiAgICAgICAgdm9pZCBFKHRvcGljS2l0LnJlY29yZGVyKS53cml0ZShcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgICAgIHJlbW90ZUFkZHJlc3NcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGFjY291bnQsIGljcUNvbm5lY3Rpb24sIHRpbWVyIH0gPSBpbztcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjY291bnQsXG4gICAgICAgIGNoYWluQWRkcmVzcyxcbiAgICAgICAgaWNxQ29ubmVjdGlvbixcbiAgICAgICAgbG9jYWxBZGRyZXNzLFxuICAgICAgICByZW1vdGVBZGRyZXNzLFxuICAgICAgICB0aW1lcixcbiAgICAgICAgdG9waWNLaXRcbiAgICAgIH07XG4gICAgfSxcbiAgICB7XG4gICAgICBoZWxwZXI6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb3duZWQoKSB7XG4gICAgICAgICAgY29uc3QgeyBhY2NvdW50IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICghYWNjb3VudCkge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBVc2luZyBhY2NvdW50IGhvbGRlciBhZnRlciB0cmFuc2ZlcmA7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBhY2NvdW50O1xuICAgICAgICB9LFxuICAgICAgICBnZXRVcGRhdGVyKCkge1xuICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS50b3BpY0tpdCkgdGhyb3cgdGhyb3dSZWRhY3RlZGBubyB0b3BpY0tpdGA7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUudG9waWNLaXQucmVjb3JkZXI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgYW1vdW50VG9Db2luKGFtb3VudCkge1xuICAgICAgICAgICEoXCJicmFuZFwiIGluIGFtb3VudCkgfHwgdGhyb3dSZWRhY3RlZGAnYW1vdW50VG9Db2luJyBub3Qgd29ya2luZyBmb3IgJHtxdW90ZShhbW91bnQuYnJhbmQpfSB1bnRpbCAjMTA0NDk7IHVzZSAnRGVub21BbW91bnQnIGZvciBub3dgO1xuICAgICAgICAgIHJldHVybiBjb2VyY2VDb2luKGNoYWluSHViLCBhbW91bnQpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYmFsYW5jZVF1ZXJ5V2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGlmICghcmVzdWx0Py5rZXkpIHRocm93IHRocm93UmVkYWN0ZWRgRXJyb3IgcGFyc2luZyByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IGJhbGFuY2UgfSA9IFF1ZXJ5QmFsYW5jZVJlc3BvbnNlLmRlY29kZShcbiAgICAgICAgICAgIGRlY29kZUJhc2U2NChyZXN1bHQua2V5KVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFiYWxhbmNlKSB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgYmFsYW5jZSBrZXk6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih0b0Rlbm9tQW1vdW50KGJhbGFuY2UpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlbGVnYXRpb25RdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGlmICghcmVzdWx0Py5rZXkpIHRocm93IHRocm93UmVkYWN0ZWRgRXJyb3IgcGFyc2luZyByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IGRlbGVnYXRpb25SZXNwb25zZSB9ID0gUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2UuZGVjb2RlKFxuICAgICAgICAgICAgZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIWRlbGVnYXRpb25SZXNwb25zZSlcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCBkZWxlZ2F0aW9uUmVzcG9uc2Uga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oXG4gICAgICAgICAgICB0b0Nvc21vc0RlbGVnYXRpb25SZXNwb25zZShjaGFpbkFkZHJlc3MsIGRlbGVnYXRpb25SZXNwb25zZSlcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGlmICghcmVzdWx0Py5rZXkpIHRocm93IHRocm93UmVkYWN0ZWRgRXJyb3IgcGFyc2luZyByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IGRlbGVnYXRpb25SZXNwb25zZXMgfSA9IFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXNwb25zZS5kZWNvZGUoZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpKTtcbiAgICAgICAgICBpZiAoIWRlbGVnYXRpb25SZXNwb25zZXMpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgZGVsZWdhdGlvblJlc3BvbnNlcyBrZXk6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbihcbiAgICAgICAgICAgIGRlbGVnYXRpb25SZXNwb25zZXMubWFwKFxuICAgICAgICAgICAgICAocjUpID0+IHRvQ29zbW9zRGVsZWdhdGlvblJlc3BvbnNlKGNoYWluQWRkcmVzcywgcjUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHVuYm9uZGluZ0RlbGVnYXRpb25RdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBpZiAoIXJlc3VsdD8ua2V5KSB0aHJvdyB0aHJvd1JlZGFjdGVkYEVycm9yIHBhcnNpbmcgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyB1bmJvbmQgfSA9IFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShcbiAgICAgICAgICAgIGRlY29kZUJhc2U2NChyZXN1bHQua2V5KVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCF1bmJvbmQpIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCB1bmJvbmQga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4odW5ib25kKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHVuYm9uZGluZ0RlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgaWYgKCFyZXN1bHQ/LmtleSkgdGhyb3cgdGhyb3dSZWRhY3RlZGBFcnJvciBwYXJzaW5nIHJlc3VsdCAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgdW5ib25kaW5nUmVzcG9uc2VzIH0gPSBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2UuZGVjb2RlKFxuICAgICAgICAgICAgZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXVuYm9uZGluZ1Jlc3BvbnNlcylcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCB1bmJvbmRpbmdSZXNwb25zZXMga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4odW5ib25kaW5nUmVzcG9uc2VzKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGlmICghcmVzdWx0Py5rZXkpIHRocm93IHRocm93UmVkYWN0ZWRgRXJyb3IgcGFyc2luZyByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IHJlZGVsZWdhdGlvblJlc3BvbnNlcyB9ID0gUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2UuZGVjb2RlKFxuICAgICAgICAgICAgZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXJlZGVsZWdhdGlvblJlc3BvbnNlcylcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCByZWRlbGVnYXRpb25SZXNwb25zZXMga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4ocmVkZWxlZ2F0aW9uUmVzcG9uc2VzKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBpZiAoIXJlc3VsdD8ua2V5KSB0aHJvdyB0aHJvd1JlZGFjdGVkYEVycm9yIHBhcnNpbmcgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyByZWRlbGVnYXRpb25SZXNwb25zZXMgfSA9IFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlLmRlY29kZShcbiAgICAgICAgICAgIGRlY29kZUJhc2U2NChyZXN1bHQua2V5KVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFyZWRlbGVnYXRpb25SZXNwb25zZXMpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHJlZGVsZWdhdGlvblJlc3BvbnNlcyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXdhcmRRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBpZiAoIXJlc3VsdD8ua2V5KSB0aHJvdyB0aHJvd1JlZGFjdGVkYEVycm9yIHBhcnNpbmcgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyByZXdhcmRzIH0gPSBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2UuZGVjb2RlKFxuICAgICAgICAgICAgZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXJld2FyZHMpIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCByZXdhcmRzIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHJld2FyZHMubWFwKHRvVHJ1bmNhdGVkRGVub21BbW91bnQpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJld2FyZHNRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGlmICghcmVzdWx0Py5rZXkpIHRocm93IHRocm93UmVkYWN0ZWRgRXJyb3IgcGFyc2luZyByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IHJld2FyZHMsIHRvdGFsIH0gPSBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZS5kZWNvZGUoXG4gICAgICAgICAgICBkZWNvZGVCYXNlNjQocmVzdWx0LmtleSlcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghcmV3YXJkcyB8fCAhdG90YWwpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgcmV3YXJkcyBvciB0b3RhbCBrZXk6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgICAgICByZXdhcmRzOiByZXdhcmRzLm1hcCgocmV3YXJkKSA9PiAoe1xuICAgICAgICAgICAgICB2YWxpZGF0b3I6IHRvQ29zbW9zVmFsaWRhdG9yQWRkcmVzcyhyZXdhcmQsIGNoYWluQWRkcmVzcy5jaGFpbklkKSxcbiAgICAgICAgICAgICAgcmV3YXJkOiByZXdhcmQucmV3YXJkLm1hcCh0b1RydW5jYXRlZERlbm9tQW1vdW50KVxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgdG90YWw6IHRvdGFsLm1hcCh0b1RydW5jYXRlZERlbm9tQW1vdW50KVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYWxsQmFsYW5jZXNRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBsZXQgcmVzcG9uc2U7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlLmRlY29kZShcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gY2F0Y2ggKGNhdXNlKSB7XG4gICAgICAgICAgICB0aHJvdyBtYWtlRXJyb3IoXG4gICAgICAgICAgICAgIGBFcnJvciBwYXJzaW5nIFF1ZXJ5QWxsQmFsYW5jZXMgcmVzdWx0ICR7cXVvdGUocmVzdWx0KX1gLFxuICAgICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICAgIHsgY2F1c2UgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlcyB9ID0gcmVzcG9uc2U7XG4gICAgICAgICAgaWYgKCFiYWxhbmNlcykgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIGJhbGFuY2VzIGtleTogJHtxdW90ZShyZXN1bHQpfWA7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbihiYWxhbmNlcy5tYXAoKGNvaW4pID0+IHRvRGVub21BbW91bnQoY29pbikpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHVuZGVsZWdhdGVXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCkge1xuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gdHJ5RGVjb2RlUmVzcG9uc2UoXG4gICAgICAgICAgICByZXN1bHQsXG4gICAgICAgICAgICBNc2dVbmRlbGVnYXRlUmVzcG9uc2UuZnJvbVByb3RvTXNnXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0cmFjZTMoXCJ1bmRlbGVnYXRlIHJlc3BvbnNlXCIsIHJlc3BvbnNlKTtcbiAgICAgICAgICBjb25zdCB7IGNvbXBsZXRpb25UaW1lIH0gPSByZXNwb25zZTtcbiAgICAgICAgICBjb21wbGV0aW9uVGltZSB8fCB0aHJvd1JlZGFjdGVkYE5vIGNvbXBsZXRpb24gdGltZSByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgRSh0aGlzLnN0YXRlLnRpbWVyKS53YWtlQXQoY29tcGxldGlvblRpbWUuc2Vjb25kcyArIG1heENsb2NrU2tldylcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIHJldHVyblZvaWRXYXRjaGVyOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0KSB7XG4gICAgICAgICAgdHJhY2UzKFwiUmVzdWx0XCIsIHJlc3VsdCk7XG4gICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdpdGhkcmF3UmV3YXJkV2F0Y2hlcjoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChyZXN1bHQpIHtcbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHRyeURlY29kZVJlc3BvbnNlKFxuICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRSZXNwb25zZS5mcm9tUHJvdG9Nc2dcbiAgICAgICAgICApO1xuICAgICAgICAgIHRyYWNlMyhcIndpdGhkcmF3UmV3YXJkIHJlc3BvbnNlXCIsIHJlc3BvbnNlKTtcbiAgICAgICAgICBjb25zdCB7IGFtb3VudDogY29pbnMgfSA9IHJlc3BvbnNlO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oY29pbnMubWFwKHRvRGVub21BbW91bnQpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRyYW5zZmVyV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3sgdHJhbnNmZXJDaGFubmVsIH0sIHRpbWVvdXRUaW1lc3RhbXBdLCB7IG9wdHMsIHRva2VuOiB0b2tlbjIsIGRlc3RpbmF0aW9uIH0pIHtcbiAgICAgICAgICBjb25zdCByZXN1bHRzID0gRSh0aGlzLmZhY2V0cy5oZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChbXG4gICAgICAgICAgICBBbnkudG9KU09OKFxuICAgICAgICAgICAgICBNc2dUcmFuc2Zlci50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICBzb3VyY2VQb3J0OiB0cmFuc2ZlckNoYW5uZWwucG9ydElkLFxuICAgICAgICAgICAgICAgIHNvdXJjZUNoYW5uZWw6IHRyYW5zZmVyQ2hhbm5lbC5jaGFubmVsSWQsXG4gICAgICAgICAgICAgICAgdG9rZW46IHRva2VuMixcbiAgICAgICAgICAgICAgICBzZW5kZXI6IHRoaXMuc3RhdGUuY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgIHJlY2VpdmVyOiBkZXN0aW5hdGlvbi52YWx1ZSxcbiAgICAgICAgICAgICAgICB0aW1lb3V0SGVpZ2h0OiBvcHRzPy50aW1lb3V0SGVpZ2h0ID8/IHtcbiAgICAgICAgICAgICAgICAgIHJldmlzaW9uSGVpZ2h0OiAwbixcbiAgICAgICAgICAgICAgICAgIHJldmlzaW9uTnVtYmVyOiAwblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGltZW91dFRpbWVzdGFtcCxcbiAgICAgICAgICAgICAgICBtZW1vOiBvcHRzPy5tZW1vID8/IFwiXCJcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICBdKTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaW52aXRhdGlvbk1ha2Vyczoge1xuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIERlbGVnYXRlKHZhbGlkYXRvciwgYW1vdW50KSB7XG4gICAgICAgICAgdHJhY2UzKFwiRGVsZWdhdGVcIiwgdmFsaWRhdG9yLCBhbW91bnQpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5kZWxlZ2F0ZSh2YWxpZGF0b3IsIGFtb3VudCkpO1xuICAgICAgICAgIH0sIFwiRGVsZWdhdGVcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBSZWRlbGVnYXRlKHNyY1ZhbGlkYXRvciwgZHN0VmFsaWRhdG9yLCBhbW91bnQpIHtcbiAgICAgICAgICB0cmFjZTMoXCJSZWRlbGVnYXRlXCIsIHNyY1ZhbGlkYXRvciwgZHN0VmFsaWRhdG9yLCBhbW91bnQpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5ob2xkZXIucmVkZWxlZ2F0ZShzcmNWYWxpZGF0b3IsIGRzdFZhbGlkYXRvciwgYW1vdW50KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCBcIlJlZGVsZWdhdGVcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBXaXRoZHJhd1Jld2FyZCh2YWxpZGF0b3IpIHtcbiAgICAgICAgICB0cmFjZTMoXCJXaXRoZHJhd1Jld2FyZFwiLCB2YWxpZGF0b3IpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci53aXRoZHJhd1Jld2FyZCh2YWxpZGF0b3IpKTtcbiAgICAgICAgICB9LCBcIldpdGhkcmF3UmV3YXJkXCIpO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBVbmRlbGVnYXRlKGRlbGVnYXRpb25zKSB7XG4gICAgICAgICAgdHJhY2UzKFwiVW5kZWxlZ2F0ZVwiLCBkZWxlZ2F0aW9ucyk7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLnVuZGVsZWdhdGUoZGVsZWdhdGlvbnMpKTtcbiAgICAgICAgICB9LCBcIlVuZGVsZWdhdGVcIik7XG4gICAgICAgIH0sXG4gICAgICAgIERlYWN0aXZhdGVBY2NvdW50KCkge1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5kZWFjdGl2YXRlKCkpO1xuICAgICAgICAgIH0sIFwiRGVhY3RpdmF0ZUFjY291bnRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFJlYWN0aXZhdGVBY2NvdW50KCkge1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5yZWFjdGl2YXRlKCkpO1xuICAgICAgICAgIH0sIFwiUmVhY3RpdmF0ZUFjY291bnRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFNlbmQoKSB7XG4gICAgICAgICAgY29uc3Qgb2ZmZXJIYW5kbGVyID0gKHNlYXQsIHsgdG9BY2NvdW50LCBhbW91bnQgfSkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLnNlbmQodG9BY2NvdW50LCBhbW91bnQpKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24ob2ZmZXJIYW5kbGVyLCBcIlNlbmRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFNlbmRBbGwoKSB7XG4gICAgICAgICAgY29uc3Qgb2ZmZXJIYW5kbGVyID0gKHNlYXQsIHsgdG9BY2NvdW50LCBhbW91bnRzIH0pID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5zZW5kQWxsKHRvQWNjb3VudCwgYW1vdW50cykpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihvZmZlckhhbmRsZXIsIFwiU2VuZEFsbFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFRyYW5zZmVyQWNjb3VudCgpIHtcbiAgICAgICAgICB0aHJvdyBFcnJvcihcIm5vdCB5ZXQgaW1wbGVtZW50ZWRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFRyYW5zZmVyKCkge1xuICAgICAgICAgIGNvbnN0IG9mZmVySGFuZGxlciA9IChzZWF0LCB7IGFtb3VudCwgZGVzdGluYXRpb24sIG9wdHMgfSkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmhvbGRlci50cmFuc2ZlcihkZXN0aW5hdGlvbiwgYW1vdW50LCBvcHRzKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24ob2ZmZXJIYW5kbGVyLCBcIlRyYW5zZmVyXCIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaG9sZGVyOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYXNDb250aW51aW5nT2ZmZXIoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IG51bGw7XG4gICAgICAgICAgICBjb25zdCB7IGhvbGRlciwgaW52aXRhdGlvbk1ha2VyczogaW0gfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgaW52aXRhdGlvbk1ha2VycyA9IChcbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgIGltXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIHB1YmxpY1N1YnNjcmliZXJzOiBhd2FpdCB3aGVuKGhvbGRlci5nZXRQdWJsaWNUb3BpY3MoKSksXG4gICAgICAgICAgICAgIGludml0YXRpb25NYWtlcnNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRQdWJsaWNUb3BpY3MoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IG51bGw7XG4gICAgICAgICAgICBjb25zdCB7IHRvcGljS2l0IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCF0b3BpY0tpdCkgdGhyb3cgdGhyb3dSZWRhY3RlZGBObyB0b3BpY0tpdDsgc3RvcmFnZU5vZGUgbm90IHByb3ZpZGVkYDtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgICBhY2NvdW50OiB7XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFBVQkxJQ19UT1BJQ1MuYWNjb3VudFswXSxcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyOiB0b3BpY0tpdC5zdWJzY3JpYmVyLFxuICAgICAgICAgICAgICAgIHN0b3JhZ2VQYXRoOiBhd2FpdCB0b3BpY0tpdC5yZWNvcmRlci5nZXRTdG9yYWdlUGF0aCgpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0QWRkcmVzcygpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5jaGFpbkFkZHJlc3M7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGRlbGVnYXRlKHZhbGlkYXRvciwgYW1vdW50KSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImRlbGVnYXRlXCIsIHZhbGlkYXRvciwgYW1vdW50KTtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29uc3QgYW1vdW50QXNDb2luID0gaGVscGVyLmFtb3VudFRvQ29pbihhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoW1xuICAgICAgICAgICAgICBBbnkudG9KU09OKFxuICAgICAgICAgICAgICAgIE1zZ0RlbGVnYXRlLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcmVzczogdmFsaWRhdG9yLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnRBc0NvaW5cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgcmVkZWxlZ2F0ZShzcmNWYWxpZGF0b3IsIGRzdFZhbGlkYXRvciwgYW1vdW50KSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcInJlZGVsZWdhdGVcIiwgc3JjVmFsaWRhdG9yLCBkc3RWYWxpZGF0b3IsIGFtb3VudCk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGhlbHBlci5vd25lZCgpKS5leGVjdXRlRW5jb2RlZFR4KFtcbiAgICAgICAgICAgICAgQW55LnRvSlNPTihcbiAgICAgICAgICAgICAgICBNc2dCZWdpblJlZGVsZWdhdGUudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JTcmNBZGRyZXNzOiBzcmNWYWxpZGF0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JEc3RBZGRyZXNzOiBkc3RWYWxpZGF0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgICBhbW91bnQ6IGhlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICByZXN1bHRzLFxuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgd2l0aGRyYXdSZXdhcmQodmFsaWRhdG9yKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcIndpdGhkcmF3UmV3YXJkXCIsIHZhbGlkYXRvcik7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IG1zZyA9IE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgIHZhbGlkYXRvckFkZHJlc3M6IHZhbGlkYXRvci52YWx1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBhY2NvdW50ID0gaGVscGVyLm93bmVkKCk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShhY2NvdW50KS5leGVjdXRlRW5jb2RlZFR4KFtBbnkudG9KU09OKG1zZyldKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy53aXRoZHJhd1Jld2FyZFdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0QmFsYW5jZShkZW5vbSkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5QmFsYW5jZVJlcXVlc3QudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBhZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICBkZW5vbTogY29lcmNlRGVub20oY2hhaW5IdWIsIGRlbm9tKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLmJhbGFuY2VRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEJhbGFuY2VzKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0LnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgYWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMuYWxsQmFsYW5jZXNRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc2VuZCh0b0FjY291bnQsIGFtb3VudCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJzZW5kXCIsIHRvQWNjb3VudCwgYW1vdW50KTtcbiAgICAgICAgICAgIGNvbnN0IGNvc21vc0Rlc3QgPSBjaGFpbkh1Yi5jb2VyY2VDb3Ntb3NBZGRyZXNzKHRvQWNjb3VudCk7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGNvc21vc0Rlc3QuY2hhaW5JZCA9PT0gY2hhaW5BZGRyZXNzLmNoYWluSWQgfHwgdGhyb3dSZWRhY3RlZGBiYW5rL3NlbmQgY2Fubm90IHNlbmQgdG8gYSBkaWZmZXJlbnQgY2hhaW4gJHtxdW90ZShjb3Ntb3NEZXN0LmNoYWluSWQpfWA7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUoaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoW1xuICAgICAgICAgICAgICAgIEFueS50b0pTT04oXG4gICAgICAgICAgICAgICAgICBNc2dTZW5kLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgICBmcm9tQWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICB0b0FkZHJlc3M6IGNvc21vc0Rlc3QudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGFtb3VudDogW2hlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KV1cbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzZW5kQWxsKHRvQWNjb3VudCwgYW1vdW50cykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJzZW5kQWxsXCIsIHRvQWNjb3VudCwgYW1vdW50cyk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShoZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChbXG4gICAgICAgICAgICAgICAgQW55LnRvSlNPTihcbiAgICAgICAgICAgICAgICAgIE1zZ1NlbmQudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICAgIGZyb21BZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIHRvQWRkcmVzczogdG9BY2NvdW50LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtb3VudHMubWFwKCh4KSA9PiBoZWxwZXIuYW1vdW50VG9Db2luKHgpKVxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB0cmFuc2ZlcihkZXN0aW5hdGlvbiwgYW1vdW50LCBvcHRzKSB7XG4gICAgICAgICAgdHJhY2UzKFwidHJhbnNmZXJcIiwgZGVzdGluYXRpb24sIGFtb3VudCwgb3B0cyk7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvc21vc0Rlc3QgPSBjaGFpbkh1Yi5jb2VyY2VDb3Ntb3NBZGRyZXNzKGRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHRva2VuMiA9IGhlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KTtcbiAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb25JbmZvViA9IHdhdGNoKFxuICAgICAgICAgICAgICBjaGFpbkh1Yi5nZXRDb25uZWN0aW9uSW5mbyhcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmNoYWluQWRkcmVzcy5jaGFpbklkLFxuICAgICAgICAgICAgICAgIGNvc21vc0Rlc3QuY2hhaW5JZFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICBhbGxWb3dzKFtcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uSW5mb1YsXG4gICAgICAgICAgICAgICAgdGltZXN0YW1wSGVscGVyLnZvd09yVmFsdWVGcm9tT3B0cyhvcHRzKVxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMudHJhbnNmZXJXYXRjaGVyLFxuICAgICAgICAgICAgICB7IG9wdHMsIHRva2VuOiB0b2tlbjIsIGRlc3RpbmF0aW9uOiBjb3Ntb3NEZXN0IH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB0cmFuc2ZlclN0ZXBzKGFtb3VudCwgbXNnKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJ0cmFuc2ZlclN0ZXBzIGdvdFwiLCBhbW91bnQsIG1zZyk7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHRocm93UmVkYWN0ZWRgbm90IHlldCBpbXBsZW1lbnRlZGApO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgd2l0aGRyYXdSZXdhcmRzKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB0aHJvd1JlZGFjdGVkYE5vdCBJbXBsZW1lbnRlZC4gVHJ5IHVzaW5nIHdpdGhkcmF3UmV3YXJkLmApO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHVuZGVsZWdhdGUoZGVsZWdhdGlvbnMpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwidW5kZWxlZ2F0ZVwiLCBkZWxlZ2F0aW9ucyk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGRlbGVnYXRpb25zLmV2ZXJ5KFxuICAgICAgICAgICAgICAoZCkgPT4gZC5kZWxlZ2F0b3IgPyBkLmRlbGVnYXRvci52YWx1ZSA9PT0gY2hhaW5BZGRyZXNzLnZhbHVlIDogdHJ1ZVxuICAgICAgICAgICAgKSB8fCB0aHJvd1JlZGFjdGVkYFNvbWUgZGVsZWdhdGlvbiByZWNvcmQgaXMgZm9yIGFub3RoZXIgZGVsZWdhdG9yYDtcbiAgICAgICAgICAgIGNvbnN0IHVuZGVsZWdhdGVWID0gd2F0Y2goXG4gICAgICAgICAgICAgIEUoaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoXG4gICAgICAgICAgICAgICAgZGVsZWdhdGlvbnMubWFwKFxuICAgICAgICAgICAgICAgICAgKHsgdmFsaWRhdG9yLCBhbW91bnQgfSkgPT4gQW55LnRvSlNPTihcbiAgICAgICAgICAgICAgICAgICAgTXNnVW5kZWxlZ2F0ZS50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcmVzczogdmFsaWRhdG9yLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDogY29lcmNlQ29pbihjaGFpbkh1YiwgYW1vdW50KVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMudW5kZWxlZ2F0ZVdhdGNoZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godW5kZWxlZ2F0ZVYsIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZGVhY3RpdmF0ZSgpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4gd2F0Y2goRSh0aGlzLmZhY2V0cy5oZWxwZXIub3duZWQoKSkuZGVhY3RpdmF0ZSgpKSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHJlYWN0aXZhdGUoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHdhdGNoKEUodGhpcy5mYWNldHMuaGVscGVyLm93bmVkKCkpLnJlYWN0aXZhdGUoKSkpO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldERlbGVnYXRpb24odmFsaWRhdG9yKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImdldERlbGVnYXRpb25cIiwgdmFsaWRhdG9yKTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzLCBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCFpY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluQWRkcmVzcy5jaGFpbklkKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaWNxQ29ubmVjdGlvbikucXVlcnkoW1xuICAgICAgICAgICAgICB0b1JlcXVlc3RRdWVyeUpzb24oXG4gICAgICAgICAgICAgICAgUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHI6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIHZhbGlkYXRvckFkZHI6IHZhbGlkYXRvci52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLmRlbGVnYXRpb25RdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXREZWxlZ2F0aW9ucygpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwiZ2V0RGVsZWdhdGlvbnNcIik7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0LnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcjogY2hhaW5BZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMuZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldFVuYm9uZGluZ0RlbGVnYXRpb24odmFsaWRhdG9yKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImdldFVuYm9uZGluZ0RlbGVnYXRpb25cIiwgdmFsaWRhdG9yKTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzLCBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCFpY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluQWRkcmVzcy5jaGFpbklkKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaWNxQ29ubmVjdGlvbikucXVlcnkoW1xuICAgICAgICAgICAgICB0b1JlcXVlc3RRdWVyeUpzb24oXG4gICAgICAgICAgICAgICAgUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHI6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIHZhbGlkYXRvckFkZHI6IHZhbGlkYXRvci52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLnVuYm9uZGluZ0RlbGVnYXRpb25RdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRVbmJvbmRpbmdEZWxlZ2F0aW9ucygpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwiZ2V0VW5ib25kaW5nRGVsZWdhdGlvbnNcIik7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXF1ZXN0LnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcjogY2hhaW5BZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMudW5ib25kaW5nRGVsZWdhdGlvbnNRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldFJlZGVsZWdhdGlvbnMoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImdldFJlZGVsZWdhdGlvbnNcIik7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3QudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgZHN0VmFsaWRhdG9yQWRkcjogXCJcIixcbiAgICAgICAgICAgICAgICAgIHNyY1ZhbGlkYXRvckFkZHI6IFwiXCJcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5yZWRlbGVnYXRpb25zUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldFJld2FyZCh2YWxpZGF0b3IpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwiZ2V0UmV3YXJkXCIsIHZhbGlkYXRvcik7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0LnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcmVzczogdmFsaWRhdG9yLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMucmV3YXJkUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRSZXdhcmRzKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJnZXRSZXdhcmRzXCIpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXF1ZXN0LnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMucmV3YXJkc1F1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGV4ZWN1dGVFbmNvZGVkVHgobXNncywgb3B0cykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdyhcbiAgICAgICAgICAgICgpID0+IHdhdGNoKEUodGhpcy5mYWNldHMuaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgobXNncywgb3B0cykpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgZGVwb3NpdEZvckJ1cm4oZGVzdGluYXRpb24sIGFtb3VudCwgY2FsbGVyKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImRlcG9zaXRGb3JCdXJuXCIsIHsgZGVzdGluYXRpb24sIGFtb3VudCB9KTtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29uc3QgZGVzdFBhcnRzID0gcGFyc2VBY2NvdW50SWQoZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgY29uc3QgY2hhaW5JZCA9IGAke2Rlc3RQYXJ0cy5uYW1lc3BhY2V9OiR7ZGVzdFBhcnRzLnJlZmVyZW5jZX1gO1xuICAgICAgICAgICAgY29uc3QgeyBjY3RwRGVzdGluYXRpb25Eb21haW4gfSA9IGNoYWluSHViLmdldENoYWluSW5mb0J5Q2hhaW5JZChjaGFpbklkKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2N0cERlc3RpbmF0aW9uRG9tYWluICE9PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgJHtxdW90ZShjaGFpbklkKX0gZG9lcyBub3QgaGF2ZSBcImNjdHBEZXN0aW5hdGlvbkRvbWFpblwiIHNldCBpbiBDaGFpbkluZm9gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZGVwb3NpdEZvckJ1cm4gPSB7XG4gICAgICAgICAgICAgIGFtb3VudDogaGVscGVyLmFtb3VudFRvQ29pbihhbW91bnQpPy5hbW91bnQsXG4gICAgICAgICAgICAgIGZyb206IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgZGVzdGluYXRpb25Eb21haW46IGNjdHBEZXN0aW5hdGlvbkRvbWFpbixcbiAgICAgICAgICAgICAgbWludFJlY2lwaWVudDogYWNjb3VudElkVG8zMkJ5dGVzKGRlc3RpbmF0aW9uKSxcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgYnVyblRva2VuOiBcInV1c2RjXCJcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvbkNhbGxlciA9ICgoKSA9PiB7XG4gICAgICAgICAgICAgIGlmICghY2FsbGVyKSByZXR1cm4gdm9pZCAwO1xuICAgICAgICAgICAgICBjb25zdCBjYWxsZXJQYXJ0cyA9IHBhcnNlQWNjb3VudElkKGNhbGxlcik7XG4gICAgICAgICAgICAgIGNhbGxlclBhcnRzLm5hbWVzcGFjZSA9PT0gZGVzdFBhcnRzLm5hbWVzcGFjZSB8fCB0aHJvd1JlZGFjdGVkYGNhbGxlciAke3F1b3RlKGNhbGxlcil9IG11c3QgYmUgaW4gc2FtZSBuYW1lc3BhY2UgYXMgZGVzdGluYXRpb24gJHtxdW90ZShkZXN0aW5hdGlvbil9YDtcbiAgICAgICAgICAgICAgcmV0dXJuIGFjY291bnRJZFRvMzJCeXRlcyhjYWxsZXIpO1xuICAgICAgICAgICAgfSkoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShoZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChbXG4gICAgICAgICAgICAgICAgQW55LnRvSlNPTihcbiAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uQ2FsbGVyID8gTXNnRGVwb3NpdEZvckJ1cm5XaXRoQ2FsbGVyLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgICAuLi5kZXBvc2l0Rm9yQnVybixcbiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb25DYWxsZXJcbiAgICAgICAgICAgICAgICAgIH0pIDogTXNnRGVwb3NpdEZvckJ1cm4udG9Qcm90b01zZyhkZXBvc2l0Rm9yQnVybilcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuIG1ha2VDb3Ntb3NPcmNoZXN0cmF0aW9uQWNjb3VudEtpdDtcbn07XG52YXIgcHJlcGFyZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50ID0gKHpvbmUsIHsgY2hhaW5IdWIsIG1ha2VSZWNvcmRlcktpdCwgdGltZXJTZXJ2aWNlLCB2b3dUb29scywgemNmIH0pID0+IHtcbiAgY29uc3QgbWFrZUtpdCA9IHByZXBhcmVDb3Ntb3NPcmNoZXN0cmF0aW9uQWNjb3VudEtpdCh6b25lLCB7XG4gICAgY2hhaW5IdWIsXG4gICAgbWFrZVJlY29yZGVyS2l0LFxuICAgIHRpbWVyU2VydmljZSxcbiAgICB2b3dUb29scyxcbiAgICB6Y2ZcbiAgfSk7XG4gIHJldHVybiAoLi4uYXJncykgPT4gbWFrZUtpdCguLi5hcmdzKS5ob2xkZXI7XG59O1xuXG4vL1xudmFyIHByZXBhcmVMb2NhbENoYWluRmFjYWRlS2l0ID0gKHpvbmUsIHtcbiAgbWFrZUxvY2FsT3JjaGVzdHJhdGlvbkFjY291bnRLaXQsXG4gIGFnb3JpY05hbWVzLFxuICBsb2NhbGNoYWluLFxuICAvL1xuICAvL1xuICBzdG9yYWdlTm9kZSxcbiAgdm93VG9vbHM6IHsgYWxsVm93cywgd2F0Y2gsIGFzVm93IH1cbn0pID0+IHpvbmUuZXhvQ2xhc3NLaXQoXG4gIFwiTG9jYWxDaGFpbkZhY2FkZVwiLFxuICB7XG4gICAgcHVibGljOiBNLmludGVyZmFjZShcIkxvY2FsQ2hhaW5GYWNhZGVcIiwge1xuICAgICAgLi4uY2hhaW5GYWNhZGVNZXRob2RzLFxuICAgICAgcXVlcnk6IE0uY2FsbChNLmFycmF5T2YoVHlwZWRKc29uU2hhcGUpKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgICAgIGdldFZCYW5rQXNzZXRJbmZvOiBNLmNhbGwoKS5vcHRpb25hbChNLmJvb2xlYW4oKSkucmV0dXJucyhWb3dTaGFwZSlcbiAgICB9KSxcbiAgICB2YmFua0Fzc2V0VmFsdWVzV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJ2YmFua0Fzc2V0VmFsdWVzV2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKFZvd1NoYXBlKVxuICAgIH0pLFxuICAgIG1ha2VBY2NvdW50V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJtYWtlQWNjb3VudFdhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbTS5yZW1vdGFibGUoXCJMQ0EgQWNjb3VudFwiKSwgTS5zdHJpbmcoKV0pLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhWb3dTaGFwZSlcbiAgICB9KSxcbiAgICBtYWtlQ2hpbGROb2RlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJtYWtlQ2hpbGROb2RlV2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ub3IoTS5yZW1vdGFibGUoKSwgTS51bmRlZmluZWQoKSkpLm9wdGlvbmFsKHsgYWNjb3VudDogTS5yZW1vdGFibGUoKSwgYWRkcmVzczogTS5zdHJpbmcoKSB9KS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpXG4gICAgfSlcbiAgfSxcbiAgLypcblxuICAgKi9cbiAgKGxvY2FsQ2hhaW5JbmZvKSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxvY2FsQ2hhaW5JbmZvLFxuICAgICAgdmJhbmtBc3NldHM6IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdm9pZCAwXG4gICAgICApXG4gICAgfTtcbiAgfSxcbiAge1xuICAgIHB1YmxpYzoge1xuICAgICAgZ2V0Q2hhaW5JbmZvKCkge1xuICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5zdGF0ZS5sb2NhbENoYWluSW5mbyk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgbWFrZUFjY291bnQoKSB7XG4gICAgICAgIGNvbnN0IGxjYVAgPSBFKGxvY2FsY2hhaW4pLm1ha2VBY2NvdW50KCk7XG4gICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vXG4gICAgICAgICAgLy9cbiAgICAgICAgICBhbGxWb3dzKFtsY2FQLCBoZWFwVm93RShsY2FQKS5nZXRBZGRyZXNzKCldKSxcbiAgICAgICAgICB0aGlzLmZhY2V0cy5tYWtlQWNjb3VudFdhdGNoZXJcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgcXVlcnkocmVxdWVzdHMpIHtcbiAgICAgICAgcmV0dXJuIHdhdGNoKEUobG9jYWxjaGFpbikucXVlcnlNYW55KHJlcXVlc3RzKSk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGdldFZCYW5rQXNzZXRJbmZvKCkge1xuICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgdmJhbmtBc3NldHMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKHZiYW5rQXNzZXRzKSB7XG4gICAgICAgICAgICByZXR1cm4gdmJhbmtBc3NldHM7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHZiYW5rQXNzZXROYW1lSHViUCA9IEUoYWdvcmljTmFtZXMpLmxvb2t1cChcInZiYW5rQXNzZXRcIik7XG4gICAgICAgICAgY29uc3QgdmJhbmtBc3NldFZhbHVlc1AgPSBFKHZiYW5rQXNzZXROYW1lSHViUCkudmFsdWVzKCk7XG4gICAgICAgICAgY29uc3QgeyB2YmFua0Fzc2V0VmFsdWVzV2F0Y2hlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKHZiYW5rQXNzZXRWYWx1ZXNQLCB2YmFua0Fzc2V0VmFsdWVzV2F0Y2hlcik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgdmJhbmtBc3NldFZhbHVlc1dhdGNoZXI6IHtcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoYXNzZXRzKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgc3RhdGUudmJhbmtBc3NldHMgPSBhc3NldHM7XG4gICAgICAgICAgcmV0dXJuIGFzc2V0cztcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtYWtlQWNjb3VudFdhdGNoZXI6IHtcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoW2FjY291bnQsIGFkZHJlc3NdKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbmFsU3RvcmFnZU5vZGUgPSBzdG9yYWdlTm9kZSA/IEUoc3RvcmFnZU5vZGUpLm1ha2VDaGlsZE5vZGUoYWRkcmVzcykgOiB2b2lkIDA7XG4gICAgICAgIHJldHVybiB3YXRjaChvcHRpb25hbFN0b3JhZ2VOb2RlLCB0aGlzLmZhY2V0cy5tYWtlQ2hpbGROb2RlV2F0Y2hlciwge1xuICAgICAgICAgIGFjY291bnQsXG4gICAgICAgICAgYWRkcmVzc1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1ha2VDaGlsZE5vZGVXYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoY2hpbGROb2RlLCB7IGFjY291bnQsIGFkZHJlc3MgfSkge1xuICAgICAgICBjb25zdCB7IGxvY2FsQ2hhaW5JbmZvIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBjb25zdCB7IGhvbGRlciB9ID0gbWFrZUxvY2FsT3JjaGVzdHJhdGlvbkFjY291bnRLaXQoe1xuICAgICAgICAgIGFjY291bnQsXG4gICAgICAgICAgYWRkcmVzczogaGFyZGVuKHtcbiAgICAgICAgICAgIHZhbHVlOiBhZGRyZXNzLFxuICAgICAgICAgICAgZW5jb2Rpbmc6IFwiYmVjaDMyXCIsXG4gICAgICAgICAgICBjaGFpbklkOiBsb2NhbENoYWluSW5mby5jaGFpbklkXG4gICAgICAgICAgfSksXG4gICAgICAgICAgLy9cbiAgICAgICAgICBzdG9yYWdlTm9kZTogY2hpbGROb2RlXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaG9sZGVyO1xuICAgICAgfVxuICAgIH1cbiAgfVxuKTtcbmhhcmRlbihwcmVwYXJlTG9jYWxDaGFpbkZhY2FkZUtpdCk7XG52YXIgcHJlcGFyZUxvY2FsQ2hhaW5GYWNhZGUgPSAoem9uZSwgcG93ZXJzKSA9PiB7XG4gIGNvbnN0IG1ha2VMb2NhbENoYWluRmFjYWRlS2l0ID0gcHJlcGFyZUxvY2FsQ2hhaW5GYWNhZGVLaXQoem9uZSwgcG93ZXJzKTtcbiAgcmV0dXJuIHBpY2tGYWNldChtYWtlTG9jYWxDaGFpbkZhY2FkZUtpdCwgXCJwdWJsaWNcIik7XG59O1xuaGFyZGVuKHByZXBhcmVMb2NhbENoYWluRmFjYWRlKTtcblxuLy9cbnZhciB0cmFjZTQgPSBtYWtlVHJhY2VyKFwiUGFja2V0VG9vbHNcIik7XG52YXIgeyB0b0NhcERhdGEgfSA9IG1ha2VNYXJzaGFsKHZvaWQgMCwgdm9pZCAwLCB7XG4gIG1hcnNoYWxOYW1lOiBcIkp1c3RFbmNvZGVyXCIsXG4gIHNlcmlhbGl6ZUJvZHlGb3JtYXQ6IFwiY2FwZGF0YVwiXG59KTtcbnZhciBqdXN0ID0gKG9iaikgPT4ge1xuICBjb25zdCB7IGJvZHkgfSA9IHRvQ2FwRGF0YShvYmopO1xuICByZXR1cm4gZGVjb2RlVG9KdXN0aW4oSlNPTi5wYXJzZShib2R5KSwgZmFsc2UpO1xufTtcbnZhciB7IFZvdyQ6IFZvdyQ0IH0gPSBTaGFwZTtcbnZhciBFVm93JCA9IChzaGFwZSkgPT4gTS5vcihWb3ckNChzaGFwZSksIE0ucHJvbWlzZShcbiAgLyogICAgICAgKi9cbikpO1xudmFyIHNpbms1ID0gKCkgPT4ge1xufTtcbmhhcmRlbihzaW5rNSk7XG52YXIgcHJlcGFyZVBhY2tldFRvb2xzID0gKHpvbmUsIHZvd1Rvb2xzKSA9PiB7XG4gIGNvbnN0IHsgYWxsVm93cywgbWFrZVZvd0tpdCwgd2F0Y2gsIHdoZW4gfSA9IHZvd1Rvb2xzO1xuICBjb25zdCBtYWtlUGFja2V0VG9vbHNLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiUGFja2V0VG9vbHNLaXRcIixcbiAgICB7XG4gICAgICBwdWJsaWM6IE0uaW50ZXJmYWNlKFwiUGFja2V0VG9vbHNcIiwge1xuICAgICAgICBzZW5kVGhlbldhaXRGb3JBY2s6IE0uY2FsbChFVm93JChNLnJlbW90YWJsZShcIlBhY2tldFNlbmRlclwiKSkpLm9wdGlvbmFsKE0uYW55KCkpLnJldHVybnMoRVZvdyQoTS5hbnkoKSkpLFxuICAgICAgICBtYXRjaEZpcnN0UGFja2V0OiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucyhFVm93JChNLmFueSgpKSksXG4gICAgICAgIG1vbml0b3JUcmFuc2ZlcnM6IE0uY2FsbChNLnJlbW90YWJsZShcIlRhcmdldEFwcFwiKSkucmV0dXJucyhcbiAgICAgICAgICBFVm93JChNLmFueSgpKVxuICAgICAgICApXG4gICAgICB9KSxcbiAgICAgIHRhcDogTS5pbnRlcmZhY2UoXCJ0YXBcIiwge1xuICAgICAgICAvL1xuICAgICAgICByZWNlaXZlVXBjYWxsOiBNLmNhbGxXaGVuKE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgbW9uaXRvclJlZ2lzdHJhdGlvbjogTS5pbnRlcmZhY2UoXCJtb25pdG9yUmVnaXN0cmF0aW9uXCIsIHtcbiAgICAgICAgLy9cbiAgICAgICAgdXBkYXRlVGFyZ2V0QXBwOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIE0uYXdhaXQoTS5yZW1vdGFibGUoXCJUYXJnZXRBcHBcIikpXG4gICAgICAgICkucmV0dXJucygpLFxuICAgICAgICAvL1xuICAgICAgICByZXZva2U6IE0uY2FsbFdoZW4oKS5yZXR1cm5zKClcbiAgICAgIH0pLFxuICAgICAgd2F0Y2hQYWNrZXRNYXRjaDogTS5pbnRlcmZhY2UoXCJ3YXRjaFBhY2tldE1hdGNoXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpLCBNLnJlY29yZCgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHdhdGNoUGFja2V0UGF0dGVybjogTS5pbnRlcmZhY2UoXCJ3YXRjaFBhY2tldFBhdHRlcm5cIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCksIE0ucmVjb3JkKCkpLnJldHVybnMoTS5hbnkoKSksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpLCBNLnJlY29yZCgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHdhdGNoRGVjclBlbmRpbmdQYXR0ZXJuczogTS5pbnRlcmZhY2UoXCJ3YXRjaERlY3JQZW5kaW5nUGF0dGVybnNcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHNlbmRQYWNrZXRXYXRjaGVyOiBNLmludGVyZmFjZShcInNlbmRQYWNrZXRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChcbiAgICAgICAgICBbTS5yZWNvcmQoKSwgTS5yZW1vdGFibGUoXCJQYWNrZXRTZW5kZXJcIildLFxuICAgICAgICAgIE0ucmVjb3JkKClcbiAgICAgICAgKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHBhY2tldFdhc1NlbnRXYXRjaGVyOiBNLmludGVyZmFjZShcInBhY2tldFdhc1NlbnRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChcbiAgICAgICAgICB7IGV2ZW50UGF0dGVybjogTS5wYXR0ZXJuKCksIHJlc3VsdFY6IFZvdyQ0KE0uYW55KCkpIH0sXG4gICAgICAgICAgTS5yZWNvcmQoKVxuICAgICAgICApLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgdXRpbHM6IE0uaW50ZXJmYWNlKFwidXRpbHNcIiwge1xuICAgICAgICBzdWJzY3JpYmVUb1RyYW5zZmVyczogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIHVuc3Vic2NyaWJlRnJvbVRyYW5zZmVyczogTS5jYWxsKCkucmV0dXJucyhNLnVuZGVmaW5lZCgpKSxcbiAgICAgICAgaW5jclBlbmRpbmdQYXR0ZXJuczogTS5jYWxsKCkucmV0dXJucyhWb3ckNChNLnVuZGVmaW5lZCgpKSksXG4gICAgICAgIGRlY3JQZW5kaW5nUGF0dGVybnM6IE0uY2FsbCgpLnJldHVybnMoVm93JDQoTS51bmRlZmluZWQoKSkpXG4gICAgICB9KSxcbiAgICAgIHJlamVjdFJlc29sdmVyQW5kUmV0aHJvd1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmVqZWN0UmVzb2x2ZXJXYXRjaGVyXCIsIHtcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCksIHtcbiAgICAgICAgICByZXNvbHZlcjogTS5yZW1vdGFibGUoXCJyZXNvbHZlclwiKVxuICAgICAgICB9KS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KVxuICAgIH0sXG4gICAgLypcblxuICAgICAqL1xuICAgIChsY2EpID0+IHtcbiAgICAgIGNvbnN0IHJlc29sdmVyVG9QYXR0ZXJuID0gem9uZS5kZXRhY2hlZCgpLm1hcFN0b3JlKFwicmVzb2x2ZXJUb1BhdHRlcm5cIik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsY2EsXG4gICAgICAgIHJlZzogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG51bGxcbiAgICAgICAgKSxcbiAgICAgICAgcmVzb2x2ZXJUb1BhdHRlcm4sXG4gICAgICAgIHVwY2FsbFF1ZXVlOiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgbnVsbFxuICAgICAgICApLFxuICAgICAgICBwZW5kaW5nOiAwLFxuICAgICAgICBleHRyYTogbnVsbCxcbiAgICAgICAgbW9uaXRvcjogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG51bGxcbiAgICAgICAgKVxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIHB1YmxpYzoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICAvL1xuICAgICAgICBhc3luYyBtb25pdG9yVHJhbnNmZXJzKG1vbml0b3IpIHtcbiAgICAgICAgICBjb25zdCBtcmVnID0gdGhpcy5mYWNldHMubW9uaXRvclJlZ2lzdHJhdGlvbjtcbiAgICAgICAgICBhd2FpdCBtcmVnLnVwZGF0ZVRhcmdldEFwcChtb25pdG9yKTtcbiAgICAgICAgICByZXR1cm4gbXJlZztcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgbWF0Y2hGaXJzdFBhY2tldChwYXR0ZXJuUCkge1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnV0aWxzLmluY3JQZW5kaW5nUGF0dGVybnMoKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLndhdGNoUGFja2V0TWF0Y2gsXG4gICAgICAgICAgICB7IHBhdHRlcm5QIH1cbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZFRoZW5XYWl0Rm9yQWNrKHBhY2tldFNlbmRlciwgb3B0cyA9IHt9KSB7XG4gICAgICAgICAgY29uc3QgcGF0dGVybiA9IG1ha2VWb3dLaXQoKTtcbiAgICAgICAgICBjb25zdCBtYXRjaFYgPSB3YXRjaChcbiAgICAgICAgICAgIGFsbFZvd3MoW1xuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5wdWJsaWMubWF0Y2hGaXJzdFBhY2tldChwYXR0ZXJuLnZvdyksXG4gICAgICAgICAgICAgIHBhY2tldFNlbmRlclxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5zZW5kUGFja2V0V2F0Y2hlcixcbiAgICAgICAgICAgIHsgb3B0cyB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCByZXN1bHRWID0gd2F0Y2gobWF0Y2hWLCB0aGlzLmZhY2V0cy5wYWNrZXRXYXNTZW50V2F0Y2hlciwge1xuICAgICAgICAgICAgb3B0cyxcbiAgICAgICAgICAgIHBhdHRlcm5SZXNvbHZlcjogcGF0dGVybi5yZXNvbHZlclxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRWLCB0aGlzLmZhY2V0cy5yZWplY3RSZXNvbHZlckFuZFJldGhyb3dXYXRjaGVyLCB7XG4gICAgICAgICAgICByZXNvbHZlcjogcGF0dGVybi5yZXNvbHZlclxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgbW9uaXRvclJlZ2lzdHJhdGlvbjoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIC8vXG4gICAgICAgIGFzeW5jIHVwZGF0ZVRhcmdldEFwcCh0YXApIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLm1vbml0b3IgPSBhd2FpdCB0YXA7XG4gICAgICAgICAgYXdhaXQgdGhpcy5mYWNldHMudXRpbHMuc3Vic2NyaWJlVG9UcmFuc2ZlcnMoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAvL1xuICAgICAgICBhc3luYyByZXZva2UoKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5tb25pdG9yID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRhcDoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBhc3luYyByZWNlaXZlVXBjYWxsKG9iaikge1xuICAgICAgICAgIGNvbnN0IHsgbW9uaXRvciwgcmVzb2x2ZXJUb1BhdHRlcm4sIHVwY2FsbFF1ZXVlLCBwZW5kaW5nIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHRyYWNlNChcbiAgICAgICAgICAgIGBUcnlpbmcgJHtyZXNvbHZlclRvUGF0dGVybi5nZXRTaXplKCl9IGN1cnJlbnQgcGF0dGVybnMgYW5kICR7cGVuZGluZ30gcGVuZGluZyBwYXR0ZXJucyBhZ2FpbnN0YCxcbiAgICAgICAgICAgIGp1c3Qob2JqKVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKG1vbml0b3IpIHtcbiAgICAgICAgICAgIHZvaWQgRShtb25pdG9yKS5yZWNlaXZlVXBjYWxsKG9iaik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAoY29uc3QgW3Jlc29sdmVyLCBwYXR0ZXJuXSBvZiByZXNvbHZlclRvUGF0dGVybi5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGlmIChtYXRjaGVzKG9iaiwgcGF0dGVybikpIHtcbiAgICAgICAgICAgICAgdHJhY2U0KFwiTWF0Y2hlZCBwYXR0ZXJuOlwiLCBqdXN0KHBhdHRlcm4pKTtcbiAgICAgICAgICAgICAgcmVzb2x2ZXIucmVzb2x2ZShvYmopO1xuICAgICAgICAgICAgICByZXNvbHZlclRvUGF0dGVybi5kZWxldGUocmVzb2x2ZXIpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh1cGNhbGxRdWV1ZSkge1xuICAgICAgICAgICAgdHJhY2U0KFwiU3Rhc2hpbmcgb2JqZWN0IGluIHVwY2FsbFF1ZXVlXCIpO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS51cGNhbGxRdWV1ZSA9IGhhcmRlbih1cGNhbGxRdWV1ZS5jb25jYXQob2JqKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRyYWNlNChcIk5vIG1hdGNoIHlldC5cIik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzZW5kUGFja2V0V2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbeyBtYXRjaCB9LCBzZW5kZXJdLCBjdHgpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goRShzZW5kZXIpLnNlbmRQYWNrZXQobWF0Y2gsIGN0eC5vcHRzKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBwYWNrZXRXYXNTZW50V2F0Y2hlcjoge1xuICAgICAgICBvbkZ1bGZpbGxlZCh7IGV2ZW50UGF0dGVybiwgcmVzdWx0ViB9LCBjdHgpIHtcbiAgICAgICAgICBjb25zdCB7IHBhdHRlcm5SZXNvbHZlciB9ID0gY3R4O1xuICAgICAgICAgIHBhdHRlcm5SZXNvbHZlci5yZXNvbHZlKGV2ZW50UGF0dGVybik7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdFY7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZWplY3RSZXNvbHZlckFuZFJldGhyb3dXYXRjaGVyOiB7XG4gICAgICAgIG9uUmVqZWN0ZWQocmVqLCB7IHJlc29sdmVyIH0pIHtcbiAgICAgICAgICByZXNvbHZlci5yZWplY3QocmVqKTtcbiAgICAgICAgICB0aHJvdyByZWo7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3YXRjaFBhY2tldE1hdGNoOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKF8sIHsgcGF0dGVyblAgfSkge1xuICAgICAgICAgIGNvbnN0IHsgdm93LCByZXNvbHZlciB9ID0gbWFrZVZvd0tpdCgpO1xuICAgICAgICAgIGNvbnN0IHBhdHRlcm5WID0gd2F0Y2goXG4gICAgICAgICAgICBwYXR0ZXJuUCxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLndhdGNoUGFja2V0UGF0dGVybixcbiAgICAgICAgICAgIGhhcmRlbih7IHJlc29sdmVyIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgICB3YXRjaChwYXR0ZXJuViwgdGhpcy5mYWNldHMud2F0Y2hEZWNyUGVuZGluZ1BhdHRlcm5zKTtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgbWF0Y2g6IHZvdywgcmVzb2x2ZXIgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3YXRjaERlY3JQZW5kaW5nUGF0dGVybnM6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmFjZXRzLnV0aWxzLmRlY3JQZW5kaW5nUGF0dGVybnMoKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZWplY3RlZCgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5mYWNldHMudXRpbHMuZGVjclBlbmRpbmdQYXR0ZXJucygpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2F0Y2hQYWNrZXRQYXR0ZXJuOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKHBhdHRlcm4sIHsgcmVzb2x2ZXIgfSkge1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZXJUb1BhdHRlcm4sIHVwY2FsbFF1ZXVlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHRyYWNlNChcIndhdGNoUGFja2V0UGF0dGVybiBvbkZ1bGZpbGxlZFwiLCBqdXN0KHBhdHRlcm4pKTtcbiAgICAgICAgICBpZiAoIXVwY2FsbFF1ZXVlKSB7XG4gICAgICAgICAgICB0cmFjZTQoXCJObyB1cGNhbGwgcXVldWUgeWV0LiAgU2F2ZSB0aGUgcGF0dGVybiBmb3IgbGF0ZXIuXCIpO1xuICAgICAgICAgICAgcmVzb2x2ZXJUb1BhdHRlcm4uaW5pdChyZXNvbHZlciwgcGF0dGVybik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGkyID0gdXBjYWxsUXVldWUuZmluZEluZGV4KChvYmopID0+IG1hdGNoZXMob2JqLCBwYXR0ZXJuKSk7XG4gICAgICAgICAgaWYgKGkyID09PSAtMSkge1xuICAgICAgICAgICAgdHJhY2U0KFwiTm8gbWF0Y2ggeWV0LiBTYXZlIHRoZSBwYXR0ZXJuIGZvciBsYXRlci5cIik7XG4gICAgICAgICAgICByZXNvbHZlclRvUGF0dGVybi5pbml0KHJlc29sdmVyLCBwYXR0ZXJuKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdHJhY2U0KFxuICAgICAgICAgICAgXCJTdWNjZXNzISBSZW1vdmUgdGhlIG1hdGNoZWQgb2JqZWN0IGZyb20gdGhlIHF1ZXVlLlwiLFxuICAgICAgICAgICAganVzdCh1cGNhbGxRdWV1ZVtpMl0pXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXNvbHZlci5yZXNvbHZlKHVwY2FsbFF1ZXVlW2kyXSk7XG4gICAgICAgICAgdGhpcy5zdGF0ZS51cGNhbGxRdWV1ZSA9IGhhcmRlbihcbiAgICAgICAgICAgIHVwY2FsbFF1ZXVlLnNsaWNlKDAsIGkyKS5jb25jYXQodXBjYWxsUXVldWUuc2xpY2UoaTIgKyAxKSlcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgeyByZXNvbHZlciB9KSB7XG4gICAgICAgICAgcmVzb2x2ZXIucmVqZWN0KHJlYXNvbik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB1dGlsczoge1xuICAgICAgICBpbmNyUGVuZGluZ1BhdHRlcm5zKCkge1xuICAgICAgICAgIGNvbnN0IHsgcGVuZGluZywgcmVnLCB1cGNhbGxRdWV1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB0aGlzLnN0YXRlLnBlbmRpbmcgKz0gMTtcbiAgICAgICAgICBpZiAoIXVwY2FsbFF1ZXVlKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnVwY2FsbFF1ZXVlID0gaGFyZGVuKFtdKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHJlZyB8fCBwZW5kaW5nID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHZvaWQgMCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy51dGlscy5zdWJzY3JpYmVUb1RyYW5zZmVycygpKTtcbiAgICAgICAgfSxcbiAgICAgICAgZGVjclBlbmRpbmdQYXR0ZXJucygpIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLnBlbmRpbmcgLT0gMTtcbiAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5wZW5kaW5nID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnN0YXRlLnBlbmRpbmcgPSAwO1xuICAgICAgICAgIHRoaXMuc3RhdGUudXBjYWxsUXVldWUgPSBudWxsO1xuICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy51dGlscy51bnN1YnNjcmliZUZyb21UcmFuc2ZlcnMoKSk7XG4gICAgICAgIH0sXG4gICAgICAgIHN1YnNjcmliZVRvVHJhbnNmZXJzKCkge1xuICAgICAgICAgIGNvbnN0IHsgbGNhLCByZWc6IGNhY2hlZFJlZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoY2FjaGVkUmVnKSB7XG4gICAgICAgICAgICByZXR1cm4gd2hlbihjYWNoZWRSZWcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB7IHRhcCB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgcmVnID0gd2F0Y2goRShsY2EpLm1vbml0b3JUcmFuc2ZlcnModGFwKSk7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5yZWcgPSByZWc7XG4gICAgICAgICAgcmV0dXJuIHdoZW4ocmVnKTtcbiAgICAgICAgfSxcbiAgICAgICAgdW5zdWJzY3JpYmVGcm9tVHJhbnNmZXJzKCkge1xuICAgICAgICAgIGNvbnN0IHsgcmVnLCBtb25pdG9yIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICghcmVnIHx8IG1vbml0b3IpIHtcbiAgICAgICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBmaW5pc2goY29udGV4dCkge1xuICAgICAgICB2b2lkIGNvbnRleHQuZmFjZXRzLnV0aWxzLnN1YnNjcmliZVRvVHJhbnNmZXJzKCk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlUGFja2V0VG9vbHMgPSBwaWNrRmFjZXQobWFrZVBhY2tldFRvb2xzS2l0LCBcInB1YmxpY1wiKTtcbiAgcmV0dXJuIG1ha2VQYWNrZXRUb29scztcbn07XG5oYXJkZW4ocHJlcGFyZVBhY2tldFRvb2xzKTtcblxuLy9cbnZhciBJQ1MyMF9UUkFOU0ZFUl9TVUNDRVNTX1JFU1VMVCA9IFwiQVE9PVwiO1xudmFyIHRyYWNlNSA9IG1ha2VUcmFjZXIoXCJJQkNQXCIpO1xudmFyIHsgRmFpbDogRmFpbDYsIGJhcmU6IGJhcmUzIH0gPSBhc3NlcnQ7XG52YXIgeyBWb3ckOiBWb3ckNSB9ID0gU2hhcGU7XG52YXIgY3JlYXRlU2VxdWVuY2VQYXR0ZXJuID0gKHNlcXVlbmNlKSA9PiB7XG4gIGNvbnN0IHNlcXVlbmNlUGF0dGVybnMgPSBbXTtcbiAgdHJ5IHtcbiAgICBjb25zdCBiaW50U2VxdWVuY2UgPSBCaWdJbnQoc2VxdWVuY2UpO1xuICAgIGJpbnRTZXF1ZW5jZSA+IDBuICYmIHNlcXVlbmNlUGF0dGVybnMucHVzaChiaW50U2VxdWVuY2UpO1xuICB9IGNhdGNoIChlMikge1xuICB9XG4gIGNvbnN0IG51bVNlcXVlbmNlID0gTnVtYmVyKHNlcXVlbmNlKTtcbiAgbnVtU2VxdWVuY2UgPiAwICYmIE51bWJlci5pc1NhZmVJbnRlZ2VyKG51bVNlcXVlbmNlKSAmJiBzZXF1ZW5jZVBhdHRlcm5zLnB1c2gobnVtU2VxdWVuY2UpO1xuICBjb25zdCBzdHJTZXF1ZW5jZSA9IFN0cmluZyhzZXF1ZW5jZSk7XG4gIHN0clNlcXVlbmNlICYmIHNlcXVlbmNlUGF0dGVybnMucHVzaChzdHJTZXF1ZW5jZSk7XG4gIGlmICghc2VxdWVuY2VQYXR0ZXJucy5maW5kKChzZXEpID0+IHNlcSA9PT0gc2VxdWVuY2UpKSB7XG4gICAgc2VxdWVuY2VQYXR0ZXJucy5wdXNoKHNlcXVlbmNlKTtcbiAgfVxuICBzd2l0Y2ggKHNlcXVlbmNlUGF0dGVybnMubGVuZ3RoKSB7XG4gICAgY2FzZSAwOlxuICAgICAgdGhyb3cgRmFpbDZgc2VxdWVuY2UgJHtzZXF1ZW5jZX0gaXMgbm90IHZhbGlkYDtcbiAgICBjYXNlIDE6XG4gICAgICByZXR1cm4gc2VxdWVuY2VQYXR0ZXJuc1swXTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIE0ub3IoLi4uc2VxdWVuY2VQYXR0ZXJucyk7XG4gIH1cbn07XG5oYXJkZW4oY3JlYXRlU2VxdWVuY2VQYXR0ZXJuKTtcbnZhciBwcmVwYXJlSUJDVHJhbnNmZXJTZW5kZXIgPSAoem9uZSwgeyB3YXRjaCwgbWFrZUlCQ1JlcGx5S2l0IH0pID0+IHtcbiAgY29uc3QgbWFrZUlCQ1RyYW5zZmVyU2VuZGVyS2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIklCQ1RyYW5zZmVyU2VuZGVyS2l0XCIsXG4gICAge1xuICAgICAgcHVibGljOiBNLmludGVyZmFjZShcIklCQ1RyYW5zZmVyU2VuZGVyXCIsIHtcbiAgICAgICAgc2VuZFBhY2tldDogTS5jYWxsKFZvdyQ1KE0uYW55KCkpLCBNLmFueSgpKS5yZXR1cm5zKFZvdyQ1KE0ucmVjb3JkKCkpKVxuICAgICAgfSksXG4gICAgICByZXNwb25zZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmVzcG9uc2VXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbTS5yZWNvcmQoKV0sIE0ucmVjb3JkKCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgdmVyaWZ5VHJhbnNmZXJTdWNjZXNzOiBNLmludGVyZmFjZShcInZlcmlmeVRyYW5zZmVyU3VjY2Vzc1wiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpXG4gICAgICB9KVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgICh0eEV4ZWN1dG9yLCB0cmFuc2Zlck1zZykgPT4gKHtcbiAgICAgIHR4RXhlY3V0b3IsXG4gICAgICB0cmFuc2Zlck1zZzogaGFyZGVuKHRyYW5zZmVyTXNnKVxuICAgIH0pLFxuICAgIHtcbiAgICAgIHB1YmxpYzoge1xuICAgICAgICAvKlxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBzZW5kUGFja2V0KG1hdGNoLCBvcHRzKSB7XG4gICAgICAgICAgY29uc3QgeyB0eEV4ZWN1dG9yLCB0cmFuc2Zlck1zZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKHR4RXhlY3V0b3IpLmV4ZWN1dGVUeChbdHJhbnNmZXJNc2ddKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJlc3BvbnNlV2F0Y2hlcixcbiAgICAgICAgICAgIHsgb3B0cywgbWF0Y2ggfVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXNwb25zZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFt7IHNlcXVlbmNlIH1dLCBjdHgpIHtcbiAgICAgICAgICBjb25zdCB7IG1hdGNoLCBvcHRzIH0gPSBjdHg7XG4gICAgICAgICAgY29uc3QgeyB0cmFuc2Zlck1zZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB0cmFjZTUoXCJzZXF1ZW5jZVwiLCBzZXF1ZW5jZSwgdHJhbnNmZXJNc2cpO1xuICAgICAgICAgIGNvbnN0IHJlcGx5UGFja2V0UGF0dGVybiA9IE0uc3BsaXRSZWNvcmQoe1xuICAgICAgICAgICAgc291cmNlX3BvcnQ6IHRyYW5zZmVyTXNnLnNvdXJjZVBvcnQsXG4gICAgICAgICAgICBzb3VyY2VfY2hhbm5lbDogdHJhbnNmZXJNc2cuc291cmNlQ2hhbm5lbCxcbiAgICAgICAgICAgIHNlcXVlbmNlOiBjcmVhdGVTZXF1ZW5jZVBhdHRlcm4oc2VxdWVuY2UpXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgeyByZXN1bHRWOiBhY2tEYXRhViwgLi4ucmVzdCB9ID0gbWFrZUlCQ1JlcGx5S2l0KFxuICAgICAgICAgICAgcmVwbHlQYWNrZXRQYXR0ZXJuLFxuICAgICAgICAgICAgbWF0Y2gsXG4gICAgICAgICAgICB7IG9wTmFtZTogXCJ0cmFuc2ZlclwiLCAuLi5vcHRzIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdFYgPSB3YXRjaChhY2tEYXRhViwgdGhpcy5mYWNldHMudmVyaWZ5VHJhbnNmZXJTdWNjZXNzKTtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgcmVzdWx0ViwgLi4ucmVzdCB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHZlcmlmeVRyYW5zZmVyU3VjY2Vzczoge1xuICAgICAgICBvbkZ1bGZpbGxlZChhY2tEYXRhKSB7XG4gICAgICAgICAgbGV0IG9iajtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2JqID0gSlNPTi5wYXJzZShhY2tEYXRhKTtcbiAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIEZhaWw2YElDUzIwLTEgdHJhbnNmZXIgYWNrIGRhdGEgaXMgbm90IEpTT046ICR7YWNrRGF0YX1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB7IHJlc3VsdCwgZXJyb3IgfSA9IG9iajtcbiAgICAgICAgICBlcnJvciA9PT0gdm9pZCAwIHx8IEZhaWw2YElDUzIwLTEgdHJhbnNmZXIgZXJyb3IgJHtlcnJvcn1gO1xuICAgICAgICAgIHJlc3VsdCA/PyBGYWlsNmBNaXNzaW5nIHJlc3VsdCBpbiBJQ1MyMC0xIHRyYW5zZmVyIGFjayAke29ian1gO1xuICAgICAgICAgIHJlc3VsdCA9PT0gSUNTMjBfVFJBTlNGRVJfU1VDQ0VTU19SRVNVTFQgfHwgRmFpbDZgSUNTMjAtMSB0cmFuc2ZlciB1bnN1Y2Nlc3NmdWwgd2l0aCBhY2sgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiAoLi4uYXJncykgPT4gbWFrZUlCQ1RyYW5zZmVyU2VuZGVyS2l0KC4uLmFyZ3MpLnB1YmxpYztcbn07XG5oYXJkZW4ocHJlcGFyZUlCQ1RyYW5zZmVyU2VuZGVyKTtcbnZhciBwcmVwYXJlSUJDUmVwbHlLaXQgPSAoem9uZSwgdm93VG9vbHMpID0+IHtcbiAgY29uc3QgeyB3YXRjaCB9ID0gdm93VG9vbHM7XG4gIGNvbnN0IGliY1dhdGNoZXIgPSB6b25lLmV4byhcbiAgICBcImliY1Jlc3VsdFdhdGNoZXJcIixcbiAgICBNLmludGVyZmFjZShcInByb2Nlc3NJQkNXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoXG4gICAgICAgIE0uc3BsaXRSZWNvcmQoeyBldmVudDogTS5zdHJpbmcoKSB9LCB7IGFja25vd2xlZGdlbWVudDogTS5zdHJpbmcoKSB9KSxcbiAgICAgICAgTS5zcGxpdFJlY29yZCh7fSwgeyBvcE5hbWU6IE0uc3RyaW5nKCksIHRpbWVvdXQ6IE0ucmVjb3JkKCkgfSlcbiAgICAgICkucmV0dXJucyhWb3ckNShNLnN0cmluZygpKSlcbiAgICB9KSxcbiAgICB7XG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChpYmNFdmVudCwgeyBvcE5hbWUgPSBcInVua25vd25cIiB9KSB7XG4gICAgICAgIGNvbnN0IHsgZXZlbnQgfSA9IGliY0V2ZW50O1xuICAgICAgICBzd2l0Y2ggKGV2ZW50KSB7XG4gICAgICAgICAgY2FzZSBcImFja25vd2xlZGdlbWVudFBhY2tldFwiOiB7XG4gICAgICAgICAgICBjb25zdCB7IGFja25vd2xlZGdlbWVudCB9ID0gaWJjRXZlbnQ7XG4gICAgICAgICAgICBhY2tub3dsZWRnZW1lbnQgfHwgRmFpbDZgYWNrbm93bGVkZ2VtZW50UGFja2V0IG1pc3NpbmcgJ2Fja25vd2xlZGdlbWVudCdgO1xuICAgICAgICAgICAgcmV0dXJuIGJhc2U2NFRvQnl0ZXMoYWNrbm93bGVkZ2VtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcInRpbWVvdXRQYWNrZXRcIjpcbiAgICAgICAgICAgIHRocm93IEZhaWw2YCR7YmFyZTMob3BOYW1lKX0gb3BlcmF0aW9uIHJlY2VpdmVkIHRpbWVvdXQgcGFja2V0YDtcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgdGhyb3cgRmFpbDZgVW5leHBlY3RlZCBldmVudDogJHtldmVudH1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlSUJDUmVwbHlLaXQgPSAocmVwbHlQYWNrZXRQYXR0ZXJuLCBtYXRjaFYsIG9wdHMpID0+IHtcbiAgICBjb25zdCBldmVudFBhdHRlcm4gPSBNLm9yKFxuICAgICAgTS5zcGxpdFJlY29yZCh7XG4gICAgICAgIGV2ZW50OiBcImFja25vd2xlZGdlbWVudFBhY2tldFwiLFxuICAgICAgICBwYWNrZXQ6IHJlcGx5UGFja2V0UGF0dGVybixcbiAgICAgICAgYWNrbm93bGVkZ2VtZW50OiBNLnN0cmluZygpXG4gICAgICB9KSxcbiAgICAgIE0uc3BsaXRSZWNvcmQoe1xuICAgICAgICBldmVudDogXCJ0aW1lb3V0UGFja2V0XCIsXG4gICAgICAgIHBhY2tldDogcmVwbHlQYWNrZXRQYXR0ZXJuXG4gICAgICB9KVxuICAgICk7XG4gICAgY29uc3QgcmVzdWx0ViA9IHdhdGNoKG1hdGNoViwgaWJjV2F0Y2hlciwgb3B0cyk7XG4gICAgcmV0dXJuIGhhcmRlbih7IGV2ZW50UGF0dGVybiwgcmVzdWx0ViB9KTtcbiAgfTtcbiAgcmV0dXJuIG1ha2VJQkNSZXBseUtpdDtcbn07XG5oYXJkZW4ocHJlcGFyZUlCQ1JlcGx5S2l0KTtcbnZhciBwcmVwYXJlSUJDVG9vbHMgPSAoem9uZSwgdm93VG9vbHMpID0+IHtcbiAgY29uc3QgbWFrZUlCQ1JlcGx5S2l0ID0gcHJlcGFyZUlCQ1JlcGx5S2l0KHpvbmUsIHZvd1Rvb2xzKTtcbiAgY29uc3QgbWFrZUlCQ1RyYW5zZmVyU2VuZGVyID0gcHJlcGFyZUlCQ1RyYW5zZmVyU2VuZGVyKHpvbmUsIHtcbiAgICBtYWtlSUJDUmVwbHlLaXQsXG4gICAgLi4udm93VG9vbHNcbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oeyBtYWtlSUJDVHJhbnNmZXJTZW5kZXIsIG1ha2VJQkNSZXBseUtpdCB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZUlCQ1Rvb2xzKTtcblxuLy9cbnZhciB0cmFjZTYgPSBtYWtlVHJhY2VyKFwiTG9jYWxPcmNoQWNjb3VudFwiKTtcbnZhciB7IFZvdyQ6IFZvdyQ2IH0gPSBTaGFwZTtcbnZhciBFVm93JDIgPSAoc2hhcGUpID0+IE0ub3IoVm93JDYoc2hhcGUpLCBNLnByb21pc2UoXG4gIC8qICAgICAgICovXG4pKTtcbnZhciBIb2xkZXJJID0gTS5pbnRlcmZhY2UoXCJob2xkZXJcIiwge1xuICAuLi5vcmNoZXN0cmF0aW9uQWNjb3VudE1ldGhvZHMsXG4gIGRlbGVnYXRlOiBNLmNhbGwoTS5zdHJpbmcoKSwgQW1vdW50U2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICB1bmRlbGVnYXRlOiBNLmNhbGwoTS5zdHJpbmcoKSwgQW1vdW50U2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICBkZXBvc2l0OiBNLmNhbGwoUGF5bWVudFNoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgd2l0aGRyYXc6IE0uY2FsbChBbW91bnRTaGFwZSkucmV0dXJucyhWb3ckNihQYXltZW50U2hhcGUpKSxcbiAgZXhlY3V0ZVR4OiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5yZXR1cm5zKFZvdyQ2KE0ucmVjb3JkKCkpKSxcbiAgc2VuZFRoZW5XYWl0Rm9yQWNrOiBNLmNhbGwoRVZvdyQyKE0ucmVtb3RhYmxlKFwiUGFja2V0U2VuZGVyXCIpKSkub3B0aW9uYWwoTS5hbnkoKSkucmV0dXJucyhFVm93JDIoTS5zdHJpbmcoKSkpLFxuICBtYXRjaEZpcnN0UGFja2V0OiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucyhFVm93JDIoTS5hbnkoKSkpLFxuICBtb25pdG9yVHJhbnNmZXJzOiBNLmNhbGwoTS5yZW1vdGFibGUoXCJUYXJnZXRBcHBcIikpLnJldHVybnMoRVZvdyQyKE0uYW55KCkpKSxcbiAgcGFyc2VJbmJvdW5kVHJhbnNmZXI6IE0uY2FsbChNLnJlY29yZE9mKE0uc3RyaW5nKCksIE0uYW55KCkpKS5yZXR1cm5zKFxuICAgIFZvdyQ2KHtcbiAgICAgIGFtb3VudDogRGVub21BbW91bnRTaGFwZSxcbiAgICAgIGZyb21BY2NvdW50OiBNLnN0cmluZygpLFxuICAgICAgdG9BY2NvdW50OiBNLnN0cmluZygpLFxuICAgICAgZXh0cmE6IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgTS5hbnkoKSlcbiAgICB9KVxuICApXG59KTtcbnZhciBQVUJMSUNfVE9QSUNTMiA9IHtcbiAgYWNjb3VudDogW1wiQWNjb3VudCBob2xkZXIgc3RhdHVzXCIsIE0uYW55KCldXG59O1xudmFyIHByZXBhcmVMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0ID0gKHpvbmUsIHtcbiAgbWFrZVJlY29yZGVyS2l0LFxuICB6Y2YsXG4gIHRpbWVyU2VydmljZSxcbiAgdm93VG9vbHMsXG4gIGNoYWluSHViLFxuICBsb2NhbGNoYWluLFxuICB6b2VUb29sc1xufSkgPT4ge1xuICBjb25zdCB7IHdhdGNoLCBhc1Zvdywgd2hlbiB9ID0gdm93VG9vbHM7XG4gIGNvbnN0IHsgbWFrZUlCQ1RyYW5zZmVyU2VuZGVyIH0gPSBwcmVwYXJlSUJDVG9vbHMoXG4gICAgem9uZS5zdWJab25lKFwiaWJjVG9vbHNcIiksXG4gICAgdm93VG9vbHNcbiAgKTtcbiAgY29uc3QgbWFrZVBhY2tldFRvb2xzID0gcHJlcGFyZVBhY2tldFRvb2xzKFxuICAgIHpvbmUuc3ViWm9uZShcInBhY2tldFRvb2xzXCIpLFxuICAgIHZvd1Rvb2xzXG4gICk7XG4gIGNvbnN0IHRpbWVzdGFtcEhlbHBlciA9IG1ha2VUaW1lc3RhbXBIZWxwZXIodGltZXJTZXJ2aWNlKTtcbiAgY29uc3QgbWFrZUxvY2FsT3JjaGVzdHJhdGlvbkFjY291bnRLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiTG9jYWwgT3JjaGVzdHJhdGlvbiBBY2NvdW50IEtpdFwiLFxuICAgIHtcbiAgICAgIGhlbHBlcjogTS5pbnRlcmZhY2UoXCJoZWxwZXJcIiwge1xuICAgICAgICBhbW91bnRUb0NvaW46IE0uY2FsbChBbW91bnRBcmdTaGFwZSkucmV0dXJucyhNLnJlY29yZCgpKVxuICAgICAgfSksXG4gICAgICBob2xkZXI6IEhvbGRlckksXG4gICAgICB1bmRlbGVnYXRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJ1bmRlbGVnYXRlV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoW1xuICAgICAgICAgIE0uc3BsaXRSZWNvcmQoeyBjb21wbGV0aW9uVGltZTogVGltZXN0YW1wUHJvdG9TaGFwZSB9KVxuICAgICAgICBdKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgICB9KSxcbiAgICAgIHRyYW5zZmVyV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJ0cmFuc2ZlcldhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ubmF0KCkpLm9wdGlvbmFsKHtcbiAgICAgICAgICBvcHRzOiBNLm9yKE0udW5kZWZpbmVkKCksIElCQ1RyYW5zZmVyT3B0aW9uc1NoYXBlKSxcbiAgICAgICAgICByb3V0ZTogVHJhbnNmZXJSb3V0ZVNoYXBlXG4gICAgICAgIH0pLnJldHVybnMoVm93JDYoTS5yZWNvcmQoKSkpXG4gICAgICB9KSxcbiAgICAgIGV4dHJhY3RGaXJzdFJlc3VsdFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiZXh0cmFjdEZpcnN0UmVzdWx0V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoW00ucmVjb3JkKCldKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcmV0dXJuVm9pZFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmV0dXJuVm9pZFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLm9wdGlvbmFsKE0uYW55KCkpLnJldHVybnMoTS51bmRlZmluZWQoKSlcbiAgICAgIH0pLFxuICAgICAgc2VhdEV4aXRlckhhbmRsZXI6IE0uaW50ZXJmYWNlKFwic2VhdEV4aXRlckhhbmRsZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0udW5kZWZpbmVkKCksIE0ucmVtb3RhYmxlKCkpLnJldHVybnMoXG4gICAgICAgICAgTS51bmRlZmluZWQoKVxuICAgICAgICApLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5lcnJvcigpLCBNLnJlbW90YWJsZSgpKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpXG4gICAgICB9KSxcbiAgICAgIGdldEJhbGFuY2VXYXRjaGVyOiBNLmludGVyZmFjZShcImdldEJhbGFuY2VXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChBbW91bnRTaGFwZSwgRGVub21TaGFwZSkucmV0dXJucyhEZW5vbUFtb3VudFNoYXBlKVxuICAgICAgfSksXG4gICAgICBxdWVyeUJhbGFuY2VXYXRjaGVyOiBNLmludGVyZmFjZShcInF1ZXJ5QmFsYW5jZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKFR5cGVkSnNvblNoYXBlKS5yZXR1cm5zKERlbm9tQW1vdW50U2hhcGUpXG4gICAgICB9KSxcbiAgICAgIHF1ZXJ5QmFsYW5jZXNXYXRjaGVyOiBNLmludGVyZmFjZShcInF1ZXJ5QmFsYW5jZXNXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChUeXBlZEpzb25TaGFwZSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoRGVub21BbW91bnRTaGFwZSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICBwYXJzZUluYm91bmRUcmFuc2ZlcldhdGNoZXI6IE0uaW50ZXJmYWNlKFwicGFyc2VJbmJvdW5kVHJhbnNmZXJXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnJlY29yZCgpLCBNLnJlY29yZCgpKS5yZXR1cm5zKE0ucmVjb3JkKCkpLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSwgTS5yZWNvcmQoKSkucmV0dXJucyhNLnJlY29yZCgpKVxuICAgICAgfSksXG4gICAgICBpbnZpdGF0aW9uTWFrZXJzOiBNLmludGVyZmFjZShcImludml0YXRpb25NYWtlcnNcIiwge1xuICAgICAgICBDbG9zZUFjY291bnQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBEZWxlZ2F0ZTogTS5jYWxsKE0uc3RyaW5nKCksIEFtb3VudFNoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgRGVwb3NpdDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIFNlbmQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBTZW5kQWxsOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgVHJhbnNmZXI6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBVbmRlbGVnYXRlOiBNLmNhbGwoTS5zdHJpbmcoKSwgQW1vdW50U2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBXaXRoZHJhdzogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICAgIH0pXG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cbiAgICAgKi9cbiAgICAoeyBhY2NvdW50LCBhZGRyZXNzLCBzdG9yYWdlTm9kZSB9KSA9PiB7XG4gICAgICBjb25zdCB0b3BpY0tpdCA9IHN0b3JhZ2VOb2RlID8gbWFrZVJlY29yZGVyS2l0KHN0b3JhZ2VOb2RlLCBQVUJMSUNfVE9QSUNTMi5hY2NvdW50WzFdKSA6IHZvaWQgMDtcbiAgICAgIGlmICh0b3BpY0tpdCkge1xuICAgICAgICB2b2lkIEUodG9waWNLaXQucmVjb3JkZXIpLndyaXRlKFwiXCIpO1xuICAgICAgfVxuICAgICAgY29uc3QgcGFja2V0VG9vbHMgPSBtYWtlUGFja2V0VG9vbHMoYWNjb3VudCk7XG4gICAgICByZXR1cm4geyBhY2NvdW50LCBhZGRyZXNzLCBwYWNrZXRUb29scywgdG9waWNLaXQgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGhlbHBlcjoge1xuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGFtb3VudFRvQ29pbihhbW91bnQpIHtcbiAgICAgICAgICByZXR1cm4gY29lcmNlQ29pbihjaGFpbkh1YiwgYW1vdW50KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGludml0YXRpb25NYWtlcnM6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBEZWxlZ2F0ZSh2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KSB7XG4gICAgICAgICAgdHJhY2U2KFwiRGVsZWdhdGVcIiwgdmFsaWRhdG9yQWRkcmVzcywgZXJ0cEFtb3VudCk7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmhvbGRlci5kZWxlZ2F0ZSh2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCBcIkRlbGVnYXRlXCIpO1xuICAgICAgICB9LFxuICAgICAgICBEZXBvc2l0KCkge1xuICAgICAgICAgIHRyYWNlNihcIkRlcG9zaXRcIik7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihcbiAgICAgICAgICAgIChzZWF0KSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHsgZ2l2ZSB9ID0gc2VhdC5nZXRQcm9wb3NhbCgpO1xuICAgICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgICAgem9lVG9vbHMubG9jYWxUcmFuc2ZlcihcbiAgICAgICAgICAgICAgICAgIHNlYXQsXG4gICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5hY2NvdW50LFxuICAgICAgICAgICAgICAgICAgZ2l2ZVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgdGhpcy5mYWNldHMuc2VhdEV4aXRlckhhbmRsZXIsXG4gICAgICAgICAgICAgICAgc2VhdFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiRGVwb3NpdFwiLFxuICAgICAgICAgICAgdm9pZCAwLFxuICAgICAgICAgICAgTS5zcGxpdFJlY29yZCh7IGdpdmU6IEFueU5hdEFtb3VudHNSZWNvcmQsIHdhbnQ6IHt9IH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBVbmRlbGVnYXRlKHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpIHtcbiAgICAgICAgICB0cmFjZTYoXCJVbmRlbGVnYXRlXCIsIHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5ob2xkZXIudW5kZWxlZ2F0ZSh2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCBcIlVuZGVsZWdhdGVcIik7XG4gICAgICAgIH0sXG4gICAgICAgIENsb3NlQWNjb3VudCgpIHtcbiAgICAgICAgICB0aHJvdyBFcnJvcihcIm5vdCB5ZXQgaW1wbGVtZW50ZWRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFNlbmQoKSB7XG4gICAgICAgICAgY29uc3Qgb2ZmZXJIYW5kbGVyID0gKHNlYXQsIHsgdG9BY2NvdW50LCBhbW91bnQgfSkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLnNlbmQodG9BY2NvdW50LCBhbW91bnQpKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24ob2ZmZXJIYW5kbGVyLCBcIlNlbmRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFNlbmRBbGwoKSB7XG4gICAgICAgICAgY29uc3Qgb2ZmZXJIYW5kbGVyID0gKHNlYXQsIHsgdG9BY2NvdW50LCBhbW91bnRzIH0pID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5zZW5kQWxsKHRvQWNjb3VudCwgYW1vdW50cykpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihvZmZlckhhbmRsZXIsIFwiU2VuZEFsbFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgVHJhbnNmZXIoKSB7XG4gICAgICAgICAgY29uc3Qgb2ZmZXJIYW5kbGVyID0gKHNlYXQsIHsgYW1vdW50LCBkZXN0aW5hdGlvbiwgb3B0cyB9KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMuaG9sZGVyLnRyYW5zZmVyKGRlc3RpbmF0aW9uLCBhbW91bnQsIG9wdHMpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihvZmZlckhhbmRsZXIsIFwiVHJhbnNmZXJcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFdpdGhkcmF3KCkge1xuICAgICAgICAgIHRyYWNlNihcIldpdGhkcmF3XCIpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oXG4gICAgICAgICAgICAoc2VhdCkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCB7IHdhbnQgfSA9IHNlYXQuZ2V0UHJvcG9zYWwoKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICAgIHpvZVRvb2xzLndpdGhkcmF3VG9TZWF0KFxuICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUuYWNjb3VudCxcbiAgICAgICAgICAgICAgICAgIHNlYXQsXG4gICAgICAgICAgICAgICAgICB3YW50XG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5zZWF0RXhpdGVySGFuZGxlcixcbiAgICAgICAgICAgICAgICBzZWF0XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJXaXRoZHJhd1wiLFxuICAgICAgICAgICAgdm9pZCAwLFxuICAgICAgICAgICAgTS5zcGxpdFJlY29yZCh7IGdpdmU6IHt9LCB3YW50OiBBbnlOYXRBbW91bnRzUmVjb3JkIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHVuZGVsZWdhdGVXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzcG9uc2UpIHtcbiAgICAgICAgICBjb25zdCB7IGNvbXBsZXRpb25UaW1lIH0gPSByZXNwb25zZVswXTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKHRpbWVyU2VydmljZSkud2FrZUF0KFxuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBCaWdJbnQoY29tcGxldGlvblRpbWUuc2Vjb25kcykgKyBtYXhDbG9ja1NrZXdcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0cmFuc2ZlcldhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZCh0aW1lb3V0VGltZXN0YW1wLCB7IG9wdHMsIHJvdXRlIH0pIHtcbiAgICAgICAgICBjb25zdCB7IGZvcndhcmRJbmZvLCAuLi50cmFuc2ZlckRldGFpbHMgfSA9IHJvdXRlO1xuICAgICAgICAgIGxldCBtZW1vO1xuICAgICAgICAgIGlmIChvcHRzICYmIFwibWVtb1wiIGluIG9wdHMpIHtcbiAgICAgICAgICAgIG1lbW8gPSBvcHRzLm1lbW87XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChmb3J3YXJkSW5mbykge1xuICAgICAgICAgICAgbWVtbyA9IEpTT04uc3RyaW5naWZ5KGZvcndhcmRJbmZvKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgdHJhbnNmZXJNc2cgPSB0eXBlZEpzb24oXG4gICAgICAgICAgICBcIi9pYmMuYXBwbGljYXRpb25zLnRyYW5zZmVyLnYxLk1zZ1RyYW5zZmVyXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIC4uLnRyYW5zZmVyRGV0YWlscyxcbiAgICAgICAgICAgICAgc2VuZGVyOiB0aGlzLnN0YXRlLmFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgIHRpbWVvdXRIZWlnaHQ6IG9wdHM/LnRpbWVvdXRIZWlnaHQgPz8ge1xuICAgICAgICAgICAgICAgIHJldmlzaW9uSGVpZ2h0OiAwbixcbiAgICAgICAgICAgICAgICByZXZpc2lvbk51bWJlcjogMG5cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdGltZW91dFRpbWVzdGFtcCxcbiAgICAgICAgICAgICAgbWVtbzogbWVtbyA/PyBcIlwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCB7IGhvbGRlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3Qgc2VuZGVyID0gbWFrZUlCQ1RyYW5zZmVyU2VuZGVyKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICAgICAgICBob2xkZXIsXG4gICAgICAgICAgICB0cmFuc2Zlck1zZ1xuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGhvbGRlci5zZW5kVGhlbldhaXRGb3JBY2soc2VuZGVyKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBleHRyYWN0Rmlyc3RSZXN1bHRXYXRjaGVyOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdHMpIHtcbiAgICAgICAgICByZXN1bHRzLmxlbmd0aCA9PT0gMSB8fCB0aHJvd1JlZGFjdGVkYGV4cGVjdGVkIGV4YWN0bHkgb25lIHJlc3VsdDsgZ290ICR7cmVzdWx0c31gO1xuICAgICAgICAgIHJldHVybiByZXN1bHRzWzBdO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmV0dXJuVm9pZFdhdGNoZXI6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoKSB7XG4gICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBnZXRCYWxhbmNlV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQobmF0QW1vdW50LCBkZW5vbSkge1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkZW5vbSwgdmFsdWU6IG5hdEFtb3VudC52YWx1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBzZWF0RXhpdGVySGFuZGxlcjoge1xuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKF8sIHNlYXQpIHtcbiAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgc2VhdCkge1xuICAgICAgICAgIHNlYXQuZXhpdChyZWFzb24pO1xuICAgICAgICAgIHRocm93IHJlYXNvbjtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBxdWVyeUJhbGFuY2VXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCkge1xuICAgICAgICAgIGNvbnN0IHsgYmFsYW5jZSB9ID0gcmVzdWx0O1xuICAgICAgICAgIGlmICghYmFsYW5jZSB8fCAhYmFsYW5jZT8uZGVub20pIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgRXhwZWN0ZWQgYmFsYW5jZSAke3F1b3RlKHJlc3VsdCl9O2A7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBoYXJkZW4odG9EZW5vbUFtb3VudChiYWxhbmNlKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgcXVlcnlCYWxhbmNlc1dhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCkge1xuICAgICAgICAgIGNvbnN0IHsgYmFsYW5jZXMgfSA9IHJlc3VsdDtcbiAgICAgICAgICBpZiAoIWJhbGFuY2VzIHx8ICFBcnJheS5pc0FycmF5KGJhbGFuY2VzKSkge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCBiYWxhbmNlcyAke3F1b3RlKHJlc3VsdCl9O2A7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBoYXJkZW4oYmFsYW5jZXMubWFwKHRvRGVub21BbW91bnQpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHBhcnNlSW5ib3VuZFRyYW5zZmVyV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChsb2NhbERlbm9tSGFzaCwgbmFpdmVSZXN1bHQpIHtcbiAgICAgICAgICBjb25zdCBsb2NhbERlbm9tID0gYGliYy8ke2xvY2FsRGVub21IYXNoLmhhc2h9YDtcbiAgICAgICAgICBjb25zdCB7IGFtb3VudCwgLi4ucmVzdCB9ID0gbmFpdmVSZXN1bHQ7XG4gICAgICAgICAgY29uc3QgeyBkZW5vbTogXywgLi4uYW1vdW50UmVzdCB9ID0gYW1vdW50O1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgIGFtb3VudDogeyAuLi5hbW91bnRSZXN0LCBkZW5vbTogbG9jYWxEZW5vbSB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCBuYWl2ZVJlc3VsdCkge1xuICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBFcnJvciAmJiBTdHJpbmcocmVhc29uLm1lc3NhZ2UpLmluY2x1ZGVzKFwiZGVub21pbmF0aW9uIHRyYWNlIG5vdCBmb3VuZFwiKSkge1xuICAgICAgICAgICAgcmV0dXJuIG5haXZlUmVzdWx0O1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aHJvdyByZWFzb247XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBob2xkZXI6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBhc0NvbnRpbnVpbmdPZmZlcigpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgbnVsbDtcbiAgICAgICAgICAgIGNvbnN0IHsgaG9sZGVyLCBpbnZpdGF0aW9uTWFrZXJzOiBpbSB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCBpbnZpdGF0aW9uTWFrZXJzID0gKFxuICAgICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgaW1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgcHVibGljU3Vic2NyaWJlcnM6IGF3YWl0IHdoZW4oaG9sZGVyLmdldFB1YmxpY1RvcGljcygpKSxcbiAgICAgICAgICAgICAgaW52aXRhdGlvbk1ha2Vyc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRCYWxhbmNlKGRlbm9tQXJnKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IFticmFuZCwgZGVub21dID0gdHlwZW9mIGRlbm9tQXJnID09PSBcInN0cmluZ1wiID8gW2NoYWluSHViLmdldEFzc2V0KGRlbm9tQXJnLCBcImFnb3JpY1wiKT8uYnJhbmQsIGRlbm9tQXJnXSA6IFtkZW5vbUFyZywgY2hhaW5IdWIuZ2V0RGVub20oZGVub21BcmcpXTtcbiAgICAgICAgICAgIGlmICghZGVub20pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBObyBkZW5vbSBmb3IgYnJhbmQ6ICR7ZGVub21Bcmd9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChicmFuZCkge1xuICAgICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgICAgRSh0aGlzLnN0YXRlLmFjY291bnQpLmdldEJhbGFuY2UoYnJhbmQpLFxuICAgICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmdldEJhbGFuY2VXYXRjaGVyLFxuICAgICAgICAgICAgICAgIGRlbm9tXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUobG9jYWxjaGFpbikucXVlcnkoXG4gICAgICAgICAgICAgICAgdHlwZWRKc29uKFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlCYWxhbmNlUmVxdWVzdFwiLCB7XG4gICAgICAgICAgICAgICAgICBhZGRyZXNzOiB0aGlzLnN0YXRlLmFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICBkZW5vbVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnF1ZXJ5QmFsYW5jZVdhdGNoZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0QmFsYW5jZXMoKSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgRShsb2NhbGNoYWluKS5xdWVyeShcbiAgICAgICAgICAgICAgdHlwZWRKc29uKFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3RcIiwge1xuICAgICAgICAgICAgICAgIGFkZHJlc3M6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnF1ZXJ5QmFsYW5jZXNXYXRjaGVyXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0UHVibGljVG9waWNzKCkge1xuICAgICAgICAgIHJldHVybiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBudWxsO1xuICAgICAgICAgICAgY29uc3QgeyB0b3BpY0tpdCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghdG9waWNLaXQpIHRocm93IHRocm93UmVkYWN0ZWRgTm8gdG9waWNLaXQ7IHN0b3JhZ2VOb2RlIG5vdCBwcm92aWRlZGA7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgICAgICAgYWNjb3VudDoge1xuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBQVUJMSUNfVE9QSUNTMi5hY2NvdW50WzBdLFxuICAgICAgICAgICAgICAgIHN1YnNjcmliZXI6IHRvcGljS2l0LnN1YnNjcmliZXIsXG4gICAgICAgICAgICAgICAgc3RvcmFnZVBhdGg6IGF3YWl0IHRvcGljS2l0LnJlY29yZGVyLmdldFN0b3JhZ2VQYXRoKClcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vXG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgZGVsZWdhdGUodmFsaWRhdG9yQWRkcmVzcywgZXJ0cEFtb3VudCkge1xuICAgICAgICAgIGNvbnN0IHsgYWNjb3VudDogbGNhIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGNvbnN0IGFtb3VudCA9IGNvZXJjZUNvaW4oY2hhaW5IdWIsIGVydHBBbW91bnQpO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUobGNhKS5leGVjdXRlVHgoW1xuICAgICAgICAgICAgICB0eXBlZEpzb24oXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dEZWxlZ2F0ZVwiLCB7XG4gICAgICAgICAgICAgICAgYW1vdW50LFxuICAgICAgICAgICAgICAgIHZhbGlkYXRvckFkZHJlc3MsXG4gICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcmVzczogdGhpcy5zdGF0ZS5hZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLmV4dHJhY3RGaXJzdFJlc3VsdFdhdGNoZXJcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvL1xuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgdW5kZWxlZ2F0ZSh2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KSB7XG4gICAgICAgICAgY29uc3QgYW1vdW50ID0gY29lcmNlQ29pbihjaGFpbkh1YiwgZXJ0cEFtb3VudCk7XG4gICAgICAgICAgY29uc3QgeyBhY2NvdW50OiBsY2EgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgRShsY2EpLmV4ZWN1dGVUeChbXG4gICAgICAgICAgICAgIHR5cGVkSnNvbihcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ1VuZGVsZWdhdGVcIiwge1xuICAgICAgICAgICAgICAgIGFtb3VudCxcbiAgICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyZXNzLFxuICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHJlc3M6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy51bmRlbGVnYXRlV2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBkZXBvc2l0KHBheW1lbnQpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKHRoaXMuc3RhdGUuYWNjb3VudCkuZGVwb3NpdChwYXltZW50KSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHdpdGhkcmF3KGFtb3VudCkge1xuICAgICAgICAgIHJldHVybiB3YXRjaChFKHRoaXMuc3RhdGUuYWNjb3VudCkud2l0aGRyYXcoYW1vdW50KSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGV4ZWN1dGVUeChtZXNzYWdlcykge1xuICAgICAgICAgIHJldHVybiB3YXRjaChFKHRoaXMuc3RhdGUuYWNjb3VudCkuZXhlY3V0ZVR4KG1lc3NhZ2VzKSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0QWRkcmVzcygpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5hZGRyZXNzO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZCh0b0FjY291bnQsIGFtb3VudCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTYoXCJzZW5kXCIsIHRvQWNjb3VudCwgYW1vdW50KTtcbiAgICAgICAgICAgIGNvbnN0IGNvc21vc0Rlc3QgPSBjaGFpbkh1Yi5jb2VyY2VDb3Ntb3NBZGRyZXNzKHRvQWNjb3VudCk7XG4gICAgICAgICAgICBjb3Ntb3NEZXN0LmNoYWluSWQgPT09IHRoaXMuc3RhdGUuYWRkcmVzcy5jaGFpbklkIHx8IHRocm93UmVkYWN0ZWRgYmFuay9zZW5kIGNhbm5vdCBzZW5kIHRvIGEgZGlmZmVyZW50IGNoYWluICR7cXVvdGUoY29zbW9zRGVzdC5jaGFpbklkKX1gO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICBFKHRoaXMuc3RhdGUuYWNjb3VudCkuZXhlY3V0ZVR4KFtcbiAgICAgICAgICAgICAgICB0eXBlZEpzb24oXCIvY29zbW9zLmJhbmsudjFiZXRhMS5Nc2dTZW5kXCIsIHtcbiAgICAgICAgICAgICAgICAgIGFtb3VudDogW2hlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KV0sXG4gICAgICAgICAgICAgICAgICB0b0FkZHJlc3M6IGNvc21vc0Rlc3QudmFsdWUsXG4gICAgICAgICAgICAgICAgICBmcm9tQWRkcmVzczogdGhpcy5zdGF0ZS5hZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZEFsbCh0b0FjY291bnQsIGFtb3VudHMpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2U2KFwic2VuZEFsbFwiLCB0b0FjY291bnQsIGFtb3VudHMpO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICBFKHRoaXMuc3RhdGUuYWNjb3VudCkuZXhlY3V0ZVR4KFtcbiAgICAgICAgICAgICAgICB0eXBlZEpzb24oXCIvY29zbW9zLmJhbmsudjFiZXRhMS5Nc2dTZW5kXCIsIHtcbiAgICAgICAgICAgICAgICAgIGFtb3VudDogYW1vdW50cy5tYXAoKGEyKSA9PiBoZWxwZXIuYW1vdW50VG9Db2luKGEyKSksXG4gICAgICAgICAgICAgICAgICB0b0FkZHJlc3M6IHRvQWNjb3VudC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIGZyb21BZGRyZXNzOiB0aGlzLnN0YXRlLmFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHRyYW5zZmVyKGRlc3RpbmF0aW9uLCBhbW91bnQsIG9wdHMpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2U2KFwiVHJhbnNmZXJyaW5nIGZ1bmRzIG92ZXIgSUJDXCIpO1xuICAgICAgICAgICAgY29uc3QgZGVub21BbW91bnQgPSBjb2VyY2VEZW5vbUFtb3VudChjaGFpbkh1YiwgYW1vdW50KTtcbiAgICAgICAgICAgIGNvbnN0IHsgZm9yd2FyZE9wdHMsIC4uLnJlc3QgfSA9IG9wdHMgPz8ge307XG4gICAgICAgICAgICBjb25zdCByb3V0ZSA9IGNoYWluSHViLm1ha2VUcmFuc2ZlclJvdXRlKFxuICAgICAgICAgICAgICBkZXN0aW5hdGlvbixcbiAgICAgICAgICAgICAgZGVub21BbW91bnQsXG4gICAgICAgICAgICAgIFwiYWdvcmljXCIsXG4gICAgICAgICAgICAgIGZvcndhcmRPcHRzXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdHJhY2U2KFwiZ290IHRyYW5zZmVyIHJvdXRlXCIsIHJvdXRlKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdFYgPSB3YXRjaChcbiAgICAgICAgICAgICAgdGltZXN0YW1wSGVscGVyLnZvd09yVmFsdWVGcm9tT3B0cyhvcHRzKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMudHJhbnNmZXJXYXRjaGVyLFxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgb3B0czogcmVzdCxcbiAgICAgICAgICAgICAgICByb3V0ZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFY7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIHBhcnNlSW5ib3VuZFRyYW5zZmVyKHJlY29yZCkge1xuICAgICAgICAgIHRyYWNlNihcInBhcnNlSW5ib3VuZFRyYW5zZmVyXCIsIHJlY29yZCk7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHBhY2tldCA9IChcbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgIHJlY29yZFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IGZ0UGFja2V0RGF0YSA9IEpTT04ucGFyc2UoYXRvYihwYWNrZXQuZGF0YSkpO1xuICAgICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgICBkZW5vbTogdHJhbnNmZXJEZW5vbSxcbiAgICAgICAgICAgICAgc2VuZGVyLFxuICAgICAgICAgICAgICByZWNlaXZlcixcbiAgICAgICAgICAgICAgYW1vdW50XG4gICAgICAgICAgICB9ID0gZnRQYWNrZXREYXRhO1xuICAgICAgICAgICAgY29uc3QgcmVzb2x2ZUJlY2gzMkFkZHJlc3MgPSAoYWRkcmVzcykgPT4gY2hhaW5IdWIucmVzb2x2ZUFjY291bnRJZChcbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICBhZGRyZXNzXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgYnVpbGRSZXR1cm5WYWx1ZSA9IChsb2NhbERlbm9tKSA9PiBoYXJkZW4oe1xuICAgICAgICAgICAgICBhbW91bnQ6IChcbiAgICAgICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIHZhbHVlOiBCaWdJbnQoYW1vdW50KSxcbiAgICAgICAgICAgICAgICAgIGRlbm9tOiBsb2NhbERlbm9tXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICBmcm9tQWNjb3VudDogcmVzb2x2ZUJlY2gzMkFkZHJlc3Moc2VuZGVyKSxcbiAgICAgICAgICAgICAgdG9BY2NvdW50OiByZXNvbHZlQmVjaDMyQWRkcmVzcyhyZWNlaXZlciksXG4gICAgICAgICAgICAgIGV4dHJhOiB7XG4gICAgICAgICAgICAgICAgLi4uZnRQYWNrZXREYXRhXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IGRlbm9tT3JUcmFjZTtcbiAgICAgICAgICAgIGNvbnN0IHByZWZpeCA9IGAke3BhY2tldC5zb3VyY2VfcG9ydH0vJHtwYWNrZXQuc291cmNlX2NoYW5uZWx9L2A7XG4gICAgICAgICAgICB0cmFjZTYoeyB0cmFuc2ZlckRlbm9tLCBwcmVmaXggfSk7XG4gICAgICAgICAgICBpZiAodHJhbnNmZXJEZW5vbS5zdGFydHNXaXRoKHByZWZpeCkpIHtcbiAgICAgICAgICAgICAgZGVub21PclRyYWNlID0gdHJhbnNmZXJEZW5vbS5zbGljZShwcmVmaXgubGVuZ3RoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGRlbm9tT3JUcmFjZSA9IGAke3BhY2tldC5kZXN0aW5hdGlvbl9wb3J0fS8ke3BhY2tldC5kZXN0aW5hdGlvbl9jaGFubmVsfS8ke3RyYW5zZmVyRGVub219YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShsb2NhbGNoYWluKS5xdWVyeShcbiAgICAgICAgICAgICAgICB0eXBlZEpzb24oXG4gICAgICAgICAgICAgICAgICBcIi9pYmMuYXBwbGljYXRpb25zLnRyYW5zZmVyLnYxLlF1ZXJ5RGVub21IYXNoUmVxdWVzdFwiLFxuICAgICAgICAgICAgICAgICAgeyB0cmFjZTogZGVub21PclRyYWNlIH1cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnBhcnNlSW5ib3VuZFRyYW5zZmVyV2F0Y2hlcixcbiAgICAgICAgICAgICAgYnVpbGRSZXR1cm5WYWx1ZShkZW5vbU9yVHJhY2UpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdHJhbnNmZXJTdGVwcyhhbW91bnQsIG1zZykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInRyYW5zZmVyU3RlcHMgZ290XCIsIGFtb3VudCwgbXNnKTtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgbm90IHlldCBpbXBsZW1lbnRlZGA7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNlbmRUaGVuV2FpdEZvckFjayhzZW5kZXIsIG9wdHMpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKHRoaXMuc3RhdGUucGFja2V0VG9vbHMpLnNlbmRUaGVuV2FpdEZvckFjayhzZW5kZXIsIG9wdHMpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG1hdGNoRmlyc3RQYWNrZXQocGF0dGVyblYpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goRSh0aGlzLnN0YXRlLnBhY2tldFRvb2xzKS5tYXRjaEZpcnN0UGFja2V0KHBhdHRlcm5WKSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG1vbml0b3JUcmFuc2ZlcnModGFwKSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUodGhpcy5zdGF0ZS5wYWNrZXRUb29scykubW9uaXRvclRyYW5zZmVycyh0YXApKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuIG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0O1xufTtcblxuLy9cbnZhciB7IFZvdyQ6IFZvdyQ3IH0gPSBTaGFwZTtcbnZhciB0cmFjZTcgPSBtYWtlVHJhY2VyKFwiT3JjaGVzdHJhdG9yXCIpO1xudmFyIE9yY2hlc3RyYXRvckkgPSBNLmludGVyZmFjZShcIk9yY2hlc3RyYXRvclwiLCB7XG4gIGdldENoYWluOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhWb3ckNyhNLnJlbW90YWJsZShcIkNoYWluRmFjYWRlXCIpKSksXG4gIGdldERlbm9tSW5mbzogTS5jYWxsKERlbm9tU2hhcGUsIE0uc3RyaW5nKCkpLnJldHVybnMoRGVub21JbmZvU2hhcGUpLFxuICBhc0Ftb3VudDogTS5jYWxsKERlbm9tQW1vdW50U2hhcGUpLnJldHVybnMoQW1vdW50U2hhcGUpXG59KTtcbnZhciBwcmVwYXJlT3JjaGVzdHJhdG9yS2l0ID0gKHpvbmUsIHtcbiAgY2hhaW5IdWIsXG4gIG1ha2VMb2NhbENoYWluRmFjYWRlLFxuICBtYWtlUmVtb3RlQ2hhaW5GYWNhZGUsXG4gIHZvd1Rvb2xzOiB7IHdhdGNoLCBhc1ZvdyB9XG59KSA9PiB7XG4gIGNvbnN0IGNoYWluQnlOYW1lID0gbWFrZVNjYWxhck1hcFN0b3JlKFwiY2hhaW5OYW1lXCIpO1xuICByZXR1cm4gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIk9yY2hlc3RyYXRvclwiLFxuICAgIHtcbiAgICAgIG9yY2hlc3RyYXRvcjogT3JjaGVzdHJhdG9ySSxcbiAgICAgIG1ha2VMb2NhbENoYWluRmFjYWRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJtYWtlTG9jYWxDaGFpbkZhY2FkZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVjb3JkKCkpLnJldHVybnMoTS5yZW1vdGFibGUoKSlcbiAgICAgIH0pLFxuICAgICAgbWFrZVJlbW90ZUNoYWluRmFjYWRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICAgIFwibWFrZVJlbW90ZUNoYWluRmFjYWRlV2F0Y2hlclwiLFxuICAgICAgICB7XG4gICAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpLCBNLnN0cmluZygpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS5yZW1vdGFibGUoKSlcbiAgICAgICAgfVxuICAgICAgKVxuICAgIH0sXG4gICAgKCkgPT4ge1xuICAgICAgdHJhY2U3KFwibWFraW5nIGFuIE9yY2hlc3RyYXRvclwiKTtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9LFxuICAgIHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBtYWtlTG9jYWxDaGFpbkZhY2FkZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoYWdvcmljQ2hhaW5JbmZvKSB7XG4gICAgICAgICAgY29uc3QgaXQgPSBtYWtlTG9jYWxDaGFpbkZhY2FkZShhZ29yaWNDaGFpbkluZm8pO1xuICAgICAgICAgIGNoYWluQnlOYW1lLnNldChcImFnb3JpY1wiLCBoYXJkZW4oeyB2YWx1ZTogaXQsIHBlbmRpbmc6IGZhbHNlIH0pKTtcbiAgICAgICAgICByZXR1cm4gaXQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgbWFrZVJlbW90ZUNoYWluRmFjYWRlV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtfYWdvcmljQ2hhaW5JbmZvLCByZW1vdGVDaGFpbkluZm8sIGNvbm5lY3Rpb25JbmZvXSwgbmFtZSkge1xuICAgICAgICAgIGNvbnN0IGl0ID0gbWFrZVJlbW90ZUNoYWluRmFjYWRlKHJlbW90ZUNoYWluSW5mbywgY29ubmVjdGlvbkluZm8pO1xuICAgICAgICAgIGNoYWluQnlOYW1lLnNldChuYW1lLCBoYXJkZW4oeyB2YWx1ZTogaXQsIHBlbmRpbmc6IGZhbHNlIH0pKTtcbiAgICAgICAgICByZXR1cm4gaXQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvcmNoZXN0cmF0b3I6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0Q2hhaW4obmFtZSkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBpZiAoY2hhaW5CeU5hbWUuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICAgIGNvbnN0IG1heWJlQ2hhaW4gPSBjaGFpbkJ5TmFtZS5nZXQobmFtZSk7XG4gICAgICAgICAgICAgIHJldHVybiBtYXliZUNoYWluLnBlbmRpbmcgPyBtYXliZUNoYWluLnZvdyA6IG1heWJlQ2hhaW4udmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB2b3cgPSBuYW1lID09PSBcImFnb3JpY1wiID8gd2F0Y2goXG4gICAgICAgICAgICAgIGNoYWluSHViLmdldENoYWluSW5mbyhcImFnb3JpY1wiKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMubWFrZUxvY2FsQ2hhaW5GYWNhZGVXYXRjaGVyXG4gICAgICAgICAgICApIDogd2F0Y2goXG4gICAgICAgICAgICAgIGNoYWluSHViLmdldENoYWluc0FuZENvbm5lY3Rpb24oXCJhZ29yaWNcIiwgbmFtZSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLm1ha2VSZW1vdGVDaGFpbkZhY2FkZVdhdGNoZXIsXG4gICAgICAgICAgICAgIG5hbWVcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjaGFpbkJ5TmFtZS5pbml0KG5hbWUsIGhhcmRlbih7IHZvdywgcGVuZGluZzogdHJ1ZSB9KSk7XG4gICAgICAgICAgICByZXR1cm4gdm93O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0RGVub21JbmZvKGRlbm9tLCBob2xkaW5nQ2hhaW5OYW1lKSB7XG4gICAgICAgICAgY29uc3QgZGVub21EZXRhaWwgPSBjaGFpbkh1Yi5nZXRBc3NldChkZW5vbSwgaG9sZGluZ0NoYWluTmFtZSk7XG4gICAgICAgICAgaWYgKCFkZW5vbURldGFpbCkgdGhyb3cgdGhyb3dSZWRhY3RlZGBObyBkZW5vbSBkZXRhaWwgZm9yICR7cXVvdGUoZGVub20pfWA7XG4gICAgICAgICAgY29uc3QgeyBjaGFpbk5hbWUsIGJhc2VOYW1lLCBiYXNlRGVub20sIGJyYW5kIH0gPSBkZW5vbURldGFpbDtcbiAgICAgICAgICBjaGFpbkJ5TmFtZS5oYXMoY2hhaW5OYW1lKSB8fCB0aHJvd1JlZGFjdGVkYHVzZSBnZXRDaGFpbigke3F1b3RlKGNoYWluTmFtZSl9KSBiZWZvcmUgZ2V0RGVub21JbmZvKCR7cXVvdGUoZGVub20pfSlgO1xuICAgICAgICAgIGNvbnN0IG1heWJlQ2hhaW4gPSBjaGFpbkJ5TmFtZS5nZXQoY2hhaW5OYW1lKTtcbiAgICAgICAgICBpZiAobWF5YmVDaGFpbi5wZW5kaW5nKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHdhaXQgdW50aWwgZ2V0Q2hhaW4oJHtxdW90ZShjaGFpbk5hbWUpfSkgY29tcGxldGVzIGJlZm9yZSBnZXREZW5vbUluZm8oJHtxdW90ZShkZW5vbSl9KWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGNoYWluID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgbWF5YmVDaGFpbi52YWx1ZVxuICAgICAgICAgICk7XG4gICAgICAgICAgY2hhaW5CeU5hbWUuaGFzKGJhc2VOYW1lKSB8fCB0aHJvd1JlZGFjdGVkYHVzZSBnZXRDaGFpbigke3F1b3RlKGJhc2VOYW1lKX0pIGJlZm9yZSBnZXREZW5vbUluZm8oJHtxdW90ZShkZW5vbSl9KWA7XG4gICAgICAgICAgY29uc3QgbWF5YmVCYXNlID0gY2hhaW5CeU5hbWUuZ2V0KGJhc2VOYW1lKTtcbiAgICAgICAgICBpZiAobWF5YmVCYXNlLnBlbmRpbmcpIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgd2FpdCB1bnRpbCBnZXRDaGFpbigke3F1b3RlKGJhc2VOYW1lKX0pIGNvbXBsZXRlcyBiZWZvcmUgZ2V0RGVub21JbmZvKCR7cXVvdGUoZGVub20pfSlgO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBiYXNlMiA9IChcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG1heWJlQmFzZS52YWx1ZVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGNoYWluLCBiYXNlOiBiYXNlMiwgYnJhbmQsIGJhc2VEZW5vbSB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYXNBbW91bnQ6ICgpID0+IHRocm93UmVkYWN0ZWRgbm90IHlldCBpbXBsZW1lbnRlZGBcbiAgICAgIH1cbiAgICB9XG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVPcmNoZXN0cmF0b3JLaXQpO1xudmFyIHByZXBhcmVPcmNoZXN0cmF0b3IgPSAoem9uZSwgcG93ZXJzKSA9PiB7XG4gIGNvbnN0IG1ha2VPcmNoZXN0cmF0b3JLaXQgPSBwcmVwYXJlT3JjaGVzdHJhdG9yS2l0KHpvbmUsIHBvd2Vycyk7XG4gIHJldHVybiBwaWNrRmFjZXQobWFrZU9yY2hlc3RyYXRvcktpdCwgXCJvcmNoZXN0cmF0b3JcIik7XG59O1xuXG4vL1xudmFyIHRyYWNlOCA9IG1ha2VUcmFjZXIoXCJSZW1vdGVDaGFpbkZhY2FkZVwiKTtcbnZhciBwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGVLaXQgPSAoem9uZSwge1xuICBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnQsXG4gIG9yY2hlc3RyYXRpb24sXG4gIC8vXG4gIC8vXG4gIHN0b3JhZ2VOb2RlLFxuICB0aW1lcixcbiAgdm93VG9vbHM6IHsgYWxsVm93cywgYXNWb3csIHdhdGNoIH1cbn0pID0+IHpvbmUuZXhvQ2xhc3NLaXQoXG4gIFwiUmVtb3RlQ2hhaW5GYWNhZGVcIixcbiAge1xuICAgIHB1YmxpYzogTS5pbnRlcmZhY2UoXCJSZW1vdGVDaGFpbkZhY2FkZVwiLCB7XG4gICAgICAuLi5jaGFpbkZhY2FkZU1ldGhvZHMsXG4gICAgICBxdWVyeTogTS5jYWxsKE0uYXJyYXlPZihJQ1FNc2dTaGFwZSkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgfSksXG4gICAgbWFrZUlDUUNvbm5lY3Rpb25RdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgXCJtYWtlSUNRQ29ubmVjdGlvblF1ZXJ5V2F0Y2hlclwiLFxuICAgICAge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVtb3RhYmxlKCksIE0uYXJyYXlPZihJQ1FNc2dTaGFwZSkpLnJldHVybnMoXG4gICAgICAgICAgVm93U2hhcGVcbiAgICAgICAgKVxuICAgICAgfVxuICAgICksXG4gICAgbWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICBcIm1ha2VBY2NvdW50QW5kUHJvdmlkZVF1ZXJ5Q29ubldhdGNoZXJcIixcbiAgICAgIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbXG4gICAgICAgICAgTS5yZW1vdGFibGUoKSxcbiAgICAgICAgICBNLm9yKE0ucmVtb3RhYmxlKCksIE0udW5kZWZpbmVkKCkpXG4gICAgICAgIF0pLnJldHVybnMoVm93U2hhcGUpXG4gICAgICB9XG4gICAgKSxcbiAgICBnZXRBZGRyZXNzZXNXYXRjaGVyOiBNLmludGVyZmFjZShcImdldEFkZHJlc3NXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoXG4gICAgICAgIFtDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSwgTS5zdHJpbmcoKSwgTS5zdHJpbmcoKV0sXG4gICAgICAgIE0ucmVtb3RhYmxlKClcbiAgICAgICkucmV0dXJucyhWb3dTaGFwZSlcbiAgICB9KSxcbiAgICBtYWtlQ2hpbGROb2RlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJtYWtlQ2hpbGROb2RlV2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ub3IoTS5yZW1vdGFibGUoKSwgTS51bmRlZmluZWQoKSksIHtcbiAgICAgICAgYWNjb3VudDogTS5yZW1vdGFibGUoKSxcbiAgICAgICAgY2hhaW5BZGRyZXNzOiBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICAgICAgbG9jYWxBZGRyZXNzOiBNLnN0cmluZygpLFxuICAgICAgICByZW1vdGVBZGRyZXNzOiBNLnN0cmluZygpXG4gICAgICB9KS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpXG4gICAgfSlcbiAgfSxcbiAgLypcblxuXG4gICAqL1xuICAocmVtb3RlQ2hhaW5JbmZvLCBjb25uZWN0aW9uSW5mbykgPT4ge1xuICAgIHRyYWNlOChcIm1ha2luZyBhIFJlbW90ZUNoYWluRmFjYWRlXCIpO1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICB7XG4gICAgICAgIHJlbW90ZUNoYWluSW5mbyxcbiAgICAgICAgY29ubmVjdGlvbkluZm8sXG4gICAgICAgIGljcUNvbm5lY3Rpb246IHZvaWQgMFxuICAgICAgfVxuICAgICk7XG4gIH0sXG4gIHtcbiAgICBwdWJsaWM6IHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBnZXRDaGFpbkluZm8oKSB7XG4gICAgICAgIHJldHVybiB3YXRjaCh0aGlzLnN0YXRlLnJlbW90ZUNoYWluSW5mbyk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgbWFrZUFjY291bnQoKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyByZW1vdGVDaGFpbkluZm8sIGNvbm5lY3Rpb25JbmZvIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChyZW1vdGVDaGFpbkluZm8ubmFtZXNwYWNlICE9PSBcImNvc21vc1wiKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYG9ubHkgc3VwcG9ydGVkIG9uICdjb3Ntb3MnIGNoYWlucywgbm90ICR7cmVtb3RlQ2hhaW5JbmZvLm5hbWVzcGFjZX1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWNvbm5lY3Rpb25JbmZvKSB0aHJvdyB0aHJvd1JlZGFjdGVkYElCQyBjb25uZWN0aW9uIGluZm8gbm90IGZvdW5kYDtcbiAgICAgICAgICBjb25zdCBpY3FDb25uT3JVbmRlZmluZWRWID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICByZW1vdGVDaGFpbkluZm8/LmljcUVuYWJsZWQgJiYgIXRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbiA/IEUob3JjaGVzdHJhdGlvbikucHJvdmlkZUlDUUNvbm5lY3Rpb24oY29ubmVjdGlvbkluZm8uaWQpIDogdm9pZCAwXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCBtYWtlQWNjb3VudFYgPSBFKG9yY2hlc3RyYXRpb24pLm1ha2VBY2NvdW50KFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICByZW1vdGVDaGFpbkluZm8uY2hhaW5JZCxcbiAgICAgICAgICAgIGNvbm5lY3Rpb25JbmZvLmNvdW50ZXJwYXJ0eS5jb25uZWN0aW9uX2lkLFxuICAgICAgICAgICAgY29ubmVjdGlvbkluZm8uaWRcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIGFsbFZvd3MoW21ha2VBY2NvdW50ViwgaWNxQ29ubk9yVW5kZWZpbmVkVl0pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMubWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHF1ZXJ5KG1zZ3MpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHJlbW90ZUNoYWluSW5mbzogeyBpY3FFbmFibGVkLCBjaGFpbklkIH0sXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgY29ubmVjdGlvbkluZm9cbiAgICAgICAgICB9ID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLnN0YXRlXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIWljcUVuYWJsZWQpIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluSWQpfWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghY29ubmVjdGlvbkluZm8pIHRocm93IHRocm93UmVkYWN0ZWRgSUJDIGNvbm5lY3Rpb24gaW5mbyBub3QgZm91bmRgO1xuICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUob3JjaGVzdHJhdGlvbikucHJvdmlkZUlDUUNvbm5lY3Rpb24oY29ubmVjdGlvbkluZm8uaWQpLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5tYWtlSUNRQ29ubmVjdGlvblF1ZXJ5V2F0Y2hlcixcbiAgICAgICAgICAgICAgbXNnc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUodGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKS5xdWVyeShtc2dzKSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlcjoge1xuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChbYWNjb3VudCwgaWNxQ29ubmVjdGlvbl0pIHtcbiAgICAgICAgaWYgKGljcUNvbm5lY3Rpb24gJiYgIXRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgIHRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbiA9IGljcUNvbm5lY3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgIGFsbFZvd3MoW1xuICAgICAgICAgICAgRShhY2NvdW50KS5nZXRBZGRyZXNzKCksXG4gICAgICAgICAgICBFKGFjY291bnQpLmdldExvY2FsQWRkcmVzcygpLFxuICAgICAgICAgICAgRShhY2NvdW50KS5nZXRSZW1vdGVBZGRyZXNzKClcbiAgICAgICAgICBdKSxcbiAgICAgICAgICB0aGlzLmZhY2V0cy5nZXRBZGRyZXNzZXNXYXRjaGVyLFxuICAgICAgICAgIGFjY291bnRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1ha2VJQ1FDb25uZWN0aW9uUXVlcnlXYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChpY3FDb25uZWN0aW9uLCBtc2dzKSB7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uID0gaWNxQ29ubmVjdGlvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gd2F0Y2goRShpY3FDb25uZWN0aW9uKS5xdWVyeShtc2dzKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBnZXRBZGRyZXNzZXNXYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoW2NoYWluQWRkcmVzcywgbG9jYWxBZGRyZXNzLCByZW1vdGVBZGRyZXNzXSwgYWNjb3VudCkge1xuICAgICAgICBjb25zdCBvcHRpb25hbFN0b3JhZ2VOb2RlID0gc3RvcmFnZU5vZGUgPyBFKHN0b3JhZ2VOb2RlKS5tYWtlQ2hpbGROb2RlKGNoYWluQWRkcmVzcy52YWx1ZSkgOiB2b2lkIDA7XG4gICAgICAgIHJldHVybiB3YXRjaChvcHRpb25hbFN0b3JhZ2VOb2RlLCB0aGlzLmZhY2V0cy5tYWtlQ2hpbGROb2RlV2F0Y2hlciwge1xuICAgICAgICAgIGFjY291bnQsXG4gICAgICAgICAgY2hhaW5BZGRyZXNzLFxuICAgICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgICByZW1vdGVBZGRyZXNzXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUNoaWxkTm9kZVdhdGNoZXI6IHtcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoY2hpbGROb2RlLCB7IGFjY291bnQsIGNoYWluQWRkcmVzcywgbG9jYWxBZGRyZXNzLCByZW1vdGVBZGRyZXNzIH0pIHtcbiAgICAgICAgY29uc3QgeyBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gbWFrZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50KFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGNoYWluQWRkcmVzcyxcbiAgICAgICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgICAgIHJlbW90ZUFkZHJlc3NcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGFjY291bnQsXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgc3RvcmFnZU5vZGU6IGNoaWxkTm9kZSxcbiAgICAgICAgICAgIGljcUNvbm5lY3Rpb24sXG4gICAgICAgICAgICB0aW1lclxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG5oYXJkZW4ocHJlcGFyZVJlbW90ZUNoYWluRmFjYWRlS2l0KTtcbnZhciBwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGUgPSAoem9uZSwgcG93ZXJzKSA9PiB7XG4gIGNvbnN0IG1ha2VMb2NhbENoYWluRmFjYWRlS2l0ID0gcHJlcGFyZVJlbW90ZUNoYWluRmFjYWRlS2l0KHpvbmUsIHBvd2Vycyk7XG4gIHJldHVybiBwaWNrRmFjZXQobWFrZUxvY2FsQ2hhaW5GYWNhZGVLaXQsIFwicHVibGljXCIpO1xufTtcbmhhcmRlbihwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGUpO1xuXG4vL1xudmFyIG1ha2VPcmNoZXN0cmF0aW9uRmFjYWRlID0gKHtcbiAgem9uZSxcbiAgdGltZXJTZXJ2aWNlLFxuICB6Y2YsXG4gIG9yY2hlc3RyYXRpb25TZXJ2aWNlLFxuICBtYWtlT3JjaGVzdHJhdG9yLFxuICB2b3dUb29scyxcbiAgYXN5bmNGbG93VG9vbHNcbn0pID0+IHtcbiAgYXNzZXJ0QWxsRGVmaW5lZCh7XG4gICAgem9uZSxcbiAgICB0aW1lclNlcnZpY2UsXG4gICAgemNmLFxuICAgIG9yY2hlc3RyYXRpb25TZXJ2aWNlLFxuICAgIG1ha2VPcmNoZXN0cmF0b3IsXG4gICAgdm93VG9vbHMsXG4gICAgYXN5bmNGbG93VG9vbHNcbiAgfSk7XG4gIGNvbnN0IHsgcHJlcGFyZUVuZG93bWVudCwgYXN5bmNGbG93IH0gPSBhc3luY0Zsb3dUb29scztcbiAgY29uc3Qgb3JjaGVzdHJhdGUgPSAoZHVyYWJsZU5hbWUsIGhvc3RDdHgsIGd1ZXN0Rm4pID0+IHtcbiAgICBjb25zdCBzdWJab25lID0gem9uZS5zdWJab25lKGR1cmFibGVOYW1lKTtcbiAgICBjb25zdCBbd3JhcHBlZEN0eF0gPSBwcmVwYXJlRW5kb3dtZW50KHN1YlpvbmUsIFwiZW5kb3dtZW50c1wiLCBbaG9zdEN0eF0pO1xuICAgIGNvbnN0IGhvc3RGbiA9IGFzeW5jRmxvdyhzdWJab25lLCBcImFzeW5jRmxvd1wiLCBndWVzdEZuKTtcbiAgICBkZWVwTWFwT2JqZWN0KFxuICAgICAgd3JhcHBlZEN0eCxcbiAgICAgICh2YWwpID0+IHZhbCA9PT0gemNmICYmIGFzc2VydC5mYWlsKFwiZG8gbm90IHVzZSB6Y2YgaW4gb3JjaGVzdHJhdGlvbiBjb250ZXh0OyB0cnkgemNmVG9vbHNcIilcbiAgICApO1xuICAgIGNvbnN0IG9yY0ZuID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgY29uc3QgaG9zdE9yYyA9IG1ha2VPcmNoZXN0cmF0b3IoKTtcbiAgICAgICAgcmV0dXJuIGhvc3RGbihob3N0T3JjLCB3cmFwcGVkQ3R4LCAuLi5hcmdzKTtcbiAgICAgIH1cbiAgICApO1xuICAgIHJldHVybiBoYXJkZW4ob3JjRm4pO1xuICB9O1xuICBjb25zdCBvcmNoZXN0cmF0ZUFsbCA9IChndWVzdEZucywgaG9zdEN0eCkgPT4ge1xuICAgIGNvbnN0IG1hcHBlZEZsb3dzID0gbmV3IE1hcChcbiAgICAgIE9iamVjdC5lbnRyaWVzKGd1ZXN0Rm5zKS5tYXAoKFtuYW1lLCBndWVzdEZuXSkgPT4gW1xuICAgICAgICBndWVzdEZuLFxuICAgICAgICAoLi4uYXJncykgPT4gb3JjRm5zW25hbWVdKC4uLmFyZ3MpXG4gICAgICBdKVxuICAgICk7XG4gICAgY29uc3QgbWFwcGVkQ29udGV4dCA9IGRlZXBNYXBPYmplY3QoXG4gICAgICBob3N0Q3R4LFxuICAgICAgKHZhbCkgPT4gbWFwcGVkRmxvd3MuZ2V0KFxuICAgICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApIHx8IHZhbFxuICAgICk7XG4gICAgY29uc3Qgb3JjRm5zID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgIE9iamVjdC5lbnRyaWVzKGd1ZXN0Rm5zKS5tYXAoKFtuYW1lLCBndWVzdEZuXSkgPT4gW1xuICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgb3JjaGVzdHJhdGUobmFtZSwgbWFwcGVkQ29udGV4dCwgZ3Vlc3RGbilcbiAgICAgICAgXSlcbiAgICAgIClcbiAgICApO1xuICAgIHJldHVybiB7IC4uLm9yY0ZucyB9O1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBvcmNoZXN0cmF0ZSxcbiAgICBvcmNoZXN0cmF0ZUFsbFxuICB9KTtcbn07XG5oYXJkZW4obWFrZU9yY2hlc3RyYXRpb25GYWNhZGUpO1xuXG4vL1xudmFyIG5hdFNhZmVNYXRoID0gaGFyZGVuKHtcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgLy9cbiAgYWRkOiAoeCwgeSkgPT4gTmF0KHgpICsgTmF0KHkpLFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBzdWJ0cmFjdDogKHgsIHkpID0+IE5hdChOYXQoeCkgLSBOYXQoeSkpLFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBtdWx0aXBseTogKHgsIHkpID0+IE5hdCh4KSAqIE5hdCh5KSxcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgZmxvb3JEaXZpZGU6ICh4LCB5KSA9PiBOYXQoeCkgLyBOYXQoeSksXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIGNlaWxEaXZpZGU6ICh4LCB5KSA9PiB7XG4gICAgeSA9IE5hdCh5KTtcbiAgICByZXR1cm4gTmF0KE5hdCh4KSArIHkgLSAxbikgLyB5O1xuICB9LFxuICAvKlxuXG5cblxuXG4gICAqL1xuICBiYW5rZXJzRGl2aWRlOiAoYTIsIGIzKSA9PiB7XG4gICAgYTIgPSBOYXQoYTIpO1xuICAgIGIzID0gTmF0KGIzKTtcbiAgICBjb25zdCBkaXYgPSBhMiAvIGIzO1xuICAgIGNvbnN0IHJlbSA9IGEyICUgYjM7XG4gICAgaWYgKHJlbSAqIDJuID4gYjMpIHtcbiAgICAgIHJldHVybiBkaXYgKyAxbjtcbiAgICB9IGVsc2UgaWYgKHJlbSAqIDJuID09PSBiMykge1xuICAgICAgaWYgKGRpdiAlIDJuID09PSAxbikgcmV0dXJuIGRpdiArIDFuO1xuICAgIH1cbiAgICByZXR1cm4gZGl2O1xuICB9LFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgaXNHVEU6ICh4LCB5KSA9PiBOYXQoeCkgPj0gTmF0KHkpXG59KTtcblxuLy9cbnZhciB7IHN1YnRyYWN0LCBhZGQsIG11bHRpcGx5LCBmbG9vckRpdmlkZSB9ID0gbmF0U2FmZU1hdGg7XG5cbi8vXG52YXIgbWFrZVN0YXRlTWFjaGluZSA9IChpbml0aWFsU3RhdGUsIGFsbG93ZWRUcmFuc2l0aW9uc0FycmF5KSA9PiB7XG4gIGxldCBzdGF0ZSA9IGluaXRpYWxTdGF0ZTtcbiAgY29uc3QgYWxsb3dlZFRyYW5zaXRpb25zID0gbmV3IE1hcChhbGxvd2VkVHJhbnNpdGlvbnNBcnJheSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGNhblRyYW5zaXRpb25UbzogKG5leHRTdGF0ZSkgPT4gYWxsb3dlZFRyYW5zaXRpb25zLmdldChzdGF0ZSkuaW5jbHVkZXMobmV4dFN0YXRlKSxcbiAgICB0cmFuc2l0aW9uVG86IChuZXh0U3RhdGUpID0+IHtcbiAgICAgIGFzc2VydDIoYWxsb3dlZFRyYW5zaXRpb25zLmdldChzdGF0ZSkuaW5jbHVkZXMobmV4dFN0YXRlKSk7XG4gICAgICBzdGF0ZSA9IG5leHRTdGF0ZTtcbiAgICB9LFxuICAgIGdldFN0YXR1czogKF8pID0+IHN0YXRlXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU3RhdGVNYWNoaW5lKTtcblxuLy9cbnZhciBLZXl3b3JkU2hhcGUgPSBNLnN0cmluZygpO1xudmFyIEludml0YXRpb25IYW5kbGVTaGFwZSA9IE0ucmVtb3RhYmxlKFwiSW52aXRhdGlvbkhhbmRsZVwiKTtcbnZhciBJbnZpdGF0aW9uU2hhcGUgPSBNLnJlbW90YWJsZShcIkludml0YXRpb25cIik7XG52YXIgSW5zdGFuY2VIYW5kbGVTaGFwZSA9IE0ucmVtb3RhYmxlKFwiSW5zdGFuY2VIYW5kbGVcIik7XG52YXIgSW5zdGFsbGF0aW9uU2hhcGUgPSBNLnJlbW90YWJsZShcIkluc3RhbGxhdGlvblwiKTtcbnZhciBTZWF0U2hhcGUgPSBNLnJlbW90YWJsZShcIlNlYXRcIik7XG52YXIgQW1vdW50S2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihLZXl3b3JkU2hhcGUsIEFtb3VudFNoYXBlKTtcbnZhciBBbW91bnRQYXR0ZXJuS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihcbiAgS2V5d29yZFNoYXBlLFxuICBNLnBhdHRlcm4oKVxuKTtcbnZhciBQYXltZW50UEtleXdvcmRSZWNvcmRTaGFwZSA9IE0ucmVjb3JkT2YoXG4gIEtleXdvcmRTaGFwZSxcbiAgTS5lcmVmKFBheW1lbnRTaGFwZSlcbik7XG52YXIgSXNzdWVyS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihLZXl3b3JkU2hhcGUsIElzc3VlclNoYXBlKTtcbnZhciBJc3N1ZXJQS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihcbiAgS2V5d29yZFNoYXBlLFxuICBNLmVyZWYoSXNzdWVyU2hhcGUpXG4pO1xudmFyIEJyYW5kS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihLZXl3b3JkU2hhcGUsIEJyYW5kU2hhcGUpO1xudmFyIElzc3VlclJlY29yZFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGJyYW5kOiBCcmFuZFNoYXBlLFxuICAgIGlzc3VlcjogSXNzdWVyU2hhcGUsXG4gICAgYXNzZXRLaW5kOiBBc3NldEtpbmRTaGFwZVxuICB9LFxuICB7IGRpc3BsYXlJbmZvOiBEaXNwbGF5SW5mb1NoYXBlIH1cbik7XG52YXIgVGVybXNTaGFwZSA9IHtcbiAgaXNzdWVyczogSXNzdWVyS2V5d29yZFJlY29yZFNoYXBlLFxuICBicmFuZHM6IEJyYW5kS2V5d29yZFJlY29yZFNoYXBlXG59O1xuaGFyZGVuKFRlcm1zU2hhcGUpO1xudmFyIEluc3RhbmNlUmVjb3JkU2hhcGUgPSB7XG4gIGluc3RhbGxhdGlvbjogSW5zdGFsbGF0aW9uU2hhcGUsXG4gIGluc3RhbmNlOiBJbnN0YW5jZUhhbmRsZVNoYXBlLFxuICB0ZXJtczogTS5zcGxpdFJlY29yZChUZXJtc1NoYXBlKVxufTtcbmhhcmRlbihJbnN0YW5jZVJlY29yZFNoYXBlKTtcbnZhciBIYW5kbGVJID0gTS5pbnRlcmZhY2UoXCJIYW5kbGVcIiwge30pO1xudmFyIG1ha2VIYW5kbGVTaGFwZSA9IChuYW1lKSA9PiBNLnJlbW90YWJsZShgJHtuYW1lfUhhbmRsZWApO1xudmFyIFRpbWVyU2hhcGUgPSBtYWtlSGFuZGxlU2hhcGUoXCJ0aW1lclwiKTtcbnZhciBGdWxsUHJvcG9zYWxTaGFwZSA9IHtcbiAgd2FudDogQW1vdW50UGF0dGVybktleXdvcmRSZWNvcmRTaGFwZSxcbiAgZ2l2ZTogQW1vdW50S2V5d29yZFJlY29yZFNoYXBlLFxuICAvL1xuICAvL1xuICAvL1xuICBleGl0OiBNLnNwbGl0UmVjb3JkKFxuICAgIHt9LFxuICAgIHtcbiAgICAgIG9uRGVtYW5kOiBudWxsLFxuICAgICAgd2FpdmVkOiBudWxsLFxuICAgICAgYWZ0ZXJEZWFkbGluZToge1xuICAgICAgICB0aW1lcjogTS5lcmVmKFRpbWVyU2hhcGUpLFxuICAgICAgICBkZWFkbGluZTogVGltZXN0YW1wU2hhcGVcbiAgICAgIH1cbiAgICB9LFxuICAgIHt9XG4gIClcbn07XG5oYXJkZW4oRnVsbFByb3Bvc2FsU2hhcGUpO1xudmFyIFByb3Bvc2FsU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHt9LCBGdWxsUHJvcG9zYWxTaGFwZSwge30pO1xudmFyIEVtcHR5UHJvcG9zYWxTaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBnaXZlOiB7fSxcbiAgd2FudDoge30sXG4gIGV4aXQ6IHsgb25EZW1hbmQ6IG51bGwgfVxufSk7XG52YXIgaXNPbkRlbWFuZEV4aXRSdWxlID0gKGV4aXQpID0+IHtcbiAgY29uc3QgW2V4aXRLZXldID0gT2JqZWN0LmtleXMoZXhpdCk7XG4gIHJldHVybiBleGl0S2V5ID09PSBcIm9uRGVtYW5kXCI7XG59O1xuaGFyZGVuKGlzT25EZW1hbmRFeGl0UnVsZSk7XG52YXIgaXNXYWl2ZWRFeGl0UnVsZSA9IChleGl0KSA9PiB7XG4gIGNvbnN0IFtleGl0S2V5XSA9IE9iamVjdC5rZXlzKGV4aXQpO1xuICByZXR1cm4gZXhpdEtleSA9PT0gXCJ3YWl2ZWRcIjtcbn07XG5oYXJkZW4oaXNXYWl2ZWRFeGl0UnVsZSk7XG52YXIgaXNBZnRlckRlYWRsaW5lRXhpdFJ1bGUgPSAoZXhpdCkgPT4ge1xuICBjb25zdCBbZXhpdEtleV0gPSBPYmplY3Qua2V5cyhleGl0KTtcbiAgcmV0dXJuIGV4aXRLZXkgPT09IFwiYWZ0ZXJEZWFkbGluZVwiO1xufTtcbmhhcmRlbihpc0FmdGVyRGVhZGxpbmVFeGl0UnVsZSk7XG52YXIgSW52aXRhdGlvbkVsZW1lbnRTaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBkZXNjcmlwdGlvbjogTS5zdHJpbmcoKSxcbiAgaGFuZGxlOiBJbnZpdGF0aW9uSGFuZGxlU2hhcGUsXG4gIGluc3RhbmNlOiBJbnN0YW5jZUhhbmRsZVNoYXBlLFxuICBpbnN0YWxsYXRpb246IEluc3RhbGxhdGlvblNoYXBlXG59KTtcbnZhciBPZmZlckhhbmRsZXJJID0gTS5pbnRlcmZhY2UoXCJPZmZlckhhbmRsZXJcIiwge1xuICBoYW5kbGU6IE0uY2FsbChTZWF0U2hhcGUpLm9wdGlvbmFsKE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbn0pO1xudmFyIFNlYXRIYW5kbGVBbGxvY2F0aW9uc1NoYXBlID0gTS5hcnJheU9mKHtcbiAgc2VhdEhhbmRsZTogU2VhdFNoYXBlLFxuICBhbGxvY2F0aW9uOiBBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGVcbn0pO1xudmFyIFpvZU1pbnRTaGFwZSA9IE0ucmVtb3RhYmxlKFwiWm9lTWludFwiKTtcbnZhciBab2VNaW50SSA9IE0uaW50ZXJmYWNlKFwiWm9lTWludFwiLCB7XG4gIGdldElzc3VlclJlY29yZDogTS5jYWxsKCkucmV0dXJucyhJc3N1ZXJSZWNvcmRTaGFwZSksXG4gIG1pbnRBbmRFc2Nyb3c6IE0uY2FsbChBbW91bnRTaGFwZSkucmV0dXJucygpLFxuICB3aXRoZHJhd0FuZEJ1cm46IE0uY2FsbChBbW91bnRTaGFwZSkucmV0dXJucygpXG59KTtcbnZhciBGZWVNaW50QWNjZXNzU2hhcGUgPSBNLnJlbW90YWJsZShcIkZlZU1pbnRBY2Nlc3NcIik7XG52YXIgRXhpdE9iamVjdEkgPSBNLmludGVyZmFjZShcIkV4aXQgT2JqZWN0XCIsIHtcbiAgZXhpdDogTS5jYWxsKCkucmV0dXJucygpXG59KTtcbnZhciBFeGl0T2JqZWN0U2hhcGUgPSBNLnJlbW90YWJsZShcIkV4aXRPYmpcIik7XG52YXIgSW5zdGFuY2VBZG1pblNoYXBlID0gTS5yZW1vdGFibGUoXCJJbnN0YW5jZUFkbWluXCIpO1xudmFyIEluc3RhbmNlQWRtaW5JID0gTS5pbnRlcmZhY2UoXCJJbnN0YW5jZUFkbWluXCIsIHtcbiAgbWFrZUludml0YXRpb246IE0uY2FsbChJbnZpdGF0aW9uSGFuZGxlU2hhcGUsIE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0ucmVjb3JkKCksIE0ucGF0dGVybigpKS5yZXR1cm5zKEludml0YXRpb25TaGFwZSksXG4gIHNhdmVJc3N1ZXI6IE0uY2FsbFdoZW4oTS5hd2FpdChJc3N1ZXJTaGFwZSksIEtleXdvcmRTaGFwZSkucmV0dXJucyhcbiAgICBJc3N1ZXJSZWNvcmRTaGFwZVxuICApLFxuICBtYWtlTm9Fc2Nyb3dTZWF0OiBNLmNhbGwoXG4gICAgQW1vdW50S2V5d29yZFJlY29yZFNoYXBlLFxuICAgIFByb3Bvc2FsU2hhcGUsXG4gICAgRXhpdE9iamVjdFNoYXBlLFxuICAgIFNlYXRTaGFwZVxuICApLnJldHVybnMoU2VhdFNoYXBlKSxcbiAgZXhpdEFsbFNlYXRzOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpLFxuICBmYWlsQWxsU2VhdHM6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKCksXG4gIGV4aXRTZWF0OiBNLmNhbGwoU2VhdFNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKCksXG4gIGZhaWxTZWF0OiBNLmNhbGwoU2VhdFNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKCksXG4gIG1ha2Vab2VNaW50OiBNLmNhbGwoS2V5d29yZFNoYXBlKS5vcHRpb25hbChcbiAgICBBc3NldEtpbmRTaGFwZSxcbiAgICBEaXNwbGF5SW5mb1NoYXBlLFxuICAgIE0uc3BsaXRSZWNvcmQoe30sIHsgZWxlbWVudFNoYXBlOiBNLnBhdHRlcm4oKSB9KVxuICApLnJldHVybnMoTS5yZW1vdGFibGUoXCJ6b2VNaW50XCIpKSxcbiAgcmVnaXN0ZXJGZWVNaW50OiBNLmNhbGwoS2V5d29yZFNoYXBlLCBGZWVNaW50QWNjZXNzU2hhcGUpLnJldHVybnMoXG4gICAgTS5yZW1vdGFibGUoXCJmZWVNaW50XCIpXG4gICksXG4gIHJlcGxhY2VBbGxvY2F0aW9uczogTS5jYWxsKFNlYXRIYW5kbGVBbGxvY2F0aW9uc1NoYXBlKS5yZXR1cm5zKCksXG4gIHN0b3BBY2NlcHRpbmdPZmZlcnM6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgc2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbChNLmFycmF5T2YoTS5zdHJpbmcoKSkpLnJldHVybnMoKSxcbiAgZ2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbCgpLnJldHVybnMoTS5hcnJheU9mKE0uc3RyaW5nKCkpKSxcbiAgZ2V0RXhpdFN1YnNjcmliZXI6IE0uY2FsbChTZWF0U2hhcGUpLnJldHVybnMoU3Vic2NyaWJlclNoYXBlKSxcbiAgaXNCbG9ja2VkOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhNLmJvb2xlYW4oKSksXG4gIHJlcGFpckNvbnRyYWN0Q29tcGxldGlvbldhdGNoZXI6IE0uY2FsbCgpLnJldHVybnMoKVxufSk7XG52YXIgSW5zdGFuY2VTdG9yYWdlTWFuYWdlcklLaXQgPSB7XG4gIGluc3RhbmNlU3RvcmFnZU1hbmFnZXI6IE0uaW50ZXJmYWNlKFwiSW5zdGFuY2VTdG9yYWdlTWFuYWdlclwiLCB7XG4gICAgZ2V0VGVybXM6IE0uY2FsbCgpLnJldHVybnMoTS5zcGxpdFJlY29yZChUZXJtc1NoYXBlKSksXG4gICAgZ2V0SXNzdWVyczogTS5jYWxsKCkucmV0dXJucyhJc3N1ZXJLZXl3b3JkUmVjb3JkU2hhcGUpLFxuICAgIGdldEJyYW5kczogTS5jYWxsKCkucmV0dXJucyhCcmFuZEtleXdvcmRSZWNvcmRTaGFwZSksXG4gICAgZ2V0SW5zdGFsbGF0aW9uOiBNLmNhbGwoKS5yZXR1cm5zKEluc3RhbGxhdGlvblNoYXBlKSxcbiAgICBnZXRJbnZpdGF0aW9uSXNzdWVyOiBNLmNhbGwoKS5yZXR1cm5zKElzc3VlclNoYXBlKSxcbiAgICBzYXZlSXNzdWVyOiBNLmNhbGwoSXNzdWVyU2hhcGUsIEtleXdvcmRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgbWFrZVpvZU1pbnQ6IE0uY2FsbChLZXl3b3JkU2hhcGUpLm9wdGlvbmFsKFxuICAgICAgQXNzZXRLaW5kU2hhcGUsXG4gICAgICBEaXNwbGF5SW5mb1NoYXBlLFxuICAgICAgTS5zcGxpdFJlY29yZCh7fSwgeyBlbGVtZW50U2hhcGU6IE0ucGF0dGVybigpIH0pXG4gICAgKS5yZXR1cm5zKE0uZXJlZihab2VNaW50U2hhcGUpKSxcbiAgICByZWdpc3RlckZlZU1pbnQ6IE0uY2FsbChLZXl3b3JkU2hhcGUsIEZlZU1pbnRBY2Nlc3NTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ucmVtb3RhYmxlKFwiZmVlTWludFwiKVxuICAgICksXG4gICAgZ2V0SW5zdGFuY2VSZWNvcmQ6IE0uY2FsbCgpLnJldHVybnMoSW5zdGFuY2VSZWNvcmRTaGFwZSksXG4gICAgZ2V0SXNzdWVyUmVjb3JkczogTS5jYWxsKCkucmV0dXJucyhNLmFycmF5T2YoSXNzdWVyUmVjb3JkU2hhcGUpKSxcbiAgICBnZXRXaXRoZHJhd0ZhY2V0OiBNLmNhbGwoKS5yZXR1cm5zKE0ucmVtb3RhYmxlKFwiV2l0aGRyYXdGYWNldFwiKSksXG4gICAgaW5pdEluc3RhbmNlQWRtaW46IE0uY2FsbChcbiAgICAgIEluc3RhbmNlSGFuZGxlU2hhcGUsXG4gICAgICBNLnJlbW90YWJsZShcImluc3RhbmNlQWRtaW5cIilcbiAgICApLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIGRlbGV0ZUluc3RhbmNlQWRtaW46IE0uY2FsbChJbnN0YW5jZUFkbWluU2hhcGUpLnJldHVybnMoKSxcbiAgICBtYWtlSW52aXRhdGlvbjogTS5jYWxsKEludml0YXRpb25IYW5kbGVTaGFwZSwgTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5yZWNvcmQoKSwgTS5wYXR0ZXJuKCkpLnJldHVybnMoUGF5bWVudFNoYXBlKSxcbiAgICBnZXRSb290OiBNLmNhbGwoKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgIGdldEFkbWluTm9kZTogTS5jYWxsKCkucmV0dXJucyhNLnJlbW90YWJsZShcImFkbWluTm9kZVwiKSlcbiAgfSksXG4gIHdpdGhkcmF3RmFjZXQ6IE0uaW50ZXJmYWNlKFwiV2l0aGRyYXdGYWNldFwiLCB7XG4gICAgd2l0aGRyYXdQYXltZW50czogTS5jYWxsKEFtb3VudEtleXdvcmRSZWNvcmRTaGFwZSkucmV0dXJucyhcbiAgICAgIFBheW1lbnRQS2V5d29yZFJlY29yZFNoYXBlXG4gICAgKVxuICB9KSxcbiAgaGVscGVyczogTS5pbnRlcmZhY2UoXCJJbnN0YW5jZVN0b3JhZ2VNYW5hZ2VyIGhlbHBlclwiLCB7XG4gICAgd3JhcElzc3VlcktpdFdpdGhab2VNaW50OiBNLmNhbGwoXG4gICAgICBLZXl3b3JkU2hhcGUsXG4gICAgICBJc3N1ZXJLaXRTaGFwZSxcbiAgICAgIE0ucmVtb3RhYmxlKFwiYWRtaW5Ob2RlXCIpXG4gICAgKS5yZXR1cm5zKFpvZU1pbnRTaGFwZSlcbiAgfSlcbn07XG5oYXJkZW4oSW5zdGFuY2VTdG9yYWdlTWFuYWdlcklLaXQpO1xudmFyIEJ1bmRsZUNhcFNoYXBlID0gTS5yZW1vdGFibGUoXCJidW5kbGVDYXBcIik7XG52YXIgQnVuZGxlU2hhcGUgPSBNLmFuZChcbiAgTS5zcGxpdFJlY29yZCh7IG1vZHVsZUZvcm1hdDogTS5hbnkoKSB9KSxcbiAgTS5yZWNvcmRPZihNLnN0cmluZygpLCBNLnN0cmluZyh7IHN0cmluZ0xlbmd0aExpbWl0OiBJbmZpbml0eSB9KSlcbik7XG52YXIgVW53cmFwcGVkSW5zdGFsbGF0aW9uU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7IGluc3RhbGxhdGlvbjogSW5zdGFsbGF0aW9uU2hhcGUgfSxcbiAge1xuICAgIGJ1bmRsZTogTS5yZWNvcmRPZihNLnN0cmluZygpLCBNLnN0cmluZyh7IHN0cmluZ0xlbmd0aExpbWl0OiBJbmZpbml0eSB9KSksXG4gICAgYnVuZGxlQ2FwOiBCdW5kbGVDYXBTaGFwZSxcbiAgICBidW5kbGVJRDogTS5zdHJpbmcoKVxuICB9LFxuICB7fVxuKTtcbnZhciBab2VTdG9yYWdlTWFuYWdlcklLaXQgPSB7XG4gIHpvZVNlcnZpY2VEYXRhQWNjZXNzOiBNLmludGVyZmFjZShcIlpvZVNlcnZpY2UgZGF0YUFjY2Vzc1wiLCB7XG4gICAgZ2V0VGVybXM6IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKE0uc3BsaXRSZWNvcmQoVGVybXNTaGFwZSkpLFxuICAgIGdldElzc3VlcnM6IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKElzc3VlcktleXdvcmRSZWNvcmRTaGFwZSksXG4gICAgZ2V0QnJhbmRzOiBNLmNhbGwoSW5zdGFuY2VIYW5kbGVTaGFwZSkucmV0dXJucyhCcmFuZEtleXdvcmRSZWNvcmRTaGFwZSksXG4gICAgZ2V0SW5zdGFsbGF0aW9uOiBNLmNhbGwoSW5zdGFuY2VIYW5kbGVTaGFwZSkucmV0dXJucyhcbiAgICAgIE0uZXJlZihNLnJlbW90YWJsZShcIkluc3RhbGxhdGlvblwiKSlcbiAgICApLFxuICAgIGdldEludml0YXRpb25Jc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUpLFxuICAgIGdldEJ1bmRsZUlERnJvbUluc3RhbGxhdGlvbjogTS5jYWxsKEluc3RhbGxhdGlvblNoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5lcmVmKE0uc3RyaW5nKCkpXG4gICAgKSxcbiAgICBpbnN0YWxsQnVuZGxlOiBNLmNhbGwoQnVuZGxlU2hhcGUpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIGluc3RhbGxCdW5kbGVJRDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIGdldFB1YmxpY0ZhY2V0OiBNLmNhbGwoSW5zdGFuY2VIYW5kbGVTaGFwZSkucmV0dXJucyhcbiAgICAgIE0uZXJlZihNLnJlbW90YWJsZShcIlB1YmxpY0ZhY2V0XCIpKVxuICAgICksXG4gICAgZ2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKE0uYXJyYXlPZihNLnN0cmluZygpKSksXG4gICAgZ2V0UHJvcG9zYWxTaGFwZUZvckludml0YXRpb246IE0uY2FsbChJbnZpdGF0aW9uSGFuZGxlU2hhcGUpLnJldHVybnMoXG4gICAgICBNLm9wdChNLnBhdHRlcm4oKSlcbiAgICApXG4gIH0pLFxuICBtYWtlT2ZmZXJBY2Nlc3M6IE0uaW50ZXJmYWNlKFwiWm9lU3RvcmFnZSBtYWtlT2ZmZXIgYWNjZXNzXCIsIHtcbiAgICBnZXRBc3NldEtpbmRCeUJyYW5kOiBNLmNhbGwoQnJhbmRTaGFwZSkucmV0dXJucyhBc3NldEtpbmRTaGFwZSksXG4gICAgZ2V0SW5zdGFuY2VBZG1pbjogTS5jYWxsKEluc3RhbmNlSGFuZGxlU2hhcGUpLnJldHVybnMoXG4gICAgICBNLnJlbW90YWJsZShcImluc3RhbmNlQWRtaW5cIilcbiAgICApLFxuICAgIGdldFByb3Bvc2FsU2hhcGVGb3JJbnZpdGF0aW9uOiBNLmNhbGwoSW52aXRhdGlvbkhhbmRsZVNoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5vcHQoTS5wYXR0ZXJuKCkpXG4gICAgKSxcbiAgICBnZXRJbnZpdGF0aW9uSXNzdWVyOiBNLmNhbGwoKS5yZXR1cm5zKElzc3VlclNoYXBlKSxcbiAgICBkZXBvc2l0UGF5bWVudHM6IE0uY2FsbChQcm9wb3NhbFNoYXBlLCBQYXltZW50UEtleXdvcmRSZWNvcmRTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ucHJvbWlzZSgpXG4gICAgKVxuICB9KSxcbiAgc3RhcnRJbnN0YW5jZUFjY2VzczogTS5pbnRlcmZhY2UoXCJab2VTdG9yYWdlIHN0YXJ0SW5zdGFuY2UgYWNjZXNzXCIsIHtcbiAgICBtYWtlWm9lSW5zdGFuY2VTdG9yYWdlTWFuYWdlcjogTS5jYWxsKFxuICAgICAgSW5zdGFsbGF0aW9uU2hhcGUsXG4gICAgICBNLmFueSgpLFxuICAgICAgSXNzdWVyUEtleXdvcmRSZWNvcmRTaGFwZSxcbiAgICAgIEluc3RhbmNlSGFuZGxlU2hhcGUsXG4gICAgICBNLm9yKEJ1bmRsZUNhcFNoYXBlLCBCdW5kbGVTaGFwZSksXG4gICAgICBNLnN0cmluZygpXG4gICAgKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICB1bndyYXBJbnN0YWxsYXRpb246IE0uY2FsbFdoZW4oTS5lcmVmKEluc3RhbGxhdGlvblNoYXBlKSkucmV0dXJucyhcbiAgICAgIFVud3JhcHBlZEluc3RhbGxhdGlvblNoYXBlXG4gICAgKVxuICB9KSxcbiAgaW52aXRhdGlvbklzc3VlckFjY2VzczogTS5pbnRlcmZhY2UoXCJab2VTdG9yYWdlIGludml0YXRpb25Jc3N1ZXJcIiwge1xuICAgIGdldEludml0YXRpb25Jc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUpXG4gIH0pXG59O1xuaGFyZGVuKFpvZVN0b3JhZ2VNYW5hZ2VySUtpdCk7XG52YXIgWm9lU2VydmljZUkgPSBNLmludGVyZmFjZShcIlpvZVNlcnZpY2VcIiwge1xuICBpbnN0YWxsOiBNLmNhbGwoTS5hbnkoKSkub3B0aW9uYWwoTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGluc3RhbGxCdW5kbGVJRDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBzdGFydEluc3RhbmNlOiBNLmNhbGwoTS5lcmVmKEluc3RhbGxhdGlvblNoYXBlKSkub3B0aW9uYWwoSXNzdWVyUEtleXdvcmRSZWNvcmRTaGFwZSwgTS5yZWNvcmQoKSwgTS5yZWNvcmQoKSwgTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIG9mZmVyOiBNLmNhbGwoTS5lcmVmKEludml0YXRpb25TaGFwZSkpLm9wdGlvbmFsKFByb3Bvc2FsU2hhcGUsIFBheW1lbnRQS2V5d29yZFJlY29yZFNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBNLmFycmF5T2YoTS5zdHJpbmcoKSlcbiAgKSxcbiAgZ2V0SW52aXRhdGlvbklzc3VlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldEZlZUlzc3VlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldEJyYW5kczogTS5jYWxsV2hlbihNLmF3YWl0KEluc3RhbmNlSGFuZGxlU2hhcGUpKS5yZXR1cm5zKFxuICAgIEJyYW5kS2V5d29yZFJlY29yZFNoYXBlXG4gICksXG4gIGdldElzc3VlcnM6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBJc3N1ZXJLZXl3b3JkUmVjb3JkU2hhcGVcbiAgKSxcbiAgZ2V0UHVibGljRmFjZXQ6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBNLnJlbW90YWJsZShcIlB1YmxpY0ZhY2V0XCIpXG4gICksXG4gIGdldFRlcm1zOiBNLmNhbGxXaGVuKE0uYXdhaXQoSW5zdGFuY2VIYW5kbGVTaGFwZSkpLnJldHVybnMoTS5hbnkoKSksXG4gIGdldEluc3RhbGxhdGlvbkZvckluc3RhbmNlOiBNLmNhbGxXaGVuKE0uYXdhaXQoSW5zdGFuY2VIYW5kbGVTaGFwZSkpLnJldHVybnMoXG4gICAgTS5lcmVmKE0ucmVtb3RhYmxlKFwiSW5zdGFsbGF0aW9uXCIpKVxuICApLFxuICBnZXRCdW5kbGVJREZyb21JbnN0YWxsYXRpb246IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YWxsYXRpb25TaGFwZSkpLnJldHVybnMoXG4gICAgTS5lcmVmKE0uc3RyaW5nKCkpXG4gICksXG4gIGdldEluc3RhbGxhdGlvbjogTS5jYWxsKE0uZXJlZihJbnZpdGF0aW9uU2hhcGUpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0SW5zdGFuY2U6IE0uY2FsbChNLmVyZWYoSW52aXRhdGlvblNoYXBlKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldENvbmZpZ3VyYXRpb246IE0uY2FsbCgpLnJldHVybnMoe1xuICAgIGZlZUlzc3VlckNvbmZpZzoge1xuICAgICAgbmFtZTogTS5zdHJpbmcoKSxcbiAgICAgIGFzc2V0S2luZDogXCJuYXRcIixcbiAgICAgIGRpc3BsYXlJbmZvOiBEaXNwbGF5SW5mb1NoYXBlXG4gICAgfVxuICB9KSxcbiAgZ2V0SW52aXRhdGlvbkRldGFpbHM6IE0uY2FsbChNLmVyZWYoSW52aXRhdGlvblNoYXBlKSkucmV0dXJucyhNLmFueSgpKSxcbiAgZ2V0UHJvcG9zYWxTaGFwZUZvckludml0YXRpb246IE0uY2FsbChJbnZpdGF0aW9uSGFuZGxlU2hhcGUpLnJldHVybnMoXG4gICAgTS5vcHQoTS5wYXR0ZXJuKCkpXG4gIClcbn0pO1xudmFyIEFkbWluRmFjZXRJID0gTS5pbnRlcmZhY2UoXCJaY2ZBZG1pbkZhY2V0XCIsIHtcbiAgZ2V0VmF0U2h1dGRvd25Qcm9taXNlOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgcmVzdGFydENvbnRyYWN0OiBNLmNhbGwoKS5vcHRpb25hbChNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgdXBncmFkZUNvbnRyYWN0OiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hbnkoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIHRlcm1pbmF0ZUNvbnRyYWN0OiBNLmNhbGwoTS5lcnJvcigpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxufSk7XG52YXIgU2VhdERhdGFTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBwcm9wb3NhbDogUHJvcG9zYWxTaGFwZSxcbiAgICBpbml0aWFsQWxsb2NhdGlvbjogQW1vdW50S2V5d29yZFJlY29yZFNoYXBlLFxuICAgIHNlYXRIYW5kbGU6IFNlYXRTaGFwZVxuICB9LFxuICB7XG4gICAgb2ZmZXJBcmdzOiBNLmFueSgpXG4gIH1cbik7XG52YXIgSGFuZGxlT2ZmZXJJID0gTS5pbnRlcmZhY2UoXCJIYW5kbGVPZmZlclwiLCB7XG4gIGhhbmRsZU9mZmVyOiBNLmNhbGwoSW52aXRhdGlvbkhhbmRsZVNoYXBlLCBTZWF0RGF0YVNoYXBlKS5yZXR1cm5zKHtcbiAgICBvZmZlclJlc3VsdFByb21pc2U6IE0ucHJvbWlzZSgpLFxuICAgIGV4aXRPYmo6IEV4aXRPYmplY3RTaGFwZVxuICB9KVxufSk7XG52YXIgUHJpY2VRdW90ZVNoYXBlID0ge1xuICBxdW90ZUFtb3VudDogQW1vdW50U2hhcGUsXG4gIHF1b3RlUGF5bWVudDogTS5lcmVmKFBheW1lbnRTaGFwZSlcbn07XG5oYXJkZW4oUHJpY2VRdW90ZVNoYXBlKTtcblxuLy9cbnZhciBUcmFuc2ZlclBhcnRTaGFwZSA9IE0uc3BsaXRBcnJheShcbiAgaGFyZGVuKFtNLm9wdChTZWF0U2hhcGUpLCBNLm9wdChTZWF0U2hhcGUpLCBNLm9wdChBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUpXSksXG4gIGhhcmRlbihbTS5vcHQoQW1vdW50S2V5d29yZFJlY29yZFNoYXBlKV0pXG4pO1xudmFyIGZyb21Pbmx5ID0gKGZyb21TZWF0LCBmcm9tQW1vdW50cykgPT4gaGFyZGVuKFtmcm9tU2VhdCwgdm9pZCAwLCBmcm9tQW1vdW50c10pO1xudmFyIHRvT25seSA9ICh0b1NlYXQsIHRvQW1vdW50cykgPT4gaGFyZGVuKFt2b2lkIDAsIHRvU2VhdCwgdm9pZCAwLCB0b0Ftb3VudHNdKTtcbnZhciBhdG9taWNUcmFuc2ZlciA9ICh6Y2YsIGZyb21TZWF0ID0gdm9pZCAwLCB0b1NlYXQgPSB2b2lkIDAsIGZyb21BbW91bnRzID0gdm9pZCAwLCB0b0Ftb3VudHMgPSB2b2lkIDApID0+IHpjZi5hdG9taWNSZWFycmFuZ2UoaGFyZGVuKFtbZnJvbVNlYXQsIHRvU2VhdCwgZnJvbUFtb3VudHMsIHRvQW1vdW50c11dKSk7XG5cbi8vXG52YXIgc2F0aXNmaWVzSW50ZXJuYWwgPSAoZ2l2ZU9yV2FudCA9IHt9LCBhbGxvY2F0aW9uKSA9PiB7XG4gIGNvbnN0IGlzR1RFQnlLZXl3b3JkID0gKFtrZXl3b3JkLCByZXF1aXJlZEFtb3VudF0pID0+IHtcbiAgICBpZiAoYWxsb2NhdGlvbltrZXl3b3JkXSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgY29uc3QgYWxsb2NhdGlvbkFtb3VudCA9IGFsbG9jYXRpb25ba2V5d29yZF07XG4gICAgcmV0dXJuIEFtb3VudE1hdGguaXNHVEUoYWxsb2NhdGlvbkFtb3VudCwgcmVxdWlyZWRBbW91bnQpID8gMSA6IDA7XG4gIH07XG4gIHJldHVybiBPYmplY3QuZW50cmllcyhnaXZlT3JXYW50KS5ldmVyeShpc0dURUJ5S2V5d29yZCkgPyAxIDogMDtcbn07XG52YXIgc2F0aXNmaWVzV2FudCA9IChwcm9wb3NhbCwgYWxsb2NhdGlvbikgPT4gc2F0aXNmaWVzSW50ZXJuYWwocHJvcG9zYWwud2FudCwgYWxsb2NhdGlvbik7XG52YXIgc2F0aXNmaWVzR2l2ZSA9IChwcm9wb3NhbCwgYWxsb2NhdGlvbikgPT4gc2F0aXNmaWVzSW50ZXJuYWwocHJvcG9zYWwuZ2l2ZSwgYWxsb2NhdGlvbik7XG5mdW5jdGlvbiBpc09mZmVyU2FmZShwcm9wb3NhbCwgYWxsb2NhdGlvbikge1xuICByZXR1cm4gc2F0aXNmaWVzR2l2ZShwcm9wb3NhbCwgYWxsb2NhdGlvbikgPiAwIHx8IHNhdGlzZmllc1dhbnQocHJvcG9zYWwsIGFsbG9jYXRpb24pID4gMDtcbn1cbmhhcmRlbihpc09mZmVyU2FmZSk7XG5oYXJkZW4oc2F0aXNmaWVzV2FudCk7XG5cbi8vXG52YXIgZGVwb3NpdFRvU2VhdFN1Y2Nlc3NNc2cgPSBgRGVwb3NpdCBhbmQgcmVhbGxvY2F0aW9uIHN1Y2Nlc3NmdWwuYDtcbnZhciBkZXBvc2l0VG9TZWF0ID0gYXN5bmMgKHpjZiwgcmVjaXBpZW50U2VhdCwgYW1vdW50cywgcGF5bWVudHMpID0+IHtcbiAgIXJlY2lwaWVudFNlYXQuaGFzRXhpdGVkKCkgfHwgdGhyb3dSZWRhY3RlZGBUaGUgcmVjaXBpZW50U2VhdCBjYW5ub3QgaGF2ZSBleGl0ZWQuYDtcbiAgY29uc3QgcmVhbGxvY2F0ZUFmdGVyRGVwb3NpdCA9ICh0ZW1wU2VhdCkgPT4ge1xuICAgIGF0b21pY1RyYW5zZmVyKHpjZiwgdGVtcFNlYXQsIHJlY2lwaWVudFNlYXQsIGFtb3VudHMpO1xuICAgIHRlbXBTZWF0LmV4aXQoKTtcbiAgICByZXR1cm4gZGVwb3NpdFRvU2VhdFN1Y2Nlc3NNc2c7XG4gIH07XG4gIGNvbnN0IGludml0YXRpb24gPSB6Y2YubWFrZUludml0YXRpb24oXG4gICAgcmVhbGxvY2F0ZUFmdGVyRGVwb3NpdCxcbiAgICBcInRlbXBvcmFyeSBzZWF0IGZvciBkZXBvc2l0XCJcbiAgKTtcbiAgY29uc3QgcHJvcG9zYWwgPSBoYXJkZW4oeyBnaXZlOiBhbW91bnRzIH0pO1xuICBoYXJkZW4ocGF5bWVudHMpO1xuICBjb25zdCB6b2UgPSB6Y2YuZ2V0Wm9lU2VydmljZSgpO1xuICBjb25zdCB0ZW1wVXNlclNlYXQgPSBFKHpvZSkub2ZmZXIoaW52aXRhdGlvbiwgcHJvcG9zYWwsIHBheW1lbnRzKTtcbiAgcmV0dXJuIEUodGVtcFVzZXJTZWF0KS5nZXRPZmZlclJlc3VsdCgpO1xufTtcblxuLy9cbnZhciB7IG11bHRpcGx5OiBtdWx0aXBseTIsIGZsb29yRGl2aWRlOiBmbG9vckRpdmlkZTIsIGNlaWxEaXZpZGUsIGJhbmtlcnNEaXZpZGUsIGFkZDogYWRkMiwgc3VidHJhY3Q6IHN1YnRyYWN0MiB9ID0gbmF0U2FmZU1hdGg7XG52YXIgUEVSQ0VOVCA9IDEwMG47XG52YXIgcmF0aW9Qcm9wZXJ0eU5hbWVzID0gW1wibnVtZXJhdG9yXCIsIFwiZGVub21pbmF0b3JcIl07XG52YXIgYXNzZXJ0SXNSYXRpbyA9IChyYXRpbykgPT4ge1xuICBhc3NlcnRSZWNvcmQocmF0aW8sIFwicmF0aW9cIik7XG4gIGNvbnN0IGtleXM0ID0gT2JqZWN0LmtleXMocmF0aW8pO1xuICBrZXlzNC5sZW5ndGggPT09IDIgfHwgdGhyb3dSZWRhY3RlZGBSYXRpbyAke3JhdGlvfSBtdXN0IGJlIGEgcmVjb3JkIHdpdGggMiBmaWVsZHMuYDtcbiAgZm9yIChjb25zdCBuYW1lIG9mIGtleXM0KSB7XG4gICAgcmF0aW9Qcm9wZXJ0eU5hbWVzLmluY2x1ZGVzKG5hbWUpIHx8IHRocm93UmVkYWN0ZWRgUGFyYW1ldGVyIG11c3QgYmUgYSBSYXRpbyByZWNvcmQsIGJ1dCAke3JhdGlvfSBoYXMgJHtxdW90ZShuYW1lKX1gO1xuICB9XG4gIGNvbnN0IG51bWVyYXRvclZhbHVlID0gcmF0aW8ubnVtZXJhdG9yLnZhbHVlO1xuICBjb25zdCBkZW5vbWluYXRvclZhbHVlID0gcmF0aW8uZGVub21pbmF0b3IudmFsdWU7XG4gIGlzTmF0KG51bWVyYXRvclZhbHVlKSB8fCB0aHJvd1JlZGFjdGVkYFRoZSBudW1lcmF0b3IgdmFsdWUgbXVzdCBiZSBhIE5hdFZhbHVlLCBub3QgJHtudW1lcmF0b3JWYWx1ZX1gO1xuICBpc05hdChkZW5vbWluYXRvclZhbHVlKSB8fCB0aHJvd1JlZGFjdGVkYFRoZSBkZW5vbWluYXRvciB2YWx1ZSBtdXN0IGJlIGEgTmF0VmFsdWUsIG5vdCAke2Rlbm9taW5hdG9yVmFsdWV9YDtcbn07XG52YXIgbWFrZVJhdGlvID0gKG51bWVyYXRvciwgbnVtZXJhdG9yQnJhbmQsIGRlbm9taW5hdG9yID0gUEVSQ0VOVCwgZGVub21pbmF0b3JCcmFuZCA9IG51bWVyYXRvckJyYW5kKSA9PiB7XG4gIGRlbm9taW5hdG9yID4gMG4gfHwgdGhyb3dSZWRhY3RlZGBObyBpbmZpbml0ZSByYXRpb3MhIERlbm9taW5hdG9yIHdhcyAwICR7cXVvdGUoZGVub21pbmF0b3JCcmFuZCl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgbnVtZXJhdG9yOiBBbW91bnRNYXRoLm1ha2UobnVtZXJhdG9yQnJhbmQsIG51bWVyYXRvciksXG4gICAgZGVub21pbmF0b3I6IEFtb3VudE1hdGgubWFrZShkZW5vbWluYXRvckJyYW5kLCBkZW5vbWluYXRvcilcbiAgfSk7XG59O1xudmFyIG1ha2VSYXRpb0Zyb21BbW91bnRzID0gKG51bWVyYXRvckFtb3VudCwgZGVub21pbmF0b3JBbW91bnQpID0+IHtcbiAgQW1vdW50TWF0aC5jb2VyY2UobnVtZXJhdG9yQW1vdW50LmJyYW5kLCBudW1lcmF0b3JBbW91bnQpO1xuICBBbW91bnRNYXRoLmNvZXJjZShkZW5vbWluYXRvckFtb3VudC5icmFuZCwgZGVub21pbmF0b3JBbW91bnQpO1xuICByZXR1cm4gbWFrZVJhdGlvKFxuICAgIC8vXG4gICAgbnVtZXJhdG9yQW1vdW50LnZhbHVlLFxuICAgIG51bWVyYXRvckFtb3VudC5icmFuZCxcbiAgICBkZW5vbWluYXRvckFtb3VudC52YWx1ZSxcbiAgICBkZW5vbWluYXRvckFtb3VudC5icmFuZFxuICApO1xufTtcbnZhciBtdWx0aXBseUhlbHBlciA9IChhbW91bnQsIHJhdGlvLCBkaXZpZGVPcCkgPT4ge1xuICBBbW91bnRNYXRoLmNvZXJjZShhbW91bnQuYnJhbmQsIGFtb3VudCk7XG4gIGFzc2VydElzUmF0aW8ocmF0aW8pO1xuICBhbW91bnQuYnJhbmQgPT09IHJhdGlvLmRlbm9taW5hdG9yLmJyYW5kIHx8IHRocm93UmVkYWN0ZWRgYW1vdW50J3MgYnJhbmQgJHtxdW90ZShhbW91bnQuYnJhbmQpfSBtdXN0IG1hdGNoIHJhdGlvJ3MgZGVub21pbmF0b3IgJHtxdW90ZShcbiAgICByYXRpby5kZW5vbWluYXRvci5icmFuZFxuICApfWA7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEFtb3VudE1hdGgubWFrZShcbiAgICAgIHJhdGlvLm51bWVyYXRvci5icmFuZCxcbiAgICAgIGRpdmlkZU9wKFxuICAgICAgICBtdWx0aXBseTIoYW1vdW50LnZhbHVlLCByYXRpby5udW1lcmF0b3IudmFsdWUpLFxuICAgICAgICByYXRpby5kZW5vbWluYXRvci52YWx1ZVxuICAgICAgKVxuICAgIClcbiAgKTtcbn07XG52YXIgbXVsdGlwbHlCeSA9IChhbW91bnQsIHJhdGlvKSA9PiB7XG4gIHJldHVybiBtdWx0aXBseUhlbHBlcihhbW91bnQsIHJhdGlvLCBiYW5rZXJzRGl2aWRlKTtcbn07XG52YXIgZGl2aWRlSGVscGVyID0gKGFtb3VudCwgcmF0aW8sIGRpdmlkZU9wKSA9PiB7XG4gIEFtb3VudE1hdGguY29lcmNlKGFtb3VudC5icmFuZCwgYW1vdW50KTtcbiAgYXNzZXJ0SXNSYXRpbyhyYXRpbyk7XG4gIGFtb3VudC5icmFuZCA9PT0gcmF0aW8ubnVtZXJhdG9yLmJyYW5kIHx8IHRocm93UmVkYWN0ZWRgYW1vdW50J3MgYnJhbmQgJHtxdW90ZShhbW91bnQuYnJhbmQpfSBtdXN0IG1hdGNoIHJhdGlvJ3MgbnVtZXJhdG9yICR7cXVvdGUoXG4gICAgcmF0aW8ubnVtZXJhdG9yLmJyYW5kXG4gICl9YDtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQW1vdW50TWF0aC5tYWtlKFxuICAgICAgcmF0aW8uZGVub21pbmF0b3IuYnJhbmQsXG4gICAgICBkaXZpZGVPcChcbiAgICAgICAgbXVsdGlwbHkyKGFtb3VudC52YWx1ZSwgcmF0aW8uZGVub21pbmF0b3IudmFsdWUpLFxuICAgICAgICByYXRpby5udW1lcmF0b3IudmFsdWVcbiAgICAgIClcbiAgICApXG4gICk7XG59O1xudmFyIGRpdmlkZUJ5ID0gKGFtb3VudCwgcmF0aW8pID0+IHtcbiAgcmV0dXJuIGRpdmlkZUhlbHBlcihhbW91bnQsIHJhdGlvLCBiYW5rZXJzRGl2aWRlKTtcbn07XG5cbi8vXG52YXIgbWFrZUVwaGVtZXJhUHJvdmlkZXIgPSAoaW5pdCkgPT4ge1xuICBjb25zdCBleHRhbnQgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgcmV0dXJuIChrZXkpID0+IHtcbiAgICBpZiAoZXh0YW50LmhhcyhrZXkpKSB7XG4gICAgICByZXR1cm4gZXh0YW50LmdldChrZXkpO1xuICAgIH1cbiAgICBjb25zdCBuZXdFcGggPSBpbml0KGtleSk7XG4gICAgZXh0YW50LnNldChrZXksIG5ld0VwaCk7XG4gICAgcmV0dXJuIG5ld0VwaDtcbiAgfTtcbn07XG5oYXJkZW4obWFrZUVwaGVtZXJhUHJvdmlkZXIpO1xudmFyIHByb3ZpZGVFbXB0eVNlYXQgPSAoemNmLCBiYWdnYWdlLCBuYW1lKSA9PiB7XG4gIHJldHVybiBwcm92aWRlKGJhZ2dhZ2UsIG5hbWUsICgpID0+IHpjZi5tYWtlRW1wdHlTZWF0S2l0KCkuemNmU2VhdCk7XG59O1xuaGFyZGVuKHByb3ZpZGVFbXB0eVNlYXQpO1xudmFyIHByb3ZpZGVBbGwgPSAoYmFnZ2FnZSwgdGh1bmtzKSA9PiB7XG4gIGNvbnN0IGtleXM0ID0gT2JqZWN0LmtleXModGh1bmtzKTtcbiAgY29uc3QgaW5CYWdnYWdlID0gYmFnZ2FnZS5oYXMoa2V5czRbMF0pO1xuICBpZiAoaW5CYWdnYWdlKSB7XG4gICAgY29uc3Qgb2JqID0gb2JqZWN0TWFwKFxuICAgICAgdGh1bmtzLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIChfLCBrKSA9PiBiYWdnYWdlLmdldChrKVxuICAgICk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShoYXJkZW4ob2JqKSk7XG4gIH1cbiAgY29uc3Qga2V5ZWRQcm9taXNlcyA9IG9iamVjdE1hcCh0aHVua3MsIChmbikgPT4gZm4oKSk7XG4gIHJldHVybiBhbGxWYWx1ZXMoa2V5ZWRQcm9taXNlcykudGhlbigoa2V5ZWRWYWxzKSA9PiB7XG4gICAgZm9yIChjb25zdCBbaywgdjJdIG9mIE9iamVjdC5lbnRyaWVzKGtleWVkVmFscykpIHtcbiAgICAgIGJhZ2dhZ2UuaW5pdChrLCB2Mik7XG4gICAgfVxuICAgIHJldHVybiBrZXllZFZhbHM7XG4gIH0pO1xufTtcbmhhcmRlbihwcm92aWRlQWxsKTtcbnZhciBwcm92aWRlU2luZ2xldG9uID0gKG1hcFN0b3JlLCBrZXksIG1ha2VWYWx1ZSwgd2l0aFZhbHVlKSA9PiB7XG4gIGNvbnN0IHN0b3JlZCA9IG1hcFN0b3JlLmhhcyhrZXkpID8gdm9pZCAwIDogRS53aGVuKG1ha2VWYWx1ZSgpLCAodjIpID0+IG1hcFN0b3JlLmluaXQoa2V5LCBoYXJkZW4odjIpKSk7XG4gIHJldHVybiBFLndoZW4oc3RvcmVkLCAoKSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBtYXBTdG9yZS5nZXQoa2V5KTtcbiAgICBpZiAod2l0aFZhbHVlKSB7XG4gICAgICB3aXRoVmFsdWUodmFsdWUpO1xuICAgIH1cbiAgICByZXR1cm4gdmFsdWU7XG4gIH0pO1xufTtcblxuLy9cbnZhciB3cmFwcGVyTWV0aG9kcyA9ICh3cmFwcGVyS2luZE5hbWUsIHVNZXRob2ROYW1lcywgZXh0cmFNZXRob2RzID0ge30pID0+IGhhcmRlbih7XG4gIC4uLmZyb21VbmlxdWVFbnRyaWVzKFxuICAgIHVNZXRob2ROYW1lcy5tYXAoKG5hbWUpID0+IFtcbiAgICAgIG5hbWUsXG4gICAgICB7XG4gICAgICAgIC8vXG4gICAgICAgIFtuYW1lXSguLi5hcmdzKSB7XG4gICAgICAgICAgY29uc3QgeyB1bmRlcmx5aW5nIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHVuZGVybHlpbmcgIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUod3JhcHBlcktpbmROYW1lKX0gcmV2b2tlZGA7XG4gICAgICAgICAgcmV0dXJuIHVuZGVybHlpbmdbbmFtZV0oLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgIH1bbmFtZV1cbiAgICBdKVxuICApLFxuICAuLi5leHRyYU1ldGhvZHNcbn0pO1xuaGFyZGVuKHdyYXBwZXJNZXRob2RzKTtcbnZhciBwcmVwYXJlQXR0ZW51YXRvck1ha2VyID0gKHpvbmUsIHVLaW5kTmFtZSwgdU1ldGhvZE5hbWVzLCBvcHRpb25zID0ge30pID0+IHtcbiAgY29uc3Qge1xuICAgIHVJbnRlcmZhY2VOYW1lID0gdUtpbmROYW1lLFxuICAgIGV4dHJhTWV0aG9kR3VhcmRzID0ge30sXG4gICAgZXh0cmFNZXRob2RzID0ge31cbiAgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IEF0dGVudWF0b3JJID0gTS5pbnRlcmZhY2UoXG4gICAgYCR7dUludGVyZmFjZU5hbWV9X2F0dGVudWF0b3JgLFxuICAgIGV4dHJhTWV0aG9kR3VhcmRzLFxuICAgIHsgZGVmYXVsdEd1YXJkczogXCJyYXdcIiB9XG4gICk7XG4gIGNvbnN0IGF0dGVudWF0b3JLaW5kTmFtZSA9IGAke3VLaW5kTmFtZX1fYXR0ZW51YXRvcmA7XG4gIHJldHVybiB6b25lLmV4b0NsYXNzKFxuICAgIGF0dGVudWF0b3JLaW5kTmFtZSxcbiAgICBBdHRlbnVhdG9ySSxcbiAgICAodW5kZXJseWluZykgPT4gKHsgdW5kZXJseWluZyB9KSxcbiAgICB3cmFwcGVyTWV0aG9kcyhhdHRlbnVhdG9yS2luZE5hbWUsIHVNZXRob2ROYW1lcywgZXh0cmFNZXRob2RzKSxcbiAgICB7XG4gICAgICBzdGF0ZVNoYXBlOiB7IHVuZGVybHlpbmc6IE0ub3B0KE0ucmVtb3RhYmxlKFwidW5kZXJseWluZ1wiKSkgfVxuICAgIH1cbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZUF0dGVudWF0b3JNYWtlcik7XG52YXIgUmVtb3RhYmxlUHJlZml4UkUgPSAvXihBbGxlZ2VkOiB8RGVidWdOYW1lOiApLztcbnZhciBhdHRlbnVhdGVPbmUgPSAodW5kZXJseWluZywgdU1ldGhvZE5hbWVzLCBvcHRpb25zID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IGhlYXBab25lID0gbWFrZUhlYXBab25lKCk7XG4gIGNvbnN0IHVLaW5kTmFtZSA9ICh1bmRlcmx5aW5nW1N5bWJvbC50b1N0cmluZ1RhZ10gfHwgXCJVbmRlcmx5aW5nXCIpLnJlcGxhY2UoXG4gICAgUmVtb3RhYmxlUHJlZml4UkUsXG4gICAgXCJcIlxuICApO1xuICBjb25zdCBtYWtlQXR0ZW51YXRvciA9IHByZXBhcmVBdHRlbnVhdG9yTWFrZXIoXG4gICAgaGVhcFpvbmUsXG4gICAgdUtpbmROYW1lLFxuICAgIHVNZXRob2ROYW1lcyxcbiAgICBvcHRpb25zXG4gICk7XG4gIHJldHVybiBtYWtlQXR0ZW51YXRvcih1bmRlcmx5aW5nKTtcbn07XG5oYXJkZW4oYXR0ZW51YXRlT25lKTtcblxuLy9cbnZhciBwcmVwYXJlUmV2b2NhYmxlTWFrZXJLaXQgPSAoem9uZSwgdUtpbmROYW1lLCB1TWV0aG9kTmFtZXMsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgdUludGVyZmFjZU5hbWUgPSB1S2luZE5hbWUsXG4gICAgZXh0cmFNZXRob2RHdWFyZHMgPSB7fSxcbiAgICBleHRyYU1ldGhvZHMgPSB7fVxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgUmV2b2NhYmxlSUtpdCA9IGhhcmRlbih7XG4gICAgcmV2b2tlcjogTS5pbnRlcmZhY2UoYCR7dUludGVyZmFjZU5hbWV9X3Jldm9rZXJgLCB7XG4gICAgICByZXZva2U6IE0uY2FsbCgpLnJldHVybnMoTS5ib29sZWFuKCkpXG4gICAgfSksXG4gICAgcmV2b2NhYmxlOiBNLmludGVyZmFjZShgJHt1SW50ZXJmYWNlTmFtZX1fcmV2b2NhYmxlYCwgZXh0cmFNZXRob2RHdWFyZHMsIHtcbiAgICAgIGRlZmF1bHRHdWFyZHM6IFwicmF3XCJcbiAgICB9KVxuICB9KTtcbiAgY29uc3QgcmV2b2NhYmxlS2luZE5hbWUgPSBgJHt1S2luZE5hbWV9X2NhcmV0YWtlcmA7XG4gIGxldCBhbXBsaWZpZXI7XG4gIGNvbnN0IG1ha2VSZXZvY2FibGVLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIHJldm9jYWJsZUtpbmROYW1lLFxuICAgIFJldm9jYWJsZUlLaXQsXG4gICAgKHVuZGVybHlpbmcpID0+ICh7IHVuZGVybHlpbmcgfSksXG4gICAge1xuICAgICAgcmV2b2tlcjoge1xuICAgICAgICByZXZva2UoKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICBpZiAoc3RhdGUudW5kZXJseWluZyA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHN0YXRlLnVuZGVybHlpbmcgPSB2b2lkIDA7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXZvY2FibGU6IHdyYXBwZXJNZXRob2RzKHJldm9jYWJsZUtpbmROYW1lLCB1TWV0aG9kTmFtZXMsIGV4dHJhTWV0aG9kcylcbiAgICB9LFxuICAgIHtcbiAgICAgIHN0YXRlU2hhcGU6IHsgdW5kZXJseWluZzogTS5vcHQoTS5yZW1vdGFibGUoXCJ1bmRlcmx5aW5nXCIpKSB9LFxuICAgICAgcmVjZWl2ZUFtcGxpZmllcjogKGFtcCkgPT4ge1xuICAgICAgICBhbXBsaWZpZXIgPSBhbXA7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlUmV2b2NhYmxlID0gKHVuZGVybHlpbmcpID0+IG1ha2VSZXZvY2FibGVLaXQodW5kZXJseWluZykucmV2b2NhYmxlO1xuICBjb25zdCByZXZva2UgPSAocmV2b2NhYmxlKSA9PiB7XG4gICAgY29uc3QgZmFjZXRzID0gYW1wbGlmaWVyKHJldm9jYWJsZSk7XG4gICAgaWYgKGZhY2V0cyA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBmYWNldHMucmV2b2tlci5yZXZva2UoKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgcmV2b2tlLFxuICAgIG1ha2VSZXZvY2FibGVcbiAgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVSZXZvY2FibGVNYWtlcktpdCk7XG5cbi8vXG52YXIgVHJhbnNmZXJQcm9wb3NhbFNoYXBlID0gTS5zcGxpdFJlY29yZCh7XG4gIGdpdmU6IHt9LFxuICB3YW50OiB7fSxcbiAgZXhpdDoge1xuICAgIG9uRGVtYW5kOiBudWxsXG4gIH1cbn0pO1xudmFyIHByZXBhcmVPd25hYmxlID0gKHpvbmUsIG1ha2VJbnZpdGF0aW9uLCB1S2luZE5hbWUsIHVNZXRob2ROYW1lcywgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHsgdUludGVyZmFjZU5hbWUgPSB1S2luZE5hbWUgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IHsgcmV2b2tlLCBtYWtlUmV2b2NhYmxlIH0gPSBwcmVwYXJlUmV2b2NhYmxlTWFrZXJLaXQoXG4gICAgem9uZSxcbiAgICB1S2luZE5hbWUsXG4gICAgdU1ldGhvZE5hbWVzLFxuICAgIHtcbiAgICAgIHVJbnRlcmZhY2VOYW1lLFxuICAgICAgZXh0cmFNZXRob2RHdWFyZHM6IHtcbiAgICAgICAgbWFrZVRyYW5zZmVySW52aXRhdGlvbjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICAgIH0sXG4gICAgICBleHRyYU1ldGhvZHM6IHtcbiAgICAgICAgbWFrZVRyYW5zZmVySW52aXRhdGlvbigpIHtcbiAgICAgICAgICBjb25zdCB7IHVuZGVybHlpbmcgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyByZXZvY2FibGUgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IGN1c3RvbURldGFpbHMgPSB1bmRlcmx5aW5nLmdldEludml0YXRpb25DdXN0b21EZXRhaWxzKCk7XG4gICAgICAgICAgY29uc3QgdHJhbnNmZXJIYW5kbGVyID0gbWFrZVRyYW5zZmVySGFuZGxlcih1bmRlcmx5aW5nKTtcbiAgICAgICAgICBjb25zdCBpbnZpdGF0aW9uID0gbWFrZUludml0YXRpb24oXG4gICAgICAgICAgICB0cmFuc2ZlckhhbmRsZXIsXG4gICAgICAgICAgICBcInRyYW5zZmVyXCIsXG4gICAgICAgICAgICBjdXN0b21EZXRhaWxzLFxuICAgICAgICAgICAgVHJhbnNmZXJQcm9wb3NhbFNoYXBlXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXZva2UocmV2b2NhYmxlKTtcbiAgICAgICAgICByZXR1cm4gaW52aXRhdGlvbjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZVRyYW5zZmVySGFuZGxlciA9IHpvbmUuZXhvQ2xhc3MoXG4gICAgXCJUcmFuc2ZlckhhbmRsZXJcIixcbiAgICBPZmZlckhhbmRsZXJJLFxuICAgICh1bmRlcmx5aW5nKSA9PiAoe1xuICAgICAgdW5kZXJseWluZ1xuICAgIH0pLFxuICAgIHtcbiAgICAgIGhhbmRsZShzZWF0KSB7XG4gICAgICAgIGNvbnN0IHsgdW5kZXJseWluZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgcmV2b2NhYmxlID0gbWFrZVJldm9jYWJsZSh1bmRlcmx5aW5nKTtcbiAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgIHJldHVybiByZXZvY2FibGU7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlT3duYWJsZSA9ICh1bmRlcmx5aW5nKSA9PiBtYWtlUmV2b2NhYmxlKHVuZGVybHlpbmcpO1xuICByZXR1cm4gaGFyZGVuKG1ha2VPd25hYmxlKTtcbn07XG5oYXJkZW4ocHJlcGFyZU93bmFibGUpO1xuXG4vL1xudmFyIHRyYWNlOSA9IG1ha2VUcmFjZXIoXCJQQVwiLCBmYWxzZSk7XG52YXIgR3VhcmRDYWxsQW1vdW50VHVwbGUgPSBNLmNhbGwoQW1vdW50U2hhcGUsIEFtb3VudFNoYXBlKS5yZXR1cm5zKFxuICBNLnByb21pc2UoKVxuKTtcbnZhciBQcmljZUF1dGhvcml0eUkgPSBNLmludGVyZmFjZShcIlByaWNlQXV0aG9yaXR5XCIsIHtcbiAgZ2V0UXVvdGVJc3N1ZXI6IE0uY2FsbChCcmFuZFNoYXBlLCBCcmFuZFNoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0VGltZXJTZXJ2aWNlOiBNLmNhbGwoQnJhbmRTaGFwZSwgQnJhbmRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIHF1b3RlR2l2ZW46IE0uY2FsbChBbW91bnRTaGFwZSwgQnJhbmRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIHF1b3RlV2FudGVkOiBNLmNhbGwoQnJhbmRTaGFwZSwgQW1vdW50U2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBtYWtlUXVvdGVOb3RpZmllcjogTS5jYWxsKEFtb3VudFNoYXBlLCBCcmFuZFNoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgcXVvdGVBdFRpbWU6IE0uY2FsbChUaW1lc3RhbXBTaGFwZSwgQW1vdW50U2hhcGUsIEJyYW5kU2hhcGUpLnJldHVybnMoXG4gICAgTS5wcm9taXNlKClcbiAgKSxcbiAgcXVvdGVXaGVuTFQ6IEd1YXJkQ2FsbEFtb3VudFR1cGxlLFxuICBxdW90ZVdoZW5MVEU6IEd1YXJkQ2FsbEFtb3VudFR1cGxlLFxuICBxdW90ZVdoZW5HVEU6IEd1YXJkQ2FsbEFtb3VudFR1cGxlLFxuICBxdW90ZVdoZW5HVDogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIG11dGFibGVRdW90ZVdoZW5MVDogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIG11dGFibGVRdW90ZVdoZW5MVEU6IEd1YXJkQ2FsbEFtb3VudFR1cGxlLFxuICBtdXRhYmxlUXVvdGVXaGVuR1RFOiBHdWFyZENhbGxBbW91bnRUdXBsZSxcbiAgbXV0YWJsZVF1b3RlV2hlbkdUOiBHdWFyZENhbGxBbW91bnRUdXBsZVxufSk7XG5cbi8vXG52YXIgdW5pdEFtb3VudCA9IGFzeW5jIChicmFuZCkgPT4ge1xuICBjb25zdCBkaXNwbGF5SW5mbyA9IGF3YWl0IEUoYnJhbmQpLmdldERpc3BsYXlJbmZvKCk7XG4gIGNvbnN0IGRlY2ltYWxQbGFjZXMgPSBkaXNwbGF5SW5mby5kZWNpbWFsUGxhY2VzID8/IDA7XG4gIHJldHVybiBBbW91bnRNYXRoLm1ha2UoYnJhbmQsIDEwbiAqKiBOYXQoZGVjaW1hbFBsYWNlcykpO1xufTtcbmhhcmRlbih1bml0QW1vdW50KTtcblxuLy9cbnZhciB0cmFjZTEwID0gbWFrZVRyYWNlcihcIlpvZVRvb2xzXCIpO1xudmFyIHsgYXNzaWduOiBhc3NpZ240LCBrZXlzOiBrZXlzMiwgdmFsdWVzOiB2YWx1ZXM1IH0gPSBPYmplY3Q7XG52YXIgbWFrZVpvZVRvb2xzID0gKHpjZiwgeyB3aGVuLCBhbGxWb3dzLCBhbGxTZXR0bGVkLCBhc1ZvdyB9KSA9PiB7XG4gIGNvbnN0IGxvY2FsVHJhbnNmZXIgPSAoc3JjU2VhdCwgbG9jYWxBY2NvdW50LCBhbW91bnRzKSA9PiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgIXNyY1NlYXQuaGFzRXhpdGVkKCkgfHwgdGhyb3dSZWRhY3RlZGBUaGUgc2VhdCBjYW5ub3QgaGF2ZSBleGl0ZWQuYDtcbiAgICBjb25zdCB7IHpjZlNlYXQ6IHRlbXBTZWF0LCB1c2VyU2VhdDogdXNlclNlYXRQIH0gPSB6Y2YubWFrZUVtcHR5U2VhdEtpdCgpO1xuICAgIGNvbnN0IHVzZXJTZWF0ID0gYXdhaXQgdXNlclNlYXRQO1xuICAgIHpjZi5hdG9taWNSZWFycmFuZ2UoaGFyZGVuKFtbc3JjU2VhdCwgdGVtcFNlYXQsIGFtb3VudHNdXSkpO1xuICAgIHRlbXBTZWF0LmV4aXQoKTtcbiAgICBjb25zdCBwYXltZW50cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAga2V5czIoYW1vdW50cykubWFwKChrdykgPT4gRSh1c2VyU2VhdCkuZ2V0UGF5b3V0KGt3KSlcbiAgICApO1xuICAgIGNvbnN0IHNldHRsZURlcG9zaXRzID0gYXdhaXQgd2hlbihcbiAgICAgIGFsbFNldHRsZWQocGF5bWVudHMubWFwKChwbXQpID0+IEUobG9jYWxBY2NvdW50KS5kZXBvc2l0KHBtdCkpKVxuICAgICk7XG4gICAgaWYgKHNldHRsZURlcG9zaXRzLmZpbmQoKHgpID0+IHguc3RhdHVzID09PSBcInJlamVjdGVkXCIpKSB7XG4gICAgICBjb25zdCBhbXRzID0gdmFsdWVzNShhbW91bnRzKTtcbiAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuICAgICAgY29uc3QgcGF5bWVudHNPcldpdGhkcmF3VnMgPSBzZXR0bGVEZXBvc2l0cy5tYXAoKHgsIGkyKSA9PiB7XG4gICAgICAgIGlmICh4LnN0YXR1cyA9PT0gXCJyZWplY3RlZFwiKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goeC5yZWFzb24pO1xuICAgICAgICAgIHJldHVybiBwYXltZW50c1tpMl07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEUobG9jYWxBY2NvdW50KS53aXRoZHJhdyhhbXRzW2kyXSk7XG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHBheW1lbnRzVG9SZXR1cm4gPSBhd2FpdCB3aGVuKGFsbFZvd3MocGF5bWVudHNPcldpdGhkcmF3VnMpKTtcbiAgICAgIGNvbnN0IHBheW1lbnRLd3IgPSBoYXJkZW4oXG4gICAgICAgIGtleXMyKGFtb3VudHMpLnJlZHVjZShcbiAgICAgICAgICAoa3dyLCBrdywgaTIpID0+IGFzc2lnbjQoa3dyLCB7IFtrd106IHBheW1lbnRzVG9SZXR1cm5baTJdIH0pLFxuICAgICAgICAgIHt9XG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICBjb25zdCBkZXBvc2l0UmVzcG9uc2UgPSBhd2FpdCBkZXBvc2l0VG9TZWF0KFxuICAgICAgICB6Y2YsXG4gICAgICAgIHNyY1NlYXQsXG4gICAgICAgIGFtb3VudHMsXG4gICAgICAgIHBheW1lbnRLd3JcbiAgICAgICk7XG4gICAgICB0cmFjZTEwKFwibG9jYWxUcmFuc2ZlciBkZXBvc2l0UmVzcG9uc2VcIiwgZGVwb3NpdFJlc3BvbnNlKTtcbiAgICAgIHRocm93IG1ha2VFcnJvcihgT25lIG9yIG1vcmUgZGVwb3NpdHMgZmFpbGVkICR7cXVvdGUoZXJyb3JzKX1gKTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCB3aXRoZHJhd1RvU2VhdCA9IChsb2NhbEFjY291bnQsIGRlc3RTZWF0LCBhbW91bnRzKSA9PiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgIWRlc3RTZWF0Lmhhc0V4aXRlZCgpIHx8IHRocm93UmVkYWN0ZWRgVGhlIHNlYXQgY2Fubm90IGhhdmUgZXhpdGVkLmA7XG4gICAgY29uc3Qgc2V0dGxlZFdpdGhkcmF3YWxzID0gYXdhaXQgd2hlbihcbiAgICAgIGFsbFNldHRsZWQodmFsdWVzNShhbW91bnRzKS5tYXAoKGFtdCkgPT4gRShsb2NhbEFjY291bnQpLndpdGhkcmF3KGFtdCkpKVxuICAgICk7XG4gICAgaWYgKHNldHRsZWRXaXRoZHJhd2Fscy5maW5kKCh4KSA9PiB4LnN0YXR1cyA9PT0gXCJyZWplY3RlZFwiKSkge1xuICAgICAgY29uc3QgcmV0dXJuUGF5bWVudFZzID0gW107XG4gICAgICBjb25zdCBlcnJvcnMgPSBbXTtcbiAgICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHNldHRsZWRXaXRoZHJhd2Fscykge1xuICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gXCJmdWxmaWxsZWRcIikge1xuICAgICAgICAgIHJldHVyblBheW1lbnRWcy5wdXNoKEUobG9jYWxBY2NvdW50KS5kZXBvc2l0KHJlc3VsdC52YWx1ZSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVycm9ycy5wdXNoKHJlc3VsdC5yZWFzb24pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBhd2FpdCB3aGVuKGFsbFZvd3MocmV0dXJuUGF5bWVudFZzKSk7XG4gICAgICB0aHJvdyBtYWtlRXJyb3IoYE9uZSBvciBtb3JlIHdpdGhkcmF3YWxzIGZhaWxlZCAke3F1b3RlKGVycm9ycyl9YCk7XG4gICAgfVxuICAgIGNvbnN0IHBheW1lbnRLd3IgPSBoYXJkZW4oXG4gICAgICBrZXlzMihhbW91bnRzKS5yZWR1Y2UoXG4gICAgICAgIChhY2MsIGt3LCBpMikgPT4gYXNzaWduNChhY2MsIHtcbiAgICAgICAgICBba3ddOiAoXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICBzZXR0bGVkV2l0aGRyYXdhbHNbaTJdLnZhbHVlXG4gICAgICAgICAgKVxuICAgICAgICB9KSxcbiAgICAgICAge31cbiAgICAgIClcbiAgICApO1xuICAgIGNvbnN0IGRlcG9zaXRSZXNwb25zZSA9IGF3YWl0IGRlcG9zaXRUb1NlYXQoXG4gICAgICB6Y2YsXG4gICAgICBkZXN0U2VhdCxcbiAgICAgIGFtb3VudHMsXG4gICAgICBwYXltZW50S3dyXG4gICAgKTtcbiAgICB0cmFjZTEwKFwid2l0aGRyYXdUb1NlYXQgZGVwb3NpdFJlc3BvbnNlXCIsIGRlcG9zaXRSZXNwb25zZSk7XG4gIH0pO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBsb2NhbFRyYW5zZmVyLFxuICAgIHdpdGhkcmF3VG9TZWF0XG4gIH0pO1xufTtcblxuLy9cbnZhciBIYW5kbGVyU2hhcGUgPSBNLnJlbW90YWJsZShcIk9mZmVySGFuZGxlclwiKTtcbnZhciBtYWtlWmNmVG9vbHMgPSAoemNmLCB2b3dUb29scykgPT4gaGFyZGVuKHtcbiAgbWFrZUludml0YXRpb24ob2ZmZXJIYW5kbGVyLCBkZXNjcmlwdGlvbiwgY3VzdG9tRGV0YWlscywgcHJvcG9zYWxTaGFwZSkge1xuICAgIG11c3RNYXRjaChvZmZlckhhbmRsZXIsIEhhbmRsZXJTaGFwZSk7XG4gICAgcmV0dXJuIHZvd1Rvb2xzLndhdGNoKFxuICAgICAgemNmLm1ha2VJbnZpdGF0aW9uKFxuICAgICAgICBvZmZlckhhbmRsZXIsXG4gICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICBjdXN0b21EZXRhaWxzLFxuICAgICAgICBwcm9wb3NhbFNoYXBlXG4gICAgICApXG4gICAgKTtcbiAgfSxcbiAgYXRvbWljUmVhcnJhbmdlKHRyYW5zZmVycykge1xuICAgIHpjZi5hdG9taWNSZWFycmFuZ2UodHJhbnNmZXJzKTtcbiAgfSxcbiAgYXNzZXJ0VW5pcXVlS2V5d29yZChrZXl3b3JkKSB7XG4gICAgemNmLmFzc2VydFVuaXF1ZUtleXdvcmQoa2V5d29yZCk7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHByb3ZpZGVPcmNoZXN0cmF0aW9uID0gKHpjZiwgYmFnZ2FnZSwgcmVtb3RlUG93ZXJzLCBtYXJzaGFsbGVyLCBvcHRzID0ge30pID0+IHtcbiAgY29uc3Qgem9uZXMgPSAoKCkgPT4ge1xuICAgIGNvbnN0IHpvbmUgPSBtYWtlRHVyYWJsZVpvbmUoYmFnZ2FnZSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGFzeW5jRmxvdzogem9uZS5zdWJab25lKFwiYXN5bmNGbG93XCIpLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgb3JjaGVzdHJhdGlvbjogem9uZS5zdWJab25lKFwib3JjaGVzdHJhdGlvblwiKSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBjaGFpbkh1Yjogem9uZS5zdWJab25lKFwiY2hhaW5IdWJcIiksXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICB2b3dzOiB6b25lLnN1YlpvbmUoXCJ2b3dzXCIpLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGNvbnRyYWN0OiB6b25lLnN1YlpvbmUoXCJjb250cmFjdFwiKVxuICAgIH07XG4gIH0pKCk7XG4gIGNvbnN0IHsgYWdvcmljTmFtZXMsIHRpbWVyU2VydmljZSwgbG9jYWxjaGFpbiB9ID0gcmVtb3RlUG93ZXJzO1xuICBjb25zdCB2b3dUb29scyA9IHByZXBhcmVTd2luZ3NldFZvd1Rvb2xzKHpvbmVzLnZvd3MpO1xuICBjb25zdCBjaGFpbkh1YiA9IG1ha2VDaGFpbkh1Yih6b25lcy5jaGFpbkh1YiwgYWdvcmljTmFtZXMsIHZvd1Rvb2xzLCB7XG4gICAgY2hhaW5JbmZvVmFsdWVTaGFwZTogb3B0cy5jaGFpbkluZm9WYWx1ZVNoYXBlXG4gIH0pO1xuICBjb25zdCB6b2VUb29scyA9IG1ha2Vab2VUb29scyh6Y2YsIHZvd1Rvb2xzKTtcbiAgY29uc3QgemNmVG9vbHMgPSBtYWtlWmNmVG9vbHMoemNmLCB2b3dUb29scyk7XG4gIGNvbnN0IHsgbWFrZVJlY29yZGVyS2l0IH0gPSBwcmVwYXJlUmVjb3JkZXJLaXRNYWtlcnMoYmFnZ2FnZSwgbWFyc2hhbGxlcik7XG4gIGNvbnN0IG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0ID0gcHJlcGFyZUxvY2FsT3JjaGVzdHJhdGlvbkFjY291bnRLaXQoXG4gICAgem9uZXMub3JjaGVzdHJhdGlvbixcbiAgICB7XG4gICAgICBtYWtlUmVjb3JkZXJLaXQsXG4gICAgICB6Y2YsXG4gICAgICB0aW1lclNlcnZpY2UsXG4gICAgICB2b3dUb29scyxcbiAgICAgIGNoYWluSHViLFxuICAgICAgbG9jYWxjaGFpbixcbiAgICAgIHpvZVRvb2xzXG4gICAgfVxuICApO1xuICBjb25zdCBhc3luY0Zsb3dUb29scyA9IHByZXBhcmVBc3luY0Zsb3dUb29scyh6b25lcy5hc3luY0Zsb3csIHtcbiAgICB2b3dUb29sc1xuICB9KTtcbiAgY29uc3QgbWFrZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50ID0gcHJlcGFyZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50KFxuICAgIHpvbmVzLm9yY2hlc3RyYXRpb24sXG4gICAge1xuICAgICAgY2hhaW5IdWIsXG4gICAgICBtYWtlUmVjb3JkZXJLaXQsXG4gICAgICB0aW1lclNlcnZpY2UsXG4gICAgICB2b3dUb29scyxcbiAgICAgIHpjZlxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZVJlbW90ZUNoYWluRmFjYWRlID0gcHJlcGFyZVJlbW90ZUNoYWluRmFjYWRlKHpvbmVzLm9yY2hlc3RyYXRpb24sIHtcbiAgICBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnQsXG4gICAgb3JjaGVzdHJhdGlvbjogcmVtb3RlUG93ZXJzLm9yY2hlc3RyYXRpb25TZXJ2aWNlLFxuICAgIHN0b3JhZ2VOb2RlOiByZW1vdGVQb3dlcnMuc3RvcmFnZU5vZGUsXG4gICAgdGltZXI6IHJlbW90ZVBvd2Vycy50aW1lclNlcnZpY2UsXG4gICAgdm93VG9vbHNcbiAgfSk7XG4gIGNvbnN0IG1ha2VMb2NhbENoYWluRmFjYWRlID0gcHJlcGFyZUxvY2FsQ2hhaW5GYWNhZGUoem9uZXMub3JjaGVzdHJhdGlvbiwge1xuICAgIG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0LFxuICAgIGxvY2FsY2hhaW46IHJlbW90ZVBvd2Vycy5sb2NhbGNoYWluLFxuICAgIC8vXG4gICAgc3RvcmFnZU5vZGU6IHJlbW90ZVBvd2Vycy5zdG9yYWdlTm9kZSxcbiAgICBhZ29yaWNOYW1lcyxcbiAgICBvcmNoZXN0cmF0aW9uOiByZW1vdGVQb3dlcnMub3JjaGVzdHJhdGlvblNlcnZpY2UsXG4gICAgdGltZXI6IHJlbW90ZVBvd2Vycy50aW1lclNlcnZpY2UsXG4gICAgdm93VG9vbHNcbiAgfSk7XG4gIGNvbnN0IG1ha2VPcmNoZXN0cmF0b3IgPSBwcmVwYXJlT3JjaGVzdHJhdG9yKHpvbmVzLm9yY2hlc3RyYXRpb24sIHtcbiAgICBjaGFpbkh1YixcbiAgICBtYWtlTG9jYWxDaGFpbkZhY2FkZSxcbiAgICBtYWtlUmVtb3RlQ2hhaW5GYWNhZGUsXG4gICAgdm93VG9vbHNcbiAgfSk7XG4gIGNvbnN0IG1ha2VPcmNoZXN0cmF0ZUtpdCA9ICh6b25lKSA9PiBtYWtlT3JjaGVzdHJhdGlvbkZhY2FkZSh7XG4gICAgem9uZSxcbiAgICB6Y2YsXG4gICAgbWFrZU9yY2hlc3RyYXRvcixcbiAgICBhc3luY0Zsb3dUb29scyxcbiAgICB2b3dUb29scyxcbiAgICAuLi5yZW1vdGVQb3dlcnNcbiAgfSk7XG4gIGNvbnN0IGRlZmF1bHRPcmNoZXN0cmF0ZUtpdCA9IG1ha2VPcmNoZXN0cmF0ZUtpdChcbiAgICB6b25lcy5jb250cmFjdC5zdWJab25lKFwib3JjaGVzdHJhdGlvblwiKVxuICApO1xuICB6Y2Yuc2V0VGVzdEppZygoKSA9PiAoe1xuICAgIGJhZ2dhZ2UsXG4gICAgY2hhaW5IdWJcbiAgfSkpO1xuICByZXR1cm4ge1xuICAgIC4uLmRlZmF1bHRPcmNoZXN0cmF0ZUtpdCxcbiAgICBtYWtlT3JjaGVzdHJhdGVLaXQsXG4gICAgYmFnZ2FnZSxcbiAgICBjaGFpbkh1YixcbiAgICB2b3dUb29scyxcbiAgICBhc3luY0Zsb3dUb29scyxcbiAgICB6Y2ZUb29scyxcbiAgICB6b2VUb29scyxcbiAgICB6b25lOiB6b25lcy5jb250cmFjdFxuICB9O1xufTtcbmhhcmRlbihwcm92aWRlT3JjaGVzdHJhdGlvbik7XG52YXIgd2l0aE9yY2hlc3RyYXRpb24gPSAoY29udHJhY3RGbiwgb3B0cykgPT4gYXN5bmMgKHpjZiwgcHJpdmF0ZUFyZ3MsIGJhZ2dhZ2UpID0+IHtcbiAgY29uc3QgeyBtYXJzaGFsbGVyLCAuLi5hbGxPcmNoUG93ZXJzIH0gPSBwcml2YXRlQXJncztcbiAgY29uc3QgeyBzdG9yYWdlTm9kZTogXywgLi4ucmVxdWlyZWRPcmNoUG93ZXJzIH0gPSBhbGxPcmNoUG93ZXJzO1xuICBjb25zdCB7IHB1Ymxpc2hBY2NvdW50SW5mbywgY2hhaW5JbmZvVmFsdWVTaGFwZSB9ID0gb3B0cyA/PyB7fTtcbiAgY29uc3QgeyB6b25lLCAuLi50b29scyB9ID0gcHJvdmlkZU9yY2hlc3RyYXRpb24oXG4gICAgemNmLFxuICAgIGJhZ2dhZ2UsXG4gICAgcHVibGlzaEFjY291bnRJbmZvID8gYWxsT3JjaFBvd2VycyA6IHJlcXVpcmVkT3JjaFBvd2VycyxcbiAgICBtYXJzaGFsbGVyLFxuICAgIHsgY2hhaW5JbmZvVmFsdWVTaGFwZSB9XG4gICk7XG4gIHJldHVybiBjb250cmFjdEZuKHpjZiwgcHJpdmF0ZUFyZ3MsIHpvbmUsIHRvb2xzKTtcbn07XG5oYXJkZW4od2l0aE9yY2hlc3RyYXRpb24pO1xuXG4vL1xudmFyIEljcUVuYWJsZWQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBvbW5pZmxpeGh1YjogdHJ1ZSxcbiAgICBvc21vc2lzOiB0cnVlXG4gIH1cbik7XG5oYXJkZW4oSWNxRW5hYmxlZCk7XG52YXIgUGZtRW5hYmxlZCA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIGFnb3JpYzogdHJ1ZSxcbiAgICBjZWxlc3RpYTogdHJ1ZSxcbiAgICBjb3Ntb3NodWI6IHRydWUsXG4gICAganVubzogdHJ1ZSxcbiAgICBuZXV0cm9uOiB0cnVlLFxuICAgIG5vYmxlOiB0cnVlLFxuICAgIG9tbmlmbGl4aHViOiB0cnVlLFxuICAgIG9zbW9zaXM6IHRydWUsXG4gICAgc2VjcmV0bmV0d29yazogdHJ1ZSxcbiAgICBzdGFyZ2F6ZTogdHJ1ZSxcbiAgICBzdHJpZGU6IHRydWUsXG4gICAgdW1lZTogdHJ1ZVxuICB9XG4pO1xuaGFyZGVuKFBmbUVuYWJsZWQpO1xudmFyIEljYUVuYWJsZWQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBjZWxlc3RpYTogdHJ1ZSxcbiAgICBjb3Ntb3NodWI6IHRydWUsXG4gICAgZHlkeDogdHJ1ZSxcbiAgICBqdW5vOiB0cnVlLFxuICAgIG5ldXRyb246IHRydWUsXG4gICAgbm9ibGU6IHRydWUsXG4gICAgb21uaWZsaXhodWI6IHRydWUsXG4gICAgb3Ntb3NpczogdHJ1ZSxcbiAgICBzZWNyZXRuZXR3b3JrOiB0cnVlLFxuICAgIHN0YXJnYXplOiB0cnVlLFxuICAgIHN0cmlkZTogdHJ1ZSxcbiAgICB1bWVlOiB0cnVlXG4gIH1cbik7XG5oYXJkZW4oSWNhRW5hYmxlZCk7XG5cbi8vXG52YXIgcmVnaXN0ZXJDaGFpbnNBbmRBc3NldHMgPSAoY2hhaW5IdWIsIGJyYW5kcywgY2hhaW5JbmZvLCBhc3NldEluZm8sIHsgbG9nID0gKCkgPT4ge1xufSB9ID0ge30pID0+IHtcbiAgbG9nKFwiY2hhaW5IdWI6IHJlZ2lzdGVyaW5nIGNoYWluc1wiLCBPYmplY3Qua2V5cyhjaGFpbkluZm8gfHwge30pKTtcbiAgaWYgKCFjaGFpbkluZm8pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgY29ubnMgPSB7fTtcbiAgZm9yIChjb25zdCBbY2hhaW5OYW1lLCBhbGxJbmZvXSBvZiBPYmplY3QuZW50cmllcyhjaGFpbkluZm8pKSB7XG4gICAgaWYgKGFsbEluZm8ubmFtZXNwYWNlID09PSBcImNvc21vc1wiKSB7XG4gICAgICBjb25zdCB7IGNvbm5lY3Rpb25zLCAuLi5pbmZvIH0gPSBhbGxJbmZvO1xuICAgICAgY2hhaW5IdWIucmVnaXN0ZXJDaGFpbihjaGFpbk5hbWUsIGluZm8pO1xuICAgICAgaWYgKGNvbm5lY3Rpb25zKSBjb25uc1tpbmZvLmNoYWluSWRdID0gY29ubmVjdGlvbnM7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNoYWluSHViLnJlZ2lzdGVyQ2hhaW4oY2hhaW5OYW1lLCBhbGxJbmZvKTtcbiAgICB9XG4gIH1cbiAgY29uc3QgcmVnaXN0ZXJlZFBhaXJzID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgZm9yIChjb25zdCBbcENoYWluSWQsIGNvbm5JbmZvc10gb2YgT2JqZWN0LmVudHJpZXMoY29ubnMpKSB7XG4gICAgZm9yIChjb25zdCBbY0NoYWluSWQsIGNvbm5JbmZvXSBvZiBPYmplY3QuZW50cmllcyhjb25uSW5mb3MpKSB7XG4gICAgICBjb25zdCBwYWlyID0gW3BDaGFpbklkLCBjQ2hhaW5JZF0uc29ydCgpLmpvaW4oXCI8LT5cIik7XG4gICAgICBpZiAoIXJlZ2lzdGVyZWRQYWlycy5oYXMocGFpcikpIHtcbiAgICAgICAgY2hhaW5IdWIucmVnaXN0ZXJDb25uZWN0aW9uKHBDaGFpbklkLCBjQ2hhaW5JZCwgY29ubkluZm8pO1xuICAgICAgICByZWdpc3RlcmVkUGFpcnMuYWRkKHBhaXIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBsb2coXCJjaGFpbkh1YjogcmVnaXN0ZXJlZCBjb25uZWN0aW9uc1wiLCBbLi4ucmVnaXN0ZXJlZFBhaXJzXS5zb3J0KCkpO1xuICBsb2coXG4gICAgXCJjaGFpbkh1YjogcmVnaXN0ZXJpbmcgYXNzZXRzXCIsXG4gICAgYXNzZXRJbmZvPy5tYXAoKFtkZW5vbSwgeyBjaGFpbk5hbWUgfV0pID0+IGAke2NoYWluTmFtZX06ICR7ZGVub219YClcbiAgKTtcbiAgaWYgKCFhc3NldEluZm8pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgZm9yIChjb25zdCBbZGVub20sIGluZm9dIG9mIGFzc2V0SW5mbykge1xuICAgIGNvbnN0IHsgYnJhbmRLZXksIC4uLnJlc3QgfSA9IGluZm87XG4gICAgY29uc3QgaW5mb1dpdGhCcmFuZCA9IGJyYW5kS2V5ID8geyAuLi5yZXN0LCBicmFuZDogYnJhbmRzW2JyYW5kS2V5XSB9IDogcmVzdDtcbiAgICBjaGFpbkh1Yi5yZWdpc3RlckFzc2V0KGRlbm9tLCBpbmZvV2l0aEJyYW5kKTtcbiAgfVxufTtcblxuLy9cbnZhciBpbXBvcnRfYmVjaDMyID0gX190b0VTTShyZXF1aXJlX2Rpc3QoKSwgMSk7XG5cbi8vXG52YXIgYmFzZV9leHBvcnRzID0ge307XG5fX2V4cG9ydChiYXNlX2V4cG9ydHMsIHtcbiAgZXhjbHVkZTogKCkgPT4gZXhjbHVkZSxcbiAgZXh0cmFjdDogKCkgPT4gZXh0cmFjdCxcbiAgcGFyc2U6ICgpID0+IHBhcnNlMixcbiAgcGFyc2VVcmw6ICgpID0+IHBhcnNlVXJsLFxuICBwaWNrOiAoKSA9PiBwaWNrLFxuICBzdHJpbmdpZnk6ICgpID0+IHN0cmluZ2lmeTIsXG4gIHN0cmluZ2lmeVVybDogKCkgPT4gc3RyaW5naWZ5VXJsXG59KTtcblxuLy9cbnZhciB0b2tlbiA9IFwiJVthLWYwLTldezJ9XCI7XG52YXIgc2luZ2xlTWF0Y2hlciA9IG5ldyBSZWdFeHAoXCIoXCIgKyB0b2tlbiArIFwiKXwoW14lXSs/KVwiLCBcImdpXCIpO1xudmFyIG11bHRpTWF0Y2hlciA9IG5ldyBSZWdFeHAoXCIoXCIgKyB0b2tlbiArIFwiKStcIiwgXCJnaVwiKTtcbmZ1bmN0aW9uIGRlY29kZUNvbXBvbmVudHMoY29tcG9uZW50cywgc3BsaXQpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gW2RlY29kZVVSSUNvbXBvbmVudChjb21wb25lbnRzLmpvaW4oXCJcIikpXTtcbiAgfSBjYXRjaCB7XG4gIH1cbiAgaWYgKGNvbXBvbmVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgcmV0dXJuIGNvbXBvbmVudHM7XG4gIH1cbiAgc3BsaXQgPSBzcGxpdCB8fCAxO1xuICBjb25zdCBsZWZ0ID0gY29tcG9uZW50cy5zbGljZSgwLCBzcGxpdCk7XG4gIGNvbnN0IHJpZ2h0ID0gY29tcG9uZW50cy5zbGljZShzcGxpdCk7XG4gIHJldHVybiBBcnJheS5wcm90b3R5cGUuY29uY2F0LmNhbGwoW10sIGRlY29kZUNvbXBvbmVudHMobGVmdCksIGRlY29kZUNvbXBvbmVudHMocmlnaHQpKTtcbn1cbmZ1bmN0aW9uIGRlY29kZShpbnB1dCkge1xuICB0cnkge1xuICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoaW5wdXQpO1xuICB9IGNhdGNoIHtcbiAgICBsZXQgdG9rZW5zID0gaW5wdXQubWF0Y2goc2luZ2xlTWF0Y2hlcikgfHwgW107XG4gICAgZm9yIChsZXQgaTIgPSAxOyBpMiA8IHRva2Vucy5sZW5ndGg7IGkyKyspIHtcbiAgICAgIGlucHV0ID0gZGVjb2RlQ29tcG9uZW50cyh0b2tlbnMsIGkyKS5qb2luKFwiXCIpO1xuICAgICAgdG9rZW5zID0gaW5wdXQubWF0Y2goc2luZ2xlTWF0Y2hlcikgfHwgW107XG4gICAgfVxuICAgIHJldHVybiBpbnB1dDtcbiAgfVxufVxuZnVuY3Rpb24gY3VzdG9tRGVjb2RlVVJJQ29tcG9uZW50KGlucHV0KSB7XG4gIGNvbnN0IHJlcGxhY2VNYXAgPSB7XG4gICAgXCIlRkUlRkZcIjogXCJcXHVGRkZEXFx1RkZGRFwiLFxuICAgIFwiJUZGJUZFXCI6IFwiXFx1RkZGRFxcdUZGRkRcIlxuICB9O1xuICBsZXQgbWF0Y2ggPSBtdWx0aU1hdGNoZXIuZXhlYyhpbnB1dCk7XG4gIHdoaWxlIChtYXRjaCkge1xuICAgIHRyeSB7XG4gICAgICByZXBsYWNlTWFwW21hdGNoWzBdXSA9IGRlY29kZVVSSUNvbXBvbmVudChtYXRjaFswXSk7XG4gICAgfSBjYXRjaCB7XG4gICAgICBjb25zdCByZXN1bHQgPSBkZWNvZGUobWF0Y2hbMF0pO1xuICAgICAgaWYgKHJlc3VsdCAhPT0gbWF0Y2hbMF0pIHtcbiAgICAgICAgcmVwbGFjZU1hcFttYXRjaFswXV0gPSByZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuICAgIG1hdGNoID0gbXVsdGlNYXRjaGVyLmV4ZWMoaW5wdXQpO1xuICB9XG4gIHJlcGxhY2VNYXBbXCIlQzJcIl0gPSBcIlxcdUZGRkRcIjtcbiAgY29uc3QgZW50cmllczEwID0gT2JqZWN0LmtleXMocmVwbGFjZU1hcCk7XG4gIGZvciAoY29uc3Qga2V5IG9mIGVudHJpZXMxMCkge1xuICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZShuZXcgUmVnRXhwKGtleSwgXCJnXCIpLCByZXBsYWNlTWFwW2tleV0pO1xuICB9XG4gIHJldHVybiBpbnB1dDtcbn1cbmZ1bmN0aW9uIGRlY29kZVVyaUNvbXBvbmVudChlbmNvZGVkVVJJKSB7XG4gIGlmICh0eXBlb2YgZW5jb2RlZFVSSSAhPT0gXCJzdHJpbmdcIikge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJFeHBlY3RlZCBgZW5jb2RlZFVSSWAgdG8gYmUgb2YgdHlwZSBgc3RyaW5nYCwgZ290IGBcIiArIHR5cGVvZiBlbmNvZGVkVVJJICsgXCJgXCIpO1xuICB9XG4gIHRyeSB7XG4gICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlbmNvZGVkVVJJKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIGN1c3RvbURlY29kZVVSSUNvbXBvbmVudChlbmNvZGVkVVJJKTtcbiAgfVxufVxuXG4vL1xuZnVuY3Rpb24gaW5jbHVkZUtleXMob2JqZWN0LCBwcmVkaWNhdGUpIHtcbiAgY29uc3QgcmVzdWx0ID0ge307XG4gIGlmIChBcnJheS5pc0FycmF5KHByZWRpY2F0ZSkpIHtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBwcmVkaWNhdGUpIHtcbiAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwga2V5KTtcbiAgICAgIGlmIChkZXNjcmlwdG9yPy5lbnVtZXJhYmxlKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXN1bHQsIGtleSwgZGVzY3JpcHRvcik7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZvciAoY29uc3Qga2V5IG9mIFJlZmxlY3Qub3duS2V5cyhvYmplY3QpKSB7XG4gICAgICBjb25zdCBkZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIGtleSk7XG4gICAgICBpZiAoZGVzY3JpcHRvci5lbnVtZXJhYmxlKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gb2JqZWN0W2tleV07XG4gICAgICAgIGlmIChwcmVkaWNhdGUoa2V5LCB2YWx1ZSwgb2JqZWN0KSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXN1bHQsIGtleSwgZGVzY3JpcHRvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLy9cbmZ1bmN0aW9uIHNwbGl0T25GaXJzdChzdHJpbmcsIHNlcGFyYXRvcikge1xuICBpZiAoISh0eXBlb2Ygc3RyaW5nID09PSBcInN0cmluZ1wiICYmIHR5cGVvZiBzZXBhcmF0b3IgPT09IFwic3RyaW5nXCIpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkV4cGVjdGVkIHRoZSBhcmd1bWVudHMgdG8gYmUgb2YgdHlwZSBgc3RyaW5nYFwiKTtcbiAgfVxuICBpZiAoc3RyaW5nID09PSBcIlwiIHx8IHNlcGFyYXRvciA9PT0gXCJcIikge1xuICAgIHJldHVybiBbXTtcbiAgfVxuICBjb25zdCBzZXBhcmF0b3JJbmRleCA9IHN0cmluZy5pbmRleE9mKHNlcGFyYXRvcik7XG4gIGlmIChzZXBhcmF0b3JJbmRleCA9PT0gLTEpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgcmV0dXJuIFtcbiAgICBzdHJpbmcuc2xpY2UoMCwgc2VwYXJhdG9ySW5kZXgpLFxuICAgIHN0cmluZy5zbGljZShzZXBhcmF0b3JJbmRleCArIHNlcGFyYXRvci5sZW5ndGgpXG4gIF07XG59XG5cbi8vXG52YXIgaXNOdWxsT3JVbmRlZmluZWQgPSAodmFsdWUpID0+IHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB2b2lkIDA7XG52YXIgc3RyaWN0VXJpRW5jb2RlID0gKHN0cmluZykgPT4gZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZykucmVwbGFjZUFsbCgvWyEnKCkqXS9nLCAoeCkgPT4gYCUke3guY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKX1gKTtcbnZhciBlbmNvZGVGcmFnbWVudElkZW50aWZpZXIgPSBTeW1ib2woXCJlbmNvZGVGcmFnbWVudElkZW50aWZpZXJcIik7XG5mdW5jdGlvbiBlbmNvZGVyRm9yQXJyYXlGb3JtYXQob3B0aW9ucykge1xuICBzd2l0Y2ggKG9wdGlvbnMuYXJyYXlGb3JtYXQpIHtcbiAgICBjYXNlIFwiaW5kZXhcIjoge1xuICAgICAgcmV0dXJuIChrZXkpID0+IChyZXN1bHQsIHZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gcmVzdWx0Lmxlbmd0aDtcbiAgICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDAgfHwgb3B0aW9ucy5za2lwTnVsbCAmJiB2YWx1ZSA9PT0gbnVsbCB8fCBvcHRpb25zLnNraXBFbXB0eVN0cmluZyAmJiB2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgXCJbXCIsIGluZGV4LCBcIl1cIl0uam9pbihcIlwiKVxuICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgW2VuY29kZShrZXksIG9wdGlvbnMpLCBcIltcIiwgZW5jb2RlKGluZGV4LCBvcHRpb25zKSwgXCJdPVwiLCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKFwiXCIpXG4gICAgICAgIF07XG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiYnJhY2tldFwiOiB7XG4gICAgICByZXR1cm4gKGtleSkgPT4gKHJlc3VsdCwgdmFsdWUpID0+IHtcbiAgICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDAgfHwgb3B0aW9ucy5za2lwTnVsbCAmJiB2YWx1ZSA9PT0gbnVsbCB8fCBvcHRpb25zLnNraXBFbXB0eVN0cmluZyAmJiB2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgXCJbXVwiXS5qb2luKFwiXCIpXG4gICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICBbZW5jb2RlKGtleSwgb3B0aW9ucyksIFwiW109XCIsIGVuY29kZSh2YWx1ZSwgb3B0aW9ucyldLmpvaW4oXCJcIilcbiAgICAgICAgXTtcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgXCJjb2xvbi1saXN0LXNlcGFyYXRvclwiOiB7XG4gICAgICByZXR1cm4gKGtleSkgPT4gKHJlc3VsdCwgdmFsdWUpID0+IHtcbiAgICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDAgfHwgb3B0aW9ucy5za2lwTnVsbCAmJiB2YWx1ZSA9PT0gbnVsbCB8fCBvcHRpb25zLnNraXBFbXB0eVN0cmluZyAmJiB2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgXCI6bGlzdD1cIl0uam9pbihcIlwiKVxuICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgW2VuY29kZShrZXksIG9wdGlvbnMpLCBcIjpsaXN0PVwiLCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKFwiXCIpXG4gICAgICAgIF07XG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiY29tbWFcIjpcbiAgICBjYXNlIFwic2VwYXJhdG9yXCI6XG4gICAgY2FzZSBcImJyYWNrZXQtc2VwYXJhdG9yXCI6IHtcbiAgICAgIGNvbnN0IGtleVZhbHVlU2VwYXJhdG9yID0gb3B0aW9ucy5hcnJheUZvcm1hdCA9PT0gXCJicmFja2V0LXNlcGFyYXRvclwiID8gXCJbXT1cIiA6IFwiPVwiO1xuICAgICAgcmV0dXJuIChrZXkpID0+IChyZXN1bHQsIHZhbHVlKSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwIHx8IG9wdGlvbnMuc2tpcE51bGwgJiYgdmFsdWUgPT09IG51bGwgfHwgb3B0aW9ucy5za2lwRW1wdHlTdHJpbmcgJiYgdmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIHZhbHVlID0gdmFsdWUgPT09IG51bGwgPyBcIlwiIDogdmFsdWU7XG4gICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIFtbZW5jb2RlKGtleSwgb3B0aW9ucyksIGtleVZhbHVlU2VwYXJhdG9yLCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKFwiXCIpXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW1tyZXN1bHQsIGVuY29kZSh2YWx1ZSwgb3B0aW9ucyldLmpvaW4ob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcildO1xuICAgICAgfTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgcmV0dXJuIChrZXkpID0+IChyZXN1bHQsIHZhbHVlKSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwIHx8IG9wdGlvbnMuc2tpcE51bGwgJiYgdmFsdWUgPT09IG51bGwgfHwgb3B0aW9ucy5za2lwRW1wdHlTdHJpbmcgJiYgdmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgICBlbmNvZGUoa2V5LCBvcHRpb25zKVxuICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgW2VuY29kZShrZXksIG9wdGlvbnMpLCBcIj1cIiwgZW5jb2RlKHZhbHVlLCBvcHRpb25zKV0uam9pbihcIlwiKVxuICAgICAgICBdO1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIHBhcnNlckZvckFycmF5Rm9ybWF0KG9wdGlvbnMpIHtcbiAgbGV0IHJlc3VsdDtcbiAgc3dpdGNoIChvcHRpb25zLmFycmF5Rm9ybWF0KSB7XG4gICAgY2FzZSBcImluZGV4XCI6IHtcbiAgICAgIHJldHVybiAoa2V5LCB2YWx1ZSwgYWNjdW11bGF0b3IpID0+IHtcbiAgICAgICAgcmVzdWx0ID0gL1xcWyhcXGQqKV0kLy5leGVjKGtleSk7XG4gICAgICAgIGtleSA9IGtleS5yZXBsYWNlKC9cXFtcXGQqXSQvLCBcIlwiKTtcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gdmFsdWU7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhY2N1bXVsYXRvcltrZXldID09PSB2b2lkIDApIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0ge307XG4gICAgICAgIH1cbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XVtyZXN1bHRbMV1dID0gdmFsdWU7XG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiYnJhY2tldFwiOiB7XG4gICAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG4gICAgICAgIHJlc3VsdCA9IC8oXFxbXSkkLy5leGVjKGtleSk7XG4gICAgICAgIGtleSA9IGtleS5yZXBsYWNlKC9cXFtdJC8sIFwiXCIpO1xuICAgICAgICBpZiAoIXJlc3VsdCkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFjY3VtdWxhdG9yW2tleV0gPT09IHZvaWQgMCkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSBbdmFsdWVdO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gWy4uLmFjY3VtdWxhdG9yW2tleV0sIHZhbHVlXTtcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgXCJjb2xvbi1saXN0LXNlcGFyYXRvclwiOiB7XG4gICAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG4gICAgICAgIHJlc3VsdCA9IC8oOmxpc3QpJC8uZXhlYyhrZXkpO1xuICAgICAgICBrZXkgPSBrZXkucmVwbGFjZSgvOmxpc3QkLywgXCJcIik7XG4gICAgICAgIGlmICghcmVzdWx0KSB7XG4gICAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IHZhbHVlO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWNjdW11bGF0b3Jba2V5XSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IFt2YWx1ZV07XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSBbLi4uYWNjdW11bGF0b3Jba2V5XSwgdmFsdWVdO1xuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBcImNvbW1hXCI6XG4gICAgY2FzZSBcInNlcGFyYXRvclwiOiB7XG4gICAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG4gICAgICAgIGNvbnN0IGlzQXJyYXk5ID0gdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluY2x1ZGVzKG9wdGlvbnMuYXJyYXlGb3JtYXRTZXBhcmF0b3IpO1xuICAgICAgICBjb25zdCBpc0VuY29kZWRBcnJheSA9IHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiAhaXNBcnJheTkgJiYgZGVjb2RlMih2YWx1ZSwgb3B0aW9ucykuaW5jbHVkZXMob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gICAgICAgIHZhbHVlID0gaXNFbmNvZGVkQXJyYXkgPyBkZWNvZGUyKHZhbHVlLCBvcHRpb25zKSA6IHZhbHVlO1xuICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IGlzQXJyYXk5IHx8IGlzRW5jb2RlZEFycmF5ID8gdmFsdWUuc3BsaXQob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcikubWFwKChpdGVtKSA9PiBkZWNvZGUyKGl0ZW0sIG9wdGlvbnMpKSA6IHZhbHVlID09PSBudWxsID8gdmFsdWUgOiBkZWNvZGUyKHZhbHVlLCBvcHRpb25zKTtcbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IG5ld1ZhbHVlO1xuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBcImJyYWNrZXQtc2VwYXJhdG9yXCI6IHtcbiAgICAgIHJldHVybiAoa2V5LCB2YWx1ZSwgYWNjdW11bGF0b3IpID0+IHtcbiAgICAgICAgY29uc3QgaXNBcnJheTkgPSAvKFxcW10pJC8udGVzdChrZXkpO1xuICAgICAgICBrZXkgPSBrZXkucmVwbGFjZSgvXFxbXSQvLCBcIlwiKTtcbiAgICAgICAgaWYgKCFpc0FycmF5OSkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSB2YWx1ZSA/IGRlY29kZTIodmFsdWUsIG9wdGlvbnMpIDogdmFsdWU7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFycmF5VmFsdWUgPSB2YWx1ZSA9PT0gbnVsbCA/IFtdIDogZGVjb2RlMih2YWx1ZSwgb3B0aW9ucykuc3BsaXQob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gICAgICAgIGlmIChhY2N1bXVsYXRvcltrZXldID09PSB2b2lkIDApIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gYXJyYXlWYWx1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IFsuLi5hY2N1bXVsYXRvcltrZXldLCAuLi5hcnJheVZhbHVlXTtcbiAgICAgIH07XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHJldHVybiAoa2V5LCB2YWx1ZSwgYWNjdW11bGF0b3IpID0+IHtcbiAgICAgICAgaWYgKGFjY3VtdWxhdG9yW2tleV0gPT09IHZvaWQgMCkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IFsuLi5bYWNjdW11bGF0b3Jba2V5XV0uZmxhdCgpLCB2YWx1ZV07XG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gdmFsaWRhdGVBcnJheUZvcm1hdFNlcGFyYXRvcih2YWx1ZSkge1xuICBpZiAodHlwZW9mIHZhbHVlICE9PSBcInN0cmluZ1wiIHx8IHZhbHVlLmxlbmd0aCAhPT0gMSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJhcnJheUZvcm1hdFNlcGFyYXRvciBtdXN0IGJlIHNpbmdsZSBjaGFyYWN0ZXIgc3RyaW5nXCIpO1xuICB9XG59XG5mdW5jdGlvbiBlbmNvZGUodmFsdWUsIG9wdGlvbnMpIHtcbiAgaWYgKG9wdGlvbnMuZW5jb2RlKSB7XG4gICAgcmV0dXJuIG9wdGlvbnMuc3RyaWN0ID8gc3RyaWN0VXJpRW5jb2RlKHZhbHVlKSA6IGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gZGVjb2RlMih2YWx1ZSwgb3B0aW9ucykge1xuICBpZiAob3B0aW9ucy5kZWNvZGUpIHtcbiAgICByZXR1cm4gZGVjb2RlVXJpQ29tcG9uZW50KHZhbHVlKTtcbiAgfVxuICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiBrZXlzU29ydGVyKGlucHV0KSB7XG4gIGlmIChBcnJheS5pc0FycmF5KGlucHV0KSkge1xuICAgIHJldHVybiBpbnB1dC5zb3J0KCk7XG4gIH1cbiAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gXCJvYmplY3RcIikge1xuICAgIHJldHVybiBrZXlzU29ydGVyKE9iamVjdC5rZXlzKGlucHV0KSkuc29ydCgoYTIsIGIzKSA9PiBOdW1iZXIoYTIpIC0gTnVtYmVyKGIzKSkubWFwKChrZXkpID0+IGlucHV0W2tleV0pO1xuICB9XG4gIHJldHVybiBpbnB1dDtcbn1cbmZ1bmN0aW9uIHJlbW92ZUhhc2goaW5wdXQpIHtcbiAgY29uc3QgaGFzaFN0YXJ0ID0gaW5wdXQuaW5kZXhPZihcIiNcIik7XG4gIGlmIChoYXNoU3RhcnQgIT09IC0xKSB7XG4gICAgaW5wdXQgPSBpbnB1dC5zbGljZSgwLCBoYXNoU3RhcnQpO1xuICB9XG4gIHJldHVybiBpbnB1dDtcbn1cbmZ1bmN0aW9uIGdldEhhc2godXJsKSB7XG4gIGxldCBoYXNoID0gXCJcIjtcbiAgY29uc3QgaGFzaFN0YXJ0ID0gdXJsLmluZGV4T2YoXCIjXCIpO1xuICBpZiAoaGFzaFN0YXJ0ICE9PSAtMSkge1xuICAgIGhhc2ggPSB1cmwuc2xpY2UoaGFzaFN0YXJ0KTtcbiAgfVxuICByZXR1cm4gaGFzaDtcbn1cbmZ1bmN0aW9uIHBhcnNlVmFsdWUodmFsdWUsIG9wdGlvbnMsIHR5cGUpIHtcbiAgaWYgKHR5cGUgPT09IFwic3RyaW5nXCIgJiYgdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIGlmICh0eXBlb2YgdHlwZSA9PT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiB0eXBlKHZhbHVlKTtcbiAgfVxuICBpZiAob3B0aW9ucy5wYXJzZUJvb2xlYW5zICYmIHZhbHVlICE9PSBudWxsICYmICh2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSBcInRydWVcIiB8fCB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSBcImZhbHNlXCIpKSB7XG4gICAgcmV0dXJuIHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IFwidHJ1ZVwiO1xuICB9XG4gIGlmICh0eXBlID09PSBcIm51bWJlclwiICYmICFOdW1iZXIuaXNOYU4oTnVtYmVyKHZhbHVlKSkgJiYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS50cmltKCkgIT09IFwiXCIpKSB7XG4gICAgcmV0dXJuIE51bWJlcih2YWx1ZSk7XG4gIH1cbiAgaWYgKG9wdGlvbnMucGFyc2VOdW1iZXJzICYmICFOdW1iZXIuaXNOYU4oTnVtYmVyKHZhbHVlKSkgJiYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS50cmltKCkgIT09IFwiXCIpKSB7XG4gICAgcmV0dXJuIE51bWJlcih2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gZXh0cmFjdChpbnB1dCkge1xuICBpbnB1dCA9IHJlbW92ZUhhc2goaW5wdXQpO1xuICBjb25zdCBxdWVyeVN0YXJ0ID0gaW5wdXQuaW5kZXhPZihcIj9cIik7XG4gIGlmIChxdWVyeVN0YXJ0ID09PSAtMSkge1xuICAgIHJldHVybiBcIlwiO1xuICB9XG4gIHJldHVybiBpbnB1dC5zbGljZShxdWVyeVN0YXJ0ICsgMSk7XG59XG5mdW5jdGlvbiBwYXJzZTIocXVlcnksIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IHtcbiAgICBkZWNvZGU6IHRydWUsXG4gICAgc29ydDogdHJ1ZSxcbiAgICBhcnJheUZvcm1hdDogXCJub25lXCIsXG4gICAgYXJyYXlGb3JtYXRTZXBhcmF0b3I6IFwiLFwiLFxuICAgIHBhcnNlTnVtYmVyczogZmFsc2UsXG4gICAgcGFyc2VCb29sZWFuczogZmFsc2UsXG4gICAgdHlwZXM6IC8qICAgICAgICAgICAqLyBPYmplY3QuY3JlYXRlKG51bGwpLFxuICAgIC4uLm9wdGlvbnNcbiAgfTtcbiAgdmFsaWRhdGVBcnJheUZvcm1hdFNlcGFyYXRvcihvcHRpb25zLmFycmF5Rm9ybWF0U2VwYXJhdG9yKTtcbiAgY29uc3QgZm9ybWF0dGVyID0gcGFyc2VyRm9yQXJyYXlGb3JtYXQob3B0aW9ucyk7XG4gIGNvbnN0IHJldHVyblZhbHVlID0gLyogICAgICAgICAgICovIE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIGlmICh0eXBlb2YgcXVlcnkgIT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gIH1cbiAgcXVlcnkgPSBxdWVyeS50cmltKCkucmVwbGFjZSgvXls/IyZdLywgXCJcIik7XG4gIGlmICghcXVlcnkpIHtcbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gIH1cbiAgZm9yIChjb25zdCBwYXJhbWV0ZXIgb2YgcXVlcnkuc3BsaXQoXCImXCIpKSB7XG4gICAgaWYgKHBhcmFtZXRlciA9PT0gXCJcIikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtZXRlcl8gPSBvcHRpb25zLmRlY29kZSA/IHBhcmFtZXRlci5yZXBsYWNlQWxsKFwiK1wiLCBcIiBcIikgOiBwYXJhbWV0ZXI7XG4gICAgbGV0IFtrZXksIHZhbHVlXSA9IHNwbGl0T25GaXJzdChwYXJhbWV0ZXJfLCBcIj1cIik7XG4gICAgaWYgKGtleSA9PT0gdm9pZCAwKSB7XG4gICAgICBrZXkgPSBwYXJhbWV0ZXJfO1xuICAgIH1cbiAgICB2YWx1ZSA9IHZhbHVlID09PSB2b2lkIDAgPyBudWxsIDogW1wiY29tbWFcIiwgXCJzZXBhcmF0b3JcIiwgXCJicmFja2V0LXNlcGFyYXRvclwiXS5pbmNsdWRlcyhvcHRpb25zLmFycmF5Rm9ybWF0KSA/IHZhbHVlIDogZGVjb2RlMih2YWx1ZSwgb3B0aW9ucyk7XG4gICAgZm9ybWF0dGVyKGRlY29kZTIoa2V5LCBvcHRpb25zKSwgdmFsdWUsIHJldHVyblZhbHVlKTtcbiAgfVxuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhyZXR1cm5WYWx1ZSkpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIHZhbHVlICE9PSBudWxsICYmIG9wdGlvbnMudHlwZXNba2V5XSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgZm9yIChjb25zdCBba2V5MiwgdmFsdWUyXSBvZiBPYmplY3QuZW50cmllcyh2YWx1ZSkpIHtcbiAgICAgICAgY29uc3QgdHlwZSA9IG9wdGlvbnMudHlwZXNba2V5XSA/IG9wdGlvbnMudHlwZXNba2V5XS5yZXBsYWNlKFwiW11cIiwgXCJcIikgOiB2b2lkIDA7XG4gICAgICAgIHZhbHVlW2tleTJdID0gcGFyc2VWYWx1ZSh2YWx1ZTIsIG9wdGlvbnMsIHR5cGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIHZhbHVlICE9PSBudWxsICYmIG9wdGlvbnMudHlwZXNba2V5XSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuVmFsdWVba2V5XSA9IE9iamVjdC52YWx1ZXModmFsdWUpLmpvaW4ob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVyblZhbHVlW2tleV0gPSBwYXJzZVZhbHVlKHZhbHVlLCBvcHRpb25zLCBvcHRpb25zLnR5cGVzW2tleV0pO1xuICAgIH1cbiAgfVxuICBpZiAob3B0aW9ucy5zb3J0ID09PSBmYWxzZSkge1xuICAgIHJldHVybiByZXR1cm5WYWx1ZTtcbiAgfVxuICByZXR1cm4gKG9wdGlvbnMuc29ydCA9PT0gdHJ1ZSA/IE9iamVjdC5rZXlzKHJldHVyblZhbHVlKS5zb3J0KCkgOiBPYmplY3Qua2V5cyhyZXR1cm5WYWx1ZSkuc29ydChvcHRpb25zLnNvcnQpKS5yZWR1Y2UoKHJlc3VsdCwga2V5KSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSByZXR1cm5WYWx1ZVtrZXldO1xuICAgIHJlc3VsdFtrZXldID0gQm9vbGVhbih2YWx1ZSkgJiYgdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmICFBcnJheS5pc0FycmF5KHZhbHVlKSA/IGtleXNTb3J0ZXIodmFsdWUpIDogdmFsdWU7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSwgLyogICAgICAgICAgICovIE9iamVjdC5jcmVhdGUobnVsbCkpO1xufVxuZnVuY3Rpb24gc3RyaW5naWZ5MihvYmplY3QsIG9wdGlvbnMpIHtcbiAgaWYgKCFvYmplY3QpIHtcbiAgICByZXR1cm4gXCJcIjtcbiAgfVxuICBvcHRpb25zID0ge1xuICAgIGVuY29kZTogdHJ1ZSxcbiAgICBzdHJpY3Q6IHRydWUsXG4gICAgYXJyYXlGb3JtYXQ6IFwibm9uZVwiLFxuICAgIGFycmF5Rm9ybWF0U2VwYXJhdG9yOiBcIixcIixcbiAgICAuLi5vcHRpb25zXG4gIH07XG4gIHZhbGlkYXRlQXJyYXlGb3JtYXRTZXBhcmF0b3Iob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gIGNvbnN0IHNob3VsZEZpbHRlciA9IChrZXkpID0+IG9wdGlvbnMuc2tpcE51bGwgJiYgaXNOdWxsT3JVbmRlZmluZWQob2JqZWN0W2tleV0pIHx8IG9wdGlvbnMuc2tpcEVtcHR5U3RyaW5nICYmIG9iamVjdFtrZXldID09PSBcIlwiO1xuICBjb25zdCBmb3JtYXR0ZXIgPSBlbmNvZGVyRm9yQXJyYXlGb3JtYXQob3B0aW9ucyk7XG4gIGNvbnN0IG9iamVjdENvcHkgPSB7fTtcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMob2JqZWN0KSkge1xuICAgIGlmICghc2hvdWxkRmlsdGVyKGtleSkpIHtcbiAgICAgIG9iamVjdENvcHlba2V5XSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuICBjb25zdCBrZXlzNCA9IE9iamVjdC5rZXlzKG9iamVjdENvcHkpO1xuICBpZiAob3B0aW9ucy5zb3J0ICE9PSBmYWxzZSkge1xuICAgIGtleXM0LnNvcnQob3B0aW9ucy5zb3J0KTtcbiAgfVxuICByZXR1cm4ga2V5czQubWFwKChrZXkpID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IG9iamVjdFtrZXldO1xuICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gZW5jb2RlKGtleSwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCAmJiBvcHRpb25zLmFycmF5Rm9ybWF0ID09PSBcImJyYWNrZXQtc2VwYXJhdG9yXCIpIHtcbiAgICAgICAgcmV0dXJuIGVuY29kZShrZXksIG9wdGlvbnMpICsgXCJbXVwiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZhbHVlLnJlZHVjZShmb3JtYXR0ZXIoa2V5KSwgW10pLmpvaW4oXCImXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZW5jb2RlKGtleSwgb3B0aW9ucykgKyBcIj1cIiArIGVuY29kZSh2YWx1ZSwgb3B0aW9ucyk7XG4gIH0pLmZpbHRlcigoeCkgPT4geC5sZW5ndGggPiAwKS5qb2luKFwiJlwiKTtcbn1cbmZ1bmN0aW9uIHBhcnNlVXJsKHVybCwgb3B0aW9ucykge1xuICBvcHRpb25zID0ge1xuICAgIGRlY29kZTogdHJ1ZSxcbiAgICAuLi5vcHRpb25zXG4gIH07XG4gIGxldCBbdXJsXywgaGFzaF0gPSBzcGxpdE9uRmlyc3QodXJsLCBcIiNcIik7XG4gIGlmICh1cmxfID09PSB2b2lkIDApIHtcbiAgICB1cmxfID0gdXJsO1xuICB9XG4gIHJldHVybiB7XG4gICAgdXJsOiB1cmxfPy5zcGxpdChcIj9cIik/LlswXSA/PyBcIlwiLFxuICAgIHF1ZXJ5OiBwYXJzZTIoZXh0cmFjdCh1cmwpLCBvcHRpb25zKSxcbiAgICAuLi4ob3B0aW9ucyYmIG9wdGlvbnMucGFyc2VGcmFnbWVudElkZW50aWZpZXIgJiYgaGFzaCA/IHsgZnJhZ21lbnRJZGVudGlmaWVyOiBkZWNvZGUyKGhhc2gsIG9wdGlvbnMpIH0gOiB7fSlcbiAgfTtcbn1cbmZ1bmN0aW9uIHN0cmluZ2lmeVVybChvYmplY3QsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IHtcbiAgICBlbmNvZGU6IHRydWUsXG4gICAgc3RyaWN0OiB0cnVlLFxuICAgIFtlbmNvZGVGcmFnbWVudElkZW50aWZpZXJdOiB0cnVlLFxuICAgIC4uLm9wdGlvbnNcbiAgfTtcbiAgY29uc3QgdXJsID0gcmVtb3ZlSGFzaChvYmplY3QudXJsKS5zcGxpdChcIj9cIilbMF0gfHwgXCJcIjtcbiAgY29uc3QgcXVlcnlGcm9tVXJsID0gZXh0cmFjdChvYmplY3QudXJsKTtcbiAgY29uc3QgcXVlcnkgPSB7XG4gICAgLi4ucGFyc2UyKHF1ZXJ5RnJvbVVybCwgeyBzb3J0OiBmYWxzZSB9KSxcbiAgICAuLi5vYmplY3QucXVlcnlcbiAgfTtcbiAgbGV0IHF1ZXJ5U3RyaW5nID0gc3RyaW5naWZ5MihxdWVyeSwgb3B0aW9ucyk7XG4gIHF1ZXJ5U3RyaW5nICYmPSBgPyR7cXVlcnlTdHJpbmd9YDtcbiAgbGV0IGhhc2ggPSBnZXRIYXNoKG9iamVjdC51cmwpO1xuICBpZiAodHlwZW9mIG9iamVjdC5mcmFnbWVudElkZW50aWZpZXIgPT09IFwic3RyaW5nXCIpIHtcbiAgICBjb25zdCB1cmxPYmplY3RGb3JGcmFnbWVudEVuY29kZSA9IG5ldyBVUkwodXJsKTtcbiAgICB1cmxPYmplY3RGb3JGcmFnbWVudEVuY29kZS5oYXNoID0gb2JqZWN0LmZyYWdtZW50SWRlbnRpZmllcjtcbiAgICBoYXNoID0gb3B0aW9uc1tlbmNvZGVGcmFnbWVudElkZW50aWZpZXJdID8gdXJsT2JqZWN0Rm9yRnJhZ21lbnRFbmNvZGUuaGFzaCA6IGAjJHtvYmplY3QuZnJhZ21lbnRJZGVudGlmaWVyfWA7XG4gIH1cbiAgcmV0dXJuIGAke3VybH0ke3F1ZXJ5U3RyaW5nfSR7aGFzaH1gO1xufVxuZnVuY3Rpb24gcGljayhpbnB1dCwgZmlsdGVyLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSB7XG4gICAgcGFyc2VGcmFnbWVudElkZW50aWZpZXI6IHRydWUsXG4gICAgW2VuY29kZUZyYWdtZW50SWRlbnRpZmllcl06IGZhbHNlLFxuICAgIC4uLm9wdGlvbnNcbiAgfTtcbiAgY29uc3QgeyB1cmwsIHF1ZXJ5LCBmcmFnbWVudElkZW50aWZpZXIgfSA9IHBhcnNlVXJsKGlucHV0LCBvcHRpb25zKTtcbiAgcmV0dXJuIHN0cmluZ2lmeVVybCh7XG4gICAgdXJsLFxuICAgIHF1ZXJ5OiBpbmNsdWRlS2V5cyhxdWVyeSwgZmlsdGVyKSxcbiAgICBmcmFnbWVudElkZW50aWZpZXJcbiAgfSwgb3B0aW9ucyk7XG59XG5mdW5jdGlvbiBleGNsdWRlKGlucHV0LCBmaWx0ZXIsIG9wdGlvbnMpIHtcbiAgY29uc3QgZXhjbHVzaW9uRmlsdGVyID0gQXJyYXkuaXNBcnJheShmaWx0ZXIpID8gKGtleSkgPT4gIWZpbHRlci5pbmNsdWRlcyhrZXkpIDogKGtleSwgdmFsdWUpID0+ICFmaWx0ZXIoa2V5LCB2YWx1ZSk7XG4gIHJldHVybiBwaWNrKGlucHV0LCBleGNsdXNpb25GaWx0ZXIsIG9wdGlvbnMpO1xufVxuXG4vL1xudmFyIHF1ZXJ5X3N0cmluZ19kZWZhdWx0ID0gYmFzZV9leHBvcnRzO1xuXG4vL1xudmFyIHI0ID0gZ2xvYmFsVGhpcy5oYXJkZW4gfHwgT2JqZWN0LmZyZWV6ZTtcbnZhciB0NCA9IFsxMjAsIDI0MSwgMTEyXTtcbnI0KHQ0KTtcbnZhciBkZWNvZGVCZWNoMzIgPSAobzIsIHQ1ID0gMTAyNCkgPT4ge1xuICBjb25zdCB7IHByZWZpeDogczMsIHdvcmRzOiBuMiB9ID0gaW1wb3J0X2JlY2gzMi5iZWNoMzIuZGVjb2RlKG8yLCB0NSksIGQgPSBpbXBvcnRfYmVjaDMyLmJlY2gzMi5mcm9tV29yZHMobjIpLCBjMiA9IG5ldyBVaW50OEFycmF5KGQpO1xuICByZXR1cm4gcjQoeyBwcmVmaXg6IHMzLCBieXRlczogYzIgfSk7XG59O1xucjQoZGVjb2RlQmVjaDMyKTtcbnZhciBlbmNvZGVCZWNoMzIgPSAobzIsIHI1LCB0NSA9IDEwMjQpID0+IHtcbiAgY29uc3QgczMgPSBpbXBvcnRfYmVjaDMyLmJlY2gzMi50b1dvcmRzKHI1KTtcbiAgcmV0dXJuIGltcG9ydF9iZWNoMzIuYmVjaDMyLmVuY29kZShvMiwgczMsIHQ1KTtcbn07XG5yNChlbmNvZGVCZWNoMzIpO1xudmFyIGpvaW5Ib29rZWRBZGRyZXNzID0gKGUyLCBvMiwgcjUgPSAxMDI0KSA9PiB7XG4gIGNvbnN0IHsgcHJlZml4OiBzMywgYnl0ZXM6IG4yIH0gPSBkZWNvZGVCZWNoMzIoZTIsIHI1KSwgZCA9IG4yLmxlbmd0aCwgYzIgPSBvMi5sZW5ndGgsIGEyID0gNjU1MzY7XG4gIGlmIChkID49IGEyKSB0aHJvdyBSYW5nZUVycm9yKGBCYXNlIGFkZHJlc3MgbGVuZ3RoIDB4JHtkLnRvU3RyaW5nKDE2KX0gZXhjZWVkcyBtYXhpbXVtIDB4JHthMi50b1N0cmluZygxNil9YCk7XG4gIGlmICghTnVtYmVyLmlzU2FmZUludGVnZXIoYzIpIHx8IGMyIDwgMCkgdGhyb3cgUmFuZ2VFcnJvcihgSG9vayBkYXRhIGxlbmd0aCAke2MyfSBpcyBub3QgYSBub24tbmVnYXRpdmUgaW50ZWdlcmApO1xuICBjb25zdCBpMiA9IHQ0Lmxlbmd0aCwgaCA9IG5ldyBVaW50OEFycmF5KGkyICsgZCArIGMyICsgMik7XG4gIGguc2V0KHQ0LCAwKSwgaFtpMiAtIDFdIHw9IDAsIGguc2V0KG4yLCBpMiksIGguc2V0KG8yLCBpMiArIGQpO1xuICBsZXQgZzMgPSBkO1xuICBmb3IgKGxldCBlMyA9IDA7IGUzIDwgMjsgZTMgKz0gMSkgaFtoLmxlbmd0aCAtIDEgLSBlM10gPSAyNTUgJiBnMywgZzMgPj4+PSA4O1xuICByZXR1cm4gZW5jb2RlQmVjaDMyKHMzLCBoLCByNSk7XG59O1xucjQoam9pbkhvb2tlZEFkZHJlc3MpO1xudmFyIGVuY29kZUFkZHJlc3NIb29rID0gKGUyLCByNSwgdDUpID0+IHtcbiAgY29uc3QgczMgPSBxdWVyeV9zdHJpbmdfZGVmYXVsdC5zdHJpbmdpZnkocjUpLCBuMiA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShgPyR7czN9YCk7XG4gIHJldHVybiBqb2luSG9va2VkQWRkcmVzcyhlMiwgbjIsIHQ1KTtcbn07XG5yNChlbmNvZGVBZGRyZXNzSG9vayk7XG52YXIgZGVjb2RlQWRkcmVzc0hvb2sgPSAoZTIsIHQ1KSA9PiB7XG4gIGNvbnN0IHsgYmFzZUFkZHJlc3M6IHMzLCBob29rRGF0YTogbjIgfSA9IHNwbGl0SG9va2VkQWRkcmVzcyhlMiwgdDUpLCBkID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKG4yKTtcbiAgaWYgKGQgJiYgIWQuc3RhcnRzV2l0aChcIj9cIikpIHRocm93IEVycm9yKGBIb29rIGRhdGEgZG9lcyBub3Qgc3RhcnQgd2l0aCAnPyc6ICR7ZH1gKTtcbiAgY29uc3QgYzIgPSBxdWVyeV9zdHJpbmdfZGVmYXVsdC5wYXJzZShkKSwgYTIgPSByNCh7IC4uLmMyIH0pO1xuICByZXR1cm4gcjQoeyBiYXNlQWRkcmVzczogczMsIHF1ZXJ5OiBhMiB9KTtcbn07XG5yNChkZWNvZGVBZGRyZXNzSG9vayk7XG52YXIgc3BsaXRIb29rZWRBZGRyZXNzID0gKGUyLCBvMiA9IDEwMjQpID0+IHtcbiAgY29uc3QgeyBwcmVmaXg6IHMzLCBieXRlczogbjIgfSA9IGRlY29kZUJlY2gzMihlMiwgbzIpLCBkID0gdDQubGVuZ3RoO1xuICBsZXQgYzIgPSAyNTU7XG4gIGZvciAobGV0IG8zID0gMDsgbzMgPCBkOyBvMyArPSAxKSB7XG4gICAgbGV0IHM0ID0gbjJbbzNdO1xuICAgIGlmIChvMyA9PT0gZCAtIDEgJiYgKGMyID0gMTUgJiBzNCwgczQgJj0gMjQwKSwgczQgIT09IHQ0W28zXSkgcmV0dXJuIHI0KHsgYmFzZUFkZHJlc3M6IGUyLCBob29rRGF0YTogbmV3IFVpbnQ4QXJyYXkoKSB9KTtcbiAgfVxuICBpZiAoMCAhPT0gYzIpIHRocm93IFR5cGVFcnJvcihgVW5zdXBwb3J0ZWQgYWRkcmVzcyBob29rIHZlcnNpb24gJHtjMn1gKTtcbiAgbGV0IGEyID0gMDtcbiAgZm9yIChsZXQgZTMgPSAxOyBlMyA+PSAwOyBlMyAtPSAxKSB7XG4gICAgY29uc3QgbzMgPSBuMi5hdCgtZTMgLSAxKTtcbiAgICBpZiAodm9pZCAwID09PSBvMykgdGhyb3cgVHlwZUVycm9yKGBDYW5ub3QgZ2V0IGJhc2UgYWRkcmVzcyBsZW5ndGggZnJvbSBieXRlICR7LWUzIC0gMX0gb2YgJHtuMi5sZW5ndGh9YCk7XG4gICAgYTIgPDw9IDgsIGEyIHw9IG8zO1xuICB9XG4gIGNvbnN0IGkyID0gYTI7XG4gIGlmIChpMiA+IG4yLmxlbmd0aCAtIDIgLSBkKSB0aHJvdyBUeXBlRXJyb3IoYEJhc2UgYWRkcmVzcyBsZW5ndGggMHgke2kyLnRvU3RyaW5nKDE2KX0gaXMgbG9uZ2VyIHRoYW4gc3BlY2ltZW4gbGVuZ3RoICR7bjIubGVuZ3RoIC0gMiAtIGR9YCk7XG4gIGNvbnN0IGggPSBuMi5zdWJhcnJheShkLCBkICsgaTIpLCBnMyA9IGVuY29kZUJlY2gzMihzMywgaCwgbzIpLCBsMyA9IG4yLnN1YmFycmF5KGQgKyBpMiwgLTIpO1xuICByZXR1cm4gcjQoeyBiYXNlQWRkcmVzczogZzMsIGhvb2tEYXRhOiBsMyB9KTtcbn07XG5yNChzcGxpdEhvb2tlZEFkZHJlc3MpO1xuXG4vL1xudmFyIHsgYWRkOiBhZGQzLCBpc0dURTogaXNHVEUyLCBzdWJ0cmFjdDogc3VidHJhY3QzLCBtYWtlRW1wdHkgfSA9IEFtb3VudE1hdGg7XG52YXIgZ2V0Q29uZmlnVmFsdWUgPSAoZmVlQ29uZmlnLCBrZXksIGRlc3RpbmF0aW9uKSA9PiB7XG4gIGNvbnN0IGNoYWluSWQgPSBjaGFpbk9mQWNjb3VudChkZXN0aW5hdGlvbik7XG4gIGlmIChmZWVDb25maWcuZGVzdGluYXRpb25PdmVycmlkZXM/LltjaGFpbklkXSAmJiBmZWVDb25maWcuZGVzdGluYXRpb25PdmVycmlkZXNbY2hhaW5JZF1ba2V5XSAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIGZlZUNvbmZpZy5kZXN0aW5hdGlvbk92ZXJyaWRlc1tjaGFpbklkXVtrZXldO1xuICB9XG4gIHJldHVybiBmZWVDb25maWdba2V5XTtcbn07XG52YXIgbWFrZUZlZVRvb2xzID0gKGZlZUNvbmZpZykgPT4ge1xuICBtdXN0TWF0Y2goZmVlQ29uZmlnLCBGZWVDb25maWdTaGFwZSwgXCJNdXN0IHByb3ZpZGUgZmVlQ29uZmlnXCIpO1xuICBjb25zdCBlbXB0eUFtb3VudCA9IG1ha2VFbXB0eShmZWVDb25maWcuZmxhdC5icmFuZCk7XG4gIGNvbnN0IGZlZVRvb2xzID0gaGFyZGVuKHtcbiAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgY2FsY3VsYXRlQmFzZUZlZShyZXF1ZXN0ZWQsIGRlc3RpbmF0aW9uKSB7XG4gICAgICBjb25zdCBmbGF0ID0gZ2V0Q29uZmlnVmFsdWUoZmVlQ29uZmlnLCBcImZsYXRcIiwgZGVzdGluYXRpb24pO1xuICAgICAgY29uc3QgdmFyaWFibGVSYXRlID0gZ2V0Q29uZmlnVmFsdWUoXG4gICAgICAgIGZlZUNvbmZpZyxcbiAgICAgICAgXCJ2YXJpYWJsZVJhdGVcIixcbiAgICAgICAgZGVzdGluYXRpb25cbiAgICAgICk7XG4gICAgICByZXR1cm4gYWRkMyhtdWx0aXBseUJ5KHJlcXVlc3RlZCwgdmFyaWFibGVSYXRlKSwgZmxhdCk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cbiAgICAgKi9cbiAgICBjYWxjdWxhdGVSZWxheUZlZShkZXN0aW5hdGlvbikge1xuICAgICAgY29uc3QgcmVsYXkgPSBnZXRDb25maWdWYWx1ZShmZWVDb25maWcsIFwicmVsYXlcIiwgZGVzdGluYXRpb24pO1xuICAgICAgcmV0dXJuIHJlbGF5IHx8IGVtcHR5QW1vdW50O1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG4gICAgICovXG4gICAgY2FsY3VsYXRlQWR2YW5jZUZlZShyZXF1ZXN0ZWQsIGRlc3RpbmF0aW9uKSB7XG4gICAgICBjb25zdCBiYXNlRmVlID0gZmVlVG9vbHMuY2FsY3VsYXRlQmFzZUZlZShyZXF1ZXN0ZWQsIGRlc3RpbmF0aW9uKTtcbiAgICAgIGNvbnN0IHJlbGF5RmVlID0gZmVlVG9vbHMuY2FsY3VsYXRlUmVsYXlGZWUoZGVzdGluYXRpb24pO1xuICAgICAgY29uc3QgZmVlID0gYWRkMyhiYXNlRmVlLCByZWxheUZlZSk7XG4gICAgICAhaXNHVEUyKGZlZSwgcmVxdWVzdGVkKSB8fCB0aHJvd1JlZGFjdGVkYFJlcXVlc3QgbXVzdCBleGNlZWQgZmVlcy5gO1xuICAgICAgcmV0dXJuIGZlZTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuICAgICAqL1xuICAgIGNhbGN1bGF0ZUFkdmFuY2UocmVxdWVzdGVkLCBkZXN0aW5hdGlvbikge1xuICAgICAgY29uc3QgZmVlID0gZmVlVG9vbHMuY2FsY3VsYXRlQWR2YW5jZUZlZShyZXF1ZXN0ZWQsIGRlc3RpbmF0aW9uKTtcbiAgICAgIHJldHVybiBzdWJ0cmFjdDMocmVxdWVzdGVkLCBmZWUpO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgY2FsY3VsYXRlU3BsaXQocmVxdWVzdGVkLCBkZXN0aW5hdGlvbikge1xuICAgICAgY29uc3QgYmFzZUZlZSA9IGZlZVRvb2xzLmNhbGN1bGF0ZUJhc2VGZWUocmVxdWVzdGVkLCBkZXN0aW5hdGlvbik7XG4gICAgICBjb25zdCByZWxheUZlZSA9IGZlZVRvb2xzLmNhbGN1bGF0ZVJlbGF5RmVlKGRlc3RpbmF0aW9uKTtcbiAgICAgIGNvbnN0IHRvdGFsRmVlID0gYWRkMyhiYXNlRmVlLCByZWxheUZlZSk7XG4gICAgICAhaXNHVEUyKHRvdGFsRmVlLCByZXF1ZXN0ZWQpIHx8IHRocm93UmVkYWN0ZWRgUmVxdWVzdCBtdXN0IGV4Y2VlZCBmZWVzLmA7XG4gICAgICBjb25zdCBjb250cmFjdFJhdGUgPSBnZXRDb25maWdWYWx1ZShcbiAgICAgICAgZmVlQ29uZmlnLFxuICAgICAgICBcImNvbnRyYWN0UmF0ZVwiLFxuICAgICAgICBkZXN0aW5hdGlvblxuICAgICAgKTtcbiAgICAgIGNvbnN0IFByaW5jaXBhbCA9IHN1YnRyYWN0MyhyZXF1ZXN0ZWQsIHRvdGFsRmVlKTtcbiAgICAgIGNvbnN0IENvbnRyYWN0RmVlID0gbXVsdGlwbHlCeShiYXNlRmVlLCBjb250cmFjdFJhdGUpO1xuICAgICAgY29uc3QgUG9vbEZlZSA9IHN1YnRyYWN0MyhiYXNlRmVlLCBDb250cmFjdEZlZSk7XG4gICAgICByZXR1cm4gaGFyZGVuKHsgUHJpbmNpcGFsLCBQb29sRmVlLCBDb250cmFjdEZlZSwgUmVsYXlGZWU6IHJlbGF5RmVlIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBmZWVUb29scztcbn07XG5cbi8vXG52YXIgbWFrZVN1cHBvcnRzQ2N0cCA9IChjaGFpbkh1YikgPT4gKGRlc3QpID0+IHtcbiAgY29uc3QgeyBuYW1lc3BhY2UsIHJlZmVyZW5jZSB9ID0gcGFyc2VBY2NvdW50SWQoZGVzdCk7XG4gIGlmIChuYW1lc3BhY2UgIT09IFwiZWlwMTU1XCIpIHJldHVybiBmYWxzZTtcbiAgdHJ5IHtcbiAgICBjb25zdCBjaSA9IGNoYWluSHViLmdldENoYWluSW5mb0J5Q2hhaW5JZChgJHtuYW1lc3BhY2V9OiR7cmVmZXJlbmNlfWApO1xuICAgIHJldHVybiB0eXBlb2YgY2kuY2N0cERlc3RpbmF0aW9uRG9tYWluID09PSBcIm51bWJlclwiO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cbi8vXG52YXIgRk9SV0FSRF9USU1FT1VUID0ge1xuICBzZWM6IDEwbiAqIDYwbixcbiAgcDogXCIxMG1cIlxufTtcbmhhcmRlbihGT1JXQVJEX1RJTUVPVVQpO1xudmFyIG1ha2VMb2NhbEFjY291bnQgPSBhc3luYyAob3JjaCkgPT4ge1xuICBjb25zdCBhZ29yaWNDaGFpbiA9IGF3YWl0IG9yY2guZ2V0Q2hhaW4oXCJhZ29yaWNcIik7XG4gIHJldHVybiBhZ29yaWNDaGFpbi5tYWtlQWNjb3VudCgpO1xufTtcbmhhcmRlbihtYWtlTG9jYWxBY2NvdW50KTtcbnZhciBtYWtlTm9ibGVBY2NvdW50ID0gYXN5bmMgKG9yY2gpID0+IHtcbiAgY29uc3Qgbm9ibGVDaGFpbiA9IGF3YWl0IG9yY2guZ2V0Q2hhaW4oXCJub2JsZVwiKTtcbiAgcmV0dXJuIG5vYmxlQ2hhaW4ubWFrZUFjY291bnQoKTtcbn07XG5oYXJkZW4obWFrZU5vYmxlQWNjb3VudCk7XG52YXIgZm9yd2FyZEZ1bmRzID0gYXN5bmMgKG9yY2gsIHtcbiAgY3VycmVudENoYWluUmVmZXJlbmNlLFxuICBzdXBwb3J0c0NjdHAsXG4gIGxvZyxcbiAgZ2V0Tm9ibGVJQ0EsXG4gIHNldHRsZW1lbnRBY2NvdW50LFxuICBzdGF0dXNNYW5hZ2VyXG59LCB0eCkgPT4ge1xuICBhd2FpdCBudWxsO1xuICBhc3NlcnRBbGxEZWZpbmVkKHtcbiAgICBjdXJyZW50Q2hhaW5SZWZlcmVuY2UsXG4gICAgc3VwcG9ydHNDY3RwLFxuICAgIGxvZyxcbiAgICBnZXROb2JsZUlDQSxcbiAgICBzZXR0bGVtZW50QWNjb3VudCxcbiAgICBzdGF0dXNNYW5hZ2VyLFxuICAgIHR4XG4gIH0pO1xuICBjb25zdCB7IGFtb3VudCwgZGVzdGluYXRpb24sIHR4SGFzaCB9ID0gdHg7XG4gIGxvZyhcInRyeWluZyBmb3J3YXJkIGZvclwiLCBhbW91bnQsIFwidG9cIiwgZGVzdGluYXRpb24sIFwiZm9yXCIsIHR4SGFzaCk7XG4gIGNvbnN0IHsgbmFtZXNwYWNlLCByZWZlcmVuY2UgfSA9IHBhcnNlQWNjb3VudElkKGRlc3RpbmF0aW9uKTtcbiAgY29uc3Qgc2V0dGxlbWVudCA9IGF3YWl0IHNldHRsZW1lbnRBY2NvdW50O1xuICBjb25zdCBpbnRlcm1lZGlhdGVSZWNpcGllbnQgPSBnZXROb2JsZUlDQSgpLmdldEFkZHJlc3MoKTtcbiAgaWYgKG5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIikge1xuICAgIGNvbnN0IGNvbXBsZXRpb24gPSByZWZlcmVuY2UgPT09IGN1cnJlbnRDaGFpblJlZmVyZW5jZSA/IHNldHRsZW1lbnQuc2VuZChkZXN0aW5hdGlvbiwgYW1vdW50KSA6IHNldHRsZW1lbnQudHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwge1xuICAgICAgdGltZW91dFJlbGF0aXZlU2Vjb25kczogRk9SV0FSRF9USU1FT1VULnNlYyxcbiAgICAgIGZvcndhcmRPcHRzOiB7XG4gICAgICAgIGludGVybWVkaWF0ZVJlY2lwaWVudCxcbiAgICAgICAgdGltZW91dDogRk9SV0FSRF9USU1FT1VULnBcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0cnkge1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkaW5nKHR4SGFzaCk7XG4gICAgICBhd2FpdCBjb21wbGV0aW9uO1xuICAgICAgbG9nKFwiZm9yd2FyZCBzdWNjZXNzZnVsIGZvclwiLCB0eEhhc2gpO1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkZWQodHhIYXNoLCB7XG4gICAgICAgIHR4SGFzaCxcbiAgICAgICAgZGVzdGluYXRpb24sXG4gICAgICAgIGFtb3VudDogYW1vdW50LnZhbHVlXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChyZWFzb24pIHtcbiAgICAgIGxvZyhcIlxcdTI2QTBcXHVGRTBGIGZvcndhcmQgdHJhbnNmZXIgcmVqZWN0ZWRcIiwgcmVhc29uLCB0eEhhc2gpO1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkRmFpbGVkKHR4SGFzaCwge1xuICAgICAgICB0eEhhc2gsXG4gICAgICAgIGRlc3RpbmF0aW9uLFxuICAgICAgICBhbW91bnQ6IGFtb3VudC52YWx1ZVxuICAgICAgfSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKHN1cHBvcnRzQ2N0cChkZXN0aW5hdGlvbikpIHtcbiAgICB0cnkge1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkaW5nKHR4SGFzaCk7XG4gICAgICBhd2FpdCBzZXR0bGVtZW50LnRyYW5zZmVyKGludGVybWVkaWF0ZVJlY2lwaWVudCwgYW1vdW50LCB7XG4gICAgICAgIHRpbWVvdXRSZWxhdGl2ZVNlY29uZHM6IEZPUldBUkRfVElNRU9VVC5zZWNcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKHJlYXNvbikge1xuICAgICAgbG9nKFwiXFx1MjZBMFxcdUZFMEYgZm9yd2FyZCBpbnRlcm1lZGlhdGUgdHJhbnNmZXIgcmVqZWN0ZWRcIiwgcmVhc29uLCB0eEhhc2gpO1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkRmFpbGVkKHR4SGFzaCwge1xuICAgICAgICB0eEhhc2gsXG4gICAgICAgIGRlc3RpbmF0aW9uLFxuICAgICAgICBhbW91bnQ6IGFtb3VudC52YWx1ZVxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGJ1cm5BbW91bnQgPSB7IGRlbm9tOiBcInV1c2RjXCIsIHZhbHVlOiBhbW91bnQudmFsdWUgfTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZ2V0Tm9ibGVJQ0EoKS5kZXBvc2l0Rm9yQnVybihkZXN0aW5hdGlvbiwgYnVybkFtb3VudCk7XG4gICAgICBsb2coXCJmb3J3YXJkIHRyYW5zZmVyIGFuZCBkZXBvc2l0Rm9yQnVybiBzdWNjZXNzZnVsIGZvclwiLCB0eEhhc2gpO1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkZWQodHgudHhIYXNoKTtcbiAgICB9IGNhdGNoIChyZWFzb24pIHtcbiAgICAgIGxvZyhcIlxcdTI2QTBcXHVGRTBGIGZvcndhcmQgZGVwb3NpdEZvckJ1cm4gcmVqZWN0ZWRcIiwgcmVhc29uLCB0eEhhc2gpO1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkRmFpbGVkKHR4SGFzaCwge1xuICAgICAgICB0eEhhc2gsXG4gICAgICAgIGRlc3RpbmF0aW9uLFxuICAgICAgICBhbW91bnQ6IGFtb3VudC52YWx1ZSxcbiAgICAgICAgZnVuZHNJbk5vYmxlSWNhOiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbG9nKFxuICAgICAgXCJcXHUyNkEwXFx1RkUwRiBmb3J3YXJkIG5vdCBhdHRlbXB0ZWRcIixcbiAgICAgIFwidW5zdXBwb3J0ZWQgZGVzdGluYXRpb25cIixcbiAgICAgIHR4SGFzaCxcbiAgICAgIGRlc3RpbmF0aW9uXG4gICAgKTtcbiAgICBzdGF0dXNNYW5hZ2VyLmZvcndhcmRTa2lwcGVkKHR4SGFzaCk7XG4gIH1cbn07XG5oYXJkZW4oZm9yd2FyZEZ1bmRzKTtcbnZhciBhZHZhbmNlRnVuZHMgPSBhc3luYyAob3JjaCwge1xuICBjaGFpbkh1YlRvb2xzLFxuICBmZWVDb25maWcsXG4gIGdldE5vYmxlSUNBLFxuICBsb2csXG4gIHN0YXR1c01hbmFnZXIsXG4gIHVzZGMsXG4gIHpjZlRvb2xzLFxuICB6b2VUb29sczogeyBsb2NhbFRyYW5zZmVyLCB3aXRoZHJhd1RvU2VhdCB9XG59LCB7IGV2aWRlbmNlLCByaXNrIH0sIGNvbmZpZykgPT4ge1xuICBjb25zdCBmZWVUb29scyA9IG1ha2VGZWVUb29scyhmZWVDb25maWcpO1xuICBjb25zdCB0b0Ftb3VudCA9ICh2YWx1ZSkgPT4gQW1vdW50TWF0aC5tYWtlKHVzZGMuYnJhbmQsIHZhbHVlKTtcbiAgY29uc3Qgc3VwcG9ydHNDY3RwID0gbWFrZVN1cHBvcnRzQ2N0cChjaGFpbkh1YlRvb2xzKTtcbiAgYXdhaXQgbnVsbDtcbiAgdHJ5IHtcbiAgICBsZXQgZGVwb3NpdFJlamVjdGVkID0gZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgIGxvZyhcbiAgICAgICAgXCJcXHUyNkEwXFx1RkUwRiBkZXBvc2l0IHRvIGxvY2FsT3JjaEFjY291bnQgZmFpbGVkLCBhdHRlbXB0aW5nIHRvIHJldHVybiBwYXltZW50IHRvIExQXCIsXG4gICAgICAgIGVycm9yXG4gICAgICApO1xuICAgICAgdHJ5IHtcbiAgICAgICAgbm90aWZpZXIubm90aWZ5QWR2YW5jaW5nUmVzdWx0KGRldGFpbCwgZmFsc2UpO1xuICAgICAgICBib3Jyb3dlci5yZXR1cm5Ub1Bvb2wodG1wU2VhdCwgYWR2YW5jZUFtb3VudCk7XG4gICAgICAgIHRtcFNlYXQuZXhpdCgpO1xuICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgbG9nKFwiXFx1ezFGNkE4fSBkZXBvc2l0IHRvIGxvY2FsT3JjaEFjY291bnQgZmFpbHVyZSByZWNvdmVyeSBmYWlsZWRcIiwgZTIpO1xuICAgICAgfVxuICAgIH0sIHdpdGhkcmF3UmVqZWN0ZWQgPSBmdW5jdGlvbihlcnJvciwgdG1wUmV0dXJuU2VhdCkge1xuICAgICAgbG9nKFxuICAgICAgICBgXFx1ezFGNkE4fSB3aXRoZHJhdyAke3F1b3RlKGFkdmFuY2VBbW91bnQpfSBmcm9tIFwicG9vbEFjY291bnRcIiB0byByZXR1cm4gdG8gcG9vbCBmYWlsZWRgLFxuICAgICAgICBlcnJvclxuICAgICAgKTtcbiAgICAgIHRtcFJldHVyblNlYXQuZXhpdCgpO1xuICAgIH07XG4gICAgaWYgKHN0YXR1c01hbmFnZXIuaGFzQmVlbk9ic2VydmVkKGV2aWRlbmNlKSkge1xuICAgICAgbG9nKFwidHhIYXNoIGFscmVhZHkgc2VlbjpcIiwgZXZpZGVuY2UudHhIYXNoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHJpc2sucmlza3NJZGVudGlmaWVkPy5sZW5ndGgpIHtcbiAgICAgIGxvZyhcInJpc2tzIGlkZW50aWZpZWQsIHNraXBwaW5nIGFkdmFuY2VcIik7XG4gICAgICBzdGF0dXNNYW5hZ2VyLnNraXBBZHZhbmNlKGV2aWRlbmNlLCByaXNrLnJpc2tzSWRlbnRpZmllZCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHsgc2V0dGxlbWVudEFkZHJlc3MgfSA9IGNvbmZpZztcbiAgICBjb25zdCB7IEVVRCB9ID0gKCgpID0+IHtcbiAgICAgIGNvbnN0IHsgcmVjaXBpZW50QWRkcmVzcyB9ID0gZXZpZGVuY2UuYXV4O1xuICAgICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZUFkZHJlc3NIb29rKHJlY2lwaWVudEFkZHJlc3MpO1xuICAgICAgbXVzdE1hdGNoMyhkZWNvZGVkLCBBZGRyZXNzSG9va1NoYXBlKTtcbiAgICAgIGlmIChkZWNvZGVkLmJhc2VBZGRyZXNzICE9PSBzZXR0bGVtZW50QWRkcmVzcy52YWx1ZSkge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYOKaoO+4jyBiYXNlQWRkcmVzcyBvZiBhZGRyZXNzIGhvb2sgJHtxdW90ZShkZWNvZGVkLmJhc2VBZGRyZXNzKX0gZG9lcyBub3QgbWF0Y2ggdGhlIGV4cGVjdGVkIGFkZHJlc3MgJHtxdW90ZShzZXR0bGVtZW50QWRkcmVzcy52YWx1ZSl9YDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkZWNvZGVkLnF1ZXJ5O1xuICAgIH0pKCk7XG4gICAgbG9nKGBkZWNvZGVkIEVVRDogJHtFVUR9YCk7XG4gICAgY29uc3QgZGVzdGluYXRpb24gPSBjaGFpbkh1YlRvb2xzLnJlc29sdmVBY2NvdW50SWQoRVVEKTtcbiAgICBjb25zdCBhY2NvdW50SWQgPSBwYXJzZUFjY291bnRJZChkZXN0aW5hdGlvbik7XG4gICAgaWYgKCEoYWNjb3VudElkLm5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIiB8fCBzdXBwb3J0c0NjdHAoZGVzdGluYXRpb24pKSkge1xuICAgICAgY29uc3QgZGVzdENoYWluID0gY2hhaW5PZkFjY291bnQoZGVzdGluYXRpb24pO1xuICAgICAgc3RhdHVzTWFuYWdlci5za2lwQWR2YW5jZShldmlkZW5jZSwgW1xuICAgICAgICBgVHJhbnNmZXIgdG8gJHtkZXN0Q2hhaW59IG5vdCBzdXBwb3J0ZWQuYFxuICAgICAgXSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGZ1bGxBbW91bnQgPSB0b0Ftb3VudChldmlkZW5jZS50eC5hbW91bnQpO1xuICAgIGNvbnN0IHsgYm9ycm93ZXIsIG5vdGlmaWVyLCBwb29sQWNjb3VudCB9ID0gY29uZmlnO1xuICAgIGNvbnN0IG1pbnRlZEVhcmx5ID0gbm90aWZpZXIuY2hlY2tNaW50ZWRFYXJseShldmlkZW5jZSwgZGVzdGluYXRpb24pO1xuICAgIGlmIChtaW50ZWRFYXJseSkgcmV0dXJuO1xuICAgIGNvbnN0IGFkdmFuY2VBbW91bnQgPSBmZWVUb29scy5jYWxjdWxhdGVBZHZhbmNlKGZ1bGxBbW91bnQsIGRlc3RpbmF0aW9uKTtcbiAgICBjb25zdCBhbW91bnQgPSBoYXJkZW4oeyBkZW5vbTogdXNkYy5kZW5vbSwgdmFsdWU6IGFkdmFuY2VBbW91bnQudmFsdWUgfSk7XG4gICAgY29uc3QgdG1wU2VhdCA9IHpjZlRvb2xzLm1ha2VFbXB0eVpDRlNlYXQoKTtcbiAgICBib3Jyb3dlci5ib3Jyb3codG1wU2VhdCwgYWR2YW5jZUFtb3VudCk7XG4gICAgc3RhdHVzTWFuYWdlci5hZHZhbmNlKGV2aWRlbmNlKTtcbiAgICBjb25zdCBkZXRhaWwgPSB7XG4gICAgICB0eEhhc2g6IGV2aWRlbmNlLnR4SGFzaCxcbiAgICAgIGZvcndhcmRpbmdBZGRyZXNzOiBldmlkZW5jZS50eC5mb3J3YXJkaW5nQWRkcmVzcyxcbiAgICAgIGZ1bGxBbW91bnQsXG4gICAgICBkZXN0aW5hdGlvblxuICAgIH07XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGxvY2FsVHJhbnNmZXIoXG4gICAgICAgIHRtcFNlYXQsXG4gICAgICAgIHBvb2xBY2NvdW50LFxuICAgICAgICBoYXJkZW4oeyBVU0RDOiBhZHZhbmNlQW1vdW50IH0pXG4gICAgICApO1xuICAgICAgdG1wU2VhdC5leGl0KCk7XG4gICAgICBjb25zdCBpbnRlcm1lZGlhdGVSZWNpcGllbnQgPSBnZXROb2JsZUlDQSgpLmdldEFkZHJlc3MoKTtcbiAgICAgIGNvbnN0IGRlc3RJbmZvID0gcGFyc2VBY2NvdW50SWRBcmcoZGVzdGluYXRpb24pO1xuICAgICAgaWYgKGRlc3RJbmZvLm5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IChkZXN0SW5mby5yZWZlcmVuY2UgPT09IHNldHRsZW1lbnRBZGRyZXNzLmNoYWluSWQgPyAoXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgcG9vbEFjY291bnQuc2VuZChkZXN0aW5hdGlvbiwgYW1vdW50KVxuICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgcG9vbEFjY291bnQudHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwge1xuICAgICAgICAgICAgICBmb3J3YXJkT3B0czoge1xuICAgICAgICAgICAgICAgIGludGVybWVkaWF0ZVJlY2lwaWVudFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICkpO1xuICAgICAgICAgIGxvZyhcIkFkdmFuY2Ugc3VjY2VlZGVkXCIsIHsgYWR2YW5jZUFtb3VudCwgZGVzdGluYXRpb24gfSk7XG4gICAgICAgICAgbm90aWZpZXIubm90aWZ5QWR2YW5jaW5nUmVzdWx0KGRldGFpbCwgdHJ1ZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgYXdhaXQgdHJhbnNmZXJSZWplY3RlZChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydHNDY3RwKGRlc3RpbmF0aW9uKSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHBvb2xBY2NvdW50LnRyYW5zZmVyKGludGVybWVkaWF0ZVJlY2lwaWVudCwgYW1vdW50KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gdHJhbnNmZXJSZWplY3RlZChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW50ZXJtZWRpYXJ5QWNjb3VudCA9IGdldE5vYmxlSUNBKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgaW50ZXJtZWRpYXJ5QWNjb3VudC5kZXBvc2l0Rm9yQnVybihkZXN0aW5hdGlvbiwgYW1vdW50KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gY2N0cEZyb21Ob2JsZVJlamVjdGVkKGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBsb2coXCJBZHZhbmNlIHN1Y2NlZWRlZFwiLCB7IGFkdmFuY2VBbW91bnQsIGRlc3RpbmF0aW9uIH0pO1xuICAgICAgICBub3RpZmllci5ub3RpZnlBZHZhbmNpbmdSZXN1bHQoZGV0YWlsLCB0cnVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93UmVkYWN0ZWRg8J+aqCBjYW4gb25seSB0cmFuc2ZlciB0byBBZ29yaWMgYWRkcmVzc2VzLCB2aWEgSUJDLCBvciB2aWEgQ0NUUGA7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGRlcG9zaXRSZWplY3RlZChlcnJvcik7XG4gICAgfVxuICAgIGFzeW5jIGZ1bmN0aW9uIHJlcGF5UG9vbCgpIHtcbiAgICAgIGNvbnN0IHRtcFJldHVyblNlYXQgPSB6Y2ZUb29scy5tYWtlRW1wdHlaQ0ZTZWF0KCk7XG4gICAgICBhd2FpdCBudWxsO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgd2l0aGRyYXdUb1NlYXQoXG4gICAgICAgICAgcG9vbEFjY291bnQsXG4gICAgICAgICAgdG1wUmV0dXJuU2VhdCxcbiAgICAgICAgICBoYXJkZW4oeyBVU0RDOiBhZHZhbmNlQW1vdW50IH0pXG4gICAgICAgICk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYm9ycm93ZXIucmV0dXJuVG9Qb29sKHRtcFJldHVyblNlYXQsIGFkdmFuY2VBbW91bnQpO1xuICAgICAgICB9IGNhdGNoIChlMikge1xuICAgICAgICAgIGxvZyhcbiAgICAgICAgICAgIGBcXHV7MUY2QTh9IHJldHVybiAke3F1b3RlKGFkdmFuY2VBbW91bnQpfSB0byBwb29sIGZhaWxlZC4gZnVuZHMgcmVtYWluIG9uIFwidG1wUmV0dXJuU2VhdFwiYCxcbiAgICAgICAgICAgIGUyXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgd2l0aGRyYXdSZWplY3RlZChlcnJvciwgdG1wUmV0dXJuU2VhdCk7XG4gICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGZ1bmN0aW9uIHRyYW5zZmVyUmVqZWN0ZWQocmVhc29uKSB7XG4gICAgICBsb2coXCJBZHZhbmNlIGZhaWxlZFwiLCByZWFzb24pO1xuICAgICAgbm90aWZpZXIubm90aWZ5QWR2YW5jaW5nUmVzdWx0KGRldGFpbCwgZmFsc2UpO1xuICAgICAgcmV0dXJuIHJlcGF5UG9vbCgpO1xuICAgIH1cbiAgICBhc3luYyBmdW5jdGlvbiBjY3RwRnJvbU5vYmxlUmVqZWN0ZWQocmVhc29uKSB7XG4gICAgICBsb2coXCJcXHUyNkEwXFx1RkUwRiBDQ1RQIHRyYW5zZmVyIGZhaWxlZFwiLCByZWFzb24pO1xuICAgICAgbm90aWZpZXIubm90aWZ5QWR2YW5jaW5nUmVzdWx0KGRldGFpbCwgZmFsc2UpO1xuICAgICAgYXdhaXQgbnVsbDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGdldE5vYmxlSUNBKCkudHJhbnNmZXIocG9vbEFjY291bnQuZ2V0QWRkcmVzcygpLCBhbW91bnQpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nKFwiXFx1ezFGNkE4fSBmYWlsZWQgdG8gdHJhbnNmZXIgYmFjayBmcm9tIG5vYmxlIElDQVwiLCBhbW91bnQudmFsdWUsIGVycm9yKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXBheVBvb2woKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nKFwiQWR2YW5jZXIgZXJyb3I6XCIsIGVycm9yKTtcbiAgICBzdGF0dXNNYW5hZ2VyLnNraXBBZHZhbmNlKGV2aWRlbmNlLCBbZXJyb3IubWVzc2FnZV0pO1xuICB9XG59O1xuaGFyZGVuKGFkdmFuY2VGdW5kcyk7XG5cbi8vXG52YXIgQWR2YW5jZXJWb3dDdHhTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBmdWxsQW1vdW50OiBBbnlOYXRBbW91bnRTaGFwZSxcbiAgICBhZHZhbmNlQW1vdW50OiBBbnlOYXRBbW91bnRTaGFwZSxcbiAgICBkZXN0aW5hdGlvbjogQWNjb3VudElkQXJnU2hhcGUsXG4gICAgLy9cbiAgICBmb3J3YXJkaW5nQWRkcmVzczogTS5zdHJpbmcoKSxcbiAgICB0eEhhc2g6IEV2bUhhc2hTaGFwZVxuICB9LFxuICB7IHRtcFNlYXQ6IE0ucmVtb3RhYmxlKCkgfVxuKTtcbnZhciBBZHZhbmNlcktpdEkgPSBoYXJkZW4oe1xuICBhZHZhbmNlcjogTS5pbnRlcmZhY2UoXCJBZHZhbmNlcklcIiwge1xuICAgIGhhbmRsZVRyYW5zYWN0aW9uRXZlbnQ6IE0uY2FsbChFdmlkZW5jZVdpdGhSaXNrU2hhcGUpLnJldHVybnMoKVxuICB9KSxcbiAgZGVwb3NpdEhhbmRsZXI6IE0uaW50ZXJmYWNlKFwiRGVwb3NpdEhhbmRsZXJJXCIsIHtcbiAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0udW5kZWZpbmVkKCksIEFkdmFuY2VyVm93Q3R4U2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIEFkdmFuY2VyVm93Q3R4U2hhcGUpLnJldHVybnMoKVxuICB9KSxcbiAgdHJhbnNmZXJIYW5kbGVyOiBNLmludGVyZmFjZShcIlRyYW5zZmVySGFuZGxlcklcIiwge1xuICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS51bmRlZmluZWQoKSwgQWR2YW5jZXJWb3dDdHhTaGFwZSkucmV0dXJucyhcbiAgICAgIE0udW5kZWZpbmVkKClcbiAgICApLFxuICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIEFkdmFuY2VyVm93Q3R4U2hhcGUpLnJldHVybnMoTS51bmRlZmluZWQoKSlcbiAgfSksXG4gIHRyYW5zZmVyQ2N0cEhhbmRsZXI6IE0uaW50ZXJmYWNlKFwiVHJhbnNmZXJIYW5kbGVySVwiLCB7XG4gICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnVuZGVmaW5lZCgpLCBBZHZhbmNlclZvd0N0eFNoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5lcnJvcigpLCBBZHZhbmNlclZvd0N0eFNoYXBlKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpXG4gIH0pLFxuICB3aXRoZHJhd0hhbmRsZXI6IE0uaW50ZXJmYWNlKFwiV2l0aGRyYXdIYW5kbGVySVwiLCB7XG4gICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnVuZGVmaW5lZCgpLCB7XG4gICAgICBhZHZhbmNlQW1vdW50OiBBbnlOYXRBbW91bnRTaGFwZSxcbiAgICAgIHRtcFJldHVyblNlYXQ6IE0ucmVtb3RhYmxlKClcbiAgICB9KS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpLFxuICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIHtcbiAgICAgIGFkdmFuY2VBbW91bnQ6IEFueU5hdEFtb3VudFNoYXBlLFxuICAgICAgdG1wUmV0dXJuU2VhdDogTS5yZW1vdGFibGUoKVxuICAgIH0pLnJldHVybnMoTS51bmRlZmluZWQoKSlcbiAgfSlcbn0pO1xudmFyIHN0YXRlU2hhcGUgPSBoYXJkZW4oe1xuICBub3RpZmllcjogTS5yZW1vdGFibGUoKSxcbiAgYm9ycm93ZXI6IE0ucmVtb3RhYmxlKCksXG4gIHBvb2xBY2NvdW50OiBNLnJlbW90YWJsZSgpLFxuICAvKiAgICAgICAgICAgICAgKi9cbiAgaW50ZXJtZWRpYXRlUmVjaXBpZW50OiBNLm9wdChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSksXG4gIHNldHRsZW1lbnRBZGRyZXNzOiBNLm9wdChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSlcbn0pO1xudmFyIHByZXBhcmVBZHZhbmNlcktpdCA9ICh6b25lLCB7XG4gIGFkdmFuY2VGdW5kczogYWR2YW5jZUZ1bmRzMixcbiAgY2hhaW5IdWIsXG4gIGdldE5vYmxlSUNBLFxuICBsb2cgPSBtYWtlVHJhY2VyKFwiQWR2YW5jZXJcIiwgdHJ1ZSksXG4gIHN0YXR1c01hbmFnZXIsXG4gIHVzZGMsXG4gIHZvd1Rvb2xzOiB7IGFzVm93LCB3YXRjaCB9LFxuICB6Y2YsXG4gIHpvZVRvb2xzOiB7IHdpdGhkcmF3VG9TZWF0IH1cbn0pID0+IHtcbiAgYXNzZXJ0QWxsRGVmaW5lZCh7XG4gICAgY2hhaW5IdWIsXG4gICAgc3RhdHVzTWFuYWdlcixcbiAgICB3YXRjaFxuICB9KTtcbiAgY29uc3Qgc3VwcG9ydHNDY3RwID0gbWFrZVN1cHBvcnRzQ2N0cChjaGFpbkh1Yik7XG4gIHJldHVybiB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiRmFzdCBVU0RDIEFkdmFuY2VyXCIsXG4gICAgQWR2YW5jZXJLaXRJLFxuICAgIChjb25maWcpID0+IGhhcmRlbih7XG4gICAgICAuLi5jb25maWcsXG4gICAgICAvL1xuICAgICAgaW50ZXJtZWRpYXRlUmVjaXBpZW50OiB2b2lkIDBcbiAgICB9KSxcbiAgICB7XG4gICAgICBhZHZhbmNlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGhhbmRsZVRyYW5zYWN0aW9uRXZlbnQoeyBldmlkZW5jZSwgcmlzayB9KSB7XG4gICAgICAgICAgY29uc3QgeyBub3RpZmllciwgYm9ycm93ZXIsIHBvb2xBY2NvdW50LCBzZXR0bGVtZW50QWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB2b2lkIGFkdmFuY2VGdW5kczIoXG4gICAgICAgICAgICBoYXJkZW4oeyBldmlkZW5jZSwgcmlzayB9KSxcbiAgICAgICAgICAgIGhhcmRlbih7XG4gICAgICAgICAgICAgIG5vdGlmaWVyLFxuICAgICAgICAgICAgICBib3Jyb3dlcixcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgcG9vbEFjY291bnQsXG4gICAgICAgICAgICAgIHNldHRsZW1lbnRBZGRyZXNzXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICBkZXBvc2l0SGFuZGxlcjoge1xuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0LCBjdHgpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBwb29sQWNjb3VudCwgc2V0dGxlbWVudEFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IHRtcFNlYXQsIC4uLnZvd0NvbnRleHQgfSA9IGN0eDtcbiAgICAgICAgICAgIGNvbnN0IHsgYWR2YW5jZUFtb3VudCB9ID0gdm93Q29udGV4dDtcbiAgICAgICAgICAgIHRtcFNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgY29uc3QgYW1vdW50ID0gaGFyZGVuKHtcbiAgICAgICAgICAgICAgZGVub206IHVzZGMuZGVub20sXG4gICAgICAgICAgICAgIHZhbHVlOiBhZHZhbmNlQW1vdW50LnZhbHVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gY29lcmNlQWNjb3VudElkKHZvd0NvbnRleHQuZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgY29uc3QgaW50ZXJtZWRpYXRlUmVjaXBpZW50ID0gZ2V0Tm9ibGVJQ0EoKS5nZXRBZGRyZXNzKCk7XG4gICAgICAgICAgICBjb25zdCBkZXN0SW5mbyA9IHBhcnNlQWNjb3VudElkQXJnKGRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIGlmIChkZXN0SW5mby5uYW1lc3BhY2UgPT09IFwiY29zbW9zXCIpIHtcbiAgICAgICAgICAgICAgY29uc3Qgdm93ID0gZGVzdEluZm8ucmVmZXJlbmNlID09PSBzZXR0bGVtZW50QWRkcmVzcy5jaGFpbklkID8gKFxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgRShwb29sQWNjb3VudCkuc2VuZChkZXN0aW5hdGlvbiwgYW1vdW50KVxuICAgICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgRShwb29sQWNjb3VudCkudHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwge1xuICAgICAgICAgICAgICAgICAgZm9yd2FyZE9wdHM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJtZWRpYXRlUmVjaXBpZW50XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHZvdywgdGhpcy5mYWNldHMudHJhbnNmZXJIYW5kbGVyLCB2b3dDb250ZXh0KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydHNDY3RwKGRlc3RpbmF0aW9uKSkge1xuICAgICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgICAgRShwb29sQWNjb3VudCkudHJhbnNmZXIoaW50ZXJtZWRpYXRlUmVjaXBpZW50LCBhbW91bnQpLFxuICAgICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnRyYW5zZmVyQ2N0cEhhbmRsZXIsXG4gICAgICAgICAgICAgICAgdm93Q29udGV4dFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhyb3dSZWRhY3RlZGDwn5qoIGNhbiBvbmx5IHRyYW5zZmVyIHRvIEFnb3JpYyBhZGRyZXNzZXMsIHZpYSBJQkMsIG9yIHZpYSBDQ1RQYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25SZWplY3RlZChlcnJvciwge1xuICAgICAgICAgIHRtcFNlYXQsXG4gICAgICAgICAgYWR2YW5jZUFtb3VudCxcbiAgICAgICAgICAuLi5yZXN0Q3R4XG4gICAgICAgIH0pIHtcbiAgICAgICAgICBsb2coXG4gICAgICAgICAgICBcIlxcdTI2QTBcXHVGRTBGIGRlcG9zaXQgdG8gbG9jYWxPcmNoQWNjb3VudCBmYWlsZWQsIGF0dGVtcHRpbmcgdG8gcmV0dXJuIHBheW1lbnQgdG8gTFBcIixcbiAgICAgICAgICAgIGVycm9yXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgeyBib3Jyb3dlciwgbm90aWZpZXIgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBub3RpZmllci5ub3RpZnlBZHZhbmNpbmdSZXN1bHQocmVzdEN0eCwgZmFsc2UpO1xuICAgICAgICAgICAgYm9ycm93ZXIucmV0dXJuVG9Qb29sKHRtcFNlYXQsIGFkdmFuY2VBbW91bnQpO1xuICAgICAgICAgICAgdG1wU2VhdC5leGl0KCk7XG4gICAgICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgICAgIGxvZyhcIlxcdXsxRjZBOH0gZGVwb3NpdCB0byBsb2NhbE9yY2hBY2NvdW50IGZhaWx1cmUgcmVjb3ZlcnkgZmFpbGVkXCIsIGUyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0cmFuc2ZlckhhbmRsZXI6IHtcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCwgY3R4KSB7XG4gICAgICAgICAgY29uc3QgeyBub3RpZmllciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IGFkdmFuY2VBbW91bnQsIGRlc3RpbmF0aW9uLCAuLi5kZXRhaWwgfSA9IGN0eDtcbiAgICAgICAgICBsb2coXCJBZHZhbmNlIHN1Y2NlZWRlZFwiLCB7IGFkdmFuY2VBbW91bnQsIGRlc3RpbmF0aW9uIH0pO1xuICAgICAgICAgIG5vdGlmaWVyLm5vdGlmeUFkdmFuY2luZ1Jlc3VsdCh7IGRlc3RpbmF0aW9uLCAuLi5kZXRhaWwgfSwgdHJ1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQoZXJyb3IsIGN0eCkge1xuICAgICAgICAgIGNvbnN0IHsgbm90aWZpZXIsIHBvb2xBY2NvdW50IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGxvZyhcIkFkdmFuY2UgZmFpbGVkXCIsIGVycm9yKTtcbiAgICAgICAgICBjb25zdCB7IGFkdmFuY2VBbW91bnQsIC4uLnJlc3RDdHggfSA9IGN0eDtcbiAgICAgICAgICBub3RpZmllci5ub3RpZnlBZHZhbmNpbmdSZXN1bHQocmVzdEN0eCwgZmFsc2UpO1xuICAgICAgICAgIGNvbnN0IHsgemNmU2VhdDogdG1wUmV0dXJuU2VhdCB9ID0gemNmLm1ha2VFbXB0eVNlYXRLaXQoKTtcbiAgICAgICAgICBjb25zdCB3aXRoZHJhd1YgPSB3aXRoZHJhd1RvU2VhdChcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBwb29sQWNjb3VudCxcbiAgICAgICAgICAgIHRtcFJldHVyblNlYXQsXG4gICAgICAgICAgICBoYXJkZW4oeyBVU0RDOiBhZHZhbmNlQW1vdW50IH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgICB2b2lkIHdhdGNoKHdpdGhkcmF3ViwgdGhpcy5mYWNldHMud2l0aGRyYXdIYW5kbGVyLCB7XG4gICAgICAgICAgICBhZHZhbmNlQW1vdW50LFxuICAgICAgICAgICAgdG1wUmV0dXJuU2VhdFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdHJhbnNmZXJDY3RwSGFuZGxlcjoge1xuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0LCBjdHgpIHtcbiAgICAgICAgICBjb25zdCB7IGFkdmFuY2VBbW91bnQgfSA9IGN0eDtcbiAgICAgICAgICBjb25zdCBpbnRlcm1lZGlhcnlBY2NvdW50ID0gZ2V0Tm9ibGVJQ0EoKTtcbiAgICAgICAgICBjb25zdCBhbW91bnQgPSBoYXJkZW4oe1xuICAgICAgICAgICAgZGVub206IHVzZGMuZGVub20sXG4gICAgICAgICAgICB2YWx1ZTogYWR2YW5jZUFtb3VudC52YWx1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gY29lcmNlQWNjb3VudElkKGN0eC5kZXN0aW5hdGlvbik7XG4gICAgICAgICAgY29uc3QgYnVybiA9IGludGVybWVkaWFyeUFjY291bnQuZGVwb3NpdEZvckJ1cm4oZGVzdGluYXRpb24sIGFtb3VudCk7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKGJ1cm4sIHRoaXMuZmFjZXRzLnRyYW5zZmVySGFuZGxlciwgY3R4KTtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZWplY3RlZChlcnJvciwgX2N0eCkge1xuICAgICAgICAgIGxvZyhcIlxcdXsxRjZBOH0gQ0NUUCB0cmFuc2ZlciBmYWlsZWRcIiwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2l0aGRyYXdIYW5kbGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0LCB7XG4gICAgICAgICAgYWR2YW5jZUFtb3VudCxcbiAgICAgICAgICB0bXBSZXR1cm5TZWF0XG4gICAgICAgIH0pIHtcbiAgICAgICAgICBjb25zdCB7IGJvcnJvd2VyIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBib3Jyb3dlci5yZXR1cm5Ub1Bvb2wodG1wUmV0dXJuU2VhdCwgYWR2YW5jZUFtb3VudCk7XG4gICAgICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgICAgIGxvZyhcbiAgICAgICAgICAgICAgYFxcdXsxRjZBOH0gcmV0dXJuICR7cXVvdGUoYWR2YW5jZUFtb3VudCl9IHRvIHBvb2wgZmFpbGVkLiBmdW5kcyByZW1haW4gb24gXCJ0bXBSZXR1cm5TZWF0XCJgLFxuICAgICAgICAgICAgICBlMlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uUmVqZWN0ZWQoZXJyb3IsIHtcbiAgICAgICAgICBhZHZhbmNlQW1vdW50LFxuICAgICAgICAgIHRtcFJldHVyblNlYXRcbiAgICAgICAgfSkge1xuICAgICAgICAgIGxvZyhcbiAgICAgICAgICAgIGBcXHV7MUY2QTh9IHdpdGhkcmF3ICR7cXVvdGUoYWR2YW5jZUFtb3VudCl9IGZyb20gXCJwb29sQWNjb3VudFwiIHRvIHJldHVybiB0byBwb29sIGZhaWxlZGAsXG4gICAgICAgICAgICBlcnJvclxuICAgICAgICAgICk7XG4gICAgICAgICAgdG1wUmV0dXJuU2VhdC5leGl0KCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgfSxcbiAgICB7XG4gICAgICBzdGF0ZVNoYXBlXG4gICAgfVxuICApO1xufTtcbmhhcmRlbihwcmVwYXJlQWR2YW5jZXJLaXQpO1xudmFyIHByZXBhcmVBZHZhbmNlciA9ICh6b25lLCBjYXBzKSA9PiB7XG4gIGNvbnN0IG1ha2VBZHZhbmNlcktpdCA9IHByZXBhcmVBZHZhbmNlcktpdCh6b25lLCBjYXBzKTtcbiAgcmV0dXJuIHBpY2tGYWNldChtYWtlQWR2YW5jZXJLaXQsIFwiYWR2YW5jZXJcIik7XG59O1xuaGFyZGVuKHByZXBhcmVBZHZhbmNlcik7XG5cbi8vXG52YXIgeyBrZXlzOiBrZXlzMyB9ID0gT2JqZWN0O1xudmFyIHsgYWRkOiBhZGQ0LCBpc0VtcHR5LCBpc0VxdWFsLCBpc0dURTogaXNHVEUzLCBtYWtlLCBtYWtlRW1wdHk6IG1ha2VFbXB0eTIsIHN1YnRyYWN0OiBzdWJ0cmFjdDQgfSA9IEFtb3VudE1hdGg7XG52YXIgbWFrZVBhcml0eSA9IChudW1lcmF0b3JCcmFuZCwgZGVub21pbmF0b3JCcmFuZCkgPT4ge1xuICBjb25zdCBkdXN0ID0gMW47XG4gIHJldHVybiBtYWtlUmF0aW8oZHVzdCwgbnVtZXJhdG9yQnJhbmQsIGR1c3QsIGRlbm9taW5hdG9yQnJhbmQpO1xufTtcbnZhciBkZXBvc2l0Q2FsYyA9IChzaGFyZVdvcnRoLCB7IGdpdmUsIHdhbnQgfSkgPT4ge1xuICBhc3NlcnQoIWlzRW1wdHkoZ2l2ZS5VU0RDKSk7XG4gIGNvbnN0IHsgZGVub21pbmF0b3I6IHNoYXJlc091dHN0YW5kaW5nLCBudW1lcmF0b3I6IHBvb2xCYWxhbmNlIH0gPSBzaGFyZVdvcnRoO1xuICBjb25zdCBmYWlyUG9vbFNoYXJlID0gZGl2aWRlQnkoZ2l2ZS5VU0RDLCBzaGFyZVdvcnRoKTtcbiAgaWYgKHdhbnQ/LlBvb2xTaGFyZSkge1xuICAgIGlzR1RFMyhmYWlyUG9vbFNoYXJlLCB3YW50LlBvb2xTaGFyZSkgfHwgdGhyb3dSZWRhY3RlZGBkZXBvc2l0IGNhbm5vdCBwYXkgb3V0ICR7cXVvdGUod2FudC5Qb29sU2hhcmUpfTsgJHtxdW90ZShnaXZlLlVTREMpfSBvbmx5IGdldHMgJHtxdW90ZShmYWlyUG9vbFNoYXJlKX1gO1xuICB9XG4gIGNvbnN0IG91dHN0YW5kaW5nUG9zdCA9IGFkZDQoc2hhcmVzT3V0c3RhbmRpbmcsIGZhaXJQb29sU2hhcmUpO1xuICBjb25zdCBiYWxhbmNlUG9zdCA9IGFkZDQocG9vbEJhbGFuY2UsIGdpdmUuVVNEQyk7XG4gIGNvbnN0IHdvcnRoUG9zdCA9IG1ha2VSYXRpb0Zyb21BbW91bnRzKGJhbGFuY2VQb3N0LCBvdXRzdGFuZGluZ1Bvc3QpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBwYXlvdXRzOiB7IFBvb2xTaGFyZTogZmFpclBvb2xTaGFyZSB9LFxuICAgIHNoYXJlV29ydGg6IHdvcnRoUG9zdFxuICB9KTtcbn07XG52YXIgY2hlY2tQb29sQmFsYW5jZSA9IChwb29sQWxsb2MsIHNoYXJlV29ydGgsIGVuY3VtYmVyZWRCYWxhbmNlKSA9PiB7XG4gIGNvbnN0IHsgYnJhbmQ6IHVzZGNCcmFuZCB9ID0gZW5jdW1iZXJlZEJhbGFuY2U7XG4gIGNvbnN0IHVuZW5jdW1iZXJlZEJhbGFuY2UgPSBwb29sQWxsb2MuVVNEQyB8fCBtYWtlRW1wdHkyKHVzZGNCcmFuZCk7XG4gIGNvbnN0IGt3ZHMgPSBrZXlzMyhwb29sQWxsb2MpO1xuICBrd2RzLmxlbmd0aCA9PT0gMCB8fCBrd2RzLmxlbmd0aCA9PT0gMSAmJiBrd2RzWzBdID09PSBcIlVTRENcIiB8fCB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgcG9vbCBhbGxvY2F0aW9uczogJHtwb29sQWxsb2N9YDtcbiAgY29uc3QgZHVzdCA9IG1ha2UodXNkY0JyYW5kLCAxbik7XG4gIGNvbnN0IGdyb3NzQmFsYW5jZSA9IGFkZDQoYWRkNCh1bmVuY3VtYmVyZWRCYWxhbmNlLCBkdXN0KSwgZW5jdW1iZXJlZEJhbGFuY2UpO1xuICBpc0VxdWFsKGdyb3NzQmFsYW5jZSwgc2hhcmVXb3J0aC5udW1lcmF0b3IpIHx8IHRocm93UmVkYWN0ZWRg8J+aqCBwb29sIGJhbGFuY2UgJHtxdW90ZSh1bmVuY3VtYmVyZWRCYWxhbmNlKX0gYW5kIGVuY3VtYmVyZWQgYmFsYW5jZSAke3F1b3RlKGVuY3VtYmVyZWRCYWxhbmNlKX0gaW5jb25zaXN0ZW50IHdpdGggc2hhcmVXb3J0aCAke3F1b3RlKHNoYXJlV29ydGgpfWA7XG4gIHJldHVybiBoYXJkZW4oeyB1bmVuY3VtYmVyZWRCYWxhbmNlLCBncm9zc0JhbGFuY2UgfSk7XG59O1xudmFyIHdpdGhkcmF3Q2FsYyA9IChzaGFyZVdvcnRoLCB7IGdpdmUsIHdhbnQgfSwgcG9vbEFsbG9jLCBlbmN1bWJlcmVkQmFsYW5jZSA9IG1ha2VFbXB0eTIoc2hhcmVXb3J0aC5udW1lcmF0b3IuYnJhbmQpKSA9PiB7XG4gIGNvbnN0IHsgdW5lbmN1bWJlcmVkQmFsYW5jZSB9ID0gY2hlY2tQb29sQmFsYW5jZShcbiAgICBwb29sQWxsb2MsXG4gICAgc2hhcmVXb3J0aCxcbiAgICBlbmN1bWJlcmVkQmFsYW5jZVxuICApO1xuICBhc3NlcnQoIWlzRW1wdHkoZ2l2ZS5Qb29sU2hhcmUpKTtcbiAgYXNzZXJ0KCFpc0VtcHR5KHdhbnQuVVNEQykpO1xuICBjb25zdCBwYXlvdXQgPSBtdWx0aXBseUJ5KGdpdmUuUG9vbFNoYXJlLCBzaGFyZVdvcnRoKTtcbiAgaXNHVEUzKHBheW91dCwgd2FudC5VU0RDKSB8fCB0aHJvd1JlZGFjdGVkYGNhbm5vdCB3aXRoZHJhdyAke3F1b3RlKHdhbnQuVVNEQyl9OyAke3F1b3RlKGdpdmUuUG9vbFNoYXJlKX0gb25seSB3b3J0aCAke3F1b3RlKHBheW91dCl9YDtcbiAgY29uc3QgeyBkZW5vbWluYXRvcjogc2hhcmVzT3V0c3RhbmRpbmcsIG51bWVyYXRvcjogcG9vbEJhbGFuY2UgfSA9IHNoYXJlV29ydGg7XG4gICFpc0dURTMod2FudC5VU0RDLCBwb29sQmFsYW5jZSkgfHwgdGhyb3dSZWRhY3RlZGBjYW5ub3Qgd2l0aGRyYXcgJHtxdW90ZSh3YW50LlVTREMpfTsgb25seSAke3F1b3RlKHBvb2xCYWxhbmNlKX0gaW4gcG9vbGA7XG4gIGlzR1RFMyh1bmVuY3VtYmVyZWRCYWxhbmNlLCB3YW50LlVTREMpIHx8IHRocm93UmVkYWN0ZWRgY2Fubm90IHdpdGhkcmF3ICR7cXVvdGUod2FudC5VU0RDKX07ICR7cXVvdGUoZW5jdW1iZXJlZEJhbGFuY2UpfSBpcyBpbiB1c2U7IHN0YW5kIGJ5IGZvciBwb29sIHRvIHJldHVybiB0byAke3F1b3RlKHBvb2xCYWxhbmNlKX1gO1xuICBjb25zdCBiYWxhbmNlUG9zdCA9IHN1YnRyYWN0NChwb29sQmFsYW5jZSwgcGF5b3V0KTtcbiAgY29uc3Qgb3V0c3RhbmRpbmdQb3N0ID0gc3VidHJhY3Q0KHNoYXJlc091dHN0YW5kaW5nLCBnaXZlLlBvb2xTaGFyZSk7XG4gIGNvbnN0IHdvcnRoUG9zdCA9IG1ha2VSYXRpb0Zyb21BbW91bnRzKGJhbGFuY2VQb3N0LCBvdXRzdGFuZGluZ1Bvc3QpO1xuICByZXR1cm4gaGFyZGVuKHsgc2hhcmVXb3J0aDogd29ydGhQb3N0LCBwYXlvdXRzOiB7IFVTREM6IHBheW91dCB9IH0pO1xufTtcbnZhciB3aXRoRmVlcyA9IChzaGFyZVdvcnRoLCBmZWVzKSA9PiB7XG4gIGNvbnN0IGJhbGFuY2VQb3N0ID0gYWRkNChzaGFyZVdvcnRoLm51bWVyYXRvciwgZmVlcyk7XG4gIHJldHVybiBtYWtlUmF0aW9Gcm9tQW1vdW50cyhiYWxhbmNlUG9zdCwgc2hhcmVXb3J0aC5kZW5vbWluYXRvcik7XG59O1xudmFyIGJvcnJvd0NhbGMgPSAocmVxdWVzdGVkLCBwb29sU2VhdEFsbG9jYXRpb24sIGVuY3VtYmVyZWRCYWxhbmNlLCBwb29sU3RhdHMpID0+IHtcbiAgIWlzR1RFMyhyZXF1ZXN0ZWQsIHBvb2xTZWF0QWxsb2NhdGlvbikgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgYm9ycm93LiBSZXF1ZXN0ZWQgJHtxdW90ZShyZXF1ZXN0ZWQpfSBtdXN0IGJlIGxlc3MgdGhhbiBwb29sIGJhbGFuY2UgJHtxdW90ZShwb29sU2VhdEFsbG9jYXRpb24pfS5gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBlbmN1bWJlcmVkQmFsYW5jZTogYWRkNChlbmN1bWJlcmVkQmFsYW5jZSwgcmVxdWVzdGVkKSxcbiAgICBwb29sU3RhdHM6IHtcbiAgICAgIC4uLnBvb2xTdGF0cyxcbiAgICAgIHRvdGFsQm9ycm93czogYWRkNChwb29sU3RhdHMudG90YWxCb3Jyb3dzLCByZXF1ZXN0ZWQpXG4gICAgfVxuICB9KTtcbn07XG52YXIgcmVwYXlDYWxjID0gKHNoYXJlV29ydGgsIHNwbGl0LCBlbmN1bWJlcmVkQmFsYW5jZSwgcG9vbFN0YXRzKSA9PiB7XG4gIGlzR1RFMyhlbmN1bWJlcmVkQmFsYW5jZSwgc3BsaXQuUHJpbmNpcGFsKSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCByZXBheS4gUHJpbmNpcGFsICR7cXVvdGUoc3BsaXQuUHJpbmNpcGFsKX0gZXhjZWVkcyBlbmN1bWJlcmVkQmFsYW5jZSAke3F1b3RlKGVuY3VtYmVyZWRCYWxhbmNlKX0uYDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgc2hhcmVXb3J0aDogd2l0aEZlZXMoc2hhcmVXb3J0aCwgc3BsaXQuUG9vbEZlZSksXG4gICAgZW5jdW1iZXJlZEJhbGFuY2U6IHN1YnRyYWN0NChlbmN1bWJlcmVkQmFsYW5jZSwgc3BsaXQuUHJpbmNpcGFsKSxcbiAgICBwb29sU3RhdHM6IHtcbiAgICAgIC4uLnBvb2xTdGF0cyxcbiAgICAgIHRvdGFsUmVwYXlzOiBhZGQ0KHBvb2xTdGF0cy50b3RhbFJlcGF5cywgc3BsaXQuUHJpbmNpcGFsKSxcbiAgICAgIHRvdGFsUG9vbEZlZXM6IGFkZDQocG9vbFN0YXRzLnRvdGFsUG9vbEZlZXMsIHNwbGl0LlBvb2xGZWUpLFxuICAgICAgdG90YWxDb250cmFjdEZlZXM6IGFkZDQoXG4gICAgICAgIGFkZDQocG9vbFN0YXRzLnRvdGFsQ29udHJhY3RGZWVzLCBzcGxpdC5Db250cmFjdEZlZSksXG4gICAgICAgIHNwbGl0LlJlbGF5RmVlXG4gICAgICApXG4gICAgfVxuICB9KTtcbn07XG5cbi8vXG52YXIgeyBhZGQ6IGFkZDUsIGlzR1RFOiBpc0dURTQsIG1ha2VFbXB0eTogbWFrZUVtcHR5MyB9ID0gQW1vdW50TWF0aDtcbnZhciBzdGF0ZVNoYXBlMiA9IGhhcmRlbih7XG4gIGVuY3VtYmVyZWRCYWxhbmNlOiBBbW91bnRTaGFwZSxcbiAgZmVlU2VhdDogTS5yZW1vdGFibGUoKSxcbiAgcG9vbFN0YXRzOiBNLnJlY29yZCgpLFxuICBwb29sTWV0cmljc1JlY29yZGVyS2l0OiBSZWNvcmRlcktpdFNoYXBlLFxuICBwb29sU2VhdDogTS5yZW1vdGFibGUoKSxcbiAgUG9vbFNoYXJlczogTS5yZW1vdGFibGUoKSxcbiAgcHJvcG9zYWxTaGFwZXM6IHtcbiAgICBkZXBvc2l0OiBNLnBhdHRlcm4oKSxcbiAgICB3aXRoZHJhdzogTS5wYXR0ZXJuKCksXG4gICAgd2l0aGRyYXdGZWVzOiBNLnBhdHRlcm4oKVxuICB9LFxuICBzaGFyZU1pbnQ6IE0ucmVtb3RhYmxlKCksXG4gIHNoYXJlV29ydGg6IFJhdGlvU2hhcGVcbn0pO1xudmFyIHByZXBhcmVMaXF1aWRpdHlQb29sS2l0ID0gKHpvbmUsIHpjZiwgVVNEQywgdG9vbHMpID0+IHtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJMaXF1aWRpdHkgUG9vbFwiLFxuICAgIHtcbiAgICAgIGJvcnJvd2VyOiBNLmludGVyZmFjZShcImJvcnJvd2VyXCIsIHtcbiAgICAgICAgYm9ycm93OiBNLmNhbGwoU2VhdFNoYXBlLCBtYWtlTmF0QW1vdW50U2hhcGUoVVNEQywgMW4pKS5yZXR1cm5zKCksXG4gICAgICAgIHJldHVyblRvUG9vbDogTS5jYWxsKFNlYXRTaGFwZSwgbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDFuKSkucmV0dXJucygpXG4gICAgICB9KSxcbiAgICAgIHJlcGF5ZXI6IE0uaW50ZXJmYWNlKFwicmVwYXllclwiLCB7XG4gICAgICAgIHJlcGF5OiBNLmNhbGwoXG4gICAgICAgICAgVHJhbnNmZXJQYXJ0U2hhcGUsXG4gICAgICAgICAgaGFyZGVuKHtcbiAgICAgICAgICAgIFByaW5jaXBhbDogbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDFuKSxcbiAgICAgICAgICAgIFBvb2xGZWU6IG1ha2VOYXRBbW91bnRTaGFwZShVU0RDLCAwbiksXG4gICAgICAgICAgICBDb250cmFjdEZlZTogbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDBuKSxcbiAgICAgICAgICAgIFJlbGF5RmVlOiBtYWtlTmF0QW1vdW50U2hhcGUoVVNEQywgMG4pXG4gICAgICAgICAgfSlcbiAgICAgICAgKS5yZXR1cm5zKClcbiAgICAgIH0pLFxuICAgICAgZXh0ZXJuYWw6IE0uaW50ZXJmYWNlKFwiZXh0ZXJuYWxcIiwge1xuICAgICAgICBwdWJsaXNoUG9vbE1ldHJpY3M6IE0uY2FsbCgpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICBkZXBvc2l0SGFuZGxlcjogTS5pbnRlcmZhY2UoXCJkZXBvc2l0SGFuZGxlclwiLCB7XG4gICAgICAgIGhhbmRsZTogTS5jYWxsKFNlYXRTaGFwZSwgTS5hbnkoKSkucmV0dXJucygpXG4gICAgICB9KSxcbiAgICAgIHdpdGhkcmF3SGFuZGxlcjogTS5pbnRlcmZhY2UoXCJ3aXRoZHJhd0hhbmRsZXJcIiwge1xuICAgICAgICBoYW5kbGU6IE0uY2FsbChTZWF0U2hhcGUsIE0uYW55KCkpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICB3aXRoZHJhd0ZlZXNIYW5kbGVyOiBNLmludGVyZmFjZShcIndpdGhkcmF3RmVlc0hhbmRsZXJcIiwge1xuICAgICAgICBoYW5kbGU6IE0uY2FsbChTZWF0U2hhcGUsIE0uYW55KCkpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICBwdWJsaWM6IE0uaW50ZXJmYWNlKFwicHVibGljXCIsIHtcbiAgICAgICAgbWFrZURlcG9zaXRJbnZpdGF0aW9uOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgbWFrZVdpdGhkcmF3SW52aXRhdGlvbjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIGdldFB1YmxpY1RvcGljczogTS5jYWxsKCkucmV0dXJucyhUb3BpY3NSZWNvcmRTaGFwZSlcbiAgICAgIH0pLFxuICAgICAgZmVlUmVjaXBpZW50OiBNLmludGVyZmFjZShcImZlZVJlY2lwaWVudFwiLCB7XG4gICAgICAgIGdldENvbnRyYWN0RmVlQmFsYW5jZTogTS5jYWxsKCkucmV0dXJucyhBbW91bnRTaGFwZSksXG4gICAgICAgIG1ha2VXaXRoZHJhd0ZlZXNJbnZpdGF0aW9uOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgICAgfSlcbiAgICB9LFxuICAgIChzaGFyZU1pbnQsIG5vZGUpID0+IHtcbiAgICAgIGNvbnN0IHsgYnJhbmQ6IFBvb2xTaGFyZXMgfSA9IHNoYXJlTWludC5nZXRJc3N1ZXJSZWNvcmQoKTtcbiAgICAgIGNvbnN0IHByb3Bvc2FsU2hhcGVzID0gbWFrZVByb3Bvc2FsU2hhcGVzKHsgVVNEQywgUG9vbFNoYXJlcyB9KTtcbiAgICAgIGNvbnN0IHNoYXJlV29ydGggPSBtYWtlUGFyaXR5KFVTREMsIFBvb2xTaGFyZXMpO1xuICAgICAgY29uc3QgeyB6Y2ZTZWF0OiBwb29sU2VhdCB9ID0gemNmLm1ha2VFbXB0eVNlYXRLaXQoKTtcbiAgICAgIGNvbnN0IHsgemNmU2VhdDogZmVlU2VhdCB9ID0gemNmLm1ha2VFbXB0eVNlYXRLaXQoKTtcbiAgICAgIGNvbnN0IHBvb2xNZXRyaWNzUmVjb3JkZXJLaXQgPSB0b29scy5tYWtlUmVjb3JkZXJLaXQoXG4gICAgICAgIG5vZGUsXG4gICAgICAgIFBvb2xNZXRyaWNzU2hhcGVcbiAgICAgICk7XG4gICAgICBjb25zdCBlbmN1bWJlcmVkQmFsYW5jZSA9IG1ha2VFbXB0eTMoVVNEQyk7XG4gICAgICBjb25zdCBwb29sU3RhdHMgPSBoYXJkZW4oe1xuICAgICAgICB0b3RhbEJvcnJvd3M6IG1ha2VFbXB0eTMoVVNEQyksXG4gICAgICAgIHRvdGFsQ29udHJhY3RGZWVzOiBtYWtlRW1wdHkzKFVTREMpLFxuICAgICAgICB0b3RhbFBvb2xGZWVzOiBtYWtlRW1wdHkzKFVTREMpLFxuICAgICAgICB0b3RhbFJlcGF5czogbWFrZUVtcHR5MyhVU0RDKVxuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBlbmN1bWJlcmVkQmFsYW5jZSxcbiAgICAgICAgZmVlU2VhdCxcbiAgICAgICAgcG9vbFN0YXRzLFxuICAgICAgICBwb29sTWV0cmljc1JlY29yZGVyS2l0LFxuICAgICAgICBwb29sU2VhdCxcbiAgICAgICAgUG9vbFNoYXJlcyxcbiAgICAgICAgcHJvcG9zYWxTaGFwZXMsXG4gICAgICAgIHNoYXJlTWludCxcbiAgICAgICAgc2hhcmVXb3J0aFxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGJvcnJvd2VyOiB7XG4gICAgICAgIGJvcnJvdyh0b1NlYXQsIGFtb3VudCkge1xuICAgICAgICAgIGNvbnN0IHsgZW5jdW1iZXJlZEJhbGFuY2UsIHBvb2xTZWF0LCBwb29sU3RhdHMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgcG9zdCA9IGJvcnJvd0NhbGMoXG4gICAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgICBwb29sU2VhdC5nZXRBbW91bnRBbGxvY2F0ZWQoXCJVU0RDXCIsIFVTREMpLFxuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2UsXG4gICAgICAgICAgICBwb29sU3RhdHNcbiAgICAgICAgICApO1xuICAgICAgICAgIHpjZi5hdG9taWNSZWFycmFuZ2UoaGFyZGVuKFtbcG9vbFNlYXQsIHRvU2VhdCwgeyBVU0RDOiBhbW91bnQgfV1dKSk7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLnN0YXRlLCBwb3N0KTtcbiAgICAgICAgICB0aGlzLmZhY2V0cy5leHRlcm5hbC5wdWJsaXNoUG9vbE1ldHJpY3MoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuVG9Qb29sKGJvcnJvd1NlYXQsIGFtb3VudCkge1xuICAgICAgICAgIGNvbnN0IHJldHVybkFtb3VudHMgPSBoYXJkZW4oe1xuICAgICAgICAgICAgUHJpbmNpcGFsOiBhbW91bnQsXG4gICAgICAgICAgICBQb29sRmVlOiBtYWtlRW1wdHkzKFVTREMpLFxuICAgICAgICAgICAgQ29udHJhY3RGZWU6IG1ha2VFbXB0eTMoVVNEQyksXG4gICAgICAgICAgICBSZWxheUZlZTogbWFrZUVtcHR5MyhVU0RDKVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IGJvcnJvd1NlYXRBbGxvY2F0aW9uID0gYm9ycm93U2VhdC5nZXRDdXJyZW50QWxsb2NhdGlvbigpO1xuICAgICAgICAgIGlzR1RFNChib3Jyb3dTZWF0QWxsb2NhdGlvbi5VU0RDLCBhbW91bnQpIHx8IHRocm93UmVkYWN0ZWRg4pqg77iPIGJvcnJvd1NlYXRBbGxvY2F0aW9uICR7cXVvdGUoYm9ycm93U2VhdEFsbG9jYXRpb24pfSBsZXNzIHRoYW4gYW1vdW50S1dSICR7cXVvdGUoYW1vdW50KX1gO1xuICAgICAgICAgIGNvbnN0IHRyYW5zZmVyU291cmNlUGFydCA9IGZyb21Pbmx5KGJvcnJvd1NlYXQsIHsgVVNEQzogYW1vdW50IH0pO1xuICAgICAgICAgIHRoaXMuZmFjZXRzLnJlcGF5ZXIucmVwYXkodHJhbnNmZXJTb3VyY2VQYXJ0LCByZXR1cm5BbW91bnRzKTtcbiAgICAgICAgICBib3Jyb3dTZWF0LmV4aXQoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlcGF5ZXI6IHtcbiAgICAgICAgcmVwYXkoc291cmNlVHJhbnNmZXIsIHNwbGl0KSB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2UsXG4gICAgICAgICAgICBmZWVTZWF0LFxuICAgICAgICAgICAgcG9vbFNlYXQsXG4gICAgICAgICAgICBwb29sU3RhdHMsXG4gICAgICAgICAgICBzaGFyZVdvcnRoXG4gICAgICAgICAgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY2hlY2tQb29sQmFsYW5jZShcbiAgICAgICAgICAgIHBvb2xTZWF0LmdldEN1cnJlbnRBbGxvY2F0aW9uKCksXG4gICAgICAgICAgICBzaGFyZVdvcnRoLFxuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2VcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHBvc3QgPSByZXBheUNhbGMoXG4gICAgICAgICAgICBzaGFyZVdvcnRoLFxuICAgICAgICAgICAgc3BsaXQsXG4gICAgICAgICAgICBlbmN1bWJlcmVkQmFsYW5jZSxcbiAgICAgICAgICAgIHBvb2xTdGF0c1xuICAgICAgICAgICk7XG4gICAgICAgICAgemNmLmF0b21pY1JlYXJyYW5nZShcbiAgICAgICAgICAgIGhhcmRlbihbXG4gICAgICAgICAgICAgIHNvdXJjZVRyYW5zZmVyLFxuICAgICAgICAgICAgICB0b09ubHkocG9vbFNlYXQsIHsgVVNEQzogYWRkNShzcGxpdC5Qb29sRmVlLCBzcGxpdC5QcmluY2lwYWwpIH0pLFxuICAgICAgICAgICAgICB0b09ubHkoZmVlU2VhdCwgeyBVU0RDOiBhZGQ1KHNwbGl0LkNvbnRyYWN0RmVlLCBzcGxpdC5SZWxheUZlZSkgfSlcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKTtcbiAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuc3RhdGUsIHBvc3QpO1xuICAgICAgICAgIHRoaXMuZmFjZXRzLmV4dGVybmFsLnB1Ymxpc2hQb29sTWV0cmljcygpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXh0ZXJuYWw6IHtcbiAgICAgICAgcHVibGlzaFBvb2xNZXRyaWNzKCkge1xuICAgICAgICAgIGNvbnN0IHsgcG9vbFN0YXRzLCBzaGFyZVdvcnRoLCBlbmN1bWJlcmVkQmFsYW5jZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IHJlY29yZGVyIH0gPSB0aGlzLnN0YXRlLnBvb2xNZXRyaWNzUmVjb3JkZXJLaXQ7XG4gICAgICAgICAgdm9pZCByZWNvcmRlci53cml0ZSh7XG4gICAgICAgICAgICBlbmN1bWJlcmVkQmFsYW5jZSxcbiAgICAgICAgICAgIHNoYXJlV29ydGgsXG4gICAgICAgICAgICAuLi5wb29sU3RhdHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlcG9zaXRIYW5kbGVyOiB7XG4gICAgICAgIGhhbmRsZShscCkge1xuICAgICAgICAgIGNvbnN0IHsgc2hhcmVXb3J0aCwgc2hhcmVNaW50LCBwb29sU2VhdCwgZW5jdW1iZXJlZEJhbGFuY2UgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyBleHRlcm5hbCB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgcHJvcG9zYWwgPSAoXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgbHAuZ2V0UHJvcG9zYWwoKVxuICAgICAgICAgICk7XG4gICAgICAgICAgY2hlY2tQb29sQmFsYW5jZShcbiAgICAgICAgICAgIHBvb2xTZWF0LmdldEN1cnJlbnRBbGxvY2F0aW9uKCksXG4gICAgICAgICAgICBzaGFyZVdvcnRoLFxuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2VcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHBvc3QgPSBkZXBvc2l0Q2FsYyhzaGFyZVdvcnRoLCBwcm9wb3NhbCk7XG4gICAgICAgICAgY29uc3Qgc2hhcmVQYXlvdXQgPSBzaGFyZU1pbnQubWludEdhaW5zKHBvc3QucGF5b3V0cyk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuc2hhcmVXb3J0aCA9IHBvc3Quc2hhcmVXb3J0aDtcbiAgICAgICAgICAgIHpjZi5hdG9taWNSZWFycmFuZ2UoXG4gICAgICAgICAgICAgIGhhcmRlbihbXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICBbbHAsIHBvb2xTZWF0LCBwcm9wb3NhbC5naXZlXSxcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIFtzaGFyZVBheW91dCwgbHAsIHBvc3QucGF5b3V0c11cbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBjYXRjaCAoY2F1c2UpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlxcdXsxRjZBOH0gY2Fubm90IGNvbW1pdCBkZXBvc2l0XCIsIHsgY2F1c2UgfSk7XG4gICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIGxwLmV4aXQoKTtcbiAgICAgICAgICAgIHNoYXJlUGF5b3V0LmV4aXQoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZXh0ZXJuYWwucHVibGlzaFBvb2xNZXRyaWNzKCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3aXRoZHJhd0hhbmRsZXI6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgaGFuZGxlKGxwKSB7XG4gICAgICAgICAgY29uc3QgeyBzaGFyZVdvcnRoLCBzaGFyZU1pbnQsIHBvb2xTZWF0LCBlbmN1bWJlcmVkQmFsYW5jZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IGV4dGVybmFsIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCBwcm9wb3NhbCA9IGxwLmdldFByb3Bvc2FsKCk7XG4gICAgICAgICAgY29uc3QgeyB6Y2ZTZWF0OiBidXJuIH0gPSB6Y2YubWFrZUVtcHR5U2VhdEtpdCgpO1xuICAgICAgICAgIGNvbnN0IHBvc3QgPSB3aXRoZHJhd0NhbGMoXG4gICAgICAgICAgICBzaGFyZVdvcnRoLFxuICAgICAgICAgICAgcHJvcG9zYWwsXG4gICAgICAgICAgICBwb29sU2VhdC5nZXRDdXJyZW50QWxsb2NhdGlvbigpLFxuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2VcbiAgICAgICAgICApO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnNoYXJlV29ydGggPSBwb3N0LnNoYXJlV29ydGg7XG4gICAgICAgICAgICB6Y2YuYXRvbWljUmVhcnJhbmdlKFxuICAgICAgICAgICAgICBoYXJkZW4oW1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgW2xwLCBidXJuLCBwcm9wb3NhbC5naXZlXSxcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIFtwb29sU2VhdCwgbHAsIHBvc3QucGF5b3V0c11cbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBzaGFyZU1pbnQuYnVybkxvc3Nlcyhwcm9wb3NhbC5naXZlLCBidXJuKTtcbiAgICAgICAgICB9IGNhdGNoIChjYXVzZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiXFx1ezFGNkE4fSBjYW5ub3QgY29tbWl0IHdpdGhkcmF3XCIsIHsgY2F1c2UgfSk7XG4gICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIGxwLmV4aXQoKTtcbiAgICAgICAgICAgIGJ1cm4uZXhpdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBleHRlcm5hbC5wdWJsaXNoUG9vbE1ldHJpY3MoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdpdGhkcmF3RmVlc0hhbmRsZXI6IHtcbiAgICAgICAgaGFuZGxlKHNlYXQpIHtcbiAgICAgICAgICBjb25zdCB7IGZlZVNlYXQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyB3YW50IH0gPSBzZWF0LmdldFByb3Bvc2FsKCk7XG4gICAgICAgICAgY29uc3QgYXZhaWxhYmxlID0gZmVlU2VhdC5nZXRBbW91bnRBbGxvY2F0ZWQoXCJVU0RDXCIsIHdhbnQuVVNEQy5icmFuZCk7XG4gICAgICAgICAgaXNHVEU0KGF2YWlsYWJsZSwgd2FudC5VU0RDKSB8fCB0aHJvd1JlZGFjdGVkYGNhbm5vdCB3aXRoZHJhdyAke3dhbnQuVVNEQ307IG9ubHkgJHthdmFpbGFibGV9IGF2YWlsYWJsZWA7XG4gICAgICAgICAgemNmLmF0b21pY1JlYXJyYW5nZShoYXJkZW4oW1tmZWVTZWF0LCBzZWF0LCB3YW50XV0pKTtcbiAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHB1YmxpYzoge1xuICAgICAgICBtYWtlRGVwb3NpdEludml0YXRpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLmRlcG9zaXRIYW5kbGVyLFxuICAgICAgICAgICAgXCJEZXBvc2l0XCIsXG4gICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnByb3Bvc2FsU2hhcGVzLmRlcG9zaXRcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICBtYWtlV2l0aGRyYXdJbnZpdGF0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy53aXRoZHJhd0hhbmRsZXIsXG4gICAgICAgICAgICBcIldpdGhkcmF3XCIsXG4gICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnByb3Bvc2FsU2hhcGVzLndpdGhkcmF3XG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0UHVibGljVG9waWNzKCkge1xuICAgICAgICAgIGNvbnN0IHsgcG9vbE1ldHJpY3NSZWNvcmRlcktpdCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcG9vbE1ldHJpY3M6IG1ha2VSZWNvcmRlclRvcGljKFxuICAgICAgICAgICAgICBcInBvb2xNZXRyaWNzXCIsXG4gICAgICAgICAgICAgIHBvb2xNZXRyaWNzUmVjb3JkZXJLaXRcbiAgICAgICAgICAgIClcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZmVlUmVjaXBpZW50OiB7XG4gICAgICAgIGdldENvbnRyYWN0RmVlQmFsYW5jZSgpIHtcbiAgICAgICAgICBjb25zdCB7IGZlZVNlYXQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgcmV0dXJuIGZlZVNlYXQuZ2V0Q3VycmVudEFsbG9jYXRpb24oKS5VU0RDO1xuICAgICAgICB9LFxuICAgICAgICBtYWtlV2l0aGRyYXdGZWVzSW52aXRhdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKFxuICAgICAgICAgICAgdGhpcy5mYWNldHMud2l0aGRyYXdGZWVzSGFuZGxlcixcbiAgICAgICAgICAgIFwiV2l0aGRyYXcgRmVlc1wiLFxuICAgICAgICAgICAgdm9pZCAwLFxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5wcm9wb3NhbFNoYXBlcy53aXRoZHJhd0ZlZXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBmaW5pc2g6ICh7IGZhY2V0czogeyBleHRlcm5hbCB9IH0pID0+IHtcbiAgICAgICAgdm9pZCBleHRlcm5hbC5wdWJsaXNoUG9vbE1ldHJpY3MoKTtcbiAgICAgIH0sXG4gICAgICBzdGF0ZVNoYXBlOiBzdGF0ZVNoYXBlMlxuICAgIH1cbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZUxpcXVpZGl0eVBvb2xLaXQpO1xuXG4vL1xudmFyIGFzTXVsdGlzZXQgPSAobWFwU3RvcmUpID0+IGhhcmRlbih7XG4gIC8qXG5cblxuXG5cbiAgICovXG4gIGFkZDogKGl0ZW0sIGNvdW50ID0gMSkgPT4ge1xuICAgIGNvdW50ID4gMCAmJiBOdW1iZXIuaXNJbnRlZ2VyKGNvdW50KSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCBhZGQgYSBub24tcG9zaXRpdmUgaW50ZWdlciBjb3VudCAke2NvdW50fSB0byBiYWdgO1xuICAgIGlmIChtYXBTdG9yZS5oYXMoaXRlbSkpIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRDb3VudCA9IG1hcFN0b3JlLmdldChpdGVtKTtcbiAgICAgIG1hcFN0b3JlLnNldChpdGVtLCBjdXJyZW50Q291bnQgKyBjb3VudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hcFN0b3JlLmluaXQoaXRlbSwgY291bnQpO1xuICAgIH1cbiAgfSxcbiAgLypcblxuXG5cblxuXG5cblxuICAgKi9cbiAgcmVtb3ZlOiAoaXRlbSwgY291bnQgPSAxKSA9PiB7XG4gICAgY291bnQgPiAwICYmIE51bWJlci5pc0ludGVnZXIoY291bnQpIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlbW92ZSBhIG5vbi1wb3NpdGl2ZSBpbnRlZ2VyIGNvdW50ICR7Y291bnR9IGZyb20gYmFnYDtcbiAgICBpZiAoIW1hcFN0b3JlLmhhcyhpdGVtKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBjdXJyZW50Q291bnQgPSBtYXBTdG9yZS5nZXQoaXRlbSk7XG4gICAgaWYgKGN1cnJlbnRDb3VudCA8IGNvdW50KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChjdXJyZW50Q291bnQgPT09IGNvdW50KSB7XG4gICAgICBtYXBTdG9yZS5kZWxldGUoaXRlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hcFN0b3JlLnNldChpdGVtLCBjdXJyZW50Q291bnQgLSBjb3VudCk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuICAvKlxuXG5cblxuXG4gICAqL1xuICBjb3VudDogKGl0ZW0pID0+IHtcbiAgICByZXR1cm4gbWFwU3RvcmUuaGFzKGl0ZW0pID8gbWFwU3RvcmUuZ2V0KGl0ZW0pIDogMDtcbiAgfSxcbiAgLypcblxuXG5cblxuICAgKi9cbiAgaGFzOiAoaXRlbSkgPT4ge1xuICAgIHJldHVybiBtYXBTdG9yZS5oYXMoaXRlbSk7XG4gIH0sXG4gIC8qXG5cblxuXG4gICAqL1xuICBrZXlzOiAoKSA9PiB7XG4gICAgcmV0dXJuIG1hcFN0b3JlLmtleXMoKTtcbiAgfSxcbiAgLypcblxuXG5cbiAgICovXG4gIGVudHJpZXM6ICgpID0+IHtcbiAgICByZXR1cm4gbWFwU3RvcmUuZW50cmllcygpO1xuICB9LFxuICAvKlxuXG5cblxuICAgKi9cbiAgc2l6ZTogKCkgPT4ge1xuICAgIHJldHVybiBtYXBTdG9yZS5nZXRTaXplKCk7XG4gIH0sXG4gIC8qXG5cbiAgICovXG4gIGNsZWFyOiAoKSA9PiB7XG4gICAgbWFwU3RvcmUuY2xlYXIoKTtcbiAgfVxufSk7XG52YXIgaW5zZXJ0SW50b1NvcnRlZEFycmF5ID0gKGFycmF5LCBpdGVtLCBjb21wYXJlKSA9PiB7XG4gIGxldCBpMiA9IGFycmF5Lmxlbmd0aDtcbiAgd2hpbGUgKGkyID4gMCAmJiBjb21wYXJlKGl0ZW0sIGFycmF5W2kyIC0gMV0pIDwgMCkge1xuICAgIGkyIC09IDE7XG4gIH1cbiAgYXJyYXkuc3BsaWNlKGkyLCAwLCBpdGVtKTtcbn07XG5oYXJkZW4oaW5zZXJ0SW50b1NvcnRlZEFycmF5KTtcblxuLy9cbnZhciBkZWNvZGVFdmVudFBhY2tldCA9ICh7IGRhdGEgfSwgcmVtb3RlRGVub20pID0+IHtcbiAgbGV0IHR4O1xuICB0cnkge1xuICAgIHR4ID0gSlNPTi5wYXJzZShhdG9iMihkYXRhKSk7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiB7IGVycm9yOiBbXCJjb3VsZCBub3QgcGFyc2UgcGFja2V0IGRhdGFcIiwgZGF0YV0gfTtcbiAgfVxuICBjb25zdCBuZmEgPSB0eC5zZW5kZXI7XG4gIGlmICh0eC5kZW5vbSAhPT0gcmVtb3RlRGVub20pIHtcbiAgICBjb25zdCB7IGRlbm9tOiBhY3R1YWwgfSA9IHR4O1xuICAgIHJldHVybiB7IGVycm9yOiBbXCJ1bmV4cGVjdGVkIGRlbm9tXCIsIHsgYWN0dWFsLCBleHBlY3RlZDogcmVtb3RlRGVub20gfV0gfTtcbiAgfVxuICBsZXQgRVVEO1xuICB0cnkge1xuICAgIGNvbnN0IGRlY29kZWQgPSBkZWNvZGVBZGRyZXNzSG9vayh0eC5yZWNlaXZlcik7XG4gICAgbXVzdE1hdGNoMihkZWNvZGVkLCBBZGRyZXNzSG9va1NoYXBlKTtcbiAgICAoeyBFVUQgfSA9IGRlY29kZWQucXVlcnkpO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4geyBlcnJvcjogW1wibm8gcXVlcnkgcGFyYW1zXCIsIHR4LnJlY2VpdmVyXSB9O1xuICB9XG4gIGxldCBhbW91bnQ7XG4gIHRyeSB7XG4gICAgYW1vdW50ID0gQmlnSW50KHR4LmFtb3VudCk7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiB7IGVycm9yOiBbXCJpbnZhbGlkIGFtb3VudFwiLCB0eC5hbW91bnRdIH07XG4gIH1cbiAgcmV0dXJuIHsgbmZhLCBhbW91bnQsIEVVRCB9O1xufTtcbmhhcmRlbihkZWNvZGVFdmVudFBhY2tldCk7XG52YXIgbWFrZU1pbnRlZEVhcmx5S2V5ID0gKGFkZHIsIGFtb3VudCkgPT4gYHBlbmRpbmdUeDoke0pTT04uc3RyaW5naWZ5KFthZGRyLCBTdHJpbmcoYW1vdW50KV0pfWA7XG52YXIgcGFyc2VNaW50ZWRFYXJseUtleSA9IChrZXkpID0+IHtcbiAgY29uc3QgW2FkZHJlc3MsIGFtb3VudF0gPSBKU09OLnBhcnNlKGtleS5zcGxpdChcIjpcIilbMV0pO1xuICByZXR1cm4gaGFyZGVuKHsgYWRkcmVzcywgYW1vdW50OiBCaWdJbnQoYW1vdW50KSB9KTtcbn07XG52YXIgbWFrZUFkdmFuY2VEZXRhaWxzU2hhcGUgPSAoVVNEQykgPT4gaGFyZGVuKHtcbiAgZGVzdGluYXRpb246IEFjY291bnRJZEFyZ1NoYXBlLFxuICAvL1xuICBmb3J3YXJkaW5nQWRkcmVzczogTS5zdHJpbmcoKSxcbiAgZnVsbEFtb3VudDogbWFrZU5hdEFtb3VudFNoYXBlKFVTREMpLFxuICB0eEhhc2g6IEV2bUhhc2hTaGFwZVxufSk7XG52YXIgc3RhdGVTaGFwZTMgPSBoYXJkZW4oe1xuICByZXBheWVyOiBNLnJlbW90YWJsZShcIlJlcGF5ZXJcIiksXG4gIHNldHRsZW1lbnRBY2NvdW50OiBNLnJlbW90YWJsZShcIkFjY291bnRcIiksXG4gIHJlZ2lzdHJhdGlvbjogTS5vcihNLnVuZGVmaW5lZCgpLCBNLnJlbW90YWJsZShcIlJlZ2lzdHJhdGlvblwiKSksXG4gIHNvdXJjZUNoYW5uZWw6IE0uc3RyaW5nKCksXG4gIHJlbW90ZURlbm9tOiBNLnN0cmluZygpLFxuICBtaW50ZWRFYXJseTogTS5yZW1vdGFibGUoXCJtaW50ZWRFYXJseVwiKSxcbiAgLyogICAgICAgICAgICAgICovXG4gIGludGVybWVkaWF0ZVJlY2lwaWVudDogTS5vcHQoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpXG59KTtcbnZhciBwcmVwYXJlU2V0dGxlciA9ICh6b25lLCB7XG4gIGNoYWluSHViLFxuICBmZWVDb25maWcsXG4gIGZvcndhcmRGdW5kczogZm9yd2FyZEZ1bmRzMixcbiAgZ2V0Tm9ibGVJQ0EsXG4gIGxvZyA9IG1ha2VUcmFjZXIoXCJTZXR0bGVyXCIsIHRydWUpLFxuICBzdGF0dXNNYW5hZ2VyLFxuICBVU0RDLFxuICB2b3dUb29scyxcbiAgd2l0aGRyYXdUb1NlYXQsXG4gIHpjZlxufSkgPT4ge1xuICBhc3NlcnRBbGxEZWZpbmVkKHsgc3RhdHVzTWFuYWdlciB9KTtcbiAgY29uc3QgVXNkY0Ftb3VudFNoYXBlID0gbWFrZU5hdEFtb3VudFNoYXBlKFVTREMpO1xuICByZXR1cm4gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIkZhc3QgVVNEQyBTZXR0bGVyXCIsXG4gICAge1xuICAgICAgY3JlYXRvcjogTS5pbnRlcmZhY2UoXCJTZXR0bGVyQ3JlYXRvcklcIiwge1xuICAgICAgICBtb25pdG9yTWludGluZ0RlcG9zaXRzOiBNLmNhbGwoKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgICAgICByZW1lZGlhdGVNaW50ZWRFYXJseTogTS5jYWxsKE0uYmlnaW50KCkpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICB0YXA6IE0uaW50ZXJmYWNlKFwiU2V0dGxlclRhcElcIiwge1xuICAgICAgICByZWNlaXZlVXBjYWxsOiBNLmNhbGwoTS5yZWNvcmQoKSkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICAgIH0pLFxuICAgICAgbm90aWZpZXI6IE0uaW50ZXJmYWNlKFwiU2V0dGxlck5vdGlmeUlcIiwge1xuICAgICAgICBub3RpZnlBZHZhbmNpbmdSZXN1bHQ6IE0uY2FsbChcbiAgICAgICAgICBtYWtlQWR2YW5jZURldGFpbHNTaGFwZShVU0RDKSxcbiAgICAgICAgICBNLmJvb2xlYW4oKVxuICAgICAgICApLnJldHVybnMoKSxcbiAgICAgICAgY2hlY2tNaW50ZWRFYXJseTogTS5jYWxsKENjdHBUeEV2aWRlbmNlU2hhcGUsIE0uc3RyaW5nKCkpLnJldHVybnMoXG4gICAgICAgICAgTS5ib29sZWFuKClcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICBzZWxmOiBNLmludGVyZmFjZShcIlNldHRsZXJTZWxmSVwiLCB7XG4gICAgICAgIGFkZE1pbnRlZEVhcmx5OiBNLmNhbGwoTS5zdHJpbmcoKSwgVXNkY0Ftb3VudFNoYXBlKS5yZXR1cm5zKCksXG4gICAgICAgIGRpc2J1cnNlOiBNLmNhbGwoRXZtSGFzaFNoYXBlLCBVc2RjQW1vdW50U2hhcGUsIE0uc3RyaW5nKCkpLnJldHVybnMoXG4gICAgICAgICAgTS5wcm9taXNlKClcbiAgICAgICAgKSxcbiAgICAgICAgZm9yd2FyZDogTS5jYWxsKEV2bUhhc2hTaGFwZSwgVXNkY0Ftb3VudFNoYXBlLCBNLnN0cmluZygpKS5yZXR1cm5zKClcbiAgICAgIH0pLFxuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIHRyYW5zZmVySGFuZGxlcjogTS5pbnRlcmZhY2UoXCJTZXR0bGVyVHJhbnNmZXJJXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnVuZGVmaW5lZCgpLCBNLnN0cmluZygpKS5yZXR1cm5zKCksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIE0uc3RyaW5nKCkpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICBpbnRlcm1lZGlhdGVUcmFuc2ZlckhhbmRsZXI6IE0uaW50ZXJmYWNlKFwiU2V0dGxlckludGVybWVkaWF0ZVRyYW5zZmVySVwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS51bmRlZmluZWQoKSwgTS5yZWNvcmQoKSkucmV0dXJucygpLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5lcnJvcigpLCBNLnJlY29yZCgpKS5yZXR1cm5zKClcbiAgICAgIH0pLFxuICAgICAgZGVwb3NpdEZvckJ1cm5IYW5kbGVyOiBNLmludGVyZmFjZShcIlNldHRsZXJEZXBvc2l0Rm9yQnVybklcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0udW5kZWZpbmVkKCksIE0uc3RyaW5nKCkpLnJldHVybnMoKSxcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uZXJyb3IoKSwgTS5zdHJpbmcoKSkucmV0dXJucygpXG4gICAgICB9KVxuICAgIH0sXG4gICAgKGNvbmZpZykgPT4ge1xuICAgICAgbG9nKFwiY29uZmlnXCIsIGNvbmZpZyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5jb25maWcsXG4gICAgICAgIC8vXG4gICAgICAgIGludGVybWVkaWF0ZVJlY2lwaWVudDogdm9pZCAwLFxuICAgICAgICByZWdpc3RyYXRpb246IHZvaWQgMCxcbiAgICAgICAgbWludGVkRWFybHk6IHpvbmUuZGV0YWNoZWQoKS5tYXBTdG9yZShcIm1pbnRlZEVhcmx5XCIpXG4gICAgICB9O1xuICAgIH0sXG4gICAge1xuICAgICAgY3JlYXRvcjoge1xuICAgICAgICAvL1xuICAgICAgICBhc3luYyBtb25pdG9yTWludGluZ0RlcG9zaXRzKCkge1xuICAgICAgICAgIGNvbnN0IHsgc2V0dGxlbWVudEFjY291bnQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgcmVnaXN0cmF0aW9uID0gYXdhaXQgdm93VG9vbHMud2hlbihcbiAgICAgICAgICAgIHNldHRsZW1lbnRBY2NvdW50Lm1vbml0b3JUcmFuc2ZlcnModGhpcy5mYWNldHMudGFwKVxuICAgICAgICAgICk7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZihyZWdpc3RyYXRpb24sIFwib2JqZWN0XCIpO1xuICAgICAgICAgIHRoaXMuc3RhdGUucmVnaXN0cmF0aW9uID0gcmVnaXN0cmF0aW9uO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICByZW1lZGlhdGVNaW50ZWRFYXJseShtaW5VdXNkYykge1xuICAgICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgeyBtaW50ZWRFYXJseSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBsb2coXCJyZW1lZGlhdGVNaW50ZWRFYXJseVwiLCBtaW5VdXNkYywgWy4uLm1pbnRlZEVhcmx5LmtleXMoKV0pO1xuICAgICAgICAgIGNvbnN0IGJhdGNoZXMgPSBtaW50ZWRFYXJseS5lbnRyaWVzKCk7XG4gICAgICAgICAgZm9yIChjb25zdCBba2V5LCBjb3VudF0gb2YgYmF0Y2hlcykge1xuICAgICAgICAgICAgY29uc3QgeyBhZGRyZXNzLCBhbW91bnQgfSA9IHBhcnNlTWludGVkRWFybHlLZXkoa2V5KTtcbiAgICAgICAgICAgIGlmIChhbW91bnQgPCBtaW5VdXNkYykge1xuICAgICAgICAgICAgICBsb2coXCJza2lwcGluZ1wiLCBrZXksIFwibGVzcyB0aGFuXCIsIG1pblV1c2RjKTtcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBhbGxQZW5kaW5nID0gc3RhdHVzTWFuYWdlci5sb29rdXBQZW5kaW5nKGFkZHJlc3MsIGFtb3VudCk7XG4gICAgICAgICAgICBpZiAoYWxsUGVuZGluZy5zb21lKFxuICAgICAgICAgICAgICAoeyBzdGF0dXMgfSkgPT4gc3RhdHVzICE9PSBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZWRcbiAgICAgICAgICAgICkpIHtcbiAgICAgICAgICAgICAgbG9nKFwiXFx1ezFGNkE4fSBwZW5kaW5nIHR4cyBpbmNsdWRlZCBvbmUgbm90IGFkdmFuY2VkXCIsIGFsbFBlbmRpbmcpO1xuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBjb3VudDsgaTIgKz0gMSkge1xuICAgICAgICAgICAgICBjb25zdCBwZW5kaW5nVHhzID0gc3RhdHVzTWFuYWdlci5tYXRjaEFuZERlcXVldWVTZXR0bGVtZW50KFxuICAgICAgICAgICAgICAgIGFkZHJlc3MsXG4gICAgICAgICAgICAgICAgYW1vdW50XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIGZvciAoY29uc3QgcDMgb2YgcGVuZGluZ1R4cykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZ1bGxWYWx1ZSA9IEFtb3VudE1hdGgubWFrZShVU0RDLCBwMy50eC5hbW91bnQpO1xuICAgICAgICAgICAgICAgIHZvaWQgc2VsZi5kaXNidXJzZShwMy50eEhhc2gsIGZ1bGxWYWx1ZSwgcDMuYXV4LnJlY2lwaWVudEFkZHJlc3MpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIG1pbnRlZEVhcmx5LmRlbGV0ZShrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRhcDoge1xuICAgICAgICBhc3luYyByZWNlaXZlVXBjYWxsKGV2ZW50KSB7XG4gICAgICAgICAgbG9nKFwidXBjYWxsIGV2ZW50XCIsIGV2ZW50LnBhY2tldC5zZXF1ZW5jZSwgZXZlbnQuYmxvY2tUaW1lKTtcbiAgICAgICAgICBjb25zdCB7IHNvdXJjZUNoYW5uZWwsIHJlbW90ZURlbm9tIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGNvbnN0IHsgcGFja2V0IH0gPSBldmVudDtcbiAgICAgICAgICBpZiAocGFja2V0LnNvdXJjZV9jaGFubmVsICE9PSBzb3VyY2VDaGFubmVsKSB7XG4gICAgICAgICAgICBjb25zdCB7IHNvdXJjZV9jaGFubmVsOiBhY3R1YWwgfSA9IHBhY2tldDtcbiAgICAgICAgICAgIGlmIChwYWNrZXQuZGVzdGluYXRpb25fY2hhbm5lbCAhPT0gc291cmNlQ2hhbm5lbCkge1xuICAgICAgICAgICAgICBsb2coXCJcXHUyNkEwXFx1RkUwRiB1bmV4cGVjdGVkIGNoYW5uZWxcIiwgeyBhY3R1YWwsIGV4cGVjdGVkOiBzb3VyY2VDaGFubmVsIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBkZWNvZGVkID0gZGVjb2RlRXZlbnRQYWNrZXQoZXZlbnQucGFja2V0LCByZW1vdGVEZW5vbSk7XG4gICAgICAgICAgaWYgKFwiZXJyb3JcIiBpbiBkZWNvZGVkKSB7XG4gICAgICAgICAgICBsb2coXCJpbnZhbGlkIGV2ZW50IHBhY2tldFwiLCBkZWNvZGVkLmVycm9yKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgeyBuZmEsIGFtb3VudCwgRVVEIH0gPSBkZWNvZGVkO1xuICAgICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgZGVxdWV1ZWQgPSBzdGF0dXNNYW5hZ2VyLm1hdGNoQW5kRGVxdWV1ZVNldHRsZW1lbnQobmZhLCBhbW91bnQpO1xuICAgICAgICAgIGlmIChkZXF1ZXVlZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGxvZyhcIlxcdTI2QTBcXHVGRTBGIHRhcDogbWludGVkIGJlZm9yZSBvYnNlcnZlZFwiLCBuZmEsIGFtb3VudCk7XG4gICAgICAgICAgICBzZWxmLmFkZE1pbnRlZEVhcmx5KG5mYSwgQW1vdW50TWF0aC5tYWtlKFVTREMsIGFtb3VudCkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBsb2coXCJkZXF1ZXVlZFwiLCBkZXF1ZXVlZCwgXCJmb3JcIiwgbmZhLCBhbW91bnQpO1xuICAgICAgICAgIGZvciAoY29uc3QgZm91bmQgb2YgZGVxdWV1ZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IGZ1bGxWYWx1ZSA9IEFtb3VudE1hdGgubWFrZShVU0RDLCBmb3VuZC50eC5hbW91bnQpO1xuICAgICAgICAgICAgc3dpdGNoIChmb3VuZC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgY2FzZSBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZWQ6XG4gICAgICAgICAgICAgICAgdm9pZCBzZWxmLmRpc2J1cnNlKGZvdW5kLnR4SGFzaCwgZnVsbFZhbHVlLCBFVUQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlIFBlbmRpbmdUeFN0YXR1cy5BZHZhbmNpbmc6XG4gICAgICAgICAgICAgICAgbG9nKFwiXFx1MjZBMFxcdUZFMEYgdGFwOiBtaW50ZWQgd2hpbGUgYWR2YW5jaW5nXCIsIG5mYSwgZm91bmQudHguYW1vdW50KTtcbiAgICAgICAgICAgICAgICBzZWxmLmFkZE1pbnRlZEVhcmx5KG5mYSwgZnVsbFZhbHVlKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZVNraXBwZWQ6XG4gICAgICAgICAgICAgIGNhc2UgUGVuZGluZ1R4U3RhdHVzLkFkdmFuY2VGYWlsZWQ6XG4gICAgICAgICAgICAgICAgc2VsZi5mb3J3YXJkKGZvdW5kLnR4SGFzaCwgZnVsbFZhbHVlLCBFVUQpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGxvZyhcIlxcdTI2QTBcXHVGRTBGIHVuZXhwZWN0ZWQgc3RhdHVzXCIsIGZvdW5kLnN0YXR1cywgXCJmb3JcIiwgZm91bmQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG5vdGlmaWVyOiB7XG4gICAgICAgIG5vdGlmeUFkdmFuY2luZ1Jlc3VsdCh7XG4gICAgICAgICAgdHhIYXNoLFxuICAgICAgICAgIGZvcndhcmRpbmdBZGRyZXNzLFxuICAgICAgICAgIGZ1bGxBbW91bnQsXG4gICAgICAgICAgZGVzdGluYXRpb246IGRlc3RBcmdcbiAgICAgICAgfSwgc3VjY2Vzcykge1xuICAgICAgICAgIGNvbnN0IHsgbWludGVkRWFybHkgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyB2YWx1ZTogZnVsbFZhbHVlIH0gPSBmdWxsQW1vdW50O1xuICAgICAgICAgIGNvbnN0IGtleSA9IG1ha2VNaW50ZWRFYXJseUtleShmb3J3YXJkaW5nQWRkcmVzcywgZnVsbFZhbHVlKTtcbiAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvbiA9IGNvZXJjZUFjY291bnRJZChkZXN0QXJnKTtcbiAgICAgICAgICBpZiAobWludGVkRWFybHkuaGFzKGtleSkpIHtcbiAgICAgICAgICAgIGFzTXVsdGlzZXQobWludGVkRWFybHkpLnJlbW92ZShrZXkpO1xuICAgICAgICAgICAgc3RhdHVzTWFuYWdlci5hZHZhbmNlT3V0Y29tZUZvck1pbnRlZEVhcmx5KHR4SGFzaCwgc3VjY2Vzcyk7XG4gICAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgICB2b2lkIHRoaXMuZmFjZXRzLnNlbGYuZGlzYnVyc2UodHhIYXNoLCBmdWxsQW1vdW50LCBkZXN0aW5hdGlvbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB2b2lkIHRoaXMuZmFjZXRzLnNlbGYuZm9yd2FyZCh0eEhhc2gsIGZ1bGxBbW91bnQsIGRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RhdHVzTWFuYWdlci5hZHZhbmNlT3V0Y29tZShcbiAgICAgICAgICAgICAgZm9yd2FyZGluZ0FkZHJlc3MsXG4gICAgICAgICAgICAgIGZ1bGxWYWx1ZSxcbiAgICAgICAgICAgICAgc3VjY2VzcyxcbiAgICAgICAgICAgICAgeyBkZXN0aW5hdGlvbiB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGNoZWNrTWludGVkRWFybHkoZXZpZGVuY2UsIGRlc3RpbmF0aW9uKSB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgdHg6IHsgZm9yd2FyZGluZ0FkZHJlc3MsIGFtb3VudCB9LFxuICAgICAgICAgICAgdHhIYXNoXG4gICAgICAgICAgfSA9IGV2aWRlbmNlO1xuICAgICAgICAgIGNvbnN0IGtleSA9IG1ha2VNaW50ZWRFYXJseUtleShmb3J3YXJkaW5nQWRkcmVzcywgYW1vdW50KTtcbiAgICAgICAgICBjb25zdCB7IG1pbnRlZEVhcmx5IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChtaW50ZWRFYXJseS5oYXMoa2V5KSkge1xuICAgICAgICAgICAgbG9nKFxuICAgICAgICAgICAgICBcIm1hdGNoZWQgbWludGVkIGVhcmx5IGtleSwgaW5pdGlhdGluZyBmb3J3YXJkXCIsXG4gICAgICAgICAgICAgIGZvcndhcmRpbmdBZGRyZXNzLFxuICAgICAgICAgICAgICBhbW91bnRcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBhc011bHRpc2V0KG1pbnRlZEVhcmx5KS5yZW1vdmUoa2V5KTtcbiAgICAgICAgICAgIHN0YXR1c01hbmFnZXIuYWR2YW5jZU91dGNvbWVGb3JVbmtub3duTWludChldmlkZW5jZSk7XG4gICAgICAgICAgICB2b2lkIHRoaXMuZmFjZXRzLnNlbGYuZm9yd2FyZChcbiAgICAgICAgICAgICAgdHhIYXNoLFxuICAgICAgICAgICAgICBBbW91bnRNYXRoLm1ha2UoVVNEQywgYW1vdW50KSxcbiAgICAgICAgICAgICAgZGVzdGluYXRpb25cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgc2VsZjoge1xuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgYWRkTWludGVkRWFybHkoYWRkcmVzcywgYW1vdW50KSB7XG4gICAgICAgICAgY29uc3Qga2V5ID0gbWFrZU1pbnRlZEVhcmx5S2V5KGFkZHJlc3MsIGFtb3VudC52YWx1ZSk7XG4gICAgICAgICAgY29uc3QgeyBtaW50ZWRFYXJseSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBhc011bHRpc2V0KG1pbnRlZEVhcmx5KS5hZGQoa2V5KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICAvL1xuICAgICAgICBhc3luYyBkaXNidXJzZSh0eEhhc2gsIHJlY2VpdmVkLCBFVUQpIHtcbiAgICAgICAgICBjb25zdCB7IHJlcGF5ZXIsIHNldHRsZW1lbnRBY2NvdW50IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGNvbnN0IHsgemNmU2VhdDogc2V0dGxpbmdTZWF0IH0gPSB6Y2YubWFrZUVtcHR5U2VhdEtpdCgpO1xuICAgICAgICAgIGNvbnN0IHsgY2FsY3VsYXRlU3BsaXQgfSA9IG1ha2VGZWVUb29scyhmZWVDb25maWcpO1xuICAgICAgICAgIGNvbnN0IGFjY291bnRJZCA9IGNoYWluSHViLnJlc29sdmVBY2NvdW50SWQoRVVEKTtcbiAgICAgICAgICBjb25zdCBzcGxpdCA9IGNhbGN1bGF0ZVNwbGl0KHJlY2VpdmVkLCBhY2NvdW50SWQpO1xuICAgICAgICAgIGxvZyhcImRpc2J1cnNpbmdcIiwgc3BsaXQpO1xuICAgICAgICAgIGF3YWl0IHZvd1Rvb2xzLndoZW4oXG4gICAgICAgICAgICB3aXRoZHJhd1RvU2VhdChcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgc2V0dGxlbWVudEFjY291bnQsXG4gICAgICAgICAgICAgIHNldHRsaW5nU2VhdCxcbiAgICAgICAgICAgICAgaGFyZGVuKHsgSW46IHJlY2VpdmVkIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCB0cmFuc2ZlclBhcnQgPSBmcm9tT25seShzZXR0bGluZ1NlYXQsIHsgSW46IHJlY2VpdmVkIH0pO1xuICAgICAgICAgIHJlcGF5ZXIucmVwYXkodHJhbnNmZXJQYXJ0LCBzcGxpdCk7XG4gICAgICAgICAgc2V0dGxpbmdTZWF0LmV4aXQoKTtcbiAgICAgICAgICBzdGF0dXNNYW5hZ2VyLmRpc2J1cnNlZCh0eEhhc2gsIHNwbGl0KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBmb3J3YXJkKHR4SGFzaCwgZnVsbFZhbHVlLCBFVUQpIHtcbiAgICAgICAgICBsb2coXCJmb3J3YXJkaW5nXCIsIGZ1bGxWYWx1ZS52YWx1ZSwgXCJ0b1wiLCBFVUQsIFwiZm9yXCIsIHR4SGFzaCk7XG4gICAgICAgICAgY29uc3QgZGVzdCA9ICgoKSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICByZXR1cm4gY2hhaW5IdWIucmVzb2x2ZUFjY291bnRJZChFVUQpO1xuICAgICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICAgIGxvZyhcbiAgICAgICAgICAgICAgICBcIlxcdTI2QTBcXHVGRTBGIGZvcndhcmQgbm90IGF0dGVtcHRlZFwiLFxuICAgICAgICAgICAgICAgIFwidW5yZXNvbHZhYmxlIGRlc3RpbmF0aW9uXCIsXG4gICAgICAgICAgICAgICAgdHhIYXNoLFxuICAgICAgICAgICAgICAgIEVVRFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICBzdGF0dXNNYW5hZ2VyLmZvcndhcmRTa2lwcGVkKHR4SGFzaCk7XG4gICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgaWYgKCFkZXN0KSByZXR1cm47XG4gICAgICAgICAgdm9pZCBmb3J3YXJkRnVuZHMyKHsgdHhIYXNoLCBhbW91bnQ6IGZ1bGxWYWx1ZSwgZGVzdGluYXRpb246IGRlc3QgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICB0cmFuc2ZlckhhbmRsZXI6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoX3Jlc3VsdCwgdHhIYXNoKSB7XG4gICAgICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkZWQodHhIYXNoKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZWplY3RlZChyZWFzb24sIHR4SGFzaCkge1xuICAgICAgICAgIGxvZyhcIlxcdXsxRjZBOH0gZm9yd2FyZCB0cmFuc2ZlciByZWplY3RlZCFcIiwgcmVhc29uLCB0eEhhc2gpO1xuICAgICAgICAgIHN0YXR1c01hbmFnZXIuZm9yd2FyZEZhaWxlZCh0eEhhc2gpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaW50ZXJtZWRpYXRlVHJhbnNmZXJIYW5kbGVyOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKF9yZXN1bHQsIHtcbiAgICAgICAgICBhbXQsXG4gICAgICAgICAgZGVzdCxcbiAgICAgICAgICB0eEhhc2hcbiAgICAgICAgfSkge1xuICAgICAgICAgIGNvbnN0IG5vYmxlSWNhID0gZ2V0Tm9ibGVJQ0EoKTtcbiAgICAgICAgICB2b2lkIHZvd1Rvb2xzLndhdGNoKFxuICAgICAgICAgICAgRShub2JsZUljYSkuZGVwb3NpdEZvckJ1cm4oZGVzdCwgYW10KSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLmRlcG9zaXRGb3JCdXJuSGFuZGxlcixcbiAgICAgICAgICAgIHR4SGFzaFxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCB7IHR4SGFzaCB9KSB7XG4gICAgICAgICAgbG9nKFwiXFx1ezFGNkE4fSBmb3J3YXJkIGludGVybWVkaWF0ZSB0cmFuc2ZlciByZWplY3RlZCFcIiwgcmVhc29uLCB0eEhhc2gpO1xuICAgICAgICAgIHN0YXR1c01hbmFnZXIuZm9yd2FyZEZhaWxlZCh0eEhhc2gpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGVwb3NpdEZvckJ1cm5IYW5kbGVyOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKF9yZXN1bHQsIHR4SGFzaCkge1xuICAgICAgICAgIHN0YXR1c01hbmFnZXIuZm9yd2FyZGVkKHR4SGFzaCk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCB0eEhhc2gpIHtcbiAgICAgICAgICBsb2coXCJcXHV7MUY2QTh9IGZvcndhcmQgZGVwb3NpdEZvckJ1cm4gcmVqZWN0ZWQhXCIsIHJlYXNvbiwgdHhIYXNoKTtcbiAgICAgICAgICBzdGF0dXNNYW5hZ2VyLmZvcndhcmRGYWlsZWQodHhIYXNoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICB9LFxuICAgIHtcbiAgICAgIHN0YXRlU2hhcGU6IHN0YXRlU2hhcGUzXG4gICAgfVxuICApO1xufTtcbmhhcmRlbihwcmVwYXJlU2V0dGxlcik7XG5cbi8vXG52YXIgRm9yd2FyZEZhaWxlZFR4U2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgZGVzdGluYXRpb246IE0uc3RyaW5nKCksXG4gICAgYW1vdW50OiBNLmJpZ2ludCgpLFxuICAgIHR4SGFzaDogRXZtSGFzaFNoYXBlXG4gIH0sXG4gIHtcbiAgICBjaGFpbklkOiBNLnN0cmluZygpLFxuICAgIGZ1bmRzSW5Ob2JsZUljYTogTS5ib29sZWFuKClcbiAgfVxuKTtcblxuLy9cbnZhciBtYWtlUm91dGVIZWFsdGggPSAobWF4RmFpbHVyZXMpID0+IHtcbiAgY29uc3QgZmFpbHVyZXMgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBjb25zdCBnZXRGYWlsdXJlQ291bnQgPSAocm91dGUpID0+IGZhaWx1cmVzLmdldChyb3V0ZSkgPz8gMDtcbiAgbGV0IGhhbmRsZXJzID0ge1xuICAgIG9uRWFjaEZhaWx1cmU6IChfcm91dGUpID0+IHtcbiAgICB9LFxuICAgIG9uRWFjaFN1Y2Nlc3M6IChfcm91dGUpID0+IHtcbiAgICB9LFxuICAgIG9uV29ya2luZzogKF9yb3V0ZSkgPT4ge1xuICAgIH0sXG4gICAgb25EZXJlbGljdDogKF9yb3V0ZSkgPT4ge1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBub3RlRmFpbHVyZTogKHJvdXRlKSA9PiB7XG4gICAgICBjb25zdCBvbGRDb3VudCA9IGdldEZhaWx1cmVDb3VudChyb3V0ZSk7XG4gICAgICBjb25zdCBuZXdDb3VudCA9IG9sZENvdW50ICsgMTtcbiAgICAgIGZhaWx1cmVzLnNldChyb3V0ZSwgbmV3Q291bnQpO1xuICAgICAgaGFuZGxlcnMub25FYWNoRmFpbHVyZShyb3V0ZSk7XG4gICAgICBpZiAobmV3Q291bnQgPT09IG1heEZhaWx1cmVzICYmIG9sZENvdW50IDwgbWF4RmFpbHVyZXMpIHtcbiAgICAgICAgaGFuZGxlcnMub25EZXJlbGljdChyb3V0ZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBub3RlU3VjY2VzczogKHJvdXRlKSA9PiB7XG4gICAgICBjb25zdCBvbGRDb3VudCA9IGdldEZhaWx1cmVDb3VudChyb3V0ZSk7XG4gICAgICBmYWlsdXJlcy5kZWxldGUocm91dGUpO1xuICAgICAgaGFuZGxlcnMub25FYWNoU3VjY2Vzcyhyb3V0ZSk7XG4gICAgICBpZiAob2xkQ291bnQgPj0gbWF4RmFpbHVyZXMpIHtcbiAgICAgICAgaGFuZGxlcnMub25Xb3JraW5nKHJvdXRlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qXG5cbiAgICAgKi9cbiAgICBpc1dvcmtpbmc6IChyb3V0ZSkgPT4ge1xuICAgICAgcmV0dXJuIGdldEZhaWx1cmVDb3VudChyb3V0ZSkgPCBtYXhGYWlsdXJlcztcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICBzZXRFdmVudEhhbmRsZXJzOiAoY2IpID0+IHtcbiAgICAgIGhhbmRsZXJzID0geyAuLi5oYW5kbGVycywgLi4uY2IgfTtcbiAgICB9XG4gIH07XG59O1xuXG4vL1xudmFyIE1BWF9NQVRDSF9ERVBUSCA9IDI1O1xudmFyIGNvbXBhcmVQZW5kaW5nVHhEZXNjID0gKGEyLCBiMykgPT4gTnVtYmVyKGIzLnR4LmFtb3VudCAtIGEyLnR4LmFtb3VudCk7XG5oYXJkZW4oY29tcGFyZVBlbmRpbmdUeERlc2MpO1xudmFyIGdyZWVkeU1hdGNoID0gKHBlbmRpbmcsIHRhcmdldCkgPT4ge1xuICBpZiAodGFyZ2V0ID09PSAwbikgcmV0dXJuIFtdO1xuICBpZiAocGVuZGluZy5sZW5ndGggPT09IDApIHJldHVybiBbXTtcbiAgY29uc3QgZGVhZEVuZHMgPSAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICBjb25zdCBwYXRoID0gW107XG4gIGNvbnN0IGRmcyA9IChpbmRleCwgc3VtKSA9PiB7XG4gICAgaWYgKHN1bSA9PT0gdGFyZ2V0KSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAoc3VtID4gdGFyZ2V0KSB7XG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgYGludGVybmFsOiB0YXJnZXQgZXhjZWVkZWQgZm9yICR7cGVuZGluZ1swXS50eC5mb3J3YXJkaW5nQWRkcmVzc31gXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAocGF0aC5sZW5ndGggPj0gTUFYX01BVENIX0RFUFRIKVxuICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgIGBNQVhfTUFUQ0hfREVQVEg6ICR7TUFYX01BVENIX0RFUFRIfSBleGNlZWRlZCBmb3IgJHtwZW5kaW5nWzBdLnR4LmZvcndhcmRpbmdBZGRyZXNzfWBcbiAgICAgICk7XG4gICAgaWYgKGluZGV4ID49IHBlbmRpbmcubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG4gICAgY29uc3Qga2V5ID0gYCR7aW5kZXh9OiR7c3VtfWA7XG4gICAgaWYgKGRlYWRFbmRzLmhhcyhrZXkpKSByZXR1cm4gZmFsc2U7XG4gICAgZm9yIChsZXQgaTIgPSBpbmRleDsgaTIgPCBwZW5kaW5nLmxlbmd0aDsgaTIgKz0gMSkge1xuICAgICAgY29uc3QgdHggPSBwZW5kaW5nW2kyXTtcbiAgICAgIGNvbnN0IG5leHRTdW0gPSBzdW0gKyB0eC50eC5hbW91bnQ7XG4gICAgICBpZiAobmV4dFN1bSA+IHRhcmdldCkgY29udGludWU7XG4gICAgICBwYXRoLnB1c2godHgpO1xuICAgICAgaWYgKGRmcyhpMiArIDEsIG5leHRTdW0pKSByZXR1cm4gdHJ1ZTtcbiAgICAgIHBhdGgucG9wKCk7XG4gICAgfVxuICAgIGRlYWRFbmRzLmFkZChrZXkpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcbiAgcmV0dXJuIGRmcygwLCAwbikgPyBwYXRoIDogW107XG59O1xuaGFyZGVuKGdyZWVkeU1hdGNoKTtcbnZhciBtYWtlU2V0dGxlbWVudE1hdGNoZXIgPSAoKSA9PiB7XG4gIGNvbnN0IGFkZFBlbmRpbmdTZXR0bGVUeCA9IChwZW5kaW5nU2V0dGxlVHhzLCBwZW5kaW5nKSA9PiB7XG4gICAgY29uc3QgbmZhID0gcGVuZGluZy50eC5mb3J3YXJkaW5nQWRkcmVzcztcbiAgICBpZiAoIXBlbmRpbmdTZXR0bGVUeHMuaGFzKG5mYSkpIHtcbiAgICAgIHBlbmRpbmdTZXR0bGVUeHMuaW5pdChuZmEsIGhhcmRlbihbcGVuZGluZ10pKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgbGlzdCA9IFsuLi5wZW5kaW5nU2V0dGxlVHhzLmdldChuZmEpXTtcbiAgICBpbnNlcnRJbnRvU29ydGVkQXJyYXkobGlzdCwgcGVuZGluZywgY29tcGFyZVBlbmRpbmdUeERlc2MpO1xuICAgIHBlbmRpbmdTZXR0bGVUeHMuc2V0KG5mYSwgaGFyZGVuKGxpc3QpKTtcbiAgfTtcbiAgY29uc3QgbWF0Y2hBbmREZXF1ZXVlU2V0dGxlbWVudCA9IChwZW5kaW5nU2V0dGxlVHhzLCBuZmEsIGFtb3VudCkgPT4ge1xuICAgIGlmICghcGVuZGluZ1NldHRsZVR4cy5oYXMobmZhKSkgcmV0dXJuIFtdO1xuICAgIGNvbnN0IGxpc3QgPSBwZW5kaW5nU2V0dGxlVHhzLmdldChuZmEpO1xuICAgIGNvbnN0IGl4ID0gbGlzdC5maW5kSW5kZXgoKHR4KSA9PiB0eC50eC5hbW91bnQgPT09IGFtb3VudCk7XG4gICAgaWYgKGl4ID49IDApIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gbGlzdFtpeF07XG4gICAgICBpZiAobGlzdC5sZW5ndGggPiAxKSB7XG4gICAgICAgIGNvbnN0IHJlbWFpbmluZyA9IFsuLi5saXN0LnNsaWNlKDAsIGl4KSwgLi4ubGlzdC5zbGljZShpeCArIDEpXTtcbiAgICAgICAgcGVuZGluZ1NldHRsZVR4cy5zZXQobmZhLCBoYXJkZW4ocmVtYWluaW5nKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwZW5kaW5nU2V0dGxlVHhzLmRlbGV0ZShuZmEpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGhhcmRlbihbbWF0Y2hdKTtcbiAgICB9XG4gICAgY29uc3QgY29tYm8gPSBncmVlZHlNYXRjaChsaXN0LCBhbW91bnQpO1xuICAgIGlmIChjb21iby5sZW5ndGgpIHtcbiAgICAgIGlmIChjb21iby5sZW5ndGggIT09IGxpc3QubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IG1hdGNoZWRTZXQgPSBuZXcgU2V0KGNvbWJvKTtcbiAgICAgICAgY29uc3QgcmVtYWluaW5nID0gbGlzdC5maWx0ZXIoKHR4KSA9PiAhbWF0Y2hlZFNldC5oYXModHgpKTtcbiAgICAgICAgcGVuZGluZ1NldHRsZVR4cy5zZXQobmZhLCBoYXJkZW4ocmVtYWluaW5nKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwZW5kaW5nU2V0dGxlVHhzLmRlbGV0ZShuZmEpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaGFyZGVuKGNvbWJvKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IGFkZFBlbmRpbmdTZXR0bGVUeCwgbWF0Y2hBbmREZXF1ZXVlU2V0dGxlbWVudCB9KTtcbn07XG5cbi8vXG52YXIgc3RhdGVTaGFwZTQgPSBoYXJkZW4oe1xuICBwZW5kaW5nU2V0dGxlVHhzOiBNLnJlbW90YWJsZSgpLFxuICBzZWVuVHhzOiBNLnJlbW90YWJsZSgpLFxuICBzdG9yZWRDb21wbGV0ZWRUeHM6IE0ucmVtb3RhYmxlKClcbn0pO1xudmFyIHByZXBhcmVTdGF0dXNNYW5hZ2VyID0gKHpvbmUsIHR4bnNOb2RlLCB7IG1hcnNoYWxsZXIsIHJvdXRlSGVhbHRoIH0pID0+IHtcbiAgY29uc3QgcGVuZGluZ1NldHRsZVR4cyA9IHpvbmUubWFwU3RvcmUoXG4gICAgXCJQZW5kaW5nU2V0dGxlVHhzXCIsXG4gICAge1xuICAgICAga2V5U2hhcGU6IE0uc3RyaW5nKCksXG4gICAgICB2YWx1ZVNoYXBlOiBNLmFycmF5T2YoUGVuZGluZ1R4U2hhcGUpXG4gICAgfVxuICApO1xuICBjb25zdCB7IGFkZFBlbmRpbmdTZXR0bGVUeCwgbWF0Y2hBbmREZXF1ZXVlU2V0dGxlbWVudCB9ID0gbWFrZVNldHRsZW1lbnRNYXRjaGVyKCk7XG4gIGNvbnN0IG1ldGEyID0gem9uZS5tYXBTdG9yZShcIk1ldGFkYXRhXCIsIHtcbiAgICBrZXlTaGFwZTogTS5zdHJpbmcoKVxuICB9KTtcbiAgY29uc3Qgc2NoZW1hVmVyc2lvbiA9IE5hdChcbiAgICBtZXRhMi5oYXMoXCJzY2hlbWFWZXJzaW9uXCIpID8gbWV0YTIuZ2V0KFwic2NoZW1hVmVyc2lvblwiKSA6IDBuXG4gICk7XG4gIGlmIChzY2hlbWFWZXJzaW9uIDwgMW4pIHtcbiAgICBjb25zdCBvbGRWYWx1ZXMgPSBbLi4ucGVuZGluZ1NldHRsZVR4cy52YWx1ZXMoKV07XG4gICAgcGVuZGluZ1NldHRsZVR4cy5jbGVhcigpO1xuICAgIGZvciAoY29uc3QgdHhzIG9mIG9sZFZhbHVlcykge1xuICAgICAgZm9yIChjb25zdCB0eCBvZiB0eHMpIHtcbiAgICAgICAgYWRkUGVuZGluZ1NldHRsZVR4KHBlbmRpbmdTZXR0bGVUeHMsIHR4KTtcbiAgICAgIH1cbiAgICB9XG4gICAgbWV0YTIuaW5pdChcInNjaGVtYVZlcnNpb25cIiwgMW4pO1xuICB9XG4gIGNvbnN0IHNlZW5UeHMgPSB6b25lLm1hcFN0b3JlKFwiU2VlblR4c1wiLCB7XG4gICAga2V5U2hhcGU6IE0uc3RyaW5nKCksXG4gICAgdmFsdWVTaGFwZTogTS5uYXQoKVxuICB9KTtcbiAgY29uc3QgZmFpbGVkRm9yd2FyZHMgPSB6b25lLm1hcFN0b3JlKFxuICAgIFwiRmFpbGVkRm9yd2FyZHNcIixcbiAgICB7XG4gICAgICBrZXlTaGFwZTogRXZtSGFzaFNoYXBlLFxuICAgICAgdmFsdWVTaGFwZTogRm9yd2FyZEZhaWxlZFR4U2hhcGVcbiAgICB9XG4gICk7XG4gIGNvbnN0IGZvcndhcmRJblByb2dyZXNzID0gem9uZS5zZXRTdG9yZShcbiAgICBcIkZvcndhcmRJblByb2dyZXNzXCIsXG4gICAge1xuICAgICAga2V5U2hhcGU6IE0uc3RyaW5nKClcbiAgICB9XG4gICk7XG4gIGNvbnN0IHN0b3JlZENvbXBsZXRlZFR4cyA9IHpvbmUuc2V0U3RvcmUoXG4gICAgXCJTdG9yZWRDb21wbGV0ZWRUeHNcIixcbiAgICB7XG4gICAgICBrZXlTaGFwZTogTS5zdHJpbmcoKVxuICAgIH1cbiAgKTtcbiAgY29uc3Qgbm90ZVJvdXRlSGVhbHRoID0gKHR4LCBpc1dvcmtpbmcpID0+IHtcbiAgICBjb25zdCBjaGFpbklkID0gY2hhaW5PZkFjY291bnQodHguZGVzdGluYXRpb24pO1xuICAgIGlmIChpc1dvcmtpbmcpIHtcbiAgICAgIHJvdXRlSGVhbHRoLm5vdGVTdWNjZXNzKGNoYWluSWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICByb3V0ZUhlYWx0aC5ub3RlRmFpbHVyZShjaGFpbklkKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHB1Ymxpc2hUeG5SZWNvcmQgPSAodHhJZCwgcmVjb3JkKSA9PiB7XG4gICAgY29uc3QgdHhOb2RlID0gRSh0eG5zTm9kZSkubWFrZUNoaWxkTm9kZSh0eElkLCB7XG4gICAgICBzZXF1ZW5jZTogdHJ1ZVxuICAgICAgLy9cbiAgICB9KTtcbiAgICBpZiAocmVjb3JkLnN0YXR1cyAmJiBUZXJtaW5hbFR4U3RhdHVzW3JlY29yZC5zdGF0dXNdKSB7XG4gICAgICBzdG9yZWRDb21wbGV0ZWRUeHMuYWRkKHR4SWQpO1xuICAgIH1cbiAgICB2b2lkIEUud2hlbihcbiAgICAgIEUobWFyc2hhbGxlcikudG9DYXBEYXRhKHJlY29yZCksXG4gICAgICAoY2FwRGF0YSkgPT4gRSh0eE5vZGUpLnNldFZhbHVlKEpTT04uc3RyaW5naWZ5KGNhcERhdGEpKVxuICAgICk7XG4gIH07XG4gIGNvbnN0IHB1Ymxpc2hFdmlkZW5jZSA9IChoYXNoLCBldmlkZW5jZSkgPT4ge1xuICAgIHB1Ymxpc2hUeG5SZWNvcmQoaGFzaCwgaGFyZGVuKHsgZXZpZGVuY2UsIHN0YXR1czogVHhTdGF0dXMuT2JzZXJ2ZWQgfSkpO1xuICB9O1xuICBjb25zdCBpbml0UGVuZGluZ1R4ID0gKGV2aWRlbmNlLCBzdGF0dXMsIHJpc2tzSWRlbnRpZmllZCkgPT4ge1xuICAgIGNvbnN0IHsgdHhIYXNoIH0gPSBldmlkZW5jZTtcbiAgICBpZiAoc2VlblR4cy5oYXModHhIYXNoKSkge1xuICAgICAgdGhyb3cgbWFrZUVycm9yKGBUcmFuc2FjdGlvbiBhbHJlYWR5IHNlZW46ICR7cXVvdGUodHhIYXNoKX1gKTtcbiAgICB9XG4gICAgc2VlblR4cy5pbml0KHR4SGFzaCwgZXZpZGVuY2UuYmxvY2tUaW1lc3RhbXApO1xuICAgIGFkZFBlbmRpbmdTZXR0bGVUeChwZW5kaW5nU2V0dGxlVHhzLCB7IC4uLmV2aWRlbmNlLCBzdGF0dXMgfSk7XG4gICAgcHVibGlzaEV2aWRlbmNlKHR4SGFzaCwgZXZpZGVuY2UpO1xuICAgIGlmIChzdGF0dXMgPT09IFBlbmRpbmdUeFN0YXR1cy5BZHZhbmNlU2tpcHBlZCkge1xuICAgICAgcHVibGlzaFR4blJlY29yZCh0eEhhc2gsIGhhcmRlbih7IHN0YXR1cywgcmlza3NJZGVudGlmaWVkIH0pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHVibGlzaFR4blJlY29yZCh0eEhhc2gsIGhhcmRlbih7IHN0YXR1cyB9KSk7XG4gICAgfVxuICB9O1xuICBmdW5jdGlvbiBzZXRQZW5kaW5nVHhTdGF0dXMoeyBuZmEsIGFtb3VudCB9LCBzdGF0dXMpIHtcbiAgICBjb25zdCBwZW5kaW5nID0gcGVuZGluZ1NldHRsZVR4cy5nZXQobmZhKTtcbiAgICBjb25zdCBpeCA9IHBlbmRpbmcuZmluZEluZGV4KFxuICAgICAgKHR4MikgPT4gdHgyLnN0YXR1cyA9PT0gUGVuZGluZ1R4U3RhdHVzLkFkdmFuY2luZyAmJiB0eDIudHguYW1vdW50ID09PSBhbW91bnRcbiAgICApO1xuICAgIGl4ID49IDAgfHwgdGhyb3dSZWRhY3RlZGBubyBhZHZhbmNpbmcgdHggd2l0aCAke3sgbmZhLCBhbW91bnQgfX1gO1xuICAgIGNvbnN0IFtwcmVmaXgsIHR4LCBzdWZmaXhdID0gW1xuICAgICAgcGVuZGluZy5zbGljZSgwLCBpeCksXG4gICAgICBwZW5kaW5nW2l4XSxcbiAgICAgIHBlbmRpbmcuc2xpY2UoaXggKyAxKVxuICAgIF07XG4gICAgY29uc3QgdHhwb3N0ID0geyAuLi50eCwgc3RhdHVzIH07XG4gICAgcGVuZGluZ1NldHRsZVR4cy5zZXQobmZhLCBoYXJkZW4oWy4uLnByZWZpeCwgdHhwb3N0LCAuLi5zdWZmaXhdKSk7XG4gICAgcHVibGlzaFR4blJlY29yZCh0eC50eEhhc2gsIGhhcmRlbih7IHN0YXR1cyB9KSk7XG4gIH1cbiAgcmV0dXJuIHpvbmUuZXhvKFxuICAgIFwiRmFzdCBVU0RDIFN0YXR1cyBNYW5hZ2VyXCIsXG4gICAgTS5pbnRlcmZhY2UoXCJTdGF0dXNNYW5hZ2VySVwiLCB7XG4gICAgICAvL1xuICAgICAgYWR2YW5jZTogTS5jYWxsKENjdHBUeEV2aWRlbmNlU2hhcGUpLnJldHVybnMoKSxcbiAgICAgIGFkdmFuY2VPdXRjb21lOiBNLmNhbGwoTS5zdHJpbmcoKSwgTS5uYXQoKSwgTS5ib29sZWFuKCkpLm9wdGlvbmFsKE0uc3BsaXRSZWNvcmQoeyBkZXN0aW5hdGlvbjogTS5zdHJpbmcoKSB9KSkucmV0dXJucygpLFxuICAgICAgc2tpcEFkdmFuY2U6IE0uY2FsbChDY3RwVHhFdmlkZW5jZVNoYXBlLCBNLmFycmF5T2YoTS5zdHJpbmcoKSkpLnJldHVybnMoKSxcbiAgICAgIGFkdmFuY2VPdXRjb21lRm9yTWludGVkRWFybHk6IE0uY2FsbChFdm1IYXNoU2hhcGUsIE0uYm9vbGVhbigpKS5yZXR1cm5zKCksXG4gICAgICBhZHZhbmNlT3V0Y29tZUZvclVua25vd25NaW50OiBNLmNhbGwoQ2N0cFR4RXZpZGVuY2VTaGFwZSkucmV0dXJucygpLFxuICAgICAgZ2V0Rm9yd2FyZHNUb1JldHJ5OiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhcbiAgICAgICAgTS5hcnJheU9mKEZvcndhcmRGYWlsZWRUeFNoYXBlKVxuICAgICAgKSxcbiAgICAgIGhhc0JlZW5PYnNlcnZlZDogTS5jYWxsKENjdHBUeEV2aWRlbmNlU2hhcGUpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICAgICAgZGVsZXRlQ29tcGxldGVkVHhzOiBNLmNhbGwoKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpLFxuICAgICAgbWF0Y2hBbmREZXF1ZXVlU2V0dGxlbWVudDogTS5jYWxsKE0uc3RyaW5nKCksIE0uYmlnaW50KCkpLnJldHVybnMoXG4gICAgICAgIE0uYXJyYXlPZihcbiAgICAgICAgICBNLnNwbGl0UmVjb3JkKHtcbiAgICAgICAgICAgIHR4SGFzaDogRXZtSGFzaFNoYXBlLFxuICAgICAgICAgICAgc3RhdHVzOiBNLm9yKC4uLk9iamVjdC52YWx1ZXMoUGVuZGluZ1R4U3RhdHVzKSlcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApLFxuICAgICAgZGlzYnVyc2VkOiBNLmNhbGwoRXZtSGFzaFNoYXBlLCBBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUpLnJldHVybnMoXG4gICAgICAgIE0udW5kZWZpbmVkKClcbiAgICAgICksXG4gICAgICBmb3J3YXJkZWQ6IE0uY2FsbChFdm1IYXNoU2hhcGUpLm9wdGlvbmFsKE0uc3BsaXRSZWNvcmQoeyBkZXN0aW5hdGlvbjogTS5zdHJpbmcoKSB9KSkucmV0dXJucygpLFxuICAgICAgZm9yd2FyZEZhaWxlZDogTS5jYWxsKEV2bUhhc2hTaGFwZSkub3B0aW9uYWwoRm9yd2FyZEZhaWxlZFR4U2hhcGUpLnJldHVybnMoKSxcbiAgICAgIGZvcndhcmRpbmc6IE0uY2FsbChFdm1IYXNoU2hhcGUpLnJldHVybnMoKSxcbiAgICAgIGZvcndhcmRTa2lwcGVkOiBNLmNhbGwoRXZtSGFzaFNoYXBlKS5yZXR1cm5zKCksXG4gICAgICBsb29rdXBQZW5kaW5nOiBNLmNhbGwoTS5zdHJpbmcoKSwgTS5iaWdpbnQoKSkucmV0dXJucyhcbiAgICAgICAgTS5hcnJheU9mKFBlbmRpbmdUeFNoYXBlKVxuICAgICAgKVxuICAgIH0pLFxuICAgIHtcbiAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBhZHZhbmNlKGV2aWRlbmNlKSB7XG4gICAgICAgIGluaXRQZW5kaW5nVHgoZXZpZGVuY2UsIFBlbmRpbmdUeFN0YXR1cy5BZHZhbmNpbmcpO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHNraXBBZHZhbmNlKGV2aWRlbmNlLCByaXNrc0lkZW50aWZpZWQpIHtcbiAgICAgICAgaW5pdFBlbmRpbmdUeChcbiAgICAgICAgICBldmlkZW5jZSxcbiAgICAgICAgICBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZVNraXBwZWQsXG4gICAgICAgICAgcmlza3NJZGVudGlmaWVkXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgYWR2YW5jZU91dGNvbWUobmZhLCBhbW91bnQsIHN1Y2Nlc3MsIHR4KSB7XG4gICAgICAgIGlmICh0eCkge1xuICAgICAgICAgIG5vdGVSb3V0ZUhlYWx0aCh0eCwgc3VjY2Vzcyk7XG4gICAgICAgIH1cbiAgICAgICAgc2V0UGVuZGluZ1R4U3RhdHVzKFxuICAgICAgICAgIHsgbmZhLCBhbW91bnQgfSxcbiAgICAgICAgICBzdWNjZXNzID8gUGVuZGluZ1R4U3RhdHVzLkFkdmFuY2VkIDogUGVuZGluZ1R4U3RhdHVzLkFkdmFuY2VGYWlsZWRcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFkdmFuY2VPdXRjb21lRm9yTWludGVkRWFybHkodHhIYXNoLCBzdWNjZXNzLCB0eCkge1xuICAgICAgICBpZiAodHgpIHtcbiAgICAgICAgICBub3RlUm91dGVIZWFsdGgodHgsIHN1Y2Nlc3MpO1xuICAgICAgICB9XG4gICAgICAgIHB1Ymxpc2hUeG5SZWNvcmQoXG4gICAgICAgICAgdHhIYXNoLFxuICAgICAgICAgIGhhcmRlbih7XG4gICAgICAgICAgICBzdGF0dXM6IHN1Y2Nlc3MgPyBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZWQgOiBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZUZhaWxlZFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgYWR2YW5jZU91dGNvbWVGb3JVbmtub3duTWludChldmlkZW5jZSkge1xuICAgICAgICBjb25zdCB7IHR4SGFzaCB9ID0gZXZpZGVuY2U7XG4gICAgICAgIGlmIChzZWVuVHhzLmhhcyh0eEhhc2gpKSB7XG4gICAgICAgICAgdGhyb3cgbWFrZUVycm9yKGBUcmFuc2FjdGlvbiBhbHJlYWR5IHNlZW46ICR7cXVvdGUodHhIYXNoKX1gKTtcbiAgICAgICAgfVxuICAgICAgICBzZWVuVHhzLmluaXQodHhIYXNoLCBldmlkZW5jZS5ibG9ja1RpbWVzdGFtcCk7XG4gICAgICAgIHB1Ymxpc2hFdmlkZW5jZSh0eEhhc2gsIGV2aWRlbmNlKTtcbiAgICAgIH0sXG4gICAgICBnZXRGb3J3YXJkc1RvUmV0cnkoY2hhaW5JZCkge1xuICAgICAgICBjb25zdCB2YWx1ZVBhdHRlcm4gPSBNLnNwbGl0UmVjb3JkKHsgY2hhaW5JZCB9KTtcbiAgICAgICAgY29uc3QgZmFpbGVkID0gWy4uLmZhaWxlZEZvcndhcmRzLnZhbHVlcyh2b2lkIDAsIHZhbHVlUGF0dGVybildO1xuICAgICAgICByZXR1cm4gZmFpbGVkLmZpbHRlcigodHgpID0+ICFmb3J3YXJkSW5Qcm9ncmVzcy5oYXModHgudHhIYXNoKSk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIGhhc0JlZW5PYnNlcnZlZChldmlkZW5jZSkge1xuICAgICAgICByZXR1cm4gc2VlblR4cy5oYXMoZXZpZGVuY2UudHhIYXNoKTtcbiAgICAgIH0sXG4gICAgICAvL1xuICAgICAgZGVsZXRlQ29tcGxldGVkVHhzKCkge1xuICAgICAgICBmb3IgKGNvbnN0IHR4SGFzaCBvZiBzdG9yZWRDb21wbGV0ZWRUeHMudmFsdWVzKCkpIHtcbiAgICAgICAgICBjb25zdCB0eE5vZGUgPSBFKHR4bnNOb2RlKS5tYWtlQ2hpbGROb2RlKHR4SGFzaCwge1xuICAgICAgICAgICAgc2VxdWVuY2U6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdm9pZCBFKHR4Tm9kZSkuc2V0VmFsdWUoXCJcIikudGhlbigoKSA9PiBzdG9yZWRDb21wbGV0ZWRUeHMuZGVsZXRlKHR4SGFzaCkpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG1hdGNoQW5kRGVxdWV1ZVNldHRsZW1lbnQobmZhLCBhbW91bnQpIHtcbiAgICAgICAgcmV0dXJuIG1hdGNoQW5kRGVxdWV1ZVNldHRsZW1lbnQocGVuZGluZ1NldHRsZVR4cywgbmZhLCBhbW91bnQpO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGRpc2J1cnNlZCh0eEhhc2gsIHNwbGl0KSB7XG4gICAgICAgIHB1Ymxpc2hUeG5SZWNvcmQodHhIYXNoLCBoYXJkZW4oeyBzcGxpdCwgc3RhdHVzOiBUeFN0YXR1cy5EaXNidXJzZWQgfSkpO1xuICAgICAgfSxcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgZm9yd2FyZGluZyh0eEhhc2gpIHtcbiAgICAgICAgaWYgKGZvcndhcmRJblByb2dyZXNzLmhhcyh0eEhhc2gpKSB7XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBUcmFuc2FjdGlvbiBhbHJlYWR5IGluIHByb2dyZXNzOiAke3F1b3RlKHR4SGFzaCl9YDtcbiAgICAgICAgfVxuICAgICAgICBmb3J3YXJkSW5Qcm9ncmVzcy5hZGQodHhIYXNoKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgZm9yd2FyZGVkKHR4SGFzaCwgdHgpIHtcbiAgICAgICAgaWYgKGZvcndhcmRJblByb2dyZXNzLmhhcyh0eEhhc2gpKSB7XG4gICAgICAgICAgZm9yd2FyZEluUHJvZ3Jlc3MuZGVsZXRlKHR4SGFzaCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgYFRyYW5zYWN0aW9uICR7dHhIYXNofSBmb3J3YXJkZWQgd2l0aG91dCBiZWluZyBtYXJrZWQgYXMgaW4gcHJvZ3Jlc3NgXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHgpIHtcbiAgICAgICAgICBpZiAoZmFpbGVkRm9yd2FyZHMuaGFzKHR4SGFzaCkpIHtcbiAgICAgICAgICAgIGZhaWxlZEZvcndhcmRzLmRlbGV0ZSh0eEhhc2gpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBub3RlUm91dGVIZWFsdGgodHgsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIHB1Ymxpc2hUeG5SZWNvcmQoXG4gICAgICAgICAgdHhIYXNoLFxuICAgICAgICAgIGhhcmRlbih7XG4gICAgICAgICAgICBzdGF0dXM6IFR4U3RhdHVzLkZvcndhcmRlZFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGZvcndhcmRGYWlsZWQodHhIYXNoLCB0eCkge1xuICAgICAgICBpZiAoZm9yd2FyZEluUHJvZ3Jlc3MuaGFzKHR4SGFzaCkpIHtcbiAgICAgICAgICBmb3J3YXJkSW5Qcm9ncmVzcy5kZWxldGUodHhIYXNoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICBgVHJhbnNhY3Rpb24gJHt0eEhhc2h9IGZvcndhcmQgZmFpbGVkIHdpdGhvdXQgYmVpbmcgbWFya2VkIGFzIGluIHByb2dyZXNzYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR4KSB7XG4gICAgICAgICAgdHgudHhIYXNoID09PSB0eEhhc2ggfHwgdGhyb3dSZWRhY3RlZGB0eEhhc2ggbWlzbWF0Y2ggaW4gZm9yd2FyZEZhaWxlZGA7XG4gICAgICAgICAgY29uc3QgY2hhaW5JZCA9IGNoYWluT2ZBY2NvdW50KHR4LmRlc3RpbmF0aW9uKTtcbiAgICAgICAgICBpZiAoIWZhaWxlZEZvcndhcmRzLmhhcyh0eEhhc2gpKSB7XG4gICAgICAgICAgICBmYWlsZWRGb3J3YXJkcy5pbml0KHR4LnR4SGFzaCwgaGFyZGVuKHsgLi4udHgsIGNoYWluSWQgfSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBub3RlUm91dGVIZWFsdGgodHgsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBwdWJsaXNoVHhuUmVjb3JkKFxuICAgICAgICAgIHR4SGFzaCxcbiAgICAgICAgICBoYXJkZW4oe1xuICAgICAgICAgICAgc3RhdHVzOiBUeFN0YXR1cy5Gb3J3YXJkRmFpbGVkXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgZm9yd2FyZFNraXBwZWQodHhIYXNoKSB7XG4gICAgICAgIHB1Ymxpc2hUeG5SZWNvcmQoXG4gICAgICAgICAgdHhIYXNoLFxuICAgICAgICAgIGhhcmRlbih7XG4gICAgICAgICAgICBzdGF0dXM6IFwiRk9SV0FSRF9TS0lQUEVEXCJcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgbG9va3VwUGVuZGluZyhuZmEsIGFtb3VudCkge1xuICAgICAgICBpZiAoIXBlbmRpbmdTZXR0bGVUeHMuaGFzKG5mYSkpIHtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKFtdKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwZW5kaW5nVHhzID0gcGVuZGluZ1NldHRsZVR4cy5nZXQobmZhKTtcbiAgICAgICAgcmV0dXJuIGhhcmRlbihwZW5kaW5nVHhzLmZpbHRlcigodHgpID0+IHR4LnR4LmFtb3VudCA9PT0gYW1vdW50KSk7XG4gICAgICB9XG4gICAgfSxcbiAgICB7IHN0YXRlU2hhcGU6IHN0YXRlU2hhcGU0IH1cbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZVN0YXR1c01hbmFnZXIpO1xuXG4vL1xudmFyIElOVklUQVRJT05fTUFLRVJTX0RFU0MgPSBcIm9yYWNsZSBvcGVyYXRvciBpbnZpdGF0aW9uXCI7XG52YXIgT3BlcmF0b3JLaXRJID0ge1xuICBhZG1pbjogTS5pbnRlcmZhY2UoXCJBZG1pblwiLCB7XG4gICAgZGlzYWJsZTogTS5jYWxsKCkucmV0dXJucygpXG4gIH0pLFxuICBpbnZpdGF0aW9uTWFrZXJzOiBNLmludGVyZmFjZShcIkludml0YXRpb25NYWtlcnNcIiwge1xuICAgIFN1Ym1pdEV2aWRlbmNlOiBNLmNhbGwoQ2N0cFR4RXZpZGVuY2VTaGFwZSkub3B0aW9uYWwoUmlza0Fzc2Vzc21lbnRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgfSksXG4gIG9wZXJhdG9yOiBNLmludGVyZmFjZShcIk9wZXJhdG9yXCIsIHtcbiAgICBzdWJtaXRFdmlkZW5jZTogTS5jYWxsKENjdHBUeEV2aWRlbmNlU2hhcGUpLm9wdGlvbmFsKFJpc2tBc3Nlc3NtZW50U2hhcGUpLnJldHVybnMoKSxcbiAgICBnZXRTdGF0dXM6IE0uY2FsbCgpLnJldHVybnMoTS5yZWNvcmQoKSlcbiAgfSlcbn07XG5cbi8vXG52YXIgdHJhY2UxMSA9IG1ha2VUcmFjZXIoXCJab2VVdGlsc1wiKTtcbnZhciBkZWZpbmVJbmVydEludml0YXRpb24gPSAoemNmLCBkZXNjcmlwdGlvbikgPT4ge1xuICByZXR1cm4gKCkgPT4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgdHJhY2UxMShgXFx1MjEzOVxcdUZFMEYgQW4gb2ZmZXIgd2FzIG1hZGUgb24gYW4gaW5lcnQgaW52aXRhdGlvbiBmb3IgJHtkZXNjcmlwdGlvbn1gKTtcbiAgICBzZWF0LmV4aXQoKTtcbiAgICByZXR1cm4gXCJpbmVydDsgbm90aGluZyBzaG91bGQgYmUgZXhwZWN0ZWQgZnJvbSB0aGlzIG9mZmVyXCI7XG4gIH0sIGRlc2NyaXB0aW9uKTtcbn07XG5cbi8vXG52YXIgdHJhY2UxMiA9IG1ha2VUcmFjZXIoXCJUeE9wZXJhdG9yXCIpO1xudmFyIHByZXBhcmVPcGVyYXRvcktpdCA9ICh6b25lLCBzdGF0aWNQb3dlcnMpID0+IHpvbmUuZXhvQ2xhc3NLaXQoXG4gIFwiT3BlcmF0b3IgS2l0XCIsXG4gIE9wZXJhdG9yS2l0SSxcbiAgLypcblxuXG4gICAqL1xuICAob3BlcmF0b3JJZCwgcG93ZXJzKSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG9wZXJhdG9ySWQsXG4gICAgICBwb3dlcnMsXG4gICAgICBkaXNhYmxlZDogZmFsc2VcbiAgICB9O1xuICB9LFxuICB7XG4gICAgYWRtaW46IHtcbiAgICAgIGRpc2FibGUoKSB7XG4gICAgICAgIHRyYWNlMTIoYG9wZXJhdG9yICR7dGhpcy5zdGF0ZS5vcGVyYXRvcklkfSBkaXNhYmxlZGApO1xuICAgICAgICB0aGlzLnN0YXRlLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qXG5cblxuICAgICAqL1xuICAgIGludml0YXRpb25NYWtlcnM6IHtcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIFN1Ym1pdEV2aWRlbmNlKGV2aWRlbmNlLCByaXNrQXNzZXNzbWVudCkge1xuICAgICAgICBjb25zdCB7IG9wZXJhdG9yIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgb3BlcmF0b3Iuc3VibWl0RXZpZGVuY2UoZXZpZGVuY2UsIHJpc2tBc3Nlc3NtZW50KTtcbiAgICAgICAgcmV0dXJuIHN0YXRpY1Bvd2Vycy5tYWtlSW5lcnRJbnZpdGF0aW9uKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBvcGVyYXRvcjoge1xuICAgICAgLypcblxuXG5cblxuICAgICAgICovXG4gICAgICBzdWJtaXRFdmlkZW5jZShldmlkZW5jZSwgcmlza0Fzc2Vzc21lbnQgPSB7fSkge1xuICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAhc3RhdGUuZGlzYWJsZWQgfHwgdGhyb3dSZWRhY3RlZGBzdWJtaXRFdmlkZW5jZSBmb3IgZGlzYWJsZWQgb3BlcmF0b3JgO1xuICAgICAgICBzdGF0ZS5wb3dlcnMuYXR0ZXN0KGV2aWRlbmNlLCByaXNrQXNzZXNzbWVudCwgc3RhdGUub3BlcmF0b3JJZCk7XG4gICAgICB9LFxuICAgICAgZ2V0U3RhdHVzKCkge1xuICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG9wZXJhdG9ySWQ6IHN0YXRlLm9wZXJhdG9ySWQsXG4gICAgICAgICAgZGlzYWJsZWQ6IHN0YXRlLmRpc2FibGVkXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICB9XG4pO1xuXG4vL1xudmFyIHRyYWNlMTMgPSBtYWtlVHJhY2VyKFwiVHhGZWVkXCIsIHRydWUpO1xudmFyIFRyYW5zYWN0aW9uRmVlZEtpdEkgPSBoYXJkZW4oe1xuICBvcGVyYXRvclBvd2VyczogTS5pbnRlcmZhY2UoXCJUcmFuc2FjdGlvbiBGZWVkIEFkbWluXCIsIHtcbiAgICBhdHRlc3Q6IE0uY2FsbChcbiAgICAgIENjdHBUeEV2aWRlbmNlU2hhcGUsXG4gICAgICBSaXNrQXNzZXNzbWVudFNoYXBlLFxuICAgICAgTS5zdHJpbmcoKVxuICAgICkucmV0dXJucygpXG4gIH0pLFxuICBjcmVhdG9yOiBNLmludGVyZmFjZShcIlRyYW5zYWN0aW9uIEZlZWQgQ3JlYXRvclwiLCB7XG4gICAgaW5pdE9wZXJhdG9yOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyh7XG4gICAgICBpbnZpdGF0aW9uTWFrZXJzOiBNLnJlbW90YWJsZSgpLFxuICAgICAgb3BlcmF0b3I6IE0ucmVtb3RhYmxlKClcbiAgICB9KSxcbiAgICBtYWtlT3BlcmF0b3JJbnZpdGF0aW9uOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgcmVtb3ZlT3BlcmF0b3I6IE0uY2FsbChNLnN0cmluZygpKS5yZXR1cm5zKClcbiAgfSksXG4gIHB1YmxpYzogTS5pbnRlcmZhY2UoXCJUcmFuc2FjdGlvbiBGZWVkIFB1YmxpY1wiLCB7XG4gICAgZ2V0RXZpZGVuY2VTdWJzY3JpYmVyOiBNLmNhbGwoKS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpXG4gIH0pXG59KTtcbnZhciBhbGxSaXNrc0lkZW50aWZpZWQgPSAocmlza1N0b3JlcywgdHhIYXNoKSA9PiB7XG4gIGNvbnN0IHNldE9mUmlza3MgPSAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICBmb3IgKGNvbnN0IHN0b3JlIG9mIHJpc2tTdG9yZXMpIHtcbiAgICBjb25zdCBuZXh0ID0gc3RvcmUuZ2V0KHR4SGFzaCk7XG4gICAgZm9yIChjb25zdCByaXNrIG9mIG5leHQucmlza3NJZGVudGlmaWVkID8/IFtdKSB7XG4gICAgICBzZXRPZlJpc2tzLmFkZChyaXNrKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIFsuLi5zZXRPZlJpc2tzLnZhbHVlcygpXS5zb3J0KCk7XG59O1xudmFyIHN0YXRlU2hhcGU1ID0ge1xuICBvcGVyYXRvcnM6IE0ucmVtb3RhYmxlKCksXG4gIHBlbmRpbmc6IE0ucmVtb3RhYmxlKCksXG4gIHJpc2tzOiBNLnJlbW90YWJsZSgpXG59O1xuaGFyZGVuKHN0YXRlU2hhcGU1KTtcbnZhciBwcmVwYXJlVHJhbnNhY3Rpb25GZWVkS2l0ID0gKHpvbmUsIHpjZikgPT4ge1xuICBjb25zdCBraW5kcyA9IHpvbmUubWFwU3RvcmUoXCJLaW5kc1wiKTtcbiAgY29uc3QgbWFrZUR1cmFibGVQdWJsaXNoS2l0ID0gcHJlcGFyZUR1cmFibGVQdWJsaXNoS2l0KFxuICAgIGtpbmRzLFxuICAgIFwiVHJhbnNhY3Rpb24gRmVlZFwiXG4gICk7XG4gIGNvbnN0IHsgcHVibGlzaGVyLCBzdWJzY3JpYmVyIH0gPSBtYWtlRHVyYWJsZVB1Ymxpc2hLaXQoKTtcbiAgY29uc3QgbWFrZUluZXJ0SW52aXRhdGlvbiA9IGRlZmluZUluZXJ0SW52aXRhdGlvbih6Y2YsIFwic3VibWl0dGluZyBldmlkZW5jZVwiKTtcbiAgY29uc3QgbWFrZU9wZXJhdG9yS2l0ID0gcHJlcGFyZU9wZXJhdG9yS2l0KHpvbmUsIHtcbiAgICBtYWtlSW5lcnRJbnZpdGF0aW9uXG4gIH0pO1xuICByZXR1cm4gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIkZhc3QgVVNEQyBGZWVkXCIsXG4gICAgVHJhbnNhY3Rpb25GZWVkS2l0SSxcbiAgICAoKSA9PiB7XG4gICAgICBjb25zdCBvcGVyYXRvcnMgPSB6b25lLm1hcFN0b3JlKFwib3BlcmF0b3JzXCIpO1xuICAgICAgY29uc3QgcGVuZGluZyA9IHpvbmUubWFwU3RvcmUoXG4gICAgICAgIFwicGVuZGluZ1wiXG4gICAgICApO1xuICAgICAgY29uc3Qgcmlza3MgPSB6b25lLm1hcFN0b3JlKFxuICAgICAgICBcInJpc2tzXCJcbiAgICAgICk7XG4gICAgICByZXR1cm4geyBvcGVyYXRvcnMsIHBlbmRpbmcsIHJpc2tzIH07XG4gICAgfSxcbiAgICB7XG4gICAgICBjcmVhdG9yOiB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgbWFrZU9wZXJhdG9ySW52aXRhdGlvbihvcGVyYXRvcklkKSB7XG4gICAgICAgICAgY29uc3QgeyBjcmVhdG9yIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICB0cmFjZTEzKFwibWFrZU9wZXJhdG9ySW52aXRhdGlvblwiLCBvcGVyYXRvcklkKTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiBjcmVhdG9yLmluaXRPcGVyYXRvcihvcGVyYXRvcklkKTtcbiAgICAgICAgICB9LCBJTlZJVEFUSU9OX01BS0VSU19ERVNDKTtcbiAgICAgICAgfSxcbiAgICAgICAgaW5pdE9wZXJhdG9yKG9wZXJhdG9ySWQpIHtcbiAgICAgICAgICBjb25zdCB7IG9wZXJhdG9ycywgcGVuZGluZywgcmlza3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgdHJhY2UxMyhcImluaXRPcGVyYXRvclwiLCBvcGVyYXRvcklkKTtcbiAgICAgICAgICBjb25zdCBvcGVyYXRvcktpdCA9IG1ha2VPcGVyYXRvcktpdChcbiAgICAgICAgICAgIG9wZXJhdG9ySWQsXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5vcGVyYXRvclBvd2Vyc1xuICAgICAgICAgICk7XG4gICAgICAgICAgb3BlcmF0b3JzLmluaXQob3BlcmF0b3JJZCwgb3BlcmF0b3JLaXQpO1xuICAgICAgICAgIHBlbmRpbmcuaW5pdChcbiAgICAgICAgICAgIG9wZXJhdG9ySWQsXG4gICAgICAgICAgICB6b25lLmRldGFjaGVkKCkubWFwU3RvcmUoXCJwZW5kaW5nIGV2aWRlbmNlXCIpXG4gICAgICAgICAgKTtcbiAgICAgICAgICByaXNrcy5pbml0KG9wZXJhdG9ySWQsIHpvbmUuZGV0YWNoZWQoKS5tYXBTdG9yZShcInJpc2sgYXNzZXNzbWVudHNcIikpO1xuICAgICAgICAgIGNvbnN0IHsgaW52aXRhdGlvbk1ha2Vycywgb3BlcmF0b3IgfSA9IG9wZXJhdG9yS2l0O1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBpbnZpdGF0aW9uTWFrZXJzLFxuICAgICAgICAgICAgb3BlcmF0b3JcbiAgICAgICAgICB9O1xuICAgICAgICB9LFxuICAgICAgICByZW1vdmVPcGVyYXRvcihvcGVyYXRvcklkKSB7XG4gICAgICAgICAgY29uc3QgeyBvcGVyYXRvcnMsIHBlbmRpbmcsIHJpc2tzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHRyYWNlMTMoXCJyZW1vdmVPcGVyYXRvclwiLCBvcGVyYXRvcklkKTtcbiAgICAgICAgICBjb25zdCBvcGVyYXRvcktpdCA9IG9wZXJhdG9ycy5nZXQob3BlcmF0b3JJZCk7XG4gICAgICAgICAgb3BlcmF0b3JLaXQuYWRtaW4uZGlzYWJsZSgpO1xuICAgICAgICAgIG9wZXJhdG9ycy5kZWxldGUob3BlcmF0b3JJZCk7XG4gICAgICAgICAgcGVuZGluZy5kZWxldGUob3BlcmF0b3JJZCk7XG4gICAgICAgICAgcmlza3MuZGVsZXRlKG9wZXJhdG9ySWQpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb3BlcmF0b3JQb3dlcnM6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgYXR0ZXN0KGV2aWRlbmNlLCByaXNrQXNzZXNzbWVudCwgb3BlcmF0b3JJZCkge1xuICAgICAgICAgIGNvbnN0IHsgb3BlcmF0b3JzLCBwZW5kaW5nLCByaXNrcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB0cmFjZTEzKFwiYXR0ZXN0XCIsIG9wZXJhdG9ySWQsIGV2aWRlbmNlKTtcbiAgICAgICAgICBjb25zdCB7IHR4SGFzaCB9ID0gZXZpZGVuY2U7XG4gICAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgcGVuZGluZ1N0b3JlID0gcGVuZGluZy5nZXQob3BlcmF0b3JJZCk7XG4gICAgICAgICAgICBpZiAocGVuZGluZ1N0b3JlLmhhcyh0eEhhc2gpKSB7XG4gICAgICAgICAgICAgIHRyYWNlMTMoYG9wZXJhdG9yICR7b3BlcmF0b3JJZH0gYWxyZWFkeSByZXBvcnRlZCAke3R4SGFzaH1gKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHBlbmRpbmdTdG9yZS5pbml0KHR4SGFzaCwgZXZpZGVuY2UpO1xuICAgICAgICAgICAgICBjb25zdCByaXNrU3RvcmUgPSByaXNrcy5nZXQob3BlcmF0b3JJZCk7XG4gICAgICAgICAgICAgIHJpc2tTdG9yZS5pbml0KHR4SGFzaCwgcmlza0Fzc2Vzc21lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBmb3VuZCA9IFsuLi5wZW5kaW5nLnZhbHVlcygpXS5maWx0ZXIoXG4gICAgICAgICAgICAoc3RvcmUpID0+IHN0b3JlLmhhcyh0eEhhc2gpXG4gICAgICAgICAgKTtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBsZXQgbGFzdEV2aWRlbmNlO1xuICAgICAgICAgICAgZm9yIChjb25zdCBzdG9yZSBvZiBmb3VuZCkge1xuICAgICAgICAgICAgICBjb25zdCBuZXh0ID0gc3RvcmUuZ2V0KHR4SGFzaCk7XG4gICAgICAgICAgICAgIGlmIChsYXN0RXZpZGVuY2UgJiYgIWtleUVRKGxhc3RFdmlkZW5jZSwgbmV4dCkpIHtcbiAgICAgICAgICAgICAgICB0cmFjZTEzKFxuICAgICAgICAgICAgICAgICAgXCJcXHV7MUY2QTh9IGNvbmZsaWN0aW5nIGV2aWRlbmNlIGZvclwiLFxuICAgICAgICAgICAgICAgICAgdHhIYXNoLFxuICAgICAgICAgICAgICAgICAgXCI6XCIsXG4gICAgICAgICAgICAgICAgICBsYXN0RXZpZGVuY2UsXG4gICAgICAgICAgICAgICAgICBcIiE9XCIsXG4gICAgICAgICAgICAgICAgICBuZXh0XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB0aHJvd1JlZGFjdGVkYGNvbmZsaWN0aW5nIGV2aWRlbmNlIGZvciAke3F1b3RlKHR4SGFzaCl9YDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBsYXN0RXZpZGVuY2UgPSBuZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBtaW5BdHRlc3RhdGlvbnMgPSBNYXRoLmNlaWwob3BlcmF0b3JzLmdldFNpemUoKSAvIDIpO1xuICAgICAgICAgIHRyYWNlMTMoXG4gICAgICAgICAgICBcInRyYW5zYWN0aW9uXCIsXG4gICAgICAgICAgICB0eEhhc2gsXG4gICAgICAgICAgICBcImhhc1wiLFxuICAgICAgICAgICAgZm91bmQubGVuZ3RoLFxuICAgICAgICAgICAgXCJvZlwiLFxuICAgICAgICAgICAgbWluQXR0ZXN0YXRpb25zLFxuICAgICAgICAgICAgXCJuZWNlc3NhcnkgYXR0ZXN0YXRpb25zXCJcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChmb3VuZC5sZW5ndGggPCBtaW5BdHRlc3RhdGlvbnMpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3Qgcmlza1N0b3JlcyA9IFsuLi5yaXNrcy52YWx1ZXMoKV0uZmlsdGVyKFxuICAgICAgICAgICAgKHN0b3JlKSA9PiBzdG9yZS5oYXModHhIYXNoKVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKGZvdW5kLmxlbmd0aCA9PT0gbWluQXR0ZXN0YXRpb25zKSB7XG4gICAgICAgICAgICBjb25zdCByaXNrc0lkZW50aWZpZWQgPSBhbGxSaXNrc0lkZW50aWZpZWQocmlza1N0b3JlcywgdHhIYXNoKTtcbiAgICAgICAgICAgIHRyYWNlMTMoXCJwdWJsaXNoaW5nIGV2aWRlbmNlXCIsIGV2aWRlbmNlLCByaXNrc0lkZW50aWZpZWQpO1xuICAgICAgICAgICAgcHVibGlzaGVyLnB1Ymxpc2goe1xuICAgICAgICAgICAgICBldmlkZW5jZSxcbiAgICAgICAgICAgICAgcmlzazogeyByaXNrc0lkZW50aWZpZWQgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChmb3VuZC5sZW5ndGggPT09IHBlbmRpbmcuZ2V0U2l6ZSgpKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHN0b3JlIG9mIGZvdW5kKSB7XG4gICAgICAgICAgICAgIHN0b3JlLmRlbGV0ZSh0eEhhc2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChjb25zdCBzdG9yZSBvZiByaXNrU3RvcmVzKSB7XG4gICAgICAgICAgICAgIHN0b3JlLmRlbGV0ZSh0eEhhc2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHB1YmxpYzoge1xuICAgICAgICBnZXRFdmlkZW5jZVN1YnNjcmliZXI6ICgpID0+IHN1YnNjcmliZXJcbiAgICAgIH1cbiAgICB9LFxuICAgIHsgc3RhdGVTaGFwZTogc3RhdGVTaGFwZTUgfVxuICApO1xufTtcbmhhcmRlbihwcmVwYXJlVHJhbnNhY3Rpb25GZWVkS2l0KTtcblxuLy9cbnZhciBzdGFydEZvcndhcmRSZXRyaWVyID0gKHtcbiAgZ2V0Rm9yd2FyZHNUb1JldHJ5LFxuICBmb3J3YXJkRnVuZHM6IGZvcndhcmRGdW5kczIsXG4gIGxvZyA9ICgpID0+IHtcbiAgfSxcbiAgcm91dGVIZWFsdGgsXG4gIFVTRENcbn0pID0+IHtcbiAgY29uc3QgZm9yd2FyZEZhaWxlZCA9IChmYWlsZWRGb3J3YXJkKSA9PiB7XG4gICAgY29uc3QgeyB0eEhhc2gsIGFtb3VudDogYW10VmFsdWUsIGRlc3RpbmF0aW9uIH0gPSBmYWlsZWRGb3J3YXJkO1xuICAgIGNvbnN0IGFtb3VudCA9IEFtb3VudE1hdGgubWFrZShVU0RDLCBhbXRWYWx1ZSk7XG4gICAgdm9pZCBmb3J3YXJkRnVuZHMyKHtcbiAgICAgIHR4SGFzaCxcbiAgICAgIGFtb3VudCxcbiAgICAgIGRlc3RpbmF0aW9uXG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGF0dGVtcHRUb0NsZWFyID0gKGNoYWluKSA9PiB7XG4gICAgY29uc3QgZmFpbGVkRm9yd2FyZHMgPSBnZXRGb3J3YXJkc1RvUmV0cnkoY2hhaW4pO1xuICAgIGlmICghZmFpbGVkRm9yd2FyZHMubGVuZ3RoKSB7XG4gICAgICBsb2coYE5vIGZhaWxlZCBmb3J3YXJkcyB0byBjbGVhciBmb3IgJHtjaGFpbn1gKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbG9nKFxuICAgICAgYEF0dGVtcHRpbmcgdG8gY2xlYXIgJHtmYWlsZWRGb3J3YXJkcy5sZW5ndGh9IGZhaWxlZCBmb3J3YXJkcyBmb3IgJHtjaGFpbn1gXG4gICAgKTtcbiAgICBmb3IgKGNvbnN0IGZhaWxlZEZvcndhcmQgb2YgZmFpbGVkRm9yd2FyZHMpIHtcbiAgICAgIGlmICghcm91dGVIZWFsdGguaXNXb3JraW5nKGNoYWluKSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGZvcndhcmRGYWlsZWQoZmFpbGVkRm9yd2FyZCk7XG4gICAgfVxuICB9O1xuICBjb25zdCBhdHRlbXB0T25lID0gKGNoYWluKSA9PiB7XG4gICAgY29uc3QgZmFpbGVkRm9yd2FyZHMgPSBnZXRGb3J3YXJkc1RvUmV0cnkoY2hhaW4pO1xuICAgIGlmICghZmFpbGVkRm9yd2FyZHMubGVuZ3RoKSB7XG4gICAgICBsb2coYE5vIGZhaWxlZCBmb3J3YXJkcyB0byB0cnkgZm9yICR7Y2hhaW59YCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxvZyhcbiAgICAgIGBSZXRyeWluZyBvbmUgb2YgJHtmYWlsZWRGb3J3YXJkcy5sZW5ndGh9IGZhaWxlZCBmb3J3YXJkcyBmb3IgJHtjaGFpbn1gXG4gICAgKTtcbiAgICBmb3J3YXJkRmFpbGVkKGZhaWxlZEZvcndhcmRzWzBdKTtcbiAgfTtcbiAgY29uc3Qgb25FYWNoRmFpbHVyZSA9IChjaGFpbikgPT4ge1xuICAgIGxvZyhgUm91dGUgJHtjaGFpbn0gZmFpbGVkLmApO1xuICAgIGlmIChyb3V0ZUhlYWx0aC5pc1dvcmtpbmcoY2hhaW4pKSB7XG4gICAgICBhdHRlbXB0T25lKGNoYWluKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IG9uV29ya2luZyA9IChjaGFpbikgPT4ge1xuICAgIGxvZyhgUm91dGUgJHtjaGFpbn0gaXMgd29ya2luZyBhZ2Fpbi5gKTtcbiAgICBhdHRlbXB0VG9DbGVhcihjaGFpbik7XG4gIH07XG4gIGNvbnN0IG9uRGVyZWxpY3QgPSAoY2hhaW4pID0+IGxvZyhcbiAgICBgUm91dGUgJHtjaGFpbn0gaXMgZGVyZWxpY3QuIEEgc3VjY2Vzc2Z1bCB0cmFuc2ZlciBtdXN0IGJlIG9ic2VydmVkIGZvciBmYWlsZWQgZm9yd2FyZHMgdG8gYmUgcmVhdHRlbXB0ZWQuYFxuICApO1xuICByb3V0ZUhlYWx0aC5zZXRFdmVudEhhbmRsZXJzKHtcbiAgICBvbkVhY2hGYWlsdXJlLFxuICAgIG9uV29ya2luZyxcbiAgICBvbkRlcmVsaWN0XG4gIH0pO1xufTtcblxuLy9cbnZhciB0cmFjZTE0ID0gbWFrZVRyYWNlcihcIkZhc3RVc2RjXCIpO1xudmFyIE1BWF9ST1VURV9GQUlMVVJFUyA9IDY7XG52YXIgVFhOU19OT0RFID0gXCJ0eG5zXCI7XG52YXIgRkVFX05PREUgPSBcImZlZUNvbmZpZ1wiO1xudmFyIEFERFJFU1NFU19CQUdHQUdFX0tFWSA9IFwiYWRkcmVzc2VzXCI7XG52YXIgTk9CTEVfSUNBX0JBR0dBR0VfS0VZID0gXCJub2JsZUlDQVwiO1xudmFyICRjzY9fbWV0YT17XG4gIGN1c3RvbVRlcm1zU2hhcGU6IEZhc3RVU0RDVGVybXNTaGFwZSxcbiAgcHJpdmF0ZUFyZ3NTaGFwZToge1xuICAgIC8vXG4gICAgLi4uT3JjaGVzdHJhdGlvblBvd2Vyc1NoYXBlLFxuICAgIGFzc2V0SW5mbzogTS5hcnJheU9mKFtEZW5vbVNoYXBlLCBEZW5vbURldGFpbFNoYXBlXSksXG4gICAgY2hhaW5JbmZvOiBNLnJlY29yZE9mKE0uc3RyaW5nKCksIENvc21vc0NoYWluSW5mb1NoYXBlVjEpLFxuICAgIGZlZUNvbmZpZzogRmVlQ29uZmlnU2hhcGUsXG4gICAgbWFyc2hhbGxlcjogTS5yZW1vdGFibGUoKSxcbiAgICBwb29sTWV0cmljc05vZGU6IE0ucmVtb3RhYmxlKClcbiAgfVxufTttZXRhPSRjzY9fbWV0YTtcbmhhcmRlbihtZXRhKTtcbnZhciBwdWJsaXNoRmVlQ29uZmlnID0gKG5vZGUsIG1hcnNoYWxsZXIsIGZlZUNvbmZpZykgPT4ge1xuICBjb25zdCBmZWVOb2RlID0gRShub2RlKS5tYWtlQ2hpbGROb2RlKEZFRV9OT0RFKTtcbiAgdm9pZCBFLndoZW4oXG4gICAgRShtYXJzaGFsbGVyKS50b0NhcERhdGEoZmVlQ29uZmlnKSxcbiAgICAodmFsdWUpID0+IEUoZmVlTm9kZSkuc2V0VmFsdWUoSlNPTi5zdHJpbmdpZnkodmFsdWUpKVxuICApO1xufTtcbnZhciBwdWJsaXNoQWRkcmVzc2VzID0gKGNvbnRyYWN0Tm9kZSwgYWRkcmVzc2VzKSA9PiB7XG4gIHJldHVybiBFKGNvbnRyYWN0Tm9kZSkuc2V0VmFsdWUoSlNPTi5zdHJpbmdpZnkoYWRkcmVzc2VzKSk7XG59O1xudmFyICRjzY9fY29udHJhY3Q9YXN5bmMoemNmLHByaXZhdGVBcmdzLCB6b25lLCB0b29scykgPT4ge1xuICBhc3NlcnQodG9vbHMsIFwibm8gdG9vbHNcIik7XG4gIGNvbnN0IHRlcm1zID0gemNmLmdldFRlcm1zKCk7XG4gIGFzc2VydChcIlVTRENcIiBpbiB0ZXJtcy5icmFuZHMsIFwibm8gVVNEQyBicmFuZFwiKTtcbiAgYXNzZXJ0KFwidXNkY0Rlbm9tXCIgaW4gdGVybXMsIFwibm8gdXNkY0Rlbm9tXCIpO1xuICBjb25zdCB7IGZlZUNvbmZpZywgbWFyc2hhbGxlciwgc3RvcmFnZU5vZGUgfSA9IHByaXZhdGVBcmdzO1xuICBjb25zdCB7IG1ha2VSZWNvcmRlcktpdCB9ID0gcHJlcGFyZVJlY29yZGVyS2l0TWFrZXJzKFxuICAgIHpvbmUubWFwU3RvcmUoXCJ2c3RvcmFnZVwiKSxcbiAgICBtYXJzaGFsbGVyXG4gICk7XG4gIGNvbnN0IHJvdXRlSGVhbHRoID0gbWFrZVJvdXRlSGVhbHRoKE1BWF9ST1VURV9GQUlMVVJFUyk7XG4gIGNvbnN0IHN0YXR1c01hbmFnZXIgPSBwcmVwYXJlU3RhdHVzTWFuYWdlcihcbiAgICB6b25lLFxuICAgIEUoc3RvcmFnZU5vZGUpLm1ha2VDaGlsZE5vZGUoVFhOU19OT0RFKSxcbiAgICB7IG1hcnNoYWxsZXIsIHJvdXRlSGVhbHRoIH1cbiAgKTtcbiAgY29uc3QgeyBVU0RDIH0gPSB0ZXJtcy5icmFuZHM7XG4gIGNvbnN0IHsgd2l0aGRyYXdUb1NlYXQgfSA9IHRvb2xzLnpvZVRvb2xzO1xuICBjb25zdCB7IGJhZ2dhZ2UsIGNoYWluSHViLCBvcmNoZXN0cmF0ZUFsbCwgdm93VG9vbHMgfSA9IHRvb2xzO1xuICBjb25zdCBnZXROb2JsZUlDQSA9ICgpID0+IGJhZ2dhZ2UuZ2V0KE5PQkxFX0lDQV9CQUdHQUdFX0tFWSk7XG4gIGNvbnN0IGZpcnN0SW5jYXJuYXRpb25LZXkgPSBcImZpcnN0SW5jYXJuYXRpb25LZXlcIjtcbiAgaWYgKCFiYWdnYWdlLmhhcyhmaXJzdEluY2FybmF0aW9uS2V5KSkge1xuICAgIGJhZ2dhZ2UuaW5pdChmaXJzdEluY2FybmF0aW9uS2V5LCB0cnVlKTtcbiAgICByZWdpc3RlckNoYWluc0FuZEFzc2V0cyhcbiAgICAgIGNoYWluSHViLFxuICAgICAgdGVybXMuYnJhbmRzLFxuICAgICAgcHJpdmF0ZUFyZ3MuY2hhaW5JbmZvLFxuICAgICAgcHJpdmF0ZUFyZ3MuYXNzZXRJbmZvLFxuICAgICAgeyBsb2c6IHRyYWNlMTQgfVxuICAgICk7XG4gIH1cbiAgY29uc3Qgc3VwcG9ydHNDY3RwID0gbWFrZVN1cHBvcnRzQ2N0cChjaGFpbkh1Yik7XG4gIGNvbnN0IHsgbWFrZUxvY2FsQWNjb3VudDogbWFrZUxvY2FsQWNjb3VudDIsIG1ha2VOb2JsZUFjY291bnQ6IG1ha2VOb2JsZUFjY291bnQyIH0gPSBvcmNoZXN0cmF0ZUFsbChcbiAgICB7XG4gICAgICAvL1xuICAgICAgbWFrZUxvY2FsQWNjb3VudCxcbiAgICAgIG1ha2VOb2JsZUFjY291bnRcbiAgICB9LFxuICAgIHt9XG4gICk7XG4gIGNvbnN0IHBvb2xBY2NvdW50ViA9IHpvbmUubWFrZU9uY2UoXCJQb29sQWNjb3VudFwiLCAoKSA9PiBtYWtlTG9jYWxBY2NvdW50MigpKTtcbiAgY29uc3Qgc2V0dGxlQWNjb3VudFYgPSB6b25lLm1ha2VPbmNlKFxuICAgIFwiU2V0dGxlQWNjb3VudFwiLFxuICAgICgpID0+IG1ha2VMb2NhbEFjY291bnQyKClcbiAgKTtcbiAgY29uc3QgeyBmb3J3YXJkRnVuZHM6IGZvcndhcmRGdW5kczIgfSA9IG9yY2hlc3RyYXRlQWxsKFxuICAgIC8vXG4gICAgeyBmb3J3YXJkRnVuZHMgfSxcbiAgICB7XG4gICAgICBjdXJyZW50Q2hhaW5SZWZlcmVuY2U6IHByaXZhdGVBcmdzLmNoYWluSW5mby5hZ29yaWMuY2hhaW5JZCxcbiAgICAgIGdldE5vYmxlSUNBLFxuICAgICAgbG9nOiBtYWtlVHJhY2VyKFwiRm9yd2FyZEZ1bmRzXCIpLFxuICAgICAgc2V0dGxlbWVudEFjY291bnQ6IHNldHRsZUFjY291bnRWLFxuICAgICAgc3VwcG9ydHNDY3RwLFxuICAgICAgc3RhdHVzTWFuYWdlclxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZVNldHRsZXIgPSBwcmVwYXJlU2V0dGxlcih6b25lLCB7XG4gICAgc3RhdHVzTWFuYWdlcixcbiAgICBVU0RDLFxuICAgIHdpdGhkcmF3VG9TZWF0LFxuICAgIGZlZUNvbmZpZyxcbiAgICBmb3J3YXJkRnVuZHM6IGZvcndhcmRGdW5kczIsXG4gICAgZ2V0Tm9ibGVJQ0EsXG4gICAgdm93VG9vbHM6IHRvb2xzLnZvd1Rvb2xzLFxuICAgIHpjZixcbiAgICAvL1xuICAgIGNoYWluSHViOiB7IHJlc29sdmVBY2NvdW50SWQ6IGNoYWluSHViLnJlc29sdmVBY2NvdW50SWQuYmluZChjaGFpbkh1YikgfVxuICB9KTtcbiAgY29uc3Qgem9lVG9vbHMgPSBtYWtlWm9lVG9vbHMoemNmLCB2b3dUb29scyk7XG4gIGNvbnN0IHsgYWR2YW5jZUZ1bmRzOiBhZHZhbmNlRnVuZHMyIH0gPSBvcmNoZXN0cmF0ZUFsbChcbiAgICAvL1xuICAgIHsgYWR2YW5jZUZ1bmRzIH0sXG4gICAge1xuICAgICAgLy9cbiAgICAgIGNoYWluSHViVG9vbHM6IHtcbiAgICAgICAgZ2V0Q2hhaW5JbmZvQnlDaGFpbklkOiBjaGFpbkh1Yi5nZXRDaGFpbkluZm9CeUNoYWluSWQuYmluZChjaGFpbkh1YiksXG4gICAgICAgIHJlc29sdmVBY2NvdW50SWQ6IGNoYWluSHViLnJlc29sdmVBY2NvdW50SWQuYmluZChjaGFpbkh1YilcbiAgICAgIH0sXG4gICAgICBmZWVDb25maWcsXG4gICAgICBnZXROb2JsZUlDQSxcbiAgICAgIGxvZzogbWFrZVRyYWNlcihcIkFkdmFuY2VGdW5kc1wiKSxcbiAgICAgIHNldHRsZW1lbnRBY2NvdW50OiBzZXR0bGVBY2NvdW50VixcbiAgICAgIHN0YXR1c01hbmFnZXIsXG4gICAgICB1c2RjOiBoYXJkZW4oe1xuICAgICAgICBicmFuZDogdGVybXMuYnJhbmRzLlVTREMsXG4gICAgICAgIGRlbm9tOiB0ZXJtcy51c2RjRGVub21cbiAgICAgIH0pLFxuICAgICAgemNmVG9vbHM6IGhhcmRlbih7XG4gICAgICAgIG1ha2VFbXB0eVpDRlNlYXQ6ICgpID0+IHtcbiAgICAgICAgICBjb25zdCB7IHpjZlNlYXQgfSA9IHpjZi5tYWtlRW1wdHlTZWF0S2l0KCk7XG4gICAgICAgICAgcmV0dXJuIHpjZlNlYXQ7XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgem9lVG9vbHNcbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VBZHZhbmNlciA9IHByZXBhcmVBZHZhbmNlcih6b25lLCB7XG4gICAgYWR2YW5jZUZ1bmRzOiBhZHZhbmNlRnVuZHMyLFxuICAgIGNoYWluSHViLFxuICAgIGdldE5vYmxlSUNBLFxuICAgIHVzZGM6IGhhcmRlbih7XG4gICAgICBicmFuZDogdGVybXMuYnJhbmRzLlVTREMsXG4gICAgICBkZW5vbTogdGVybXMudXNkY0Rlbm9tXG4gICAgfSksXG4gICAgc3RhdHVzTWFuYWdlcixcbiAgICB2b3dUb29scyxcbiAgICB6Y2YsXG4gICAgem9lVG9vbHNcbiAgfSk7XG4gIGNvbnN0IG1ha2VGZWVkS2l0ID0gcHJlcGFyZVRyYW5zYWN0aW9uRmVlZEtpdCh6b25lLCB6Y2YpO1xuICBjb25zdCBtYWtlTGlxdWlkaXR5UG9vbEtpdCA9IHByZXBhcmVMaXF1aWRpdHlQb29sS2l0KFxuICAgIHpvbmUsXG4gICAgemNmLFxuICAgIHRlcm1zLmJyYW5kcy5VU0RDLFxuICAgIHsgbWFrZVJlY29yZGVyS2l0IH1cbiAgKTtcbiAgY29uc3QgY3JlYXRvckZhY2V0ID0gem9uZS5leG8oXCJGYXN0IFVTREMgQ3JlYXRvclwiLCB2b2lkIDAsIHtcbiAgICBhc3luYyBtYWtlT3BlcmF0b3JJbnZpdGF0aW9uKG9wZXJhdG9ySWQpIHtcbiAgICAgIHJldHVybiBmZWVkS2l0LmNyZWF0b3IubWFrZU9wZXJhdG9ySW52aXRhdGlvbihvcGVyYXRvcklkKTtcbiAgICB9LFxuICAgIHJlbW92ZU9wZXJhdG9yKG9wZXJhdG9ySWQpIHtcbiAgICAgIHJldHVybiBmZWVkS2l0LmNyZWF0b3IucmVtb3ZlT3BlcmF0b3Iob3BlcmF0b3JJZCk7XG4gICAgfSxcbiAgICBhc3luYyBnZXRDb250cmFjdEZlZUJhbGFuY2UoKSB7XG4gICAgICByZXR1cm4gcG9vbEtpdC5mZWVSZWNpcGllbnQuZ2V0Q29udHJhY3RGZWVCYWxhbmNlKCk7XG4gICAgfSxcbiAgICBhc3luYyBtYWtlV2l0aGRyYXdGZWVzSW52aXRhdGlvbigpIHtcbiAgICAgIHJldHVybiBwb29sS2l0LmZlZVJlY2lwaWVudC5tYWtlV2l0aGRyYXdGZWVzSW52aXRhdGlvbigpO1xuICAgIH0sXG4gICAgYXN5bmMgY29ubmVjdFRvTm9ibGUoYWdvcmljQ2hhaW5JZCwgbm9ibGVDaGFpbklkLCBhZ29yaWNUb05vYmxlKSB7XG4gICAgICBjb25zdCBzaG91bGRVcGRhdGUgPSBhZ29yaWNDaGFpbklkICYmIG5vYmxlQ2hhaW5JZCAmJiBhZ29yaWNUb05vYmxlO1xuICAgICAgaWYgKHNob3VsZFVwZGF0ZSkge1xuICAgICAgICB0cmFjZTE0KFwiY29ubmVjdFRvTm9ibGVcIiwgYWdvcmljQ2hhaW5JZCwgbm9ibGVDaGFpbklkLCBhZ29yaWNUb05vYmxlKTtcbiAgICAgICAgY2hhaW5IdWIudXBkYXRlQ29ubmVjdGlvbihhZ29yaWNDaGFpbklkLCBub2JsZUNoYWluSWQsIGFnb3JpY1RvTm9ibGUpO1xuICAgICAgfVxuICAgICAgY29uc3Qgbm9ibGVJQ0FMYWJlbCA9IGBOb2JsZUlDQS0keyhzaG91bGRVcGRhdGUgPyBhZ29yaWNUb05vYmxlIDogYWdUb05vYmxlKS5jb3VudGVycGFydHkuY29ubmVjdGlvbl9pZH1gO1xuICAgICAgdHJhY2UxNChcIk5vYmxlSUNBXCIsIG5vYmxlSUNBTGFiZWwpO1xuICAgICAgY29uc3Qgbm9ibGVBY2NvdW50ViA9IHpvbmUubWFrZU9uY2UoXG4gICAgICAgIG5vYmxlSUNBTGFiZWwsXG4gICAgICAgICgpID0+IG1ha2VOb2JsZUFjY291bnQyKClcbiAgICAgICk7XG4gICAgICByZXR1cm4gdm93VG9vbHMud2hlbihub2JsZUFjY291bnRWLCAobm9ibGVBY2NvdW50KSA9PiB7XG4gICAgICAgIHRyYWNlMTQoXCJub2JsZUFjY291bnRcIiwgbm9ibGVBY2NvdW50KTtcbiAgICAgICAgaWYgKGJhZ2dhZ2UuaGFzKE5PQkxFX0lDQV9CQUdHQUdFX0tFWSkpIHtcbiAgICAgICAgICB0cmFjZTE0KFxuICAgICAgICAgICAgXCJOb2JsZSBJQ0EgYWxyZWFkeSBzZXQgaW4gYmFnZ2FnZS4gRXF1YWw/XCIsXG4gICAgICAgICAgICBiYWdnYWdlLmdldChOT0JMRV9JQ0FfQkFHR0FHRV9LRVkpID09PSBub2JsZUFjY291bnRcbiAgICAgICAgICApO1xuICAgICAgICAgIGJhZ2dhZ2Uuc2V0KE5PQkxFX0lDQV9CQUdHQUdFX0tFWSwgbm9ibGVBY2NvdW50KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBiYWdnYWdlLmluaXQoTk9CTEVfSUNBX0JBR0dBR0VfS0VZLCBub2JsZUFjY291bnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBub2JsZUFjY291bnQuZ2V0QWRkcmVzcygpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBhc3luYyBwdWJsaXNoQWRkcmVzc2VzKCkge1xuICAgICAgIWJhZ2dhZ2UuaGFzKEFERFJFU1NFU19CQUdHQUdFX0tFWSkgfHwgdGhyb3dSZWRhY3RlZGBBZGRyZXNzZXMgYWxyZWFkeSBwdWJsaXNoZWRgO1xuICAgICAgY29uc3QgW3Bvb2xBY2NvdW50QWRkcmVzc10gPSBhd2FpdCB2b3dUb29scy53aGVuKFxuICAgICAgICB2b3dUb29scy5hbGwoW0UocG9vbEFjY291bnQpLmdldEFkZHJlc3MoKV0pXG4gICAgICApO1xuICAgICAgY29uc3QgYWRkcmVzc2VzID0gaGFyZGVuKHtcbiAgICAgICAgcG9vbEFjY291bnQ6IHBvb2xBY2NvdW50QWRkcmVzcy52YWx1ZSxcbiAgICAgICAgc2V0dGxlbWVudEFjY291bnQ6IHNldHRsZW1lbnRBZGRyZXNzLnZhbHVlXG4gICAgICB9KTtcbiAgICAgIGJhZ2dhZ2UuaW5pdChBRERSRVNTRVNfQkFHR0FHRV9LRVksIGFkZHJlc3Nlcyk7XG4gICAgICBhd2FpdCBwdWJsaXNoQWRkcmVzc2VzKHN0b3JhZ2VOb2RlLCBhZGRyZXNzZXMpO1xuICAgICAgcmV0dXJuIGFkZHJlc3NlcztcbiAgICB9LFxuICAgIGRlbGV0ZUNvbXBsZXRlZFR4cygpIHtcbiAgICAgIHJldHVybiBzdGF0dXNNYW5hZ2VyLmRlbGV0ZUNvbXBsZXRlZFR4cygpO1xuICAgIH0sXG4gICAgcmVtZWRpYXRlVW5kZXRlY3RlZEJhdGNoZXMobWluVXVzZGMpIHtcbiAgICAgIHJldHVybiBzZXR0bGVyS2l0LmNyZWF0b3IucmVtZWRpYXRlTWludGVkRWFybHkobWluVXVzZGMpO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG4gICAgICovXG4gICAgYXN5bmMgc2VuZEZyb21TZXR0bGVtZW50QWNjb3VudChhZ29yaWNSZWNpcGllbnQsIGFtb3VudCkge1xuICAgICAgdHJhY2UxNChcbiAgICAgICAgYFNlbmRpbmcgJHtxdW90ZShhbW91bnQpfSB0byAke2Fnb3JpY1JlY2lwaWVudH0gZnJvbSBzZXR0bGVtZW50QWNjb3VudGBcbiAgICAgICk7XG4gICAgICBjb25zdCByZWNpcGllbnQgPSBjaGFpbkh1Yi5yZXNvbHZlQWNjb3VudElkKGFnb3JpY1JlY2lwaWVudCk7XG4gICAgICBjb25zdCBiZWZvcmUgPSBhd2FpdCB2b3dUb29scy53aGVuKEUoc2V0dGxlbWVudEFjY291bnQpLmdldEJhbGFuY2VzKCkpO1xuICAgICAgcmV0dXJuIHZvd1Rvb2xzLndoZW4oXG4gICAgICAgIEUoc2V0dGxlbWVudEFjY291bnQpLnNlbmQocmVjaXBpZW50LCBhbW91bnQpLFxuICAgICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgcG9vbEtpdC5leHRlcm5hbC5wdWJsaXNoUG9vbE1ldHJpY3MoKTtcbiAgICAgICAgICBjb25zdCBhZnRlciA9IGF3YWl0IHZvd1Rvb2xzLndoZW4oRShzZXR0bGVtZW50QWNjb3VudCkuZ2V0QmFsYW5jZXMoKSk7XG4gICAgICAgICAgdHJhY2UxNChcbiAgICAgICAgICAgIGBTZW50ICR7cXVvdGUoYW1vdW50KX0gdG8gJHthZ29yaWNSZWNpcGllbnR9LiBzZXR0bGVtZW50QWNjb3VudDpgLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBiZWZvcmUsXG4gICAgICAgICAgICAgIGFmdGVyXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4geyBiZWZvcmUsIGFmdGVyIH07XG4gICAgICAgIH0sXG4gICAgICAgIChlcnIpID0+IHtcbiAgICAgICAgICB0cmFjZTE0KGBGYWlsZWQgdG8gc2VuZCAke2Ftb3VudH0gdG8gJHthZ29yaWNSZWNpcGllbnR9OmAsIGVycik7XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBTZW5kIGZhaWxlZDogJHtlcnJ9YDtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9LFxuICAgIHVwZGF0ZUNoYWluKGNoYWluTmFtZSwgY2hhaW5JbmZvKSB7XG4gICAgICByZXR1cm4gY2hhaW5IdWIudXBkYXRlQ2hhaW4oY2hhaW5OYW1lLCBjaGFpbkluZm8pO1xuICAgIH0sXG4gICAgcmVnaXN0ZXJDaGFpbihjaGFpbk5hbWUsIGNoYWluSW5mbykge1xuICAgICAgcmV0dXJuIGNoYWluSHViLnJlZ2lzdGVyQ2hhaW4oY2hhaW5OYW1lLCBjaGFpbkluZm8pO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IHB1YmxpY0ZhY2V0ID0gem9uZS5leG8oXCJGYXN0IFVTREMgUHVibGljXCIsIHZvaWQgMCwge1xuICAgIG1ha2VEZXBvc2l0SW52aXRhdGlvbigpIHtcbiAgICAgIHJldHVybiBwb29sS2l0LnB1YmxpYy5tYWtlRGVwb3NpdEludml0YXRpb24oKTtcbiAgICB9LFxuICAgIG1ha2VXaXRoZHJhd0ludml0YXRpb24oKSB7XG4gICAgICByZXR1cm4gcG9vbEtpdC5wdWJsaWMubWFrZVdpdGhkcmF3SW52aXRhdGlvbigpO1xuICAgIH0sXG4gICAgZ2V0UHVibGljVG9waWNzKCkge1xuICAgICAgcmV0dXJuIHBvb2xLaXQucHVibGljLmdldFB1YmxpY1RvcGljcygpO1xuICAgIH0sXG4gICAgZ2V0U3RhdGljSW5mbygpIHtcbiAgICAgIGJhZ2dhZ2UuaGFzKEFERFJFU1NFU19CQUdHQUdFX0tFWSkgfHwgdGhyb3dSZWRhY3RlZGBubyBhZGRyZXNzZXMuIGNyZWF0b3IgbXVzdCAncHVibGlzaEFkZHJlc3NlcycgZmlyc3RgO1xuICAgICAgY29uc3QgYWRkcmVzc2VzID0gYmFnZ2FnZS5nZXQoQUREUkVTU0VTX0JBR0dBR0VfS0VZKTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBbQUREUkVTU0VTX0JBR0dBR0VfS0VZXTogYWRkcmVzc2VzXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICBwdWJsaXNoRmVlQ29uZmlnKHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyLCBmZWVDb25maWcpO1xuICBjb25zdCBzaGFyZU1pbnQgPSBhd2FpdCBwcm92aWRlU2luZ2xldG9uKFxuICAgIHpvbmUubWFwU3RvcmUoXCJtaW50XCIpLFxuICAgIFwiUG9vbFNoYXJlXCIsXG4gICAgKCkgPT4gemNmLm1ha2VaQ0ZNaW50KFwiUG9vbFNoYXJlc1wiLCBBc3NldEtpbmQuTkFULCB7XG4gICAgICBkZWNpbWFsUGxhY2VzOiA2XG4gICAgfSlcbiAgKTtcbiAgY29uc3QgcG9vbEtpdCA9IHpvbmUubWFrZU9uY2UoXG4gICAgXCJMaXF1aWRpdHkgUG9vbCBraXRcIixcbiAgICAoKSA9PiBtYWtlTGlxdWlkaXR5UG9vbEtpdChzaGFyZU1pbnQsIHByaXZhdGVBcmdzLnBvb2xNZXRyaWNzTm9kZSlcbiAgKTtcbiAgY29uc3QgZmVlZEtpdCA9IHpvbmUubWFrZU9uY2UoXCJGZWVkIEtpdFwiLCAoKSA9PiBtYWtlRmVlZEtpdCgpKTtcbiAgY29uc3QgW3Bvb2xBY2NvdW50LCBzZXR0bGVtZW50QWNjb3VudF0gPSBhd2FpdCB2b3dUb29scy53aGVuKFxuICAgIHZvd1Rvb2xzLmFsbChbcG9vbEFjY291bnRWLCBzZXR0bGVBY2NvdW50Vl0pXG4gICk7XG4gIHRyYWNlMTQoXCJzZXR0bGVtZW50QWNjb3VudFwiLCBzZXR0bGVtZW50QWNjb3VudCk7XG4gIHRyYWNlMTQoXCJwb29sQWNjb3VudFwiLCBwb29sQWNjb3VudCk7XG4gIGNvbnN0IHNldHRsZW1lbnRBZGRyZXNzID0gYXdhaXQgRShzZXR0bGVtZW50QWNjb3VudCkuZ2V0QWRkcmVzcygpO1xuICB0cmFjZTE0KFwic2V0dGxlbWVudEFkZHJlc3NcIiwgc2V0dGxlbWVudEFkZHJlc3MpO1xuICBjb25zdCBbX2Fnb3JpYywgX25vYmxlLCBhZ1RvTm9ibGVdID0gYXdhaXQgdm93VG9vbHMud2hlbihcbiAgICBjaGFpbkh1Yi5nZXRDaGFpbnNBbmRDb25uZWN0aW9uKFwiYWdvcmljXCIsIFwibm9ibGVcIilcbiAgKTtcbiAgY29uc3Qgc2V0dGxlcktpdCA9IHpvbmUubWFrZU9uY2UoXG4gICAgXCJzZXR0bGVyS2l0XCIsXG4gICAgKCkgPT4gbWFrZVNldHRsZXIoe1xuICAgICAgcmVwYXllcjogcG9vbEtpdC5yZXBheWVyLFxuICAgICAgc291cmNlQ2hhbm5lbDogYWdUb05vYmxlLnRyYW5zZmVyQ2hhbm5lbC5jb3VudGVyUGFydHlDaGFubmVsSWQsXG4gICAgICByZW1vdGVEZW5vbTogXCJ1dXNkY1wiLFxuICAgICAgc2V0dGxlbWVudEFjY291bnRcbiAgICB9KVxuICApO1xuICBjb25zdCBhZHZhbmNlciA9IG1ha2VBZHZhbmNlcih7XG4gICAgYm9ycm93ZXI6IHBvb2xLaXQuYm9ycm93ZXIsXG4gICAgbm90aWZpZXI6IHNldHRsZXJLaXQubm90aWZpZXIsXG4gICAgcG9vbEFjY291bnQsXG4gICAgc2V0dGxlbWVudEFkZHJlc3NcbiAgfSk7XG4gIHZvaWQgb2JzZXJ2ZUl0ZXJhdGlvbihzdWJzY3JpYmVFYWNoKGZlZWRLaXQucHVibGljLmdldEV2aWRlbmNlU3Vic2NyaWJlcigpKSwge1xuICAgIHVwZGF0ZVN0YXRlKGV2aWRlbmNlV2l0aFJpc2spIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZvaWQgYWR2YW5jZXIuaGFuZGxlVHJhbnNhY3Rpb25FdmVudChldmlkZW5jZVdpdGhSaXNrKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICB0cmFjZTE0KFwiXFx1ezFGNkE4fSBFcnJvciBoYW5kbGluZyB0cmFuc2FjdGlvbiBldmVudFwiLCBlcnIpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIGF3YWl0IHNldHRsZXJLaXQuY3JlYXRvci5tb25pdG9yTWludGluZ0RlcG9zaXRzKCk7XG4gIHN0YXJ0Rm9yd2FyZFJldHJpZXIoe1xuICAgIGZvcndhcmRGdW5kczogZm9yd2FyZEZ1bmRzMixcbiAgICBnZXRGb3J3YXJkc1RvUmV0cnk6IHN0YXR1c01hbmFnZXIuZ2V0Rm9yd2FyZHNUb1JldHJ5LmJpbmQoc3RhdHVzTWFuYWdlciksXG4gICAgbG9nOiB0cmFjZTE0LFxuICAgIHJvdXRlSGVhbHRoLFxuICAgIFVTRENcbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oeyBjcmVhdG9yRmFjZXQsIHB1YmxpY0ZhY2V0IH0pO1xufTtjb250cmFjdD0kY82PX2NvbnRyYWN0O1xuaGFyZGVuKGNvbnRyYWN0KTtcbnZhciAkY82PX3N0YXJ0PXdpdGhPcmNoZXN0cmF0aW9uKGNvbnRyYWN0LHtcbiAgY2hhaW5JbmZvVmFsdWVTaGFwZTogQ29zbW9zQ2hhaW5JbmZvU2hhcGVWMVxufSk7c3RhcnQ9JGPNj19zdGFydDtcbmhhcmRlbihzdGFydCk7XG59KSgpXG4iLCJfX2xpdmVFeHBvcnRNYXBfXyI6eyJtZXRhIjpbIm1ldGEiLHRydWVdLCJjb250cmFjdCI6WyJjb250cmFjdCIsdHJ1ZV0sInN0YXJ0IjpbInN0YXJ0Iix0cnVlXX0sIl9fcmVleHBvcnRNYXBfXyI6e30sIl9fZml4ZWRFeHBvcnRNYXBfXyI6e30sIl9fbmVlZHNJbXBvcnRfXyI6ZmFsc2UsIl9fbmVlZHNJbXBvcnRNZXRhX18iOmZhbHNlfVBLAQIeAwoAAAAAAAAAAABm8ROttgIAALYCAAAUAAAAAAAAAAAAAACkgQAAAABjb21wYXJ0bWVudC1tYXAuanNvblBLAQIeAwoAAAAAAAAAAABj3tPb6jANAOowDQBCAAAAAAAAAAAAAACkgegCAABAYWdsb2NhbC9mYXN0LXVzZGMtZGVwbG95LXYwLjEuMC9kaXN0L2Zhc3QtdXNkYy5jb250cmFjdC5idW5kbGUuanNQSwUGAAAAAAIAAgCyAAAAMjQNAAAA",
  "endoZipBase64Sha512": "57337cfe14b7313808db4f60b65ac24849aaee9b3267d197dbb13e34b2bbb98851a49d2e9ae815dbbb6797af645231752b8db7e9c9587d1c20c790e4c808456c"
}