{"moduleFormat":"endoZipBase64","endoZipBase64":"UEsDBAoAAAAAAAAAAACs55LetgIAALYCAAAUAAAAY29tcGFydG1lbnQtbWFwLmpzb257CiAgInRhZ3MiOiBbXSwKICAiZW50cnkiOiB7CiAgICAiY29tcGFydG1lbnQiOiAiQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAiLAogICAgIm1vZHVsZSI6ICIuL2Rpc3QvZmFzdC11c2RjLmNvbnRyYWN0LmJ1bmRsZS5qcyIKICB9LAogICJjb21wYXJ0bWVudHMiOiB7CiAgICAiQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAiOiB7CiAgICAgICJuYW1lIjogIkBhZ2xvY2FsL2Zhc3QtdXNkYy1kZXBsb3kiLAogICAgICAibGFiZWwiOiAiQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAiLAogICAgICAibG9jYXRpb24iOiAiQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAiLAogICAgICAibW9kdWxlcyI6IHsKICAgICAgICAiLi9kaXN0L2Zhc3QtdXNkYy5jb250cmFjdC5idW5kbGUuanMiOiB7CiAgICAgICAgICAibG9jYXRpb24iOiAiZGlzdC9mYXN0LXVzZGMuY29udHJhY3QuYnVuZGxlLmpzIiwKICAgICAgICAgICJwYXJzZXIiOiAicHJlLW1qcy1qc29uIiwKICAgICAgICAgICJzaGE1MTIiOiAiY2MzOGY1MGZiNjlmYTVlODIzOWRiMzc0MmEzNzY0ZWJkMmVjZjQ5NTlkMzhlNzkyODhhYmNmN2ZhNzJlNTA4Y2U3Mjk4MTc2OGI5NGIyNzUyN2VhMDIwMjExNmJjMTg0NjJjMTM4NzhiZDAxNTgwMDNmODVmYmFmNjIyZWRhOTciCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9UEsDBAoAAAAAAAAAAAC6cxetIRUNACEVDQBCAAAAQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAvZGlzdC9mYXN0LXVzZGMuY29udHJhY3QuYnVuZGxlLmpzeyJpbXBvcnRzIjpbXSwiZXhwb3J0cyI6WyJjb250cmFjdCIsIm1ldGEiLCJzdGFydCJdLCJyZWV4cG9ydHMiOltdLCJfX3N5bmNNb2R1bGVQcm9ncmFtX18iOiIoe2ltcG9ydHM6JGjNj19pbXBvcnRzLGxpdmVWYXI6JGjNj19saXZlLG9uY2VWYXI6JGjNj19vbmNlLGltcG9ydDokaM2PX2ltcG9ydCxpbXBvcnRNZXRhOiRozY9fX19fbWV0YX0pPT4oZnVuY3Rpb24oKXsndXNlIHN0cmljdCc7JGjNj19pbXBvcnRzKFtdKTskaM2PX2xpdmUubWV0YSgpOyRozY9fbGl2ZS5jb250cmFjdCgpOyRozY9fbGl2ZS5zdGFydCgpO3ZhciBfX2NyZWF0ZSA9IE9iamVjdC5jcmVhdGU7XG52YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5O1xudmFyIF9fZ2V0T3duUHJvcERlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO1xudmFyIF9fZ2V0T3duUHJvcE5hbWVzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXM7XG52YXIgX19nZXRQcm90b09mID0gT2JqZWN0LmdldFByb3RvdHlwZU9mO1xudmFyIF9faGFzT3duUHJvcCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG52YXIgX19jb21tb25KUyA9IChjYiwgbW9kKSA9PiBmdW5jdGlvbiBfX3JlcXVpcmUoKSB7XG4gIHJldHVybiBtb2QgfHwgKDAsIGNiW19fZ2V0T3duUHJvcE5hbWVzKGNiKVswXV0pKChtb2QgPSB7IGV4cG9ydHM6IHt9IH0pLmV4cG9ydHMsIG1vZCksIG1vZC5leHBvcnRzO1xufTtcbnZhciBfX2V4cG9ydCA9ICh0YXJnZXQsIGFsbCkgPT4ge1xuICBmb3IgKHZhciBuYW1lIGluIGFsbClcbiAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xufTtcbnZhciBfX2NvcHlQcm9wcyA9ICh0bywgZnJvbSwgZXhjZXB0LCBkZXNjKSA9PiB7XG4gIGlmIChmcm9tICYmIHR5cGVvZiBmcm9tID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBmcm9tID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBmb3IgKGxldCBrZXkgb2YgX19nZXRPd25Qcm9wTmFtZXMoZnJvbSkpXG4gICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KVxuICAgICAgICBfX2RlZlByb3AodG8sIGtleSwgeyBnZXQ6ICgpID0+IGZyb21ba2V5XSwgZW51bWVyYWJsZTogIShkZXNjID0gX19nZXRPd25Qcm9wRGVzYyhmcm9tLCBrZXkpKSB8fCBkZXNjLmVudW1lcmFibGUgfSk7XG4gIH1cbiAgcmV0dXJuIHRvO1xufTtcbnZhciBfX3RvRVNNID0gKG1vZCwgaXNOb2RlTW9kZSwgdGFyZ2V0KSA9PiAodGFyZ2V0ID0gbW9kICE9IG51bGwgPyBfX2NyZWF0ZShfX2dldFByb3RvT2YobW9kKSkgOiB7fSwgX19jb3B5UHJvcHMoXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIGlzTm9kZU1vZGUgfHwgIW1vZCB8fCAhbW9kLl9fZXNNb2R1bGUgPyBfX2RlZlByb3AodGFyZ2V0LCBcImRlZmF1bHRcIiwgeyB2YWx1ZTogbW9kLCBlbnVtZXJhYmxlOiB0cnVlIH0pIDogdGFyZ2V0LFxuICBtb2RcbikpO1xuXG4vL1xudmFyIHJlcXVpcmVfYXNjaWkgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9idWlsZC9hc2NpaS5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy5mcm9tQXNjaWkgPSBleHBvcnRzLnRvQXNjaWkgPSB2b2lkIDA7XG4gICAgZnVuY3Rpb24gdG9Bc2NpaShpbnB1dCkge1xuICAgICAgY29uc3QgdG9OdW1zID0gKHN0cikgPT4gc3RyLnNwbGl0KFwiXCIpLm1hcCgoeCkgPT4ge1xuICAgICAgICBjb25zdCBjaGFyQ29kZSA9IHguY2hhckNvZGVBdCgwKTtcbiAgICAgICAgaWYgKGNoYXJDb2RlIDwgMzIgfHwgY2hhckNvZGUgPiAxMjYpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZW5jb2RlIGNoYXJhY3RlciB0aGF0IGlzIG91dCBvZiBwcmludGFibGUgQVNDSUkgcmFuZ2U6IFwiICsgY2hhckNvZGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGFyQ29kZTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIFVpbnQ4QXJyYXkuZnJvbSh0b051bXMoaW5wdXQpKTtcbiAgICB9XG4gICAgZXhwb3J0cy50b0FzY2lpID0gdG9Bc2NpaTtcbiAgICBmdW5jdGlvbiBmcm9tQXNjaWkoZGF0YSkge1xuICAgICAgY29uc3QgZnJvbU51bXMgPSAobGlzdE9mTnVtYmVycykgPT4gbGlzdE9mTnVtYmVycy5tYXAoKHgpID0+IHtcbiAgICAgICAgaWYgKHggPCAzMiB8fCB4ID4gMTI2KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGRlY29kZSBjaGFyYWN0ZXIgdGhhdCBpcyBvdXQgb2YgcHJpbnRhYmxlIEFTQ0lJIHJhbmdlOiBcIiArIHgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZnJvbU51bXMoQXJyYXkuZnJvbShkYXRhKSkuam9pbihcIlwiKTtcbiAgICB9XG4gICAgZXhwb3J0cy5mcm9tQXNjaWkgPSBmcm9tQXNjaWk7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYmFzZTY0X2pzID0gX19jb21tb25KUyh7XG4gIFwiLi4vLi4vbm9kZV9tb2R1bGVzL2Jhc2U2NC1qcy9pbmRleC5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBleHBvcnRzLmJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoO1xuICAgIGV4cG9ydHMudG9CeXRlQXJyYXkgPSB0b0J5dGVBcnJheTtcbiAgICBleHBvcnRzLmZyb21CeXRlQXJyYXkgPSBmcm9tQnl0ZUFycmF5O1xuICAgIHZhciBsb29rdXAgPSBbXTtcbiAgICB2YXIgcmV2TG9va3VwID0gW107XG4gICAgdmFyIEFyciA9IHR5cGVvZiBVaW50OEFycmF5ICE9PSBcInVuZGVmaW5lZFwiID8gVWludDhBcnJheSA6IEFycmF5O1xuICAgIHZhciBjb2RlID0gXCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvXCI7XG4gICAgZm9yIChpMiA9IDAsIGxlbiA9IGNvZGUubGVuZ3RoOyBpMiA8IGxlbjsgKytpMikge1xuICAgICAgbG9va3VwW2kyXSA9IGNvZGVbaTJdO1xuICAgICAgcmV2TG9va3VwW2NvZGUuY2hhckNvZGVBdChpMildID0gaTI7XG4gICAgfVxuICAgIHZhciBpMjtcbiAgICB2YXIgbGVuO1xuICAgIHJldkxvb2t1cFtcIi1cIi5jaGFyQ29kZUF0KDApXSA9IDYyO1xuICAgIHJldkxvb2t1cFtcIl9cIi5jaGFyQ29kZUF0KDApXSA9IDYzO1xuICAgIGZ1bmN0aW9uIGdldExlbnMoYjY0KSB7XG4gICAgICB2YXIgbGVuMiA9IGI2NC5sZW5ndGg7XG4gICAgICBpZiAobGVuMiAlIDQgPiAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3RyaW5nLiBMZW5ndGggbXVzdCBiZSBhIG11bHRpcGxlIG9mIDRcIik7XG4gICAgICB9XG4gICAgICB2YXIgdmFsaWRMZW4gPSBiNjQuaW5kZXhPZihcIj1cIik7XG4gICAgICBpZiAodmFsaWRMZW4gPT09IC0xKSB2YWxpZExlbiA9IGxlbjI7XG4gICAgICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gdmFsaWRMZW4gPT09IGxlbjIgPyAwIDogNCAtIHZhbGlkTGVuICUgNDtcbiAgICAgIHJldHVybiBbdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbl07XG4gICAgfVxuICAgIGZ1bmN0aW9uIGJ5dGVMZW5ndGgoYjY0KSB7XG4gICAgICB2YXIgbGVucyA9IGdldExlbnMoYjY0KTtcbiAgICAgIHZhciB2YWxpZExlbiA9IGxlbnNbMF07XG4gICAgICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gbGVuc1sxXTtcbiAgICAgIHJldHVybiAodmFsaWRMZW4gKyBwbGFjZUhvbGRlcnNMZW4pICogMyAvIDQgLSBwbGFjZUhvbGRlcnNMZW47XG4gICAgfVxuICAgIGZ1bmN0aW9uIF9ieXRlTGVuZ3RoKGI2NCwgdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbikge1xuICAgICAgcmV0dXJuICh2YWxpZExlbiArIHBsYWNlSG9sZGVyc0xlbikgKiAzIC8gNCAtIHBsYWNlSG9sZGVyc0xlbjtcbiAgICB9XG4gICAgZnVuY3Rpb24gdG9CeXRlQXJyYXkoYjY0KSB7XG4gICAgICB2YXIgdG1wO1xuICAgICAgdmFyIGxlbnMgPSBnZXRMZW5zKGI2NCk7XG4gICAgICB2YXIgdmFsaWRMZW4gPSBsZW5zWzBdO1xuICAgICAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IGxlbnNbMV07XG4gICAgICB2YXIgYXJyID0gbmV3IEFycihfYnl0ZUxlbmd0aChiNjQsIHZhbGlkTGVuLCBwbGFjZUhvbGRlcnNMZW4pKTtcbiAgICAgIHZhciBjdXJCeXRlID0gMDtcbiAgICAgIHZhciBsZW4yID0gcGxhY2VIb2xkZXJzTGVuID4gMCA/IHZhbGlkTGVuIC0gNCA6IHZhbGlkTGVuO1xuICAgICAgdmFyIGkzO1xuICAgICAgZm9yIChpMyA9IDA7IGkzIDwgbGVuMjsgaTMgKz0gNCkge1xuICAgICAgICB0bXAgPSByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTMpXSA8PCAxOCB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyArIDEpXSA8PCAxMiB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyArIDIpXSA8PCA2IHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkzICsgMyldO1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCA+PiAxNiAmIDI1NTtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgPj4gOCAmIDI1NTtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAyNTU7XG4gICAgICB9XG4gICAgICBpZiAocGxhY2VIb2xkZXJzTGVuID09PSAyKSB7XG4gICAgICAgIHRtcCA9IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyldIDw8IDIgfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTMgKyAxKV0gPj4gNDtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAyNTU7XG4gICAgICB9XG4gICAgICBpZiAocGxhY2VIb2xkZXJzTGVuID09PSAxKSB7XG4gICAgICAgIHRtcCA9IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyldIDw8IDEwIHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkzICsgMSldIDw8IDQgfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTMgKyAyKV0gPj4gMjtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgPj4gOCAmIDI1NTtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAyNTU7XG4gICAgICB9XG4gICAgICByZXR1cm4gYXJyO1xuICAgIH1cbiAgICBmdW5jdGlvbiB0cmlwbGV0VG9CYXNlNjQobnVtKSB7XG4gICAgICByZXR1cm4gbG9va3VwW251bSA+PiAxOCAmIDYzXSArIGxvb2t1cFtudW0gPj4gMTIgJiA2M10gKyBsb29rdXBbbnVtID4+IDYgJiA2M10gKyBsb29rdXBbbnVtICYgNjNdO1xuICAgIH1cbiAgICBmdW5jdGlvbiBlbmNvZGVDaHVuayh1aW50OCwgc3RhcnQyLCBlbmQpIHtcbiAgICAgIHZhciB0bXA7XG4gICAgICB2YXIgb3V0cHV0ID0gW107XG4gICAgICBmb3IgKHZhciBpMyA9IHN0YXJ0MjsgaTMgPCBlbmQ7IGkzICs9IDMpIHtcbiAgICAgICAgdG1wID0gKHVpbnQ4W2kzXSA8PCAxNiAmIDE2NzExNjgwKSArICh1aW50OFtpMyArIDFdIDw8IDggJiA2NTI4MCkgKyAodWludDhbaTMgKyAyXSAmIDI1NSk7XG4gICAgICAgIG91dHB1dC5wdXNoKHRyaXBsZXRUb0Jhc2U2NCh0bXApKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvdXRwdXQuam9pbihcIlwiKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbUJ5dGVBcnJheSh1aW50OCkge1xuICAgICAgdmFyIHRtcDtcbiAgICAgIHZhciBsZW4yID0gdWludDgubGVuZ3RoO1xuICAgICAgdmFyIGV4dHJhQnl0ZXMgPSBsZW4yICUgMztcbiAgICAgIHZhciBwYXJ0cyA9IFtdO1xuICAgICAgdmFyIG1heENodW5rTGVuZ3RoID0gMTYzODM7XG4gICAgICBmb3IgKHZhciBpMyA9IDAsIGxlbjIyID0gbGVuMiAtIGV4dHJhQnl0ZXM7IGkzIDwgbGVuMjI7IGkzICs9IG1heENodW5rTGVuZ3RoKSB7XG4gICAgICAgIHBhcnRzLnB1c2goZW5jb2RlQ2h1bmsodWludDgsIGkzLCBpMyArIG1heENodW5rTGVuZ3RoID4gbGVuMjIgPyBsZW4yMiA6IGkzICsgbWF4Q2h1bmtMZW5ndGgpKTtcbiAgICAgIH1cbiAgICAgIGlmIChleHRyYUJ5dGVzID09PSAxKSB7XG4gICAgICAgIHRtcCA9IHVpbnQ4W2xlbjIgLSAxXTtcbiAgICAgICAgcGFydHMucHVzaChcbiAgICAgICAgICBsb29rdXBbdG1wID4+IDJdICsgbG9va3VwW3RtcCA8PCA0ICYgNjNdICsgXCI9PVwiXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKGV4dHJhQnl0ZXMgPT09IDIpIHtcbiAgICAgICAgdG1wID0gKHVpbnQ4W2xlbjIgLSAyXSA8PCA4KSArIHVpbnQ4W2xlbjIgLSAxXTtcbiAgICAgICAgcGFydHMucHVzaChcbiAgICAgICAgICBsb29rdXBbdG1wID4+IDEwXSArIGxvb2t1cFt0bXAgPj4gNCAmIDYzXSArIGxvb2t1cFt0bXAgPDwgMiAmIDYzXSArIFwiPVwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGFydHMuam9pbihcIlwiKTtcbiAgICB9XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYmFzZTY0ID0gX19jb21tb25KUyh7XG4gIFwiLi4vLi4vbm9kZV9tb2R1bGVzL0Bjb3NtanMvZW5jb2RpbmcvYnVpbGQvYmFzZTY0LmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIHZhciBfX2NyZWF0ZUJpbmRpbmcgPSBleHBvcnRzICYmIGV4cG9ydHMuX19jcmVhdGVCaW5kaW5nIHx8IChPYmplY3QuY3JlYXRlID8gZnVuY3Rpb24obzIsIG0yLCBrLCBrMikge1xuICAgICAgaWYgKGsyID09PSB2b2lkIDApIGsyID0gaztcbiAgICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtMiwgayk7XG4gICAgICBpZiAoIWRlc2MgfHwgKFwiZ2V0XCIgaW4gZGVzYyA/ICFtMi5fX2VzTW9kdWxlIDogZGVzYy53cml0YWJsZSB8fCBkZXNjLmNvbmZpZ3VyYWJsZSkpIHtcbiAgICAgICAgZGVzYyA9IHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbTJba107XG4gICAgICAgIH0gfTtcbiAgICAgIH1cbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvMiwgazIsIGRlc2MpO1xuICAgIH0gOiBmdW5jdGlvbihvMiwgbTIsIGssIGsyKSB7XG4gICAgICBpZiAoazIgPT09IHZvaWQgMCkgazIgPSBrO1xuICAgICAgbzJbazJdID0gbTJba107XG4gICAgfSk7XG4gICAgdmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IGV4cG9ydHMgJiYgZXhwb3J0cy5fX3NldE1vZHVsZURlZmF1bHQgfHwgKE9iamVjdC5jcmVhdGUgPyBmdW5jdGlvbihvMiwgdjMpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvMiwgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYzIH0pO1xuICAgIH0gOiBmdW5jdGlvbihvMiwgdjMpIHtcbiAgICAgIG8yW1wiZGVmYXVsdFwiXSA9IHYzO1xuICAgIH0pO1xuICAgIHZhciBfX2ltcG9ydFN0YXIgPSBleHBvcnRzICYmIGV4cG9ydHMuX19pbXBvcnRTdGFyIHx8IGZ1bmN0aW9uKG1vZCkge1xuICAgICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICAgIGlmIChtb2QgIT0gbnVsbCkge1xuICAgICAgICBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgICAgfVxuICAgICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy5mcm9tQmFzZTY0ID0gZXhwb3J0cy50b0Jhc2U2NCA9IHZvaWQgMDtcbiAgICB2YXIgYmFzZTY0anMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZV9iYXNlNjRfanMoKSk7XG4gICAgZnVuY3Rpb24gdG9CYXNlNjQoZGF0YSkge1xuICAgICAgcmV0dXJuIGJhc2U2NGpzLmZyb21CeXRlQXJyYXkoZGF0YSk7XG4gICAgfVxuICAgIGV4cG9ydHMudG9CYXNlNjQgPSB0b0Jhc2U2NDtcbiAgICBmdW5jdGlvbiBmcm9tQmFzZTY0KGJhc2U2NFN0cmluZykge1xuICAgICAgaWYgKCFiYXNlNjRTdHJpbmcubWF0Y2goL15bYS16QS1aMC05Ky9dKj17MCwyfSQvKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGJhc2U2NCBzdHJpbmcgZm9ybWF0XCIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJhc2U2NGpzLnRvQnl0ZUFycmF5KGJhc2U2NFN0cmluZyk7XG4gICAgfVxuICAgIGV4cG9ydHMuZnJvbUJhc2U2NCA9IGZyb21CYXNlNjQ7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYmVjaDMyID0gX19jb21tb25KUyh7XG4gIFwiLi4vLi4vbm9kZV9tb2R1bGVzL0Bjb3NtanMvZW5jb2Rpbmcvbm9kZV9tb2R1bGVzL2JlY2gzMi9pbmRleC5qc1wiKGV4cG9ydHMsIG1vZHVsZSkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIHZhciBBTFBIQUJFVDIgPSBcInFwenJ5OXg4Z2YydHZkdzBzM2puNTRraGNlNm11YTdsXCI7XG4gICAgdmFyIEFMUEhBQkVUX01BUCA9IHt9O1xuICAgIGZvciAoeiA9IDA7IHogPCBBTFBIQUJFVDIubGVuZ3RoOyB6KyspIHtcbiAgICAgIHggPSBBTFBIQUJFVDIuY2hhckF0KHopO1xuICAgICAgaWYgKEFMUEhBQkVUX01BUFt4XSAhPT0gdm9pZCAwKSB0aHJvdyBuZXcgVHlwZUVycm9yKHggKyBcIiBpcyBhbWJpZ3VvdXNcIik7XG4gICAgICBBTFBIQUJFVF9NQVBbeF0gPSB6O1xuICAgIH1cbiAgICB2YXIgeDtcbiAgICB2YXIgejtcbiAgICBmdW5jdGlvbiBwb2x5bW9kU3RlcChwcmUpIHtcbiAgICAgIHZhciBiMyA9IHByZSA+PiAyNTtcbiAgICAgIHJldHVybiAocHJlICYgMzM1NTQ0MzEpIDw8IDUgXiAtKGIzID4+IDAgJiAxKSAmIDk5NjgyNTAxMCBeIC0oYjMgPj4gMSAmIDEpICYgNjQyODEzNTQ5IF4gLShiMyA+PiAyICYgMSkgJiA1MTM4NzQ0MjYgXiAtKGIzID4+IDMgJiAxKSAmIDEwMjc3NDg4MjkgXiAtKGIzID4+IDQgJiAxKSAmIDcwNTk3OTA1OTtcbiAgICB9XG4gICAgZnVuY3Rpb24gcHJlZml4Q2hrKHByZWZpeCkge1xuICAgICAgdmFyIGNoayA9IDE7XG4gICAgICBmb3IgKHZhciBpMiA9IDA7IGkyIDwgcHJlZml4Lmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YXIgYzIgPSBwcmVmaXguY2hhckNvZGVBdChpMik7XG4gICAgICAgIGlmIChjMiA8IDMzIHx8IGMyID4gMTI2KSByZXR1cm4gXCJJbnZhbGlkIHByZWZpeCAoXCIgKyBwcmVmaXggKyBcIilcIjtcbiAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIGMyID4+IDU7XG4gICAgICB9XG4gICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspO1xuICAgICAgZm9yIChpMiA9IDA7IGkyIDwgcHJlZml4Lmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YXIgdjMgPSBwcmVmaXguY2hhckNvZGVBdChpMik7XG4gICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoaykgXiB2MyAmIDMxO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNoaztcbiAgICB9XG4gICAgZnVuY3Rpb24gZW5jb2RlMihwcmVmaXgsIHdvcmRzLCBMSU1JVCkge1xuICAgICAgTElNSVQgPSBMSU1JVCB8fCA5MDtcbiAgICAgIGlmIChwcmVmaXgubGVuZ3RoICsgNyArIHdvcmRzLmxlbmd0aCA+IExJTUlUKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRXhjZWVkcyBsZW5ndGggbGltaXRcIik7XG4gICAgICBwcmVmaXggPSBwcmVmaXgudG9Mb3dlckNhc2UoKTtcbiAgICAgIHZhciBjaGsgPSBwcmVmaXhDaGsocHJlZml4KTtcbiAgICAgIGlmICh0eXBlb2YgY2hrID09PSBcInN0cmluZ1wiKSB0aHJvdyBuZXcgRXJyb3IoY2hrKTtcbiAgICAgIHZhciByZXN1bHQgPSBwcmVmaXggKyBcIjFcIjtcbiAgICAgIGZvciAodmFyIGkyID0gMDsgaTIgPCB3b3Jkcy5sZW5ndGg7ICsraTIpIHtcbiAgICAgICAgdmFyIHgyID0gd29yZHNbaTJdO1xuICAgICAgICBpZiAoeDIgPj4gNSAhPT0gMCkgdGhyb3cgbmV3IEVycm9yKFwiTm9uIDUtYml0IHdvcmRcIik7XG4gICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoaykgXiB4MjtcbiAgICAgICAgcmVzdWx0ICs9IEFMUEhBQkVUMi5jaGFyQXQoeDIpO1xuICAgICAgfVxuICAgICAgZm9yIChpMiA9IDA7IGkyIDwgNjsgKytpMikge1xuICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspO1xuICAgICAgfVxuICAgICAgY2hrIF49IDE7XG4gICAgICBmb3IgKGkyID0gMDsgaTIgPCA2OyArK2kyKSB7XG4gICAgICAgIHZhciB2MyA9IGNoayA+PiAoNSAtIGkyKSAqIDUgJiAzMTtcbiAgICAgICAgcmVzdWx0ICs9IEFMUEhBQkVUMi5jaGFyQXQodjMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgZnVuY3Rpb24gX19kZWNvZGUoc3RyLCBMSU1JVCkge1xuICAgICAgTElNSVQgPSBMSU1JVCB8fCA5MDtcbiAgICAgIGlmIChzdHIubGVuZ3RoIDwgOCkgcmV0dXJuIHN0ciArIFwiIHRvbyBzaG9ydFwiO1xuICAgICAgaWYgKHN0ci5sZW5ndGggPiBMSU1JVCkgcmV0dXJuIFwiRXhjZWVkcyBsZW5ndGggbGltaXRcIjtcbiAgICAgIHZhciBsb3dlcmVkID0gc3RyLnRvTG93ZXJDYXNlKCk7XG4gICAgICB2YXIgdXBwZXJlZCA9IHN0ci50b1VwcGVyQ2FzZSgpO1xuICAgICAgaWYgKHN0ciAhPT0gbG93ZXJlZCAmJiBzdHIgIT09IHVwcGVyZWQpIHJldHVybiBcIk1peGVkLWNhc2Ugc3RyaW5nIFwiICsgc3RyO1xuICAgICAgc3RyID0gbG93ZXJlZDtcbiAgICAgIHZhciBzcGxpdCA9IHN0ci5sYXN0SW5kZXhPZihcIjFcIik7XG4gICAgICBpZiAoc3BsaXQgPT09IC0xKSByZXR1cm4gXCJObyBzZXBhcmF0b3IgY2hhcmFjdGVyIGZvciBcIiArIHN0cjtcbiAgICAgIGlmIChzcGxpdCA9PT0gMCkgcmV0dXJuIFwiTWlzc2luZyBwcmVmaXggZm9yIFwiICsgc3RyO1xuICAgICAgdmFyIHByZWZpeCA9IHN0ci5zbGljZSgwLCBzcGxpdCk7XG4gICAgICB2YXIgd29yZENoYXJzID0gc3RyLnNsaWNlKHNwbGl0ICsgMSk7XG4gICAgICBpZiAod29yZENoYXJzLmxlbmd0aCA8IDYpIHJldHVybiBcIkRhdGEgdG9vIHNob3J0XCI7XG4gICAgICB2YXIgY2hrID0gcHJlZml4Q2hrKHByZWZpeCk7XG4gICAgICBpZiAodHlwZW9mIGNoayA9PT0gXCJzdHJpbmdcIikgcmV0dXJuIGNoaztcbiAgICAgIHZhciB3b3JkcyA9IFtdO1xuICAgICAgZm9yICh2YXIgaTIgPSAwOyBpMiA8IHdvcmRDaGFycy5sZW5ndGg7ICsraTIpIHtcbiAgICAgICAgdmFyIGMyID0gd29yZENoYXJzLmNoYXJBdChpMik7XG4gICAgICAgIHZhciB2MyA9IEFMUEhBQkVUX01BUFtjMl07XG4gICAgICAgIGlmICh2MyA9PT0gdm9pZCAwKSByZXR1cm4gXCJVbmtub3duIGNoYXJhY3RlciBcIiArIGMyO1xuICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspIF4gdjM7XG4gICAgICAgIGlmIChpMiArIDYgPj0gd29yZENoYXJzLmxlbmd0aCkgY29udGludWU7XG4gICAgICAgIHdvcmRzLnB1c2godjMpO1xuICAgICAgfVxuICAgICAgaWYgKGNoayAhPT0gMSkgcmV0dXJuIFwiSW52YWxpZCBjaGVja3N1bSBmb3IgXCIgKyBzdHI7XG4gICAgICByZXR1cm4geyBwcmVmaXgsIHdvcmRzIH07XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRlY29kZVVuc2FmZSgpIHtcbiAgICAgIHZhciByZXMgPSBfX2RlY29kZS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHR5cGVvZiByZXMgPT09IFwib2JqZWN0XCIpIHJldHVybiByZXM7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRlY29kZTMoc3RyKSB7XG4gICAgICB2YXIgcmVzID0gX19kZWNvZGUuYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0eXBlb2YgcmVzID09PSBcIm9iamVjdFwiKSByZXR1cm4gcmVzO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNvbnZlcnQoZGF0YSwgaW5CaXRzLCBvdXRCaXRzLCBwYWQpIHtcbiAgICAgIHZhciB2YWx1ZSA9IDA7XG4gICAgICB2YXIgYml0cyA9IDA7XG4gICAgICB2YXIgbWF4ViA9ICgxIDw8IG91dEJpdHMpIC0gMTtcbiAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgIGZvciAodmFyIGkyID0gMDsgaTIgPCBkYXRhLmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YWx1ZSA9IHZhbHVlIDw8IGluQml0cyB8IGRhdGFbaTJdO1xuICAgICAgICBiaXRzICs9IGluQml0cztcbiAgICAgICAgd2hpbGUgKGJpdHMgPj0gb3V0Qml0cykge1xuICAgICAgICAgIGJpdHMgLT0gb3V0Qml0cztcbiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSA+PiBiaXRzICYgbWF4Vik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChwYWQpIHtcbiAgICAgICAgaWYgKGJpdHMgPiAwKSB7XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUgPDwgb3V0Qml0cyAtIGJpdHMgJiBtYXhWKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGJpdHMgPj0gaW5CaXRzKSByZXR1cm4gXCJFeGNlc3MgcGFkZGluZ1wiO1xuICAgICAgICBpZiAodmFsdWUgPDwgb3V0Qml0cyAtIGJpdHMgJiBtYXhWKSByZXR1cm4gXCJOb24temVybyBwYWRkaW5nXCI7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b1dvcmRzVW5zYWZlKGJ5dGVzKSB7XG4gICAgICB2YXIgcmVzID0gY29udmVydChieXRlcywgOCwgNSwgdHJ1ZSk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpKSByZXR1cm4gcmVzO1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b1dvcmRzKGJ5dGVzKSB7XG4gICAgICB2YXIgcmVzID0gY29udmVydChieXRlcywgOCwgNSwgdHJ1ZSk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpKSByZXR1cm4gcmVzO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21Xb3Jkc1Vuc2FmZSh3b3Jkcykge1xuICAgICAgdmFyIHJlcyA9IGNvbnZlcnQod29yZHMsIDUsIDgsIGZhbHNlKTtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlcykpIHJldHVybiByZXM7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21Xb3Jkcyh3b3Jkcykge1xuICAgICAgdmFyIHJlcyA9IGNvbnZlcnQod29yZHMsIDUsIDgsIGZhbHNlKTtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlcykpIHJldHVybiByZXM7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzKTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgICBkZWNvZGVVbnNhZmUsXG4gICAgICBkZWNvZGU6IGRlY29kZTMsXG4gICAgICBlbmNvZGU6IGVuY29kZTIsXG4gICAgICB0b1dvcmRzVW5zYWZlLFxuICAgICAgdG9Xb3JkcyxcbiAgICAgIGZyb21Xb3Jkc1Vuc2FmZSxcbiAgICAgIGZyb21Xb3Jkc1xuICAgIH07XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYmVjaDMyMiA9IF9fY29tbW9uSlMoe1xuICBcIi4uLy4uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL2JlY2gzMi5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICB2YXIgX19jcmVhdGVCaW5kaW5nID0gZXhwb3J0cyAmJiBleHBvcnRzLl9fY3JlYXRlQmluZGluZyB8fCAoT2JqZWN0LmNyZWF0ZSA/IGZ1bmN0aW9uKG8yLCBtMiwgaywgazIpIHtcbiAgICAgIGlmIChrMiA9PT0gdm9pZCAwKSBrMiA9IGs7XG4gICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobTIsIGspO1xuICAgICAgaWYgKCFkZXNjIHx8IChcImdldFwiIGluIGRlc2MgPyAhbTIuX19lc01vZHVsZSA6IGRlc2Mud3JpdGFibGUgfHwgZGVzYy5jb25maWd1cmFibGUpKSB7XG4gICAgICAgIGRlc2MgPSB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIG0yW2tdO1xuICAgICAgICB9IH07XG4gICAgICB9XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobzIsIGsyLCBkZXNjKTtcbiAgICB9IDogZnVuY3Rpb24obzIsIG0yLCBrLCBrMikge1xuICAgICAgaWYgKGsyID09PSB2b2lkIDApIGsyID0gaztcbiAgICAgIG8yW2syXSA9IG0yW2tdO1xuICAgIH0pO1xuICAgIHZhciBfX3NldE1vZHVsZURlZmF1bHQgPSBleHBvcnRzICYmIGV4cG9ydHMuX19zZXRNb2R1bGVEZWZhdWx0IHx8IChPYmplY3QuY3JlYXRlID8gZnVuY3Rpb24obzIsIHYzKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobzIsIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2MyB9KTtcbiAgICB9IDogZnVuY3Rpb24obzIsIHYzKSB7XG4gICAgICBvMltcImRlZmF1bHRcIl0gPSB2MztcbiAgICB9KTtcbiAgICB2YXIgX19pbXBvcnRTdGFyID0gZXhwb3J0cyAmJiBleHBvcnRzLl9faW1wb3J0U3RhciB8fCBmdW5jdGlvbihtb2QpIHtcbiAgICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgICBpZiAobW9kICE9IG51bGwpIHtcbiAgICAgICAgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICAgIH1cbiAgICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMubm9ybWFsaXplQmVjaDMyID0gZXhwb3J0cy5mcm9tQmVjaDMyID0gZXhwb3J0cy50b0JlY2gzMiA9IHZvaWQgMDtcbiAgICB2YXIgYmVjaDMyID0gX19pbXBvcnRTdGFyKHJlcXVpcmVfYmVjaDMyKCkpO1xuICAgIGZ1bmN0aW9uIHRvQmVjaDMyKHByZWZpeCwgZGF0YSwgbGltaXQyKSB7XG4gICAgICBjb25zdCBhZGRyZXNzID0gYmVjaDMyLmVuY29kZShwcmVmaXgsIGJlY2gzMi50b1dvcmRzKGRhdGEpLCBsaW1pdDIpO1xuICAgICAgcmV0dXJuIGFkZHJlc3M7XG4gICAgfVxuICAgIGV4cG9ydHMudG9CZWNoMzIgPSB0b0JlY2gzMjtcbiAgICBmdW5jdGlvbiBmcm9tQmVjaDMyKGFkZHJlc3MsIGxpbWl0MiA9IEluZmluaXR5KSB7XG4gICAgICBjb25zdCBkZWNvZGVkQWRkcmVzcyA9IGJlY2gzMi5kZWNvZGUoYWRkcmVzcywgbGltaXQyKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByZWZpeDogZGVjb2RlZEFkZHJlc3MucHJlZml4LFxuICAgICAgICBkYXRhOiBuZXcgVWludDhBcnJheShiZWNoMzIuZnJvbVdvcmRzKGRlY29kZWRBZGRyZXNzLndvcmRzKSlcbiAgICAgIH07XG4gICAgfVxuICAgIGV4cG9ydHMuZnJvbUJlY2gzMiA9IGZyb21CZWNoMzI7XG4gICAgZnVuY3Rpb24gbm9ybWFsaXplQmVjaDMyKGFkZHJlc3MpIHtcbiAgICAgIGNvbnN0IHsgcHJlZml4LCBkYXRhIH0gPSBmcm9tQmVjaDMyKGFkZHJlc3MpO1xuICAgICAgcmV0dXJuIHRvQmVjaDMyKHByZWZpeCwgZGF0YSk7XG4gICAgfVxuICAgIGV4cG9ydHMubm9ybWFsaXplQmVjaDMyID0gbm9ybWFsaXplQmVjaDMyO1xuICB9XG59KTtcblxuLy9cbnZhciByZXF1aXJlX2hleCA9IF9fY29tbW9uSlMoe1xuICBcIi4uLy4uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL2hleC5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy5mcm9tSGV4ID0gZXhwb3J0cy50b0hleCA9IHZvaWQgMDtcbiAgICBmdW5jdGlvbiB0b0hleChkYXRhKSB7XG4gICAgICBsZXQgb3V0ID0gXCJcIjtcbiAgICAgIGZvciAoY29uc3QgYnl0ZSBvZiBkYXRhKSB7XG4gICAgICAgIG91dCArPSAoXCIwXCIgKyBieXRlLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG4gICAgZXhwb3J0cy50b0hleCA9IHRvSGV4O1xuICAgIGZ1bmN0aW9uIGZyb21IZXgyKGhleHN0cmluZykge1xuICAgICAgaWYgKGhleHN0cmluZy5sZW5ndGggJSAyICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImhleCBzdHJpbmcgbGVuZ3RoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAyXCIpO1xuICAgICAgfVxuICAgICAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoaGV4c3RyaW5nLmxlbmd0aCAvIDIpO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IG91dC5sZW5ndGg7IGkyKyspIHtcbiAgICAgICAgY29uc3QgaiA9IDIgKiBpMjtcbiAgICAgICAgY29uc3QgaGV4Qnl0ZUFzU3RyaW5nID0gaGV4c3RyaW5nLnNsaWNlKGosIGogKyAyKTtcbiAgICAgICAgaWYgKCFoZXhCeXRlQXNTdHJpbmcubWF0Y2goL1swLTlhLWZdezJ9L2kpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaGV4IHN0cmluZyBjb250YWlucyBpbnZhbGlkIGNoYXJhY3RlcnNcIik7XG4gICAgICAgIH1cbiAgICAgICAgb3V0W2kyXSA9IHBhcnNlSW50KGhleEJ5dGVBc1N0cmluZywgMTYpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG4gICAgZXhwb3J0cy5mcm9tSGV4ID0gZnJvbUhleDI7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfcmZjMzMzOSA9IF9fY29tbW9uSlMoe1xuICBcIi4uLy4uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL3JmYzMzMzkuanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMudG9SZmMzMzM5ID0gZXhwb3J0cy5mcm9tUmZjMzMzOSA9IHZvaWQgMDtcbiAgICB2YXIgcmZjMzMzOU1hdGNoZXIgPSAvXihcXGR7NH0pLShcXGR7Mn0pLShcXGR7Mn0pW1QgXShcXGR7Mn0pOihcXGR7Mn0pOihcXGR7Mn0pKFxcLlxcZHsxLDl9KT8oKD86WystXVxcZHsyfTpcXGR7Mn0pfFopJC87XG4gICAgZnVuY3Rpb24gcGFkZGVkKGludGVnZXIsIGxlbmd0aCA9IDIpIHtcbiAgICAgIHJldHVybiBpbnRlZ2VyLnRvU3RyaW5nKCkucGFkU3RhcnQobGVuZ3RoLCBcIjBcIik7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21SZmMzMzM5KHN0cikge1xuICAgICAgY29uc3QgbWF0Y2hlczIgPSByZmMzMzM5TWF0Y2hlci5leGVjKHN0cik7XG4gICAgICBpZiAoIW1hdGNoZXMyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGUgc3RyaW5nIGlzIG5vdCBpbiBSRkMzMzM5IGZvcm1hdFwiKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHllYXIgPSArbWF0Y2hlczJbMV07XG4gICAgICBjb25zdCBtb250aCA9ICttYXRjaGVzMlsyXTtcbiAgICAgIGNvbnN0IGRheSA9ICttYXRjaGVzMlszXTtcbiAgICAgIGNvbnN0IGhvdXIgPSArbWF0Y2hlczJbNF07XG4gICAgICBjb25zdCBtaW51dGUgPSArbWF0Y2hlczJbNV07XG4gICAgICBjb25zdCBzZWNvbmQgPSArbWF0Y2hlczJbNl07XG4gICAgICBjb25zdCBtaWxsaVNlY29uZHMgPSBtYXRjaGVzMls3XSA/IE1hdGguZmxvb3IoK21hdGNoZXMyWzddICogMWUzKSA6IDA7XG4gICAgICBsZXQgdHpPZmZzZXRTaWduO1xuICAgICAgbGV0IHR6T2Zmc2V0SG91cnM7XG4gICAgICBsZXQgdHpPZmZzZXRNaW51dGVzO1xuICAgICAgaWYgKG1hdGNoZXMyWzhdID09PSBcIlpcIikge1xuICAgICAgICB0ek9mZnNldFNpZ24gPSAxO1xuICAgICAgICB0ek9mZnNldEhvdXJzID0gMDtcbiAgICAgICAgdHpPZmZzZXRNaW51dGVzID0gMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHR6T2Zmc2V0U2lnbiA9IG1hdGNoZXMyWzhdLnN1YnN0cmluZygwLCAxKSA9PT0gXCItXCIgPyAtMSA6IDE7XG4gICAgICAgIHR6T2Zmc2V0SG91cnMgPSArbWF0Y2hlczJbOF0uc3Vic3RyaW5nKDEsIDMpO1xuICAgICAgICB0ek9mZnNldE1pbnV0ZXMgPSArbWF0Y2hlczJbOF0uc3Vic3RyaW5nKDQsIDYpO1xuICAgICAgfVxuICAgICAgY29uc3QgdHpPZmZzZXQgPSB0ek9mZnNldFNpZ24gKiAodHpPZmZzZXRIb3VycyAqIDYwICsgdHpPZmZzZXRNaW51dGVzKSAqIDYwO1xuICAgICAgY29uc3QgZGF0ZSA9IC8qICAgICAgICAgICAqLyBuZXcgRGF0ZSgpO1xuICAgICAgZGF0ZS5zZXRVVENGdWxsWWVhcih5ZWFyLCBtb250aCAtIDEsIGRheSk7XG4gICAgICBkYXRlLnNldFVUQ0hvdXJzKGhvdXIsIG1pbnV0ZSwgc2Vjb25kLCBtaWxsaVNlY29uZHMpO1xuICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpIC0gdHpPZmZzZXQgKiAxZTMpO1xuICAgIH1cbiAgICBleHBvcnRzLmZyb21SZmMzMzM5ID0gZnJvbVJmYzMzMzk7XG4gICAgZnVuY3Rpb24gdG9SZmMzMzM5KGRhdGUpIHtcbiAgICAgIGNvbnN0IHllYXIgPSBkYXRlLmdldFVUQ0Z1bGxZZWFyKCk7XG4gICAgICBjb25zdCBtb250aCA9IHBhZGRlZChkYXRlLmdldFVUQ01vbnRoKCkgKyAxKTtcbiAgICAgIGNvbnN0IGRheSA9IHBhZGRlZChkYXRlLmdldFVUQ0RhdGUoKSk7XG4gICAgICBjb25zdCBob3VyID0gcGFkZGVkKGRhdGUuZ2V0VVRDSG91cnMoKSk7XG4gICAgICBjb25zdCBtaW51dGUgPSBwYWRkZWQoZGF0ZS5nZXRVVENNaW51dGVzKCkpO1xuICAgICAgY29uc3Qgc2Vjb25kID0gcGFkZGVkKGRhdGUuZ2V0VVRDU2Vjb25kcygpKTtcbiAgICAgIGNvbnN0IG1zID0gcGFkZGVkKGRhdGUuZ2V0VVRDTWlsbGlzZWNvbmRzKCksIDMpO1xuICAgICAgcmV0dXJuIGAke3llYXJ9LSR7bW9udGh9LSR7ZGF5fVQke2hvdXJ9OiR7bWludXRlfToke3NlY29uZH0uJHttc31aYDtcbiAgICB9XG4gICAgZXhwb3J0cy50b1JmYzMzMzkgPSB0b1JmYzMzMzk7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfdXRmOCA9IF9fY29tbW9uSlMoe1xuICBcIi4uLy4uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL3V0ZjguanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMuZnJvbVV0ZjggPSBleHBvcnRzLnRvVXRmOCA9IHZvaWQgMDtcbiAgICBmdW5jdGlvbiB0b1V0Zjgoc3RyKSB7XG4gICAgICByZXR1cm4gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKHN0cik7XG4gICAgfVxuICAgIGV4cG9ydHMudG9VdGY4ID0gdG9VdGY4O1xuICAgIGZ1bmN0aW9uIGZyb21VdGY4KGRhdGEsIGxvc3N5ID0gZmFsc2UpIHtcbiAgICAgIGNvbnN0IGZhdGFsID0gIWxvc3N5O1xuICAgICAgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcihcInV0Zi04XCIsIHsgZmF0YWwgfSkuZGVjb2RlKGRhdGEpO1xuICAgIH1cbiAgICBleHBvcnRzLmZyb21VdGY4ID0gZnJvbVV0Zjg7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYnVpbGQgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9idWlsZC9pbmRleC5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy50b1V0ZjggPSBleHBvcnRzLmZyb21VdGY4ID0gZXhwb3J0cy50b1JmYzMzMzkgPSBleHBvcnRzLmZyb21SZmMzMzM5ID0gZXhwb3J0cy50b0hleCA9IGV4cG9ydHMuZnJvbUhleCA9IGV4cG9ydHMudG9CZWNoMzIgPSBleHBvcnRzLm5vcm1hbGl6ZUJlY2gzMiA9IGV4cG9ydHMuZnJvbUJlY2gzMiA9IGV4cG9ydHMudG9CYXNlNjQgPSBleHBvcnRzLmZyb21CYXNlNjQgPSBleHBvcnRzLnRvQXNjaWkgPSBleHBvcnRzLmZyb21Bc2NpaSA9IHZvaWQgMDtcbiAgICB2YXIgYXNjaWlfMSA9IHJlcXVpcmVfYXNjaWkoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tQXNjaWlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGFzY2lpXzEuZnJvbUFzY2lpO1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9Bc2NpaVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYXNjaWlfMS50b0FzY2lpO1xuICAgIH0gfSk7XG4gICAgdmFyIGJhc2U2NF8xID0gcmVxdWlyZV9iYXNlNjQoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tQmFzZTY0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBiYXNlNjRfMS5mcm9tQmFzZTY0O1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9CYXNlNjRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGJhc2U2NF8xLnRvQmFzZTY0O1xuICAgIH0gfSk7XG4gICAgdmFyIGJlY2gzMl8xID0gcmVxdWlyZV9iZWNoMzIyKCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiZnJvbUJlY2gzMlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYmVjaDMyXzEuZnJvbUJlY2gzMjtcbiAgICB9IH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIm5vcm1hbGl6ZUJlY2gzMlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYmVjaDMyXzEubm9ybWFsaXplQmVjaDMyO1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9CZWNoMzJcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGJlY2gzMl8xLnRvQmVjaDMyO1xuICAgIH0gfSk7XG4gICAgdmFyIGhleF8xID0gcmVxdWlyZV9oZXgoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tSGV4XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBoZXhfMS5mcm9tSGV4O1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9IZXhcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGhleF8xLnRvSGV4O1xuICAgIH0gfSk7XG4gICAgdmFyIHJmYzMzMzlfMSA9IHJlcXVpcmVfcmZjMzMzOSgpO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcImZyb21SZmMzMzM5XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiByZmMzMzM5XzEuZnJvbVJmYzMzMzk7XG4gICAgfSB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJ0b1JmYzMzMzlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHJmYzMzMzlfMS50b1JmYzMzMzk7XG4gICAgfSB9KTtcbiAgICB2YXIgdXRmOF8xID0gcmVxdWlyZV91dGY4KCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiZnJvbVV0ZjhcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHV0ZjhfMS5mcm9tVXRmODtcbiAgICB9IH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcInRvVXRmOFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdXRmOF8xLnRvVXRmODtcbiAgICB9IH0pO1xuICB9XG59KTtcblxuLy9cbnZhciByZXF1aXJlX2Rpc3QgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvYmVjaDMyL2Rpc3QvaW5kZXguanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMuYmVjaDMybSA9IGV4cG9ydHMuYmVjaDMyID0gdm9pZCAwO1xuICAgIHZhciBBTFBIQUJFVDIgPSBcInFwenJ5OXg4Z2YydHZkdzBzM2puNTRraGNlNm11YTdsXCI7XG4gICAgdmFyIEFMUEhBQkVUX01BUCA9IHt9O1xuICAgIGZvciAobGV0IHogPSAwOyB6IDwgQUxQSEFCRVQyLmxlbmd0aDsgeisrKSB7XG4gICAgICBjb25zdCB4ID0gQUxQSEFCRVQyLmNoYXJBdCh6KTtcbiAgICAgIEFMUEhBQkVUX01BUFt4XSA9IHo7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHBvbHltb2RTdGVwKHByZSkge1xuICAgICAgY29uc3QgYjMgPSBwcmUgPj4gMjU7XG4gICAgICByZXR1cm4gKHByZSAmIDMzNTU0NDMxKSA8PCA1IF4gLShiMyA+PiAwICYgMSkgJiA5OTY4MjUwMTAgXiAtKGIzID4+IDEgJiAxKSAmIDY0MjgxMzU0OSBeIC0oYjMgPj4gMiAmIDEpICYgNTEzODc0NDI2IF4gLShiMyA+PiAzICYgMSkgJiAxMDI3NzQ4ODI5IF4gLShiMyA+PiA0ICYgMSkgJiA3MDU5NzkwNTk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHByZWZpeENoayhwcmVmaXgpIHtcbiAgICAgIGxldCBjaGsgPSAxO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IHByZWZpeC5sZW5ndGg7ICsraTIpIHtcbiAgICAgICAgY29uc3QgYzIgPSBwcmVmaXguY2hhckNvZGVBdChpMik7XG4gICAgICAgIGlmIChjMiA8IDMzIHx8IGMyID4gMTI2KVxuICAgICAgICAgIHJldHVybiBcIkludmFsaWQgcHJlZml4IChcIiArIHByZWZpeCArIFwiKVwiO1xuICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspIF4gYzIgPj4gNTtcbiAgICAgIH1cbiAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoayk7XG4gICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgcHJlZml4Lmxlbmd0aDsgKytpMikge1xuICAgICAgICBjb25zdCB2MyA9IHByZWZpeC5jaGFyQ29kZUF0KGkyKTtcbiAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIHYzICYgMzE7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2hrO1xuICAgIH1cbiAgICBmdW5jdGlvbiBjb252ZXJ0KGRhdGEsIGluQml0cywgb3V0Qml0cywgcGFkKSB7XG4gICAgICBsZXQgdmFsdWUgPSAwO1xuICAgICAgbGV0IGJpdHMgPSAwO1xuICAgICAgY29uc3QgbWF4ViA9ICgxIDw8IG91dEJpdHMpIC0gMTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGRhdGEubGVuZ3RoOyArK2kyKSB7XG4gICAgICAgIHZhbHVlID0gdmFsdWUgPDwgaW5CaXRzIHwgZGF0YVtpMl07XG4gICAgICAgIGJpdHMgKz0gaW5CaXRzO1xuICAgICAgICB3aGlsZSAoYml0cyA+PSBvdXRCaXRzKSB7XG4gICAgICAgICAgYml0cyAtPSBvdXRCaXRzO1xuICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlID4+IGJpdHMgJiBtYXhWKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHBhZCkge1xuICAgICAgICBpZiAoYml0cyA+IDApIHtcbiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSA8PCBvdXRCaXRzIC0gYml0cyAmIG1heFYpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoYml0cyA+PSBpbkJpdHMpXG4gICAgICAgICAgcmV0dXJuIFwiRXhjZXNzIHBhZGRpbmdcIjtcbiAgICAgICAgaWYgKHZhbHVlIDw8IG91dEJpdHMgLSBiaXRzICYgbWF4VilcbiAgICAgICAgICByZXR1cm4gXCJOb24temVybyBwYWRkaW5nXCI7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b1dvcmRzKGJ5dGVzKSB7XG4gICAgICByZXR1cm4gY29udmVydChieXRlcywgOCwgNSwgdHJ1ZSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21Xb3Jkc1Vuc2FmZSh3b3Jkcykge1xuICAgICAgY29uc3QgcmVzID0gY29udmVydCh3b3JkcywgNSwgOCwgZmFsc2UpO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVzKSlcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbVdvcmRzKHdvcmRzKSB7XG4gICAgICBjb25zdCByZXMgPSBjb252ZXJ0KHdvcmRzLCA1LCA4LCBmYWxzZSk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpKVxuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldExpYnJhcnlGcm9tRW5jb2RpbmcoZW5jb2RpbmcpIHtcbiAgICAgIGxldCBFTkNPRElOR19DT05TVDtcbiAgICAgIGlmIChlbmNvZGluZyA9PT0gXCJiZWNoMzJcIikge1xuICAgICAgICBFTkNPRElOR19DT05TVCA9IDE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBFTkNPRElOR19DT05TVCA9IDczNDUzOTkzOTtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIGVuY29kZTIocHJlZml4LCB3b3JkcywgTElNSVQpIHtcbiAgICAgICAgTElNSVQgPSBMSU1JVCB8fCA5MDtcbiAgICAgICAgaWYgKHByZWZpeC5sZW5ndGggKyA3ICsgd29yZHMubGVuZ3RoID4gTElNSVQpXG4gICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkV4Y2VlZHMgbGVuZ3RoIGxpbWl0XCIpO1xuICAgICAgICBwcmVmaXggPSBwcmVmaXgudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgbGV0IGNoayA9IHByZWZpeENoayhwcmVmaXgpO1xuICAgICAgICBpZiAodHlwZW9mIGNoayA9PT0gXCJzdHJpbmdcIilcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoY2hrKTtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHByZWZpeCArIFwiMVwiO1xuICAgICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgd29yZHMubGVuZ3RoOyArK2kyKSB7XG4gICAgICAgICAgY29uc3QgeCA9IHdvcmRzW2kyXTtcbiAgICAgICAgICBpZiAoeCA+PiA1ICE9PSAwKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm9uIDUtYml0IHdvcmRcIik7XG4gICAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIHg7XG4gICAgICAgICAgcmVzdWx0ICs9IEFMUEhBQkVUMi5jaGFyQXQoeCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IDY7ICsraTIpIHtcbiAgICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspO1xuICAgICAgICB9XG4gICAgICAgIGNoayBePSBFTkNPRElOR19DT05TVDtcbiAgICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IDY7ICsraTIpIHtcbiAgICAgICAgICBjb25zdCB2MyA9IGNoayA+PiAoNSAtIGkyKSAqIDUgJiAzMTtcbiAgICAgICAgICByZXN1bHQgKz0gQUxQSEFCRVQyLmNoYXJBdCh2Myk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIF9fZGVjb2RlKHN0ciwgTElNSVQpIHtcbiAgICAgICAgTElNSVQgPSBMSU1JVCB8fCA5MDtcbiAgICAgICAgaWYgKHN0ci5sZW5ndGggPCA4KVxuICAgICAgICAgIHJldHVybiBzdHIgKyBcIiB0b28gc2hvcnRcIjtcbiAgICAgICAgaWYgKHN0ci5sZW5ndGggPiBMSU1JVClcbiAgICAgICAgICByZXR1cm4gXCJFeGNlZWRzIGxlbmd0aCBsaW1pdFwiO1xuICAgICAgICBjb25zdCBsb3dlcmVkID0gc3RyLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IHVwcGVyZWQgPSBzdHIudG9VcHBlckNhc2UoKTtcbiAgICAgICAgaWYgKHN0ciAhPT0gbG93ZXJlZCAmJiBzdHIgIT09IHVwcGVyZWQpXG4gICAgICAgICAgcmV0dXJuIFwiTWl4ZWQtY2FzZSBzdHJpbmcgXCIgKyBzdHI7XG4gICAgICAgIHN0ciA9IGxvd2VyZWQ7XG4gICAgICAgIGNvbnN0IHNwbGl0ID0gc3RyLmxhc3RJbmRleE9mKFwiMVwiKTtcbiAgICAgICAgaWYgKHNwbGl0ID09PSAtMSlcbiAgICAgICAgICByZXR1cm4gXCJObyBzZXBhcmF0b3IgY2hhcmFjdGVyIGZvciBcIiArIHN0cjtcbiAgICAgICAgaWYgKHNwbGl0ID09PSAwKVxuICAgICAgICAgIHJldHVybiBcIk1pc3NpbmcgcHJlZml4IGZvciBcIiArIHN0cjtcbiAgICAgICAgY29uc3QgcHJlZml4ID0gc3RyLnNsaWNlKDAsIHNwbGl0KTtcbiAgICAgICAgY29uc3Qgd29yZENoYXJzID0gc3RyLnNsaWNlKHNwbGl0ICsgMSk7XG4gICAgICAgIGlmICh3b3JkQ2hhcnMubGVuZ3RoIDwgNilcbiAgICAgICAgICByZXR1cm4gXCJEYXRhIHRvbyBzaG9ydFwiO1xuICAgICAgICBsZXQgY2hrID0gcHJlZml4Q2hrKHByZWZpeCk7XG4gICAgICAgIGlmICh0eXBlb2YgY2hrID09PSBcInN0cmluZ1wiKVxuICAgICAgICAgIHJldHVybiBjaGs7XG4gICAgICAgIGNvbnN0IHdvcmRzID0gW107XG4gICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCB3b3JkQ2hhcnMubGVuZ3RoOyArK2kyKSB7XG4gICAgICAgICAgY29uc3QgYzIgPSB3b3JkQ2hhcnMuY2hhckF0KGkyKTtcbiAgICAgICAgICBjb25zdCB2MyA9IEFMUEhBQkVUX01BUFtjMl07XG4gICAgICAgICAgaWYgKHYzID09PSB2b2lkIDApXG4gICAgICAgICAgICByZXR1cm4gXCJVbmtub3duIGNoYXJhY3RlciBcIiArIGMyO1xuICAgICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoaykgXiB2MztcbiAgICAgICAgICBpZiAoaTIgKyA2ID49IHdvcmRDaGFycy5sZW5ndGgpXG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB3b3Jkcy5wdXNoKHYzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hrICE9PSBFTkNPRElOR19DT05TVClcbiAgICAgICAgICByZXR1cm4gXCJJbnZhbGlkIGNoZWNrc3VtIGZvciBcIiArIHN0cjtcbiAgICAgICAgcmV0dXJuIHsgcHJlZml4LCB3b3JkcyB9O1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gZGVjb2RlVW5zYWZlKHN0ciwgTElNSVQpIHtcbiAgICAgICAgY29uc3QgcmVzID0gX19kZWNvZGUoc3RyLCBMSU1JVCk7XG4gICAgICAgIGlmICh0eXBlb2YgcmVzID09PSBcIm9iamVjdFwiKVxuICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBkZWNvZGUzKHN0ciwgTElNSVQpIHtcbiAgICAgICAgY29uc3QgcmVzID0gX19kZWNvZGUoc3RyLCBMSU1JVCk7XG4gICAgICAgIGlmICh0eXBlb2YgcmVzID09PSBcIm9iamVjdFwiKVxuICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihyZXMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGVjb2RlVW5zYWZlLFxuICAgICAgICBkZWNvZGU6IGRlY29kZTMsXG4gICAgICAgIGVuY29kZTogZW5jb2RlMixcbiAgICAgICAgdG9Xb3JkcyxcbiAgICAgICAgZnJvbVdvcmRzVW5zYWZlLFxuICAgICAgICBmcm9tV29yZHNcbiAgICAgIH07XG4gICAgfVxuICAgIGV4cG9ydHMuYmVjaDMyID0gZ2V0TGlicmFyeUZyb21FbmNvZGluZyhcImJlY2gzMlwiKTtcbiAgICBleHBvcnRzLmJlY2gzMm0gPSBnZXRMaWJyYXJ5RnJvbUVuY29kaW5nKFwiYmVjaDMybVwiKTtcbiAgfVxufSk7XG5cbi8vXG52YXIgZ2xvYmFsQXNzZXJ0ID0gZ2xvYmFsVGhpcy5hc3NlcnQ7XG5pZiAoZ2xvYmFsQXNzZXJ0ID09PSB2b2lkIDApIHtcbiAgdGhyb3cgRXJyb3IoXG4gICAgYENhbm5vdCBpbml0aWFsaXplIEBlbmRvL2Vycm9ycywgbWlzc2luZyBnbG9iYWxUaGlzLmFzc2VydCwgaW1wb3J0ICdzZXMnIGJlZm9yZSAnQGVuZG8vZXJyb3JzJ2BcbiAgKTtcbn1cbnZhciBtaXNzaW5nID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBbXG4gICAgXCJ0eXBlb2ZcIixcbiAgICBcImVycm9yXCIsXG4gICAgXCJmYWlsXCIsXG4gICAgXCJlcXVhbFwiLFxuICAgIFwic3RyaW5nXCIsXG4gICAgXCJub3RlXCIsXG4gICAgXCJkZXRhaWxzXCIsXG4gICAgXCJGYWlsXCIsXG4gICAgXCJxdW90ZVwiLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgXCJtYWtlQXNzZXJ0XCJcbiAgXS5maWx0ZXIoKG5hbWUpID0+IGdsb2JhbEFzc2VydFtuYW1lXSA9PT0gdm9pZCAwKVxuKTtcbmlmIChtaXNzaW5nLmxlbmd0aCA+IDApIHtcbiAgdGhyb3cgRXJyb3IoXG4gICAgYENhbm5vdCBpbml0aWFsaXplIEBlbmRvL2Vycm9ycywgbWlzc2luZyBnbG9iYWxUaGlzLmFzc2VydCBtZXRob2RzICR7bWlzc2luZy5qb2luKFxuICAgICAgXCIsIFwiXG4gICAgKX1gXG4gICk7XG59XG52YXIge1xuICBiYXJlLFxuICBkZXRhaWxzOiByZWRhY3RlZCxcbiAgZXJyb3I6IG1ha2VFcnJvcixcbiAgRmFpbDogdGhyb3dSZWRhY3RlZCxcbiAgbWFrZUFzc2VydDogX29taXR0ZWRNYWtlQXNzZXJ0LFxuICBub3RlLFxuICBxdW90ZSxcbiAgLi4uYXNzZXJ0aW9uc1xufSA9IGdsb2JhbEFzc2VydDtcbnZhciBhc3NlcnQyID0gKHZhbHVlLCBvcHREZXRhaWxzLCBlcnJDb250cnVjdG9yLCBvcHRpb25zKSA9PiBnbG9iYWxBc3NlcnQodmFsdWUsIG9wdERldGFpbHMsIGVyckNvbnRydWN0b3IsIG9wdGlvbnMpO1xuT2JqZWN0LmFzc2lnbihhc3NlcnQyLCBhc3NlcnRpb25zKTtcbnZhciBiYXJlT3JRdW90ZSA9IGJhcmUgfHwgcXVvdGU7XG5cbi8vXG52YXIgeyBmcmVlemUgfSA9IE9iamVjdDtcbnZhciB7IGFwcGx5IH0gPSBSZWZsZWN0O1xudmFyIHVuY3VycnlUaGlzID0gKGZuKSA9PiAocmVjZWl2ZXIsIC4uLmFyZ3MpID0+IGFwcGx5KGZuLCByZWNlaXZlciwgYXJncyk7XG52YXIgYXJyYXlQdXNoID0gdW5jdXJyeVRoaXMoQXJyYXkucHJvdG90eXBlLnB1c2gpO1xudmFyIGFycmF5SW5jbHVkZXMgPSB1bmN1cnJ5VGhpcyhBcnJheS5wcm90b3R5cGUuaW5jbHVkZXMpO1xudmFyIHN0cmluZ1NwbGl0ID0gdW5jdXJyeVRoaXMoU3RyaW5nLnByb3RvdHlwZS5zcGxpdCk7XG52YXIgcSA9IEpTT04uc3RyaW5naWZ5O1xudmFyIEZhaWwgPSAobGl0ZXJhbHMsIC4uLmFyZ3MpID0+IHtcbiAgbGV0IG1zZyA9IGxpdGVyYWxzWzBdO1xuICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgYXJncy5sZW5ndGg7IGkyICs9IDEpIHtcbiAgICBtc2cgPSBgJHttc2d9JHthcmdzW2kyXX0ke2xpdGVyYWxzW2kyICsgMV19YDtcbiAgfVxuICB0aHJvdyBFcnJvcihtc2cpO1xufTtcbnZhciBtYWtlRW52aXJvbm1lbnRDYXB0b3IgPSAoYUdsb2JhbCwgZHJvcE5hbWVzID0gZmFsc2UpID0+IHtcbiAgY29uc3QgY2FwdHVyZWRFbnZpcm9ubWVudE9wdGlvbk5hbWVzID0gW107XG4gIGNvbnN0IGdldEVudmlyb25tZW50T3B0aW9uMiA9IChvcHRpb25OYW1lLCBkZWZhdWx0U2V0dGluZywgb3B0T3RoZXJWYWx1ZXMgPSB2b2lkIDApID0+IHtcbiAgICB0eXBlb2Ygb3B0aW9uTmFtZSA9PT0gXCJzdHJpbmdcIiB8fCBGYWlsYEVudmlyb25tZW50IG9wdGlvbiBuYW1lICR7cShvcHRpb25OYW1lKX0gbXVzdCBiZSBhIHN0cmluZy5gO1xuICAgIHR5cGVvZiBkZWZhdWx0U2V0dGluZyA9PT0gXCJzdHJpbmdcIiB8fCBGYWlsYEVudmlyb25tZW50IG9wdGlvbiBkZWZhdWx0IHNldHRpbmcgJHtxKFxuICAgICAgZGVmYXVsdFNldHRpbmdcbiAgICApfSBtdXN0IGJlIGEgc3RyaW5nLmA7XG4gICAgbGV0IHNldHRpbmcgPSBkZWZhdWx0U2V0dGluZztcbiAgICBjb25zdCBnbG9iYWxQcm9jZXNzID0gYUdsb2JhbC5wcm9jZXNzIHx8IHZvaWQgMDtcbiAgICBjb25zdCBnbG9iYWxFbnYgPSB0eXBlb2YgZ2xvYmFsUHJvY2VzcyA9PT0gXCJvYmplY3RcIiAmJiBnbG9iYWxQcm9jZXNzLmVudiB8fCB2b2lkIDA7XG4gICAgaWYgKHR5cGVvZiBnbG9iYWxFbnYgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGlmIChvcHRpb25OYW1lIGluIGdsb2JhbEVudikge1xuICAgICAgICBpZiAoIWRyb3BOYW1lcykge1xuICAgICAgICAgIGFycmF5UHVzaChjYXB0dXJlZEVudmlyb25tZW50T3B0aW9uTmFtZXMsIG9wdGlvbk5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9wdGlvblZhbHVlID0gZ2xvYmFsRW52W29wdGlvbk5hbWVdO1xuICAgICAgICB0eXBlb2Ygb3B0aW9uVmFsdWUgPT09IFwic3RyaW5nXCIgfHwgRmFpbGBFbnZpcm9ubWVudCBvcHRpb24gbmFtZWQgJHtxKFxuICAgICAgICAgIG9wdGlvbk5hbWVcbiAgICAgICAgKX0sIGlmIHByZXNlbnQsIG11c3QgaGF2ZSBhIGNvcnJlc3BvbmRpbmcgc3RyaW5nIHZhbHVlLCBnb3QgJHtxKFxuICAgICAgICAgIG9wdGlvblZhbHVlXG4gICAgICAgICl9YDtcbiAgICAgICAgc2V0dGluZyA9IG9wdGlvblZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICBvcHRPdGhlclZhbHVlcyA9PT0gdm9pZCAwIHx8IHNldHRpbmcgPT09IGRlZmF1bHRTZXR0aW5nIHx8IGFycmF5SW5jbHVkZXMob3B0T3RoZXJWYWx1ZXMsIHNldHRpbmcpIHx8IEZhaWxgVW5yZWNvZ25pemVkICR7cShvcHRpb25OYW1lKX0gdmFsdWUgJHtxKFxuICAgICAgc2V0dGluZ1xuICAgICl9LiBFeHBlY3RlZCBvbmUgb2YgJHtxKFtkZWZhdWx0U2V0dGluZywgLi4ub3B0T3RoZXJWYWx1ZXNdKX1gO1xuICAgIHJldHVybiBzZXR0aW5nO1xuICB9O1xuICBmcmVlemUoZ2V0RW52aXJvbm1lbnRPcHRpb24yKTtcbiAgY29uc3QgZ2V0RW52aXJvbm1lbnRPcHRpb25zTGlzdDIgPSAob3B0aW9uTmFtZSkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGdldEVudmlyb25tZW50T3B0aW9uMihvcHRpb25OYW1lLCBcIlwiKTtcbiAgICByZXR1cm4gZnJlZXplKG9wdGlvbiA9PT0gXCJcIiA/IFtdIDogc3RyaW5nU3BsaXQob3B0aW9uLCBcIixcIikpO1xuICB9O1xuICBmcmVlemUoZ2V0RW52aXJvbm1lbnRPcHRpb25zTGlzdDIpO1xuICBjb25zdCBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzMiA9IChvcHRpb25OYW1lLCBlbGVtZW50KSA9PiBhcnJheUluY2x1ZGVzKGdldEVudmlyb25tZW50T3B0aW9uc0xpc3QyKG9wdGlvbk5hbWUpLCBlbGVtZW50KTtcbiAgY29uc3QgZ2V0Q2FwdHVyZWRFbnZpcm9ubWVudE9wdGlvbk5hbWVzID0gKCkgPT4ge1xuICAgIHJldHVybiBmcmVlemUoWy4uLmNhcHR1cmVkRW52aXJvbm1lbnRPcHRpb25OYW1lc10pO1xuICB9O1xuICBmcmVlemUoZ2V0Q2FwdHVyZWRFbnZpcm9ubWVudE9wdGlvbk5hbWVzKTtcbiAgcmV0dXJuIGZyZWV6ZSh7XG4gICAgZ2V0RW52aXJvbm1lbnRPcHRpb246IGdldEVudmlyb25tZW50T3B0aW9uMixcbiAgICBnZXRFbnZpcm9ubWVudE9wdGlvbnNMaXN0OiBnZXRFbnZpcm9ubWVudE9wdGlvbnNMaXN0MixcbiAgICBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzOiBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzMixcbiAgICBnZXRDYXB0dXJlZEVudmlyb25tZW50T3B0aW9uTmFtZXNcbiAgfSk7XG59O1xuZnJlZXplKG1ha2VFbnZpcm9ubWVudENhcHRvcik7XG52YXIge1xuICBnZXRFbnZpcm9ubWVudE9wdGlvbixcbiAgZ2V0RW52aXJvbm1lbnRPcHRpb25zTGlzdCxcbiAgZW52aXJvbm1lbnRPcHRpb25zTGlzdEhhc1xufSA9IG1ha2VFbnZpcm9ubWVudENhcHRvcihnbG9iYWxUaGlzLCB0cnVlKTtcblxuLy9cbnZhciB7IHF1b3RlOiBxMiwgRmFpbDogRmFpbDIgfSA9IGFzc2VydDtcbnZhciB7IGhhc093biwgZnJlZXplOiBmcmVlemUyLCBlbnRyaWVzIH0gPSBPYmplY3Q7XG52YXIgaXNKU09OUmVjb3JkID0gKHZhbCkgPT4gdHlwZW9mIHZhbCA9PT0gXCJvYmplY3RcIiAmJiB2YWwgIT09IG51bGwgJiYgIUFycmF5LmlzQXJyYXkodmFsKTtcbnZhciBzaW1wbGlmeVRhZyA9ICh0YWcpID0+IHtcbiAgZm9yIChjb25zdCBwcmVmaXggb2YgW1wiQWxsZWdlZDogXCIsIFwiRGVidWdOYW1lOiBcIl0pIHtcbiAgICBpZiAodGFnLnN0YXJ0c1dpdGgocHJlZml4KSkge1xuICAgICAgcmV0dXJuIHRhZy5zbGljZShwcmVmaXgubGVuZ3RoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRhZztcbn07XG52YXIgbWFrZU1lc3NhZ2VCcmVha3BvaW50VGVzdGVyID0gKG9wdGlvbk5hbWUpID0+IHtcbiAgbGV0IGJyZWFrcG9pbnRzID0gSlNPTi5wYXJzZShnZXRFbnZpcm9ubWVudE9wdGlvbihvcHRpb25OYW1lLCBcIm51bGxcIikpO1xuICBpZiAoYnJlYWtwb2ludHMgPT09IG51bGwpIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIGxldCBicmVha3BvaW50c1RhYmxlO1xuICBjb25zdCBnZXRCcmVha3BvaW50cyA9ICgpID0+IGJyZWFrcG9pbnRzO1xuICBmcmVlemUyKGdldEJyZWFrcG9pbnRzKTtcbiAgY29uc3Qgc2V0QnJlYWtwb2ludHMgPSAobmV3QnJlYWtwb2ludHMgPSBicmVha3BvaW50cykgPT4ge1xuICAgIGlzSlNPTlJlY29yZChuZXdCcmVha3BvaW50cykgfHwgRmFpbDJgRXhwZWN0ZWQgJHtxMihvcHRpb25OYW1lKX0gb3B0aW9uIHRvIGJlIGEgSlNPTiBicmVha3BvaW50cyByZWNvcmRgO1xuICAgIGNvbnN0IG5ld0JyZWFrcG9pbnRzVGFibGUgPSB7IF9fcHJvdG9fXzogbnVsbCB9O1xuICAgIGZvciAoY29uc3QgW3RhZywgbWV0aG9kQlBzXSBvZiBlbnRyaWVzKG5ld0JyZWFrcG9pbnRzKSkge1xuICAgICAgdGFnID09PSBzaW1wbGlmeVRhZyh0YWcpIHx8IEZhaWwyYEp1c3QgdXNlIHNpbXBsZSB0YWcgJHtxMihzaW1wbGlmeVRhZyh0YWcpKX0gcmF0aGVyIHRoYW4gJHtxMih0YWcpfWA7XG4gICAgICBpc0pTT05SZWNvcmQobWV0aG9kQlBzKSB8fCBGYWlsMmBFeHBlY3RlZCAke3EyKG9wdGlvbk5hbWUpfSBvcHRpb24ncyAke3EyKFxuICAgICAgICB0YWdcbiAgICAgICl9IHRvIGJlIGEgSlNPTiBtZXRob2RzIGJyZWFrcG9pbnRzIHJlY29yZGA7XG4gICAgICBmb3IgKGNvbnN0IFttZXRob2ROYW1lLCBjb3VudF0gb2YgZW50cmllcyhtZXRob2RCUHMpKSB7XG4gICAgICAgIGNvdW50ID09PSBcIipcIiB8fCB0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIgJiYgTnVtYmVyLmlzU2FmZUludGVnZXIoY291bnQpICYmIGNvdW50ID49IDAgfHwgRmFpbDJgRXhwZWN0ZWQgJHtxMihvcHRpb25OYW1lKX0gb3B0aW9uJ3MgJHtxMih0YWcpfS4ke3EyKFxuICAgICAgICAgIG1ldGhvZE5hbWVcbiAgICAgICAgKX0gdG8gYmUgXCIqXCIgb3IgYSBub24tbmVnYXRpdmUgaW50ZWdlcmA7XG4gICAgICAgIGNvbnN0IGNsYXNzQlBzID0gaGFzT3duKG5ld0JyZWFrcG9pbnRzVGFibGUsIG1ldGhvZE5hbWUpID8gbmV3QnJlYWtwb2ludHNUYWJsZVttZXRob2ROYW1lXSA6IG5ld0JyZWFrcG9pbnRzVGFibGVbbWV0aG9kTmFtZV0gPSB7XG4gICAgICAgICAgLy9cbiAgICAgICAgICBfX3Byb3RvX186IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgY2xhc3NCUHNbdGFnXSA9IGNvdW50O1xuICAgICAgfVxuICAgIH1cbiAgICBicmVha3BvaW50cyA9IG5ld0JyZWFrcG9pbnRzO1xuICAgIGJyZWFrcG9pbnRzVGFibGUgPSBuZXdCcmVha3BvaW50c1RhYmxlO1xuICB9O1xuICBmcmVlemUyKHNldEJyZWFrcG9pbnRzKTtcbiAgY29uc3Qgc2hvdWxkQnJlYWtwb2ludCA9IChyZWNpcGllbnQsIG1ldGhvZE5hbWUpID0+IHtcbiAgICBpZiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwIHx8IG1ldGhvZE5hbWUgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgY2xhc3NCUHMgPSBicmVha3BvaW50c1RhYmxlW21ldGhvZE5hbWVdIHx8IGJyZWFrcG9pbnRzVGFibGVbXCIqXCJdO1xuICAgIGlmIChjbGFzc0JQcyA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGxldCB0YWcgPSBzaW1wbGlmeVRhZyhyZWNpcGllbnRbU3ltYm9sLnRvU3RyaW5nVGFnXSk7XG4gICAgbGV0IGNvdW50ID0gY2xhc3NCUHNbdGFnXTtcbiAgICBpZiAoY291bnQgPT09IHZvaWQgMCkge1xuICAgICAgdGFnID0gXCIqXCI7XG4gICAgICBjb3VudCA9IGNsYXNzQlBzW3RhZ107XG4gICAgICBpZiAoY291bnQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChjb3VudCA9PT0gXCIqXCIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoY291bnQgPT09IDApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBhc3NlcnQodHlwZW9mIGNvdW50ID09PSBcIm51bWJlclwiICYmIGNvdW50ID49IDEpO1xuICAgIGNsYXNzQlBzW3RhZ10gPSBjb3VudCAtIDE7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICBmcmVlemUyKHNob3VsZEJyZWFrcG9pbnQpO1xuICBjb25zdCBicmVha3BvaW50VGVzdGVyID0gZnJlZXplMih7XG4gICAgZ2V0QnJlYWtwb2ludHMsXG4gICAgc2V0QnJlYWtwb2ludHMsXG4gICAgc2hvdWxkQnJlYWtwb2ludFxuICB9KTtcbiAgYnJlYWtwb2ludFRlc3Rlci5zZXRCcmVha3BvaW50cygpO1xuICByZXR1cm4gYnJlYWtwb2ludFRlc3Rlcjtcbn07XG5mcmVlemUyKG1ha2VNZXNzYWdlQnJlYWtwb2ludFRlc3Rlcik7XG5cbi8vXG52YXIgeyBkZXRhaWxzOiBYLCBxdW90ZTogcTMsIEZhaWw6IEZhaWwzIH0gPSBhc3NlcnQ7XG52YXIgeyBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzLCBnZXRQcm90b3R5cGVPZiwgZnJlZXplOiBmcmVlemUzIH0gPSBPYmplY3Q7XG52YXIgeyBhcHBseTogYXBwbHkyLCBvd25LZXlzIH0gPSBSZWZsZWN0O1xudmFyIG9uRGVsaXZlcnkgPSBtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIoXCJFTkRPX0RFTElWRVJZX0JSRUFLUE9JTlRTXCIpO1xudmFyIGlzT2JqZWN0ID0gKHZhbCkgPT4gT2JqZWN0KHZhbCkgPT09IHZhbDtcbnZhciBjb21wYXJlU3RyaW5naWZpZWQgPSAoYTIsIGIzKSA9PiB7XG4gIGlmICh0eXBlb2YgYTIgPT09IHR5cGVvZiBiMykge1xuICAgIGNvbnN0IGxlZnQgPSBTdHJpbmcoYTIpO1xuICAgIGNvbnN0IHJpZ2h0ID0gU3RyaW5nKGIzKTtcbiAgICByZXR1cm4gbGVmdCA8IHJpZ2h0ID8gLTEgOiBsZWZ0ID4gcmlnaHQgPyAxIDogMDtcbiAgfVxuICBpZiAodHlwZW9mIGEyID09PSBcInN5bWJvbFwiKSB7XG4gICAgYXNzZXJ0KHR5cGVvZiBiMyA9PT0gXCJzdHJpbmdcIik7XG4gICAgcmV0dXJuIC0xO1xuICB9XG4gIGFzc2VydCh0eXBlb2YgYTIgPT09IFwic3RyaW5nXCIpO1xuICBhc3NlcnQodHlwZW9mIGIzID09PSBcInN5bWJvbFwiKTtcbiAgcmV0dXJuIDE7XG59O1xudmFyIGdldE1ldGhvZE5hbWVzID0gKHZhbCkgPT4ge1xuICBsZXQgbGF5ZXIgPSB2YWw7XG4gIGNvbnN0IG5hbWVzID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgd2hpbGUgKGxheWVyICE9PSBudWxsICYmIGxheWVyICE9PSBPYmplY3QucHJvdG90eXBlKSB7XG4gICAgY29uc3QgZGVzY3MgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKGxheWVyKTtcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2Ygb3duS2V5cyhkZXNjcykpIHtcbiAgICAgIGlmICh0eXBlb2YgdmFsW25hbWVdID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgbmFtZXMuYWRkKG5hbWUpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWlzT2JqZWN0KHZhbCkpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBsYXllciA9IGdldFByb3RvdHlwZU9mKGxheWVyKTtcbiAgfVxuICByZXR1cm4gaGFyZGVuKFsuLi5uYW1lc10uc29ydChjb21wYXJlU3RyaW5naWZpZWQpKTtcbn07XG5mcmVlemUzKGdldE1ldGhvZE5hbWVzKTtcblxuLy9cbnZhciB7IGlzQXJyYXkgfSA9IEFycmF5O1xudmFyIHsgcHJvdG90eXBlOiBmdW5jdGlvblByb3RvdHlwZSB9ID0gRnVuY3Rpb247XG52YXIge1xuICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsXG4gIGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjIsXG4gIGhhc093blByb3BlcnR5OiBvYmplY3RIYXNPd25Qcm9wZXJ0eSxcbiAgaXNGcm96ZW4sXG4gIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlXG59ID0gT2JqZWN0O1xudmFyIHsgYXBwbHk6IGFwcGx5MyB9ID0gUmVmbGVjdDtcbnZhciB7IHRvU3RyaW5nVGFnOiB0b1N0cmluZ1RhZ1N5bWJvbCB9ID0gU3ltYm9sO1xudmFyIHR5cGVkQXJyYXlQcm90b3R5cGUgPSBnZXRQcm90b3R5cGVPZjIoVWludDhBcnJheS5wcm90b3R5cGUpO1xudmFyIHR5cGVkQXJyYXlUb1N0cmluZ1RhZ0Rlc2MgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoXG4gIHR5cGVkQXJyYXlQcm90b3R5cGUsXG4gIHRvU3RyaW5nVGFnU3ltYm9sXG4pO1xuYXNzZXJ0KHR5cGVkQXJyYXlUb1N0cmluZ1RhZ0Rlc2MpO1xudmFyIGdldFR5cGVkQXJyYXlUb1N0cmluZ1RhZyA9IHR5cGVkQXJyYXlUb1N0cmluZ1RhZ0Rlc2MuZ2V0O1xuYXNzZXJ0KHR5cGVvZiBnZXRUeXBlZEFycmF5VG9TdHJpbmdUYWcgPT09IFwiZnVuY3Rpb25cIik7XG52YXIgaGFzT3duUHJvcGVydHlPZiA9IChvYmosIHByb3ApID0+IGFwcGx5MyhvYmplY3RIYXNPd25Qcm9wZXJ0eSwgb2JqLCBbcHJvcF0pO1xuaGFyZGVuKGhhc093blByb3BlcnR5T2YpO1xudmFyIGlzT2JqZWN0MiA9ICh2YWwpID0+IE9iamVjdCh2YWwpID09PSB2YWw7XG5oYXJkZW4oaXNPYmplY3QyKTtcbnZhciBpc1R5cGVkQXJyYXkgPSAob2JqZWN0KSA9PiB7XG4gIGNvbnN0IHRhZyA9IGFwcGx5MyhnZXRUeXBlZEFycmF5VG9TdHJpbmdUYWcsIG9iamVjdCwgW10pO1xuICByZXR1cm4gdGFnICE9PSB2b2lkIDA7XG59O1xuaGFyZGVuKGlzVHlwZWRBcnJheSk7XG52YXIgUEFTU19TVFlMRSA9IFN5bWJvbC5mb3IoXCJwYXNzU3R5bGVcIik7XG52YXIgY2FuQmVNZXRob2QgPSAoZnVuYykgPT4gdHlwZW9mIGZ1bmMgPT09IFwiZnVuY3Rpb25cIiAmJiAhKFBBU1NfU1RZTEUgaW4gZnVuYyk7XG5oYXJkZW4oY2FuQmVNZXRob2QpO1xudmFyIGFzc2VydENoZWNrZXIgPSAoY29uZCwgZGV0YWlscykgPT4ge1xuICBhc3NlcnQoY29uZCwgZGV0YWlscyk7XG4gIHJldHVybiB0cnVlO1xufTtcbmhhcmRlbihhc3NlcnRDaGVja2VyKTtcbnZhciBDWCA9IChjaGVjaykgPT4ge1xuICBjb25zdCByZWplY3QgPSAoVCwgLi4uc3VicykgPT4gY2hlY2soZmFsc2UsIHJlZGFjdGVkKFQsIC4uLnN1YnMpKTtcbiAgcmV0dXJuIHJlamVjdDtcbn07XG5oYXJkZW4oQ1gpO1xudmFyIGdldE93bkRhdGFEZXNjcmlwdG9yID0gKGNhbmRpZGF0ZSwgcHJvcE5hbWUsIHNob3VsZEJlRW51bWVyYWJsZSwgY2hlY2spID0+IHtcbiAgY29uc3QgZGVzYyA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoY2FuZGlkYXRlLCBwcm9wTmFtZSlcbiAgKTtcbiAgcmV0dXJuIChkZXNjICE9PSB2b2lkIDAgfHwgISFjaGVjayAmJiBDWChjaGVjaylgJHtxdW90ZShwcm9wTmFtZSl9IHByb3BlcnR5IGV4cGVjdGVkOiAke2NhbmRpZGF0ZX1gKSAmJiAoaGFzT3duUHJvcGVydHlPZihkZXNjLCBcInZhbHVlXCIpIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgY2hlY2tcbiAgKWAke3F1b3RlKHByb3BOYW1lKX0gbXVzdCBub3QgYmUgYW4gYWNjZXNzb3IgcHJvcGVydHk6ICR7Y2FuZGlkYXRlfWApICYmIChzaG91bGRCZUVudW1lcmFibGUgPyBkZXNjLmVudW1lcmFibGUgfHwgISFjaGVjayAmJiBDWChcbiAgICBjaGVja1xuICApYCR7cXVvdGUocHJvcE5hbWUpfSBtdXN0IGJlIGFuIGVudW1lcmFibGUgcHJvcGVydHk6ICR7Y2FuZGlkYXRlfWAgOiAhZGVzYy5lbnVtZXJhYmxlIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgY2hlY2tcbiAgKWAke3F1b3RlKHByb3BOYW1lKX0gbXVzdCBub3QgYmUgYW4gZW51bWVyYWJsZSBwcm9wZXJ0eTogJHtjYW5kaWRhdGV9YCkgPyBkZXNjIDogKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICB2b2lkIDBcbiAgKTtcbn07XG5oYXJkZW4oZ2V0T3duRGF0YURlc2NyaXB0b3IpO1xudmFyIGdldFRhZyA9ICh0YWdSZWNvcmQpID0+IHRhZ1JlY29yZFtTeW1ib2wudG9TdHJpbmdUYWddO1xuaGFyZGVuKGdldFRhZyk7XG52YXIgY2hlY2tQYXNzU3R5bGUgPSAob2JqLCBwYXNzU3R5bGUsIGV4cGVjdGVkUGFzc1N0eWxlLCBjaGVjaykgPT4ge1xuICByZXR1cm4gcGFzc1N0eWxlID09PSBleHBlY3RlZFBhc3NTdHlsZSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBFeHBlY3RlZCAke3F1b3RlKGV4cGVjdGVkUGFzc1N0eWxlKX0sIG5vdCAke3F1b3RlKHBhc3NTdHlsZSl9OiAke29ian1gO1xufTtcbmhhcmRlbihjaGVja1Bhc3NTdHlsZSk7XG52YXIgbWFrZUNoZWNrVGFnUmVjb3JkID0gKGNoZWNrUHJvdG8pID0+IHtcbiAgY29uc3QgY2hlY2tUYWdSZWNvcmQyID0gKHRhZ1JlY29yZCwgZXhwZWN0ZWRQYXNzU3R5bGUsIGNoZWNrKSA9PiB7XG4gICAgcmV0dXJuIChpc09iamVjdDIodGFnUmVjb3JkKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBBIG5vbi1vYmplY3QgY2Fubm90IGJlIGEgdGFnUmVjb3JkOiAke3RhZ1JlY29yZH1gKSAmJiAoaXNGcm96ZW4odGFnUmVjb3JkKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBBIHRhZ1JlY29yZCBtdXN0IGJlIGZyb3plbjogJHt0YWdSZWNvcmR9YCkgJiYgKCFpc0FycmF5KHRhZ1JlY29yZCkgfHwgISFjaGVjayAmJiBDWChjaGVjaylgQW4gYXJyYXkgY2Fubm90IGJlIGEgdGFnUmVjb3JkOiAke3RhZ1JlY29yZH1gKSAmJiBjaGVja1Bhc3NTdHlsZShcbiAgICAgIHRhZ1JlY29yZCxcbiAgICAgIGdldE93bkRhdGFEZXNjcmlwdG9yKHRhZ1JlY29yZCwgUEFTU19TVFlMRSwgZmFsc2UsIGNoZWNrKS52YWx1ZSxcbiAgICAgIGV4cGVjdGVkUGFzc1N0eWxlLFxuICAgICAgY2hlY2tcbiAgICApICYmICh0eXBlb2YgZ2V0T3duRGF0YURlc2NyaXB0b3IodGFnUmVjb3JkLCBTeW1ib2wudG9TdHJpbmdUYWcsIGZhbHNlLCBjaGVjaykudmFsdWUgPT09IFwic3RyaW5nXCIgfHwgISFjaGVjayAmJiBDWChcbiAgICAgIGNoZWNrXG4gICAgKWBBIFtTeW1ib2wudG9TdHJpbmdUYWddLW5hbWVkIHByb3BlcnR5IG11c3QgYmUgYSBzdHJpbmc6ICR7dGFnUmVjb3JkfWApICYmIGNoZWNrUHJvdG8odGFnUmVjb3JkLCBnZXRQcm90b3R5cGVPZjIodGFnUmVjb3JkKSwgY2hlY2spO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKGNoZWNrVGFnUmVjb3JkMik7XG59O1xudmFyIGNoZWNrVGFnUmVjb3JkID0gbWFrZUNoZWNrVGFnUmVjb3JkKFxuICAodmFsLCBwcm90bywgY2hlY2spID0+IHByb3RvID09PSBvYmplY3RQcm90b3R5cGUgfHwgISFjaGVjayAmJiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSB0YWdSZWNvcmQgbXVzdCBpbmhlcml0IGZyb20gT2JqZWN0LnByb3RvdHlwZTogJHt2YWx9YClcbik7XG5oYXJkZW4oY2hlY2tUYWdSZWNvcmQpO1xudmFyIGNoZWNrRnVuY3Rpb25UYWdSZWNvcmQgPSBtYWtlQ2hlY2tUYWdSZWNvcmQoXG4gICh2YWwsIHByb3RvLCBjaGVjaykgPT4gcHJvdG8gPT09IGZ1bmN0aW9uUHJvdG90eXBlIHx8IHByb3RvICE9PSBudWxsICYmIGdldFByb3RvdHlwZU9mMihwcm90bykgPT09IGZ1bmN0aW9uUHJvdG90eXBlIHx8ICEhY2hlY2sgJiYgY2hlY2soXG4gICAgZmFsc2UsXG4gICAgcmVkYWN0ZWRgRm9yIGZ1bmN0aW9ucywgYSB0YWdSZWNvcmQgbXVzdCBpbmhlcml0IGZyb20gRnVuY3Rpb24ucHJvdG90eXBlOiAke3ZhbH1gXG4gIClcbik7XG5oYXJkZW4oY2hlY2tGdW5jdGlvblRhZ1JlY29yZCk7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzMiB9ID0gUmVmbGVjdDtcbnZhciB7IGlzQXJyYXk6IGlzQXJyYXkyIH0gPSBBcnJheTtcbnZhciB7XG4gIGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjMsXG4gIGlzRnJvemVuOiBpc0Zyb3plbjIsXG4gIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlMixcbiAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczJcbn0gPSBPYmplY3Q7XG52YXIgY2hlY2tJZmFjZSA9IChpZmFjZSwgY2hlY2spID0+IHtcbiAgcmV0dXJuIChcbiAgICAvL1xuICAgICh0eXBlb2YgaWZhY2UgPT09IFwic3RyaW5nXCIgfHwgISFjaGVjayAmJiBDWChcbiAgICAgIGNoZWNrXG4gICAgKWBGb3Igbm93LCBpbnRlcmZhY2UgJHtpZmFjZX0gbXVzdCBiZSBhIHN0cmluZzsgdW5pbXBsZW1lbnRlZGApICYmIChpZmFjZSA9PT0gXCJSZW1vdGFibGVcIiB8fCBpZmFjZS5zdGFydHNXaXRoKFwiQWxsZWdlZDogXCIpIHx8IGlmYWNlLnN0YXJ0c1dpdGgoXCJEZWJ1Z05hbWU6IFwiKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBGb3Igbm93LCBpZmFjZSAke3F1b3RlKFxuICAgICAgaWZhY2VcbiAgICApfSBtdXN0IGJlIFwiUmVtb3RhYmxlXCIgb3IgYmVnaW4gd2l0aCBcIkFsbGVnZWQ6IFwiIG9yIFwiRGVidWdOYW1lOiBcIjsgdW5pbXBsZW1lbnRlZGApXG4gICk7XG59O1xudmFyIGFzc2VydElmYWNlID0gKGlmYWNlKSA9PiBjaGVja0lmYWNlKGlmYWNlLCBhc3NlcnRDaGVja2VyKTtcbmhhcmRlbihhc3NlcnRJZmFjZSk7XG52YXIgY2hlY2tSZW1vdGFibGVQcm90b09mID0gKG9yaWdpbmFsLCBjaGVjaykgPT4ge1xuICBpc09iamVjdDIob3JpZ2luYWwpIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlcyBtdXN0IGJlIG9iamVjdHMgb3IgZnVuY3Rpb25zOiAke29yaWdpbmFsfWA7XG4gIGNvbnN0IHByb3RvID0gZ2V0UHJvdG90eXBlT2YzKG9yaWdpbmFsKTtcbiAgaWYgKHByb3RvID09PSBvYmplY3RQcm90b3R5cGUyIHx8IHByb3RvID09PSBudWxsIHx8IHByb3RvID09PSBGdW5jdGlvbi5wcm90b3R5cGUpIHtcbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgUmVtb3RhYmxlcyBtdXN0IGJlIGV4cGxpY2l0bHkgZGVjbGFyZWQ6ICR7cXVvdGUob3JpZ2luYWwpfWA7XG4gIH1cbiAgaWYgKHR5cGVvZiBvcmlnaW5hbCA9PT0gXCJvYmplY3RcIikge1xuICAgIGNvbnN0IHByb3RvUHJvdG8gPSBnZXRQcm90b3R5cGVPZjMocHJvdG8pO1xuICAgIGlmIChwcm90b1Byb3RvICE9PSBvYmplY3RQcm90b3R5cGUyICYmIHByb3RvUHJvdG8gIT09IG51bGwpIHtcbiAgICAgIHJldHVybiBjaGVja1JlbW90YWJsZShwcm90bywgY2hlY2spO1xuICAgIH1cbiAgICBpZiAoIWNoZWNrVGFnUmVjb3JkKHByb3RvLCBcInJlbW90YWJsZVwiLCBjaGVjaykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0gZWxzZSBpZiAodHlwZW9mIG9yaWdpbmFsID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBpZiAoIWNoZWNrRnVuY3Rpb25UYWdSZWNvcmQocHJvdG8sIFwicmVtb3RhYmxlXCIsIGNoZWNrKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICBjb25zdCBwYXNzU3R5bGVLZXkgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgIFBBU1NfU1RZTEVcbiAgKTtcbiAgY29uc3QgdGFnS2V5ID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBTeW1ib2wudG9TdHJpbmdUYWdcbiAgKTtcbiAgY29uc3Qge1xuICAgIC8vXG4gICAgW1xuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICBwYXNzU3R5bGVLZXlcbiAgICBdOiBfcGFzc1N0eWxlRGVzYyxcbiAgICBbXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHRhZ0tleVxuICAgIF06IHsgdmFsdWU6IGlmYWNlIH0sXG4gICAgLi4ucmVzdERlc2NzXG4gIH0gPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzMihwcm90byk7XG4gIHJldHVybiAob3duS2V5czIocmVzdERlc2NzKS5sZW5ndGggPT09IDAgfHwgISFjaGVjayAmJiBDWChcbiAgICBjaGVja1xuICApYFVuZXhwZWN0ZWQgcHJvcGVydGllcyBvbiBSZW1vdGFibGUgUHJvdG8gJHtvd25LZXlzMihyZXN0RGVzY3MpfWApICYmIGNoZWNrSWZhY2UoaWZhY2UsIGNoZWNrKTtcbn07XG52YXIgY29uZmlybWVkUmVtb3RhYmxlcyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrUmVtb3RhYmxlID0gKHZhbCwgY2hlY2spID0+IHtcbiAgaWYgKGNvbmZpcm1lZFJlbW90YWJsZXMuaGFzKHZhbCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoIWlzRnJvemVuMih2YWwpKSB7XG4gICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goY2hlY2spYGNhbm5vdCBzZXJpYWxpemUgbm9uLWZyb3plbiBvYmplY3RzIGxpa2UgJHt2YWx9YDtcbiAgfVxuICBpZiAoIVJlbW90YWJsZUhlbHBlci5jYW5CZVZhbGlkKHZhbCwgY2hlY2spKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IHJlc3VsdCA9IGNoZWNrUmVtb3RhYmxlUHJvdG9PZih2YWwsIGNoZWNrKTtcbiAgaWYgKHJlc3VsdCkge1xuICAgIGNvbmZpcm1lZFJlbW90YWJsZXMuYWRkKHZhbCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgZ2V0SW50ZXJmYWNlT2YgPSAodmFsKSA9PiB7XG4gIGlmICghaXNPYmplY3QyKHZhbCkgfHwgdmFsW1BBU1NfU1RZTEVdICE9PSBcInJlbW90YWJsZVwiIHx8ICFjaGVja1JlbW90YWJsZSh2YWwpKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICByZXR1cm4gZ2V0VGFnKHZhbCk7XG59O1xuaGFyZGVuKGdldEludGVyZmFjZU9mKTtcbnZhciBSZW1vdGFibGVIZWxwZXIgPSBoYXJkZW4oe1xuICBzdHlsZU5hbWU6IFwicmVtb3RhYmxlXCIsXG4gIGNhbkJlVmFsaWQ6IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiB7XG4gICAgY29uc3QgdmFsaWRUeXBlID0gKGlzT2JqZWN0MihjYW5kaWRhdGUpIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYGNhbm5vdCBzZXJpYWxpemUgbm9uLW9iamVjdHMgYXMgUmVtb3RhYmxlICR7Y2FuZGlkYXRlfWApICYmICghaXNBcnJheTIoY2FuZGlkYXRlKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBjYW5ub3Qgc2VyaWFsaXplIGFycmF5cyBhcyBSZW1vdGFibGUgJHtjYW5kaWRhdGV9YCk7XG4gICAgaWYgKCF2YWxpZFR5cGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgZGVzY3MgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzMihjYW5kaWRhdGUpO1xuICAgIGlmICh0eXBlb2YgY2FuZGlkYXRlID09PSBcIm9iamVjdFwiKSB7XG4gICAgICByZXR1cm4gb3duS2V5czIoZGVzY3MpLmV2ZXJ5KChrZXkpID0+IHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAvL1xuICAgICAgICAgIChoYXNPd25Qcm9wZXJ0eU9mKGRlc2NzW1xuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICBrZXlcbiAgICAgICAgICBdLCBcInZhbHVlXCIpIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYGNhbm5vdCBzZXJpYWxpemUgUmVtb3RhYmxlcyB3aXRoIGFjY2Vzc29ycyBsaWtlICR7cXVvdGUoXG4gICAgICAgICAgICBTdHJpbmcoa2V5KVxuICAgICAgICAgICl9IGluICR7Y2FuZGlkYXRlfWApICYmIChrZXkgPT09IFN5bWJvbC50b1N0cmluZ1RhZyAmJiBjaGVja0lmYWNlKGNhbmRpZGF0ZVtrZXldLCBjaGVjaykgfHwgKGNhbkJlTWV0aG9kKGNhbmRpZGF0ZVtrZXldKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBjYW5ub3Qgc2VyaWFsaXplIFJlbW90YWJsZXMgd2l0aCBub24tbWV0aG9kcyBsaWtlICR7cXVvdGUoXG4gICAgICAgICAgICBTdHJpbmcoa2V5KVxuICAgICAgICAgICl9IGluICR7Y2FuZGlkYXRlfWApICYmIChrZXkgIT09IFBBU1NfU1RZTEUgfHwgISFjaGVjayAmJiBDWChjaGVjaylgQSBwYXNzLWJ5LXJlbW90ZSBjYW5ub3Qgc2hhZG93ICR7cXVvdGUoUEFTU19TVFlMRSl9YCkpXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjYW5kaWRhdGUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgY29uc3Qge1xuICAgICAgICBuYW1lOiBuYW1lRGVzYyxcbiAgICAgICAgbGVuZ3RoOiBsZW5ndGhEZXNjLFxuICAgICAgICAvL1xuICAgICAgICBbU3ltYm9sLnRvU3RyaW5nVGFnXTogdG9TdHJpbmdUYWdEZXNjLFxuICAgICAgICAuLi5yZXN0RGVzY3NcbiAgICAgIH0gPSBkZXNjcztcbiAgICAgIGNvbnN0IHJlc3RLZXlzID0gb3duS2V5czIocmVzdERlc2NzKTtcbiAgICAgIHJldHVybiAobmFtZURlc2MgJiYgdHlwZW9mIG5hbWVEZXNjLnZhbHVlID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYEZhciBmdW5jdGlvbiBuYW1lIG11c3QgYmUgYSBzdHJpbmcsIGluICR7Y2FuZGlkYXRlfWApICYmIChsZW5ndGhEZXNjICYmIHR5cGVvZiBsZW5ndGhEZXNjLnZhbHVlID09PSBcIm51bWJlclwiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgICAgIGNoZWNrXG4gICAgICApYEZhciBmdW5jdGlvbiBsZW5ndGggbXVzdCBiZSBhIG51bWJlciwgaW4gJHtjYW5kaWRhdGV9YCkgJiYgKHRvU3RyaW5nVGFnRGVzYyA9PT0gdm9pZCAwIHx8ICh0eXBlb2YgdG9TdHJpbmdUYWdEZXNjLnZhbHVlID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgICAgIGNoZWNrXG4gICAgICApYEZhciBmdW5jdGlvbiBAQHRvU3RyaW5nVGFnIG11c3QgYmUgYSBzdHJpbmcsIGluICR7Y2FuZGlkYXRlfWApICYmIGNoZWNrSWZhY2UodG9TdHJpbmdUYWdEZXNjLnZhbHVlLCBjaGVjaykpICYmIChyZXN0S2V5cy5sZW5ndGggPT09IDAgfHwgISFjaGVjayAmJiBDWChcbiAgICAgICAgY2hlY2tcbiAgICAgIClgRmFyIGZ1bmN0aW9ucyB1bmV4cGVjdGVkIHByb3BlcnRpZXMgYmVzaWRlcyAubmFtZSBhbmQgLmxlbmd0aCAke3Jlc3RLZXlzfWApO1xuICAgIH1cbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgdW5yZWNvZ25pemVkIHR5cGVvZiAke2NhbmRpZGF0ZX1gO1xuICB9LFxuICBhc3NlcnRSZXN0VmFsaWQ6IChjYW5kaWRhdGUpID0+IGNoZWNrUmVtb3RhYmxlKGNhbmRpZGF0ZSwgYXNzZXJ0Q2hlY2tlciksXG4gIGV2ZXJ5OiAoX3Bhc3NhYmxlLCBfZm4pID0+IHRydWVcbn0pO1xuXG4vL1xudmFyIHsgcHJvdG90eXBlOiBmdW5jdGlvblByb3RvdHlwZTIgfSA9IEZ1bmN0aW9uO1xudmFyIHtcbiAgZ2V0UHJvdG90eXBlT2Y6IGdldFByb3RvdHlwZU9mNCxcbiAgc2V0UHJvdG90eXBlT2YsXG4gIGNyZWF0ZSxcbiAgaXNGcm96ZW46IGlzRnJvemVuMyxcbiAgcHJvdG90eXBlOiBvYmplY3RQcm90b3R5cGUzXG59ID0gT2JqZWN0O1xudmFyIG1ha2VSZW1vdGFibGVQcm90byA9IChyZW1vdGFibGUsIGlmYWNlKSA9PiB7XG4gIGxldCBvbGRQcm90byA9IGdldFByb3RvdHlwZU9mNChyZW1vdGFibGUpO1xuICBpZiAodHlwZW9mIHJlbW90YWJsZSA9PT0gXCJvYmplY3RcIikge1xuICAgIGlmIChvbGRQcm90byA9PT0gbnVsbCkge1xuICAgICAgb2xkUHJvdG8gPSBvYmplY3RQcm90b3R5cGUzO1xuICAgIH1cbiAgICBvbGRQcm90byA9PT0gb2JqZWN0UHJvdG90eXBlMyB8fCB0aHJvd1JlZGFjdGVkYEZvciBub3csIHJlbW90YWJsZXMgY2Fubm90IGluaGVyaXQgZnJvbSBhbnl0aGluZyB1bnVzdWFsLCBpbiAke3JlbW90YWJsZX1gO1xuICB9IGVsc2UgaWYgKHR5cGVvZiByZW1vdGFibGUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIG9sZFByb3RvICE9PSBudWxsIHx8IHRocm93UmVkYWN0ZWRgT3JpZ2luYWwgZnVuY3Rpb24gbXVzdCBub3QgaW5oZXJpdCBmcm9tIG51bGw6ICR7cmVtb3RhYmxlfWA7XG4gICAgb2xkUHJvdG8gPT09IGZ1bmN0aW9uUHJvdG90eXBlMiB8fCBnZXRQcm90b3R5cGVPZjQob2xkUHJvdG8pID09PSBmdW5jdGlvblByb3RvdHlwZTIgfHwgdGhyb3dSZWRhY3RlZGBGYXIgZnVuY3Rpb25zIG11c3Qgb3JpZ2luYWxseSBpbmhlcml0IGZyb20gRnVuY3Rpb24ucHJvdG90eXBlLCBpbiAke3JlbW90YWJsZX1gO1xuICB9IGVsc2Uge1xuICAgIHRocm93UmVkYWN0ZWRgdW5yZWNvZ25pemVkIHR5cGVvZiAke3JlbW90YWJsZX1gO1xuICB9XG4gIHJldHVybiBoYXJkZW4oXG4gICAgY3JlYXRlKG9sZFByb3RvLCB7XG4gICAgICBbUEFTU19TVFlMRV06IHsgdmFsdWU6IFwicmVtb3RhYmxlXCIgfSxcbiAgICAgIFtTeW1ib2wudG9TdHJpbmdUYWddOiB7IHZhbHVlOiBpZmFjZSB9XG4gICAgfSlcbiAgKTtcbn07XG52YXIgYXNzZXJ0Q2FuQmVSZW1vdGFibGUgPSAoY2FuZGlkYXRlKSA9PiBSZW1vdGFibGVIZWxwZXIuY2FuQmVWYWxpZChjYW5kaWRhdGUsIGFzc2VydENoZWNrZXIpO1xudmFyIFJlbW90YWJsZSA9IChpZmFjZSA9IFwiUmVtb3RhYmxlXCIsIHByb3BzID0gdm9pZCAwLCByZW1vdGFibGUgPSAoXG4gIC8qICAgICAgICAgICAgKi9cbiAge31cbikpID0+IHtcbiAgYXNzZXJ0SWZhY2UoaWZhY2UpO1xuICBhc3NlcnQoaWZhY2UpO1xuICBwcm9wcyA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlIHByb3BzIG5vdCB5ZXQgaW1wbGVtZW50ZWQgJHtwcm9wc31gO1xuICBhc3NlcnRDYW5CZVJlbW90YWJsZShyZW1vdGFibGUpO1xuICAhKFBBU1NfU1RZTEUgaW4gcmVtb3RhYmxlKSB8fCB0aHJvd1JlZGFjdGVkYFJlbW90YWJsZSAke3JlbW90YWJsZX0gaXMgYWxyZWFkeSBtYXJrZWQgYXMgYSAke3F1b3RlKFxuICAgIHJlbW90YWJsZVtQQVNTX1NUWUxFXVxuICApfWA7XG4gIGhhcmRlbi5pc0Zha2UgfHwgLy9cbiAgIWlzRnJvemVuMyhyZW1vdGFibGUpIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlICR7cmVtb3RhYmxlfSBpcyBhbHJlYWR5IGZyb3plbmA7XG4gIGNvbnN0IHJlbW90YWJsZVByb3RvID0gbWFrZVJlbW90YWJsZVByb3RvKHJlbW90YWJsZSwgaWZhY2UpO1xuICBjb25zdCBtdXRhdGVIYXJkZW5BbmRDaGVjayA9ICh0YXJnZXQpID0+IHtcbiAgICBzZXRQcm90b3R5cGVPZih0YXJnZXQsIHJlbW90YWJsZVByb3RvKTtcbiAgICBoYXJkZW4odGFyZ2V0KTtcbiAgICBhc3NlcnRDYW5CZVJlbW90YWJsZSh0YXJnZXQpO1xuICB9O1xuICBtdXRhdGVIYXJkZW5BbmRDaGVjayh7fSk7XG4gIG11dGF0ZUhhcmRlbkFuZENoZWNrKHJlbW90YWJsZSk7XG4gIGFzc2VydChpZmFjZSAhPT0gdm9pZCAwKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICByZW1vdGFibGVcbiAgKTtcbn07XG5oYXJkZW4oUmVtb3RhYmxlKTtcbnZhciBHRVRfTUVUSE9EX05BTUVTID0gXCJfX2dldE1ldGhvZE5hbWVzX19cIjtcbnZhciBnZXRNZXRob2ROYW1lc01ldGhvZCA9IGhhcmRlbih7XG4gIFtHRVRfTUVUSE9EX05BTUVTXSgpIHtcbiAgICByZXR1cm4gZ2V0TWV0aG9kTmFtZXModGhpcyk7XG4gIH1cbn0pW0dFVF9NRVRIT0RfTkFNRVNdO1xudmFyIGdldE1ldGhvZE5hbWVzRGVzY3JpcHRvciA9IGhhcmRlbih7XG4gIHZhbHVlOiBnZXRNZXRob2ROYW1lc01ldGhvZCxcbiAgZW51bWVyYWJsZTogZmFsc2UsXG4gIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gIHdyaXRhYmxlOiBmYWxzZVxufSk7XG52YXIgRmFyID0gKGZhck5hbWUsIHJlbW90YWJsZSA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCByNSA9IHJlbW90YWJsZSA9PT0gdm9pZCAwID8gKFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICB7fVxuICApIDogcmVtb3RhYmxlO1xuICBpZiAodHlwZW9mIHI1ID09PSBcIm9iamVjdFwiICYmICEoR0VUX01FVEhPRF9OQU1FUyBpbiByNSkpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocjUsIEdFVF9NRVRIT0RfTkFNRVMsIGdldE1ldGhvZE5hbWVzRGVzY3JpcHRvcik7XG4gIH1cbiAgcmV0dXJuIFJlbW90YWJsZShgQWxsZWdlZDogJHtmYXJOYW1lfWAsIHZvaWQgMCwgcjUpO1xufTtcbmhhcmRlbihGYXIpO1xudmFyIFRvRmFyRnVuY3Rpb24gPSAoZmFyTmFtZSwgZnVuYykgPT4ge1xuICBpZiAoZ2V0SW50ZXJmYWNlT2YoZnVuYykgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiBmdW5jO1xuICB9XG4gIHJldHVybiBGYXIoZmFyTmFtZSwgKC4uLmFyZ3MpID0+IGZ1bmMoLi4uYXJncykpO1xufTtcbmhhcmRlbihUb0ZhckZ1bmN0aW9uKTtcblxuLy9cbnZhciBtYXBJdGVyYWJsZSA9IChiYXNlSXRlcmFibGUsIGZ1bmMpID0+IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgRmFyKFwibWFwcGVkIGl0ZXJhYmxlXCIsIHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgY29uc3QgYmFzZUl0ZXJhdG9yID0gYmFzZUl0ZXJhYmxlW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgIHJldHVybiBGYXIoXCJtYXBwZWQgaXRlcmF0b3JcIiwge1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyB2YWx1ZTogYmFzZVZhbHVlLCBkb25lIH0gPSBiYXNlSXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gZG9uZSA/IGJhc2VWYWx1ZSA6IGZ1bmMoYmFzZVZhbHVlKTtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWUsIGRvbmUgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSlcbik7XG5oYXJkZW4obWFwSXRlcmFibGUpO1xudmFyIGZpbHRlckl0ZXJhYmxlID0gKGJhc2VJdGVyYWJsZSwgcHJlZCkgPT4gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICBGYXIoXCJmaWx0ZXJlZCBpdGVyYWJsZVwiLCB7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGNvbnN0IGJhc2VJdGVyYXRvciA9IGJhc2VJdGVyYWJsZVtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICByZXR1cm4gRmFyKFwiZmlsdGVyZWQgaXRlcmF0b3JcIiwge1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgZm9yICg7IDsgKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBiYXNlSXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgICAgY29uc3QgeyB2YWx1ZSwgZG9uZSB9ID0gcmVzdWx0O1xuICAgICAgICAgICAgaWYgKGRvbmUgfHwgcHJlZCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSlcbik7XG5oYXJkZW4oZmlsdGVySXRlcmFibGUpO1xuXG4vL1xudmFyIHsgZ2V0UHJvdG90eXBlT2Y6IGdldFByb3RvdHlwZU9mNSwgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczMsIGhhc093bjogaGFzT3duMiwgZW50cmllczogZW50cmllczIgfSA9IE9iamVjdDtcbnZhciBlcnJvckNvbnN0cnVjdG9ycyA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKFxuICAvL1xuICAvL1xuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgW1xuICAgIFtcIkVycm9yXCIsIEVycm9yXSxcbiAgICBbXCJFdmFsRXJyb3JcIiwgRXZhbEVycm9yXSxcbiAgICBbXCJSYW5nZUVycm9yXCIsIFJhbmdlRXJyb3JdLFxuICAgIFtcIlJlZmVyZW5jZUVycm9yXCIsIFJlZmVyZW5jZUVycm9yXSxcbiAgICBbXCJTeW50YXhFcnJvclwiLCBTeW50YXhFcnJvcl0sXG4gICAgW1wiVHlwZUVycm9yXCIsIFR5cGVFcnJvcl0sXG4gICAgW1wiVVJJRXJyb3JcIiwgVVJJRXJyb3JdXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgXVxuKTtcbmlmICh0eXBlb2YgQWdncmVnYXRlRXJyb3IgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgZXJyb3JDb25zdHJ1Y3RvcnMuc2V0KFwiQWdncmVnYXRlRXJyb3JcIiwgQWdncmVnYXRlRXJyb3IpO1xufVxudmFyIGdldEVycm9yQ29uc3RydWN0b3IgPSAobmFtZSkgPT4gZXJyb3JDb25zdHJ1Y3RvcnMuZ2V0KG5hbWUpO1xuaGFyZGVuKGdldEVycm9yQ29uc3RydWN0b3IpO1xudmFyIGNoZWNrRXJyb3JMaWtlID0gKGNhbmRpZGF0ZSwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgcmV0dXJuIGNhbmRpZGF0ZSBpbnN0YW5jZW9mIEVycm9yIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYEVycm9yIGV4cGVjdGVkOiAke2NhbmRpZGF0ZX1gO1xufTtcbmhhcmRlbihjaGVja0Vycm9yTGlrZSk7XG52YXIgaXNFcnJvckxpa2UgPSAoY2FuZGlkYXRlKSA9PiBjaGVja0Vycm9yTGlrZShjYW5kaWRhdGUpO1xuaGFyZGVuKGlzRXJyb3JMaWtlKTtcbnZhciBjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvclByb3BlcnR5RGVzYyA9IChwcm9wTmFtZSwgZGVzYywgcGFzc1N0eWxlT2ZSZWN1ciwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgaWYgKGRlc2MuZW51bWVyYWJsZSkge1xuICAgIHJldHVybiAhIWNoZWNrICYmIENYKGNoZWNrKWBQYXNzYWJsZSBFcnJvciAke3F1b3RlKFxuICAgICAgcHJvcE5hbWVcbiAgICApfSBvd24gcHJvcGVydHkgbXVzdCBub3QgYmUgZW51bWVyYWJsZTogJHtkZXNjfWA7XG4gIH1cbiAgaWYgKCFoYXNPd24yKGRlc2MsIFwidmFsdWVcIikpIHtcbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgUGFzc2FibGUgRXJyb3IgJHtxdW90ZShcbiAgICAgIHByb3BOYW1lXG4gICAgKX0gb3duIHByb3BlcnR5IG11c3QgYmUgYSBkYXRhIHByb3BlcnR5OiAke2Rlc2N9YDtcbiAgfVxuICBjb25zdCB7IHZhbHVlIH0gPSBkZXNjO1xuICBzd2l0Y2ggKHByb3BOYW1lKSB7XG4gICAgY2FzZSBcIm1lc3NhZ2VcIjpcbiAgICBjYXNlIFwic3RhY2tcIjoge1xuICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBQYXNzYWJsZSBFcnJvciAke3F1b3RlKFxuICAgICAgICBwcm9wTmFtZVxuICAgICAgKX0gb3duIHByb3BlcnR5IG11c3QgYmUgYSBzdHJpbmc6ICR7dmFsdWV9YDtcbiAgICB9XG4gICAgY2FzZSBcImNhdXNlXCI6IHtcbiAgICAgIHJldHVybiBjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvcih2YWx1ZSwgcGFzc1N0eWxlT2ZSZWN1ciwgY2hlY2spO1xuICAgIH1cbiAgICBjYXNlIFwiZXJyb3JzXCI6IHtcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgcGFzc1N0eWxlT2ZSZWN1cih2YWx1ZSkgIT09IFwiY29weUFycmF5XCIpIHtcbiAgICAgICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goY2hlY2spYFBhc3NhYmxlIEVycm9yICR7cXVvdGUoXG4gICAgICAgICAgcHJvcE5hbWVcbiAgICAgICAgKX0gb3duIHByb3BlcnR5IG11c3QgYmUgYSBjb3B5QXJyYXk6ICR7dmFsdWV9YDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZS5ldmVyeShcbiAgICAgICAgKGVycikgPT4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3IoZXJyLCBwYXNzU3R5bGVPZlJlY3VyLCBjaGVjaylcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIHJldHVybiAhIWNoZWNrICYmIENYKGNoZWNrKWBQYXNzYWJsZSBFcnJvciBoYXMgZXh0cmEgdW5wYXNzZWQgcHJvcGVydHkgJHtxdW90ZShwcm9wTmFtZSl9YDtcbn07XG5oYXJkZW4oY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MpO1xudmFyIGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yID0gKGNhbmRpZGF0ZSwgcGFzc1N0eWxlT2ZSZWN1ciwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgaWYgKCFjaGVja0Vycm9yTGlrZShjYW5kaWRhdGUsIGNoZWNrKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCBwcm90byA9IGdldFByb3RvdHlwZU9mNShjYW5kaWRhdGUpO1xuICBjb25zdCB7IG5hbWUgfSA9IHByb3RvO1xuICBjb25zdCBlcnJDb25zdHJ1Y3RvciA9IGdldEVycm9yQ29uc3RydWN0b3IobmFtZSk7XG4gIGlmIChlcnJDb25zdHJ1Y3RvciA9PT0gdm9pZCAwIHx8IGVyckNvbnN0cnVjdG9yLnByb3RvdHlwZSAhPT0gcHJvdG8pIHtcbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChcbiAgICAgIGNoZWNrXG4gICAgKWBQYXNzYWJsZSBFcnJvciBtdXN0IGluaGVyaXQgZnJvbSBhbiBlcnJvciBjbGFzcyAucHJvdG90eXBlOiAke2NhbmRpZGF0ZX1gO1xuICB9XG4gIGNvbnN0IGRlc2NzID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczMoY2FuZGlkYXRlKTtcbiAgaWYgKCEoXCJtZXNzYWdlXCIgaW4gZGVzY3MpKSB7XG4gICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goXG4gICAgICBjaGVja1xuICAgIClgUGFzc2FibGUgRXJyb3IgbXVzdCBoYXZlIGFuIG93biBcIm1lc3NhZ2VcIiBzdHJpbmcgcHJvcGVydHk6ICR7Y2FuZGlkYXRlfWA7XG4gIH1cbiAgcmV0dXJuIGVudHJpZXMyKGRlc2NzKS5ldmVyeShcbiAgICAoW3Byb3BOYW1lLCBkZXNjXSkgPT4gY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MoXG4gICAgICBwcm9wTmFtZSxcbiAgICAgIGRlc2MsXG4gICAgICBwYXNzU3R5bGVPZlJlY3VyLFxuICAgICAgY2hlY2tcbiAgICApXG4gICk7XG59O1xuaGFyZGVuKGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yKTtcbnZhciBFcnJvckhlbHBlciA9IGhhcmRlbih7XG4gIHN0eWxlTmFtZTogXCJlcnJvclwiLFxuICBjYW5CZVZhbGlkOiBjaGVja0Vycm9yTGlrZSxcbiAgYXNzZXJ0UmVzdFZhbGlkOiAoY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyKSA9PiBjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvcihjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIsIGFzc2VydENoZWNrZXIpXG59KTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXMzIH0gPSBSZWZsZWN0O1xudmFyIHdlbGxLbm93blN5bWJvbE5hbWVzID0gbmV3IE1hcChcbiAgb3duS2V5czMoU3ltYm9sKS5maWx0ZXIoXG4gICAgKG5hbWUpID0+IHR5cGVvZiBuYW1lID09PSBcInN0cmluZ1wiICYmIHR5cGVvZiBTeW1ib2xbbmFtZV0gPT09IFwic3ltYm9sXCJcbiAgKS5maWx0ZXIoKG5hbWUpID0+IHtcbiAgICAhbmFtZS5zdGFydHNXaXRoKFwiQEBcIikgfHwgdGhyb3dSZWRhY3RlZGBEaWQgbm90IGV4cGVjdCBTeW1ib2wgdG8gaGF2ZSBhIHN5bWJvbC12YWx1ZWQgcHJvcGVydHkgbmFtZSBzdGFydGluZyB3aXRoIFwiQEBcIiAke3F1b3RlKFxuICAgICAgbmFtZVxuICAgICl9YDtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSkubWFwKChuYW1lKSA9PiBbU3ltYm9sW25hbWVdLCBgQEAke25hbWV9YF0pXG4pO1xudmFyIGlzUGFzc2FibGVTeW1ib2wgPSAoc3ltKSA9PiB0eXBlb2Ygc3ltID09PSBcInN5bWJvbFwiICYmICh0eXBlb2YgU3ltYm9sLmtleUZvcihzeW0pID09PSBcInN0cmluZ1wiIHx8IHdlbGxLbm93blN5bWJvbE5hbWVzLmhhcyhzeW0pKTtcbmhhcmRlbihpc1Bhc3NhYmxlU3ltYm9sKTtcbnZhciBhc3NlcnRQYXNzYWJsZVN5bWJvbCA9IChzeW0pID0+IGlzUGFzc2FibGVTeW1ib2woc3ltKSB8fCB0aHJvd1JlZGFjdGVkYE9ubHkgcmVnaXN0ZXJlZCBzeW1ib2xzIG9yIHdlbGwta25vd24gc3ltYm9scyBhcmUgcGFzc2FibGU6ICR7cXVvdGUoc3ltKX1gO1xuaGFyZGVuKGFzc2VydFBhc3NhYmxlU3ltYm9sKTtcbnZhciBuYW1lRm9yUGFzc2FibGVTeW1ib2wgPSAoc3ltKSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBTeW1ib2wua2V5Rm9yKHN5bSk7XG4gIGlmIChuYW1lID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gd2VsbEtub3duU3ltYm9sTmFtZXMuZ2V0KHN5bSk7XG4gIH1cbiAgaWYgKG5hbWUuc3RhcnRzV2l0aChcIkBAXCIpKSB7XG4gICAgcmV0dXJuIGBAQCR7bmFtZX1gO1xuICB9XG4gIHJldHVybiBuYW1lO1xufTtcbmhhcmRlbihuYW1lRm9yUGFzc2FibGVTeW1ib2wpO1xudmFyIEF0QXRQcmVmaXhQYXR0ZXJuID0gL15AQCguKikkLztcbmhhcmRlbihBdEF0UHJlZml4UGF0dGVybik7XG52YXIgcGFzc2FibGVTeW1ib2xGb3JOYW1lID0gKG5hbWUpID0+IHtcbiAgaWYgKHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBjb25zdCBtYXRjaCA9IEF0QXRQcmVmaXhQYXR0ZXJuLmV4ZWMobmFtZSk7XG4gIGlmIChtYXRjaCkge1xuICAgIGNvbnN0IHN1ZmZpeCA9IG1hdGNoWzFdO1xuICAgIGlmIChzdWZmaXguc3RhcnRzV2l0aChcIkBAXCIpKSB7XG4gICAgICByZXR1cm4gU3ltYm9sLmZvcihzdWZmaXgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBzeW0gPSBTeW1ib2xbc3VmZml4XTtcbiAgICAgIGlmICh0eXBlb2Ygc3ltID09PSBcInN5bWJvbFwiKSB7XG4gICAgICAgIHJldHVybiBzeW07XG4gICAgICB9XG4gICAgICB0aHJvd1JlZGFjdGVkYFJlc2VydmVkIGZvciB3ZWxsIGtub3duIHN5bWJvbCAke3F1b3RlKHN1ZmZpeCl9OiAke3F1b3RlKG5hbWUpfWA7XG4gICAgfVxuICB9XG4gIHJldHVybiBTeW1ib2wuZm9yKG5hbWUpO1xufTtcbmhhcmRlbihwYXNzYWJsZVN5bWJvbEZvck5hbWUpO1xuXG4vL1xudmFyIGhhc1dlbGxGb3JtZWRTdHJpbmdNZXRob2QgPSAhIVN0cmluZy5wcm90b3R5cGUuaXNXZWxsRm9ybWVkO1xudmFyIGlzV2VsbEZvcm1lZFN0cmluZyA9IGhhc1dlbGxGb3JtZWRTdHJpbmdNZXRob2QgPyAoc3RyKSA9PiB0eXBlb2Ygc3RyID09PSBcInN0cmluZ1wiICYmIHN0ci5pc1dlbGxGb3JtZWQoKSA6IChzdHIpID0+IHtcbiAgaWYgKHR5cGVvZiBzdHIgIT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZm9yIChjb25zdCBjaCBvZiBzdHIpIHtcbiAgICBjb25zdCBjcCA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgY2guY29kZVBvaW50QXQoMClcbiAgICApO1xuICAgIGlmIChjcCA+PSA1NTI5NiAmJiBjcCA8PSA1NzM0Mykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5oYXJkZW4oaXNXZWxsRm9ybWVkU3RyaW5nKTtcbnZhciBhc3NlcnRXZWxsRm9ybWVkU3RyaW5nID0gKHN0cikgPT4ge1xuICBpc1dlbGxGb3JtZWRTdHJpbmcoc3RyKSB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkIHdlbGwtZm9ybWVkIHVuaWNvZGUgc3RyaW5nOiAke3N0cn1gO1xufTtcbmhhcmRlbihhc3NlcnRXZWxsRm9ybWVkU3RyaW5nKTtcbnZhciBPTkxZX1dFTExfRk9STUVEX1NUUklOR1NfUEFTU0FCTEUgPSBnZXRFbnZpcm9ubWVudE9wdGlvbihcIk9OTFlfV0VMTF9GT1JNRURfU1RSSU5HU19QQVNTQUJMRVwiLCBcImRpc2FibGVkXCIsIFtcbiAgXCJlbmFibGVkXCJcbl0pID09PSBcImVuYWJsZWRcIjtcbnZhciBhc3NlcnRQYXNzYWJsZVN0cmluZyA9IChzdHIpID0+IHtcbiAgdHlwZW9mIHN0ciA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkIHN0cmluZyAke3N0cn1gO1xuICAhT05MWV9XRUxMX0ZPUk1FRF9TVFJJTkdTX1BBU1NBQkxFIHx8IGFzc2VydFdlbGxGb3JtZWRTdHJpbmcoc3RyKTtcbn07XG5oYXJkZW4oYXNzZXJ0UGFzc2FibGVTdHJpbmcpO1xuXG4vL1xudmFyIG1ha2VSZWxlYXNpbmdFeGVjdXRvcktpdCA9ICgpID0+IHtcbiAgbGV0IGludGVybmFsUmVzb2x2ZTtcbiAgbGV0IGludGVybmFsUmVqZWN0O1xuICBjb25zdCByZXNvbHZlMiA9ICh2YWx1ZSkgPT4ge1xuICAgIGlmIChpbnRlcm5hbFJlc29sdmUpIHtcbiAgICAgIGludGVybmFsUmVzb2x2ZSh2YWx1ZSk7XG4gICAgICBpbnRlcm5hbFJlc29sdmUgPSBudWxsO1xuICAgICAgaW50ZXJuYWxSZWplY3QgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBhc3NlcnQoaW50ZXJuYWxSZXNvbHZlID09PSBudWxsKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHJlamVjdCA9IChyZWFzb24pID0+IHtcbiAgICBpZiAoaW50ZXJuYWxSZWplY3QpIHtcbiAgICAgIGludGVybmFsUmVqZWN0KHJlYXNvbik7XG4gICAgICBpbnRlcm5hbFJlc29sdmUgPSBudWxsO1xuICAgICAgaW50ZXJuYWxSZWplY3QgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBhc3NlcnQoaW50ZXJuYWxSZWplY3QgPT09IG51bGwpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgZXhlY3V0b3IgPSAocmVzLCByZWopID0+IHtcbiAgICBhc3NlcnQoaW50ZXJuYWxSZXNvbHZlID09PSB2b2lkIDAgJiYgaW50ZXJuYWxSZWplY3QgPT09IHZvaWQgMCk7XG4gICAgaW50ZXJuYWxSZXNvbHZlID0gcmVzO1xuICAgIGludGVybmFsUmVqZWN0ID0gcmVqO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHsgcmVzb2x2ZTogcmVzb2x2ZTIsIHJlamVjdCwgZXhlY3V0b3IgfSk7XG59O1xuaGFyZGVuKG1ha2VSZWxlYXNpbmdFeGVjdXRvcktpdCk7XG5cbi8vXG52YXIgaXNPYmplY3QzID0gKHZhbHVlKSA9PiBPYmplY3QodmFsdWUpID09PSB2YWx1ZTtcbnZhciBrbm93blByb21pc2VzID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG52YXIgbWFya1NldHRsZWQgPSAocmVjb3JkKSA9PiB7XG4gIGlmICghcmVjb3JkIHx8IHJlY29yZC5zZXR0bGVkKSB7XG4gICAgcmV0dXJuIC8qICAgICAgICAgICAqLyBuZXcgU2V0KCk7XG4gIH1cbiAgY29uc3QgeyBkZWZlcnJlZHMgfSA9IHJlY29yZDtcbiAgT2JqZWN0LmFzc2lnbihyZWNvcmQsIHtcbiAgICBkZWZlcnJlZHM6IHZvaWQgMCxcbiAgICBzZXR0bGVkOiB0cnVlXG4gIH0pO1xuICBPYmplY3QuZnJlZXplKHJlY29yZCk7XG4gIHJldHVybiBkZWZlcnJlZHM7XG59O1xudmFyIGdldE1lbW9SZWNvcmQgPSAodmFsdWUpID0+IHtcbiAgaWYgKCFpc09iamVjdDModmFsdWUpKSB7XG4gICAgcmV0dXJuIGhhcmRlbih7IHNldHRsZWQ6IHRydWUgfSk7XG4gIH1cbiAgbGV0IHJlY29yZCA9IGtub3duUHJvbWlzZXMuZ2V0KHZhbHVlKTtcbiAgaWYgKCFyZWNvcmQpIHtcbiAgICByZWNvcmQgPSB7IGRlZmVycmVkczogLyogICAgICAgICAgICovIG5ldyBTZXQoKSwgc2V0dGxlZDogZmFsc2UgfTtcbiAgICBrbm93blByb21pc2VzLnNldCh2YWx1ZSwgcmVjb3JkKTtcbiAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oXG4gICAgICAodmFsKSA9PiB7XG4gICAgICAgIGZvciAoY29uc3QgeyByZXNvbHZlOiByZXNvbHZlMiB9IG9mIG1hcmtTZXR0bGVkKHJlY29yZCkpIHtcbiAgICAgICAgICByZXNvbHZlMih2YWwpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgKGVycikgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IHsgcmVqZWN0IH0gb2YgbWFya1NldHRsZWQocmVjb3JkKSkge1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgfVxuICByZXR1cm4gcmVjb3JkO1xufTtcbnZhciB7IHJhY2UgfSA9IHtcbiAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAqL1xuICByYWNlKHZhbHVlczYpIHtcbiAgICBsZXQgZGVmZXJyZWQ7XG4gICAgY29uc3QgY2FjaGVkVmFsdWVzID0gW107XG4gICAgY29uc3QgQyA9IHRoaXM7XG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IEMoKHJlc29sdmUyLCByZWplY3QpID0+IHtcbiAgICAgIGRlZmVycmVkID0geyByZXNvbHZlOiByZXNvbHZlMiwgcmVqZWN0IH07XG4gICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHZhbHVlczYpIHtcbiAgICAgICAgY2FjaGVkVmFsdWVzLnB1c2godmFsdWUpO1xuICAgICAgICBjb25zdCB7IHNldHRsZWQsIGRlZmVycmVkcyB9ID0gZ2V0TWVtb1JlY29yZCh2YWx1ZSk7XG4gICAgICAgIGlmIChzZXR0bGVkKSB7XG4gICAgICAgICAgQy5yZXNvbHZlKHZhbHVlKS50aGVuKHJlc29sdmUyLCByZWplY3QpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRlZmVycmVkcy5hZGQoZGVmZXJyZWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdC5maW5hbGx5KCgpID0+IHtcbiAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgY2FjaGVkVmFsdWVzKSB7XG4gICAgICAgIGNvbnN0IHsgZGVmZXJyZWRzIH0gPSBnZXRNZW1vUmVjb3JkKHZhbHVlKTtcbiAgICAgICAgaWYgKGRlZmVycmVkcykge1xuICAgICAgICAgIGRlZmVycmVkcy5kZWxldGUoZGVmZXJyZWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn07XG5cbi8vXG5mdW5jdGlvbiBpc1Byb21pc2UobWF5YmVQcm9taXNlKSB7XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUobWF5YmVQcm9taXNlKSA9PT0gbWF5YmVQcm9taXNlO1xufVxuaGFyZGVuKGlzUHJvbWlzZSk7XG5cbi8vXG52YXIgQmVzdFBpcGVsaW5hYmxlUHJvbWlzZSA9IGdsb2JhbFRoaXMuSGFuZGxlZFByb21pc2UgfHwgUHJvbWlzZTtcbmZ1bmN0aW9uIG1ha2VQcm9taXNlS2l0KCkge1xuICBjb25zdCB7IHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QsIGV4ZWN1dG9yIH0gPSBtYWtlUmVsZWFzaW5nRXhlY3V0b3JLaXQoKTtcbiAgY29uc3QgcHJvbWlzZSA9IG5ldyBCZXN0UGlwZWxpbmFibGVQcm9taXNlKGV4ZWN1dG9yKTtcbiAgcmV0dXJuIGhhcmRlbih7IHByb21pc2UsIHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QgfSk7XG59XG5oYXJkZW4obWFrZVByb21pc2VLaXQpO1xuZnVuY3Rpb24gcmFjZVByb21pc2VzKHZhbHVlczYpIHtcbiAgcmV0dXJuIGhhcmRlbihyYWNlLmNhbGwoQmVzdFBpcGVsaW5hYmxlUHJvbWlzZSwgdmFsdWVzNikpO1xufVxuaGFyZGVuKHJhY2VQcm9taXNlcyk7XG5cbi8vXG52YXIgeyBnZXRQcm90b3R5cGVPZjogZ2V0UHJvdG90eXBlT2Y2IH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzNCB9ID0gUmVmbGVjdDtcbnZhciB7IGlzQXJyYXk6IGlzQXJyYXkzLCBwcm90b3R5cGU6IGFycmF5UHJvdG90eXBlIH0gPSBBcnJheTtcbnZhciBDb3B5QXJyYXlIZWxwZXIgPSBoYXJkZW4oe1xuICBzdHlsZU5hbWU6IFwiY29weUFycmF5XCIsXG4gIGNhbkJlVmFsaWQ6IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiBpc0FycmF5MyhjYW5kaWRhdGUpIHx8ICEhY2hlY2sgJiYgY2hlY2soZmFsc2UsIHJlZGFjdGVkYEFycmF5IGV4cGVjdGVkOiAke2NhbmRpZGF0ZX1gKSxcbiAgYXNzZXJ0UmVzdFZhbGlkOiAoY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyKSA9PiB7XG4gICAgZ2V0UHJvdG90eXBlT2Y2KGNhbmRpZGF0ZSkgPT09IGFycmF5UHJvdG90eXBlIHx8IGFzc2VydC5mYWlsKHJlZGFjdGVkYE1hbGZvcm1lZCBhcnJheTogJHtjYW5kaWRhdGV9YCwgVHlwZUVycm9yKTtcbiAgICBjb25zdCBsZW4gPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGdldE93bkRhdGFEZXNjcmlwdG9yKGNhbmRpZGF0ZSwgXCJsZW5ndGhcIiwgZmFsc2UsIGFzc2VydENoZWNrZXIpLnZhbHVlXG4gICAgKTtcbiAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbGVuOyBpMiArPSAxKSB7XG4gICAgICBwYXNzU3R5bGVPZlJlY3VyKFxuICAgICAgICBnZXRPd25EYXRhRGVzY3JpcHRvcihjYW5kaWRhdGUsIGkyLCB0cnVlLCBhc3NlcnRDaGVja2VyKS52YWx1ZVxuICAgICAgKTtcbiAgICB9XG4gICAgb3duS2V5czQoY2FuZGlkYXRlKS5sZW5ndGggPT09IGxlbiArIDEgfHwgYXNzZXJ0LmZhaWwocmVkYWN0ZWRgQXJyYXlzIG11c3Qgbm90IGhhdmUgbm9uLWluZGV4ZXM6ICR7Y2FuZGlkYXRlfWAsIFR5cGVFcnJvcik7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czUgfSA9IFJlZmxlY3Q7XG52YXIgeyBnZXRQcm90b3R5cGVPZjogZ2V0UHJvdG90eXBlT2Y3LCBwcm90b3R5cGU6IG9iamVjdFByb3RvdHlwZTQgfSA9IE9iamVjdDtcbnZhciBjaGVja09iamVjdFByb3RvdHlwZSA9IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiB7XG4gIHJldHVybiBnZXRQcm90b3R5cGVPZjcoY2FuZGlkYXRlKSA9PT0gb2JqZWN0UHJvdG90eXBlNCB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBSZWNvcmRzIG11c3QgaW5oZXJpdCBmcm9tIE9iamVjdC5wcm90b3R5cGU6ICR7Y2FuZGlkYXRlfWA7XG59O1xudmFyIGNoZWNrUHJvcGVydHlDYW5CZVZhbGlkID0gKGNhbmRpZGF0ZSwga2V5LCB2YWx1ZSwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgcmV0dXJuICh0eXBlb2Yga2V5ID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgY2hlY2tcbiAgKWBSZWNvcmRzIGNhbiBvbmx5IGhhdmUgc3RyaW5nLW5hbWVkIHByb3BlcnRpZXM6ICR7Y2FuZGlkYXRlfWApICYmICghY2FuQmVNZXRob2QodmFsdWUpIHx8ICEhY2hlY2sgJiYgLy9cbiAgQ1goXG4gICAgY2hlY2tcbiAgKWBSZWNvcmRzIGNhbm5vdCBjb250YWluIG5vbi1mYXIgZnVuY3Rpb25zIGJlY2F1c2UgdGhleSBtYXkgYmUgbWV0aG9kcyBvZiBhbiBpbXBsaWNpdCBSZW1vdGFibGU6ICR7Y2FuZGlkYXRlfWApO1xufTtcbnZhciBDb3B5UmVjb3JkSGVscGVyID0gaGFyZGVuKHtcbiAgc3R5bGVOYW1lOiBcImNvcHlSZWNvcmRcIixcbiAgY2FuQmVWYWxpZDogKGNhbmRpZGF0ZSwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgICByZXR1cm4gY2hlY2tPYmplY3RQcm90b3R5cGUoY2FuZGlkYXRlLCBjaGVjaykgJiYgLy9cbiAgICAvL1xuICAgIG93bktleXM1KGNhbmRpZGF0ZSkuZXZlcnkoXG4gICAgICAoa2V5KSA9PiBjaGVja1Byb3BlcnR5Q2FuQmVWYWxpZChjYW5kaWRhdGUsIGtleSwgY2FuZGlkYXRlW2tleV0sIGNoZWNrKVxuICAgICk7XG4gIH0sXG4gIGFzc2VydFJlc3RWYWxpZDogKGNhbmRpZGF0ZSwgcGFzc1N0eWxlT2ZSZWN1cikgPT4ge1xuICAgIGZvciAoY29uc3QgbmFtZSBvZiBvd25LZXlzNShjYW5kaWRhdGUpKSB7XG4gICAgICBjb25zdCB7IHZhbHVlIH0gPSBnZXRPd25EYXRhRGVzY3JpcHRvcihcbiAgICAgICAgY2FuZGlkYXRlLFxuICAgICAgICBuYW1lLFxuICAgICAgICB0cnVlLFxuICAgICAgICBhc3NlcnRDaGVja2VyXG4gICAgICApO1xuICAgICAgcGFzc1N0eWxlT2ZSZWN1cih2YWx1ZSk7XG4gICAgfVxuICB9XG59KTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXM2IH0gPSBSZWZsZWN0O1xudmFyIHsgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczQgfSA9IE9iamVjdDtcbnZhciBUYWdnZWRIZWxwZXIgPSBoYXJkZW4oe1xuICBzdHlsZU5hbWU6IFwidGFnZ2VkXCIsXG4gIGNhbkJlVmFsaWQ6IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiBjaGVja1Bhc3NTdHlsZShjYW5kaWRhdGUsIGNhbmRpZGF0ZVtQQVNTX1NUWUxFXSwgXCJ0YWdnZWRcIiwgY2hlY2spLFxuICBhc3NlcnRSZXN0VmFsaWQ6IChjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIpID0+IHtcbiAgICBjaGVja1RhZ1JlY29yZChjYW5kaWRhdGUsIFwidGFnZ2VkXCIsIGFzc2VydENoZWNrZXIpO1xuICAgIGNvbnN0IHBhc3NTdHlsZUtleSA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIFBBU1NfU1RZTEVcbiAgICApO1xuICAgIGNvbnN0IHRhZ0tleSA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIFN5bWJvbC50b1N0cmluZ1RhZ1xuICAgICk7XG4gICAgY29uc3Qge1xuICAgICAgLy9cbiAgICAgIFtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgIHBhc3NTdHlsZUtleVxuICAgICAgXTogX3Bhc3NTdHlsZURlc2MsXG4gICAgICBbXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB0YWdLZXlcbiAgICAgIF06IF9sYWJlbERlc2MsXG4gICAgICBwYXlsb2FkOiBfcGF5bG9hZERlc2MsXG4gICAgICAvL1xuICAgICAgLi4ucmVzdERlc2NzXG4gICAgfSA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM0KGNhbmRpZGF0ZSk7XG4gICAgb3duS2V5czYocmVzdERlc2NzKS5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIHByb3BlcnRpZXMgb24gdGFnZ2VkIHJlY29yZCAke293bktleXM2KHJlc3REZXNjcyl9YDtcbiAgICBwYXNzU3R5bGVPZlJlY3VyKFxuICAgICAgZ2V0T3duRGF0YURlc2NyaXB0b3IoY2FuZGlkYXRlLCBcInBheWxvYWRcIiwgdHJ1ZSwgYXNzZXJ0Q2hlY2tlcikudmFsdWVcbiAgICApO1xuICB9XG59KTtcblxuLy9cbnZhciB7IGlzRnJvemVuOiBpc0Zyb3plbjQsIGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjgsIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMiB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czcgfSA9IFJlZmxlY3Q7XG52YXIgeyB0b1N0cmluZ1RhZyB9ID0gU3ltYm9sO1xudmFyIGNoZWNrUHJvbWlzZU93bktleXMgPSAocHIsIGNoZWNrKSA9PiB7XG4gIGNvbnN0IGtleXM0ID0gb3duS2V5czcocHIpO1xuICBpZiAoa2V5czQubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgY29uc3QgdW5rbm93bktleXMgPSBrZXlzNC5maWx0ZXIoXG4gICAgKGtleSkgPT4gdHlwZW9mIGtleSAhPT0gXCJzeW1ib2xcIiB8fCAhaGFzT3duUHJvcGVydHlPZihQcm9taXNlLnByb3RvdHlwZSwga2V5KVxuICApO1xuICBpZiAodW5rbm93bktleXMubGVuZ3RoICE9PSAwKSB7XG4gICAgcmV0dXJuIENYKFxuICAgICAgY2hlY2tcbiAgICApYCR7cHJ9IC0gTXVzdCBub3QgaGF2ZSBhbnkgb3duIHByb3BlcnRpZXM6ICR7cXVvdGUodW5rbm93bktleXMpfWA7XG4gIH1cbiAgY29uc3QgY2hlY2tTYWZlT3duS2V5ID0gKGtleSkgPT4ge1xuICAgIGlmIChrZXkgPT09IHRvU3RyaW5nVGFnKSB7XG4gICAgICBjb25zdCB0YWdEZXNjID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMihwciwgdG9TdHJpbmdUYWcpO1xuICAgICAgYXNzZXJ0KHRhZ0Rlc2MgIT09IHZvaWQgMCk7XG4gICAgICByZXR1cm4gKGhhc093blByb3BlcnR5T2YodGFnRGVzYywgXCJ2YWx1ZVwiKSB8fCBDWChcbiAgICAgICAgY2hlY2tcbiAgICAgIClgT3duIEBAdG9TdHJpbmdUYWcgbXVzdCBiZSBhIGRhdGEgcHJvcGVydHksIG5vdCBhbiBhY2Nlc3NvcjogJHtxdW90ZSh0YWdEZXNjKX1gKSAmJiAodHlwZW9mIHRhZ0Rlc2MudmFsdWUgPT09IFwic3RyaW5nXCIgfHwgQ1goXG4gICAgICAgIGNoZWNrXG4gICAgICApYE93biBAQHRvU3RyaW5nVGFnIHZhbHVlIG11c3QgYmUgYSBzdHJpbmc6ICR7cXVvdGUodGFnRGVzYy52YWx1ZSl9YCkgJiYgKCF0YWdEZXNjLmVudW1lcmFibGUgfHwgQ1goY2hlY2spYE93biBAQHRvU3RyaW5nVGFnIG11c3Qgbm90IGJlIGVudW1lcmFibGU6ICR7cXVvdGUodGFnRGVzYyl9YCk7XG4gICAgfVxuICAgIGNvbnN0IHZhbCA9IHByW2tleV07XG4gICAgaWYgKHZhbCA9PT0gdm9pZCAwIHx8IHR5cGVvZiB2YWwgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHZhbCA9PT0gXCJvYmplY3RcIiAmJiB2YWwgIT09IG51bGwgJiYgaXNGcm96ZW40KHZhbCkgJiYgZ2V0UHJvdG90eXBlT2Y4KHZhbCkgPT09IE9iamVjdC5wcm90b3R5cGUpIHtcbiAgICAgIGNvbnN0IHN1YktleXMgPSBvd25LZXlzNyh2YWwpO1xuICAgICAgaWYgKHN1YktleXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKHN1YktleXMubGVuZ3RoID09PSAxICYmIHN1YktleXNbMF0gPT09IFwiZGVzdHJveWVkXCIgJiYgdmFsLmRlc3Ryb3llZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBDWChcbiAgICAgIGNoZWNrXG4gICAgKWBVbmV4cGVjdGVkIE5vZGUgYXN5bmNfaG9va3MgYWRkaXRpb25zIHRvIHByb21pc2U6ICR7cHJ9LiR7cXVvdGUoXG4gICAgICBTdHJpbmcoa2V5KVxuICAgICl9IGlzICR7dmFsfWA7XG4gIH07XG4gIHJldHVybiBrZXlzNC5ldmVyeShjaGVja1NhZmVPd25LZXkpO1xufTtcbnZhciBjaGVja1NhZmVQcm9taXNlID0gKHByLCBjaGVjaykgPT4ge1xuICByZXR1cm4gKGlzRnJvemVuNChwcikgfHwgQ1goY2hlY2spYCR7cHJ9IC0gTXVzdCBiZSBmcm96ZW5gKSAmJiAoaXNQcm9taXNlKHByKSB8fCBDWChjaGVjaylgJHtwcn0gLSBNdXN0IGJlIGEgcHJvbWlzZWApICYmIChnZXRQcm90b3R5cGVPZjgocHIpID09PSBQcm9taXNlLnByb3RvdHlwZSB8fCBDWChjaGVjaylgJHtwcn0gLSBNdXN0IGluaGVyaXQgZnJvbSBQcm9taXNlLnByb3RvdHlwZTogJHtxdW90ZShcbiAgICBnZXRQcm90b3R5cGVPZjgocHIpXG4gICl9YCkgJiYgY2hlY2tQcm9taXNlT3duS2V5cyhcbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgcHIsXG4gICAgY2hlY2tcbiAgKTtcbn07XG5oYXJkZW4oY2hlY2tTYWZlUHJvbWlzZSk7XG52YXIgaXNTYWZlUHJvbWlzZSA9IChwcikgPT4gY2hlY2tTYWZlUHJvbWlzZShwciwgKHgpID0+IHgpO1xuaGFyZGVuKGlzU2FmZVByb21pc2UpO1xudmFyIGFzc2VydFNhZmVQcm9taXNlID0gKHByKSA9PiBjaGVja1NhZmVQcm9taXNlKHByLCBhc3NlcnRDaGVja2VyKTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXM4IH0gPSBSZWZsZWN0O1xudmFyIHsgaXNGcm96ZW46IGlzRnJvemVuNSwgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczUsIHZhbHVlcyB9ID0gT2JqZWN0O1xudmFyIG1ha2VIZWxwZXJUYWJsZSA9IChwYXNzU3R5bGVIZWxwZXJzKSA9PiB7XG4gIGNvbnN0IEhlbHBlclRhYmxlID0ge1xuICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICBjb3B5QXJyYXk6IHZvaWQgMCxcbiAgICBjb3B5UmVjb3JkOiB2b2lkIDAsXG4gICAgdGFnZ2VkOiB2b2lkIDAsXG4gICAgZXJyb3I6IHZvaWQgMCxcbiAgICByZW1vdGFibGU6IHZvaWQgMFxuICB9O1xuICBmb3IgKGNvbnN0IGhlbHBlciBvZiBwYXNzU3R5bGVIZWxwZXJzKSB7XG4gICAgY29uc3QgeyBzdHlsZU5hbWUgfSA9IGhlbHBlcjtcbiAgICBzdHlsZU5hbWUgaW4gSGVscGVyVGFibGUgfHwgdGhyb3dSZWRhY3RlZGBVbnJlY29nbml6ZWQgaGVscGVyOiAke3F1b3RlKHN0eWxlTmFtZSl9YDtcbiAgICBIZWxwZXJUYWJsZVtzdHlsZU5hbWVdID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBjb25mbGljdGluZyBoZWxwZXJzIGZvciAke3F1b3RlKHN0eWxlTmFtZSl9YDtcbiAgICBIZWxwZXJUYWJsZVtzdHlsZU5hbWVdID0gaGVscGVyO1xuICB9XG4gIGZvciAoY29uc3Qgc3R5bGVOYW1lIG9mIG93bktleXM4KEhlbHBlclRhYmxlKSkge1xuICAgIEhlbHBlclRhYmxlW3N0eWxlTmFtZV0gIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYG1pc3NpbmcgaGVscGVyIGZvciAke3F1b3RlKHN0eWxlTmFtZSl9YDtcbiAgfVxuICByZXR1cm4gaGFyZGVuKEhlbHBlclRhYmxlKTtcbn07XG52YXIgYXNzZXJ0VmFsaWQgPSAoaGVscGVyLCBjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIpID0+IHtcbiAgaGVscGVyLmNhbkJlVmFsaWQoY2FuZGlkYXRlLCBhc3NlcnRDaGVja2VyKTtcbiAgaGVscGVyLmFzc2VydFJlc3RWYWxpZChjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIpO1xufTtcbnZhciBtYWtlUGFzc1N0eWxlT2YgPSAocGFzc1N0eWxlSGVscGVycykgPT4ge1xuICBjb25zdCBIZWxwZXJUYWJsZSA9IG1ha2VIZWxwZXJUYWJsZShwYXNzU3R5bGVIZWxwZXJzKTtcbiAgY29uc3QgcmVtb3RhYmxlSGVscGVyID0gSGVscGVyVGFibGUucmVtb3RhYmxlO1xuICBjb25zdCBwYXNzU3R5bGVNZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IHBhc3NTdHlsZU9mMiA9IChwYXNzYWJsZSkgPT4ge1xuICAgIGNvbnN0IGluUHJvZ3Jlc3MgPSAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICAgIGNvbnN0IHBhc3NTdHlsZU9mUmVjdXIgPSAoaW5uZXIpID0+IHtcbiAgICAgIGNvbnN0IGlubmVySXNPYmplY3QgPSBpc09iamVjdDIoaW5uZXIpO1xuICAgICAgaWYgKGlubmVySXNPYmplY3QpIHtcbiAgICAgICAgY29uc3QgaW5uZXJTdHlsZSA9IHBhc3NTdHlsZU1lbW8uZ2V0KGlubmVyKTtcbiAgICAgICAgaWYgKGlubmVyU3R5bGUpIHtcbiAgICAgICAgICByZXR1cm4gaW5uZXJTdHlsZTtcbiAgICAgICAgfVxuICAgICAgICAhaW5Qcm9ncmVzcy5oYXMoaW5uZXIpIHx8IHRocm93UmVkYWN0ZWRgUGFzcy1ieS1jb3B5IGRhdGEgY2Fubm90IGJlIGN5Y2xpYyAke2lubmVyfWA7XG4gICAgICAgIGluUHJvZ3Jlc3MuYWRkKGlubmVyKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mSW50ZXJuYWwoaW5uZXIpO1xuICAgICAgaWYgKGlubmVySXNPYmplY3QpIHtcbiAgICAgICAgcGFzc1N0eWxlTWVtby5zZXQoaW5uZXIsIHBhc3NTdHlsZSk7XG4gICAgICAgIGluUHJvZ3Jlc3MuZGVsZXRlKGlubmVyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXNzU3R5bGU7XG4gICAgfTtcbiAgICBjb25zdCBwYXNzU3R5bGVPZkludGVybmFsID0gKGlubmVyKSA9PiB7XG4gICAgICBjb25zdCB0eXBlc3RyID0gdHlwZW9mIGlubmVyO1xuICAgICAgc3dpdGNoICh0eXBlc3RyKSB7XG4gICAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjpcbiAgICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgICByZXR1cm4gdHlwZXN0cjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic3RyaW5nXCI6IHtcbiAgICAgICAgICBhc3NlcnRQYXNzYWJsZVN0cmluZyhpbm5lcik7XG4gICAgICAgICAgcmV0dXJuIFwic3RyaW5nXCI7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICAgICAgYXNzZXJ0UGFzc2FibGVTeW1ib2woaW5uZXIpO1xuICAgICAgICAgIHJldHVybiBcInN5bWJvbFwiO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJvYmplY3RcIjoge1xuICAgICAgICAgIGlmIChpbm5lciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIFwibnVsbFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWlzRnJvemVuNShpbm5lcikpIHtcbiAgICAgICAgICAgIGFzc2VydC5mYWlsKFxuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBpc1R5cGVkQXJyYXkoaW5uZXIpID8gcmVkYWN0ZWRgQ2Fubm90IHBhc3MgbXV0YWJsZSB0eXBlZCBhcnJheXMgbGlrZSAke2lubmVyfS5gIDogcmVkYWN0ZWRgQ2Fubm90IHBhc3Mgbm9uLWZyb3plbiBvYmplY3RzIGxpa2UgJHtpbm5lcn0uIFVzZSBoYXJkZW4oKWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChpc1Byb21pc2UoaW5uZXIpKSB7XG4gICAgICAgICAgICBhc3NlcnRTYWZlUHJvbWlzZShpbm5lcik7XG4gICAgICAgICAgICByZXR1cm4gXCJwcm9taXNlXCI7XG4gICAgICAgICAgfVxuICAgICAgICAgIHR5cGVvZiBpbm5lci50aGVuICE9PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcGFzcyBub24tcHJvbWlzZSB0aGVuYWJsZXNgO1xuICAgICAgICAgIGNvbnN0IHBhc3NTdHlsZVRhZyA9IGlubmVyW1BBU1NfU1RZTEVdO1xuICAgICAgICAgIGlmIChwYXNzU3R5bGVUYWcgIT09IHZvaWQgMCkge1xuICAgICAgICAgICAgYXNzZXJ0LnR5cGVvZihwYXNzU3R5bGVUYWcsIFwic3RyaW5nXCIpO1xuICAgICAgICAgICAgY29uc3QgaGVscGVyID0gSGVscGVyVGFibGVbcGFzc1N0eWxlVGFnXTtcbiAgICAgICAgICAgIGhlbHBlciAhPT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIFBhc3NTdHlsZTogJHtxdW90ZShwYXNzU3R5bGVUYWcpfWA7XG4gICAgICAgICAgICBhc3NlcnRWYWxpZChoZWxwZXIsIGlubmVyLCBwYXNzU3R5bGVPZlJlY3VyKTtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICBwYXNzU3R5bGVUYWdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAoY29uc3QgaGVscGVyIG9mIHBhc3NTdHlsZUhlbHBlcnMpIHtcbiAgICAgICAgICAgIGlmIChoZWxwZXIuY2FuQmVWYWxpZChpbm5lcikpIHtcbiAgICAgICAgICAgICAgaGVscGVyLmFzc2VydFJlc3RWYWxpZChpbm5lciwgcGFzc1N0eWxlT2ZSZWN1cik7XG4gICAgICAgICAgICAgIHJldHVybiBoZWxwZXIuc3R5bGVOYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBhc3NlcnRWYWxpZChyZW1vdGFibGVIZWxwZXIsIGlubmVyLCBwYXNzU3R5bGVPZlJlY3VyKTtcbiAgICAgICAgICByZXR1cm4gXCJyZW1vdGFibGVcIjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiZnVuY3Rpb25cIjoge1xuICAgICAgICAgIGlzRnJvemVuNShpbm5lcikgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcGFzcyBub24tZnJvemVuIG9iamVjdHMgbGlrZSAke2lubmVyfS4gVXNlIGhhcmRlbigpYDtcbiAgICAgICAgICB0eXBlb2YgaW5uZXIudGhlbiAhPT0gXCJmdW5jdGlvblwiIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHBhc3Mgbm9uLXByb21pc2UgdGhlbmFibGVzYDtcbiAgICAgICAgICBhc3NlcnRWYWxpZChyZW1vdGFibGVIZWxwZXIsIGlubmVyLCBwYXNzU3R5bGVPZlJlY3VyKTtcbiAgICAgICAgICByZXR1cm4gXCJyZW1vdGFibGVcIjtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwocmVkYWN0ZWRgVW5yZWNvZ25pemVkIHR5cGVvZiAke3F1b3RlKHR5cGVzdHIpfWAsIFR5cGVFcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBwYXNzU3R5bGVPZlJlY3VyKHBhc3NhYmxlKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbihwYXNzU3R5bGVPZjIpO1xufTtcbnZhciBQYXNzU3R5bGVPZkVuZG93bWVudFN5bWJvbCA9IFN5bWJvbC5mb3IoXCJAZW5kbyBwYXNzU3R5bGVPZlwiKTtcbnZhciBwYXNzU3R5bGVPZiA9IGdsb2JhbFRoaXMgJiYgZ2xvYmFsVGhpc1tQYXNzU3R5bGVPZkVuZG93bWVudFN5bWJvbF0gfHwgbWFrZVBhc3NTdHlsZU9mKFtcbiAgQ29weUFycmF5SGVscGVyLFxuICBDb3B5UmVjb3JkSGVscGVyLFxuICBUYWdnZWRIZWxwZXIsXG4gIEVycm9ySGVscGVyLFxuICBSZW1vdGFibGVIZWxwZXJcbl0pO1xudmFyIGFzc2VydFBhc3NhYmxlID0gKHZhbCkgPT4ge1xuICBwYXNzU3R5bGVPZih2YWwpO1xufTtcbmhhcmRlbihhc3NlcnRQYXNzYWJsZSk7XG52YXIgaXNQYXNzYWJsZSA9IChzcGVjaW1lbikgPT4ge1xuICB0cnkge1xuICAgIHJldHVybiBwYXNzU3R5bGVPZihzcGVjaW1lbikgIT09IHZvaWQgMDtcbiAgfSBjYXRjaCAoXykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcbmhhcmRlbihpc1Bhc3NhYmxlKTtcbnZhciBpc1Bhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MgPSAobmFtZSwgZGVzYykgPT4gY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MobmFtZSwgZGVzYywgcGFzc1N0eWxlT2YpO1xudmFyIHRvUGFzc2FibGVFcnJvciA9IChlcnIpID0+IHtcbiAgaGFyZGVuKGVycik7XG4gIGlmIChjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvcihlcnIsIHBhc3NTdHlsZU9mKSkge1xuICAgIHJldHVybiBlcnI7XG4gIH1cbiAgY29uc3QgeyBuYW1lLCBtZXNzYWdlIH0gPSBlcnI7XG4gIGNvbnN0IHsgY2F1c2U6IGNhdXNlRGVzYywgZXJyb3JzOiBlcnJvcnNEZXNjIH0gPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNShlcnIpO1xuICBsZXQgY2F1c2U7XG4gIGxldCBlcnJvcnM7XG4gIGlmIChjYXVzZURlc2MgJiYgaXNQYXNzYWJsZUVycm9yUHJvcGVydHlEZXNjKFwiY2F1c2VcIiwgY2F1c2VEZXNjKSkge1xuICAgIGNhdXNlID0gY2F1c2VEZXNjLnZhbHVlO1xuICB9XG4gIGlmIChlcnJvcnNEZXNjICYmIGlzUGFzc2FibGVFcnJvclByb3BlcnR5RGVzYyhcImVycm9yc1wiLCBlcnJvcnNEZXNjKSkge1xuICAgIGVycm9ycyA9IGVycm9yc0Rlc2MudmFsdWU7XG4gIH1cbiAgY29uc3QgZXJyQ29uc3RydWN0b3IgPSBnZXRFcnJvckNvbnN0cnVjdG9yKGAke25hbWV9YCkgfHwgRXJyb3I7XG4gIGNvbnN0IG5ld0Vycm9yID0gbWFrZUVycm9yKGAke21lc3NhZ2V9YCwgZXJyQ29uc3RydWN0b3IsIHtcbiAgICAvL1xuICAgIGNhdXNlLFxuICAgIGVycm9yc1xuICB9KTtcbiAgaGFyZGVuKG5ld0Vycm9yKTtcbiAgbm90ZShuZXdFcnJvciwgcmVkYWN0ZWRgY29waWVkIGZyb20gZXJyb3IgJHtlcnJ9YCk7XG4gIHBhc3NTdHlsZU9mKG5ld0Vycm9yKSA9PT0gXCJlcnJvclwiIHx8IHRocm93UmVkYWN0ZWRgRXhwZWN0ZWQgJHtuZXdFcnJvcn0gdG8gYmUgYSBwYXNzYWJsZSBlcnJvcmA7XG4gIHJldHVybiBuZXdFcnJvcjtcbn07XG5oYXJkZW4odG9QYXNzYWJsZUVycm9yKTtcbnZhciB0b1Rocm93YWJsZSA9IChzcGVjaW1lbikgPT4ge1xuICBoYXJkZW4oc3BlY2ltZW4pO1xuICBpZiAoaXNFcnJvckxpa2Uoc3BlY2ltZW4pKSB7XG4gICAgcmV0dXJuIHRvUGFzc2FibGVFcnJvcihcbiAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICBzcGVjaW1lblxuICAgICk7XG4gIH1cbiAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2Yoc3BlY2ltZW4pO1xuICBpZiAoaXNPYmplY3QyKHNwZWNpbWVuKSkge1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgc3BlY2ltZW5cbiAgICAgICAgKTtcbiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7XG4gICAgICAgICAgZWxlbWVudCA9PT0gdG9UaHJvd2FibGUoZWxlbWVudCkgfHwgdGhyb3dSZWRhY3RlZGBuZXN0ZWQgdG9UaHJvd2FibGUgY29lcmNpb24gbm90IHlldCBzdXBwb3J0ZWQgJHtlbGVtZW50fWA7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGNvbnN0IHJlYyA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgc3BlY2ltZW5cbiAgICAgICAgKTtcbiAgICAgICAgZm9yIChjb25zdCB2YWwgb2YgdmFsdWVzKHJlYykpIHtcbiAgICAgICAgICB2YWwgPT09IHRvVGhyb3dhYmxlKHZhbCkgfHwgdGhyb3dSZWRhY3RlZGBuZXN0ZWQgdG9UaHJvd2FibGUgY29lcmNpb24gbm90IHlldCBzdXBwb3J0ZWQgJHt2YWx9YDtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICBjb25zdCB0ZyA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgc3BlY2ltZW5cbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgeyBwYXlsb2FkIH0gPSB0ZztcbiAgICAgICAgcGF5bG9hZCA9PT0gdG9UaHJvd2FibGUocGF5bG9hZCkgfHwgdGhyb3dSZWRhY3RlZGBuZXN0ZWQgdG9UaHJvd2FibGUgY29lcmNpb24gbm90IHlldCBzdXBwb3J0ZWQgJHtwYXlsb2FkfWA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgY29uc3QgZXIgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBzcGVjaW1lblxuICAgICAgICApO1xuICAgICAgICBlciA9PT0gdG9UaHJvd2FibGUoZXIpIHx8IHRocm93UmVkYWN0ZWRgbmVzdGVkIHRvVGhyb3dhYmxlIGNvZXJjaW9uIG5vdCB5ZXQgc3VwcG9ydGVkICR7ZXJ9YDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgQSAke3F1b3RlKHBhc3NTdHlsZSl9IGlzIG5vdCB0aHJvd2FibGU6ICR7c3BlY2ltZW59YDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBzcGVjaW1lblxuICApO1xufTtcbmhhcmRlbih0b1Rocm93YWJsZSk7XG5cbi8vXG52YXIgeyBjcmVhdGU6IGNyZWF0ZTIsIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlNSB9ID0gT2JqZWN0O1xudmFyIG1ha2VUYWdnZWQgPSAodGFnLCBwYXlsb2FkKSA9PiB7XG4gIHR5cGVvZiB0YWcgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBUaGUgdGFnIG9mIGEgdGFnZ2VkIHJlY29yZCBtdXN0IGJlIGEgc3RyaW5nOiAke3RhZ31gO1xuICBhc3NlcnRQYXNzYWJsZShoYXJkZW4ocGF5bG9hZCkpO1xuICByZXR1cm4gaGFyZGVuKFxuICAgIGNyZWF0ZTIob2JqZWN0UHJvdG90eXBlNSwge1xuICAgICAgW1BBU1NfU1RZTEVdOiB7IHZhbHVlOiBcInRhZ2dlZFwiIH0sXG4gICAgICBbU3ltYm9sLnRvU3RyaW5nVGFnXTogeyB2YWx1ZTogdGFnIH0sXG4gICAgICBwYXlsb2FkOiB7IHZhbHVlOiBwYXlsb2FkLCBlbnVtZXJhYmxlOiB0cnVlIH1cbiAgICB9KVxuICApO1xufTtcbmhhcmRlbihtYWtlVGFnZ2VkKTtcblxuLy9cbnZhciBpc0NvcHlBcnJheSA9IChhcnIpID0+IHBhc3NTdHlsZU9mKGFycikgPT09IFwiY29weUFycmF5XCI7XG5oYXJkZW4oaXNDb3B5QXJyYXkpO1xudmFyIGlzUmVjb3JkID0gKHJlY29yZCkgPT4gcGFzc1N0eWxlT2YocmVjb3JkKSA9PT0gXCJjb3B5UmVjb3JkXCI7XG5oYXJkZW4oaXNSZWNvcmQpO1xudmFyIGlzUmVtb3RhYmxlID0gKHJlbW90YWJsZSkgPT4gcGFzc1N0eWxlT2YocmVtb3RhYmxlKSA9PT0gXCJyZW1vdGFibGVcIjtcbmhhcmRlbihpc1JlbW90YWJsZSk7XG52YXIgYXNzZXJ0Q29weUFycmF5ID0gKGFyciwgb3B0TmFtZU9mQXJyYXkgPSBcIkFsbGVnZWQgYXJyYXlcIikgPT4ge1xuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihhcnIpO1xuICBwYXNzU3R5bGUgPT09IFwiY29weUFycmF5XCIgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKG9wdE5hbWVPZkFycmF5KX0gJHthcnJ9IG11c3QgYmUgYSBwYXNzLWJ5LWNvcHkgYXJyYXksIG5vdCAke3F1b3RlKFxuICAgIHBhc3NTdHlsZVxuICApfWA7XG59O1xuaGFyZGVuKGFzc2VydENvcHlBcnJheSk7XG52YXIgYXNzZXJ0UmVjb3JkID0gKHJlY29yZCwgb3B0TmFtZU9mUmVjb3JkID0gXCJBbGxlZ2VkIHJlY29yZFwiKSA9PiB7XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHJlY29yZCk7XG4gIHBhc3NTdHlsZSA9PT0gXCJjb3B5UmVjb3JkXCIgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKG9wdE5hbWVPZlJlY29yZCl9ICR7cmVjb3JkfSBtdXN0IGJlIGEgcGFzcy1ieS1jb3B5IHJlY29yZCwgbm90ICR7cXVvdGUoXG4gICAgcGFzc1N0eWxlXG4gICl9YDtcbn07XG5oYXJkZW4oYXNzZXJ0UmVjb3JkKTtcbnZhciBhc3NlcnRSZW1vdGFibGUgPSAocmVtb3RhYmxlLCBvcHROYW1lT2ZSZW1vdGFibGUgPSBcIkFsbGVnZWQgcmVtb3RhYmxlXCIpID0+IHtcbiAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocmVtb3RhYmxlKTtcbiAgcGFzc1N0eWxlID09PSBcInJlbW90YWJsZVwiIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShvcHROYW1lT2ZSZW1vdGFibGUpfSAke3JlbW90YWJsZX0gbXVzdCBiZSBhIHJlbW90YWJsZSwgbm90ICR7cXVvdGUoXG4gICAgcGFzc1N0eWxlXG4gICl9YDtcbn07XG5oYXJkZW4oYXNzZXJ0UmVtb3RhYmxlKTtcblxuLy9cbnZhciBoaWRkZW5QcmlvckVycm9yO1xudmFyIGhpZGRlbkN1cnJlbnRUdXJuID0gMDtcbnZhciBoaWRkZW5DdXJyZW50RXZlbnQgPSAwO1xudmFyIFZFUkJPU0UgPSBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzKFwiREVCVUdcIiwgXCJ0cmFjay10dXJuc1wiKTtcbnZhciBFTkFCTEVEID0gZ2V0RW52aXJvbm1lbnRPcHRpb24oXCJUUkFDS19UVVJOU1wiLCBcImRpc2FibGVkXCIsIFtcImVuYWJsZWRcIl0pID09PSBcImVuYWJsZWRcIjtcbnZhciBhZGRSZWplY3Rpb25Ob3RlID0gKGRldGFpbHNOb3RlKSA9PiAocmVhc29uKSA9PiB7XG4gIGlmIChyZWFzb24gaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIGdsb2JhbFRoaXMuYXNzZXJ0Lm5vdGUocmVhc29uLCBkZXRhaWxzTm90ZSk7XG4gIH1cbiAgaWYgKFZFUkJPU0UpIHtcbiAgICBjb25zb2xlLmxvZyhcIlJFSkVDVEVEIGF0IHRvcCBvZiBldmVudCBsb29wXCIsIHJlYXNvbik7XG4gIH1cbn07XG52YXIgd3JhcEZ1bmN0aW9uID0gKGZ1bmMsIHNlbmRpbmdFcnJvciwgWDUpID0+ICguLi5hcmdzKSA9PiB7XG4gIGhpZGRlblByaW9yRXJyb3IgPSBzZW5kaW5nRXJyb3I7XG4gIGhpZGRlbkN1cnJlbnRUdXJuICs9IDE7XG4gIGhpZGRlbkN1cnJlbnRFdmVudCA9IDA7XG4gIHRyeSB7XG4gICAgbGV0IHJlc3VsdDtcbiAgICB0cnkge1xuICAgICAgcmVzdWx0ID0gZnVuYyguLi5hcmdzKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICBnbG9iYWxUaGlzLmFzc2VydC5ub3RlKFxuICAgICAgICAgIGVycixcbiAgICAgICAgICBYNWBUaHJvd24gZnJvbTogJHtoaWRkZW5QcmlvckVycm9yfToke2hpZGRlbkN1cnJlbnRUdXJufS4ke2hpZGRlbkN1cnJlbnRFdmVudH1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoVkVSQk9TRSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlRIUk9XTiB0byB0b3Agb2YgZXZlbnQgbG9vcFwiLCBlcnIpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICBjb25zdCBkZXRhaWxzTm90ZSA9IFg1YFJlamVjdGlvbiBmcm9tOiAke2hpZGRlblByaW9yRXJyb3J9OiR7aGlkZGVuQ3VycmVudFR1cm59LiR7aGlkZGVuQ3VycmVudEV2ZW50fWA7XG4gICAgUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCkuY2F0Y2goYWRkUmVqZWN0aW9uTm90ZShkZXRhaWxzTm90ZSkpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH0gZmluYWxseSB7XG4gICAgaGlkZGVuUHJpb3JFcnJvciA9IHZvaWQgMDtcbiAgfVxufTtcbnZhciB0cmFja1R1cm5zID0gKGZ1bmNzKSA9PiB7XG4gIGlmICghRU5BQkxFRCB8fCB0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gXCJ1bmRlZmluZWRcIiB8fCAhZ2xvYmFsVGhpcy5hc3NlcnQpIHtcbiAgICByZXR1cm4gZnVuY3M7XG4gIH1cbiAgY29uc3QgeyBkZXRhaWxzOiBYNSwgbm90ZTogYW5ub3RhdGVFcnJvciB9ID0gZ2xvYmFsVGhpcy5hc3NlcnQ7XG4gIGhpZGRlbkN1cnJlbnRFdmVudCArPSAxO1xuICBjb25zdCBzZW5kaW5nRXJyb3IgPSBFcnJvcihcbiAgICBgRXZlbnQ6ICR7aGlkZGVuQ3VycmVudFR1cm59LiR7aGlkZGVuQ3VycmVudEV2ZW50fWBcbiAgKTtcbiAgaWYgKGhpZGRlblByaW9yRXJyb3IgIT09IHZvaWQgMCkge1xuICAgIGFubm90YXRlRXJyb3Ioc2VuZGluZ0Vycm9yLCBYNWBDYXVzZWQgYnk6ICR7aGlkZGVuUHJpb3JFcnJvcn1gKTtcbiAgfVxuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICBmdW5jcy5tYXAoKGZ1bmMpID0+IGZ1bmMgJiYgd3JhcEZ1bmN0aW9uKGZ1bmMsIHNlbmRpbmdFcnJvciwgWDUpKVxuICApO1xufTtcblxuLy9cbnZhciB7IGRldGFpbHM6IFgyLCBxdW90ZTogcTQsIEZhaWw6IEZhaWw0LCBlcnJvcjogbWFrZUVycm9yMiB9ID0gYXNzZXJ0O1xudmFyIHsgYXNzaWduLCBmcmVlemU6IGZyZWV6ZTQgfSA9IE9iamVjdDtcbnZhciBvblNlbmQgPSBtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIoXCJFTkRPX1NFTkRfQlJFQUtQT0lOVFNcIik7XG52YXIgYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlciA9IHtcbiAgc2V0KF90YXJnZXQsIF9wcm9wLCBfdmFsdWUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIGlzRXh0ZW5zaWJsZShfdGFyZ2V0KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBzZXRQcm90b3R5cGVPZihfdGFyZ2V0LCBfdmFsdWUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIGRlbGV0ZVByb3BlcnR5KF90YXJnZXQsIF9wcm9wKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xudmFyIG1ha2VFUHJveHlIYW5kbGVyID0gKHJlY2lwaWVudCwgSGFuZGxlZFByb21pc2UyKSA9PiBoYXJkZW4oe1xuICAuLi5iYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyLFxuICBnZXQ6IChfdGFyZ2V0LCBwcm9wZXJ0eUtleSwgcmVjZWl2ZXIpID0+IHtcbiAgICByZXR1cm4gaGFyZGVuKFxuICAgICAge1xuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgW3Byb3BlcnR5S2V5XSguLi5hcmdzKSB7XG4gICAgICAgICAgaWYgKHRoaXMgIT09IHJlY2VpdmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gSGFuZGxlZFByb21pc2UyLnJlamVjdChcbiAgICAgICAgICAgICAgbWFrZUVycm9yMihcbiAgICAgICAgICAgICAgICBYMmBVbmV4cGVjdGVkIHJlY2VpdmVyIGZvciBcIiR7cTQocHJvcGVydHlLZXkpfVwiIG1ldGhvZCBvZiBFKCR7cTQoXG4gICAgICAgICAgICAgICAgICByZWNpcGllbnRcbiAgICAgICAgICAgICAgICApfSlgXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvblNlbmQgJiYgb25TZW5kLnNob3VsZEJyZWFrcG9pbnQocmVjaXBpZW50LCBwcm9wZXJ0eUtleSkpIHtcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gSGFuZGxlZFByb21pc2UyLmFwcGx5TWV0aG9kKHJlY2lwaWVudCwgcHJvcGVydHlLZXksIGFyZ3MpO1xuICAgICAgICB9XG4gICAgICAgIC8vXG4gICAgICB9W3Byb3BlcnR5S2V5XVxuICAgICk7XG4gIH0sXG4gIGFwcGx5OiAoX3RhcmdldCwgX3RoaXNBcmcsIGFyZ0FycmF5ID0gW10pID0+IHtcbiAgICBpZiAob25TZW5kICYmIG9uU2VuZC5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgdm9pZCAwKSkge1xuICAgICAgZGVidWdnZXI7XG4gICAgfVxuICAgIHJldHVybiBIYW5kbGVkUHJvbWlzZTIuYXBwbHlGdW5jdGlvbihyZWNpcGllbnQsIGFyZ0FycmF5KTtcbiAgfSxcbiAgaGFzOiAoX3RhcmdldCwgX3ApID0+IHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufSk7XG52YXIgbWFrZUVTZW5kT25seVByb3h5SGFuZGxlciA9IChyZWNpcGllbnQsIEhhbmRsZWRQcm9taXNlMikgPT4gaGFyZGVuKHtcbiAgLi4uYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlcixcbiAgZ2V0OiAoX3RhcmdldCwgcHJvcGVydHlLZXksIHJlY2VpdmVyKSA9PiB7XG4gICAgcmV0dXJuIGhhcmRlbihcbiAgICAgIHtcbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgW3Byb3BlcnR5S2V5XSguLi5hcmdzKSB7XG4gICAgICAgICAgdGhpcyA9PT0gcmVjZWl2ZXIgfHwgRmFpbDRgVW5leHBlY3RlZCByZWNlaXZlciBmb3IgXCIke3E0KFxuICAgICAgICAgICAgcHJvcGVydHlLZXlcbiAgICAgICAgICApfVwiIG1ldGhvZCBvZiBFLnNlbmRPbmx5KCR7cTQocmVjaXBpZW50KX0pYDtcbiAgICAgICAgICBpZiAob25TZW5kICYmIG9uU2VuZC5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgcHJvcGVydHlLZXkpKSB7XG4gICAgICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgSGFuZGxlZFByb21pc2UyLmFwcGx5TWV0aG9kU2VuZE9ubHkocmVjaXBpZW50LCBwcm9wZXJ0eUtleSwgYXJncyk7XG4gICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgfVxuICAgICAgICAvL1xuICAgICAgfVtwcm9wZXJ0eUtleV1cbiAgICApO1xuICB9LFxuICBhcHBseTogKF90YXJnZXQsIF90aGlzQXJnLCBhcmdzQXJyYXkgPSBbXSkgPT4ge1xuICAgIGlmIChvblNlbmQgJiYgb25TZW5kLnNob3VsZEJyZWFrcG9pbnQocmVjaXBpZW50LCB2b2lkIDApKSB7XG4gICAgICBkZWJ1Z2dlcjtcbiAgICB9XG4gICAgSGFuZGxlZFByb21pc2UyLmFwcGx5RnVuY3Rpb25TZW5kT25seShyZWNpcGllbnQsIGFyZ3NBcnJheSk7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfSxcbiAgaGFzOiAoX3RhcmdldCwgX3ApID0+IHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufSk7XG52YXIgbWFrZUVHZXRQcm94eUhhbmRsZXIgPSAoeCwgSGFuZGxlZFByb21pc2UyKSA9PiBoYXJkZW4oe1xuICAuLi5iYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyLFxuICBoYXM6IChfdGFyZ2V0LCBfcHJvcCkgPT4gdHJ1ZSxcbiAgZ2V0OiAoX3RhcmdldCwgcHJvcCkgPT4gSGFuZGxlZFByb21pc2UyLmdldCh4LCBwcm9wKVxufSk7XG52YXIgZnVuY1RhcmdldCA9IGZyZWV6ZTQoKCkgPT4ge1xufSk7XG52YXIgb2JqVGFyZ2V0ID0gZnJlZXplNCh7IF9fcHJvdG9fXzogbnVsbCB9KTtcbnZhciBtYWtlRSA9IChIYW5kbGVkUHJvbWlzZTIpID0+IHtcbiAgcmV0dXJuIGhhcmRlbihcbiAgICBhc3NpZ24oXG4gICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICAvL1xuICAgICAgKHgpID0+IG5ldyBQcm94eShmdW5jVGFyZ2V0LCBtYWtlRVByb3h5SGFuZGxlcih4LCBIYW5kbGVkUHJvbWlzZTIpKSxcbiAgICAgIHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIC8vXG4gICAgICAgIGdldDogKHgpID0+IG5ldyBQcm94eShvYmpUYXJnZXQsIG1ha2VFR2V0UHJveHlIYW5kbGVyKHgsIEhhbmRsZWRQcm9taXNlMikpLFxuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICByZXNvbHZlOiBIYW5kbGVkUHJvbWlzZTIucmVzb2x2ZSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZE9ubHk6ICh4KSA9PiAoXG4gICAgICAgICAgLy9cbiAgICAgICAgICBuZXcgUHJveHkoZnVuY1RhcmdldCwgbWFrZUVTZW5kT25seVByb3h5SGFuZGxlcih4LCBIYW5kbGVkUHJvbWlzZTIpKVxuICAgICAgICApLFxuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICB3aGVuOiAoeCwgb25mdWxmaWxsZWQsIG9ucmVqZWN0ZWQpID0+IEhhbmRsZWRQcm9taXNlMi5yZXNvbHZlKHgpLnRoZW4oXG4gICAgICAgICAgLi4udHJhY2tUdXJucyhbb25mdWxmaWxsZWQsIG9ucmVqZWN0ZWRdKVxuICAgICAgICApXG4gICAgICB9XG4gICAgKVxuICApO1xufTtcbnZhciBFX2RlZmF1bHQgPSBtYWtlRTtcblxuLy9cbnZhciBocCA9IEhhbmRsZWRQcm9taXNlO1xudmFyIEUgPSBFX2RlZmF1bHQoaHApO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czkgfSA9IFJlZmxlY3Q7XG52YXIgeyBmcm9tRW50cmllcyB9ID0gT2JqZWN0O1xudmFyIGRlZXBseUZ1bGZpbGxlZCA9IGFzeW5jICh2YWwpID0+IHtcbiAgaWYgKCFpc09iamVjdDIodmFsKSkge1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICB2YWxcbiAgICApO1xuICB9XG4gIGlmIChpc1Byb21pc2UodmFsKSkge1xuICAgIHJldHVybiBFLndoZW4odmFsLCAobm9ucCkgPT4gZGVlcGx5RnVsZmlsbGVkKG5vbnApKTtcbiAgfVxuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZih2YWwpO1xuICBzd2l0Y2ggKHBhc3NTdHlsZSkge1xuICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgIGNvbnN0IHJlYyA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB2YWxcbiAgICAgICk7XG4gICAgICBjb25zdCBuYW1lcyA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb3duS2V5czkocmVjKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHZhbFBzID0gbmFtZXMubWFwKChuYW1lKSA9PiBkZWVwbHlGdWxmaWxsZWQocmVjW25hbWVdKSk7XG4gICAgICByZXR1cm4gRS53aGVuKFxuICAgICAgICBQcm9taXNlLmFsbCh2YWxQcyksXG4gICAgICAgICh2YWxzKSA9PiBoYXJkZW4oZnJvbUVudHJpZXModmFscy5tYXAoKGMyLCBpMikgPT4gW25hbWVzW2kyXSwgYzJdKSkpXG4gICAgICApO1xuICAgIH1cbiAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgIGNvbnN0IGFyciA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZhbFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHZhbFBzID0gYXJyLm1hcCgocDMpID0+IGRlZXBseUZ1bGZpbGxlZChwMykpO1xuICAgICAgcmV0dXJuIEUud2hlbihQcm9taXNlLmFsbCh2YWxQcyksICh2YWxzKSA9PiBoYXJkZW4odmFscykpO1xuICAgIH1cbiAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgIGNvbnN0IHRnZCA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB2YWxcbiAgICAgICk7XG4gICAgICBjb25zdCB0YWcgPSBnZXRUYWcodGdkKTtcbiAgICAgIHJldHVybiBFLndoZW4oXG4gICAgICAgIGRlZXBseUZ1bGZpbGxlZCh0Z2QucGF5bG9hZCksXG4gICAgICAgIChwYXlsb2FkKSA9PiBtYWtlVGFnZ2VkKHRhZywgcGF5bG9hZClcbiAgICAgICk7XG4gICAgfVxuICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgY29uc3QgcmVtID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApO1xuICAgICAgcmV0dXJuIHJlbTtcbiAgICB9XG4gICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgIGNvbnN0IGVyciA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApO1xuICAgICAgcmV0dXJuIGVycjtcbiAgICB9XG4gICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgY29uc3QgcHJvbSA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZhbFxuICAgICAgKTtcbiAgICAgIHJldHVybiBFLndoZW4ocHJvbSwgKG5vbnApID0+IGRlZXBseUZ1bGZpbGxlZChub25wKSk7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHRocm93IGFzc2VydC5mYWlsKHJlZGFjdGVkYFVuZXhwZWN0ZWQgcGFzc1N0eWxlICR7cXVvdGUocGFzc1N0eWxlKX1gLCBUeXBlRXJyb3IpO1xuICAgIH1cbiAgfVxufTtcbmhhcmRlbihkZWVwbHlGdWxmaWxsZWQpO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czEwIH0gPSBSZWZsZWN0O1xudmFyIHsgaXNBcnJheTogaXNBcnJheTQgfSA9IEFycmF5O1xudmFyIHtcbiAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczYsXG4gIGRlZmluZVByb3BlcnRpZXMsXG4gIGlzLFxuICBlbnRyaWVzOiBlbnRyaWVzMyxcbiAgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMixcbiAgZnJlZXplOiBmcmVlemU1XG59ID0gT2JqZWN0O1xudmFyIFFDTEFTUyA9IFwiQHFjbGFzc1wiO1xudmFyIGhhc1FDbGFzcyA9IChlbmNvZGVkKSA9PiBoYXNPd25Qcm9wZXJ0eU9mKGVuY29kZWQsIFFDTEFTUyk7XG52YXIgcWNsYXNzTWF0Y2hlcyA9IChlbmNvZGVkLCBxY2xhc3MpID0+IGlzT2JqZWN0MihlbmNvZGVkKSAmJiAhaXNBcnJheTQoZW5jb2RlZCkgJiYgaGFzUUNsYXNzKGVuY29kZWQpICYmIGVuY29kZWRbUUNMQVNTXSA9PT0gcWNsYXNzO1xudmFyIGRvbnRFbmNvZGVSZW1vdGFibGVUb0NhcERhdGEgPSAocmVtKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke3JlbX1gO1xudmFyIGRvbnRFbmNvZGVQcm9taXNlVG9DYXBEYXRhID0gKHByb20pID0+IHRocm93UmVkYWN0ZWRgcHJvbWlzZSB1bmV4cGVjdGVkOiAke3Byb219YDtcbnZhciBkb250RW5jb2RlRXJyb3JUb0NhcERhdGEgPSAoZXJyKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIG9iamVjdCB1bmV4cGVjdGVkOiAke2Vycn1gO1xudmFyIG1ha2VFbmNvZGVUb0NhcERhdGEgPSAoZW5jb2RlT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBlbmNvZGVSZW1vdGFibGVUb0NhcERhdGEgPSBkb250RW5jb2RlUmVtb3RhYmxlVG9DYXBEYXRhLFxuICAgIGVuY29kZVByb21pc2VUb0NhcERhdGEgPSBkb250RW5jb2RlUHJvbWlzZVRvQ2FwRGF0YSxcbiAgICBlbmNvZGVFcnJvclRvQ2FwRGF0YSA9IGRvbnRFbmNvZGVFcnJvclRvQ2FwRGF0YVxuICB9ID0gZW5jb2RlT3B0aW9ucztcbiAgY29uc3QgZW5jb2RlVG9DYXBEYXRhUmVjdXIgPSAocGFzc2FibGUpID0+IHtcbiAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihwYXNzYWJsZSk7XG4gICAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICAgIGNhc2UgXCJudWxsXCI6XG4gICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgIHJldHVybiBwYXNzYWJsZTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjoge1xuICAgICAgICByZXR1cm4geyBbUUNMQVNTXTogXCJ1bmRlZmluZWRcIiB9O1xuICAgICAgfVxuICAgICAgY2FzZSBcIm51bWJlclwiOiB7XG4gICAgICAgIGlmIChOdW1iZXIuaXNOYU4ocGFzc2FibGUpKSB7XG4gICAgICAgICAgcmV0dXJuIHsgW1FDTEFTU106IFwiTmFOXCIgfTtcbiAgICAgICAgfSBlbHNlIGlmIChwYXNzYWJsZSA9PT0gSW5maW5pdHkpIHtcbiAgICAgICAgICByZXR1cm4geyBbUUNMQVNTXTogXCJJbmZpbml0eVwiIH07XG4gICAgICAgIH0gZWxzZSBpZiAocGFzc2FibGUgPT09IC1JbmZpbml0eSkge1xuICAgICAgICAgIHJldHVybiB7IFtRQ0xBU1NdOiBcIi1JbmZpbml0eVwiIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzKHBhc3NhYmxlLCAtMCkgPyAwIDogcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBbUUNMQVNTXTogXCJiaWdpbnRcIixcbiAgICAgICAgICBkaWdpdHM6IFN0cmluZyhwYXNzYWJsZSlcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgICBhc3NlcnRQYXNzYWJsZVN5bWJvbChwYXNzYWJsZSk7XG4gICAgICAgIGNvbnN0IG5hbWUgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgbmFtZUZvclBhc3NhYmxlU3ltYm9sKHBhc3NhYmxlKVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIFtRQ0xBU1NdOiBcInN5bWJvbFwiLFxuICAgICAgICAgIG5hbWVcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgaWYgKGhhc093blByb3BlcnR5T2YocGFzc2FibGUsIFFDTEFTUykpIHtcbiAgICAgICAgICBjb25zdCB7IFtRQ0xBU1NdOiBxY2xhc3NWYWx1ZSwgLi4ucmVzdCB9ID0gcGFzc2FibGU7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgICAgICAgW1FDTEFTU106IFwiaGlsYmVydFwiLFxuICAgICAgICAgICAgb3JpZ2luYWw6IGVuY29kZVRvQ2FwRGF0YVJlY3VyKHFjbGFzc1ZhbHVlKVxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYgKG93bktleXMxMChyZXN0KS5sZW5ndGggPj0gMSkge1xuICAgICAgICAgICAgcmVzdWx0LnJlc3QgPSBlbmNvZGVUb0NhcERhdGFSZWN1cihmcmVlemU1KHJlc3QpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuYW1lcyA9IG93bktleXMxMChwYXNzYWJsZSkuc29ydCgpO1xuICAgICAgICByZXR1cm4gZnJvbUVudHJpZXMyKFxuICAgICAgICAgIG5hbWVzLm1hcCgobmFtZSkgPT4gW25hbWUsIGVuY29kZVRvQ2FwRGF0YVJlY3VyKHBhc3NhYmxlW25hbWVdKV0pXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgcmV0dXJuIHBhc3NhYmxlLm1hcChlbmNvZGVUb0NhcERhdGFSZWN1cik7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBbUUNMQVNTXTogXCJ0YWdnZWRcIixcbiAgICAgICAgICB0YWc6IGdldFRhZyhwYXNzYWJsZSksXG4gICAgICAgICAgcGF5bG9hZDogZW5jb2RlVG9DYXBEYXRhUmVjdXIocGFzc2FibGUucGF5bG9hZClcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlUmVtb3RhYmxlVG9DYXBEYXRhKFxuICAgICAgICAgIHBhc3NhYmxlLFxuICAgICAgICAgIGVuY29kZVRvQ2FwRGF0YVJlY3VyXG4gICAgICAgICk7XG4gICAgICAgIGlmIChxY2xhc3NNYXRjaGVzKGVuY29kZWQsIFwic2xvdFwiKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGVkO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFJlbW90YWJsZSBlbmNvZGluZyBtdXN0IGJlIGFuIG9iamVjdCB3aXRoICR7cXVvdGUoXG4gICAgICAgICAgUUNMQVNTXG4gICAgICAgICl9ICR7cXVvdGUoXCJzbG90XCIpfTogJHtlbmNvZGVkfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVQcm9taXNlVG9DYXBEYXRhKHBhc3NhYmxlLCBlbmNvZGVUb0NhcERhdGFSZWN1cik7XG4gICAgICAgIGlmIChxY2xhc3NNYXRjaGVzKGVuY29kZWQsIFwic2xvdFwiKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGVkO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFByb21pc2UgZW5jb2RpbmcgbXVzdCBiZSBhbiBvYmplY3Qgd2l0aCAke3F1b3RlKFxuICAgICAgICAgIFFDTEFTUyxcbiAgICAgICAgICBcInNsb3RcIlxuICAgICAgICApfTogJHtlbmNvZGVkfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlRXJyb3JUb0NhcERhdGEocGFzc2FibGUsIGVuY29kZVRvQ2FwRGF0YVJlY3VyKTtcbiAgICAgICAgaWYgKHFjbGFzc01hdGNoZXMoZW5jb2RlZCwgXCJlcnJvclwiKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGVkO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IEVycm9yIGVuY29kaW5nIG11c3QgYmUgYW4gb2JqZWN0IHdpdGggJHtxdW90ZShcbiAgICAgICAgICBRQ0xBU1MsXG4gICAgICAgICAgXCJlcnJvclwiXG4gICAgICAgICl9OiAke2VuY29kZWR9YDtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgcmVkYWN0ZWRgaW50ZXJuYWw6IFVucmVjb2duaXplZCBwYXNzU3R5bGUgJHtxdW90ZShwYXNzU3R5bGUpfWAsXG4gICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBlbmNvZGVUb0NhcERhdGEgPSAocGFzc2FibGUpID0+IHtcbiAgICBpZiAoaXNFcnJvckxpa2UocGFzc2FibGUpKSB7XG4gICAgICByZXR1cm4gaGFyZGVuKGVuY29kZUVycm9yVG9DYXBEYXRhKHBhc3NhYmxlLCBlbmNvZGVUb0NhcERhdGFSZWN1cikpO1xuICAgIH1cbiAgICByZXR1cm4gaGFyZGVuKGVuY29kZVRvQ2FwRGF0YVJlY3VyKHBhc3NhYmxlKSk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oZW5jb2RlVG9DYXBEYXRhKTtcbn07XG5oYXJkZW4obWFrZUVuY29kZVRvQ2FwRGF0YSk7XG52YXIgZG9udERlY29kZVJlbW90YWJsZU9yUHJvbWlzZUZyb21DYXBEYXRhID0gKHNsb3RFbmNvZGluZykgPT4gdGhyb3dSZWRhY3RlZGByZW1vdGFibGUgb3IgcHJvbWlzZSB1bmV4cGVjdGVkOiAke3Nsb3RFbmNvZGluZ31gO1xudmFyIGRvbnREZWNvZGVFcnJvckZyb21DYXBEYXRhID0gKGVycm9yRW5jb2RpbmcpID0+IHRocm93UmVkYWN0ZWRgZXJyb3IgdW5leHBlY3RlZDogJHtlcnJvckVuY29kaW5nfWA7XG52YXIgbWFrZURlY29kZUZyb21DYXBEYXRhID0gKGRlY29kZU9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgZGVjb2RlUmVtb3RhYmxlRnJvbUNhcERhdGEgPSBkb250RGVjb2RlUmVtb3RhYmxlT3JQcm9taXNlRnJvbUNhcERhdGEsXG4gICAgZGVjb2RlUHJvbWlzZUZyb21DYXBEYXRhID0gZG9udERlY29kZVJlbW90YWJsZU9yUHJvbWlzZUZyb21DYXBEYXRhLFxuICAgIGRlY29kZUVycm9yRnJvbUNhcERhdGEgPSBkb250RGVjb2RlRXJyb3JGcm9tQ2FwRGF0YVxuICB9ID0gZGVjb2RlT3B0aW9ucztcbiAgZGVjb2RlUmVtb3RhYmxlRnJvbUNhcERhdGEgPT09IGRlY29kZVByb21pc2VGcm9tQ2FwRGF0YSB8fCB0aHJvd1JlZGFjdGVkYEFuIGltcGxlbWVudGF0aW9uIHJlc3RyaWN0aW9uIGZvciBub3c6IElmIGVpdGhlciBkZWNvZGVSZW1vdGFibGVGcm9tQ2FwRGF0YSBvciBkZWNvZGVQcm9taXNlRnJvbUNhcERhdGEgaXMgcHJvdmlkZWQsIGJvdGggbXVzdCBiZSBwcm92aWRlZCBhbmQgdGhleSBtdXN0IGJlIHRoZSBzYW1lOiAke3F1b3RlKFxuICAgIGRlY29kZVJlbW90YWJsZUZyb21DYXBEYXRhXG4gICl9IHZzICR7cXVvdGUoZGVjb2RlUHJvbWlzZUZyb21DYXBEYXRhKX1gO1xuICBjb25zdCBkZWNvZGVGcm9tQ2FwRGF0YSA9IChqc29uRW5jb2RlZCkgPT4ge1xuICAgIGlmICghaXNPYmplY3QyKGpzb25FbmNvZGVkKSkge1xuICAgICAgcmV0dXJuIGpzb25FbmNvZGVkO1xuICAgIH1cbiAgICBpZiAoaXNBcnJheTQoanNvbkVuY29kZWQpKSB7XG4gICAgICByZXR1cm4ganNvbkVuY29kZWQubWFwKChlbmNvZGVkVmFsKSA9PiBkZWNvZGVGcm9tQ2FwRGF0YShlbmNvZGVkVmFsKSk7XG4gICAgfSBlbHNlIGlmIChoYXNRQ2xhc3MoanNvbkVuY29kZWQpKSB7XG4gICAgICBjb25zdCBxY2xhc3MgPSBqc29uRW5jb2RlZFtRQ0xBU1NdO1xuICAgICAgdHlwZW9mIHFjbGFzcyA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGludmFsaWQgJHtxdW90ZShRQ0xBU1MpfSB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgcWNsYXNzKX1gO1xuICAgICAgc3dpdGNoIChxY2xhc3MpIHtcbiAgICAgICAgLy9cbiAgICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOiB7XG4gICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiTmFOXCI6IHtcbiAgICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJJbmZpbml0eVwiOiB7XG4gICAgICAgICAgcmV0dXJuIEluZmluaXR5O1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCItSW5maW5pdHlcIjoge1xuICAgICAgICAgIHJldHVybiAtSW5maW5pdHk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImJpZ2ludFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBkaWdpdHMgfSA9IGpzb25FbmNvZGVkO1xuICAgICAgICAgIHR5cGVvZiBkaWdpdHMgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGRpZ2l0cyB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgZGlnaXRzKX1gO1xuICAgICAgICAgIHJldHVybiBCaWdJbnQoZGlnaXRzKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiQEBhc3luY0l0ZXJhdG9yXCI6IHtcbiAgICAgICAgICByZXR1cm4gU3ltYm9sLmFzeW5jSXRlcmF0b3I7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSBqc29uRW5jb2RlZDtcbiAgICAgICAgICByZXR1cm4gcGFzc2FibGVTeW1ib2xGb3JOYW1lKG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgdGFnLCBwYXlsb2FkIH0gPSBqc29uRW5jb2RlZDtcbiAgICAgICAgICByZXR1cm4gbWFrZVRhZ2dlZCh0YWcsIGRlY29kZUZyb21DYXBEYXRhKHBheWxvYWQpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic2xvdFwiOiB7XG4gICAgICAgICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZVJlbW90YWJsZUZyb21DYXBEYXRhKFxuICAgICAgICAgICAganNvbkVuY29kZWQsXG4gICAgICAgICAgICBkZWNvZGVGcm9tQ2FwRGF0YVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGRlY29kZWQ7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgICBjb25zdCBkZWNvZGVkID0gZGVjb2RlRXJyb3JGcm9tQ2FwRGF0YShcbiAgICAgICAgICAgIGpzb25FbmNvZGVkLFxuICAgICAgICAgICAgZGVjb2RlRnJvbUNhcERhdGFcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChwYXNzU3R5bGVPZihkZWNvZGVkKSA9PT0gXCJlcnJvclwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZGVjb2RlZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogZGVjb2RlRXJyb3JGcm9tQ2FwRGF0YSBvcHRpb24gbXVzdCByZXR1cm4gYW4gZXJyb3I6ICR7ZGVjb2RlZH1gO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJoaWxiZXJ0XCI6IHtcbiAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsLCByZXN0IH0gPSBqc29uRW5jb2RlZDtcbiAgICAgICAgICBoYXNPd25Qcm9wZXJ0eU9mKGpzb25FbmNvZGVkLCBcIm9yaWdpbmFsXCIpIHx8IHRocm93UmVkYWN0ZWRgSW52YWxpZCBIaWxiZXJ0IEhvdGVsIGVuY29kaW5nICR7anNvbkVuY29kZWR9YDtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSB7IFtRQ0xBU1NdOiBkZWNvZGVGcm9tQ2FwRGF0YShvcmlnaW5hbCkgfTtcbiAgICAgICAgICBpZiAoaGFzT3duUHJvcGVydHlPZihqc29uRW5jb2RlZCwgXCJyZXN0XCIpKSB7XG4gICAgICAgICAgICBjb25zdCBpc05vbkVtcHR5T2JqZWN0ID0gdHlwZW9mIHJlc3QgPT09IFwib2JqZWN0XCIgJiYgcmVzdCAhPT0gbnVsbCAmJiBvd25LZXlzMTAocmVzdCkubGVuZ3RoID49IDE7XG4gICAgICAgICAgICBpZiAoIWlzTm9uRW1wdHlPYmplY3QpIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN0IGVuY29kaW5nIG11c3QgYmUgYSBub24tZW1wdHkgb2JqZWN0OiAke3Jlc3R9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3RPYmogPSBkZWNvZGVGcm9tQ2FwRGF0YShyZXN0KTtcbiAgICAgICAgICAgICFoYXNPd25Qcm9wZXJ0eU9mKHJlc3RPYmosIFFDTEFTUykgfHwgdGhyb3dSZWRhY3RlZGBSZXN0IG11c3Qgbm90IGNvbnRhaW4gaXRzIG93biBkZWZpbml0aW9uIG9mICR7cXVvdGUoUUNMQVNTKX1gO1xuICAgICAgICAgICAgZGVmaW5lUHJvcGVydGllcyhyZXN1bHQsIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM2KHJlc3RPYmopKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICAvL1xuICAgICAgICBjYXNlIFwiaWJpZFwiOiB7XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBUaGUgY2FwRGF0YSBwcm90b2NvbCBubyBsb25nZXIgc3VwcG9ydHMgJHtxdW90ZShRQ0xBU1MpfSAke3F1b3RlKFxuICAgICAgICAgICAgcWNsYXNzXG4gICAgICAgICAgKX1gO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICB0aHJvdyBhc3NlcnQuZmFpbChcbiAgICAgICAgICAgIHJlZGFjdGVkYHVucmVjb2duaXplZCAke3F1b3RlKFFDTEFTUyl9ICR7cXVvdGUocWNsYXNzKX1gLFxuICAgICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBhc3NlcnQodHlwZW9mIGpzb25FbmNvZGVkID09PSBcIm9iamVjdFwiICYmIGpzb25FbmNvZGVkICE9PSBudWxsKTtcbiAgICAgIGNvbnN0IGRlY29kZUVudHJ5ID0gKFtuYW1lLCBlbmNvZGVkVmFsXSkgPT4ge1xuICAgICAgICB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYFByb3BlcnR5ICR7cXVvdGUobmFtZSl9IG9mICR7anNvbkVuY29kZWR9IG11c3QgYmUgYSBzdHJpbmdgO1xuICAgICAgICByZXR1cm4gW25hbWUsIGRlY29kZUZyb21DYXBEYXRhKGVuY29kZWRWYWwpXTtcbiAgICAgIH07XG4gICAgICBjb25zdCBkZWNvZGVkRW50cmllcyA9IGVudHJpZXMzKGpzb25FbmNvZGVkKS5tYXAoZGVjb2RlRW50cnkpO1xuICAgICAgcmV0dXJuIGZyb21FbnRyaWVzMihkZWNvZGVkRW50cmllcyk7XG4gICAgfVxuICB9O1xuICByZXR1cm4gaGFyZGVuKGRlY29kZUZyb21DYXBEYXRhKTtcbn07XG5cbi8vXG5mdW5jdGlvbiBpc05hdChhbGxlZ2VkTnVtKSB7XG4gIGlmICh0eXBlb2YgYWxsZWdlZE51bSA9PT0gXCJiaWdpbnRcIikge1xuICAgIHJldHVybiBhbGxlZ2VkTnVtID49IDA7XG4gIH1cbiAgaWYgKHR5cGVvZiBhbGxlZ2VkTnVtICE9PSBcIm51bWJlclwiKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBOdW1iZXIuaXNTYWZlSW50ZWdlcihhbGxlZ2VkTnVtKSAmJiBhbGxlZ2VkTnVtID49IDA7XG59XG5mdW5jdGlvbiBOYXQoYWxsZWdlZE51bSkge1xuICBpZiAodHlwZW9mIGFsbGVnZWROdW0gPT09IFwiYmlnaW50XCIpIHtcbiAgICBpZiAoYWxsZWdlZE51bSA8IDBuKSB7XG4gICAgICB0aHJvdyBSYW5nZUVycm9yKGAke2FsbGVnZWROdW19IGlzIG5lZ2F0aXZlYCk7XG4gICAgfVxuICAgIHJldHVybiBhbGxlZ2VkTnVtO1xuICB9XG4gIGlmICh0eXBlb2YgYWxsZWdlZE51bSA9PT0gXCJudW1iZXJcIikge1xuICAgIGlmICghTnVtYmVyLmlzU2FmZUludGVnZXIoYWxsZWdlZE51bSkpIHtcbiAgICAgIHRocm93IFJhbmdlRXJyb3IoYCR7YWxsZWdlZE51bX0gaXMgbm90IGEgc2FmZSBpbnRlZ2VyYCk7XG4gICAgfVxuICAgIGlmIChhbGxlZ2VkTnVtIDwgMCkge1xuICAgICAgdGhyb3cgUmFuZ2VFcnJvcihgJHthbGxlZ2VkTnVtfSBpcyBuZWdhdGl2ZWApO1xuICAgIH1cbiAgICByZXR1cm4gQmlnSW50KGFsbGVnZWROdW0pO1xuICB9XG4gIHRocm93IFR5cGVFcnJvcihcbiAgICBgJHthbGxlZ2VkTnVtfSBpcyBhICR7dHlwZW9mIGFsbGVnZWROdW19IGJ1dCBtdXN0IGJlIGEgYmlnaW50IG9yIGEgbnVtYmVyYFxuICApO1xufVxuXG4vL1xudmFyIHsgZW50cmllczogZW50cmllczQsIGZyb21FbnRyaWVzOiBmcm9tRW50cmllczMgfSA9IE9iamVjdDtcbnZhciBvYmplY3RNYXAgPSAob3JpZ2luYWwsIG1hcEZuKSA9PiB7XG4gIGNvbnN0IGVudHMgPSBlbnRyaWVzNChvcmlnaW5hbCk7XG4gIGNvbnN0IG1hcEVudHMgPSBlbnRzLm1hcChcbiAgICAoW2ssIHYzXSkgPT4gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBbaywgbWFwRm4odjMsIGspXVxuICAgIClcbiAgKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBoYXJkZW4oZnJvbUVudHJpZXMzKG1hcEVudHMpKVxuICApO1xufTtcbmhhcmRlbihvYmplY3RNYXApO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czExIH0gPSBSZWZsZWN0O1xudmFyIHsgaXNBcnJheTogaXNBcnJheTUgfSA9IEFycmF5O1xudmFyIHsgaXM6IGlzMiwgZW50cmllczogZW50cmllczUsIGZyb21FbnRyaWVzOiBmcm9tRW50cmllczQgfSA9IE9iamVjdDtcbnZhciBCQU5HID0gXCIhXCIuY2hhckNvZGVBdCgwKTtcbnZhciBEQVNIID0gXCItXCIuY2hhckNvZGVBdCgwKTtcbnZhciBzdGFydHNTcGVjaWFsID0gKGVuY29kZWRTdHIpID0+IHtcbiAgaWYgKGVuY29kZWRTdHIgPT09IFwiXCIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgY29kZSA9IGVuY29kZWRTdHIuY2hhckNvZGVBdCgwKTtcbiAgcmV0dXJuIEJBTkcgPD0gY29kZSAmJiBjb2RlIDw9IERBU0g7XG59O1xudmFyIGRvbnRFbmNvZGVSZW1vdGFibGVUb1NtYWxsY2FwcyA9IChyZW0pID0+IHRocm93UmVkYWN0ZWRgcmVtb3RhYmxlIHVuZXhwZWN0ZWQ6ICR7cmVtfWA7XG52YXIgZG9udEVuY29kZVByb21pc2VUb1NtYWxsY2FwcyA9IChwcm9tKSA9PiB0aHJvd1JlZGFjdGVkYHByb21pc2UgdW5leHBlY3RlZDogJHtwcm9tfWA7XG52YXIgZG9udEVuY29kZUVycm9yVG9TbWFsbGNhcHMgPSAoZXJyKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIG9iamVjdCB1bmV4cGVjdGVkOiAke3F1b3RlKGVycil9YDtcbnZhciBtYWtlRW5jb2RlVG9TbWFsbGNhcHMgPSAoZW5jb2RlT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBlbmNvZGVSZW1vdGFibGVUb1NtYWxsY2FwcyA9IGRvbnRFbmNvZGVSZW1vdGFibGVUb1NtYWxsY2FwcyxcbiAgICBlbmNvZGVQcm9taXNlVG9TbWFsbGNhcHMgPSBkb250RW5jb2RlUHJvbWlzZVRvU21hbGxjYXBzLFxuICAgIGVuY29kZUVycm9yVG9TbWFsbGNhcHMgPSBkb250RW5jb2RlRXJyb3JUb1NtYWxsY2Fwc1xuICB9ID0gZW5jb2RlT3B0aW9ucztcbiAgY29uc3QgYXNzZXJ0RW5jb2RlZEVycm9yID0gKGVuY29kaW5nKSA9PiB7XG4gICAgdHlwZW9mIGVuY29kaW5nID09PSBcIm9iamVjdFwiICYmIGhhc093blByb3BlcnR5T2YoZW5jb2RpbmcsIFwiI2Vycm9yXCIpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IEVycm9yIGVuY29kaW5nIG11c3QgaGF2ZSBcIiNlcnJvclwiIHByb3BlcnR5OiAke3F1b3RlKFxuICAgICAgZW5jb2RpbmdcbiAgICApfWA7XG4gICAgY29uc3QgbWVzc2FnZSA9IGVuY29kaW5nW1wiI2Vycm9yXCJdO1xuICAgIHR5cGVvZiBtZXNzYWdlID09PSBcInN0cmluZ1wiICYmICghc3RhcnRzU3BlY2lhbChtZXNzYWdlKSB8fCBtZXNzYWdlLmNoYXJBdCgwKSA9PT0gXCIhXCIpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IEVycm9yIGVuY29kaW5nIG11c3QgaGF2ZSBzdHJpbmcgbWVzc2FnZTogJHtxdW90ZShtZXNzYWdlKX1gO1xuICB9O1xuICBjb25zdCBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyID0gKHBhc3NhYmxlKSA9PiB7XG4gICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocGFzc2FibGUpO1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwibnVsbFwiOlxuICAgICAgY2FzZSBcImJvb2xlYW5cIjoge1xuICAgICAgICByZXR1cm4gcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwic3RyaW5nXCI6IHtcbiAgICAgICAgaWYgKHN0YXJ0c1NwZWNpYWwocGFzc2FibGUpKSB7XG4gICAgICAgICAgcmV0dXJuIGAhJHtwYXNzYWJsZX1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXNzYWJsZTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjoge1xuICAgICAgICByZXR1cm4gXCIjdW5kZWZpbmVkXCI7XG4gICAgICB9XG4gICAgICBjYXNlIFwibnVtYmVyXCI6IHtcbiAgICAgICAgaWYgKE51bWJlci5pc05hTihwYXNzYWJsZSkpIHtcbiAgICAgICAgICByZXR1cm4gXCIjTmFOXCI7XG4gICAgICAgIH0gZWxzZSBpZiAocGFzc2FibGUgPT09IEluZmluaXR5KSB7XG4gICAgICAgICAgcmV0dXJuIFwiI0luZmluaXR5XCI7XG4gICAgICAgIH0gZWxzZSBpZiAocGFzc2FibGUgPT09IC1JbmZpbml0eSkge1xuICAgICAgICAgIHJldHVybiBcIiMtSW5maW5pdHlcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXMyKHBhc3NhYmxlLCAtMCkgPyAwIDogcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgY29uc3Qgc3RyID0gU3RyaW5nKHBhc3NhYmxlKTtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBwYXNzYWJsZSA8IDBuID8gc3RyIDogYCske3N0cn1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgYXNzZXJ0UGFzc2FibGVTeW1ib2wocGFzc2FibGUpO1xuICAgICAgICBjb25zdCBuYW1lID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG5hbWVGb3JQYXNzYWJsZVN5bWJvbChwYXNzYWJsZSlcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIGAlJHtuYW1lfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGNvbnN0IG5hbWVzID0gb3duS2V5czExKHBhc3NhYmxlKS5zb3J0KCk7XG4gICAgICAgIHJldHVybiBmcm9tRW50cmllczQoXG4gICAgICAgICAgbmFtZXMubWFwKChuYW1lKSA9PiBbXG4gICAgICAgICAgICBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKG5hbWUpLFxuICAgICAgICAgICAgZW5jb2RlVG9TbWFsbGNhcHNSZWN1cihwYXNzYWJsZVtuYW1lXSlcbiAgICAgICAgICBdKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIHJldHVybiBwYXNzYWJsZS5tYXAoZW5jb2RlVG9TbWFsbGNhcHNSZWN1cik7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBcIiN0YWdcIjogZW5jb2RlVG9TbWFsbGNhcHNSZWN1cihnZXRUYWcocGFzc2FibGUpKSxcbiAgICAgICAgICBwYXlsb2FkOiBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKHBhc3NhYmxlLnBheWxvYWQpXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMoXG4gICAgICAgICAgcGFzc2FibGUsXG4gICAgICAgICAgZW5jb2RlVG9TbWFsbGNhcHNSZWN1clxuICAgICAgICApO1xuICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gXCJzdHJpbmdcIiAmJiByZXN1bHQuY2hhckF0KDApID09PSBcIiRcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogUmVtb3RhYmxlIGVuY29kaW5nIG11c3Qgc3RhcnQgd2l0aCBcIiRcIjogJHtyZXN1bHR9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZW5jb2RlUHJvbWlzZVRvU21hbGxjYXBzKFxuICAgICAgICAgIHBhc3NhYmxlLFxuICAgICAgICAgIGVuY29kZVRvU21hbGxjYXBzUmVjdXJcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHR5cGVvZiByZXN1bHQgPT09IFwic3RyaW5nXCIgJiYgcmVzdWx0LmNoYXJBdCgwKSA9PT0gXCImXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFByb21pc2UgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiJlwiOiAke3Jlc3VsdH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZW5jb2RlRXJyb3JUb1NtYWxsY2FwcyhwYXNzYWJsZSwgZW5jb2RlVG9TbWFsbGNhcHNSZWN1cik7XG4gICAgICAgIGFzc2VydEVuY29kZWRFcnJvcihyZXN1bHQpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyBhc3NlcnQuZmFpbChcbiAgICAgICAgICByZWRhY3RlZGBpbnRlcm5hbDogVW5yZWNvZ25pemVkIHBhc3NTdHlsZSAke3F1b3RlKHBhc3NTdHlsZSl9YCxcbiAgICAgICAgICBUeXBlRXJyb3JcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IGVuY29kZVRvU21hbGxjYXBzID0gKHBhc3NhYmxlKSA9PiB7XG4gICAgaWYgKGlzRXJyb3JMaWtlKHBhc3NhYmxlKSkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gaGFyZGVuKFxuICAgICAgICBlbmNvZGVFcnJvclRvU21hbGxjYXBzKHBhc3NhYmxlLCBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKVxuICAgICAgKTtcbiAgICAgIGFzc2VydEVuY29kZWRFcnJvcihyZXN1bHQpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbihlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKHBhc3NhYmxlKSk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oZW5jb2RlVG9TbWFsbGNhcHMpO1xufTtcbmhhcmRlbihtYWtlRW5jb2RlVG9TbWFsbGNhcHMpO1xudmFyIGRvbnREZWNvZGVSZW1vdGFibGVGcm9tU21hbGxjYXBzID0gKGVuY29kaW5nKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke2VuY29kaW5nfWA7XG52YXIgZG9udERlY29kZVByb21pc2VGcm9tU21hbGxjYXBzID0gKGVuY29kaW5nKSA9PiB0aHJvd1JlZGFjdGVkYHByb21pc2UgdW5leHBlY3RlZDogJHtlbmNvZGluZ31gO1xudmFyIGRvbnREZWNvZGVFcnJvckZyb21TbWFsbGNhcHMgPSAoZW5jb2RpbmcpID0+IHRocm93UmVkYWN0ZWRgZXJyb3IgdW5leHBlY3RlZDogJHtxdW90ZShlbmNvZGluZyl9YDtcbnZhciBtYWtlRGVjb2RlRnJvbVNtYWxsY2FwcyA9IChkZWNvZGVPcHRpb25zID0ge30pID0+IHtcbiAgY29uc3Qge1xuICAgIGRlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMgPSBkb250RGVjb2RlUmVtb3RhYmxlRnJvbVNtYWxsY2FwcyxcbiAgICBkZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyA9IGRvbnREZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyxcbiAgICBkZWNvZGVFcnJvckZyb21TbWFsbGNhcHMgPSBkb250RGVjb2RlRXJyb3JGcm9tU21hbGxjYXBzXG4gIH0gPSBkZWNvZGVPcHRpb25zO1xuICBjb25zdCBkZWNvZGVGcm9tU21hbGxjYXBzID0gKGVuY29kaW5nKSA9PiB7XG4gICAgc3dpdGNoICh0eXBlb2YgZW5jb2RpbmcpIHtcbiAgICAgIGNhc2UgXCJib29sZWFuXCI6XG4gICAgICBjYXNlIFwibnVtYmVyXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kaW5nO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgIGlmICghc3RhcnRzU3BlY2lhbChlbmNvZGluZykpIHtcbiAgICAgICAgICByZXR1cm4gZW5jb2Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYzIgPSBlbmNvZGluZy5jaGFyQXQoMCk7XG4gICAgICAgIHN3aXRjaCAoYzIpIHtcbiAgICAgICAgICBjYXNlIFwiIVwiOiB7XG4gICAgICAgICAgICByZXR1cm4gZW5jb2Rpbmcuc2xpY2UoMSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgXCIlXCI6IHtcbiAgICAgICAgICAgIHJldHVybiBwYXNzYWJsZVN5bWJvbEZvck5hbWUoZW5jb2Rpbmcuc2xpY2UoMSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiI1wiOiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGVuY29kaW5nKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCIjdW5kZWZpbmVkXCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNhc2UgXCIjTmFOXCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNhc2UgXCIjSW5maW5pdHlcIjoge1xuICAgICAgICAgICAgICAgIHJldHVybiBJbmZpbml0eTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjYXNlIFwiIy1JbmZpbml0eVwiOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC1JbmZpbml0eTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgICAgICAgICByZWRhY3RlZGB1bmtub3duIGNvbnN0YW50IFwiJHtxdW90ZShlbmNvZGluZyl9XCJgLFxuICAgICAgICAgICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiK1wiOlxuICAgICAgICAgIGNhc2UgXCItXCI6IHtcbiAgICAgICAgICAgIHJldHVybiBCaWdJbnQoZW5jb2RpbmcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiJFwiOiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBkZWNvZGVSZW1vdGFibGVGcm9tU21hbGxjYXBzKFxuICAgICAgICAgICAgICBlbmNvZGluZyxcbiAgICAgICAgICAgICAgZGVjb2RlRnJvbVNtYWxsY2Fwc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChwYXNzU3R5bGVPZihyZXN1bHQpICE9PSBcInJlbW90YWJsZVwiKSB7XG4gICAgICAgICAgICAgIHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGRlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMgb3B0aW9uIG11c3QgcmV0dXJuIGEgcmVtb3RhYmxlOiAke3Jlc3VsdH1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcIiZcIjoge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGVjb2RlUHJvbWlzZUZyb21TbWFsbGNhcHMoXG4gICAgICAgICAgICAgIGVuY29kaW5nLFxuICAgICAgICAgICAgICBkZWNvZGVGcm9tU21hbGxjYXBzXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKHBhc3NTdHlsZU9mKHJlc3VsdCkgIT09IFwicHJvbWlzZVwiKSB7XG4gICAgICAgICAgICAgIHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGRlY29kZVByb21pc2VGcm9tU21hbGxjYXBzIG9wdGlvbiBtdXN0IHJldHVybiBhIHByb21pc2U6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgIH1cbiAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFNwZWNpYWwgY2hhciAke3F1b3RlKFxuICAgICAgICAgICAgICBjMlxuICAgICAgICAgICAgKX0gcmVzZXJ2ZWQgZm9yIGZ1dHVyZSB1c2U6ICR7ZW5jb2Rpbmd9YDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNhc2UgXCJvYmplY3RcIjoge1xuICAgICAgICBpZiAoZW5jb2RpbmcgPT09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gZW5jb2Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzQXJyYXk1KGVuY29kaW5nKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGluZy5tYXAoKHZhbCkgPT4gZGVjb2RlRnJvbVNtYWxsY2Fwcyh2YWwpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGFzT3duUHJvcGVydHlPZihlbmNvZGluZywgXCIjdGFnXCIpKSB7XG4gICAgICAgICAgY29uc3QgeyBcIiN0YWdcIjogdGFnLCBwYXlsb2FkLCAuLi5yZXN0IH0gPSBlbmNvZGluZztcbiAgICAgICAgICB0eXBlb2YgdGFnID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgVmFsdWUgb2YgXCIjdGFnXCIsIHRoZSB0YWcsIG11c3QgYmUgYSBzdHJpbmc6ICR7ZW5jb2Rpbmd9YDtcbiAgICAgICAgICBvd25LZXlzMTEocmVzdCkubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgI3RhZyByZWNvcmQgdW5leHBlY3RlZCBwcm9wZXJ0aWVzOiAke3F1b3RlKG93bktleXMxMShyZXN0KSl9YDtcbiAgICAgICAgICByZXR1cm4gbWFrZVRhZ2dlZChcbiAgICAgICAgICAgIGRlY29kZUZyb21TbWFsbGNhcHModGFnKSxcbiAgICAgICAgICAgIGRlY29kZUZyb21TbWFsbGNhcHMocGF5bG9hZClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eU9mKGVuY29kaW5nLCBcIiNlcnJvclwiKSkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGRlY29kZUVycm9yRnJvbVNtYWxsY2FwcyhcbiAgICAgICAgICAgIGVuY29kaW5nLFxuICAgICAgICAgICAgZGVjb2RlRnJvbVNtYWxsY2Fwc1xuICAgICAgICAgICk7XG4gICAgICAgICAgcGFzc1N0eWxlT2YocmVzdWx0KSA9PT0gXCJlcnJvclwiIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGRlY29kZUVycm9yRnJvbVNtYWxsY2FwcyBvcHRpb24gbXVzdCByZXR1cm4gYW4gZXJyb3I6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkZWNvZGVFbnRyeSA9IChbZW5jb2RlZE5hbWUsIGVuY29kZWRWYWxdKSA9PiB7XG4gICAgICAgICAgdHlwZW9mIGVuY29kZWROYW1lID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgUHJvcGVydHkgbmFtZSAke3F1b3RlKFxuICAgICAgICAgICAgZW5jb2RlZE5hbWVcbiAgICAgICAgICApfSBvZiAke2VuY29kaW5nfSBtdXN0IGJlIGEgc3RyaW5nYDtcbiAgICAgICAgICBlbmNvZGVkTmFtZS5jaGFyQXQoMCkgIT09IFwiI1wiIHx8IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIHJlY29yZCB0eXBlICR7cXVvdGUoZW5jb2RlZE5hbWUpfTogJHtlbmNvZGluZ31gO1xuICAgICAgICAgIGNvbnN0IG5hbWUgPSBkZWNvZGVGcm9tU21hbGxjYXBzKGVuY29kZWROYW1lKTtcbiAgICAgICAgICB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYERlY29kZWQgcHJvcGVydHkgbmFtZSAke25hbWV9IGZyb20gJHtlbmNvZGluZ30gbXVzdCBiZSBhIHN0cmluZ2A7XG4gICAgICAgICAgcmV0dXJuIFtuYW1lLCBkZWNvZGVGcm9tU21hbGxjYXBzKGVuY29kZWRWYWwpXTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZGVjb2RlZEVudHJpZXMgPSBlbnRyaWVzNShlbmNvZGluZykubWFwKGRlY29kZUVudHJ5KTtcbiAgICAgICAgcmV0dXJuIGZyb21FbnRyaWVzNChkZWNvZGVkRW50cmllcyk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IGFzc2VydC5mYWlsKFxuICAgICAgICAgIHJlZGFjdGVkYGludGVybmFsOiB1bnJlY29nbml6ZWQgSlNPTiB0eXBlb2YgJHtxdW90ZShcbiAgICAgICAgICAgIHR5cGVvZiBlbmNvZGluZ1xuICAgICAgICAgICl9OiAke2VuY29kaW5nfWAsXG4gICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gaGFyZGVuKGRlY29kZUZyb21TbWFsbGNhcHMpO1xufTtcblxuLy9cbnZhciB7IGRlZmluZVByb3BlcnRpZXM6IGRlZmluZVByb3BlcnRpZXMyIH0gPSBPYmplY3Q7XG52YXIgeyBpc0FycmF5OiBpc0FycmF5NiB9ID0gQXJyYXk7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTIgfSA9IFJlZmxlY3Q7XG52YXIgZGVmYXVsdFZhbFRvU2xvdEZuID0gKHgpID0+IHg7XG52YXIgZGVmYXVsdFNsb3RUb1ZhbEZuID0gKHgsIF8pID0+IHg7XG52YXIgbWFrZU1hcnNoYWwgPSAoY29udmVydFZhbFRvU2xvdCA9IGRlZmF1bHRWYWxUb1Nsb3RGbiwgY29udmVydFNsb3RUb1ZhbCA9IGRlZmF1bHRTbG90VG9WYWxGbiwge1xuICBlcnJvclRhZ2dpbmcgPSBcIm9uXCIsXG4gIG1hcnNoYWxOYW1lID0gXCJhbm9uLW1hcnNoYWxcIixcbiAgLy9cbiAgLy9cbiAgZXJyb3JJZE51bSA9IDFlNCxcbiAgLy9cbiAgLy9cbiAgbWFyc2hhbFNhdmVFcnJvciA9IChlcnIpID0+IGNvbnNvbGUubG9nKFwiVGVtcG9yYXJ5IGxvZ2dpbmcgb2Ygc2VudCBlcnJvclwiLCBlcnIpLFxuICAvL1xuICAvL1xuICBzZXJpYWxpemVCb2R5Rm9ybWF0ID0gXCJjYXBkYXRhXCJcbn0gPSB7fSkgPT4ge1xuICBhc3NlcnQudHlwZW9mKG1hcnNoYWxOYW1lLCBcInN0cmluZ1wiKTtcbiAgZXJyb3JUYWdnaW5nID09PSBcIm9uXCIgfHwgZXJyb3JUYWdnaW5nID09PSBcIm9mZlwiIHx8IHRocm93UmVkYWN0ZWRgVGhlIGVycm9yVGFnZ2luZyBvcHRpb24gY2FuIG9ubHkgYmUgXCJvblwiIG9yIFwib2ZmXCIgJHtlcnJvclRhZ2dpbmd9YDtcbiAgY29uc3QgbmV4dEVycm9ySWQgPSAoKSA9PiB7XG4gICAgZXJyb3JJZE51bSArPSAxO1xuICAgIHJldHVybiBgZXJyb3I6JHttYXJzaGFsTmFtZX0jJHtlcnJvcklkTnVtfWA7XG4gIH07XG4gIGNvbnN0IHRvQ2FwRGF0YTIgPSAocm9vdCkgPT4ge1xuICAgIGNvbnN0IHNsb3RzID0gW107XG4gICAgY29uc3Qgc2xvdE1hcCA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gICAgY29uc3QgZW5jb2RlU2xvdENvbW1vbiA9IChwYXNzYWJsZSkgPT4ge1xuICAgICAgbGV0IGluZGV4ID0gc2xvdE1hcC5nZXQocGFzc2FibGUpO1xuICAgICAgaWYgKGluZGV4ICE9PSB2b2lkIDApIHtcbiAgICAgICAgYXNzZXJ0LnR5cGVvZihpbmRleCwgXCJudW1iZXJcIik7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBpbmRleCwgcmVwZWF0OiB0cnVlIH0pO1xuICAgICAgfVxuICAgICAgaW5kZXggPSBzbG90cy5sZW5ndGg7XG4gICAgICBjb25zdCBzbG90ID0gY29udmVydFZhbFRvU2xvdChwYXNzYWJsZSk7XG4gICAgICBzbG90cy5wdXNoKHNsb3QpO1xuICAgICAgc2xvdE1hcC5zZXQocGFzc2FibGUsIGluZGV4KTtcbiAgICAgIHJldHVybiBoYXJkZW4oeyBpbmRleCwgcmVwZWF0OiBmYWxzZSB9KTtcbiAgICB9O1xuICAgIGNvbnN0IGVuY29kZUVycm9yQ29tbW9uID0gKGVyciwgZW5jb2RlUmVjdXIpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlbmNvZGVSZWN1cihgJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGFzc2VydC50eXBlb2YobWVzc2FnZSwgXCJzdHJpbmdcIik7XG4gICAgICBjb25zdCBuYW1lID0gZW5jb2RlUmVjdXIoYCR7ZXJyLm5hbWV9YCk7XG4gICAgICBhc3NlcnQudHlwZW9mKG5hbWUsIFwic3RyaW5nXCIpO1xuICAgICAgaWYgKGVycm9yVGFnZ2luZyA9PT0gXCJvblwiKSB7XG4gICAgICAgIGNvbnN0IGVycm9ySWQgPSBlbmNvZGVSZWN1cihuZXh0RXJyb3JJZCgpKTtcbiAgICAgICAgYXNzZXJ0LnR5cGVvZihlcnJvcklkLCBcInN0cmluZ1wiKTtcbiAgICAgICAgbm90ZShlcnIsIHJlZGFjdGVkYFNlbnQgYXMgJHtlcnJvcklkfWApO1xuICAgICAgICBtYXJzaGFsU2F2ZUVycm9yKGVycik7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBlcnJvcklkLCBtZXNzYWdlLCBuYW1lIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7IG1lc3NhZ2UsIG5hbWUgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBpZiAoc2VyaWFsaXplQm9keUZvcm1hdCA9PT0gXCJjYXBkYXRhXCIpIHtcbiAgICAgIGNvbnN0IGVuY29kZVNsb3RUb0NhcERhdGEgPSAocGFzc2FibGUsIGlmYWNlID0gdm9pZCAwKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaW5kZXgsIHJlcGVhdCB9ID0gZW5jb2RlU2xvdENvbW1vbihwYXNzYWJsZSk7XG4gICAgICAgIGlmIChyZXBlYXQgPT09IHRydWUgfHwgaWZhY2UgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBbUUNMQVNTXTogXCJzbG90XCIsIGluZGV4IH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBbUUNMQVNTXTogXCJzbG90XCIsIGlmYWNlLCBpbmRleCB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IGVuY29kZVJlbW90YWJsZVRvQ2FwRGF0YSA9ICh2YWwsIF9lbmNvZGVSZWN1cikgPT4gZW5jb2RlU2xvdFRvQ2FwRGF0YSh2YWwsIGdldEludGVyZmFjZU9mKHZhbCkpO1xuICAgICAgY29uc3QgZW5jb2RlUHJvbWlzZVRvQ2FwRGF0YSA9IChwcm9taXNlLCBfZW5jb2RlUmVjdXIpID0+IGVuY29kZVNsb3RUb0NhcERhdGEocHJvbWlzZSk7XG4gICAgICBjb25zdCBlbmNvZGVFcnJvclRvQ2FwRGF0YSA9IChlcnIsIGVuY29kZVJlY3VyKSA9PiB7XG4gICAgICAgIGNvbnN0IGVyckRhdGEgPSBlbmNvZGVFcnJvckNvbW1vbihlcnIsIGVuY29kZVJlY3VyKTtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7IFtRQ0xBU1NdOiBcImVycm9yXCIsIC4uLmVyckRhdGEgfSk7XG4gICAgICB9O1xuICAgICAgY29uc3QgZW5jb2RlVG9DYXBEYXRhID0gbWFrZUVuY29kZVRvQ2FwRGF0YSh7XG4gICAgICAgIGVuY29kZVJlbW90YWJsZVRvQ2FwRGF0YSxcbiAgICAgICAgZW5jb2RlUHJvbWlzZVRvQ2FwRGF0YSxcbiAgICAgICAgZW5jb2RlRXJyb3JUb0NhcERhdGFcbiAgICAgIH0pO1xuICAgICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZVRvQ2FwRGF0YShyb290KTtcbiAgICAgIGNvbnN0IGJvZHkgPSBKU09OLnN0cmluZ2lmeShlbmNvZGVkKTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBib2R5LFxuICAgICAgICBzbG90c1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChzZXJpYWxpemVCb2R5Rm9ybWF0ID09PSBcInNtYWxsY2Fwc1wiKSB7XG4gICAgICBjb25zdCBlbmNvZGVTbG90VG9TbWFsbGNhcHMgPSAocHJlZml4LCBwYXNzYWJsZSwgaWZhY2UgPSB2b2lkIDApID0+IHtcbiAgICAgICAgY29uc3QgeyBpbmRleCwgcmVwZWF0IH0gPSBlbmNvZGVTbG90Q29tbW9uKHBhc3NhYmxlKTtcbiAgICAgICAgaWYgKHJlcGVhdCA9PT0gdHJ1ZSB8fCBpZmFjZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgcmV0dXJuIGAke3ByZWZpeH0ke2luZGV4fWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke3ByZWZpeH0ke2luZGV4fS4ke2lmYWNlfWA7XG4gICAgICB9O1xuICAgICAgY29uc3QgZW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMgPSAocmVtb3RhYmxlLCBfZW5jb2RlUmVjdXIpID0+IGVuY29kZVNsb3RUb1NtYWxsY2FwcyhcIiRcIiwgcmVtb3RhYmxlLCBnZXRJbnRlcmZhY2VPZihyZW1vdGFibGUpKTtcbiAgICAgIGNvbnN0IGVuY29kZVByb21pc2VUb1NtYWxsY2FwcyA9IChwcm9taXNlLCBfZW5jb2RlUmVjdXIpID0+IGVuY29kZVNsb3RUb1NtYWxsY2FwcyhcIiZcIiwgcHJvbWlzZSk7XG4gICAgICBjb25zdCBlbmNvZGVFcnJvclRvU21hbGxjYXBzID0gKGVyciwgZW5jb2RlUmVjdXIpID0+IHtcbiAgICAgICAgY29uc3QgZXJyRGF0YSA9IGVuY29kZUVycm9yQ29tbW9uKGVyciwgZW5jb2RlUmVjdXIpO1xuICAgICAgICBjb25zdCB7IG1lc3NhZ2UsIC4uLnJlc3QgfSA9IGVyckRhdGE7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBcIiNlcnJvclwiOiBtZXNzYWdlLCAuLi5yZXN0IH0pO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGVuY29kZVRvU21hbGxjYXBzID0gbWFrZUVuY29kZVRvU21hbGxjYXBzKHtcbiAgICAgICAgZW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMsXG4gICAgICAgIGVuY29kZVByb21pc2VUb1NtYWxsY2FwcyxcbiAgICAgICAgZW5jb2RlRXJyb3JUb1NtYWxsY2Fwc1xuICAgICAgfSk7XG4gICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlVG9TbWFsbGNhcHMocm9vdCk7XG4gICAgICBjb25zdCBzbWFsbGNhcHNCb2R5ID0gSlNPTi5zdHJpbmdpZnkoZW5jb2RlZCk7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgYm9keTogYCMke3NtYWxsY2Fwc0JvZHl9YCxcbiAgICAgICAgc2xvdHNcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFVucmVjb2duaXplZCBzZXJpYWxpemVCb2R5Rm9ybWF0OiAke3F1b3RlKHNlcmlhbGl6ZUJvZHlGb3JtYXQpfWA7XG4gICAgfVxuICB9O1xuICBjb25zdCBtYWtlRnVsbFJldml2ZSA9IChzbG90cykgPT4ge1xuICAgIGNvbnN0IHZhbE1hcCA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gICAgY29uc3QgZGVjb2RlU2xvdENvbW1vbiA9IChzbG90RGF0YSkgPT4ge1xuICAgICAgY29uc3QgeyBpZmFjZSA9IHZvaWQgMCwgaW5kZXgsIC4uLnJlc3QgfSA9IHNsb3REYXRhO1xuICAgICAgb3duS2V5czEyKHJlc3QpLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZW5jb2RlZCBzbG90IHByb3BlcnRpZXMgJHtxdW90ZShvd25LZXlzMTIocmVzdCkpfWA7XG4gICAgICBjb25zdCBleHRhbnQgPSB2YWxNYXAuZ2V0KGluZGV4KTtcbiAgICAgIGlmIChleHRhbnQpIHtcbiAgICAgICAgcmV0dXJuIGV4dGFudDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHNsb3QgPSBzbG90c1tOdW1iZXIoTmF0KGluZGV4KSldO1xuICAgICAgY29uc3QgdmFsID0gY29udmVydFNsb3RUb1ZhbChzbG90LCBpZmFjZSk7XG4gICAgICB2YWxNYXAuc2V0KGluZGV4LCB2YWwpO1xuICAgICAgcmV0dXJuIHZhbDtcbiAgICB9O1xuICAgIGNvbnN0IGRlY29kZUVycm9yQ29tbW9uID0gKGVyckRhdGEsIGRlY29kZVJlY3VyKSA9PiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGVycm9ySWQgPSB2b2lkIDAsXG4gICAgICAgIG1lc3NhZ2UsXG4gICAgICAgIG5hbWUsXG4gICAgICAgIGNhdXNlID0gdm9pZCAwLFxuICAgICAgICBlcnJvcnMgPSB2b2lkIDAsXG4gICAgICAgIC4uLnJlc3RcbiAgICAgIH0gPSBlcnJEYXRhO1xuICAgICAgY29uc3QgZE5hbWUgPSBkZWNvZGVSZWN1cihuYW1lKTtcbiAgICAgIGNvbnN0IGRNZXNzYWdlID0gZGVjb2RlUmVjdXIobWVzc2FnZSk7XG4gICAgICBjb25zdCBkRXJyb3JJZCA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgIGVycm9ySWQgJiYgZGVjb2RlUmVjdXIoZXJyb3JJZClcbiAgICAgICk7XG4gICAgICBpZiAodHlwZW9mIGROYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW52YWxpZCBlcnJvciBuYW1lIHR5cGVvZiAke3F1b3RlKHR5cGVvZiBkTmFtZSl9YDtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2YgZE1lc3NhZ2UgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGVycm9yIG1lc3NhZ2UgdHlwZW9mICR7cXVvdGUodHlwZW9mIGRNZXNzYWdlKX1gO1xuICAgICAgfVxuICAgICAgY29uc3QgZXJyQ29uc3RydWN0b3IgPSBnZXRFcnJvckNvbnN0cnVjdG9yKGROYW1lKSB8fCBFcnJvcjtcbiAgICAgIGNvbnN0IGVycm9yTmFtZSA9IGRFcnJvcklkID09PSB2b2lkIDAgPyBgUmVtb3RlJHtlcnJDb25zdHJ1Y3Rvci5uYW1lfWAgOiBgUmVtb3RlJHtlcnJDb25zdHJ1Y3Rvci5uYW1lfSgke2RFcnJvcklkfSlgO1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgZXJyb3JOYW1lLFxuICAgICAgICBzYW5pdGl6ZTogZmFsc2VcbiAgICAgIH07XG4gICAgICBpZiAoY2F1c2UpIHtcbiAgICAgICAgb3B0aW9ucy5jYXVzZSA9IGRlY29kZVJlY3VyKGNhdXNlKTtcbiAgICAgIH1cbiAgICAgIGlmIChlcnJvcnMpIHtcbiAgICAgICAgb3B0aW9ucy5lcnJvcnMgPSBkZWNvZGVSZWN1cihlcnJvcnMpO1xuICAgICAgfVxuICAgICAgY29uc3QgcmF3RXJyb3IgPSBtYWtlRXJyb3IoZE1lc3NhZ2UsIGVyckNvbnN0cnVjdG9yLCBvcHRpb25zKTtcbiAgICAgIGNvbnN0IGRlc2NzID0gb2JqZWN0TWFwKHJlc3QsIChkYXRhKSA9PiAoe1xuICAgICAgICB2YWx1ZTogZGVjb2RlUmVjdXIoZGF0YSksXG4gICAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2VcbiAgICAgIH0pKTtcbiAgICAgIGRlZmluZVByb3BlcnRpZXMyKHJhd0Vycm9yLCBkZXNjcyk7XG4gICAgICBoYXJkZW4ocmF3RXJyb3IpO1xuICAgICAgcmV0dXJuIHRvUGFzc2FibGVFcnJvcihyYXdFcnJvcik7XG4gICAgfTtcbiAgICBjb25zdCBkZWNvZGVSZW1vdGFibGVPclByb21pc2VGcm9tQ2FwRGF0YSA9IChyYXdUcmVlLCBfZGVjb2RlUmVjdXIpID0+IHtcbiAgICAgIGNvbnN0IHsgW1FDTEFTU106IF8sIC4uLnNsb3REYXRhIH0gPSByYXdUcmVlO1xuICAgICAgcmV0dXJuIGRlY29kZVNsb3RDb21tb24oc2xvdERhdGEpO1xuICAgIH07XG4gICAgY29uc3QgZGVjb2RlRXJyb3JGcm9tQ2FwRGF0YSA9IChyYXdUcmVlLCBkZWNvZGVSZWN1cikgPT4ge1xuICAgICAgY29uc3QgeyBbUUNMQVNTXTogXywgLi4uZXJyRGF0YSB9ID0gcmF3VHJlZTtcbiAgICAgIHJldHVybiBkZWNvZGVFcnJvckNvbW1vbihlcnJEYXRhLCBkZWNvZGVSZWN1cik7XG4gICAgfTtcbiAgICBjb25zdCByZXZpdmVGcm9tQ2FwRGF0YSA9IG1ha2VEZWNvZGVGcm9tQ2FwRGF0YSh7XG4gICAgICBkZWNvZGVSZW1vdGFibGVGcm9tQ2FwRGF0YTogZGVjb2RlUmVtb3RhYmxlT3JQcm9taXNlRnJvbUNhcERhdGEsXG4gICAgICBkZWNvZGVQcm9taXNlRnJvbUNhcERhdGE6IGRlY29kZVJlbW90YWJsZU9yUHJvbWlzZUZyb21DYXBEYXRhLFxuICAgICAgZGVjb2RlRXJyb3JGcm9tQ2FwRGF0YVxuICAgIH0pO1xuICAgIGNvbnN0IG1ha2VEZWNvZGVTbG90RnJvbVNtYWxsY2FwcyA9IChwcmVmaXgpID0+IHtcbiAgICAgIHJldHVybiAoc3RyaW5nRW5jb2RpbmcsIF9kZWNvZGVSZWN1cikgPT4ge1xuICAgICAgICBhc3NlcnQoc3RyaW5nRW5jb2RpbmcuY2hhckF0KDApID09PSBwcmVmaXgpO1xuICAgICAgICBjb25zdCBpMiA9IHN0cmluZ0VuY29kaW5nLmluZGV4T2YoXCIuXCIpO1xuICAgICAgICBjb25zdCBpbmRleCA9IE51bWJlcihzdHJpbmdFbmNvZGluZy5zbGljZSgxLCBpMiA8IDAgPyB2b2lkIDAgOiBpMikpO1xuICAgICAgICBjb25zdCBpZmFjZSA9IGkyIDwgMCA/IHZvaWQgMCA6IHN0cmluZ0VuY29kaW5nLnNsaWNlKGkyICsgMSk7XG4gICAgICAgIHJldHVybiBkZWNvZGVTbG90Q29tbW9uKHsgaWZhY2UsIGluZGV4IH0pO1xuICAgICAgfTtcbiAgICB9O1xuICAgIGNvbnN0IGRlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMgPSBtYWtlRGVjb2RlU2xvdEZyb21TbWFsbGNhcHMoXCIkXCIpO1xuICAgIGNvbnN0IGRlY29kZVByb21pc2VGcm9tU21hbGxjYXBzID0gbWFrZURlY29kZVNsb3RGcm9tU21hbGxjYXBzKFwiJlwiKTtcbiAgICBjb25zdCBkZWNvZGVFcnJvckZyb21TbWFsbGNhcHMgPSAoZW5jb2RpbmcsIGRlY29kZVJlY3VyKSA9PiB7XG4gICAgICBjb25zdCB7IFwiI2Vycm9yXCI6IG1lc3NhZ2UsIC4uLnJlc3RFcnJEYXRhIH0gPSBlbmNvZGluZztcbiAgICAgICFoYXNPd25Qcm9wZXJ0eU9mKHJlc3RFcnJEYXRhLCBcIm1lc3NhZ2VcIikgfHwgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGVuY29kZWQgZXJyb3IgcHJvcGVydHkgJHtxdW90ZShcIm1lc3NhZ2VcIil9YDtcbiAgICAgIHJldHVybiBkZWNvZGVFcnJvckNvbW1vbih7IG1lc3NhZ2UsIC4uLnJlc3RFcnJEYXRhIH0sIGRlY29kZVJlY3VyKTtcbiAgICB9O1xuICAgIGNvbnN0IHJldml2ZUZyb21TbWFsbGNhcHMgPSBtYWtlRGVjb2RlRnJvbVNtYWxsY2Fwcyh7XG4gICAgICAvL1xuICAgICAgZGVjb2RlUmVtb3RhYmxlRnJvbVNtYWxsY2FwcyxcbiAgICAgIC8vXG4gICAgICBkZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyxcbiAgICAgIGRlY29kZUVycm9yRnJvbVNtYWxsY2Fwc1xuICAgIH0pO1xuICAgIHJldHVybiBoYXJkZW4oeyByZXZpdmVGcm9tQ2FwRGF0YSwgcmV2aXZlRnJvbVNtYWxsY2FwcyB9KTtcbiAgfTtcbiAgY29uc3QgZnJvbUNhcERhdGEgPSAoZGF0YSkgPT4ge1xuICAgIGNvbnN0IHsgYm9keSwgc2xvdHMgfSA9IGRhdGE7XG4gICAgdHlwZW9mIGJvZHkgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGB1bnNlcmlhbGl6ZSgpIGdpdmVuIG5vbi1jYXBkYXRhICguYm9keSBpcyAke2JvZHl9LCBub3Qgc3RyaW5nKWA7XG4gICAgaXNBcnJheTYoZGF0YS5zbG90cykgfHwgdGhyb3dSZWRhY3RlZGB1bnNlcmlhbGl6ZSgpIGdpdmVuIG5vbi1jYXBkYXRhICguc2xvdHMgYXJlIG5vdCBBcnJheSlgO1xuICAgIGNvbnN0IHsgcmV2aXZlRnJvbUNhcERhdGEsIHJldml2ZUZyb21TbWFsbGNhcHMgfSA9IG1ha2VGdWxsUmV2aXZlKHNsb3RzKTtcbiAgICBsZXQgcmVzdWx0O1xuICAgIGlmIChib2R5LmNoYXJBdCgwKSA9PT0gXCIjXCIpIHtcbiAgICAgIGNvbnN0IHNtYWxsY2Fwc0JvZHkgPSBib2R5LnNsaWNlKDEpO1xuICAgICAgY29uc3QgZW5jb2RpbmcgPSBoYXJkZW4oSlNPTi5wYXJzZShzbWFsbGNhcHNCb2R5KSk7XG4gICAgICByZXN1bHQgPSBoYXJkZW4ocmV2aXZlRnJvbVNtYWxsY2FwcyhlbmNvZGluZykpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCByYXdUcmVlID0gaGFyZGVuKEpTT04ucGFyc2UoYm9keSkpO1xuICAgICAgcmVzdWx0ID0gaGFyZGVuKHJldml2ZUZyb21DYXBEYXRhKHJhd1RyZWUpKTtcbiAgICB9XG4gICAgYXNzZXJ0UGFzc2FibGUocmVzdWx0KTtcbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHJlc3VsdFxuICAgICk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIHRvQ2FwRGF0YTogdG9DYXBEYXRhMixcbiAgICBmcm9tQ2FwRGF0YSxcbiAgICAvL1xuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgc2VyaWFsaXplOiB0b0NhcERhdGEyLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICB1bnNlcmlhbGl6ZTogZnJvbUNhcERhdGFcbiAgfSk7XG59O1xuXG4vL1xudmFyIHsgZnJlZXplOiBmcmVlemU2IH0gPSBPYmplY3Q7XG52YXIgZG9Ob3RDb252ZXJ0VmFsVG9TbG90ID0gKHZhbCkgPT4gdGhyb3dSZWRhY3RlZGBNYXJzaGFsJ3Mgc3RyaW5naWZ5IHJlamVjdHMgcHJlc2VuY2VzIGFuZCBwcm9taXNlcyAke3ZhbH1gO1xudmFyIGRvTm90Q29udmVydFNsb3RUb1ZhbCA9IChzbG90LCBfaWZhY2UpID0+IHRocm93UmVkYWN0ZWRgTWFyc2hhbCdzIHBhcnNlIG11c3Qgbm90IGVuY29kZSBhbnkgc2xvdHMgJHtzbG90fWA7XG52YXIgYmFkQXJyYXlIYW5kbGVyID0gaGFyZGVuKHtcbiAgZ2V0OiAoX3RhcmdldCwgbmFtZSwgX3JlY2VpdmVyKSA9PiB7XG4gICAgaWYgKG5hbWUgPT09IFwibGVuZ3RoXCIpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYE1hcnNoYWwncyBwYXJzZSBtdXN0IG5vdCBlbmNvZGUgYW55IHNsb3QgcG9zaXRpb25zICR7bmFtZX1gO1xuICB9XG59KTtcbnZhciBhcnJheVRhcmdldCA9IGZyZWV6ZTYoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIFtdXG4pO1xudmFyIGJhZEFycmF5ID0gbmV3IFByb3h5KGFycmF5VGFyZ2V0LCBiYWRBcnJheUhhbmRsZXIpO1xudmFyIHsgc2VyaWFsaXplLCB1bnNlcmlhbGl6ZSB9ID0gbWFrZU1hcnNoYWwoXG4gIGRvTm90Q29udmVydFZhbFRvU2xvdCxcbiAgZG9Ob3RDb252ZXJ0U2xvdFRvVmFsLFxuICB7XG4gICAgZXJyb3JUYWdnaW5nOiBcIm9mZlwiLFxuICAgIC8vXG4gICAgc2VyaWFsaXplQm9keUZvcm1hdDogXCJjYXBkYXRhXCJcbiAgfVxuKTtcbnZhciBzdHJpbmdpZnkgPSAodmFsKSA9PiBzZXJpYWxpemUodmFsKS5ib2R5O1xuaGFyZGVuKHN0cmluZ2lmeSk7XG52YXIgcGFyc2UgPSAoc3RyKSA9PiB1bnNlcmlhbGl6ZShcbiAgLy9cbiAgLy9cbiAgLy9cbiAgZnJlZXplNih7XG4gICAgYm9keTogc3RyLFxuICAgIHNsb3RzOiBiYWRBcnJheVxuICB9KVxuKTtcbmhhcmRlbihwYXJzZSk7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTMgfSA9IFJlZmxlY3Q7XG52YXIgeyBpc0FycmF5OiBpc0FycmF5NyB9ID0gQXJyYXk7XG52YXIgeyBzdHJpbmdpZnk6IHF1b3RlMiB9ID0gSlNPTjtcbnZhciBtYWtlWWVzSW5kZW50ZXIgPSAoKSA9PiB7XG4gIGNvbnN0IHN0cmluZ3MgPSBbXTtcbiAgbGV0IGxldmVsID0gMDtcbiAgbGV0IG5lZWRTcGFjZSA9IGZhbHNlO1xuICBjb25zdCBsaW5lID0gKCkgPT4ge1xuICAgIG5lZWRTcGFjZSA9IGZhbHNlO1xuICAgIHJldHVybiBzdHJpbmdzLnB1c2goXCJcXG5cIiwgXCIgIFwiLnJlcGVhdChsZXZlbCkpO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBvcGVuOiAob3BlbkJyYWNrZXQpID0+IHtcbiAgICAgIGxldmVsICs9IDE7XG4gICAgICBpZiAobmVlZFNwYWNlKSB7XG4gICAgICAgIHN0cmluZ3MucHVzaChcIiBcIik7XG4gICAgICB9XG4gICAgICBuZWVkU3BhY2UgPSBmYWxzZTtcbiAgICAgIHJldHVybiBzdHJpbmdzLnB1c2gob3BlbkJyYWNrZXQpO1xuICAgIH0sXG4gICAgbGluZSxcbiAgICBuZXh0OiAodG9rZW4yKSA9PiB7XG4gICAgICBpZiAobmVlZFNwYWNlICYmIHRva2VuMiAhPT0gXCIsXCIpIHtcbiAgICAgICAgc3RyaW5ncy5wdXNoKFwiIFwiKTtcbiAgICAgIH1cbiAgICAgIG5lZWRTcGFjZSA9IHRydWU7XG4gICAgICByZXR1cm4gc3RyaW5ncy5wdXNoKHRva2VuMik7XG4gICAgfSxcbiAgICBjbG9zZTogKGNsb3NlQnJhY2tldCkgPT4ge1xuICAgICAgYXNzZXJ0KGxldmVsID49IDEpO1xuICAgICAgbGV2ZWwgLT0gMTtcbiAgICAgIGxpbmUoKTtcbiAgICAgIHJldHVybiBzdHJpbmdzLnB1c2goY2xvc2VCcmFja2V0KTtcbiAgICB9LFxuICAgIGRvbmU6ICgpID0+IHtcbiAgICAgIGFzc2VydC5lcXVhbChsZXZlbCwgMCk7XG4gICAgICByZXR1cm4gc3RyaW5ncy5qb2luKFwiXCIpO1xuICAgIH1cbiAgfSk7XG59O1xudmFyIGJhZFBhaXJQYXR0ZXJuID0gL14oPzpcXHdcXHd8PDx8Pj58XFwrXFwrfC0tfDwhfC0+KSQvO1xudmFyIG1ha2VOb0luZGVudGVyID0gKCkgPT4ge1xuICBjb25zdCBzdHJpbmdzID0gW107XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIG9wZW46IChvcGVuQnJhY2tldCkgPT4gc3RyaW5ncy5wdXNoKG9wZW5CcmFja2V0KSxcbiAgICBsaW5lOiAoKSA9PiBzdHJpbmdzLmxlbmd0aCxcbiAgICBuZXh0OiAodG9rZW4yKSA9PiB7XG4gICAgICBpZiAoc3RyaW5ncy5sZW5ndGggPj0gMSkge1xuICAgICAgICBjb25zdCBsYXN0ID0gc3RyaW5nc1tzdHJpbmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICBpZiAobGFzdC5sZW5ndGggPj0gMSAmJiB0b2tlbjIubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICBjb25zdCBwYWlyID0gYCR7bGFzdFtsYXN0Lmxlbmd0aCAtIDFdfSR7dG9rZW4yWzBdfWA7XG4gICAgICAgICAgaWYgKGJhZFBhaXJQYXR0ZXJuLnRlc3QocGFpcikpIHtcbiAgICAgICAgICAgIHN0cmluZ3MucHVzaChcIiBcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RyaW5ncy5wdXNoKHRva2VuMik7XG4gICAgfSxcbiAgICBjbG9zZTogKGNsb3NlQnJhY2tldCkgPT4ge1xuICAgICAgaWYgKHN0cmluZ3MubGVuZ3RoID49IDEgJiYgc3RyaW5nc1tzdHJpbmdzLmxlbmd0aCAtIDFdID09PSBcIixcIikge1xuICAgICAgICBzdHJpbmdzLnBvcCgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0cmluZ3MucHVzaChjbG9zZUJyYWNrZXQpO1xuICAgIH0sXG4gICAgZG9uZTogKCkgPT4gc3RyaW5ncy5qb2luKFwiXCIpXG4gIH0pO1xufTtcbnZhciBpZGVudFBhdHRlcm4gPSAvXlthLXpBLVpdXFx3KiQvO1xuaGFyZGVuKGlkZW50UGF0dGVybik7XG52YXIgQXRBdFByZWZpeFBhdHRlcm4yID0gL15AQCguKikkLztcbmhhcmRlbihBdEF0UHJlZml4UGF0dGVybjIpO1xudmFyIGRlY29kZVRvSnVzdGluID0gKGVuY29kaW5nLCBzaG91bGRJbmRlbnQgPSBmYWxzZSwgc2xvdHMgPSBbXSkgPT4ge1xuICBjb25zdCBwcmVwYXJlID0gKHJhd1RyZWUpID0+IHtcbiAgICBpZiAoIWlzT2JqZWN0MihyYXdUcmVlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBhc3NlcnQudHlwZW9mKHJhd1RyZWUsIFwib2JqZWN0XCIpO1xuICAgIGFzc2VydChyYXdUcmVlICE9PSBudWxsKTtcbiAgICBpZiAoUUNMQVNTIGluIHJhd1RyZWUpIHtcbiAgICAgIGNvbnN0IHFjbGFzcyA9IHJhd1RyZWVbUUNMQVNTXTtcbiAgICAgIHR5cGVvZiBxY2xhc3MgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIHFjbGFzcyB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgcWNsYXNzKX1gO1xuICAgICAgYXNzZXJ0KCFpc0FycmF5NyhyYXdUcmVlKSk7XG4gICAgICBzd2l0Y2ggKHJhd1RyZWVbXCJAcWNsYXNzXCJdKSB7XG4gICAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjpcbiAgICAgICAgY2FzZSBcIk5hTlwiOlxuICAgICAgICBjYXNlIFwiSW5maW5pdHlcIjpcbiAgICAgICAgY2FzZSBcIi1JbmZpbml0eVwiOiB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJiaWdpbnRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgZGlnaXRzIH0gPSByYXdUcmVlO1xuICAgICAgICAgIHR5cGVvZiBkaWdpdHMgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGRpZ2l0cyB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgZGlnaXRzKX1gO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiQEBhc3luY0l0ZXJhdG9yXCI6IHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSByYXdUcmVlO1xuICAgICAgICAgIGFzc2VydC50eXBlb2YobmFtZSwgXCJzdHJpbmdcIik7XG4gICAgICAgICAgY29uc3Qgc3ltID0gcGFzc2FibGVTeW1ib2xGb3JOYW1lKG5hbWUpO1xuICAgICAgICAgIGFzc2VydC50eXBlb2Yoc3ltLCBcInN5bWJvbFwiKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgICAgY29uc3QgeyB0YWcsIHBheWxvYWQgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZih0YWcsIFwic3RyaW5nXCIpO1xuICAgICAgICAgIHByZXBhcmUocGF5bG9hZCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzbG90XCI6IHtcbiAgICAgICAgICBjb25zdCB7IGluZGV4LCBpZmFjZSB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKGluZGV4LCBcIm51bWJlclwiKTtcbiAgICAgICAgICBOYXQoaW5kZXgpO1xuICAgICAgICAgIGlmIChpZmFjZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgICBhc3NlcnQudHlwZW9mKGlmYWNlLCBcInN0cmluZ1wiKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJoaWxiZXJ0XCI6IHtcbiAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsLCByZXN0IH0gPSByYXdUcmVlO1xuICAgICAgICAgIFwib3JpZ2luYWxcIiBpbiByYXdUcmVlIHx8IHRocm93UmVkYWN0ZWRgSW52YWxpZCBIaWxiZXJ0IEhvdGVsIGVuY29kaW5nICR7cmF3VHJlZX1gO1xuICAgICAgICAgIHByZXBhcmUob3JpZ2luYWwpO1xuICAgICAgICAgIGlmIChcInJlc3RcIiBpbiByYXdUcmVlKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHJlc3QgIT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN0ICR7cmVzdH0gZW5jb2RpbmcgbXVzdCBiZSBhbiBvYmplY3RgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlc3QgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN0ICR7cmVzdH0gZW5jb2RpbmcgbXVzdCBub3QgYmUgbnVsbGA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNBcnJheTcocmVzdCkpIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN0ICR7cmVzdH0gZW5jb2RpbmcgbXVzdCBub3QgYmUgYW4gYXJyYXlgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKFFDTEFTUyBpbiByZXN0KSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdCBlbmNvZGluZyAke3Jlc3R9IG11c3Qgbm90IGNvbnRhaW4gJHtxdW90ZShRQ0xBU1MpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBuYW1lcyA9IG93bktleXMxMyhyZXN0KTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykge1xuICAgICAgICAgICAgICB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYFByb3BlcnR5IG5hbWUgJHtuYW1lfSBvZiAke3Jhd1RyZWV9IG11c3QgYmUgYSBzdHJpbmdgO1xuICAgICAgICAgICAgICBwcmVwYXJlKHJlc3RbbmFtZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgICBjb25zdCB7IG5hbWUsIG1lc3NhZ2UgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgaWYgKHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludmFsaWQgZXJyb3IgbmFtZSB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgbmFtZSl9YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgZ2V0RXJyb3JDb25zdHJ1Y3RvcihuYW1lKSAhPT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgTXVzdCBiZSB0aGUgbmFtZSBvZiBhbiBFcnJvciBjb25zdHJ1Y3RvciAke25hbWV9YDtcbiAgICAgICAgICB0eXBlb2YgbWVzc2FnZSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGludmFsaWQgZXJyb3IgbWVzc2FnZSB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgbWVzc2FnZSl9YDtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIGFzc2VydC5mYWlsKHJlZGFjdGVkYHVucmVjb2duaXplZCAke3F1b3RlKFFDTEFTUyl9ICR7cXVvdGUocWNsYXNzKX1gLCBUeXBlRXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChpc0FycmF5NyhyYXdUcmVlKSkge1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHJhd1RyZWU7XG4gICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbGVuZ3RoOyBpMiArPSAxKSB7XG4gICAgICAgIHByZXBhcmUocmF3VHJlZVtpMl0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBuYW1lcyA9IG93bktleXMxMyhyYXdUcmVlKTtcbiAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykge1xuICAgICAgICBpZiAodHlwZW9mIG5hbWUgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFByb3BlcnR5IG5hbWUgJHtuYW1lfSBvZiAke3Jhd1RyZWV9IG11c3QgYmUgYSBzdHJpbmdgO1xuICAgICAgICB9XG4gICAgICAgIHByZXBhcmUocmF3VHJlZVtuYW1lXSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBtYWtlSW5kZW50ZXIgPSBzaG91bGRJbmRlbnQgPyBtYWtlWWVzSW5kZW50ZXIgOiBtYWtlTm9JbmRlbnRlcjtcbiAgbGV0IG91dCA9IG1ha2VJbmRlbnRlcigpO1xuICBjb25zdCBkZWNvZGUzID0gKHJhd1RyZWUpID0+IHtcbiAgICByZXR1cm4gcmVjdXIocmF3VHJlZSk7XG4gIH07XG4gIGNvbnN0IGRlY29kZVByb3BlcnR5ID0gKG5hbWUsIHZhbHVlKSA9PiB7XG4gICAgb3V0LmxpbmUoKTtcbiAgICBpZiAobmFtZSA9PT0gXCJfX3Byb3RvX19cIikge1xuICAgICAgb3V0Lm5leHQoYFtcIl9fcHJvdG9fX1wiXTpgKTtcbiAgICB9IGVsc2UgaWYgKGlkZW50UGF0dGVybi50ZXN0KG5hbWUpKSB7XG4gICAgICBvdXQubmV4dChgJHtuYW1lfTpgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3V0Lm5leHQoYCR7cXVvdGUyKG5hbWUpfTpgKTtcbiAgICB9XG4gICAgZGVjb2RlMyh2YWx1ZSk7XG4gICAgb3V0Lm5leHQoXCIsXCIpO1xuICB9O1xuICBjb25zdCByZWN1ciA9IChyYXdUcmVlKSA9PiB7XG4gICAgaWYgKCFpc09iamVjdDIocmF3VHJlZSkpIHtcbiAgICAgIHJldHVybiBvdXQubmV4dChxdW90ZTIocmF3VHJlZSkpO1xuICAgIH1cbiAgICBhc3NlcnQudHlwZW9mKHJhd1RyZWUsIFwib2JqZWN0XCIpO1xuICAgIGFzc2VydChyYXdUcmVlICE9PSBudWxsKTtcbiAgICBpZiAoUUNMQVNTIGluIHJhd1RyZWUpIHtcbiAgICAgIGNvbnN0IHFjbGFzcyA9IHJhd1RyZWVbUUNMQVNTXTtcbiAgICAgIGFzc2VydC50eXBlb2YocWNsYXNzLCBcInN0cmluZ1wiKTtcbiAgICAgIGFzc2VydCghaXNBcnJheTcocmF3VHJlZSkpO1xuICAgICAgc3dpdGNoIChyYXdUcmVlW1wiQHFjbGFzc1wiXSkge1xuICAgICAgICAvL1xuICAgICAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgICAgIGNhc2UgXCJOYU5cIjpcbiAgICAgICAgY2FzZSBcIkluZmluaXR5XCI6XG4gICAgICAgIGNhc2UgXCItSW5maW5pdHlcIjoge1xuICAgICAgICAgIHJldHVybiBvdXQubmV4dChxY2xhc3MpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJiaWdpbnRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgZGlnaXRzIH0gPSByYXdUcmVlO1xuICAgICAgICAgIGFzc2VydC50eXBlb2YoZGlnaXRzLCBcInN0cmluZ1wiKTtcbiAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoYCR7QmlnSW50KGRpZ2l0cyl9bmApO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJAQGFzeW5jSXRlcmF0b3JcIjoge1xuICAgICAgICAgIHJldHVybiBvdXQubmV4dChcIlN5bWJvbC5hc3luY0l0ZXJhdG9yXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgICAgIGNvbnN0IHsgbmFtZSB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKG5hbWUsIFwic3RyaW5nXCIpO1xuICAgICAgICAgIGNvbnN0IHN5bSA9IHBhc3NhYmxlU3ltYm9sRm9yTmFtZShuYW1lKTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKHN5bSwgXCJzeW1ib2xcIik7XG4gICAgICAgICAgY29uc3QgcmVnaXN0ZXJlZE5hbWUgPSBTeW1ib2wua2V5Rm9yKHN5bSk7XG4gICAgICAgICAgaWYgKHJlZ2lzdGVyZWROYW1lID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gQXRBdFByZWZpeFBhdHRlcm4yLmV4ZWMobmFtZSk7XG4gICAgICAgICAgICBhc3NlcnQobWF0Y2ggIT09IG51bGwpO1xuICAgICAgICAgICAgY29uc3Qgc3VmZml4ID0gbWF0Y2hbMV07XG4gICAgICAgICAgICBhc3NlcnQoU3ltYm9sW3N1ZmZpeF0gPT09IHN5bSk7XG4gICAgICAgICAgICBhc3NlcnQoaWRlbnRQYXR0ZXJuLnRlc3Qoc3VmZml4KSk7XG4gICAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoYFN5bWJvbC4ke3N1ZmZpeH1gKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGBTeW1ib2wuZm9yKCR7cXVvdGUyKHJlZ2lzdGVyZWROYW1lKX0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgICAgY29uc3QgeyB0YWcsIHBheWxvYWQgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgb3V0Lm5leHQoYG1ha2VUYWdnZWQoJHtxdW90ZTIodGFnKX0sYCk7XG4gICAgICAgICAgZGVjb2RlMyhwYXlsb2FkKTtcbiAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoXCIpXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzbG90XCI6IHtcbiAgICAgICAgICBsZXQgeyBpZmFjZSB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBjb25zdCBpbmRleCA9IE51bWJlcihOYXQocmF3VHJlZS5pbmRleCkpO1xuICAgICAgICAgIGNvbnN0IG5lc3RlZFJlbmRlciA9IChhcmcpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9sZE91dCA9IG91dDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIG91dCA9IG1ha2VOb0luZGVudGVyKCk7XG4gICAgICAgICAgICAgIGRlY29kZTMoYXJnKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG91dC5kb25lKCk7XG4gICAgICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgICBvdXQgPSBvbGRPdXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZiAoaW5kZXggPCBzbG90cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IHNsb3QgPSBuZXN0ZWRSZW5kZXIoc2xvdHNbaW5kZXhdKTtcbiAgICAgICAgICAgIGlmIChpZmFjZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiBvdXQubmV4dChgc2xvdFRvVmFsKCR7c2xvdH0pYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZmFjZSA9IG5lc3RlZFJlbmRlcihpZmFjZSk7XG4gICAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoYHNsb3RUb1ZhbCgke3Nsb3R9LCR7aWZhY2V9KWApO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaWZhY2UgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGBzbG90KCR7aW5kZXh9KWApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZmFjZSA9IG5lc3RlZFJlbmRlcihpZmFjZSk7XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGBzbG90KCR7aW5kZXh9LCR7aWZhY2V9KWApO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJoaWxiZXJ0XCI6IHtcbiAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsLCByZXN0IH0gPSByYXdUcmVlO1xuICAgICAgICAgIG91dC5vcGVuKFwie1wiKTtcbiAgICAgICAgICBkZWNvZGVQcm9wZXJ0eShRQ0xBU1MsIG9yaWdpbmFsKTtcbiAgICAgICAgICBpZiAoXCJyZXN0XCIgaW4gcmF3VHJlZSkge1xuICAgICAgICAgICAgYXNzZXJ0LnR5cGVvZihyZXN0LCBcIm9iamVjdFwiKTtcbiAgICAgICAgICAgIGFzc2VydChyZXN0ICE9PSBudWxsKTtcbiAgICAgICAgICAgIGNvbnN0IG5hbWVzID0gb3duS2V5czEzKHJlc3QpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIG5hbWVzKSB7XG4gICAgICAgICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUHJvcGVydHkgbmFtZSAke3F1b3RlKFxuICAgICAgICAgICAgICAgICAgbmFtZVxuICAgICAgICAgICAgICAgICl9IG9mICR7cmVzdH0gbXVzdCBiZSBhIHN0cmluZ2A7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZGVjb2RlUHJvcGVydHkobmFtZSwgcmVzdFtuYW1lXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBvdXQuY2xvc2UoXCJ9XCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICBjYXVzZSA9IHZvaWQgMCxcbiAgICAgICAgICAgIGVycm9ycyA9IHZvaWQgMFxuICAgICAgICAgIH0gPSByYXdUcmVlO1xuICAgICAgICAgIGNhdXNlID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBlcnJvciBjYXVzZSBub3QgeWV0IGltcGxlbWVudGVkIGluIG1hcnNoYWwtanVzdGluYDtcbiAgICAgICAgICBuYW1lICE9PSBgQWdncmVnYXRlRXJyb3JgIHx8IHRocm93UmVkYWN0ZWRgQWdncmVnYXRlRXJyb3Igbm90IHlldCBpbXBsZW1lbnRlZCBpbiBtYXJzaGFsLWp1c3RpbmA7XG4gICAgICAgICAgZXJyb3JzID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBlcnJvciBlcnJvcnMgbm90IHlldCBpbXBsZW1lbnRlZCBpbiBtYXJzaGFsLWp1c3RpbmA7XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGAke25hbWV9KCR7cXVvdGUyKG1lc3NhZ2UpfSlgKTtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgICByZWRhY3RlZGB1bnJlY29nbml6ZWQgJHtxdW90ZShRQ0xBU1MpfSAke3F1b3RlKHFjbGFzcyl9YCxcbiAgICAgICAgICAgIFR5cGVFcnJvclxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGlzQXJyYXk3KHJhd1RyZWUpKSB7XG4gICAgICBjb25zdCB7IGxlbmd0aCB9ID0gcmF3VHJlZTtcbiAgICAgIGlmIChsZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIG91dC5uZXh0KFwiW11cIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvdXQub3BlbihcIltcIik7XG4gICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBsZW5ndGg7IGkyICs9IDEpIHtcbiAgICAgICAgICBvdXQubGluZSgpO1xuICAgICAgICAgIGRlY29kZTMocmF3VHJlZVtpMl0pO1xuICAgICAgICAgIG91dC5uZXh0KFwiLFwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0LmNsb3NlKFwiXVwiKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbmFtZXMgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG93bktleXMxMyhyYXdUcmVlKVxuICAgICAgKTtcbiAgICAgIGlmIChuYW1lcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIG91dC5uZXh0KFwie31cIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvdXQub3BlbihcIntcIik7XG4gICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykge1xuICAgICAgICAgIGRlY29kZVByb3BlcnR5KG5hbWUsIHJhd1RyZWVbbmFtZV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXQuY2xvc2UoXCJ9XCIpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgcHJlcGFyZShlbmNvZGluZyk7XG4gIGRlY29kZTMoZW5jb2RpbmcpO1xuICByZXR1cm4gb3V0LmRvbmUoKTtcbn07XG5oYXJkZW4oZGVjb2RlVG9KdXN0aW4pO1xuXG4vL1xudmFyIHsgaXNBcnJheTogaXNBcnJheTggfSA9IEFycmF5O1xudmFyIHsgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzNSwgaXM6IGlzMyB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czE0IH0gPSBSZWZsZWN0O1xudmFyIHJDMCA9IC9bXFx4MDAtXFx4MUZdLztcbnZhciBnZXRTdWZmaXggPSAoc3RyLCBpbmRleCkgPT4gaW5kZXggPT09IDAgPyBzdHIgOiBzdHIuc3Vic3RyaW5nKGluZGV4KTtcbnZhciByZWNvcmROYW1lcyA9IChyZWNvcmQpID0+IChcbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgaGFyZGVuKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgb3duS2V5czE0KHJlY29yZCkuc29ydCgpLnJldmVyc2UoKVxuICApXG4pO1xuaGFyZGVuKHJlY29yZE5hbWVzKTtcbnZhciByZWNvcmRWYWx1ZXMgPSAocmVjb3JkLCBuYW1lcykgPT4gaGFyZGVuKG5hbWVzLm1hcCgobmFtZSkgPT4gcmVjb3JkW25hbWVdKSk7XG5oYXJkZW4ocmVjb3JkVmFsdWVzKTtcbnZhciB6ZXJvZXMgPSBBcnJheSgxNikuZmlsbCh2b2lkIDApLm1hcCgoXywgaTIpID0+IFwiMFwiLnJlcGVhdChpMikpO1xudmFyIHplcm9QYWQgPSAobjIsIHNpemUpID0+IHtcbiAgY29uc3QgblN0ciA9IGAke24yfWA7XG4gIGNvbnN0IGZpbGxMZW4gPSBzaXplIC0gblN0ci5sZW5ndGg7XG4gIGlmIChmaWxsTGVuID09PSAwKSByZXR1cm4gblN0cjtcbiAgYXNzZXJ0KGZpbGxMZW4gPiAwICYmIGZpbGxMZW4gPCB6ZXJvZXMubGVuZ3RoKTtcbiAgcmV0dXJuIGAke3plcm9lc1tmaWxsTGVuXX0ke25TdHJ9YDtcbn07XG5oYXJkZW4oemVyb1BhZCk7XG52YXIgYXNOdW1iZXIgPSBuZXcgRmxvYXQ2NEFycmF5KDEpO1xudmFyIGFzQml0cyA9IG5ldyBCaWdVaW50NjRBcnJheShhc051bWJlci5idWZmZXIpO1xudmFyIENhbm9uaWNhbE5hTkJpdHMgPSBcImZmZjgwMDAwMDAwMDAwMDBcIjtcbnZhciBlbmNvZGVCaW5hcnk2NCA9IChuMikgPT4ge1xuICBpZiAoaXMzKG4yLCAtMCkpIHtcbiAgICBuMiA9IDA7XG4gIH0gZWxzZSBpZiAoaXMzKG4yLCBOYU4pKSB7XG4gICAgcmV0dXJuIGBmJHtDYW5vbmljYWxOYU5CaXRzfWA7XG4gIH1cbiAgYXNOdW1iZXJbMF0gPSBuMjtcbiAgbGV0IGJpdHMgPSBhc0JpdHNbMF07XG4gIGlmIChuMiA8IDApIHtcbiAgICBiaXRzIF49IDB4ZmZmZmZmZmZmZmZmZmZmZm47XG4gIH0gZWxzZSB7XG4gICAgYml0cyBePSAweDgwMDAwMDAwMDAwMDAwMDBuO1xuICB9XG4gIHJldHVybiBgZiR7emVyb1BhZChiaXRzLnRvU3RyaW5nKDE2KSwgMTYpfWA7XG59O1xudmFyIGRlY29kZUJpbmFyeTY0ID0gKGVuY29kZWQsIHNraXAgPSAwKSA9PiB7XG4gIGVuY29kZWQuY2hhckF0KHNraXApID09PSBcImZcIiB8fCB0aHJvd1JlZGFjdGVkYEVuY29kZWQgbnVtYmVyIGV4cGVjdGVkOiAke2VuY29kZWR9YDtcbiAgbGV0IGJpdHMgPSBCaWdJbnQoYDB4JHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCArIDEpfWApO1xuICBpZiAoZW5jb2RlZC5jaGFyQXQoc2tpcCArIDEpIDwgXCI4XCIpIHtcbiAgICBiaXRzIF49IDB4ZmZmZmZmZmZmZmZmZmZmZm47XG4gIH0gZWxzZSB7XG4gICAgYml0cyBePSAweDgwMDAwMDAwMDAwMDAwMDBuO1xuICB9XG4gIGFzQml0c1swXSA9IGJpdHM7XG4gIGNvbnN0IHJlc3VsdCA9IGFzTnVtYmVyWzBdO1xuICAhaXMzKHJlc3VsdCwgLTApIHx8IHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCBuZWdhdGl2ZSB6ZXJvOiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBlbmNvZGVCaWdJbnQgPSAobjIpID0+IHtcbiAgY29uc3QgYWJzID0gbjIgPCAwbiA/IC1uMiA6IG4yO1xuICBjb25zdCBuRGlnaXRzID0gYWJzLnRvU3RyaW5nKCkubGVuZ3RoO1xuICBjb25zdCBsRGlnaXRzID0gbkRpZ2l0cy50b1N0cmluZygpLmxlbmd0aDtcbiAgaWYgKG4yIDwgMG4pIHtcbiAgICByZXR1cm4gYG4key8vXG4gICAgLy9cbiAgICBcIiNcIi5yZXBlYXQobERpZ2l0cyAtIDEpfSR7Ly9cbiAgICAoMTAgKiogbERpZ2l0cyAtIG5EaWdpdHMpLnRvU3RyaW5nKCkucGFkU3RhcnQobERpZ2l0cywgXCIwXCIpfTokey8vXG4gICAgKDEwbiAqKiBCaWdJbnQobkRpZ2l0cykgKyBuMikudG9TdHJpbmcoKS5wYWRTdGFydChuRGlnaXRzLCBcIjBcIil9YDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYHAkey8vXG4gICAgLy9cbiAgICBcIn5cIi5yZXBlYXQobERpZ2l0cyAtIDEpfSR7Ly9cbiAgICBuRGlnaXRzfTokey8vXG4gICAgbjJ9YDtcbiAgfVxufTtcbnZhciByQmlnSW50UGF5bG9hZCA9IC8oWzAtOV0rKSg6KFswLTldKyR8KXwpL3M7XG52YXIgZGVjb2RlQmlnSW50ID0gKGVuY29kZWQpID0+IHtcbiAgY29uc3QgdHlwZVByZWZpeCA9IGVuY29kZWQuY2hhckF0KDApO1xuICB0eXBlUHJlZml4ID09PSBcInBcIiB8fCB0eXBlUHJlZml4ID09PSBcIm5cIiB8fCB0aHJvd1JlZGFjdGVkYEVuY29kZWQgYmlnaW50IGV4cGVjdGVkOiAke2VuY29kZWR9YDtcbiAgY29uc3Qge1xuICAgIGluZGV4OiBsRGlnaXRzLFxuICAgIDE6IHNuRGlnaXRzLFxuICAgIDI6IHRhaWwsXG4gICAgMzogZGlnaXRzXG4gIH0gPSBlbmNvZGVkLm1hdGNoKHJCaWdJbnRQYXlsb2FkKSB8fCB0aHJvd1JlZGFjdGVkYERpZ2l0IGNvdW50IGV4cGVjdGVkOiAke2VuY29kZWR9YDtcbiAgc25EaWdpdHMubGVuZ3RoID09PSBsRGlnaXRzIHx8IHRocm93UmVkYWN0ZWRgVW5hcnktcHJlZml4ZWQgZGVjaW1hbCBkaWdpdCBjb3VudCBleHBlY3RlZDogJHtlbmNvZGVkfWA7XG4gIGxldCBuRGlnaXRzID0gcGFyc2VJbnQoc25EaWdpdHMsIDEwKTtcbiAgaWYgKHR5cGVQcmVmaXggPT09IFwiblwiKSB7XG4gICAgbkRpZ2l0cyA9IDEwICoqIC8qICAgICAgICAgICAgICAgICAqL1xuICAgIGxEaWdpdHMgLSBuRGlnaXRzO1xuICB9XG4gIHRhaWwuY2hhckF0KDApID09PSBcIjpcIiB8fCB0aHJvd1JlZGFjdGVkYFNlcGFyYXRvciBleHBlY3RlZDogJHtlbmNvZGVkfWA7XG4gIGRpZ2l0cy5sZW5ndGggPT09IG5EaWdpdHMgfHwgdGhyb3dSZWRhY3RlZGBGaXhlZC1sZW5ndGggZGlnaXQgc2VxdWVuY2UgZXhwZWN0ZWQ6ICR7ZW5jb2RlZH1gO1xuICBsZXQgbjIgPSBCaWdJbnQoZGlnaXRzKTtcbiAgaWYgKHR5cGVQcmVmaXggPT09IFwiblwiKSB7XG4gICAgbjIgPSAtKDEwbiAqKiBCaWdJbnQobkRpZ2l0cykgLSBuMik7XG4gIH1cbiAgcmV0dXJuIG4yO1xufTtcbnZhciBzdHJpbmdFc2NhcGVzID0gQXJyYXkoMzQpLmZpbGwodm9pZCAwKS5tYXAoKF8sIGNwKSA9PiB7XG4gIHN3aXRjaCAoU3RyaW5nLmZyb21DaGFyQ29kZShjcCkpIHtcbiAgICBjYXNlIFwiIFwiOlxuICAgICAgcmV0dXJuIFwiIV9cIjtcbiAgICBjYXNlIFwiIVwiOlxuICAgICAgcmV0dXJuIFwiIXxcIjtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIGAhJHtTdHJpbmcuZnJvbUNoYXJDb2RlKGNwICsgMzMpfWA7XG4gIH1cbn0pO1xuc3RyaW5nRXNjYXBlc1tcIl5cIi5jaGFyQ29kZUF0KDApXSA9IFwiX0BcIjtcbnN0cmluZ0VzY2FwZXNbXCJfXCIuY2hhckNvZGVBdCgwKV0gPSBcIl9fXCI7XG52YXIgZW5jb2RlQ29tcGFjdFN0cmluZ1N1ZmZpeCA9IChzdHIpID0+IHN0ci5yZXBsYWNlKC9bXFwwLSFeX10vZywgKGNoKSA9PiBzdHJpbmdFc2NhcGVzW2NoLmNoYXJDb2RlQXQoMCldKTtcbnZhciBkZWNvZGVDb21wYWN0U3RyaW5nU3VmZml4ID0gKGVuY29kZWQpID0+IHtcbiAgcmV0dXJuIGVuY29kZWQucmVwbGFjZSgvKFtcXDAtIV9dKSgufFxcbik/L2csIChlc2MsIHByZWZpeCwgc3VmZml4KSA9PiB7XG4gICAgc3dpdGNoIChlc2MpIHtcbiAgICAgIGNhc2UgXCIhX1wiOlxuICAgICAgICByZXR1cm4gXCIgXCI7XG4gICAgICBjYXNlIFwiIXxcIjpcbiAgICAgICAgcmV0dXJuIFwiIVwiO1xuICAgICAgY2FzZSBcIl9AXCI6XG4gICAgICAgIHJldHVybiBcIl5cIjtcbiAgICAgIGNhc2UgXCJfX1wiOlxuICAgICAgICByZXR1cm4gXCJfXCI7XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIGNvbnN0IGNoID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHN1ZmZpeFxuICAgICAgICApO1xuICAgICAgICBwcmVmaXggPT09IFwiIVwiICYmIHN1ZmZpeCAhPT0gdm9pZCAwICYmIGNoID49IFwiIVwiICYmIGNoIDw9IFwiQFwiIHx8IHRocm93UmVkYWN0ZWRgaW52YWxpZCBzdHJpbmcgZXNjYXBlOiAke3F1b3RlKGVzYyl9YDtcbiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2guY2hhckNvZGVBdCgwKSAtIDMzKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBlbmNvZGVMZWdhY3lTdHJpbmdTdWZmaXggPSAoc3RyKSA9PiBzdHI7XG52YXIgZGVjb2RlTGVnYWN5U3RyaW5nU3VmZml4ID0gKGVuY29kZWQpID0+IGVuY29kZWQ7XG52YXIgZW5jb2RlQ29tcGFjdEFycmF5ID0gKGFycmF5LCBlbmNvZGVQYXNzYWJsZSkgPT4ge1xuICBjb25zdCBjaGFycyA9IFtcIl5cIl07XG4gIGZvciAoY29uc3QgZWxlbWVudCBvZiBhcnJheSkge1xuICAgIGNvbnN0IGVuYyA9IGVuY29kZVBhc3NhYmxlKGVsZW1lbnQpO1xuICAgIGNoYXJzLnB1c2goZW5jLCBcIiBcIik7XG4gIH1cbiAgcmV0dXJuIGNoYXJzLmpvaW4oXCJcIik7XG59O1xudmFyIGRlY29kZUNvbXBhY3RBcnJheSA9IChlbmNvZGVkLCBkZWNvZGVQYXNzYWJsZSwgc2tpcCA9IDApID0+IHtcbiAgY29uc3QgZWxlbWVudHMgPSBbXTtcbiAgbGV0IGRlcHRoID0gMDtcbiAgbGV0IG5leHRJbmRleCA9IHNraXAgKyAxO1xuICBsZXQgY3VycmVudEVsZW1lbnRTdGFydCA9IHNraXAgKyAxO1xuICBmb3IgKGNvbnN0IHsgMDogY2gsIGluZGV4OiBpMiB9IG9mIGVuY29kZWQubWF0Y2hBbGwoL1tcXF4gXS9nKSkge1xuICAgIGNvbnN0IGluZGV4ID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICBpMlxuICAgICk7XG4gICAgaWYgKGluZGV4IDw9IHNraXApIHtcbiAgICAgIGlmIChpbmRleCA9PT0gc2tpcCkge1xuICAgICAgICBjaCA9PT0gXCJeXCIgfHwgdGhyb3dSZWRhY3RlZGBFbmNvZGVkIGFycmF5IGV4cGVjdGVkOiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY2ggPT09IFwiXlwiKSB7XG4gICAgICBkZXB0aCArPSAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoaW5kZXggPT09IG5leHRJbmRleCkge1xuICAgICAgICBkZXB0aCAtPSAxO1xuICAgICAgICBkZXB0aCA+PSAwIHx8IC8vXG4gICAgICAgIHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBhcnJheSBlbGVtZW50IHRlcm1pbmF0b3I6ICR7ZW5jb2RlZC5zbGljZShza2lwLCBpbmRleCArIDIpfWA7XG4gICAgICB9XG4gICAgICBpZiAoZGVwdGggPT09IDApIHtcbiAgICAgICAgZWxlbWVudHMucHVzaChcbiAgICAgICAgICBkZWNvZGVQYXNzYWJsZShlbmNvZGVkLnNsaWNlKGN1cnJlbnRFbGVtZW50U3RhcnQsIGluZGV4KSlcbiAgICAgICAgKTtcbiAgICAgICAgY3VycmVudEVsZW1lbnRTdGFydCA9IGluZGV4ICsgMTtcbiAgICAgIH1cbiAgICB9XG4gICAgbmV4dEluZGV4ID0gaW5kZXggKyAxO1xuICB9XG4gIGRlcHRoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgdW50ZXJtaW5hdGVkIGFycmF5OiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICBuZXh0SW5kZXggPT09IGVuY29kZWQubGVuZ3RoIHx8IHRocm93UmVkYWN0ZWRgdW50ZXJtaW5hdGVkIGFycmF5IGVsZW1lbnQ6ICR7Z2V0U3VmZml4KFxuICAgIGVuY29kZWQsXG4gICAgY3VycmVudEVsZW1lbnRTdGFydFxuICApfWA7XG4gIHJldHVybiBoYXJkZW4oZWxlbWVudHMpO1xufTtcbnZhciBlbmNvZGVMZWdhY3lBcnJheSA9IChhcnJheSwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgY29uc3QgY2hhcnMgPSBbXCJbXCJdO1xuICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgYXJyYXkpIHtcbiAgICBjb25zdCBlbmMgPSBlbmNvZGVQYXNzYWJsZShlbGVtZW50KTtcbiAgICBmb3IgKGNvbnN0IGMyIG9mIGVuYykge1xuICAgICAgaWYgKGMyID09PSBcIlxcMFwiIHx8IGMyID09PSBcIlx1MDAwMVwiKSB7XG4gICAgICAgIGNoYXJzLnB1c2goXCJcdTAwMDFcIik7XG4gICAgICB9XG4gICAgICBjaGFycy5wdXNoKGMyKTtcbiAgICB9XG4gICAgY2hhcnMucHVzaChcIlxcMFwiKTtcbiAgfVxuICByZXR1cm4gY2hhcnMuam9pbihcIlwiKTtcbn07XG52YXIgZGVjb2RlTGVnYWN5QXJyYXkgPSAoZW5jb2RlZCwgZGVjb2RlUGFzc2FibGUsIHNraXAgPSAwKSA9PiB7XG4gIGNvbnN0IGVsZW1lbnRzID0gW107XG4gIGNvbnN0IGVsZW1DaGFycyA9IFtdO1xuICBsZXQgc3RpbGxUb1NraXAgPSBza2lwICsgMTtcbiAgbGV0IGluRXNjYXBlID0gZmFsc2U7XG4gIGZvciAoY29uc3QgYzIgb2YgZW5jb2RlZCkge1xuICAgIGlmIChzdGlsbFRvU2tpcCA+IDApIHtcbiAgICAgIHN0aWxsVG9Ta2lwIC09IDE7XG4gICAgICBpZiAoc3RpbGxUb1NraXAgPT09IDApIHtcbiAgICAgICAgYzIgPT09IFwiW1wiIHx8IHRocm93UmVkYWN0ZWRgRW5jb2RlZCBhcnJheSBleHBlY3RlZDogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGluRXNjYXBlKSB7XG4gICAgICBjMiA9PT0gXCJcXDBcIiB8fCBjMiA9PT0gXCJcdTAwMDFcIiB8fCB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgY2hhcmFjdGVyIGFmdGVyIHUwMDAxIGVzY2FwZTogJHtjMn1gO1xuICAgICAgZWxlbUNoYXJzLnB1c2goYzIpO1xuICAgIH0gZWxzZSBpZiAoYzIgPT09IFwiXFwwXCIpIHtcbiAgICAgIGNvbnN0IGVuY29kZWRFbGVtZW50ID0gZWxlbUNoYXJzLmpvaW4oXCJcIik7XG4gICAgICBlbGVtQ2hhcnMubGVuZ3RoID0gMDtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBkZWNvZGVQYXNzYWJsZShlbmNvZGVkRWxlbWVudCk7XG4gICAgICBlbGVtZW50cy5wdXNoKGVsZW1lbnQpO1xuICAgIH0gZWxzZSBpZiAoYzIgPT09IFwiXHUwMDAxXCIpIHtcbiAgICAgIGluRXNjYXBlID0gdHJ1ZTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtQ2hhcnMucHVzaChjMik7XG4gICAgfVxuICAgIGluRXNjYXBlID0gZmFsc2U7XG4gIH1cbiAgIWluRXNjYXBlIHx8IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBlbmQgb2YgZW5jb2RpbmcgJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgZWxlbUNoYXJzLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYGVuY29kaW5nIHRlcm1pbmF0ZWQgZWFybHk6ICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gIHJldHVybiBoYXJkZW4oZWxlbWVudHMpO1xufTtcbnZhciBlbmNvZGVSZWNvcmQgPSAocmVjb3JkLCBlbmNvZGVBcnJheSwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgY29uc3QgbmFtZXMgPSByZWNvcmROYW1lcyhyZWNvcmQpO1xuICBjb25zdCB2YWx1ZXM2ID0gcmVjb3JkVmFsdWVzKHJlY29yZCwgbmFtZXMpO1xuICByZXR1cm4gYCgke2VuY29kZUFycmF5KGhhcmRlbihbbmFtZXMsIHZhbHVlczZdKSwgZW5jb2RlUGFzc2FibGUpfWA7XG59O1xudmFyIGRlY29kZVJlY29yZCA9IChlbmNvZGVkLCBkZWNvZGVBcnJheSwgZGVjb2RlUGFzc2FibGUsIHNraXAgPSAwKSA9PiB7XG4gIGFzc2VydChlbmNvZGVkLmNoYXJBdChza2lwKSA9PT0gXCIoXCIpO1xuICBjb25zdCB1bnppcHBlZEVudHJpZXMgPSBkZWNvZGVBcnJheShlbmNvZGVkLCBkZWNvZGVQYXNzYWJsZSwgc2tpcCArIDEpO1xuICB1bnppcHBlZEVudHJpZXMubGVuZ3RoID09PSAyIHx8IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQga2V5cyx2YWx1ZXMgcGFpcjogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgY29uc3QgW2tleXM0LCB2YWxzXSA9IHVuemlwcGVkRW50cmllcztcbiAgcGFzc1N0eWxlT2Yoa2V5czQpID09PSBcImNvcHlBcnJheVwiICYmIHBhc3NTdHlsZU9mKHZhbHMpID09PSBcImNvcHlBcnJheVwiICYmIGtleXM0Lmxlbmd0aCA9PT0gdmFscy5sZW5ndGggJiYga2V5czQuZXZlcnkoKGtleSkgPT4gdHlwZW9mIGtleSA9PT0gXCJzdHJpbmdcIikgfHwgdGhyb3dSZWRhY3RlZGBub3QgYSB2YWxpZCByZWNvcmQgZW5jb2Rpbmc6ICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gIGNvbnN0IG1hcEVudHJpZXMgPSBrZXlzNC5tYXAoKGtleSwgaTIpID0+IFtrZXksIHZhbHNbaTJdXSk7XG4gIGNvbnN0IHJlY29yZCA9IGhhcmRlbihmcm9tRW50cmllczUobWFwRW50cmllcykpO1xuICBhc3NlcnRSZWNvcmQocmVjb3JkLCBcImRlY29kZWQgcmVjb3JkXCIpO1xuICByZXR1cm4gcmVjb3JkO1xufTtcbnZhciBlbmNvZGVUYWdnZWQgPSAodGFnZ2VkLCBlbmNvZGVBcnJheSwgZW5jb2RlUGFzc2FibGUpID0+IGA6JHtlbmNvZGVBcnJheShoYXJkZW4oW2dldFRhZyh0YWdnZWQpLCB0YWdnZWQucGF5bG9hZF0pLCBlbmNvZGVQYXNzYWJsZSl9YDtcbnZhciBkZWNvZGVUYWdnZWQgPSAoZW5jb2RlZCwgZGVjb2RlQXJyYXksIGRlY29kZVBhc3NhYmxlLCBza2lwID0gMCkgPT4ge1xuICBhc3NlcnQoZW5jb2RlZC5jaGFyQXQoc2tpcCkgPT09IFwiOlwiKTtcbiAgY29uc3QgdGFnZ2VkUGF5bG9hZCA9IGRlY29kZUFycmF5KGVuY29kZWQsIGRlY29kZVBhc3NhYmxlLCBza2lwICsgMSk7XG4gIHRhZ2dlZFBheWxvYWQubGVuZ3RoID09PSAyIHx8IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQgdGFnLHBheWxvYWQgcGFpcjogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgY29uc3QgW3RhZywgcGF5bG9hZF0gPSB0YWdnZWRQYXlsb2FkO1xuICBwYXNzU3R5bGVPZih0YWcpID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgbm90IGEgdmFsaWQgdGFnZ2VkIGVuY29kaW5nOiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICByZXR1cm4gbWFrZVRhZ2dlZCh0YWcsIHBheWxvYWQpO1xufTtcbnZhciBtYWtlRW5jb2RlUmVtb3RhYmxlID0gKHVuc2FmZUVuY29kZVJlbW90YWJsZSwgdmVyaWZ5RW5jb2RpbmcpID0+IHtcbiAgY29uc3QgZW5jb2RlUmVtb3RhYmxlID0gKHI1LCBpbm5lckVuY29kZSkgPT4ge1xuICAgIGNvbnN0IGVuY29kaW5nID0gdW5zYWZlRW5jb2RlUmVtb3RhYmxlKHI1LCBpbm5lckVuY29kZSk7XG4gICAgdHlwZW9mIGVuY29kaW5nID09PSBcInN0cmluZ1wiICYmIGVuY29kaW5nLmNoYXJBdCgwKSA9PT0gXCJyXCIgfHwgdGhyb3dSZWRhY3RlZGBSZW1vdGFibGUgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiclwiOiAke2VuY29kaW5nfWA7XG4gICAgdmVyaWZ5RW5jb2RpbmcoZW5jb2RpbmcsIFwiUmVtb3RhYmxlXCIpO1xuICAgIHJldHVybiBlbmNvZGluZztcbiAgfTtcbiAgcmV0dXJuIGVuY29kZVJlbW90YWJsZTtcbn07XG52YXIgbWFrZUVuY29kZVByb21pc2UgPSAodW5zYWZlRW5jb2RlUHJvbWlzZSwgdmVyaWZ5RW5jb2RpbmcpID0+IHtcbiAgY29uc3QgZW5jb2RlUHJvbWlzZSA9IChwMywgaW5uZXJFbmNvZGUpID0+IHtcbiAgICBjb25zdCBlbmNvZGluZyA9IHVuc2FmZUVuY29kZVByb21pc2UocDMsIGlubmVyRW5jb2RlKTtcbiAgICB0eXBlb2YgZW5jb2RpbmcgPT09IFwic3RyaW5nXCIgJiYgZW5jb2RpbmcuY2hhckF0KDApID09PSBcIj9cIiB8fCB0aHJvd1JlZGFjdGVkYFByb21pc2UgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiP1wiOiAke2VuY29kaW5nfWA7XG4gICAgdmVyaWZ5RW5jb2RpbmcoZW5jb2RpbmcsIFwiUHJvbWlzZVwiKTtcbiAgICByZXR1cm4gZW5jb2Rpbmc7XG4gIH07XG4gIHJldHVybiBlbmNvZGVQcm9taXNlO1xufTtcbnZhciBtYWtlRW5jb2RlRXJyb3IgPSAodW5zYWZlRW5jb2RlRXJyb3IsIHZlcmlmeUVuY29kaW5nKSA9PiB7XG4gIGNvbnN0IGVuY29kZUVycm9yID0gKGVyciwgaW5uZXJFbmNvZGUpID0+IHtcbiAgICBjb25zdCBlbmNvZGluZyA9IHVuc2FmZUVuY29kZUVycm9yKGVyciwgaW5uZXJFbmNvZGUpO1xuICAgIHR5cGVvZiBlbmNvZGluZyA9PT0gXCJzdHJpbmdcIiAmJiBlbmNvZGluZy5jaGFyQXQoMCkgPT09IFwiIVwiIHx8IHRocm93UmVkYWN0ZWRgRXJyb3IgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiIVwiOiAke2VuY29kaW5nfWA7XG4gICAgdmVyaWZ5RW5jb2RpbmcoZW5jb2RpbmcsIFwiRXJyb3JcIik7XG4gICAgcmV0dXJuIGVuY29kaW5nO1xuICB9O1xuICByZXR1cm4gZW5jb2RlRXJyb3I7XG59O1xudmFyIG1ha2VJbm5lckVuY29kZSA9IChlbmNvZGVTdHJpbmdTdWZmaXgsIGVuY29kZUFycmF5LCBvcHRpb25zKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBlbmNvZGVSZW1vdGFibGU6IHVuc2FmZUVuY29kZVJlbW90YWJsZSxcbiAgICBlbmNvZGVQcm9taXNlOiB1bnNhZmVFbmNvZGVQcm9taXNlLFxuICAgIGVuY29kZUVycm9yOiB1bnNhZmVFbmNvZGVFcnJvcixcbiAgICB2ZXJpZnlFbmNvZGluZyA9ICgpID0+IHtcbiAgICB9XG4gIH0gPSBvcHRpb25zO1xuICBjb25zdCBlbmNvZGVSZW1vdGFibGUgPSBtYWtlRW5jb2RlUmVtb3RhYmxlKFxuICAgIHVuc2FmZUVuY29kZVJlbW90YWJsZSxcbiAgICB2ZXJpZnlFbmNvZGluZ1xuICApO1xuICBjb25zdCBlbmNvZGVQcm9taXNlID0gbWFrZUVuY29kZVByb21pc2UodW5zYWZlRW5jb2RlUHJvbWlzZSwgdmVyaWZ5RW5jb2RpbmcpO1xuICBjb25zdCBlbmNvZGVFcnJvciA9IG1ha2VFbmNvZGVFcnJvcih1bnNhZmVFbmNvZGVFcnJvciwgdmVyaWZ5RW5jb2RpbmcpO1xuICBjb25zdCBpbm5lckVuY29kZSA9IChwYXNzYWJsZSkgPT4ge1xuICAgIGlmIChpc0Vycm9yTGlrZShwYXNzYWJsZSkpIHtcbiAgICAgIHJldHVybiBlbmNvZGVFcnJvcihwYXNzYWJsZSwgaW5uZXJFbmNvZGUpO1xuICAgIH1cbiAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihwYXNzYWJsZSk7XG4gICAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICAgIGNhc2UgXCJudWxsXCI6IHtcbiAgICAgICAgcmV0dXJuIFwidlwiO1xuICAgICAgfVxuICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOiB7XG4gICAgICAgIHJldHVybiBcInpcIjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJudW1iZXJcIjoge1xuICAgICAgICByZXR1cm4gZW5jb2RlQmluYXJ5NjQocGFzc2FibGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgIHJldHVybiBgcyR7ZW5jb2RlU3RyaW5nU3VmZml4KHBhc3NhYmxlKX1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJvb2xlYW5cIjoge1xuICAgICAgICByZXR1cm4gYGIke3Bhc3NhYmxlfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZUJpZ0ludChwYXNzYWJsZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZVJlbW90YWJsZShwYXNzYWJsZSwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZUVycm9yKHBhc3NhYmxlLCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVQcm9taXNlKHBhc3NhYmxlLCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgY29uc3QgbmFtZSA9IG5hbWVGb3JQYXNzYWJsZVN5bWJvbChwYXNzYWJsZSk7XG4gICAgICAgIGFzc2VydC50eXBlb2YobmFtZSwgXCJzdHJpbmdcIik7XG4gICAgICAgIHJldHVybiBgeSR7ZW5jb2RlU3RyaW5nU3VmZml4KG5hbWUpfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZUFycmF5KHBhc3NhYmxlLCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVSZWNvcmQocGFzc2FibGUsIGVuY29kZUFycmF5LCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZVRhZ2dlZChwYXNzYWJsZSwgZW5jb2RlQXJyYXksIGlubmVyRW5jb2RlKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBhICR7cXVvdGUocGFzc1N0eWxlKX0gY2Fubm90IGJlIHVzZWQgYXMgYSBjb2xsZWN0aW9uIHBhc3NhYmxlYDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiBpbm5lckVuY29kZTtcbn07XG52YXIgbGliZXJhbERlY29kZXJzID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAvKiAgICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBkZWNvZGVSZW1vdGFibGU6IChfZW5jb2RpbmcsIF9pbm5lckRlY29kZSkgPT4gdm9pZCAwLFxuICAgIGRlY29kZVByb21pc2U6IChfZW5jb2RpbmcsIF9pbm5lckRlY29kZSkgPT4gdm9pZCAwLFxuICAgIGRlY29kZUVycm9yOiAoX2VuY29kaW5nLCBfaW5uZXJEZWNvZGUpID0+IHZvaWQgMFxuICB9XG4pO1xudmFyIG1ha2VJbm5lckRlY29kZSA9IChkZWNvZGVTdHJpbmdTdWZmaXgsIGRlY29kZUFycmF5LCBvcHRpb25zKSA9PiB7XG4gIGNvbnN0IHsgZGVjb2RlUmVtb3RhYmxlLCBkZWNvZGVQcm9taXNlLCBkZWNvZGVFcnJvciB9ID0gb3B0aW9ucztcbiAgY29uc3QgaW5uZXJEZWNvZGUgPSAoZW5jb2RlZCwgc2tpcCA9IDApID0+IHtcbiAgICBzd2l0Y2ggKGVuY29kZWQuY2hhckF0KHNraXApKSB7XG4gICAgICBjYXNlIFwidlwiOiB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY2FzZSBcInpcIjoge1xuICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgfVxuICAgICAgY2FzZSBcImZcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlQmluYXJ5NjQoZW5jb2RlZCwgc2tpcCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwic1wiOiB7XG4gICAgICAgIHJldHVybiBkZWNvZGVTdHJpbmdTdWZmaXgoZ2V0U3VmZml4KGVuY29kZWQsIHNraXAgKyAxKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYlwiOiB7XG4gICAgICAgIGNvbnN0IHN1YnN0cmluZyA9IGdldFN1ZmZpeChlbmNvZGVkLCBza2lwICsgMSk7XG4gICAgICAgIGlmIChzdWJzdHJpbmcgPT09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoc3Vic3RyaW5nID09PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBleHBlY3RlZCBlbmNvZGVkIGJvb2xlYW4gdG8gYmUgXCJidHJ1ZVwiIG9yIFwiYmZhbHNlXCI6ICR7c3Vic3RyaW5nfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiblwiOlxuICAgICAgY2FzZSBcInBcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlQmlnSW50KGdldFN1ZmZpeChlbmNvZGVkLCBza2lwKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiclwiOiB7XG4gICAgICAgIHJldHVybiBkZWNvZGVSZW1vdGFibGUoZ2V0U3VmZml4KGVuY29kZWQsIHNraXApLCBpbm5lckRlY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiP1wiOiB7XG4gICAgICAgIHJldHVybiBkZWNvZGVQcm9taXNlKGdldFN1ZmZpeChlbmNvZGVkLCBza2lwKSwgaW5uZXJEZWNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcIiFcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlRXJyb3IoZ2V0U3VmZml4KGVuY29kZWQsIHNraXApLCBpbm5lckRlY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwieVwiOiB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBkZWNvZGVTdHJpbmdTdWZmaXgoZ2V0U3VmZml4KGVuY29kZWQsIHNraXAgKyAxKSk7XG4gICAgICAgIHJldHVybiBwYXNzYWJsZVN5bWJvbEZvck5hbWUobmFtZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiW1wiOlxuICAgICAgY2FzZSBcIl5cIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlQXJyYXkoZW5jb2RlZCwgaW5uZXJEZWNvZGUsIHNraXApO1xuICAgICAgfVxuICAgICAgY2FzZSBcIihcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlUmVjb3JkKGVuY29kZWQsIGRlY29kZUFycmF5LCBpbm5lckRlY29kZSwgc2tpcCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiOlwiOiB7XG4gICAgICAgIHJldHVybiBkZWNvZGVUYWdnZWQoZW5jb2RlZCwgZGVjb2RlQXJyYXksIGlubmVyRGVjb2RlLCBza2lwKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGRhdGFiYXNlIGtleTogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiBpbm5lckRlY29kZTtcbn07XG52YXIgbWFrZVBhc3NhYmxlS2l0ID0gKG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgZW5jb2RlUmVtb3RhYmxlID0gKHI1LCBfKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke3I1fWAsXG4gICAgZW5jb2RlUHJvbWlzZSA9IChwMywgXykgPT4gdGhyb3dSZWRhY3RlZGBwcm9taXNlIHVuZXhwZWN0ZWQ6ICR7cDN9YCxcbiAgICBlbmNvZGVFcnJvciA9IChlcnIsIF8pID0+IHRocm93UmVkYWN0ZWRgZXJyb3IgdW5leHBlY3RlZDogJHtlcnJ9YCxcbiAgICBmb3JtYXQgPSBcImxlZ2FjeU9yZGVyZWRcIixcbiAgICBkZWNvZGVSZW1vdGFibGUgPSAoZW5jb2RpbmcsIF8pID0+IHRocm93UmVkYWN0ZWRgcmVtb3RhYmxlIHVuZXhwZWN0ZWQ6ICR7ZW5jb2Rpbmd9YCxcbiAgICBkZWNvZGVQcm9taXNlID0gKGVuY29kaW5nLCBfKSA9PiB0aHJvd1JlZGFjdGVkYHByb21pc2UgdW5leHBlY3RlZDogJHtlbmNvZGluZ31gLFxuICAgIGRlY29kZUVycm9yID0gKGVuY29kaW5nLCBfKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIHVuZXhwZWN0ZWQ6ICR7ZW5jb2Rpbmd9YFxuICB9ID0gb3B0aW9ucztcbiAgbGV0IGVuY29kZVBhc3NhYmxlO1xuICBjb25zdCBlbmNvZGVPcHRpb25zID0geyBlbmNvZGVSZW1vdGFibGUsIGVuY29kZVByb21pc2UsIGVuY29kZUVycm9yLCBmb3JtYXQgfTtcbiAgaWYgKGZvcm1hdCA9PT0gXCJjb21wYWN0T3JkZXJlZFwiKSB7XG4gICAgY29uc3QgbGliZXJhbERlY29kZSA9IG1ha2VJbm5lckRlY29kZShcbiAgICAgIGRlY29kZUNvbXBhY3RTdHJpbmdTdWZmaXgsXG4gICAgICBkZWNvZGVDb21wYWN0QXJyYXksXG4gICAgICBsaWJlcmFsRGVjb2RlcnNcbiAgICApO1xuICAgIGNvbnN0IHZlcmlmeUVuY29kaW5nID0gKGVuY29kaW5nLCBsYWJlbCkgPT4ge1xuICAgICAgIWVuY29kaW5nLm1hdGNoKHJDMCkgfHwgdGhyb3dSZWRhY3RlZGAke2JhcmVPclF1b3RlKFxuICAgICAgICBsYWJlbFxuICAgICAgKX0gZW5jb2RpbmcgbXVzdCBub3QgY29udGFpbiBhIEMwIGNvbnRyb2wgY2hhcmFjdGVyOiAke2VuY29kaW5nfWA7XG4gICAgICBjb25zdCBkZWNvZGVkID0gZGVjb2RlQ29tcGFjdEFycmF5KGBediAke2VuY29kaW5nfSB2IGAsIGxpYmVyYWxEZWNvZGUpO1xuICAgICAgaXNBcnJheTgoZGVjb2RlZCkgJiYgZGVjb2RlZC5sZW5ndGggPT09IDMgJiYgZGVjb2RlZFswXSA9PT0gbnVsbCAmJiBkZWNvZGVkWzJdID09PSBudWxsIHx8IHRocm93UmVkYWN0ZWRgJHtiYXJlT3JRdW90ZShsYWJlbCl9IGVuY29kaW5nIG11c3QgYmUgZW1iZWRkYWJsZTogJHtlbmNvZGluZ31gO1xuICAgIH07XG4gICAgY29uc3QgZW5jb2RlQ29tcGFjdCA9IG1ha2VJbm5lckVuY29kZShcbiAgICAgIGVuY29kZUNvbXBhY3RTdHJpbmdTdWZmaXgsXG4gICAgICBlbmNvZGVDb21wYWN0QXJyYXksXG4gICAgICB7IC4uLmVuY29kZU9wdGlvbnMsIHZlcmlmeUVuY29kaW5nIH1cbiAgICApO1xuICAgIGVuY29kZVBhc3NhYmxlID0gKHBhc3NhYmxlKSA9PiBgfiR7ZW5jb2RlQ29tcGFjdChwYXNzYWJsZSl9YDtcbiAgfSBlbHNlIGlmIChmb3JtYXQgPT09IFwibGVnYWN5T3JkZXJlZFwiKSB7XG4gICAgZW5jb2RlUGFzc2FibGUgPSBtYWtlSW5uZXJFbmNvZGUoXG4gICAgICBlbmNvZGVMZWdhY3lTdHJpbmdTdWZmaXgsXG4gICAgICBlbmNvZGVMZWdhY3lBcnJheSxcbiAgICAgIGVuY29kZU9wdGlvbnNcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIHRocm93IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIGZvcm1hdDogJHtxdW90ZShmb3JtYXQpfWA7XG4gIH1cbiAgY29uc3QgZGVjb2RlT3B0aW9ucyA9IHsgZGVjb2RlUmVtb3RhYmxlLCBkZWNvZGVQcm9taXNlLCBkZWNvZGVFcnJvciB9O1xuICBjb25zdCBkZWNvZGVDb21wYWN0ID0gbWFrZUlubmVyRGVjb2RlKFxuICAgIGRlY29kZUNvbXBhY3RTdHJpbmdTdWZmaXgsXG4gICAgZGVjb2RlQ29tcGFjdEFycmF5LFxuICAgIGRlY29kZU9wdGlvbnNcbiAgKTtcbiAgY29uc3QgZGVjb2RlTGVnYWN5ID0gbWFrZUlubmVyRGVjb2RlKFxuICAgIGRlY29kZUxlZ2FjeVN0cmluZ1N1ZmZpeCxcbiAgICBkZWNvZGVMZWdhY3lBcnJheSxcbiAgICBkZWNvZGVPcHRpb25zXG4gICk7XG4gIGNvbnN0IGRlY29kZVBhc3NhYmxlID0gKGVuY29kZWQpID0+IHtcbiAgICBpZiAoZW5jb2RlZC5jaGFyQXQoMCkgPT09IFwiflwiKSB7XG4gICAgICByZXR1cm4gZGVjb2RlQ29tcGFjdChlbmNvZGVkLCAxKTtcbiAgICB9XG4gICAgcmV0dXJuIGRlY29kZUxlZ2FjeShlbmNvZGVkKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IGVuY29kZVBhc3NhYmxlLCBkZWNvZGVQYXNzYWJsZSB9KTtcbn07XG5oYXJkZW4obWFrZVBhc3NhYmxlS2l0KTtcbnZhciBtYWtlRW5jb2RlUGFzc2FibGUgPSAoZW5jb2RlT3B0aW9ucykgPT4ge1xuICBjb25zdCB7IGVuY29kZVBhc3NhYmxlIH0gPSBtYWtlUGFzc2FibGVLaXQoZW5jb2RlT3B0aW9ucyk7XG4gIHJldHVybiBlbmNvZGVQYXNzYWJsZTtcbn07XG5oYXJkZW4obWFrZUVuY29kZVBhc3NhYmxlKTtcbnZhciBtYWtlRGVjb2RlUGFzc2FibGUgPSAoZGVjb2RlT3B0aW9ucykgPT4ge1xuICBjb25zdCB7IGRlY29kZVBhc3NhYmxlIH0gPSBtYWtlUGFzc2FibGVLaXQoZGVjb2RlT3B0aW9ucyk7XG4gIHJldHVybiBkZWNvZGVQYXNzYWJsZTtcbn07XG5oYXJkZW4obWFrZURlY29kZVBhc3NhYmxlKTtcbnZhciBpc0VuY29kZWRSZW1vdGFibGUgPSAoZW5jb2RlZCkgPT4gZW5jb2RlZC5jaGFyQXQoMCkgPT09IFwiclwiO1xuaGFyZGVuKGlzRW5jb2RlZFJlbW90YWJsZSk7XG52YXIgcGFzc1N0eWxlUHJlZml4ZXMgPSB7XG4gIGVycm9yOiBcIiFcIixcbiAgY29weVJlY29yZDogXCIoXCIsXG4gIHRhZ2dlZDogXCI6XCIsXG4gIHByb21pc2U6IFwiP1wiLFxuICBjb3B5QXJyYXk6IFwiW15cIixcbiAgYm9vbGVhbjogXCJiXCIsXG4gIG51bWJlcjogXCJmXCIsXG4gIGJpZ2ludDogXCJucFwiLFxuICByZW1vdGFibGU6IFwiclwiLFxuICBzdHJpbmc6IFwic1wiLFxuICBudWxsOiBcInZcIixcbiAgc3ltYm9sOiBcInlcIixcbiAgLy9cbiAgLy9cbiAgLy9cbiAgdW5kZWZpbmVkOiBcInpcIlxufTtcbk9iamVjdC5zZXRQcm90b3R5cGVPZihwYXNzU3R5bGVQcmVmaXhlcywgbnVsbCk7XG5oYXJkZW4ocGFzc1N0eWxlUHJlZml4ZXMpO1xuXG4vL1xudmFyIHsgZW50cmllczogZW50cmllczYsIGZyb21FbnRyaWVzOiBmcm9tRW50cmllczYsIHNldFByb3RvdHlwZU9mOiBzZXRQcm90b3R5cGVPZjIsIGlzOiBpczQgfSA9IE9iamVjdDtcbnZhciBzYW1lVmFsdWVaZXJvID0gKHgsIHkpID0+IHggPT09IHkgfHwgaXM0KHgsIHkpO1xudmFyIHRyaXZpYWxDb21wYXJhdG9yID0gKGxlZnQsIHJpZ2h0KSA9PiAoXG4gIC8vXG4gIGxlZnQgPCByaWdodCA/IC0xIDogbGVmdCA9PT0gcmlnaHQgPyAwIDogMVxuKTtcbnZhciBwYXNzU3R5bGVSYW5rcyA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgZnJvbUVudHJpZXM2KFxuICAgIGVudHJpZXM2KHBhc3NTdHlsZVByZWZpeGVzKS5zb3J0KChbX2xlZnRTdHlsZSwgbGVmdFByZWZpeGVzXSwgW19yaWdodFN0eWxlLCByaWdodFByZWZpeGVzXSkgPT4ge1xuICAgICAgcmV0dXJuIHRyaXZpYWxDb21wYXJhdG9yKGxlZnRQcmVmaXhlcywgcmlnaHRQcmVmaXhlcyk7XG4gICAgfSkubWFwKChbcGFzc1N0eWxlLCBwcmVmaXhlc10sIGluZGV4KSA9PiB7XG4gICAgICBwcmVmaXhlcyA9PT0gWy4uLnByZWZpeGVzXS5zb3J0KCkuam9pbihcIlwiKSB8fCB0aHJvd1JlZGFjdGVkYHVuc29ydGVkIHByZWZpeGVzIGZvciBwYXNzU3R5bGUgJHtxdW90ZShwYXNzU3R5bGUpfTogJHtxdW90ZShwcmVmaXhlcyl9YDtcbiAgICAgIGNvbnN0IGNvdmVyID0gW1xuICAgICAgICBwcmVmaXhlcy5jaGFyQXQoMCksXG4gICAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUocHJlZml4ZXMuY2hhckNvZGVBdChwcmVmaXhlcy5sZW5ndGggLSAxKSArIDEpXG4gICAgICBdO1xuICAgICAgcmV0dXJuIFtwYXNzU3R5bGUsIHsgaW5kZXgsIGNvdmVyIH1dO1xuICAgIH0pXG4gIClcbik7XG5zZXRQcm90b3R5cGVPZjIocGFzc1N0eWxlUmFua3MsIG51bGwpO1xuaGFyZGVuKHBhc3NTdHlsZVJhbmtzKTtcbnZhciBnZXRQYXNzU3R5bGVDb3ZlciA9IChwYXNzU3R5bGUpID0+IHBhc3NTdHlsZVJhbmtzW3Bhc3NTdHlsZV0uY292ZXI7XG5oYXJkZW4oZ2V0UGFzc1N0eWxlQ292ZXIpO1xudmFyIG1lbW9PZlNvcnRlZCA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xudmFyIGNvbXBhcmF0b3JNaXJyb3JJbWFnZXMgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbnZhciBtYWtlQ29tcGFyYXRvcktpdCA9IChjb21wYXJlUmVtb3RhYmxlcyA9IChfeCwgX3kpID0+IE5hTikgPT4ge1xuICBjb25zdCBjb21wYXJhdG9yID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gICAgaWYgKHNhbWVWYWx1ZVplcm8obGVmdCwgcmlnaHQpKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgY29uc3QgbGVmdFN0eWxlID0gcGFzc1N0eWxlT2YobGVmdCk7XG4gICAgY29uc3QgcmlnaHRTdHlsZSA9IHBhc3NTdHlsZU9mKHJpZ2h0KTtcbiAgICBpZiAobGVmdFN0eWxlICE9PSByaWdodFN0eWxlKSB7XG4gICAgICByZXR1cm4gdHJpdmlhbENvbXBhcmF0b3IoXG4gICAgICAgIHBhc3NTdHlsZVJhbmtzW2xlZnRTdHlsZV0uaW5kZXgsXG4gICAgICAgIHBhc3NTdHlsZVJhbmtzW3JpZ2h0U3R5bGVdLmluZGV4XG4gICAgICApO1xuICAgIH1cbiAgICBzd2l0Y2ggKGxlZnRTdHlsZSkge1xuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIHJldHVybiBjb21wYXJlUmVtb3RhYmxlcyhsZWZ0LCByaWdodCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgICBjYXNlIFwibnVsbFwiOlxuICAgICAgY2FzZSBcImVycm9yXCI6XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgIGNhc2UgXCJiaWdpbnRcIjpcbiAgICAgIGNhc2UgXCJzdHJpbmdcIjoge1xuICAgICAgICBpZiAobGVmdCA8IHJpZ2h0KSB7XG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFzc2VydChsZWZ0ID4gcmlnaHQpO1xuICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgcmV0dXJuIGNvbXBhcmF0b3IoXG4gICAgICAgICAgbmFtZUZvclBhc3NhYmxlU3ltYm9sKGxlZnQpLFxuICAgICAgICAgIG5hbWVGb3JQYXNzYWJsZVN5bWJvbChyaWdodClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJudW1iZXJcIjoge1xuICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKGxlZnQpKSB7XG4gICAgICAgICAgYXNzZXJ0KCFOdW1iZXIuaXNOYU4ocmlnaHQpKTtcbiAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfSBlbHNlIGlmIChOdW1iZXIuaXNOYU4ocmlnaHQpKSB7XG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsZWZ0IDwgcmlnaHQpIHtcbiAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXNzZXJ0KGxlZnQgPiByaWdodCk7XG4gICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgY29uc3QgbGVmdE5hbWVzID0gcmVjb3JkTmFtZXMobGVmdCk7XG4gICAgICAgIGNvbnN0IHJpZ2h0TmFtZXMgPSByZWNvcmROYW1lcyhyaWdodCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbXBhcmF0b3IobGVmdE5hbWVzLCByaWdodE5hbWVzKTtcbiAgICAgICAgaWYgKHJlc3VsdCAhPT0gMCkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGVmdFZhbHVlcyA9IHJlY29yZFZhbHVlcyhsZWZ0LCBsZWZ0TmFtZXMpO1xuICAgICAgICBjb25zdCByaWdodFZhbHVlcyA9IHJlY29yZFZhbHVlcyhyaWdodCwgcmlnaHROYW1lcyk7XG4gICAgICAgIHJldHVybiBjb21wYXJhdG9yKGxlZnRWYWx1ZXMsIHJpZ2h0VmFsdWVzKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICBjb25zdCBsZW4gPSBNYXRoLm1pbihsZWZ0Lmxlbmd0aCwgcmlnaHQubGVuZ3RoKTtcbiAgICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlbjsgaTIgKz0gMSkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbXBhcmF0b3IobGVmdFtpMl0sIHJpZ2h0W2kyXSk7XG4gICAgICAgICAgaWYgKHJlc3VsdCAhPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbXBhcmF0b3IobGVmdC5sZW5ndGgsIHJpZ2h0Lmxlbmd0aCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgY29uc3QgbGFiZWxDb21wID0gY29tcGFyYXRvcihnZXRUYWcobGVmdCksIGdldFRhZyhyaWdodCkpO1xuICAgICAgICBpZiAobGFiZWxDb21wICE9PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIGxhYmVsQ29tcDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29tcGFyYXRvcihsZWZ0LnBheWxvYWQsIHJpZ2h0LnBheWxvYWQpO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFVucmVjb2duaXplZCBwYXNzU3R5bGU6ICR7cXVvdGUobGVmdFN0eWxlKX1gO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3Qgb3V0ZXJDb21wYXJhdG9yID0gKHgsIHkpID0+IChcbiAgICAvL1xuICAgIC8vXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNvbXBhcmF0b3IoeCwgeSkgfHwgMFxuICApO1xuICBjb25zdCBhbnRpQ29tcGFyYXRvciA9ICh4LCB5KSA9PiBvdXRlckNvbXBhcmF0b3IoeSwgeCk7XG4gIG1lbW9PZlNvcnRlZC5zZXQob3V0ZXJDb21wYXJhdG9yLCAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKSk7XG4gIG1lbW9PZlNvcnRlZC5zZXQoYW50aUNvbXBhcmF0b3IsIC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpKTtcbiAgY29tcGFyYXRvck1pcnJvckltYWdlcy5zZXQob3V0ZXJDb21wYXJhdG9yLCBhbnRpQ29tcGFyYXRvcik7XG4gIGNvbXBhcmF0b3JNaXJyb3JJbWFnZXMuc2V0KGFudGlDb21wYXJhdG9yLCBvdXRlckNvbXBhcmF0b3IpO1xuICByZXR1cm4gaGFyZGVuKHsgY29tcGFyYXRvcjogb3V0ZXJDb21wYXJhdG9yLCBhbnRpQ29tcGFyYXRvciB9KTtcbn07XG52YXIgaXNSYW5rU29ydGVkID0gKHBhc3NhYmxlcywgY29tcGFyZSkgPT4ge1xuICBjb25zdCBzdWJNZW1vT2ZTb3J0ZWQgPSBtZW1vT2ZTb3J0ZWQuZ2V0KGNvbXBhcmUpO1xuICBhc3NlcnQoc3ViTWVtb09mU29ydGVkICE9PSB2b2lkIDApO1xuICBpZiAoc3ViTWVtb09mU29ydGVkLmhhcyhwYXNzYWJsZXMpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgYXNzZXJ0KHBhc3NTdHlsZU9mKHBhc3NhYmxlcykgPT09IFwiY29weUFycmF5XCIpO1xuICBmb3IgKGxldCBpMiA9IDE7IGkyIDwgcGFzc2FibGVzLmxlbmd0aDsgaTIgKz0gMSkge1xuICAgIGlmIChjb21wYXJlKHBhc3NhYmxlc1tpMiAtIDFdLCBwYXNzYWJsZXNbaTJdKSA+PSAxKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHN1Yk1lbW9PZlNvcnRlZC5hZGQocGFzc2FibGVzKTtcbiAgcmV0dXJuIHRydWU7XG59O1xuaGFyZGVuKGlzUmFua1NvcnRlZCk7XG52YXIgYXNzZXJ0UmFua1NvcnRlZCA9IChzb3J0ZWQsIGNvbXBhcmUpID0+IGlzUmFua1NvcnRlZChzb3J0ZWQsIGNvbXBhcmUpIHx8IC8vXG4vL1xudGhyb3dSZWRhY3RlZGBNdXN0IGJlIHJhbmsgc29ydGVkOiAke3NvcnRlZH0gdnMgJHtzb3J0QnlSYW5rKHNvcnRlZCwgY29tcGFyZSl9YDtcbmhhcmRlbihhc3NlcnRSYW5rU29ydGVkKTtcbnZhciBzb3J0QnlSYW5rID0gKHBhc3NhYmxlcywgY29tcGFyZSkgPT4ge1xuICBpZiAoQXJyYXkuaXNBcnJheShwYXNzYWJsZXMpKSB7XG4gICAgaGFyZGVuKHBhc3NhYmxlcyk7XG4gICAgaWYgKGlzUmFua1NvcnRlZChwYXNzYWJsZXMsIGNvbXBhcmUpKSB7XG4gICAgICByZXR1cm4gcGFzc2FibGVzO1xuICAgIH1cbiAgfVxuICBjb25zdCB1bnNvcnRlZCA9IFsuLi5wYXNzYWJsZXNdO1xuICB1bnNvcnRlZC5mb3JFYWNoKGhhcmRlbik7XG4gIGNvbnN0IHNvcnRlZCA9IHVuc29ydGVkLnNvcnQoY29tcGFyZSk7XG4gIGlmIChjb21wYXJlKHRydWUsIHZvaWQgMCkgPiAwKSB7XG4gICAgbGV0IGkyID0gc29ydGVkLmxlbmd0aCAtIDE7XG4gICAgd2hpbGUgKGkyID49IDAgJiYgc29ydGVkW2kyXSA9PT0gdm9pZCAwKSBpMiAtPSAxO1xuICAgIGNvbnN0IG4yID0gc29ydGVkLmxlbmd0aCAtIGkyIC0gMTtcbiAgICBpZiAobjIgPiAwICYmIG4yIDwgc29ydGVkLmxlbmd0aCkge1xuICAgICAgc29ydGVkLmNvcHlXaXRoaW4objIsIDApO1xuICAgICAgc29ydGVkLmZpbGwoXG4gICAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgICAgdm9pZCAwLFxuICAgICAgICAwLFxuICAgICAgICBuMlxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgaGFyZGVuKHNvcnRlZCk7XG4gIGNvbnN0IHN1Yk1lbW9PZlNvcnRlZCA9IG1lbW9PZlNvcnRlZC5nZXQoY29tcGFyZSk7XG4gIGFzc2VydChzdWJNZW1vT2ZTb3J0ZWQgIT09IHZvaWQgMCk7XG4gIHN1Yk1lbW9PZlNvcnRlZC5hZGQoc29ydGVkKTtcbiAgcmV0dXJuIHNvcnRlZDtcbn07XG5oYXJkZW4oc29ydEJ5UmFuayk7XG52YXIgcmFua1NlYXJjaCA9IChzb3J0ZWQsIGNvbXBhcmUsIGtleSwgYmlhcyA9IFwibGVmdE1vc3RcIikgPT4ge1xuICBhc3NlcnRSYW5rU29ydGVkKHNvcnRlZCwgY29tcGFyZSk7XG4gIGxldCBsZWZ0ID0gMDtcbiAgbGV0IHJpZ2h0ID0gc29ydGVkLmxlbmd0aDtcbiAgd2hpbGUgKGxlZnQgPCByaWdodCkge1xuICAgIGNvbnN0IG0yID0gTWF0aC5mbG9vcigobGVmdCArIHJpZ2h0KSAvIDIpO1xuICAgIGNvbnN0IGNvbXAgPSBjb21wYXJlKHNvcnRlZFttMl0sIGtleSk7XG4gICAgaWYgKGNvbXAgPD0gLTEgfHwgY29tcCA9PT0gMCAmJiBiaWFzID09PSBcInJpZ2h0TW9zdFwiKSB7XG4gICAgICBsZWZ0ID0gbTIgKyAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBhc3NlcnQoY29tcCA+PSAxIHx8IGNvbXAgPT09IDAgJiYgYmlhcyA9PT0gXCJsZWZ0TW9zdFwiKTtcbiAgICAgIHJpZ2h0ID0gbTI7XG4gICAgfVxuICB9XG4gIHJldHVybiBiaWFzID09PSBcImxlZnRNb3N0XCIgPyBsZWZ0IDogcmlnaHQgLSAxO1xufTtcbnZhciBnZXRJbmRleENvdmVyID0gKHNvcnRlZCwgY29tcGFyZSwgW2xlZnRLZXksIHJpZ2h0S2V5XSkgPT4ge1xuICBhc3NlcnRSYW5rU29ydGVkKHNvcnRlZCwgY29tcGFyZSk7XG4gIGNvbnN0IGxlZnRJbmRleCA9IHJhbmtTZWFyY2goc29ydGVkLCBjb21wYXJlLCBsZWZ0S2V5LCBcImxlZnRNb3N0XCIpO1xuICBjb25zdCByaWdodEluZGV4ID0gcmFua1NlYXJjaChzb3J0ZWQsIGNvbXBhcmUsIHJpZ2h0S2V5LCBcInJpZ2h0TW9zdFwiKTtcbiAgcmV0dXJuIFtsZWZ0SW5kZXgsIHJpZ2h0SW5kZXhdO1xufTtcbmhhcmRlbihnZXRJbmRleENvdmVyKTtcbnZhciBGdWxsUmFua0NvdmVyID0gaGFyZGVuKFtcIlwiLCBcIntcIl0pO1xudmFyIGNvdmVyZWRFbnRyaWVzID0gKHNvcnRlZCwgW2xlZnRJbmRleCwgcmlnaHRJbmRleF0pID0+IHtcbiAgY29uc3QgaXRlcmFibGUgPSBoYXJkZW4oe1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBsZXQgaTIgPSBsZWZ0SW5kZXg7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGlmIChpMiA8PSByaWdodEluZGV4KSB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gc29ydGVkW2kyXTtcbiAgICAgICAgICAgIGkyICs9IDE7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWU6IFtpMiwgZWxlbWVudF0sIGRvbmU6IGZhbHNlIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWU6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBpdGVyYWJsZTtcbn07XG5oYXJkZW4oY292ZXJlZEVudHJpZXMpO1xudmFyIG1heFJhbmsgPSAoY29tcGFyZSwgYTIsIGIzKSA9PiBjb21wYXJlKGEyLCBiMykgPj0gMCA/IGEyIDogYjM7XG52YXIgbWluUmFuayA9IChjb21wYXJlLCBhMiwgYjMpID0+IGNvbXBhcmUoYTIsIGIzKSA8PSAwID8gYTIgOiBiMztcbnZhciB1bmlvblJhbmtDb3ZlcnMgPSAoY29tcGFyZSwgY292ZXJzKSA9PiB7XG4gIGNvbnN0IHVuaW9uUmFua0NvdmVyUGFpciA9IChbbGVmdEEsIHJpZ2h0QV0sIFtsZWZ0QiwgcmlnaHRCXSkgPT4gW1xuICAgIG1pblJhbmsoY29tcGFyZSwgbGVmdEEsIGxlZnRCKSxcbiAgICBtYXhSYW5rKGNvbXBhcmUsIHJpZ2h0QSwgcmlnaHRCKVxuICBdO1xuICByZXR1cm4gY292ZXJzLnJlZHVjZSh1bmlvblJhbmtDb3ZlclBhaXIsIFtcIntcIiwgXCJcIl0pO1xufTtcbmhhcmRlbih1bmlvblJhbmtDb3ZlcnMpO1xudmFyIGludGVyc2VjdFJhbmtDb3ZlcnMgPSAoY29tcGFyZSwgY292ZXJzKSA9PiB7XG4gIGNvbnN0IGludGVyc2VjdFJhbmtDb3ZlclBhaXIgPSAoW2xlZnRBLCByaWdodEFdLCBbbGVmdEIsIHJpZ2h0Ql0pID0+IFtcbiAgICBtYXhSYW5rKGNvbXBhcmUsIGxlZnRBLCBsZWZ0QiksXG4gICAgbWluUmFuayhjb21wYXJlLCByaWdodEEsIHJpZ2h0QilcbiAgXTtcbiAgcmV0dXJuIGNvdmVycy5yZWR1Y2UoaW50ZXJzZWN0UmFua0NvdmVyUGFpciwgW1wiXCIsIFwie1wiXSk7XG59O1xudmFyIHsgY29tcGFyYXRvcjogY29tcGFyZVJhbmssIGFudGlDb21wYXJhdG9yOiBjb21wYXJlQW50aVJhbmsgfSA9IG1ha2VDb21wYXJhdG9yS2l0KCk7XG52YXIgbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQgPSAobG9uZ0xpdmVkID0gZmFsc2UpID0+IHtcbiAgbGV0IG51bVNlZW4gPSAwO1xuICBjb25zdCBNYXBDb25zdHJ1Y3RvciA9IGxvbmdMaXZlZCA/IFdlYWtNYXAgOiBNYXA7XG4gIGNvbnN0IHNlZW4gPSBuZXcgTWFwQ29uc3RydWN0b3IoKTtcbiAgY29uc3QgdGFnID0gKHI1KSA9PiB7XG4gICAgaWYgKHNlZW4uaGFzKHI1KSkge1xuICAgICAgcmV0dXJuIHNlZW4uZ2V0KHI1KTtcbiAgICB9XG4gICAgbnVtU2VlbiArPSAxO1xuICAgIHNlZW4uc2V0KHI1LCBudW1TZWVuKTtcbiAgICByZXR1cm4gbnVtU2VlbjtcbiAgfTtcbiAgY29uc3QgY29tcGFyZVJlbW90YWJsZXMgPSAoeCwgeSkgPT4gY29tcGFyZVJhbmsodGFnKHgpLCB0YWcoeSkpO1xuICByZXR1cm4gbWFrZUNvbXBhcmF0b3JLaXQoY29tcGFyZVJlbW90YWJsZXMpO1xufTtcbmhhcmRlbihtYWtlRnVsbE9yZGVyQ29tcGFyYXRvcktpdCk7XG5cbi8vXG52YXIgaWRlbnRDaGVja2VyID0gKGNvbmQsIF9kZXRhaWxzKSA9PiBjb25kO1xuaGFyZGVuKGlkZW50Q2hlY2tlcik7XG5cbi8vXG52YXIgY2hlY2tOb0R1cGxpY2F0ZXMgPSAoZWxlbWVudHMsIGZ1bGxDb21wYXJlLCBjaGVjaykgPT4ge1xuICBmdWxsQ29tcGFyZSA9IGZ1bGxDb21wYXJlIHx8IG1ha2VGdWxsT3JkZXJDb21wYXJhdG9yS2l0KCkuYW50aUNvbXBhcmF0b3I7XG4gIGVsZW1lbnRzID0gc29ydEJ5UmFuayhlbGVtZW50cywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB7IGxlbmd0aCB9ID0gZWxlbWVudHM7XG4gIGZvciAobGV0IGkyID0gMTsgaTIgPCBsZW5ndGg7IGkyICs9IDEpIHtcbiAgICBjb25zdCBrMCA9IGVsZW1lbnRzW2kyIC0gMV07XG4gICAgY29uc3QgazEgPSBlbGVtZW50c1tpMl07XG4gICAgaWYgKGZ1bGxDb21wYXJlKGswLCBrMSkgPT09IDApIHtcbiAgICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgdmFsdWUgaGFzIGR1cGxpY2F0ZSBrZXlzOiAke2swfWApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgYXNzZXJ0Tm9EdXBsaWNhdGVzID0gKGVsZW1lbnRzLCBmdWxsQ29tcGFyZSA9IHZvaWQgMCkgPT4ge1xuICBjaGVja05vRHVwbGljYXRlcyhlbGVtZW50cywgZnVsbENvbXBhcmUsIGFzc2VydENoZWNrZXIpO1xufTtcbnZhciBjaGVja0VsZW1lbnRzID0gKGVsZW1lbnRzLCBjaGVjaykgPT4ge1xuICBpZiAocGFzc1N0eWxlT2YoZWxlbWVudHMpICE9PSBcImNvcHlBcnJheVwiKSB7XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgZmFsc2UsXG4gICAgICByZWRhY3RlZGBUaGUga2V5cyBvZiBhIGNvcHlTZXQgb3IgY29weU1hcCBtdXN0IGJlIGEgY29weUFycmF5OiAke2VsZW1lbnRzfWBcbiAgICApO1xuICB9XG4gIGlmICghaXNSYW5rU29ydGVkKGVsZW1lbnRzLCBjb21wYXJlQW50aVJhbmspKSB7XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgZmFsc2UsXG4gICAgICByZWRhY3RlZGBUaGUga2V5cyBvZiBhIGNvcHlTZXQgb3IgY29weU1hcCBtdXN0IGJlIHNvcnRlZCBpbiByZXZlcnNlIHJhbmsgb3JkZXI6ICR7ZWxlbWVudHN9YFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGNoZWNrTm9EdXBsaWNhdGVzKGVsZW1lbnRzLCB2b2lkIDAsIGNoZWNrKTtcbn07XG5oYXJkZW4oY2hlY2tFbGVtZW50cyk7XG52YXIgYXNzZXJ0RWxlbWVudHMgPSAoZWxlbWVudHMpID0+IHtcbiAgY2hlY2tFbGVtZW50cyhlbGVtZW50cywgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydEVsZW1lbnRzKTtcbnZhciBjb2VyY2VUb0VsZW1lbnRzID0gKGVsZW1lbnRzTGlzdCkgPT4ge1xuICBjb25zdCBlbGVtZW50cyA9IHNvcnRCeVJhbmsoZWxlbWVudHNMaXN0LCBjb21wYXJlQW50aVJhbmspO1xuICBhc3NlcnRFbGVtZW50cyhlbGVtZW50cyk7XG4gIHJldHVybiBlbGVtZW50cztcbn07XG5oYXJkZW4oY29lcmNlVG9FbGVtZW50cyk7XG52YXIgbWFrZVNldE9mRWxlbWVudHMgPSAoZWxlbWVudEl0ZXIpID0+IG1ha2VUYWdnZWQoXCJjb3B5U2V0XCIsIGNvZXJjZVRvRWxlbWVudHMoZWxlbWVudEl0ZXIpKTtcbmhhcmRlbihtYWtlU2V0T2ZFbGVtZW50cyk7XG5cbi8vXG52YXIgY2hlY2tOb0R1cGxpY2F0ZUtleXMgPSAoYmFnRW50cmllcywgZnVsbENvbXBhcmUsIGNoZWNrKSA9PiB7XG4gIGZ1bGxDb21wYXJlID0gZnVsbENvbXBhcmUgfHwgbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgYmFnRW50cmllcyA9IHNvcnRCeVJhbmsoYmFnRW50cmllcywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB7IGxlbmd0aCB9ID0gYmFnRW50cmllcztcbiAgZm9yIChsZXQgaTIgPSAxOyBpMiA8IGxlbmd0aDsgaTIgKz0gMSkge1xuICAgIGNvbnN0IGswID0gYmFnRW50cmllc1tpMiAtIDFdWzBdO1xuICAgIGNvbnN0IGsxID0gYmFnRW50cmllc1tpMl1bMF07XG4gICAgaWYgKGZ1bGxDb21wYXJlKGswLCBrMSkgPT09IDApIHtcbiAgICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgdmFsdWUgaGFzIGR1cGxpY2F0ZSBrZXlzOiAke2swfWApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgYXNzZXJ0Tm9EdXBsaWNhdGVLZXlzID0gKGJhZ0VudHJpZXMsIGZ1bGxDb21wYXJlID0gdm9pZCAwKSA9PiB7XG4gIGNoZWNrTm9EdXBsaWNhdGVLZXlzKGJhZ0VudHJpZXMsIGZ1bGxDb21wYXJlLCBhc3NlcnRDaGVja2VyKTtcbn07XG52YXIgY2hlY2tCYWdFbnRyaWVzID0gKGJhZ0VudHJpZXMsIGNoZWNrKSA9PiB7XG4gIGlmIChwYXNzU3R5bGVPZihiYWdFbnRyaWVzKSAhPT0gXCJjb3B5QXJyYXlcIikge1xuICAgIHJldHVybiBjaGVjayhcbiAgICAgIGZhbHNlLFxuICAgICAgcmVkYWN0ZWRgVGhlIGVudHJpZXMgb2YgYSBjb3B5QmFnIG11c3QgYmUgYSBjb3B5QXJyYXk6ICR7YmFnRW50cmllc31gXG4gICAgKTtcbiAgfVxuICBpZiAoIWlzUmFua1NvcnRlZChiYWdFbnRyaWVzLCBjb21wYXJlQW50aVJhbmspKSB7XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgZmFsc2UsXG4gICAgICByZWRhY3RlZGBUaGUgZW50cmllcyBvZiBhIGNvcHlCYWcgbXVzdCBiZSBzb3J0ZWQgaW4gcmV2ZXJzZSByYW5rIG9yZGVyOiAke2JhZ0VudHJpZXN9YFxuICAgICk7XG4gIH1cbiAgZm9yIChjb25zdCBlbnRyeSBvZiBiYWdFbnRyaWVzKSB7XG4gICAgaWYgKHBhc3NTdHlsZU9mKGVudHJ5KSAhPT0gXCJjb3B5QXJyYXlcIiB8fCBlbnRyeS5sZW5ndGggIT09IDIgfHwgdHlwZW9mIGVudHJ5WzFdICE9PSBcImJpZ2ludFwiKSB7XG4gICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICByZWRhY3RlZGBFYWNoIGVudHJ5IG9mIGEgY29weUJhZyBtdXN0IGJlIHBhaXIgb2YgYSBrZXkgYW5kIGEgYmlnaW50IHJlcHJlc2VudGluZyBhIGNvdW50OiAke2VudHJ5fWBcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChlbnRyeVsxXSA8IDEpIHtcbiAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYEVhY2ggZW50cnkgb2YgYSBjb3B5QmFnIG11c3QgaGF2ZSBhIHBvc2l0aXZlIGNvdW50OiAke2VudHJ5fWBcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIHJldHVybiBjaGVja05vRHVwbGljYXRlS2V5cyhiYWdFbnRyaWVzLCB2b2lkIDAsIGNoZWNrKTtcbn07XG5oYXJkZW4oY2hlY2tCYWdFbnRyaWVzKTtcbnZhciBhc3NlcnRCYWdFbnRyaWVzID0gKGJhZ0VudHJpZXMpID0+IHtcbiAgY2hlY2tCYWdFbnRyaWVzKGJhZ0VudHJpZXMsIGFzc2VydENoZWNrZXIpO1xufTtcbmhhcmRlbihhc3NlcnRCYWdFbnRyaWVzKTtcbnZhciBjb2VyY2VUb0JhZ0VudHJpZXMgPSAoYmFnRW50cmllc0xpc3QpID0+IHtcbiAgY29uc3QgYmFnRW50cmllcyA9IHNvcnRCeVJhbmsoYmFnRW50cmllc0xpc3QsIGNvbXBhcmVBbnRpUmFuayk7XG4gIGFzc2VydEJhZ0VudHJpZXMoYmFnRW50cmllcyk7XG4gIHJldHVybiBiYWdFbnRyaWVzO1xufTtcbmhhcmRlbihjb2VyY2VUb0JhZ0VudHJpZXMpO1xudmFyIG1ha2VCYWdPZkVudHJpZXMgPSAoYmFnRW50cnlJdGVyKSA9PiBtYWtlVGFnZ2VkKFwiY29weUJhZ1wiLCBjb2VyY2VUb0JhZ0VudHJpZXMoYmFnRW50cnlJdGVyKSk7XG5oYXJkZW4obWFrZUJhZ09mRW50cmllcyk7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTUgfSA9IFJlZmxlY3Q7XG52YXIgY2hlY2tQcmltaXRpdmVLZXkgPSAodmFsLCBjaGVjaykgPT4ge1xuICBpZiAoaXNPYmplY3QyKHZhbCkpIHtcbiAgICByZXR1cm4gY2hlY2sgIT09IGlkZW50Q2hlY2tlciAmJiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSAke3F1b3RlKHR5cGVvZiB2YWwpfSBjYW5ub3QgYmUgYSBwcmltaXRpdmU6ICR7dmFsfWApO1xuICB9XG4gIGFzc2VydFBhc3NhYmxlKHZhbCk7XG4gIHJldHVybiB0cnVlO1xufTtcbnZhciBpc1ByaW1pdGl2ZUtleSA9ICh2YWwpID0+IGNoZWNrUHJpbWl0aXZlS2V5KHZhbCwgaWRlbnRDaGVja2VyKTtcbmhhcmRlbihpc1ByaW1pdGl2ZUtleSk7XG52YXIgYXNzZXJ0UHJpbWl0aXZlS2V5ID0gKHZhbCkgPT4ge1xuICBjaGVja1ByaW1pdGl2ZUtleSh2YWwsIGFzc2VydENoZWNrZXIpO1xufTtcbmhhcmRlbihhc3NlcnRQcmltaXRpdmVLZXkpO1xudmFyIGNoZWNrU2NhbGFyS2V5ID0gKHZhbCwgY2hlY2spID0+IHtcbiAgaWYgKGlzUHJpbWl0aXZlS2V5KHZhbCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZih2YWwpO1xuICBpZiAocGFzc1N0eWxlID09PSBcInJlbW90YWJsZVwiKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBBICR7cXVvdGUocGFzc1N0eWxlKX0gY2Fubm90IGJlIGEgc2NhbGFyIGtleTogJHt2YWx9YCk7XG59O1xudmFyIGlzU2NhbGFyS2V5ID0gKHZhbCkgPT4gY2hlY2tTY2FsYXJLZXkodmFsLCBpZGVudENoZWNrZXIpO1xuaGFyZGVuKGlzU2NhbGFyS2V5KTtcbnZhciBhc3NlcnRTY2FsYXJLZXkgPSAodmFsKSA9PiB7XG4gIGNoZWNrU2NhbGFyS2V5KHZhbCwgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydFNjYWxhcktleSk7XG52YXIga2V5TWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrS2V5ID0gKHZhbCwgY2hlY2spID0+IHtcbiAgaWYgKCFpc09iamVjdDIodmFsKSkge1xuICAgIGFzc2VydFBhc3NhYmxlKHZhbCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKGtleU1lbW8uaGFzKHZhbCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSBjaGVja0tleUludGVybmFsKHZhbCwgY2hlY2spO1xuICBpZiAocmVzdWx0KSB7XG4gICAga2V5TWVtby5hZGQodmFsKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbmhhcmRlbihjaGVja0tleSk7XG52YXIgaXNLZXkgPSAodmFsKSA9PiBjaGVja0tleSh2YWwsIGlkZW50Q2hlY2tlcik7XG5oYXJkZW4oaXNLZXkpO1xudmFyIGFzc2VydEtleSA9ICh2YWwpID0+IHtcbiAgY2hlY2tLZXkodmFsLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0S2V5KTtcbnZhciBjb3B5U2V0TWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrQ29weVNldCA9IChzMywgY2hlY2spID0+IHtcbiAgaWYgKGNvcHlTZXRNZW1vLmhhcyhzMykpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSAocGFzc1N0eWxlT2YoczMpID09PSBcInRhZ2dlZFwiICYmIGdldFRhZyhzMykgPT09IFwiY29weVNldFwiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBOb3QgYSBjb3B5U2V0OiAke3MzfWApKSAmJiBjaGVja0VsZW1lbnRzKHMzLnBheWxvYWQsIGNoZWNrKSAmJiBjaGVja0tleShzMy5wYXlsb2FkLCBjaGVjayk7XG4gIGlmIChyZXN1bHQpIHtcbiAgICBjb3B5U2V0TWVtby5hZGQoczMpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuaGFyZGVuKGNoZWNrQ29weVNldCk7XG52YXIgaXNDb3B5U2V0ID0gKHMzKSA9PiBjaGVja0NvcHlTZXQoczMsIGlkZW50Q2hlY2tlcik7XG5oYXJkZW4oaXNDb3B5U2V0KTtcbnZhciBhc3NlcnRDb3B5U2V0ID0gKHMzKSA9PiB7XG4gIGNoZWNrQ29weVNldChzMywgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydENvcHlTZXQpO1xudmFyIGdldENvcHlTZXRLZXlzID0gKHMzKSA9PiB7XG4gIGFzc2VydENvcHlTZXQoczMpO1xuICByZXR1cm4gczMucGF5bG9hZDtcbn07XG5oYXJkZW4oZ2V0Q29weVNldEtleXMpO1xudmFyIGV2ZXJ5Q29weVNldEtleSA9IChzMywgZm4pID0+IGdldENvcHlTZXRLZXlzKHMzKS5ldmVyeSgoa2V5LCBpbmRleCkgPT4gZm4oa2V5LCBpbmRleCkpO1xuaGFyZGVuKGV2ZXJ5Q29weVNldEtleSk7XG52YXIgbWFrZUNvcHlTZXQgPSAoZWxlbWVudEl0ZXIpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gbWFrZVNldE9mRWxlbWVudHMoZWxlbWVudEl0ZXIpO1xuICBhc3NlcnRDb3B5U2V0KHJlc3VsdCk7XG4gIHJldHVybiByZXN1bHQ7XG59O1xuaGFyZGVuKG1ha2VDb3B5U2V0KTtcbnZhciBjb3B5QmFnTWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrQ29weUJhZyA9IChiMywgY2hlY2spID0+IHtcbiAgaWYgKGNvcHlCYWdNZW1vLmhhcyhiMykpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSAocGFzc1N0eWxlT2YoYjMpID09PSBcInRhZ2dlZFwiICYmIGdldFRhZyhiMykgPT09IFwiY29weUJhZ1wiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBOb3QgYSBjb3B5QmFnOiAke2IzfWApKSAmJiBjaGVja0JhZ0VudHJpZXMoYjMucGF5bG9hZCwgY2hlY2spICYmIGNoZWNrS2V5KGIzLnBheWxvYWQsIGNoZWNrKTtcbiAgaWYgKHJlc3VsdCkge1xuICAgIGNvcHlCYWdNZW1vLmFkZChiMyk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4oY2hlY2tDb3B5QmFnKTtcbnZhciBpc0NvcHlCYWcgPSAoYjMpID0+IGNoZWNrQ29weUJhZyhiMywgaWRlbnRDaGVja2VyKTtcbmhhcmRlbihpc0NvcHlCYWcpO1xudmFyIGFzc2VydENvcHlCYWcgPSAoYjMpID0+IHtcbiAgY2hlY2tDb3B5QmFnKGIzLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0Q29weUJhZyk7XG52YXIgZ2V0Q29weUJhZ0VudHJpZXMgPSAoYjMpID0+IHtcbiAgYXNzZXJ0Q29weUJhZyhiMyk7XG4gIHJldHVybiBiMy5wYXlsb2FkO1xufTtcbmhhcmRlbihnZXRDb3B5QmFnRW50cmllcyk7XG52YXIgZXZlcnlDb3B5QmFnRW50cnkgPSAoYjMsIGZuKSA9PiBnZXRDb3B5QmFnRW50cmllcyhiMykuZXZlcnkoKGVudHJ5LCBpbmRleCkgPT4gZm4oZW50cnksIGluZGV4KSk7XG5oYXJkZW4oZXZlcnlDb3B5QmFnRW50cnkpO1xudmFyIG1ha2VDb3B5QmFnID0gKGJhZ0VudHJ5SXRlcikgPT4ge1xuICBjb25zdCByZXN1bHQgPSBtYWtlQmFnT2ZFbnRyaWVzKGJhZ0VudHJ5SXRlcik7XG4gIGFzc2VydENvcHlCYWcocmVzdWx0KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4obWFrZUNvcHlCYWcpO1xudmFyIG1ha2VDb3B5QmFnRnJvbUVsZW1lbnRzID0gKGVsZW1lbnRJdGVyKSA9PiB7XG4gIGNvbnN0IGZ1bGxDb21wYXJlID0gbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgY29uc3Qgc29ydGVkID0gc29ydEJ5UmFuayhlbGVtZW50SXRlciwgZnVsbENvbXBhcmUpO1xuICBjb25zdCBlbnRyaWVzMTAgPSBbXTtcbiAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IHNvcnRlZC5sZW5ndGg7ICkge1xuICAgIGNvbnN0IGsgPSBzb3J0ZWRbaTJdO1xuICAgIGxldCBqID0gaTIgKyAxO1xuICAgIHdoaWxlIChqIDwgc29ydGVkLmxlbmd0aCAmJiBmdWxsQ29tcGFyZShrLCBzb3J0ZWRbal0pID09PSAwKSB7XG4gICAgICBqICs9IDE7XG4gICAgfVxuICAgIGVudHJpZXMxMC5wdXNoKFtrLCBCaWdJbnQoaiAtIGkyKV0pO1xuICAgIGkyID0gajtcbiAgfVxuICByZXR1cm4gbWFrZUNvcHlCYWcoZW50cmllczEwKTtcbn07XG5oYXJkZW4obWFrZUNvcHlCYWdGcm9tRWxlbWVudHMpO1xudmFyIGNvcHlNYXBNZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCk7XG52YXIgY2hlY2tDb3B5TWFwID0gKG0yLCBjaGVjaykgPT4ge1xuICBpZiAoY29weU1hcE1lbW8uaGFzKG0yKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmICghKHBhc3NTdHlsZU9mKG0yKSA9PT0gXCJ0YWdnZWRcIiAmJiBnZXRUYWcobTIpID09PSBcImNvcHlNYXBcIikpIHtcbiAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYE5vdCBhIGNvcHlNYXA6ICR7bTJ9YCk7XG4gIH1cbiAgY29uc3QgeyBwYXlsb2FkIH0gPSBtMjtcbiAgaWYgKHBhc3NTdHlsZU9mKHBheWxvYWQpICE9PSBcImNvcHlSZWNvcmRcIikge1xuICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSBjb3B5TWFwJ3MgcGF5bG9hZCBtdXN0IGJlIGEgcmVjb3JkOiAke20yfWApO1xuICB9XG4gIGNvbnN0IHsga2V5czoga2V5czQsIHZhbHVlczogdmFsdWVzNiwgLi4ucmVzdCB9ID0gcGF5bG9hZDtcbiAgY29uc3QgcmVzdWx0ID0gKG93bktleXMxNShyZXN0KS5sZW5ndGggPT09IDAgfHwgY2hlY2soXG4gICAgZmFsc2UsXG4gICAgcmVkYWN0ZWRgQSBjb3B5TWFwJ3MgcGF5bG9hZCBtdXN0IG9ubHkgaGF2ZSAua2V5cyBhbmQgLnZhbHVlczogJHttMn1gXG4gICkpICYmIGNoZWNrRWxlbWVudHMoa2V5czQsIGNoZWNrKSAmJiBjaGVja0tleShrZXlzNCwgY2hlY2spICYmIChwYXNzU3R5bGVPZih2YWx1ZXM2KSA9PT0gXCJjb3B5QXJyYXlcIiB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSBjb3B5TWFwJ3MgLnZhbHVlcyBtdXN0IGJlIGEgY29weUFycmF5OiAke20yfWApKSAmJiAoa2V5czQubGVuZ3RoID09PSB2YWx1ZXM2Lmxlbmd0aCB8fCBjaGVjayhcbiAgICBmYWxzZSxcbiAgICByZWRhY3RlZGBBIGNvcHlNYXAgbXVzdCBoYXZlIHRoZSBzYW1lIG51bWJlciBvZiBrZXlzIGFuZCB2YWx1ZXM6ICR7bTJ9YFxuICApKTtcbiAgaWYgKHJlc3VsdCkge1xuICAgIGNvcHlNYXBNZW1vLmFkZChtMik7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4oY2hlY2tDb3B5TWFwKTtcbnZhciBpc0NvcHlNYXAgPSAobTIpID0+IGNoZWNrQ29weU1hcChtMiwgaWRlbnRDaGVja2VyKTtcbmhhcmRlbihpc0NvcHlNYXApO1xudmFyIGFzc2VydENvcHlNYXAgPSAobTIpID0+IHtcbiAgY2hlY2tDb3B5TWFwKG0yLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0Q29weU1hcCk7XG52YXIgZ2V0Q29weU1hcEtleXMgPSAobTIpID0+IHtcbiAgYXNzZXJ0Q29weU1hcChtMik7XG4gIHJldHVybiBtMi5wYXlsb2FkLmtleXM7XG59O1xuaGFyZGVuKGdldENvcHlNYXBLZXlzKTtcbnZhciBnZXRDb3B5TWFwVmFsdWVzID0gKG0yKSA9PiB7XG4gIGFzc2VydENvcHlNYXAobTIpO1xuICByZXR1cm4gbTIucGF5bG9hZC52YWx1ZXM7XG59O1xuaGFyZGVuKGdldENvcHlNYXBWYWx1ZXMpO1xudmFyIGdldENvcHlNYXBFbnRyeUFycmF5ID0gKG0yKSA9PiB7XG4gIGFzc2VydENvcHlNYXAobTIpO1xuICBjb25zdCB7XG4gICAgcGF5bG9hZDogeyBrZXlzOiBrZXlzNCwgdmFsdWVzOiB2YWx1ZXM2IH1cbiAgfSA9IG0yO1xuICByZXR1cm4gaGFyZGVuKGtleXM0Lm1hcCgoa2V5LCBpMikgPT4gW2tleSwgdmFsdWVzNltpMl1dKSk7XG59O1xuaGFyZGVuKGdldENvcHlNYXBFbnRyeUFycmF5KTtcbnZhciBnZXRDb3B5TWFwRW50cmllcyA9IChtMikgPT4ge1xuICBhc3NlcnRDb3B5TWFwKG0yKTtcbiAgY29uc3Qge1xuICAgIHBheWxvYWQ6IHsga2V5czoga2V5czQsIHZhbHVlczogdmFsdWVzNiB9XG4gIH0gPSBtMjtcbiAgY29uc3QgeyBsZW5ndGggfSA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgIGtleXM0XG4gICk7XG4gIHJldHVybiBGYXIoXCJDb3B5TWFwIGVudHJpZXMgaXRlcmFibGVcIiwge1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBsZXQgaTIgPSAwO1xuICAgICAgcmV0dXJuIEZhcihcIkNvcHlNYXAgZW50cmllcyBpdGVyYXRvclwiLCB7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBsZXQgcmVzdWx0O1xuICAgICAgICAgIGlmIChpMiA8IGxlbmd0aCkge1xuICAgICAgICAgICAgcmVzdWx0ID0gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlOiBba2V5czRbaTJdLCB2YWx1ZXM2W2kyXV0gfSk7XG4gICAgICAgICAgICBpMiArPSAxO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ID0gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHZvaWQgMCB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4oZ2V0Q29weU1hcEVudHJpZXMpO1xudmFyIGV2ZXJ5Q29weU1hcEtleSA9IChtMiwgZm4pID0+IGdldENvcHlNYXBLZXlzKG0yKS5ldmVyeSgoa2V5LCBpbmRleCkgPT4gZm4oa2V5LCBpbmRleCkpO1xuaGFyZGVuKGV2ZXJ5Q29weU1hcEtleSk7XG52YXIgZXZlcnlDb3B5TWFwVmFsdWUgPSAobTIsIGZuKSA9PiBnZXRDb3B5TWFwVmFsdWVzKG0yKS5ldmVyeSgodmFsdWUsIGluZGV4KSA9PiBmbih2YWx1ZSwgaW5kZXgpKTtcbmhhcmRlbihldmVyeUNvcHlNYXBWYWx1ZSk7XG52YXIgY29weU1hcEtleVNldCA9IChtMikgPT4gKFxuICAvL1xuICBtYWtlVGFnZ2VkKFwiY29weVNldFwiLCBtMi5wYXlsb2FkLmtleXMpXG4pO1xuaGFyZGVuKGNvcHlNYXBLZXlTZXQpO1xudmFyIG1ha2VDb3B5TWFwID0gKGVudHJpZXMxMCkgPT4ge1xuICBjb25zdCBzb3J0ZWRFbnRyaWVzID0gc29ydEJ5UmFuayhlbnRyaWVzMTAsIGNvbXBhcmVBbnRpUmFuayk7XG4gIGNvbnN0IGtleXM0ID0gc29ydGVkRW50cmllcy5tYXAoKFtrLCBfdl0pID0+IGspO1xuICBjb25zdCB2YWx1ZXM2ID0gc29ydGVkRW50cmllcy5tYXAoKFtfaywgdjNdKSA9PiB2Myk7XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VUYWdnZWQoXCJjb3B5TWFwXCIsIHsga2V5czoga2V5czQsIHZhbHVlczogdmFsdWVzNiB9KTtcbiAgYXNzZXJ0Q29weU1hcChyZXN1bHQpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbmhhcmRlbihtYWtlQ29weU1hcCk7XG52YXIgY2hlY2tLZXlJbnRlcm5hbCA9ICh2YWwsIGNoZWNrKSA9PiB7XG4gIGNvbnN0IGNoZWNrSXQgPSAoY2hpbGQpID0+IGNoZWNrS2V5KGNoaWxkLCBjaGVjayk7XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHZhbCk7XG4gIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXModmFsKS5ldmVyeShjaGVja0l0KTtcbiAgICB9XG4gICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICByZXR1cm4gdmFsLmV2ZXJ5KGNoZWNrSXQpO1xuICAgIH1cbiAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgIGNvbnN0IHRhZyA9IGdldFRhZyh2YWwpO1xuICAgICAgc3dpdGNoICh0YWcpIHtcbiAgICAgICAgY2FzZSBcImNvcHlTZXRcIjoge1xuICAgICAgICAgIHJldHVybiBjaGVja0NvcHlTZXQodmFsLCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImNvcHlCYWdcIjoge1xuICAgICAgICAgIHJldHVybiBjaGVja0NvcHlCYWcodmFsLCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICAgIHJldHVybiBjaGVja0NvcHlNYXAodmFsLCBjaGVjaykgJiYgLy9cbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vXG4gICAgICAgICAgZXZlcnlDb3B5TWFwVmFsdWUodmFsLCBjaGVja0l0KTtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrICE9PSBpZGVudENoZWNrZXIgJiYgY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgcGFzc2FibGUgdGFnZ2VkICR7cXVvdGUodGFnKX0gaXMgbm90IGEga2V5OiAke3ZhbH1gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjYXNlIFwiZXJyb3JcIjpcbiAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgJHtxdW90ZShwYXNzU3R5bGUpfSBjYW5ub3QgYmUgYSBrZXlgKTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIHBhc3NTdHlsZSAke3F1b3RlKHBhc3NTdHlsZSl9OiAke3ZhbH1gO1xuICAgIH1cbiAgfVxufTtcblxuLy9cbnZhciBtYWtlSXRlcmF0b3IgPSAobmV4dCkgPT4ge1xuICBjb25zdCBpdGVyID0gaGFyZGVuKHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4gaXRlcixcbiAgICBuZXh0XG4gIH0pO1xuICByZXR1cm4gaXRlcjtcbn07XG5oYXJkZW4obWFrZUl0ZXJhdG9yKTtcblxuLy9cbnZhciBtYWtlQXJyYXlJdGVyYXRvciA9IChhcnIpID0+IHtcbiAgY29uc3QgeyBsZW5ndGggfSA9IGFycjtcbiAgbGV0IGkyID0gMDtcbiAgcmV0dXJuIG1ha2VJdGVyYXRvcigoKSA9PiB7XG4gICAgbGV0IHZhbHVlO1xuICAgIGlmIChpMiA8IGxlbmd0aCkge1xuICAgICAgdmFsdWUgPSBhcnJbaTJdO1xuICAgICAgaTIgKz0gMTtcbiAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWUgfSk7XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZSB9KTtcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VBcnJheUl0ZXJhdG9yKTtcblxuLy9cbnZhciBnZW5lcmF0ZUZ1bGxTb3J0ZWRFbnRyaWVzID0gKGVudHJpZXMxMCwgcmFua0NvbXBhcmUsIGZ1bGxDb21wYXJlKSA9PiB7XG4gIGFzc2VydFJhbmtTb3J0ZWQoZW50cmllczEwLCByYW5rQ29tcGFyZSk7XG4gIGNvbnN0IHsgbGVuZ3RoIH0gPSBlbnRyaWVzMTA7XG4gIGxldCBpMiA9IDA7XG4gIGxldCBzYW1lUmFua0l0ZXJhdG9yO1xuICByZXR1cm4gbWFrZUl0ZXJhdG9yKCgpID0+IHtcbiAgICBpZiAoc2FtZVJhbmtJdGVyYXRvcikge1xuICAgICAgY29uc3QgcmVzdWx0ID0gc2FtZVJhbmtJdGVyYXRvci5uZXh0KCk7XG4gICAgICBpZiAoIXJlc3VsdC5kb25lKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICBzYW1lUmFua0l0ZXJhdG9yID0gdm9pZCAwO1xuICAgIH1cbiAgICBpZiAoaTIgPCBsZW5ndGgpIHtcbiAgICAgIGNvbnN0IGVudHJ5ID0gZW50cmllczEwW2kyXTtcbiAgICAgIGxldCBqID0gaTIgKyAxO1xuICAgICAgd2hpbGUgKGogPCBsZW5ndGggJiYgcmFua0NvbXBhcmUoZW50cnlbMF0sIGVudHJpZXMxMFtqXVswXSkgPT09IDApIHtcbiAgICAgICAgaiArPSAxO1xuICAgICAgfVxuICAgICAgaWYgKGogPT09IGkyICsgMSkge1xuICAgICAgICBpMiA9IGo7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWU6IGVudHJ5IH0pO1xuICAgICAgfVxuICAgICAgY29uc3QgdGllcyA9IGVudHJpZXMxMC5zbGljZShpMiwgaik7XG4gICAgICBpMiA9IGo7XG4gICAgICBjb25zdCBzb3J0ZWRUaWVzID0gc29ydEJ5UmFuayh0aWVzLCBmdWxsQ29tcGFyZSk7XG4gICAgICBmb3IgKGxldCBrID0gMTsgayA8IHNvcnRlZFRpZXMubGVuZ3RoOyBrICs9IDEpIHtcbiAgICAgICAgY29uc3QgW2tleTBdID0gc29ydGVkVGllc1trIC0gMV07XG4gICAgICAgIGNvbnN0IFtrZXkxXSA9IHNvcnRlZFRpZXNba107XG4gICAgICAgIE1hdGguc2lnbihmdWxsQ29tcGFyZShrZXkwLCBrZXkxKSkgfHwgdGhyb3dSZWRhY3RlZGBEdXBsaWNhdGUgZW50cnkga2V5OiAke2tleTB9YDtcbiAgICAgIH1cbiAgICAgIHNhbWVSYW5rSXRlcmF0b3IgPSBtYWtlQXJyYXlJdGVyYXRvcihzb3J0ZWRUaWVzKTtcbiAgICAgIHJldHVybiBzYW1lUmFua0l0ZXJhdG9yLm5leHQoKTtcbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlOiB2b2lkIDAgfSk7XG4gIH0pO1xufTtcbmhhcmRlbihnZW5lcmF0ZUZ1bGxTb3J0ZWRFbnRyaWVzKTtcbnZhciBnZW5lcmF0ZUNvbGxlY3Rpb25QYWlyRW50cmllcyA9IChjMSwgYzIsIGdldEVudHJpZXMsIGFic2VudFZhbHVlKSA9PiB7XG4gIGNvbnN0IGUxID0gZ2V0RW50cmllcyhjMSk7XG4gIGNvbnN0IGUyID0gZ2V0RW50cmllcyhjMik7XG4gIGNvbnN0IGZ1bGxDb21wYXJlID0gbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgY29uc3QgeCA9IGdlbmVyYXRlRnVsbFNvcnRlZEVudHJpZXMoZTEsIGNvbXBhcmVBbnRpUmFuaywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB5ID0gZ2VuZXJhdGVGdWxsU29ydGVkRW50cmllcyhlMiwgY29tcGFyZUFudGlSYW5rLCBmdWxsQ29tcGFyZSk7XG4gIGxldCB4RG9uZTtcbiAgbGV0IHhLZXk7XG4gIGxldCB4VmFsdWU7XG4gIGxldCB5RG9uZTtcbiAgbGV0IHlLZXk7XG4gIGxldCB5VmFsdWU7XG4gIGNvbnN0IG5vbkVudHJ5ID0gW3ZvaWQgMCwgdm9pZCAwXTtcbiAgY29uc3QgbmV4dFggPSAoKSA9PiB7XG4gICAgIXhEb25lIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IG5leHRYIG11c3Qgbm90IGJlIGNhbGxlZCBvbmNlIGRvbmVgO1xuICAgIGNvbnN0IHJlc3VsdCA9IHhWYWx1ZTtcbiAgICAoeyBkb25lOiB4RG9uZSwgdmFsdWU6IFt4S2V5LCB4VmFsdWVdID0gbm9uRW50cnkgfSA9IHgubmV4dCgpKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuICBuZXh0WCgpO1xuICBjb25zdCBuZXh0WSA9ICgpID0+IHtcbiAgICAheURvbmUgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogbmV4dFkgbXVzdCBub3QgYmUgY2FsbGVkIG9uY2UgZG9uZWA7XG4gICAgY29uc3QgcmVzdWx0ID0geVZhbHVlO1xuICAgICh7IGRvbmU6IHlEb25lLCB2YWx1ZTogW3lLZXksIHlWYWx1ZV0gPSBub25FbnRyeSB9ID0geS5uZXh0KCkpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG4gIG5leHRZKCk7XG4gIHJldHVybiBtYWtlSXRlcmF0b3IoKCkgPT4ge1xuICAgIGxldCBkb25lID0gZmFsc2U7XG4gICAgbGV0IHZhbHVlO1xuICAgIGlmICh4RG9uZSAmJiB5RG9uZSkge1xuICAgICAgZG9uZSA9IHRydWU7XG4gICAgICB2YWx1ZSA9IFt2b2lkIDAsIGFic2VudFZhbHVlLCBhYnNlbnRWYWx1ZV07XG4gICAgfSBlbHNlIGlmICh4RG9uZSkge1xuICAgICAgdmFsdWUgPSBbeUtleSwgYWJzZW50VmFsdWUsIG5leHRZKCldO1xuICAgIH0gZWxzZSBpZiAoeURvbmUpIHtcbiAgICAgIHZhbHVlID0gW3hLZXksIG5leHRYKCksIGFic2VudFZhbHVlXTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgY29tcCA9IGZ1bGxDb21wYXJlKHhLZXksIHlLZXkpO1xuICAgICAgaWYgKGNvbXAgPT09IDApIHtcbiAgICAgICAgdmFsdWUgPSBbeEtleSwgbmV4dFgoKSwgbmV4dFkoKV07XG4gICAgICB9IGVsc2UgaWYgKGNvbXAgPCAwKSB7XG4gICAgICAgIHZhbHVlID0gW3hLZXksIG5leHRYKCksIGFic2VudFZhbHVlXTtcbiAgICAgIH0gZWxzZSBpZiAoY29tcCA+IDApIHtcbiAgICAgICAgdmFsdWUgPSBbeUtleSwgYWJzZW50VmFsdWUsIG5leHRZKCldO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIGtleSBjb21wYXJpc29uICR7cXVvdGUoY29tcCl9IGZvciAke3hLZXl9IHZzICR7eUtleX1gO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaGFyZGVuKHsgZG9uZSwgdmFsdWUgfSk7XG4gIH0pO1xufTtcbmhhcmRlbihnZW5lcmF0ZUNvbGxlY3Rpb25QYWlyRW50cmllcyk7XG52YXIgbWFrZUNvbXBhcmVDb2xsZWN0aW9uID0gKGdldEVudHJpZXMsIGFic2VudFZhbHVlLCBjb21wYXJlVmFsdWVzMikgPT4gaGFyZGVuKChsZWZ0LCByaWdodCkgPT4ge1xuICBjb25zdCBtZXJnZWQgPSBnZW5lcmF0ZUNvbGxlY3Rpb25QYWlyRW50cmllcyhcbiAgICBsZWZ0LFxuICAgIHJpZ2h0LFxuICAgIGdldEVudHJpZXMsXG4gICAgYWJzZW50VmFsdWVcbiAgKTtcbiAgbGV0IGxlZnRJc0JpZ2dlciA9IGZhbHNlO1xuICBsZXQgcmlnaHRJc0JpZ2dlciA9IGZhbHNlO1xuICBmb3IgKGNvbnN0IFtfa2V5LCBsZWZ0VmFsdWUsIHJpZ2h0VmFsdWVdIG9mIG1lcmdlZCkge1xuICAgIGNvbnN0IGNvbXAgPSBjb21wYXJlVmFsdWVzMihsZWZ0VmFsdWUsIHJpZ2h0VmFsdWUpO1xuICAgIGlmIChjb21wID09PSAwKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9IGVsc2UgaWYgKGNvbXAgPCAwKSB7XG4gICAgICByaWdodElzQmlnZ2VyID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGNvbXAgPiAwKSB7XG4gICAgICBsZWZ0SXNCaWdnZXIgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBOdW1iZXIuaXNOYU4oY29tcCkgfHwgLy9cbiAgICAgIHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCB2YWx1ZSBjb21wYXJpc29uICR7cXVvdGUoY29tcCl9IGZvciAke2xlZnRWYWx1ZX0gdnMgJHtyaWdodFZhbHVlfWA7XG4gICAgICByZXR1cm4gTmFOO1xuICAgIH1cbiAgICBpZiAobGVmdElzQmlnZ2VyICYmIHJpZ2h0SXNCaWdnZXIpIHtcbiAgICAgIHJldHVybiBOYU47XG4gICAgfVxuICB9XG4gIHJldHVybiBsZWZ0SXNCaWdnZXIgPyAxIDogcmlnaHRJc0JpZ2dlciA/IC0xIDogMDtcbn0pO1xuaGFyZGVuKG1ha2VDb21wYXJlQ29sbGVjdGlvbik7XG5cbi8vXG52YXIgc2V0Q29tcGFyZSA9IG1ha2VDb21wYXJlQ29sbGVjdGlvbihcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgKHMzKSA9PiBoYXJkZW4oZ2V0Q29weVNldEtleXMoczMpLm1hcCgoa2V5KSA9PiBba2V5LCAxXSkpLFxuICAwLFxuICB0cml2aWFsQ29tcGFyYXRvclxuKTtcbmhhcmRlbihzZXRDb21wYXJlKTtcbnZhciBiYWdDb21wYXJlID0gbWFrZUNvbXBhcmVDb2xsZWN0aW9uKFxuICBnZXRDb3B5QmFnRW50cmllcyxcbiAgMG4sXG4gIHRyaXZpYWxDb21wYXJhdG9yXG4pO1xuaGFyZGVuKGJhZ0NvbXBhcmUpO1xudmFyIEFCU0VOVCA9IFN5bWJvbChcImFic2VudFwiKTtcbnZhciBfbWFwQ29tcGFyZSA9IG1ha2VDb21wYXJlQ29sbGVjdGlvbihcbiAgZ2V0Q29weU1hcEVudHJ5QXJyYXksXG4gIEFCU0VOVCxcbiAgKGxlZnRWYWx1ZSwgcmlnaHRWYWx1ZSkgPT4ge1xuICAgIGlmIChsZWZ0VmFsdWUgPT09IEFCU0VOVCAmJiByaWdodFZhbHVlID09PSBBQlNFTlQpIHtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IFVuZXhwZWN0ZWQgYWJzZW50IGVudHJ5IHBhaXJgO1xuICAgIH0gZWxzZSBpZiAobGVmdFZhbHVlID09PSBBQlNFTlQpIHtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9IGVsc2UgaWYgKHJpZ2h0VmFsdWUgPT09IEFCU0VOVCkge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBjb21wYXJlS2V5cyhsZWZ0VmFsdWUsIHJpZ2h0VmFsdWUpO1xuICAgIH1cbiAgfVxuKTtcbmhhcmRlbihfbWFwQ29tcGFyZSk7XG52YXIgY29tcGFyZUtleXMgPSAobGVmdCwgcmlnaHQpID0+IHtcbiAgYXNzZXJ0S2V5KGxlZnQpO1xuICBhc3NlcnRLZXkocmlnaHQpO1xuICBjb25zdCBsZWZ0U3R5bGUgPSBwYXNzU3R5bGVPZihsZWZ0KTtcbiAgY29uc3QgcmlnaHRTdHlsZSA9IHBhc3NTdHlsZU9mKHJpZ2h0KTtcbiAgaWYgKGxlZnRTdHlsZSAhPT0gcmlnaHRTdHlsZSkge1xuICAgIHJldHVybiBOYU47XG4gIH1cbiAgc3dpdGNoIChsZWZ0U3R5bGUpIHtcbiAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgY2FzZSBcIm51bGxcIjpcbiAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgIGNhc2UgXCJiaWdpbnRcIjpcbiAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICByZXR1cm4gY29tcGFyZVJhbmsobGVmdCwgcmlnaHQpO1xuICAgIH1cbiAgICBjYXNlIFwibnVtYmVyXCI6IHtcbiAgICAgIGNvbnN0IHJhbmtDb21wID0gY29tcGFyZVJhbmsobGVmdCwgcmlnaHQpO1xuICAgICAgaWYgKHJhbmtDb21wID09PSAwKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgaWYgKE51bWJlci5pc05hTihsZWZ0KSB8fCBOdW1iZXIuaXNOYU4ocmlnaHQpKSB7XG4gICAgICAgIGFzc2VydCghTnVtYmVyLmlzTmFOKGxlZnQpIHx8ICFOdW1iZXIuaXNOYU4ocmlnaHQpKTtcbiAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgIH1cbiAgICAgIHJldHVybiByYW5rQ29tcDtcbiAgICB9XG4gICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICBpZiAobGVmdCA9PT0gcmlnaHQpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmFOO1xuICAgIH1cbiAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgIGNvbnN0IGxlbiA9IE1hdGgubWluKGxlZnQubGVuZ3RoLCByaWdodC5sZW5ndGgpO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlbjsgaTIgKz0gMSkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21wYXJlS2V5cyhsZWZ0W2kyXSwgcmlnaHRbaTJdKTtcbiAgICAgICAgaWYgKHJlc3VsdCAhPT0gMCkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBjb21wYXJlUmFuayhsZWZ0Lmxlbmd0aCwgcmlnaHQubGVuZ3RoKTtcbiAgICB9XG4gICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgY29uc3QgbGVmdE5hbWVzID0gcmVjb3JkTmFtZXMobGVmdCk7XG4gICAgICBjb25zdCByaWdodE5hbWVzID0gcmVjb3JkTmFtZXMocmlnaHQpO1xuICAgICAgaWYgKCFrZXlFUShsZWZ0TmFtZXMsIHJpZ2h0TmFtZXMpKSB7XG4gICAgICAgIHJldHVybiBOYU47XG4gICAgICB9XG4gICAgICBjb25zdCBsZWZ0VmFsdWVzID0gcmVjb3JkVmFsdWVzKGxlZnQsIGxlZnROYW1lcyk7XG4gICAgICBjb25zdCByaWdodFZhbHVlcyA9IHJlY29yZFZhbHVlcyhyaWdodCwgcmlnaHROYW1lcyk7XG4gICAgICBsZXQgcmVzdWx0ID0gMDtcbiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBsZWZ0VmFsdWVzLmxlbmd0aDsgaTIgKz0gMSkge1xuICAgICAgICBjb25zdCBjb21wID0gY29tcGFyZUtleXMobGVmdFZhbHVlc1tpMl0sIHJpZ2h0VmFsdWVzW2kyXSk7XG4gICAgICAgIGlmIChOdW1iZXIuaXNOYU4oY29tcCkpIHtcbiAgICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN1bHQgIT09IGNvbXAgJiYgY29tcCAhPT0gMCkge1xuICAgICAgICAgIGlmIChyZXN1bHQgPT09IDApIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGNvbXA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFzc2VydChcbiAgICAgICAgICAgICAgcmVzdWx0ID09PSAtMSAmJiBjb21wID09PSAxIHx8IHJlc3VsdCA9PT0gMSAmJiBjb21wID09PSAtMVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBOYU47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgIGNvbnN0IGxlZnRUYWcgPSBnZXRUYWcobGVmdCk7XG4gICAgICBjb25zdCByaWdodFRhZyA9IGdldFRhZyhyaWdodCk7XG4gICAgICBpZiAobGVmdFRhZyAhPT0gcmlnaHRUYWcpIHtcbiAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgIH1cbiAgICAgIHN3aXRjaCAobGVmdFRhZykge1xuICAgICAgICBjYXNlIFwiY29weVNldFwiOiB7XG4gICAgICAgICAgcmV0dXJuIHNldENvbXBhcmUobGVmdCwgcmlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJjb3B5QmFnXCI6IHtcbiAgICAgICAgICByZXR1cm4gYmFnQ29tcGFyZShsZWZ0LCByaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgTWFwIGNvbXBhcmlzb24gbm90IHlldCBpbXBsZW1lbnRlZDogJHtsZWZ0fSB2cyAke3JpZ2h0fWA7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCB0YWcgJHtxdW90ZShsZWZ0VGFnKX06ICR7bGVmdH1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBwYXNzU3R5bGUgJHtxdW90ZShsZWZ0U3R5bGUpfTogJHtsZWZ0fWA7XG4gICAgfVxuICB9XG59O1xuaGFyZGVuKGNvbXBhcmVLZXlzKTtcbnZhciBrZXlMVCA9IChsZWZ0LCByaWdodCkgPT4gY29tcGFyZUtleXMobGVmdCwgcmlnaHQpIDwgMDtcbmhhcmRlbihrZXlMVCk7XG52YXIga2V5TFRFID0gKGxlZnQsIHJpZ2h0KSA9PiBjb21wYXJlS2V5cyhsZWZ0LCByaWdodCkgPD0gMDtcbmhhcmRlbihrZXlMVEUpO1xudmFyIGtleUVRID0gKGxlZnQsIHJpZ2h0KSA9PiBjb21wYXJlS2V5cyhsZWZ0LCByaWdodCkgPT09IDA7XG5oYXJkZW4oa2V5RVEpO1xudmFyIGtleUdURSA9IChsZWZ0LCByaWdodCkgPT4gY29tcGFyZUtleXMobGVmdCwgcmlnaHQpID49IDA7XG5oYXJkZW4oa2V5R1RFKTtcbnZhciBrZXlHVCA9IChsZWZ0LCByaWdodCkgPT4gY29tcGFyZUtleXMobGVmdCwgcmlnaHQpID4gMDtcbmhhcmRlbihrZXlHVCk7XG5cbi8vXG52YXIgd2luZG93UmVzb3J0ID0gKGVsZW1lbnRzLCByYW5rQ29tcGFyZSwgZnVsbENvbXBhcmUpID0+IHtcbiAgYXNzZXJ0UmFua1NvcnRlZChlbGVtZW50cywgcmFua0NvbXBhcmUpO1xuICBjb25zdCB7IGxlbmd0aCB9ID0gZWxlbWVudHM7XG4gIGxldCBpMiA9IDA7XG4gIGxldCBvcHRJbm5lckl0ZXJhdG9yO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4gaGFyZGVuKHtcbiAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgaWYgKG9wdElubmVySXRlcmF0b3IpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBvcHRJbm5lckl0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgICAgIG9wdElubmVySXRlcmF0b3IgPSB2b2lkIDA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChpMiA8IGxlbmd0aCkge1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gZWxlbWVudHNbaTJdO1xuICAgICAgICAgIGxldCBqID0gaTIgKyAxO1xuICAgICAgICAgIHdoaWxlIChqIDwgbGVuZ3RoICYmIHJhbmtDb21wYXJlKHZhbHVlLCBlbGVtZW50c1tqXSkgPT09IDApIHtcbiAgICAgICAgICAgIGogKz0gMTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGogPT09IGkyICsgMSkge1xuICAgICAgICAgICAgaTIgPSBqO1xuICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3Qgc2ltaWxhclJ1biA9IGVsZW1lbnRzLnNsaWNlKGkyLCBqKTtcbiAgICAgICAgICBpMiA9IGo7XG4gICAgICAgICAgY29uc3QgcmVzb3J0ZWQgPSBzb3J0QnlSYW5rKHNpbWlsYXJSdW4sIGZ1bGxDb21wYXJlKTtcbiAgICAgICAgICBhc3NlcnROb0R1cGxpY2F0ZXMocmVzb3J0ZWQsIGZ1bGxDb21wYXJlKTtcbiAgICAgICAgICBvcHRJbm5lckl0ZXJhdG9yID0gcmVzb3J0ZWRbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgICAgIHJldHVybiBvcHRJbm5lckl0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IG51bGwgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICB9KTtcbn07XG52YXIgbWVyZ2UgPSAoeGVsZW1lbnRzLCB5ZWxlbWVudHMpID0+IHtcbiAgY29uc3QgZnVsbENvbXBhcmUgPSBtYWtlRnVsbE9yZGVyQ29tcGFyYXRvcktpdCgpLmFudGlDb21wYXJhdG9yO1xuICBjb25zdCB4cyA9IHdpbmRvd1Jlc29ydCh4ZWxlbWVudHMsIGNvbXBhcmVBbnRpUmFuaywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB5cyA9IHdpbmRvd1Jlc29ydCh5ZWxlbWVudHMsIGNvbXBhcmVBbnRpUmFuaywgZnVsbENvbXBhcmUpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgbGV0IHg7XG4gICAgICBsZXQgeERvbmU7XG4gICAgICBsZXQgeTtcbiAgICAgIGxldCB5RG9uZTtcbiAgICAgIGNvbnN0IHhpID0geHNbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgY29uc3QgbmV4dFggPSAoKSA9PiB7XG4gICAgICAgICF4RG9uZSB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBuZXh0WCBzaG91bGQgbm90IGJlIGNhbGxlZCBvbmNlIGRvbmVgO1xuICAgICAgICAoeyBkb25lOiB4RG9uZSwgdmFsdWU6IHggfSA9IHhpLm5leHQoKSk7XG4gICAgICB9O1xuICAgICAgbmV4dFgoKTtcbiAgICAgIGNvbnN0IHlpID0geXNbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgY29uc3QgbmV4dFkgPSAoKSA9PiB7XG4gICAgICAgICF5RG9uZSB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBuZXh0WSBzaG91bGQgbm90IGJlIGNhbGxlZCBvbmNlIGRvbmVgO1xuICAgICAgICAoeyBkb25lOiB5RG9uZSwgdmFsdWU6IHkgfSA9IHlpLm5leHQoKSk7XG4gICAgICB9O1xuICAgICAgbmV4dFkoKTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgbGV0IGRvbmUgPSBmYWxzZTtcbiAgICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgICAgaWYgKHhEb25lICYmIHlEb25lKSB7XG4gICAgICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhbHVlID0gW251bGwsIDBuLCAwbl07XG4gICAgICAgICAgfSBlbHNlIGlmICh4RG9uZSkge1xuICAgICAgICAgICAgdmFsdWUgPSBbeSwgMG4sIDFuXTtcbiAgICAgICAgICAgIG5leHRZKCk7XG4gICAgICAgICAgfSBlbHNlIGlmICh5RG9uZSkge1xuICAgICAgICAgICAgdmFsdWUgPSBbeCwgMW4sIDBuXTtcbiAgICAgICAgICAgIG5leHRYKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbXAgPSBmdWxsQ29tcGFyZSh4LCB5KTtcbiAgICAgICAgICAgIGlmIChjb21wID09PSAwKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gW3gsIDFuLCAxbl07XG4gICAgICAgICAgICAgIG5leHRYKCk7XG4gICAgICAgICAgICAgIG5leHRZKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXAgPCAwKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gW3gsIDFuLCAwbl07XG4gICAgICAgICAgICAgIG5leHRYKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb21wID4gMCB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBVbmV4cGVjdGVkIGNvbXAgJHtxdW90ZShjb21wKX1gO1xuICAgICAgICAgICAgICB2YWx1ZSA9IFt5LCAwbiwgMW5dO1xuICAgICAgICAgICAgICBuZXh0WSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZSwgdmFsdWUgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1lcmdlKTtcbnZhciBpdGVySXNTdXBlcnNldCA9ICh4eWkpID0+IHtcbiAgZm9yIChjb25zdCBbX20sIHhjLCBfeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA9PT0gMG4pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xudmFyIGl0ZXJJc0Rpc2pvaW50ID0gKHh5aSkgPT4ge1xuICBmb3IgKGNvbnN0IFtfbSwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICBpZiAoeGMgPj0gMW4gJiYgeWMgPj0gMW4pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xudmFyIGl0ZXJDb21wYXJlID0gKHh5aSkgPT4ge1xuICBsZXQgbG9uZVkgPSBmYWxzZTtcbiAgbGV0IGxvbmVYID0gZmFsc2U7XG4gIGZvciAoY29uc3QgW19tLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA9PT0gMG4pIHtcbiAgICAgIGxvbmVZID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHljID09PSAwbikge1xuICAgICAgbG9uZVggPSB0cnVlO1xuICAgIH1cbiAgICBpZiAobG9uZVggJiYgbG9uZVkpIHtcbiAgICAgIHJldHVybiBOYU47XG4gICAgfVxuICB9XG4gIGlmIChsb25lWCkge1xuICAgIHJldHVybiAxO1xuICB9IGVsc2UgaWYgKGxvbmVZKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9IGVsc2Uge1xuICAgICFsb25lWCAmJiAhbG9uZVkgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogVW5leHBlY3RlZCBsb25lIHBhaXIgJHtxdW90ZShbbG9uZVgsIGxvbmVZXSl9YDtcbiAgICByZXR1cm4gMDtcbiAgfVxufTtcbnZhciBpdGVyVW5pb24gPSAoeHlpKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3IgKGNvbnN0IFttMiwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICBpZiAoeGMgPj0gMG4pIHtcbiAgICAgIHJlc3VsdC5wdXNoKG0yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgeWMgPj0gMG4gfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogVW5leHBlY3RlZCBjb3VudCAke3F1b3RlKHljKX1gO1xuICAgICAgcmVzdWx0LnB1c2gobTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBpdGVyRGlzam9pbnRVbmlvbiA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIHhjID09PSAwbiB8fCB5YyA9PT0gMG4gfHwgdGhyb3dSZWRhY3RlZGBTZXRzIG11c3Qgbm90IGhhdmUgY29tbW9uIGVsZW1lbnRzOiAke20yfWA7XG4gICAgaWYgKHhjID49IDFuKSB7XG4gICAgICByZXN1bHQucHVzaChtMik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHljID49IDFuIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IFVuZXhwZWN0ZWQgY291bnQgJHtxdW90ZSh5Yyl9YDtcbiAgICAgIHJlc3VsdC5wdXNoKG0yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgaXRlckludGVyc2VjdGlvbiA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA+PSAxbiAmJiB5YyA+PSAxbikge1xuICAgICAgcmVzdWx0LnB1c2gobTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBpdGVyRGlzam9pbnRTdWJ0cmFjdCA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIHhjID49IDFuIHx8IHRocm93UmVkYWN0ZWRgcmlnaHQgZWxlbWVudCAke20yfSB3YXMgbm90IGluIGxlZnRgO1xuICAgIGlmICh5YyA9PT0gMG4pIHtcbiAgICAgIHJlc3VsdC5wdXNoKG0yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgbWVyZ2VpZnkgPSAoaXRlck9wKSA9PiAoeGVsZW1lbnRzLCB5ZWxlbWVudHMpID0+IGl0ZXJPcChtZXJnZSh4ZWxlbWVudHMsIHllbGVtZW50cykpO1xudmFyIGVsZW1lbnRzSXNTdXBlcnNldCA9IG1lcmdlaWZ5KGl0ZXJJc1N1cGVyc2V0KTtcbnZhciBlbGVtZW50c0lzRGlzam9pbnQgPSBtZXJnZWlmeShpdGVySXNEaXNqb2ludCk7XG52YXIgZWxlbWVudHNDb21wYXJlID0gbWVyZ2VpZnkoaXRlckNvbXBhcmUpO1xudmFyIGVsZW1lbnRzVW5pb24gPSBtZXJnZWlmeShpdGVyVW5pb24pO1xudmFyIGVsZW1lbnRzRGlzam9pbnRVbmlvbiA9IG1lcmdlaWZ5KGl0ZXJEaXNqb2ludFVuaW9uKTtcbnZhciBlbGVtZW50c0ludGVyc2VjdGlvbiA9IG1lcmdlaWZ5KGl0ZXJJbnRlcnNlY3Rpb24pO1xudmFyIGVsZW1lbnRzRGlzam9pbnRTdWJ0cmFjdCA9IG1lcmdlaWZ5KGl0ZXJEaXNqb2ludFN1YnRyYWN0KTtcbnZhciByYXdTZXRpZnkgPSAoZWxlbWVudHNPcCkgPT4gKHhzZXQsIHlzZXQpID0+IGVsZW1lbnRzT3AoeHNldC5wYXlsb2FkLCB5c2V0LnBheWxvYWQpO1xudmFyIHNldGlmeSA9IChlbGVtZW50c09wKSA9PiAoeHNldCwgeXNldCkgPT4gbWFrZVNldE9mRWxlbWVudHMoZWxlbWVudHNPcCh4c2V0LnBheWxvYWQsIHlzZXQucGF5bG9hZCkpO1xudmFyIHNldElzU3VwZXJzZXQgPSByYXdTZXRpZnkoZWxlbWVudHNJc1N1cGVyc2V0KTtcbnZhciBzZXRJc0Rpc2pvaW50ID0gcmF3U2V0aWZ5KGVsZW1lbnRzSXNEaXNqb2ludCk7XG52YXIgc2V0VW5pb24gPSBzZXRpZnkoZWxlbWVudHNVbmlvbik7XG52YXIgc2V0RGlzam9pbnRVbmlvbiA9IHNldGlmeShlbGVtZW50c0Rpc2pvaW50VW5pb24pO1xudmFyIHNldEludGVyc2VjdGlvbiA9IHNldGlmeShlbGVtZW50c0ludGVyc2VjdGlvbik7XG52YXIgc2V0RGlzam9pbnRTdWJ0cmFjdCA9IHNldGlmeShlbGVtZW50c0Rpc2pvaW50U3VidHJhY3QpO1xuXG4vL1xudmFyIGJhZ1dpbmRvd1Jlc29ydCA9IChiYWdFbnRyaWVzLCByYW5rQ29tcGFyZSwgZnVsbENvbXBhcmUpID0+IHtcbiAgYXNzZXJ0UmFua1NvcnRlZChiYWdFbnRyaWVzLCByYW5rQ29tcGFyZSk7XG4gIGNvbnN0IHsgbGVuZ3RoIH0gPSBiYWdFbnRyaWVzO1xuICBsZXQgaTIgPSAwO1xuICBsZXQgb3B0SW5uZXJJdGVyYXRvcjtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IGhhcmRlbih7XG4gICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgIGlmIChvcHRJbm5lckl0ZXJhdG9yKSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gb3B0SW5uZXJJdGVyYXRvci5uZXh0KCk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICAgICAgICBvcHRJbm5lckl0ZXJhdG9yID0gdm9pZCAwO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaTIgPCBsZW5ndGgpIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGJhZ0VudHJpZXNbaTJdO1xuICAgICAgICAgIGxldCBqID0gaTIgKyAxO1xuICAgICAgICAgIHdoaWxlIChqIDwgbGVuZ3RoICYmIHJhbmtDb21wYXJlKGVudHJ5WzBdLCBiYWdFbnRyaWVzW2pdWzBdKSA9PT0gMCkge1xuICAgICAgICAgICAgaiArPSAxO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaiA9PT0gaTIgKyAxKSB7XG4gICAgICAgICAgICBpMiA9IGo7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlOiBlbnRyeSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3Qgc2ltaWxhclJ1biA9IGJhZ0VudHJpZXMuc2xpY2UoaTIsIGopO1xuICAgICAgICAgIGkyID0gajtcbiAgICAgICAgICBjb25zdCByZXNvcnRlZCA9IHNvcnRCeVJhbmsoc2ltaWxhclJ1biwgZnVsbENvbXBhcmUpO1xuICAgICAgICAgIGFzc2VydE5vRHVwbGljYXRlS2V5cyhyZXNvcnRlZCwgZnVsbENvbXBhcmUpO1xuICAgICAgICAgIG9wdElubmVySXRlcmF0b3IgPSByZXNvcnRlZFtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICAgICAgcmV0dXJuIG9wdElubmVySXRlcmF0b3IubmV4dCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogW251bGwsIDBuXSB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIH0pO1xufTtcbnZhciBtZXJnZTIgPSAoeGJhZ0VudHJpZXMsIHliYWdFbnRyaWVzKSA9PiB7XG4gIGNvbnN0IGZ1bGxDb21wYXJlID0gbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgY29uc3QgeHMgPSBiYWdXaW5kb3dSZXNvcnQoeGJhZ0VudHJpZXMsIGNvbXBhcmVBbnRpUmFuaywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB5cyA9IGJhZ1dpbmRvd1Jlc29ydCh5YmFnRW50cmllcywgY29tcGFyZUFudGlSYW5rLCBmdWxsQ29tcGFyZSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBsZXQgeDtcbiAgICAgIGxldCB4YztcbiAgICAgIGxldCB4RG9uZTtcbiAgICAgIGxldCB5O1xuICAgICAgbGV0IHljO1xuICAgICAgbGV0IHlEb25lO1xuICAgICAgY29uc3QgeGkgPSB4c1tTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICBjb25zdCBuZXh0WCA9ICgpID0+IHtcbiAgICAgICAgIXhEb25lIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IG5leHRYIHNob3VsZCBub3QgYmUgY2FsbGVkIG9uY2UgZG9uZWA7XG4gICAgICAgICh7XG4gICAgICAgICAgZG9uZTogeERvbmUsXG4gICAgICAgICAgdmFsdWU6IFt4LCB4Y11cbiAgICAgICAgfSA9IHhpLm5leHQoKSk7XG4gICAgICB9O1xuICAgICAgbmV4dFgoKTtcbiAgICAgIGNvbnN0IHlpID0geXNbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgY29uc3QgbmV4dFkgPSAoKSA9PiB7XG4gICAgICAgICF5RG9uZSB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBuZXh0WSBzaG91bGQgbm90IGJlIGNhbGxlZCBvbmNlIGRvbmVgO1xuICAgICAgICAoe1xuICAgICAgICAgIGRvbmU6IHlEb25lLFxuICAgICAgICAgIHZhbHVlOiBbeSwgeWNdXG4gICAgICAgIH0gPSB5aS5uZXh0KCkpO1xuICAgICAgfTtcbiAgICAgIG5leHRZKCk7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGxldCBkb25lID0gZmFsc2U7XG4gICAgICAgICAgbGV0IHZhbHVlO1xuICAgICAgICAgIGlmICh4RG9uZSAmJiB5RG9uZSkge1xuICAgICAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgICAgICB2YWx1ZSA9IFtudWxsLCAwbiwgMG5dO1xuICAgICAgICAgIH0gZWxzZSBpZiAoeERvbmUpIHtcbiAgICAgICAgICAgIHZhbHVlID0gW3ksIDBuLCB5Y107XG4gICAgICAgICAgICBuZXh0WSgpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoeURvbmUpIHtcbiAgICAgICAgICAgIHZhbHVlID0gW3gsIHhjLCAwbl07XG4gICAgICAgICAgICBuZXh0WCgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBjb21wID0gZnVsbENvbXBhcmUoeCwgeSk7XG4gICAgICAgICAgICBpZiAoY29tcCA9PT0gMCkge1xuICAgICAgICAgICAgICB2YWx1ZSA9IFt4LCB4YywgeWNdO1xuICAgICAgICAgICAgICBuZXh0WCgpO1xuICAgICAgICAgICAgICBuZXh0WSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wIDwgMCkge1xuICAgICAgICAgICAgICB2YWx1ZSA9IFt4LCB4YywgMG5dO1xuICAgICAgICAgICAgICBuZXh0WCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29tcCA+IDAgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogVW5leHBlY3RlZCBjb21wICR7cXVvdGUoY29tcCl9YDtcbiAgICAgICAgICAgICAgdmFsdWUgPSBbeSwgMG4sIHljXTtcbiAgICAgICAgICAgICAgbmV4dFkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmUsIHZhbHVlIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihtZXJnZTIpO1xudmFyIGJhZ0l0ZXJJc1N1cGVyYmFnID0gKHh5aSkgPT4ge1xuICBmb3IgKGNvbnN0IFtfbSwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICBpZiAoeGMgPCB5Yykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgYmFnSXRlcklzRGlzam9pbnQgPSAoeHlpKSA9PiB7XG4gIGZvciAoY29uc3QgW19tLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA+PSAxbiAmJiB5YyA+PSAxbikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgYmFnSXRlclVuaW9uID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgcmVzdWx0LnB1c2goW20yLCB4YyArIHljXSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgYmFnSXRlckludGVyc2VjdGlvbiA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGNvbnN0IG1jID0geGMgPD0geWMgPyB4YyA6IHljO1xuICAgIHJlc3VsdC5wdXNoKFttMiwgbWNdKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBiYWdJdGVyRGlzam9pbnRTdWJ0cmFjdCA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGNvbnN0IG1jID0geGMgLSB5YztcbiAgICBtYyA+PSAwbiB8fCB0aHJvd1JlZGFjdGVkYHJpZ2h0IGVsZW1lbnQgJHttMn0gd2FzIG5vdCBpbiBsZWZ0YDtcbiAgICBpZiAobWMgPj0gMW4pIHtcbiAgICAgIHJlc3VsdC5wdXNoKFttMiwgbWNdKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgbWVyZ2VpZnkyID0gKGJhZ0l0ZXJPcCkgPT4gKHhiYWdFbnRyaWVzLCB5YmFnRW50cmllcykgPT4gYmFnSXRlck9wKG1lcmdlMih4YmFnRW50cmllcywgeWJhZ0VudHJpZXMpKTtcbnZhciBiYWdFbnRyaWVzSXNTdXBlcmJhZyA9IG1lcmdlaWZ5MihiYWdJdGVySXNTdXBlcmJhZyk7XG52YXIgYmFnRW50cmllc0lzRGlzam9pbnQgPSBtZXJnZWlmeTIoYmFnSXRlcklzRGlzam9pbnQpO1xudmFyIGJhZ0VudHJpZXNVbmlvbiA9IG1lcmdlaWZ5MihiYWdJdGVyVW5pb24pO1xudmFyIGJhZ0VudHJpZXNJbnRlcnNlY3Rpb24gPSBtZXJnZWlmeTIoYmFnSXRlckludGVyc2VjdGlvbik7XG52YXIgYmFnRW50cmllc0Rpc2pvaW50U3VidHJhY3QgPSBtZXJnZWlmeTIoYmFnSXRlckRpc2pvaW50U3VidHJhY3QpO1xudmFyIHJhd0JhZ2lmeSA9IChiYWdFbnRyaWVzT3ApID0+ICh4YmFnLCB5YmFnKSA9PiBiYWdFbnRyaWVzT3AoeGJhZy5wYXlsb2FkLCB5YmFnLnBheWxvYWQpO1xudmFyIGJhZ2lmeSA9IChiYWdFbnRyaWVzT3ApID0+ICh4YmFnLCB5YmFnKSA9PiBtYWtlQmFnT2ZFbnRyaWVzKGJhZ0VudHJpZXNPcCh4YmFnLnBheWxvYWQsIHliYWcucGF5bG9hZCkpO1xudmFyIGJhZ0lzU3VwZXJiYWcgPSByYXdCYWdpZnkoYmFnRW50cmllc0lzU3VwZXJiYWcpO1xudmFyIGJhZ0lzRGlzam9pbnQgPSByYXdCYWdpZnkoYmFnRW50cmllc0lzRGlzam9pbnQpO1xudmFyIGJhZ1VuaW9uID0gYmFnaWZ5KGJhZ0VudHJpZXNVbmlvbik7XG52YXIgYmFnSW50ZXJzZWN0aW9uID0gYmFnaWZ5KGJhZ0VudHJpZXNJbnRlcnNlY3Rpb24pO1xudmFyIGJhZ0Rpc2pvaW50U3VidHJhY3QgPSBiYWdpZnkoYmFnRW50cmllc0Rpc2pvaW50U3VidHJhY3QpO1xuXG4vL1xudmFyIHRocm93TGFiZWxlZCA9IChpbm5lckVyciwgbGFiZWwsIGVyckNvbnN0cnVjdG9yID0gdm9pZCAwLCBvcHRpb25zID0gdm9pZCAwKSA9PiB7XG4gIGlmICh0eXBlb2YgbGFiZWwgPT09IFwibnVtYmVyXCIpIHtcbiAgICBsYWJlbCA9IGBbJHtsYWJlbH1dYDtcbiAgfVxuICBjb25zdCBvdXRlckVyciA9IG1ha2VFcnJvcihcbiAgICBgJHtsYWJlbH06ICR7aW5uZXJFcnIubWVzc2FnZX1gLFxuICAgIGVyckNvbnN0cnVjdG9yLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgbm90ZShvdXRlckVyciwgcmVkYWN0ZWRgQ2F1c2VkIGJ5ICR7aW5uZXJFcnJ9YCk7XG4gIHRocm93IG91dGVyRXJyO1xufTtcbmhhcmRlbih0aHJvd0xhYmVsZWQpO1xuXG4vL1xudmFyIGFwcGx5TGFiZWxpbmdFcnJvciA9IChmdW5jLCBhcmdzLCBsYWJlbCA9IHZvaWQgMCkgPT4ge1xuICBpZiAobGFiZWwgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiBmdW5jKC4uLmFyZ3MpO1xuICB9XG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gZnVuYyguLi5hcmdzKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgdGhyb3dMYWJlbGVkKGVyciwgbGFiZWwpO1xuICB9XG4gIGlmIChpc1Byb21pc2UocmVzdWx0KSkge1xuICAgIHJldHVybiBFLndoZW4ocmVzdWx0LCB2b2lkIDAsIChyZWFzb24pID0+IHRocm93TGFiZWxlZChyZWFzb24sIGxhYmVsKSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufTtcbmhhcmRlbihhcHBseUxhYmVsaW5nRXJyb3IpO1xuXG4vL1xudmFyIHsgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzNyB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czE2IH0gPSBSZWZsZWN0O1xudmFyIGZyb21VbmlxdWVFbnRyaWVzID0gKGFsbEVudHJpZXMpID0+IHtcbiAgY29uc3QgZW50cmllc0FycmF5ID0gWy4uLmFsbEVudHJpZXNdO1xuICBjb25zdCByZXN1bHQgPSBoYXJkZW4oZnJvbUVudHJpZXM3KGVudHJpZXNBcnJheSkpO1xuICBpZiAob3duS2V5czE2KHJlc3VsdCkubGVuZ3RoID09PSBlbnRyaWVzQXJyYXkubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuICBjb25zdCBuYW1lcyA9IC8qICAgICAgICAgICAqLyBuZXcgU2V0KCk7XG4gIGZvciAoY29uc3QgW25hbWUsIF9dIG9mIGVudHJpZXNBcnJheSkge1xuICAgIGlmIChuYW1lcy5oYXMobmFtZSkpIHtcbiAgICAgIHRocm93UmVkYWN0ZWRgY29sbGlzaW9uIG9uIHByb3BlcnR5IG5hbWUgJHtxdW90ZShuYW1lKX06ICR7ZW50cmllc0FycmF5fWA7XG4gICAgfVxuICAgIG5hbWVzLmFkZChuYW1lKTtcbiAgfVxuICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBmYWlsZWQgdG8gY3JlYXRlIG9iamVjdCBmcm9tIHVuaXF1ZSBlbnRyaWVzYDtcbn07XG5oYXJkZW4oZnJvbVVuaXF1ZUVudHJpZXMpO1xuXG4vL1xudmFyIGxpc3REaWZmZXJlbmNlID0gKGxlZnRMaXN0LCByaWdodExpc3QpID0+IHtcbiAgY29uc3QgcmlnaHRTZXQgPSBuZXcgU2V0KHJpZ2h0TGlzdCk7XG4gIHJldHVybiBsZWZ0TGlzdC5maWx0ZXIoKGVsZW1lbnQpID0+ICFyaWdodFNldC5oYXMoZWxlbWVudCkpO1xufTtcbmhhcmRlbihsaXN0RGlmZmVyZW5jZSk7XG5cbi8vXG52YXIgeyBlbnRyaWVzOiBlbnRyaWVzNywgdmFsdWVzOiB2YWx1ZXMyIH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTcgfSA9IFJlZmxlY3Q7XG52YXIgcGF0dGVybk1lbW8gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKTtcbnZhciBNTTtcbnZhciBkZWZhdWx0TGltaXRzID0gaGFyZGVuKHtcbiAgZGVjaW1hbERpZ2l0c0xpbWl0OiAxMDAsXG4gIHN0cmluZ0xlbmd0aExpbWl0OiAxZTUsXG4gIHN5bWJvbE5hbWVMZW5ndGhMaW1pdDogMTAwLFxuICBudW1Qcm9wZXJ0aWVzTGltaXQ6IDgwLFxuICBwcm9wZXJ0eU5hbWVMZW5ndGhMaW1pdDogMTAwLFxuICBhcnJheUxlbmd0aExpbWl0OiAxZTQsXG4gIG51bVNldEVsZW1lbnRzTGltaXQ6IDFlNCxcbiAgbnVtVW5pcXVlQmFnRWxlbWVudHNMaW1pdDogMWU0LFxuICBudW1NYXBFbnRyaWVzTGltaXQ6IDVlM1xufSk7XG52YXIgbGltaXQgPSAobGltaXRzID0ge30pID0+IChcbiAgLyogICAgICAgICAgICAgICAgICAgICovXG4gIGhhcmRlbih7IF9fcHJvdG9fXzogZGVmYXVsdExpbWl0cywgLi4ubGltaXRzIH0pXG4pO1xudmFyIGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0ID0gKHBheWxvYWQsIG1haW5QYXlsb2FkU2hhcGUsIGNoZWNrLCBsYWJlbCkgPT4ge1xuICBhc3NlcnQoQXJyYXkuaXNBcnJheShtYWluUGF5bG9hZFNoYXBlKSk7XG4gIGlmICghQXJyYXkuaXNBcnJheShwYXlsb2FkKSkge1xuICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtxdW90ZShsYWJlbCl9IHBheWxvYWQgbXVzdCBiZSBhbiBhcnJheTogJHtwYXlsb2FkfWApO1xuICB9XG4gIGNvbnN0IG1haW5MZW5ndGggPSBtYWluUGF5bG9hZFNoYXBlLmxlbmd0aDtcbiAgaWYgKCEocGF5bG9hZC5sZW5ndGggPT09IG1haW5MZW5ndGggfHwgcGF5bG9hZC5sZW5ndGggPT09IG1haW5MZW5ndGggKyAxKSkge1xuICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtxdW90ZShsYWJlbCl9IHBheWxvYWQgdW5leHBlY3RlZCBzaXplOiAke3BheWxvYWR9YCk7XG4gIH1cbiAgY29uc3QgbGltaXRzID0gcGF5bG9hZFttYWluTGVuZ3RoXTtcbiAgcGF5bG9hZCA9IGhhcmRlbihwYXlsb2FkLnNsaWNlKDAsIG1haW5MZW5ndGgpKTtcbiAgaWYgKCFjaGVja01hdGNoZXMocGF5bG9hZCwgbWFpblBheWxvYWRTaGFwZSwgY2hlY2ssIGxhYmVsKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBpZiAobGltaXRzID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gKHBhc3NTdHlsZU9mKGxpbWl0cykgPT09IFwiY29weVJlY29yZFwiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBMaW1pdHMgbXVzdCBiZSBhIHJlY29yZDogJHtxdW90ZShsaW1pdHMpfWApKSAmJiBlbnRyaWVzNyhsaW1pdHMpLmV2ZXJ5KFxuICAgIChba2V5LCB2YWx1ZV0pID0+IHBhc3NTdHlsZU9mKHZhbHVlKSA9PT0gXCJudW1iZXJcIiB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgVmFsdWUgb2YgbGltaXQgJHtxdW90ZShrZXkpfSBidXQgYmUgYSBudW1iZXI6ICR7cXVvdGUodmFsdWUpfWApXG4gICk7XG59O1xudmFyIGNoZWNrRGVjaW1hbERpZ2l0c0xpbWl0ID0gKHNwZWNpbWVuLCBkZWNpbWFsRGlnaXRzTGltaXQsIGNoZWNrKSA9PiB7XG4gIGlmIChNYXRoLmZsb29yKE1hdGgubG9nMTAoTWF0aC5hYnMoTnVtYmVyKHNwZWNpbWVuKSkpKSArIDEgPD0gZGVjaW1hbERpZ2l0c0xpbWl0KSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGNoZWNrKFxuICAgIGZhbHNlLFxuICAgIHJlZGFjdGVkYGJpZ2ludCAke3NwZWNpbWVufSBtdXN0IG5vdCBoYXZlIG1vcmUgdGhhbiAke2RlY2ltYWxEaWdpdHNMaW1pdH0gZGlnaXRzYFxuICApO1xufTtcbnZhciBtYWtlUGF0dGVybktpdCA9ICgpID0+IHtcbiAgY29uc3QgbWF5YmVNYXRjaEhlbHBlciA9ICh0YWcpID0+IChcbiAgICAvL1xuICAgIEhlbHBlcnNCeU1hdGNoVGFnW3RhZ11cbiAgKTtcbiAgY29uc3QgbWF5YmVQYXlsb2FkU2hhcGUgPSAodGFnKSA9PiAoXG4gICAgLy9cbiAgICBHdWFyZFBheWxvYWRTaGFwZXNbdGFnXVxuICApO1xuICBjb25zdCBzaW5nbGV0b25LaW5kcyA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKFtcbiAgICBbXCJudWxsXCIsIG51bGxdLFxuICAgIFtcInVuZGVmaW5lZFwiLCB2b2lkIDBdXG4gIF0pO1xuICBjb25zdCB0YWdNZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IGNoZWNrVGFnZ2VkID0gKHRhZ2dlZCwgdGFnLCBjaGVjaykgPT4ge1xuICAgIGNvbnN0IG1hdGNoSGVscGVyID0gbWF5YmVNYXRjaEhlbHBlcih0YWcpO1xuICAgIGlmIChtYXRjaEhlbHBlcikge1xuICAgICAgcmV0dXJuIG1hdGNoSGVscGVyLmNoZWNrSXNXZWxsRm9ybWVkKHRhZ2dlZC5wYXlsb2FkLCBjaGVjayk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHBheWxvYWRTaGFwZSA9IG1heWJlUGF5bG9hZFNoYXBlKHRhZyk7XG4gICAgICBpZiAocGF5bG9hZFNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIGNoZWNrTWF0Y2hlczIodGFnZ2VkLnBheWxvYWQsIHBheWxvYWRTaGFwZSwgY2hlY2ssIHRhZyk7XG4gICAgICB9XG4gICAgfVxuICAgIHN3aXRjaCAodGFnKSB7XG4gICAgICBjYXNlIFwiY29weVNldFwiOiB7XG4gICAgICAgIHJldHVybiBjaGVja0NvcHlTZXQodGFnZ2VkLCBjaGVjayk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUJhZ1wiOiB7XG4gICAgICAgIHJldHVybiBjaGVja0NvcHlCYWcodGFnZ2VkLCBjaGVjayk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weU1hcFwiOiB7XG4gICAgICAgIHJldHVybiBjaGVja0NvcHlNYXAodGFnZ2VkLCBjaGVjayk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICByZWRhY3RlZGBjYW5ub3QgY2hlY2sgdW5yZWNvZ25pemVkIHRhZyAke3F1b3RlKHRhZyl9OiAke3RhZ2dlZH1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBraW5kT2YyID0gKHNwZWNpbWVuLCBjaGVjayA9IGlkZW50Q2hlY2tlcikgPT4ge1xuICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHNwZWNpbWVuKTtcbiAgICBpZiAocGFzc1N0eWxlICE9PSBcInRhZ2dlZFwiKSB7XG4gICAgICByZXR1cm4gcGFzc1N0eWxlO1xuICAgIH1cbiAgICBpZiAodGFnTWVtby5oYXMoc3BlY2ltZW4pKSB7XG4gICAgICByZXR1cm4gdGFnTWVtby5nZXQoc3BlY2ltZW4pO1xuICAgIH1cbiAgICBjb25zdCB0YWcgPSBnZXRUYWcoc3BlY2ltZW4pO1xuICAgIGlmIChjaGVja1RhZ2dlZChzcGVjaW1lbiwgdGFnLCBjaGVjaykpIHtcbiAgICAgIHRhZ01lbW8uc2V0KHNwZWNpbWVuLCB0YWcpO1xuICAgICAgcmV0dXJuIHRhZztcbiAgICB9XG4gICAgaWYgKGNoZWNrICE9PSBpZGVudENoZWNrZXIpIHtcbiAgICAgIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBjYW5ub3QgY2hlY2sgdW5yZWNvZ25pemVkIHRhZyAke3F1b3RlKHRhZyl9YCk7XG4gICAgfVxuICAgIHJldHVybiB2b2lkIDA7XG4gIH07XG4gIGhhcmRlbihraW5kT2YyKTtcbiAgY29uc3QgY2hlY2tLaW5kID0gKHNwZWNpbWVuLCBraW5kMiwgY2hlY2spID0+IHtcbiAgICBpZiAoc2luZ2xldG9uS2luZHMuaGFzKGtpbmQyKSkge1xuICAgICAgcmV0dXJuIGNoZWNrQXNLZXlQYXR0KHNwZWNpbWVuLCBzaW5nbGV0b25LaW5kcy5nZXQoa2luZDIpLCBjaGVjayk7XG4gICAgfVxuICAgIGNvbnN0IHJlYWxLaW5kID0ga2luZE9mMihzcGVjaW1lbiwgY2hlY2spO1xuICAgIGlmIChraW5kMiA9PT0gcmVhbEtpbmQpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoY2hlY2sgIT09IGlkZW50Q2hlY2tlcikge1xuICAgICAgY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7YmFyZU9yUXVvdGUocmVhbEtpbmQpfSAke3NwZWNpbWVufSAtIE11c3QgYmUgYSAke2JhcmVPclF1b3RlKGtpbmQyKX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICBjb25zdCBpc0tpbmQgPSAoc3BlY2ltZW4sIGtpbmQyKSA9PiBjaGVja0tpbmQoc3BlY2ltZW4sIGtpbmQyLCBpZGVudENoZWNrZXIpO1xuICBjb25zdCBjaGVja0FzS2V5UGF0dCA9IChzcGVjaW1lbiwga2V5QXNQYXR0ZXJuLCBjaGVjaykgPT4ge1xuICAgIGlmIChpc0tleShzcGVjaW1lbikgJiYga2V5RVEoc3BlY2ltZW4sIGtleUFzUGF0dGVybikpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gY2hlY2sgIT09IGlkZW50Q2hlY2tlciAmJiAvL1xuICAgIC8vXG4gICAgY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZTogJHtrZXlBc1BhdHRlcm59YCk7XG4gIH07XG4gIGNvbnN0IGNoZWNrUGF0dGVybiA9IChwYXR0LCBjaGVjaykgPT4ge1xuICAgIGlmIChpc0tleShwYXR0KSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChwYXR0ZXJuTWVtby5oYXMocGF0dCkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQgPSBjaGVja1BhdHRlcm5JbnRlcm5hbChwYXR0LCBjaGVjayk7XG4gICAgaWYgKHJlc3VsdCkge1xuICAgICAgcGF0dGVybk1lbW8uYWRkKHBhdHQpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuICBjb25zdCBjaGVja1BhdHRlcm5JbnRlcm5hbCA9IChwYXR0LCBjaGVjaykgPT4ge1xuICAgIGNvbnN0IGNoZWNrSXQgPSAoY2hpbGQpID0+IGNoZWNrUGF0dGVybihjaGlsZCwgY2hlY2spO1xuICAgIGNvbnN0IGtpbmQyID0ga2luZE9mMihwYXR0LCBjaGVjayk7XG4gICAgc3dpdGNoIChraW5kMikge1xuICAgICAgY2FzZSB2b2lkIDA6IHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICByZXR1cm4gdmFsdWVzMihwYXR0KS5ldmVyeShjaGVja0l0KTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICByZXR1cm4gcGF0dC5ldmVyeShjaGVja0l0KTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5TWFwXCI6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrUGF0dGVybihwYXR0LnZhbHVlcywgY2hlY2spO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSAke3F1b3RlKGtpbmQyKX0gY2Fubm90IGJlIGEgcGF0dGVybmApO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBpZiAobWF5YmVNYXRjaEhlbHBlcihraW5kMikgIT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICByZWRhY3RlZGBBIHBhc3NhYmxlIG9mIGtpbmQgJHtxdW90ZShraW5kMil9IGlzIG5vdCBhIHBhdHRlcm46ICR7cGF0dH1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBpc1BhdHRlcm4yID0gKHBhdHQpID0+IGNoZWNrUGF0dGVybihwYXR0LCBpZGVudENoZWNrZXIpO1xuICBjb25zdCBhc3NlcnRQYXR0ZXJuMiA9IChwYXR0KSA9PiB7XG4gICAgY2hlY2tQYXR0ZXJuKHBhdHQsIGFzc2VydENoZWNrZXIpO1xuICB9O1xuICBjb25zdCBjaGVja01hdGNoZXMyID0gKHNwZWNpbWVuLCBwYXR0ZXJuLCBjaGVjaywgbGFiZWwgPSB2b2lkIDApID0+IChcbiAgICAvL1xuICAgIGFwcGx5TGFiZWxpbmdFcnJvcihjaGVja01hdGNoZXNJbnRlcm5hbCwgW3NwZWNpbWVuLCBwYXR0ZXJuLCBjaGVja10sIGxhYmVsKVxuICApO1xuICBjb25zdCBjaGVja01hdGNoZXNJbnRlcm5hbCA9IChzcGVjaW1lbiwgcGF0dCwgY2hlY2spID0+IHtcbiAgICBjb25zdCBwYXR0ZXJuS2luZCA9IGtpbmRPZjIocGF0dCwgY2hlY2spO1xuICAgIGNvbnN0IHNwZWNpbWVuS2luZCA9IGtpbmRPZjIoc3BlY2ltZW4pO1xuICAgIHN3aXRjaCAocGF0dGVybktpbmQpIHtcbiAgICAgIGNhc2Ugdm9pZCAwOiB7XG4gICAgICAgIHJldHVybiB0aHJvd1JlZGFjdGVkYHBhdHRlcm4gZXhwZWN0ZWQ6ICR7cGF0dH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICByZXR1cm4gdGhyb3dSZWRhY3RlZGBwcm9taXNlcyBjYW5ub3QgYmUgcGF0dGVybnM6ICR7cGF0dH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgcmV0dXJuIHRocm93UmVkYWN0ZWRgZXJyb3JzIGNhbm5vdCBiZSBwYXR0ZXJuczogJHtwYXR0fWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgICBjYXNlIFwibnVsbFwiOlxuICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgIGNhc2UgXCJudW1iZXJcIjpcbiAgICAgIGNhc2UgXCJiaWdpbnRcIjpcbiAgICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICAgIGNhc2UgXCJzeW1ib2xcIjpcbiAgICAgIGNhc2UgXCJjb3B5U2V0XCI6XG4gICAgICBjYXNlIFwiY29weUJhZ1wiOlxuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIHJldHVybiBjaGVja0FzS2V5UGF0dChzcGVjaW1lbiwgcGF0dCwgY2hlY2spO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIGlmIChpc0tleShwYXR0KSkge1xuICAgICAgICAgIHJldHVybiBjaGVja0FzS2V5UGF0dChzcGVjaW1lbiwgcGF0dCwgY2hlY2spO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzcGVjaW1lbktpbmQgIT09IFwiY29weUFycmF5XCIpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSBhIGNvcHlBcnJheSB0byBtYXRjaCBhIGNvcHlBcnJheSBwYXR0ZXJuOiAke3F1b3RlKFxuICAgICAgICAgICAgICBwYXR0XG4gICAgICAgICAgICApfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSBwYXR0O1xuICAgICAgICBpZiAoc3BlY2ltZW4ubGVuZ3RoICE9PSBsZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIHJlZGFjdGVkYEFycmF5ICR7c3BlY2ltZW59IC0gTXVzdCBiZSBhcyBsb25nIGFzIGNvcHlBcnJheSBwYXR0ZXJuOiAke3F1b3RlKFxuICAgICAgICAgICAgICBwYXR0XG4gICAgICAgICAgICApfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXR0LmV2ZXJ5KChwMywgaTIpID0+IGNoZWNrTWF0Y2hlczIoc3BlY2ltZW5baTJdLCBwMywgY2hlY2ssIGkyKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGlmIChpc0tleShwYXR0KSkge1xuICAgICAgICAgIHJldHVybiBjaGVja0FzS2V5UGF0dChzcGVjaW1lbiwgcGF0dCwgY2hlY2spO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzcGVjaW1lbktpbmQgIT09IFwiY29weVJlY29yZFwiKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgYSBjb3B5UmVjb3JkIHRvIG1hdGNoIGEgY29weVJlY29yZCBwYXR0ZXJuOiAke3F1b3RlKFxuICAgICAgICAgICAgICBwYXR0XG4gICAgICAgICAgICApfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNwZWNpbWVuTmFtZXMgPSByZWNvcmROYW1lcyhzcGVjaW1lbik7XG4gICAgICAgIGNvbnN0IHBhdHROYW1lcyA9IHJlY29yZE5hbWVzKHBhdHQpO1xuICAgICAgICBjb25zdCBtaXNzaW5nMiA9IGxpc3REaWZmZXJlbmNlKHBhdHROYW1lcywgc3BlY2ltZW5OYW1lcyk7XG4gICAgICAgIGlmIChtaXNzaW5nMi5sZW5ndGggPj0gMSkge1xuICAgICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGhhdmUgbWlzc2luZyBwcm9wZXJ0aWVzICR7cXVvdGUobWlzc2luZzIpfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVuZXhwZWN0ZWQgPSBsaXN0RGlmZmVyZW5jZShzcGVjaW1lbk5hbWVzLCBwYXR0TmFtZXMpO1xuICAgICAgICBpZiAodW5leHBlY3RlZC5sZW5ndGggPj0gMSkge1xuICAgICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IG5vdCBoYXZlIHVuZXhwZWN0ZWQgcHJvcGVydGllczogJHtxdW90ZShcbiAgICAgICAgICAgICAgdW5leHBlY3RlZFxuICAgICAgICAgICAgKX1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzcGVjaW1lblZhbHVlcyA9IHJlY29yZFZhbHVlcyhzcGVjaW1lbiwgc3BlY2ltZW5OYW1lcyk7XG4gICAgICAgIGNvbnN0IHBhdHRWYWx1ZXMgPSByZWNvcmRWYWx1ZXMocGF0dCwgcGF0dE5hbWVzKTtcbiAgICAgICAgcmV0dXJuIHBhdHROYW1lcy5ldmVyeShcbiAgICAgICAgICAobGFiZWwsIGkyKSA9PiBjaGVja01hdGNoZXMyKHNwZWNpbWVuVmFsdWVzW2kyXSwgcGF0dFZhbHVlc1tpMl0sIGNoZWNrLCBsYWJlbClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5TWFwXCI6IHtcbiAgICAgICAgaWYgKGlzS2V5KHBhdHQpKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrQXNLZXlQYXR0KHNwZWNpbWVuLCBwYXR0LCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNwZWNpbWVuS2luZCAhPT0gXCJjb3B5TWFwXCIpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSBhIGNvcHlNYXAgdG8gbWF0Y2ggYSBjb3B5TWFwIHBhdHRlcm46ICR7cXVvdGUoXG4gICAgICAgICAgICAgIHBhdHRcbiAgICAgICAgICAgICl9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGF0dEtleVNldCA9IGNvcHlNYXBLZXlTZXQocGF0dCk7XG4gICAgICAgIGNvbnN0IHNwZWNpbWVuS2V5U2V0ID0gY29weU1hcEtleVNldChzcGVjaW1lbik7XG4gICAgICAgIGlmICghY2hlY2tNYXRjaGVzMihzcGVjaW1lbktleVNldCwgcGF0dEtleVNldCwgY2hlY2spKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhdHRWYWx1ZXMgPSBbXTtcbiAgICAgICAgY29uc3Qgc3BlY2ltZW5WYWx1ZXMgPSBbXTtcbiAgICAgICAgY29uc3QgZW50cnlQYWlycyA9IGdlbmVyYXRlQ29sbGVjdGlvblBhaXJFbnRyaWVzKFxuICAgICAgICAgIHBhdHQsXG4gICAgICAgICAgc3BlY2ltZW4sXG4gICAgICAgICAgZ2V0Q29weU1hcEVudHJ5QXJyYXksXG4gICAgICAgICAgdm9pZCAwXG4gICAgICAgICk7XG4gICAgICAgIGZvciAoY29uc3QgW19rZXksIHBhdHRWYWx1ZSwgc3BlY2ltZW5WYWx1ZV0gb2YgZW50cnlQYWlycykge1xuICAgICAgICAgIHBhdHRWYWx1ZXMucHVzaChwYXR0VmFsdWUpO1xuICAgICAgICAgIHNwZWNpbWVuVmFsdWVzLnB1c2goc3BlY2ltZW5WYWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoZWNrTWF0Y2hlczIoaGFyZGVuKHNwZWNpbWVuVmFsdWVzKSwgaGFyZGVuKHBhdHRWYWx1ZXMpLCBjaGVjayk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIGNvbnN0IG1hdGNoSGVscGVyID0gbWF5YmVNYXRjaEhlbHBlcihwYXR0ZXJuS2luZCk7XG4gICAgICAgIGlmIChtYXRjaEhlbHBlcikge1xuICAgICAgICAgIHJldHVybiBtYXRjaEhlbHBlci5jaGVja01hdGNoZXMoc3BlY2ltZW4sIHBhdHQucGF5bG9hZCwgY2hlY2spO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IHNob3VsZCBoYXZlIHJlY29nbml6ZWQgJHtxdW90ZShwYXR0ZXJuS2luZCl9IGA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBtYXRjaGVzMiA9IChzcGVjaW1lbiwgcGF0dCkgPT4gY2hlY2tNYXRjaGVzMihzcGVjaW1lbiwgcGF0dCwgaWRlbnRDaGVja2VyKTtcbiAgY29uc3QgbXVzdE1hdGNoNCA9IChzcGVjaW1lbiwgcGF0dCwgbGFiZWwgPSB2b2lkIDApID0+IHtcbiAgICBsZXQgaW5uZXJFcnJvcjtcbiAgICB0cnkge1xuICAgICAgaWYgKGNoZWNrTWF0Y2hlczIoc3BlY2ltZW4sIHBhdHQsIGlkZW50Q2hlY2tlciwgdm9pZCAwKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXIpIHtcbiAgICAgIGlubmVyRXJyb3IgPSBlcjtcbiAgICB9XG4gICAgY2hlY2tNYXRjaGVzMihzcGVjaW1lbiwgcGF0dCwgYXNzZXJ0Q2hlY2tlciwgbGFiZWwpO1xuICAgIGNvbnN0IG91dGVyRXJyb3IgPSBtYWtlRXJyb3IoXG4gICAgICByZWRhY3RlZGBpbnRlcm5hbDogJHtsYWJlbH06IGluY29uc2lzdGVudCBwYXR0ZXJuIG1hdGNoOiAke3F1b3RlKHBhdHQpfWBcbiAgICApO1xuICAgIGlmIChpbm5lckVycm9yICE9PSB2b2lkIDApIHtcbiAgICAgIG5vdGUob3V0ZXJFcnJvciwgcmVkYWN0ZWRgY2F1c2VkIGJ5ICR7aW5uZXJFcnJvcn1gKTtcbiAgICB9XG4gICAgdGhyb3cgb3V0ZXJFcnJvcjtcbiAgfTtcbiAgY29uc3QgZ2V0UmFua0NvdmVyMiA9IChwYXR0LCBlbmNvZGVQYXNzYWJsZSkgPT4ge1xuICAgIGlmIChpc0tleShwYXR0KSkge1xuICAgICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZVBhc3NhYmxlKHBhdHQpO1xuICAgICAgaWYgKGVuY29kZWQgIT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gW2VuY29kZWQsIGAke2VuY29kZWR9fmBdO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihwYXR0KTtcbiAgICBzd2l0Y2ggKHBhc3NTdHlsZSkge1xuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICBjb25zdCB0YWcgPSBnZXRUYWcocGF0dCk7XG4gICAgICAgIGNvbnN0IG1hdGNoSGVscGVyID0gbWF5YmVNYXRjaEhlbHBlcih0YWcpO1xuICAgICAgICBpZiAobWF0Y2hIZWxwZXIpIHtcbiAgICAgICAgICByZXR1cm4gbWF0Y2hIZWxwZXIuZ2V0UmFua0NvdmVyKHBhdHQucGF5bG9hZCwgZW5jb2RlUGFzc2FibGUpO1xuICAgICAgICB9XG4gICAgICAgIHN3aXRjaCAodGFnKSB7XG4gICAgICAgICAgY2FzZSBcImNvcHlTZXRcIjoge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgXCJjb3B5TWFwXCI6IHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZ2V0UGFzc1N0eWxlQ292ZXIocGFzc1N0eWxlKTtcbiAgfTtcbiAgY29uc3QgYXJyYXlFdmVyeU1hdGNoUGF0dGVybiA9IChhcnJheSwgcGF0dCwgY2hlY2ssIGxhYmVsUHJlZml4ID0gXCJcIikgPT4ge1xuICAgIGlmIChpc0tpbmQocGF0dCwgXCJtYXRjaDphbnlcIikpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gYXJyYXkuZXZlcnkoXG4gICAgICAoZWwsIGkyKSA9PiBjaGVja01hdGNoZXMyKGVsLCBwYXR0LCBjaGVjaywgYCR7bGFiZWxQcmVmaXh9WyR7aTJ9XWApXG4gICAgKTtcbiAgfTtcbiAgY29uc3QgbWF0Y2hBbnlIZWxwZXIgPSBGYXIoXCJtYXRjaDphbnkgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChfc3BlY2ltZW4sIF9tYXRjaGVyUGF5bG9hZCwgX2NoZWNrKSA9PiB0cnVlLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAobWF0Y2hlclBheWxvYWQsIGNoZWNrKSA9PiBtYXRjaGVyUGF5bG9hZCA9PT0gdm9pZCAwIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBtYXRjaDphbnkgcGF5bG9hZDogJHttYXRjaGVyUGF5bG9hZH0gLSBNdXN0IGJlIHVuZGVmaW5lZGApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gW1wiXCIsIFwie1wiXVxuICB9KTtcbiAgY29uc3QgbWF0Y2hBbmRIZWxwZXIgPSBGYXIoXCJtYXRjaDphbmQgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcGF0dHMsIGNoZWNrKSA9PiB7XG4gICAgICByZXR1cm4gcGF0dHMuZXZlcnkoKHBhdHQpID0+IGNoZWNrTWF0Y2hlczIoc3BlY2ltZW4sIHBhdHQsIGNoZWNrKSk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKGFsbGVnZWRQYXR0cywgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IGNoZWNrSXQgPSAocGF0dCkgPT4gY2hlY2tQYXR0ZXJuKHBhdHQsIGNoZWNrKTtcbiAgICAgIHJldHVybiAocGFzc1N0eWxlT2YoYWxsZWdlZFBhdHRzKSA9PT0gXCJjb3B5QXJyYXlcIiB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgTmVlZHMgYXJyYXkgb2Ygc3ViLXBhdHRlcm5zOiAke3F1b3RlKGFsbGVnZWRQYXR0cyl9YCkpICYmIGFsbGVnZWRQYXR0cy5ldmVyeShjaGVja0l0KTtcbiAgICB9LFxuICAgIGdldFJhbmtDb3ZlcjogKHBhdHRzLCBlbmNvZGVQYXNzYWJsZSkgPT4gaW50ZXJzZWN0UmFua0NvdmVycyhcbiAgICAgIGNvbXBhcmVSYW5rLFxuICAgICAgcGF0dHMubWFwKChwMykgPT4gZ2V0UmFua0NvdmVyMihwMywgZW5jb2RlUGFzc2FibGUpKVxuICAgIClcbiAgfSk7XG4gIGNvbnN0IG1hdGNoT3JIZWxwZXIgPSBGYXIoXCJtYXRjaDpvciBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBwYXR0cywgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSBwYXR0cztcbiAgICAgIGlmIChsZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gbm8gcGF0dGVybiBkaXNqdW5jdHMgdG8gbWF0Y2g6ICR7cXVvdGUocGF0dHMpfWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChwYXR0cy5sZW5ndGggPT09IDIgJiYgIW1hdGNoZXMyKHNwZWNpbWVuLCBwYXR0c1swXSkgJiYgaXNLaW5kKHBhdHRzWzBdLCBcIm1hdGNoOmtpbmRcIikgJiYgcGF0dHNbMF0ucGF5bG9hZCA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICByZXR1cm4gY2hlY2tNYXRjaGVzMihzcGVjaW1lbiwgcGF0dHNbMV0sIGNoZWNrKTtcbiAgICAgIH1cbiAgICAgIGlmIChwYXR0cy5zb21lKChwYXR0KSA9PiBtYXRjaGVzMihzcGVjaW1lbiwgcGF0dCkpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgbWF0Y2ggb25lIG9mICR7cXVvdGUocGF0dHMpfWApO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IG1hdGNoQW5kSGVscGVyLmNoZWNrSXNXZWxsRm9ybWVkLFxuICAgIGdldFJhbmtDb3ZlcjogKHBhdHRzLCBlbmNvZGVQYXNzYWJsZSkgPT4gdW5pb25SYW5rQ292ZXJzKFxuICAgICAgY29tcGFyZVJhbmssXG4gICAgICBwYXR0cy5tYXAoKHAzKSA9PiBnZXRSYW5rQ292ZXIyKHAzLCBlbmNvZGVQYXNzYWJsZSkpXG4gICAgKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hOb3RIZWxwZXIgPSBGYXIoXCJtYXRjaDpub3QgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcGF0dCwgY2hlY2spID0+IHtcbiAgICAgIGlmIChtYXRjaGVzMihzcGVjaW1lbiwgcGF0dCkpIHtcbiAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBmYWlsIG5lZ2F0ZWQgcGF0dGVybjogJHtxdW90ZShwYXR0KX1gXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBjaGVja1BhdHRlcm4sXG4gICAgZ2V0UmFua0NvdmVyOiAoX3BhdHQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gW1wiXCIsIFwie1wiXVxuICB9KTtcbiAgY29uc3QgbWF0Y2hTY2FsYXJIZWxwZXIgPSBGYXIoXCJtYXRjaDpzY2FsYXIgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgX21hdGNoZXJQYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tTY2FsYXJLZXkoc3BlY2ltZW4sIGNoZWNrKSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogbWF0Y2hBbnlIZWxwZXIuY2hlY2tJc1dlbGxGb3JtZWQsXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBbXCJhXCIsIFwien5cIl1cbiAgfSk7XG4gIGNvbnN0IG1hdGNoS2V5SGVscGVyID0gRmFyKFwibWF0Y2g6a2V5IGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIF9tYXRjaGVyUGF5bG9hZCwgY2hlY2spID0+IGNoZWNrS2V5KHNwZWNpbWVuLCBjaGVjayksXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IG1hdGNoQW55SGVscGVyLmNoZWNrSXNXZWxsRm9ybWVkLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gW1wiYVwiLCBcInp+XCJdXG4gIH0pO1xuICBjb25zdCBtYXRjaFBhdHRlcm5IZWxwZXIgPSBGYXIoXCJtYXRjaDpwYXR0ZXJuIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIF9tYXRjaGVyUGF5bG9hZCwgY2hlY2spID0+IGNoZWNrUGF0dGVybihzcGVjaW1lbiwgY2hlY2spLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBtYXRjaEFueUhlbHBlci5jaGVja0lzV2VsbEZvcm1lZCxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IFtcImFcIiwgXCJ6flwiXVxuICB9KTtcbiAgY29uc3QgbWF0Y2hLaW5kSGVscGVyID0gRmFyKFwibWF0Y2g6a2luZCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogY2hlY2tLaW5kLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAoYWxsZWdlZEtleUtpbmQsIGNoZWNrKSA9PiB0eXBlb2YgYWxsZWdlZEtleUtpbmQgPT09IFwic3RyaW5nXCIgfHwgY2hlY2soXG4gICAgICBmYWxzZSxcbiAgICAgIHJlZGFjdGVkYG1hdGNoOmtpbmQ6IHBheWxvYWQ6ICR7YWxsZWdlZEtleUtpbmR9IC0gQSBraW5kIG5hbWUgbXVzdCBiZSBhIHN0cmluZ2BcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKGtpbmQyLCBfZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgICAgIGxldCBzdHlsZTtcbiAgICAgIHN3aXRjaCAoa2luZDIpIHtcbiAgICAgICAgY2FzZSBcImNvcHlTZXRcIjpcbiAgICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICAgIHN0eWxlID0gXCJ0YWdnZWRcIjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgc3R5bGUgPSBraW5kMjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGdldFBhc3NTdHlsZUNvdmVyKHN0eWxlKTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBtYXRjaFRhZ2dlZEhlbHBlciA9IEZhcihcIm1hdGNoOnRhZ2dlZCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbdGFnUGF0dCwgcGF5bG9hZFBhdHRdLCBjaGVjaykgPT4ge1xuICAgICAgaWYgKHBhc3NTdHlsZU9mKHNwZWNpbWVuKSAhPT0gXCJ0YWdnZWRcIikge1xuICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcmVkYWN0ZWRgRXhwZWN0ZWQgdGFnZ2VkIG9iamVjdCwgbm90ICR7cXVvdGUoXG4gICAgICAgICAgICBwYXNzU3R5bGVPZihzcGVjaW1lbilcbiAgICAgICAgICApfTogJHtzcGVjaW1lbn1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2hlY2tNYXRjaGVzMihnZXRUYWcoc3BlY2ltZW4pLCB0YWdQYXR0LCBjaGVjaywgXCJ0YWdcIikgJiYgY2hlY2tNYXRjaGVzMihzcGVjaW1lbi5wYXlsb2FkLCBwYXlsb2FkUGF0dCwgY2hlY2ssIFwicGF5bG9hZFwiKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrTWF0Y2hlczIoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtNTS5wYXR0ZXJuKCksIE1NLnBhdHRlcm4oKV0pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOnRhZ2dlZCBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9raW5kLCBfZW5jb2RlUGFzc2FibGUpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwidGFnZ2VkXCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaEJpZ2ludEhlbHBlciA9IEZhcihcIm1hdGNoOmJpZ2ludCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgZGVjaW1hbERpZ2l0c0xpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgcmV0dXJuIGNoZWNrS2luZChzcGVjaW1lbiwgXCJiaWdpbnRcIiwgY2hlY2spICYmIGNoZWNrRGVjaW1hbERpZ2l0c0xpbWl0KHNwZWNpbWVuLCBkZWNpbWFsRGlnaXRzTGltaXQsIGNoZWNrKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6YmlnaW50IHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcImJpZ2ludFwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hOYXRIZWxwZXIgPSBGYXIoXCJtYXRjaDpuYXQgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2xpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IGRlY2ltYWxEaWdpdHNMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiYmlnaW50XCIsIGNoZWNrKSAmJiBjaGVjayhcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNwZWNpbWVuID49IDBuLFxuICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgbm9uLW5lZ2F0aXZlYFxuICAgICAgKSAmJiBjaGVja0RlY2ltYWxEaWdpdHNMaW1pdChzcGVjaW1lbiwgZGVjaW1hbERpZ2l0c0xpbWl0LCBjaGVjayk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW10pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOm5hdCBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gKFxuICAgICAgLy9cbiAgICAgIGdldFBhc3NTdHlsZUNvdmVyKFwiYmlnaW50XCIpXG4gICAgKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hTdHJpbmdIZWxwZXIgPSBGYXIoXCJtYXRjaDpzdHJpbmcgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2xpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IHN0cmluZ0xlbmd0aExpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgcmV0dXJuIGNoZWNrS2luZChzcGVjaW1lbiwgXCJzdHJpbmdcIiwgY2hlY2spICYmIC8vXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIChzcGVjaW1lbi5sZW5ndGggPD0gc3RyaW5nTGVuZ3RoTGltaXQgfHwgY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICByZWRhY3RlZGBzdHJpbmcgJHtzcGVjaW1lbn0gbXVzdCBub3QgYmUgYmlnZ2VyIHRoYW4gJHtzdHJpbmdMZW5ndGhMaW1pdH1gXG4gICAgICApKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6c3RyaW5nIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInN0cmluZ1wiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hTeW1ib2xIZWxwZXIgPSBGYXIoXCJtYXRjaDpzeW1ib2wgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2xpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IHN5bWJvbE5hbWVMZW5ndGhMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIGlmICghY2hlY2tLaW5kKHNwZWNpbWVuLCBcInN5bWJvbFwiLCBjaGVjaykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgY29uc3Qgc3ltYm9sTmFtZSA9IG5hbWVGb3JQYXNzYWJsZVN5bWJvbChzcGVjaW1lbik7XG4gICAgICBpZiAodHlwZW9mIHN5bWJvbE5hbWUgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogUGFzc2FibGUgc3ltYm9sICR7c3BlY2ltZW59IG11c3QgaGF2ZSBhIHBhc3NhYmxlIG5hbWVgO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICBzeW1ib2xOYW1lLmxlbmd0aCA8PSBzeW1ib2xOYW1lTGVuZ3RoTGltaXQsXG4gICAgICAgIHJlZGFjdGVkYFN5bWJvbCBuYW1lICR7cXVvdGUoXG4gICAgICAgICAgc3ltYm9sTmFtZVxuICAgICAgICApfSBtdXN0IG5vdCBiZSBiaWdnZXIgdGhhbiAke3N5bWJvbE5hbWVMZW5ndGhMaW1pdH1gXG4gICAgICApO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtdKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpzeW1ib2wgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwic3ltYm9sXCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaFJlbW90YWJsZUhlbHBlciA9IEZhcihcIm1hdGNoOnJlbW90YWJsZSBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCByZW1vdGFibGVEZXNjLCBjaGVjaykgPT4ge1xuICAgICAgaWYgKGlzS2luZChzcGVjaW1lbiwgXCJyZW1vdGFibGVcIikpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoY2hlY2sgPT09IGlkZW50Q2hlY2tlcikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGxhYmVsIH0gPSByZW1vdGFibGVEZXNjO1xuICAgICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2Yoc3BlY2ltZW4pO1xuICAgICAgY29uc3Qga2luZERldGFpbHMgPSBwYXNzU3R5bGUgIT09IFwidGFnZ2VkXCIgPyAoXG4gICAgICAgIC8vXG4gICAgICAgIGJhcmVPclF1b3RlKHBhc3NTdHlsZSlcbiAgICAgICkgOiAoXG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIHF1b3RlKGdldFRhZyhzcGVjaW1lbikpXG4gICAgICApO1xuICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIGEgcmVtb3RhYmxlICR7YmFyZU9yUXVvdGUobGFiZWwpfSwgbm90ICR7a2luZERldGFpbHN9YFxuICAgICAgKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAoYWxsZWdlZFJlbW90YWJsZURlc2MsIGNoZWNrKSA9PiBjaGVja01hdGNoZXMyKFxuICAgICAgYWxsZWdlZFJlbW90YWJsZURlc2MsXG4gICAgICBoYXJkZW4oeyBsYWJlbDogTU0uc3RyaW5nKCkgfSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6cmVtb3RhYmxlIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX3JlbW90YWJsZURlc2MsIF9lbmNvZGVQYXNzYWJsZSkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJyZW1vdGFibGVcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoTFRFSGVscGVyID0gRmFyKFwibWF0Y2g6bHRlIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCwgY2hlY2spID0+IGtleUxURShzcGVjaW1lbiwgcmlnaHRPcGVyYW5kKSB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIDw9ICR7cmlnaHRPcGVyYW5kfWApLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBjaGVja0tleSxcbiAgICBnZXRSYW5rQ292ZXI6IChyaWdodE9wZXJhbmQsIGVuY29kZVBhc3NhYmxlKSA9PiB7XG4gICAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihyaWdodE9wZXJhbmQpO1xuICAgICAgbGV0IFtsZWZ0Qm91bmQsIHJpZ2h0Qm91bmRdID0gZ2V0UGFzc1N0eWxlQ292ZXIocGFzc1N0eWxlKTtcbiAgICAgIGNvbnN0IG5ld1JpZ2h0Qm91bmQgPSBgJHtlbmNvZGVQYXNzYWJsZShyaWdodE9wZXJhbmQpfX5gO1xuICAgICAgaWYgKG5ld1JpZ2h0Qm91bmQgIT09IHZvaWQgMCkge1xuICAgICAgICByaWdodEJvdW5kID0gbmV3UmlnaHRCb3VuZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBbbGVmdEJvdW5kLCByaWdodEJvdW5kXTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBtYXRjaExUSGVscGVyID0gRmFyKFwibWF0Y2g6bHQgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcmlnaHRPcGVyYW5kLCBjaGVjaykgPT4ga2V5TFQoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCkgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSA8ICR7cmlnaHRPcGVyYW5kfWApLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBjaGVja0tleSxcbiAgICBnZXRSYW5rQ292ZXI6IG1hdGNoTFRFSGVscGVyLmdldFJhbmtDb3ZlclxuICB9KTtcbiAgY29uc3QgbWF0Y2hHVEVIZWxwZXIgPSBGYXIoXCJtYXRjaDpndGUgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcmlnaHRPcGVyYW5kLCBjaGVjaykgPT4ga2V5R1RFKHNwZWNpbWVuLCByaWdodE9wZXJhbmQpIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgPj0gJHtyaWdodE9wZXJhbmR9YCksXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IGNoZWNrS2V5LFxuICAgIGdldFJhbmtDb3ZlcjogKHJpZ2h0T3BlcmFuZCwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHJpZ2h0T3BlcmFuZCk7XG4gICAgICBsZXQgW2xlZnRCb3VuZCwgcmlnaHRCb3VuZF0gPSBnZXRQYXNzU3R5bGVDb3ZlcihwYXNzU3R5bGUpO1xuICAgICAgY29uc3QgbmV3TGVmdEJvdW5kID0gZW5jb2RlUGFzc2FibGUocmlnaHRPcGVyYW5kKTtcbiAgICAgIGlmIChuZXdMZWZ0Qm91bmQgIT09IHZvaWQgMCkge1xuICAgICAgICBsZWZ0Qm91bmQgPSBuZXdMZWZ0Qm91bmQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gW2xlZnRCb3VuZCwgcmlnaHRCb3VuZF07XG4gICAgfVxuICB9KTtcbiAgY29uc3QgbWF0Y2hHVEhlbHBlciA9IEZhcihcIm1hdGNoOmd0IGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCwgY2hlY2spID0+IGtleUdUKHNwZWNpbWVuLCByaWdodE9wZXJhbmQpIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgPiAke3JpZ2h0T3BlcmFuZH1gKSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogY2hlY2tLZXksXG4gICAgZ2V0UmFua0NvdmVyOiBtYXRjaEdURUhlbHBlci5nZXRSYW5rQ292ZXJcbiAgfSk7XG4gIGNvbnN0IG1hdGNoUmVjb3JkT2ZIZWxwZXIgPSBGYXIoXCJtYXRjaDpyZWNvcmRPZiBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBba2V5UGF0dCwgdmFsdWVQYXR0LCBsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBudW1Qcm9wZXJ0aWVzTGltaXQsIHByb3BlcnR5TmFtZUxlbmd0aExpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgcmV0dXJuIGNoZWNrS2luZChzcGVjaW1lbiwgXCJjb3B5UmVjb3JkXCIsIGNoZWNrKSAmJiBjaGVjayhcbiAgICAgICAgb3duS2V5czE3KHNwZWNpbWVuKS5sZW5ndGggPD0gbnVtUHJvcGVydGllc0xpbWl0LFxuICAgICAgICByZWRhY3RlZGBNdXN0IG5vdCBoYXZlIG1vcmUgdGhhbiAke3F1b3RlKFxuICAgICAgICAgIG51bVByb3BlcnRpZXNMaW1pdFxuICAgICAgICApfSBwcm9wZXJ0aWVzOiAke3NwZWNpbWVufWBcbiAgICAgICkgJiYgZW50cmllczcoc3BlY2ltZW4pLmV2ZXJ5KFxuICAgICAgICAoW2tleSwgdmFsdWVdKSA9PiBhcHBseUxhYmVsaW5nRXJyb3IoXG4gICAgICAgICAgY2hlY2ssXG4gICAgICAgICAgW1xuICAgICAgICAgICAga2V5Lmxlbmd0aCA8PSBwcm9wZXJ0eU5hbWVMZW5ndGhMaW1pdCxcbiAgICAgICAgICAgIHJlZGFjdGVkYFByb3BlcnR5IG5hbWUgbXVzdCBub3QgYmUgbG9uZ2VyIHRoYW4gJHtxdW90ZShcbiAgICAgICAgICAgICAgcHJvcGVydHlOYW1lTGVuZ3RoTGltaXRcbiAgICAgICAgICAgICl9YFxuICAgICAgICAgIF0sXG4gICAgICAgICAga2V5XG4gICAgICAgICkgJiYgY2hlY2tNYXRjaGVzMihcbiAgICAgICAgICBoYXJkZW4oW2tleSwgdmFsdWVdKSxcbiAgICAgICAgICBoYXJkZW4oW2tleVBhdHQsIHZhbHVlUGF0dF0pLFxuICAgICAgICAgIGNoZWNrLFxuICAgICAgICAgIGtleVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtNTS5wYXR0ZXJuKCksIE1NLnBhdHRlcm4oKV0pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOnJlY29yZE9mIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX2VudHJ5UGF0dCkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJjb3B5UmVjb3JkXCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaEFycmF5T2ZIZWxwZXIgPSBGYXIoXCJtYXRjaDphcnJheU9mIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtzdWJQYXR0LCBsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBhcnJheUxlbmd0aExpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgcmV0dXJuIGNoZWNrS2luZChzcGVjaW1lbiwgXCJjb3B5QXJyYXlcIiwgY2hlY2spICYmIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAoc3BlY2ltZW4ubGVuZ3RoIDw9IGFycmF5TGVuZ3RoTGltaXQgfHwgY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICByZWRhY3RlZGBBcnJheSBsZW5ndGggJHtzcGVjaW1lbi5sZW5ndGh9IG11c3QgYmUgPD0gbGltaXQgJHthcnJheUxlbmd0aExpbWl0fWBcbiAgICAgICkpICYmIGFycmF5RXZlcnlNYXRjaFBhdHRlcm4oc3BlY2ltZW4sIHN1YlBhdHQsIGNoZWNrKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbTU0ucGF0dGVybigpXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6YXJyYXlPZiBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKCkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJjb3B5QXJyYXlcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoU2V0T2ZIZWxwZXIgPSBGYXIoXCJtYXRjaDpzZXRPZiBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBba2V5UGF0dCwgbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgbnVtU2V0RWxlbWVudHNMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiY29weVNldFwiLCBjaGVjaykgJiYgY2hlY2soXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNwZWNpbWVuLnBheWxvYWQubGVuZ3RoIDwgbnVtU2V0RWxlbWVudHNMaW1pdCxcbiAgICAgICAgcmVkYWN0ZWRgU2V0IG11c3Qgbm90IGhhdmUgbW9yZSB0aGFuICR7cXVvdGUobnVtU2V0RWxlbWVudHNMaW1pdCl9IGVsZW1lbnRzOiAke3NwZWNpbWVuLnBheWxvYWQubGVuZ3RofWBcbiAgICAgICkgJiYgYXJyYXlFdmVyeU1hdGNoUGF0dGVybihzcGVjaW1lbi5wYXlsb2FkLCBrZXlQYXR0LCBjaGVjaywgXCJzZXQgZWxlbWVudHNcIik7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKV0pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOnNldE9mIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInRhZ2dlZFwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hCYWdPZkhlbHBlciA9IEZhcihcIm1hdGNoOmJhZ09mIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtrZXlQYXR0LCBjb3VudFBhdHQsIGxpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IG51bVVuaXF1ZUJhZ0VsZW1lbnRzTGltaXQsIGRlY2ltYWxEaWdpdHNMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiY29weUJhZ1wiLCBjaGVjaykgJiYgY2hlY2soXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNwZWNpbWVuLnBheWxvYWQubGVuZ3RoIDw9IG51bVVuaXF1ZUJhZ0VsZW1lbnRzTGltaXQsXG4gICAgICAgIHJlZGFjdGVkYEJhZyBtdXN0IG5vdCBoYXZlIG1vcmUgdGhhbiAke3F1b3RlKFxuICAgICAgICAgIG51bVVuaXF1ZUJhZ0VsZW1lbnRzTGltaXRcbiAgICAgICAgKX0gdW5pcXVlIGVsZW1lbnRzOiAke3NwZWNpbWVufWBcbiAgICAgICkgJiYgc3BlY2ltZW4ucGF5bG9hZC5ldmVyeShcbiAgICAgICAgKFtrZXksIGNvdW50XSwgaTIpID0+IGNoZWNrTWF0Y2hlczIoa2V5LCBrZXlQYXR0LCBjaGVjaywgYGJhZyBrZXlzWyR7aTJ9XWApICYmIGFwcGx5TGFiZWxpbmdFcnJvcihcbiAgICAgICAgICBjaGVja0RlY2ltYWxEaWdpdHNMaW1pdCxcbiAgICAgICAgICBbY291bnQsIGRlY2ltYWxEaWdpdHNMaW1pdCwgY2hlY2tdLFxuICAgICAgICAgIGBiYWcgY291bnRzWyR7aTJ9XWBcbiAgICAgICAgKSAmJiBjaGVja01hdGNoZXMyKGNvdW50LCBjb3VudFBhdHQsIGNoZWNrLCBgYmFnIGNvdW50c1ske2kyfV1gKVxuICAgICAgKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbTU0ucGF0dGVybigpLCBNTS5wYXR0ZXJuKCldKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpiYWdPZiBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKCkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJ0YWdnZWRcIilcbiAgfSk7XG4gIGNvbnN0IGVsZW1lbnRzSGFzU3BsaXQgPSAoZWxlbWVudHMsIGVsZW1lbnRQYXR0LCBib3VuZCwgaW5SZXN1bHRzID0gdm9pZCAwLCBvdXRSZXN1bHRzID0gdm9pZCAwLCBjaGVjayA9IGlkZW50Q2hlY2tlcikgPT4ge1xuICAgIGxldCBjb3VudCA9IDBuO1xuICAgIGZvciAobGV0IGkyID0gZWxlbWVudHMubGVuZ3RoIC0gMTsgaTIgPj0gMDsgaTIgLT0gMSkge1xuICAgICAgY29uc3QgZWxlbWVudCA9IGVsZW1lbnRzW2kyXTtcbiAgICAgIGlmIChjb3VudCA8IGJvdW5kKSB7XG4gICAgICAgIGlmIChtYXRjaGVzMihlbGVtZW50LCBlbGVtZW50UGF0dCkpIHtcbiAgICAgICAgICBjb3VudCArPSAxbjtcbiAgICAgICAgICBpZiAoaW5SZXN1bHRzKSBpblJlc3VsdHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgfSBlbHNlIGlmIChvdXRSZXN1bHRzKSB7XG4gICAgICAgICAgb3V0UmVzdWx0cy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKG91dFJlc3VsdHMgPT09IHZvaWQgMCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG91dFJlc3VsdHMucHVzaChlbGVtZW50KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgY291bnQgPj0gYm91bmQsXG4gICAgICByZWRhY3RlZGBIYXMgb25seSAke3F1b3RlKGNvdW50KX0gbWF0Y2hlcywgYnV0IG5lZWRzICR7cXVvdGUoYm91bmQpfWBcbiAgICApO1xuICB9O1xuICBjb25zdCBwYWlyc0hhc1NwbGl0ID0gKHBhaXJzLCBlbGVtZW50UGF0dCwgYm91bmQsIGluUmVzdWx0cyA9IHZvaWQgMCwgb3V0UmVzdWx0cyA9IHZvaWQgMCwgY2hlY2sgPSBpZGVudENoZWNrZXIpID0+IHtcbiAgICBsZXQgY291bnQgPSAwbjtcbiAgICBmb3IgKGxldCBpMiA9IHBhaXJzLmxlbmd0aCAtIDE7IGkyID49IDA7IGkyIC09IDEpIHtcbiAgICAgIGNvbnN0IFtlbGVtZW50LCBudW1dID0gcGFpcnNbaTJdO1xuICAgICAgY29uc3QgbnVtUmVzdCA9IGJvdW5kIC0gY291bnQ7XG4gICAgICBpZiAobnVtUmVzdCA+PSAxbikge1xuICAgICAgICBpZiAobWF0Y2hlczIoZWxlbWVudCwgZWxlbWVudFBhdHQpKSB7XG4gICAgICAgICAgaWYgKG51bSA8PSBudW1SZXN0KSB7XG4gICAgICAgICAgICBjb3VudCArPSBudW07XG4gICAgICAgICAgICBpZiAoaW5SZXN1bHRzKSBpblJlc3VsdHMucHVzaChbZWxlbWVudCwgbnVtXSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG51bUluID0gbnVtUmVzdDtcbiAgICAgICAgICAgIGNvdW50ICs9IG51bUluO1xuICAgICAgICAgICAgaWYgKGluUmVzdWx0cykgaW5SZXN1bHRzLnB1c2goW2VsZW1lbnQsIG51bVJlc3RdKTtcbiAgICAgICAgICAgIGlmIChvdXRSZXN1bHRzKSBvdXRSZXN1bHRzLnB1c2goW2VsZW1lbnQsIG51bSAtIG51bVJlc3RdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAob3V0UmVzdWx0cykge1xuICAgICAgICAgIG91dFJlc3VsdHMucHVzaChbZWxlbWVudCwgbnVtXSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAob3V0UmVzdWx0cyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3V0UmVzdWx0cy5wdXNoKFtlbGVtZW50LCBudW1dKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgY291bnQgPj0gYm91bmQsXG4gICAgICByZWRhY3RlZGBIYXMgb25seSAke3F1b3RlKGNvdW50KX0gbWF0Y2hlcywgYnV0IG5lZWRzICR7cXVvdGUoYm91bmQpfWBcbiAgICApO1xuICB9O1xuICBjb25zdCBjb250YWluZXJIYXNTcGxpdDIgPSAoc3BlY2ltZW4sIGVsZW1lbnRQYXR0LCBib3VuZCwgbmVlZEluUmVzdWx0cyA9IGZhbHNlLCBuZWVkT3V0UmVzdWx0cyA9IGZhbHNlLCBjaGVjayA9IGlkZW50Q2hlY2tlcikgPT4ge1xuICAgIGNvbnN0IGluUmVzdWx0cyA9IG5lZWRJblJlc3VsdHMgPyBbXSA6IHZvaWQgMDtcbiAgICBjb25zdCBvdXRSZXN1bHRzID0gbmVlZE91dFJlc3VsdHMgPyBbXSA6IHZvaWQgMDtcbiAgICBjb25zdCBraW5kMiA9IGtpbmRPZjIoc3BlY2ltZW4pO1xuICAgIHN3aXRjaCAoa2luZDIpIHtcbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICBpZiAoIWVsZW1lbnRzSGFzU3BsaXQoXG4gICAgICAgICAgc3BlY2ltZW4sXG4gICAgICAgICAgZWxlbWVudFBhdHQsXG4gICAgICAgICAgYm91bmQsXG4gICAgICAgICAgaW5SZXN1bHRzLFxuICAgICAgICAgIG91dFJlc3VsdHMsXG4gICAgICAgICAgY2hlY2tcbiAgICAgICAgKSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW2luUmVzdWx0cywgb3V0UmVzdWx0c107XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVNldFwiOiB7XG4gICAgICAgIGlmICghZWxlbWVudHNIYXNTcGxpdChcbiAgICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLFxuICAgICAgICAgIGVsZW1lbnRQYXR0LFxuICAgICAgICAgIGJvdW5kLFxuICAgICAgICAgIGluUmVzdWx0cyxcbiAgICAgICAgICBvdXRSZXN1bHRzLFxuICAgICAgICAgIGNoZWNrXG4gICAgICAgICkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICBpblJlc3VsdHMgJiYgbWFrZUNvcHlTZXQoaW5SZXN1bHRzKSxcbiAgICAgICAgICBvdXRSZXN1bHRzICYmIG1ha2VDb3B5U2V0KG91dFJlc3VsdHMpXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUJhZ1wiOiB7XG4gICAgICAgIGlmICghcGFpcnNIYXNTcGxpdChcbiAgICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLFxuICAgICAgICAgIGVsZW1lbnRQYXR0LFxuICAgICAgICAgIGJvdW5kLFxuICAgICAgICAgIGluUmVzdWx0cyxcbiAgICAgICAgICBvdXRSZXN1bHRzLFxuICAgICAgICAgIGNoZWNrXG4gICAgICAgICkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICBpblJlc3VsdHMgJiYgbWFrZUNvcHlCYWcoaW5SZXN1bHRzKSxcbiAgICAgICAgICBvdXRSZXN1bHRzICYmIG1ha2VDb3B5QmFnKG91dFJlc3VsdHMpXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgdW5leHBlY3RlZCAke3F1b3RlKGtpbmQyKX1gKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IG1hdGNoQ29udGFpbmVySGFzSGVscGVyID0gRmFyKFwiTS5jb250YWluZXJIYXMgaGVscGVyXCIsIHtcbiAgICAvKlxuXG5cblxuICAgICAqL1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbZWxlbWVudFBhdHQsIGJvdW5kLCBsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3Qga2luZDIgPSBraW5kT2YyKHNwZWNpbWVuLCBjaGVjayk7XG4gICAgICBjb25zdCB7IGRlY2ltYWxEaWdpdHNMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIGlmICghYXBwbHlMYWJlbGluZ0Vycm9yKFxuICAgICAgICBjaGVja0RlY2ltYWxEaWdpdHNMaW1pdCxcbiAgICAgICAgW2JvdW5kLCBkZWNpbWFsRGlnaXRzTGltaXQsIGNoZWNrXSxcbiAgICAgICAgYCR7a2luZDJ9IG1hdGNoZXNgXG4gICAgICApKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAhIWNvbnRhaW5lckhhc1NwbGl0MihcbiAgICAgICAgc3BlY2ltZW4sXG4gICAgICAgIGVsZW1lbnRQYXR0LFxuICAgICAgICBib3VuZCxcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBjaGVja1xuICAgICAgKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbTU0ucGF0dGVybigpLCBNTS5ndGUoMW4pXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwiTS5jb250YWluZXJIYXMgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6ICgpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwidGFnZ2VkXCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaE1hcE9mSGVscGVyID0gRmFyKFwibWF0Y2g6bWFwT2YgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2tleVBhdHQsIHZhbHVlUGF0dCwgbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgbnVtTWFwRW50cmllc0xpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgcmV0dXJuIGNoZWNrS2luZChzcGVjaW1lbiwgXCJjb3B5TWFwXCIsIGNoZWNrKSAmJiBjaGVjayhcbiAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc3BlY2ltZW4ucGF5bG9hZC5rZXlzLmxlbmd0aCA8PSBudW1NYXBFbnRyaWVzTGltaXQsXG4gICAgICAgIHJlZGFjdGVkYENvcHlNYXAgbXVzdCBoYXZlIG5vIG1vcmUgdGhhbiAke3F1b3RlKFxuICAgICAgICAgIG51bU1hcEVudHJpZXNMaW1pdFxuICAgICAgICApfSBlbnRyaWVzOiAke3NwZWNpbWVufWBcbiAgICAgICkgJiYgYXJyYXlFdmVyeU1hdGNoUGF0dGVybihcbiAgICAgICAgc3BlY2ltZW4ucGF5bG9hZC5rZXlzLFxuICAgICAgICBrZXlQYXR0LFxuICAgICAgICBjaGVjayxcbiAgICAgICAgXCJtYXAga2V5c1wiXG4gICAgICApICYmIGFycmF5RXZlcnlNYXRjaFBhdHRlcm4oXG4gICAgICAgIHNwZWNpbWVuLnBheWxvYWQudmFsdWVzLFxuICAgICAgICB2YWx1ZVBhdHQsXG4gICAgICAgIGNoZWNrLFxuICAgICAgICBcIm1hcCB2YWx1ZXNcIlxuICAgICAgKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbTU0ucGF0dGVybigpLCBNTS5wYXR0ZXJuKCldKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDptYXBPZiBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9lbnRyeVBhdHQpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwidGFnZ2VkXCIpXG4gIH0pO1xuICBjb25zdCBzcGxpdEFycmF5UGFydHMgPSAoc3BlY2ltZW4sIHJlcXVpcmVkUGF0dCwgb3B0aW9uYWxQYXR0KSA9PiB7XG4gICAgY29uc3QgbnVtUmVxdWlyZWQgPSByZXF1aXJlZFBhdHQubGVuZ3RoO1xuICAgIGNvbnN0IG51bU9wdGlvbmFsID0gb3B0aW9uYWxQYXR0Lmxlbmd0aDtcbiAgICBjb25zdCByZXF1aXJlZFNwZWNpbWVuID0gc3BlY2ltZW4uc2xpY2UoMCwgbnVtUmVxdWlyZWQpO1xuICAgIGNvbnN0IG9wdGlvbmFsU3BlY2ltZW4gPSBzcGVjaW1lbi5zbGljZShcbiAgICAgIG51bVJlcXVpcmVkLFxuICAgICAgbnVtUmVxdWlyZWQgKyBudW1PcHRpb25hbFxuICAgICk7XG4gICAgY29uc3QgcmVzdFNwZWNpbWVuID0gc3BlY2ltZW4uc2xpY2UobnVtUmVxdWlyZWQgKyBudW1PcHRpb25hbCk7XG4gICAgcmV0dXJuIGhhcmRlbih7IHJlcXVpcmVkU3BlY2ltZW4sIG9wdGlvbmFsU3BlY2ltZW4sIHJlc3RTcGVjaW1lbiB9KTtcbiAgfTtcbiAgY29uc3QgYWRhcHRBcnJheVBhdHRlcm4gPSAob3B0aW9uYWxQYXR0LCBsZW5ndGgpID0+IGhhcmRlbihvcHRpb25hbFBhdHQuc2xpY2UoMCwgbGVuZ3RoKS5tYXAoKHBhdHQpID0+IE1NLm9wdChwYXR0KSkpO1xuICBjb25zdCBtYXRjaFNwbGl0QXJyYXlIZWxwZXIgPSBGYXIoXCJtYXRjaDpzcGxpdEFycmF5IGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtyZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCA9IFtdLCByZXN0UGF0dCA9IE1NLmFueSgpXSwgY2hlY2spID0+IHtcbiAgICAgIGlmICghY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlBcnJheVwiLCBjaGVjaykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgY29uc3QgeyByZXF1aXJlZFNwZWNpbWVuLCBvcHRpb25hbFNwZWNpbWVuLCByZXN0U3BlY2ltZW4gfSA9IHNwbGl0QXJyYXlQYXJ0cyhzcGVjaW1lbiwgcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQpO1xuICAgICAgY29uc3QgcGFydGlhbFBhdHQgPSBhZGFwdEFycmF5UGF0dGVybihcbiAgICAgICAgb3B0aW9uYWxQYXR0LFxuICAgICAgICBvcHRpb25hbFNwZWNpbWVuLmxlbmd0aFxuICAgICAgKTtcbiAgICAgIGxldCBhcmdOdW0gPSAwO1xuICAgICAgcmV0dXJuIChyZXF1aXJlZFNwZWNpbWVuLmxlbmd0aCA9PT0gcmVxdWlyZWRQYXR0Lmxlbmd0aCB8fCBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYEV4cGVjdGVkIGF0IGxlYXN0ICR7cXVvdGUoXG4gICAgICAgICAgcmVxdWlyZWRQYXR0Lmxlbmd0aFxuICAgICAgICApfSBhcmd1bWVudHM6ICR7c3BlY2ltZW59YFxuICAgICAgKSkgJiYgcmVxdWlyZWRQYXR0LmV2ZXJ5KFxuICAgICAgICAocDMsIGkyKSA9PiAoXG4gICAgICAgICAgLy9cbiAgICAgICAgICBjaGVja01hdGNoZXMyKHJlcXVpcmVkU3BlY2ltZW5baTJdLCBwMywgY2hlY2ssIGBhcmcgJHthcmdOdW0rK31gKVxuICAgICAgICApXG4gICAgICApICYmIHBhcnRpYWxQYXR0LmV2ZXJ5KFxuICAgICAgICAocDMsIGkyKSA9PiAoXG4gICAgICAgICAgLy9cbiAgICAgICAgICBjaGVja01hdGNoZXMyKG9wdGlvbmFsU3BlY2ltZW5baTJdLCBwMywgY2hlY2ssIGBhcmcgJHthcmdOdW0rK30/YClcbiAgICAgICAgKVxuICAgICAgKSAmJiBjaGVja01hdGNoZXMyKHJlc3RTcGVjaW1lbiwgcmVzdFBhdHQsIGNoZWNrLCBcIi4uLnJlc3RcIik7XG4gICAgfSxcbiAgICAvKlxuXG5cbiAgICAgKi9cbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHNwbGl0QXJyYXksIGNoZWNrKSA9PiB7XG4gICAgICBpZiAocGFzc1N0eWxlT2Yoc3BsaXRBcnJheSkgPT09IFwiY29weUFycmF5XCIgJiYgKHNwbGl0QXJyYXkubGVuZ3RoID49IDEgfHwgc3BsaXRBcnJheS5sZW5ndGggPD0gMykpIHtcbiAgICAgICAgY29uc3QgW3JlcXVpcmVkUGF0dCwgb3B0aW9uYWxQYXR0ID0gdm9pZCAwLCByZXN0UGF0dCA9IHZvaWQgMF0gPSBzcGxpdEFycmF5O1xuICAgICAgICBpZiAoaXNQYXR0ZXJuMihyZXF1aXJlZFBhdHQpICYmIHBhc3NTdHlsZU9mKHJlcXVpcmVkUGF0dCkgPT09IFwiY29weUFycmF5XCIgJiYgKG9wdGlvbmFsUGF0dCA9PT0gdm9pZCAwIHx8IGlzUGF0dGVybjIob3B0aW9uYWxQYXR0KSAmJiBwYXNzU3R5bGVPZihvcHRpb25hbFBhdHQpID09PSBcImNvcHlBcnJheVwiKSAmJiAocmVzdFBhdHQgPT09IHZvaWQgMCB8fCBpc1BhdHRlcm4yKHJlc3RQYXR0KSkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgcmVkYWN0ZWRgTXVzdCBiZSBhbiBhcnJheSBvZiBhIHJlcXVpcmVkUGF0dCBhcnJheSwgYW4gb3B0aW9uYWwgb3B0aW9uYWxQYXR0IGFycmF5LCBhbmQgYW4gb3B0aW9uYWwgcmVzdFBhdHQ6ICR7cXVvdGUoXG4gICAgICAgICAgc3BsaXRBcnJheVxuICAgICAgICApfWBcbiAgICAgICk7XG4gICAgfSxcbiAgICBnZXRSYW5rQ292ZXI6IChbXG4gICAgICBfcmVxdWlyZWRQYXR0LFxuICAgICAgX29wdGlvbmFsUGF0dCA9IHZvaWQgMCxcbiAgICAgIF9yZXN0UGF0dCA9IHZvaWQgMFxuICAgIF0pID0+IGdldFBhc3NTdHlsZUNvdmVyKFwiY29weUFycmF5XCIpXG4gIH0pO1xuICBjb25zdCBzcGxpdFJlY29yZFBhcnRzID0gKHNwZWNpbWVuLCByZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCkgPT4ge1xuICAgIGNvbnN0IHJlcXVpcmVkRW50cmllcyA9IFtdO1xuICAgIGNvbnN0IG9wdGlvbmFsRW50cmllcyA9IFtdO1xuICAgIGNvbnN0IHJlc3RFbnRyaWVzID0gW107XG4gICAgZm9yIChjb25zdCBbbmFtZSwgdmFsdWVdIG9mIGVudHJpZXM3KHNwZWNpbWVuKSkge1xuICAgICAgaWYgKGhhc093blByb3BlcnR5T2YocmVxdWlyZWRQYXR0LCBuYW1lKSkge1xuICAgICAgICByZXF1aXJlZEVudHJpZXMucHVzaChbbmFtZSwgdmFsdWVdKTtcbiAgICAgIH0gZWxzZSBpZiAoaGFzT3duUHJvcGVydHlPZihvcHRpb25hbFBhdHQsIG5hbWUpKSB7XG4gICAgICAgIG9wdGlvbmFsRW50cmllcy5wdXNoKFtuYW1lLCB2YWx1ZV0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdEVudHJpZXMucHVzaChbbmFtZSwgdmFsdWVdKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICByZXF1aXJlZFNwZWNpbWVuOiBmcm9tVW5pcXVlRW50cmllcyhyZXF1aXJlZEVudHJpZXMpLFxuICAgICAgb3B0aW9uYWxTcGVjaW1lbjogZnJvbVVuaXF1ZUVudHJpZXMob3B0aW9uYWxFbnRyaWVzKSxcbiAgICAgIHJlc3RTcGVjaW1lbjogZnJvbVVuaXF1ZUVudHJpZXMocmVzdEVudHJpZXMpXG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGFkYXB0UmVjb3JkUGF0dGVybiA9IChvcHRpb25hbFBhdHQsIG5hbWVzKSA9PiBmcm9tVW5pcXVlRW50cmllcyhuYW1lcy5tYXAoKG5hbWUpID0+IFtuYW1lLCBNTS5vcHQob3B0aW9uYWxQYXR0W25hbWVdKV0pKTtcbiAgY29uc3QgbWF0Y2hTcGxpdFJlY29yZEhlbHBlciA9IEZhcihcIm1hdGNoOnNwbGl0UmVjb3JkIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtyZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCA9IHt9LCByZXN0UGF0dCA9IE1NLmFueSgpXSwgY2hlY2spID0+IHtcbiAgICAgIGlmICghY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlSZWNvcmRcIiwgY2hlY2spKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgcmVxdWlyZWRTcGVjaW1lbiwgb3B0aW9uYWxTcGVjaW1lbiwgcmVzdFNwZWNpbWVuIH0gPSBzcGxpdFJlY29yZFBhcnRzKHNwZWNpbWVuLCByZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCk7XG4gICAgICBjb25zdCBwYXJ0aWFsTmFtZXMgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG93bktleXMxNyhvcHRpb25hbFNwZWNpbWVuKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHBhcnRpYWxQYXR0ID0gYWRhcHRSZWNvcmRQYXR0ZXJuKG9wdGlvbmFsUGF0dCwgcGFydGlhbE5hbWVzKTtcbiAgICAgIHJldHVybiBjaGVja01hdGNoZXMyKHJlcXVpcmVkU3BlY2ltZW4sIHJlcXVpcmVkUGF0dCwgY2hlY2spICYmIHBhcnRpYWxOYW1lcy5ldmVyeShcbiAgICAgICAgKG5hbWUpID0+IGNoZWNrTWF0Y2hlczIoXG4gICAgICAgICAgb3B0aW9uYWxTcGVjaW1lbltuYW1lXSxcbiAgICAgICAgICBwYXJ0aWFsUGF0dFtuYW1lXSxcbiAgICAgICAgICBjaGVjayxcbiAgICAgICAgICBgJHtuYW1lfT9gXG4gICAgICAgIClcbiAgICAgICkgJiYgY2hlY2tNYXRjaGVzMihyZXN0U3BlY2ltZW4sIHJlc3RQYXR0LCBjaGVjaywgXCIuLi5yZXN0XCIpO1xuICAgIH0sXG4gICAgLypcblxuXG4gICAgICovXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChzcGxpdEFycmF5LCBjaGVjaykgPT4ge1xuICAgICAgaWYgKHBhc3NTdHlsZU9mKHNwbGl0QXJyYXkpID09PSBcImNvcHlBcnJheVwiICYmIChzcGxpdEFycmF5Lmxlbmd0aCA+PSAxIHx8IHNwbGl0QXJyYXkubGVuZ3RoIDw9IDMpKSB7XG4gICAgICAgIGNvbnN0IFtyZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCA9IHZvaWQgMCwgcmVzdFBhdHQgPSB2b2lkIDBdID0gc3BsaXRBcnJheTtcbiAgICAgICAgaWYgKGlzUGF0dGVybjIocmVxdWlyZWRQYXR0KSAmJiBwYXNzU3R5bGVPZihyZXF1aXJlZFBhdHQpID09PSBcImNvcHlSZWNvcmRcIiAmJiAob3B0aW9uYWxQYXR0ID09PSB2b2lkIDAgfHwgaXNQYXR0ZXJuMihvcHRpb25hbFBhdHQpICYmIHBhc3NTdHlsZU9mKG9wdGlvbmFsUGF0dCkgPT09IFwiY29weVJlY29yZFwiKSAmJiAocmVzdFBhdHQgPT09IHZvaWQgMCB8fCBpc1BhdHRlcm4yKHJlc3RQYXR0KSkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgcmVkYWN0ZWRgTXVzdCBiZSBhbiBhcnJheSBvZiBhIHJlcXVpcmVkUGF0dCByZWNvcmQsIGFuIG9wdGlvbmFsIG9wdGlvbmFsUGF0dCByZWNvcmQsIGFuZCBhbiBvcHRpb25hbCByZXN0UGF0dDogJHtxdW90ZShcbiAgICAgICAgICBzcGxpdEFycmF5XG4gICAgICAgICl9YFxuICAgICAgKTtcbiAgICB9LFxuICAgIGdldFJhbmtDb3ZlcjogKFtcbiAgICAgIHJlcXVpcmVkUGF0dCxcbiAgICAgIF9vcHRpb25hbFBhdHQgPSB2b2lkIDAsXG4gICAgICBfcmVzdFBhdHQgPSB2b2lkIDBcbiAgICBdKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihwYXNzU3R5bGVPZihyZXF1aXJlZFBhdHQpKVxuICB9KTtcbiAgY29uc3QgSGVscGVyc0J5TWF0Y2hUYWcgPSBoYXJkZW4oe1xuICAgIFwibWF0Y2g6YW55XCI6IG1hdGNoQW55SGVscGVyLFxuICAgIFwibWF0Y2g6YW5kXCI6IG1hdGNoQW5kSGVscGVyLFxuICAgIFwibWF0Y2g6b3JcIjogbWF0Y2hPckhlbHBlcixcbiAgICBcIm1hdGNoOm5vdFwiOiBtYXRjaE5vdEhlbHBlcixcbiAgICBcIm1hdGNoOnNjYWxhclwiOiBtYXRjaFNjYWxhckhlbHBlcixcbiAgICBcIm1hdGNoOmtleVwiOiBtYXRjaEtleUhlbHBlcixcbiAgICBcIm1hdGNoOnBhdHRlcm5cIjogbWF0Y2hQYXR0ZXJuSGVscGVyLFxuICAgIFwibWF0Y2g6a2luZFwiOiBtYXRjaEtpbmRIZWxwZXIsXG4gICAgXCJtYXRjaDp0YWdnZWRcIjogbWF0Y2hUYWdnZWRIZWxwZXIsXG4gICAgXCJtYXRjaDpiaWdpbnRcIjogbWF0Y2hCaWdpbnRIZWxwZXIsXG4gICAgXCJtYXRjaDpuYXRcIjogbWF0Y2hOYXRIZWxwZXIsXG4gICAgXCJtYXRjaDpzdHJpbmdcIjogbWF0Y2hTdHJpbmdIZWxwZXIsXG4gICAgXCJtYXRjaDpzeW1ib2xcIjogbWF0Y2hTeW1ib2xIZWxwZXIsXG4gICAgXCJtYXRjaDpyZW1vdGFibGVcIjogbWF0Y2hSZW1vdGFibGVIZWxwZXIsXG4gICAgXCJtYXRjaDpsdFwiOiBtYXRjaExUSGVscGVyLFxuICAgIFwibWF0Y2g6bHRlXCI6IG1hdGNoTFRFSGVscGVyLFxuICAgIFwibWF0Y2g6Z3RlXCI6IG1hdGNoR1RFSGVscGVyLFxuICAgIFwibWF0Y2g6Z3RcIjogbWF0Y2hHVEhlbHBlcixcbiAgICBcIm1hdGNoOmFycmF5T2ZcIjogbWF0Y2hBcnJheU9mSGVscGVyLFxuICAgIFwibWF0Y2g6cmVjb3JkT2ZcIjogbWF0Y2hSZWNvcmRPZkhlbHBlcixcbiAgICBcIm1hdGNoOnNldE9mXCI6IG1hdGNoU2V0T2ZIZWxwZXIsXG4gICAgXCJtYXRjaDpiYWdPZlwiOiBtYXRjaEJhZ09mSGVscGVyLFxuICAgIFwibWF0Y2g6Y29udGFpbmVySGFzXCI6IG1hdGNoQ29udGFpbmVySGFzSGVscGVyLFxuICAgIFwibWF0Y2g6bWFwT2ZcIjogbWF0Y2hNYXBPZkhlbHBlcixcbiAgICBcIm1hdGNoOnNwbGl0QXJyYXlcIjogbWF0Y2hTcGxpdEFycmF5SGVscGVyLFxuICAgIFwibWF0Y2g6c3BsaXRSZWNvcmRcIjogbWF0Y2hTcGxpdFJlY29yZEhlbHBlclxuICB9KTtcbiAgY29uc3QgbWFrZU1hdGNoZXIgPSAodGFnLCBwYXlsb2FkKSA9PiB7XG4gICAgY29uc3QgbWF0Y2hlciA9IG1ha2VUYWdnZWQodGFnLCBwYXlsb2FkKTtcbiAgICBhc3NlcnRQYXR0ZXJuMihtYXRjaGVyKTtcbiAgICByZXR1cm4gbWF0Y2hlcjtcbiAgfTtcbiAgY29uc3QgbWFrZUtpbmRNYXRjaGVyID0gKGtpbmQyKSA9PiBtYWtlTWF0Y2hlcihcIm1hdGNoOmtpbmRcIiwga2luZDIpO1xuICBjb25zdCBBbnlTaGFwZSA9IG1ha2VNYXRjaGVyKFwibWF0Y2g6YW55XCIsIHZvaWQgMCk7XG4gIGNvbnN0IFNjYWxhclNoYXBlID0gbWFrZU1hdGNoZXIoXCJtYXRjaDpzY2FsYXJcIiwgdm9pZCAwKTtcbiAgY29uc3QgS2V5U2hhcGUgPSBtYWtlTWF0Y2hlcihcIm1hdGNoOmtleVwiLCB2b2lkIDApO1xuICBjb25zdCBQYXR0ZXJuU2hhcGUgPSBtYWtlTWF0Y2hlcihcIm1hdGNoOnBhdHRlcm5cIiwgdm9pZCAwKTtcbiAgY29uc3QgQm9vbGVhblNoYXBlID0gbWFrZUtpbmRNYXRjaGVyKFwiYm9vbGVhblwiKTtcbiAgY29uc3QgTnVtYmVyU2hhcGUgPSBtYWtlS2luZE1hdGNoZXIoXCJudW1iZXJcIik7XG4gIGNvbnN0IEJpZ0ludFNoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOmJpZ2ludFwiLCBbXSk7XG4gIGNvbnN0IE5hdFNoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOm5hdFwiLCBbXSk7XG4gIGNvbnN0IFN0cmluZ1NoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOnN0cmluZ1wiLCBbXSk7XG4gIGNvbnN0IFN5bWJvbFNoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOnN5bWJvbFwiLCBbXSk7XG4gIGNvbnN0IFJlY29yZFNoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOnJlY29yZE9mXCIsIFtBbnlTaGFwZSwgQW55U2hhcGVdKTtcbiAgY29uc3QgQXJyYXlTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDphcnJheU9mXCIsIFtBbnlTaGFwZV0pO1xuICBjb25zdCBTZXRTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpzZXRPZlwiLCBbQW55U2hhcGVdKTtcbiAgY29uc3QgQmFnU2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6YmFnT2ZcIiwgW0FueVNoYXBlLCBBbnlTaGFwZV0pO1xuICBjb25zdCBNYXBTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDptYXBPZlwiLCBbQW55U2hhcGUsIEFueVNoYXBlXSk7XG4gIGNvbnN0IFJlbW90YWJsZVNoYXBlID0gbWFrZUtpbmRNYXRjaGVyKFwicmVtb3RhYmxlXCIpO1xuICBjb25zdCBFcnJvclNoYXBlID0gbWFrZUtpbmRNYXRjaGVyKFwiZXJyb3JcIik7XG4gIGNvbnN0IFByb21pc2VTaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcInByb21pc2VcIik7XG4gIGNvbnN0IFVuZGVmaW5lZFNoYXBlID0gbWFrZUtpbmRNYXRjaGVyKFwidW5kZWZpbmVkXCIpO1xuICBjb25zdCBtYWtlTGltaXRzTWF0Y2hlciA9ICh0YWcsIHBheWxvYWQpID0+IHtcbiAgICBpZiAocGF5bG9hZFtwYXlsb2FkLmxlbmd0aCAtIDFdID09PSB2b2lkIDApIHtcbiAgICAgIHBheWxvYWQgPSBoYXJkZW4ocGF5bG9hZC5zbGljZSgwLCBwYXlsb2FkLmxlbmd0aCAtIDEpKTtcbiAgICB9XG4gICAgcmV0dXJuIG1ha2VNYXRjaGVyKHRhZywgcGF5bG9hZCk7XG4gIH07XG4gIGNvbnN0IG1ha2VSZW1vdGFibGVNYXRjaGVyID0gKGxhYmVsID0gdm9pZCAwKSA9PiBsYWJlbCA9PT0gdm9pZCAwID8gUmVtb3RhYmxlU2hhcGUgOiBtYWtlTWF0Y2hlcihcIm1hdGNoOnJlbW90YWJsZVwiLCBoYXJkZW4oeyBsYWJlbCB9KSk7XG4gIGNvbnN0IG1ha2VTcGxpdFBheWxvYWQgPSAoZW1wdHk1LCBiYXNlMiwgb3B0aW9uYWwgPSB2b2lkIDAsIHJlc3QgPSB2b2lkIDApID0+IHtcbiAgICBpZiAocmVzdCkge1xuICAgICAgcmV0dXJuIFtiYXNlMiwgb3B0aW9uYWwgfHwgZW1wdHk1LCByZXN0XTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbmFsKSB7XG4gICAgICByZXR1cm4gW2Jhc2UyLCBvcHRpb25hbF07XG4gICAgfVxuICAgIHJldHVybiBbYmFzZTJdO1xuICB9O1xuICBjb25zdCBNMiA9IGhhcmRlbih7XG4gICAgYW55OiAoKSA9PiBBbnlTaGFwZSxcbiAgICBhbmQ6ICguLi5wYXR0cykgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDphbmRcIiwgcGF0dHMpLFxuICAgIG9yOiAoLi4ucGF0dHMpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6b3JcIiwgcGF0dHMpLFxuICAgIG5vdDogKHN1YlBhdHQpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6bm90XCIsIHN1YlBhdHQpLFxuICAgIHNjYWxhcjogKCkgPT4gU2NhbGFyU2hhcGUsXG4gICAga2V5OiAoKSA9PiBLZXlTaGFwZSxcbiAgICBwYXR0ZXJuOiAoKSA9PiBQYXR0ZXJuU2hhcGUsXG4gICAga2luZDogbWFrZUtpbmRNYXRjaGVyLFxuICAgIHRhZ2dlZDogKHRhZ1BhdHQgPSBNMi5zdHJpbmcoKSwgcGF5bG9hZFBhdHQgPSBNMi5hbnkoKSkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDp0YWdnZWRcIiwgaGFyZGVuKFt0YWdQYXR0LCBwYXlsb2FkUGF0dF0pKSxcbiAgICBib29sZWFuOiAoKSA9PiBCb29sZWFuU2hhcGUsXG4gICAgbnVtYmVyOiAoKSA9PiBOdW1iZXJTaGFwZSxcbiAgICBiaWdpbnQ6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6YmlnaW50XCIsIFtsaW1pdHNdKSA6IEJpZ0ludFNoYXBlLFxuICAgIG5hdDogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpuYXRcIiwgW2xpbWl0c10pIDogTmF0U2hhcGUsXG4gICAgc3RyaW5nOiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnN0cmluZ1wiLCBbbGltaXRzXSkgOiBTdHJpbmdTaGFwZSxcbiAgICBzeW1ib2w6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6c3ltYm9sXCIsIFtsaW1pdHNdKSA6IFN5bWJvbFNoYXBlLFxuICAgIHJlY29yZDogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gTTIucmVjb3JkT2YoTTIuYW55KCksIE0yLmFueSgpLCBsaW1pdHMpIDogUmVjb3JkU2hhcGUsXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICBhcnJheTogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gTTIuYXJyYXlPZihNMi5hbnkoKSwgbGltaXRzKSA6IEFycmF5U2hhcGUsXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgc2V0OiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBNMi5zZXRPZihNMi5hbnkoKSwgbGltaXRzKSA6IFNldFNoYXBlLFxuICAgIGJhZzogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gTTIuYmFnT2YoTTIuYW55KCksIE0yLmFueSgpLCBsaW1pdHMpIDogQmFnU2hhcGUsXG4gICAgbWFwOiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBNMi5tYXBPZihNMi5hbnkoKSwgTTIuYW55KCksIGxpbWl0cykgOiBNYXBTaGFwZSxcbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIHJlbW90YWJsZTogbWFrZVJlbW90YWJsZU1hdGNoZXIsXG4gICAgZXJyb3I6ICgpID0+IEVycm9yU2hhcGUsXG4gICAgcHJvbWlzZTogKCkgPT4gUHJvbWlzZVNoYXBlLFxuICAgIHVuZGVmaW5lZDogKCkgPT4gVW5kZWZpbmVkU2hhcGUsXG4gICAgbnVsbDogKCkgPT4gbnVsbCxcbiAgICBsdDogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpsdFwiLCByaWdodE9wZXJhbmQpLFxuICAgIGx0ZTogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpsdGVcIiwgcmlnaHRPcGVyYW5kKSxcbiAgICBlcTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5KGtleSk7XG4gICAgICByZXR1cm4ga2V5ID09PSB2b2lkIDAgPyBNMi51bmRlZmluZWQoKSA6IGtleTtcbiAgICB9LFxuICAgIG5lcTogKGtleSkgPT4gTTIubm90KE0yLmVxKGtleSkpLFxuICAgIGd0ZTogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpndGVcIiwgcmlnaHRPcGVyYW5kKSxcbiAgICBndDogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpndFwiLCByaWdodE9wZXJhbmQpLFxuICAgIHJlY29yZE9mOiAoa2V5UGF0dCA9IE0yLmFueSgpLCB2YWx1ZVBhdHQgPSBNMi5hbnkoKSwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnJlY29yZE9mXCIsIFtrZXlQYXR0LCB2YWx1ZVBhdHQsIGxpbWl0c10pLFxuICAgIGFycmF5T2Y6IChzdWJQYXR0ID0gTTIuYW55KCksIGxpbWl0cyA9IHZvaWQgMCkgPT4gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDphcnJheU9mXCIsIFtzdWJQYXR0LCBsaW1pdHNdKSxcbiAgICBzZXRPZjogKGtleVBhdHQgPSBNMi5hbnkoKSwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnNldE9mXCIsIFtrZXlQYXR0LCBsaW1pdHNdKSxcbiAgICBiYWdPZjogKGtleVBhdHQgPSBNMi5hbnkoKSwgY291bnRQYXR0ID0gTTIuYW55KCksIGxpbWl0cyA9IHZvaWQgMCkgPT4gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpiYWdPZlwiLCBba2V5UGF0dCwgY291bnRQYXR0LCBsaW1pdHNdKSxcbiAgICBjb250YWluZXJIYXM6IChlbGVtZW50UGF0dCA9IE0yLmFueSgpLCBjb3VudFBhdHQgPSAxbiwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOmNvbnRhaW5lckhhc1wiLCBbZWxlbWVudFBhdHQsIGNvdW50UGF0dCwgbGltaXRzXSksXG4gICAgbWFwT2Y6IChrZXlQYXR0ID0gTTIuYW55KCksIHZhbHVlUGF0dCA9IE0yLmFueSgpLCBsaW1pdHMgPSB2b2lkIDApID0+IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6bWFwT2ZcIiwgW2tleVBhdHQsIHZhbHVlUGF0dCwgbGltaXRzXSksXG4gICAgc3BsaXRBcnJheTogKGJhc2UyLCBvcHRpb25hbCA9IHZvaWQgMCwgcmVzdCA9IHZvaWQgMCkgPT4gbWFrZU1hdGNoZXIoXG4gICAgICBcIm1hdGNoOnNwbGl0QXJyYXlcIixcbiAgICAgIG1ha2VTcGxpdFBheWxvYWQoW10sIGJhc2UyLCBvcHRpb25hbCwgcmVzdClcbiAgICApLFxuICAgIHNwbGl0UmVjb3JkOiAoYmFzZTIsIG9wdGlvbmFsID0gdm9pZCAwLCByZXN0ID0gdm9pZCAwKSA9PiBtYWtlTWF0Y2hlcihcbiAgICAgIFwibWF0Y2g6c3BsaXRSZWNvcmRcIixcbiAgICAgIG1ha2VTcGxpdFBheWxvYWQoe30sIGJhc2UyLCBvcHRpb25hbCwgcmVzdClcbiAgICApLFxuICAgIHNwbGl0OiAoYmFzZTIsIHJlc3QgPSB2b2lkIDApID0+IHtcbiAgICAgIGlmIChwYXNzU3R5bGVPZihoYXJkZW4oYmFzZTIpKSA9PT0gXCJjb3B5QXJyYXlcIikge1xuICAgICAgICByZXR1cm4gTTIuc3BsaXRBcnJheShiYXNlMiwgcmVzdCAmJiBbXSwgcmVzdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gTTIuc3BsaXRSZWNvcmQoYmFzZTIsIHJlc3QgJiYge30sIHJlc3QpO1xuICAgICAgfVxuICAgIH0sXG4gICAgcGFydGlhbDogKGJhc2UyLCByZXN0ID0gdm9pZCAwKSA9PiB7XG4gICAgICBpZiAocGFzc1N0eWxlT2YoaGFyZGVuKGJhc2UyKSkgPT09IFwiY29weUFycmF5XCIpIHtcbiAgICAgICAgcmV0dXJuIE0yLnNwbGl0QXJyYXkoW10sIGJhc2UyLCByZXN0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBNMi5zcGxpdFJlY29yZCh7fSwgYmFzZTIsIHJlc3QpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZXJlZjogKHQ1KSA9PiBNMi5vcih0NSwgTTIucHJvbWlzZSgpKSxcbiAgICBvcHQ6ICh0NSkgPT4gTTIub3IoTTIudW5kZWZpbmVkKCksIHQ1KSxcbiAgICBpbnRlcmZhY2U6IChpbnRlcmZhY2VOYW1lLCBtZXRob2RHdWFyZHMsIG9wdGlvbnMpID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlSW50ZXJmYWNlR3VhcmQoaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCBvcHRpb25zKVxuICAgICksXG4gICAgY2FsbDogKC4uLmFyZ1BhdHRlcm5zKSA9PiAoXG4gICAgICAvL1xuICAgICAgbWFrZU1ldGhvZEd1YXJkTWFrZXIoXCJzeW5jXCIsIGFyZ1BhdHRlcm5zKVxuICAgICksXG4gICAgY2FsbFdoZW46ICguLi5hcmdHdWFyZHMpID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlTWV0aG9kR3VhcmRNYWtlcihcImFzeW5jXCIsIGFyZ0d1YXJkcylcbiAgICApLFxuICAgIGF3YWl0OiAoYXJnUGF0dGVybikgPT4gKFxuICAgICAgLy9cbiAgICAgIG1ha2VBd2FpdEFyZ0d1YXJkKGFyZ1BhdHRlcm4pXG4gICAgKSxcbiAgICByYXc6ICgpID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlUmF3R3VhcmQoKVxuICAgIClcbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGNoZWNrTWF0Y2hlczogY2hlY2tNYXRjaGVzMixcbiAgICBtYXRjaGVzOiBtYXRjaGVzMixcbiAgICBtdXN0TWF0Y2g6IG11c3RNYXRjaDQsXG4gICAgYXNzZXJ0UGF0dGVybjogYXNzZXJ0UGF0dGVybjIsXG4gICAgaXNQYXR0ZXJuOiBpc1BhdHRlcm4yLFxuICAgIGdldFJhbmtDb3ZlcjogZ2V0UmFua0NvdmVyMixcbiAgICBNOiBNMixcbiAgICBraW5kT2Y6IGtpbmRPZjIsXG4gICAgY29udGFpbmVySGFzU3BsaXQ6IGNvbnRhaW5lckhhc1NwbGl0MlxuICB9KTtcbn07XG52YXIge1xuICBjaGVja01hdGNoZXMsXG4gIG1hdGNoZXMsXG4gIG11c3RNYXRjaCxcbiAgYXNzZXJ0UGF0dGVybixcbiAgaXNQYXR0ZXJuLFxuICBnZXRSYW5rQ292ZXIsXG4gIE0sXG4gIGtpbmRPZixcbiAgY29udGFpbmVySGFzU3BsaXRcbn0gPSBtYWtlUGF0dGVybktpdCgpO1xuTU0gPSBNO1xudmFyIEF3YWl0QXJnR3VhcmRQYXlsb2FkU2hhcGUgPSBoYXJkZW4oe1xuICBhcmdHdWFyZDogTS5wYXR0ZXJuKClcbn0pO1xudmFyIEF3YWl0QXJnR3VhcmRTaGFwZSA9IE0ua2luZChcImd1YXJkOmF3YWl0QXJnR3VhcmRcIik7XG52YXIgaXNBd2FpdEFyZ0d1YXJkID0gKHNwZWNpbWVuKSA9PiBtYXRjaGVzKHNwZWNpbWVuLCBBd2FpdEFyZ0d1YXJkU2hhcGUpO1xuaGFyZGVuKGlzQXdhaXRBcmdHdWFyZCk7XG52YXIgYXNzZXJ0QXdhaXRBcmdHdWFyZCA9IChzcGVjaW1lbikgPT4ge1xuICBtdXN0TWF0Y2goc3BlY2ltZW4sIEF3YWl0QXJnR3VhcmRTaGFwZSwgXCJhd2FpdEFyZ0d1YXJkXCIpO1xufTtcbmhhcmRlbihhc3NlcnRBd2FpdEFyZ0d1YXJkKTtcbnZhciBtYWtlQXdhaXRBcmdHdWFyZCA9IChhcmdQYXR0ZXJuKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VUYWdnZWQoXCJndWFyZDphd2FpdEFyZ0d1YXJkXCIsIHtcbiAgICBhcmdHdWFyZDogYXJnUGF0dGVyblxuICB9KTtcbiAgYXNzZXJ0QXdhaXRBcmdHdWFyZChyZXN1bHQpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBSYXdHdWFyZFBheWxvYWRTaGFwZSA9IE0ucmVjb3JkKCk7XG52YXIgUmF3R3VhcmRTaGFwZSA9IE0ua2luZChcImd1YXJkOnJhd0d1YXJkXCIpO1xudmFyIGlzUmF3R3VhcmQgPSAoc3BlY2ltZW4pID0+IG1hdGNoZXMoc3BlY2ltZW4sIFJhd0d1YXJkU2hhcGUpO1xudmFyIG1ha2VSYXdHdWFyZCA9ICgpID0+IG1ha2VUYWdnZWQoXCJndWFyZDpyYXdHdWFyZFwiLCB7fSk7XG52YXIgU3luY1ZhbHVlR3VhcmRTaGFwZSA9IE0ub3IoUmF3R3VhcmRTaGFwZSwgTS5wYXR0ZXJuKCkpO1xudmFyIFN5bmNWYWx1ZUd1YXJkTGlzdFNoYXBlID0gTS5hcnJheU9mKFN5bmNWYWx1ZUd1YXJkU2hhcGUpO1xudmFyIEFyZ0d1YXJkU2hhcGUgPSBNLm9yKFJhd0d1YXJkU2hhcGUsIEF3YWl0QXJnR3VhcmRTaGFwZSwgTS5wYXR0ZXJuKCkpO1xudmFyIEFyZ0d1YXJkTGlzdFNoYXBlID0gTS5hcnJheU9mKEFyZ0d1YXJkU2hhcGUpO1xudmFyIFN5bmNNZXRob2RHdWFyZFBheWxvYWRTaGFwZSA9IGhhcmRlbih7XG4gIGNhbGxLaW5kOiBcInN5bmNcIixcbiAgYXJnR3VhcmRzOiBTeW5jVmFsdWVHdWFyZExpc3RTaGFwZSxcbiAgb3B0aW9uYWxBcmdHdWFyZHM6IE0ub3B0KFN5bmNWYWx1ZUd1YXJkTGlzdFNoYXBlKSxcbiAgcmVzdEFyZ0d1YXJkOiBNLm9wdChTeW5jVmFsdWVHdWFyZFNoYXBlKSxcbiAgcmV0dXJuR3VhcmQ6IFN5bmNWYWx1ZUd1YXJkU2hhcGVcbn0pO1xudmFyIEFzeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUgPSBoYXJkZW4oe1xuICBjYWxsS2luZDogXCJhc3luY1wiLFxuICBhcmdHdWFyZHM6IEFyZ0d1YXJkTGlzdFNoYXBlLFxuICBvcHRpb25hbEFyZ0d1YXJkczogTS5vcHQoQXJnR3VhcmRMaXN0U2hhcGUpLFxuICByZXN0QXJnR3VhcmQ6IE0ub3B0KFN5bmNWYWx1ZUd1YXJkU2hhcGUpLFxuICByZXR1cm5HdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxufSk7XG52YXIgTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUgPSBNLm9yKFxuICBTeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUsXG4gIEFzeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGVcbik7XG52YXIgTWV0aG9kR3VhcmRTaGFwZSA9IE0ua2luZChcImd1YXJkOm1ldGhvZEd1YXJkXCIpO1xudmFyIGFzc2VydE1ldGhvZEd1YXJkID0gKHNwZWNpbWVuKSA9PiB7XG4gIG11c3RNYXRjaChzcGVjaW1lbiwgTWV0aG9kR3VhcmRTaGFwZSwgXCJtZXRob2RHdWFyZFwiKTtcbn07XG5oYXJkZW4oYXNzZXJ0TWV0aG9kR3VhcmQpO1xudmFyIG1ha2VNZXRob2RHdWFyZE1ha2VyID0gKGNhbGxLaW5kLCBhcmdHdWFyZHMsIG9wdGlvbmFsQXJnR3VhcmRzID0gdm9pZCAwLCByZXN0QXJnR3VhcmQgPSB2b2lkIDApID0+IGhhcmRlbih7XG4gIG9wdGlvbmFsOiAoLi4ub3B0QXJnR3VhcmRzKSA9PiB7XG4gICAgb3B0aW9uYWxBcmdHdWFyZHMgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYENhbiBvbmx5IGhhdmUgb25lIHNldCBvZiBvcHRpb25hbCBndWFyZHNgO1xuICAgIHJlc3RBcmdHdWFyZCA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgb3B0aW9uYWwgYXJnIGd1YXJkcyBtdXN0IGNvbWUgYmVmb3JlIHJlc3QgYXJnYDtcbiAgICByZXR1cm4gbWFrZU1ldGhvZEd1YXJkTWFrZXIoY2FsbEtpbmQsIGFyZ0d1YXJkcywgb3B0QXJnR3VhcmRzKTtcbiAgfSxcbiAgcmVzdDogKHJBcmdHdWFyZCkgPT4ge1xuICAgIHJlc3RBcmdHdWFyZCA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgQ2FuIG9ubHkgaGF2ZSBvbmUgcmVzdCBhcmdgO1xuICAgIHJldHVybiBtYWtlTWV0aG9kR3VhcmRNYWtlcihcbiAgICAgIGNhbGxLaW5kLFxuICAgICAgYXJnR3VhcmRzLFxuICAgICAgb3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgICByQXJnR3VhcmRcbiAgICApO1xuICB9LFxuICByZXR1cm5zOiAocmV0dXJuR3VhcmQgPSBNLnVuZGVmaW5lZCgpKSA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gbWFrZVRhZ2dlZChcImd1YXJkOm1ldGhvZEd1YXJkXCIsIHtcbiAgICAgIGNhbGxLaW5kLFxuICAgICAgYXJnR3VhcmRzLFxuICAgICAgb3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgICByZXN0QXJnR3VhcmQsXG4gICAgICByZXR1cm5HdWFyZFxuICAgIH0pO1xuICAgIGFzc2VydE1ldGhvZEd1YXJkKHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufSk7XG52YXIgSW50ZXJmYWNlR3VhcmRQYXlsb2FkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgaW50ZXJmYWNlTmFtZTogTS5zdHJpbmcoKSxcbiAgICBtZXRob2RHdWFyZHM6IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgTWV0aG9kR3VhcmRTaGFwZSlcbiAgfSxcbiAge1xuICAgIGRlZmF1bHRHdWFyZHM6IE0ub3IoTS51bmRlZmluZWQoKSwgXCJwYXNzYWJsZVwiLCBcInJhd1wiKSxcbiAgICBzbG9wcHk6IE0uYm9vbGVhbigpLFxuICAgIHN5bWJvbE1ldGhvZEd1YXJkczogTS5tYXBPZihNLnN5bWJvbCgpLCBNZXRob2RHdWFyZFNoYXBlKVxuICB9XG4pO1xudmFyIEludGVyZmFjZUd1YXJkU2hhcGUgPSBNLmtpbmQoXCJndWFyZDppbnRlcmZhY2VHdWFyZFwiKTtcbnZhciBhc3NlcnRJbnRlcmZhY2VHdWFyZCA9IChzcGVjaW1lbikgPT4ge1xuICBtdXN0TWF0Y2goc3BlY2ltZW4sIEludGVyZmFjZUd1YXJkU2hhcGUsIFwiaW50ZXJmYWNlR3VhcmRcIik7XG59O1xuaGFyZGVuKGFzc2VydEludGVyZmFjZUd1YXJkKTtcbnZhciBtYWtlSW50ZXJmYWNlR3VhcmQgPSAoaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCBvcHRpb25zID0ge30pID0+IHtcbiAgY29uc3QgeyBzbG9wcHkgPSBmYWxzZSwgZGVmYXVsdEd1YXJkcyA9IHNsb3BweSA/IFwicGFzc2FibGVcIiA6IHZvaWQgMCB9ID0gb3B0aW9ucztcbiAgY29uc3Qgc3RyaW5nTWV0aG9kR3VhcmRzID0ge307XG4gIGNvbnN0IHN5bWJvbE1ldGhvZEd1YXJkc0VudHJpZXMgPSBbXTtcbiAgZm9yIChjb25zdCBrZXkgb2Ygb3duS2V5czE3KG1ldGhvZEd1YXJkcykpIHtcbiAgICBjb25zdCB2YWx1ZSA9IG1ldGhvZEd1YXJkc1tcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAga2V5XG4gICAgXTtcbiAgICBpZiAodHlwZW9mIGtleSA9PT0gXCJzeW1ib2xcIikge1xuICAgICAgc3ltYm9sTWV0aG9kR3VhcmRzRW50cmllcy5wdXNoKFtrZXksIHZhbHVlXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0cmluZ01ldGhvZEd1YXJkc1trZXldID0gdmFsdWU7XG4gICAgfVxuICB9XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VUYWdnZWQoXCJndWFyZDppbnRlcmZhY2VHdWFyZFwiLCB7XG4gICAgaW50ZXJmYWNlTmFtZSxcbiAgICBtZXRob2RHdWFyZHM6IHN0cmluZ01ldGhvZEd1YXJkcyxcbiAgICAuLi4oc3ltYm9sTWV0aG9kR3VhcmRzRW50cmllcy5sZW5ndGg/IHsgc3ltYm9sTWV0aG9kR3VhcmRzOiBtYWtlQ29weU1hcChzeW1ib2xNZXRob2RHdWFyZHNFbnRyaWVzKSB9IDoge30pLFxuICAgIGRlZmF1bHRHdWFyZHNcbiAgfSk7XG4gIGFzc2VydEludGVyZmFjZUd1YXJkKHJlc3VsdCk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICByZXN1bHRcbiAgKTtcbn07XG52YXIgR3VhcmRQYXlsb2FkU2hhcGVzID0gaGFyZGVuKHtcbiAgXCJndWFyZDphd2FpdEFyZ0d1YXJkXCI6IEF3YWl0QXJnR3VhcmRQYXlsb2FkU2hhcGUsXG4gIFwiZ3VhcmQ6cmF3R3VhcmRcIjogUmF3R3VhcmRQYXlsb2FkU2hhcGUsXG4gIFwiZ3VhcmQ6bWV0aG9kR3VhcmRcIjogTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUsXG4gIFwiZ3VhcmQ6aW50ZXJmYWNlR3VhcmRcIjogSW50ZXJmYWNlR3VhcmRQYXlsb2FkU2hhcGVcbn0pO1xuXG4vL1xudmFyIExlZ2FjeUF3YWl0QXJnR3VhcmRTaGFwZSA9IGhhcmRlbih7XG4gIGtsYXNzOiBcImF3YWl0QXJnXCIsXG4gIGFyZ0d1YXJkOiBNLnBhdHRlcm4oKVxufSk7XG52YXIgZ2V0QXdhaXRBcmdHdWFyZFBheWxvYWQgPSAoYXdhaXRBcmdHdWFyZCkgPT4ge1xuICBpZiAobWF0Y2hlcyhhd2FpdEFyZ0d1YXJkLCBMZWdhY3lBd2FpdEFyZ0d1YXJkU2hhcGUpKSB7XG4gICAgY29uc3QgeyBrbGFzczogXywgLi4ucGF5bG9hZCB9ID0gYXdhaXRBcmdHdWFyZDtcbiAgICByZXR1cm4gcGF5bG9hZDtcbiAgfVxuICBhc3NlcnRBd2FpdEFyZ0d1YXJkKGF3YWl0QXJnR3VhcmQpO1xuICByZXR1cm4gYXdhaXRBcmdHdWFyZC5wYXlsb2FkO1xufTtcbmhhcmRlbihnZXRBd2FpdEFyZ0d1YXJkUGF5bG9hZCk7XG52YXIgTGVnYWN5U3luY01ldGhvZEd1YXJkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAga2xhc3M6IFwibWV0aG9kR3VhcmRcIixcbiAgICBjYWxsS2luZDogXCJzeW5jXCIsXG4gICAgYXJnR3VhcmRzOiBTeW5jVmFsdWVHdWFyZExpc3RTaGFwZSxcbiAgICByZXR1cm5HdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxuICB9LFxuICB7XG4gICAgb3B0aW9uYWxBcmdHdWFyZHM6IFN5bmNWYWx1ZUd1YXJkTGlzdFNoYXBlLFxuICAgIHJlc3RBcmdHdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxuICB9XG4pO1xudmFyIExlZ2FjeUFyZ0d1YXJkU2hhcGUgPSBNLm9yKFxuICBSYXdHdWFyZFNoYXBlLFxuICBBd2FpdEFyZ0d1YXJkU2hhcGUsXG4gIExlZ2FjeUF3YWl0QXJnR3VhcmRTaGFwZSxcbiAgTS5wYXR0ZXJuKClcbik7XG52YXIgTGVnYWN5QXJnR3VhcmRMaXN0U2hhcGUgPSBNLmFycmF5T2YoTGVnYWN5QXJnR3VhcmRTaGFwZSk7XG52YXIgTGVnYWN5QXN5bmNNZXRob2RHdWFyZFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGtsYXNzOiBcIm1ldGhvZEd1YXJkXCIsXG4gICAgY2FsbEtpbmQ6IFwiYXN5bmNcIixcbiAgICBhcmdHdWFyZHM6IExlZ2FjeUFyZ0d1YXJkTGlzdFNoYXBlLFxuICAgIHJldHVybkd1YXJkOiBTeW5jVmFsdWVHdWFyZFNoYXBlXG4gIH0sXG4gIHtcbiAgICBvcHRpb25hbEFyZ0d1YXJkczogQXJnR3VhcmRMaXN0U2hhcGUsXG4gICAgcmVzdEFyZ0d1YXJkOiBTeW5jVmFsdWVHdWFyZFNoYXBlXG4gIH1cbik7XG52YXIgTGVnYWN5TWV0aG9kR3VhcmRTaGFwZSA9IE0ub3IoXG4gIExlZ2FjeVN5bmNNZXRob2RHdWFyZFNoYXBlLFxuICBMZWdhY3lBc3luY01ldGhvZEd1YXJkU2hhcGVcbik7XG52YXIgYWRhcHRMZWdhY3lBcmdHdWFyZCA9IChhcmdHdWFyZCkgPT4gbWF0Y2hlcyhhcmdHdWFyZCwgTGVnYWN5QXdhaXRBcmdHdWFyZFNoYXBlKSA/IE0uYXdhaXQoZ2V0QXdhaXRBcmdHdWFyZFBheWxvYWQoYXJnR3VhcmQpLmFyZ0d1YXJkKSA6IGFyZ0d1YXJkO1xudmFyIGdldE1ldGhvZEd1YXJkUGF5bG9hZCA9IChtZXRob2RHdWFyZCkgPT4ge1xuICBpZiAobWF0Y2hlcyhtZXRob2RHdWFyZCwgTWV0aG9kR3VhcmRTaGFwZSkpIHtcbiAgICByZXR1cm4gbWV0aG9kR3VhcmQucGF5bG9hZDtcbiAgfVxuICBtdXN0TWF0Y2gobWV0aG9kR3VhcmQsIExlZ2FjeU1ldGhvZEd1YXJkU2hhcGUsIFwibGVnYWN5TWV0aG9kR3VhcmRcIik7XG4gIGNvbnN0IHtcbiAgICAvL1xuICAgIGtsYXNzOiBfLFxuICAgIC8vXG4gICAgY2FsbEtpbmQsXG4gICAgLy9cbiAgICByZXR1cm5HdWFyZCxcbiAgICAvL1xuICAgIHJlc3RBcmdHdWFyZFxuICB9ID0gbWV0aG9kR3VhcmQ7XG4gIGxldCB7XG4gICAgLy9cbiAgICBhcmdHdWFyZHMsXG4gICAgLy9cbiAgICBvcHRpb25hbEFyZ0d1YXJkc1xuICB9ID0gbWV0aG9kR3VhcmQ7XG4gIGlmIChjYWxsS2luZCA9PT0gXCJhc3luY1wiKSB7XG4gICAgYXJnR3VhcmRzID0gYXJnR3VhcmRzLm1hcChhZGFwdExlZ2FjeUFyZ0d1YXJkKTtcbiAgICBvcHRpb25hbEFyZ0d1YXJkcyA9IG9wdGlvbmFsQXJnR3VhcmRzICYmIG9wdGlvbmFsQXJnR3VhcmRzLm1hcChhZGFwdExlZ2FjeUFyZ0d1YXJkKTtcbiAgfVxuICBjb25zdCBwYXlsb2FkID0gaGFyZGVuKHtcbiAgICBjYWxsS2luZCxcbiAgICBhcmdHdWFyZHMsXG4gICAgb3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgcmVzdEFyZ0d1YXJkLFxuICAgIHJldHVybkd1YXJkXG4gIH0pO1xuICBtdXN0TWF0Y2gocGF5bG9hZCwgTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUsIFwiaW50ZXJuYWxNZXRob2RHdWFyZEFkYXB0b3JcIik7XG4gIHJldHVybiBwYXlsb2FkO1xufTtcbmhhcmRlbihnZXRNZXRob2RHdWFyZFBheWxvYWQpO1xudmFyIExlZ2FjeUludGVyZmFjZUd1YXJkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAga2xhc3M6IFwiSW50ZXJmYWNlXCIsXG4gICAgaW50ZXJmYWNlTmFtZTogTS5zdHJpbmcoKSxcbiAgICBtZXRob2RHdWFyZHM6IE0ucmVjb3JkT2YoXG4gICAgICBNLnN0cmluZygpLFxuICAgICAgTS5vcihNZXRob2RHdWFyZFNoYXBlLCBMZWdhY3lNZXRob2RHdWFyZFNoYXBlKVxuICAgIClcbiAgfSxcbiAge1xuICAgIGRlZmF1bHRHdWFyZHM6IE0ub3IoTS51bmRlZmluZWQoKSwgXCJwYXNzYWJsZVwiLCBcInJhd1wiKSxcbiAgICBzbG9wcHk6IE0uYm9vbGVhbigpLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIHN5bWJvbE1ldGhvZEd1YXJkczogTS5tYXBPZihNLnN5bWJvbCgpLCBNZXRob2RHdWFyZFNoYXBlKVxuICB9XG4pO1xudmFyIGFkYXB0TWV0aG9kR3VhcmQgPSAobWV0aG9kR3VhcmQpID0+IHtcbiAgaWYgKG1hdGNoZXMobWV0aG9kR3VhcmQsIExlZ2FjeU1ldGhvZEd1YXJkU2hhcGUpKSB7XG4gICAgY29uc3Qge1xuICAgICAgY2FsbEtpbmQsXG4gICAgICBhcmdHdWFyZHMsXG4gICAgICBvcHRpb25hbEFyZ0d1YXJkcyA9IFtdLFxuICAgICAgcmVzdEFyZ0d1YXJkID0gTS5hbnkoKSxcbiAgICAgIHJldHVybkd1YXJkXG4gICAgfSA9IGdldE1ldGhvZEd1YXJkUGF5bG9hZChtZXRob2RHdWFyZCk7XG4gICAgY29uc3QgbUNhbGwgPSBjYWxsS2luZCA9PT0gXCJzeW5jXCIgPyBNLmNhbGwgOiBNLmNhbGxXaGVuO1xuICAgIHJldHVybiBtQ2FsbCguLi5hcmdHdWFyZHMpLm9wdGlvbmFsKC4uLm9wdGlvbmFsQXJnR3VhcmRzKS5yZXN0KHJlc3RBcmdHdWFyZCkucmV0dXJucyhyZXR1cm5HdWFyZCk7XG4gIH1cbiAgcmV0dXJuIG1ldGhvZEd1YXJkO1xufTtcbnZhciBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQgPSAoaW50ZXJmYWNlR3VhcmQpID0+IHtcbiAgaWYgKG1hdGNoZXMoaW50ZXJmYWNlR3VhcmQsIEludGVyZmFjZUd1YXJkU2hhcGUpKSB7XG4gICAgcmV0dXJuIGludGVyZmFjZUd1YXJkLnBheWxvYWQ7XG4gIH1cbiAgbXVzdE1hdGNoKGludGVyZmFjZUd1YXJkLCBMZWdhY3lJbnRlcmZhY2VHdWFyZFNoYXBlLCBcImxlZ2FjeUludGVyZmFjZUd1YXJkXCIpO1xuICBsZXQgeyBrbGFzczogXywgaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCAuLi5yZXN0IH0gPSBpbnRlcmZhY2VHdWFyZDtcbiAgbWV0aG9kR3VhcmRzID0gb2JqZWN0TWFwKG1ldGhvZEd1YXJkcywgYWRhcHRNZXRob2RHdWFyZCk7XG4gIGNvbnN0IHBheWxvYWQgPSBoYXJkZW4oe1xuICAgIGludGVyZmFjZU5hbWUsXG4gICAgbWV0aG9kR3VhcmRzLFxuICAgIC4uLnJlc3RcbiAgfSk7XG4gIG11c3RNYXRjaChcbiAgICBwYXlsb2FkLFxuICAgIEludGVyZmFjZUd1YXJkUGF5bG9hZFNoYXBlLFxuICAgIFwiaW50ZXJuYWxJbnRlcmZhY2VHdWFyZEFkYXB0b3JcIlxuICApO1xuICByZXR1cm4gcGF5bG9hZDtcbn07XG5oYXJkZW4oZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKTtcbnZhciBlbXB0eUNvcHlNYXAgPSBtYWtlQ29weU1hcChbXSk7XG52YXIgZ2V0SW50ZXJmYWNlTWV0aG9kS2V5cyA9IChpbnRlcmZhY2VHdWFyZCkgPT4ge1xuICBjb25zdCB7IG1ldGhvZEd1YXJkcywgc3ltYm9sTWV0aG9kR3VhcmRzID0gZW1wdHlDb3B5TWFwIH0gPSBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoaW50ZXJmYWNlR3VhcmQpO1xuICByZXR1cm4gaGFyZGVuKFtcbiAgICAuLi5SZWZsZWN0Lm93bktleXMobWV0aG9kR3VhcmRzKSxcbiAgICAuLi5nZXRDb3B5TWFwS2V5cyhzeW1ib2xNZXRob2RHdWFyZHMpXG4gIF0pO1xufTtcbmhhcmRlbihnZXRJbnRlcmZhY2VNZXRob2RLZXlzKTtcblxuLy9cbnZhciBtYWtlV2Vha1NldFN0b3JlTWV0aG9kcyA9IChqc3NldCwgYXNzZXJ0S2V5T2tUb0FkZCwgYXNzZXJ0S2V5T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgYXNzZXJ0S2V5RXhpc3RzID0gKGtleSkgPT4ganNzZXQuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGtleU5hbWUpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIGpzc2V0LmhhcyhrZXkpO1xuICAgIH0sXG4gICAgYWRkOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlPa1RvQWRkKGtleSk7XG4gICAgICBqc3NldC5hZGQoa2V5KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBpZiAoYXNzZXJ0S2V5T2tUb0RlbGV0ZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgIGFzc2VydEtleU9rVG9EZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICAgIGpzc2V0LmRlbGV0ZShrZXkpO1xuICAgIH0sXG4gICAgYWRkQWxsOiAoa2V5czQpID0+IHtcbiAgICAgIGlmICh0eXBlb2Yga2V5czRbU3ltYm9sLml0ZXJhdG9yXSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGlmIChPYmplY3QuaXNGcm96ZW4oa2V5czQpICYmIGlzQ29weVNldChrZXlzNCkpIHtcbiAgICAgICAgICBrZXlzNCA9IGdldENvcHlTZXRLZXlzKGtleXM0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvd1JlZGFjdGVkYHByb3ZpZGVkIGRhdGEgc291cmNlIGlzIG5vdCBpdGVyYWJsZTogJHtrZXlzNH1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKFxuICAgICAgICBjb25zdCBrZXkgb2ZcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAga2V5czRcbiAgICAgICkge1xuICAgICAgICBhc3NlcnRLZXlPa1RvQWRkKGtleSk7XG4gICAgICAgIGpzc2V0LmFkZChrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJXZWFrU2V0U3RvcmUgPSAodGFnID0gXCJrZXlcIiwgeyBsb25nTGl2ZWQgPSB0cnVlLCBrZXlTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNzZXQgPSBuZXcgKGxvbmdMaXZlZCA/IFdlYWtTZXQgOiBTZXQpKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S2V5T2tUb0FkZCA9IChrZXkpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBwYXNzU3R5bGVPZihrZXkpID09PSBcInJlbW90YWJsZVwiIHx8IHRocm93UmVkYWN0ZWRgT25seSByZW1vdGFibGVzIGNhbiBiZSBrZXlzIG9mIHNjYWxhciBXZWFrU3RvcmVzOiAke2tleX1gO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJ3ZWFrU2V0U3RvcmUga2V5XCIpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIEZhcihgc2NhbGFyIFdlYWtTZXRTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VXZWFrU2V0U3RvcmVNZXRob2RzKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCB2b2lkIDAsIHRhZylcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJXZWFrU2V0U3RvcmUpO1xuXG4vL1xudmFyIG1ha2VDdXJyZW50S2V5c0tpdCA9IChnZXRSYXdLZXlzLCBjaGVja0hhcywgY29tcGFyZSwgYXNzZXJ0T2tUb0FkZCwgYXNzZXJ0T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgbGV0IHVwZGF0ZUNvdW50ID0gMDtcbiAgbGV0IHNvcnRlZEtleXNNZW1vO1xuICBjb25zdCBhc3NlcnRVcGRhdGVPbkFkZCA9IChrLCB2MyA9IHZvaWQgMCkgPT4ge1xuICAgIGFzc2VydE9rVG9BZGQoaywgdjMpO1xuICAgIHVwZGF0ZUNvdW50ICs9IDE7XG4gICAgc29ydGVkS2V5c01lbW8gPSB2b2lkIDA7XG4gIH07XG4gIGNvbnN0IGFzc2VydFVwZGF0ZU9uRGVsZXRlID0gKGspID0+IGFzc2VydE9rVG9EZWxldGUgJiYgYXNzZXJ0T2tUb0RlbGV0ZShrKTtcbiAgY29uc3QgZ2V0U29ydGVkS2V5cyA9ICgpID0+IHtcbiAgICBpZiAoc29ydGVkS2V5c01lbW8gPT09IHZvaWQgMCkge1xuICAgICAgc29ydGVkS2V5c01lbW8gPSBoYXJkZW4oWy4uLmdldFJhd0tleXMoKV0uc29ydChjb21wYXJlKSk7XG4gICAgfVxuICAgIHJldHVybiBzb3J0ZWRLZXlzTWVtbztcbiAgfTtcbiAgY29uc3QgaXRlcmFibGVLZXlzID0gRmFyKFwiSXRlcmFibGUgb2Yga2V5c1wiLCB7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGNvbnN0IGdlbmVyYXRpb24gPSB1cGRhdGVDb3VudDtcbiAgICAgIGdldFNvcnRlZEtleXMoKTtcbiAgICAgIGNvbnN0IGxlbiA9IHNvcnRlZEtleXNNZW1vLmxlbmd0aDtcbiAgICAgIGxldCBpMiA9IDA7XG4gICAgICByZXR1cm4gRmFyKFwiSXRlcmF0b3Igb2Yga2V5c1wiLCB7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBnZW5lcmF0aW9uID09PSB1cGRhdGVDb3VudCB8fCB0aHJvd1JlZGFjdGVkYFN0b3JlICR7cXVvdGUoa2V5TmFtZSl9IGN1cnNvciBzdGFsZWA7XG4gICAgICAgICAgZm9yICg7IDsgKSB7XG4gICAgICAgICAgICBpZiAoaTIgPCBsZW4pIHtcbiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBzb3J0ZWRLZXlzTWVtb1tpMl07XG4gICAgICAgICAgICAgIGkyICs9IDE7XG4gICAgICAgICAgICAgIGlmIChjaGVja0hhcyh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHZvaWQgMCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGFzc2VydFVwZGF0ZU9uQWRkLFxuICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgIGl0ZXJhYmxlS2V5c1xuICB9KTtcbn07XG5oYXJkZW4obWFrZUN1cnJlbnRLZXlzS2l0KTtcbnZhciBwcm92aWRlTGF6eSA9IChtYXBTdG9yZSwga2V5LCBtYWtlVmFsdWUpID0+IHtcbiAgaWYgKCFtYXBTdG9yZS5oYXMoa2V5KSkge1xuICAgIG1hcFN0b3JlLmluaXQoa2V5LCBtYWtlVmFsdWUoa2V5KSk7XG4gIH1cbiAgcmV0dXJuIG1hcFN0b3JlLmdldChrZXkpO1xufTtcbmhhcmRlbihwcm92aWRlTGF6eSk7XG52YXIgbWFrZUF0b21pY1Byb3ZpZGVyID0gKHN0b3JlKSA9PiB7XG4gIGNvbnN0IHBlbmRpbmcgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBjb25zdCBwcm92aWRlQXN5bmMgPSAoa2V5LCBtYWtlVmFsdWUsIGZpbmlzaFZhbHVlKSA9PiB7XG4gICAgaWYgKHN0b3JlLmhhcyhrZXkpKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHN0b3JlLmdldChrZXkpKTtcbiAgICB9XG4gICAgaWYgKCFwZW5kaW5nLmhhcyhrZXkpKSB7XG4gICAgICBjb25zdCB2YWxQMiA9IG1ha2VWYWx1ZShrZXkpLnRoZW4oKHYzKSA9PiB7XG4gICAgICAgIHN0b3JlLmluaXQoa2V5LCB2Myk7XG4gICAgICAgIHJldHVybiB2MztcbiAgICAgIH0pLnRoZW4oKHYzKSA9PiB7XG4gICAgICAgIGlmIChmaW5pc2hWYWx1ZSkge1xuICAgICAgICAgIHJldHVybiBmaW5pc2hWYWx1ZShrZXksIHYzKS50aGVuKCgpID0+IHYzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdjM7XG4gICAgICB9KS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgcGVuZGluZy5kZWxldGUoa2V5KTtcbiAgICAgIH0pO1xuICAgICAgcGVuZGluZy5zZXQoa2V5LCB2YWxQMik7XG4gICAgfVxuICAgIGNvbnN0IHZhbFAgPSBwZW5kaW5nLmdldChrZXkpO1xuICAgIGFzc2VydCh2YWxQKTtcbiAgICByZXR1cm4gdmFsUDtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IHByb3ZpZGVBc3luYyB9KTtcbn07XG5oYXJkZW4obWFrZUF0b21pY1Byb3ZpZGVyKTtcbnZhciBhcHBlbmRUb1N0b3JlZEFycmF5ID0gKG1hcFN0b3JlLCBrZXksIGl0ZW0pID0+IHtcbiAgaWYgKG1hcFN0b3JlLmhhcyhrZXkpKSB7XG4gICAgY29uc3QgZXh0YW50ID0gbWFwU3RvcmUuZ2V0KGtleSk7XG4gICAgbWFwU3RvcmUuc2V0KGtleSwgaGFyZGVuKFsuLi5leHRhbnQsIGl0ZW1dKSk7XG4gIH0gZWxzZSB7XG4gICAgbWFwU3RvcmUuaW5pdChrZXksIGhhcmRlbihbaXRlbV0pKTtcbiAgfVxufTtcbmhhcmRlbihhcHBlbmRUb1N0b3JlZEFycmF5KTtcblxuLy9cbnZhciBtYWtlU2V0U3RvcmVNZXRob2RzID0gKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCB7IGFzc2VydFVwZGF0ZU9uQWRkLCBhc3NlcnRVcGRhdGVPbkRlbGV0ZSwgaXRlcmFibGVLZXlzIH0gPSBtYWtlQ3VycmVudEtleXNLaXQoXG4gICAgKCkgPT4ganNzZXQua2V5cygpLFxuICAgIChrKSA9PiBqc3NldC5oYXMoayksXG4gICAgY29tcGFyZVJhbmssXG4gICAgYXNzZXJ0S2V5T2tUb0FkZCxcbiAgICBhc3NlcnRLZXlPa1RvRGVsZXRlLFxuICAgIGtleU5hbWVcbiAgKTtcbiAgY29uc3Qga2V5czQgPSAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwID8gaXRlcmFibGVLZXlzIDogZmlsdGVySXRlcmFibGUoaXRlcmFibGVLZXlzLCAoaykgPT4gbWF0Y2hlcyhrLCBrZXlQYXR0KSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIC4uLm1ha2VXZWFrU2V0U3RvcmVNZXRob2RzKFxuICAgICAganNzZXQsXG4gICAgICBhc3NlcnRVcGRhdGVPbkFkZCxcbiAgICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgICAga2V5TmFtZVxuICAgICksXG4gICAga2V5czoga2V5czQsXG4gICAgdmFsdWVzOiBrZXlzNCxcbiAgICBzbmFwc2hvdDogKGtleVBhdHQgPSB2b2lkIDApID0+IG1ha2VDb3B5U2V0KGtleXM0KGtleVBhdHQpKSxcbiAgICBnZXRTaXplOiAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwID8ganNzZXQuc2l6ZSA6IFsuLi5rZXlzNChrZXlQYXR0KV0ubGVuZ3RoLFxuICAgIGNsZWFyOiAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgICBqc3NldC5jbGVhcigpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5czQoa2V5UGF0dCkpIHtcbiAgICAgICAganNzZXQuZGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhclNldFN0b3JlID0gKHRhZyA9IFwia2V5XCIsIHsga2V5U2hhcGUgPSB2b2lkIDAgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGpzc2V0ID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGtleVNoYXBlKTtcbiAgfVxuICBjb25zdCBhc3NlcnRLZXlPa1RvQWRkID0gKGtleSkgPT4ge1xuICAgIGhhcmRlbihrZXkpO1xuICAgIGFzc2VydFNjYWxhcktleShrZXkpO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJzZXRTdG9yZSBrZXlcIik7XG4gICAgfVxuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgU2V0U3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlU2V0U3RvcmVNZXRob2RzKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCB2b2lkIDAsIHRhZylcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJTZXRTdG9yZSk7XG5cbi8vXG52YXIgbWFrZVdlYWtNYXBTdG9yZU1ldGhvZHMgPSAoanNtYXAsIGFzc2VydEtWT2tUb0FkZCwgYXNzZXJ0S1ZPa1RvU2V0LCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCBhc3NlcnRLZXlEb2VzTm90RXhpc3QgPSAoa2V5KSA9PiAhanNtYXAuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGtleU5hbWUpfSBhbHJlYWR5IHJlZ2lzdGVyZWQ6ICR7a2V5fWA7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IGpzbWFwLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShrZXlOYW1lKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiBqc21hcC5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAgICAgICAgICAgICovXG4gICAgICAgIGpzbWFwLmdldChrZXkpXG4gICAgICApO1xuICAgIH0sXG4gICAgaW5pdDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleURvZXNOb3RFeGlzdChrZXkpO1xuICAgICAgYXNzZXJ0S1ZPa1RvQWRkKGtleSwgdmFsdWUpO1xuICAgICAganNtYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgc2V0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBhc3NlcnRLVk9rVG9TZXQoa2V5LCB2YWx1ZSk7XG4gICAgICBqc21hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgaWYgKGFzc2VydEtleU9rVG9EZWxldGUgIT09IHZvaWQgMCkge1xuICAgICAgICBhc3NlcnRLZXlPa1RvRGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgICBqc21hcC5kZWxldGUoa2V5KTtcbiAgICB9LFxuICAgIGFkZEFsbDogKGVudHJpZXMxMCkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBlbnRyaWVzMTBbU3ltYm9sLml0ZXJhdG9yXSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGlmIChPYmplY3QuaXNGcm96ZW4oZW50cmllczEwKSAmJiBpc0NvcHlNYXAoZW50cmllczEwKSkge1xuICAgICAgICAgIGVudHJpZXMxMCA9IGdldENvcHlNYXBFbnRyaWVzKGVudHJpZXMxMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3dSZWRhY3RlZGBwcm92aWRlZCBkYXRhIHNvdXJjZSBpcyBub3QgaXRlcmFibGU6ICR7ZW50cmllczEwfWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoXG4gICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSBvZlxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGVudHJpZXMxMFxuICAgICAgKSB7XG4gICAgICAgIGFzc2VydEtWT2tUb0FkZChrZXksIHZhbHVlKTtcbiAgICAgICAganNtYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJXZWFrTWFwU3RvcmUgPSAodGFnID0gXCJrZXlcIiwgeyBsb25nTGl2ZWQgPSB0cnVlLCBrZXlTaGFwZSA9IHZvaWQgMCwgdmFsdWVTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNtYXAgPSBuZXcgKGxvbmdMaXZlZCA/IFdlYWtNYXAgOiBNYXApKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4odmFsdWVTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S1ZPa1RvU2V0ID0gKF9rZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKHZhbHVlKTtcbiAgICBhc3NlcnRQYXNzYWJsZSh2YWx1ZSk7XG4gICAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKHZhbHVlLCB2YWx1ZVNoYXBlLCBcIndlYWtNYXBTdG9yZSB2YWx1ZVwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydEtWT2tUb0FkZCA9IChrZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgcGFzc1N0eWxlT2Yoa2V5KSA9PT0gXCJyZW1vdGFibGVcIiB8fCB0aHJvd1JlZGFjdGVkYE9ubHkgcmVtb3RhYmxlcyBjYW4gYmUga2V5cyBvZiBzY2FsYXIgV2Vha01hcFN0b3JlczogJHtrZXl9YDtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwid2Vha01hcFN0b3JlIGtleVwiKTtcbiAgICB9XG4gICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgV2Vha01hcFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZVdlYWtNYXBTdG9yZU1ldGhvZHMoXG4gICAgICBqc21hcCxcbiAgICAgIGFzc2VydEtWT2tUb0FkZCxcbiAgICAgIGFzc2VydEtWT2tUb1NldCxcbiAgICAgIHZvaWQgMCxcbiAgICAgIHRhZ1xuICAgIClcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJXZWFrTWFwU3RvcmUpO1xuXG4vL1xudmFyIG1ha2VNYXBTdG9yZU1ldGhvZHMgPSAoanNtYXAsIGFzc2VydEtWT2tUb0FkZCwgYXNzZXJ0S1ZPa1RvU2V0LCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCB0YWcgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IHsgYXNzZXJ0VXBkYXRlT25BZGQsIGFzc2VydFVwZGF0ZU9uRGVsZXRlLCBpdGVyYWJsZUtleXMgfSA9IG1ha2VDdXJyZW50S2V5c0tpdChcbiAgICAoKSA9PiBqc21hcC5rZXlzKCksXG4gICAgKGspID0+IGpzbWFwLmhhcyhrKSxcbiAgICBjb21wYXJlUmFuayxcbiAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZSxcbiAgICB0YWdcbiAgKTtcbiAgY29uc3Qga2V5czQgPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiB7XG4gICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCAmJiB2YWx1ZVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGl0ZXJhYmxlS2V5cztcbiAgICB9XG4gICAgY29uc3QgZmlsdGVyID0gKGspID0+IHtcbiAgICAgIGlmIChrZXlQYXR0ICE9PSB2b2lkIDAgJiYgIW1hdGNoZXMoaywga2V5UGF0dCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKHZhbHVlUGF0dCAhPT0gdm9pZCAwICYmICFtYXRjaGVzKGpzbWFwLmdldChrKSwgdmFsdWVQYXR0KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIHJldHVybiBmaWx0ZXJJdGVyYWJsZShpdGVyYWJsZUtleXMsIGZpbHRlcik7XG4gIH07XG4gIGNvbnN0IHZhbHVlczYgPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBtYXBJdGVyYWJsZShrZXlzNChrZXlQYXR0LCB2YWx1ZVBhdHQpLCAoaykgPT4gKFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICBqc21hcC5nZXQoaylcbiAgKSk7XG4gIGNvbnN0IGVudHJpZXMxMCA9IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IG1hcEl0ZXJhYmxlKGtleXM0KGtleVBhdHQsIHZhbHVlUGF0dCksIChrKSA9PiBbXG4gICAgayxcbiAgICAvKiAgICAgICAgICAgICovXG4gICAganNtYXAuZ2V0KGspXG4gIF0pO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICAuLi5tYWtlV2Vha01hcFN0b3JlTWV0aG9kcyhcbiAgICAgIGpzbWFwLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGFzc2VydFVwZGF0ZU9uQWRkLFxuICAgICAgYXNzZXJ0S1ZPa1RvU2V0LFxuICAgICAgYXNzZXJ0VXBkYXRlT25EZWxldGUsXG4gICAgICB0YWdcbiAgICApLFxuICAgIGtleXM6IGtleXM0LFxuICAgIHZhbHVlczogdmFsdWVzNixcbiAgICBlbnRyaWVzOiBlbnRyaWVzMTAsXG4gICAgc25hcHNob3Q6IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IG1ha2VDb3B5TWFwKGVudHJpZXMxMChrZXlQYXR0LCB2YWx1ZVBhdHQpKSxcbiAgICBnZXRTaXplOiAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBrZXlQYXR0ID09PSB2b2lkIDAgJiYgdmFsdWVQYXR0ID09PSB2b2lkIDAgPyBqc21hcC5zaXplIDogWy4uLmtleXM0KGtleVBhdHQsIHZhbHVlUGF0dCldLmxlbmd0aCxcbiAgICBjbGVhcjogKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCAmJiB2YWx1ZVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgICBqc21hcC5jbGVhcigpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5czQoa2V5UGF0dCwgdmFsdWVQYXR0KSkge1xuICAgICAgICBqc21hcC5kZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBtYWtlU2NhbGFyTWFwU3RvcmUgPSAodGFnID0gXCJrZXlcIiwgeyBrZXlTaGFwZSA9IHZvaWQgMCwgdmFsdWVTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNtYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oa2V5U2hhcGUpO1xuICB9XG4gIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKHZhbHVlU2hhcGUpO1xuICB9XG4gIGNvbnN0IGFzc2VydEtWT2tUb1NldCA9IChfa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGhhcmRlbih2YWx1ZSk7XG4gICAgYXNzZXJ0UGFzc2FibGUodmFsdWUpO1xuICAgIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaCh2YWx1ZSwgdmFsdWVTaGFwZSwgXCJtYXBTdG9yZSB2YWx1ZVwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydEtWT2tUb0FkZCA9IChrZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgYXNzZXJ0U2NhbGFyS2V5KGtleSk7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcIm1hcFN0b3JlIGtleVwiKTtcbiAgICB9XG4gICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgTWFwU3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlTWFwU3RvcmVNZXRob2RzKFxuICAgICAganNtYXAsXG4gICAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgICBhc3NlcnRLVk9rVG9TZXQsXG4gICAgICB2b2lkIDAsXG4gICAgICB0YWdcbiAgICApXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyTWFwU3RvcmUpO1xuXG4vL1xudmFyIEdFVF9JTlRFUkZBQ0VfR1VBUkQgPSBcIl9fZ2V0SW50ZXJmYWNlR3VhcmRfX1wiO1xuXG4vL1xudmFyIHsgYXBwbHk6IGFwcGx5NCwgb3duS2V5czogb3duS2V5czE4IH0gPSBSZWZsZWN0O1xudmFyIHsgZGVmaW5lUHJvcGVydGllczogZGVmaW5lUHJvcGVydGllczMsIGZyb21FbnRyaWVzOiBmcm9tRW50cmllczggfSA9IE9iamVjdDtcbnZhciBSYXdNZXRob2RHdWFyZCA9IE0uY2FsbCgpLnJlc3QoTS5yYXcoKSkucmV0dXJucyhNLnJhdygpKTtcbnZhciBSRURBQ1RFRF9SQVdfQVJHID0gXCI8cmVkYWN0ZWQgcmF3IGFyZz5cIjtcbnZhciBQYXNzYWJsZU1ldGhvZEd1YXJkID0gTS5jYWxsKCkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpO1xudmFyIGRlZmVuZFN5bmNBcmdzID0gKHN5bmNBcmdzLCBtYXRjaENvbmZpZywgbGFiZWwgPSB2b2lkIDApID0+IHtcbiAgY29uc3Qge1xuICAgIGRlY2xhcmVkTGVuLFxuICAgIGhhc1Jlc3RBcmdHdWFyZCxcbiAgICByZXN0QXJnR3VhcmRJc1JhdyxcbiAgICBwYXJhbXNQYXR0ZXJuLFxuICAgIHJlZGFjdGVkSW5kaWNlc1xuICB9ID0gbWF0Y2hDb25maWc7XG4gIGxldCBtYXRjaGFibGVBcmdzID0gc3luY0FyZ3M7XG4gIGlmIChyZXN0QXJnR3VhcmRJc1JhdyAmJiBzeW5jQXJncy5sZW5ndGggPiBkZWNsYXJlZExlbikge1xuICAgIGNvbnN0IHJlc3RMZW4gPSBzeW5jQXJncy5sZW5ndGggLSBkZWNsYXJlZExlbjtcbiAgICBjb25zdCByZWRhY3RlZFJlc3QgPSBBcnJheShyZXN0TGVuKS5maWxsKFJFREFDVEVEX1JBV19BUkcpO1xuICAgIG1hdGNoYWJsZUFyZ3MgPSBbLi4uc3luY0FyZ3Muc2xpY2UoMCwgZGVjbGFyZWRMZW4pLCAuLi5yZWRhY3RlZFJlc3RdO1xuICB9IGVsc2UgaWYgKHJlZGFjdGVkSW5kaWNlcy5sZW5ndGggPiAwICYmIHJlZGFjdGVkSW5kaWNlc1swXSA8IHN5bmNBcmdzLmxlbmd0aCkge1xuICAgIG1hdGNoYWJsZUFyZ3MgPSBbLi4uc3luY0FyZ3NdO1xuICB9XG4gIGZvciAoY29uc3QgaTIgb2YgcmVkYWN0ZWRJbmRpY2VzKSB7XG4gICAgaWYgKGkyID49IG1hdGNoYWJsZUFyZ3MubGVuZ3RoKSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgbWF0Y2hhYmxlQXJnc1tpMl0gPSBSRURBQ1RFRF9SQVdfQVJHO1xuICB9XG4gIG11c3RNYXRjaChoYXJkZW4obWF0Y2hhYmxlQXJncyksIHBhcmFtc1BhdHRlcm4sIGxhYmVsKTtcbiAgaWYgKGhhc1Jlc3RBcmdHdWFyZCkge1xuICAgIHJldHVybiBzeW5jQXJncztcbiAgfVxuICBzeW5jQXJncy5sZW5ndGggPD0gZGVjbGFyZWRMZW4gfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGxhYmVsKX0gYWNjZXB0cyBhdCBtb3N0ICR7cXVvdGUoZGVjbGFyZWRMZW4pfSBhcmd1bWVudHMsIG5vdCAke3F1b3RlKFxuICAgIHN5bmNBcmdzLmxlbmd0aFxuICApfTogJHtzeW5jQXJnc31gO1xuICByZXR1cm4gc3luY0FyZ3M7XG59O1xudmFyIGJ1aWxkTWF0Y2hDb25maWcgPSAobWV0aG9kR3VhcmRQYXlsb2FkKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBhcmdHdWFyZHMsXG4gICAgb3B0aW9uYWxBcmdHdWFyZHMgPSBbXSxcbiAgICByZXN0QXJnR3VhcmRcbiAgfSA9IG1ldGhvZEd1YXJkUGF5bG9hZDtcbiAgY29uc3QgbWF0Y2hhYmxlQXJnR3VhcmRzID0gWy4uLmFyZ0d1YXJkcywgLi4ub3B0aW9uYWxBcmdHdWFyZHNdO1xuICBjb25zdCByZWRhY3RlZEluZGljZXMgPSBbXTtcbiAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IG1hdGNoYWJsZUFyZ0d1YXJkcy5sZW5ndGg7IGkyICs9IDEpIHtcbiAgICBpZiAoaXNSYXdHdWFyZChtYXRjaGFibGVBcmdHdWFyZHNbaTJdKSkge1xuICAgICAgbWF0Y2hhYmxlQXJnR3VhcmRzW2kyXSA9IFJFREFDVEVEX1JBV19BUkc7XG4gICAgICByZWRhY3RlZEluZGljZXMucHVzaChpMik7XG4gICAgfVxuICB9XG4gIGxldCBtYXRjaGFibGVSZXN0QXJnR3VhcmQgPSByZXN0QXJnR3VhcmQ7XG4gIGlmIChpc1Jhd0d1YXJkKG1hdGNoYWJsZVJlc3RBcmdHdWFyZCkpIHtcbiAgICBtYXRjaGFibGVSZXN0QXJnR3VhcmQgPSBNLmFycmF5T2YoUkVEQUNURURfUkFXX0FSRyk7XG4gIH1cbiAgY29uc3QgbWF0Y2hhYmxlTWV0aG9kR3VhcmRQYXlsb2FkID0gaGFyZGVuKHtcbiAgICAuLi5tZXRob2RHdWFyZFBheWxvYWQsXG4gICAgYXJnR3VhcmRzOiBtYXRjaGFibGVBcmdHdWFyZHMuc2xpY2UoMCwgYXJnR3VhcmRzLmxlbmd0aCksXG4gICAgb3B0aW9uYWxBcmdHdWFyZHM6IG1hdGNoYWJsZUFyZ0d1YXJkcy5zbGljZShhcmdHdWFyZHMubGVuZ3RoKSxcbiAgICByZXN0QXJnR3VhcmQ6IG1hdGNoYWJsZVJlc3RBcmdHdWFyZFxuICB9KTtcbiAgY29uc3QgcGFyYW1zUGF0dGVybiA9IE0uc3BsaXRBcnJheShcbiAgICBtYXRjaGFibGVNZXRob2RHdWFyZFBheWxvYWQuYXJnR3VhcmRzLFxuICAgIG1hdGNoYWJsZU1ldGhvZEd1YXJkUGF5bG9hZC5vcHRpb25hbEFyZ0d1YXJkcyxcbiAgICBtYXRjaGFibGVNZXRob2RHdWFyZFBheWxvYWQucmVzdEFyZ0d1YXJkXG4gICk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGRlY2xhcmVkTGVuOiBtYXRjaGFibGVBcmdHdWFyZHMubGVuZ3RoLFxuICAgIGhhc1Jlc3RBcmdHdWFyZDogcmVzdEFyZ0d1YXJkICE9PSB2b2lkIDAsXG4gICAgcmVzdEFyZ0d1YXJkSXNSYXc6IHJlc3RBcmdHdWFyZCAhPT0gbWF0Y2hhYmxlUmVzdEFyZ0d1YXJkLFxuICAgIHBhcmFtc1BhdHRlcm4sXG4gICAgcmVkYWN0ZWRJbmRpY2VzLFxuICAgIG1hdGNoYWJsZU1ldGhvZEd1YXJkUGF5bG9hZFxuICB9KTtcbn07XG52YXIgZGVmZW5kU3luY01ldGhvZCA9IChnZXRDb250ZXh0LCBiZWhhdmlvck1ldGhvZCwgbWV0aG9kR3VhcmRQYXlsb2FkLCBsYWJlbCkgPT4ge1xuICBjb25zdCB7IHJldHVybkd1YXJkIH0gPSBtZXRob2RHdWFyZFBheWxvYWQ7XG4gIGNvbnN0IGlzUmF3UmV0dXJuID0gaXNSYXdHdWFyZChyZXR1cm5HdWFyZCk7XG4gIGNvbnN0IG1hdGNoQ29uZmlnID0gYnVpbGRNYXRjaENvbmZpZyhtZXRob2RHdWFyZFBheWxvYWQpO1xuICBjb25zdCB7IHN5bmNNZXRob2QgfSA9IHtcbiAgICAvL1xuICAgIHN5bmNNZXRob2QoLi4uc3luY0FyZ3MpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBnZXRDb250ZXh0KHRoaXMpO1xuICAgICAgICBjb25zdCByZWFsQXJncyA9IGRlZmVuZFN5bmNBcmdzKHN5bmNBcmdzLCBtYXRjaENvbmZpZywgbGFiZWwpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhcHBseTQoYmVoYXZpb3JNZXRob2QsIGNvbnRleHQsIHJlYWxBcmdzKTtcbiAgICAgICAgaWYgKCFpc1Jhd1JldHVybikge1xuICAgICAgICAgIG11c3RNYXRjaChoYXJkZW4ocmVzdWx0KSwgcmV0dXJuR3VhcmQsIGAke2xhYmVsfTogcmVzdWx0YCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0gY2F0Y2ggKHRocm93blRoaW5nKSB7XG4gICAgICAgIHRocm93IHRvVGhyb3dhYmxlKHRocm93blRoaW5nKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiBzeW5jTWV0aG9kO1xufTtcbnZhciBkZXN5bmMgPSAobWV0aG9kR3VhcmRQYXlsb2FkKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBhcmdHdWFyZHMsXG4gICAgb3B0aW9uYWxBcmdHdWFyZHMgPSBbXSxcbiAgICByZXN0QXJnR3VhcmRcbiAgfSA9IG1ldGhvZEd1YXJkUGF5bG9hZDtcbiAgIWlzQXdhaXRBcmdHdWFyZChyZXN0QXJnR3VhcmQpIHx8IHRocm93UmVkYWN0ZWRgUmVzdCBhcmdzIG1heSBub3QgYmUgYXdhaXRlZDogJHtyZXN0QXJnR3VhcmR9YDtcbiAgY29uc3QgcmF3QXJnR3VhcmRzID0gWy4uLmFyZ0d1YXJkcywgLi4ub3B0aW9uYWxBcmdHdWFyZHNdO1xuICBjb25zdCBhd2FpdEluZGV4ZXMgPSBbXTtcbiAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IHJhd0FyZ0d1YXJkcy5sZW5ndGg7IGkyICs9IDEpIHtcbiAgICBjb25zdCBhcmdHdWFyZCA9IHJhd0FyZ0d1YXJkc1tpMl07XG4gICAgaWYgKGlzQXdhaXRBcmdHdWFyZChhcmdHdWFyZCkpIHtcbiAgICAgIHJhd0FyZ0d1YXJkc1tpMl0gPSBnZXRBd2FpdEFyZ0d1YXJkUGF5bG9hZChhcmdHdWFyZCkuYXJnR3VhcmQ7XG4gICAgICBhd2FpdEluZGV4ZXMucHVzaChpMik7XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgYXdhaXRJbmRleGVzLFxuICAgIHJhd01ldGhvZEd1YXJkUGF5bG9hZDoge1xuICAgICAgLi4ubWV0aG9kR3VhcmRQYXlsb2FkLFxuICAgICAgYXJnR3VhcmRzOiByYXdBcmdHdWFyZHMuc2xpY2UoMCwgYXJnR3VhcmRzLmxlbmd0aCksXG4gICAgICBvcHRpb25hbEFyZ0d1YXJkczogcmF3QXJnR3VhcmRzLnNsaWNlKGFyZ0d1YXJkcy5sZW5ndGgpXG4gICAgfVxuICB9O1xufTtcbnZhciBkZWZlbmRBc3luY01ldGhvZCA9IChnZXRDb250ZXh0LCBiZWhhdmlvck1ldGhvZCwgbWV0aG9kR3VhcmRQYXlsb2FkLCBsYWJlbCkgPT4ge1xuICBjb25zdCB7IHJldHVybkd1YXJkIH0gPSBtZXRob2RHdWFyZFBheWxvYWQ7XG4gIGNvbnN0IGlzUmF3UmV0dXJuID0gaXNSYXdHdWFyZChyZXR1cm5HdWFyZCk7XG4gIGNvbnN0IHsgYXdhaXRJbmRleGVzLCByYXdNZXRob2RHdWFyZFBheWxvYWQgfSA9IGRlc3luYyhtZXRob2RHdWFyZFBheWxvYWQpO1xuICBjb25zdCBtYXRjaENvbmZpZyA9IGJ1aWxkTWF0Y2hDb25maWcocmF3TWV0aG9kR3VhcmRQYXlsb2FkKTtcbiAgY29uc3QgeyBhc3luY01ldGhvZCB9ID0ge1xuICAgIC8vXG4gICAgYXN5bmNNZXRob2QoLi4uYXJncykge1xuICAgICAgY29uc3QgYXdhaXRMaXN0ID0gW107XG4gICAgICBmb3IgKGNvbnN0IGkyIG9mIGF3YWl0SW5kZXhlcykge1xuICAgICAgICBpZiAoaTIgPj0gYXJncy5sZW5ndGgpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBhd2FpdExpc3QucHVzaChhcmdzW2kyXSk7XG4gICAgICB9XG4gICAgICBjb25zdCBwMyA9IFByb21pc2UuYWxsKGF3YWl0TGlzdCk7XG4gICAgICBjb25zdCBzeW5jQXJncyA9IFsuLi5hcmdzXTtcbiAgICAgIGNvbnN0IHJlc3VsdFAgPSBFLndoZW4oXG4gICAgICAgIHAzLFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgKGF3YWl0ZWRBcmdzKSA9PiB7XG4gICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBhd2FpdGVkQXJncy5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgICAgICAgc3luY0FyZ3NbYXdhaXRJbmRleGVzW2pdXSA9IGF3YWl0ZWRBcmdzW2pdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBjb250ZXh0ID0gZ2V0Q29udGV4dCh0aGlzKTtcbiAgICAgICAgICBjb25zdCByZWFsQXJncyA9IGRlZmVuZFN5bmNBcmdzKHN5bmNBcmdzLCBtYXRjaENvbmZpZywgbGFiZWwpO1xuICAgICAgICAgIHJldHVybiBhcHBseTQoYmVoYXZpb3JNZXRob2QsIGNvbnRleHQsIHJlYWxBcmdzKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiBFLndoZW4ocmVzdWx0UCwgKGZ1bGZpbGxtZW50KSA9PiB7XG4gICAgICAgIGlmICghaXNSYXdSZXR1cm4pIHtcbiAgICAgICAgICBtdXN0TWF0Y2goaGFyZGVuKGZ1bGZpbGxtZW50KSwgcmV0dXJuR3VhcmQsIGAke2xhYmVsfTogcmVzdWx0YCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZ1bGZpbGxtZW50O1xuICAgICAgfSkuY2F0Y2goXG4gICAgICAgIChyZWFzb24pID0+IChcbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vXG4gICAgICAgICAgUHJvbWlzZS5yZWplY3QodG9UaHJvd2FibGUocmVhc29uKSlcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBhc3luY01ldGhvZDtcbn07XG52YXIgZGVmZW5kTWV0aG9kID0gKGdldENvbnRleHQsIGJlaGF2aW9yTWV0aG9kLCBtZXRob2RHdWFyZCwgbGFiZWwpID0+IHtcbiAgY29uc3QgbWV0aG9kR3VhcmRQYXlsb2FkID0gZ2V0TWV0aG9kR3VhcmRQYXlsb2FkKG1ldGhvZEd1YXJkKTtcbiAgY29uc3QgeyBjYWxsS2luZCB9ID0gbWV0aG9kR3VhcmRQYXlsb2FkO1xuICBpZiAoY2FsbEtpbmQgPT09IFwic3luY1wiKSB7XG4gICAgcmV0dXJuIGRlZmVuZFN5bmNNZXRob2QoXG4gICAgICBnZXRDb250ZXh0LFxuICAgICAgYmVoYXZpb3JNZXRob2QsXG4gICAgICBtZXRob2RHdWFyZFBheWxvYWQsXG4gICAgICBsYWJlbFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgYXNzZXJ0KGNhbGxLaW5kID09PSBcImFzeW5jXCIpO1xuICAgIHJldHVybiBkZWZlbmRBc3luY01ldGhvZChcbiAgICAgIGdldENvbnRleHQsXG4gICAgICBiZWhhdmlvck1ldGhvZCxcbiAgICAgIG1ldGhvZEd1YXJkUGF5bG9hZCxcbiAgICAgIGxhYmVsXG4gICAgKTtcbiAgfVxufTtcbnZhciBiaW5kTWV0aG9kID0gKG1ldGhvZFRhZywgY29udGV4dFByb3ZpZGVyLCBiZWhhdmlvck1ldGhvZCwgbWV0aG9kR3VhcmQpID0+IHtcbiAgYXNzZXJ0LnR5cGVvZihiZWhhdmlvck1ldGhvZCwgXCJmdW5jdGlvblwiKTtcbiAgY29uc3QgZ2V0Q29udGV4dCA9IChyZXByZXNlbnRhdGl2ZSkgPT4ge1xuICAgIHJlcHJlc2VudGF0aXZlIHx8IC8vXG4gICAgdGhyb3dSZWRhY3RlZGBNZXRob2QgJHttZXRob2RUYWd9IGNhbGxlZCB3aXRob3V0ICd0aGlzJyBvYmplY3RgO1xuICAgIGNvbnN0IGNvbnRleHQgPSBjb250ZXh0UHJvdmlkZXIocmVwcmVzZW50YXRpdmUpO1xuICAgIGlmIChjb250ZXh0ID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgJHtxdW90ZShcbiAgICAgICAgbWV0aG9kVGFnXG4gICAgICApfSBtYXkgb25seSBiZSBhcHBsaWVkIHRvIGEgdmFsaWQgaW5zdGFuY2U6ICR7cmVwcmVzZW50YXRpdmV9YDtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnRleHQ7XG4gIH07XG4gIGNvbnN0IG1ldGhvZCA9IGRlZmVuZE1ldGhvZChcbiAgICBnZXRDb250ZXh0LFxuICAgIGJlaGF2aW9yTWV0aG9kLFxuICAgIG1ldGhvZEd1YXJkLFxuICAgIG1ldGhvZFRhZ1xuICApO1xuICBkZWZpbmVQcm9wZXJ0aWVzMyhtZXRob2QsIHtcbiAgICBuYW1lOiB7IHZhbHVlOiBtZXRob2RUYWcgfSxcbiAgICBsZW5ndGg6IHsgdmFsdWU6IGJlaGF2aW9yTWV0aG9kLmxlbmd0aCB9XG4gIH0pO1xuICByZXR1cm4gbWV0aG9kO1xufTtcbnZhciBkZWZlbmRQcm90b3R5cGUgPSAodGFnLCBjb250ZXh0UHJvdmlkZXIsIGJlaGF2aW9yTWV0aG9kcywgdGhpc2Z1bE1ldGhvZHMgPSBmYWxzZSwgaW50ZXJmYWNlR3VhcmQgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgcHJvdG90eXBlID0ge307XG4gIGNvbnN0IG1ldGhvZE5hbWVzID0gZ2V0TWV0aG9kTmFtZXMoYmVoYXZpb3JNZXRob2RzKS5maWx0ZXIoXG4gICAgLy9cbiAgICAvL1xuICAgIChrZXkpID0+IHtcbiAgICAgIGlmIChrZXkgIT09IFwiY29uc3RydWN0b3JcIikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbnN0cnVjdG9yID0gYmVoYXZpb3JNZXRob2RzLmNvbnN0cnVjdG9yO1xuICAgICAgcmV0dXJuICEoY29uc3RydWN0b3IucHJvdG90eXBlICYmIGNvbnN0cnVjdG9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9PT0gY29uc3RydWN0b3IpO1xuICAgIH1cbiAgKTtcbiAgbGV0IG1ldGhvZEd1YXJkcztcbiAgbGV0IGRlZmF1bHRHdWFyZHM7XG4gIGlmIChpbnRlcmZhY2VHdWFyZCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGludGVyZmFjZU5hbWUsXG4gICAgICBtZXRob2RHdWFyZHM6IG1nLFxuICAgICAgc3ltYm9sTWV0aG9kR3VhcmRzLFxuICAgICAgc2xvcHB5LFxuICAgICAgZGVmYXVsdEd1YXJkczogZGcgPSBzbG9wcHkgPyBcInBhc3NhYmxlXCIgOiBkZWZhdWx0R3VhcmRzXG4gICAgfSA9IGdldEludGVyZmFjZUd1YXJkUGF5bG9hZChpbnRlcmZhY2VHdWFyZCk7XG4gICAgbWV0aG9kR3VhcmRzID0gaGFyZGVuKHtcbiAgICAgIC4uLm1nLFxuICAgICAgLi4uKHN5bWJvbE1ldGhvZEd1YXJkcyYmIGZyb21FbnRyaWVzOChnZXRDb3B5TWFwRW50cmllcyhzeW1ib2xNZXRob2RHdWFyZHMpKSlcbiAgICB9KTtcbiAgICBkZWZhdWx0R3VhcmRzID0gZGc7XG4gICAge1xuICAgICAgY29uc3QgbWV0aG9kR3VhcmROYW1lcyA9IG93bktleXMxOChtZXRob2RHdWFyZHMpO1xuICAgICAgY29uc3QgdW5pbXBsZW1lbnRlZCA9IGxpc3REaWZmZXJlbmNlKG1ldGhvZEd1YXJkTmFtZXMsIG1ldGhvZE5hbWVzKTtcbiAgICAgIHVuaW1wbGVtZW50ZWQubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgbWV0aG9kcyAke3F1b3RlKHVuaW1wbGVtZW50ZWQpfSBub3QgaW1wbGVtZW50ZWQgYnkgJHtxdW90ZSh0YWcpfWA7XG4gICAgICBpZiAoZGVmYXVsdEd1YXJkcyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnN0IHVuZ3VhcmRlZCA9IGxpc3REaWZmZXJlbmNlKG1ldGhvZE5hbWVzLCBtZXRob2RHdWFyZE5hbWVzKTtcbiAgICAgICAgdW5ndWFyZGVkLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZHMgJHtxdW90ZSh1bmd1YXJkZWQpfSBub3QgZ3VhcmRlZCBieSAke3F1b3RlKGludGVyZmFjZU5hbWUpfWA7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGZvciAoY29uc3QgcHJvcCBvZiBtZXRob2ROYW1lcykge1xuICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gYmVoYXZpb3JNZXRob2RzW3Byb3BdO1xuICAgIGNvbnN0IHsgc2hpZnRlZE1ldGhvZCB9ID0ge1xuICAgICAgc2hpZnRlZE1ldGhvZCguLi5hcmdzKSB7XG4gICAgICAgIHJldHVybiBvcmlnaW5hbE1ldGhvZCh0aGlzLCAuLi5hcmdzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGJlaGF2aW9yTWV0aG9kID0gdGhpc2Z1bE1ldGhvZHMgPyBvcmlnaW5hbE1ldGhvZCA6IHNoaWZ0ZWRNZXRob2Q7XG4gICAgbGV0IG1ldGhvZEd1YXJkID0gbWV0aG9kR3VhcmRzICYmIG1ldGhvZEd1YXJkc1twcm9wXTtcbiAgICBpZiAoIW1ldGhvZEd1YXJkKSB7XG4gICAgICBzd2l0Y2ggKGRlZmF1bHRHdWFyZHMpIHtcbiAgICAgICAgY2FzZSB2b2lkIDA6IHtcbiAgICAgICAgICBpZiAodGhpc2Z1bE1ldGhvZHMpIHtcbiAgICAgICAgICAgIG1ldGhvZEd1YXJkID0gUGFzc2FibGVNZXRob2RHdWFyZDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWV0aG9kR3VhcmQgPSBSYXdNZXRob2RHdWFyZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInBhc3NhYmxlXCI6IHtcbiAgICAgICAgICBtZXRob2RHdWFyZCA9IFBhc3NhYmxlTWV0aG9kR3VhcmQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInJhd1wiOiB7XG4gICAgICAgICAgbWV0aG9kR3VhcmQgPSBSYXdNZXRob2RHdWFyZDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBVbnJlY29nbml6ZWQgZGVmYXVsdEd1YXJkcyAke3F1b3RlKGRlZmF1bHRHdWFyZHMpfWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcHJvdG90eXBlW3Byb3BdID0gYmluZE1ldGhvZChcbiAgICAgIGBJbiAke3F1b3RlKHByb3ApfSBtZXRob2Qgb2YgKCR7dGFnfSlgLFxuICAgICAgY29udGV4dFByb3ZpZGVyLFxuICAgICAgYmVoYXZpb3JNZXRob2QsXG4gICAgICBtZXRob2RHdWFyZFxuICAgICk7XG4gIH1cbiAgaWYgKCFoYXNPd25Qcm9wZXJ0eU9mKHByb3RvdHlwZSwgR0VUX0lOVEVSRkFDRV9HVUFSRCkpIHtcbiAgICBjb25zdCBnZXRJbnRlcmZhY2VHdWFyZE1ldGhvZCA9IHtcbiAgICAgIFtHRVRfSU5URVJGQUNFX0dVQVJEXSgpIHtcbiAgICAgICAgcmV0dXJuIGludGVyZmFjZUd1YXJkO1xuICAgICAgfVxuICAgIH1bR0VUX0lOVEVSRkFDRV9HVUFSRF07XG4gICAgcHJvdG90eXBlW0dFVF9JTlRFUkZBQ0VfR1VBUkRdID0gYmluZE1ldGhvZChcbiAgICAgIGBJbiAke3F1b3RlKEdFVF9JTlRFUkZBQ0VfR1VBUkQpfSBtZXRob2Qgb2YgKCR7dGFnfSlgLFxuICAgICAgY29udGV4dFByb3ZpZGVyLFxuICAgICAgZ2V0SW50ZXJmYWNlR3VhcmRNZXRob2QsXG4gICAgICBQYXNzYWJsZU1ldGhvZEd1YXJkXG4gICAgKTtcbiAgfVxuICByZXR1cm4gRmFyKFxuICAgIHRhZyxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHByb3RvdHlwZVxuICApO1xufTtcbmhhcmRlbihkZWZlbmRQcm90b3R5cGUpO1xudmFyIGRlZmVuZFByb3RvdHlwZUtpdCA9ICh0YWcsIGNvbnRleHRQcm92aWRlcktpdCwgYmVoYXZpb3JNZXRob2RzS2l0LCB0aGlzZnVsTWV0aG9kcyA9IGZhbHNlLCBpbnRlcmZhY2VHdWFyZEtpdCA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCBmYWNldE5hbWVzID0gb3duS2V5czE4KGJlaGF2aW9yTWV0aG9kc0tpdCkuc29ydCgpO1xuICBmYWNldE5hbWVzLmxlbmd0aCA+IDEgfHwgdGhyb3dSZWRhY3RlZGBBIG11bHRpLWZhY2V0IG9iamVjdCBtdXN0IGhhdmUgbXVsdGlwbGUgZmFjZXRzYDtcbiAgaWYgKGludGVyZmFjZUd1YXJkS2l0KSB7XG4gICAgY29uc3QgaW50ZXJmYWNlTmFtZXMgPSBvd25LZXlzMTgoaW50ZXJmYWNlR3VhcmRLaXQpO1xuICAgIGNvbnN0IGV4dHJhSW50ZXJmYWNlTmFtZXMgPSBsaXN0RGlmZmVyZW5jZShmYWNldE5hbWVzLCBpbnRlcmZhY2VOYW1lcyk7XG4gICAgZXh0cmFJbnRlcmZhY2VOYW1lcy5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcmZhY2VzICR7cXVvdGUoZXh0cmFJbnRlcmZhY2VOYW1lcyl9IG5vdCBpbXBsZW1lbnRlZCBieSAke3F1b3RlKHRhZyl9YDtcbiAgICBjb25zdCBleHRyYUZhY2V0TmFtZXMyID0gbGlzdERpZmZlcmVuY2UoaW50ZXJmYWNlTmFtZXMsIGZhY2V0TmFtZXMpO1xuICAgIGV4dHJhRmFjZXROYW1lczIubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgRmFjZXRzICR7cXVvdGUoZXh0cmFGYWNldE5hbWVzMil9IG9mICR7cXVvdGUodGFnKX0gbm90IGd1YXJkZWQgYnkgaW50ZXJmYWNlc2A7XG4gIH1cbiAgY29uc3QgY29udGV4dE1hcE5hbWVzID0gb3duS2V5czE4KGNvbnRleHRQcm92aWRlcktpdCk7XG4gIGNvbnN0IGV4dHJhQ29udGV4dE5hbWVzID0gbGlzdERpZmZlcmVuY2UoZmFjZXROYW1lcywgY29udGV4dE1hcE5hbWVzKTtcbiAgZXh0cmFDb250ZXh0TmFtZXMubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgQ29udGV4dHMgJHtxdW90ZShleHRyYUNvbnRleHROYW1lcyl9IG5vdCBpbXBsZW1lbnRlZCBieSAke3F1b3RlKHRhZyl9YDtcbiAgY29uc3QgZXh0cmFGYWNldE5hbWVzID0gbGlzdERpZmZlcmVuY2UoY29udGV4dE1hcE5hbWVzLCBmYWNldE5hbWVzKTtcbiAgZXh0cmFGYWNldE5hbWVzLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYEZhY2V0cyAke3F1b3RlKGV4dHJhRmFjZXROYW1lcyl9IG9mICR7cXVvdGUodGFnKX0gbWlzc2luZyBjb250ZXh0c2A7XG4gIGNvbnN0IHByb3RvS2l0ID0gb2JqZWN0TWFwKFxuICAgIGJlaGF2aW9yTWV0aG9kc0tpdCxcbiAgICAoYmVoYXZpb3JNZXRob2RzLCBmYWNldE5hbWUpID0+IGRlZmVuZFByb3RvdHlwZShcbiAgICAgIGAke3RhZ30gJHtTdHJpbmcoZmFjZXROYW1lKX1gLFxuICAgICAgY29udGV4dFByb3ZpZGVyS2l0W2ZhY2V0TmFtZV0sXG4gICAgICBiZWhhdmlvck1ldGhvZHMsXG4gICAgICB0aGlzZnVsTWV0aG9kcyxcbiAgICAgIGludGVyZmFjZUd1YXJkS2l0ICYmIGludGVyZmFjZUd1YXJkS2l0W2ZhY2V0TmFtZV1cbiAgICApXG4gICk7XG4gIHJldHVybiBwcm90b0tpdDtcbn07XG5cbi8vXG52YXIgeyBjcmVhdGU6IGNyZWF0ZTMsIHNlYWwsIGZyZWV6ZTogZnJlZXplNywgZGVmaW5lUHJvcGVydHksIHZhbHVlczogdmFsdWVzMyB9ID0gT2JqZWN0O1xudmFyIExBQkVMX0lOU1RBTkNFUyA9IGVudmlyb25tZW50T3B0aW9uc0xpc3RIYXMoXCJERUJVR1wiLCBcImxhYmVsLWluc3RhbmNlc1wiKTtcbnZhciBtYWtlU2VsZiA9IChwcm90bywgaW5zdGFuY2VDb3VudCkgPT4ge1xuICBjb25zdCBzZWxmID0gY3JlYXRlMyhwcm90byk7XG4gIGlmIChMQUJFTF9JTlNUQU5DRVMpIHtcbiAgICBkZWZpbmVQcm9wZXJ0eShzZWxmLCBTeW1ib2wudG9TdHJpbmdUYWcsIHtcbiAgICAgIHZhbHVlOiBgJHtwcm90b1tTeW1ib2wudG9TdHJpbmdUYWddfSMke2luc3RhbmNlQ291bnR9YCxcbiAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgY29uZmlndXJhYmxlOiBmYWxzZVxuICAgIH0pO1xuICB9XG4gIHJldHVybiBoYXJkZW4oc2VsZik7XG59O1xudmFyIGVtcHR5UmVjb3JkID0gaGFyZGVuKHt9KTtcbnZhciBpbml0RW1wdHkgPSAoKSA9PiBlbXB0eVJlY29yZDtcbnZhciBkZWZpbmVFeG9DbGFzcyA9ICh0YWcsIGludGVyZmFjZUd1YXJkLCBpbml0LCBtZXRob2RzLCBvcHRpb25zID0ge30pID0+IHtcbiAgaGFyZGVuKG1ldGhvZHMpO1xuICBjb25zdCB7XG4gICAgZmluaXNoID0gdm9pZCAwLFxuICAgIHJlY2VpdmVBbXBsaWZpZXIgPSB2b2lkIDAsXG4gICAgcmVjZWl2ZUluc3RhbmNlVGVzdGVyID0gdm9pZCAwXG4gIH0gPSBvcHRpb25zO1xuICByZWNlaXZlQW1wbGlmaWVyID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBPbmx5IGZhY2V0cyBvZiBhbiBleG8gY2xhc3Mga2l0IGNhbiBiZSBhbXBsaWZpZWQgJHtxdW90ZSh0YWcpfWA7XG4gIGNvbnN0IGNvbnRleHRNYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgcHJvdG8gPSBkZWZlbmRQcm90b3R5cGUoXG4gICAgdGFnLFxuICAgIChzZWxmKSA9PiAoXG4gICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgIGNvbnRleHRNYXAuZ2V0KHNlbGYpXG4gICAgKSxcbiAgICBtZXRob2RzLFxuICAgIHRydWUsXG4gICAgaW50ZXJmYWNlR3VhcmRcbiAgKTtcbiAgbGV0IGluc3RhbmNlQ291bnQgPSAwO1xuICBjb25zdCBtYWtlSW5zdGFuY2UgPSAoLi4uYXJncykgPT4ge1xuICAgIGNvbnN0IHN0YXRlID0gc2VhbChpbml0KC4uLmFyZ3MpKTtcbiAgICBpbnN0YW5jZUNvdW50ICs9IDE7XG4gICAgY29uc3Qgc2VsZiA9IG1ha2VTZWxmKHByb3RvLCBpbnN0YW5jZUNvdW50KTtcbiAgICBjb25zdCBjb250ZXh0ID0gZnJlZXplNyh7IHN0YXRlLCBzZWxmIH0pO1xuICAgIGNvbnRleHRNYXAuc2V0KHNlbGYsIGNvbnRleHQpO1xuICAgIGlmIChmaW5pc2gpIHtcbiAgICAgIGZpbmlzaChjb250ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIHNlbGY7XG4gIH07XG4gIGlmIChyZWNlaXZlSW5zdGFuY2VUZXN0ZXIpIHtcbiAgICBjb25zdCBpc0luc3RhbmNlID0gKGV4bywgZmFjZXROYW1lID0gdm9pZCAwKSA9PiB7XG4gICAgICBmYWNldE5hbWUgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYGZhY2V0TmFtZSBjYW4gb25seSBiZSB1c2VkIHdpdGggYW4gZXhvIGNsYXNzIGtpdDogJHtxdW90ZShcbiAgICAgICAgdGFnXG4gICAgICApfSBoYXMgbm8gZmFjZXQgJHtxdW90ZShmYWNldE5hbWUpfWA7XG4gICAgICByZXR1cm4gY29udGV4dE1hcC5oYXMoZXhvKTtcbiAgICB9O1xuICAgIGhhcmRlbihpc0luc3RhbmNlKTtcbiAgICByZWNlaXZlSW5zdGFuY2VUZXN0ZXIoaXNJbnN0YW5jZSk7XG4gIH1cbiAgcmV0dXJuIGhhcmRlbihtYWtlSW5zdGFuY2UpO1xufTtcbmhhcmRlbihkZWZpbmVFeG9DbGFzcyk7XG52YXIgZGVmaW5lRXhvQ2xhc3NLaXQgPSAodGFnLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgbWV0aG9kc0tpdCwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGhhcmRlbihtZXRob2RzS2l0KTtcbiAgY29uc3Qge1xuICAgIGZpbmlzaCA9IHZvaWQgMCxcbiAgICByZWNlaXZlQW1wbGlmaWVyID0gdm9pZCAwLFxuICAgIHJlY2VpdmVJbnN0YW5jZVRlc3RlciA9IHZvaWQgMFxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgY29udGV4dE1hcEtpdCA9IG9iamVjdE1hcChtZXRob2RzS2l0LCAoKSA9PiAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKSk7XG4gIGNvbnN0IGdldENvbnRleHRLaXQgPSBvYmplY3RNYXAoXG4gICAgY29udGV4dE1hcEtpdCxcbiAgICAoY29udGV4dE1hcCkgPT4gKGZhY2V0KSA9PiBjb250ZXh0TWFwLmdldChmYWNldClcbiAgKTtcbiAgY29uc3QgcHJvdG90eXBlS2l0ID0gZGVmZW5kUHJvdG90eXBlS2l0KFxuICAgIHRhZyxcbiAgICBnZXRDb250ZXh0S2l0LFxuICAgIG1ldGhvZHNLaXQsXG4gICAgdHJ1ZSxcbiAgICBpbnRlcmZhY2VHdWFyZEtpdFxuICApO1xuICBsZXQgaW5zdGFuY2VDb3VudCA9IDA7XG4gIGNvbnN0IG1ha2VJbnN0YW5jZUtpdCA9ICguLi5hcmdzKSA9PiB7XG4gICAgY29uc3Qgc3RhdGUgPSBzZWFsKGluaXQoLi4uYXJncykpO1xuICAgIGNvbnN0IGNvbnRleHQgPSB7IHN0YXRlLCBmYWNldHM6IG51bGwgfTtcbiAgICBpbnN0YW5jZUNvdW50ICs9IDE7XG4gICAgY29uc3QgZmFjZXRzID0gb2JqZWN0TWFwKHByb3RvdHlwZUtpdCwgKHByb3RvLCBmYWNldE5hbWUpID0+IHtcbiAgICAgIGNvbnN0IHNlbGYgPSBtYWtlU2VsZihwcm90bywgaW5zdGFuY2VDb3VudCk7XG4gICAgICBjb250ZXh0TWFwS2l0W2ZhY2V0TmFtZV0uc2V0KHNlbGYsIGNvbnRleHQpO1xuICAgICAgcmV0dXJuIHNlbGY7XG4gICAgfSk7XG4gICAgY29udGV4dC5mYWNldHMgPSBmYWNldHM7XG4gICAgZnJlZXplNyhjb250ZXh0KTtcbiAgICBpZiAoZmluaXNoKSB7XG4gICAgICBmaW5pc2goY29udGV4dCk7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBjb250ZXh0LmZhY2V0c1xuICAgICk7XG4gIH07XG4gIGlmIChyZWNlaXZlQW1wbGlmaWVyKSB7XG4gICAgY29uc3QgYW1wbGlmeSA9IChleG9GYWNldCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBjb250ZXh0TWFwIG9mIHZhbHVlczMoY29udGV4dE1hcEtpdCkpIHtcbiAgICAgICAgaWYgKGNvbnRleHRNYXAuaGFzKGV4b0ZhY2V0KSkge1xuICAgICAgICAgIGNvbnN0IHsgZmFjZXRzIH0gPSBjb250ZXh0TWFwLmdldChleG9GYWNldCk7XG4gICAgICAgICAgcmV0dXJuIGZhY2V0cztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBNdXN0IGJlIGEgZmFjZXQgb2YgJHtxdW90ZSh0YWcpfTogJHtleG9GYWNldH1gO1xuICAgIH07XG4gICAgaGFyZGVuKGFtcGxpZnkpO1xuICAgIHJlY2VpdmVBbXBsaWZpZXIoYW1wbGlmeSk7XG4gIH1cbiAgaWYgKHJlY2VpdmVJbnN0YW5jZVRlc3Rlcikge1xuICAgIGNvbnN0IGlzSW5zdGFuY2UgPSAoZXhvRmFjZXQsIGZhY2V0TmFtZSA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKGZhY2V0TmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZXMzKGNvbnRleHRNYXBLaXQpLnNvbWUoXG4gICAgICAgICAgKGNvbnRleHRNYXAyKSA9PiBjb250ZXh0TWFwMi5oYXMoZXhvRmFjZXQpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBhc3NlcnQudHlwZW9mKGZhY2V0TmFtZSwgXCJzdHJpbmdcIik7XG4gICAgICBjb25zdCBjb250ZXh0TWFwID0gY29udGV4dE1hcEtpdFtmYWNldE5hbWVdO1xuICAgICAgY29udGV4dE1hcCAhPT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgZXhvIGNsYXNzIGtpdCAke3F1b3RlKHRhZyl9IGhhcyBubyBmYWNldCBuYW1lZCAke3F1b3RlKGZhY2V0TmFtZSl9YDtcbiAgICAgIHJldHVybiBjb250ZXh0TWFwLmhhcyhleG9GYWNldCk7XG4gICAgfTtcbiAgICBoYXJkZW4oaXNJbnN0YW5jZSk7XG4gICAgcmVjZWl2ZUluc3RhbmNlVGVzdGVyKGlzSW5zdGFuY2UpO1xuICB9XG4gIHJldHVybiBoYXJkZW4obWFrZUluc3RhbmNlS2l0KTtcbn07XG5oYXJkZW4oZGVmaW5lRXhvQ2xhc3NLaXQpO1xudmFyIG1ha2VFeG8gPSAodGFnLCBpbnRlcmZhY2VHdWFyZCwgbWV0aG9kcywgb3B0aW9ucyA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCBtYWtlSW5zdGFuY2UgPSBkZWZpbmVFeG9DbGFzcyhcbiAgICB0YWcsXG4gICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgaW5pdEVtcHR5LFxuICAgIG1ldGhvZHMsXG4gICAgb3B0aW9uc1xuICApO1xuICByZXR1cm4gbWFrZUluc3RhbmNlKCk7XG59O1xuaGFyZGVuKG1ha2VFeG8pO1xuXG4vL1xudmFyIG1ha2VMZWdhY3lNYXAgPSAodGFnID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCBtMiA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGNvbnN0IGFzc2VydEtleURvZXNOb3RFeGlzdCA9IChrZXkpID0+ICFtMi5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gYWxyZWFkeSByZWdpc3RlcmVkOiAke2tleX1gO1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiBtMi5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiBtMi5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGluaXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlEb2VzTm90RXhpc3Qoa2V5KTtcbiAgICAgIG0yLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gbTIuZ2V0KGtleSk7XG4gICAgfSxcbiAgICBzZXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIG0yLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBtMi5kZWxldGUoa2V5KTtcbiAgICB9LFxuICAgIGtleXM6ICgpID0+IG0yLmtleXMoKSxcbiAgICB2YWx1ZXM6ICgpID0+IG0yLnZhbHVlcygpLFxuICAgIGVudHJpZXM6ICgpID0+IG0yLmVudHJpZXMoKSxcbiAgICBnZXRTaXplOiAoKSA9PiBtMi5zaXplLFxuICAgIGNsZWFyOiAoKSA9PiBtMi5jbGVhcigpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlTGVnYWN5TWFwKTtcblxuLy9cbnZhciBtYWtlTGVnYWN5V2Vha01hcCA9ICh0YWcgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IHdtID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IGFzc2VydEtleURvZXNOb3RFeGlzdCA9IChrZXkpID0+ICF3bS5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gYWxyZWFkeSByZWdpc3RlcmVkOiAke2tleX1gO1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiB3bS5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiB3bS5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGluaXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlEb2VzTm90RXhpc3Qoa2V5KTtcbiAgICAgIHdtLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAgICAgICAgICAgICovXG4gICAgICAgIHdtLmdldChrZXkpXG4gICAgICApO1xuICAgIH0sXG4gICAgc2V0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICB3bS5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgd20uZGVsZXRlKGtleSk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUxlZ2FjeVdlYWtNYXApO1xuXG4vL1xudmFyIG11c3RNYXRjaDIgPSBtdXN0TWF0Y2g7XG5cbi8vXG52YXIgZW1wdHkgPSAwbjtcbnZhciBuYXRNYXRoSGVscGVycyA9IGhhcmRlbih7XG4gIGRvQ29lcmNlOiAobmF0KSA9PiB7XG4gICAgYXNzZXJ0LnR5cGVvZihuYXQsIFwiYmlnaW50XCIpO1xuICAgIGlzTmF0KG5hdCkgfHwgdGhyb3dSZWRhY3RlZGB2YWx1ZSAke25hdH0gbXVzdCBiZSBhIG5hdHVyYWwgbnVtYmVyYDtcbiAgICByZXR1cm4gTmF0KG5hdCk7XG4gIH0sXG4gIGRvTWFrZUVtcHR5OiAoKSA9PiBlbXB0eSxcbiAgZG9Jc0VtcHR5OiAobmF0KSA9PiBuYXQgPT09IGVtcHR5LFxuICBkb0lzR1RFOiAobGVmdCwgcmlnaHQpID0+IGxlZnQgPj0gcmlnaHQsXG4gIGRvSXNFcXVhbDogKGxlZnQsIHJpZ2h0KSA9PiBsZWZ0ID09PSByaWdodCxcbiAgLy9cbiAgZG9BZGQ6IChsZWZ0LCByaWdodCkgPT4gbGVmdCArIHJpZ2h0LFxuICBkb1N1YnRyYWN0OiAobGVmdCwgcmlnaHQpID0+IE5hdChsZWZ0IC0gcmlnaHQpXG59KTtcblxuLy9cbnZhciBlbXB0eTIgPSBoYXJkZW4oW10pO1xudmFyIHNldE1hdGhIZWxwZXJzID0gaGFyZGVuKHtcbiAgZG9Db2VyY2U6IChsaXN0KSA9PiB7XG4gICAgbGlzdCA9IGNvZXJjZVRvRWxlbWVudHMobGlzdCk7XG4gICAgYXNzZXJ0S2V5KGxpc3QpO1xuICAgIHJldHVybiBsaXN0O1xuICB9LFxuICBkb01ha2VFbXB0eTogKCkgPT4gZW1wdHkyLFxuICBkb0lzRW1wdHk6IChsaXN0KSA9PiBwYXNzU3R5bGVPZihsaXN0KSA9PT0gXCJjb3B5QXJyYXlcIiAmJiBsaXN0Lmxlbmd0aCA9PT0gMCxcbiAgZG9Jc0dURTogZWxlbWVudHNJc1N1cGVyc2V0LFxuICBkb0lzRXF1YWw6ICh4LCB5KSA9PiBlbGVtZW50c0NvbXBhcmUoeCwgeSkgPT09IDAsXG4gIGRvQWRkOiBlbGVtZW50c0Rpc2pvaW50VW5pb24sXG4gIGRvU3VidHJhY3Q6IGVsZW1lbnRzRGlzam9pbnRTdWJ0cmFjdFxufSk7XG5cbi8vXG52YXIgZW1wdHkzID0gbWFrZUNvcHlTZXQoW10pO1xudmFyIGNvcHlTZXRNYXRoSGVscGVycyA9IGhhcmRlbih7XG4gIGRvQ29lcmNlOiAoc2V0KSA9PiB7XG4gICAgbXVzdE1hdGNoMihzZXQsIE0uc2V0KCksIFwic2V0IG9mIGFtb3VudFwiKTtcbiAgICByZXR1cm4gc2V0O1xuICB9LFxuICBkb01ha2VFbXB0eTogKCkgPT4gZW1wdHkzLFxuICBkb0lzRW1wdHk6IChzZXQpID0+IGdldENvcHlTZXRLZXlzKHNldCkubGVuZ3RoID09PSAwLFxuICBkb0lzR1RFOiBzZXRJc1N1cGVyc2V0LFxuICBkb0lzRXF1YWw6IGtleUVRLFxuICBkb0FkZDogc2V0RGlzam9pbnRVbmlvbixcbiAgZG9TdWJ0cmFjdDogc2V0RGlzam9pbnRTdWJ0cmFjdFxufSk7XG5cbi8vXG52YXIgZW1wdHk0ID0gbWFrZUNvcHlCYWcoW10pO1xudmFyIGNvcHlCYWdNYXRoSGVscGVycyA9IGhhcmRlbih7XG4gIGRvQ29lcmNlOiAoYmFnKSA9PiB7XG4gICAgbXVzdE1hdGNoMihiYWcsIE0uYmFnKCksIFwiYmFnIG9mIGFtb3VudFwiKTtcbiAgICByZXR1cm4gYmFnO1xuICB9LFxuICBkb01ha2VFbXB0eTogKCkgPT4gZW1wdHk0LFxuICBkb0lzRW1wdHk6IChiYWcpID0+IGdldENvcHlCYWdFbnRyaWVzKGJhZykubGVuZ3RoID09PSAwLFxuICBkb0lzR1RFOiBiYWdJc1N1cGVyYmFnLFxuICBkb0lzRXF1YWw6IGtleUVRLFxuICBkb0FkZDogYmFnVW5pb24sXG4gIGRvU3VidHJhY3Q6IGJhZ0Rpc2pvaW50U3VidHJhY3Rcbn0pO1xuXG4vL1xudmFyIEFzc2V0S2luZCA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIE5BVDogXCJuYXRcIixcbiAgICBTRVQ6IFwic2V0XCIsXG4gICAgQ09QWV9TRVQ6IFwiY29weVNldFwiLFxuICAgIENPUFlfQkFHOiBcImNvcHlCYWdcIlxuICB9XG4pO1xuaGFyZGVuKEFzc2V0S2luZCk7XG52YXIgYXNzZXRLaW5kTmFtZXMgPSBoYXJkZW4oT2JqZWN0LnZhbHVlcyhBc3NldEtpbmQpLnNvcnQoKSk7XG52YXIgYXNzZXJ0QXNzZXRLaW5kID0gKGFsbGVnZWRBSykgPT4ge1xuICBhc3NldEtpbmROYW1lcy5pbmNsdWRlcyhhbGxlZ2VkQUspIHx8IHRocm93UmVkYWN0ZWRgVGhlIGFzc2V0S2luZCAke2FsbGVnZWRBS30gbXVzdCBiZSBvbmUgb2YgJHtxdW90ZShhc3NldEtpbmROYW1lcyl9YDtcbn07XG5oYXJkZW4oYXNzZXJ0QXNzZXRLaW5kKTtcbnZhciBoZWxwZXJzID0ge1xuICBuYXQ6IG5hdE1hdGhIZWxwZXJzLFxuICBzZXQ6IHNldE1hdGhIZWxwZXJzLFxuICBjb3B5U2V0OiBjb3B5U2V0TWF0aEhlbHBlcnMsXG4gIGNvcHlCYWc6IGNvcHlCYWdNYXRoSGVscGVyc1xufTtcbnZhciBhc3NlcnRWYWx1ZUdldEFzc2V0S2luZCA9ICh2YWx1ZSkgPT4ge1xuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZih2YWx1ZSk7XG4gIGlmIChwYXNzU3R5bGUgPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4gXCJuYXRcIjtcbiAgfVxuICBpZiAocGFzc1N0eWxlID09PSBcImNvcHlBcnJheVwiKSB7XG4gICAgcmV0dXJuIFwic2V0XCI7XG4gIH1cbiAgaWYgKG1hdGNoZXModmFsdWUsIE0uc2V0KCkpKSB7XG4gICAgcmV0dXJuIFwiY29weVNldFwiO1xuICB9XG4gIGlmIChtYXRjaGVzKHZhbHVlLCBNLmJhZygpKSkge1xuICAgIHJldHVybiBcImNvcHlCYWdcIjtcbiAgfVxuICB0aHJvdyB0aHJvd1JlZGFjdGVkYHZhbHVlICR7dmFsdWV9IG11c3QgYmUgYSBiaWdpbnQsIGNvcHlTZXQsIGNvcHlCYWcsIG9yIGFuIGFycmF5LCBub3QgJHtxdW90ZShcbiAgICBwYXNzU3R5bGVcbiAgKX1gO1xufTtcbnZhciBhc3NlcnRWYWx1ZUdldEhlbHBlcnMgPSAodmFsdWUpID0+IChcbiAgLy9cbiAgaGVscGVyc1thc3NlcnRWYWx1ZUdldEFzc2V0S2luZCh2YWx1ZSldXG4pO1xudmFyIG9wdGlvbmFsQnJhbmRDaGVjayA9IChhbGxlZ2VkQnJhbmQsIGJyYW5kKSA9PiB7XG4gIGlmIChicmFuZCAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGJyYW5kLCBcImJyYW5kXCIpO1xuICAgIGFsbGVnZWRCcmFuZCA9PT0gYnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBhbW91bnQncyBicmFuZCAke3F1b3RlKGFsbGVnZWRCcmFuZCl9IGRpZCBub3QgbWF0Y2ggZXhwZWN0ZWQgYnJhbmQgJHtxdW90ZShcbiAgICAgIGJyYW5kXG4gICAgKX1gO1xuICB9XG59O1xudmFyIGNoZWNrTFJBbmRHZXRIZWxwZXJzID0gKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICBhc3NlcnRSZWNvcmQobGVmdEFtb3VudCwgXCJsZWZ0QW1vdW50XCIpO1xuICBhc3NlcnRSZWNvcmQocmlnaHRBbW91bnQsIFwicmlnaHRBbW91bnRcIik7XG4gIGNvbnN0IHsgdmFsdWU6IGxlZnRWYWx1ZSwgYnJhbmQ6IGxlZnRCcmFuZCB9ID0gbGVmdEFtb3VudDtcbiAgY29uc3QgeyB2YWx1ZTogcmlnaHRWYWx1ZSwgYnJhbmQ6IHJpZ2h0QnJhbmQgfSA9IHJpZ2h0QW1vdW50O1xuICBhc3NlcnRSZW1vdGFibGUobGVmdEJyYW5kLCBcImxlZnRCcmFuZFwiKTtcbiAgYXNzZXJ0UmVtb3RhYmxlKHJpZ2h0QnJhbmQsIFwicmlnaHRCcmFuZFwiKTtcbiAgb3B0aW9uYWxCcmFuZENoZWNrKGxlZnRCcmFuZCwgYnJhbmQpO1xuICBvcHRpb25hbEJyYW5kQ2hlY2socmlnaHRCcmFuZCwgYnJhbmQpO1xuICBsZWZ0QnJhbmQgPT09IHJpZ2h0QnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBCcmFuZHMgaW4gbGVmdCAke3F1b3RlKGxlZnRCcmFuZCl9IGFuZCByaWdodCAke3F1b3RlKFxuICAgIHJpZ2h0QnJhbmRcbiAgKX0gc2hvdWxkIG1hdGNoIGJ1dCBkbyBub3RgO1xuICBjb25zdCBsZWZ0SGVscGVycyA9IGFzc2VydFZhbHVlR2V0SGVscGVycyhsZWZ0VmFsdWUpO1xuICBjb25zdCByaWdodEhlbHBlcnMgPSBhc3NlcnRWYWx1ZUdldEhlbHBlcnMocmlnaHRWYWx1ZSk7XG4gIGxlZnRIZWxwZXJzID09PSByaWdodEhlbHBlcnMgfHwgdGhyb3dSZWRhY3RlZGBUaGUgbGVmdCAke2xlZnRBbW91bnR9IGFuZCByaWdodCBhbW91bnQgJHtyaWdodEFtb3VudH0gaGFkIGRpZmZlcmVudCBhc3NldEtpbmRzYDtcbiAgcmV0dXJuIGxlZnRIZWxwZXJzO1xufTtcbnZhciBjb2VyY2VMUiA9IChoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkgPT4ge1xuICByZXR1cm4gW2guZG9Db2VyY2UobGVmdEFtb3VudC52YWx1ZSksIGguZG9Db2VyY2UocmlnaHRBbW91bnQudmFsdWUpXTtcbn07XG52YXIgaXNHVEUgPSAobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVycyhsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICByZXR1cm4gaC5kb0lzR1RFKC4uLmNvZXJjZUxSKGgsIGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50KSk7XG59O1xudmFyIEFtb3VudE1hdGggPSB7XG4gIC8vXG4gIC8vXG4gIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICovXG4gIG1ha2U6IChicmFuZCwgYWxsZWdlZFZhbHVlKSA9PiB7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGJyYW5kLCBcImJyYW5kXCIpO1xuICAgIGNvbnN0IGggPSBhc3NlcnRWYWx1ZUdldEhlbHBlcnMoYWxsZWdlZFZhbHVlKTtcbiAgICBjb25zdCB2YWx1ZSA9IGguZG9Db2VyY2UoYWxsZWdlZFZhbHVlKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgYnJhbmQsIHZhbHVlIH0pO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuXG4gICAqL1xuICBjb2VyY2U6IChicmFuZCwgYWxsZWdlZEFtb3VudCkgPT4ge1xuICAgIGFzc2VydFJlbW90YWJsZShicmFuZCwgXCJicmFuZFwiKTtcbiAgICBhc3NlcnRSZWNvcmQoYWxsZWdlZEFtb3VudCwgXCJhbW91bnRcIik7XG4gICAgY29uc3QgeyBicmFuZDogYWxsZWdlZEJyYW5kLCB2YWx1ZTogYWxsZWdlZFZhbHVlIH0gPSBhbGxlZ2VkQW1vdW50O1xuICAgIGJyYW5kID09PSBhbGxlZ2VkQnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBUaGUgYnJhbmQgaW4gdGhlIGFsbGVnZWRBbW91bnQgJHthbGxlZ2VkQW1vdW50fSBpbiAnY29lcmNlJyBkaWRuJ3QgbWF0Y2ggdGhlIHNwZWNpZmllZCBicmFuZCAke2JyYW5kfS5gO1xuICAgIHJldHVybiBBbW91bnRNYXRoLm1ha2UoYnJhbmQsIGFsbGVnZWRWYWx1ZSk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuXG4gICAqL1xuICBnZXRWYWx1ZTogKGJyYW5kLCBhbW91bnQpID0+IEFtb3VudE1hdGguY29lcmNlKGJyYW5kLCBhbW91bnQpLnZhbHVlLFxuICAvKlxuXG5cblxuXG5cblxuXG4gICAqL1xuICBtYWtlRW1wdHk6IChicmFuZCwgYXNzZXRLaW5kID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgXCJuYXRcIlxuICApKSA9PiB7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGJyYW5kLCBcImJyYW5kXCIpO1xuICAgIGFzc2VydEFzc2V0S2luZChhc3NldEtpbmQpO1xuICAgIGNvbnN0IHZhbHVlID0gaGVscGVyc1thc3NldEtpbmRdLmRvTWFrZUVtcHR5KCk7XG4gICAgcmV0dXJuIGhhcmRlbih7IGJyYW5kLCB2YWx1ZSB9KTtcbiAgfSxcbiAgLypcblxuXG5cblxuXG5cbiAgICovXG4gIG1ha2VFbXB0eUZyb21BbW91bnQ6IChhbW91bnQpID0+IHtcbiAgICBhc3NlcnRSZWNvcmQoYW1vdW50LCBcImFtb3VudFwiKTtcbiAgICBjb25zdCB7IGJyYW5kLCB2YWx1ZSB9ID0gYW1vdW50O1xuICAgIGNvbnN0IGFzc2V0S2luZCA9IGFzc2VydFZhbHVlR2V0QXNzZXRLaW5kKHZhbHVlKTtcbiAgICByZXR1cm4gQW1vdW50TWF0aC5tYWtlRW1wdHkoYnJhbmQsIGFzc2V0S2luZCk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuICAgKi9cbiAgaXNFbXB0eTogKGFtb3VudCwgYnJhbmQgPSB2b2lkIDApID0+IHtcbiAgICBhc3NlcnRSZWNvcmQoYW1vdW50LCBcImFtb3VudFwiKTtcbiAgICBjb25zdCB7IGJyYW5kOiBhbGxlZ2VkQnJhbmQsIHZhbHVlIH0gPSBhbW91bnQ7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGFsbGVnZWRCcmFuZCwgXCJicmFuZFwiKTtcbiAgICBvcHRpb25hbEJyYW5kQ2hlY2soYWxsZWdlZEJyYW5kLCBicmFuZCk7XG4gICAgY29uc3QgaCA9IGFzc2VydFZhbHVlR2V0SGVscGVycyh2YWx1ZSk7XG4gICAgcmV0dXJuIGguZG9Jc0VtcHR5KGguZG9Db2VyY2UodmFsdWUpKTtcbiAgfSxcbiAgaXNHVEUsXG4gIC8qXG5cblxuXG5cblxuXG5cblxuICAgKi9cbiAgaXNFcXVhbDogKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVycyhsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICAgIHJldHVybiBoLmRvSXNFcXVhbCguLi5jb2VyY2VMUihoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkpO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICovXG4gIGFkZDogKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVycyhsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICAgIGNvbnN0IHZhbHVlID0gaC5kb0FkZCguLi5jb2VyY2VMUihoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkpO1xuICAgIHJldHVybiBoYXJkZW4oeyBicmFuZDogbGVmdEFtb3VudC5icmFuZCwgdmFsdWUgfSk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAqL1xuICBzdWJ0cmFjdDogKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVycyhsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICAgIGNvbnN0IHZhbHVlID0gaC5kb1N1YnRyYWN0KC4uLmNvZXJjZUxSKGgsIGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50KSk7XG4gICAgcmV0dXJuIGhhcmRlbih7IGJyYW5kOiBsZWZ0QW1vdW50LmJyYW5kLCB2YWx1ZSB9KTtcbiAgfSxcbiAgLypcblxuXG5cblxuXG5cblxuICAgKi9cbiAgbWluOiAoeCwgeSwgYnJhbmQgPSB2b2lkIDApID0+IChcbiAgICAvL1xuICAgIGlzR1RFKHgsIHksIGJyYW5kKSA/IHkgOiBpc0dURSh5LCB4LCBicmFuZCkgPyB4IDogdGhyb3dSZWRhY3RlZGAke3h9IGFuZCAke3l9IGFyZSBpbmNvbXBhcmFibGVgXG4gICksXG4gIC8qXG5cblxuXG5cblxuXG5cbiAgICovXG4gIG1heDogKHgsIHksIGJyYW5kID0gdm9pZCAwKSA9PiAoXG4gICAgLy9cbiAgICBpc0dURSh4LCB5LCBicmFuZCkgPyB4IDogaXNHVEUoeSwgeCkgPyB5IDogdGhyb3dSZWRhY3RlZGAke3h9IGFuZCAke3l9IGFyZSBpbmNvbXBhcmFibGVgXG4gIClcbn07XG5oYXJkZW4oQW1vdW50TWF0aCk7XG52YXIgZ2V0QXNzZXRLaW5kID0gKGFtb3VudCkgPT4ge1xuICBhc3NlcnRSZWNvcmQoYW1vdW50LCBcImFtb3VudFwiKTtcbiAgY29uc3QgeyB2YWx1ZSB9ID0gYW1vdW50O1xuICByZXR1cm4gYXNzZXJ0VmFsdWVHZXRBc3NldEtpbmQodmFsdWUpO1xufTtcbmhhcmRlbihnZXRBc3NldEtpbmQpO1xuXG4vL1xudmFyIFZhdERhdGFHbG9iYWw7XG5pZiAoXCJWYXREYXRhXCIgaW4gZ2xvYmFsVGhpcykge1xuICBnbG9iYWxUaGlzLlZhdERhdGEgfHwgdGhyb3dSZWRhY3RlZGBWYXREYXRhIGRlZmluZWQgaW4gZ2xvYmFsIGFzIG51bGwgb3IgdW5kZWZpbmVkYDtcbiAgVmF0RGF0YUdsb2JhbCA9IC8qICAgICAgICAgICAgICAqL1xuICBnbG9iYWxUaGlzLlZhdERhdGE7XG59IGVsc2Uge1xuICBjb25zdCB1bmF2YWlsYWJsZSA9ICgpID0+IHRocm93UmVkYWN0ZWRgVmF0RGF0YSB1bmF2YWlsYWJsZWA7XG4gIFZhdERhdGFHbG9iYWwgPSB7XG4gICAgZGVmaW5lS2luZDogdW5hdmFpbGFibGUsXG4gICAgZGVmaW5lS2luZE11bHRpOiB1bmF2YWlsYWJsZSxcbiAgICBkZWZpbmVEdXJhYmxlS2luZDogdW5hdmFpbGFibGUsXG4gICAgZGVmaW5lRHVyYWJsZUtpbmRNdWx0aTogdW5hdmFpbGFibGUsXG4gICAgbWFrZUtpbmRIYW5kbGU6IHVuYXZhaWxhYmxlLFxuICAgIHByb3ZpZGVQcm9taXNlV2F0Y2hlcjogdW5hdmFpbGFibGUsXG4gICAgd2F0Y2hQcm9taXNlOiB1bmF2YWlsYWJsZSxcbiAgICBtYWtlU2NhbGFyQmlnTWFwU3RvcmU6IHVuYXZhaWxhYmxlLFxuICAgIG1ha2VTY2FsYXJCaWdXZWFrTWFwU3RvcmU6IHVuYXZhaWxhYmxlLFxuICAgIG1ha2VTY2FsYXJCaWdTZXRTdG9yZTogdW5hdmFpbGFibGUsXG4gICAgbWFrZVNjYWxhckJpZ1dlYWtTZXRTdG9yZTogdW5hdmFpbGFibGUsXG4gICAgY2FuQmVEdXJhYmxlOiB1bmF2YWlsYWJsZVxuICB9O1xufVxudmFyIFZhdERhdGFFeHBvcnQgPSBWYXREYXRhR2xvYmFsO1xudmFyIHtcbiAgZGVmaW5lS2luZCxcbiAgZGVmaW5lS2luZE11bHRpLFxuICBkZWZpbmVEdXJhYmxlS2luZCxcbiAgZGVmaW5lRHVyYWJsZUtpbmRNdWx0aVxufSA9IFZhdERhdGFHbG9iYWw7XG52YXIge1xuICBtYWtlS2luZEhhbmRsZSxcbiAgcHJvdmlkZVByb21pc2VXYXRjaGVyLFxuICB3YXRjaFByb21pc2UsXG4gIG1ha2VTY2FsYXJCaWdNYXBTdG9yZSxcbiAgbWFrZVNjYWxhckJpZ1dlYWtNYXBTdG9yZSxcbiAgbWFrZVNjYWxhckJpZ1NldFN0b3JlLFxuICBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlLFxuICBjYW5CZUR1cmFibGVcbn0gPSBWYXREYXRhR2xvYmFsO1xudmFyIHBpY2tGYWNldCA9IChtYWtlciwgZmFjZXROYW1lKSA9PiAoLi4uYXJncykgPT4gbWFrZXIoLi4uYXJncylbZmFjZXROYW1lXTtcbmhhcmRlbihwaWNrRmFjZXQpO1xudmFyIHBhcnRpYWxBc3NpZ24gPSAodGFyZ2V0LCBzb3VyY2UpID0+IHtcbiAgT2JqZWN0LmFzc2lnbih0YXJnZXQsIHNvdXJjZSk7XG59O1xuaGFyZGVuKHBhcnRpYWxBc3NpZ24pO1xudmFyIHByb3ZpZGUgPSAoXG4gIC8vXG4gIC8qXG5cblxuXG5cblxuICAgKi9cbiAgcHJvdmlkZUxhenlcbik7XG52YXIgbWFrZVN0b3JlVXRpbHMgPSAoVmF0RGF0YSkgPT4ge1xuICBjb25zdCB7XG4gICAgLy9cbiAgICBtYWtlU2NhbGFyQmlnTWFwU3RvcmU6IG1ha2VTY2FsYXJCaWdNYXBTdG9yZTIsXG4gICAgLy9cbiAgICBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlOiBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlMixcbiAgICAvL1xuICAgIG1ha2VTY2FsYXJCaWdTZXRTdG9yZTogbWFrZVNjYWxhckJpZ1NldFN0b3JlMixcbiAgICAvL1xuICAgIG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmU6IG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmUyXG4gIH0gPSBWYXREYXRhO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZU1hcFN0b3JlMiA9IChiYWdnYWdlLCBuYW1lLCBvcHRpb25zID0ge30pID0+IHByb3ZpZGUoXG4gICAgYmFnZ2FnZSxcbiAgICBuYW1lLFxuICAgICgpID0+IG1ha2VTY2FsYXJCaWdNYXBTdG9yZTIobmFtZSwgeyBkdXJhYmxlOiB0cnVlLCAuLi5vcHRpb25zIH0pXG4gICk7XG4gIGhhcmRlbihwcm92aWRlRHVyYWJsZU1hcFN0b3JlMik7XG4gIGNvbnN0IHByb3ZpZGVEdXJhYmxlV2Vha01hcFN0b3JlMiA9IChiYWdnYWdlLCBuYW1lLCBvcHRpb25zID0ge30pID0+IHByb3ZpZGUoXG4gICAgYmFnZ2FnZSxcbiAgICBuYW1lLFxuICAgICgpID0+IG1ha2VTY2FsYXJCaWdXZWFrTWFwU3RvcmUyKG5hbWUsIHsgZHVyYWJsZTogdHJ1ZSwgLi4ub3B0aW9ucyB9KVxuICApO1xuICBoYXJkZW4ocHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmUyKTtcbiAgY29uc3QgcHJvdmlkZUR1cmFibGVTZXRTdG9yZTIgPSAoYmFnZ2FnZSwgbmFtZSwgb3B0aW9ucyA9IHt9KSA9PiBwcm92aWRlKFxuICAgIGJhZ2dhZ2UsXG4gICAgbmFtZSxcbiAgICAoKSA9PiBtYWtlU2NhbGFyQmlnU2V0U3RvcmUyKG5hbWUsIHsgZHVyYWJsZTogdHJ1ZSwgLi4ub3B0aW9ucyB9KVxuICApO1xuICBoYXJkZW4ocHJvdmlkZUR1cmFibGVTZXRTdG9yZTIpO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTIgPSAoYmFnZ2FnZSwgbmFtZSwgb3B0aW9ucyA9IHt9KSA9PiBwcm92aWRlKFxuICAgIGJhZ2dhZ2UsXG4gICAgbmFtZSxcbiAgICAoKSA9PiBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlMihuYW1lLCB7IGR1cmFibGU6IHRydWUsIC4uLm9wdGlvbnMgfSlcbiAgKTtcbiAgaGFyZGVuKHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlMik7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIHByb3ZpZGVEdXJhYmxlTWFwU3RvcmU6IHByb3ZpZGVEdXJhYmxlTWFwU3RvcmUyLFxuICAgIHByb3ZpZGVEdXJhYmxlV2Vha01hcFN0b3JlOiBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTIsXG4gICAgcHJvdmlkZUR1cmFibGVTZXRTdG9yZTogcHJvdmlkZUR1cmFibGVTZXRTdG9yZTIsXG4gICAgcHJvdmlkZUR1cmFibGVXZWFrU2V0U3RvcmU6IHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlMlxuICB9KTtcbn07XG52YXIgZ2xvYmFsU3RvcmVVdGlscyA9IG1ha2VTdG9yZVV0aWxzKFZhdERhdGFHbG9iYWwpO1xudmFyIHtcbiAgcHJvdmlkZUR1cmFibGVNYXBTdG9yZSxcbiAgcHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmUsXG4gIHByb3ZpZGVEdXJhYmxlU2V0U3RvcmUsXG4gIHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlXG59ID0gZ2xvYmFsU3RvcmVVdGlscztcblxuLy9cbnZhciBpZ25vcmVDb250ZXh0ID0gKGZuKSA9PiAoX2NvbnRleHQsIC4uLmFyZ3MpID0+IGZuKC4uLmFyZ3MpO1xuaGFyZGVuKGlnbm9yZUNvbnRleHQpO1xudmFyIG1ha2VFeG9VdGlscyA9IChWYXREYXRhKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBkZWZpbmVLaW5kOiBkZWZpbmVLaW5kMixcbiAgICBkZWZpbmVLaW5kTXVsdGk6IGRlZmluZUtpbmRNdWx0aTIsXG4gICAgZGVmaW5lRHVyYWJsZUtpbmQ6IGRlZmluZUR1cmFibGVLaW5kMixcbiAgICBkZWZpbmVEdXJhYmxlS2luZE11bHRpOiBkZWZpbmVEdXJhYmxlS2luZE11bHRpMixcbiAgICBtYWtlS2luZEhhbmRsZTogbWFrZUtpbmRIYW5kbGUyXG4gIH0gPSBWYXREYXRhO1xuICBjb25zdCBwcm92aWRlS2luZEhhbmRsZTIgPSAoYmFnZ2FnZSwga2luZE5hbWUpID0+IHByb3ZpZGUoYmFnZ2FnZSwgYCR7a2luZE5hbWV9X2tpbmRIYW5kbGVgLCAoKSA9PiBtYWtlS2luZEhhbmRsZTIoa2luZE5hbWUpKTtcbiAgaGFyZGVuKHByb3ZpZGVLaW5kSGFuZGxlMik7XG4gIGNvbnN0IHByZXBhcmVLaW5kMiA9IChiYWdnYWdlLCBraW5kTmFtZSwgaW5pdCwgYmVoYXZpb3IsIG9wdGlvbnMgPSB2b2lkIDApID0+IGRlZmluZUR1cmFibGVLaW5kMihcbiAgICBwcm92aWRlS2luZEhhbmRsZTIoYmFnZ2FnZSwga2luZE5hbWUpLFxuICAgIGluaXQsXG4gICAgYmVoYXZpb3IsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUtpbmQyKTtcbiAgY29uc3QgcHJlcGFyZUtpbmRNdWx0aTIgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGluaXQsIGJlaGF2aW9yLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlS2luZE11bHRpMihcbiAgICBwcm92aWRlS2luZEhhbmRsZTIoYmFnZ2FnZSwga2luZE5hbWUpLFxuICAgIGluaXQsXG4gICAgYmVoYXZpb3IsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUtpbmRNdWx0aTIpO1xuICBjb25zdCBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3MyID0gKHRhZywgaW50ZXJmYWNlR3VhcmQsIGluaXQsIG1ldGhvZHMsIG9wdGlvbnMpID0+IChcbiAgICAvL1xuICAgIGRlZmluZUtpbmQyKHRhZywgaW5pdCwgbWV0aG9kcywge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHRoaXNmdWxNZXRob2RzOiB0cnVlLFxuICAgICAgaW50ZXJmYWNlR3VhcmRcbiAgICB9KVxuICApO1xuICBoYXJkZW4oZGVmaW5lVmlydHVhbEV4b0NsYXNzMik7XG4gIGNvbnN0IGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDIgPSAodGFnLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgZmFjZXRzLCBvcHRpb25zKSA9PiAoXG4gICAgLy9cbiAgICBkZWZpbmVLaW5kTXVsdGkyKHRhZywgaW5pdCwgZmFjZXRzLCB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgdGhpc2Z1bE1ldGhvZHM6IHRydWUsXG4gICAgICBpbnRlcmZhY2VHdWFyZEtpdFxuICAgIH0pXG4gICk7XG4gIGhhcmRlbihkZWZpbmVWaXJ0dWFsRXhvQ2xhc3NLaXQyKTtcbiAgY29uc3QgZGVmaW5lRHVyYWJsZUV4b0NsYXNzMiA9IChraW5kSGFuZGxlLCBpbnRlcmZhY2VHdWFyZCwgaW5pdCwgbWV0aG9kcywgb3B0aW9ucykgPT4gKFxuICAgIC8vXG4gICAgZGVmaW5lRHVyYWJsZUtpbmQyKGtpbmRIYW5kbGUsIGluaXQsIG1ldGhvZHMsIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICB0aGlzZnVsTWV0aG9kczogdHJ1ZSxcbiAgICAgIGludGVyZmFjZUd1YXJkXG4gICAgfSlcbiAgKTtcbiAgaGFyZGVuKGRlZmluZUR1cmFibGVFeG9DbGFzczIpO1xuICBjb25zdCBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQyID0gKGtpbmRIYW5kbGUsIGludGVyZmFjZUd1YXJkS2l0LCBpbml0LCBmYWNldHMsIG9wdGlvbnMpID0+IChcbiAgICAvL1xuICAgIGRlZmluZUR1cmFibGVLaW5kTXVsdGkyKGtpbmRIYW5kbGUsIGluaXQsIGZhY2V0cywge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHRoaXNmdWxNZXRob2RzOiB0cnVlLFxuICAgICAgaW50ZXJmYWNlR3VhcmRLaXRcbiAgICB9KVxuICApO1xuICBoYXJkZW4oZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0Mik7XG4gIGNvbnN0IHByZXBhcmVFeG9DbGFzczIgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGludGVyZmFjZUd1YXJkLCBpbml0LCBtZXRob2RzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3MyKFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlMihiYWdnYWdlLCBraW5kTmFtZSksXG4gICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgaW5pdCxcbiAgICBtZXRob2RzLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgaGFyZGVuKHByZXBhcmVFeG9DbGFzczIpO1xuICBjb25zdCBwcmVwYXJlRXhvQ2xhc3NLaXQyID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgZmFjZXRzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQyKFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlMihiYWdnYWdlLCBraW5kTmFtZSksXG4gICAgaW50ZXJmYWNlR3VhcmRLaXQsXG4gICAgaW5pdCxcbiAgICBmYWNldHMsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUV4b0NsYXNzS2l0Mik7XG4gIGNvbnN0IHByZXBhcmVFeG8yID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbnRlcmZhY2VHdWFyZCwgbWV0aG9kcywgb3B0aW9ucyA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IG1ha2VTaW5nbGV0b24gPSBwcmVwYXJlRXhvQ2xhc3MyKFxuICAgICAgYmFnZ2FnZSxcbiAgICAgIGtpbmROYW1lLFxuICAgICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgICBpbml0RW1wdHksXG4gICAgICBtZXRob2RzLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gICAgcmV0dXJuIHByb3ZpZGUoYmFnZ2FnZSwgYCR7a2luZE5hbWV9X3NpbmdsZXRvbmAsICgpID0+IG1ha2VTaW5nbGV0b24oKSk7XG4gIH07XG4gIGhhcmRlbihwcmVwYXJlRXhvMik7XG4gIGNvbnN0IHByZXBhcmVTaW5nbGV0b24yID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBtZXRob2RzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBwcmVwYXJlRXhvMihiYWdnYWdlLCBraW5kTmFtZSwgdm9pZCAwLCBtZXRob2RzLCBvcHRpb25zKTtcbiAgaGFyZGVuKHByZXBhcmVTaW5nbGV0b24yKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgZGVmaW5lVmlydHVhbEV4b0NsYXNzOiBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3MyLFxuICAgIGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDogZGVmaW5lVmlydHVhbEV4b0NsYXNzS2l0MixcbiAgICBkZWZpbmVEdXJhYmxlRXhvQ2xhc3M6IGRlZmluZUR1cmFibGVFeG9DbGFzczIsXG4gICAgZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0OiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQyLFxuICAgIHByZXBhcmVFeG9DbGFzczogcHJlcGFyZUV4b0NsYXNzMixcbiAgICBwcmVwYXJlRXhvQ2xhc3NLaXQ6IHByZXBhcmVFeG9DbGFzc0tpdDIsXG4gICAgcHJlcGFyZUV4bzogcHJlcGFyZUV4bzIsXG4gICAgcHJlcGFyZVNpbmdsZXRvbjogcHJlcGFyZVNpbmdsZXRvbjIsXG4gICAgcHJvdmlkZUtpbmRIYW5kbGU6IHByb3ZpZGVLaW5kSGFuZGxlMixcbiAgICBwcmVwYXJlS2luZDogcHJlcGFyZUtpbmQyLFxuICAgIHByZXBhcmVLaW5kTXVsdGk6IHByZXBhcmVLaW5kTXVsdGkyXG4gIH0pO1xufTtcbnZhciBnbG9iYWxFeG9VdGlscyA9IG1ha2VFeG9VdGlscyhWYXREYXRhRXhwb3J0KTtcbnZhciB7XG4gIGRlZmluZVZpcnR1YWxFeG9DbGFzcyxcbiAgZGVmaW5lVmlydHVhbEV4b0NsYXNzS2l0LFxuICBkZWZpbmVEdXJhYmxlRXhvQ2xhc3MsXG4gIGRlZmluZUR1cmFibGVFeG9DbGFzc0tpdCxcbiAgcHJlcGFyZUV4b0NsYXNzLFxuICBwcmVwYXJlRXhvQ2xhc3NLaXQsXG4gIHByZXBhcmVFeG8sXG4gIHByZXBhcmVTaW5nbGV0b25cbn0gPSBnbG9iYWxFeG9VdGlscztcbnZhciB7IHByb3ZpZGVLaW5kSGFuZGxlLCBwcmVwYXJlS2luZCwgcHJlcGFyZUtpbmRNdWx0aSB9ID0gZ2xvYmFsRXhvVXRpbHM7XG5cbi8vXG52YXIgZGVmYXVsdExhYmVsVG9LZXlzID0gKGxhYmVsKSA9PiBoYXJkZW4oW2xhYmVsXSk7XG5oYXJkZW4oZGVmYXVsdExhYmVsVG9LZXlzKTtcbnZhciBtYWtlT25jZUtpdCA9IChkZWJ1Z05hbWUsIHN0b3JlcywgYmFja2luZ1N0b3JlID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IHVzZWRLZXlzID0gc3RvcmVzLmRldGFjaGVkKCkuc2V0U3RvcmUoYCR7ZGVidWdOYW1lfSB1c2VkIGtleXNgKTtcbiAgY29uc3QgYXNzZXJ0T25seU9uY2UgPSAoa2V5KSA9PiB7XG4gICAgdHlwZW9mIGtleSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGtleSAke2tleX0gbXVzdCBiZSBhIHN0cmluZ2A7XG4gICAgIXVzZWRLZXlzLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRga2V5ICR7a2V5fSBoYXMgYWxyZWFkeSBiZWVuIHVzZWQgaW4gdGhpcyB6b25lIGFuZCBpbmNhcm5hdGlvbmA7XG4gICAgdXNlZEtleXMuYWRkKGtleSk7XG4gIH07XG4gIGNvbnN0IHdyYXBQcm92aWRlciA9IChwcm92aWRlciwgbGFiZWxUb0tleXMgPSBkZWZhdWx0TGFiZWxUb0tleXMpID0+IHtcbiAgICBjb25zdCB3cmFwcGVyID0gKGxhYmVsLCAuLi5yZXN0KSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBsYWJlbFRvS2V5cyhsYWJlbCkpIHtcbiAgICAgICAgYXNzZXJ0T25seU9uY2Uoa2V5KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwcm92aWRlcihsYWJlbCwgLi4ucmVzdCk7XG4gICAgfTtcbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgd3JhcHBlclxuICAgICk7XG4gIH07XG4gIGNvbnN0IG1ha2VPbmNlID0gKGtleSwgbWFrZXIpID0+IHtcbiAgICBhc3NlcnRPbmx5T25jZShrZXkpO1xuICAgIGlmIChiYWNraW5nU3RvcmUgJiYgYmFja2luZ1N0b3JlLmhhcyhrZXkpKSB7XG4gICAgICByZXR1cm4gYmFja2luZ1N0b3JlLmdldChrZXkpO1xuICAgIH1cbiAgICBjb25zdCB2YWx1ZSA9IG1ha2VyKGtleSk7XG4gICAgc3RvcmVzLmlzU3RvcmFibGUodmFsdWUpIHx8IHRocm93UmVkYWN0ZWRgbWFrZXIgcmV0dXJuIHZhbHVlICR7dmFsdWV9IGlzIG5vdCBzdG9yYWJsZWA7XG4gICAgYmFja2luZ1N0b3JlICYmIGJhY2tpbmdTdG9yZS5pbml0KGtleSwgdmFsdWUpO1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IG1ha2VPbmNlLCB3cmFwUHJvdmlkZXIgfSk7XG59O1xuaGFyZGVuKG1ha2VPbmNlS2l0KTtcblxuLy9cbnZhciBraW5kID0gKGxhYmVsKSA9PiBgJHtsYWJlbH1fa2luZEhhbmRsZWA7XG52YXIgc2luZ2xldG9uID0gKGxhYmVsKSA9PiBgJHtsYWJlbH1fc2luZ2xldG9uYDtcbnZhciBhZ29yaWNWYXREYXRhS2V5cyA9IHtcbiAgZXhvQ2xhc3M6IChsYWJlbCkgPT4gaGFyZGVuKFtraW5kKGxhYmVsKV0pLFxuICBleG9DbGFzc0tpdDogKGxhYmVsKSA9PiBoYXJkZW4oW2tpbmQobGFiZWwpXSksXG4gIGV4bzogKGxhYmVsKSA9PiBoYXJkZW4oW2tpbmQobGFiZWwpLCBzaW5nbGV0b24obGFiZWwpXSksXG4gIHN0b3JlOiAobGFiZWwpID0+IGhhcmRlbihbbGFiZWxdKSxcbiAgem9uZTogKGxhYmVsKSA9PiBoYXJkZW4oW2xhYmVsXSlcbn07XG5oYXJkZW4oYWdvcmljVmF0RGF0YUtleXMpO1xuXG4vL1xudmFyIHsgYXBwbHk6IGFwcGx5NSB9ID0gUmVmbGVjdDtcbnZhciBQcm9taXNlV2F0Y2hlckhhbmRsZXIgPSBNLmNhbGwoTS5yYXcoKSkucmVzdChNLnJhdygpKS5yZXR1cm5zKCk7XG52YXIgUHJvbWlzZVdhdGNoZXJJID0gTS5pbnRlcmZhY2UoXCJQcm9taXNlV2F0Y2hlclwiLCB7XG4gIG9uRnVsZmlsbGVkOiBQcm9taXNlV2F0Y2hlckhhbmRsZXIsXG4gIG9uUmVqZWN0ZWQ6IFByb21pc2VXYXRjaGVySGFuZGxlclxufSk7XG52YXIgUHJvbWlzZVdhdGNoZXJGdWxmaWxsZWRJID0gTS5pbnRlcmZhY2UoXCJQcm9taXNlV2F0Y2hlckZ1bGZpbGxlZFwiLCB7XG4gIG9uRnVsZmlsbGVkOiBQcm9taXNlV2F0Y2hlckhhbmRsZXJcbn0pO1xudmFyIFByb21pc2VXYXRjaGVyUmVqZWN0ZWRJID0gTS5pbnRlcmZhY2UoXCJQcm9taXNlV2F0Y2hlclJlamVjdGVkXCIsIHtcbiAgb25SZWplY3RlZDogUHJvbWlzZVdhdGNoZXJIYW5kbGVyXG59KTtcbnZhciBjYWxsTWVNYXliZSA9ICh0aGF0LCBwcm9wLCBwb3N0QXJncykgPT4ge1xuICBjb25zdCBmbiA9IHRoYXRbcHJvcF07XG4gIGlmICghZm4pIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIGFzc2VydC50eXBlb2YoZm4sIFwiZnVuY3Rpb25cIik7XG4gIGNvbnN0IHdyYXBwZWQgPSAoYXJnKSA9PiB7XG4gICAgYXBwbHk1KGZuLCB0aGF0LCBbYXJnLCAuLi5wb3N0QXJnc10pO1xuICB9O1xuICByZXR1cm4gd3JhcHBlZDtcbn07XG52YXIgd2F0Y2hQcm9taXNlMiA9IChwMywgd2F0Y2hlciwgLi4ud2F0Y2hlckFyZ3MpID0+IHtcbiAgUHJvbWlzZS5yZXNvbHZlKHAzKSA9PT0gcDMgfHwgdGhyb3dSZWRhY3RlZGB3YXRjaFByb21pc2Ugb25seSB3YXRjaGVzIHByb21pc2VzYDtcbiAgY29uc3Qgb25GdWxmaWxsZWQgPSBjYWxsTWVNYXliZSh3YXRjaGVyLCBcIm9uRnVsZmlsbGVkXCIsIHdhdGNoZXJBcmdzKTtcbiAgY29uc3Qgb25SZWplY3RlZCA9IGNhbGxNZU1heWJlKHdhdGNoZXIsIFwib25SZWplY3RlZFwiLCB3YXRjaGVyQXJncyk7XG4gIG9uRnVsZmlsbGVkIHx8IG9uUmVqZWN0ZWQgfHwgdGhyb3dSZWRhY3RlZGBwcm9taXNlIHdhdGNoZXIgbXVzdCBpbXBsZW1lbnQgYXQgbGVhc3Qgb25lIGhhbmRsZXIgbWV0aG9kYDtcbiAgdm9pZCBFLndoZW4ocDMsIG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKTtcbn07XG5oYXJkZW4od2F0Y2hQcm9taXNlMik7XG5cbi8vXG52YXIgaXNTdG9yYWJsZSA9IChzcGVjaW1lbikgPT4gaXNQYXNzYWJsZShzcGVjaW1lbikgJiYgY2FuQmVEdXJhYmxlKHNwZWNpbWVuKTtcbmhhcmRlbihpc1N0b3JhYmxlKTtcbnZhciBhdHRhY2hEdXJhYmxlU3RvcmVzID0gKGdldEJhZ2dhZ2UpID0+IHtcbiAgY29uc3QgbWFwU3RvcmUgPSAobGFiZWwsIG9wdGlvbnMpID0+IHtcbiAgICBjb25zdCBiYWdnYWdlID0gZ2V0QmFnZ2FnZSgpO1xuICAgIGNvbnN0IHJldCA9IHByb3ZpZGVEdXJhYmxlTWFwU3RvcmUoYmFnZ2FnZSwgbGFiZWwsIG9wdGlvbnMpO1xuICAgIHJldHVybiByZXQ7XG4gIH07XG4gIGNvbnN0IHNldFN0b3JlID0gKGxhYmVsLCBvcHRpb25zKSA9PiBwcm92aWRlRHVyYWJsZVNldFN0b3JlKGdldEJhZ2dhZ2UoKSwgbGFiZWwsIG9wdGlvbnMpO1xuICBjb25zdCB3ZWFrU2V0U3RvcmUgPSAobGFiZWwsIG9wdGlvbnMpID0+IHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlKGdldEJhZ2dhZ2UoKSwgbGFiZWwsIG9wdGlvbnMpO1xuICBjb25zdCB3ZWFrTWFwU3RvcmUgPSAobGFiZWwsIG9wdGlvbnMpID0+IHByb3ZpZGVEdXJhYmxlV2Vha01hcFN0b3JlKGdldEJhZ2dhZ2UoKSwgbGFiZWwsIG9wdGlvbnMpO1xuICByZXR1cm4gRmFyKFwiZHVyYWJsZVN0b3Jlc1wiLCB7XG4gICAgZGV0YWNoZWQ6ICgpID0+IGRldGFjaGVkRHVyYWJsZVN0b3JlcyxcbiAgICBpc1N0b3JhYmxlLFxuICAgIG1hcFN0b3JlLFxuICAgIHNldFN0b3JlLFxuICAgIHdlYWtNYXBTdG9yZSxcbiAgICB3ZWFrU2V0U3RvcmVcbiAgfSk7XG59O1xudmFyIGRldGFjaGVkRHVyYWJsZVN0b3JlcyA9IGF0dGFjaER1cmFibGVTdG9yZXMoXG4gICgpID0+IG1ha2VTY2FsYXJNYXBTdG9yZShcImRldGFjaGVkXCIpXG4pO1xudmFyIG1ha2VEdXJhYmxlWm9uZSA9IChiYWdnYWdlLCBiYXNlTGFiZWwgPSBcImR1cmFibGVab25lXCIpID0+IHtcbiAgYmFnZ2FnZSB8fCB0aHJvd1JlZGFjdGVkYGJhZ2dhZ2UgcmVxdWlyZWRgO1xuICBjb25zdCBhdHRhY2hlZFN0b3JlcyA9IGF0dGFjaER1cmFibGVTdG9yZXMoKCkgPT4gYmFnZ2FnZSk7XG4gIGNvbnN0IHsgbWFrZU9uY2UsIHdyYXBQcm92aWRlciB9ID0gbWFrZU9uY2VLaXQoXG4gICAgYmFzZUxhYmVsLFxuICAgIGF0dGFjaGVkU3RvcmVzLFxuICAgIGJhZ2dhZ2VcbiAgKTtcbiAgY29uc3QgZXhvQ2xhc3MgPSAoLi4uYXJncykgPT4gcHJlcGFyZUV4b0NsYXNzKGJhZ2dhZ2UsIC4uLmFyZ3MpO1xuICBjb25zdCBleG9DbGFzc0tpdCA9ICguLi5hcmdzKSA9PiBwcmVwYXJlRXhvQ2xhc3NLaXQoYmFnZ2FnZSwgLi4uYXJncyk7XG4gIGNvbnN0IGV4byA9ICguLi5hcmdzKSA9PiBwcmVwYXJlRXhvKGJhZ2dhZ2UsIC4uLmFyZ3MpO1xuICBjb25zdCBzdWJab25lU3RvcmUgPSB3cmFwUHJvdmlkZXIoYXR0YWNoZWRTdG9yZXMubWFwU3RvcmUsIGFnb3JpY1ZhdERhdGFLZXlzLnpvbmUpO1xuICBjb25zdCBzdWJab25lID0gKGxhYmVsLCBvcHRpb25zID0ge30pID0+IHtcbiAgICBjb25zdCBzdWJCYWdnYWdlID0gc3ViWm9uZVN0b3JlKGxhYmVsLCBvcHRpb25zKTtcbiAgICByZXR1cm4gbWFrZUR1cmFibGVab25lKHN1YkJhZ2dhZ2UsIGAke2Jhc2VMYWJlbH0uJHtsYWJlbH1gKTtcbiAgfTtcbiAgcmV0dXJuIEZhcihcImR1cmFibGVab25lXCIsIHtcbiAgICBleG86IHdyYXBQcm92aWRlcihleG8sIGFnb3JpY1ZhdERhdGFLZXlzLmV4byksXG4gICAgZXhvQ2xhc3M6IHdyYXBQcm92aWRlcihleG9DbGFzcywgYWdvcmljVmF0RGF0YUtleXMuZXhvQ2xhc3MpLFxuICAgIGV4b0NsYXNzS2l0OiB3cmFwUHJvdmlkZXIoZXhvQ2xhc3NLaXQsIGFnb3JpY1ZhdERhdGFLZXlzLmV4b0NsYXNzS2l0KSxcbiAgICBzdWJab25lLFxuICAgIG1ha2VPbmNlLFxuICAgIHdhdGNoUHJvbWlzZSxcbiAgICBkZXRhY2hlZDogYXR0YWNoZWRTdG9yZXMuZGV0YWNoZWQsXG4gICAgaXNTdG9yYWJsZTogYXR0YWNoZWRTdG9yZXMuaXNTdG9yYWJsZSxcbiAgICBtYXBTdG9yZTogd3JhcFByb3ZpZGVyKGF0dGFjaGVkU3RvcmVzLm1hcFN0b3JlLCBhZ29yaWNWYXREYXRhS2V5cy5zdG9yZSksXG4gICAgc2V0U3RvcmU6IHdyYXBQcm92aWRlcihhdHRhY2hlZFN0b3Jlcy5zZXRTdG9yZSwgYWdvcmljVmF0RGF0YUtleXMuc3RvcmUpLFxuICAgIHdlYWtNYXBTdG9yZTogd3JhcFByb3ZpZGVyKGF0dGFjaGVkU3RvcmVzLndlYWtNYXBTdG9yZSwgYWdvcmljVmF0RGF0YUtleXMuc3RvcmUpLFxuICAgIHdlYWtTZXRTdG9yZTogd3JhcFByb3ZpZGVyKGF0dGFjaGVkU3RvcmVzLndlYWtTZXRTdG9yZSwgYWdvcmljVmF0RGF0YUtleXMuc3RvcmUpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlRHVyYWJsZVpvbmUpO1xuXG4vL1xudmFyIEJyYW5kU2hhcGUgPSBNLnJlbW90YWJsZShcIkJyYW5kXCIpO1xudmFyIElzc3VlclNoYXBlID0gTS5yZW1vdGFibGUoXCJJc3N1ZXJcIik7XG52YXIgUGF5bWVudFNoYXBlID0gTS5yZW1vdGFibGUoXCJQYXltZW50XCIpO1xudmFyIFB1cnNlU2hhcGUgPSBNLnJlbW90YWJsZShcIlB1cnNlXCIpO1xudmFyIERlcG9zaXRGYWNldFNoYXBlID0gTS5yZW1vdGFibGUoXCJEZXBvc2l0RmFjZXRcIik7XG52YXIgTm90aWZpZXJTaGFwZSA9IE0ucmVtb3RhYmxlKFwiTm90aWZpZXJcIik7XG52YXIgTWludFNoYXBlID0gTS5yZW1vdGFibGUoXCJNaW50XCIpO1xudmFyIE5hdFZhbHVlU2hhcGUgPSBNLm5hdCgpO1xudmFyIENvcHlTZXRWYWx1ZVNoYXBlID0gTS5zZXQoKTtcbnZhciBTZXRWYWx1ZVNoYXBlID0gTS5hcnJheU9mKE0ua2V5KCkpO1xudmFyIENvcHlCYWdWYWx1ZVNoYXBlID0gTS5iYWcoKTtcbnZhciBBbW91bnRWYWx1ZVNoYXBlID0gTS5vcihcbiAgTmF0VmFsdWVTaGFwZSxcbiAgQ29weVNldFZhbHVlU2hhcGUsXG4gIFNldFZhbHVlU2hhcGUsXG4gIENvcHlCYWdWYWx1ZVNoYXBlXG4pO1xudmFyIEFtb3VudFNoYXBlID0geyBicmFuZDogQnJhbmRTaGFwZSwgdmFsdWU6IEFtb3VudFZhbHVlU2hhcGUgfTtcbmhhcmRlbihBbW91bnRTaGFwZSk7XG52YXIgQW1vdW50UGF0dGVyblNoYXBlID0gTS5wYXR0ZXJuKCk7XG52YXIgUmF0aW9TaGFwZSA9IHsgbnVtZXJhdG9yOiBBbW91bnRTaGFwZSwgZGVub21pbmF0b3I6IEFtb3VudFNoYXBlIH07XG5oYXJkZW4oUmF0aW9TaGFwZSk7XG52YXIgaXNOYXRWYWx1ZSA9ICh2YWx1ZSkgPT4gbWF0Y2hlcyh2YWx1ZSwgTmF0VmFsdWVTaGFwZSk7XG5oYXJkZW4oaXNOYXRWYWx1ZSk7XG52YXIgaXNDb3B5U2V0VmFsdWUgPSAodmFsdWUpID0+IG1hdGNoZXModmFsdWUsIENvcHlTZXRWYWx1ZVNoYXBlKTtcbmhhcmRlbihpc0NvcHlTZXRWYWx1ZSk7XG52YXIgaXNTZXRWYWx1ZSA9ICh2YWx1ZSkgPT4gbWF0Y2hlcyh2YWx1ZSwgU2V0VmFsdWVTaGFwZSk7XG5oYXJkZW4oaXNTZXRWYWx1ZSk7XG52YXIgaXNDb3B5QmFnVmFsdWUgPSAodmFsdWUpID0+IG1hdGNoZXModmFsdWUsIENvcHlCYWdWYWx1ZVNoYXBlKTtcbmhhcmRlbihpc0NvcHlCYWdWYWx1ZSk7XG52YXIgTUFYX0FCU09MVVRFX0RFQ0lNQUxfUExBQ0VTID0gMTAwO1xudmFyIEFzc2V0S2luZFNoYXBlID0gTS5vcihcIm5hdFwiLCBcInNldFwiLCBcImNvcHlTZXRcIiwgXCJjb3B5QmFnXCIpO1xudmFyIERpc3BsYXlJbmZvU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7fSxcbiAge1xuICAgIGRlY2ltYWxQbGFjZXM6IE0uYW5kKFxuICAgICAgTS5ndGUoLU1BWF9BQlNPTFVURV9ERUNJTUFMX1BMQUNFUyksXG4gICAgICBNLmx0ZShNQVhfQUJTT0xVVEVfREVDSU1BTF9QTEFDRVMpXG4gICAgKSxcbiAgICBhc3NldEtpbmQ6IEFzc2V0S2luZFNoYXBlXG4gIH0sXG4gIHtcbiAgICAvL1xuICAgIC8vXG4gIH1cbik7XG52YXIgSXNzdWVyS2l0U2hhcGUgPSB7XG4gIGJyYW5kOiBCcmFuZFNoYXBlLFxuICBtaW50OiBNaW50U2hhcGUsXG4gIG1pbnRSZWNvdmVyeVB1cnNlOiBQdXJzZVNoYXBlLFxuICBpc3N1ZXI6IElzc3VlclNoYXBlLFxuICBkaXNwbGF5SW5mbzogRGlzcGxheUluZm9TaGFwZVxufTtcbmhhcmRlbihJc3N1ZXJLaXRTaGFwZSk7XG52YXIgQnJhbmRJID0gTS5pbnRlcmZhY2UoXCJCcmFuZFwiLCB7XG4gIGlzTXlJc3N1ZXI6IE0uY2FsbFdoZW4oTS5hd2FpdChJc3N1ZXJTaGFwZSkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICBnZXRBbGxlZ2VkTmFtZTogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgZ2V0RGlzcGxheUluZm86IE0uY2FsbCgpLnJldHVybnMoRGlzcGxheUluZm9TaGFwZSksXG4gIGdldEFtb3VudFNoYXBlOiBNLmNhbGwoKS5yZXR1cm5zKE0ucGF0dGVybigpKVxufSk7XG52YXIgbWFrZUlzc3VlckludGVyZmFjZXMgPSAoYnJhbmRTaGFwZSA9IEJyYW5kU2hhcGUsIGFzc2V0S2luZFNoYXBlID0gQXNzZXRLaW5kU2hhcGUsIGFtb3VudFNoYXBlID0gQW1vdW50U2hhcGUpID0+IHtcbiAgY29uc3QgSXNzdWVySSA9IE0uaW50ZXJmYWNlKFwiSXNzdWVyXCIsIHtcbiAgICBnZXRCcmFuZDogTS5jYWxsKCkucmV0dXJucyhicmFuZFNoYXBlKSxcbiAgICBnZXRBbGxlZ2VkTmFtZTogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgICBnZXRBc3NldEtpbmQ6IE0uY2FsbCgpLnJldHVybnMoYXNzZXRLaW5kU2hhcGUpLFxuICAgIGdldERpc3BsYXlJbmZvOiBNLmNhbGwoKS5yZXR1cm5zKERpc3BsYXlJbmZvU2hhcGUpLFxuICAgIG1ha2VFbXB0eVB1cnNlOiBNLmNhbGwoKS5yZXR1cm5zKFB1cnNlU2hhcGUpLFxuICAgIGlzTGl2ZTogTS5jYWxsV2hlbihNLmF3YWl0KFBheW1lbnRTaGFwZSkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICAgIGdldEFtb3VudE9mOiBNLmNhbGxXaGVuKE0uYXdhaXQoUGF5bWVudFNoYXBlKSkucmV0dXJucyhhbW91bnRTaGFwZSksXG4gICAgYnVybjogTS5jYWxsV2hlbihNLmF3YWl0KFBheW1lbnRTaGFwZSkpLm9wdGlvbmFsKEFtb3VudFBhdHRlcm5TaGFwZSkucmV0dXJucyhhbW91bnRTaGFwZSlcbiAgfSk7XG4gIGNvbnN0IE1pbnRJID0gTS5pbnRlcmZhY2UoXCJNaW50XCIsIHtcbiAgICBnZXRJc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUpLFxuICAgIG1pbnRQYXltZW50OiBNLmNhbGwoYW1vdW50U2hhcGUpLnJldHVybnMoUGF5bWVudFNoYXBlKVxuICB9KTtcbiAgY29uc3QgUGF5bWVudEkgPSBNLmludGVyZmFjZShcIlBheW1lbnRcIiwge1xuICAgIGdldEFsbGVnZWRCcmFuZDogTS5jYWxsKCkucmV0dXJucyhicmFuZFNoYXBlKVxuICB9KTtcbiAgY29uc3QgUHVyc2VJID0gTS5pbnRlcmZhY2UoXCJQdXJzZVwiLCB7XG4gICAgZ2V0QWxsZWdlZEJyYW5kOiBNLmNhbGwoKS5yZXR1cm5zKGJyYW5kU2hhcGUpLFxuICAgIGdldEN1cnJlbnRBbW91bnQ6IE0uY2FsbCgpLnJldHVybnMoYW1vdW50U2hhcGUpLFxuICAgIGdldEN1cnJlbnRBbW91bnROb3RpZmllcjogTS5jYWxsKCkucmV0dXJucyhOb3RpZmllclNoYXBlKSxcbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIGRlcG9zaXQ6IE0uY2FsbChQYXltZW50U2hhcGUpLm9wdGlvbmFsKEFtb3VudFBhdHRlcm5TaGFwZSkucmV0dXJucyhhbW91bnRTaGFwZSksXG4gICAgZ2V0RGVwb3NpdEZhY2V0OiBNLmNhbGwoKS5yZXR1cm5zKERlcG9zaXRGYWNldFNoYXBlKSxcbiAgICB3aXRoZHJhdzogTS5jYWxsKGFtb3VudFNoYXBlKS5yZXR1cm5zKFBheW1lbnRTaGFwZSksXG4gICAgZ2V0UmVjb3ZlcnlTZXQ6IE0uY2FsbCgpLnJldHVybnMoTS5zZXRPZihQYXltZW50U2hhcGUpKSxcbiAgICByZWNvdmVyQWxsOiBNLmNhbGwoKS5yZXR1cm5zKGFtb3VudFNoYXBlKVxuICB9KTtcbiAgY29uc3QgRGVwb3NpdEZhY2V0SSA9IE0uaW50ZXJmYWNlKFwiRGVwb3NpdEZhY2V0XCIsIHtcbiAgICByZWNlaXZlOiBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoUHVyc2VJKS5tZXRob2RHdWFyZHMuZGVwb3NpdFxuICB9KTtcbiAgY29uc3QgUHVyc2VJS2l0ID0ge1xuICAgIHB1cnNlOiBQdXJzZUksXG4gICAgZGVwb3NpdEZhY2V0OiBEZXBvc2l0RmFjZXRJXG4gIH07XG4gIGhhcmRlbihQdXJzZUlLaXQpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBJc3N1ZXJJLFxuICAgIE1pbnRJLFxuICAgIFBheW1lbnRJLFxuICAgIFB1cnNlSUtpdFxuICB9KTtcbn07XG5oYXJkZW4obWFrZUlzc3VlckludGVyZmFjZXMpO1xuXG4vL1xudmFyIGNvZXJjZURpc3BsYXlJbmZvID0gKGFsbGVnZWREaXNwbGF5SW5mbywgYXNzZXRLaW5kKSA9PiB7XG4gIG11c3RNYXRjaDIoYWxsZWdlZERpc3BsYXlJbmZvLCBEaXNwbGF5SW5mb1NoYXBlLCBcImRpc3BsYXlJbmZvXCIpO1xuICBpZiAoYWxsZWdlZERpc3BsYXlJbmZvLmFzc2V0S2luZCAhPT0gdm9pZCAwKSB7XG4gICAgYWxsZWdlZERpc3BsYXlJbmZvLmFzc2V0S2luZCA9PT0gYXNzZXRLaW5kIHx8IHRocm93UmVkYWN0ZWRgZGlzcGxheUluZm8uYXNzZXRLaW5kIHdhcyBwcmVzZW50ICgke2FsbGVnZWREaXNwbGF5SW5mby5hc3NldEtpbmR9KSBhbmQgZGlkIG5vdCBtYXRjaCB0aGUgYXNzZXRLaW5kIGFyZ3VtZW50ICgke2Fzc2V0S2luZH0pYDtcbiAgfVxuICBjb25zdCBkaXNwbGF5SW5mbyA9IGhhcmRlbih7IC4uLmFsbGVnZWREaXNwbGF5SW5mbywgYXNzZXRLaW5kIH0pO1xuICBpZiAoZGlzcGxheUluZm8uZGVjaW1hbFBsYWNlcyAhPT0gdm9pZCAwKSB7XG4gICAgTnVtYmVyLmlzU2FmZUludGVnZXIoZGlzcGxheUluZm8uZGVjaW1hbFBsYWNlcykgfHwgdGhyb3dSZWRhY3RlZGBkZWNpbWFsUGxhY2VzICR7ZGlzcGxheUluZm8uZGVjaW1hbFBsYWNlc30gaXMgbm90IGEgc2FmZSBpbnRlZ2VyYDtcbiAgfVxuICByZXR1cm4gZGlzcGxheUluZm87XG59O1xuXG4vL1xudmFyIHByZXBhcmVQYXltZW50S2luZCA9IChpc3N1ZXJab25lLCBuYW1lLCBicmFuZCwgUGF5bWVudEkpID0+IHtcbiAgY29uc3QgbWFrZVBheW1lbnQgPSBpc3N1ZXJab25lLmV4b0NsYXNzKFxuICAgIGAke25hbWV9IHBheW1lbnRgLFxuICAgIFBheW1lbnRJLFxuICAgIGluaXRFbXB0eSxcbiAgICB7XG4gICAgICBnZXRBbGxlZ2VkQnJhbmQoKSB7XG4gICAgICAgIHJldHVybiBicmFuZDtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlUGF5bWVudDtcbn07XG5oYXJkZW4ocHJlcGFyZVBheW1lbnRLaW5kKTtcblxuLy9cbnZhciBzaW5rID0gKCkgPT4ge1xufTtcbnZhciBtYWtlUXVpZXRSZWplY3Rpb24gPSAocmVhc29uKSA9PiB7XG4gIGNvbnN0IHJlamVjdGlvbiA9IGhhcmRlbihQcm9taXNlLnJlamVjdChyZWFzb24pKTtcbiAgdm9pZCBFLndoZW4ocmVqZWN0aW9uLCBzaW5rLCBzaW5rKTtcbiAgcmV0dXJuIHJlamVjdGlvbjtcbn07XG52YXIgdG9vRmFyUmVqZWN0aW9uID0gbWFrZVF1aWV0UmVqZWN0aW9uKFxuICBoYXJkZW4oRXJyb3IoXCJDYW5ub3QgcmVhZCBwYXN0IGVuZCBvZiBpdGVyYXRpb24uXCIpKVxuKTtcbnZhciBQdWJsaXNoZXJJID0gTS5pbnRlcmZhY2UoXCJQdWJsaXNoZXJcIiwge1xuICBwdWJsaXNoOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpLFxuICBmaW5pc2g6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKCksXG4gIGZhaWw6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKClcbn0pO1xudmFyIFVwZGF0ZUNvdW50U2hhcGUgPSBNLm9yKE0uYmlnaW50KCksIE0ubnVtYmVyKCkpO1xudmFyIFN1YnNjcmliZXJJID0gTS5pbnRlcmZhY2UoXCJTdWJzY3JpYmVyXCIsIHtcbiAgc3Vic2NyaWJlQWZ0ZXI6IE0uY2FsbCgpLm9wdGlvbmFsKE0uYmlnaW50KCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBnZXRVcGRhdGVTaW5jZTogTS5jYWxsKCkub3B0aW9uYWwoVXBkYXRlQ291bnRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSlcbn0pO1xudmFyIHB1Ymxpc2hLaXRJS2l0ID0gaGFyZGVuKHtcbiAgcHVibGlzaGVyOiBQdWJsaXNoZXJJLFxuICBzdWJzY3JpYmVyOiBTdWJzY3JpYmVySVxufSk7XG52YXIgRm9ya2FibGVBc3luY0l0ZXJhYmxlSXRlcmF0b3JTaGFwZSA9IE0uaW50ZXJmYWNlKFxuICBcIkZvcmthYmxlQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXCIsXG4gIHtcbiAgICBmb3JrOiBNLmNhbGwoKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06IE0uY2FsbCgpLnJldHVybnMoTS5hbnkoKSksXG4gICAgLy9cbiAgICBuZXh0OiBNLmNhbGxXaGVuKCkucmV0dXJucyhNLmFueSgpKVxuICB9XG4pO1xudmFyIEl0ZXJhYmxlRWFjaFRvcGljSSA9IE0uaW50ZXJmYWNlKFwiSXRlcmFibGVFYWNoVG9waWNcIiwge1xuICBzdWJzY3JpYmVBZnRlcjogZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKFN1YnNjcmliZXJJKS5tZXRob2RHdWFyZHMuc3Vic2NyaWJlQWZ0ZXIsXG4gIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06IE0uY2FsbCgpLnJldHVybnMoXG4gICAgTS5yZW1vdGFibGUoXCJGb3JrYWJsZUFzeW5jSXRlcmFibGVJdGVyYXRvclwiKVxuICApXG59KTtcbnZhciBJdGVyYWJsZUxhdGVzdFRvcGljSSA9IE0uaW50ZXJmYWNlKFwiSXRlcmFibGVMYXRlc3RUb3BpY1wiLCB7XG4gIGdldFVwZGF0ZVNpbmNlOiBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoU3Vic2NyaWJlckkpLm1ldGhvZEd1YXJkcy5nZXRVcGRhdGVTaW5jZSxcbiAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogTS5jYWxsKCkucmV0dXJucyhcbiAgICBNLnJlbW90YWJsZShcIkZvcmthYmxlQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXCIpXG4gIClcbn0pO1xudmFyIHdlYWtNZW1vaXplVW5hcnkgPSAoZm4pID0+IHtcbiAgY29uc3QgY2FjaGUgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgcmV0dXJuIChhcmcpID0+IHtcbiAgICBjb25zdCBvYXJnID0gYXJnO1xuICAgIGlmIChjYWNoZS5oYXMob2FyZykpIHtcbiAgICAgIHJldHVybiBjYWNoZS5nZXQob2FyZyk7XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IGZuKGFyZyk7XG4gICAgY2FjaGUuc2V0KG9hcmcsIHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbn07XG52YXIgbWFrZVVwZGF0ZVJlY29yZEZyb21QdWJsaWNhdGlvblJlY29yZCA9IChyZWNvcmQpID0+IHtcbiAgY29uc3Qge1xuICAgIGhlYWQ6IHsgdmFsdWUsIGRvbmUgfSxcbiAgICBwdWJsaXNoQ291bnRcbiAgfSA9IHJlY29yZDtcbiAgaWYgKGRvbmUpIHtcbiAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWUsIHVwZGF0ZUNvdW50OiB2b2lkIDAgfSk7XG4gIH1cbiAgcmV0dXJuIGhhcmRlbih7IHZhbHVlLCB1cGRhdGVDb3VudDogcHVibGlzaENvdW50IH0pO1xufTtcbnZhciBtYWtlUHVibGlzaEtpdCA9ICgpID0+IHtcbiAgbGV0IHRhaWxQO1xuICBsZXQgdGFpbFI7XG4gICh7IHByb21pc2U6IHRhaWxQLCByZXNvbHZlOiB0YWlsUiB9ID0gbWFrZVByb21pc2VLaXQoKSk7XG4gIGxldCBjdXJyZW50UHVibGlzaENvdW50ID0gMG47XG4gIGxldCBjdXJyZW50UCA9IHRhaWxQO1xuICBjb25zdCBhZHZhbmNlQ3VycmVudCA9IChkb25lLCB2YWx1ZSwgcmVqZWN0aW9uKSA9PiB7XG4gICAgaWYgKHRhaWxSID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHVwZGF0ZSBzdGF0ZSBhZnRlciB0ZXJtaW5hdGlvbi5cIik7XG4gICAgfVxuICAgIGN1cnJlbnRQdWJsaXNoQ291bnQgKz0gMW47XG4gICAgY3VycmVudFAgPSB0YWlsUDtcbiAgICBjb25zdCByZXNvbHZlQ3VycmVudCA9IHRhaWxSO1xuICAgIGlmIChkb25lKSB7XG4gICAgICB0YWlsUCA9IHRvb0ZhclJlamVjdGlvbjtcbiAgICAgIHRhaWxSID0gdm9pZCAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAoeyBwcm9taXNlOiB0YWlsUCwgcmVzb2x2ZTogdGFpbFIgfSA9IG1ha2VQcm9taXNlS2l0KCkpO1xuICAgIH1cbiAgICBpZiAocmVqZWN0aW9uKSB7XG4gICAgICByZXNvbHZlQ3VycmVudChyZWplY3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNvbHZlQ3VycmVudChcbiAgICAgICAgaGFyZGVuKHtcbiAgICAgICAgICBoZWFkOiB7IHZhbHVlLCBkb25lIH0sXG4gICAgICAgICAgcHVibGlzaENvdW50OiBjdXJyZW50UHVibGlzaENvdW50LFxuICAgICAgICAgIHRhaWw6IHRhaWxQXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgbWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkID0gd2Vha01lbW9pemVVbmFyeShcbiAgICBtYWtlVXBkYXRlUmVjb3JkRnJvbVB1YmxpY2F0aW9uUmVjb3JkXG4gICk7XG4gIGNvbnN0IHN1YnNjcmliZXIgPSBGYXIoXCJTdWJzY3JpYmVyXCIsIHtcbiAgICBzdWJzY3JpYmVBZnRlcjogKHB1Ymxpc2hDb3VudCA9IC0xbikgPT4ge1xuICAgICAgYXNzZXJ0LnR5cGVvZihwdWJsaXNoQ291bnQsIFwiYmlnaW50XCIpO1xuICAgICAgaWYgKHB1Ymxpc2hDb3VudCA9PT0gY3VycmVudFB1Ymxpc2hDb3VudCkge1xuICAgICAgICByZXR1cm4gdGFpbFA7XG4gICAgICB9IGVsc2UgaWYgKHB1Ymxpc2hDb3VudCA8IGN1cnJlbnRQdWJsaXNoQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRQO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgXCJzdWJzY3JpYmVBZnRlciBhcmd1bWVudCBtdXN0IGJlIGEgcHJldmlvdXNseS1pc3N1ZWQgcHVibGlzaENvdW50LlwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcbiAgICBnZXRVcGRhdGVTaW5jZTogKHVwZGF0ZUNvdW50KSA9PiB7XG4gICAgICBpZiAodXBkYXRlQ291bnQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcigpLnRoZW4obWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkKTtcbiAgICAgIH1cbiAgICAgIHVwZGF0ZUNvdW50ID0gQmlnSW50KHVwZGF0ZUNvdW50KTtcbiAgICAgIHJldHVybiBzdWJzY3JpYmVyLnN1YnNjcmliZUFmdGVyKHVwZGF0ZUNvdW50KS50aGVuKCgpID0+IHN1YnNjcmliZXIuZ2V0VXBkYXRlU2luY2UoKSk7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgcHVibGlzaGVyID0gRmFyKFwiUHVibGlzaGVyXCIsIHtcbiAgICBwdWJsaXNoOiAodmFsdWUpID0+IHtcbiAgICAgIGFkdmFuY2VDdXJyZW50KGZhbHNlLCB2YWx1ZSk7XG4gICAgfSxcbiAgICBmaW5pc2g6IChmaW5hbFZhbHVlKSA9PiB7XG4gICAgICBhZHZhbmNlQ3VycmVudCh0cnVlLCBmaW5hbFZhbHVlKTtcbiAgICB9LFxuICAgIGZhaWw6IChyZWFzb24pID0+IHtcbiAgICAgIGFkdmFuY2VDdXJyZW50KHRydWUsIHZvaWQgMCwgbWFrZVF1aWV0UmVqZWN0aW9uKHJlYXNvbikpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSk7XG59O1xuaGFyZGVuKG1ha2VQdWJsaXNoS2l0KTtcbnZhciBEdXJhYmxlUHVibGlzaEtpdFN0YXRlU2hhcGUgPSBoYXJkZW4oe1xuICB2YWx1ZUR1cmFiaWxpdHk6IE0uYW55KCksXG4gIHB1Ymxpc2hDb3VudDogTS5hbnkoKSxcbiAgc3RhdHVzOiBNLmFueSgpLFxuICBoYXNWYWx1ZTogTS5hbnkoKSxcbiAgdmFsdWU6IE0uYW55KClcbn0pO1xudmFyIGluaXREdXJhYmxlUHVibGlzaEtpdFN0YXRlID0gKG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IHZhbHVlRHVyYWJpbGl0eSA9IFwibWFuZGF0b3J5XCIgfSA9IG9wdGlvbnM7XG4gIGFzc2VydC5lcXVhbCh2YWx1ZUR1cmFiaWxpdHksIFwibWFuZGF0b3J5XCIpO1xuICByZXR1cm4ge1xuICAgIC8vXG4gICAgdmFsdWVEdXJhYmlsaXR5LFxuICAgIC8vXG4gICAgcHVibGlzaENvdW50OiAwbixcbiAgICBzdGF0dXM6IFwibGl2ZVwiLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgaGFzVmFsdWU6IGZhbHNlLFxuICAgIHZhbHVlOiB2b2lkIDBcbiAgfTtcbn07XG52YXIgZ2V0RXBoZW1lcmFsS2V5ID0gKGZhY2V0cykgPT4gZmFjZXRzLnB1Ymxpc2hlcjtcbnZhciBkdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbnZhciBwcm92aWRlQ3VycmVudFAgPSAoc3RhdGUsIGZhY2V0cywgdGFpbCkgPT4ge1xuICBjb25zdCBlcGhlbWVyYWxLZXkgPSBnZXRFcGhlbWVyYWxLZXkoZmFjZXRzKTtcbiAgY29uc3QgZm91bmREYXRhID0gZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhLmdldChlcGhlbWVyYWxLZXkpO1xuICBjb25zdCBjdXJyZW50UCA9IGZvdW5kRGF0YSAmJiBmb3VuZERhdGEuY3VycmVudFA7XG4gIGlmIChjdXJyZW50UCkge1xuICAgIHJldHVybiBjdXJyZW50UDtcbiAgfVxuICBjb25zdCB7IHB1Ymxpc2hDb3VudCwgc3RhdHVzLCBoYXNWYWx1ZSwgdmFsdWUgfSA9IHN0YXRlO1xuICBpZiAoIWhhc1ZhbHVlKSB7XG4gICAgYXNzZXJ0KHN0YXR1cyA9PT0gXCJsaXZlXCIpO1xuICAgIHJldHVybiB0YWlsO1xuICB9XG4gIGlmIChzdGF0dXMgPT09IFwibGl2ZVwiIHx8IHN0YXR1cyA9PT0gXCJmaW5pc2hlZFwiKSB7XG4gICAgY29uc3QgY2VsbCA9IGhhcmRlbih7XG4gICAgICBoZWFkOiB7IHZhbHVlLCBkb25lOiBzdGF0dXMgIT09IFwibGl2ZVwiIH0sXG4gICAgICBwdWJsaXNoQ291bnQsXG4gICAgICB0YWlsXG4gICAgfSk7XG4gICAgcmV0dXJuIEUucmVzb2x2ZShjZWxsKTtcbiAgfSBlbHNlIGlmIChzdGF0dXMgPT09IFwiZmFpbGVkXCIpIHtcbiAgICByZXR1cm4gbWFrZVF1aWV0UmVqZWN0aW9uKHZhbHVlKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEludmFsaWQgZHVyYWJsZSBwcm9taXNlIGtpdCBzdGF0dXM6ICR7cXVvdGUoc3RhdHVzKX1gO1xuICB9XG59O1xudmFyIHByb3ZpZGVEdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEgPSAoc3RhdGUsIGZhY2V0cykgPT4ge1xuICBjb25zdCBlcGhlbWVyYWxLZXkgPSBnZXRFcGhlbWVyYWxLZXkoZmFjZXRzKTtcbiAgY29uc3QgZm91bmREYXRhID0gZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhLmdldChlcGhlbWVyYWxLZXkpO1xuICBpZiAoZm91bmREYXRhKSB7XG4gICAgcmV0dXJuIGZvdW5kRGF0YTtcbiAgfVxuICBjb25zdCB7IHN0YXR1cyB9ID0gc3RhdGU7XG4gIGxldCB0YWlsUDtcbiAgbGV0IHRhaWxSO1xuICBpZiAoc3RhdHVzID09PSBcImxpdmVcIikge1xuICAgICh7IHByb21pc2U6IHRhaWxQLCByZXNvbHZlOiB0YWlsUiB9ID0gbWFrZVByb21pc2VLaXQoKSk7XG4gICAgdm9pZCBFLndoZW4odGFpbFAsIHNpbmssIHNpbmspO1xuICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gXCJmaW5pc2hlZFwiIHx8IHN0YXR1cyA9PT0gXCJmYWlsZWRcIikge1xuICAgIHRhaWxQID0gdG9vRmFyUmVqZWN0aW9uO1xuICB9IGVsc2Uge1xuICAgIHRocm93IHRocm93UmVkYWN0ZWRgSW52YWxpZCBkdXJhYmxlIHByb21pc2Uga2l0IHN0YXR1czogJHtxdW90ZShzdGF0dXMpfWA7XG4gIH1cbiAgY29uc3Qgb2JqID0gaGFyZGVuKHsgY3VycmVudFA6IHZvaWQgMCwgdGFpbFAsIHRhaWxSIH0pO1xuICBkdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEuc2V0KGVwaGVtZXJhbEtleSwgb2JqKTtcbiAgcmV0dXJuIG9iajtcbn07XG52YXIgYWR2YW5jZUR1cmFibGVQdWJsaXNoS2l0ID0gKGNvbnRleHQsIHZhbHVlLCB0YXJnZXRTdGF0dXMgPSBcImxpdmVcIikgPT4ge1xuICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IGNvbnRleHQ7XG4gIGNvbnN0IHsgdmFsdWVEdXJhYmlsaXR5LCBzdGF0dXMgfSA9IHN0YXRlO1xuICBpZiAoc3RhdHVzICE9PSBcImxpdmVcIikge1xuICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHVwZGF0ZSBzdGF0ZSBhZnRlciB0ZXJtaW5hdGlvbi5cIik7XG4gIH1cbiAgY29uc3QgZG9uZSA9IHRhcmdldFN0YXR1cyAhPT0gXCJsaXZlXCI7XG4gIGlmIChkb25lIHx8IHZhbHVlRHVyYWJpbGl0eSA9PT0gXCJtYW5kYXRvcnlcIikge1xuICAgIGNhbkJlRHVyYWJsZSh2YWx1ZSkgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgYWNjZXB0IG5vbi1kdXJhYmxlIHZhbHVlOiAke3ZhbHVlfWA7XG4gIH1cbiAgY29uc3QgeyB0YWlsUDogb2xkVGFpbFAsIHRhaWxSOiByZXNvbHZlT2xkVGFpbCB9ID0gcHJvdmlkZUR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YShzdGF0ZSwgZmFjZXRzKTtcbiAgYXNzZXJ0LnR5cGVvZihyZXNvbHZlT2xkVGFpbCwgXCJmdW5jdGlvblwiKTtcbiAgY29uc3QgcHVibGlzaENvdW50ID0gc3RhdGUucHVibGlzaENvdW50ICsgMW47XG4gIHN0YXRlLnB1Ymxpc2hDb3VudCA9IHB1Ymxpc2hDb3VudDtcbiAgbGV0IHRhaWxQO1xuICBsZXQgdGFpbFI7XG4gIGlmIChkb25lKSB7XG4gICAgc3RhdGUuc3RhdHVzID0gdGFyZ2V0U3RhdHVzO1xuICAgIHRhaWxQID0gdG9vRmFyUmVqZWN0aW9uO1xuICAgIHRhaWxSID0gdm9pZCAwO1xuICB9IGVsc2Uge1xuICAgICh7IHByb21pc2U6IHRhaWxQLCByZXNvbHZlOiB0YWlsUiB9ID0gbWFrZVByb21pc2VLaXQoKSk7XG4gICAgdm9pZCBFLndoZW4odGFpbFAsIHNpbmssIHNpbmspO1xuICB9XG4gIGxldCBjdXJyZW50UDtcbiAgaWYgKHRhcmdldFN0YXR1cyA9PT0gXCJmYWlsZWRcIikge1xuICAgIHN0YXRlLmhhc1ZhbHVlID0gdHJ1ZTtcbiAgICBzdGF0ZS52YWx1ZSA9IHZhbHVlO1xuICAgIGNvbnN0IHJlamVjdGlvbiA9IG1ha2VRdWlldFJlamVjdGlvbih2YWx1ZSk7XG4gICAgcmVzb2x2ZU9sZFRhaWwocmVqZWN0aW9uKTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoZG9uZSB8fCB2YWx1ZUR1cmFiaWxpdHkgIT09IFwiaWdub3JlZFwiICYmIGNhbkJlRHVyYWJsZSh2YWx1ZSkpIHtcbiAgICAgIHN0YXRlLmhhc1ZhbHVlID0gdHJ1ZTtcbiAgICAgIHN0YXRlLnZhbHVlID0gdmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0YXRlLmhhc1ZhbHVlID0gZmFsc2U7XG4gICAgICBzdGF0ZS52YWx1ZSA9IHZvaWQgMDtcbiAgICAgIGN1cnJlbnRQID0gb2xkVGFpbFA7XG4gICAgfVxuICAgIHJlc29sdmVPbGRUYWlsKFxuICAgICAgaGFyZGVuKHtcbiAgICAgICAgaGVhZDogeyB2YWx1ZSwgZG9uZSB9LFxuICAgICAgICBwdWJsaXNoQ291bnQsXG4gICAgICAgIHRhaWw6IHRhaWxQXG4gICAgICB9KVxuICAgICk7XG4gIH1cbiAgZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhLnNldChcbiAgICBnZXRFcGhlbWVyYWxLZXkoZmFjZXRzKSxcbiAgICBoYXJkZW4oeyBjdXJyZW50UCwgdGFpbFAsIHRhaWxSIH0pXG4gICk7XG59O1xudmFyIHByZXBhcmVEdXJhYmxlUHVibGlzaEtpdCA9IChiYWdnYWdlLCBraW5kTmFtZSkgPT4ge1xuICBjb25zdCBtYWtlTWVtb2l6ZWRVcGRhdGVSZWNvcmQgPSBtYWtlVXBkYXRlUmVjb3JkRnJvbVB1YmxpY2F0aW9uUmVjb3JkO1xuICByZXR1cm4gcHJlcGFyZUV4b0NsYXNzS2l0KFxuICAgIGJhZ2dhZ2UsXG4gICAga2luZE5hbWUsXG4gICAgcHVibGlzaEtpdElLaXQsXG4gICAgaW5pdER1cmFibGVQdWJsaXNoS2l0U3RhdGUsXG4gICAge1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICBwdWJsaXNoZXI6IHtcbiAgICAgICAgcHVibGlzaCh2YWx1ZSkge1xuICAgICAgICAgIGFkdmFuY2VEdXJhYmxlUHVibGlzaEtpdCh0aGlzLCB2YWx1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGZpbmlzaChmaW5hbFZhbHVlKSB7XG4gICAgICAgICAgYWR2YW5jZUR1cmFibGVQdWJsaXNoS2l0KHRoaXMsIGZpbmFsVmFsdWUsIFwiZmluaXNoZWRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIGZhaWwocmVhc29uKSB7XG4gICAgICAgICAgYWR2YW5jZUR1cmFibGVQdWJsaXNoS2l0KHRoaXMsIHJlYXNvbiwgXCJmYWlsZWRcIik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIHN1YnNjcmliZXI6IHtcbiAgICAgICAgc3Vic2NyaWJlQWZ0ZXIocHVibGlzaENvdW50ID0gLTFuKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgIGNvbnN0IHsgcHVibGlzaENvdW50OiBjdXJyZW50UHVibGlzaENvdW50IH0gPSBzdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IGN1cnJlbnRQLCB0YWlsUCB9ID0gcHJvdmlkZUR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YShcbiAgICAgICAgICAgIHN0YXRlLFxuICAgICAgICAgICAgZmFjZXRzXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAocHVibGlzaENvdW50ID09PSBjdXJyZW50UHVibGlzaENvdW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdGFpbFA7XG4gICAgICAgICAgfSBlbHNlIGlmIChwdWJsaXNoQ291bnQgPCBjdXJyZW50UHVibGlzaENvdW50KSB7XG4gICAgICAgICAgICByZXR1cm4gY3VycmVudFAgfHwgcHJvdmlkZUN1cnJlbnRQKHN0YXRlLCBmYWNldHMsIHRhaWxQKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgICAgIFwic3Vic2NyaWJlQWZ0ZXIgYXJndW1lbnQgbXVzdCBiZSBhIHByZXZpb3VzbHktaXNzdWVkIHB1Ymxpc2hDb3VudC5cIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KSB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgZmFjZXRzOiB7IHN1YnNjcmliZXIgfVxuICAgICAgICAgIH0gPSB0aGlzO1xuICAgICAgICAgIGlmICh1cGRhdGVDb3VudCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcigpLnRoZW4obWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdXBkYXRlQ291bnQgPSBCaWdJbnQodXBkYXRlQ291bnQpO1xuICAgICAgICAgIHJldHVybiBzdWJzY3JpYmVyLnN1YnNjcmliZUFmdGVyKHVwZGF0ZUNvdW50KS50aGVuKCgpID0+IHN1YnNjcmliZXIuZ2V0VXBkYXRlU2luY2UoKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIHN0YXRlU2hhcGU6IER1cmFibGVQdWJsaXNoS2l0U3RhdGVTaGFwZVxuICAgIH1cbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZUR1cmFibGVQdWJsaXNoS2l0KTtcbnZhciBTdWJzY3JpYmVyU2hhcGUgPSBNLnJlbW90YWJsZShcIlN1YnNjcmliZXJcIik7XG5cbi8vXG52YXIgeyBpc0Zyb3plbjogaXNGcm96ZW42IH0gPSBPYmplY3Q7XG52YXIgVXBncmFkZURpc2Nvbm5lY3Rpb25TaGFwZSA9IGhhcmRlbih7XG4gIG5hbWU6IFwidmF0VXBncmFkZWRcIixcbiAgdXBncmFkZU1lc3NhZ2U6IE0uc3RyaW5nKCksXG4gIGluY2FybmF0aW9uTnVtYmVyOiBNLm51bWJlcigpXG59KTtcbnZhciBtYWtlVXBncmFkZURpc2Nvbm5lY3Rpb24gPSAodXBncmFkZU1lc3NhZ2UsIHRvSW5jYXJuYXRpb25OdW1iZXIpID0+IGhhcmRlbih7XG4gIG5hbWU6IFwidmF0VXBncmFkZWRcIixcbiAgdXBncmFkZU1lc3NhZ2UsXG4gIGluY2FybmF0aW9uTnVtYmVyOiB0b0luY2FybmF0aW9uTnVtYmVyXG59KTtcbmhhcmRlbihtYWtlVXBncmFkZURpc2Nvbm5lY3Rpb24pO1xudmFyIGlzVXBncmFkZURpc2Nvbm5lY3Rpb24gPSAocmVhc29uKSA9PiByZWFzb24gIT0gbnVsbCAmJiAvL1xuaXNGcm96ZW42KHJlYXNvbikgJiYgbWF0Y2hlcyhyZWFzb24sIFVwZ3JhZGVEaXNjb25uZWN0aW9uU2hhcGUpO1xuaGFyZGVuKGlzVXBncmFkZURpc2Nvbm5lY3Rpb24pO1xudmFyIGlzQWJhbmRvbmVkRXJyb3IgPSAocmVhc29uKSA9PiByZWFzb24gIT0gbnVsbCAmJiAvL1xuaXNGcm96ZW42KHJlYXNvbikgJiYgbWF0Y2hlcyhyZWFzb24sIE0uZXJyb3IoKSkgJiYgLy9cbi8vXG5yZWFzb24ubWVzc2FnZSA9PT0gXCJ2YXQgdGVybWluYXRlZFwiO1xuaGFyZGVuKGlzQWJhbmRvbmVkRXJyb3IpO1xuXG4vL1xudmFyIHNpbmsyID0gKCkgPT4ge1xufTtcbnZhciByZWNvbm5lY3RBc05lZWRlZCA9IGFzeW5jIChnZXR0ZXIsIHNlZWQgPSBbXSkgPT4ge1xuICBsZXQgZGlzY29ubmVjdGlvbjtcbiAgbGV0IGxhc3RWZXJzaW9uID0gLUluZmluaXR5O1xuICBhd2FpdCBudWxsO1xuICBmb3IgKGxldCBpMiA9IDA7IDsgaTIgKz0gMSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHRQID0gaTIgPCBzZWVkLmxlbmd0aCA/IHNlZWRbaTJdIDogZ2V0dGVyKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXN1bHRQO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChpc1VwZ3JhZGVEaXNjb25uZWN0aW9uKGVycikpIHtcbiAgICAgICAgaWYgKCFkaXNjb25uZWN0aW9uKSB7XG4gICAgICAgICAgZGlzY29ubmVjdGlvbiA9IGVycjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGluY2FybmF0aW9uTnVtYmVyOiB2ZXJzaW9uIH0gPSBlcnI7XG4gICAgICAgIGlmICh2ZXJzaW9uID4gbGFzdFZlcnNpb24pIHtcbiAgICAgICAgICBsYXN0VmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChpc09iamVjdDIoZXJyKSAmJiBkaXNjb25uZWN0aW9uICYmIGRpc2Nvbm5lY3Rpb24gIT09IGVycikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIG5vdGUoXG4gICAgICAgICAgICBlcnIsXG4gICAgICAgICAgICByZWRhY3RlZGBBdHRlbXB0aW5nIHRvIHJlY292ZXIgZnJvbSBkaXNjb25uZWN0aW9uOiAke2Rpc2Nvbm5lY3Rpb259YFxuICAgICAgICAgICk7XG4gICAgICAgIH0gY2F0Y2ggKF9lcnIpIHtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxufTtcbnZhciBtYWtlRWFjaEl0ZXJhdG9yID0gKHRvcGljLCBuZXh0Q2VsbFApID0+IHtcbiAgY29uc3Qgc2VsZiA9IEZhcihcIkVhY2hJdGVyYXRvclwiLCB7XG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogKCkgPT4gc2VsZixcbiAgICBuZXh0OiAoKSA9PiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGhlYWQ6IHJlc3VsdFAsXG4gICAgICAgIHB1Ymxpc2hDb3VudDogcHVibGlzaENvdW50UCxcbiAgICAgICAgdGFpbDogdGFpbFBcbiAgICAgIH0gPSBFLmdldChuZXh0Q2VsbFApO1xuICAgICAgY29uc3QgZ2V0U3VjY2Vzc29yID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBwdWJsaXNoQ291bnQgPSBhd2FpdCBwdWJsaXNoQ291bnRQO1xuICAgICAgICBhc3NlcnQudHlwZW9mKHB1Ymxpc2hDb3VudCwgXCJiaWdpbnRcIik7XG4gICAgICAgIGNvbnN0IHN1Y2Nlc3NvciA9IGF3YWl0IEUodG9waWMpLnN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudCk7XG4gICAgICAgIGNvbnN0IG5ld1B1Ymxpc2hDb3VudCA9IHN1Y2Nlc3Nvci5wdWJsaXNoQ291bnQ7XG4gICAgICAgIGlmIChuZXdQdWJsaXNoQ291bnQgIT09IHB1Ymxpc2hDb3VudCArIDFuKSB7XG4gICAgICAgICAgdGhyb3dSZWRhY3RlZGBlYWNoSXRlcmF0b3IgYnJva2VuIGJ5IGdhcCBmcm9tIHB1Ymxpc2hDb3VudCAke3B1Ymxpc2hDb3VudH0gdG8gJHtuZXdQdWJsaXNoQ291bnR9YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3VjY2Vzc29yO1xuICAgICAgfTtcbiAgICAgIG5leHRDZWxsUCA9IHJlY29ubmVjdEFzTmVlZGVkKGdldFN1Y2Nlc3NvciwgW3RhaWxQXSk7XG4gICAgICB2b2lkIEUud2hlbihwdWJsaXNoQ291bnRQLCBzaW5rMiwgc2luazIpO1xuICAgICAgdm9pZCBFLndoZW4obmV4dENlbGxQLCBzaW5rMiwgc2luazIpO1xuICAgICAgcmV0dXJuIHJlc3VsdFA7XG4gICAgfSxcbiAgICBmb3JrOiAoKSA9PiBtYWtlRWFjaEl0ZXJhdG9yKHRvcGljLCBuZXh0Q2VsbFApXG4gIH0pO1xuICByZXR1cm4gc2VsZjtcbn07XG52YXIgc3Vic2NyaWJlRWFjaCA9ICh0b3BpYykgPT4ge1xuICBjb25zdCBpdGVyYWJsZSA9IEZhcihcIkVhY2hJdGVyYWJsZVwiLCB7XG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgY29uc3QgZmlyc3RDZWxsUCA9IHJlY29ubmVjdEFzTmVlZGVkKCgpID0+IEUodG9waWMpLnN1YnNjcmliZUFmdGVyKCkpO1xuICAgICAgcmV0dXJuIG1ha2VFYWNoSXRlcmF0b3IodG9waWMsIGZpcnN0Q2VsbFApO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBpdGVyYWJsZTtcbn07XG5oYXJkZW4oc3Vic2NyaWJlRWFjaCk7XG52YXIgY2xvbmVMYXRlc3RJdGVyYXRvciA9ICh0b3BpYywgbG9jYWxVcGRhdGVDb3VudCwgdGVybWluYWxSZXN1bHQpID0+IHtcbiAgbGV0IG11dGV4ID0gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIGNvbnN0IG1heWJlUmVxdWVzdE5leHRSZXN1bHQgPSBhc3luYyAoKSA9PiB7XG4gICAgaWYgKHRlcm1pbmFsUmVzdWx0KSB7XG4gICAgICByZXR1cm4gdGVybWluYWxSZXN1bHQ7XG4gICAgfVxuICAgIGNvbnN0IHsgdmFsdWUsIHVwZGF0ZUNvdW50IH0gPSBhd2FpdCByZWNvbm5lY3RBc05lZWRlZChcbiAgICAgICgpID0+IEUodG9waWMpLmdldFVwZGF0ZVNpbmNlKGxvY2FsVXBkYXRlQ291bnQpXG4gICAgKTtcbiAgICBsb2NhbFVwZGF0ZUNvdW50ID0gdXBkYXRlQ291bnQ7XG4gICAgaWYgKHVwZGF0ZUNvdW50ID09PSB2b2lkIDApIHtcbiAgICAgIHRlcm1pbmFsUmVzdWx0ID0gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWUgfSk7XG4gICAgICByZXR1cm4gdGVybWluYWxSZXN1bHQ7XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWUgfSk7XG4gIH07XG4gIGNvbnN0IHNlbGYgPSBGYXIoXCJMYXRlc3RJdGVyYXRvclwiLCB7XG4gICAgZm9yazogKCkgPT4gY2xvbmVMYXRlc3RJdGVyYXRvcih0b3BpYywgbG9jYWxVcGRhdGVDb3VudCwgdGVybWluYWxSZXN1bHQpLFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IHNlbGYsXG4gICAgbmV4dDogYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKHRlcm1pbmFsUmVzdWx0KSB7XG4gICAgICAgIHJldHVybiB0ZXJtaW5hbFJlc3VsdDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG5leHRSZXN1bHQgPSBtdXRleC50aGVuKG1heWJlUmVxdWVzdE5leHRSZXN1bHQpO1xuICAgICAgbXV0ZXggPSBuZXh0UmVzdWx0LnRoZW4oc2luazIsIHNpbmsyKTtcbiAgICAgIHJldHVybiBuZXh0UmVzdWx0O1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBzZWxmO1xufTtcbnZhciBtYWtlTGF0ZXN0SXRlcmF0b3IgPSAodG9waWMpID0+IGNsb25lTGF0ZXN0SXRlcmF0b3IodG9waWMpO1xudmFyIHN1YnNjcmliZUxhdGVzdCA9ICh0b3BpYykgPT4ge1xuICBjb25zdCBpdGVyYWJsZSA9IEZhcihcIkxhdGVzdEl0ZXJhYmxlXCIsIHtcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiAoKSA9PiBtYWtlTGF0ZXN0SXRlcmF0b3IodG9waWMpXG4gIH0pO1xuICByZXR1cm4gaXRlcmFibGU7XG59O1xuaGFyZGVuKHN1YnNjcmliZUxhdGVzdCk7XG5cbi8vXG52YXIgbWFrZU5vdGlmaWVyID0gKHNoYXJhYmxlSW50ZXJuYWxzUCkgPT4ge1xuICBjb25zdCBub3RpZmllciA9IEZhcihcIm5vdGlmaWVyXCIsIHtcbiAgICAuLi5zdWJzY3JpYmVMYXRlc3Qoc2hhcmFibGVJbnRlcm5hbHNQKSxcbiAgICBnZXRVcGRhdGVTaW5jZTogYXN5bmMgKHVwZGF0ZUNvdW50KSA9PiBFKHNoYXJhYmxlSW50ZXJuYWxzUCkuZ2V0VXBkYXRlU2luY2UodXBkYXRlQ291bnQpLFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICBnZXRTaGFyYWJsZU5vdGlmaWVySW50ZXJuYWxzOiBhc3luYyAoKSA9PiBzaGFyYWJsZUludGVybmFsc1AsXG4gICAgLypcblxuXG5cbiAgICAgKi9cbiAgICBnZXRTdG9yZUtleTogKCkgPT4gaGFyZGVuKHsgbm90aWZpZXIgfSlcbiAgfSk7XG4gIHJldHVybiBub3RpZmllcjtcbn07XG52YXIgbWFrZU5vdGlmaWVyRnJvbVN1YnNjcmliZXIgPSAoc3Vic2NyaWJlcikgPT4ge1xuICBjb25zdCBiYXNlTm90aWZpZXIgPSBoYXJkZW4oe1xuICAgIGdldFVwZGF0ZVNpbmNlOiAodXBkYXRlQ291bnQgPSB2b2lkIDApID0+IEUoc3Vic2NyaWJlcikuZ2V0VXBkYXRlU2luY2UodXBkYXRlQ291bnQpXG4gIH0pO1xuICBjb25zdCBub3RpZmllciA9IEZhcihcIm5vdGlmaWVyXCIsIHtcbiAgICAuLi5tYWtlTm90aWZpZXIoYmFzZU5vdGlmaWVyKSxcbiAgICAuLi5iYXNlTm90aWZpZXJcbiAgfSk7XG4gIHJldHVybiBub3RpZmllcjtcbn07XG5oYXJkZW4obWFrZU5vdGlmaWVyRnJvbVN1YnNjcmliZXIpO1xudmFyIG1ha2VOb3RpZmllcktpdCA9ICguLi5pbml0aWFsU3RhdGVBcnIpID0+IHtcbiAgY29uc3QgeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSA9IG1ha2VQdWJsaXNoS2l0KCk7XG4gIGNvbnN0IG5vdGlmaWVyID0gbWFrZU5vdGlmaWVyRnJvbVN1YnNjcmliZXIoc3Vic2NyaWJlcik7XG4gIGNvbnN0IHVwZGF0ZXIgPSBGYXIoXCJ1cGRhdGVyXCIsIHtcbiAgICB1cGRhdGVTdGF0ZTogKHN0YXRlKSA9PiBwdWJsaXNoZXIucHVibGlzaChzdGF0ZSksXG4gICAgZmluaXNoOiAoY29tcGxldGlvbikgPT4gcHVibGlzaGVyLmZpbmlzaChjb21wbGV0aW9uKSxcbiAgICBmYWlsOiAocmVhc29uKSA9PiBwdWJsaXNoZXIuZmFpbChyZWFzb24pXG4gIH0pO1xuICBhc3NlcnQyKGluaXRpYWxTdGF0ZUFyci5sZW5ndGggPD0gMSwgXCJ0b28gbWFueSBhcmd1bWVudHNcIik7XG4gIGlmIChpbml0aWFsU3RhdGVBcnIubGVuZ3RoID09PSAxKSB7XG4gICAgdXBkYXRlci51cGRhdGVTdGF0ZShpbml0aWFsU3RhdGVBcnJbMF0pO1xuICB9XG4gIHJldHVybiBoYXJkZW4oeyBub3RpZmllciwgdXBkYXRlciB9KTtcbn07XG52YXIgbWFrZU5vdGlmaWVyRnJvbUFzeW5jSXRlcmFibGUgPSAoYXN5bmNJdGVyYWJsZVApID0+IHtcbiAgY29uc3QgaXRlcmF0b3JQID0gRShhc3luY0l0ZXJhYmxlUClbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCk7XG4gIGxldCBvcHROZXh0UHJvbWlzZTtcbiAgbGV0IGN1cnJlbnRVcGRhdGVDb3VudCA9IDBuO1xuICBsZXQgY3VycmVudFJlc3BvbnNlO1xuICBsZXQgZmluYWwgPSBmYWxzZTtcbiAgY29uc3QgYmFzZU5vdGlmaWVyID0gRmFyKFwiYmFzZU5vdGlmaWVyXCIsIHtcbiAgICBnZXRVcGRhdGVTaW5jZSh1cGRhdGVDb3VudCA9IC0xbikge1xuICAgICAgaWYgKHVwZGF0ZUNvdW50IDwgY3VycmVudFVwZGF0ZUNvdW50KSB7XG4gICAgICAgIGlmIChjdXJyZW50UmVzcG9uc2UpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGN1cnJlbnRSZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodXBkYXRlQ291bnQgIT09IGN1cnJlbnRVcGRhdGVDb3VudCkge1xuICAgICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICBcImdldFVwZGF0ZVNpbmNlIGFyZ3VtZW50IG11c3QgYmUgYSBwcmV2aW91c2x5LWlzc3VlZCB1cGRhdGVDb3VudC5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKGZpbmFsKSB7XG4gICAgICAgIGFzc2VydDIoY3VycmVudFJlc3BvbnNlICE9PSB2b2lkIDApO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGN1cnJlbnRSZXNwb25zZSk7XG4gICAgICB9XG4gICAgICBpZiAoIW9wdE5leHRQcm9taXNlKSB7XG4gICAgICAgIGNvbnN0IG5leHRJdGVyUmVzdWx0UCA9IEUoaXRlcmF0b3JQKS5uZXh0KCk7XG4gICAgICAgIG9wdE5leHRQcm9taXNlID0gRS53aGVuKFxuICAgICAgICAgIG5leHRJdGVyUmVzdWx0UCxcbiAgICAgICAgICAoeyBkb25lLCB2YWx1ZSB9KSA9PiB7XG4gICAgICAgICAgICBhc3NlcnQyKCFmaW5hbCk7XG4gICAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgICBmaW5hbCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJyZW50VXBkYXRlQ291bnQgKz0gMW47XG4gICAgICAgICAgICBjdXJyZW50UmVzcG9uc2UgPSBoYXJkZW4oe1xuICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgdXBkYXRlQ291bnQ6IGRvbmUgPyB2b2lkIDAgOiBjdXJyZW50VXBkYXRlQ291bnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgb3B0TmV4dFByb21pc2UgPSB2b2lkIDA7XG4gICAgICAgICAgICByZXR1cm4gY3VycmVudFJlc3BvbnNlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgKF9yZWFzb24pID0+IHtcbiAgICAgICAgICAgIGZpbmFsID0gdHJ1ZTtcbiAgICAgICAgICAgIGN1cnJlbnRSZXNwb25zZSA9IC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgbmV4dEl0ZXJSZXN1bHRQO1xuICAgICAgICAgICAgb3B0TmV4dFByb21pc2UgPSB2b2lkIDA7XG4gICAgICAgICAgICByZXR1cm4gY3VycmVudFJlc3BvbnNlO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvcHROZXh0UHJvbWlzZTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBub3RpZmllciA9IEZhcihcIm5vdGlmaWVyXCIsIHtcbiAgICAvL1xuICAgIC8vXG4gICAgLi4ubWFrZU5vdGlmaWVyKGJhc2VOb3RpZmllciksXG4gICAgLi4uYmFzZU5vdGlmaWVyXG4gIH0pO1xuICByZXR1cm4gbm90aWZpZXI7XG59O1xuaGFyZGVuKG1ha2VOb3RpZmllckZyb21Bc3luY0l0ZXJhYmxlKTtcblxuLy9cbnZhciBtYWtlUGlubmVkSGlzdG9yeVRvcGljID0gKHRvcGljKSA9PiB7XG4gIGNvbnN0IHBpbm5lZFB1Ykxpc3QgPSB0b3BpYy5zdWJzY3JpYmVBZnRlcigpO1xuICByZXR1cm4gRmFyKFwiUGlubmVkSGlzdG9yeVRvcGljXCIsIHtcbiAgICBzdWJzY3JpYmVBZnRlcjogYXN5bmMgKHB1Ymxpc2hDb3VudCA9IC0xbikgPT4ge1xuICAgICAgaWYgKHB1Ymxpc2hDb3VudCA9PT0gLTFuKSB7XG4gICAgICAgIHJldHVybiBwaW5uZWRQdWJMaXN0O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRvcGljLnN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudCk7XG4gICAgfSxcbiAgICBnZXRVcGRhdGVTaW5jZTogYXN5bmMgKHVwZGF0ZUNvdW50ID0gdm9pZCAwKSA9PiB7XG4gICAgICByZXR1cm4gdG9waWMuZ2V0VXBkYXRlU2luY2UodXBkYXRlQ291bnQpO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VQaW5uZWRIaXN0b3J5VG9waWMpO1xuXG4vL1xudmFyIG1ha2VTdWJzY3JpcHRpb24gPSAodG9waWMpID0+IHtcbiAgY29uc3Qgc3Vic2NyaXB0aW9uID0gRmFyKFwiU3Vic2NyaXB0aW9uXCIsIHtcbiAgICAuLi5zdWJzY3JpYmVFYWNoKHRvcGljKSxcbiAgICBzdWJzY3JpYmVBZnRlcjogYXN5bmMgKHB1Ymxpc2hDb3VudCkgPT4gRSh0b3BpYykuc3Vic2NyaWJlQWZ0ZXIocHVibGlzaENvdW50KSxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgZ2V0U2hhcmFibGVTdWJzY3JpcHRpb25JbnRlcm5hbHM6IGFzeW5jICgpID0+IHRvcGljLFxuICAgIGdldFN0b3JlS2V5OiAoKSA9PiBoYXJkZW4oeyBzdWJzY3JpcHRpb24gfSlcbiAgfSk7XG4gIHJldHVybiBzdWJzY3JpcHRpb247XG59O1xuaGFyZGVuKG1ha2VTdWJzY3JpcHRpb24pO1xudmFyIG1ha2VTdWJzY3JpcHRpb25LaXQgPSAoKSA9PiB7XG4gIGNvbnN0IHsgcHVibGlzaGVyLCBzdWJzY3JpYmVyIH0gPSBtYWtlUHVibGlzaEtpdCgpO1xuICBjb25zdCBwaW5uZWRIaXN0b3J5VG9waWMgPSBtYWtlUGlubmVkSGlzdG9yeVRvcGljKHN1YnNjcmliZXIpO1xuICBjb25zdCBzdWJzY3JpcHRpb24gPSBtYWtlU3Vic2NyaXB0aW9uKHBpbm5lZEhpc3RvcnlUb3BpYyk7XG4gIGNvbnN0IHB1YmxpY2F0aW9uID0gRmFyKFwicHVibGljYXRpb25cIiwge1xuICAgIHVwZGF0ZVN0YXRlOiAobm9uRmluYWxWYWx1ZSkgPT4gcHVibGlzaGVyLnB1Ymxpc2gobm9uRmluYWxWYWx1ZSksXG4gICAgZmluaXNoOiAoY29tcGxldGlvbikgPT4gcHVibGlzaGVyLmZpbmlzaChjb21wbGV0aW9uKSxcbiAgICBmYWlsOiAocmVhc29uKSA9PiBwdWJsaXNoZXIuZmFpbChyZWFzb24pXG4gIH0pO1xuICByZXR1cm4gaGFyZGVuKHsgcHVibGljYXRpb24sIHN1YnNjcmlwdGlvbiB9KTtcbn07XG5oYXJkZW4obWFrZVN1YnNjcmlwdGlvbktpdCk7XG5cbi8vXG52YXIgb2JzZXJ2ZUl0ZXJhdG9yID0gKGFzeW5jSXRlcmF0b3JQLCBpdGVyYXRpb25PYnNlcnZlcikgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKGFjaywgb2JzZXJ2ZXJFcnJvcikgPT4ge1xuICAgIGNvbnN0IHJlY3VyID0gKCkgPT4ge1xuICAgICAgRS53aGVuKFxuICAgICAgICBFKGFzeW5jSXRlcmF0b3JQKS5uZXh0KCksXG4gICAgICAgICh7IHZhbHVlLCBkb25lIH0pID0+IHtcbiAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgaXRlcmF0aW9uT2JzZXJ2ZXIuZmluaXNoICYmIGl0ZXJhdGlvbk9ic2VydmVyLmZpbmlzaCh2YWx1ZSk7XG4gICAgICAgICAgICBhY2sodm9pZCAwKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaXRlcmF0aW9uT2JzZXJ2ZXIudXBkYXRlU3RhdGUgJiYgaXRlcmF0aW9uT2JzZXJ2ZXIudXBkYXRlU3RhdGUodmFsdWUpO1xuICAgICAgICAgICAgcmVjdXIoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIChyZWFzb24pID0+IHtcbiAgICAgICAgICBpdGVyYXRpb25PYnNlcnZlci5mYWlsICYmIGl0ZXJhdGlvbk9ic2VydmVyLmZhaWwocmVhc29uKTtcbiAgICAgICAgICBhY2sodm9pZCAwKTtcbiAgICAgICAgfVxuICAgICAgKS5jYXRjaChvYnNlcnZlckVycm9yKTtcbiAgICB9O1xuICAgIHJlY3VyKCk7XG4gIH0pO1xufTtcbnZhciBvYnNlcnZlSXRlcmF0aW9uID0gKGFzeW5jSXRlcmFibGVQLCBpdGVyYXRpb25PYnNlcnZlcikgPT4ge1xuICBjb25zdCBpdGVyYXRvclAgPSBFKGFzeW5jSXRlcmFibGVQKVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKTtcbiAgcmV0dXJuIG9ic2VydmVJdGVyYXRvcihpdGVyYXRvclAsIGl0ZXJhdGlvbk9ic2VydmVyKTtcbn07XG5cbi8vXG52YXIgQnJpZGdlSWQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBCQU5LOiBcImJhbmtcIixcbiAgICBDT1JFOiBcImNvcmVcIixcbiAgICBESUJDOiBcImRpYmNcIixcbiAgICBTVE9SQUdFOiBcInN0b3JhZ2VcIixcbiAgICBQUk9WSVNJT046IFwicHJvdmlzaW9uXCIsXG4gICAgUFJPVklTSU9OX1NNQVJUX1dBTExFVDogXCJwcm92aXNpb25XYWxsZXRcIixcbiAgICBWTE9DQUxDSEFJTjogXCJ2bG9jYWxjaGFpblwiLFxuICAgIFZUUkFOU0ZFUjogXCJ2dHJhbnNmZXJcIixcbiAgICBXQUxMRVQ6IFwid2FsbGV0XCJcbiAgfVxuKTtcbmhhcmRlbihCcmlkZ2VJZCk7XG52YXIgQ29zbW9zSW5pdEtleVRvQnJpZGdlSWQgPSB7XG4gIHZiYW5rUG9ydDogXCJiYW5rXCIsXG4gIHZpYmNQb3J0OiBcImRpYmNcIlxufTtcbmhhcmRlbihDb3Ntb3NJbml0S2V5VG9CcmlkZ2VJZCk7XG52YXIgV2FsbGV0TmFtZSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIGRlcG9zaXRGYWNldDogXCJkZXBvc2l0RmFjZXRcIlxuICB9XG4pO1xuaGFyZGVuKFdhbGxldE5hbWUpO1xudmFyIFZCYW5rQWNjb3VudCA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIHJlc2VydmU6IHtcbiAgICAgIG1vZHVsZTogXCJ2YmFuay9yZXNlcnZlXCIsXG4gICAgICBhZGRyZXNzOiBcImFnb3JpYzFhZTBsbXR6bGdyY25sYTl4amtwYWFycTVkNWRmZXo2M2gzbnVjbFwiXG4gICAgfSxcbiAgICBwcm92aXNpb246IHtcbiAgICAgIG1vZHVsZTogXCJ2YmFuay9wcm92aXNpb25cIixcbiAgICAgIGFkZHJlc3M6IFwiYWdvcmljMW1lZ3p5dGc2NWN5cmd6czZmdnp4Z3JjcXZ3d2w3dWdwdDYyMzQ2XCJcbiAgICB9XG4gIH1cbik7XG5oYXJkZW4oVkJhbmtBY2NvdW50KTtcblxuLy9cbnZhciBkZWJ1Z0luc3RhbmNlID0gMTtcbnZhciBtYWtlVHJhY2VyID0gKG5hbWUsIGVuYWJsZSA9IHRydWUpID0+IHtcbiAgZGVidWdJbnN0YW5jZSArPSAxO1xuICBsZXQgZGVidWdDb3VudCA9IDE7XG4gIGNvbnN0IGtleSA9IGAtLS0tLSAke25hbWV9LiR7ZGVidWdJbnN0YW5jZX0gYDtcbiAgc3dpdGNoIChlbmFibGUpIHtcbiAgICBjYXNlIGZhbHNlOiB7XG4gICAgICBjb25zdCBsb2dEaXNhYmxlZCA9ICguLi5fYXJncykgPT4ge1xuICAgICAgfTtcbiAgICAgIHJldHVybiBsb2dEaXNhYmxlZDtcbiAgICB9XG4gICAgY2FzZSBcInZlcmJvc2VcIjoge1xuICAgICAgY29uc3QgaW5mb1RpY2sgPSAob3B0TG9nLCAuLi5hcmdzKSA9PiB7XG4gICAgICAgIGlmIChvcHRMb2cubG9nKSB7XG4gICAgICAgICAgY29uc29sZS5pbmZvKGtleSwgZGVidWdDb3VudCArPSAxLCAuLi5hcmdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmluZm8oa2V5LCBkZWJ1Z0NvdW50ICs9IDEsIG9wdExvZywgLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gaW5mb1RpY2s7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIGNvbnN0IGRlYnVnVGljayA9IChvcHRMb2csIC4uLmFyZ3MpID0+IHtcbiAgICAgICAgaWYgKG9wdExvZy5sb2cpIHtcbiAgICAgICAgICBvcHRMb2cubG9nKGtleSwgZGVidWdDb3VudCArPSAxLCAuLi5hcmdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmluZm8oa2V5LCBkZWJ1Z0NvdW50ICs9IDEsIG9wdExvZywgLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gZGVidWdUaWNrO1xuICAgIH1cbiAgfVxufTtcbmhhcmRlbihtYWtlVHJhY2VyKTtcblxuLy9cbnZhciBOb25OdWxsaXNoID0gKHZhbCwgb3B0RGV0YWlscyA9IGB1bmV4cGVjdGVkICR7cXVvdGUodmFsKX1gKSA9PiB7XG4gIGlmICh2YWwgIT0gbnVsbCkge1xuICAgIHJldHVybiB2YWw7XG4gIH1cbiAgYXNzZXJ0LmZhaWwob3B0RGV0YWlscyk7XG59O1xuaGFyZGVuKE5vbk51bGxpc2gpO1xuXG4vL1xudmFyIHsgZGVmaW5lUHJvcGVydHk6IGRlZmluZVByb3BlcnR5MiB9ID0gT2JqZWN0O1xudmFyIHR5cGVkRW50cmllcyA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICovXG4gIE9iamVjdC5lbnRyaWVzXG4pO1xudmFyIGZyb21UeXBlZEVudHJpZXMgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgT2JqZWN0LmZyb21FbnRyaWVzXG4pO1xudmFyIHR5cGVkTWFwID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICBGdW5jdGlvbi5wcm90b3R5cGUuY2FsbC5iaW5kKEFycmF5LnByb3RvdHlwZS5tYXApXG4pO1xudmFyIGxvZ0xldmVscyA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgW1xuICAgIFwiZGVidWdcIixcbiAgICBcImxvZ1wiLFxuICAgIFwiaW5mb1wiLFxuICAgIFwid2FyblwiLFxuICAgIFwiZXJyb3JcIlxuICBdXG4pO1xuT2JqZWN0LmZyZWV6ZShsb2dMZXZlbHMpO1xudmFyIGRlZXBNYXBPYmplY3RJbnRlcm5hbCA9ICh2YWx1ZSwgbmFtZSwgY29udGFpbmVyLCBtYXBwZXIpID0+IHtcbiAgaWYgKGNvbnRhaW5lciAmJiB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIikge1xuICAgIGNvbnN0IG1hcHBlZCA9IG1hcHBlcih2YWx1ZSwgbmFtZSwgY29udGFpbmVyKTtcbiAgICBpZiAobWFwcGVkICE9PSB2YWx1ZSkge1xuICAgICAgcmV0dXJuIG1hcHBlZDtcbiAgICB9XG4gIH1cbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJvYmplY3RcIiB8fCAhdmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgbGV0IHdhc01hcHBlZCA9IGZhbHNlO1xuICBjb25zdCB2YWx1ZU9iaiA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHZhbHVlXG4gICk7XG4gIGNvbnN0IG1hcEVudHJ5ID0gKFtpbm5lck5hbWUsIGlubmVyVmFsdWVdKSA9PiB7XG4gICAgY29uc3QgbWFwcGVkSW5uZXJWYWx1ZSA9IGRlZXBNYXBPYmplY3RJbnRlcm5hbChcbiAgICAgIGlubmVyVmFsdWUsXG4gICAgICBpbm5lck5hbWUsXG4gICAgICB2YWx1ZU9iaixcbiAgICAgIG1hcHBlclxuICAgICk7XG4gICAgd2FzTWFwcGVkIHx8PSBtYXBwZWRJbm5lclZhbHVlICE9PSBpbm5lclZhbHVlO1xuICAgIHJldHVybiBbXG4gICAgICBpbm5lck5hbWUsXG4gICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgIG1hcHBlZElubmVyVmFsdWVcbiAgICBdO1xuICB9O1xuICBjb25zdCBtYXBwZWRFbnRyaWVzID0gdHlwZWRFbnRyaWVzKHZhbHVlT2JqKS5tYXAobWFwRW50cnkpO1xuICBpZiAoIXdhc01hcHBlZCkge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBjb25zdCBtYXBwZWRPYmogPSBmcm9tVHlwZWRFbnRyaWVzKG1hcHBlZEVudHJpZXMpO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAqL1xuICAgIG1hcHBlZE9ialxuICApO1xufTtcbnZhciBkZWVwTWFwT2JqZWN0ID0gKG9iaiwgbWFwcGVyKSA9PiAoXG4gIC8qICAgICAgICAgICAgICAqL1xuICBkZWVwTWFwT2JqZWN0SW50ZXJuYWwob2JqLCB2b2lkIDAsIHZvaWQgMCwgbWFwcGVyKVxuKTtcbnZhciBwcm92aWRlTGF6eU1hcCA9IChtYXAsIGtleSwgbWFrZVZhbHVlKSA9PiB7XG4gIGNvbnN0IGZvdW5kID0gbWFwLmdldChrZXkpO1xuICBpZiAoZm91bmQgIT09IHZvaWQgMCB8fCBtYXAuaGFzKGtleSkpIHtcbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgZm91bmRcbiAgICApO1xuICB9XG4gIGNvbnN0IHZhbHVlID0gbWFrZVZhbHVlKGtleSk7XG4gIG1hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gIHJldHVybiB2YWx1ZTtcbn07XG5cbi8vXG52YXIgZGV0YWNoZWRIZWFwU3RvcmVzID0gRmFyKFwiaGVhcFN0b3Jlc1wiLCB7XG4gIGRldGFjaGVkOiAoKSA9PiBkZXRhY2hlZEhlYXBTdG9yZXMsXG4gIGlzU3RvcmFibGU6IGlzUGFzc2FibGUsXG4gIHNldFN0b3JlOiBtYWtlU2NhbGFyU2V0U3RvcmUsXG4gIG1hcFN0b3JlOiBtYWtlU2NhbGFyTWFwU3RvcmUsXG4gIHdlYWtNYXBTdG9yZTogbWFrZVNjYWxhcldlYWtNYXBTdG9yZSxcbiAgd2Vha1NldFN0b3JlOiBtYWtlU2NhbGFyV2Vha1NldFN0b3JlXG59KTtcbnZhciBtYWtlSGVhcFpvbmUgPSAoYmFzZUxhYmVsID0gXCJoZWFwWm9uZVwiKSA9PiB7XG4gIGNvbnN0IHsgbWFrZU9uY2UsIHdyYXBQcm92aWRlciB9ID0gbWFrZU9uY2VLaXQoYmFzZUxhYmVsLCBkZXRhY2hlZEhlYXBTdG9yZXMpO1xuICBjb25zdCBtYWtlU3ViWm9uZSA9IChsYWJlbCwgX29wdGlvbnMpID0+IG1ha2VIZWFwWm9uZShgJHtiYXNlTGFiZWx9LiR7bGFiZWx9YCk7XG4gIHJldHVybiBGYXIoXCJoZWFwWm9uZVwiLCB7XG4gICAgZXhvOiB3cmFwUHJvdmlkZXIobWFrZUV4bywgYWdvcmljVmF0RGF0YUtleXMuZXhvKSxcbiAgICBleG9DbGFzczogd3JhcFByb3ZpZGVyKGRlZmluZUV4b0NsYXNzLCBhZ29yaWNWYXREYXRhS2V5cy5leG9DbGFzcyksXG4gICAgZXhvQ2xhc3NLaXQ6IHdyYXBQcm92aWRlcihkZWZpbmVFeG9DbGFzc0tpdCwgYWdvcmljVmF0RGF0YUtleXMuZXhvQ2xhc3NLaXQpLFxuICAgIHN1YlpvbmU6IHdyYXBQcm92aWRlcihtYWtlU3ViWm9uZSksXG4gICAgbWFrZU9uY2UsXG4gICAgd2F0Y2hQcm9taXNlOiB3YXRjaFByb21pc2UyLFxuICAgIGRldGFjaGVkOiBkZXRhY2hlZEhlYXBTdG9yZXMuZGV0YWNoZWQsXG4gICAgaXNTdG9yYWJsZTogZGV0YWNoZWRIZWFwU3RvcmVzLmlzU3RvcmFibGUsXG4gICAgbWFwU3RvcmU6IHdyYXBQcm92aWRlcihkZXRhY2hlZEhlYXBTdG9yZXMubWFwU3RvcmUpLFxuICAgIHNldFN0b3JlOiB3cmFwUHJvdmlkZXIoZGV0YWNoZWRIZWFwU3RvcmVzLnNldFN0b3JlKSxcbiAgICB3ZWFrTWFwU3RvcmU6IHdyYXBQcm92aWRlcihkZXRhY2hlZEhlYXBTdG9yZXMud2Vha01hcFN0b3JlKSxcbiAgICB3ZWFrU2V0U3RvcmU6IHdyYXBQcm92aWRlcihkZXRhY2hlZEhlYXBTdG9yZXMud2Vha1NldFN0b3JlKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUhlYXBab25lKTtcblxuLy9cbnZhciB7IGZyb21FbnRyaWVzOiBmcm9tRW50cmllczkgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IHJhd093bktleXMgfSA9IFJlZmxlY3Q7XG52YXIgb3duS2V5czE5ID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICByYXdPd25LZXlzXG4pO1xudmFyIGlzUHJvcGVydHlLZXkgPSAoa2V5KSA9PiB7XG4gIHN3aXRjaCAodHlwZW9mIGtleSkge1xuICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgY2FzZSBcInN5bWJvbFwiOlxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcbnZhciBjYWxsU3luYyA9IChjYWxsYmFjaywgLi4uYXJncykgPT4ge1xuICBjb25zdCB7IHRhcmdldCwgbWV0aG9kTmFtZSwgYm91bmQgfSA9IGNhbGxiYWNrO1xuICBpZiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRhcmdldCguLi5ib3VuZCwgLi4uYXJncyk7XG4gIH1cbiAgcmV0dXJuIHRhcmdldFttZXRob2ROYW1lXSguLi5ib3VuZCwgLi4uYXJncyk7XG59O1xuaGFyZGVuKGNhbGxTeW5jKTtcbnZhciBjYWxsRSA9IChjYWxsYmFjaywgLi4uYXJncykgPT4ge1xuICBjb25zdCB7IHRhcmdldCwgbWV0aG9kTmFtZSwgYm91bmQgfSA9IGNhbGxiYWNrO1xuICBpZiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIEUodGFyZ2V0KSguLi5ib3VuZCwgLi4uYXJncyk7XG4gIH1cbiAgcmV0dXJuIEUodGFyZ2V0KVttZXRob2ROYW1lXSguLi5ib3VuZCwgLi4uYXJncyk7XG59O1xuaGFyZGVuKGNhbGxFKTtcbnZhciBtYWtlU3luY0Z1bmN0aW9uQ2FsbGJhY2sgPSAodGFyZ2V0LCAuLi5ib3VuZCkgPT4ge1xuICB0eXBlb2YgdGFyZ2V0ID09PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGBzeW5jIGZ1bmN0aW9uIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGEgZnVuY3Rpb246ICR7dGFyZ2V0fWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBib3VuZCwgaXNTeW5jOiB0cnVlIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VTeW5jRnVuY3Rpb25DYWxsYmFjayk7XG52YXIgbWFrZUZ1bmN0aW9uQ2FsbGJhY2sgPSAodGFyZ2V0LCAuLi5ib3VuZCkgPT4ge1xuICBpc09iamVjdDIodGFyZ2V0KSB8fCB0aHJvd1JlZGFjdGVkYGZ1bmN0aW9uIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGEgZnVuY3Rpb24gcHJlc2VuY2U6ICR7dGFyZ2V0fWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBib3VuZCB9KTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VGdW5jdGlvbkNhbGxiYWNrKTtcbnZhciBtYWtlU3luY01ldGhvZENhbGxiYWNrID0gKHRhcmdldCwgbWV0aG9kTmFtZSwgLi4uYm91bmQpID0+IHtcbiAgaXNPYmplY3QyKHRhcmdldCkgfHwgdGhyb3dSZWRhY3RlZGBzeW5jIG1ldGhvZCBjYWxsYmFjayB0YXJnZXQgbXVzdCBiZSBhbiBvYmplY3Q6ICR7dGFyZ2V0fWA7XG4gIHR5cGVvZiBtZXRob2ROYW1lID09PSBcInN0cmluZ1wiIHx8IGlzUGFzc2FibGVTeW1ib2wobWV0aG9kTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBtZXRob2QgbmFtZSBtdXN0IGJlIGEgc3RyaW5nIG9yIHBhc3NhYmxlIHN5bWJvbDogJHttZXRob2ROYW1lfWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBtZXRob2ROYW1lLCBib3VuZCwgaXNTeW5jOiB0cnVlIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VTeW5jTWV0aG9kQ2FsbGJhY2spO1xudmFyIG1ha2VNZXRob2RDYWxsYmFjayA9ICh0YXJnZXQsIG1ldGhvZE5hbWUsIC4uLmJvdW5kKSA9PiB7XG4gIGlzT2JqZWN0Mih0YXJnZXQpIHx8IHRocm93UmVkYWN0ZWRgbWV0aG9kIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGFuIG9iamVjdDogJHt0YXJnZXR9YDtcbiAgdHlwZW9mIG1ldGhvZE5hbWUgPT09IFwic3RyaW5nXCIgfHwgaXNQYXNzYWJsZVN5bWJvbChtZXRob2ROYW1lKSB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZCBuYW1lIG11c3QgYmUgYSBzdHJpbmcgb3IgcGFzc2FibGUgc3ltYm9sOiAke21ldGhvZE5hbWV9YDtcbiAgY29uc3QgY2IgPSBoYXJkZW4oeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgY2JcbiAgKTtcbn07XG5oYXJkZW4obWFrZU1ldGhvZENhbGxiYWNrKTtcbnZhciBpc0NhbGxiYWNrID0gKGNhbGxiYWNrKSA9PiB7XG4gIGlmICghaXNPYmplY3QyKGNhbGxiYWNrKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCB7IHRhcmdldCwgbWV0aG9kTmFtZSwgYm91bmQgfSA9IGNhbGxiYWNrO1xuICByZXR1cm4gaXNPYmplY3QyKHRhcmdldCkgJiYgKG1ldGhvZE5hbWUgPT09IHZvaWQgMCB8fCB0eXBlb2YgbWV0aG9kTmFtZSA9PT0gXCJzdHJpbmdcIiB8fCBpc1Bhc3NhYmxlU3ltYm9sKG1ldGhvZE5hbWUpKSAmJiBBcnJheS5pc0FycmF5KGJvdW5kKTtcbn07XG5oYXJkZW4oaXNDYWxsYmFjayk7XG52YXIgcHJlcGFyZUF0dGVudWF0b3IgPSAoem9uZSwgbWV0aG9kTmFtZXMsIHsgaW50ZXJmYWNlR3VhcmQsIHRhZyA9IFwiQXR0ZW51YXRvclwiIH0gPSB7fSkgPT4ge1xuICBjb25zdCBtZXRob2RzID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBmcm9tRW50cmllczkoXG4gICAgICBtZXRob2ROYW1lcy5tYXAoKGtleSkgPT4ge1xuICAgICAgICBpZiAoIWlzUHJvcGVydHlLZXkoa2V5KSkge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRga2V5ICR7cXVvdGUoa2V5KX0gaXMgbm90IGEgUHJvcGVydHlLZXlgO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG0yID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB7XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgW2tleV0oLi4uYXJncykge1xuICAgICAgICAgICAgICBjb25zdCBjYiA9IHRoaXMuc3RhdGUuY2JzW2tleV07XG4gICAgICAgICAgICAgIGlmICghY2IpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSBtYWtlRXJyb3IoYHVuaW1wbGVtZW50ZWQgJHtxdW90ZSh0YWcpfSBtZXRob2QgJHtxdW90ZShrZXkpfWApO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmlzU3luYykge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoY2IuaXNTeW5jKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxTeW5jKGNiLCAuLi5hcmdzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gY2FsbEUoY2IsIC4uLmFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1ba2V5XVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgW2tleSwgbTJdXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgIClcbiAgKTtcbiAgY29uc3QgbWFrZUF0dGVudWF0b3IgPSB6b25lLmV4b0NsYXNzKFxuICAgIHRhZyxcbiAgICBpbnRlcmZhY2VHdWFyZCxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgKHtcbiAgICAgIHRhcmdldCA9IG51bGwsXG4gICAgICBpc1N5bmMgPSBmYWxzZSxcbiAgICAgIG92ZXJyaWRlcyA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHt9XG4gICAgICApXG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgY2JzID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAge31cbiAgICAgICk7XG4gICAgICBjb25zdCByZW1haW5pbmcgPSBuZXcgU2V0KG1ldGhvZE5hbWVzKTtcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIG93bktleXMxOShvdmVycmlkZXMpKSB7XG4gICAgICAgIHJlbWFpbmluZy5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gb3ZlcnJpZGVzWyR7cXVvdGUoa2V5KX1dIG5vdCBhbGxvd2VkIGJ5IG1ldGhvZE5hbWVzYDtcbiAgICAgICAgcmVtYWluaW5nLmRlbGV0ZShrZXkpO1xuICAgICAgICBjb25zdCBjYiA9IG92ZXJyaWRlc1trZXldO1xuICAgICAgICBjYiA9PSBudWxsIHx8IGlzQ2FsbGJhY2soY2IpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBvdmVycmlkZXNbJHtxdW90ZShrZXkpfV0gaXMgbm90IGEgY2FsbGJhY2s7IGdvdCAke2NifWA7XG4gICAgICAgIGNic1trZXldID0gY2I7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiByZW1haW5pbmcpIHtcbiAgICAgICAgaWYgKGlzU3luYykge1xuICAgICAgICAgIGNic1trZXldID0gbWFrZVN5bmNNZXRob2RDYWxsYmFjayh0YXJnZXQsIGtleSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2JzW2tleV0gPSBtYWtlTWV0aG9kQ2FsbGJhY2sodGFyZ2V0LCBrZXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gaGFyZGVuKHsgY2JzLCBpc1N5bmMgfSk7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgbWV0aG9kc1xuICApO1xuICByZXR1cm4gbWFrZUF0dGVudWF0b3I7XG59O1xuaGFyZGVuKHByZXBhcmVBdHRlbnVhdG9yKTtcbnZhciBwcmVwYXJlR3VhcmRlZEF0dGVudWF0b3IgPSAoem9uZSwgaW50ZXJmYWNlR3VhcmQsIG9wdHMgPSB7fSkgPT4ge1xuICBjb25zdCBtZXRob2ROYW1lcyA9IGdldEludGVyZmFjZU1ldGhvZEtleXMoaW50ZXJmYWNlR3VhcmQpO1xuICBjb25zdCBtYWtlQXR0ZW51YXRvciA9IHByZXBhcmVBdHRlbnVhdG9yKHpvbmUsIG1ldGhvZE5hbWVzLCB7XG4gICAgLi4ub3B0cyxcbiAgICBpbnRlcmZhY2VHdWFyZFxuICB9KTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgbWFrZUF0dGVudWF0b3JcbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZUd1YXJkZWRBdHRlbnVhdG9yKTtcblxuLy9cbnZhciBTdHJlYW1DZWxsU2hhcGUgPSBoYXJkZW4oe1xuICBibG9ja0hlaWdodDogTS5zdHJpbmcoKSxcbiAgdmFsdWVzOiBNLmFycmF5KClcbn0pO1xudmFyIENoYWluU3RvcmFnZU5vZGVJID0gTS5pbnRlcmZhY2UoXCJTdG9yYWdlTm9kZVwiLCB7XG4gIHNldFZhbHVlOiBNLmNhbGxXaGVuKE0uc3RyaW5nKCkpLnJldHVybnMoKSxcbiAgZ2V0UGF0aDogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgZ2V0U3RvcmVLZXk6IE0uY2FsbFdoZW4oKS5yZXR1cm5zKE0ucmVjb3JkKCkpLFxuICBtYWtlQ2hpbGROb2RlOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5zcGxpdFJlY29yZCh7fSwgeyBzZXF1ZW5jZTogTS5ib29sZWFuKCkgfSwge30pKS5yZXR1cm5zKE0ucmVtb3RhYmxlKFwiU3RvcmFnZU5vZGVcIikpXG59KTtcbnZhciBpc1N0cmVhbUNlbGwgPSAoY2VsbCkgPT4gY2VsbCAmJiB0eXBlb2YgY2VsbCA9PT0gXCJvYmplY3RcIiAmJiBBcnJheS5pc0FycmF5KGNlbGwudmFsdWVzKSAmJiB0eXBlb2YgY2VsbC5ibG9ja0hlaWdodCA9PT0gXCJzdHJpbmdcIiAmJiAvXjAkfF5bMS05XVswLTldKiQvLnRlc3QoY2VsbC5ibG9ja0hlaWdodCk7XG5oYXJkZW4oaXNTdHJlYW1DZWxsKTtcbnZhciBwYXRoU2VnbWVudFBhdHRlcm4gPSAvXlthLXpBLVowLTlfLV17MSwxMDB9JC87XG52YXIgYXNzZXJ0UGF0aFNlZ21lbnQgPSAobmFtZSkgPT4ge1xuICBwYXRoU2VnbWVudFBhdHRlcm4udGVzdChuYW1lKSB8fCB0aHJvd1JlZGFjdGVkYFBhdGggc2VnbWVudCBuYW1lcyBtdXN0IGNvbnNpc3Qgb2YgMSB0byAxMDAgY2hhcmFjdGVycyBsaW1pdGVkIHRvIEFTQ0lJIGFscGhhbnVtZXJpY3MsIHVuZGVyc2NvcmVzLCBhbmQvb3IgZGFzaGVzOiAke25hbWV9YDtcbn07XG5oYXJkZW4oYXNzZXJ0UGF0aFNlZ21lbnQpO1xudmFyIHByZXBhcmVDaGFpblN0b3JhZ2VOb2RlID0gKHpvbmUpID0+IHtcbiAgY29uc3QgbWFrZUNoYWluU3RvcmFnZU5vZGUgPSB6b25lLmV4b0NsYXNzKFxuICAgIFwiQ2hhaW5TdG9yYWdlTm9kZVwiLFxuICAgIENoYWluU3RvcmFnZU5vZGVJLFxuICAgIC8qXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgKG1lc3NlbmdlciwgcGF0aCwgeyBzZXF1ZW5jZSA9IGZhbHNlIH0gPSB7fSkgPT4ge1xuICAgICAgYXNzZXJ0LnR5cGVvZihwYXRoLCBcInN0cmluZ1wiKTtcbiAgICAgIGFzc2VydC50eXBlb2Yoc2VxdWVuY2UsIFwiYm9vbGVhblwiKTtcbiAgICAgIHJldHVybiBoYXJkZW4oeyBwYXRoLCBtZXNzZW5nZXIsIHNlcXVlbmNlIH0pO1xuICAgIH0sXG4gICAge1xuICAgICAgZ2V0UGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUucGF0aDtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgYXN5bmMgZ2V0U3RvcmVLZXkoKSB7XG4gICAgICAgIGNvbnN0IHsgcGF0aCwgbWVzc2VuZ2VyIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gY2FsbEUobWVzc2VuZ2VyLCB7XG4gICAgICAgICAgbWV0aG9kOiBcImdldFN0b3JlS2V5XCIsXG4gICAgICAgICAgYXJnczogW3BhdGhdXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgbWFrZUNoaWxkTm9kZShuYW1lLCBjaGlsZE5vZGVPcHRpb25zID0ge30pIHtcbiAgICAgICAgY29uc3QgeyBzZXF1ZW5jZSwgcGF0aCwgbWVzc2VuZ2VyIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBhc3NlcnRQYXRoU2VnbWVudChuYW1lKTtcbiAgICAgICAgY29uc3QgbWVyZ2VkT3B0aW9ucyA9IHsgc2VxdWVuY2UsIC4uLmNoaWxkTm9kZU9wdGlvbnMgfTtcbiAgICAgICAgcmV0dXJuIG1ha2VDaGFpblN0b3JhZ2VOb2RlKFxuICAgICAgICAgIG1lc3NlbmdlcixcbiAgICAgICAgICBgJHtwYXRofS4ke25hbWV9YCxcbiAgICAgICAgICBtZXJnZWRPcHRpb25zXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGFzeW5jIHNldFZhbHVlKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHsgc2VxdWVuY2UsIHBhdGgsIG1lc3NlbmdlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgYXNzZXJ0LnR5cGVvZih2YWx1ZSwgXCJzdHJpbmdcIik7XG4gICAgICAgIGxldCBlbnRyeTtcbiAgICAgICAgaWYgKCFzZXF1ZW5jZSAmJiAhdmFsdWUpIHtcbiAgICAgICAgICBlbnRyeSA9IFtwYXRoXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbnRyeSA9IFtwYXRoLCB2YWx1ZV07XG4gICAgICAgIH1cbiAgICAgICAgYXdhaXQgY2FsbEUobWVzc2VuZ2VyLCB7XG4gICAgICAgICAgbWV0aG9kOiBzZXF1ZW5jZSA/IFwiYXBwZW5kXCIgOiBcInNldFwiLFxuICAgICAgICAgIGFyZ3M6IFtlbnRyeV1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgIH1cbiAgKTtcbiAgcmV0dXJuIG1ha2VDaGFpblN0b3JhZ2VOb2RlO1xufTtcbnZhciBtYWtlSGVhcENoYWluU3RvcmFnZU5vZGUgPSBwcmVwYXJlQ2hhaW5TdG9yYWdlTm9kZShtYWtlSGVhcFpvbmUoKSk7XG5mdW5jdGlvbiBtYWtlQ2hhaW5TdG9yYWdlUm9vdChoYW5kbGVTdG9yYWdlTWVzc2FnZSwgcm9vdFBhdGgsIHJvb3RPcHRpb25zID0ge30pIHtcbiAgY29uc3QgbWVzc2VuZ2VyID0gbWFrZUZ1bmN0aW9uQ2FsbGJhY2soaGFuZGxlU3RvcmFnZU1lc3NhZ2UpO1xuICBjb25zdCByb290Tm9kZSA9IG1ha2VIZWFwQ2hhaW5TdG9yYWdlTm9kZShtZXNzZW5nZXIsIHJvb3RQYXRoLCByb290T3B0aW9ucyk7XG4gIHJldHVybiByb290Tm9kZTtcbn1cbnZhciBtYWtlTnVsbFN0b3JhZ2VOb2RlID0gKCkgPT4ge1xuICByZXR1cm4gbWFrZUNoYWluU3RvcmFnZVJvb3QoXG4gICAgRmFyKFwiTnVsbE1lc3NlbmdlclwiLCAoKSA9PiBudWxsKSxcbiAgICBcIm51bGxcIlxuICApO1xufTtcbmFzeW5jIGZ1bmN0aW9uIG1ha2VTdG9yYWdlTm9kZUNoaWxkKHN0b3JhZ2VOb2RlUmVmLCBjaGlsZE5hbWUpIHtcbiAgY29uc3QgZXhpc3RpbmdTdG9yYWdlTm9kZSA9IGF3YWl0IHN0b3JhZ2VOb2RlUmVmO1xuICBjb25zdCBzdG9yYWdlTm9kZSA9IGV4aXN0aW5nU3RvcmFnZU5vZGUgfHwgbWFrZU51bGxTdG9yYWdlTm9kZSgpO1xuICByZXR1cm4gRShzdG9yYWdlTm9kZSkubWFrZUNoaWxkTm9kZShjaGlsZE5hbWUpO1xufVxuaGFyZGVuKG1ha2VTdG9yYWdlTm9kZUNoaWxkKTtcbnZhciBtYWtlU2VyaWFsaXplVG9TdG9yYWdlID0gKHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKSA9PiB7XG4gIHJldHVybiBhc3luYyAodmFsdWUpID0+IHtcbiAgICBjb25zdCBtYXJzaGFsbGVkID0gYXdhaXQgRShtYXJzaGFsbGVyKS50b0NhcERhdGEodmFsdWUpO1xuICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSBKU09OLnN0cmluZ2lmeShtYXJzaGFsbGVkKTtcbiAgICByZXR1cm4gRShzdG9yYWdlTm9kZSkuc2V0VmFsdWUoc2VyaWFsaXplZCk7XG4gIH07XG59O1xuXG4vL1xudmFyIENhcERhdGFTaGFwZSA9IHsgYm9keTogTS5zdHJpbmcoKSwgc2xvdHM6IE0uYXJyYXkoKSB9O1xuaGFyZGVuKENhcERhdGFTaGFwZSk7XG52YXIgYXNzZXJ0Q2FwRGF0YSA9IChkYXRhKSA9PiB7XG4gIGFzc2VydC50eXBlb2YoZGF0YSwgXCJvYmplY3RcIik7XG4gIGFzc2VydChkYXRhKTtcbiAgdHlwZW9mIGRhdGEuYm9keSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGRhdGEgaGFzIG5vbi1zdHJpbmcgLmJvZHkgJHtkYXRhLmJvZHl9YDtcbiAgQXJyYXkuaXNBcnJheShkYXRhLnNsb3RzKSB8fCB0aHJvd1JlZGFjdGVkYGRhdGEgaGFzIG5vbi1BcnJheSBzbG90cyAke2RhdGEuc2xvdHN9YDtcbn07XG5oYXJkZW4oYXNzZXJ0Q2FwRGF0YSk7XG52YXIgdW5tYXJzaGFsRnJvbVZzdG9yYWdlID0gKGRhdGEsIGtleSwgZnJvbUNhcERhdGEsIGluZGV4KSA9PiB7XG4gIGNvbnN0IHNlcmlhbGl6ZWQgPSBkYXRhLmdldChrZXkpIHx8IHRocm93UmVkYWN0ZWRgbm8gZGF0YSBmb3IgJHtrZXl9YDtcbiAgYXNzZXJ0LnR5cGVvZihzZXJpYWxpemVkLCBcInN0cmluZ1wiKTtcbiAgYXNzZXJ0LnR5cGVvZihpbmRleCwgXCJudW1iZXJcIik7XG4gIGNvbnN0IHN0cmVhbUNlbGwgPSBKU09OLnBhcnNlKHNlcmlhbGl6ZWQpO1xuICBpZiAoIWlzU3RyZWFtQ2VsbChzdHJlYW1DZWxsKSkge1xuICAgIHRocm93IHRocm93UmVkYWN0ZWRgbm90IGEgU3RyZWFtQ2VsbDogJHtzdHJlYW1DZWxsfWA7XG4gIH1cbiAgY29uc3QgeyB2YWx1ZXM6IHZhbHVlczYgfSA9IHN0cmVhbUNlbGw7XG4gIHZhbHVlczYubGVuZ3RoID4gMCB8fCB0aHJvd1JlZGFjdGVkYG5vIFN0cmVhbUNlbGwgdmFsdWVzOiAke3N0cmVhbUNlbGx9YDtcbiAgY29uc3QgbWFyc2hhbGxlZCA9IHZhbHVlczYuYXQoaW5kZXgpO1xuICBhc3NlcnQudHlwZW9mKG1hcnNoYWxsZWQsIFwic3RyaW5nXCIpO1xuICBjb25zdCBjYXBEYXRhID0gaGFyZGVuKEpTT04ucGFyc2UobWFyc2hhbGxlZCkpO1xuICBhc3NlcnRDYXBEYXRhKGNhcERhdGEpO1xuICBjb25zdCB1bm1hcnNoYWxsZWQgPSBmcm9tQ2FwRGF0YShjYXBEYXRhKTtcbiAgcmV0dXJuIHVubWFyc2hhbGxlZDtcbn07XG5oYXJkZW4odW5tYXJzaGFsRnJvbVZzdG9yYWdlKTtcbnZhciByZWplY3RPQ2FwID0gKGNhcCkgPT4gdGhyb3dSZWRhY3RlZGAke2NhcH0gaXMgbm90IHB1cmUgZGF0YWA7XG52YXIgcHVyZURhdGFNYXJzaGFsbGVyID0gbWFrZU1hcnNoYWwocmVqZWN0T0NhcCwgcmVqZWN0T0NhcCwge1xuICBzZXJpYWxpemVCb2R5Rm9ybWF0OiBcInNtYWxsY2Fwc1wiXG59KTtcbmhhcmRlbihwdXJlRGF0YU1hcnNoYWxsZXIpO1xuXG4vL1xudmFyIHsgY3JlYXRlOiBjcmVhdGU0LCBmcm9tRW50cmllczogZnJvbUVudHJpZXMxMCB9ID0gT2JqZWN0O1xudmFyIHsgYXBwbHk6IGFwcGx5NiB9ID0gUmVmbGVjdDtcbnZhciBnZXRNZXRob2ROYW1lczIgPSAodmFsKSA9PiAoXG4gIC8qICAgICAgICAgICAgICAqL1xuICBnZXRNZXRob2ROYW1lcyh2YWwpXG4pO1xuaGFyZGVuKGdldE1ldGhvZE5hbWVzMik7XG52YXIgYmluZEFsbE1ldGhvZHMgPSAob2JqKSA9PiBoYXJkZW4oXG4gIGNyZWF0ZTQoXG4gICAgb2JqLFxuICAgIGZyb21FbnRyaWVzMTAoXG4gICAgICBnZXRNZXRob2ROYW1lcyhvYmopLm1hcCgobmFtZSkgPT4gW1xuICAgICAgICBuYW1lLFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6ICguLi5hcmdzKSA9PiBhcHBseTYob2JqW25hbWVdLCBvYmosIGFyZ3MpLFxuICAgICAgICAgIGVudW1lcmFibGU6IHRydWVcbiAgICAgICAgfVxuICAgICAgXSlcbiAgICApXG4gIClcbik7XG5oYXJkZW4oYmluZEFsbE1ldGhvZHMpO1xuXG4vL1xudmFyIEhJU1RPR1JBTV9NU19MQVRFTkNZX0JPVU5EQVJJRVMgPSBbXG4gIDUsXG4gIDEwLFxuICAyNSxcbiAgNTAsXG4gIDEwMCxcbiAgMjUwLFxuICA1MDAsXG4gIDFlMyxcbiAgMjUwMCxcbiAgNWUzLFxuICAxZTQsXG4gIEluZmluaXR5XG5dO1xudmFyIEhJU1RPR1JBTV9TRUNPTkRTX0xBVEVOQ1lfQk9VTkRBUklFUyA9IEhJU1RPR1JBTV9NU19MQVRFTkNZX0JPVU5EQVJJRVMubWFwKChtcykgPT4gbXMgLyAxZTMpO1xudmFyIEhJU1RPR1JBTV9NRVRSSUNTID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgc3dpbmdzZXRfY3JhbmtfcHJvY2Vzc2luZ190aW1lOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQcm9jZXNzaW5nIHRpbWUgcGVyIGNyYW5rIChtcylcIixcbiAgICAgIHVuaXQ6IFwibXNcIixcbiAgICAgIGJvdW5kYXJpZXM6IEFycmF5Lm9mKDEsIDExLCAyMSwgMzEsIDQxLCA1MSwgNjEsIDcxLCA4MSwgOTEsIEluZmluaXR5KVxuICAgIH0sXG4gICAgc3dpbmdzZXRfYmxvY2tfcHJvY2Vzc2luZ19zZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQcm9jZXNzaW5nIHRpbWUgcGVyIGJsb2NrXCIsXG4gICAgICB1bml0OiBcInNcIixcbiAgICAgIGJvdW5kYXJpZXM6IEhJU1RPR1JBTV9TRUNPTkRTX0xBVEVOQ1lfQk9VTkRBUklFU1xuICAgIH0sXG4gICAgc3dpbmdzZXRfdmF0X3N0YXJ0dXA6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlZhdCBzdGFydHVwIHRpbWUgKG1zKVwiLFxuICAgICAgdW5pdDogXCJtc1wiLFxuICAgICAgYm91bmRhcmllczogSElTVE9HUkFNX01TX0xBVEVOQ1lfQk9VTkRBUklFU1xuICAgIH0sXG4gICAgc3dpbmdzZXRfdmF0X2RlbGl2ZXJ5OiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJWYXQgZGVsaXZlcnkgdGltZSAobXMpXCIsXG4gICAgICB1bml0OiBcIm1zXCIsXG4gICAgICBib3VuZGFyaWVzOiBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTXG4gICAgfSxcbiAgICBzd2luZ3NldF9tZXRlcl91c2FnZToge1xuICAgICAgZGVzY3JpcHRpb246IFwiVmF0IG1ldGVyIHVzYWdlXCIsXG4gICAgICB1bml0OiBcIm1zXCIsXG4gICAgICBib3VuZGFyaWVzOiBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTXG4gICAgfVxuICB9XG4pO1xudmFyIGJsb2NrSGlzdG9ncmFtTWV0cmljRGVzYyA9IHtcbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgdW5pdDogXCJzXCIsXG4gIGFkdmljZToge1xuICAgIGV4cGxpY2l0QnVja2V0Qm91bmRhcmllczogW1xuICAgICAgMC4xLFxuICAgICAgMC4yLFxuICAgICAgMC4zLFxuICAgICAgMC40LFxuICAgICAgMC41LFxuICAgICAgMSxcbiAgICAgIDIsXG4gICAgICAzLFxuICAgICAgNCxcbiAgICAgIDUsXG4gICAgICA2LFxuICAgICAgNyxcbiAgICAgIDEwLFxuICAgICAgMTUsXG4gICAgICAzMFxuICAgIF1cbiAgfVxufTtcbnZhciBCTE9DS19ISVNUT0dSQU1fTUVUUklDUyA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIHN3aW5nc2V0UnVuU2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgZXhlY3V0aW5nIFN3aW5nU2V0XCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2NcbiAgICB9LFxuICAgIHN3aW5nc2V0Q2hhaW5TYXZlU2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgcHJvcGFnYXRpbmcgU3dpbmdTZXQgc3RhdGUgaW50byBjb3Ntb3NcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgc3dpbmdzZXRDb21taXRTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQZXItYmxvY2sgdGltZSBzcGVudCBjb21taXR0aW5nIFN3aW5nU2V0IHN0YXRlIHRvIGhvc3Qgc3RvcmFnZVwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjXG4gICAgfSxcbiAgICBjb3Ntb3NDb21taXRTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQZXItYmxvY2sgdGltZSBzcGVudCBjb21taXR0aW5nIGNvc21vcyBzdGF0ZVwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjXG4gICAgfSxcbiAgICBmdWxsQ29tbWl0U2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgY29tbWl0dGluZyBzdGF0ZSwgaW5jbHVzaXZlIG9mIENPTU1JVF9CTE9DSyBwcm9jZXNzaW5nIHBsdXMgdGltZSBzcGVudCBbb3V0c2lkZSBvZiBjb3NtaWMtc3dpbmdzZXRdIGJlZm9yZSBhbmQgYWZ0ZXIgaXRcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgaW50ZXJCbG9ja1NlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlRpbWUgc3BlbnQgaWRsZSBiZXR3ZWVuIGJsb2Nrc1wiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjXG4gICAgfSxcbiAgICBhZnRlckNvbW1pdEhhbmdvdmVyU2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiUGVyLWJsb2NrIHRpbWUgc3BlbnQgd2FpdGluZyBmb3IgcHJldmlvdXMtYmxvY2sgYWZ0ZXJDb21taXQgd29ya1wiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjXG4gICAgfSxcbiAgICBibG9ja0xhZ1NlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlRoZSBkZWxheSBvZiBlYWNoIGJsb2NrIGZyb20gaXRzIGV4cGVjdGVkIGJlZ2luIHRpbWVcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzYyxcbiAgICAgIC8vXG4gICAgICBhZHZpY2U6IHtcbiAgICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjLmFkdmljZSxcbiAgICAgICAgZXhwbGljaXRCdWNrZXRCb3VuZGFyaWVzOiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBbXG4gICAgICAgICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MuYWR2aWNlLmV4cGxpY2l0QnVja2V0Qm91bmRhcmllcyxcbiAgICAgICAgICAgIC4uLls2MCwgMTIwLCAxODAsIDI0MCwgMzAwLCA2MDAsIDM2MDBdXG4gICAgICAgICAgXVxuICAgICAgICApXG4gICAgICB9XG4gICAgfVxuICB9XG4pO1xudmFyIE1ldHJpY1R5cGUgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBDb3VudGVyOiBcImNvdW50ZXJcIixcbiAgICBHYXVnZTogXCJnYXVnZVwiXG4gIH1cbik7XG52YXIgS0VSTkVMX1NUQVRTX1NVTV9NRVRSSUNTID0gW1xuICB7XG4gICAga2V5OiBcInN5c2NhbGxzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9hbGxfc3lzY2FsbF90b3RhbFwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxTZW5kXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInNlbmRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBtZXNzYWdlIHNlbmQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsQ2FsbE5vd1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJjYWxsTm93XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgc3luY2hyb25vdXMgZGV2aWNlIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFN1YnNjcmliZVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJzdWJzY3JpYmVcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBwcm9taXNlIHN1YnNjcmlwdGlvbiBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxSZXNvbHZlXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInJlc29sdmVcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBwcm9taXNlIHJlc29sdXRpb24ga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsRXhpdFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJleGl0XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0IGV4aXQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsVmF0c3RvcmVHZXRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwidmF0c3RvcmVHZXRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXRzdG9yZSBnZXQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsVmF0c3RvcmVTZXRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwidmF0c3RvcmVTZXRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXRzdG9yZSBzZXQga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsVmF0c3RvcmVHZXROZXh0S2V5XCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInZhdHN0b3JlR2V0TmV4dFwiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdHN0b3JlIGdldE5leHRLZXkga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsVmF0c3RvcmVEZWxldGVcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwidmF0c3RvcmVEZWxldGVcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXRzdG9yZSBkZWxldGUga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsRHJvcEltcG9ydHNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwiZHJvcEltcG9ydHNcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBkcm9wIGltcG9ydHMga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJkaXNwYXRjaGVzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9kaXNwYXRjaF90b3RhbFwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXQgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImRpc3BhdGNoRGVsaXZlclwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfZGlzcGF0Y2hfZGVsaXZlcl90b3RhbFwiLFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXQgbWVzc2FnZSBkZWxpdmVyaWVzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJkaXNwYXRjaE5vdGlmeVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfZGlzcGF0Y2hfbm90aWZ5X3RvdGFsXCIsXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdCBwcm9taXNlIG5vdGlmaWNhdGlvbnNcIlxuICB9XG5dO1xudmFyIEtFUk5FTF9TVEFUU19VUERPV05fTUVUUklDUyA9IFtcbiAge1xuICAgIGtleTogXCJrZXJuZWxPYmplY3RzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9rZXJuZWxfb2JqZWN0c1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIkFjdGl2ZSBrZXJuZWwgb2JqZWN0c1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwia2VybmVsRGV2aWNlc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfa2VybmVsX2RldmljZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJBY3RpdmUga2VybmVsIGRldmljZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImtlcm5lbFByb21pc2VzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9rZXJuZWxfcHJvbWlzZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJBY3RpdmUga2VybmVsIHByb21pc2VzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJrcFVucmVzb2x2ZWRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3VucmVzb2x2ZWRfa2VybmVsX3Byb21pc2VzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiVW5yZXNvbHZlZCBrZXJuZWwgcHJvbWlzZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImtwRnVsZmlsbGVkXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9mdWxmaWxsZWRfa2VybmVsX3Byb21pc2VzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiRnVsZmlsbGVkIGtlcm5lbCBwcm9taXNlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwia3BSZWplY3RlZFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfcmVqZWN0ZWRfa2VybmVsX3Byb21pc2VzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiUmVqZWN0ZWQga2VybmVsIHByb21pc2VzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJydW5RdWV1ZUxlbmd0aFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfcnVuX3F1ZXVlX2xlbmd0aFwiLFxuICAgIGNvbnNlbnN1czogdHJ1ZSxcbiAgICBkZXNjcmlwdGlvbjogXCJMZW5ndGggb2YgdGhlIGtlcm5lbCBydW4gcXVldWVcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImFjY2VwdGFuY2VRdWV1ZUxlbmd0aFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfYWNjZXB0YW5jZV9xdWV1ZV9sZW5ndGhcIixcbiAgICBjb25zZW5zdXM6IHRydWUsXG4gICAgZGVzY3JpcHRpb246IFwiTGVuZ3RoIG9mIHRoZSBrZXJuZWwgYWNjZXB0YW5jZSBxdWV1ZVwiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwicHJvbWlzZVF1ZXVlc0xlbmd0aFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfcHJvbWlzZV9xdWV1ZXNfbGVuZ3RoXCIsXG4gICAgY29uc2Vuc3VzOiB0cnVlLFxuICAgIGRlc2NyaXB0aW9uOiBcIkNvbWJpbmVkIGxlbmd0aCBvZiBhbGwga2VybmVsIHByb21pc2UgcXVldWVzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJjbGlzdEVudHJpZXNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2NsaXN0X2VudHJpZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJOdW1iZXIgb2YgZW50cmllcyBpbiB0aGUga2VybmVsIGMtbGlzdFwiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwidmF0c1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfdmF0c1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIk51bWJlciBvZiBhY3RpdmUgdmF0c1wiXG4gIH1cbl07XG52YXIgeyBDb3VudGVyLCBHYXVnZSB9ID0gTWV0cmljVHlwZTtcbnZhciBLRVJORUxfU1RBVFNfTUVUUklDUyA9IGhhcmRlbihbXG4gIC4uLktFUk5FTF9TVEFUU19TVU1fTUVUUklDUy5tYXAoKG0yKSA9PiAoeyAuLi5tMiwgbWV0cmljVHlwZTogQ291bnRlciB9KSksXG4gIC4uLktFUk5FTF9TVEFUU19VUERPV05fTUVUUklDUy5tYXAoKG0yKSA9PiAoeyAuLi5tMiwgbWV0cmljVHlwZTogR2F1Z2UgfSkpXG5dKTtcbnZhciBrZXJuZWxTdGF0c0tleXMgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuZm9yIChjb25zdCB7IGtleSB9IG9mIEtFUk5FTF9TVEFUU19NRVRSSUNTKSB7XG4gIGtlcm5lbFN0YXRzS2V5cy5zZXQoa2V5LCAoa2VybmVsU3RhdHNLZXlzLmdldChrZXkpIHx8IDApICsgMSk7XG59XG52YXIgZHVwbGljYXRlS2VybmVsU3RhdHNLZXlzID0gWy4uLmtlcm5lbFN0YXRzS2V5cy5lbnRyaWVzKCldLmZsYXRNYXAoXG4gIChba2V5LCB2YWx1ZV0pID0+IHZhbHVlID4gMSA/IFtrZXldIDogW11cbik7XG5pZiAoZHVwbGljYXRlS2VybmVsU3RhdHNLZXlzLmxlbmd0aCA+IDApIHtcbiAgY29uc3QgbXNnID0gYER1cGxpY2F0ZSBrZXJuZWwgc3RhdHMga2V5cyAke0pTT04uc3RyaW5naWZ5KGR1cGxpY2F0ZUtlcm5lbFN0YXRzS2V5cyl9YDtcbiAgdGhyb3cgRXJyb3IobXNnKTtcbn1cblxuLy9cbnZhciBjb21wYXJlTmF0cyA9IChhMiwgYjMpID0+IHtcbiAgY29uc3QgZGlmZiA9ICthMiAtICtiMztcbiAgY29uc3QgZmluaXRlRGlmZiA9IE51bWJlci5pc0Zpbml0ZShkaWZmKSAmJiBkaWZmIHx8IChhMiA9PT0gYjMgPyAwIDogTnVtYmVyKEJpZ0ludChhMikgLSBCaWdJbnQoYjMpKSB8fCBhMi5sZW5ndGggLSBiMy5sZW5ndGgpO1xuICByZXR1cm4gTWF0aC5zaWduKGZpbml0ZURpZmYpO1xufTtcbnZhciBjb21wYXJlU3RyaW5ncyA9IChhMiwgYjMpID0+IGEyID4gYjMgPyAxIDogYTIgPCBiMyA/IC0xIDogMDtcbnZhciByUHJlZml4ZWREaWdpdHMgPSAvXihcXEQqKShcXGQrKShcXEQuKnwpL3M7XG52YXIgbmF0dXJhbENvbXBhcmUgPSAoYTIsIGIzKSA9PiB7XG4gIGNvbnN0IFtfYSwgYVByZWZpeCwgYURpZ2l0cywgYVN1ZmZpeF0gPSByUHJlZml4ZWREaWdpdHMuZXhlYyhhMikgfHwgW107XG4gIGlmIChhUHJlZml4ICE9PSB2b2lkIDApIHtcbiAgICBjb25zdCBbX2IsIGJQcmVmaXgsIGJEaWdpdHMsIGJTdWZmaXhdID0gclByZWZpeGVkRGlnaXRzLmV4ZWMoYjMpIHx8IFtdO1xuICAgIGlmIChiUHJlZml4ID09PSBhUHJlZml4KSB7XG4gICAgICByZXR1cm4gY29tcGFyZU5hdHMoYURpZ2l0cywgYkRpZ2l0cykgfHwgY29tcGFyZVN0cmluZ3MoYVN1ZmZpeCwgYlN1ZmZpeCk7XG4gICAgfVxuICB9XG4gIHJldHVybiBjb21wYXJlU3RyaW5ncyhhMiwgYjMpO1xufTtcbmhhcmRlbihuYXR1cmFsQ29tcGFyZSk7XG5cbi8vXG52YXIgeyBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNywgY3JlYXRlOiBjcmVhdGU1LCBmcm9tRW50cmllczogZnJvbUVudHJpZXMxMSB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czIwIH0gPSBSZWZsZWN0O1xudmFyIG9iamVjdE1ldGFNYXAgPSAob3JpZ2luYWwsIG1ldGFNYXBGbiwgcHJvdG8gPSBPYmplY3QucHJvdG90eXBlKSA9PiB7XG4gIGNvbnN0IGRlc2NzID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczcob3JpZ2luYWwpO1xuICBjb25zdCBrZXlzNCA9IG93bktleXMyMChvcmlnaW5hbCk7XG4gIGNvbnN0IGRlc2NFbnRyaWVzID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBrZXlzNC5tYXAoKGtleSkgPT4gW2tleSwgbWV0YU1hcEZuKGRlc2NzW2tleV0sIGtleSldKS5maWx0ZXIoKFtfa2V5LCBvcHREZXNjXSkgPT4gb3B0RGVzYyAhPT0gdm9pZCAwKVxuICApO1xuICByZXR1cm4gaGFyZGVuKGNyZWF0ZTUocHJvdG8sIGZyb21FbnRyaWVzMTEoZGVzY0VudHJpZXMpKSk7XG59O1xuaGFyZGVuKG9iamVjdE1ldGFNYXApO1xuXG4vL1xudmFyIGZyZWV6ZTggPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgT2JqZWN0LmZyZWV6ZVxuKTtcbnZhciBtYWtlUXVldWUgPSAoKSA9PiB7XG4gIGxldCB7IHByb21pc2U6IHRhaWxQcm9taXNlLCByZXNvbHZlOiB0YWlsUmVzb2x2ZSB9ID0gbWFrZVByb21pc2VLaXQoKTtcbiAgcmV0dXJuIHtcbiAgICBwdXQodmFsdWUpIHtcbiAgICAgIGNvbnN0IHsgcmVzb2x2ZTogcmVzb2x2ZTIsIHByb21pc2UgfSA9IG1ha2VQcm9taXNlS2l0KCk7XG4gICAgICB0YWlsUmVzb2x2ZShmcmVlemU4KHsgdmFsdWUsIHByb21pc2UgfSkpO1xuICAgICAgdGFpbFJlc29sdmUgPSByZXNvbHZlMjtcbiAgICB9LFxuICAgIGdldCgpIHtcbiAgICAgIGNvbnN0IHByb21pc2UgPSB0YWlsUHJvbWlzZS50aGVuKChuZXh0KSA9PiBuZXh0LnZhbHVlKTtcbiAgICAgIHRhaWxQcm9taXNlID0gdGFpbFByb21pc2UudGhlbigobmV4dCkgPT4gbmV4dC5wcm9taXNlKTtcbiAgICAgIHJldHVybiBoYXJkZW4ocHJvbWlzZSk7XG4gICAgfVxuICB9O1xufTtcbmhhcmRlbihtYWtlUXVldWUpO1xudmFyIG1ha2VTdHJlYW0gPSAoYWNrcywgZGF0YSkgPT4ge1xuICBjb25zdCBzdHJlYW0gPSBoYXJkZW4oe1xuICAgIC8qXG5cbiAgICAgKi9cbiAgICBuZXh0KHZhbHVlKSB7XG4gICAgICBkYXRhLnB1dChmcmVlemU4KHsgdmFsdWUsIGRvbmU6IGZhbHNlIH0pKTtcbiAgICAgIHJldHVybiBhY2tzLmdldCgpO1xuICAgIH0sXG4gICAgLypcblxuICAgICAqL1xuICAgIHJldHVybih2YWx1ZSkge1xuICAgICAgZGF0YS5wdXQoZnJlZXplOCh7IHZhbHVlLCBkb25lOiB0cnVlIH0pKTtcbiAgICAgIHJldHVybiBhY2tzLmdldCgpO1xuICAgIH0sXG4gICAgLypcblxuICAgICAqL1xuICAgIHRocm93KGVycm9yKSB7XG4gICAgICBkYXRhLnB1dChoYXJkZW4oUHJvbWlzZS5yZWplY3QoZXJyb3IpKSk7XG4gICAgICByZXR1cm4gYWNrcy5nZXQoKTtcbiAgICB9LFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgICByZXR1cm4gc3RyZWFtO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBzdHJlYW07XG59O1xuaGFyZGVuKG1ha2VTdHJlYW0pO1xudmFyIG1ha2VQaXBlID0gKCkgPT4ge1xuICBjb25zdCBkYXRhID0gbWFrZVF1ZXVlKCk7XG4gIGNvbnN0IGFja3MgPSBtYWtlUXVldWUoKTtcbiAgY29uc3QgcmVhZGVyID0gbWFrZVN0cmVhbShhY2tzLCBkYXRhKTtcbiAgY29uc3Qgd3JpdGVyID0gbWFrZVN0cmVhbShkYXRhLCBhY2tzKTtcbiAgcmV0dXJuIGhhcmRlbihbd3JpdGVyLCByZWFkZXJdKTtcbn07XG5oYXJkZW4obWFrZVBpcGUpO1xudmFyIHB1bXAgPSBhc3luYyAod3JpdGVyLCByZWFkZXIsIHByaW1lcikgPT4ge1xuICBjb25zdCB0aWNrID0gKHByb21pc2UpID0+IEUud2hlbihcbiAgICBwcm9taXNlLFxuICAgIChyZXN1bHQpID0+IHtcbiAgICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgICByZXR1cm4gd3JpdGVyLnJldHVybihyZXN1bHQudmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRvY2sod3JpdGVyLm5leHQocmVzdWx0LnZhbHVlKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICAoZXJyb3IpID0+IHtcbiAgICAgIHJldHVybiB3cml0ZXIudGhyb3coZXJyb3IpO1xuICAgIH1cbiAgKTtcbiAgY29uc3QgdG9jayA9IChwcm9taXNlKSA9PiBFLndoZW4oXG4gICAgcHJvbWlzZSxcbiAgICAocmVzdWx0KSA9PiB7XG4gICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgcmV0dXJuIHJlYWRlci5yZXR1cm4ocmVzdWx0LnZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0aWNrKHJlYWRlci5uZXh0KHJlc3VsdC52YWx1ZSkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgKGVycm9yKSA9PiB7XG4gICAgICByZXR1cm4gcmVhZGVyLnRocm93KGVycm9yKTtcbiAgICB9XG4gICk7XG4gIGF3YWl0IHRpY2socmVhZGVyLm5leHQocHJpbWVyKSk7XG4gIHJldHVybiB2b2lkIDA7XG59O1xuaGFyZGVuKHB1bXApO1xudmFyIHByaW1lID0gKGdlbmVyYXRvciwgcHJpbWVyKSA9PiB7XG4gIGNvbnN0IGZpcnN0ID0gZ2VuZXJhdG9yLm5leHQocHJpbWVyKTtcbiAgbGV0IHJlc3VsdDtcbiAgY29uc3QgcHJpbWVkID0gaGFyZGVuKHtcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgYXN5bmMgbmV4dCh2YWx1ZSkge1xuICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJlc3VsdCA9IGF3YWl0IGZpcnN0O1xuICAgICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZ2VuZXJhdG9yLm5leHQodmFsdWUpO1xuICAgIH0sXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBhc3luYyByZXR1cm4odmFsdWUpIHtcbiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCBmaXJzdDtcbiAgICAgICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGdlbmVyYXRvci5yZXR1cm4odmFsdWUpO1xuICAgIH0sXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgYXN5bmMgdGhyb3coZXJyb3IpIHtcbiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCBmaXJzdDtcbiAgICAgICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBnZW5lcmF0b3IudGhyb3coZXJyb3IpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBwcmltZWQ7XG59O1xuaGFyZGVuKHByaW1lKTtcbnZhciBtYXBSZWFkZXIgPSAocmVhZGVyLCB0cmFuc2Zvcm0pID0+IHtcbiAgYXN5bmMgZnVuY3Rpb24qIHRyYW5zZm9ybUdlbmVyYXRvcigpIHtcbiAgICBmb3IgYXdhaXQgKGNvbnN0IHZhbHVlIG9mIHJlYWRlcikge1xuICAgICAgeWllbGQgdHJhbnNmb3JtKHZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBoYXJkZW4odHJhbnNmb3JtR2VuZXJhdG9yKTtcbiAgcmV0dXJuIGhhcmRlbih0cmFuc2Zvcm1HZW5lcmF0b3IoKSk7XG59O1xuaGFyZGVuKG1hcFJlYWRlcik7XG52YXIgbWFwV3JpdGVyID0gKHdyaXRlciwgdHJhbnNmb3JtKSA9PiB7XG4gIGNvbnN0IHRyYW5zZm9ybWVkV3JpdGVyID0gaGFyZGVuKHtcbiAgICAvKlxuXG4gICAgICovXG4gICAgYXN5bmMgbmV4dCh2YWx1ZSkge1xuICAgICAgcmV0dXJuIHdyaXRlci5uZXh0KHRyYW5zZm9ybSh2YWx1ZSkpO1xuICAgIH0sXG4gICAgLypcblxuICAgICAqL1xuICAgIGFzeW5jIHRocm93KGVycm9yKSB7XG4gICAgICByZXR1cm4gd3JpdGVyLnRocm93KGVycm9yKTtcbiAgICB9LFxuICAgIC8qXG5cbiAgICAgKi9cbiAgICBhc3luYyByZXR1cm4odmFsdWUpIHtcbiAgICAgIHJldHVybiB3cml0ZXIucmV0dXJuKHZhbHVlKTtcbiAgICB9LFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSB7XG4gICAgICByZXR1cm4gdHJhbnNmb3JtZWRXcml0ZXI7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHRyYW5zZm9ybWVkV3JpdGVyO1xufTtcbmhhcmRlbihtYXBXcml0ZXIpO1xuXG4vL1xudmFyIG1ha2VQcm9taXNlID0gKGV4ZWN1dG9yKSA9PiBoYXJkZW4obmV3IFByb21pc2UoZXhlY3V0b3IpKTtcbmhhcmRlbihtYWtlUHJvbWlzZSk7XG52YXIgbWFrZU1hcCA9IChlbnRyaWVzT3JJdGVyYWJsZSkgPT4gaGFyZGVuKG5ldyBNYXAoZW50cmllc09ySXRlcmFibGUpKTtcbmhhcmRlbihtYWtlTWFwKTtcbnZhciBtYWtlU2V0ID0gKHZhbHVlczYpID0+IGhhcmRlbihuZXcgU2V0KHZhbHVlczYpKTtcbmhhcmRlbihtYWtlU2V0KTtcbnZhciBtYWtlV2Vha01hcCA9IChlbnRyaWVzMTApID0+IGhhcmRlbihuZXcgV2Vha01hcChlbnRyaWVzMTApKTtcbmhhcmRlbihtYWtlV2Vha01hcCk7XG52YXIgbWFrZVdlYWtTZXQgPSAodmFsdWVzNikgPT4gaGFyZGVuKG5ldyBXZWFrU2V0KHZhbHVlczYpKTtcbmhhcmRlbihtYWtlV2Vha1NldCk7XG5cbi8vXG52YXIgYXN5bmNHZW5lcmF0ZSA9IChuZXh0KSA9PiB7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBuZXh0OiBhc3luYyAoKSA9PiBoYXJkZW4obmV4dCgpKVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4oYXN5bmNHZW5lcmF0ZSk7XG5cbi8vXG52YXIgYXN5bmNEb1doaWxlID0gKGJvZHkpID0+IHtcbiAgcmV0dXJuIG1ha2VQcm9taXNlKChyZXNvbHZlMiwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3QgbG9vcCA9IGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRvQ29udGludWUgPSBhd2FpdCBib2R5KCk7XG4gICAgICBpZiAoIWRvQ29udGludWUpIHtcbiAgICAgICAgcmVzb2x2ZTIodm9pZCAwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbG9vcCgpLmNhdGNoKHJlamVjdCk7XG4gICAgfTtcbiAgICBsb29wKCkuY2F0Y2gocmVqZWN0KTtcbiAgfSk7XG59O1xuaGFyZGVuKGFzeW5jRG9XaGlsZSk7XG5cbi8vXG52YXIgeyBmcm9tRW50cmllczogZnJvbUVudHJpZXMxMiwga2V5cywgdmFsdWVzOiB2YWx1ZXM0IH0gPSBPYmplY3Q7XG52YXIgbWFrZUxpbWl0ZWRDb25zb2xlID0gKG1ha2VMb2dnZXIpID0+IHtcbiAgY29uc3QgbGltaXRlZENvbnNvbGUgPSAoXG4gICAgLyogICAgICAgICAgICAgICovXG4gICAgZnJvbUVudHJpZXMxMihsb2dMZXZlbHMubWFwKChsZXZlbCkgPT4gW2xldmVsLCBtYWtlTG9nZ2VyKGxldmVsKV0pKVxuICApO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgaGFyZGVuKGxpbWl0ZWRDb25zb2xlKVxuICApO1xufTtcbmhhcmRlbihtYWtlTGltaXRlZENvbnNvbGUpO1xudmFyIGFzc2VydEFsbERlZmluZWQgPSAob2JqKSA9PiB7XG4gIGNvbnN0IG1pc3NpbmcyID0gW107XG4gIGZvciAoY29uc3QgW2tleSwgdmFsXSBvZiBPYmplY3QuZW50cmllcyhvYmopKSB7XG4gICAgaWYgKHZhbCA9PT0gdm9pZCAwKSB7XG4gICAgICBtaXNzaW5nMi5wdXNoKGtleSk7XG4gICAgfVxuICB9XG4gIGlmIChtaXNzaW5nMi5sZW5ndGggPiAwKSB7XG4gICAgdGhyb3dSZWRhY3RlZGBtaXNzaW5nICR7cXVvdGUobWlzc2luZzIpfWA7XG4gIH1cbn07XG52YXIgbm90RG9uZSA9IGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZTogdm9pZCAwIH0pO1xudmFyIGFsd2F5c0RvbmUgPSBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogdm9pZCAwIH0pO1xudmFyIGZvcmV2ZXIgPSBhc3luY0dlbmVyYXRlKCgpID0+IG5vdERvbmUpO1xudmFyIHppcCA9ICh4cywgeXMpID0+IGhhcmRlbih4cy5tYXAoKHgsIGkyKSA9PiBbeCwgeXNbK2kyXV0pKTtcbnZhciBhbGxWYWx1ZXMgPSBhc3luYyAob2JqKSA9PiB7XG4gIGNvbnN0IHJlc29sdmVkID0gYXdhaXQgUHJvbWlzZS5hbGwodmFsdWVzNChvYmopKTtcbiAgcmV0dXJuIGhhcmRlbihmcm9tRW50cmllczEyKHppcChrZXlzKG9iaiksIHJlc29sdmVkKSkpO1xufTtcblxuLy9cbnZhciBtdXN0TWF0Y2gzID0gbXVzdE1hdGNoO1xuXG4vL1xudmFyIFN0b3JhZ2VOb2RlU2hhcGUgPSBNLnJlbW90YWJsZShcIlN0b3JhZ2VOb2RlXCIpO1xudmFyIFVuZ3VhcmRlZEhlbHBlckkgPSBNLmludGVyZmFjZShcbiAgXCJoZWxwZXJcIixcbiAge30sXG4gIC8vXG4gIHsgc2xvcHB5OiB0cnVlIH1cbik7XG52YXIgQnJpZGdlQmlnSW50U2hhcGUgPSBNLm9yKE0ubnVtYmVyKCksIE0uc3RyaW5nKCkpO1xuXG4vL1xudmFyIGZvckVhY2hQdWJsaWNhdGlvblJlY29yZCA9IGFzeW5jIChzdWJzY3JpYmVyLCBjb25zdW1lVmFsdWUpID0+IHtcbiAgY29uc3QgaXRlcmF0b3IgPSBzdWJzY3JpYmVFYWNoKHN1YnNjcmliZXIpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpO1xuICBsZXQgZmluaXNoZWQgPSBmYWxzZTtcbiAgYXdhaXQgbnVsbDtcbiAgd2hpbGUgKCFmaW5pc2hlZCkge1xuICAgIGNvbnN0IHsgdmFsdWUsIGRvbmUgfSA9IGF3YWl0IGl0ZXJhdG9yLm5leHQoKTtcbiAgICBhd2FpdCBjb25zdW1lVmFsdWUodmFsdWUpO1xuICAgIGZpbmlzaGVkID0gISFkb25lO1xuICB9XG59O1xudmFyIG1ha2VTdG9yZWRTdWJzY3JpYmVyID0gKHN1YnNjcmliZXIsIHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKSA9PiB7XG4gIGFzc2VydEFsbERlZmluZWQoeyBzdWJzY3JpYmVyLCBzdG9yYWdlTm9kZSwgbWFyc2hhbGxlciB9KTtcbiAgY29uc3QgbWFyc2hhbGxUb1N0b3JhZ2UgPSBtYWtlU2VyaWFsaXplVG9TdG9yYWdlKHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyKTtcbiAgZm9yRWFjaFB1YmxpY2F0aW9uUmVjb3JkKHN1YnNjcmliZXIsIG1hcnNoYWxsVG9TdG9yYWdlKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcihcIlN0b3JlZFN1YnNjcmliZXIgZmFpbGVkIHRvIGl0ZXJhdGVcIiwgZXJyKTtcbiAgfSk7XG4gIGNvbnN0IHVuc2VyaWFsaXplciA9IEZhcihcInVuc2VyaWFsaXplclwiLCB7XG4gICAgZnJvbUNhcERhdGE6IChkYXRhKSA9PiBFKG1hcnNoYWxsZXIpLmZyb21DYXBEYXRhKGRhdGEpLFxuICAgIHVuc2VyaWFsaXplOiAoZGF0YSkgPT4gRShtYXJzaGFsbGVyKS5mcm9tQ2FwRGF0YShkYXRhKVxuICB9KTtcbiAgY29uc3Qgc3RvcmVzdWIgPSBGYXIoXCJTdG9yZWRTdWJzY3JpYmVyXCIsIHtcbiAgICBzdWJzY3JpYmVBZnRlcjogKHB1Ymxpc2hDb3VudCkgPT4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcihwdWJsaXNoQ291bnQpLFxuICAgIGdldFVwZGF0ZVNpbmNlOiAodXBkYXRlQ291bnQpID0+IHN1YnNjcmliZXIuZ2V0VXBkYXRlU2luY2UodXBkYXRlQ291bnQpLFxuICAgIGdldFBhdGg6ICgpID0+IEUoc3RvcmFnZU5vZGUpLmdldFBhdGgoKSxcbiAgICBnZXRTdG9yZUtleTogKCkgPT4gRShzdG9yYWdlTm9kZSkuZ2V0U3RvcmVLZXkoKSxcbiAgICBnZXRVbnNlcmlhbGl6ZXI6ICgpID0+IHVuc2VyaWFsaXplclxuICB9KTtcbiAgcmV0dXJuIHN0b3Jlc3ViO1xufTtcbnZhciBtYWtlU3RvcmVkU3Vic2NyaXB0aW9uID0gKHN1YnNjcmlwdGlvbiwgc3RvcmFnZU5vZGUsIG1hcnNoYWxsZXIgPSBtYWtlTWFyc2hhbCh2b2lkIDAsIHZvaWQgMCwge1xuICBtYXJzaGFsU2F2ZUVycm9yOiAoKSA9PiB7XG4gIH0sXG4gIHNlcmlhbGl6ZUJvZHlGb3JtYXQ6IFwic21hbGxjYXBzXCJcbn0pKSA9PiB7XG4gIGNvbnN0IHVuc2VyaWFsaXplciA9IEZhcihcInVuc2VyaWFsaXplclwiLCB7XG4gICAgZnJvbUNhcERhdGE6IChkYXRhKSA9PiBFKG1hcnNoYWxsZXIpLmZyb21DYXBEYXRhKGRhdGEpLFxuICAgIHVuc2VyaWFsaXplOiAoZGF0YSkgPT4gRShtYXJzaGFsbGVyKS5mcm9tQ2FwRGF0YShkYXRhKVxuICB9KTtcbiAgbGV0IHB1Ymxpc2hGYWlsZWQgPSBmYWxzZTtcbiAgbGV0IHB1Ymxpc2hFeGNlcHRpb247XG4gIGNvbnN0IGZhaWwgPSAoZXJyKSA9PiB7XG4gICAgcHVibGlzaEZhaWxlZCA9IHRydWU7XG4gICAgcHVibGlzaEV4Y2VwdGlvbiA9IGVycjtcbiAgfTtcbiAgY29uc3QgcHVibGlzaFZhbHVlID0gKG9iaikgPT4ge1xuICAgIGFzc2VydChzdG9yYWdlTm9kZSk7XG4gICAgaWYgKHB1Ymxpc2hGYWlsZWQpIHtcbiAgICAgIHRocm93IHB1Ymxpc2hFeGNlcHRpb247XG4gICAgfVxuICAgIEUobWFyc2hhbGxlcikudG9DYXBEYXRhKG9iaikudGhlbigoc2VyaWFsaXplZCkgPT4ge1xuICAgICAgY29uc3QgZW5jb2RlZCA9IEpTT04uc3RyaW5naWZ5KHNlcmlhbGl6ZWQpO1xuICAgICAgcmV0dXJuIEUoc3RvcmFnZU5vZGUpLnNldFZhbHVlKGVuY29kZWQpO1xuICAgIH0pLmNhdGNoKGZhaWwpO1xuICB9O1xuICBpZiAoc3RvcmFnZU5vZGUpIHtcbiAgICBvYnNlcnZlSXRlcmF0aW9uKHN1YnNjcmlwdGlvbiwge1xuICAgICAgdXBkYXRlU3RhdGU6IHB1Ymxpc2hWYWx1ZSxcbiAgICAgIGZpbmlzaDogcHVibGlzaFZhbHVlXG4gICAgfSkuY2F0Y2goZmFpbCk7XG4gIH1cbiAgY29uc3Qgc3RvcmVzdWIgPSBGYXIoXCJTdG9yZWRTdWJzY3JpcHRpb25cIiwge1xuICAgIC8vXG4gICAgZ2V0U3RvcmVLZXk6IGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghc3RvcmFnZU5vZGUpIHtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7IHN1YnNjcmlwdGlvbiB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHN0b3JlS2V5ID0gYXdhaXQgRShzdG9yYWdlTm9kZSkuZ2V0U3RvcmVLZXkoKTtcbiAgICAgIHJldHVybiBoYXJkZW4oeyAuLi5zdG9yZUtleSwgc3Vic2NyaXB0aW9uIH0pO1xuICAgIH0sXG4gICAgZ2V0VW5zZXJpYWxpemVyOiAoKSA9PiB1bnNlcmlhbGl6ZXIsXG4gICAgZ2V0U2hhcmFibGVTdWJzY3JpcHRpb25JbnRlcm5hbHM6ICgpID0+IHN1YnNjcmlwdGlvbi5nZXRTaGFyYWJsZVN1YnNjcmlwdGlvbkludGVybmFscygpLFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IHN1YnNjcmlwdGlvbltTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKSxcbiAgICBzdWJzY3JpYmVBZnRlcjogKHB1Ymxpc2hDb3VudCkgPT4gc3Vic2NyaXB0aW9uLnN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudClcbiAgfSk7XG4gIHJldHVybiBzdG9yZXN1Yjtcbn07XG5oYXJkZW4obWFrZVN0b3JlZFN1YnNjcmlwdGlvbik7XG52YXIgbWFrZVN0b3JlZFB1Ymxpc2hLaXQgPSAoc3RvcmFnZU5vZGUsIG1hcnNoYWxsZXIpID0+IHtcbiAgY29uc3QgeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSA9IG1ha2VQdWJsaXNoS2l0KCk7XG4gIHJldHVybiB7XG4gICAgcHVibGlzaGVyLFxuICAgIC8vXG4gICAgc3Vic2NyaWJlcjogbWFrZVN0b3JlZFN1YnNjcmliZXIoc3Vic2NyaWJlciwgc3RvcmFnZU5vZGUsIG1hcnNoYWxsZXIpXG4gIH07XG59O1xuaGFyZGVuKG1ha2VTdG9yZWRQdWJsaXNoS2l0KTtcblxuLy9cbnZhciBtYWtlVHJhbnNpZW50Tm90aWZpZXJLaXQgPSAoKSA9PiB7XG4gIGNvbnN0IHRyYW5zaWVudE5vdGlmZXJLaXRzID0gbWFrZVNjYWxhckJpZ1dlYWtNYXBTdG9yZShcbiAgICBcInRyYW5zaWVudE5vdGlmZXJLaXRzXCJcbiAgKTtcbiAgY29uc3QgcHJvdmlkZU5vdGlmaWVyS2l0ID0gKGtleSkgPT4gcHJvdmlkZUxhenkoXG4gICAgdHJhbnNpZW50Tm90aWZlcktpdHMsXG4gICAga2V5LFxuICAgICgpID0+IG1ha2VOb3RpZmllcktpdChrZXkuZ2V0Q3VycmVudEFtb3VudCgpKVxuICApO1xuICBjb25zdCBwcm92aWRlTm90aWZpZXIgPSAoa2V5KSA9PiBwcm92aWRlTm90aWZpZXJLaXQoa2V5KS5ub3RpZmllcjtcbiAgY29uc3QgdXBkYXRlID0gKGtleSwgbmV3VmFsdWUpID0+IHtcbiAgICBpZiAodHJhbnNpZW50Tm90aWZlcktpdHMuaGFzKGtleSkpIHtcbiAgICAgIGNvbnN0IHsgdXBkYXRlciB9ID0gdHJhbnNpZW50Tm90aWZlcktpdHMuZ2V0KGtleSk7XG4gICAgICB1cGRhdGVyLnVwZGF0ZVN0YXRlKG5ld1ZhbHVlKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiB7IHByb3ZpZGVOb3RpZmllciwgdXBkYXRlIH07XG59O1xuaGFyZGVuKG1ha2VUcmFuc2llbnROb3RpZmllcktpdCk7XG5cbi8vXG52YXIgbWFrZUFtb3VudFN0b3JlID0gKHN0YXRlLCBrZXkpID0+IHtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgZ2V0QW1vdW50OiAoKSA9PiBzdGF0ZVtrZXldLFxuICAgIGluY3JlbWVudDogKGRlbHRhKSA9PiB7XG4gICAgICBzdGF0ZVtrZXldID0gQW1vdW50TWF0aC5hZGQoc3RhdGVba2V5XSwgZGVsdGEpO1xuICAgIH0sXG4gICAgZGVjcmVtZW50OiAoZGVsdGEpID0+IHtcbiAgICAgIGlmIChBbW91bnRNYXRoLmlzR1RFKHN0YXRlW2tleV0sIGRlbHRhKSkge1xuICAgICAgICBzdGF0ZVtrZXldID0gQW1vdW50TWF0aC5zdWJ0cmFjdChzdGF0ZVtrZXldLCBkZWx0YSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VBbW91bnRTdG9yZSk7XG5cbi8vXG52YXIgRU1QVFlfQ09QWV9TRVQgPSBtYWtlQ29weVNldChbXSk7XG52YXIgcHJlcGFyZVB1cnNlS2luZCA9IChpc3N1ZXJab25lLCBuYW1lLCBhc3NldEtpbmQsIGJyYW5kLCBQdXJzZUlLaXQsIHB1cnNlTWV0aG9kcywgcmVjb3ZlcnlTZXRzU3RhdGUsIHBheW1lbnRSZWNvdmVyeVNldHMpID0+IHtcbiAgY29uc3QgYW1vdW50U2hhcGUgPSBicmFuZC5nZXRBbW91bnRTaGFwZSgpO1xuICBjb25zdCB7IHByb3ZpZGVOb3RpZmllciwgdXBkYXRlOiB1cGRhdGVCYWxhbmNlIH0gPSBtYWtlVHJhbnNpZW50Tm90aWZpZXJLaXQoKTtcbiAgY29uc3QgbWF5YmVSZWNvdmVyeVNldCA9IChzdGF0ZSkgPT4ge1xuICAgIGNvbnN0IHsgcmVjb3ZlcnlTZXQgfSA9IHN0YXRlO1xuICAgIGlmIChyZWNvdmVyeVNldHNTdGF0ZSA9PT0gXCJoYXNSZWNvdmVyeVNldHNcIikge1xuICAgICAgcmV0dXJuIHJlY292ZXJ5U2V0O1xuICAgIH0gZWxzZSB7XG4gICAgICByZWNvdmVyeVNldHNTdGF0ZSA9PT0gXCJub1JlY292ZXJ5U2V0c1wiIHx8IHRocm93UmVkYWN0ZWRgcmVjb3ZlclNldHNTdGF0ZSBtdXN0IGJlIG5vUmVjb3ZlcnlTZXRzIGlmIGl0IGlzbid0IGhhc1JlY292ZXJTZXRzYDtcbiAgICAgIHBheW1lbnRSZWNvdmVyeVNldHMgIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYHBheW1lbnRSZWNvdmVyeVNldHMgbXVzdCBhbHdheXMgYmUgZGVmaW5lZGA7XG4gICAgICByZWNvdmVyeVNldC5nZXRTaXplKCkgPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBXaXRoIG5vUmVjb3ZlcnlTZXRzLCByZWNvdmVyeVNldCBtdXN0IGJlIGVtcHR5YDtcbiAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgfVxuICB9O1xuICBjb25zdCB7IGRlcG9zaXRJbnRlcm5hbCwgd2l0aGRyYXdJbnRlcm5hbCB9ID0gcHVyc2VNZXRob2RzO1xuICBjb25zdCBtYWtlUHVyc2VLaXQgPSBpc3N1ZXJab25lLmV4b0NsYXNzS2l0KFxuICAgIGAke25hbWV9IFB1cnNlYCxcbiAgICBQdXJzZUlLaXQsXG4gICAgKCkgPT4ge1xuICAgICAgY29uc3QgY3VycmVudEJhbGFuY2UgPSBBbW91bnRNYXRoLm1ha2VFbXB0eShicmFuZCwgYXNzZXRLaW5kKTtcbiAgICAgIGNvbnN0IHJlY292ZXJ5U2V0ID0gaXNzdWVyWm9uZS5kZXRhY2hlZCgpLnNldFN0b3JlKFwicmVjb3Zlcnkgc2V0XCIpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY3VycmVudEJhbGFuY2UsXG4gICAgICAgIHJlY292ZXJ5U2V0XG4gICAgICB9O1xuICAgIH0sXG4gICAge1xuICAgICAgcHVyc2U6IHtcbiAgICAgICAgZGVwb3NpdChzcmNQYXltZW50LCBvcHRBbW91bnRTaGFwZSA9IHZvaWQgMCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgY29uc3QgeyBwdXJzZSB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgYmFsYW5jZVN0b3JlID0gbWFrZUFtb3VudFN0b3JlKHN0YXRlLCBcImN1cnJlbnRCYWxhbmNlXCIpO1xuICAgICAgICAgIGNvbnN0IHNyY1BheW1lbnRCYWxhbmNlID0gZGVwb3NpdEludGVybmFsKFxuICAgICAgICAgICAgYmFsYW5jZVN0b3JlLFxuICAgICAgICAgICAgc3JjUGF5bWVudCxcbiAgICAgICAgICAgIG9wdEFtb3VudFNoYXBlXG4gICAgICAgICAgKTtcbiAgICAgICAgICB1cGRhdGVCYWxhbmNlKHB1cnNlLCBiYWxhbmNlU3RvcmUuZ2V0QW1vdW50KCkpO1xuICAgICAgICAgIHJldHVybiBzcmNQYXltZW50QmFsYW5jZTtcbiAgICAgICAgfSxcbiAgICAgICAgd2l0aGRyYXcoYW1vdW50KSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICBjb25zdCB7IHB1cnNlIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCBvcHRSZWNvdmVyeVNldCA9IG1heWJlUmVjb3ZlcnlTZXQoc3RhdGUpO1xuICAgICAgICAgIGNvbnN0IGJhbGFuY2VTdG9yZSA9IG1ha2VBbW91bnRTdG9yZShzdGF0ZSwgXCJjdXJyZW50QmFsYW5jZVwiKTtcbiAgICAgICAgICBjb25zdCBwYXltZW50ID0gd2l0aGRyYXdJbnRlcm5hbChcbiAgICAgICAgICAgIGJhbGFuY2VTdG9yZSxcbiAgICAgICAgICAgIGFtb3VudCxcbiAgICAgICAgICAgIG9wdFJlY292ZXJ5U2V0XG4gICAgICAgICAgKTtcbiAgICAgICAgICB1cGRhdGVCYWxhbmNlKHB1cnNlLCBiYWxhbmNlU3RvcmUuZ2V0QW1vdW50KCkpO1xuICAgICAgICAgIHJldHVybiBwYXltZW50O1xuICAgICAgICB9LFxuICAgICAgICBnZXRDdXJyZW50QW1vdW50KCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgY29uc3QgYmFsYW5jZVN0b3JlID0gbWFrZUFtb3VudFN0b3JlKHN0YXRlLCBcImN1cnJlbnRCYWxhbmNlXCIpO1xuICAgICAgICAgIHJldHVybiBiYWxhbmNlU3RvcmUuZ2V0QW1vdW50KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEN1cnJlbnRBbW91bnROb3RpZmllcigpIHtcbiAgICAgICAgICByZXR1cm4gcHJvdmlkZU5vdGlmaWVyKHRoaXMuZmFjZXRzLnB1cnNlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0QWxsZWdlZEJyYW5kKCkge1xuICAgICAgICAgIHJldHVybiBicmFuZDtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0RGVwb3NpdEZhY2V0KCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmZhY2V0cy5kZXBvc2l0RmFjZXQ7XG4gICAgICAgIH0sXG4gICAgICAgIGdldFJlY292ZXJ5U2V0KCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgY29uc3Qgb3B0UmVjb3ZlcnlTZXQgPSBtYXliZVJlY292ZXJ5U2V0KHN0YXRlKTtcbiAgICAgICAgICBpZiAob3B0UmVjb3ZlcnlTZXQgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgcmV0dXJuIEVNUFRZX0NPUFlfU0VUO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gb3B0UmVjb3ZlcnlTZXQuc25hcHNob3QoKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVjb3ZlckFsbCgpIHtcbiAgICAgICAgICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgbGV0IGFtb3VudCA9IEFtb3VudE1hdGgubWFrZUVtcHR5KGJyYW5kLCBhc3NldEtpbmQpO1xuICAgICAgICAgIGNvbnN0IG9wdFJlY292ZXJ5U2V0ID0gbWF5YmVSZWNvdmVyeVNldChzdGF0ZSk7XG4gICAgICAgICAgaWYgKG9wdFJlY292ZXJ5U2V0ID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIHJldHVybiBhbW91bnQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAoY29uc3QgcGF5bWVudCBvZiBvcHRSZWNvdmVyeVNldC5rZXlzKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGRlbHRhID0gZmFjZXRzLnB1cnNlLmRlcG9zaXQocGF5bWVudCk7XG4gICAgICAgICAgICBhbW91bnQgPSBBbW91bnRNYXRoLmFkZChhbW91bnQsIGRlbHRhLCBicmFuZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG9wdFJlY292ZXJ5U2V0LmdldFNpemUoKSA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBSZW1haW5pbmcgdW5yZWNvdmVyZWQgcGF5bWVudHM6ICR7ZmFjZXRzLnB1cnNlLmdldFJlY292ZXJ5U2V0KCl9YDtcbiAgICAgICAgICByZXR1cm4gYW1vdW50O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGVwb3NpdEZhY2V0OiB7XG4gICAgICAgIHJlY2VpdmUoLi4uYXJncykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmZhY2V0cy5wdXJzZS5kZXBvc2l0KC4uLmFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBzdGF0ZVNoYXBlOiB7XG4gICAgICAgIGN1cnJlbnRCYWxhbmNlOiBhbW91bnRTaGFwZSxcbiAgICAgICAgcmVjb3ZlcnlTZXQ6IE0ucmVtb3RhYmxlKFwicmVjb3ZlcnlTZXRcIilcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiAoKSA9PiBtYWtlUHVyc2VLaXQoKS5wdXJzZTtcbn07XG5oYXJkZW4ocHJlcGFyZVB1cnNlS2luZCk7XG5cbi8vXG52YXIgYW1vdW50U2hhcGVGcm9tRWxlbWVudFNoYXBlID0gKGJyYW5kLCBhc3NldEtpbmQsIGVsZW1lbnRTaGFwZSkgPT4ge1xuICBsZXQgdmFsdWVTaGFwZTtcbiAgc3dpdGNoIChhc3NldEtpbmQpIHtcbiAgICBjYXNlIFwibmF0XCI6IHtcbiAgICAgIHZhbHVlU2hhcGUgPSBNLm5hdCgpO1xuICAgICAgZWxlbWVudFNoYXBlID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBGdW5naWJsZSBhc3NldHMgY2Fubm90IGhhdmUgYW4gZWxlbWVudFNoYXBlOiAke3F1b3RlKGVsZW1lbnRTaGFwZSl9YDtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIFwic2V0XCI6IHtcbiAgICAgIGlmIChlbGVtZW50U2hhcGUgPT09IHZvaWQgMCkge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5hcnJheU9mKE0ua2V5KCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWVTaGFwZSA9IE0uYXJyYXlPZihNLmFuZChNLmtleSgpLCBlbGVtZW50U2hhcGUpKTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBjYXNlIFwiY29weVNldFwiOiB7XG4gICAgICBpZiAoZWxlbWVudFNoYXBlID09PSB2b2lkIDApIHtcbiAgICAgICAgdmFsdWVTaGFwZSA9IE0uc2V0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5zZXRPZihlbGVtZW50U2hhcGUpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgXCJjb3B5QmFnXCI6IHtcbiAgICAgIGlmIChlbGVtZW50U2hhcGUgPT09IHZvaWQgMCkge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5iYWcoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlU2hhcGUgPSBNLmJhZ09mKGVsZW1lbnRTaGFwZSk7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGFzc2V0IGtpbmQgJHtxdW90ZShhc3NldEtpbmQpfWA7XG4gICAgfVxuICB9XG4gIGNvbnN0IGFtb3VudFNoYXBlID0gaGFyZGVuKHtcbiAgICBicmFuZCxcbiAgICAvL1xuICAgIHZhbHVlOiB2YWx1ZVNoYXBlXG4gIH0pO1xuICByZXR1cm4gYW1vdW50U2hhcGU7XG59O1xudmFyIHByZXBhcmVQYXltZW50TGVkZ2VyID0gKGlzc3VlclpvbmUsIG5hbWUsIGFzc2V0S2luZCwgZGlzcGxheUluZm8sIGVsZW1lbnRTaGFwZSwgcmVjb3ZlcnlTZXRzU3RhdGUsIG9wdFNodXRkb3duV2l0aEZhaWx1cmUgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgYnJhbmQgPSBpc3N1ZXJab25lLmV4byhgJHtuYW1lfSBicmFuZGAsIEJyYW5kSSwge1xuICAgIGlzTXlJc3N1ZXIoYWxsZWdlZElzc3Vlcikge1xuICAgICAgcmV0dXJuIGFsbGVnZWRJc3N1ZXIgPT09IGlzc3VlcjtcbiAgICB9LFxuICAgIGdldEFsbGVnZWROYW1lKCkge1xuICAgICAgcmV0dXJuIG5hbWU7XG4gICAgfSxcbiAgICAvL1xuICAgIGdldERpc3BsYXlJbmZvKCkge1xuICAgICAgcmV0dXJuIGRpc3BsYXlJbmZvO1xuICAgIH0sXG4gICAgZ2V0QW1vdW50U2hhcGUoKSB7XG4gICAgICByZXR1cm4gYW1vdW50U2hhcGU7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgYW1vdW50U2hhcGUgPSBhbW91bnRTaGFwZUZyb21FbGVtZW50U2hhcGUoXG4gICAgYnJhbmQsXG4gICAgYXNzZXRLaW5kLFxuICAgIGVsZW1lbnRTaGFwZVxuICApO1xuICBjb25zdCB7IElzc3VlckksIE1pbnRJLCBQYXltZW50SSwgUHVyc2VJS2l0IH0gPSBtYWtlSXNzdWVySW50ZXJmYWNlcyhcbiAgICBicmFuZCxcbiAgICBhc3NldEtpbmQsXG4gICAgYW1vdW50U2hhcGVcbiAgKTtcbiAgY29uc3QgbWFrZVBheW1lbnQgPSBwcmVwYXJlUGF5bWVudEtpbmQoaXNzdWVyWm9uZSwgbmFtZSwgYnJhbmQsIFBheW1lbnRJKTtcbiAgY29uc3Qgc2h1dGRvd25MZWRnZXJXaXRoRmFpbHVyZSA9IChyZWFzb24pID0+IHtcbiAgICBpZiAob3B0U2h1dGRvd25XaXRoRmFpbHVyZSAhPT0gdm9pZCAwKSB7XG4gICAgICB0cnkge1xuICAgICAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlKHJlYXNvbik7XG4gICAgICB9IGNhdGNoIChlcnJJblNodXRkb3duKSB7XG4gICAgICAgIG5vdGUoZXJySW5TaHV0ZG93biwgcmVkYWN0ZWRgQ2F1c2VkIGJ5OiAke3JlYXNvbn1gKTtcbiAgICAgICAgdGhyb3cgZXJySW5TaHV0ZG93bjtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhyb3cgcmVhc29uO1xuICB9O1xuICBjb25zdCBwYXltZW50TGVkZ2VyID0gaXNzdWVyWm9uZS53ZWFrTWFwU3RvcmUoXCJwYXltZW50TGVkZ2VyXCIsIHtcbiAgICB2YWx1ZVNoYXBlOiBhbW91bnRTaGFwZVxuICB9KTtcbiAgY29uc3QgcGF5bWVudFJlY292ZXJ5U2V0cyA9IGlzc3VlclpvbmUud2Vha01hcFN0b3JlKFwicGF5bWVudFJlY292ZXJ5U2V0c1wiKTtcbiAgY29uc3QgaW5pdFBheW1lbnQgPSAocGF5bWVudCwgYW1vdW50LCBvcHRSZWNvdmVyeVNldCA9IHZvaWQgMCkgPT4ge1xuICAgIGlmIChyZWNvdmVyeVNldHNTdGF0ZSA9PT0gXCJub1JlY292ZXJ5U2V0c1wiKSB7XG4gICAgICBvcHRSZWNvdmVyeVNldCA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgd2hlbiByZWNvdmVyU2V0c1N0YXRlID09PSAnbm9SZWNvdmVyeVNldHMnLCBvcHRSZWNvdmVyeVNldCBtdXN0IGJlIGVtcHR5YDtcbiAgICB9XG4gICAgaWYgKG9wdFJlY292ZXJ5U2V0ICE9PSB2b2lkIDAgJiYgIUFtb3VudE1hdGguaXNFbXB0eShhbW91bnQpKSB7XG4gICAgICBvcHRSZWNvdmVyeVNldC5hZGQocGF5bWVudCk7XG4gICAgICBwYXltZW50UmVjb3ZlcnlTZXRzLmluaXQocGF5bWVudCwgb3B0UmVjb3ZlcnlTZXQpO1xuICAgIH1cbiAgICBwYXltZW50TGVkZ2VyLmluaXQocGF5bWVudCwgYW1vdW50KTtcbiAgfTtcbiAgY29uc3QgZGVsZXRlUGF5bWVudCA9IChwYXltZW50KSA9PiB7XG4gICAgcGF5bWVudExlZGdlci5kZWxldGUocGF5bWVudCk7XG4gICAgaWYgKHBheW1lbnRSZWNvdmVyeVNldHMuaGFzKHBheW1lbnQpKSB7XG4gICAgICBjb25zdCByZWNvdmVyeVNldCA9IHBheW1lbnRSZWNvdmVyeVNldHMuZ2V0KHBheW1lbnQpO1xuICAgICAgcGF5bWVudFJlY292ZXJ5U2V0cy5kZWxldGUocGF5bWVudCk7XG4gICAgICByZWNvdmVyeVNldC5kZWxldGUocGF5bWVudCk7XG4gICAgfVxuICB9O1xuICBjb25zdCBjb2VyY2UgPSAoYWxsZWdlZEFtb3VudCkgPT4gQW1vdW50TWF0aC5jb2VyY2UoYnJhbmQsIGFsbGVnZWRBbW91bnQpO1xuICBjb25zdCBhc3NlcnRBbW91bnRDb25zaXN0ZW50ID0gKHBheW1lbnRCYWxhbmNlLCBvcHRBbW91bnRTaGFwZSkgPT4ge1xuICAgIGlmIChvcHRBbW91bnRTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2gocGF5bWVudEJhbGFuY2UsIG9wdEFtb3VudFNoYXBlLCBcImFtb3VudFwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydExpdmVQYXltZW50ID0gKHBheW1lbnQpID0+IHtcbiAgICBwYXltZW50TGVkZ2VyLmhhcyhwYXltZW50KSB8fCB0aHJvd1JlZGFjdGVkYCR7cGF5bWVudH0gd2FzIG5vdCBhIGxpdmUgcGF5bWVudCBmb3IgYnJhbmQgJHtxdW90ZShcbiAgICAgIGJyYW5kXG4gICAgKX0uIEl0IGNvdWxkIGJlIGEgdXNlZC11cCBwYXltZW50LCBhIHBheW1lbnQgZm9yIGFub3RoZXIgYnJhbmQsIG9yIGl0IG1pZ2h0IG5vdCBiZSBhIHBheW1lbnQgYXQgYWxsLmA7XG4gIH07XG4gIGNvbnN0IGRlcG9zaXRJbnRlcm5hbCA9IChiYWxhbmNlU3RvcmUsIHNyY1BheW1lbnQsIG9wdEFtb3VudFNoYXBlID0gdm9pZCAwKSA9PiB7XG4gICAgIWlzUHJvbWlzZShzcmNQYXltZW50KSB8fCBhc3NlcnQuZmFpbChcbiAgICAgIGBkZXBvc2l0IGRvZXMgbm90IGFjY2VwdCBwcm9taXNlcyBhcyBmaXJzdCBhcmd1bWVudC4gSW5zdGVhZCBvZiBwYXNzaW5nIHRoZSBwcm9taXNlIChkZXBvc2l0KHBheW1lbnRQcm9taXNlKSksIGNvbnNpZGVyIHVud3JhcHBpbmcgdGhlIHByb21pc2UgZmlyc3Q6IEUud2hlbihwYXltZW50UHJvbWlzZSwgKGFjdHVhbFBheW1lbnQgPT4gZGVwb3NpdChhY3R1YWxQYXltZW50KSlgLFxuICAgICAgVHlwZUVycm9yXG4gICAgKTtcbiAgICBhc3NlcnRMaXZlUGF5bWVudChzcmNQYXltZW50KTtcbiAgICBjb25zdCBzcmNQYXltZW50QmFsYW5jZSA9IHBheW1lbnRMZWRnZXIuZ2V0KHNyY1BheW1lbnQpO1xuICAgIGFzc2VydEFtb3VudENvbnNpc3RlbnQoc3JjUGF5bWVudEJhbGFuY2UsIG9wdEFtb3VudFNoYXBlKTtcbiAgICB0cnkge1xuICAgICAgZGVsZXRlUGF5bWVudChzcmNQYXltZW50KTtcbiAgICAgIGJhbGFuY2VTdG9yZS5pbmNyZW1lbnQoc3JjUGF5bWVudEJhbGFuY2UpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgc2h1dGRvd25MZWRnZXJXaXRoRmFpbHVyZShlcnIpO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICByZXR1cm4gc3JjUGF5bWVudEJhbGFuY2U7XG4gIH07XG4gIGNvbnN0IHdpdGhkcmF3SW50ZXJuYWwgPSAoYmFsYW5jZVN0b3JlLCBhbW91bnQsIHJlY292ZXJ5U2V0ID0gdm9pZCAwKSA9PiB7XG4gICAgYW1vdW50ID0gY29lcmNlKGFtb3VudCk7XG4gICAgY29uc3QgcGF5bWVudCA9IG1ha2VQYXltZW50KCk7XG4gICAgYmFsYW5jZVN0b3JlLmRlY3JlbWVudChhbW91bnQpIHx8IHRocm93UmVkYWN0ZWRgV2l0aGRyYXdhbCBvZiAke2Ftb3VudH0gZmFpbGVkIGJlY2F1c2UgdGhlIHB1cnNlIG9ubHkgY29udGFpbmVkICR7YmFsYW5jZVN0b3JlLmdldEFtb3VudCgpfWA7XG4gICAgdHJ5IHtcbiAgICAgIGluaXRQYXltZW50KHBheW1lbnQsIGFtb3VudCwgcmVjb3ZlcnlTZXQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgc2h1dGRvd25MZWRnZXJXaXRoRmFpbHVyZShlcnIpO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICByZXR1cm4gcGF5bWVudDtcbiAgfTtcbiAgY29uc3QgbWFrZUVtcHR5UHVyc2UgPSBwcmVwYXJlUHVyc2VLaW5kKFxuICAgIGlzc3VlclpvbmUsXG4gICAgbmFtZSxcbiAgICBhc3NldEtpbmQsXG4gICAgYnJhbmQsXG4gICAgUHVyc2VJS2l0LFxuICAgIGhhcmRlbih7XG4gICAgICBkZXBvc2l0SW50ZXJuYWwsXG4gICAgICB3aXRoZHJhd0ludGVybmFsXG4gICAgfSksXG4gICAgcmVjb3ZlcnlTZXRzU3RhdGUsXG4gICAgcGF5bWVudFJlY292ZXJ5U2V0c1xuICApO1xuICBjb25zdCBpc3N1ZXIgPSBpc3N1ZXJab25lLmV4byhgJHtuYW1lfSBpc3N1ZXJgLCBJc3N1ZXJJLCB7XG4gICAgZ2V0QnJhbmQoKSB7XG4gICAgICByZXR1cm4gYnJhbmQ7XG4gICAgfSxcbiAgICBnZXRBbGxlZ2VkTmFtZSgpIHtcbiAgICAgIHJldHVybiBuYW1lO1xuICAgIH0sXG4gICAgZ2V0QXNzZXRLaW5kKCkge1xuICAgICAgcmV0dXJuIGFzc2V0S2luZDtcbiAgICB9LFxuICAgIGdldERpc3BsYXlJbmZvKCkge1xuICAgICAgcmV0dXJuIGRpc3BsYXlJbmZvO1xuICAgIH0sXG4gICAgbWFrZUVtcHR5UHVyc2UoKSB7XG4gICAgICByZXR1cm4gbWFrZUVtcHR5UHVyc2UoKTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGlzTGl2ZShwYXltZW50KSB7XG4gICAgICByZXR1cm4gcGF5bWVudExlZGdlci5oYXMocGF5bWVudCk7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBnZXRBbW91bnRPZihwYXltZW50KSB7XG4gICAgICBhc3NlcnRMaXZlUGF5bWVudChwYXltZW50KTtcbiAgICAgIHJldHVybiBwYXltZW50TGVkZ2VyLmdldChwYXltZW50KTtcbiAgICB9LFxuICAgIC8qXG5cblxuICAgICAqL1xuICAgIGJ1cm4ocGF5bWVudCwgb3B0QW1vdW50U2hhcGUgPSB2b2lkIDApIHtcbiAgICAgIGFzc2VydExpdmVQYXltZW50KHBheW1lbnQpO1xuICAgICAgY29uc3QgcGF5bWVudEJhbGFuY2UgPSBwYXltZW50TGVkZ2VyLmdldChwYXltZW50KTtcbiAgICAgIGFzc2VydEFtb3VudENvbnNpc3RlbnQocGF5bWVudEJhbGFuY2UsIG9wdEFtb3VudFNoYXBlKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGRlbGV0ZVBheW1lbnQocGF5bWVudCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgc2h1dGRvd25MZWRnZXJXaXRoRmFpbHVyZShlcnIpO1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGF5bWVudEJhbGFuY2U7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgbWludFJlY292ZXJ5UHVyc2UgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgICBpc3N1ZXJab25lLm1ha2VPbmNlKFwibWludFJlY292ZXJ5UHVyc2VcIiwgKCkgPT4gbWFrZUVtcHR5UHVyc2UoKSlcbiAgKTtcbiAgY29uc3QgbWludCA9IGlzc3VlclpvbmUuZXhvKGAke25hbWV9IG1pbnRgLCBNaW50SSwge1xuICAgIGdldElzc3VlcigpIHtcbiAgICAgIHJldHVybiBpc3N1ZXI7XG4gICAgfSxcbiAgICBtaW50UGF5bWVudChuZXdBbW91bnQpIHtcbiAgICAgIG5ld0Ftb3VudCA9IGNvZXJjZShuZXdBbW91bnQpO1xuICAgICAgbXVzdE1hdGNoKG5ld0Ftb3VudCwgYW1vdW50U2hhcGUsIFwibWludGVkIGFtb3VudFwiKTtcbiAgICAgIGNvbnN0IHJhd1BheW1lbnQgPSBtYWtlUGF5bWVudCgpO1xuICAgICAgaW5pdFBheW1lbnQocmF3UGF5bWVudCwgbmV3QW1vdW50LCB2b2lkIDApO1xuICAgICAgY29uc3QgbWludFJlY292ZXJ5UHVyc2VCZWZvcmUgPSBtaW50UmVjb3ZlcnlQdXJzZS5nZXRDdXJyZW50QW1vdW50KCk7XG4gICAgICBtaW50UmVjb3ZlcnlQdXJzZS5kZXBvc2l0KHJhd1BheW1lbnQsIG5ld0Ftb3VudCk7XG4gICAgICBjb25zdCBwYXltZW50ID0gbWludFJlY292ZXJ5UHVyc2Uud2l0aGRyYXcobmV3QW1vdW50KTtcbiAgICAgIGNvbnN0IG1pbnRSZWNvdmVyeVB1cnNlQWZ0ZXIgPSBtaW50UmVjb3ZlcnlQdXJzZS5nZXRDdXJyZW50QW1vdW50KCk7XG4gICAgICBhc3NlcnQoa2V5RVEobWludFJlY292ZXJ5UHVyc2VCZWZvcmUsIG1pbnRSZWNvdmVyeVB1cnNlQWZ0ZXIpKTtcbiAgICAgIHJldHVybiBwYXltZW50O1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IGlzc3VlcktpdCA9IGhhcmRlbih7IGlzc3VlciwgbWludCwgYnJhbmQsIG1pbnRSZWNvdmVyeVB1cnNlIH0pO1xuICByZXR1cm4gaXNzdWVyS2l0O1xufTtcbmhhcmRlbihwcmVwYXJlUGF5bWVudExlZGdlcik7XG5cbi8vXG52YXIgc2V0dXBJc3N1ZXJLaXQgPSAoeyBuYW1lLCBhc3NldEtpbmQsIGRpc3BsYXlJbmZvLCBlbGVtZW50U2hhcGUgfSwgaXNzdWVyWm9uZSwgcmVjb3ZlcnlTZXRzU3RhdGUsIG9wdFNodXRkb3duV2l0aEZhaWx1cmUgPSB2b2lkIDApID0+IHtcbiAgYXNzZXJ0Mi50eXBlb2YobmFtZSwgXCJzdHJpbmdcIik7XG4gIGFzc2VydEFzc2V0S2luZChhc3NldEtpbmQpO1xuICBjb25zdCBjbGVhbkRpc3BsYXlJbmZvID0gY29lcmNlRGlzcGxheUluZm8oZGlzcGxheUluZm8sIGFzc2V0S2luZCk7XG4gIGlmIChvcHRTaHV0ZG93bldpdGhGYWlsdXJlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnQyLnR5cGVvZihvcHRTaHV0ZG93bldpdGhGYWlsdXJlLCBcImZ1bmN0aW9uXCIpO1xuICB9XG4gIGlmIChlbGVtZW50U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oZWxlbWVudFNoYXBlKTtcbiAgfVxuICBjb25zdCB7IGlzc3VlciwgbWludCwgYnJhbmQsIG1pbnRSZWNvdmVyeVB1cnNlIH0gPSBwcmVwYXJlUGF5bWVudExlZGdlcihcbiAgICBpc3N1ZXJab25lLFxuICAgIG5hbWUsXG4gICAgYXNzZXRLaW5kLFxuICAgIGNsZWFuRGlzcGxheUluZm8sXG4gICAgZWxlbWVudFNoYXBlLFxuICAgIHJlY292ZXJ5U2V0c1N0YXRlLFxuICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmVcbiAgKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgYnJhbmQsXG4gICAgaXNzdWVyLFxuICAgIG1pbnQsXG4gICAgbWludFJlY292ZXJ5UHVyc2UsXG4gICAgZGlzcGxheUluZm86IGNsZWFuRGlzcGxheUluZm9cbiAgfSk7XG59O1xuaGFyZGVuKHNldHVwSXNzdWVyS2l0KTtcbnZhciBJTlNUQU5DRV9LRVkgPSBcImlzc3VlclwiO1xudmFyIFJFQ09WRVJZX1NFVFNfU1RBVEUgPSBcInJlY292ZXJ5U2V0c1N0YXRlXCI7XG52YXIgdXBncmFkZUlzc3VlcktpdCA9IChpc3N1ZXJCYWdnYWdlLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwLCByZWNvdmVyeVNldHNPcHRpb24gPSB2b2lkIDApID0+IHtcbiAgY29uc3QgaXNzdWVyUmVjb3JkID0gaXNzdWVyQmFnZ2FnZS5nZXQoSU5TVEFOQ0VfS0VZKTtcbiAgY29uc3QgaXNzdWVyWm9uZSA9IG1ha2VEdXJhYmxlWm9uZShpc3N1ZXJCYWdnYWdlKTtcbiAgY29uc3Qgb2xkUmVjb3ZlcnlTZXRzU3RhdGUgPSBpc3N1ZXJCYWdnYWdlLmhhcyhSRUNPVkVSWV9TRVRTX1NUQVRFKSA/IGlzc3VlckJhZ2dhZ2UuZ2V0KFJFQ09WRVJZX1NFVFNfU1RBVEUpIDogXCJoYXNSZWNvdmVyeVNldHNcIjtcbiAgaWYgKG9sZFJlY292ZXJ5U2V0c1N0YXRlID09PSBcIm5vUmVjb3ZlcnlTZXRzXCIgJiYgcmVjb3ZlcnlTZXRzT3B0aW9uID09PSBcImhhc1JlY292ZXJ5U2V0c1wiKSB7XG4gICAgdGhyb3dSZWRhY3RlZGBDYW5ub3QgKHlldD8pIHVwZ3JhZGUgZnJvbSAnbm9SZWNvdmVyeVNldHMnIHRvICdoYXNSZWNvdmVyeVNldHMnYDtcbiAgfVxuICBjb25zdCByZWNvdmVyeVNldHNTdGF0ZSA9IHJlY292ZXJ5U2V0c09wdGlvbiB8fCBvbGRSZWNvdmVyeVNldHNTdGF0ZTtcbiAgcmV0dXJuIHNldHVwSXNzdWVyS2l0KFxuICAgIGlzc3VlclJlY29yZCxcbiAgICBpc3N1ZXJab25lLFxuICAgIHJlY292ZXJ5U2V0c1N0YXRlLFxuICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmVcbiAgKTtcbn07XG5oYXJkZW4odXBncmFkZUlzc3VlcktpdCk7XG52YXIgaGFzSXNzdWVyID0gKGJhZ2dhZ2UpID0+IGJhZ2dhZ2UuaGFzKElOU1RBTkNFX0tFWSk7XG52YXIgbWFrZUR1cmFibGVJc3N1ZXJLaXQgPSAoaXNzdWVyQmFnZ2FnZSwgbmFtZSwgYXNzZXRLaW5kID0gQXNzZXRLaW5kLk5BVCwgZGlzcGxheUluZm8gPSBoYXJkZW4oe30pLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwLCB7IGVsZW1lbnRTaGFwZSA9IHZvaWQgMCwgcmVjb3ZlcnlTZXRzT3B0aW9uID0gdm9pZCAwIH0gPSB7fSkgPT4ge1xuICBjb25zdCBpc3N1ZXJEYXRhID0gaGFyZGVuKHtcbiAgICBuYW1lLFxuICAgIGFzc2V0S2luZCxcbiAgICBkaXNwbGF5SW5mbyxcbiAgICBlbGVtZW50U2hhcGVcbiAgfSk7XG4gIGlzc3VlckJhZ2dhZ2UuaW5pdChJTlNUQU5DRV9LRVksIGlzc3VlckRhdGEpO1xuICBjb25zdCBpc3N1ZXJab25lID0gbWFrZUR1cmFibGVab25lKGlzc3VlckJhZ2dhZ2UpO1xuICBjb25zdCByZWNvdmVyeVNldHNTdGF0ZSA9IHJlY292ZXJ5U2V0c09wdGlvbiB8fCBcImhhc1JlY292ZXJ5U2V0c1wiO1xuICBpc3N1ZXJCYWdnYWdlLmluaXQoUkVDT1ZFUllfU0VUU19TVEFURSwgcmVjb3ZlcnlTZXRzU3RhdGUpO1xuICByZXR1cm4gc2V0dXBJc3N1ZXJLaXQoXG4gICAgaXNzdWVyRGF0YSxcbiAgICBpc3N1ZXJab25lLFxuICAgIHJlY292ZXJ5U2V0c1N0YXRlLFxuICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmVcbiAgKTtcbn07XG5oYXJkZW4obWFrZUR1cmFibGVJc3N1ZXJLaXQpO1xudmFyIHByZXBhcmVJc3N1ZXJLaXQgPSAoaXNzdWVyQmFnZ2FnZSwgbmFtZSwgYXNzZXRLaW5kID0gQXNzZXRLaW5kLk5BVCwgZGlzcGxheUluZm8gPSBoYXJkZW4oe30pLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwLCBvcHRpb25zID0ge30pID0+IHtcbiAgaWYgKGhhc0lzc3Vlcihpc3N1ZXJCYWdnYWdlKSkge1xuICAgIGNvbnN0IHsgZWxlbWVudFNoYXBlOiBfID0gdm9pZCAwLCByZWNvdmVyeVNldHNPcHRpb24gPSB2b2lkIDAgfSA9IG9wdGlvbnM7XG4gICAgY29uc3QgaXNzdWVyS2l0ID0gdXBncmFkZUlzc3VlcktpdChcbiAgICAgIGlzc3VlckJhZ2dhZ2UsXG4gICAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlLFxuICAgICAgcmVjb3ZlcnlTZXRzT3B0aW9uXG4gICAgKTtcbiAgICByZXR1cm4gaXNzdWVyS2l0O1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGlzc3VlcktpdCA9IG1ha2VEdXJhYmxlSXNzdWVyS2l0KFxuICAgICAgaXNzdWVyQmFnZ2FnZSxcbiAgICAgIG5hbWUsXG4gICAgICBhc3NldEtpbmQsXG4gICAgICBkaXNwbGF5SW5mbyxcbiAgICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmUsXG4gICAgICBvcHRpb25zXG4gICAgKTtcbiAgICByZXR1cm4gaXNzdWVyS2l0O1xuICB9XG59O1xuaGFyZGVuKHByZXBhcmVJc3N1ZXJLaXQpO1xudmFyIG1ha2VJc3N1ZXJLaXQgPSAobmFtZSwgYXNzZXRLaW5kID0gQXNzZXRLaW5kLk5BVCwgZGlzcGxheUluZm8gPSBoYXJkZW4oe30pLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwLCB7IGVsZW1lbnRTaGFwZSA9IHZvaWQgMCwgcmVjb3ZlcnlTZXRzT3B0aW9uID0gdm9pZCAwIH0gPSB7fSkgPT4gKFxuICAvL1xuICBtYWtlRHVyYWJsZUlzc3VlcktpdChcbiAgICBtYWtlU2NhbGFyQmlnTWFwU3RvcmUoXCJkcm9wcGVkIGlzc3VlciBraXRcIiwgeyBkdXJhYmxlOiB0cnVlIH0pLFxuICAgIG5hbWUsXG4gICAgYXNzZXRLaW5kLFxuICAgIGRpc3BsYXlJbmZvLFxuICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmUsXG4gICAgeyBlbGVtZW50U2hhcGUsIHJlY292ZXJ5U2V0c09wdGlvbiB9XG4gIClcbik7XG5oYXJkZW4obWFrZUlzc3VlcktpdCk7XG5cbi8vXG52YXIgcGFkZGluZyA9IFwiPVwiO1xudmFyIGFscGhhYmV0NjQgPSBcIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky9cIjtcbnZhciBtb25vZHU2NCA9IHt9O1xuZm9yIChsZXQgaTIgPSAwOyBpMiA8IGFscGhhYmV0NjQubGVuZ3RoOyBpMiArPSAxKSB7XG4gIGNvbnN0IGMyID0gYWxwaGFiZXQ2NFtpMl07XG4gIG1vbm9kdTY0W2MyXSA9IGkyO1xufVxuXG4vL1xudmFyIGpzRW5jb2RlQmFzZTY0ID0gKGRhdGEpID0+IHtcbiAgbGV0IHN0cmluZyA9IFwiXCI7XG4gIGxldCByZWdpc3RlciA9IDA7XG4gIGxldCBxdWFudHVtID0gMDtcbiAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGRhdGEubGVuZ3RoOyBpMiArPSAxKSB7XG4gICAgY29uc3QgYjMgPSBkYXRhW2kyXTtcbiAgICByZWdpc3RlciA9IHJlZ2lzdGVyIDw8IDggfCBiMztcbiAgICBxdWFudHVtICs9IDg7XG4gICAgaWYgKHF1YW50dW0gPT09IDI0KSB7XG4gICAgICBzdHJpbmcgKz0gYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gMTggJiA2M10gKyBhbHBoYWJldDY0W3JlZ2lzdGVyID4+PiAxMiAmIDYzXSArIGFscGhhYmV0NjRbcmVnaXN0ZXIgPj4+IDYgJiA2M10gKyBhbHBoYWJldDY0W3JlZ2lzdGVyID4+PiAwICYgNjNdO1xuICAgICAgcmVnaXN0ZXIgPSAwO1xuICAgICAgcXVhbnR1bSA9IDA7XG4gICAgfVxuICB9XG4gIHN3aXRjaCAocXVhbnR1bSkge1xuICAgIGNhc2UgMDpcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgODpcbiAgICAgIHN0cmluZyArPSBhbHBoYWJldDY0W3JlZ2lzdGVyID4+PiAyICYgNjNdICsgYWxwaGFiZXQ2NFtyZWdpc3RlciA8PCA0ICYgNjNdICsgcGFkZGluZyArIHBhZGRpbmc7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDE2OlxuICAgICAgc3RyaW5nICs9IGFscGhhYmV0NjRbcmVnaXN0ZXIgPj4+IDEwICYgNjNdICsgYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gNCAmIDYzXSArIGFscGhhYmV0NjRbcmVnaXN0ZXIgPDwgMiAmIDYzXSArIHBhZGRpbmc7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgRXJyb3IoYGludGVybmFsOiBiYWQgcXVhbnR1bSAke3F1YW50dW19YCk7XG4gIH1cbiAgcmV0dXJuIHN0cmluZztcbn07XG52YXIgZW5jb2RlQmFzZTY0ID0gZ2xvYmFsVGhpcy5CYXNlNjQgIT09IHZvaWQgMCA/IGdsb2JhbFRoaXMuQmFzZTY0LmVuY29kZSA6IGpzRW5jb2RlQmFzZTY0O1xuXG4vL1xudmFyIGpzRGVjb2RlQmFzZTY0ID0gKHN0cmluZywgbmFtZSA9IFwiPHVua25vd24+XCIpID0+IHtcbiAgY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KE1hdGguY2VpbChzdHJpbmcubGVuZ3RoICogNCAvIDMpKTtcbiAgbGV0IHJlZ2lzdGVyID0gMDtcbiAgbGV0IHF1YW50dW0gPSAwO1xuICBsZXQgaTIgPSAwO1xuICBsZXQgaiA9IDA7XG4gIHdoaWxlIChpMiA8IHN0cmluZy5sZW5ndGggJiYgc3RyaW5nW2kyXSAhPT0gcGFkZGluZykge1xuICAgIGNvbnN0IG51bWJlciA9IG1vbm9kdTY0W3N0cmluZ1tpMl1dO1xuICAgIGlmIChudW1iZXIgPT09IHZvaWQgMCkge1xuICAgICAgdGhyb3cgRXJyb3IoYEludmFsaWQgYmFzZTY0IGNoYXJhY3RlciAke3N0cmluZ1tpMl19IGluIHN0cmluZyAke25hbWV9YCk7XG4gICAgfVxuICAgIHJlZ2lzdGVyID0gcmVnaXN0ZXIgPDwgNiB8IG51bWJlcjtcbiAgICBxdWFudHVtICs9IDY7XG4gICAgaWYgKHF1YW50dW0gPj0gOCkge1xuICAgICAgcXVhbnR1bSAtPSA4O1xuICAgICAgZGF0YVtqXSA9IHJlZ2lzdGVyID4+PiBxdWFudHVtO1xuICAgICAgaiArPSAxO1xuICAgICAgcmVnaXN0ZXIgJj0gKDEgPDwgcXVhbnR1bSkgLSAxO1xuICAgIH1cbiAgICBpMiArPSAxO1xuICB9XG4gIHdoaWxlIChxdWFudHVtID4gMCkge1xuICAgIGlmIChpMiA9PT0gc3RyaW5nLmxlbmd0aCB8fCBzdHJpbmdbaTJdICE9PSBwYWRkaW5nKSB7XG4gICAgICB0aHJvdyBFcnJvcihgTWlzc2luZyBwYWRkaW5nIGF0IG9mZnNldCAke2kyfSBvZiBzdHJpbmcgJHtuYW1lfWApO1xuICAgIH1cbiAgICBpMiArPSAxO1xuICAgIHF1YW50dW0gLT0gMjtcbiAgfVxuICBpZiAoaTIgPCBzdHJpbmcubGVuZ3RoKSB7XG4gICAgdGhyb3cgRXJyb3IoXG4gICAgICBgQmFzZTY0IHN0cmluZyBoYXMgdHJhaWxpbmcgZ2FyYmFnZSAke3N0cmluZy5zdWJzdHIoXG4gICAgICAgIGkyXG4gICAgICApfSBpbiBzdHJpbmcgJHtuYW1lfWBcbiAgICApO1xuICB9XG4gIHJldHVybiBkYXRhLnN1YmFycmF5KDAsIGopO1xufTtcbnZhciBhZGFwdERlY29kZXIgPSAobmF0aXZlRGVjb2RlQmFzZTY0KSA9PiAoLi4uYXJncykgPT4ge1xuICBjb25zdCBkZWNvZGVkID0gbmF0aXZlRGVjb2RlQmFzZTY0KC4uLmFyZ3MpO1xuICBpZiAoZGVjb2RlZCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHtcbiAgICByZXR1cm4gZGVjb2RlZDtcbiAgfVxuICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoZGVjb2RlZCk7XG59O1xudmFyIGRlY29kZUJhc2U2NCA9IGdsb2JhbFRoaXMuQmFzZTY0ICE9PSB2b2lkIDAgPyBhZGFwdERlY29kZXIoZ2xvYmFsVGhpcy5CYXNlNjQuZGVjb2RlKSA6IGpzRGVjb2RlQmFzZTY0O1xuXG4vL1xudmFyIGF0b2IgPSAoZW5jb2RlZERhdGEpID0+IHtcbiAgY29uc3QgYnVmID0gZGVjb2RlQmFzZTY0KGVuY29kZWREYXRhKTtcbiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uYnVmKTtcbn07XG5cbi8vXG52YXIgY29lcmNlVG9CeXRlQXJyYXkgPSAoY29udGVudHMpID0+IHtcbiAgaWYgKHR5cGVvZiBjb250ZW50cyA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiBVaW50OEFycmF5LmZyb20oY29udGVudHMsIChjMikgPT4ge1xuICAgICAgY29uc3QgYjMgPSBjMi5jaGFyQ29kZUF0KDApO1xuICAgICAgYjMgPD0gMjU1IHx8IHRocm93UmVkYWN0ZWRgY2hhcmFjdGVyIGNhbm5vdCBiZSBjb2VyY2VkIHRvIGFuIG9jdGV0OiAke2MyfWA7XG4gICAgICByZXR1cm4gYjM7XG4gICAgfSk7XG4gIH0gZWxzZSBpZiAoY29udGVudHMgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG4gICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KFxuICAgICAgY29udGVudHMuYnVmZmVyLFxuICAgICAgY29udGVudHMuYnl0ZU9mZnNldCxcbiAgICAgIGNvbnRlbnRzLmJ5dGVMZW5ndGhcbiAgICApO1xuICB9XG4gIHJldHVybiBuZXcgVWludDhBcnJheShjb250ZW50cyk7XG59O1xuZnVuY3Rpb24gdG9CeXRlcyhieXRlU291cmNlKSB7XG4gIGNvbnN0IGJ1ZiA9IGNvZXJjZVRvQnl0ZUFycmF5KGJ5dGVTb3VyY2UpO1xuICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSguLi5idWYpO1xufVxuZnVuY3Rpb24gYmFzZTY0VG9CeXRlcyhzdHJpbmcpIHtcbiAgcmV0dXJuIHRvQnl0ZXMoZGVjb2RlQmFzZTY0KHN0cmluZykpO1xufVxuXG4vL1xudmFyIFNoYXBlMSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIC8qXG5cblxuICAgICAqL1xuICAgIERhdGE6IE0uc3RyaW5nKCksXG4gICAgQnl0ZXM6IE0uc3RyaW5nKCksXG4gICAgRW5kcG9pbnQ6IE0uc3RyaW5nKCksXG4gICAgVm93OiBNLnRhZ2dlZChcbiAgICAgIFwiVm93XCIsXG4gICAgICBoYXJkZW4oe1xuICAgICAgICB2b3dWMDogTS5yZW1vdGFibGUoXCJWb3dWMFwiKVxuICAgICAgfSlcbiAgICApLFxuICAgIENvbm5lY3Rpb25IYW5kbGVyOiBNLnJlbW90YWJsZShcIkNvbm5lY3Rpb25IYW5kbGVyXCIpLFxuICAgIENvbm5lY3Rpb246IE0ucmVtb3RhYmxlKFwiQ29ubmVjdGlvblwiKSxcbiAgICBJbmJvdW5kQXR0ZW1wdDogTS5yZW1vdGFibGUoXCJJbmJvdW5kQXR0ZW1wdFwiKSxcbiAgICBMaXN0ZW5lcjogTS5yZW1vdGFibGUoXCJMaXN0ZW5lclwiKSxcbiAgICBMaXN0ZW5IYW5kbGVyOiBNLnJlbW90YWJsZShcIkxpc3RlbkhhbmRsZXJcIiksXG4gICAgUG9ydDogTS5yZW1vdGFibGUoXCJQb3J0XCIpLFxuICAgIFByb3RvY29sSGFuZGxlcjogTS5yZW1vdGFibGUoXCJQcm90b2NvbEhhbmRsZXJcIiksXG4gICAgUHJvdG9jb2xJbXBsOiBNLnJlbW90YWJsZShcIlByb3RvY29sSW1wbFwiKVxuICB9XG4pO1xudmFyIFNlbmRPcHRpb25zU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7fSxcbiAgeyByZWxhdGl2ZVRpbWVvdXROczogTS5iaWdpbnQoKSB9XG4pO1xudmFyIFNoYXBlMiA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIC4uLlNoYXBlMSxcbiAgICBWb3ckOiAoc2hhcGUpID0+IE0ub3Ioc2hhcGUsIFNoYXBlMS5Wb3cpLFxuICAgIEF0dGVtcHREZXNjcmlwdGlvbjogTS5zcGxpdFJlY29yZChcbiAgICAgIHsgaGFuZGxlcjogU2hhcGUxLkNvbm5lY3Rpb25IYW5kbGVyIH0sXG4gICAgICB7IHJlbW90ZUFkZHJlc3M6IFNoYXBlMS5FbmRwb2ludCwgbG9jYWxBZGRyZXNzOiBTaGFwZTEuRW5kcG9pbnQgfVxuICAgICksXG4gICAgT3B0czogU2VuZE9wdGlvbnNTaGFwZVxuICB9XG4pO1xudmFyIFNoYXBlID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBoYXJkZW4oe1xuICAgIC4uLlNoYXBlMixcbiAgICBDb25uZWN0aW9uSToge1xuICAgICAgY29ubmVjdGlvbjogTS5pbnRlcmZhY2UoXCJDb25uZWN0aW9uXCIsIHtcbiAgICAgICAgc2VuZDogTS5jYWxsV2hlbihTaGFwZTIuRGF0YSkub3B0aW9uYWwoU2hhcGUyLk9wdHMpLnJldHVybnMoU2hhcGUyLlZvdyQoU2hhcGUyLkJ5dGVzKSksXG4gICAgICAgIGNsb3NlOiBNLmNhbGxXaGVuKCkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSksXG4gICAgICAgIGdldExvY2FsQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhTaGFwZTIuRW5kcG9pbnQpLFxuICAgICAgICBnZXRSZW1vdGVBZGRyZXNzOiBNLmNhbGwoKS5yZXR1cm5zKFNoYXBlMi5FbmRwb2ludClcbiAgICAgIH0pLFxuICAgICAgb3BlbkNvbm5lY3Rpb25BY2tXYXRjaGVyOiBNLmludGVyZmFjZShcIk9wZW5Db25uZWN0aW9uQWNrV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJSZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXJcIiwge1xuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHNpbmtXYXRjaGVyOiBNLmludGVyZmFjZShcIlNpbmtXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoKVxuICAgICAgfSlcbiAgICB9LFxuICAgIEluYm91bmRBdHRlbXB0SToge1xuICAgICAgaW5ib3VuZEF0dGVtcHQ6IE0uaW50ZXJmYWNlKFwiSW5ib3VuZEF0dGVtcHRcIiwge1xuICAgICAgICBhY2NlcHQ6IE0uY2FsbFdoZW4oU2hhcGUyLkF0dGVtcHREZXNjcmlwdGlvbikucmV0dXJucyhcbiAgICAgICAgICBTaGFwZTIuVm93JChTaGFwZTIuQ29ubmVjdGlvbilcbiAgICAgICAgKSxcbiAgICAgICAgZ2V0TG9jYWxBZGRyZXNzOiBNLmNhbGwoKS5yZXR1cm5zKFNoYXBlMi5FbmRwb2ludCksXG4gICAgICAgIGdldFJlbW90ZUFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoU2hhcGUyLkVuZHBvaW50KSxcbiAgICAgICAgY2xvc2U6IE0uY2FsbFdoZW4oKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpKVxuICAgICAgfSksXG4gICAgICBpbmJvdW5kQXR0ZW1wdEFjY2VwdFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiSW5ib3VuZEF0dGVtcHRBY2NlcHRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyOiBNLmludGVyZmFjZShcIlJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgc2lua1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiU2lua1dhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucygpXG4gICAgICB9KVxuICAgIH0sXG4gICAgUG9ydEk6IHtcbiAgICAgIHBvcnQ6IE0uaW50ZXJmYWNlKFwiUG9ydFwiLCB7XG4gICAgICAgIGdldExvY2FsQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhTaGFwZTIuRW5kcG9pbnQpLFxuICAgICAgICBhZGRMaXN0ZW5lcjogTS5jYWxsV2hlbihTaGFwZTIuTGlzdGVuZXIpLnJldHVybnMoXG4gICAgICAgICAgU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSlcbiAgICAgICAgKSxcbiAgICAgICAgY29ubmVjdDogTS5jYWxsV2hlbihTaGFwZTIuRW5kcG9pbnQpLm9wdGlvbmFsKFNoYXBlMi5Db25uZWN0aW9uSGFuZGxlcikucmV0dXJucyhTaGFwZTIuVm93JChTaGFwZTIuQ29ubmVjdGlvbikpLFxuICAgICAgICByZW1vdmVMaXN0ZW5lcjogTS5jYWxsV2hlbihTaGFwZTIuTGlzdGVuZXIpLnJldHVybnMoXG4gICAgICAgICAgU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSlcbiAgICAgICAgKSxcbiAgICAgICAgcmV2b2tlOiBNLmNhbGxXaGVuKCkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSlcbiAgICAgIH0pLFxuICAgICAgcG9ydEFkZExpc3RlbmVyV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQb3J0QWRkTGlzdGVuZXJXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcG9ydFJlbW92ZUxpc3RlbmVyV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQb3J0UmVtb3ZlTGlzdGVuZXJXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcG9ydENvbm5lY3RXYXRjaGVyOiBNLmludGVyZmFjZShcIlBvcnRDb25uZWN0V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHBvcnRSZXZva2VXYXRjaGVyOiBNLmludGVyZmFjZShcIlBvcnRSZXZva2VXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcG9ydFJldm9rZUNsZWFudXBXYXRjaGVyOiBNLmludGVyZmFjZShcIlBvcnRSZXZva2VDbGVhbnVwV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJSZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXJcIiwge1xuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHNpbmtXYXRjaGVyOiBNLmludGVyZmFjZShcIlNpbmtXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoKSxcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSlcbiAgICB9LFxuICAgIFByb3RvY29sSGFuZGxlckk6IHtcbiAgICAgIHByb3RvY29sSGFuZGxlcjogTS5pbnRlcmZhY2UoXCJQcm90b2NvbEhhbmRsZXJcIiwge1xuICAgICAgICBvbkNyZWF0ZTogTS5jYWxsV2hlbihNLnJlbW90YWJsZSgpLCBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyKS5yZXR1cm5zKFxuICAgICAgICAgIFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpXG4gICAgICAgICksXG4gICAgICAgIGdlbmVyYXRlUG9ydElEOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChNLnN0cmluZygpKSksXG4gICAgICAgIG9uQmluZDogTS5jYWxsV2hlbihcbiAgICAgICAgICBTaGFwZTIuUG9ydCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLlByb3RvY29sSGFuZGxlclxuICAgICAgICApLnJldHVybnMoU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSkpLFxuICAgICAgICBvbkxpc3RlbjogTS5jYWxsV2hlbihcbiAgICAgICAgICBTaGFwZTIuUG9ydCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLkxpc3RlbkhhbmRsZXIsXG4gICAgICAgICAgU2hhcGUyLlByb3RvY29sSGFuZGxlclxuICAgICAgICApLnJldHVybnMoU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSkpLFxuICAgICAgICBvbkxpc3RlblJlbW92ZTogTS5jYWxsV2hlbihcbiAgICAgICAgICBTaGFwZTIuUG9ydCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLkxpc3RlbkhhbmRsZXIsXG4gICAgICAgICAgU2hhcGUyLlByb3RvY29sSGFuZGxlclxuICAgICAgICApLnJldHVybnMoU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSkpLFxuICAgICAgICBvbkluc3RhbnRpYXRlOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLlByb3RvY29sSGFuZGxlclxuICAgICAgICApLnJldHVybnMoU2hhcGUyLlZvdyQoU2hhcGUyLkVuZHBvaW50KSksXG4gICAgICAgIG9uQ29ubmVjdDogTS5jYWxsV2hlbihcbiAgICAgICAgICBTaGFwZTIuUG9ydCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5Db25uZWN0aW9uSGFuZGxlcixcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChTaGFwZTIuQXR0ZW1wdERlc2NyaXB0aW9uKSksXG4gICAgICAgIG9uUmV2b2tlOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIFNoYXBlMi5Qb3J0LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuUHJvdG9jb2xIYW5kbGVyXG4gICAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSlcbiAgICAgIH0pLFxuICAgICAgcHJvdG9jb2xIYW5kbGVyQWNjZXB0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQcm90b2NvbEhhbmRsZXJBY2NlcHRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcHJvdG9jb2xIYW5kbGVySW5zdGFudGlhdGVXYXRjaGVyOiBNLmludGVyZmFjZShcbiAgICAgICAgXCJQcm90b2NvbEhhbmRsZXJJbnN0YW50aWF0ZVdhdGNoZXJcIixcbiAgICAgICAge1xuICAgICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICBwcm90b2NvbEhhbmRsZXJDb25uZWN0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICAgIFwiUHJvdG9jb2xIYW5kbGVyQ29ubmVjdFdhdGNoZXJcIixcbiAgICAgICAge1xuICAgICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICByZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyXCIsIHtcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSlcbiAgICB9LFxuICAgIFByb3RvY29sSW1wbEk6IE0uaW50ZXJmYWNlKFwiUHJvdG9jb2xJbXBsXCIsIHtcbiAgICAgIGJpbmRQb3J0OiBNLmNhbGxXaGVuKFNoYXBlMi5FbmRwb2ludCkucmV0dXJucyhTaGFwZTIuVm93JChTaGFwZTIuUG9ydCkpLFxuICAgICAgaW5ib3VuZDogTS5jYWxsV2hlbihTaGFwZTIuRW5kcG9pbnQsIFNoYXBlMi5FbmRwb2ludCkucmV0dXJucyhcbiAgICAgICAgU2hhcGUyLlZvdyQoU2hhcGUyLkluYm91bmRBdHRlbXB0KVxuICAgICAgKSxcbiAgICAgIG91dGJvdW5kOiBNLmNhbGxXaGVuKFxuICAgICAgICBTaGFwZTIuUG9ydCxcbiAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICBTaGFwZTIuQ29ubmVjdGlvbkhhbmRsZXJcbiAgICAgICkucmV0dXJucyhTaGFwZTIuVm93JChTaGFwZTIuQ29ubmVjdGlvbikpXG4gICAgfSlcbiAgfSlcbik7XG5cbi8vXG52YXIgc2luazMgPSAoKSA9PiB7XG59O1xuaGFyZGVuKHNpbmszKTtcbnZhciBDTE9TRV9SRUFTT05fRklOQUxJWkVSID0gXCJjbG9zZWQtYnktZmluYWxpemVyXCI7XG52YXIgUmV2b2tlU3RhdGUgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBOT1RfUkVWT0tFRDogMCxcbiAgICBSRVZPS0lORzogMSxcbiAgICBSRVZPS0VEOiAyXG4gIH1cbik7XG5oYXJkZW4oUmV2b2tlU3RhdGUpO1xudmFyIHByZXBhcmVGaW5hbGl6ZXIgPSAoem9uZSwgeyB3YXRjaCB9KSA9PiB7XG4gIGNvbnN0IG9ialRvRmluYWxpemVySW5mbyA9IHpvbmUubWFwU3RvcmUoXCJvYmpUb0ZpbmFsaXplckluZm9cIik7XG4gIHJldHVybiB6b25lLmV4byhcIk5ldHdvcmtGaW5hbGl6ZXJcIiwgdm9pZCAwLCB7XG4gICAgaGFzKG9iaikge1xuICAgICAgcmV0dXJuIG9ialRvRmluYWxpemVySW5mby5oYXMob2JqKTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICBpbml0Q29ubmVjdGlvbihjb25uLCBoYW5kbGVyKSB7XG4gICAgICBvYmpUb0ZpbmFsaXplckluZm8uaW5pdChjb25uLCBoYXJkZW4oeyBjb25uLCBoYW5kbGVyIH0pKTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG4gICAgICovXG4gICAgaW5pdENsb3NlcihjbG9zZXIpIHtcbiAgICAgIG9ialRvRmluYWxpemVySW5mby5pbml0KGNsb3NlciwgaGFyZGVuKHsgY2xvc2VyIH0pKTtcbiAgICB9LFxuICAgIGZpbmFsaXplKG9iaikge1xuICAgICAgaWYgKCFvYmpUb0ZpbmFsaXplckluZm8uaGFzKG9iaikpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3QgZGlzcG9zZUluZm8gPSBvYmpUb0ZpbmFsaXplckluZm8uZ2V0KG9iaik7XG4gICAgICBpZiAoXCJjb25uXCIgaW4gZGlzcG9zZUluZm8pIHtcbiAgICAgICAgY29uc3QgeyBjb25uLCBoYW5kbGVyIH0gPSBkaXNwb3NlSW5mbztcbiAgICAgICAgb2JqVG9GaW5hbGl6ZXJJbmZvLmRlbGV0ZShvYmopO1xuICAgICAgICByZXR1cm4gd2F0Y2goRShoYW5kbGVyKS5vbkNsb3NlKGNvbm4sIENMT1NFX1JFQVNPTl9GSU5BTElaRVIsIGhhbmRsZXIpKTtcbiAgICAgIH0gZWxzZSBpZiAoXCJjbG9zZXJcIiBpbiBkaXNwb3NlSW5mbykge1xuICAgICAgICBjb25zdCB7IGNsb3NlciB9ID0gZGlzcG9zZUluZm87XG4gICAgICAgIG9ialRvRmluYWxpemVySW5mby5kZWxldGUob2JqKTtcbiAgICAgICAgcmV0dXJuIHdhdGNoKEUoY2xvc2VyKS5jbG9zZSgpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHVucGluKG9iaikge1xuICAgICAgb2JqVG9GaW5hbGl6ZXJJbmZvLmRlbGV0ZShvYmopO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVGaW5hbGl6ZXIpO1xuXG4vL1xudmFyIFJvdXRlckkgPSBNLmludGVyZmFjZShcIlJvdXRlclwiLCB7XG4gIGdldFJvdXRlczogTS5jYWxsKFNoYXBlLkVuZHBvaW50KS5yZXR1cm5zKE0uYXJyYXlPZihbTS5zdHJpbmcoKSwgTS5hbnkoKV0pKSxcbiAgcmVnaXN0ZXI6IE0uY2FsbChNLnN0cmluZygpLCBNLmFueSgpKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpLFxuICB1bnJlZ2lzdGVyOiBNLmNhbGwoTS5zdHJpbmcoKSwgTS5hbnkoKSkucmV0dXJucyhNLnVuZGVmaW5lZCgpKVxufSk7XG5cbi8vXG52YXIgc2luazQgPSAoKSA9PiB7XG59O1xuaGFyZGVuKHNpbms0KTtcbnZhciBWb3dTaGFwZSA9IE0udGFnZ2VkKFxuICBcIlZvd1wiLFxuICBNLnNwbGl0UmVjb3JkKHtcbiAgICB2b3dWMDogTS5yZW1vdGFibGUoXCJWb3dWMFwiKVxuICB9KVxuKTtcbnZhciBpc1ZvdyA9IChzcGVjaW1lbikgPT4gaXNQYXNzYWJsZShzcGVjaW1lbikgJiYgbWF0Y2hlcyhzcGVjaW1lbiwgVm93U2hhcGUpO1xuaGFyZGVuKGlzVm93KTtcbnZhciBnZXRWb3dQYXlsb2FkID0gKHNwZWNpbWVuKSA9PiB7XG4gIGlmICghaXNWb3coc3BlY2ltZW4pKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBjb25zdCB2b3cgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgIHNwZWNpbWVuXG4gICk7XG4gIHJldHVybiB2b3cucGF5bG9hZDtcbn07XG5oYXJkZW4oZ2V0Vm93UGF5bG9hZCk7XG52YXIgdG9QYXNzYWJsZUNhcCA9IChrKSA9PiB7XG4gIGNvbnN0IHBheWxvYWQgPSBnZXRWb3dQYXlsb2FkKGspO1xuICBpZiAocGF5bG9hZCA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBrXG4gICAgKTtcbiAgfVxuICBjb25zdCB7IHZvd1YwIH0gPSBwYXlsb2FkO1xuICByZXR1cm4gdm93VjA7XG59O1xuaGFyZGVuKHRvUGFzc2FibGVDYXApO1xudmFyIG1ha2VBc1ZvdyA9IChtYWtlVm93S2l0KSA9PiB7XG4gIGNvbnN0IGFzVm93ID0gKGZuKSA9PiB7XG4gICAgbGV0IHJlc3VsdDtcbiAgICB0cnkge1xuICAgICAgcmVzdWx0ID0gZm4oKTtcbiAgICB9IGNhdGNoIChlMikge1xuICAgICAgcmVzdWx0ID0gUHJvbWlzZS5yZWplY3QoZTIpO1xuICAgIH1cbiAgICBpZiAoaXNWb3cocmVzdWx0KSkge1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgY29uc3QgeyB2b3csIHJlc29sdmVyIH0gPSBtYWtlVm93S2l0KCk7XG4gICAgcmVzb2x2ZXIucmVzb2x2ZShyZXN1bHQpO1xuICAgIHJldHVybiB2b3c7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oYXNWb3cpO1xufTtcbmhhcmRlbihtYWtlQXNWb3cpO1xuXG4vL1xudmFyIHsgZGV0YWlsczogWDMgfSA9IGFzc2VydDtcbnZhciBub29wID0gKCkgPT4ge1xufTtcbmhhcmRlbihub29wKTtcbnZhciBwcmVwYXJlVm93S2l0ID0gKHpvbmUsIHZvd1JlamVjdGlvblRyYWNrZXIpID0+IHtcbiAgY29uc3QgcmVzb2x2ZXJUb0VwaGVtZXJhID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IHJlc29sdmVyVG9Ob25TdG9yZWRWYWx1ZSA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCBwcm92aWRlRXBoZW1lcmEgPSAocmVzb2x2ZXIsIG9wdGlvbnMpID0+IHtcbiAgICBsZXQgZXBoZW1lcmEgPSByZXNvbHZlclRvRXBoZW1lcmEuZ2V0KHJlc29sdmVyKTtcbiAgICBpZiAoIWVwaGVtZXJhKSB7XG4gICAgICBlcGhlbWVyYSA9IG1ha2VQcm9taXNlS2l0KCk7XG4gICAgICBlcGhlbWVyYS5wcm9taXNlLmNhdGNoKG5vb3ApO1xuICAgIH1cbiAgICBlcGhlbWVyYSA9IGhhcmRlbih7IC4uLmVwaGVtZXJhLCAuLi5vcHRpb25zIH0pO1xuICAgIHJlc29sdmVyVG9FcGhlbWVyYS5zZXQocmVzb2x2ZXIsIGVwaGVtZXJhKTtcbiAgICByZXR1cm4gZXBoZW1lcmE7XG4gIH07XG4gIGNvbnN0IHByb3ZpZGVFcGhlbWVyYUZvclJlc29sdXRpb24gPSAocmVzb2x2ZXIpID0+IHtcbiAgICBjb25zdCBlcGhlbWVyYSA9IHByb3ZpZGVFcGhlbWVyYShyZXNvbHZlcik7XG4gICAgaWYgKGVwaGVtZXJhLnJlc29sdmUpIHtcbiAgICAgIGNvbnN0IHsgcmVzb2x2ZTogXzEsIHJlamVjdDogXzIsIC4uLnJlc3QgfSA9IGVwaGVtZXJhO1xuICAgICAgcmVzb2x2ZXJUb0VwaGVtZXJhLnNldChyZXNvbHZlciwgaGFyZGVuKHJlc3QpKTtcbiAgICB9XG4gICAgcmV0dXJuIGVwaGVtZXJhO1xuICB9O1xuICBjb25zdCBtYWtlVm93SW50ZXJuYWxzS2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIlZvd0ludGVybmFsc0tpdFwiLFxuICAgIHtcbiAgICAgIHZvd1YwOiBNLmludGVyZmFjZShcIlZvd1YwXCIsIHtcbiAgICAgICAgc2hvcnRlbjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICAgIH0pLFxuICAgICAgcmVzb2x2ZXI6IE0uaW50ZXJmYWNlKFwiVm93UmVzb2x2ZXJcIiwge1xuICAgICAgICByZXNvbHZlOiBNLmNhbGwoKS5vcHRpb25hbChNLnJhdygpKS5yZXR1cm5zKCksXG4gICAgICAgIHJlamVjdDogTS5jYWxsKCkub3B0aW9uYWwoTS5yYXcoKSkucmV0dXJucygpXG4gICAgICB9KSxcbiAgICAgIHdhdGNoTmV4dFN0ZXA6IFByb21pc2VXYXRjaGVySVxuICAgIH0sXG4gICAgKCkgPT4gKHtcbiAgICAgIC8qICAgICAgICAgICAgICAqL1xuICAgICAgdmFsdWU6IHZvaWQgMCxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBzdGVwU3RhdHVzOiBudWxsLFxuICAgICAgaXNTdG9yZWRWYWx1ZTogZmFsc2UsXG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICB2b3dJc0hhbmRsZWQ6IGZhbHNlLFxuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgZXh0cmE6IHZvaWQgMFxuICAgIH0pLFxuICAgIHtcbiAgICAgIHZvd1YwOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIGFzeW5jIHNob3J0ZW4oKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGVwU3RhdHVzLCBpc1N0b3JlZFZhbHVlLCB2YWx1ZSwgdm93SXNIYW5kbGVkIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZXIsIHZvd1YwIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBzd2l0Y2ggKHN0ZXBTdGF0dXMpIHtcbiAgICAgICAgICAgIGNhc2UgXCJmdWxmaWxsZWRcIjoge1xuICAgICAgICAgICAgICBpZiAodm93SXNIYW5kbGVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUudm93SXNIYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoaXNTdG9yZWRWYWx1ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNvbHZlclRvTm9uU3RvcmVkVmFsdWUuaGFzKHJlc29sdmVyKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNvbHZlclRvTm9uU3RvcmVkVmFsdWUuZ2V0KHJlc29sdmVyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB0aHJvdyB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgXCJyZWplY3RlZFwiOiB7XG4gICAgICAgICAgICAgIGlmICh2b3dJc0hhbmRsZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS52b3dJc0hhbmRsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHZvd1JlamVjdGlvblRyYWNrZXI/LmhhbmRsZSh2b3dWMCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc3QgcmVhc29uID0gcmVzb2x2ZXJUb05vblN0b3JlZFZhbHVlLmhhcyhyZXNvbHZlcikgPyByZXNvbHZlclRvTm9uU3RvcmVkVmFsdWUuZ2V0KHJlc29sdmVyKSA6IHZhbHVlO1xuICAgICAgICAgICAgICB0aHJvdyByZWFzb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIG51bGw6XG4gICAgICAgICAgICBjYXNlIFwicGVuZGluZ1wiOlxuICAgICAgICAgICAgICByZXR1cm4gcHJvdmlkZUVwaGVtZXJhKHRoaXMuZmFjZXRzLnJlc29sdmVyLCB7XG4gICAgICAgICAgICAgICAgcG90ZW50aWFsbHlIYW5kbGVkOiB0cnVlXG4gICAgICAgICAgICAgIH0pLnByb21pc2U7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICB0aHJvdyBUeXBlRXJyb3IoYHVuZXhwZWN0ZWQgc3RlcFN0YXR1cyAke3N0ZXBTdGF0dXN9YCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmVzb2x2ZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgcmVzb2x2ZSh2YWx1ZSkge1xuICAgICAgICAgIGNvbnN0IHsgc3RlcFN0YXR1cyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoc3RlcFN0YXR1cyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnN0YXRlLnN0ZXBTdGF0dXMgPSBcInBlbmRpbmdcIjtcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmU6IHJlc29sdmUyIH0gPSBwcm92aWRlRXBoZW1lcmFGb3JSZXNvbHV0aW9uKHJlc29sdmVyKTtcbiAgICAgICAgICByZXNvbHZlMiAmJiByZXNvbHZlMih2YWx1ZSk7XG4gICAgICAgICAgem9uZS53YXRjaFByb21pc2UoXG4gICAgICAgICAgICBIYW5kbGVkUHJvbWlzZS5yZXNvbHZlKHZhbHVlKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLndhdGNoTmV4dFN0ZXBcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICByZWplY3QocmVhc29uKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGVwU3RhdHVzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChzdGVwU3RhdHVzICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuc3RhdGUuc3RlcFN0YXR1cyA9IFwicmVqZWN0ZWRcIjtcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmVyLCB3YXRjaE5leHRTdGVwIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCB7IHJlamVjdCB9ID0gcHJvdmlkZUVwaGVtZXJhRm9yUmVzb2x1dGlvbihyZXNvbHZlcik7XG4gICAgICAgICAgcmVqZWN0ICYmIHJlamVjdChyZWFzb24pO1xuICAgICAgICAgIHdhdGNoTmV4dFN0ZXAub25SZWplY3RlZChyZWFzb24pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2F0Y2hOZXh0U3RlcDoge1xuICAgICAgICBvbkZ1bGZpbGxlZCh2YWx1ZSkge1xuICAgICAgICAgIHRoaXMuc3RhdGUuc3RlcFN0YXR1cyA9IFwiZnVsZmlsbGVkXCI7XG4gICAgICAgICAgY29uc3QgeyByZXNvbHZlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgeyByZXNvbHZlOiByZXNvbHZlMiB9ID0gcHJvdmlkZUVwaGVtZXJhRm9yUmVzb2x1dGlvbihyZXNvbHZlcik7XG4gICAgICAgICAgaGFyZGVuKHZhbHVlKTtcbiAgICAgICAgICByZXNvbHZlMiAmJiByZXNvbHZlMih2YWx1ZSk7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5pc1N0b3JlZFZhbHVlID0gem9uZS5pc1N0b3JhYmxlKHZhbHVlKTtcbiAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5pc1N0b3JlZFZhbHVlKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc29sdmVyVG9Ob25TdG9yZWRWYWx1ZS5zZXQocmVzb2x2ZXIsIHZhbHVlKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUudmFsdWUgPSBhc3NlcnQuZXJyb3IoXG4gICAgICAgICAgICAgIFgzYFZvdyBmdWxmaWxsbWVudCB2YWx1ZSB3YXMgbm90IHN0b3JlZDogJHt2YWx1ZX1gXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb25SZWplY3RlZChyZWFzb24pIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLnN0ZXBTdGF0dXMgPSBcInJlamVjdGVkXCI7XG4gICAgICAgICAgY29uc3QgeyByZXNvbHZlciwgdm93VjAgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IHsgcmVqZWN0LCBwb3RlbnRpYWxseUhhbmRsZWQgfSA9IHByb3ZpZGVFcGhlbWVyYUZvclJlc29sdXRpb24ocmVzb2x2ZXIpO1xuICAgICAgICAgIGhhcmRlbihyZWFzb24pO1xuICAgICAgICAgIHJlamVjdCAmJiByZWplY3QocmVhc29uKTtcbiAgICAgICAgICBpZiAodGhpcy5zdGF0ZS52b3dJc0hhbmRsZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBpZiAocG90ZW50aWFsbHlIYW5kbGVkKSB7XG4gICAgICAgICAgICAgIHRoaXMuc3RhdGUudm93SXNIYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHZvd1JlamVjdGlvblRyYWNrZXI/LnJlamVjdCh2b3dWMCwgcmVhc29uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zdGF0ZS5pc1N0b3JlZFZhbHVlID0gem9uZS5pc1N0b3JhYmxlKHJlYXNvbik7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaXNTdG9yZWRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS52YWx1ZSA9IHJlYXNvbjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzb2x2ZXJUb05vblN0b3JlZFZhbHVlLnNldChyZXNvbHZlciwgcmVhc29uKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUudmFsdWUgPSBhc3NlcnQuZXJyb3IoXG4gICAgICAgICAgICAgIFgzYFZvdyByZWplY3Rpb24gcmVhc29uIHdhcyBub3Qgc3RvcmVkOiAke3JlYXNvbn1gXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZVZvd0tpdCA9ICgpID0+IHtcbiAgICBjb25zdCB7IHJlc29sdmVyLCB2b3dWMCB9ID0gbWFrZVZvd0ludGVybmFsc0tpdCgpO1xuICAgIGNvbnN0IHZvdyA9IG1ha2VUYWdnZWQoXCJWb3dcIiwgaGFyZGVuKHsgdm93VjAgfSkpO1xuICAgIHJldHVybiBoYXJkZW4oeyByZXNvbHZlciwgdm93IH0pO1xuICB9O1xuICByZXR1cm4gbWFrZVZvd0tpdDtcbn07XG5oYXJkZW4ocHJlcGFyZVZvd0tpdCk7XG5cbi8vXG52YXIgeyBGYWlsOiBGYWlsNSwgYmFyZTogYmFyZTIsIGRldGFpbHM6IFg0IH0gPSBhc3NlcnQ7XG52YXIgVm93U2hhcGUyID0gTS50YWdnZWQoXG4gIFwiVm93XCIsXG4gIGhhcmRlbih7XG4gICAgdm93VjA6IE0ucmVtb3RhYmxlKFwiVm93VjBcIilcbiAgfSlcbik7XG52YXIgcHJlcGFyZVdhdGNoVXRpbHMgPSAoem9uZSwgeyB3YXRjaCwgd2hlbiwgbWFrZVZvd0tpdCwgaXNSZXRyeWFibGVSZWFzb246IGlzUmV0cnlhYmxlUmVhc29uMiB9KSA9PiB7XG4gIGNvbnN0IGRldGFjaGVkID0gem9uZS5kZXRhY2hlZCgpO1xuICBjb25zdCB1dGlsc1RvTm9uU3RvcmFibGVSZXN1bHRzID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IG1ha2VXYXRjaFV0aWxzS2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIldhdGNoVXRpbHNcIixcbiAgICB7XG4gICAgICB1dGlsczogTS5pbnRlcmZhY2UoXCJVdGlsc1wiLCB7XG4gICAgICAgIGFsbDogTS5jYWxsKE0uYXJyYXlPZihNLmFueSgpKSkucmV0dXJucyhWb3dTaGFwZTIpLFxuICAgICAgICBhbGxTZXR0bGVkOiBNLmNhbGwoTS5hcnJheU9mKE0uYW55KCkpKS5yZXR1cm5zKFZvd1NoYXBlMiksXG4gICAgICAgIGFzUHJvbWlzZTogTS5jYWxsKE0ucmF3KCkpLnJlc3QoTS5yYXcoKSkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICAgIH0pLFxuICAgICAgd2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnJhdygpKS5yZXN0KE0ucmF3KCkpLnJldHVybnMoTS5yYXcoKSksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLnJhdygpKS5yZXN0KE0ucmF3KCkpLnJldHVybnMoTS5yYXcoKSlcbiAgICAgIH0pLFxuICAgICAgaGVscGVyOiBNLmludGVyZmFjZShcIkhlbHBlclwiLCB7XG4gICAgICAgIGNyZWF0ZVZvdzogTS5jYWxsKE0uYXJyYXlPZihNLmFueSgpKSwgTS5ib29sZWFuKCkpLnJldHVybnMoVm93U2hhcGUyKSxcbiAgICAgICAgcHJvY2Vzc1Jlc3VsdDogTS5jYWxsKE0ucmF3KCkpLnJlc3QoTS5yYXcoKSkucmV0dXJucyhNLnVuZGVmaW5lZCgpKVxuICAgICAgfSksXG4gICAgICByZXRyeVJlamVjdGlvblByb21pc2VXYXRjaGVyOiBQcm9taXNlV2F0Y2hlcklcbiAgICB9LFxuICAgICgpID0+IHtcbiAgICAgIGNvbnN0IGlkVG9Wb3dTdGF0ZSA9IGRldGFjaGVkLm1hcFN0b3JlKFwiaWRUb1Zvd1N0YXRlXCIpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmV4dElkOiAwbixcbiAgICAgICAgaWRUb1Zvd1N0YXRlXG4gICAgICB9O1xuICAgIH0sXG4gICAge1xuICAgICAgdXRpbHM6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYWxsKHNwZWNpbWVucykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmZhY2V0cy5oZWxwZXIuY3JlYXRlVm93KHNwZWNpbWVucywgZmFsc2UpO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBhbGxTZXR0bGVkKHNwZWNpbWVucykge1xuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLmhlbHBlci5jcmVhdGVWb3coc3BlY2ltZW5zLCB0cnVlKVxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGFzUHJvbWlzZShzcGVjaW1lblAsIC4uLndhdGNoZXJBcmdzKSB7XG4gICAgICAgICAgY29uc3Qgdm93ID0gd2F0Y2goc3BlY2ltZW5QLCAuLi53YXRjaGVyQXJncyk7XG4gICAgICAgICAgY29uc3QgcHJvbWlzZSA9IHdoZW4odm93KTtcbiAgICAgICAgICB6b25lLndhdGNoUHJvbWlzZShwcm9taXNlLCB0aGlzLmZhY2V0cy5yZXRyeVJlamVjdGlvblByb21pc2VXYXRjaGVyKTtcbiAgICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHZhbHVlLCBjdHgpIHtcbiAgICAgICAgICB0aGlzLmZhY2V0cy5oZWxwZXIucHJvY2Vzc1Jlc3VsdCh2YWx1ZSwgY3R4LCBcImZ1bGZpbGxlZFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCBjdHgpIHtcbiAgICAgICAgICB0aGlzLmZhY2V0cy5oZWxwZXIucHJvY2Vzc1Jlc3VsdChyZWFzb24sIGN0eCwgXCJyZWplY3RlZFwiKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGhlbHBlcjoge1xuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGNyZWF0ZVZvdyhzcGVjaW1lbnMsIGlzQWxsU2V0dGxlZCkge1xuICAgICAgICAgIGNvbnN0IHsgbmV4dElkOiBpZCwgaWRUb1Zvd1N0YXRlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGNvbnN0IGtpdCA9IG1ha2VWb3dLaXQoKTtcbiAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgc3BlY2ltZW5zLmxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgICAgICAgICAgd2F0Y2goc3BlY2ltZW5zW2luZGV4XSwgdGhpcy5mYWNldHMud2F0Y2hlciwge1xuICAgICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgICAgIG51bVJlc3VsdHM6IHNwZWNpbWVucy5sZW5ndGgsXG4gICAgICAgICAgICAgIGlzQWxsU2V0dGxlZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzcGVjaW1lbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5uZXh0SWQgKz0gMW47XG4gICAgICAgICAgICBpZFRvVm93U3RhdGUuaW5pdChcbiAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAgIGhhcmRlbih7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZXI6IGtpdC5yZXNvbHZlcixcbiAgICAgICAgICAgICAgICByZW1haW5pbmc6IHNwZWNpbWVucy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgcmVzdWx0c01hcDogZGV0YWNoZWQubWFwU3RvcmUoXCJyZXN1bHRzTWFwXCIpLFxuICAgICAgICAgICAgICAgIGlzQWxsU2V0dGxlZFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IGlkVG9Ob25TdG9yYWJsZVJlc3VsdHMgPSBwcm92aWRlTGF6eU1hcChcbiAgICAgICAgICAgICAgdXRpbHNUb05vblN0b3JhYmxlUmVzdWx0cyxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMudXRpbHMsXG4gICAgICAgICAgICAgICgpID0+IC8qICAgICAgICAgICAqLyBuZXcgTWFwKClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZFRvTm9uU3RvcmFibGVSZXN1bHRzLnNldChpZCwgLyogICAgICAgICAgICovIG5ldyBNYXAoKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGtpdC5yZXNvbHZlci5yZXNvbHZlKGhhcmRlbihbXSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4ga2l0LnZvdztcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgcHJvY2Vzc1Jlc3VsdChyZXN1bHQsIHsgaWQsIGluZGV4LCBudW1SZXN1bHRzLCBpc0FsbFNldHRsZWQgfSwgc3RhdHVzKSB7XG4gICAgICAgICAgY29uc3QgeyBpZFRvVm93U3RhdGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKCFpZFRvVm93U3RhdGUuaGFzKGlkKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBpZFRvTm9uU3RvcmFibGVSZXN1bHRzID0gcHJvdmlkZUxhenlNYXAoXG4gICAgICAgICAgICB1dGlsc1RvTm9uU3RvcmFibGVSZXN1bHRzLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMudXRpbHMsXG4gICAgICAgICAgICAoKSA9PiAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCB7IHJlbWFpbmluZywgcmVzdWx0c01hcCwgcmVzb2x2ZXIgfSA9IGlkVG9Wb3dTdGF0ZS5nZXQoaWQpO1xuICAgICAgICAgIGlmICghaXNBbGxTZXR0bGVkICYmIHN0YXR1cyA9PT0gXCJyZWplY3RlZFwiKSB7XG4gICAgICAgICAgICBpZFRvVm93U3RhdGUuZGVsZXRlKGlkKTtcbiAgICAgICAgICAgIGlkVG9Ob25TdG9yYWJsZVJlc3VsdHMuZGVsZXRlKGlkKTtcbiAgICAgICAgICAgIHJlc29sdmVyLnJlamVjdChyZXN1bHQpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBwb3NzaWJseVdyYXBwZWRSZXN1bHQgPSBpc0FsbFNldHRsZWQgPyBoYXJkZW4oe1xuICAgICAgICAgICAgc3RhdHVzLFxuICAgICAgICAgICAgW3N0YXR1cyA9PT0gXCJmdWxmaWxsZWRcIiA/IFwidmFsdWVcIiA6IFwicmVhc29uXCJdOiByZXN1bHRcbiAgICAgICAgICB9KSA6IHJlc3VsdDtcbiAgICAgICAgICBjb25zdCBub25TdG9yYWJsZVJlc3VsdHMgPSBwcm92aWRlTGF6eU1hcChcbiAgICAgICAgICAgIGlkVG9Ob25TdG9yYWJsZVJlc3VsdHMsXG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgICgpID0+IC8qICAgICAgICAgICAqLyBuZXcgTWFwKClcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICh6b25lLmlzU3RvcmFibGUocG9zc2libHlXcmFwcGVkUmVzdWx0KSkge1xuICAgICAgICAgICAgcmVzdWx0c01hcC5pbml0KGluZGV4LCBwb3NzaWJseVdyYXBwZWRSZXN1bHQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBub25TdG9yYWJsZVJlc3VsdHMuc2V0KGluZGV4LCBwb3NzaWJseVdyYXBwZWRSZXN1bHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB2b3dTdGF0ZSA9IGhhcmRlbih7XG4gICAgICAgICAgICByZW1haW5pbmc6IHJlbWFpbmluZyAtIDEsXG4gICAgICAgICAgICByZXN1bHRzTWFwLFxuICAgICAgICAgICAgcmVzb2x2ZXIsXG4gICAgICAgICAgICBpc0FsbFNldHRsZWRcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAodm93U3RhdGUucmVtYWluaW5nID4gMCkge1xuICAgICAgICAgICAgaWRUb1Zvd1N0YXRlLnNldChpZCwgdm93U3RhdGUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZFRvVm93U3RhdGUuZGVsZXRlKGlkKTtcbiAgICAgICAgICBpZFRvTm9uU3RvcmFibGVSZXN1bHRzLmRlbGV0ZShpZCk7XG4gICAgICAgICAgY29uc3QgcmVzdWx0cyA9IG5ldyBBcnJheShudW1SZXN1bHRzKTtcbiAgICAgICAgICBsZXQgbnVtTG9zdCA9IDA7XG4gICAgICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IG51bVJlc3VsdHM7IGkyICs9IDEpIHtcbiAgICAgICAgICAgIGlmIChub25TdG9yYWJsZVJlc3VsdHMuaGFzKGkyKSkge1xuICAgICAgICAgICAgICByZXN1bHRzW2kyXSA9IG5vblN0b3JhYmxlUmVzdWx0cy5nZXQoaTIpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHRzTWFwLmhhcyhpMikpIHtcbiAgICAgICAgICAgICAgcmVzdWx0c1tpMl0gPSByZXN1bHRzTWFwLmdldChpMik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBudW1Mb3N0ICs9IDE7XG4gICAgICAgICAgICAgIHJlc3VsdHNbaTJdID0gaXNBbGxTZXR0bGVkID8geyBzdGF0dXM6IFwicmVqZWN0ZWRcIiwgcmVhc29uOiBcIlVuc3RvcmFibGUgcmVzdWx0IHdhcyBsb3N0XCIgfSA6IHZvaWQgMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG51bUxvc3QgPiAwICYmICFpc0FsbFNldHRsZWQpIHtcbiAgICAgICAgICAgIHJlc29sdmVyLnJlamVjdChcbiAgICAgICAgICAgICAgYXNzZXJ0LmVycm9yKFg0YCR7bnVtTG9zdH0gdW5zdG9yYWJsZSByZXN1bHRzIHdlcmUgbG9zdGApXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlci5yZXNvbHZlKGhhcmRlbihyZXN1bHRzKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmV0cnlSZWplY3Rpb25Qcm9taXNlV2F0Y2hlcjoge1xuICAgICAgICBvbkZ1bGZpbGxlZChfcmVzdWx0KSB7XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCBmYWlsZWRPcCkge1xuICAgICAgICAgIGlmIChpc1JldHJ5YWJsZVJlYXNvbjIocmVhc29uLCB2b2lkIDApKSB7XG4gICAgICAgICAgICBGYWlsNWBQZW5kaW5nICR7YmFyZTIoZmFpbGVkT3ApfSBjb3VsZCBub3QgcmV0cnk7ICR7cmVhc29ufWA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlV2F0Y2hVdGlsID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgdXRpbHMgfSA9IG1ha2VXYXRjaFV0aWxzS2l0KCk7XG4gICAgcmV0dXJuIGhhcmRlbih1dGlscyk7XG4gIH07XG4gIHJldHVybiBtYWtlV2F0Y2hVdGlsO1xufTtcbmhhcmRlbihwcmVwYXJlV2F0Y2hVdGlscyk7XG5cbi8vXG52YXIgeyBhcHBseTogYXBwbHk3IH0gPSBSZWZsZWN0O1xudmFyIG1ha2VXYXRjaE5leHRTdGVwID0gKHpvbmUpID0+IChcbiAgLypcblxuXG5cblxuXG5cbiAgICovXG4gIChzcGVjaW1lbiwgcHJvbWlzZVdhdGNoZXIpID0+IHtcbiAgICBsZXQgcHJvbWlzZTtcbiAgICBjb25zdCBwYXlsb2FkID0gZ2V0Vm93UGF5bG9hZChzcGVjaW1lbik7XG4gICAgaWYgKHBheWxvYWQpIHtcbiAgICAgIHByb21pc2UgPSBFKHBheWxvYWQudm93VjApLnNob3J0ZW4oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHJvbWlzZSA9IEUucmVzb2x2ZShzcGVjaW1lbik7XG4gICAgfVxuICAgIHpvbmUud2F0Y2hQcm9taXNlKHByb21pc2UsIHByb21pc2VXYXRjaGVyKTtcbiAgfVxuKTtcbnZhciBzZXR0bGUgPSBhc3luYyAocmVzb2x2ZXIsIHdhdGNoZXIsIHdjYiwgdmFsdWUsIHdhdGNoZXJBcmdzID0gW10pID0+IHtcbiAgYXdhaXQgbnVsbDtcbiAgdHJ5IHtcbiAgICBsZXQgY2hhaW5lZFZhbHVlID0gdmFsdWU7XG4gICAgY29uc3QgdzIgPSB3YXRjaGVyICYmIHdhdGNoZXJbd2NiXTtcbiAgICBpZiAodzIpIHtcbiAgICAgIGNoYWluZWRWYWx1ZSA9IGFwcGx5Nyh3Miwgd2F0Y2hlciwgW3ZhbHVlLCAuLi53YXRjaGVyQXJnc10pO1xuICAgIH0gZWxzZSBpZiAod2NiID09PSBcIm9uUmVqZWN0ZWRcIikge1xuICAgICAgdGhyb3cgdmFsdWU7XG4gICAgfVxuICAgIGlmIChyZXNvbHZlcikge1xuICAgICAgcmVzb2x2ZXIucmVzb2x2ZShjaGFpbmVkVmFsdWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBhd2FpdCBjaGFpbmVkVmFsdWU7XG4gIH0gY2F0Y2ggKGUyKSB7XG4gICAgaWYgKHJlc29sdmVyKSB7XG4gICAgICByZXNvbHZlci5yZWplY3QoZTIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aHJvdyBlMjtcbiAgfVxufTtcbnZhciBwcmVwYXJlUHJvbWlzZVdhdGNoZXIgPSAoem9uZSwgaXNSZXRyeWFibGVSZWFzb24yLCB3YXRjaE5leHRTdGVwKSA9PiB7XG4gIGNvbnN0IHdhdGNoZXJTZWVuUGF5bG9hZHMgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgZ2V0U2VlblBheWxvYWRzID0gKHdhdGNoZXIpID0+IHtcbiAgICBsZXQgc2VlblBheWxvYWRzID0gd2F0Y2hlclNlZW5QYXlsb2Fkcy5nZXQod2F0Y2hlcik7XG4gICAgaWYgKCFzZWVuUGF5bG9hZHMpIHtcbiAgICAgIHNlZW5QYXlsb2FkcyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xuICAgICAgd2F0Y2hlclNlZW5QYXlsb2Fkcy5zZXQod2F0Y2hlciwgc2VlblBheWxvYWRzKTtcbiAgICB9XG4gICAgcmV0dXJuIHNlZW5QYXlsb2FkcztcbiAgfTtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3MoXG4gICAgXCJQcm9taXNlV2F0Y2hlclwiLFxuICAgIFByb21pc2VXYXRjaGVySSxcbiAgICAvKlxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIChyZXNvbHZlciwgd2F0Y2hlciwgd2F0Y2hlckFyZ3MpID0+IHtcbiAgICAgIGNvbnN0IHN0YXRlID0ge1xuICAgICAgICB2b3c6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgdm9pZCAwXG4gICAgICAgICksXG4gICAgICAgIHByaW9yUmV0cnlWYWx1ZTogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHZvaWQgMFxuICAgICAgICApLFxuICAgICAgICByZXNvbHZlcixcbiAgICAgICAgd2F0Y2hlcixcbiAgICAgICAgd2F0Y2hlckFyZ3M6IGhhcmRlbih3YXRjaGVyQXJncylcbiAgICAgIH07XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc3RhdGVcbiAgICAgICk7XG4gICAgfSxcbiAgICB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHsgd2F0Y2hlciwgd2F0Y2hlckFyZ3MsIHJlc29sdmVyIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIXJlc29sdmVyKSB7XG4gICAgICAgICAgdGhyb3cgRXJyb3IoXCJVbmV4cGVjdGVkIG11bHRpcGxlIGNhbGxzIHRvIFByb21pc2VXYXRjaGVyXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSBnZXRWb3dQYXlsb2FkKHZhbHVlKTtcbiAgICAgICAgaWYgKHBheWxvYWQpIHtcbiAgICAgICAgICBjb25zdCBzZWVuUGF5bG9hZHMgPSBnZXRTZWVuUGF5bG9hZHModGhpcy5zZWxmKTtcbiAgICAgICAgICBpZiAoc2VlblBheWxvYWRzLmhhcyhwYXlsb2FkLnZvd1YwKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VsZi5vblJlamVjdGVkKEVycm9yKFwiVm93IHJlc29sdXRpb24gY3ljbGUgZGV0ZWN0ZWRcIikpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZWVuUGF5bG9hZHMuYWRkKHBheWxvYWQudm93VjApO1xuICAgICAgICAgIHRoaXMuc3RhdGUudm93ID0gdmFsdWU7XG4gICAgICAgICAgd2F0Y2hOZXh0U3RlcCh2YWx1ZSwgdGhpcy5zZWxmKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgd2F0Y2hlclNlZW5QYXlsb2Fkcy5kZWxldGUodGhpcy5zZWxmKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5wcmlvclJldHJ5VmFsdWUgPSB2b2lkIDA7XG4gICAgICAgIHRoaXMuc3RhdGUud2F0Y2hlciA9IHZvaWQgMDtcbiAgICAgICAgdGhpcy5zdGF0ZS5yZXNvbHZlciA9IHZvaWQgMDtcbiAgICAgICAgdm9pZCBzZXR0bGUocmVzb2x2ZXIsIHdhdGNoZXIsIFwib25GdWxmaWxsZWRcIiwgdmFsdWUsIHdhdGNoZXJBcmdzKTtcbiAgICAgIH0sXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgb25SZWplY3RlZChyZWFzb24pIHtcbiAgICAgICAgY29uc3QgeyB2b3csIHdhdGNoZXIsIHdhdGNoZXJBcmdzLCByZXNvbHZlciwgcHJpb3JSZXRyeVZhbHVlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBpZiAoIXJlc29sdmVyKSB7XG4gICAgICAgICAgdGhyb3cgRXJyb3IoXCJVbmV4cGVjdGVkIG11bHRpcGxlIGNhbGxzIHRvIFByb21pc2VXYXRjaGVyXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJldHJ5VmFsdWUgPSBpc1JldHJ5YWJsZVJlYXNvbjIocmVhc29uLCBwcmlvclJldHJ5VmFsdWUpO1xuICAgICAgICBpZiAocmV0cnlWYWx1ZSkge1xuICAgICAgICAgIHRoaXMuc3RhdGUucHJpb3JSZXRyeVZhbHVlID0gcmV0cnlWYWx1ZTtcbiAgICAgICAgICBpZiAodm93KSB7XG4gICAgICAgICAgICB3YXRjaE5leHRTdGVwKHZvdywgdGhpcy5zZWxmKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgd2F0Y2hlclNlZW5QYXlsb2Fkcy5kZWxldGUodGhpcy5zZWxmKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5wcmlvclJldHJ5VmFsdWUgPSB2b2lkIDA7XG4gICAgICAgIHRoaXMuc3RhdGUucmVzb2x2ZXIgPSB2b2lkIDA7XG4gICAgICAgIHRoaXMuc3RhdGUud2F0Y2hlciA9IHZvaWQgMDtcbiAgICAgICAgdm9pZCBzZXR0bGUocmVzb2x2ZXIsIHdhdGNoZXIsIFwib25SZWplY3RlZFwiLCByZWFzb24sIHdhdGNoZXJBcmdzKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG59O1xudmFyIHByZXBhcmVXYXRjaCA9ICh6b25lLCBtYWtlVm93S2l0LCBpc1JldHJ5YWJsZVJlYXNvbjIgPSAoX3JlYXNvbiwgX2xhc3RWYWx1ZSkgPT4gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IHdhdGNoTmV4dFN0ZXAgPSBtYWtlV2F0Y2hOZXh0U3RlcCh6b25lKTtcbiAgY29uc3QgbWFrZVByb21pc2VXYXRjaGVyID0gcHJlcGFyZVByb21pc2VXYXRjaGVyKFxuICAgIHpvbmUsXG4gICAgaXNSZXRyeWFibGVSZWFzb24yLFxuICAgIHdhdGNoTmV4dFN0ZXBcbiAgKTtcbiAgY29uc3Qgd2F0Y2ggPSAoc3BlY2ltZW5QLCB3YXRjaGVyLCAuLi53YXRjaGVyQXJncykgPT4ge1xuICAgIGNvbnN0IHsgcmVzb2x2ZXIsIHZvdyB9ID0gbWFrZVZvd0tpdCgpO1xuICAgIGNvbnN0IHByb21pc2VXYXRjaGVyID0gbWFrZVByb21pc2VXYXRjaGVyKHJlc29sdmVyLCB3YXRjaGVyLCB3YXRjaGVyQXJncyk7XG4gICAgY29uc3QgcHJvbWlzZSA9IEUucmVzb2x2ZShzcGVjaW1lblApO1xuICAgIHpvbmUud2F0Y2hQcm9taXNlKHByb21pc2UsIHByb21pc2VXYXRjaGVyKTtcbiAgICByZXR1cm4gdm93O1xuICB9O1xuICBoYXJkZW4od2F0Y2gpO1xuICByZXR1cm4gd2F0Y2g7XG59O1xuaGFyZGVuKHByZXBhcmVXYXRjaCk7XG5cbi8vXG52YXIgbWFrZVVuaGFuZGxlZFJlamVjdGlvbkNhbmNlbGxlciA9IChyZWplY3RlZCwgdXBncmFkZWRQSykgPT4ge1xuICByZXR1cm4gKCkgPT4ge1xuICAgIHJlamVjdGVkPy5jYXRjaChzaW5rNCk7XG4gICAgdXBncmFkZWRQSz8ucmVzb2x2ZSgpO1xuICB9O1xufTtcbnZhciBwcmVwYXJlVm93UmVqZWN0aW9uVHJhY2tlciA9ICh6b25lKSA9PiB7XG4gIGNvbnN0IHZvd1RvQ2FuY2VsVW5oYW5kbGVkUmVqZWN0aW9uID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IHVwZ3JhZGVSZWplY3Rpb25XYXRjaGVyID0gem9uZS5leG8oXG4gICAgXCJVcGdyYWRlUmVqZWN0aW9uV2F0Y2hlclwiLFxuICAgIE0uaW50ZXJmYWNlKFwiVXBncmFkZVJlamVjdGlvbldhdGNoZXJcIiwge1xuICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0ucmF3KCksIE0ucmF3KCkpLnJldHVybnMoKVxuICAgIH0pLFxuICAgIHtcbiAgICAgIG9uUmVqZWN0ZWQodXBncmFkZVJlYXNvbiwgYmFzZVJlYXNvbikge1xuICAgICAgICBjb25zdCByZWFzb24gPSBhc3NlcnQuZXJyb3IoXG4gICAgICAgICAgcmVkYWN0ZWRgVk9XX1JFSkVDVElPTiAke2Jhc2VSZWFzb259IG5vdCBoYW5kbGVkIGJlZm9yZSB1cGdyYWRlICR7dXBncmFkZVJlYXNvbn1gXG4gICAgICAgICk7XG4gICAgICAgIHRocm93IHJlYXNvbjtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IHZvd1JlamVjdGlvblRyYWNrZXIgPSB6b25lLmV4byhcbiAgICBcIlZvd1JlamVjdGlvblRyYWNrZXJcIixcbiAgICBNLmludGVyZmFjZShcIlZvd1JlamVjdGlvblRyYWNrZXJcIiwge1xuICAgICAgaGFuZGxlOiBNLmNhbGwoTS5yZW1vdGFibGUoKSkucmV0dXJucygpLFxuICAgICAgcmVqZWN0OiBNLmNhbGwoTS5yZW1vdGFibGUoKSwgTS5yYXcoKSkucmV0dXJucygpXG4gICAgfSksXG4gICAge1xuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBoYW5kbGUodm93Q2FwKSB7XG4gICAgICAgIGNvbnN0IGNhbmNlbCA9IHZvd1RvQ2FuY2VsVW5oYW5kbGVkUmVqZWN0aW9uLmdldCh2b3dDYXApO1xuICAgICAgICBpZiAoIWNhbmNlbCkge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgIGFzc2VydC5lcnJvcihcbiAgICAgICAgICAgICAgcmVkYWN0ZWRgTm93IGhhbmRsaW5nIGEgVk9XX1JFSkVDVElPTiBmcm9tIGEgcHJpb3IgaW5jYXJuYXRpb24gZm9yICR7dm93Q2FwfWBcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2b3dUb0NhbmNlbFVuaGFuZGxlZFJlamVjdGlvbi5kZWxldGUodm93Q2FwKTtcbiAgICAgICAgY2FuY2VsKCk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIHJlamVjdCh2b3dDYXAsIHJlYXNvbikge1xuICAgICAgICBpZiAodm93VG9DYW5jZWxVbmhhbmRsZWRSZWplY3Rpb24uaGFzKHZvd0NhcCkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaGFyZGVuKHJlYXNvbik7XG4gICAgICAgIGNvbnN0IGJhc2VSZWFzb24gPSB6b25lLmlzU3RvcmFibGUocmVhc29uKSA/IHJlYXNvbiA6IGFzc2VydC5lcnJvcihyZWRhY3RlZGBWb3cgcmVqZWN0aW9uIHJlYXNvbiB3YXMgbm90IHN0b3JlZDogJHtyZWFzb259YCk7XG4gICAgICAgIGNvbnN0IHVwZ3JhZGVkUEsgPSBtYWtlUHJvbWlzZUtpdCgpO1xuICAgICAgICB6b25lLndhdGNoUHJvbWlzZShcbiAgICAgICAgICB1cGdyYWRlZFBLLnByb21pc2UsXG4gICAgICAgICAgdXBncmFkZVJlamVjdGlvbldhdGNoZXIsXG4gICAgICAgICAgYmFzZVJlYXNvblxuICAgICAgICApO1xuICAgICAgICBjb25zdCByZWplY3RlZCA9IFByb21pc2UucmVqZWN0KHJlYXNvbik7XG4gICAgICAgIGNvbnN0IGNhbmNlbCA9IG1ha2VVbmhhbmRsZWRSZWplY3Rpb25DYW5jZWxsZXIocmVqZWN0ZWQsIHVwZ3JhZGVkUEspO1xuICAgICAgICB2b3dUb0NhbmNlbFVuaGFuZGxlZFJlamVjdGlvbi5zZXQodm93Q2FwLCBjYW5jZWwpO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuIHZvd1JlamVjdGlvblRyYWNrZXI7XG59O1xuXG4vL1xudmFyIHsgZGVmaW5lUHJvcGVydGllczogZGVmaW5lUHJvcGVydGllczQgfSA9IE9iamVjdDtcbnZhciBSZXRyeWFibGVGbG93SUtpdCA9IGhhcmRlbih7XG4gIGZsb3c6IE0uaW50ZXJmYWNlKFwiRmxvd1wiLCB7XG4gICAgcmVzdGFydDogTS5jYWxsKCkucmV0dXJucygpLFxuICAgIGdldE91dGNvbWU6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpXG4gIH0pLFxuICByZXN1bHRXYXRjaGVyOiBQcm9taXNlV2F0Y2hlcklcbn0pO1xudmFyIEFkbWluUmV0cnlhYmxlRmxvd0kgPSBNLmludGVyZmFjZShcIlJldHJ5YWJsZUZsb3dBZG1pblwiLCB7XG4gIGdldEZsb3dGb3JPdXRjb21lVm93OiBNLmNhbGwoVm93U2hhcGUpLnJldHVybnMoTS5vcHQoTS5yZW1vdGFibGUoXCJmbG93XCIpKSlcbn0pO1xudmFyIHByZXBhcmVSZXRyeWFibGVUb29scyA9IChvdXRlclpvbmUsIG91dGVyT3B0aW9ucykgPT4ge1xuICBjb25zdCB7IG1ha2VWb3dLaXQsIGlzUmV0cnlhYmxlUmVhc29uOiBpc1JldHJ5YWJsZVJlYXNvbjIgfSA9IG91dGVyT3B0aW9ucztcbiAgY29uc3QgYXNWb3cgPSBtYWtlQXNWb3cobWFrZVZvd0tpdCk7XG4gIGNvbnN0IGZsb3dGb3JPdXRjb21lVm93S2V5ID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIG91dGVyWm9uZS5tYXBTdG9yZShcInJldHJ5YWJsZUZsb3dGb3JPdXRjb21lVm93XCIsIHtcbiAgICAgIGtleVNoYXBlOiBNLnJlbW90YWJsZShcInRvUGFzc2FibGVDYXBcIiksXG4gICAgICB2YWx1ZVNoYXBlOiBNLnJlbW90YWJsZShcImZsb3dcIilcbiAgICAgIC8vXG4gICAgfSlcbiAgKTtcbiAgY29uc3QgcHJlcGFyZVJldHJ5YWJsZUZsb3dLaXQgPSAoem9uZSwgdGFnLCByZXRyeWFibGVGdW5jKSA9PiB7XG4gICAgdHlwZW9mIHJldHJ5YWJsZUZ1bmMgPT09IFwiZnVuY3Rpb25cIiB8fCB0aHJvd1JlZGFjdGVkYHJldHJ5YWJsZUZ1bmMgbXVzdCBiZSBhIGNhbGxhYmxlIGZ1bmN0aW9uICR7cmV0cnlhYmxlRnVuY31gO1xuICAgIGNvbnN0IGludGVybmFsTWFrZVJldHJ5YWJsZUZsb3dLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgICAgdGFnLFxuICAgICAgUmV0cnlhYmxlRmxvd0lLaXQsXG4gICAgICAoYWN0aXZhdGlvbkFyZ3MpID0+IHtcbiAgICAgICAgaGFyZGVuKGFjdGl2YXRpb25BcmdzKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBhY3RpdmF0aW9uQXJncyxcbiAgICAgICAgICAvL1xuICAgICAgICAgIG91dGNvbWVLaXQ6IG1ha2VWb3dLaXQoKSxcbiAgICAgICAgICAvL1xuICAgICAgICAgIGxhc3RSZXRyeVJlYXNvbjogdm9pZCAwLFxuICAgICAgICAgIHJ1bnM6IDBuLFxuICAgICAgICAgIGlzRG9uZTogZmFsc2VcbiAgICAgICAgICAvL1xuICAgICAgICB9O1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgZmxvdzoge1xuICAgICAgICAgIC8qXG5cblxuICAgICAgICAgICAqL1xuICAgICAgICAgIHJlc3RhcnQoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGFjdGl2YXRpb25BcmdzLCBpc0RvbmUgfSA9IHN0YXRlO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93LCByZXN1bHRXYXRjaGVyIH0gPSBmYWNldHM7XG4gICAgICAgICAgICAhaXNEb25lIHx8IC8vXG4gICAgICAgICAgICB0aHJvd1JlZGFjdGVkYENhbm5vdCByZXN0YXJ0IGEgZG9uZSByZXRyeWFibGUgZmxvdyAke2Zsb3d9YDtcbiAgICAgICAgICAgIGNvbnN0IHJ1bklkID0gc3RhdGUucnVucyArIDFuO1xuICAgICAgICAgICAgc3RhdGUucnVucyA9IHJ1bklkO1xuICAgICAgICAgICAgbGV0IHJlc3VsdFA7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICByZXN1bHRQID0gUHJvbWlzZS5yZXNvbHZlKHJldHJ5YWJsZUZ1bmMoLi4uYWN0aXZhdGlvbkFyZ3MpKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICByZXN1bHRQID0gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG91dGVyWm9uZS53YXRjaFByb21pc2UoaGFyZGVuKHJlc3VsdFApLCByZXN1bHRXYXRjaGVyLCBydW5JZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXRPdXRjb21lKCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgb3V0Y29tZUtpdCB9ID0gc3RhdGU7XG4gICAgICAgICAgICByZXR1cm4gb3V0Y29tZUtpdC52b3c7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByZXN1bHRXYXRjaGVyOiB7XG4gICAgICAgICAgb25GdWxmaWxsZWQodmFsdWUsIHJ1bklkKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBydW5zLCBvdXRjb21lS2l0IH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGlmIChydW5JZCAhPT0gcnVucykgcmV0dXJuO1xuICAgICAgICAgICAgIXN0YXRlLmlzRG9uZSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCByZXNvbHZlIGEgZG9uZSByZXRyeWFibGUgZmxvdyAke3RoaXMuZmFjZXRzLmZsb3d9YDtcbiAgICAgICAgICAgIG91dGNvbWVLaXQucmVzb2x2ZXIucmVzb2x2ZSh2YWx1ZSk7XG4gICAgICAgICAgICBmbG93Rm9yT3V0Y29tZVZvd0tleS5kZWxldGUodG9QYXNzYWJsZUNhcChvdXRjb21lS2l0LnZvdykpO1xuICAgICAgICAgICAgc3RhdGUuaXNEb25lID0gdHJ1ZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCBydW5JZCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgcnVucywgb3V0Y29tZUtpdCB9ID0gc3RhdGU7XG4gICAgICAgICAgICBpZiAocnVuSWQgIT09IHJ1bnMpIHJldHVybjtcbiAgICAgICAgICAgICFzdGF0ZS5pc0RvbmUgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcmVqZWN0IGEgZG9uZSByZXRyeWFibGUgZmxvdyAke3RoaXMuZmFjZXRzLmZsb3d9YDtcbiAgICAgICAgICAgIGNvbnN0IHJldHJ5UmVhc29uID0gaXNSZXRyeWFibGVSZWFzb24yKFxuICAgICAgICAgICAgICByZWFzb24sXG4gICAgICAgICAgICAgIHN0YXRlLmxhc3RSZXRyeVJlYXNvblxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChyZXRyeVJlYXNvbikge1xuICAgICAgICAgICAgICBzdGF0ZS5sYXN0UmV0cnlSZWFzb24gPSByZXRyeVJlYXNvbjtcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMuZmxvdy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBvdXRjb21lS2l0LnJlc29sdmVyLnJlamVjdChyZWFzb24pO1xuICAgICAgICAgICAgICBmbG93Rm9yT3V0Y29tZVZvd0tleS5kZWxldGUodG9QYXNzYWJsZUNhcChvdXRjb21lS2l0LnZvdykpO1xuICAgICAgICAgICAgICBzdGF0ZS5pc0RvbmUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gICAgY29uc3QgbWFrZVJldHJ5YWJsZUZsb3dLaXQgPSAoYWN0aXZhdGlvbkFyZ3MpID0+IHtcbiAgICAgIGNvbnN0IHJldHJ5YWJsZUtpdCA9IGludGVybmFsTWFrZVJldHJ5YWJsZUZsb3dLaXQoYWN0aXZhdGlvbkFyZ3MpO1xuICAgICAgY29uc3QgeyBmbG93IH0gPSByZXRyeWFibGVLaXQ7XG4gICAgICBjb25zdCB2b3cgPSBmbG93LmdldE91dGNvbWUoKTtcbiAgICAgIGZsb3dGb3JPdXRjb21lVm93S2V5LmluaXQodG9QYXNzYWJsZUNhcCh2b3cpLCBmbG93KTtcbiAgICAgIGZsb3cucmVzdGFydCgpO1xuICAgICAgcmV0dXJuIHJldHJ5YWJsZUtpdDtcbiAgICB9O1xuICAgIHJldHVybiBoYXJkZW4obWFrZVJldHJ5YWJsZUZsb3dLaXQpO1xuICB9O1xuICBjb25zdCByZXRyeWFibGUgPSAoem9uZSwgdGFnLCByZXRyeWFibGVGdW5jKSA9PiB7XG4gICAgY29uc3QgbWFrZVJldHJ5YWJsZUtpdCA9IHByZXBhcmVSZXRyeWFibGVGbG93S2l0KHpvbmUsIHRhZywgcmV0cnlhYmxlRnVuYyk7XG4gICAgY29uc3Qgd3JhcHBlckZ1bmNOYW1lID0gYCR7dGFnfV9yZXRyeWFibGVgO1xuICAgIGNvbnN0IHdyYXBwZXJGdW5jID0ge1xuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIFt3cmFwcGVyRnVuY05hbWVdKC4uLmFyZ3MpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICB6b25lLmlzU3RvcmFibGUoaGFyZGVuKGFyZ3MpKSB8fCB0aHJvd1JlZGFjdGVkYHJldHJ5YWJsZSBhcmd1bWVudHMgbXVzdCBiZSBzdG9yYWJsZSAke2FyZ3N9YDtcbiAgICAgICAgICBjb25zdCB7IGZsb3cgfSA9IG1ha2VSZXRyeWFibGVLaXQoYXJncyk7XG4gICAgICAgICAgcmV0dXJuIGZsb3cuZ2V0T3V0Y29tZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9W3dyYXBwZXJGdW5jTmFtZV07XG4gICAgZGVmaW5lUHJvcGVydGllczQod3JhcHBlckZ1bmMsIHtcbiAgICAgIGxlbmd0aDogeyB2YWx1ZTogcmV0cnlhYmxlRnVuYy5sZW5ndGggfVxuICAgIH0pO1xuICAgIHJldHVybiBoYXJkZW4od3JhcHBlckZ1bmMpO1xuICB9O1xuICBjb25zdCBhZG1pblJldHJ5YWJsZUZsb3cgPSBvdXRlclpvbmUuZXhvKFxuICAgIFwiQWRtaW5SZXRyeWFibGVGbG93XCIsXG4gICAgQWRtaW5SZXRyeWFibGVGbG93SSxcbiAgICB7XG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIGdldEZsb3dGb3JPdXRjb21lVm93KG91dGNvbWVWb3cpIHtcbiAgICAgICAgcmV0dXJuIGZsb3dGb3JPdXRjb21lVm93S2V5LmdldCh0b1Bhc3NhYmxlQ2FwKG91dGNvbWVWb3cpKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIHByZXBhcmVSZXRyeWFibGVGbG93S2l0LFxuICAgIGFkbWluUmV0cnlhYmxlRmxvdyxcbiAgICByZXRyeWFibGVcbiAgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVSZXRyeWFibGVUb29scyk7XG5cbi8vXG52YXIgbWFrZVdoZW4gPSAoaXNSZXRyeWFibGVSZWFzb24yID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAoKSA9PiBmYWxzZVxuKSkgPT4ge1xuICBjb25zdCB1bndyYXAgPSBhc3luYyAoc3BlY2ltZW5QKSA9PiB7XG4gICAgYXdhaXQgbnVsbDtcbiAgICBsZXQgcmVzdWx0ID0gYXdhaXQgc3BlY2ltZW5QO1xuICAgIGxldCBwYXlsb2FkID0gZ2V0Vm93UGF5bG9hZChyZXN1bHQpO1xuICAgIGxldCBwcmlvclJldHJ5VmFsdWU7XG4gICAgY29uc3Qgc2VlblBheWxvYWRzID0gLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCk7XG4gICAgd2hpbGUgKHBheWxvYWQpIHtcbiAgICAgIGNvbnN0IHsgdm93VjAgfSA9IHBheWxvYWQ7XG4gICAgICBpZiAoc2VlblBheWxvYWRzLmhhcyh2b3dWMCkpIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXCJWb3cgcmVzb2x1dGlvbiBjeWNsZSBkZXRlY3RlZFwiKTtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IEUodm93VjApLnNob3J0ZW4oKTtcbiAgICAgICAgc2VlblBheWxvYWRzLmFkZCh2b3dWMCk7XG4gICAgICAgIHByaW9yUmV0cnlWYWx1ZSA9IHZvaWQgMDtcbiAgICAgICAgcmVzdWx0ID0gcmVzO1xuICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgY29uc3QgbmV4dFJldHJ5VmFsdWUgPSBpc1JldHJ5YWJsZVJlYXNvbjIoZTIsIHByaW9yUmV0cnlWYWx1ZSk7XG4gICAgICAgIGlmICghbmV4dFJldHJ5VmFsdWUpIHtcbiAgICAgICAgICB0aHJvdyBlMjtcbiAgICAgICAgfVxuICAgICAgICBwcmlvclJldHJ5VmFsdWUgPSBuZXh0UmV0cnlWYWx1ZTtcbiAgICAgIH1cbiAgICAgIHBheWxvYWQgPSBnZXRWb3dQYXlsb2FkKHJlc3VsdCk7XG4gICAgfVxuICAgIGNvbnN0IHVud3JhcHBlZCA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHJlc3VsdFxuICAgICk7XG4gICAgcmV0dXJuIHVud3JhcHBlZDtcbiAgfTtcbiAgY29uc3Qgd2hlbiA9IChzcGVjaW1lblAsIG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKSA9PiB7XG4gICAgY29uc3QgdW53cmFwcGVkID0gdW53cmFwKHNwZWNpbWVuUCk7XG4gICAgaWYgKG9uRnVsZmlsbGVkID09IG51bGwgJiYgb25SZWplY3RlZCA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB1bndyYXBwZWRcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBFLnJlc29sdmUodW53cmFwcGVkKS50aGVuKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKTtcbiAgfTtcbiAgaGFyZGVuKHdoZW4pO1xuICByZXR1cm4gd2hlbjtcbn07XG5oYXJkZW4obWFrZVdoZW4pO1xuXG4vL1xudmFyIHByZXBhcmVCYXNpY1Zvd1Rvb2xzID0gKHpvbmUsIHBvd2VycyA9IHt9KSA9PiB7XG4gIGNvbnN0IHsgaXNSZXRyeWFibGVSZWFzb246IGlzUmV0cnlhYmxlUmVhc29uMiA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICgpID0+IGZhbHNlXG4gICkgfSA9IHBvd2VycztcbiAgY29uc3Qgdm93UmVqZWN0aW9uVHJhY2tlciA9IHByZXBhcmVWb3dSZWplY3Rpb25UcmFja2VyKHpvbmUpO1xuICBjb25zdCBtYWtlVm93S2l0ID0gcHJlcGFyZVZvd0tpdCh6b25lLCB2b3dSZWplY3Rpb25UcmFja2VyKTtcbiAgY29uc3Qgd2hlbiA9IG1ha2VXaGVuKGlzUmV0cnlhYmxlUmVhc29uMik7XG4gIGNvbnN0IHdhdGNoID0gcHJlcGFyZVdhdGNoKHpvbmUsIG1ha2VWb3dLaXQsIGlzUmV0cnlhYmxlUmVhc29uMik7XG4gIGNvbnN0IG1ha2VXYXRjaFV0aWxzID0gcHJlcGFyZVdhdGNoVXRpbHMoem9uZSwge1xuICAgIHdhdGNoLFxuICAgIHdoZW4sXG4gICAgbWFrZVZvd0tpdCxcbiAgICBpc1JldHJ5YWJsZVJlYXNvbjogaXNSZXRyeWFibGVSZWFzb24yXG4gIH0pO1xuICBjb25zdCB3YXRjaFV0aWxzID0gbWFrZVdhdGNoVXRpbHMoKTtcbiAgY29uc3QgYXNWb3cgPSBtYWtlQXNWb3cobWFrZVZvd0tpdCk7XG4gIGNvbnN0IHsgcmV0cnlhYmxlIH0gPSBwcmVwYXJlUmV0cnlhYmxlVG9vbHMoem9uZSwge1xuICAgIG1ha2VWb3dLaXQsXG4gICAgaXNSZXRyeWFibGVSZWFzb246IGlzUmV0cnlhYmxlUmVhc29uMlxuICB9KTtcbiAgY29uc3QgYWxsID0gKG1heWJlVm93cykgPT4gd2F0Y2hVdGlscy5hbGwobWF5YmVWb3dzKTtcbiAgY29uc3QgYWxsVm93cyA9IGFsbDtcbiAgY29uc3QgYWxsU2V0dGxlZCA9IChtYXliZVZvd3MpID0+IHdhdGNoVXRpbHMuYWxsU2V0dGxlZChtYXliZVZvd3MpO1xuICBjb25zdCBhc1Byb21pc2UgPSAoc3BlY2ltZW5QLCAuLi53YXRjaGVyQXJncykgPT4gd2F0Y2hVdGlscy5hc1Byb21pc2Uoc3BlY2ltZW5QLCAuLi53YXRjaGVyQXJncyk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIHdoZW4sXG4gICAgd2F0Y2gsXG4gICAgbWFrZVZvd0tpdCxcbiAgICBhbGwsXG4gICAgYWxsVm93cyxcbiAgICBhbGxTZXR0bGVkLFxuICAgIGFzVm93LFxuICAgIGFzUHJvbWlzZSxcbiAgICByZXRyeWFibGUsXG4gICAgcmV0cmlhYmxlOiByZXRyeWFibGVcbiAgICAvL1xuICB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZUJhc2ljVm93VG9vbHMpO1xuXG4vL1xudmFyIGhpZGRlblByaW9yRXJyb3IyO1xudmFyIGhpZGRlbkN1cnJlbnRUdXJuMiA9IDA7XG52YXIgaGlkZGVuQ3VycmVudEV2ZW50MiA9IDA7XG52YXIgVkVSQk9TRTIgPSBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzKFwiREVCVUdcIiwgXCJ0cmFjay10dXJuc1wiKTtcbnZhciBFTkFCTEVEMiA9IGdldEVudmlyb25tZW50T3B0aW9uKFwiVFJBQ0tfVFVSTlNcIiwgXCJkaXNhYmxlZFwiLCBbXCJlbmFibGVkXCJdKSA9PT0gXCJlbmFibGVkXCI7XG52YXIgYWRkUmVqZWN0aW9uTm90ZTIgPSAoZGV0YWlsc05vdGUpID0+IChyZWFzb24pID0+IHtcbiAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgbm90ZShyZWFzb24sIGRldGFpbHNOb3RlKTtcbiAgfVxuICBpZiAoVkVSQk9TRTIpIHtcbiAgICBjb25zb2xlLmxvZyhcIlJFSkVDVEVEIGF0IHRvcCBvZiBldmVudCBsb29wXCIsIHJlYXNvbik7XG4gIH1cbn07XG52YXIgd3JhcEZ1bmN0aW9uMiA9IChmdW5jLCBzZW5kaW5nRXJyb3IpID0+ICguLi5hcmdzKSA9PiB7XG4gIGhpZGRlblByaW9yRXJyb3IyID0gc2VuZGluZ0Vycm9yO1xuICBoaWRkZW5DdXJyZW50VHVybjIgKz0gMTtcbiAgaGlkZGVuQ3VycmVudEV2ZW50MiA9IDA7XG4gIHRyeSB7XG4gICAgbGV0IHJlc3VsdDtcbiAgICB0cnkge1xuICAgICAgcmVzdWx0ID0gZnVuYyguLi5hcmdzKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICBub3RlKFxuICAgICAgICAgIGVycixcbiAgICAgICAgICByZWRhY3RlZGBUaHJvd24gZnJvbTogJHtoaWRkZW5QcmlvckVycm9yMn06JHtoaWRkZW5DdXJyZW50VHVybjJ9LiR7aGlkZGVuQ3VycmVudEV2ZW50Mn1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoVkVSQk9TRTIpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJUSFJPV04gdG8gdG9wIG9mIGV2ZW50IGxvb3BcIiwgZXJyKTtcbiAgICAgIH1cbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gICAgY29uc3QgZGV0YWlsc05vdGUgPSByZWRhY3RlZGBSZWplY3Rpb24gZnJvbTogJHtoaWRkZW5QcmlvckVycm9yMn06JHtoaWRkZW5DdXJyZW50VHVybjJ9LiR7aGlkZGVuQ3VycmVudEV2ZW50Mn1gO1xuICAgIFByb21pc2UucmVzb2x2ZShyZXN1bHQpLmNhdGNoKGFkZFJlamVjdGlvbk5vdGUyKGRldGFpbHNOb3RlKSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBmaW5hbGx5IHtcbiAgICBoaWRkZW5QcmlvckVycm9yMiA9IHZvaWQgMDtcbiAgfVxufTtcbnZhciB0cmFja1R1cm5zMiA9IChmdW5jcykgPT4ge1xuICBpZiAoIUVOQUJMRUQyIHx8IHR5cGVvZiBnbG9iYWxUaGlzID09PSBcInVuZGVmaW5lZFwiIHx8ICFnbG9iYWxUaGlzLmFzc2VydCkge1xuICAgIHJldHVybiBmdW5jcztcbiAgfVxuICBoaWRkZW5DdXJyZW50RXZlbnQyICs9IDE7XG4gIGNvbnN0IHNlbmRpbmdFcnJvciA9IEVycm9yKFxuICAgIGBFdmVudDogJHtoaWRkZW5DdXJyZW50VHVybjJ9LiR7aGlkZGVuQ3VycmVudEV2ZW50Mn1gXG4gICk7XG4gIGlmIChoaWRkZW5QcmlvckVycm9yMiAhPT0gdm9pZCAwKSB7XG4gICAgbm90ZShzZW5kaW5nRXJyb3IsIHJlZGFjdGVkYENhdXNlZCBieTogJHtoaWRkZW5QcmlvckVycm9yMn1gKTtcbiAgfVxuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICBmdW5jcy5tYXAoKGZ1bmMpID0+IGZ1bmMgJiYgd3JhcEZ1bmN0aW9uMihmdW5jLCBzZW5kaW5nRXJyb3IpKVxuICApO1xufTtcblxuLy9cbnZhciB7IGhhc093bjogaGFzT3duMywgZnJlZXplOiBmcmVlemU5LCBlbnRyaWVzOiBlbnRyaWVzOCB9ID0gT2JqZWN0O1xudmFyIGlzSlNPTlJlY29yZDIgPSAodmFsKSA9PiB0eXBlb2YgdmFsID09PSBcIm9iamVjdFwiICYmIHZhbCAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheSh2YWwpO1xudmFyIHNpbXBsaWZ5VGFnMiA9ICh0YWcpID0+IHtcbiAgZm9yIChjb25zdCBwcmVmaXggb2YgW1wiQWxsZWdlZDogXCIsIFwiRGVidWdOYW1lOiBcIl0pIHtcbiAgICBpZiAodGFnLnN0YXJ0c1dpdGgocHJlZml4KSkge1xuICAgICAgcmV0dXJuIHRhZy5zbGljZShwcmVmaXgubGVuZ3RoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRhZztcbn07XG52YXIgbWFrZU1lc3NhZ2VCcmVha3BvaW50VGVzdGVyMiA9IChvcHRpb25OYW1lKSA9PiB7XG4gIGxldCBicmVha3BvaW50cyA9IEpTT04ucGFyc2UoZ2V0RW52aXJvbm1lbnRPcHRpb24ob3B0aW9uTmFtZSwgXCJudWxsXCIpKTtcbiAgaWYgKGJyZWFrcG9pbnRzID09PSBudWxsKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBsZXQgYnJlYWtwb2ludHNUYWJsZTtcbiAgY29uc3QgZ2V0QnJlYWtwb2ludHMgPSAoKSA9PiBicmVha3BvaW50cztcbiAgZnJlZXplOShnZXRCcmVha3BvaW50cyk7XG4gIGNvbnN0IHNldEJyZWFrcG9pbnRzID0gKG5ld0JyZWFrcG9pbnRzID0gYnJlYWtwb2ludHMpID0+IHtcbiAgICBpc0pTT05SZWNvcmQyKG5ld0JyZWFrcG9pbnRzKSB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkICR7cXVvdGUob3B0aW9uTmFtZSl9IG9wdGlvbiB0byBiZSBhIEpTT04gYnJlYWtwb2ludHMgcmVjb3JkYDtcbiAgICBjb25zdCBuZXdCcmVha3BvaW50c1RhYmxlID0geyBfX3Byb3RvX186IG51bGwgfTtcbiAgICBmb3IgKGNvbnN0IFt0YWcsIG1ldGhvZEJQc10gb2YgZW50cmllczgobmV3QnJlYWtwb2ludHMpKSB7XG4gICAgICB0YWcgPT09IHNpbXBsaWZ5VGFnMih0YWcpIHx8IHRocm93UmVkYWN0ZWRgSnVzdCB1c2Ugc2ltcGxlIHRhZyAke3F1b3RlKHNpbXBsaWZ5VGFnMih0YWcpKX0gcmF0aGVyIHRoYW4gJHtxdW90ZSh0YWcpfWA7XG4gICAgICBpc0pTT05SZWNvcmQyKG1ldGhvZEJQcykgfHwgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCAke3F1b3RlKG9wdGlvbk5hbWUpfSBvcHRpb24ncyAke3F1b3RlKFxuICAgICAgICB0YWdcbiAgICAgICl9IHRvIGJlIGEgSlNPTiBtZXRob2RzIGJyZWFrcG9pbnRzIHJlY29yZGA7XG4gICAgICBmb3IgKGNvbnN0IFttZXRob2ROYW1lLCBjb3VudF0gb2YgZW50cmllczgobWV0aG9kQlBzKSkge1xuICAgICAgICBjb3VudCA9PT0gXCIqXCIgfHwgdHlwZW9mIGNvdW50ID09PSBcIm51bWJlclwiICYmIE51bWJlci5pc1NhZmVJbnRlZ2VyKGNvdW50KSAmJiBjb3VudCA+PSAwIHx8IHRocm93UmVkYWN0ZWRgRXhwZWN0ZWQgJHtxdW90ZShvcHRpb25OYW1lKX0gb3B0aW9uJ3MgJHtxdW90ZSh0YWcpfS4ke3F1b3RlKFxuICAgICAgICAgIG1ldGhvZE5hbWVcbiAgICAgICAgKX0gdG8gYmUgXCIqXCIgb3IgYSBub24tbmVnYXRpdmUgaW50ZWdlcmA7XG4gICAgICAgIGNvbnN0IGNsYXNzQlBzID0gaGFzT3duMyhuZXdCcmVha3BvaW50c1RhYmxlLCBtZXRob2ROYW1lKSA/IG5ld0JyZWFrcG9pbnRzVGFibGVbbWV0aG9kTmFtZV0gOiBuZXdCcmVha3BvaW50c1RhYmxlW21ldGhvZE5hbWVdID0ge1xuICAgICAgICAgIC8vXG4gICAgICAgICAgX19wcm90b19fOiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIGNsYXNzQlBzW3RhZ10gPSBjb3VudDtcbiAgICAgIH1cbiAgICB9XG4gICAgYnJlYWtwb2ludHMgPSBuZXdCcmVha3BvaW50cztcbiAgICBicmVha3BvaW50c1RhYmxlID0gbmV3QnJlYWtwb2ludHNUYWJsZTtcbiAgfTtcbiAgZnJlZXplOShzZXRCcmVha3BvaW50cyk7XG4gIGNvbnN0IHNob3VsZEJyZWFrcG9pbnQgPSAocmVjaXBpZW50LCBtZXRob2ROYW1lKSA9PiB7XG4gICAgaWYgKG1ldGhvZE5hbWUgPT09IHZvaWQgMCB8fCBtZXRob2ROYW1lID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IGNsYXNzQlBzID0gYnJlYWtwb2ludHNUYWJsZVttZXRob2ROYW1lXSB8fCBicmVha3BvaW50c1RhYmxlW1wiKlwiXTtcbiAgICBpZiAoY2xhc3NCUHMgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBsZXQgdGFnID0gc2ltcGxpZnlUYWcyKHJlY2lwaWVudFtTeW1ib2wudG9TdHJpbmdUYWddKTtcbiAgICBsZXQgY291bnQgPSBjbGFzc0JQc1t0YWddO1xuICAgIGlmIChjb3VudCA9PT0gdm9pZCAwKSB7XG4gICAgICB0YWcgPSBcIipcIjtcbiAgICAgIGNvdW50ID0gY2xhc3NCUHNbdGFnXTtcbiAgICAgIGlmIChjb3VudCA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNvdW50ID09PSBcIipcIikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChjb3VudCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGFzc2VydCh0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIgJiYgY291bnQgPj0gMSk7XG4gICAgY2xhc3NCUHNbdGFnXSA9IGNvdW50IC0gMTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG4gIGZyZWV6ZTkoc2hvdWxkQnJlYWtwb2ludCk7XG4gIGNvbnN0IGJyZWFrcG9pbnRUZXN0ZXIgPSBmcmVlemU5KHtcbiAgICBnZXRCcmVha3BvaW50cyxcbiAgICBzZXRCcmVha3BvaW50cyxcbiAgICBzaG91bGRCcmVha3BvaW50XG4gIH0pO1xuICBicmVha3BvaW50VGVzdGVyLnNldEJyZWFrcG9pbnRzKCk7XG4gIHJldHVybiBicmVha3BvaW50VGVzdGVyO1xufTtcbmZyZWV6ZTkobWFrZU1lc3NhZ2VCcmVha3BvaW50VGVzdGVyMik7XG5cbi8vXG52YXIgeyBhc3NpZ246IGFzc2lnbjIsIGNyZWF0ZTogY3JlYXRlNiB9ID0gT2JqZWN0O1xudmFyIG9uU2VuZDIgPSBtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIyKFwiRU5ET19TRU5EX0JSRUFLUE9JTlRTXCIpO1xudmFyIGJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIyID0ge1xuICBzZXQoX3RhcmdldCwgX3Byb3AsIF92YWx1ZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgaXNFeHRlbnNpYmxlKF90YXJnZXQpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIHNldFByb3RvdHlwZU9mKF90YXJnZXQsIF92YWx1ZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbiAgZGVsZXRlUHJvcGVydHkoX3RhcmdldCwgX3Byb3ApIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG52YXIgbWFrZUVQcm94eUhhbmRsZXIyID0gKHJlY2lwaWVudCwgSGFuZGxlZFByb21pc2UyLCB1bndyYXApID0+IGhhcmRlbih7XG4gIC4uLmJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIyLFxuICBnZXQ6IChfdGFyZ2V0LCBwcm9wZXJ0eUtleSwgcmVjZWl2ZXIpID0+IHtcbiAgICByZXR1cm4gaGFyZGVuKFxuICAgICAge1xuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFtwcm9wZXJ0eUtleV0oLi4uYXJncykge1xuICAgICAgICAgIGlmICh0aGlzICE9PSByZWNlaXZlcikge1xuICAgICAgICAgICAgcmV0dXJuIEhhbmRsZWRQcm9taXNlMi5yZWplY3QoXG4gICAgICAgICAgICAgIG1ha2VFcnJvcihcbiAgICAgICAgICAgICAgICByZWRhY3RlZGBVbmV4cGVjdGVkIHJlY2VpdmVyIGZvciBcIiR7cXVvdGUocHJvcGVydHlLZXkpfVwiIG1ldGhvZCBvZiBFKCR7cXVvdGUoXG4gICAgICAgICAgICAgICAgICByZWNpcGllbnRcbiAgICAgICAgICAgICAgICApfSlgXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvblNlbmQyICYmIG9uU2VuZDIuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHByb3BlcnR5S2V5KSkge1xuICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB1bndyYXAoXG4gICAgICAgICAgICBIYW5kbGVkUHJvbWlzZTIuYXBwbHlNZXRob2QodW53cmFwKHJlY2lwaWVudCksIHByb3BlcnR5S2V5LCBhcmdzKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgIH1bcHJvcGVydHlLZXldXG4gICAgKTtcbiAgfSxcbiAgYXBwbHk6IChfdGFyZ2V0LCBfdGhpc0FyZywgYXJnQXJyYXkgPSBbXSkgPT4ge1xuICAgIGlmIChvblNlbmQyICYmIG9uU2VuZDIuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHZvaWQgMCkpIHtcbiAgICAgIGRlYnVnZ2VyO1xuICAgIH1cbiAgICByZXR1cm4gdW53cmFwKEhhbmRsZWRQcm9taXNlMi5hcHBseUZ1bmN0aW9uKHVud3JhcChyZWNpcGllbnQpLCBhcmdBcnJheSkpO1xuICB9LFxuICBoYXM6IChfdGFyZ2V0LCBfcCkgPT4ge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59KTtcbnZhciBtYWtlRVNlbmRPbmx5UHJveHlIYW5kbGVyMiA9IChyZWNpcGllbnQsIEhhbmRsZWRQcm9taXNlMiwgdW53cmFwKSA9PiBoYXJkZW4oe1xuICAuLi5iYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyMixcbiAgZ2V0OiAoX3RhcmdldCwgcHJvcGVydHlLZXksIHJlY2VpdmVyKSA9PiB7XG4gICAgcmV0dXJuIGhhcmRlbihcbiAgICAgIHtcbiAgICAgICAgLypcblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBbcHJvcGVydHlLZXldKC4uLmFyZ3MpIHtcbiAgICAgICAgICB0aGlzID09PSByZWNlaXZlciB8fCB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgcmVjZWl2ZXIgZm9yIFwiJHtxdW90ZShcbiAgICAgICAgICAgIHByb3BlcnR5S2V5XG4gICAgICAgICAgKX1cIiBtZXRob2Qgb2YgRS5zZW5kT25seSgke3F1b3RlKHJlY2lwaWVudCl9KWA7XG4gICAgICAgICAgaWYgKG9uU2VuZDIgJiYgb25TZW5kMi5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgcHJvcGVydHlLZXkpKSB7XG4gICAgICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgSGFuZGxlZFByb21pc2UyLmFwcGx5TWV0aG9kU2VuZE9ubHkoXG4gICAgICAgICAgICB1bndyYXAocmVjaXBpZW50KSxcbiAgICAgICAgICAgIHByb3BlcnR5S2V5LFxuICAgICAgICAgICAgYXJnc1xuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgfVxuICAgICAgICAvL1xuICAgICAgfVtwcm9wZXJ0eUtleV1cbiAgICApO1xuICB9LFxuICBhcHBseTogKF90YXJnZXQsIF90aGlzQXJnLCBhcmdzQXJyYXkgPSBbXSkgPT4ge1xuICAgIGlmIChvblNlbmQyICYmIG9uU2VuZDIuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHZvaWQgMCkpIHtcbiAgICAgIGRlYnVnZ2VyO1xuICAgIH1cbiAgICBIYW5kbGVkUHJvbWlzZTIuYXBwbHlGdW5jdGlvblNlbmRPbmx5KHVud3JhcChyZWNpcGllbnQpLCBhcmdzQXJyYXkpO1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH0sXG4gIGhhczogKF90YXJnZXQsIF9wKSA9PiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn0pO1xudmFyIG1ha2VFR2V0UHJveHlIYW5kbGVyMiA9ICh4LCBIYW5kbGVkUHJvbWlzZTIsIHVud3JhcCkgPT4gaGFyZGVuKHtcbiAgLi4uYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlcjIsXG4gIGhhczogKF90YXJnZXQsIF9wcm9wKSA9PiB0cnVlLFxuICBnZXQ6IChfdGFyZ2V0LCBwcm9wKSA9PiBIYW5kbGVkUHJvbWlzZTIuZ2V0KHVud3JhcCh4KSwgcHJvcClcbn0pO1xudmFyIHJlc29sdmUgPSAoeCkgPT4gSGFuZGxlZFByb21pc2UucmVzb2x2ZSh4KTtcbnZhciBtYWtlRTIgPSAoSGFuZGxlZFByb21pc2UyLCBwb3dlcnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgYWRkaXRpb25hbCA9IChcbiAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgIHt9XG4gICAgKSxcbiAgICB1bndyYXAgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHJlc29sdmVcbiAgICApXG4gIH0gPSBwb3dlcnM7XG4gIHJldHVybiBoYXJkZW4oXG4gICAgYXNzaWduMihcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgKHgpID0+IGhhcmRlbihcbiAgICAgICAgbmV3IFByb3h5KCgpID0+IHtcbiAgICAgICAgfSwgbWFrZUVQcm94eUhhbmRsZXIyKHgsIEhhbmRsZWRQcm9taXNlMiwgdW53cmFwKSlcbiAgICAgICksXG4gICAgICB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBnZXQ6ICh4KSA9PiBoYXJkZW4oXG4gICAgICAgICAgbmV3IFByb3h5KFxuICAgICAgICAgICAgY3JlYXRlNihudWxsKSxcbiAgICAgICAgICAgIG1ha2VFR2V0UHJveHlIYW5kbGVyMih4LCBIYW5kbGVkUHJvbWlzZTIsIHVud3JhcClcbiAgICAgICAgICApXG4gICAgICAgICksXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHJlc29sdmU6ICh4KSA9PiByZXNvbHZlKHVud3JhcCh4KSksXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHNlbmRPbmx5OiAoeCkgPT4gaGFyZGVuKFxuICAgICAgICAgIG5ldyBQcm94eShcbiAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBtYWtlRVNlbmRPbmx5UHJveHlIYW5kbGVyMih4LCBIYW5kbGVkUHJvbWlzZTIsIHVud3JhcClcbiAgICAgICAgICApXG4gICAgICAgICksXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgd2hlbjogKHgsIG9uZnVsZmlsbGVkLCBvbnJlamVjdGVkKSA9PiB7XG4gICAgICAgICAgY29uc3QgdW53cmFwcGVkID0gcmVzb2x2ZSh1bndyYXAoeCkpO1xuICAgICAgICAgIGlmIChvbmZ1bGZpbGxlZCA9PSBudWxsICYmIG9ucmVqZWN0ZWQgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHVud3JhcHBlZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHVud3JhcHBlZC50aGVuKFxuICAgICAgICAgICAgLi4udHJhY2tUdXJuczIoXG4gICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgIFtvbmZ1bGZpbGxlZCwgb25yZWplY3RlZF1cbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYWRkaXRpb25hbFxuICAgIClcbiAgKTtcbn07XG52YXIgRV9kZWZhdWx0MiA9IG1ha2VFMjtcblxuLy9cbnZhciBpc1JldHJ5YWJsZVJlYXNvbiA9IChyZWFzb24sIHByaW9yUmV0cnlWYWx1ZSkgPT4ge1xuICBpZiAoaXNVcGdyYWRlRGlzY29ubmVjdGlvbihyZWFzb24pICYmICghaXNVcGdyYWRlRGlzY29ubmVjdGlvbihwcmlvclJldHJ5VmFsdWUpIHx8IHJlYXNvbi5pbmNhcm5hdGlvbk51bWJlciA+IHByaW9yUmV0cnlWYWx1ZS5pbmNhcm5hdGlvbk51bWJlcikpIHtcbiAgICByZXR1cm4gcmVhc29uO1xuICB9XG4gIGlmIChpc0FiYW5kb25lZEVycm9yKHJlYXNvbikgJiYgIWlzQWJhbmRvbmVkRXJyb3IocHJpb3JSZXRyeVZhbHVlKSkge1xuICAgIHJldHVybiByZWFzb247XG4gIH1cbiAgcmV0dXJuIHZvaWQgMDtcbn07XG52YXIgZGVmYXVsdFBvd2VycyA9IGhhcmRlbih7XG4gIGlzUmV0cnlhYmxlUmVhc29uXG59KTtcbnZhciBwcmVwYXJlU3dpbmdzZXRWb3dUb29scyA9ICh6b25lLCBwb3dlcnMgPSB7fSkgPT4gcHJlcGFyZUJhc2ljVm93VG9vbHMoem9uZSwgeyAuLi5kZWZhdWx0UG93ZXJzLCAuLi5wb3dlcnMgfSk7XG5oYXJkZW4ocHJlcGFyZVN3aW5nc2V0Vm93VG9vbHMpO1xudmFyIGhlYXBWb3dUb29scyA9IHByZXBhcmVTd2luZ3NldFZvd1Rvb2xzKG1ha2VIZWFwWm9uZSgpKTtcbnZhciBoZWFwVm93RSA9IEVfZGVmYXVsdDIoZ2xvYmFsVGhpcy5IYW5kbGVkUHJvbWlzZSwge1xuICB1bndyYXA6IGhlYXBWb3dUb29scy53aGVuLFxuICBhZGRpdGlvbmFsOiB7IHdoZW46IGhlYXBWb3dUb29scy53aGVuIH1cbn0pO1xuXG4vL1xudmFyIE91dGJvdW5kQ29ubmVjdGlvbkhhbmRsZXJJID0gTS5pbnRlcmZhY2UoXG4gIFwiT3V0Ym91bmRDb25uZWN0aW9uSGFuZGxlclwiLFxuICB7XG4gICAgb25PcGVuOiBNLmNhbGxXaGVuKE0uYW55KCksIE0uc3RyaW5nKCksIE0uc3RyaW5nKCksIE0uYW55KCkpLnJldHVybnMoXG4gICAgICBNLmFueSgpXG4gICAgKSxcbiAgICBvbkNsb3NlOiBNLmNhbGxXaGVuKE0uYW55KCksIE0uYW55KCksIE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgfVxuKTtcbnZhciBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSA9IHtcbiAgY2hhaW5JZDogTS5zdHJpbmcoKSxcbiAgLy9cbiAgZW5jb2Rpbmc6IE0uc3RyaW5nKCksXG4gIHZhbHVlOiBNLnN0cmluZygpXG59O1xuaGFyZGVuKENvc21vc0NoYWluQWRkcmVzc1NoYXBlKTtcbnZhciBDYWlwMTBSZWNvcmRTaGFwZSA9IHtcbiAgbmFtZXNwYWNlOiBNLnN0cmluZygpLFxuICByZWZlcmVuY2U6IE0uc3RyaW5nKCksXG4gIGFjY291bnRBZGRyZXNzOiBNLnN0cmluZygpXG59O1xuaGFyZGVuKENhaXAxMFJlY29yZFNoYXBlKTtcbnZhciBBY2NvdW50SWRBcmdTaGFwZSA9IE0ub3IoTS5zdHJpbmcoKSwgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpO1xudmFyIFByb3RvM1NoYXBlID0geyB0eXBlVXJsOiBNLnN0cmluZygpLCB2YWx1ZTogTS5zdHJpbmcoKSB9O1xuaGFyZGVuKFByb3RvM1NoYXBlKTtcbnZhciBJQkNDaGFubmVsSURTaGFwZSA9IE0uc3RyaW5nKCk7XG52YXIgSUJDQ2hhbm5lbEluZm9TaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBwb3J0SWQ6IE0uc3RyaW5nKCksXG4gIGNoYW5uZWxJZDogSUJDQ2hhbm5lbElEU2hhcGUsXG4gIGNvdW50ZXJQYXJ0eVBvcnRJZDogTS5zdHJpbmcoKSxcbiAgY291bnRlclBhcnR5Q2hhbm5lbElkOiBJQkNDaGFubmVsSURTaGFwZSxcbiAgb3JkZXJpbmc6IE0uc2NhbGFyKCksXG4gIC8vXG4gIHN0YXRlOiBNLnNjYWxhcigpLFxuICAvL1xuICB2ZXJzaW9uOiBNLnN0cmluZygpXG59KTtcbnZhciBJQkNDb25uZWN0aW9uSURTaGFwZSA9IE0uc3RyaW5nKCk7XG52YXIgSUJDQ29ubmVjdGlvbkluZm9TaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBpZDogSUJDQ29ubmVjdGlvbklEU2hhcGUsXG4gIGNsaWVudF9pZDogTS5zdHJpbmcoKSxcbiAgc3RhdGU6IE0uc2NhbGFyKCksXG4gIC8vXG4gIGNvdW50ZXJwYXJ0eToge1xuICAgIGNsaWVudF9pZDogTS5zdHJpbmcoKSxcbiAgICBjb25uZWN0aW9uX2lkOiBJQkNDb25uZWN0aW9uSURTaGFwZVxuICB9LFxuICB0cmFuc2ZlckNoYW5uZWw6IElCQ0NoYW5uZWxJbmZvU2hhcGVcbn0pO1xudmFyIENvc21vc0Fzc2V0SW5mb1NoYXBlID0gTS5zcGxpdFJlY29yZCh7XG4gIGJhc2U6IE0uc3RyaW5nKCksXG4gIG5hbWU6IE0uc3RyaW5nKCksXG4gIGRpc3BsYXk6IE0uc3RyaW5nKCksXG4gIHN5bWJvbDogTS5zdHJpbmcoKSxcbiAgZGVub21fdW5pdHM6IE0uYXJyYXlPZihcbiAgICBNLnNwbGl0UmVjb3JkKHsgZGVub206IE0uc3RyaW5nKCksIGV4cG9uZW50OiBNLm51bWJlcigpIH0pXG4gIClcbn0pO1xudmFyIENoYWluSW5mb1JlcXVpcmVkU2hhcGUgPSB7XG4gIG5hbWVzcGFjZTogTS5zdHJpbmcoKSxcbiAgcmVmZXJlbmNlOiBNLnN0cmluZygpXG59O1xudmFyIENoYWluSW5mb09wdGlvbmFsU2hhcGUgPSB7XG4gIGNjdHBEZXN0aW5hdGlvbkRvbWFpbjogTS5udW1iZXIoKVxufTtcbnZhciBCYXNlQ2hhaW5JbmZvU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICBDaGFpbkluZm9SZXF1aXJlZFNoYXBlLFxuICBDaGFpbkluZm9PcHRpb25hbFNoYXBlXG4pO1xuaGFyZGVuKEJhc2VDaGFpbkluZm9TaGFwZSk7XG52YXIgQ29zbW9zQ2hhaW5JbmZvU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgY2hhaW5JZDogTS5zdHJpbmcoKSxcbiAgICBiZWNoMzJQcmVmaXg6IE0uc3RyaW5nKCksXG4gICAgLi4uQ2hhaW5JbmZvUmVxdWlyZWRTaGFwZVxuICB9LFxuICB7XG4gICAgY29ubmVjdGlvbnM6IE0ucmVjb3JkKCksXG4gICAgLy9cbiAgICBpY3FFbmFibGVkOiBNLmJvb2xlYW4oKSxcbiAgICBwZm1FbmFibGVkOiBNLmJvb2xlYW4oKSxcbiAgICBzdGFraW5nVG9rZW5zOiBNLmFycmF5T2YoeyBkZW5vbTogTS5zdHJpbmcoKSB9KSxcbiAgICAuLi5DaGFpbkluZm9PcHRpb25hbFNoYXBlXG4gIH1cbik7XG5oYXJkZW4oQ29zbW9zQ2hhaW5JbmZvU2hhcGUpO1xudmFyIENoYWluSW5mb1NoYXBlID0gTS5vcihDb3Ntb3NDaGFpbkluZm9TaGFwZSwgQmFzZUNoYWluSW5mb1NoYXBlKTtcbmhhcmRlbihDaGFpbkluZm9TaGFwZSk7XG52YXIgRGVub21TaGFwZSA9IE0uc3RyaW5nKCk7XG52YXIgQ29pblNoYXBlID0ge1xuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICBhbW91bnQ6IE0uc3RyaW5nKCksXG4gIGRlbm9tOiBEZW5vbVNoYXBlXG59O1xuaGFyZGVuKENvaW5TaGFwZSk7XG52YXIgRGVub21JbmZvU2hhcGUgPSB7XG4gIGNoYWluOiBNLnJlbW90YWJsZShcIkNoYWluXCIpLFxuICBiYXNlOiBNLnJlbW90YWJsZShcIkNoYWluXCIpLFxuICBicmFuZDogTS5vcihNLnJlbW90YWJsZShcIkJyYW5kXCIpLCBNLnVuZGVmaW5lZCgpKSxcbiAgYmFzZURlbm9tOiBNLnN0cmluZygpXG59O1xuaGFyZGVuKERlbm9tSW5mb1NoYXBlKTtcbnZhciBEZW5vbURldGFpbFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAgeyBjaGFpbk5hbWU6IE0uc3RyaW5nKCksIGJhc2VOYW1lOiBNLnN0cmluZygpLCBiYXNlRGVub206IE0uc3RyaW5nKCkgfSxcbiAgeyBicmFuZDogQnJhbmRTaGFwZSB9XG4pO1xuaGFyZGVuKERlbm9tRGV0YWlsU2hhcGUpO1xudmFyIERlbm9tQW1vdW50U2hhcGUgPSB7IGRlbm9tOiBEZW5vbVNoYXBlLCB2YWx1ZTogTS5uYXQoKSB9O1xuaGFyZGVuKERlbm9tQW1vdW50U2hhcGUpO1xudmFyIEFueU5hdEFtb3VudFNoYXBlID0ge1xuICBicmFuZDogTS5yZW1vdGFibGUoXCJCcmFuZFwiKSxcbiAgdmFsdWU6IE0ubmF0KClcbn07XG5oYXJkZW4oQW55TmF0QW1vdW50U2hhcGUpO1xudmFyIEFtb3VudEFyZ1NoYXBlID0gTS5vcihBbnlOYXRBbW91bnRTaGFwZSwgRGVub21BbW91bnRTaGFwZSk7XG52YXIgRGVsZWdhdGlvblNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIHZhbGlkYXRvcjogQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsXG4gICAgYW1vdW50OiBBbW91bnRBcmdTaGFwZVxuICB9LFxuICB7IGRlbGVnYXRvcjogQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUgfVxuKTtcbnZhciBJQ1FNc2dTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHsgcGF0aDogTS5zdHJpbmcoKSwgZGF0YTogTS5zdHJpbmcoKSB9LFxuICB7IGhlaWdodDogTS5zdHJpbmcoKSwgcHJvdmU6IE0uYm9vbGVhbigpIH1cbik7XG52YXIgVHlwZWRKc29uU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHsgXCJAdHlwZVwiOiBNLnN0cmluZygpIH0pO1xudmFyIGNoYWluRmFjYWRlTWV0aG9kcyA9IHtcbiAgZ2V0Q2hhaW5JbmZvOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgbWFrZUFjY291bnQ6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpXG59O1xuaGFyZGVuKGNoYWluRmFjYWRlTWV0aG9kcyk7XG52YXIgVGltZXN0YW1wUHJvdG9TaGFwZSA9IHsgc2Vjb25kczogTS5zdHJpbmcoKSwgbmFub3M6IE0ubnVtYmVyKCkgfTtcbmhhcmRlbihUaW1lc3RhbXBQcm90b1NoYXBlKTtcbnZhciBFeGVjdXRlSUNBVHhPcHRzU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7fSxcbiAge1xuICAgIG1lbW86IE0uc3RyaW5nKCksXG4gICAgdGltZW91dEhlaWdodDogTS5iaWdpbnQoKSxcbiAgICBleHRlbnNpb25PcHRpb25zOiBNLmFycmF5T2YoTS5hbnkoKSksXG4gICAgbm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zOiBNLmFycmF5T2YoTS5hbnkoKSksXG4gICAgc2VuZE9wdHM6IFNlbmRPcHRpb25zU2hhcGVcbiAgfVxuKTtcbnZhciBBbnlOYXRBbW91bnRzUmVjb3JkID0gTS5hbmQoXG4gIE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgQW55TmF0QW1vdW50U2hhcGUpLFxuICBNLm5vdCh7fSlcbik7XG52YXIgT3JjaGVzdHJhdGlvblBvd2Vyc1NoYXBlID0ge1xuICBhZ29yaWNOYW1lczogTS5yZW1vdGFibGUoKSxcbiAgbG9jYWxjaGFpbjogTS5yZW1vdGFibGUoKSxcbiAgb3JjaGVzdHJhdGlvblNlcnZpY2U6IE0ucmVtb3RhYmxlKCksXG4gIHN0b3JhZ2VOb2RlOiBNLnJlbW90YWJsZSgpLFxuICB0aW1lclNlcnZpY2U6IE0ucmVtb3RhYmxlKClcbn07XG5oYXJkZW4oT3JjaGVzdHJhdGlvblBvd2Vyc1NoYXBlKTtcbnZhciBGb3J3YXJkQXJnc1NoYXBlID0ge1xuICByZWNlaXZlcjogTS5zdHJpbmcoKSxcbiAgcG9ydDogXCJ0cmFuc2ZlclwiLFxuICBjaGFubmVsOiBNLnN0cmluZygpLFxuICB0aW1lb3V0OiBNLnN0cmluZygpLFxuICByZXRyaWVzOiBNLm51bWJlcigpXG59O1xuaGFyZGVuKEZvcndhcmRBcmdzU2hhcGUpO1xudmFyIEZvcndhcmRJbmZvU2hhcGUgPSB7XG4gIGZvcndhcmQ6IE0uc3BsaXRSZWNvcmQoRm9yd2FyZEFyZ3NTaGFwZSwge1xuICAgIC8qXG5cblxuICAgICAqL1xuICAgIG5leHQ6IHtcbiAgICAgIGZvcndhcmQ6IEZvcndhcmRBcmdzU2hhcGVcbiAgICB9XG4gIH0pXG59O1xuaGFyZGVuKEZvcndhcmRJbmZvU2hhcGUpO1xudmFyIEZvcndhcmRPcHRzU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7fSxcbiAge1xuICAgIHRpbWVvdXQ6IE0uc3RyaW5nKCksXG4gICAgcmV0cmllczogTS5udW1iZXIoKSxcbiAgICBpbnRlcm1lZGlhdGVSZWNpcGllbnQ6IENvc21vc0NoYWluQWRkcmVzc1NoYXBlXG4gIH0sXG4gIHt9XG4pO1xudmFyIElCQ1RyYW5zZmVyT3B0aW9uc1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge30sXG4gIHtcbiAgICB0aW1lb3V0VGltZXN0YW1wOiBNLmJpZ2ludCgpLFxuICAgIHRpbWVvdXRIZWlnaHQ6IHtcbiAgICAgIHJldmlzaW9uSGVpZ2h0OiBNLmJpZ2ludCgpLFxuICAgICAgcmV2aXNpb25OdW1iZXI6IE0uYmlnaW50KClcbiAgICB9LFxuICAgIHRpbWVvdXRSZWxhdGl2ZVNlY29uZHM6IE0uYmlnaW50KCksXG4gICAgbWVtbzogTS5zdHJpbmcoKSxcbiAgICBmb3J3YXJkT3B0czogRm9yd2FyZE9wdHNTaGFwZVxuICB9XG4pO1xuXG4vL1xudmFyIFR4U3RhdHVzID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgT2JzZXJ2ZWQ6IFwiT0JTRVJWRURcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEFkdmFuY2luZzogXCJBRFZBTkNJTkdcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQWR2YW5jZWQ6IFwiQURWQU5DRURcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEFkdmFuY2VGYWlsZWQ6IFwiQURWQU5DRV9GQUlMRURcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQWR2YW5jZVNraXBwZWQ6IFwiQURWQU5DRV9TS0lQUEVEXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIERpc2J1cnNlZDogXCJESVNCVVJTRURcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEZvcndhcmRlZFNraXBwZWQ6IFwiRk9SV0FSRF9TS0lQUEVEXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgRm9yd2FyZGVkOiBcIkZPUldBUkRFRFwiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBGb3J3YXJkRmFpbGVkOiBcIkZPUldBUkRfRkFJTEVEXCJcbiAgfVxuKTtcbmhhcmRlbihUeFN0YXR1cyk7XG52YXIgVGVybWluYWxUeFN0YXR1cyA9IHtcbiAgW1R4U3RhdHVzLkZvcndhcmRlZF06IHRydWUsXG4gIFtUeFN0YXR1cy5Gb3J3YXJkRmFpbGVkXTogdHJ1ZSxcbiAgW1R4U3RhdHVzLkRpc2J1cnNlZF06IHRydWVcbn07XG52YXIgUGVuZGluZ1R4U3RhdHVzID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBBZHZhbmNpbmc6IFwiQURWQU5DSU5HXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBBZHZhbmNlRmFpbGVkOiBcIkFEVkFOQ0VfRkFJTEVEXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEFkdmFuY2VkOiBcIkFEVkFOQ0VEXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEFkdmFuY2VTa2lwcGVkOiBcIkFEVkFOQ0VfU0tJUFBFRFwiXG4gIH1cbik7XG5oYXJkZW4oUGVuZGluZ1R4U3RhdHVzKTtcblxuLy9cbnZhciBtYWtlTmF0QW1vdW50U2hhcGUgPSAoYnJhbmQsIG1pbikgPT4gaGFyZGVuKHsgYnJhbmQsIHZhbHVlOiBtaW4gPyBNLmd0ZShtaW4pIDogTS5uYXQoKSB9KTtcbnZhciBtYWtlUHJvcG9zYWxTaGFwZXMgPSAoeyBQb29sU2hhcmVzLCBVU0RDIH0pID0+IHtcbiAgY29uc3QgZGVwb3NpdCA9IE0uc3BsaXRSZWNvcmQoe1xuICAgIGdpdmU6IHsgVVNEQzogbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDFuKSB9LFxuICAgIHdhbnQ6IHsgUG9vbFNoYXJlOiBtYWtlTmF0QW1vdW50U2hhcGUoUG9vbFNoYXJlcykgfVxuICB9KTtcbiAgY29uc3Qgd2l0aGRyYXcgPSBNLnNwbGl0UmVjb3JkKHtcbiAgICBnaXZlOiB7IFBvb2xTaGFyZTogbWFrZU5hdEFtb3VudFNoYXBlKFBvb2xTaGFyZXMsIDFuKSB9LFxuICAgIHdhbnQ6IHsgVVNEQzogbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDFuKSB9XG4gIH0pO1xuICBjb25zdCB3aXRoZHJhd0ZlZXMgPSBNLnNwbGl0UmVjb3JkKHtcbiAgICB3YW50OiB7IFVTREM6IG1ha2VOYXRBbW91bnRTaGFwZShVU0RDLCAxbikgfVxuICB9KTtcbiAgcmV0dXJuIGhhcmRlbih7IGRlcG9zaXQsIHdpdGhkcmF3LCB3aXRoZHJhd0ZlZXMgfSk7XG59O1xudmFyIEZhc3RVU0RDVGVybXNTaGFwZSA9IGhhcmRlbih7XG4gIHVzZGNEZW5vbTogTS5zdHJpbmcoKVxufSk7XG52YXIgRXZtQWRkcmVzc1NoYXBlID0gTS5zdHJpbmcoe1xuICAvL1xuICBzdHJpbmdMZW5ndGhMaW1pdDogNDJcbn0pO1xuaGFyZGVuKEV2bUFkZHJlc3NTaGFwZSk7XG52YXIgRXZtSGFzaFNoYXBlID0gTS5zdHJpbmcoe1xuICBzdHJpbmdMZW5ndGhMaW1pdDogNjZcbn0pO1xuaGFyZGVuKEV2bUhhc2hTaGFwZSk7XG52YXIgUmlza0Fzc2Vzc21lbnRTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHt9LFxuICB7XG4gICAgcmlza3NJZGVudGlmaWVkOiBNLmFycmF5T2YoTS5zdHJpbmcoKSlcbiAgfVxuKTtcbmhhcmRlbihSaXNrQXNzZXNzbWVudFNoYXBlKTtcbnZhciBDY3RwVHhFdmlkZW5jZVNoYXBlID0ge1xuICBhdXg6IHtcbiAgICBmb3J3YXJkaW5nQ2hhbm5lbDogTS5zdHJpbmcoKSxcbiAgICByZWNpcGllbnRBZGRyZXNzOiBNLnN0cmluZygpXG4gIH0sXG4gIGJsb2NrSGFzaDogRXZtSGFzaFNoYXBlLFxuICBibG9ja051bWJlcjogTS5uYXQoKSxcbiAgYmxvY2tUaW1lc3RhbXA6IE0ubmF0KCksXG4gIGNoYWluSWQ6IE0ubnVtYmVyKCksXG4gIHR4OiB7XG4gICAgYW1vdW50OiBNLm5hdCgpLFxuICAgIGZvcndhcmRpbmdBZGRyZXNzOiBNLnN0cmluZygpLFxuICAgIHNlbmRlcjogRXZtQWRkcmVzc1NoYXBlXG4gIH0sXG4gIHR4SGFzaDogRXZtSGFzaFNoYXBlXG59O1xuaGFyZGVuKENjdHBUeEV2aWRlbmNlU2hhcGUpO1xudmFyIEV2aWRlbmNlV2l0aFJpc2tTaGFwZSA9IHtcbiAgZXZpZGVuY2U6IENjdHBUeEV2aWRlbmNlU2hhcGUsXG4gIHJpc2s6IFJpc2tBc3Nlc3NtZW50U2hhcGVcbn07XG5oYXJkZW4oRXZpZGVuY2VXaXRoUmlza1NoYXBlKTtcbnZhciBQZW5kaW5nVHhTaGFwZSA9IHtcbiAgLi4uQ2N0cFR4RXZpZGVuY2VTaGFwZSxcbiAgc3RhdHVzOiBNLm9yKC4uLk9iamVjdC52YWx1ZXMoUGVuZGluZ1R4U3RhdHVzKSlcbn07XG5oYXJkZW4oUGVuZGluZ1R4U2hhcGUpO1xudmFyIEFkZHJlc3NIb29rU2hhcGUgPSB7XG4gIGJhc2VBZGRyZXNzOiBNLnN0cmluZygpLFxuICBxdWVyeTogeyBFVUQ6IE0uc3RyaW5nKCkgfVxufTtcbmhhcmRlbihBZGRyZXNzSG9va1NoYXBlKTtcbnZhciBOYXRBbW91bnRTaGFwZSA9IHsgYnJhbmQ6IEJyYW5kU2hhcGUsIHZhbHVlOiBNLm5hdCgpIH07XG52YXIgRGVzdGluYXRpb25PdmVycmlkZXNTaGFwZSA9IE0ucmVjb3JkT2YoXG4gIE0uc3RyaW5nKCksXG4gIE0uc3BsaXRSZWNvcmQoXG4gICAge30sXG4gICAge1xuICAgICAgZmxhdDogTmF0QW1vdW50U2hhcGUsXG4gICAgICB2YXJpYWJsZVJhdGU6IFJhdGlvU2hhcGUsXG4gICAgICBjb250cmFjdFJhdGU6IFJhdGlvU2hhcGUsXG4gICAgICByZWxheTogTmF0QW1vdW50U2hhcGVcbiAgICB9XG4gIClcbik7XG52YXIgRmVlQ29uZmlnU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgZmxhdDogTmF0QW1vdW50U2hhcGUsXG4gICAgdmFyaWFibGVSYXRlOiBSYXRpb1NoYXBlLFxuICAgIGNvbnRyYWN0UmF0ZTogUmF0aW9TaGFwZVxuICB9LFxuICB7XG4gICAgcmVsYXk6IE5hdEFtb3VudFNoYXBlLFxuICAgIGRlc3RpbmF0aW9uT3ZlcnJpZGVzOiBEZXN0aW5hdGlvbk92ZXJyaWRlc1NoYXBlXG4gIH0sXG4gIHt9XG4pO1xudmFyIFBvb2xNZXRyaWNzU2hhcGUgPSB7XG4gIGVuY3VtYmVyZWRCYWxhbmNlOiBBbW91bnRTaGFwZSxcbiAgc2hhcmVXb3J0aDogUmF0aW9TaGFwZSxcbiAgdG90YWxDb250cmFjdEZlZXM6IEFtb3VudFNoYXBlLFxuICB0b3RhbFBvb2xGZWVzOiBBbW91bnRTaGFwZSxcbiAgdG90YWxCb3Jyb3dzOiBBbW91bnRTaGFwZSxcbiAgdG90YWxSZXBheXM6IEFtb3VudFNoYXBlXG59O1xuaGFyZGVuKFBvb2xNZXRyaWNzU2hhcGUpO1xudmFyIENoYWluUG9saWN5U2hhcGUgPSB7XG4gIGF0dGVudWF0ZWRDdHRwQnJpZGdlQWRkcmVzc2VzOiBNLnNwbGl0QXJyYXkoXG4gICAgW0V2bUhhc2hTaGFwZV0sXG4gICAgdm9pZCAwLFxuICAgIE0uYXJyYXlPZihFdm1IYXNoU2hhcGUpXG4gICksXG4gIGNjdHBUb2tlbk1lc3NlbmdlckFkZHJlc3M6IEV2bUhhc2hTaGFwZSxcbiAgY29uZmlybWF0aW9uczogTS5udW1iZXIoKSxcbiAgY2hhaW5JZDogTS5udW1iZXIoKSxcbiAgcmF0ZUxpbWl0czoge1xuICAgIHR4OiBNLmJpZ2ludCgpLFxuICAgIGJsb2NrV2luZG93OiBNLmJpZ2ludCgpLFxuICAgIGJsb2NrV2luZG93U2l6ZTogTS5udW1iZXIoKVxuICB9XG59O1xuaGFyZGVuKENoYWluUG9saWN5U2hhcGUpO1xudmFyIEZlZWRQb2xpY3lTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBub2JsZURvbWFpbklkOiBNLm51bWJlcigpLFxuICAgIG5vYmxlQWdvcmljQ2hhbm5lbElkOiBNLnN0cmluZygpLFxuICAgIGNoYWluUG9saWNpZXM6IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgQ2hhaW5Qb2xpY3lTaGFwZSlcbiAgfSxcbiAgeyBldmVudEZpbHRlcjogTS5zdHJpbmcoKSB9XG4pO1xuaGFyZGVuKEZlZWRQb2xpY3lTaGFwZSk7XG52YXIgQ29zbW9zQ2hhaW5JbmZvU2hhcGVWMSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBjaGFpbklkOiBNLnN0cmluZygpXG4gIH0sXG4gIHtcbiAgICBiZWNoMzJQcmVmaXg6IE0uc3RyaW5nKCksXG4gICAgY29ubmVjdGlvbnM6IE0ucmVjb3JkKCksXG4gICAgc3Rha2luZ1Rva2VuczogTS5hcnJheU9mKHsgZGVub206IE0uc3RyaW5nKCkgfSksXG4gICAgLy9cbiAgICBpY3FFbmFibGVkOiBNLmJvb2xlYW4oKSxcbiAgICBwZm1FbmFibGVkOiBNLmJvb2xlYW4oKVxuICB9XG4pO1xudmFyIEZhc3RVU0RDQ29uZmlnU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHtcbiAgdGVybXM6IEZhc3RVU0RDVGVybXNTaGFwZSxcbiAgb3JhY2xlczogTS5yZWNvcmRPZihNLnN0cmluZygpLCBNLnN0cmluZygpKSxcbiAgZmVlQ29uZmlnOiBGZWVDb25maWdTaGFwZSxcbiAgZmVlZFBvbGljeTogRmVlZFBvbGljeVNoYXBlLFxuICBjaGFpbkluZm86IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgQ29zbW9zQ2hhaW5JbmZvU2hhcGVWMSksXG4gIGFzc2V0SW5mbzogTS5hcnJheU9mKFtEZW5vbVNoYXBlLCBEZW5vbURldGFpbFNoYXBlXSlcbn0pO1xuXG4vL1xudmFyIGltcG9ydF9lbmNvZGluZyA9IF9fdG9FU00ocmVxdWlyZV9idWlsZCgpLCAxKTtcblxuLy9cbmZ1bmN0aW9uIGJhc2UoQUxQSEFCRVQyKSB7XG4gIGlmIChBTFBIQUJFVDIubGVuZ3RoID49IDI1NSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBbHBoYWJldCB0b28gbG9uZ1wiKTtcbiAgfVxuICBjb25zdCBCQVNFX01BUCA9IG5ldyBVaW50OEFycmF5KDI1Nik7XG4gIGZvciAobGV0IGogPSAwOyBqIDwgQkFTRV9NQVAubGVuZ3RoOyBqKyspIHtcbiAgICBCQVNFX01BUFtqXSA9IDI1NTtcbiAgfVxuICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgQUxQSEFCRVQyLmxlbmd0aDsgaTIrKykge1xuICAgIGNvbnN0IHggPSBBTFBIQUJFVDIuY2hhckF0KGkyKTtcbiAgICBjb25zdCB4YyA9IHguY2hhckNvZGVBdCgwKTtcbiAgICBpZiAoQkFTRV9NQVBbeGNdICE9PSAyNTUpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoeCArIFwiIGlzIGFtYmlndW91c1wiKTtcbiAgICB9XG4gICAgQkFTRV9NQVBbeGNdID0gaTI7XG4gIH1cbiAgY29uc3QgQkFTRSA9IEFMUEhBQkVUMi5sZW5ndGg7XG4gIGNvbnN0IExFQURFUiA9IEFMUEhBQkVUMi5jaGFyQXQoMCk7XG4gIGNvbnN0IEZBQ1RPUiA9IE1hdGgubG9nKEJBU0UpIC8gTWF0aC5sb2coMjU2KTtcbiAgY29uc3QgaUZBQ1RPUiA9IE1hdGgubG9nKDI1NikgLyBNYXRoLmxvZyhCQVNFKTtcbiAgZnVuY3Rpb24gZW5jb2RlMihzb3VyY2UpIHtcbiAgICBpZiAoc291cmNlIGluc3RhbmNlb2YgVWludDhBcnJheSkge1xuICAgIH0gZWxzZSBpZiAoQXJyYXlCdWZmZXIuaXNWaWV3KHNvdXJjZSkpIHtcbiAgICAgIHNvdXJjZSA9IG5ldyBVaW50OEFycmF5KHNvdXJjZS5idWZmZXIsIHNvdXJjZS5ieXRlT2Zmc2V0LCBzb3VyY2UuYnl0ZUxlbmd0aCk7XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHNvdXJjZSkpIHtcbiAgICAgIHNvdXJjZSA9IFVpbnQ4QXJyYXkuZnJvbShzb3VyY2UpO1xuICAgIH1cbiAgICBpZiAoIShzb3VyY2UgaW5zdGFuY2VvZiBVaW50OEFycmF5KSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkV4cGVjdGVkIFVpbnQ4QXJyYXlcIik7XG4gICAgfVxuICAgIGlmIChzb3VyY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gICAgbGV0IHplcm9lczIgPSAwO1xuICAgIGxldCBsZW5ndGggPSAwO1xuICAgIGxldCBwYmVnaW4gPSAwO1xuICAgIGNvbnN0IHBlbmQgPSBzb3VyY2UubGVuZ3RoO1xuICAgIHdoaWxlIChwYmVnaW4gIT09IHBlbmQgJiYgc291cmNlW3BiZWdpbl0gPT09IDApIHtcbiAgICAgIHBiZWdpbisrO1xuICAgICAgemVyb2VzMisrO1xuICAgIH1cbiAgICBjb25zdCBzaXplID0gKHBlbmQgLSBwYmVnaW4pICogaUZBQ1RPUiArIDEgPj4+IDA7XG4gICAgY29uc3QgYjU4ID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZSk7XG4gICAgd2hpbGUgKHBiZWdpbiAhPT0gcGVuZCkge1xuICAgICAgbGV0IGNhcnJ5ID0gc291cmNlW3BiZWdpbl07XG4gICAgICBsZXQgaTIgPSAwO1xuICAgICAgZm9yIChsZXQgaXQxID0gc2l6ZSAtIDE7IChjYXJyeSAhPT0gMCB8fCBpMiA8IGxlbmd0aCkgJiYgaXQxICE9PSAtMTsgaXQxLS0sIGkyKyspIHtcbiAgICAgICAgY2FycnkgKz0gMjU2ICogYjU4W2l0MV0gPj4+IDA7XG4gICAgICAgIGI1OFtpdDFdID0gY2FycnkgJSBCQVNFID4+PiAwO1xuICAgICAgICBjYXJyeSA9IGNhcnJ5IC8gQkFTRSA+Pj4gMDtcbiAgICAgIH1cbiAgICAgIGlmIChjYXJyeSAhPT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb24temVybyBjYXJyeVwiKTtcbiAgICAgIH1cbiAgICAgIGxlbmd0aCA9IGkyO1xuICAgICAgcGJlZ2luKys7XG4gICAgfVxuICAgIGxldCBpdDIgPSBzaXplIC0gbGVuZ3RoO1xuICAgIHdoaWxlIChpdDIgIT09IHNpemUgJiYgYjU4W2l0Ml0gPT09IDApIHtcbiAgICAgIGl0MisrO1xuICAgIH1cbiAgICBsZXQgc3RyID0gTEVBREVSLnJlcGVhdCh6ZXJvZXMyKTtcbiAgICBmb3IgKDsgaXQyIDwgc2l6ZTsgKytpdDIpIHtcbiAgICAgIHN0ciArPSBBTFBIQUJFVDIuY2hhckF0KGI1OFtpdDJdKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0cjtcbiAgfVxuICBmdW5jdGlvbiBkZWNvZGVVbnNhZmUoc291cmNlKSB7XG4gICAgaWYgKHR5cGVvZiBzb3VyY2UgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJFeHBlY3RlZCBTdHJpbmdcIik7XG4gICAgfVxuICAgIGlmIChzb3VyY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoKTtcbiAgICB9XG4gICAgbGV0IHBzeiA9IDA7XG4gICAgbGV0IHplcm9lczIgPSAwO1xuICAgIGxldCBsZW5ndGggPSAwO1xuICAgIHdoaWxlIChzb3VyY2VbcHN6XSA9PT0gTEVBREVSKSB7XG4gICAgICB6ZXJvZXMyKys7XG4gICAgICBwc3orKztcbiAgICB9XG4gICAgY29uc3Qgc2l6ZSA9IChzb3VyY2UubGVuZ3RoIC0gcHN6KSAqIEZBQ1RPUiArIDEgPj4+IDA7XG4gICAgY29uc3QgYjI1NiA9IG5ldyBVaW50OEFycmF5KHNpemUpO1xuICAgIHdoaWxlIChwc3ogPCBzb3VyY2UubGVuZ3RoKSB7XG4gICAgICBjb25zdCBjaGFyQ29kZSA9IHNvdXJjZS5jaGFyQ29kZUF0KHBzeik7XG4gICAgICBpZiAoY2hhckNvZGUgPiAyNTUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbGV0IGNhcnJ5ID0gQkFTRV9NQVBbY2hhckNvZGVdO1xuICAgICAgaWYgKGNhcnJ5ID09PSAyNTUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbGV0IGkyID0gMDtcbiAgICAgIGZvciAobGV0IGl0MyA9IHNpemUgLSAxOyAoY2FycnkgIT09IDAgfHwgaTIgPCBsZW5ndGgpICYmIGl0MyAhPT0gLTE7IGl0My0tLCBpMisrKSB7XG4gICAgICAgIGNhcnJ5ICs9IEJBU0UgKiBiMjU2W2l0M10gPj4+IDA7XG4gICAgICAgIGIyNTZbaXQzXSA9IGNhcnJ5ICUgMjU2ID4+PiAwO1xuICAgICAgICBjYXJyeSA9IGNhcnJ5IC8gMjU2ID4+PiAwO1xuICAgICAgfVxuICAgICAgaWYgKGNhcnJ5ICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vbi16ZXJvIGNhcnJ5XCIpO1xuICAgICAgfVxuICAgICAgbGVuZ3RoID0gaTI7XG4gICAgICBwc3orKztcbiAgICB9XG4gICAgbGV0IGl0NCA9IHNpemUgLSBsZW5ndGg7XG4gICAgd2hpbGUgKGl0NCAhPT0gc2l6ZSAmJiBiMjU2W2l0NF0gPT09IDApIHtcbiAgICAgIGl0NCsrO1xuICAgIH1cbiAgICBjb25zdCB2Y2ggPSBuZXcgVWludDhBcnJheSh6ZXJvZXMyICsgKHNpemUgLSBpdDQpKTtcbiAgICBsZXQgaiA9IHplcm9lczI7XG4gICAgd2hpbGUgKGl0NCAhPT0gc2l6ZSkge1xuICAgICAgdmNoW2orK10gPSBiMjU2W2l0NCsrXTtcbiAgICB9XG4gICAgcmV0dXJuIHZjaDtcbiAgfVxuICBmdW5jdGlvbiBkZWNvZGUzKHN0cmluZykge1xuICAgIGNvbnN0IGJ1ZmZlciA9IGRlY29kZVVuc2FmZShzdHJpbmcpO1xuICAgIGlmIChidWZmZXIpIHtcbiAgICAgIHJldHVybiBidWZmZXI7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihcIk5vbi1iYXNlXCIgKyBCQVNFICsgXCIgY2hhcmFjdGVyXCIpO1xuICB9XG4gIHJldHVybiB7XG4gICAgZW5jb2RlOiBlbmNvZGUyLFxuICAgIGRlY29kZVVuc2FmZSxcbiAgICBkZWNvZGU6IGRlY29kZTNcbiAgfTtcbn1cbnZhciBlc21fZGVmYXVsdCA9IGJhc2U7XG5cbi8vXG52YXIgQUxQSEFCRVQgPSBcIjEyMzQ1Njc4OUFCQ0RFRkdISktMTU5QUVJTVFVWV1hZWmFiY2RlZmdoaWprbW5vcHFyc3R1dnd4eXpcIjtcbnZhciBlc21fZGVmYXVsdDIgPSBlc21fZGVmYXVsdChBTFBIQUJFVCk7XG5cbi8vXG52YXIgbWFrZUlDQUNoYW5uZWxBZGRyZXNzID0gKGhvc3RDb25uZWN0aW9uSWQsIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsIHtcbiAgdmVyc2lvbiA9IFwiaWNzMjctMVwiLFxuICBlbmNvZGluZyA9IFwicHJvdG8zXCIsXG4gIG9yZGVyaW5nID0gXCJvcmRlcmVkXCIsXG4gIHR4VHlwZSA9IFwic2RrX211bHRpX21zZ1wiXG59ID0ge30pID0+IHtcbiAgaG9zdENvbm5lY3Rpb25JZCB8fCB0aHJvd1JlZGFjdGVkYGhvc3RDb25uZWN0aW9uSWQgaXMgcmVxdWlyZWRgO1xuICBjb250cm9sbGVyQ29ubmVjdGlvbklkIHx8IHRocm93UmVkYWN0ZWRgY29udHJvbGxlckNvbm5lY3Rpb25JZCBpcyByZXF1aXJlZGA7XG4gIGNvbnN0IGNvbm5TdHJpbmcgPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgdmVyc2lvbixcbiAgICBjb250cm9sbGVyQ29ubmVjdGlvbklkLFxuICAgIGhvc3RDb25uZWN0aW9uSWQsXG4gICAgYWRkcmVzczogXCJcIixcbiAgICAvL1xuICAgIGVuY29kaW5nLFxuICAgIHR4VHlwZVxuICB9KTtcbiAgcmV0dXJuIGAvaWJjLWhvcC8ke2NvbnRyb2xsZXJDb25uZWN0aW9uSWR9L2liYy1wb3J0L2ljYWhvc3QvJHtvcmRlcmluZ30vJHtjb25uU3RyaW5nfWA7XG59O1xuaGFyZGVuKG1ha2VJQ0FDaGFubmVsQWRkcmVzcyk7XG52YXIgREVGQVVMVF9JQ1FfVkVSU0lPTiA9IFwiaWNxLTFcIjtcbnZhciBtYWtlSUNRQ2hhbm5lbEFkZHJlc3MgPSAoY29udHJvbGxlckNvbm5lY3Rpb25JZCwgdmVyc2lvbiA9IERFRkFVTFRfSUNRX1ZFUlNJT04pID0+IHtcbiAgY29udHJvbGxlckNvbm5lY3Rpb25JZCB8fCB0aHJvd1JlZGFjdGVkYGNvbnRyb2xsZXJDb25uZWN0aW9uSWQgaXMgcmVxdWlyZWRgO1xuICByZXR1cm4gYC9pYmMtaG9wLyR7Y29udHJvbGxlckNvbm5lY3Rpb25JZH0vaWJjLXBvcnQvaWNxaG9zdC91bm9yZGVyZWQvJHt2ZXJzaW9ufWA7XG59O1xuaGFyZGVuKG1ha2VJQ1FDaGFubmVsQWRkcmVzcyk7XG52YXIgZmluZEFkZHJlc3NGaWVsZCA9IChyZW1vdGVBZGRyZXNzU3RyaW5nKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QganNvblN0ciA9IHJlbW90ZUFkZHJlc3NTdHJpbmc/Lm1hdGNoKC97Lio/fS8pPy5bMF07XG4gICAgY29uc3QganNvbk9iaiA9IGpzb25TdHIgPyBKU09OLnBhcnNlKGpzb25TdHIpIDogdm9pZCAwO1xuICAgIGlmICghanNvbk9iaj8uYWRkcmVzcz8ubGVuZ3RoKSByZXR1cm4gdm9pZCAwO1xuICAgIHJldHVybiBqc29uT2JqLmFkZHJlc3M7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxufTtcbmhhcmRlbihmaW5kQWRkcmVzc0ZpZWxkKTtcbnZhciBnZXRCZWNoMzJQcmVmaXggPSAoYWRkcmVzcykgPT4ge1xuICBhc3NlcnQoYWRkcmVzcywgXCJhZGRyZXNzIGlzIHJlcXVpcmVkXCIpO1xuICBjb25zdCBzcGxpdCA9IGFkZHJlc3MubGFzdEluZGV4T2YoXCIxXCIpO1xuICBpZiAoc3BsaXQgPT09IC0xKSByZXR1cm4gdGhyb3dSZWRhY3RlZGBObyBzZXBhcmF0b3IgY2hhcmFjdGVyIGZvciAke3F1b3RlKGFkZHJlc3MpfWA7XG4gIGlmIChzcGxpdCA9PT0gMCkgcmV0dXJuIHRocm93UmVkYWN0ZWRgTWlzc2luZyBwcmVmaXggZm9yICR7cXVvdGUoYWRkcmVzcyl9YDtcbiAgcmV0dXJuIGFkZHJlc3Muc2xpY2UoMCwgc3BsaXQpO1xufTtcbnZhciBjb2VyY2VBY2NvdW50SWQgPSAoaWRBcmcpID0+IHtcbiAgaWYgKHR5cGVvZiBpZEFyZyA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiBpZEFyZztcbiAgfVxuICByZXR1cm4gYGNvc21vczoke2lkQXJnLmNoYWluSWR9OiR7aWRBcmcudmFsdWV9YDtcbn07XG5oYXJkZW4oY29lcmNlQWNjb3VudElkKTtcbnZhciBwYXJzZUFjY291bnRJZEFyZyA9IChpZEFyZykgPT4ge1xuICBpZiAodHlwZW9mIGlkQXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHBhcnNlQWNjb3VudElkKGlkQXJnKTtcbiAgfVxuICByZXR1cm4ge1xuICAgIG5hbWVzcGFjZTogXCJjb3Ntb3NcIixcbiAgICByZWZlcmVuY2U6IGlkQXJnLmNoYWluSWQsXG4gICAgYWNjb3VudEFkZHJlc3M6IGlkQXJnLnZhbHVlXG4gIH07XG59O1xuaGFyZGVuKHBhcnNlQWNjb3VudElkQXJnKTtcbnZhciBwYXJzZUFjY291bnRJZCA9IChhY2NvdW50SWQpID0+IHtcbiAgY29uc3QgcGFydHMgPSBhY2NvdW50SWQuc3BsaXQoXCI6XCIpO1xuICBwYXJ0cy5sZW5ndGggPT09IDMgfHwgdGhyb3dSZWRhY3RlZGBtYWxmb3JtZWQgQ0FJUC0xMCBhY2NvdW50SWQ6ICR7cXVvdGUoYWNjb3VudElkKX1gO1xuICBjb25zdCBbbmFtZXNwYWNlLCByZWZlcmVuY2UsIGFjY291bnRBZGRyZXNzXSA9IHBhcnRzO1xuICByZXR1cm4ge1xuICAgIG5hbWVzcGFjZSxcbiAgICByZWZlcmVuY2UsXG4gICAgYWNjb3VudEFkZHJlc3NcbiAgfTtcbn07XG5oYXJkZW4ocGFyc2VBY2NvdW50SWQpO1xudmFyIGNoYWluT2ZBY2NvdW50ID0gKGFjY291bnRJZEFyZykgPT4ge1xuICBjb25zdCB7IG5hbWVzcGFjZSwgcmVmZXJlbmNlIH0gPSBwYXJzZUFjY291bnRJZEFyZyhhY2NvdW50SWRBcmcpO1xuICByZXR1cm4gYCR7bmFtZXNwYWNlfToke3JlZmVyZW5jZX1gO1xufTtcbnZhciBsZWZ0UGFkRXRoQWRkcmVzc1RvMzJCeXRlcyA9IChyYXdBZGRyZXNzKSA9PiB7XG4gIGNvbnN0IGNsZWFuZWRBZGRyZXNzID0gcmF3QWRkcmVzcy5yZXBsYWNlKC9eMHgvLCBcIlwiKTtcbiAgY29uc3QgemVyb2VzTmVlZGVkID0gNjQgLSBjbGVhbmVkQWRkcmVzcy5sZW5ndGg7XG4gIGNvbnN0IHBhZGRlZEFkZHJlc3MgPSBcIjBcIi5yZXBlYXQoemVyb2VzTmVlZGVkKSArIGNsZWFuZWRBZGRyZXNzO1xuICByZXR1cm4gKDAsIGltcG9ydF9lbmNvZGluZy5mcm9tSGV4KShwYWRkZWRBZGRyZXNzKTtcbn07XG52YXIgc29sYW5hQWRkcmVzc1RvQ2N0cFJlY2lwaWVudCA9IChzb2xhbmFBZGRyZXNzKSA9PiBlc21fZGVmYXVsdDIuZGVjb2RlKHNvbGFuYUFkZHJlc3MpO1xudmFyIGFjY291bnRJZFRvMzJCeXRlcyA9IChhY2NvdW50SWQpID0+IHtcbiAgY29uc3QgeyBuYW1lc3BhY2UsIGFjY291bnRBZGRyZXNzIH0gPSBwYXJzZUFjY291bnRJZChhY2NvdW50SWQpO1xuICBzd2l0Y2ggKG5hbWVzcGFjZSkge1xuICAgIGNhc2UgXCJlaXAxNTVcIjpcbiAgICAgIHJldHVybiBsZWZ0UGFkRXRoQWRkcmVzc1RvMzJCeXRlcyhhY2NvdW50QWRkcmVzcyk7XG4gICAgY2FzZSBcInNvbGFuYVwiOlxuICAgICAgcmV0dXJuIHNvbGFuYUFkZHJlc3NUb0NjdHBSZWNpcGllbnQoYWNjb3VudEFkZHJlc3MpO1xuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYG5hbWVzcGFjZSAke25hbWVzcGFjZX0gbm90IHN1cHBvcnRlZGApO1xuICB9XG59O1xuXG4vL1xuZnVuY3Rpb24gdXRmOExlbmd0aCh0NSkge1xuICBsZXQgcjUgPSAwLCBlMiA9IDA7XG4gIGZvciAobGV0IG8yID0gMDsgbzIgPCB0NS5sZW5ndGg7ICsrbzIpIGUyID0gdDUuY2hhckNvZGVBdChvMiksIGUyIDwgMTI4ID8gcjUgKz0gMSA6IGUyIDwgMjA0OCA/IHI1ICs9IDIgOiA1NTI5NiA9PSAoNjQ1MTIgJiBlMikgJiYgNTYzMjAgPT0gKDY0NTEyICYgdDUuY2hhckNvZGVBdChvMiArIDEpKSA/ICgrK28yLCByNSArPSA0KSA6IHI1ICs9IDM7XG4gIHJldHVybiByNTtcbn1cbmZ1bmN0aW9uIHV0ZjhSZWFkKHQ1LCByNSwgZTIpIHtcbiAgaWYgKGUyIC0gcjUgPCAxKSByZXR1cm4gXCJcIjtcbiAgY29uc3QgbzIgPSBbXTtcbiAgbGV0IG4yLCBmMiA9IFtdLCBoID0gMDtcbiAgZm9yICg7IHI1IDwgZTI7ICkgbjIgPSB0NVtyNSsrXSwgbjIgPCAxMjggPyBvMltoKytdID0gbjIgOiBuMiA+IDE5MSAmJiBuMiA8IDIyNCA/IG8yW2grK10gPSAoMzEgJiBuMikgPDwgNiB8IDYzICYgdDVbcjUrK10gOiBuMiA+IDIzOSAmJiBuMiA8IDM2NSA/IChuMiA9ICgoNyAmIG4yKSA8PCAxOCB8ICg2MyAmIHQ1W3I1KytdKSA8PCAxMiB8ICg2MyAmIHQ1W3I1KytdKSA8PCA2IHwgNjMgJiB0NVtyNSsrXSkgLSA2NTUzNiwgbzJbaCsrXSA9IDU1Mjk2ICsgKG4yID4+IDEwKSwgbzJbaCsrXSA9IDU2MzIwICsgKDEwMjMgJiBuMikpIDogbzJbaCsrXSA9ICgxNSAmIG4yKSA8PCAxMiB8ICg2MyAmIHQ1W3I1KytdKSA8PCA2IHwgNjMgJiB0NVtyNSsrXSwgaCA+IDgxOTEgJiYgKChmMiB8fCAoZjIgPSBbXSkpLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSguLi5vMikpLCBoID0gMCk7XG4gIHJldHVybiBmMiA/IChoICYmIGYyLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSguLi5vMi5zbGljZSgwLCBoKSkpLCBmMi5qb2luKFwiXCIpKSA6IFN0cmluZy5mcm9tQ2hhckNvZGUoLi4ubzIuc2xpY2UoMCwgaCkpO1xufVxuZnVuY3Rpb24gdXRmOFdyaXRlKHQ1LCByNSwgZTIpIHtcbiAgY29uc3QgbzIgPSBlMjtcbiAgbGV0IG4yLCBmMjtcbiAgZm9yIChsZXQgbzMgPSAwOyBvMyA8IHQ1Lmxlbmd0aDsgKytvMykgbjIgPSB0NS5jaGFyQ29kZUF0KG8zKSwgbjIgPCAxMjggPyByNVtlMisrXSA9IG4yIDogbjIgPCAyMDQ4ID8gKHI1W2UyKytdID0gbjIgPj4gNiB8IDE5MiwgcjVbZTIrK10gPSA2MyAmIG4yIHwgMTI4KSA6IDU1Mjk2ID09ICg2NDUxMiAmIG4yKSAmJiA1NjMyMCA9PSAoNjQ1MTIgJiAoZjIgPSB0NS5jaGFyQ29kZUF0KG8zICsgMSkpKSA/IChuMiA9IDY1NTM2ICsgKCgxMDIzICYgbjIpIDw8IDEwKSArICgxMDIzICYgZjIpLCArK28zLCByNVtlMisrXSA9IG4yID4+IDE4IHwgMjQwLCByNVtlMisrXSA9IG4yID4+IDEyICYgNjMgfCAxMjgsIHI1W2UyKytdID0gbjIgPj4gNiAmIDYzIHwgMTI4LCByNVtlMisrXSA9IDYzICYgbjIgfCAxMjgpIDogKHI1W2UyKytdID0gbjIgPj4gMTIgfCAyMjQsIHI1W2UyKytdID0gbjIgPj4gNiAmIDYzIHwgMTI4LCByNVtlMisrXSA9IDYzICYgbjIgfCAxMjgpO1xuICByZXR1cm4gZTIgLSBvMjtcbn1cblxuLy9cbmZ1bmN0aW9uIHZhcmludDY0cmVhZCgpIHtcbiAgbGV0IHQ1ID0gMCwgcjUgPSAwO1xuICBmb3IgKGxldCBuMyA9IDA7IG4zIDwgMjg7IG4zICs9IDcpIHtcbiAgICBsZXQgbzIgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgICBpZiAodDUgfD0gKDEyNyAmIG8yKSA8PCBuMywgISgxMjggJiBvMikpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCBbdDUsIHI1XTtcbiAgfVxuICBsZXQgbjIgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgaWYgKHQ1IHw9ICgxNSAmIG4yKSA8PCAyOCwgcjUgPSAoMTEyICYgbjIpID4+IDQsICEoMTI4ICYgbjIpKSByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgW3Q1LCByNV07XG4gIGZvciAobGV0IG4zID0gMzsgbjMgPD0gMzE7IG4zICs9IDcpIHtcbiAgICBsZXQgbzIgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgICBpZiAocjUgfD0gKDEyNyAmIG8yKSA8PCBuMywgISgxMjggJiBvMikpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCBbdDUsIHI1XTtcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoXCJpbnZhbGlkIHZhcmludFwiKTtcbn1cbnZhciB0ID0gNDI5NDk2NzI5NjtcbmZ1bmN0aW9uIGludDY0RnJvbVN0cmluZyhvMikge1xuICBjb25zdCBpMiA9IFwiLVwiID09PSBvMlswXTtcbiAgaTIgJiYgKG8yID0gbzIuc2xpY2UoMSkpO1xuICBjb25zdCBlMiA9IDFlNjtcbiAgbGV0IHMzID0gMCwgdTIgPSAwO1xuICBmdW5jdGlvbiBmMihyNSwgbjIpIHtcbiAgICBjb25zdCBpMyA9IE51bWJlcihvMi5zbGljZShyNSwgbjIpKTtcbiAgICB1MiAqPSBlMiwgczMgPSBzMyAqIGUyICsgaTMsIHMzID49IHQgJiYgKHUyICs9IHMzIC8gdCB8IDAsIHMzICU9IHQpO1xuICB9XG4gIHJldHVybiBmMigtMjQsIC0xOCksIGYyKC0xOCwgLTEyKSwgZjIoLTEyLCAtNiksIGYyKC02KSwgaTIgPyBuKHMzLCB1MikgOiByKHMzLCB1Mik7XG59XG5mdW5jdGlvbiBpbnQ2NFRvU3RyaW5nKHQ1LCBvMikge1xuICBsZXQgaTIgPSByKHQ1LCBvMik7XG4gIGNvbnN0IGUyID0gMjE0NzQ4MzY0OCAmIGkyLmhpO1xuICBlMiAmJiAoaTIgPSBuKGkyLmxvLCBpMi5oaSkpO1xuICBjb25zdCBzMyA9IHVJbnQ2NFRvU3RyaW5nKGkyLmxvLCBpMi5oaSk7XG4gIHJldHVybiBlMiA/IFwiLVwiICsgczMgOiBzMztcbn1cbmZ1bmN0aW9uIHVJbnQ2NFRvU3RyaW5nKHI1LCBuMikge1xuICBpZiAoeyBsbzogcjUsIGhpOiBuMiB9ID0gZnVuY3Rpb24odDUsIHI2KSB7XG4gICAgcmV0dXJuIHsgbG86IHQ1ID4+PiAwLCBoaTogcjYgPj4+IDAgfTtcbiAgfShyNSwgbjIpLCBuMiA8PSAyMDk3MTUxKSByZXR1cm4gU3RyaW5nKHQgKiBuMiArIHI1KTtcbiAgY29uc3QgaTIgPSAxNjc3NzIxNSAmIChyNSA+Pj4gMjQgfCBuMiA8PCA4KSwgZTIgPSBuMiA+PiAxNiAmIDY1NTM1O1xuICBsZXQgczMgPSAoMTY3NzcyMTUgJiByNSkgKyA2Nzc3MjE2ICogaTIgKyA2NzEwNjU2ICogZTIsIHUyID0gaTIgKyA4MTQ3NDk3ICogZTIsIGYyID0gMiAqIGUyO1xuICBjb25zdCBoID0gMWU3O1xuICByZXR1cm4gczMgPj0gaCAmJiAodTIgKz0gTWF0aC5mbG9vcihzMyAvIGgpLCBzMyAlPSBoKSwgdTIgPj0gaCAmJiAoZjIgKz0gTWF0aC5mbG9vcih1MiAvIGgpLCB1MiAlPSBoKSwgZjIudG9TdHJpbmcoKSArIG8odTIpICsgbyhzMyk7XG59XG5mdW5jdGlvbiByKHQ1LCByNSkge1xuICByZXR1cm4geyBsbzogMCB8IHQ1LCBoaTogMCB8IHI1IH07XG59XG5mdW5jdGlvbiBuKHQ1LCBuMikge1xuICByZXR1cm4gbjIgPSB+bjIsIHQ1ID8gdDUgPSAxICsgfnQ1IDogbjIgKz0gMSwgcih0NSwgbjIpO1xufVxudmFyIG8gPSAodDUpID0+IHtcbiAgY29uc3QgcjUgPSBTdHJpbmcodDUpO1xuICByZXR1cm4gXCIwMDAwMDAwXCIuc2xpY2UocjUubGVuZ3RoKSArIHI1O1xufTtcbmZ1bmN0aW9uIHZhcmludDMycmVhZCgpIHtcbiAgbGV0IHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI1ID0gMTI3ICYgdDU7XG4gIGlmICghKDEyOCAmIHQ1KSkgcmV0dXJuIHRoaXMuYXNzZXJ0Qm91bmRzKCksIHI1O1xuICBpZiAodDUgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXSwgcjUgfD0gKDEyNyAmIHQ1KSA8PCA3LCAhKDEyOCAmIHQ1KSkgcmV0dXJuIHRoaXMuYXNzZXJ0Qm91bmRzKCksIHI1O1xuICBpZiAodDUgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXSwgcjUgfD0gKDEyNyAmIHQ1KSA8PCAxNCwgISgxMjggJiB0NSkpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCByNTtcbiAgaWYgKHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI1IHw9ICgxMjcgJiB0NSkgPDwgMjEsICEoMTI4ICYgdDUpKSByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgcjU7XG4gIHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI1IHw9ICgxNSAmIHQ1KSA8PCAyODtcbiAgZm9yIChsZXQgcjYgPSA1OyAxMjggJiB0NSAmJiByNiA8IDEwOyByNisrKSB0NSA9IHRoaXMuYnVmW3RoaXMucG9zKytdO1xuICBpZiAoMTI4ICYgdDUpIHRocm93IG5ldyBFcnJvcihcImludmFsaWQgdmFyaW50XCIpO1xuICByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgcjUgPj4+IDA7XG59XG5mdW5jdGlvbiB6ekVuY29kZSh0NSwgcjUpIHtcbiAgbGV0IG4yID0gcjUgPj4gMzE7XG4gIHJldHVybiByNSA9ICgocjUgPDwgMSB8IHQ1ID4+PiAzMSkgXiBuMikgPj4+IDAsIFt0NSA9ICh0NSA8PCAxIF4gbjIpID4+PiAwLCByNV07XG59XG5mdW5jdGlvbiB6ekRlY29kZSh0NSwgcjUpIHtcbiAgbGV0IG4yID0gLSgxICYgdDUpO1xuICByZXR1cm4gW3Q1ID0gKCh0NSA+Pj4gMSB8IHI1IDw8IDMxKSBeIG4yKSA+Pj4gMCwgcjUgPSAocjUgPj4+IDEgXiBuMikgPj4+IDBdO1xufVxuZnVuY3Rpb24gcmVhZFVJbnQzMih0NSwgcjUpIHtcbiAgcmV0dXJuICh0NVtyNV0gfCB0NVtyNSArIDFdIDw8IDggfCB0NVtyNSArIDJdIDw8IDE2KSArIDE2Nzc3MjE2ICogdDVbcjUgKyAzXTtcbn1cbmZ1bmN0aW9uIHJlYWRJbnQzMih0NSwgcjUpIHtcbiAgcmV0dXJuICh0NVtyNV0gfCB0NVtyNSArIDFdIDw8IDggfCB0NVtyNSArIDJdIDw8IDE2KSArICh0NVtyNSArIDNdIDw8IDI0KTtcbn1cbmZ1bmN0aW9uIHdyaXRlVmFyaW50MzIodDUsIHI1LCBuMikge1xuICBmb3IgKDsgdDUgPiAxMjc7ICkgcjVbbjIrK10gPSAxMjcgJiB0NSB8IDEyOCwgdDUgPj4+PSA3O1xuICByNVtuMl0gPSB0NTtcbn1cbmZ1bmN0aW9uIHdyaXRlVmFyaW50NjQodDUsIHI1LCBuMikge1xuICBmb3IgKDsgdDUuaGk7ICkgcjVbbjIrK10gPSAxMjcgJiB0NS5sbyB8IDEyOCwgdDUubG8gPSAodDUubG8gPj4+IDcgfCB0NS5oaSA8PCAyNSkgPj4+IDAsIHQ1LmhpID4+Pj0gNztcbiAgZm9yICg7IHQ1LmxvID4gMTI3OyApIHI1W24yKytdID0gMTI3ICYgdDUubG8gfCAxMjgsIHQ1LmxvID0gdDUubG8gPj4+IDc7XG4gIHI1W24yKytdID0gdDUubG87XG59XG5mdW5jdGlvbiBpbnQ2NExlbmd0aCh0NSwgcjUpIHtcbiAgbGV0IG4yID0gKHQ1ID4+PiAyOCB8IHI1IDw8IDQpID4+PiAwLCBvMiA9IHI1ID4+PiAyNDtcbiAgcmV0dXJuIDAgPT09IG8yID8gMCA9PT0gbjIgPyB0NSA8IDE2Mzg0ID8gdDUgPCAxMjggPyAxIDogMiA6IHQ1IDwgMjA5NzE1MiA/IDMgOiA0IDogbjIgPCAxNjM4NCA/IG4yIDwgMTI4ID8gNSA6IDYgOiBuMiA8IDIwOTcxNTIgPyA3IDogOCA6IG8yIDwgMTI4ID8gOSA6IDEwO1xufVxuZnVuY3Rpb24gd3JpdGVGaXhlZDMyKHQ1LCByNSwgbjIpIHtcbiAgcjVbbjJdID0gMjU1ICYgdDUsIHI1W24yICsgMV0gPSB0NSA+Pj4gOCAmIDI1NSwgcjVbbjIgKyAyXSA9IHQ1ID4+PiAxNiAmIDI1NSwgcjVbbjIgKyAzXSA9IHQ1ID4+PiAyNDtcbn1cbmZ1bmN0aW9uIHdyaXRlQnl0ZSh0NSwgcjUsIG4yKSB7XG4gIHI1W24yXSA9IDI1NSAmIHQ1O1xufVxuXG4vL1xudmFyIFdpcmVUeXBlO1xuIWZ1bmN0aW9uKHQ1KSB7XG4gIHQ1W3Q1LlZhcmludCA9IDBdID0gXCJWYXJpbnRcIiwgdDVbdDUuRml4ZWQ2NCA9IDFdID0gXCJGaXhlZDY0XCIsIHQ1W3Q1LkJ5dGVzID0gMl0gPSBcIkJ5dGVzXCIsIHQ1W3Q1LkZpeGVkMzIgPSA1XSA9IFwiRml4ZWQzMlwiO1xufShXaXJlVHlwZSB8fCAoV2lyZVR5cGUgPSB7fSkpO1xudmFyIEJpbmFyeVJlYWRlciA9IGNsYXNzIHtcbiAgYnVmO1xuICBwb3M7XG4gIHR5cGU7XG4gIGxlbjtcbiAgYXNzZXJ0Qm91bmRzKCkge1xuICAgIGlmICh0aGlzLnBvcyA+IHRoaXMubGVuKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcInByZW1hdHVyZSBFT0ZcIik7XG4gIH1cbiAgY29uc3RydWN0b3IodDUpIHtcbiAgICB0aGlzLmJ1ZiA9IHQ1ID8gbmV3IFVpbnQ4QXJyYXkodDUpIDogbmV3IFVpbnQ4QXJyYXkoMCksIHRoaXMucG9zID0gMCwgdGhpcy50eXBlID0gMCwgdGhpcy5sZW4gPSB0aGlzLmJ1Zi5sZW5ndGg7XG4gIH1cbiAgdGFnKCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy51aW50MzIoKSwgaTIgPSB0NSA+Pj4gMywgczMgPSA3ICYgdDU7XG4gICAgaWYgKGkyIDw9IDAgfHwgczMgPCAwIHx8IHMzID4gNSkgdGhyb3cgbmV3IEVycm9yKFwiaWxsZWdhbCB0YWc6IGZpZWxkIG5vIFwiICsgaTIgKyBcIiB3aXJlIHR5cGUgXCIgKyBzMyk7XG4gICAgcmV0dXJuIFtpMiwgczMsIHQ1XTtcbiAgfVxuICBza2lwKHQ1KSB7XG4gICAgaWYgKFwibnVtYmVyXCIgPT0gdHlwZW9mIHQ1KSB7XG4gICAgICBpZiAodGhpcy5wb3MgKyB0NSA+IHRoaXMubGVuKSB0aHJvdyBCKHRoaXMsIHQ1KTtcbiAgICAgIHRoaXMucG9zICs9IHQ1O1xuICAgIH0gZWxzZSBkbyB7XG4gICAgICBpZiAodGhpcy5wb3MgPj0gdGhpcy5sZW4pIHRocm93IEIodGhpcyk7XG4gICAgfSB3aGlsZSAoMTI4ICYgdGhpcy5idWZbdGhpcy5wb3MrK10pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHNraXBUeXBlKHQ1KSB7XG4gICAgc3dpdGNoICh0NSkge1xuICAgICAgY2FzZSBXaXJlVHlwZS5WYXJpbnQ6XG4gICAgICAgIHRoaXMuc2tpcCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgV2lyZVR5cGUuRml4ZWQ2NDpcbiAgICAgICAgdGhpcy5za2lwKDgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgV2lyZVR5cGUuQnl0ZXM6XG4gICAgICAgIHRoaXMuc2tpcCh0aGlzLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGZvciAoOyA0ICE9ICh0NSA9IDcgJiB0aGlzLnVpbnQzMigpKTsgKSB0aGlzLnNraXBUeXBlKHQ1KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFdpcmVUeXBlLkZpeGVkMzI6XG4gICAgICAgIHRoaXMuc2tpcCg0KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBFcnJvcihcImludmFsaWQgd2lyZSB0eXBlIFwiICsgdDUgKyBcIiBhdCBvZmZzZXQgXCIgKyB0aGlzLnBvcyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHVpbnQzMigpIHtcbiAgICByZXR1cm4gdmFyaW50MzJyZWFkLmJpbmQodGhpcykoKTtcbiAgfVxuICBpbnQzMigpIHtcbiAgICByZXR1cm4gMCB8IHRoaXMudWludDMyKCk7XG4gIH1cbiAgc2ludDMyKCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy51aW50MzIoKTtcbiAgICByZXR1cm4gdDUgJSAyID09IDEgPyAodDUgKyAxKSAvIC0yIDogdDUgLyAyO1xuICB9XG4gIGZpeGVkMzIoKSB7XG4gICAgY29uc3QgdDUgPSByZWFkVUludDMyKHRoaXMuYnVmLCB0aGlzLnBvcyk7XG4gICAgcmV0dXJuIHRoaXMucG9zICs9IDQsIHQ1O1xuICB9XG4gIHNmaXhlZDMyKCkge1xuICAgIGNvbnN0IHQ1ID0gcmVhZEludDMyKHRoaXMuYnVmLCB0aGlzLnBvcyk7XG4gICAgcmV0dXJuIHRoaXMucG9zICs9IDQsIHQ1O1xuICB9XG4gIGludDY0KCkge1xuICAgIGNvbnN0IFt0NSwgaTJdID0gdmFyaW50NjRyZWFkLmJpbmQodGhpcykoKTtcbiAgICByZXR1cm4gQmlnSW50KGludDY0VG9TdHJpbmcodDUsIGkyKSk7XG4gIH1cbiAgdWludDY0KCkge1xuICAgIGNvbnN0IFt0NSwgaTJdID0gdmFyaW50NjRyZWFkLmJpbmQodGhpcykoKTtcbiAgICByZXR1cm4gQmlnSW50KHVJbnQ2NFRvU3RyaW5nKHQ1LCBpMikpO1xuICB9XG4gIHNpbnQ2NCgpIHtcbiAgICBsZXQgW3Q1LCBpMl0gPSB2YXJpbnQ2NHJlYWQuYmluZCh0aGlzKSgpO1xuICAgIHJldHVybiBbdDUsIGkyXSA9IHp6RGVjb2RlKHQ1LCBpMiksIEJpZ0ludChpbnQ2NFRvU3RyaW5nKHQ1LCBpMikpO1xuICB9XG4gIGZpeGVkNjQoKSB7XG4gICAgY29uc3QgdDUgPSB0aGlzLnNmaXhlZDMyKCksIGkyID0gdGhpcy5zZml4ZWQzMigpO1xuICAgIHJldHVybiBCaWdJbnQodUludDY0VG9TdHJpbmcodDUsIGkyKSk7XG4gIH1cbiAgc2ZpeGVkNjQoKSB7XG4gICAgY29uc3QgdDUgPSB0aGlzLnNmaXhlZDMyKCksIGkyID0gdGhpcy5zZml4ZWQzMigpO1xuICAgIHJldHVybiBCaWdJbnQoaW50NjRUb1N0cmluZyh0NSwgaTIpKTtcbiAgfVxuICBmbG9hdCgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJmbG9hdCBub3Qgc3VwcG9ydGVkXCIpO1xuICB9XG4gIGRvdWJsZSgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJkb3VibGUgbm90IHN1cHBvcnRlZFwiKTtcbiAgfVxuICBib29sKCkge1xuICAgIGNvbnN0IFt0NSwgaTJdID0gdmFyaW50NjRyZWFkLmJpbmQodGhpcykoKTtcbiAgICByZXR1cm4gMCAhPT0gdDUgfHwgMCAhPT0gaTI7XG4gIH1cbiAgYnl0ZXMoKSB7XG4gICAgY29uc3QgdDUgPSB0aGlzLnVpbnQzMigpLCBpMiA9IHRoaXMucG9zO1xuICAgIHJldHVybiB0aGlzLnBvcyArPSB0NSwgdGhpcy5hc3NlcnRCb3VuZHMoKSwgdGhpcy5idWYuc3ViYXJyYXkoaTIsIGkyICsgdDUpO1xuICB9XG4gIHN0cmluZygpIHtcbiAgICBjb25zdCB0NSA9IHRoaXMuYnl0ZXMoKTtcbiAgICByZXR1cm4gdXRmOFJlYWQodDUsIDAsIHQ1Lmxlbmd0aCk7XG4gIH1cbn07XG52YXIgdyA9IGNsYXNzIHtcbiAgZm47XG4gIGxlbjtcbiAgdmFsO1xuICBuZXh0O1xuICBjb25zdHJ1Y3Rvcih0NSwgaTIsIHMzKSB7XG4gICAgdGhpcy5mbiA9IHQ1LCB0aGlzLmxlbiA9IGkyLCB0aGlzLnZhbCA9IHMzO1xuICB9XG4gIHByb2NlZWQodDUsIGkyKSB7XG4gICAgdGhpcy5mbiAmJiB0aGlzLmZuKHRoaXMudmFsLCB0NSwgaTIpO1xuICB9XG59O1xudmFyIGIgPSBjbGFzcyB7XG4gIGhlYWQ7XG4gIHRhaWw7XG4gIGxlbjtcbiAgbmV4dDtcbiAgY29uc3RydWN0b3IodDUpIHtcbiAgICB0aGlzLmhlYWQgPSB0NS5oZWFkLCB0aGlzLnRhaWwgPSB0NS50YWlsLCB0aGlzLmxlbiA9IHQ1LmxlbiwgdGhpcy5uZXh0ID0gdDUuc3RhdGVzO1xuICB9XG59O1xudmFyIEJpbmFyeVdyaXRlciA9IGNsYXNzIF9CaW5hcnlXcml0ZXIge1xuICBsZW4gPSAwO1xuICBoZWFkO1xuICB0YWlsO1xuICBzdGF0ZXM7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaGVhZCA9IG5ldyB3KG51bGwsIDAsIDApLCB0aGlzLnRhaWwgPSB0aGlzLmhlYWQsIHRoaXMuc3RhdGVzID0gbnVsbDtcbiAgfVxuICBzdGF0aWMgY3JlYXRlKCkge1xuICAgIHJldHVybiBuZXcgX0JpbmFyeVdyaXRlcigpO1xuICB9XG4gIHN0YXRpYyBhbGxvYyh0NSkge1xuICAgIHJldHVybiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBVaW50OEFycmF5ID8gZnVuY3Rpb24odDYsIGkyLCBzMykge1xuICAgICAgY29uc3QgZTIgPSBzMyB8fCA4MTkyLCBuMiA9IGUyID4+PiAxO1xuICAgICAgbGV0IHI1ID0gbnVsbCwgaCA9IGUyO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKHM0KSB7XG4gICAgICAgIGlmIChzNCA8IDEgfHwgczQgPiBuMikgcmV0dXJuIHQ2KHM0KTtcbiAgICAgICAgaCArIHM0ID4gZTIgJiYgKHI1ID0gdDYoZTIpLCBoID0gMCk7XG4gICAgICAgIGNvbnN0IG8yID0gaTIuY2FsbChyNSwgaCwgaCArPSBzNCk7XG4gICAgICAgIHJldHVybiA3ICYgaCAmJiAoaCA9IDEgKyAoNyB8IGgpKSwgbzI7XG4gICAgICB9O1xuICAgIH0oKHQ2KSA9PiBuZXcgVWludDhBcnJheSh0NiksIFVpbnQ4QXJyYXkucHJvdG90eXBlLnN1YmFycmF5KSh0NSkgOiBuZXcgQXJyYXkodDUpO1xuICB9XG4gIF9wdXNoKHQ1LCBpMiwgczMpIHtcbiAgICByZXR1cm4gdGhpcy50YWlsID0gdGhpcy50YWlsLm5leHQgPSBuZXcgdyh0NSwgaTIsIHMzKSwgdGhpcy5sZW4gKz0gaTIsIHRoaXM7XG4gIH1cbiAgZmluaXNoKCkge1xuICAgIGxldCB0NSA9IHRoaXMuaGVhZC5uZXh0LCBpMiA9IDA7XG4gICAgY29uc3QgczMgPSBfQmluYXJ5V3JpdGVyLmFsbG9jKHRoaXMubGVuKTtcbiAgICBmb3IgKDsgdDU7ICkgdDUucHJvY2VlZChzMywgaTIpLCBpMiArPSB0NS5sZW4sIHQ1ID0gdDUubmV4dDtcbiAgICByZXR1cm4gczM7XG4gIH1cbiAgZm9yaygpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZXMgPSBuZXcgYih0aGlzKSwgdGhpcy5oZWFkID0gdGhpcy50YWlsID0gbmV3IHcobnVsbCwgMCwgMCksIHRoaXMubGVuID0gMCwgdGhpcztcbiAgfVxuICByZXNldCgpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZXMgPyAodGhpcy5oZWFkID0gdGhpcy5zdGF0ZXMuaGVhZCwgdGhpcy50YWlsID0gdGhpcy5zdGF0ZXMudGFpbCwgdGhpcy5sZW4gPSB0aGlzLnN0YXRlcy5sZW4sIHRoaXMuc3RhdGVzID0gdGhpcy5zdGF0ZXMubmV4dCkgOiAodGhpcy5oZWFkID0gdGhpcy50YWlsID0gbmV3IHcobnVsbCwgMCwgMCksIHRoaXMubGVuID0gMCksIHRoaXM7XG4gIH1cbiAgbGRlbGltKCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy5oZWFkLCBpMiA9IHRoaXMudGFpbCwgczMgPSB0aGlzLmxlbjtcbiAgICByZXR1cm4gdGhpcy5yZXNldCgpLnVpbnQzMihzMyksIHMzICYmICh0aGlzLnRhaWwubmV4dCA9IHQ1Lm5leHQsIHRoaXMudGFpbCA9IGkyLCB0aGlzLmxlbiArPSBzMyksIHRoaXM7XG4gIH1cbiAgdGFnKHQ1LCBpMikge1xuICAgIHJldHVybiB0aGlzLnVpbnQzMigodDUgPDwgMyB8IGkyKSA+Pj4gMCk7XG4gIH1cbiAgdWludDMyKHQ1KSB7XG4gICAgcmV0dXJuIHRoaXMubGVuICs9ICh0aGlzLnRhaWwgPSB0aGlzLnRhaWwubmV4dCA9IG5ldyB3KHdyaXRlVmFyaW50MzIsICh0NSA+Pj49IDApIDwgMTI4ID8gMSA6IHQ1IDwgMTYzODQgPyAyIDogdDUgPCAyMDk3MTUyID8gMyA6IHQ1IDwgMjY4NDM1NDU2ID8gNCA6IDUsIHQ1KSkubGVuLCB0aGlzO1xuICB9XG4gIGludDMyKHQ1KSB7XG4gICAgcmV0dXJuIHQ1IDwgMCA/IHRoaXMuX3B1c2god3JpdGVWYXJpbnQ2NCwgMTAsIGludDY0RnJvbVN0cmluZyh0NS50b1N0cmluZygpKSkgOiB0aGlzLnVpbnQzMih0NSk7XG4gIH1cbiAgc2ludDMyKHQ1KSB7XG4gICAgcmV0dXJuIHRoaXMudWludDMyKCh0NSA8PCAxIF4gdDUgPj4gMzEpID4+PiAwKTtcbiAgfVxuICBpbnQ2NCh0NSkge1xuICAgIGNvbnN0IHsgbG86IGkyLCBoaTogczMgfSA9IGludDY0RnJvbVN0cmluZyh0NS50b1N0cmluZygpKTtcbiAgICByZXR1cm4gdGhpcy5fcHVzaCh3cml0ZVZhcmludDY0LCBpbnQ2NExlbmd0aChpMiwgczMpLCB7IGxvOiBpMiwgaGk6IHMzIH0pO1xuICB9XG4gIHVpbnQ2NCA9IF9CaW5hcnlXcml0ZXIucHJvdG90eXBlLmludDY0O1xuICBzaW50NjQodDUpIHtcbiAgICBsZXQgeyBsbzogaTIsIGhpOiBzMyB9ID0gaW50NjRGcm9tU3RyaW5nKHQ1LnRvU3RyaW5nKCkpO1xuICAgIHJldHVybiBbaTIsIHMzXSA9IHp6RW5jb2RlKGkyLCBzMyksIHRoaXMuX3B1c2god3JpdGVWYXJpbnQ2NCwgaW50NjRMZW5ndGgoaTIsIHMzKSwgeyBsbzogaTIsIGhpOiBzMyB9KTtcbiAgfVxuICBmaXhlZDY0KHQ1KSB7XG4gICAgY29uc3QgeyBsbzogaTIsIGhpOiBzMyB9ID0gaW50NjRGcm9tU3RyaW5nKHQ1LnRvU3RyaW5nKCkpO1xuICAgIHJldHVybiB0aGlzLl9wdXNoKHdyaXRlRml4ZWQzMiwgNCwgaTIpLl9wdXNoKHdyaXRlRml4ZWQzMiwgNCwgczMpO1xuICB9XG4gIHNmaXhlZDY0ID0gX0JpbmFyeVdyaXRlci5wcm90b3R5cGUuZml4ZWQ2NDtcbiAgYm9vbCh0NSkge1xuICAgIHJldHVybiB0aGlzLl9wdXNoKHdyaXRlQnl0ZSwgMSwgdDUgPyAxIDogMCk7XG4gIH1cbiAgZml4ZWQzMih0NSkge1xuICAgIHJldHVybiB0aGlzLl9wdXNoKHdyaXRlRml4ZWQzMiwgNCwgdDUgPj4+IDApO1xuICB9XG4gIHNmaXhlZDMyID0gX0JpbmFyeVdyaXRlci5wcm90b3R5cGUuZml4ZWQzMjtcbiAgZmxvYXQodDUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJmbG9hdCBub3Qgc3VwcG9ydGVkXCIgKyB0NSk7XG4gIH1cbiAgZG91YmxlKHQ1KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiZG91YmxlIG5vdCBzdXBwb3J0ZWRcIiArIHQ1KTtcbiAgfVxuICBieXRlcyh0NSkge1xuICAgIGNvbnN0IGkyID0gdDUubGVuZ3RoID4+PiAwO1xuICAgIHJldHVybiBpMiA/IHRoaXMudWludDMyKGkyKS5fcHVzaChnLCBpMiwgdDUpIDogdGhpcy5fcHVzaCh3cml0ZUJ5dGUsIDEsIDApO1xuICB9XG4gIHN0cmluZyhpMikge1xuICAgIGNvbnN0IGUyID0gdXRmOExlbmd0aChpMik7XG4gICAgcmV0dXJuIGUyID8gdGhpcy51aW50MzIoZTIpLl9wdXNoKHV0ZjhXcml0ZSwgZTIsIGkyKSA6IHRoaXMuX3B1c2god3JpdGVCeXRlLCAxLCAwKTtcbiAgfVxufTtcbmZ1bmN0aW9uIGcodDUsIGkyLCBzMykge1xuICBpZiAoXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgVWludDhBcnJheSkgaTIuc2V0KHQ1LCBzMyk7XG4gIGVsc2UgZm9yIChsZXQgZTIgPSAwOyBlMiA8IHQ1Lmxlbmd0aDsgKytlMikgaTJbczMgKyBlMl0gPSB0NVtlMl07XG59XG5mdW5jdGlvbiBCKHQ1LCBpMikge1xuICByZXR1cm4gUmFuZ2VFcnJvcihcImluZGV4IG91dCBvZiByYW5nZTogXCIgKyB0NS5wb3MgKyBcIiArIFwiICsgKGkyIHx8IDEpICsgXCIgPiBcIiArIHQ1Lmxlbik7XG59XG5cbi8vXG5mdW5jdGlvbiBpc1NldCh0NSkge1xuICByZXR1cm4gbnVsbCAhPSB0NTtcbn1cbmZ1bmN0aW9uIHRvVGltZXN0YW1wKHQ1KSB7XG4gIHZhciBuMjtcbiAgcmV0dXJuIHsgc2Vjb25kczogKG4yID0gdDUuZ2V0VGltZSgpIC8gMWUzLCBCaWdJbnQoTWF0aC50cnVuYyhuMikpKSwgbmFub3M6IHQ1LmdldFRpbWUoKSAlIDFlMyAqIDFlNiB9O1xufVxuZnVuY3Rpb24gZnJvbVRpbWVzdGFtcCh0NSkge1xuICBsZXQgbjIgPSAxZTMgKiBOdW1iZXIodDUuc2Vjb25kcyk7XG4gIHJldHVybiBuMiArPSB0NS5uYW5vcyAvIDFlNiwgbmV3IERhdGUobjIpO1xufVxuZnVuY3Rpb24gZnJvbUpzb25UaW1lc3RhbXAodDUpIHtcbiAgcmV0dXJuIHQ1IGluc3RhbmNlb2YgRGF0ZSA/IHRvVGltZXN0YW1wKHQ1KSA6IFwic3RyaW5nXCIgPT0gdHlwZW9mIHQ1ID8gdG9UaW1lc3RhbXAobmV3IERhdGUodDUpKSA6IHsgc2Vjb25kczogaXNTZXQoKG4yID0gdDUpLnNlY29uZHMpID8gQmlnSW50KG4yLnNlY29uZHMudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG5hbm9zOiBpc1NldChuMi5uYW5vcykgPyBOdW1iZXIobjIubmFub3MpIDogMCB9O1xuICB2YXIgbjI7XG59XG5cbi8vXG5mdW5jdGlvbiBsKCkge1xuICByZXR1cm4geyAkdHlwZVVybDogXCIvZ29vZ2xlLnByb3RvYnVmLkFueVwiLCB0eXBlVXJsOiBcIlwiLCB2YWx1ZTogbmV3IFVpbnQ4QXJyYXkoKSB9O1xufVxudmFyIEFueSA9IHsgdHlwZVVybDogXCIvZ29vZ2xlLnByb3RvYnVmLkFueVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi50eXBlVXJsICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLnR5cGVVcmwpLCAwICE9PSBlMi52YWx1ZS5sZW5ndGggJiYgbzIudWludDMyKDE4KS5ieXRlcyhlMi52YWx1ZSksIG8yKSwgZGVjb2RlKHI1LCBvMikge1xuICBjb25zdCB0NSA9IHI1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gcjUgOiBuZXcgQmluYXJ5UmVhZGVyKHI1KTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSBvMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIG8yO1xuICBjb25zdCBhMiA9IGwoKTtcbiAgZm9yICg7IHQ1LnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBlMiA9IHQ1LnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTIgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgYTIudHlwZVVybCA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgYTIudmFsdWUgPSB0NS5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHQ1LnNraXBUeXBlKDcgJiBlMik7XG4gICAgfVxuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IHR5cGVVcmw6IGlzU2V0KGUyLnR5cGVVcmwpID8gU3RyaW5nKGUyLnR5cGVVcmwpIDogXCJcIiwgdmFsdWU6IGlzU2V0KGUyLnZhbHVlKSA/IGRlY29kZUJhc2U2NChlMi52YWx1ZSkgOiBuZXcgVWludDhBcnJheSgpIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgcjUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIudHlwZVVybCAmJiAocjUudHlwZVVybCA9IGUyLnR5cGVVcmwpLCB2b2lkIDAgIT09IGUyLnZhbHVlICYmIChyNS52YWx1ZSA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IGUyLnZhbHVlID8gZTIudmFsdWUgOiBuZXcgVWludDhBcnJheSgpKSksIHI1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgcjUgPSBsKCk7XG4gIHJldHVybiByNS50eXBlVXJsID0gZTIudHlwZVVybCA/PyBcIlwiLCByNS52YWx1ZSA9IGUyLnZhbHVlID8/IG5ldyBVaW50OEFycmF5KCksIHI1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IEFueS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IEFueS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2dvb2dsZS5wcm90b2J1Zi5BbnlcIiwgdmFsdWU6IEFueS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgU2lnbk1vZGU7XG4hZnVuY3Rpb24oZTIpIHtcbiAgZTJbZTIuU0lHTl9NT0RFX1VOU1BFQ0lGSUVEID0gMF0gPSBcIlNJR05fTU9ERV9VTlNQRUNJRklFRFwiLCBlMltlMi5TSUdOX01PREVfRElSRUNUID0gMV0gPSBcIlNJR05fTU9ERV9ESVJFQ1RcIiwgZTJbZTIuU0lHTl9NT0RFX1RFWFRVQUwgPSAyXSA9IFwiU0lHTl9NT0RFX1RFWFRVQUxcIiwgZTJbZTIuU0lHTl9NT0RFX0RJUkVDVF9BVVggPSAzXSA9IFwiU0lHTl9NT0RFX0RJUkVDVF9BVVhcIiwgZTJbZTIuU0lHTl9NT0RFX0xFR0FDWV9BTUlOT19KU09OID0gMTI3XSA9IFwiU0lHTl9NT0RFX0xFR0FDWV9BTUlOT19KU09OXCIsIGUyW2UyLlNJR05fTU9ERV9FSVBfMTkxID0gMTkxXSA9IFwiU0lHTl9NT0RFX0VJUF8xOTFcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0oU2lnbk1vZGUgfHwgKFNpZ25Nb2RlID0ge30pKTtcblxuLy9cbnZhciBEZWNpbWFsID0gY2xhc3MgX0RlY2ltYWwge1xuICBzdGF0aWMgZnJvbVVzZXJJbnB1dCh0NSwgaTIpIHtcbiAgICBfRGVjaW1hbC52ZXJpZnlGcmFjdGlvbmFsRGlnaXRzKGkyKTtcbiAgICBjb25zdCByNSA9IHQ1Lm1hdGNoKC9bXjAtOS5dLyk7XG4gICAgaWYgKHI1KSB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgY2hhcmFjdGVyIGF0IHBvc2l0aW9uICR7cjUuaW5kZXggKyAxfWApO1xuICAgIGxldCBhMiwgZTI7XG4gICAgaWYgKFwiXCIgPT09IHQ1KSBhMiA9IFwiMFwiLCBlMiA9IFwiXCI7XG4gICAgZWxzZSBpZiAoLTEgPT09IHQ1LnNlYXJjaCgvXFwuLykpIGEyID0gdDUsIGUyID0gXCJcIjtcbiAgICBlbHNlIHtcbiAgICAgIGNvbnN0IGkzID0gdDUuc3BsaXQoXCIuXCIpO1xuICAgICAgc3dpdGNoIChpMy5sZW5ndGgpIHtcbiAgICAgICAgY2FzZSAwOlxuICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmV3ZXIgdGhhbiB0d28gZWxlbWVudHMgaW4gc3BsaXQgcmVzdWx0LiBUaGlzIG11c3Qgbm90IGhhcHBlbiBoZXJlLlwiKTtcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgIGlmICghaTNbMV0pIHRocm93IG5ldyBFcnJvcihcIkZyYWN0aW9uYWwgcGFydCBtaXNzaW5nXCIpO1xuICAgICAgICAgIGEyID0gaTNbMF0sIGUyID0gaTNbMV0ucmVwbGFjZSgvMCskLywgXCJcIik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTW9yZSB0aGFuIG9uZSBzZXBhcmF0b3IgZm91bmRcIik7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChlMi5sZW5ndGggPiBpMikgdGhyb3cgbmV3IEVycm9yKFwiR290IG1vcmUgZnJhY3Rpb25hbCBkaWdpdHMgdGhhbiBzdXBwb3J0ZWRcIik7XG4gICAgY29uc3QgbjIgPSBgJHthMn0ke2UyLnBhZEVuZChpMiwgXCIwXCIpfWA7XG4gICAgcmV0dXJuIG5ldyBfRGVjaW1hbChuMiwgaTIpO1xuICB9XG4gIHN0YXRpYyBmcm9tQXRvbWljcyh0NSwgaTIpIHtcbiAgICByZXR1cm4gX0RlY2ltYWwudmVyaWZ5RnJhY3Rpb25hbERpZ2l0cyhpMiksIG5ldyBfRGVjaW1hbCh0NSwgaTIpO1xuICB9XG4gIHN0YXRpYyB2ZXJpZnlGcmFjdGlvbmFsRGlnaXRzKHQ1KSB7XG4gICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKHQ1KSkgdGhyb3cgbmV3IEVycm9yKFwiRnJhY3Rpb25hbCBkaWdpdHMgaXMgbm90IGFuIGludGVnZXJcIik7XG4gICAgaWYgKHQ1IDwgMCkgdGhyb3cgbmV3IEVycm9yKFwiRnJhY3Rpb25hbCBkaWdpdHMgbXVzdCBub3QgYmUgbmVnYXRpdmVcIik7XG4gICAgaWYgKHQ1ID4gMzApIHRocm93IG5ldyBFcnJvcihcIkZyYWN0aW9uYWwgZGlnaXRzIG11c3Qgbm90IGV4Y2VlZCAzMFwiKTtcbiAgfVxuICBnZXQgYXRvbWljcygpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLmF0b21pY3MudG9TdHJpbmcoKTtcbiAgfVxuICBnZXQgZnJhY3Rpb25hbERpZ2l0cygpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLmZyYWN0aW9uYWxEaWdpdHM7XG4gIH1cbiAgZGF0YTtcbiAgY29uc3RydWN0b3IodDUsIGkyKSB7XG4gICAgaWYgKCF0NS5tYXRjaCgvXlswLTldKyQvKSkgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzdHJpbmcgZm9ybWF0LiBPbmx5IG5vbi1uZWdhdGl2ZSBpbnRlZ2VycyBpbiBkZWNpbWFsIHJlcHJlc2VudGF0aW9uIHN1cHBvcnRlZC5cIik7XG4gICAgdGhpcy5kYXRhID0geyBhdG9taWNzOiBCaWdJbnQodDUpLCBmcmFjdGlvbmFsRGlnaXRzOiBpMiB9O1xuICB9XG4gIHRvU3RyaW5nKCkge1xuICAgIGNvbnN0IHQ1ID0gQmlnSW50KDEwKSAqKiBCaWdJbnQodGhpcy5kYXRhLmZyYWN0aW9uYWxEaWdpdHMpLCBpMiA9IHRoaXMuZGF0YS5hdG9taWNzIC8gdDUsIHI1ID0gdGhpcy5kYXRhLmF0b21pY3MgJSB0NTtcbiAgICBpZiAoMG4gPT09IHI1KSByZXR1cm4gaTIudG9TdHJpbmcoKTtcbiAgICB7XG4gICAgICBjb25zdCB0NiA9IHI1LnRvU3RyaW5nKCkucGFkU3RhcnQodGhpcy5kYXRhLmZyYWN0aW9uYWxEaWdpdHMsIFwiMFwiKS5yZXBsYWNlKC8wKyQvLCBcIlwiKTtcbiAgICAgIHJldHVybiBgJHtpMi50b1N0cmluZygpfS4ke3Q2fWA7XG4gICAgfVxuICB9XG59O1xuXG4vL1xudmFyIENvaW4gPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnYxYmV0YTEuQ29pblwiLCBlbmNvZGU6IChvMiwgbjIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5kZW5vbSAmJiBuMi51aW50MzIoMTApLnN0cmluZyhvMi5kZW5vbSksIFwiXCIgIT09IG8yLmFtb3VudCAmJiBuMi51aW50MzIoMTgpLnN0cmluZyhvMi5hbW91bnQpLCBuMiksIGRlY29kZSh0NSwgbjIpIHtcbiAgY29uc3QgZTIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCByNSA9IHZvaWQgMCA9PT0gbjIgPyBlMi5sZW4gOiBlMi5wb3MgKyBuMjtcbiAgY29uc3QgczMgPSB7IGRlbm9tOiBcIlwiLCBhbW91bnQ6IFwiXCIgfTtcbiAgZm9yICg7IGUyLnBvcyA8IHI1OyApIHtcbiAgICBjb25zdCBvMiA9IGUyLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzIgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczMuZGVub20gPSBlMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHMzLmFtb3VudCA9IGUyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGUyLnNraXBUeXBlKDcgJiBvMik7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMztcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGRlbm9tOiBpc1NldChvMi5kZW5vbSkgPyBTdHJpbmcobzIuZGVub20pIDogXCJcIiwgYW1vdW50OiBpc1NldChvMi5hbW91bnQpID8gU3RyaW5nKG8yLmFtb3VudCkgOiBcIlwiIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZGVub20gJiYgKHQ1LmRlbm9tID0gbzIuZGVub20pLCB2b2lkIDAgIT09IG8yLmFtb3VudCAmJiAodDUuYW1vdW50ID0gbzIuYW1vdW50KSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgZGVub206IFwiXCIsIGFtb3VudDogXCJcIiB9O1xuICByZXR1cm4gdDUuZGVub20gPSBvMi5kZW5vbSA/PyBcIlwiLCB0NS5hbW91bnQgPSBvMi5hbW91bnQgPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gQ29pbi5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IENvaW4uZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS52MWJldGExLkNvaW5cIiwgdmFsdWU6IENvaW4uZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIERlY0NvaW4gPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnYxYmV0YTEuRGVjQ29pblwiLCBlbmNvZGU6IChvMiwgbjIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5kZW5vbSAmJiBuMi51aW50MzIoMTApLnN0cmluZyhvMi5kZW5vbSksIFwiXCIgIT09IG8yLmFtb3VudCAmJiBuMi51aW50MzIoMTgpLnN0cmluZyhEZWNpbWFsLmZyb21Vc2VySW5wdXQobzIuYW1vdW50LCAxOCkuYXRvbWljcyksIG4yKSwgZGVjb2RlKHQ1LCBuMikge1xuICBjb25zdCByNSA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IHMzID0gdm9pZCAwID09PSBuMiA/IHI1LmxlbiA6IHI1LnBvcyArIG4yO1xuICBjb25zdCBpMiA9IHsgZGVub206IFwiXCIsIGFtb3VudDogXCJcIiB9O1xuICBmb3IgKDsgcjUucG9zIDwgczM7ICkge1xuICAgIGNvbnN0IG8yID0gcjUudWludDMyKCk7XG4gICAgc3dpdGNoIChvMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5kZW5vbSA9IHI1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIuYW1vdW50ID0gRGVjaW1hbC5mcm9tQXRvbWljcyhyNS5zdHJpbmcoKSwgMTgpLnRvU3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcjUuc2tpcFR5cGUoNyAmIG8yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVub206IGlzU2V0KG8yLmRlbm9tKSA/IFN0cmluZyhvMi5kZW5vbSkgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KG8yLmFtb3VudCkgPyBTdHJpbmcobzIuYW1vdW50KSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZW5vbSAmJiAodDUuZGVub20gPSBvMi5kZW5vbSksIHZvaWQgMCAhPT0gbzIuYW1vdW50ICYmICh0NS5hbW91bnQgPSBvMi5hbW91bnQpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyBkZW5vbTogXCJcIiwgYW1vdW50OiBcIlwiIH07XG4gIHJldHVybiB0NS5kZW5vbSA9IG8yLmRlbm9tID8/IFwiXCIsIHQ1LmFtb3VudCA9IG8yLmFtb3VudCA/PyBcIlwiLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBEZWNDb2luLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gRGVjQ29pbi5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnYxYmV0YTEuRGVjQ29pblwiLCB2YWx1ZTogRGVjQ29pbi5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG5mdW5jdGlvbiBnMigpIHtcbiAgcmV0dXJuIHsgbWVzc2FnZXM6IFtdLCBtZW1vOiBcIlwiLCB0aW1lb3V0SGVpZ2h0OiBCaWdJbnQoMCksIGV4dGVuc2lvbk9wdGlvbnM6IFtdLCBub25Dcml0aWNhbEV4dGVuc2lvbk9wdGlvbnM6IFtdIH07XG59XG52YXIgVHhCb2R5ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MudHgudjFiZXRhMS5UeEJvZHlcIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IG4yIG9mIGUyLm1lc3NhZ2VzKSBBbnkuZW5jb2RlKG4yLCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIFwiXCIgIT09IGUyLm1lbW8gJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIubWVtbyksIGUyLnRpbWVvdXRIZWlnaHQgIT09IEJpZ0ludCgwKSAmJiB0NS51aW50MzIoMjQpLnVpbnQ2NChlMi50aW1lb3V0SGVpZ2h0KTtcbiAgZm9yIChjb25zdCBuMiBvZiBlMi5leHRlbnNpb25PcHRpb25zKSBBbnkuZW5jb2RlKG4yLCB0NS51aW50MzIoODE4NikuZm9yaygpKS5sZGVsaW0oKTtcbiAgZm9yIChjb25zdCBuMiBvZiBlMi5ub25Dcml0aWNhbEV4dGVuc2lvbk9wdGlvbnMpIEFueS5lbmNvZGUobjIsIHQ1LnVpbnQzMigxNjM3OCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHQ1O1xufSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSB0NSA/IG4yLmxlbiA6IG4yLnBvcyArIHQ1O1xuICBjb25zdCByNSA9IGcyKCk7XG4gIGZvciAoOyBuMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1Lm1lc3NhZ2VzLnB1c2goQW55LmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1Lm1lbW8gPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHI1LnRpbWVvdXRIZWlnaHQgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDEwMjM6XG4gICAgICAgIHI1LmV4dGVuc2lvbk9wdGlvbnMucHVzaChBbnkuZGVjb2RlKG4yLCBuMi51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjA0NzpcbiAgICAgICAgcjUubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zLnB1c2goQW55LmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBtZXNzYWdlczogQXJyYXkuaXNBcnJheShlMj8ubWVzc2FnZXMpID8gZTIubWVzc2FnZXMubWFwKChlMykgPT4gQW55LmZyb21KU09OKGUzKSkgOiBbXSwgbWVtbzogaXNTZXQoZTIubWVtbykgPyBTdHJpbmcoZTIubWVtbykgOiBcIlwiLCB0aW1lb3V0SGVpZ2h0OiBpc1NldChlMi50aW1lb3V0SGVpZ2h0KSA/IEJpZ0ludChlMi50aW1lb3V0SGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBleHRlbnNpb25PcHRpb25zOiBBcnJheS5pc0FycmF5KGUyPy5leHRlbnNpb25PcHRpb25zKSA/IGUyLmV4dGVuc2lvbk9wdGlvbnMubWFwKChlMykgPT4gQW55LmZyb21KU09OKGUzKSkgOiBbXSwgbm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zOiBBcnJheS5pc0FycmF5KGUyPy5ub25Dcml0aWNhbEV4dGVuc2lvbk9wdGlvbnMpID8gZTIubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zLm1hcCgoZTMpID0+IEFueS5mcm9tSlNPTihlMykpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gZTIubWVzc2FnZXMgPyB0NS5tZXNzYWdlcyA9IGUyLm1lc3NhZ2VzLm1hcCgoZTMpID0+IGUzID8gQW55LnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUubWVzc2FnZXMgPSBbXSwgdm9pZCAwICE9PSBlMi5tZW1vICYmICh0NS5tZW1vID0gZTIubWVtbyksIHZvaWQgMCAhPT0gZTIudGltZW91dEhlaWdodCAmJiAodDUudGltZW91dEhlaWdodCA9IChlMi50aW1lb3V0SGVpZ2h0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIGUyLmV4dGVuc2lvbk9wdGlvbnMgPyB0NS5leHRlbnNpb25PcHRpb25zID0gZTIuZXh0ZW5zaW9uT3B0aW9ucy5tYXAoKGUzKSA9PiBlMyA/IEFueS50b0pTT04oZTMpIDogdm9pZCAwKSA6IHQ1LmV4dGVuc2lvbk9wdGlvbnMgPSBbXSwgZTIubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zID8gdDUubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zID0gZTIubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zLm1hcCgoZTMpID0+IGUzID8gQW55LnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zID0gW10sIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSBnMigpO1xuICByZXR1cm4gdDUubWVzc2FnZXMgPSBlMi5tZXNzYWdlcz8ubWFwKChlMykgPT4gQW55LmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1Lm1lbW8gPSBlMi5tZW1vID8/IFwiXCIsIHQ1LnRpbWVvdXRIZWlnaHQgPSB2b2lkIDAgIT09IGUyLnRpbWVvdXRIZWlnaHQgJiYgbnVsbCAhPT0gZTIudGltZW91dEhlaWdodCA/IEJpZ0ludChlMi50aW1lb3V0SGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB0NS5leHRlbnNpb25PcHRpb25zID0gZTIuZXh0ZW5zaW9uT3B0aW9ucz8ubWFwKChlMykgPT4gQW55LmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1Lm5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9ucyA9IGUyLm5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9ucz8ubWFwKChlMykgPT4gQW55LmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IFR4Qm9keS5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFR4Qm9keS5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy50eC52MWJldGExLlR4Qm9keVwiLCB2YWx1ZTogVHhCb2R5LmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbmZ1bmN0aW9uIHMoKSB7XG4gIHJldHVybiB7IHR5cGU6IFwiXCIsIGtleTogbmV3IFVpbnQ4QXJyYXkoKSwgZGF0YTogbmV3IFVpbnQ4QXJyYXkoKSB9O1xufVxudmFyIFByb29mT3AgPSB7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuY3J5cHRvLlByb29mT3BcIiwgZW5jb2RlOiAodDUsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gdDUudHlwZSAmJiBlMi51aW50MzIoMTApLnN0cmluZyh0NS50eXBlKSwgMCAhPT0gdDUua2V5Lmxlbmd0aCAmJiBlMi51aW50MzIoMTgpLmJ5dGVzKHQ1LmtleSksIDAgIT09IHQ1LmRhdGEubGVuZ3RoICYmIGUyLnVpbnQzMigyNikuYnl0ZXModDUuZGF0YSksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCBuMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IHI1ID0gdm9pZCAwID09PSBlMiA/IG4yLmxlbiA6IG4yLnBvcyArIGUyO1xuICBjb25zdCBpMiA9IHMoKTtcbiAgZm9yICg7IG4yLnBvcyA8IHI1OyApIHtcbiAgICBjb25zdCB0NSA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAodDUgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTIudHlwZSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIua2V5ID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGkyLmRhdGEgPSBuMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiB0NSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAodDUpID0+ICh7IHR5cGU6IGlzU2V0KHQ1LnR5cGUpID8gU3RyaW5nKHQ1LnR5cGUpIDogXCJcIiwga2V5OiBpc1NldCh0NS5rZXkpID8gZGVjb2RlQmFzZTY0KHQ1LmtleSkgOiBuZXcgVWludDhBcnJheSgpLCBkYXRhOiBpc1NldCh0NS5kYXRhKSA/IGRlY29kZUJhc2U2NCh0NS5kYXRhKSA6IG5ldyBVaW50OEFycmF5KCkgfSksIHRvSlNPTih0NSkge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSB0NS50eXBlICYmIChvMi50eXBlID0gdDUudHlwZSksIHZvaWQgMCAhPT0gdDUua2V5ICYmIChvMi5rZXkgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSB0NS5rZXkgPyB0NS5rZXkgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gdDUuZGF0YSAmJiAobzIuZGF0YSA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IHQ1LmRhdGEgPyB0NS5kYXRhIDogbmV3IFVpbnQ4QXJyYXkoKSkpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKHQ1KSB7XG4gIGNvbnN0IG8yID0gcygpO1xuICByZXR1cm4gbzIudHlwZSA9IHQ1LnR5cGUgPz8gXCJcIiwgbzIua2V5ID0gdDUua2V5ID8/IG5ldyBVaW50OEFycmF5KCksIG8yLmRhdGEgPSB0NS5kYXRhID8/IG5ldyBVaW50OEFycmF5KCksIG8yO1xufSwgZnJvbVByb3RvTXNnOiAodDUpID0+IFByb29mT3AuZGVjb2RlKHQ1LnZhbHVlKSwgdG9Qcm90bzogKHQ1KSA9PiBQcm9vZk9wLmVuY29kZSh0NSkuZmluaXNoKCksIHRvUHJvdG9Nc2c6ICh0NSkgPT4gKHsgdHlwZVVybDogXCIvdGVuZGVybWludC5jcnlwdG8uUHJvb2ZPcFwiLCB2YWx1ZTogUHJvb2ZPcC5lbmNvZGUodDUpLmZpbmlzaCgpIH0pIH07XG52YXIgUHJvb2ZPcHMgPSB7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuY3J5cHRvLlByb29mT3BzXCIsIGVuY29kZSh0NSwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBvMiBvZiB0NS5vcHMpIFByb29mT3AuZW5jb2RlKG8yLCBlMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiBlMjtcbn0sIGRlY29kZShvMiwgZTIpIHtcbiAgY29uc3QgbjIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCByNSA9IHZvaWQgMCA9PT0gZTIgPyBuMi5sZW4gOiBuMi5wb3MgKyBlMjtcbiAgY29uc3QgaTIgPSB7IG9wczogW10gfTtcbiAgZm9yICg7IG4yLnBvcyA8IHI1OyApIHtcbiAgICBjb25zdCB0NSA9IG4yLnVpbnQzMigpO1xuICAgIGlmICh0NSA+Pj4gMyA9PSAxKSBpMi5vcHMucHVzaChQcm9vZk9wLmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICBlbHNlIG4yLnNraXBUeXBlKDcgJiB0NSk7XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046ICh0NSkgPT4gKHsgb3BzOiBBcnJheS5pc0FycmF5KHQ1Py5vcHMpID8gdDUub3BzLm1hcCgodDYpID0+IFByb29mT3AuZnJvbUpTT04odDYpKSA6IFtdIH0pLCB0b0pTT04odDUpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHQ1Lm9wcyA/IG8yLm9wcyA9IHQ1Lm9wcy5tYXAoKHQ2KSA9PiB0NiA/IFByb29mT3AudG9KU09OKHQ2KSA6IHZvaWQgMCkgOiBvMi5vcHMgPSBbXSwgbzI7XG59LCBmcm9tUGFydGlhbCh0NSkge1xuICBjb25zdCBvMiA9IHsgb3BzOiBbXSB9O1xuICByZXR1cm4gbzIub3BzID0gdDUub3BzPy5tYXAoKHQ2KSA9PiBQcm9vZk9wLmZyb21QYXJ0aWFsKHQ2KSkgfHwgW10sIG8yO1xufSwgZnJvbVByb3RvTXNnOiAodDUpID0+IFByb29mT3BzLmRlY29kZSh0NS52YWx1ZSksIHRvUHJvdG86ICh0NSkgPT4gUHJvb2ZPcHMuZW5jb2RlKHQ1KS5maW5pc2goKSwgdG9Qcm90b01zZzogKHQ1KSA9PiAoeyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmNyeXB0by5Qcm9vZk9wc1wiLCB2YWx1ZTogUHJvb2ZPcHMuZW5jb2RlKHQ1KS5maW5pc2goKSB9KSB9O1xuXG4vL1xuZnVuY3Rpb24gdDIoKSB7XG4gIHJldHVybiB7IHNlY29uZHM6IEJpZ0ludCgwKSwgbmFub3M6IDAgfTtcbn1cbnZhciBUaW1lc3RhbXAgPSB7IHR5cGVVcmw6IFwiL2dvb2dsZS5wcm90b2J1Zi5UaW1lc3RhbXBcIiwgZW5jb2RlOiAobjIsIHMzID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAobjIuc2Vjb25kcyAhPT0gQmlnSW50KDApICYmIHMzLnVpbnQzMig4KS5pbnQ2NChuMi5zZWNvbmRzKSwgMCAhPT0gbjIubmFub3MgJiYgczMudWludDMyKDE2KS5pbnQzMihuMi5uYW5vcyksIHMzKSwgZGVjb2RlKG8yLCBzMykge1xuICBjb25zdCBlMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBzMyA/IGUyLmxlbiA6IGUyLnBvcyArIHMzO1xuICBjb25zdCByNSA9IHQyKCk7XG4gIGZvciAoOyBlMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgbjIgPSBlMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG4yID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LnNlY29uZHMgPSBlMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUubmFub3MgPSBlMi5pbnQzMigpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGUyLnNraXBUeXBlKDcgJiBuMik7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAobjIpID0+ICh7IHNlY29uZHM6IGlzU2V0KG4yLnNlY29uZHMpID8gQmlnSW50KG4yLnNlY29uZHMudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG5hbm9zOiBpc1NldChuMi5uYW5vcykgPyBOdW1iZXIobjIubmFub3MpIDogMCB9KSwgdG9KU09OKG4yKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG4yLnNlY29uZHMgJiYgKG8yLnNlY29uZHMgPSAobjIuc2Vjb25kcyB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IG4yLm5hbm9zICYmIChvMi5uYW5vcyA9IE1hdGgucm91bmQobjIubmFub3MpKSwgbzI7XG59LCBmcm9tUGFydGlhbChuMikge1xuICBjb25zdCBvMiA9IHQyKCk7XG4gIHJldHVybiBvMi5zZWNvbmRzID0gdm9pZCAwICE9PSBuMi5zZWNvbmRzICYmIG51bGwgIT09IG4yLnNlY29uZHMgPyBCaWdJbnQobjIuc2Vjb25kcy50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbzIubmFub3MgPSBuMi5uYW5vcyA/PyAwLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKG4yKSA9PiBUaW1lc3RhbXAuZGVjb2RlKG4yLnZhbHVlKSwgdG9Qcm90bzogKG4yKSA9PiBUaW1lc3RhbXAuZW5jb2RlKG4yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG4yKSA9PiAoeyB0eXBlVXJsOiBcIi9nb29nbGUucHJvdG9idWYuVGltZXN0YW1wXCIsIHZhbHVlOiBUaW1lc3RhbXAuZW5jb2RlKG4yKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIEJsb2NrSURGbGFnO1xuIWZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLkJMT0NLX0lEX0ZMQUdfVU5LTk9XTiA9IDBdID0gXCJCTE9DS19JRF9GTEFHX1VOS05PV05cIiwgZTJbZTIuQkxPQ0tfSURfRkxBR19BQlNFTlQgPSAxXSA9IFwiQkxPQ0tfSURfRkxBR19BQlNFTlRcIiwgZTJbZTIuQkxPQ0tfSURfRkxBR19DT01NSVQgPSAyXSA9IFwiQkxPQ0tfSURfRkxBR19DT01NSVRcIiwgZTJbZTIuQkxPQ0tfSURfRkxBR19OSUwgPSAzXSA9IFwiQkxPQ0tfSURfRkxBR19OSUxcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0oQmxvY2tJREZsYWcgfHwgKEJsb2NrSURGbGFnID0ge30pKTtcbnZhciBTaWduZWRNc2dUeXBlO1xuIWZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLlNJR05FRF9NU0dfVFlQRV9VTktOT1dOID0gMF0gPSBcIlNJR05FRF9NU0dfVFlQRV9VTktOT1dOXCIsIGUyW2UyLlNJR05FRF9NU0dfVFlQRV9QUkVWT1RFID0gMV0gPSBcIlNJR05FRF9NU0dfVFlQRV9QUkVWT1RFXCIsIGUyW2UyLlNJR05FRF9NU0dfVFlQRV9QUkVDT01NSVQgPSAyXSA9IFwiU0lHTkVEX01TR19UWVBFX1BSRUNPTU1JVFwiLCBlMltlMi5TSUdORURfTVNHX1RZUEVfUFJPUE9TQUwgPSAzMl0gPSBcIlNJR05FRF9NU0dfVFlQRV9QUk9QT1NBTFwiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShTaWduZWRNc2dUeXBlIHx8IChTaWduZWRNc2dUeXBlID0ge30pKTtcblxuLy9cbnZhciBDaGVja1R4VHlwZTtcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5ORVcgPSAwXSA9IFwiTkVXXCIsIGUyW2UyLlJFQ0hFQ0sgPSAxXSA9IFwiUkVDSEVDS1wiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShDaGVja1R4VHlwZSB8fCAoQ2hlY2tUeFR5cGUgPSB7fSkpO1xudmFyIEV2aWRlbmNlVHlwZTtcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5VTktOT1dOID0gMF0gPSBcIlVOS05PV05cIiwgZTJbZTIuRFVQTElDQVRFX1ZPVEUgPSAxXSA9IFwiRFVQTElDQVRFX1ZPVEVcIiwgZTJbZTIuTElHSFRfQ0xJRU5UX0FUVEFDSyA9IDJdID0gXCJMSUdIVF9DTElFTlRfQVRUQUNLXCIsIGUyW2UyLlVOUkVDT0dOSVpFRCA9IC0xXSA9IFwiVU5SRUNPR05JWkVEXCI7XG59KEV2aWRlbmNlVHlwZSB8fCAoRXZpZGVuY2VUeXBlID0ge30pKTtcbmZ1bmN0aW9uIHAoKSB7XG4gIHJldHVybiB7IGRhdGE6IG5ldyBVaW50OEFycmF5KCksIHBhdGg6IFwiXCIsIGhlaWdodDogQmlnSW50KDApLCBwcm92ZTogZmFsc2UgfTtcbn1cbnZhciBSZXF1ZXN0UXVlcnkgPSB7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuYWJjaS5SZXF1ZXN0UXVlcnlcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoMCAhPT0gZTIuZGF0YS5sZW5ndGggJiYgdDUudWludDMyKDEwKS5ieXRlcyhlMi5kYXRhKSwgXCJcIiAhPT0gZTIucGF0aCAmJiB0NS51aW50MzIoMTgpLnN0cmluZyhlMi5wYXRoKSwgZTIuaGVpZ2h0ICE9PSBCaWdJbnQoMCkgJiYgdDUudWludDMyKDI0KS5pbnQ2NChlMi5oZWlnaHQpLCB0cnVlID09PSBlMi5wcm92ZSAmJiB0NS51aW50MzIoMzIpLmJvb2woZTIucHJvdmUpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbzIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gdDUgPyBvMi5sZW4gOiBvMi5wb3MgKyB0NTtcbiAgY29uc3QgaTIgPSBwKCk7XG4gIGZvciAoOyBvMi5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTMgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRhdGEgPSBvMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIucGF0aCA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgaTIuaGVpZ2h0ID0gbzIuaW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGkyLnByb3ZlID0gbzIuYm9vbCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRhdGE6IGlzU2V0KGUyLmRhdGEpID8gZGVjb2RlQmFzZTY0KGUyLmRhdGEpIDogbmV3IFVpbnQ4QXJyYXkoKSwgcGF0aDogaXNTZXQoZTIucGF0aCkgPyBTdHJpbmcoZTIucGF0aCkgOiBcIlwiLCBoZWlnaHQ6IGlzU2V0KGUyLmhlaWdodCkgPyBCaWdJbnQoZTIuaGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBwcm92ZTogISFpc1NldChlMi5wcm92ZSkgJiYgQm9vbGVhbihlMi5wcm92ZSkgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kYXRhICYmICh0NS5kYXRhID0gZW5jb2RlQmFzZTY0KHZvaWQgMCAhPT0gZTIuZGF0YSA/IGUyLmRhdGEgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gZTIucGF0aCAmJiAodDUucGF0aCA9IGUyLnBhdGgpLCB2b2lkIDAgIT09IGUyLmhlaWdodCAmJiAodDUuaGVpZ2h0ID0gKGUyLmhlaWdodCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLnByb3ZlICYmICh0NS5wcm92ZSA9IGUyLnByb3ZlKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHAoKTtcbiAgcmV0dXJuIHQ1LmRhdGEgPSBlMi5kYXRhID8/IG5ldyBVaW50OEFycmF5KCksIHQ1LnBhdGggPSBlMi5wYXRoID8/IFwiXCIsIHQ1LmhlaWdodCA9IHZvaWQgMCAhPT0gZTIuaGVpZ2h0ICYmIG51bGwgIT09IGUyLmhlaWdodCA/IEJpZ0ludChlMi5oZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIHQ1LnByb3ZlID0gZTIucHJvdmUgPz8gZmFsc2UsIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFJlcXVlc3RRdWVyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlcXVlc3RRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuYWJjaS5SZXF1ZXN0UXVlcnlcIiwgdmFsdWU6IFJlcXVlc3RRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBtKCkge1xuICByZXR1cm4geyBjb2RlOiAwLCBsb2c6IFwiXCIsIGluZm86IFwiXCIsIGluZGV4OiBCaWdJbnQoMCksIGtleTogbmV3IFVpbnQ4QXJyYXkoKSwgdmFsdWU6IG5ldyBVaW50OEFycmF5KCksIHByb29mT3BzOiB2b2lkIDAsIGhlaWdodDogQmlnSW50KDApLCBjb2Rlc3BhY2U6IFwiXCIgfTtcbn1cbnZhciBSZXNwb25zZVF1ZXJ5ID0geyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmFiY2kuUmVzcG9uc2VRdWVyeVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICgwICE9PSBlMi5jb2RlICYmIG8yLnVpbnQzMig4KS51aW50MzIoZTIuY29kZSksIFwiXCIgIT09IGUyLmxvZyAmJiBvMi51aW50MzIoMjYpLnN0cmluZyhlMi5sb2cpLCBcIlwiICE9PSBlMi5pbmZvICYmIG8yLnVpbnQzMigzNCkuc3RyaW5nKGUyLmluZm8pLCBlMi5pbmRleCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMig0MCkuaW50NjQoZTIuaW5kZXgpLCAwICE9PSBlMi5rZXkubGVuZ3RoICYmIG8yLnVpbnQzMig1MCkuYnl0ZXMoZTIua2V5KSwgMCAhPT0gZTIudmFsdWUubGVuZ3RoICYmIG8yLnVpbnQzMig1OCkuYnl0ZXMoZTIudmFsdWUpLCB2b2lkIDAgIT09IGUyLnByb29mT3BzICYmIFByb29mT3BzLmVuY29kZShlMi5wcm9vZk9wcywgbzIudWludDMyKDY2KS5mb3JrKCkpLmxkZWxpbSgpLCBlMi5oZWlnaHQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoNzIpLmludDY0KGUyLmhlaWdodCksIFwiXCIgIT09IGUyLmNvZGVzcGFjZSAmJiBvMi51aW50MzIoODIpLnN0cmluZyhlMi5jb2Rlc3BhY2UpLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgbjIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gbzIgPyBuMi5sZW4gOiBuMi5wb3MgKyBvMjtcbiAgY29uc3QgYTIgPSBtKCk7XG4gIGZvciAoOyBuMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGEyLmNvZGUgPSBuMi51aW50MzIoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGEyLmxvZyA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgYTIuaW5mbyA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgYTIuaW5kZXggPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNjpcbiAgICAgICAgYTIua2V5ID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDc6XG4gICAgICAgIGEyLnZhbHVlID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDg6XG4gICAgICAgIGEyLnByb29mT3BzID0gUHJvb2ZPcHMuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA5OlxuICAgICAgICBhMi5oZWlnaHQgPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMTA6XG4gICAgICAgIGEyLmNvZGVzcGFjZSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGNvZGU6IGlzU2V0KGUyLmNvZGUpID8gTnVtYmVyKGUyLmNvZGUpIDogMCwgbG9nOiBpc1NldChlMi5sb2cpID8gU3RyaW5nKGUyLmxvZykgOiBcIlwiLCBpbmZvOiBpc1NldChlMi5pbmZvKSA/IFN0cmluZyhlMi5pbmZvKSA6IFwiXCIsIGluZGV4OiBpc1NldChlMi5pbmRleCkgPyBCaWdJbnQoZTIuaW5kZXgudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGtleTogaXNTZXQoZTIua2V5KSA/IGRlY29kZUJhc2U2NChlMi5rZXkpIDogbmV3IFVpbnQ4QXJyYXkoKSwgdmFsdWU6IGlzU2V0KGUyLnZhbHVlKSA/IGRlY29kZUJhc2U2NChlMi52YWx1ZSkgOiBuZXcgVWludDhBcnJheSgpLCBwcm9vZk9wczogaXNTZXQoZTIucHJvb2ZPcHMpID8gUHJvb2ZPcHMuZnJvbUpTT04oZTIucHJvb2ZPcHMpIDogdm9pZCAwLCBoZWlnaHQ6IGlzU2V0KGUyLmhlaWdodCkgPyBCaWdJbnQoZTIuaGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBjb2Rlc3BhY2U6IGlzU2V0KGUyLmNvZGVzcGFjZSkgPyBTdHJpbmcoZTIuY29kZXNwYWNlKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5jb2RlICYmIChvMi5jb2RlID0gTWF0aC5yb3VuZChlMi5jb2RlKSksIHZvaWQgMCAhPT0gZTIubG9nICYmIChvMi5sb2cgPSBlMi5sb2cpLCB2b2lkIDAgIT09IGUyLmluZm8gJiYgKG8yLmluZm8gPSBlMi5pbmZvKSwgdm9pZCAwICE9PSBlMi5pbmRleCAmJiAobzIuaW5kZXggPSAoZTIuaW5kZXggfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi5rZXkgJiYgKG8yLmtleSA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IGUyLmtleSA/IGUyLmtleSA6IG5ldyBVaW50OEFycmF5KCkpKSwgdm9pZCAwICE9PSBlMi52YWx1ZSAmJiAobzIudmFsdWUgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSBlMi52YWx1ZSA/IGUyLnZhbHVlIDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB2b2lkIDAgIT09IGUyLnByb29mT3BzICYmIChvMi5wcm9vZk9wcyA9IGUyLnByb29mT3BzID8gUHJvb2ZPcHMudG9KU09OKGUyLnByb29mT3BzKSA6IHZvaWQgMCksIHZvaWQgMCAhPT0gZTIuaGVpZ2h0ICYmIChvMi5oZWlnaHQgPSAoZTIuaGVpZ2h0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuY29kZXNwYWNlICYmIChvMi5jb2Rlc3BhY2UgPSBlMi5jb2Rlc3BhY2UpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0gbSgpO1xuICByZXR1cm4gbzIuY29kZSA9IGUyLmNvZGUgPz8gMCwgbzIubG9nID0gZTIubG9nID8/IFwiXCIsIG8yLmluZm8gPSBlMi5pbmZvID8/IFwiXCIsIG8yLmluZGV4ID0gdm9pZCAwICE9PSBlMi5pbmRleCAmJiBudWxsICE9PSBlMi5pbmRleCA/IEJpZ0ludChlMi5pbmRleC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbzIua2V5ID0gZTIua2V5ID8/IG5ldyBVaW50OEFycmF5KCksIG8yLnZhbHVlID0gZTIudmFsdWUgPz8gbmV3IFVpbnQ4QXJyYXkoKSwgbzIucHJvb2ZPcHMgPSB2b2lkIDAgIT09IGUyLnByb29mT3BzICYmIG51bGwgIT09IGUyLnByb29mT3BzID8gUHJvb2ZPcHMuZnJvbVBhcnRpYWwoZTIucHJvb2ZPcHMpIDogdm9pZCAwLCBvMi5oZWlnaHQgPSB2b2lkIDAgIT09IGUyLmhlaWdodCAmJiBudWxsICE9PSBlMi5oZWlnaHQgPyBCaWdJbnQoZTIuaGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBvMi5jb2Rlc3BhY2UgPSBlMi5jb2Rlc3BhY2UgPz8gXCJcIiwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUmVzcG9uc2VRdWVyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlc3BvbnNlUXVlcnkuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmFiY2kuUmVzcG9uc2VRdWVyeVwiLCB2YWx1ZTogUmVzcG9uc2VRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgQ29zbW9zUXVlcnkgPSB7IHR5cGVVcmw6IFwiL2ljcS52MS5Db3Ntb3NRdWVyeVwiLCBlbmNvZGUobzIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgcjUgb2YgbzIucmVxdWVzdHMpIFJlcXVlc3RRdWVyeS5lbmNvZGUocjUsIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHQ1O1xufSwgZGVjb2RlKG8yLCByNSkge1xuICBjb25zdCBzMyA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSByNSA/IHMzLmxlbiA6IHMzLnBvcyArIHI1O1xuICBjb25zdCBhMiA9IHsgcmVxdWVzdHM6IFtdIH07XG4gIGZvciAoOyBzMy5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgbzMgPSBzMy51aW50MzIoKTtcbiAgICBpZiAobzMgPj4+IDMgPT0gMSkgYTIucmVxdWVzdHMucHVzaChSZXF1ZXN0UXVlcnkuZGVjb2RlKHMzLCBzMy51aW50MzIoKSkpO1xuICAgIGVsc2UgczMuc2tpcFR5cGUoNyAmIG8zKTtcbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyByZXF1ZXN0czogQXJyYXkuaXNBcnJheShvMj8ucmVxdWVzdHMpID8gbzIucmVxdWVzdHMubWFwKChvMykgPT4gUmVxdWVzdFF1ZXJ5LmZyb21KU09OKG8zKSkgOiBbXSB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiBvMi5yZXF1ZXN0cyA/IHQ1LnJlcXVlc3RzID0gbzIucmVxdWVzdHMubWFwKChvMykgPT4gbzMgPyBSZXF1ZXN0UXVlcnkudG9KU09OKG8zKSA6IHZvaWQgMCkgOiB0NS5yZXF1ZXN0cyA9IFtdLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyByZXF1ZXN0czogW10gfTtcbiAgcmV0dXJuIHQ1LnJlcXVlc3RzID0gbzIucmVxdWVzdHM/Lm1hcCgobzMpID0+IFJlcXVlc3RRdWVyeS5mcm9tUGFydGlhbChvMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBDb3Ntb3NRdWVyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IENvc21vc1F1ZXJ5LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvaWNxLnYxLkNvc21vc1F1ZXJ5XCIsIHZhbHVlOiBDb3Ntb3NRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgQ29zbW9zUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2ljcS52MS5Db3Ntb3NSZXNwb25zZVwiLCBlbmNvZGUoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgcjUgb2YgZTIucmVzcG9uc2VzKSBSZXNwb25zZVF1ZXJ5LmVuY29kZShyNSwgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdDU7XG59LCBkZWNvZGUoZTIsIHI1KSB7XG4gIGNvbnN0IHMzID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHI1ID8gczMubGVuIDogczMucG9zICsgcjU7XG4gIGNvbnN0IGEyID0geyByZXNwb25zZXM6IFtdIH07XG4gIGZvciAoOyBzMy5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTMgPSBzMy51aW50MzIoKTtcbiAgICBpZiAoZTMgPj4+IDMgPT0gMSkgYTIucmVzcG9uc2VzLnB1c2goUmVzcG9uc2VRdWVyeS5kZWNvZGUoczMsIHMzLnVpbnQzMigpKSk7XG4gICAgZWxzZSBzMy5za2lwVHlwZSg3ICYgZTMpO1xuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IHJlc3BvbnNlczogQXJyYXkuaXNBcnJheShlMj8ucmVzcG9uc2VzKSA/IGUyLnJlc3BvbnNlcy5tYXAoKGUzKSA9PiBSZXNwb25zZVF1ZXJ5LmZyb21KU09OKGUzKSkgOiBbXSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiBlMi5yZXNwb25zZXMgPyB0NS5yZXNwb25zZXMgPSBlMi5yZXNwb25zZXMubWFwKChlMykgPT4gZTMgPyBSZXNwb25zZVF1ZXJ5LnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUucmVzcG9uc2VzID0gW10sIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSB7IHJlc3BvbnNlczogW10gfTtcbiAgcmV0dXJuIHQ1LnJlc3BvbnNlcyA9IGUyLnJlc3BvbnNlcz8ubWFwKChlMykgPT4gUmVzcG9uc2VRdWVyeS5mcm9tUGFydGlhbChlMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBDb3Ntb3NSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IENvc21vc1Jlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvaWNxLnYxLkNvc21vc1Jlc3BvbnNlXCIsIHZhbHVlOiBDb3Ntb3NSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgVHlwZTtcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5UWVBFX1VOU1BFQ0lGSUVEID0gMF0gPSBcIlRZUEVfVU5TUEVDSUZJRURcIiwgZTJbZTIuVFlQRV9FWEVDVVRFX1RYID0gMV0gPSBcIlRZUEVfRVhFQ1VURV9UWFwiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShUeXBlIHx8IChUeXBlID0ge30pKTtcblxuLy9cbmZ1bmN0aW9uIG1ha2VUeFBhY2tldChtc2dzLCBvcHRzKSB7XG4gIGNvbnN0IG1lc3NhZ2VzID0gbXNncy5tYXAoQW55LmZyb21KU09OKTtcbiAgY29uc3QgYnl0ZXMgPSBUeEJvZHkuZW5jb2RlKFxuICAgIFR4Qm9keS5mcm9tUGFydGlhbCh7XG4gICAgICBtZXNzYWdlcyxcbiAgICAgIC4uLm9wdHNcbiAgICB9KVxuICApLmZpbmlzaCgpO1xuICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHtcbiAgICAgIHR5cGU6IFR5cGUuVFlQRV9FWEVDVVRFX1RYLFxuICAgICAgZGF0YTogZW5jb2RlQmFzZTY0KGJ5dGVzKSxcbiAgICAgIG1lbW86IFwiXCJcbiAgICB9XG4gICk7XG59XG5oYXJkZW4obWFrZVR4UGFja2V0KTtcbmZ1bmN0aW9uIG1ha2VRdWVyeVBhY2tldChtc2dzKSB7XG4gIGNvbnN0IGJ5dGVzID0gQ29zbW9zUXVlcnkuZW5jb2RlKFxuICAgIENvc21vc1F1ZXJ5LmZyb21QYXJ0aWFsKHtcbiAgICAgIHJlcXVlc3RzOiBtc2dzLm1hcChSZXF1ZXN0UXVlcnkuZnJvbUpTT04pXG4gICAgfSlcbiAgKS5maW5pc2goKTtcbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAge1xuICAgICAgZGF0YTogZW5jb2RlQmFzZTY0KGJ5dGVzKSxcbiAgICAgIG1lbW86IFwiXCJcbiAgICB9XG4gICk7XG59XG5oYXJkZW4obWFrZVF1ZXJ5UGFja2V0KTtcbmZ1bmN0aW9uIHBhcnNlVHhQYWNrZXQocmVzcG9uc2UpIHtcbiAgY29uc3QgeyByZXN1bHQsIGVycm9yIH0gPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcbiAgaWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDtcbiAgZWxzZSBpZiAoZXJyb3IpIHRocm93IEVycm9yKGVycm9yKTtcbiAgZWxzZSB0aHJvdyB0aHJvd1JlZGFjdGVkYGV4cGVjdGVkIGVpdGhlciByZXN1bHQgb3IgZXJyb3I6ICR7cmVzcG9uc2V9YDtcbn1cbmhhcmRlbihwYXJzZVR4UGFja2V0KTtcbmZ1bmN0aW9uIHBhcnNlUXVlcnlQYWNrZXQocmVzcG9uc2UpIHtcbiAgY29uc3QgcmVzdWx0ID0gcGFyc2VUeFBhY2tldChyZXNwb25zZSk7XG4gIGNvbnN0IHsgZGF0YSB9ID0gSlNPTi5wYXJzZShhdG9iKHJlc3VsdCkpO1xuICBjb25zdCB7IHJlc3BvbnNlcyA9IFtdIH0gPSBDb3Ntb3NSZXNwb25zZS5kZWNvZGUoZGVjb2RlQmFzZTY0KGRhdGEpKTtcbiAgcmV0dXJuIGhhcmRlbihyZXNwb25zZXMubWFwKFJlc3BvbnNlUXVlcnkudG9KU09OKSk7XG59XG5oYXJkZW4ocGFyc2VRdWVyeVBhY2tldCk7XG5cbi8vXG52YXIgdHJhY2UgPSBtYWtlVHJhY2VyKFwiSWNhQWNjb3VudEtpdFwiKTtcbnZhciBVTlBBUlNBQkxFX0NIQUlOX0FERFJFU1MgPSBcIlVOUEFSU0FCTEVfQ0hBSU5fQUREUkVTU1wiO1xudmFyIEljYUFjY291bnRJID0gTS5pbnRlcmZhY2UoXCJJY2FBY2NvdW50XCIsIHtcbiAgZ2V0QWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSksXG4gIGdldExvY2FsQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgZ2V0UmVtb3RlQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgZ2V0UG9ydDogTS5jYWxsKCkucmV0dXJucyhNLnJlbW90YWJsZShcIlBvcnRcIikpLFxuICBleGVjdXRlVHg6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoVm93U2hhcGUpLFxuICBleGVjdXRlRW5jb2RlZFR4OiBNLmNhbGwoTS5hcnJheU9mKFByb3RvM1NoYXBlKSkub3B0aW9uYWwoRXhlY3V0ZUlDQVR4T3B0c1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZGVhY3RpdmF0ZTogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIHJlYWN0aXZhdGU6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpXG59KTtcbnZhciBwcmVwYXJlSWNhQWNjb3VudEtpdCA9ICh6b25lLCB7IHdhdGNoLCBhc1ZvdyB9KSA9PiB6b25lLmV4b0NsYXNzS2l0KFxuICBcIkljYUFjY291bnRLaXRcIixcbiAge1xuICAgIGFjY291bnQ6IEljYUFjY291bnRJLFxuICAgIGNvbm5lY3Rpb25IYW5kbGVyOiBPdXRib3VuZENvbm5lY3Rpb25IYW5kbGVySSxcbiAgICBwYXJzZVR4UGFja2V0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQYXJzZVR4UGFja2V0V2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhNLnN0cmluZygpKVxuICAgIH0pXG4gIH0sXG4gIC8qXG5cblxuXG4gICAqL1xuICAoY2hhaW5JZCwgcG9ydCwgcmVxdWVzdGVkUmVtb3RlQWRkcmVzcykgPT4gKFxuICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAge1xuICAgICAgY2hhaW5JZCxcbiAgICAgIHBvcnQsXG4gICAgICBjb25uZWN0aW9uOiB2b2lkIDAsXG4gICAgICByZXF1ZXN0ZWRSZW1vdGVBZGRyZXNzLFxuICAgICAgcmVtb3RlQWRkcmVzczogdm9pZCAwLFxuICAgICAgY2hhaW5BZGRyZXNzOiB2b2lkIDAsXG4gICAgICBsb2NhbEFkZHJlc3M6IHZvaWQgMCxcbiAgICAgIGlzSW5pdGlhdGluZ0Nsb3NlOiBmYWxzZVxuICAgIH1cbiAgKSxcbiAge1xuICAgIHBhcnNlVHhQYWNrZXRXYXRjaGVyOiB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoYWNrKSB7XG4gICAgICAgIHJldHVybiBwYXJzZVR4UGFja2V0KGFjayk7XG4gICAgICB9XG4gICAgfSxcbiAgICBhY2NvdW50OiB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGdldEFkZHJlc3MoKSB7XG4gICAgICAgIHJldHVybiBOb25OdWxsaXNoKFxuICAgICAgICAgIHRoaXMuc3RhdGUuY2hhaW5BZGRyZXNzLFxuICAgICAgICAgIFwiSUNBIGNoYW5uZWwgY3JlYXRpb24gYWNrbm93bGVkZ2VtZW50IG5vdCB5ZXQgcmVjZWl2ZWQuXCJcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBnZXRMb2NhbEFkZHJlc3MoKSB7XG4gICAgICAgIHJldHVybiBOb25OdWxsaXNoKFxuICAgICAgICAgIHRoaXMuc3RhdGUubG9jYWxBZGRyZXNzLFxuICAgICAgICAgIFwibG9jYWwgYWRkcmVzcyBub3QgYXZhaWxhYmxlXCJcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBnZXRSZW1vdGVBZGRyZXNzKCkge1xuICAgICAgICByZXR1cm4gTm9uTnVsbGlzaChcbiAgICAgICAgICB0aGlzLnN0YXRlLnJlbW90ZUFkZHJlc3MsXG4gICAgICAgICAgXCJyZW1vdGUgYWRkcmVzcyBub3QgYXZhaWxhYmxlXCJcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBnZXRQb3J0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5wb3J0O1xuICAgICAgfSxcbiAgICAgIGV4ZWN1dGVUeCgpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHRocm93UmVkYWN0ZWRgbm90IHlldCBpbXBsZW1lbnRlZGApO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGV4ZWN1dGVFbmNvZGVkVHgobXNncywgb3B0cyA9IHt9KSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBjb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICghY29ubmVjdGlvbikge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBBY2NvdW50IG5vdCBhdmFpbGFibGUgb3IgZGVhY3RpdmF0ZWQuYDtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgeyBzZW5kT3B0cywgLi4udHhCb2R5T3B0cyB9ID0gb3B0cztcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKGNvbm5lY3Rpb24pLnNlbmQobWFrZVR4UGFja2V0KG1zZ3MsIHR4Qm9keU9wdHMpLCBzZW5kT3B0cyksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5wYXJzZVR4UGFja2V0V2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBkZWFjdGl2YXRlKCkge1xuICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgY29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoIWNvbm5lY3Rpb24pIHRocm93IHRocm93UmVkYWN0ZWRgQWNjb3VudCBub3QgYXZhaWxhYmxlIG9yIGRlYWN0aXZhdGVkLmA7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5pc0luaXRpYXRpbmdDbG9zZSA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuIEUoY29ubmVjdGlvbikuY2xvc2UoKTtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHJlYWN0aXZhdGUoKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBjb25uZWN0aW9uLCBwb3J0LCByZXF1ZXN0ZWRSZW1vdGVBZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChjb25uZWN0aW9uKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEFjY291bnQgaXMgYWxyZWFkeSBhY3RpdmUuYDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgRShwb3J0KS5jb25uZWN0KFxuICAgICAgICAgICAgICByZXF1ZXN0ZWRSZW1vdGVBZGRyZXNzLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5jb25uZWN0aW9uSGFuZGxlclxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgY29ubmVjdGlvbkhhbmRsZXI6IHtcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIG9uT3Blbihjb25uZWN0aW9uLCBsb2NhbEFkZHIsIHJlbW90ZUFkZHIpIHtcbiAgICAgICAgdHJhY2UoYElDQSBDaGFubmVsIE9wZW5lZCBmb3IgJHtsb2NhbEFkZHJ9IGF0ICR7cmVtb3RlQWRkcn1gKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcbiAgICAgICAgdGhpcy5zdGF0ZS5yZW1vdGVBZGRyZXNzID0gcmVtb3RlQWRkcjtcbiAgICAgICAgdGhpcy5zdGF0ZS5sb2NhbEFkZHJlc3MgPSBsb2NhbEFkZHI7XG4gICAgICAgIGNvbnN0IGFkZHJlc3MgPSBmaW5kQWRkcmVzc0ZpZWxkKHJlbW90ZUFkZHIpO1xuICAgICAgICBpZiAoIWFkZHJlc3MpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiXFx1MjZBMFxcdUZFMEYgZmFpbGVkIHRvIHBhcnNlIGNoYWluIGFkZHJlc3NcIiwgcmVtb3RlQWRkcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zdGF0ZS5jaGFpbkFkZHJlc3MgPSBoYXJkZW4oe1xuICAgICAgICAgIHZhbHVlOiBhZGRyZXNzIHx8IFVOUEFSU0FCTEVfQ0hBSU5fQUREUkVTUyxcbiAgICAgICAgICBjaGFpbklkOiB0aGlzLnN0YXRlLmNoYWluSWQsXG4gICAgICAgICAgZW5jb2Rpbmc6IFwiYmVjaDMyXCJcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgYXN5bmMgb25DbG9zZShfY29ubmVjdGlvbiwgcmVhc29uKSB7XG4gICAgICAgIHRyYWNlKGBJQ0EgQ2hhbm5lbCBjbG9zZWQuIFJlYXNvbjogJHtyZWFzb259YCk7XG4gICAgICAgIHRoaXMuc3RhdGUuY29ubmVjdGlvbiA9IHZvaWQgMDtcbiAgICAgICAgdGhpcy5zdGF0ZS5sb2NhbEFkZHJlc3MgPSB2b2lkIDA7XG4gICAgICAgIHRoaXMuc3RhdGUucmVtb3RlQWRkcmVzcyA9IHZvaWQgMDtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaXNJbml0aWF0aW5nQ2xvc2UgPT09IHRydWUpIHtcbiAgICAgICAgICB0cmFjZShcIkFjY291bnQgZGVhY3RpdmF0ZWQgYnkgaG9sZGVyLiBTa2lwcGluZyByZWFjdGl2YXRpb24uXCIpO1xuICAgICAgICAgIHRoaXMuc3RhdGUuaXNJbml0aWF0aW5nQ2xvc2UgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0cmFjZShcIkFjY291bnQgY2xvc2VkIHVuZXhwZWN0ZWRseS4gQXV0b21hdGljYWxseSByZWFjdGl2YXRpbmcuXCIpO1xuICAgICAgICAgIHZvaWQgd2F0Y2godGhpcy5mYWNldHMuYWNjb3VudC5yZWFjdGl2YXRlKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4pO1xuXG4vL1xudmFyIHRyYWNlMiA9IG1ha2VUcmFjZXIoXCJPcmNoZXN0cmF0aW9uOklDUUNvbm5lY3Rpb25cIik7XG52YXIgSUNRQ29ubmVjdGlvbkkgPSBNLmludGVyZmFjZShcIklDUUNvbm5lY3Rpb25cIiwge1xuICBnZXRMb2NhbEFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIGdldFJlbW90ZUFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIHF1ZXJ5OiBNLmNhbGwoTS5hcnJheU9mKElDUU1zZ1NoYXBlKSkucmV0dXJucyhWb3dTaGFwZSlcbn0pO1xudmFyIHByZXBhcmVJQ1FDb25uZWN0aW9uS2l0ID0gKHpvbmUsIHsgd2F0Y2gsIGFzVm93IH0pID0+IHpvbmUuZXhvQ2xhc3NLaXQoXG4gIFwiSUNRQ29ubmVjdGlvbktpdFwiLFxuICB7XG4gICAgY29ubmVjdGlvbjogSUNRQ29ubmVjdGlvbkksXG4gICAgY29ubmVjdGlvbkhhbmRsZXI6IE91dGJvdW5kQ29ubmVjdGlvbkhhbmRsZXJJLFxuICAgIHBhcnNlUXVlcnlQYWNrZXRXYXRjaGVyOiBNLmludGVyZmFjZShcIlBhcnNlUXVlcnlQYWNrZXRXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKE0uYXJyYXlPZihNLnJlY29yZCgpKSlcbiAgICB9KVxuICB9LFxuICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gIChwb3J0KSA9PiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAge1xuICAgICAgcG9ydCxcbiAgICAgIGNvbm5lY3Rpb246IHZvaWQgMCxcbiAgICAgIHJlbW90ZUFkZHJlc3M6IHZvaWQgMCxcbiAgICAgIGxvY2FsQWRkcmVzczogdm9pZCAwXG4gICAgfVxuICApLFxuICB7XG4gICAgY29ubmVjdGlvbjoge1xuICAgICAgZ2V0TG9jYWxBZGRyZXNzKCkge1xuICAgICAgICByZXR1cm4gTm9uTnVsbGlzaChcbiAgICAgICAgICB0aGlzLnN0YXRlLmxvY2FsQWRkcmVzcyxcbiAgICAgICAgICBcImxvY2FsIGFkZHJlc3Mgbm90IGF2YWlsYWJsZVwiXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgZ2V0UmVtb3RlQWRkcmVzcygpIHtcbiAgICAgICAgcmV0dXJuIE5vbk51bGxpc2goXG4gICAgICAgICAgdGhpcy5zdGF0ZS5yZW1vdGVBZGRyZXNzLFxuICAgICAgICAgIFwicmVtb3RlIGFkZHJlc3Mgbm90IGF2YWlsYWJsZVwiXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuICAgICAgICovXG4gICAgICBxdWVyeShtc2dzKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBjb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICghY29ubmVjdGlvbikgdGhyb3cgdGhyb3dSZWRhY3RlZGBjb25uZWN0aW9uIG5vdCBhdmFpbGFibGVgO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUoY29ubmVjdGlvbikuc2VuZChtYWtlUXVlcnlQYWNrZXQobXNncykpLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMucGFyc2VRdWVyeVBhY2tldFdhdGNoZXJcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHBhcnNlUXVlcnlQYWNrZXRXYXRjaGVyOiB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoYWNrKSB7XG4gICAgICAgIHJldHVybiBwYXJzZVF1ZXJ5UGFja2V0KGFjayk7XG4gICAgICB9XG4gICAgfSxcbiAgICBjb25uZWN0aW9uSGFuZGxlcjoge1xuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgYXN5bmMgb25PcGVuKGNvbm5lY3Rpb24sIGxvY2FsQWRkciwgcmVtb3RlQWRkcikge1xuICAgICAgICB0cmFjZTIoYElDUSBDaGFubmVsIE9wZW5lZCBmb3IgJHtsb2NhbEFkZHJ9IGF0ICR7cmVtb3RlQWRkcn1gKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcbiAgICAgICAgdGhpcy5zdGF0ZS5yZW1vdGVBZGRyZXNzID0gcmVtb3RlQWRkcjtcbiAgICAgICAgdGhpcy5zdGF0ZS5sb2NhbEFkZHJlc3MgPSBsb2NhbEFkZHI7XG4gICAgICB9LFxuICAgICAgYXN5bmMgb25DbG9zZShfY29ubmVjdGlvbiwgcmVhc29uKSB7XG4gICAgICAgIHRyYWNlMihgSUNRIENoYW5uZWwgY2xvc2VkLiBSZWFzb246ICR7cmVhc29ufWApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuKTtcblxuLy9cbnZhciB7IFZvdyQgfSA9IFNoYXBlO1xudmFyIGdldElDUUNvbm5lY3Rpb25LZXkgPSAoY29udHJvbGxlckNvbm5lY3Rpb25JZCwgdmVyc2lvbikgPT4ge1xuICByZXR1cm4gYCR7Y29udHJvbGxlckNvbm5lY3Rpb25JZH06JHt2ZXJzaW9uIHx8IERFRkFVTFRfSUNRX1ZFUlNJT059YDtcbn07XG52YXIgcHJlcGFyZUNvc21vc09yY2hlc3RyYXRpb25TZXJ2aWNlS2l0ID0gKHpvbmUsIHsgd2F0Y2gsIGFzVm93IH0sIG1ha2VJY2FBY2NvdW50S2l0LCBtYWtlSUNRQ29ubmVjdGlvbktpdCkgPT4gem9uZS5leG9DbGFzc0tpdChcbiAgXCJPcmNoZXN0cmF0aW9uXCIsXG4gIHtcbiAgICByZXF1ZXN0SUNBQ2hhbm5lbFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUmVxdWVzdElDQUNoYW5uZWxXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5yZW1vdGFibGUoXCJQb3J0XCIpKS5vcHRpb25hbCh7IGNoYWluSWQ6IE0uc3RyaW5nKCksIHJlbW90ZUNvbm5BZGRyOiBNLnN0cmluZygpIH0pLnJldHVybnMoVm93JChTaGFwZS5Db25uZWN0aW9uKSlcbiAgICB9KSxcbiAgICByZXF1ZXN0SUNRQ2hhbm5lbFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUmVxdWVzdElDUUNoYW5uZWxXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5yZW1vdGFibGUoXCJQb3J0XCIpKS5vcHRpb25hbCh7XG4gICAgICAgIHJlbW90ZUNvbm5BZGRyOiBNLnN0cmluZygpLFxuICAgICAgICBpY3FMb29rdXBLZXk6IE0uc3RyaW5nKClcbiAgICAgIH0pLnJldHVybnMoVm93JChTaGFwZS5Db25uZWN0aW9uKSlcbiAgICB9KSxcbiAgICBjaGFubmVsT3BlbldhdGNoZXI6IE0uaW50ZXJmYWNlKFwiQ2hhbm5lbE9wZW5XYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5yZW1vdGFibGUoXCJDb25uZWN0aW9uXCIpKS5vcHRpb25hbChcbiAgICAgICAgTS5zcGxpdFJlY29yZChcbiAgICAgICAgICB7IGNvbm5lY3Rpb25LaXQ6IE0ucmVjb3JkKCksIHJldHVybkZhY2V0OiBNLnN0cmluZygpIH0sXG4gICAgICAgICAgeyBpY3FMb29rdXBLZXk6IE0uc3RyaW5nKCkgfVxuICAgICAgICApXG4gICAgICApLnJldHVybnMoTS5yZW1vdGFibGUoXCJDb25uZWN0aW9uS2l0IEhvbGRlciBmYWNldFwiKSlcbiAgICB9KSxcbiAgICBwdWJsaWM6IE0uaW50ZXJmYWNlKFwiQ29zbW9zSW50ZXJjaGFpblNlcnZpY2VcIiwge1xuICAgICAgbWFrZUFjY291bnQ6IE0uY2FsbChNLnN0cmluZygpLCBNLnN0cmluZygpLCBNLnN0cmluZygpKS5vcHRpb25hbChNLnJlY29yZCgpKS5yZXR1cm5zKFZvdyQoTS5yZW1vdGFibGUoXCJJY2FBY2NvdW50S2l0XCIpKSksXG4gICAgICBwcm92aWRlSUNRQ29ubmVjdGlvbjogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoVm93JChNLnJlbW90YWJsZShcIklDUUNvbm5lY3Rpb25cIikpKVxuICAgIH0pXG4gIH0sXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAocG93ZXJzKSA9PiB7XG4gICAgbXVzdE1hdGNoKHBvd2Vycz8ucG9ydEFsbG9jYXRvciwgTS5yZW1vdGFibGUoXCJQb3J0QWxsb2NhdG9yXCIpKTtcbiAgICBjb25zdCBpY3FDb25uZWN0aW9ucyA9IHpvbmUuZGV0YWNoZWQoKS5tYXBTdG9yZShcIklDUUNvbm5lY3Rpb25zXCIpO1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHtcbiAgICAgICAgaWNxQ29ubmVjdGlvbnMsXG4gICAgICAgIHNoYXJlZElDUVBvcnQ6IHZvaWQgMCxcbiAgICAgICAgcmVzZXJ2ZWQ6IHZvaWQgMCxcbiAgICAgICAgLi4ucG93ZXJzXG4gICAgICB9XG4gICAgKTtcbiAgfSxcbiAge1xuICAgIHJlcXVlc3RJQ0FDaGFubmVsV2F0Y2hlcjoge1xuICAgICAgLypcblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKHBvcnQsIHsgY2hhaW5JZCwgcmVtb3RlQ29ubkFkZHIgfSkge1xuICAgICAgICBjb25zdCBjb25uZWN0aW9uS2l0ID0gbWFrZUljYUFjY291bnRLaXQoXG4gICAgICAgICAgY2hhaW5JZCxcbiAgICAgICAgICBwb3J0LFxuICAgICAgICAgIHJlbW90ZUNvbm5BZGRyXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICBFKHBvcnQpLmNvbm5lY3QocmVtb3RlQ29ubkFkZHIsIGNvbm5lY3Rpb25LaXQuY29ubmVjdGlvbkhhbmRsZXIpLFxuICAgICAgICAgIHRoaXMuZmFjZXRzLmNoYW5uZWxPcGVuV2F0Y2hlcixcbiAgICAgICAgICB7IHJldHVybkZhY2V0OiBcImFjY291bnRcIiwgY29ubmVjdGlvbktpdCB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcbiAgICByZXF1ZXN0SUNRQ2hhbm5lbFdhdGNoZXI6IHtcbiAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChwb3J0LCB7IHJlbW90ZUNvbm5BZGRyLCBpY3FMb29rdXBLZXkgfSkge1xuICAgICAgICBpZiAoIXRoaXMuc3RhdGUuc2hhcmVkSUNRUG9ydCkge1xuICAgICAgICAgIHRoaXMuc3RhdGUuc2hhcmVkSUNRUG9ydCA9IHBvcnQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29ubmVjdGlvbktpdCA9IG1ha2VJQ1FDb25uZWN0aW9uS2l0KHBvcnQpO1xuICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgRShwb3J0KS5jb25uZWN0KHJlbW90ZUNvbm5BZGRyLCBjb25uZWN0aW9uS2l0LmNvbm5lY3Rpb25IYW5kbGVyKSxcbiAgICAgICAgICB0aGlzLmZhY2V0cy5jaGFubmVsT3BlbldhdGNoZXIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgY29ubmVjdGlvbktpdCxcbiAgICAgICAgICAgIHJldHVybkZhY2V0OiBcImNvbm5lY3Rpb25cIixcbiAgICAgICAgICAgIGljcUxvb2t1cEtleVxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qXG5cblxuXG4gICAgICovXG4gICAgY2hhbm5lbE9wZW5XYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChfY29ubmVjdGlvbiwgeyBjb25uZWN0aW9uS2l0LCByZXR1cm5GYWNldCwgaWNxTG9va3VwS2V5IH0pIHtcbiAgICAgICAgaWYgKGljcUxvb2t1cEtleSkge1xuICAgICAgICAgIHRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbnMuaW5pdChcbiAgICAgICAgICAgIGljcUxvb2t1cEtleSxcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGNvbm5lY3Rpb25LaXRcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb25uZWN0aW9uS2l0W3JldHVybkZhY2V0XTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHB1YmxpYzoge1xuICAgICAgLypcblxuXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG1ha2VBY2NvdW50KGNoYWluSWQsIGhvc3RDb25uZWN0aW9uSWQsIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsIG9wdHMpIHtcbiAgICAgICAgY29uc3QgcmVtb3RlQ29ubkFkZHIgPSBtYWtlSUNBQ2hhbm5lbEFkZHJlc3MoXG4gICAgICAgICAgaG9zdENvbm5lY3Rpb25JZCxcbiAgICAgICAgICBjb250cm9sbGVyQ29ubmVjdGlvbklkLFxuICAgICAgICAgIG9wdHNcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgeyBwb3J0QWxsb2NhdG9yIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgRShwb3J0QWxsb2NhdG9yKS5hbGxvY2F0ZUlDQUNvbnRyb2xsZXJQb3J0KCksXG4gICAgICAgICAgdGhpcy5mYWNldHMucmVxdWVzdElDQUNoYW5uZWxXYXRjaGVyLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGNoYWluSWQsXG4gICAgICAgICAgICByZW1vdGVDb25uQWRkclxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHByb3ZpZGVJQ1FDb25uZWN0aW9uKGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsIHZlcnNpb24pIHtcbiAgICAgICAgY29uc3QgaWNxTG9va3VwS2V5ID0gZ2V0SUNRQ29ubmVjdGlvbktleShcbiAgICAgICAgICBjb250cm9sbGVyQ29ubmVjdGlvbklkLFxuICAgICAgICAgIHZlcnNpb25cbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbnMuaGFzKGljcUxvb2t1cEtleSkpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coXG4gICAgICAgICAgICAoKSA9PiB0aGlzLnN0YXRlLmljcUNvbm5lY3Rpb25zLmdldChpY3FMb29rdXBLZXkpLmNvbm5lY3Rpb25cbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJlbW90ZUNvbm5BZGRyID0gbWFrZUlDUUNoYW5uZWxBZGRyZXNzKFxuICAgICAgICAgIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsXG4gICAgICAgICAgdmVyc2lvblxuICAgICAgICApO1xuICAgICAgICBjb25zdCB7IHBvcnRBbGxvY2F0b3IsIHNoYXJlZElDUVBvcnQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHBvcnRPclBvcnRWb3cgPSBzaGFyZWRJQ1FQb3J0IHx8IEUocG9ydEFsbG9jYXRvcikuYWxsb2NhdGVJQ1FDb250cm9sbGVyUG9ydCgpO1xuICAgICAgICByZXR1cm4gd2F0Y2gocG9ydE9yUG9ydFZvdywgdGhpcy5mYWNldHMucmVxdWVzdElDUUNoYW5uZWxXYXRjaGVyLCB7XG4gICAgICAgICAgcmVtb3RlQ29ubkFkZHIsXG4gICAgICAgICAgaWNxTG9va3VwS2V5XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAge1xuICAgIHN0YXRlU2hhcGU6IHtcbiAgICAgIGljcUNvbm5lY3Rpb25zOiBNLnJlbW90YWJsZShcImljcUNvbm5lY3Rpb25zIG1hcFN0b3JlXCIpLFxuICAgICAgc2hhcmVkSUNRUG9ydDogTS5vcihNLnJlbW90YWJsZShcIlBvcnRcIiksIE0udW5kZWZpbmVkKCkpLFxuICAgICAgcG9ydEFsbG9jYXRvcjogTS5yZW1vdGFibGUoXCJQb3J0QWxsb2NhdG9yXCIpLFxuICAgICAgcmVzZXJ2ZWQ6IE0uYW55KClcbiAgICB9XG4gIH1cbik7XG52YXIgcHJlcGFyZUNvc21vc0ludGVyY2hhaW5TZXJ2aWNlID0gKHpvbmUsIHZvd1Rvb2xzKSA9PiB7XG4gIGNvbnN0IG1ha2VJY2FBY2NvdW50S2l0ID0gcHJlcGFyZUljYUFjY291bnRLaXQoem9uZSwgdm93VG9vbHMpO1xuICBjb25zdCBtYWtlSUNRQ29ubmVjdGlvbktpdCA9IHByZXBhcmVJQ1FDb25uZWN0aW9uS2l0KHpvbmUsIHZvd1Rvb2xzKTtcbiAgY29uc3QgbWFrZUNvc21vc09yY2hlc3RyYXRpb25TZXJ2aWNlS2l0ID0gcHJlcGFyZUNvc21vc09yY2hlc3RyYXRpb25TZXJ2aWNlS2l0KFxuICAgIHpvbmUsXG4gICAgdm93VG9vbHMsXG4gICAgbWFrZUljYUFjY291bnRLaXQsXG4gICAgbWFrZUlDUUNvbm5lY3Rpb25LaXRcbiAgKTtcbiAgY29uc3QgbWFrZUNvc21vc0ludGVyY2hhaW5TZXJ2aWNlID0gcGlja0ZhY2V0KFxuICAgIG1ha2VDb3Ntb3NPcmNoZXN0cmF0aW9uU2VydmljZUtpdCxcbiAgICBcInB1YmxpY1wiXG4gICk7XG4gIHJldHVybiBtYWtlQ29zbW9zSW50ZXJjaGFpblNlcnZpY2U7XG59O1xuaGFyZGVuKHByZXBhcmVDb3Ntb3NJbnRlcmNoYWluU2VydmljZSk7XG5cbi8vXG52YXIgbWFrZUNvbnZlcnQgPSAoY29udmVydFJlbW90YWJsZSwgY29udmVydFByb21pc2VPclZvdywgY29udmVydEVycm9yKSA9PiB7XG4gIGNvbnN0IGNvbnZlcnRSZWN1ciA9IChzcGVjaW1lbiwgbGFiZWwpID0+IHtcbiAgICBpZiAobGFiZWwgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGlubmVyQ29udmVydChzcGVjaW1lbik7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gaW5uZXJDb252ZXJ0KHNwZWNpbWVuKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRocm93TGFiZWxlZChlcnIsIGxhYmVsKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGlubmVyQ29udmVydCA9IChzcGVjaW1lbikgPT4ge1xuICAgIGlmICghaXNPYmplY3QyKHNwZWNpbWVuKSkge1xuICAgICAgcmV0dXJuIHNwZWNpbWVuO1xuICAgIH1cbiAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihzcGVjaW1lbik7XG4gICAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICByZXR1cm4gc3BlY2ltZW4ubWFwKChlbGVtZW50LCBpMikgPT4gY29udmVydFJlY3VyKGVsZW1lbnQsIGkyKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIHJldHVybiBvYmplY3RNYXAoc3BlY2ltZW4sICh2YWx1ZSwgbmFtZSkgPT4gY29udmVydFJlY3VyKHZhbHVlLCBuYW1lKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgaWYgKGlzVm93KHNwZWNpbWVuKSkge1xuICAgICAgICAgIHJldHVybiBjb252ZXJ0UHJvbWlzZU9yVm93KHNwZWNpbWVuKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0YWcgPSBnZXRUYWcoc3BlY2ltZW4pO1xuICAgICAgICBjb25zdCB7IHBheWxvYWQgfSA9IHNwZWNpbWVuO1xuICAgICAgICByZXR1cm4gbWFrZVRhZ2dlZCh0YWcsIGNvbnZlcnRSZWN1cihwYXlsb2FkLCBgJHt0YWd9IHBheWxvYWRgKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICByZXR1cm4gY29udmVydEVycm9yKHNwZWNpbWVuKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgICByZXR1cm4gY29udmVydFJlbW90YWJsZShzcGVjaW1lbik7XG4gICAgICB9XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHJldHVybiBjb252ZXJ0UHJvbWlzZU9yVm93KHNwZWNpbWVuKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIHBhc3NTdHlsZSAke3F1b3RlKHBhc3NTdHlsZSl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IGNvbnZlcnQgPSAoc3BlY2ltZW4sIGxhYmVsID0gdm9pZCAwKSA9PiBjb252ZXJ0UmVjdXIoaGFyZGVuKHNwZWNpbWVuKSwgbGFiZWwpO1xuICByZXR1cm4gaGFyZGVuKGNvbnZlcnQpO1xufTtcbnZhciBtYWtlQ29udmVydEtpdCA9IChiaWplY3Rpb24sIG1ha2VHdWVzdEZvckhvc3RSZW1vdGFibGUsIG1ha2VHdWVzdEZvckhvc3RWb3cpID0+IHtcbiAgY29uc3QgZ3Vlc3RUb0hvc3QgPSBtYWtlQ29udmVydChcbiAgICAoZ1JlbSkgPT4ge1xuICAgICAgaWYgKGJpamVjdGlvbi5oYXNHdWVzdChnUmVtKSkge1xuICAgICAgICByZXR1cm4gYmlqZWN0aW9uLmd1ZXN0VG9Ib3N0KGdSZW0pO1xuICAgICAgfVxuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBjYW5ub3QgeWV0IHNlbmQgZ3Vlc3QgcmVtb3RhYmxlcyAke2dSZW19YDtcbiAgICB9LFxuICAgIChnUHJvbSkgPT4ge1xuICAgICAgaWYgKGJpamVjdGlvbi5oYXNHdWVzdChnUHJvbSkpIHtcbiAgICAgICAgcmV0dXJuIGJpamVjdGlvbi5ndWVzdFRvSG9zdChnUHJvbSk7XG4gICAgICB9XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGNhbm5vdCB5ZXQgc2VuZCBndWVzdCBwcm9taXNlcyAke2dQcm9tfWA7XG4gICAgfSxcbiAgICAoZ0VycikgPT4ge1xuICAgICAgY29uc3QgaEVyciA9IGhhcmRlbihcbiAgICAgICAgbWFrZUVycm9yKGdFcnIubWVzc2FnZSwgZ2V0RXJyb3JDb25zdHJ1Y3RvcihnRXJyLm5hbWUpKVxuICAgICAgKTtcbiAgICAgIG5vdGUoaEVyciwgcmVkYWN0ZWRgZnJvbSBndWVzdCBlcnJvciAke2dFcnJ9YCk7XG4gICAgICByZXR1cm4gaEVycjtcbiAgICB9XG4gICk7XG4gIGNvbnN0IGhvc3RUb0d1ZXN0ID0gbWFrZUNvbnZlcnQoXG4gICAgKGhSZW0pID0+IHtcbiAgICAgIGlmIChiaWplY3Rpb24uaGFzSG9zdChoUmVtKSkge1xuICAgICAgICByZXR1cm4gYmlqZWN0aW9uLmhvc3RUb0d1ZXN0KGhSZW0pO1xuICAgICAgfVxuICAgICAgY29uc3QgZ1JlbSA9IG1ha2VHdWVzdEZvckhvc3RSZW1vdGFibGUoaFJlbSk7XG4gICAgICByZXR1cm4gYmlqZWN0aW9uLnVud3JhcEluaXQoZ1JlbSwgaFJlbSk7XG4gICAgfSxcbiAgICAoaFZvdykgPT4ge1xuICAgICAgaWYgKGJpamVjdGlvbi5oYXNIb3N0KGhWb3cpKSB7XG4gICAgICAgIHJldHVybiBiaWplY3Rpb24uaG9zdFRvR3Vlc3QoaFZvdyk7XG4gICAgICB9XG4gICAgICBjb25zdCBnUCA9IG1ha2VHdWVzdEZvckhvc3RWb3coaFZvdyk7XG4gICAgICByZXR1cm4gYmlqZWN0aW9uLnVud3JhcEluaXQoZ1AsIGhWb3cpO1xuICAgIH0sXG4gICAgKGhFcnIpID0+IHtcbiAgICAgIGNvbnN0IGdFcnIgPSBoYXJkZW4oXG4gICAgICAgIG1ha2VFcnJvcihoRXJyLm1lc3NhZ2UsIGdldEVycm9yQ29uc3RydWN0b3IoaEVyci5uYW1lKSlcbiAgICAgICk7XG4gICAgICBub3RlKGdFcnIsIHJlZGFjdGVkYGZyb20gaG9zdCBlcnJvciAke2hFcnJ9YCk7XG4gICAgICByZXR1cm4gZ0VycjtcbiAgICB9XG4gICk7XG4gIHJldHVybiBoYXJkZW4oeyBndWVzdFRvSG9zdCwgaG9zdFRvR3Vlc3QgfSk7XG59O1xuaGFyZGVuKG1ha2VDb252ZXJ0S2l0KTtcblxuLy9cbnZhciB7IGlzOiBpczUgfSA9IE9iamVjdDtcbnZhciBtYWtlRXF1YXRlID0gKGJpamVjdGlvbikgPT4ge1xuICBjb25zdCBlcXVhdGUgPSAoZzMsIGgsIGxhYmVsKSA9PiB7XG4gICAgaWYgKGxhYmVsID09PSB2b2lkIDApIHtcbiAgICAgIGlubmVyRXF1YXRlKGczLCBoKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGlubmVyRXF1YXRlKGczLCBoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHRocm93TGFiZWxlZChlcnIsIGxhYmVsKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGlubmVyRXF1YXRlID0gKGczLCBoKSA9PiB7XG4gICAgaWYgKCFpc09iamVjdDIoZzMpKSB7XG4gICAgICBpczUoZzMsIGgpIHx8IC8vXG4gICAgICB0aHJvd1JlZGFjdGVkYHVuZXF1YWwgJHtnM30gdnMgJHtofWA7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChiaWplY3Rpb24uaGFzR3Vlc3QoZzMpICYmIGJpamVjdGlvbi5ndWVzdFRvSG9zdChnMykgPT09IGgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZ1Bhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKGczKTtcbiAgICBpZiAoZ1Bhc3NTdHlsZSA9PT0gXCJwcm9taXNlXCIgJiYgaXNWb3coaCkpIHtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgZ3Vlc3QgcHJvbWlzZXMgbm90IHlldCBwYXNzYWJsZWA7XG4gICAgfVxuICAgIGNvbnN0IGhQYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihoKTtcbiAgICBnUGFzc1N0eWxlID09PSBoUGFzc1N0eWxlIHx8IHRocm93UmVkYWN0ZWRgdW5lcXVhbCBwYXNzU3R5bGVzICR7cXVvdGUoZ1Bhc3NTdHlsZSl9IHZzICR7cXVvdGUoaFBhc3NTdHlsZSl9YDtcbiAgICBzd2l0Y2ggKGdQYXNzU3R5bGUpIHtcbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICBlcXVhdGUoZzMubGVuZ3RoLCBoLmxlbmd0aCwgXCJsZW5ndGhcIik7XG4gICAgICAgIGczLmZvckVhY2goKGdFbCwgaTIpID0+IGVxdWF0ZShnRWwsIGhbaTJdLCBpMikpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGNvbnN0IGdOYW1lcyA9IHJlY29yZE5hbWVzKGczKTtcbiAgICAgICAgY29uc3QgaE5hbWVzID0gcmVjb3JkTmFtZXMoaCk7XG4gICAgICAgIGVxdWF0ZShnTmFtZXMsIGhOYW1lcywgXCJwcm9wZXJ0eU5hbWVzXCIpO1xuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgb2YgZ05hbWVzKSB7XG4gICAgICAgICAgZXF1YXRlKGczW25hbWVdLCBoW25hbWVdLCBuYW1lKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgZXF1YXRlKGdldFRhZyhnMyksIGdldFRhZyhoKSwgXCJ0YWdcIik7XG4gICAgICAgIGVxdWF0ZShnMy5wYXlsb2FkLCBoLnBheWxvYWQsIFwicGF5bG9hZFwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgZXF1YXRlKGczLm5hbWUsIGgubmFtZSwgXCJlcnJvciBuYW1lXCIpO1xuICAgICAgICBub3RlKGczLCByZWRhY3RlZGByZXBsYXkgb2YgZXJyb3IgJHtofWApO1xuICAgICAgICBub3RlKGgsIHJlZGFjdGVkYHJlcGxheWVkIGFzIGVycm9yICR7ZzN9YCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGNhbm5vdCB5ZXQgc2VuZCBndWVzdCByZW1vdGFibGVzIHRvIGhvc3QgJHtnM30gdnMgJHtofWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgY2Fubm90IHlldCBzZW5kIGd1ZXN0IHByb21pc2VzIHRvIGhvc3QgJHtnM30gdnMgJHtofWA7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBwYXNzU3R5bGUgJHtxdW90ZShnUGFzc1N0eWxlKX1gO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgcmV0dXJuIGhhcmRlbihlcXVhdGUpO1xufTtcbmhhcmRlbihtYWtlRXF1YXRlKTtcblxuLy9cbnZhciB7IGZyb21FbnRyaWVzOiBmcm9tRW50cmllczEzLCBkZWZpbmVQcm9wZXJ0aWVzOiBkZWZpbmVQcm9wZXJ0aWVzNSwgYXNzaWduOiBhc3NpZ24zIH0gPSBPYmplY3Q7XG52YXIgbWFrZVJlcGxheU1lbWJyYW5lID0gKGFyZykgPT4ge1xuICBjb25zdCBub0R1bmRlckFyZyA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKGFyZykuZmlsdGVyKChba10pID0+ICFrLnN0YXJ0c1dpdGgoXCJfX1wiKSkpXG4gICk7XG4gIHJldHVybiBtYWtlUmVwbGF5TWVtYnJhbmVGb3JUZXN0aW5nKG5vRHVuZGVyQXJnKTtcbn07XG52YXIgbWFrZVJlcGxheU1lbWJyYW5lRm9yVGVzdGluZyA9ICh7XG4gIGxvZyxcbiAgYmlqZWN0aW9uLFxuICB2b3dUb29scyxcbiAgd2F0Y2hXYWtlLFxuICBwYW5pYyxcbiAgX19ldmVudHVhbFNlbmRGb3JUZXN0aW5nXG59KSA9PiB7XG4gIGNvbnN0IHsgd2hlbiwgbWFrZVZvd0tpdCB9ID0gdm93VG9vbHM7XG4gIGNvbnN0IGVxdWF0ZSA9IG1ha2VFcXVhdGUoYmlqZWN0aW9uKTtcbiAgY29uc3QgZ3Vlc3RQcm9taXNlTWFwID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGxldCBzdG9wcGVkID0gZmFsc2U7XG4gIGNvbnN0IFBhbmljID0gKHRlbXBsYXRlLCAuLi5hcmdzKSA9PiBwYW5pYyhtYWtlRXJyb3IocmVkYWN0ZWQodGVtcGxhdGUsIC4uLmFyZ3MpKSk7XG4gIGNvbnN0IHN0YXJ0R2VuZXJhdGlvbiA9IChnZW5lcmF0aW9uKSA9PiB7XG4gICAgTnVtYmVyLmlzU2FmZUludGVnZXIoZ2VuZXJhdGlvbikgfHwgdGhyb3dSZWRhY3RlZGBnZW5lcmF0aW9uIGV4cGVjdGVkIGludGVnZXI7IGdvdCAke2dlbmVyYXRpb259YDtcbiAgICBnZW5lcmF0aW9uID49IDAgfHwgdGhyb3dSZWRhY3RlZGBnZW5lcmF0aW9uIGV4cGVjdGVkIG5vbi1uZWdhdGl2ZTsgZ290ICR7Z2VuZXJhdGlvbn1gO1xuICB9O1xuICBjb25zdCBkb0Z1bGZpbGwgPSAoaG9zdFZvdywgaG9zdEZ1bGZpbGxtZW50KSA9PiB7XG4gICAgY29uc3QgZ3Vlc3RQcm9taXNlID0gaG9zdFRvR3Vlc3QoaG9zdFZvdyk7XG4gICAgY29uc3Qgc3RhdHVzID0gZ3Vlc3RQcm9taXNlTWFwLmdldChndWVzdFByb21pc2UpO1xuICAgIGlmICghc3RhdHVzIHx8IHN0YXR1cyA9PT0gXCJzZXR0bGVkXCIpIHtcbiAgICAgIHRocm93UmVkYWN0ZWRgZG9GdWxmaWxsIHNob3VsZCBvbmx5IGJlIGNhbGxlZCBvbiBhIHJlZ2lzdGVyZWQgdW5yZXNvbHZlZCBwcm9taXNlYDtcbiAgICB9XG4gICAgY29uc3QgZ3Vlc3RGdWxmaWxsbWVudCA9IGhvc3RUb0d1ZXN0KGhvc3RGdWxmaWxsbWVudCk7XG4gICAgc3RhdHVzLnJlc29sdmUoZ3Vlc3RGdWxmaWxsbWVudCk7XG4gICAgZ3Vlc3RQcm9taXNlTWFwLnNldChndWVzdFByb21pc2UsIFwic2V0dGxlZFwiKTtcbiAgfTtcbiAgY29uc3QgZG9SZWplY3QgPSAoaG9zdFZvdywgaG9zdFJlYXNvbikgPT4ge1xuICAgIGNvbnN0IGd1ZXN0UHJvbWlzZSA9IGhvc3RUb0d1ZXN0KGhvc3RWb3cpO1xuICAgIGNvbnN0IHN0YXR1cyA9IGd1ZXN0UHJvbWlzZU1hcC5nZXQoZ3Vlc3RQcm9taXNlKTtcbiAgICBpZiAoIXN0YXR1cyB8fCBzdGF0dXMgPT09IFwic2V0dGxlZFwiKSB7XG4gICAgICB0aHJvd1JlZGFjdGVkYGRvUmVqZWN0IHNob3VsZCBvbmx5IGJlIGNhbGxlZCBvbiBhIHJlZ2lzdGVyZWQgdW5yZXNvbHZlZCBwcm9taXNlYDtcbiAgICB9XG4gICAgY29uc3QgZ3Vlc3RSZWFzb24gPSBob3N0VG9HdWVzdChob3N0UmVhc29uKTtcbiAgICBzdGF0dXMucmVqZWN0KGd1ZXN0UmVhc29uKTtcbiAgICBndWVzdFByb21pc2VNYXAuc2V0KGd1ZXN0UHJvbWlzZSwgXCJzZXR0bGVkXCIpO1xuICB9O1xuICBjb25zdCBkb1JldHVybiA9IChjYWxsSW5kZXgsIGhvc3RSZXN1bHQpID0+IHtcbiAgICB1bm5lc3RJbnRlcnByZXRlcihjYWxsSW5kZXgpO1xuICAgIGNvbnN0IGd1ZXN0UmVzdWx0ID0gaG9zdFRvR3Vlc3QoaG9zdFJlc3VsdCk7XG4gICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICBraW5kOiBcInJldHVyblwiLFxuICAgICAgcmVzdWx0OiBndWVzdFJlc3VsdFxuICAgIH0pO1xuICB9O1xuICBjb25zdCBkb1Rocm93ID0gKGNhbGxJbmRleCwgaG9zdFByb2JsZW0pID0+IHtcbiAgICB1bm5lc3RJbnRlcnByZXRlcihjYWxsSW5kZXgpO1xuICAgIGNvbnN0IGd1ZXN0UHJvYmxlbSA9IGhvc3RUb0d1ZXN0KGhvc3RQcm9ibGVtKTtcbiAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgIGtpbmQ6IFwidGhyb3dcIixcbiAgICAgIHByb2JsZW06IGd1ZXN0UHJvYmxlbVxuICAgIH0pO1xuICB9O1xuICBjb25zdCBwZXJmb3JtQ2FsbCA9IChob3N0VGFyZ2V0LCBvcHRWZXJiLCBob3N0QXJncywgY2FsbEluZGV4KSA9PiB7XG4gICAgbGV0IGhvc3RSZXN1bHQ7XG4gICAgdHJ5IHtcbiAgICAgIGhvc3RSZXN1bHQgPSBvcHRWZXJiID8gaG9zdFRhcmdldFtvcHRWZXJiXSguLi5ob3N0QXJncykgOiBob3N0VGFyZ2V0KC4uLmhvc3RBcmdzKTtcbiAgICAgIGhvc3RUb0d1ZXN0KGhvc3RSZXN1bHQsIGBjb252ZXJ0aW5nICR7b3B0VmVyYiB8fCBcImhvc3RcIn0gcmVzdWx0YCk7XG4gICAgfSBjYXRjaCAoaG9zdFByb2JsZW0pIHtcbiAgICAgIHJldHVybiBsb2dEbyhuZXN0RGlzcGF0Y2gsIGhhcmRlbihbXCJkb1Rocm93XCIsIGNhbGxJbmRleCwgaG9zdFByb2JsZW1dKSk7XG4gICAgfVxuICAgIHJldHVybiBsb2dEbyhuZXN0RGlzcGF0Y2gsIGhhcmRlbihbXCJkb1JldHVyblwiLCBjYWxsSW5kZXgsIGhvc3RSZXN1bHRdKSk7XG4gIH07XG4gIGNvbnN0IGd1ZXN0Q2FsbHNIb3N0ID0gKGd1ZXN0VGFyZ2V0LCBvcHRWZXJiLCBndWVzdEFyZ3MsIGNhbGxJbmRleCkgPT4ge1xuICAgIGlmIChzdG9wcGVkIHx8ICFiaWplY3Rpb24uaGFzR3Vlc3QoZ3Vlc3RUYXJnZXQpKSB7XG4gICAgICBjb25zdCBleHRyYURpYWdub3N0aWMgPSBjYWxsU3RhY2subGVuZ3RoID09PSAwID8gXCJcIiA6IChcbiAgICAgICAgLy9cbiAgICAgICAgYCB3aXRoIG5vbi1lbXB0eSBjYWxsc3RhY2sgJHtxdW90ZShjYWxsU3RhY2spfTtgXG4gICAgICApO1xuICAgICAgdGhyb3dSZWRhY3RlZGBDYWxsZWQgZnJvbSBhIHByZXZpb3VzIHJ1bjogJHtndWVzdFRhcmdldH0ke2JhcmVPclF1b3RlKGV4dHJhRGlhZ25vc3RpYyl9YDtcbiAgICB9XG4gICAgbGV0IG91dGNvbWU7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGd1ZXN0RW50cnkgPSBoYXJkZW4oW1xuICAgICAgICBcImNoZWNrQ2FsbFwiLFxuICAgICAgICBndWVzdFRhcmdldCxcbiAgICAgICAgb3B0VmVyYixcbiAgICAgICAgZ3Vlc3RBcmdzLFxuICAgICAgICBjYWxsSW5kZXhcbiAgICAgIF0pO1xuICAgICAgaWYgKGxvZy5pc1JlcGxheWluZygpKSB7XG4gICAgICAgIGNvbnN0IGVudHJ5ID0gbG9nLm5leHRFbnRyeSgpO1xuICAgICAgICBlcXVhdGUoXG4gICAgICAgICAgZ3Vlc3RFbnRyeSxcbiAgICAgICAgICBlbnRyeSxcbiAgICAgICAgICBgcmVwbGF5ICR7Y2FsbEluZGV4fTpcbiAgICAgJHtxdW90ZShndWVzdEVudHJ5KX1cbiAgdnMgJHtxdW90ZShlbnRyeSl9XG4gICAgYFxuICAgICAgICApO1xuICAgICAgICBvdXRjb21lID0gLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBuZXN0SW50ZXJwcmV0ZXIoY2FsbEluZGV4KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGVudHJ5ID0gZ3Vlc3RUb0hvc3QoZ3Vlc3RFbnRyeSk7XG4gICAgICAgIGxvZy5wdXNoRW50cnkoZW50cnkpO1xuICAgICAgICBjb25zdCBbXywgLi4uYXJnc10gPSBlbnRyeTtcbiAgICAgICAgbmVzdEludGVycHJldGVyKGNhbGxJbmRleCk7XG4gICAgICAgIG91dGNvbWUgPSBwZXJmb3JtQ2FsbCguLi5hcmdzKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChmYXRhbEVycm9yKSB7XG4gICAgICB0aHJvdyBwYW5pYyhmYXRhbEVycm9yKTtcbiAgICB9XG4gICAgc3dpdGNoIChvdXRjb21lLmtpbmQpIHtcbiAgICAgIGNhc2UgXCJyZXR1cm5cIjoge1xuICAgICAgICByZXR1cm4gb3V0Y29tZS5yZXN1bHQ7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGhyb3dcIjoge1xuICAgICAgICB0aHJvdyBvdXRjb21lLnByb2JsZW07XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IFBhbmljYHVuZXhwZWN0ZWQgb3V0Y29tZSBraW5kICR7cXVvdGUob3V0Y29tZS5raW5kKX1gO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgcGVyZm9ybVNlbmRPbmx5ID0gKGhvc3RUYXJnZXQsIG9wdFZlcmIsIGhvc3RBcmdzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIG9wdFZlcmIgPT09IHZvaWQgMCA/IGhlYXBWb3dFLnNlbmRPbmx5KGhvc3RUYXJnZXQpKC4uLmhvc3RBcmdzKSA6IGhlYXBWb3dFLnNlbmRPbmx5KGhvc3RUYXJnZXQpW29wdFZlcmJdKC4uLmhvc3RBcmdzKTtcbiAgICB9IGNhdGNoIChob3N0UHJvYmxlbSkge1xuICAgICAgdGhyb3cgUGFuaWNgaW50ZXJuYWw6IGV2ZW50dWFsIHNlbmRPbmx5IHN5bmNocm9ub3VzbHkgZmFpbGVkICR7aG9zdFByb2JsZW19YDtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHBlcmZvcm1TZW5kID0gKGhvc3RUYXJnZXQsIG9wdFZlcmIsIGhvc3RBcmdzLCBjYWxsSW5kZXgsIGhvc3RSZXN1bHRLaXQsIGd1ZXN0UmV0dXJuZWRQKSA9PiB7XG4gICAgY29uc3QgeyB2b3csIHJlc29sdmVyIH0gPSBob3N0UmVzdWx0S2l0O1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBob3N0UHJvbWlzZSA9IG9wdFZlcmIgPT09IHZvaWQgMCA/IGhlYXBWb3dFKGhvc3RUYXJnZXQpKC4uLmhvc3RBcmdzKSA6IGhlYXBWb3dFKGhvc3RUYXJnZXQpW29wdFZlcmJdKC4uLmhvc3RBcmdzKTtcbiAgICAgIHJlc29sdmVyLnJlc29sdmUoaG9zdFByb21pc2UpO1xuICAgIH0gY2F0Y2ggKGhvc3RQcm9ibGVtKSB7XG4gICAgICB0aHJvdyBQYW5pY2BpbnRlcm5hbDogZXZlbnR1YWwgc2VuZCBzeW5jaHJvbm91c2x5IGZhaWxlZCAke2hvc3RQcm9ibGVtfWA7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBlbnRyeSA9IGhhcmRlbihbXCJkb1JldHVyblwiLCBjYWxsSW5kZXgsIHZvd10pO1xuICAgICAgbG9nLnB1c2hFbnRyeShlbnRyeSk7XG4gICAgICBjb25zdCBndWVzdFByb21pc2UgPSBtYWtlR3Vlc3RGb3JIb3N0Vm93KHZvdywgZ3Vlc3RSZXR1cm5lZFApO1xuICAgICAgZG9SZXR1cm4oY2FsbEluZGV4LCB2b3cpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgIGtpbmQ6IFwicmV0dXJuXCIsXG4gICAgICAgIHJlc3VsdDogZ3Vlc3RQcm9taXNlXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChwcm9ibGVtKSB7XG4gICAgICB0aHJvdyBwYW5pYyhwcm9ibGVtKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGd1ZXN0SGFuZGxlciA9IGhhcmRlbih7XG4gICAgYXBwbHlNZXRob2RTZW5kT25seShndWVzdFRhcmdldCwgb3B0VmVyYiwgZ3Vlc3RBcmdzKSB7XG4gICAgICBfX2V2ZW50dWFsU2VuZEZvclRlc3RpbmcgfHwgUGFuaWNgZ3Vlc3QgZXZlbnR1YWwgYXBwbHlNZXRob2RTZW5kT25seSBub3QgeWV0IHN1cHBvcnRlZDogJHtndWVzdFRhcmdldH0uJHtiYXJlT3JRdW90ZShvcHRWZXJiKX1gO1xuICAgICAgY29uc3QgY2FsbEluZGV4ID0gbG9nLmdldEluZGV4KCk7XG4gICAgICBpZiAoc3RvcHBlZCB8fCAhYmlqZWN0aW9uLmhhc0d1ZXN0KGd1ZXN0VGFyZ2V0KSkge1xuICAgICAgICB0aHJvd1JlZGFjdGVkYFNlbnQgZnJvbSBhIHByZXZpb3VzIHJ1bjogJHtndWVzdFRhcmdldH1gO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZ3Vlc3RFbnRyeSA9IGhhcmRlbihbXG4gICAgICAgICAgXCJjaGVja1NlbmRPbmx5XCIsXG4gICAgICAgICAgZ3Vlc3RUYXJnZXQsXG4gICAgICAgICAgb3B0VmVyYixcbiAgICAgICAgICBndWVzdEFyZ3MsXG4gICAgICAgICAgY2FsbEluZGV4XG4gICAgICAgIF0pO1xuICAgICAgICBpZiAobG9nLmlzUmVwbGF5aW5nKCkpIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGxvZy5uZXh0RW50cnkoKTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgZXF1YXRlKGd1ZXN0RW50cnksIGVudHJ5KTtcbiAgICAgICAgICB9IGNhdGNoIChlcXVhdGVFcnIpIHtcbiAgICAgICAgICAgIHRocm93TGFiZWxlZChcbiAgICAgICAgICAgICAgZXF1YXRlRXJyLFxuICAgICAgICAgICAgICBgcmVwbGF5ICR7Y2FsbEluZGV4fTpcbiAgICAgJHtxdW90ZShndWVzdEVudHJ5KX1cbiAgdnMgJHtxdW90ZShlbnRyeSl9XG4gICAgYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBndWVzdFRvSG9zdChndWVzdEVudHJ5KTtcbiAgICAgICAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICAgICAgICBjb25zdCBbX29wLCBob3N0VGFyZ2V0LCBfb3B0VmVyYiwgaG9zdEFyZ3MsIF9jYWxsSW5kZXhdID0gZW50cnk7XG4gICAgICAgICAgcGVyZm9ybVNlbmRPbmx5KGhvc3RUYXJnZXQsIG9wdFZlcmIsIGhvc3RBcmdzKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZmF0YWxFcnJvcikge1xuICAgICAgICB0aHJvdyBwYW5pYyhmYXRhbEVycm9yKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGFwcGx5TWV0aG9kKGd1ZXN0VGFyZ2V0LCBvcHRWZXJiLCBndWVzdEFyZ3MsIGd1ZXN0UmV0dXJuZWRQKSB7XG4gICAgICBfX2V2ZW50dWFsU2VuZEZvclRlc3RpbmcgfHwgUGFuaWNgZ3Vlc3QgZXZlbnR1YWwgYXBwbHlNZXRob2Qgbm90IHlldCBzdXBwb3J0ZWQ6ICR7Z3Vlc3RUYXJnZXR9LiR7YmFyZU9yUXVvdGUob3B0VmVyYil9IC0+ICR7YmFyZU9yUXVvdGUoZ3Vlc3RSZXR1cm5lZFApfWA7XG4gICAgICBjb25zdCBjYWxsSW5kZXggPSBsb2cuZ2V0SW5kZXgoKTtcbiAgICAgIGlmIChzdG9wcGVkIHx8ICFiaWplY3Rpb24uaGFzR3Vlc3QoZ3Vlc3RUYXJnZXQpKSB7XG4gICAgICAgIHRocm93UmVkYWN0ZWRgU2VudCBmcm9tIGEgcHJldmlvdXMgcnVuOiAke2d1ZXN0VGFyZ2V0fWA7XG4gICAgICB9XG4gICAgICBjb25zdCBob3N0UmVzdWx0S2l0ID0gbWFrZVZvd0tpdCgpO1xuICAgICAgY29uc3QgZzMgPSBiaWplY3Rpb24udW53cmFwSW5pdChndWVzdFJldHVybmVkUCwgaG9zdFJlc3VsdEtpdC52b3cpO1xuICAgICAgZzMgPT09IGd1ZXN0UmV0dXJuZWRQIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGd1ZXN0UmV0dXJuZWRQIHNob3VsZCBub3QgdW53cmFwOiAke2czfSB2cyAke2d1ZXN0UmV0dXJuZWRQfWA7XG4gICAgICBsZXQgb3V0Y29tZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGd1ZXN0RW50cnkgPSBoYXJkZW4oW1xuICAgICAgICAgIFwiY2hlY2tTZW5kXCIsXG4gICAgICAgICAgZ3Vlc3RUYXJnZXQsXG4gICAgICAgICAgb3B0VmVyYixcbiAgICAgICAgICBndWVzdEFyZ3MsXG4gICAgICAgICAgY2FsbEluZGV4XG4gICAgICAgIF0pO1xuICAgICAgICBpZiAobG9nLmlzUmVwbGF5aW5nKCkpIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGxvZy5uZXh0RW50cnkoKTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgZXF1YXRlKGd1ZXN0RW50cnksIGVudHJ5KTtcbiAgICAgICAgICB9IGNhdGNoIChlcXVhdGVFcnIpIHtcbiAgICAgICAgICAgIHRocm93TGFiZWxlZChcbiAgICAgICAgICAgICAgZXF1YXRlRXJyLFxuICAgICAgICAgICAgICBgcmVwbGF5ICR7Y2FsbEluZGV4fTpcbiAgICAgJHtxdW90ZShndWVzdEVudHJ5KX1cbiAgdnMgJHtxdW90ZShlbnRyeSl9XG4gICAgYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb3V0Y29tZSA9IC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBuZXN0SW50ZXJwcmV0ZXIoY2FsbEluZGV4KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGd1ZXN0VG9Ib3N0KGd1ZXN0RW50cnkpO1xuICAgICAgICAgIGxvZy5wdXNoRW50cnkoZW50cnkpO1xuICAgICAgICAgIGNvbnN0IFtfb3AsIGhvc3RUYXJnZXQsIF9vcHRWZXJiLCBob3N0QXJncywgX2NhbGxJbmRleF0gPSBlbnRyeTtcbiAgICAgICAgICBuZXN0SW50ZXJwcmV0ZXIoY2FsbEluZGV4KTtcbiAgICAgICAgICBvdXRjb21lID0gcGVyZm9ybVNlbmQoXG4gICAgICAgICAgICBob3N0VGFyZ2V0LFxuICAgICAgICAgICAgb3B0VmVyYixcbiAgICAgICAgICAgIGhvc3RBcmdzLFxuICAgICAgICAgICAgY2FsbEluZGV4LFxuICAgICAgICAgICAgaG9zdFJlc3VsdEtpdCxcbiAgICAgICAgICAgIGd1ZXN0UmV0dXJuZWRQXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZmF0YWxFcnJvcikge1xuICAgICAgICB0aHJvdyBwYW5pYyhmYXRhbEVycm9yKTtcbiAgICAgIH1cbiAgICAgIHN3aXRjaCAob3V0Y29tZS5raW5kKSB7XG4gICAgICAgIGNhc2UgXCJyZXR1cm5cIjoge1xuICAgICAgICAgIHJldHVybiBvdXRjb21lLnJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwidGhyb3dcIjoge1xuICAgICAgICAgIHRocm93IG91dGNvbWUucHJvYmxlbTtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgdGhyb3cgUGFuaWNgdW5leHBlY3RlZCBvdXRjb21lIGtpbmQgJHtxdW90ZShvdXRjb21lLmtpbmQpfWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGFwcGx5RnVuY3Rpb25TZW5kT25seShndWVzdFRhcmdldCwgZ3Vlc3RBcmdzKSB7XG4gICAgICBfX2V2ZW50dWFsU2VuZEZvclRlc3RpbmcgfHwgUGFuaWNgZ3Vlc3QgZXZlbnR1YWwgYXBwbHlGdW5jdGlvblNlbmRPbmx5IG5vdCB5ZXQgc3VwcG9ydGVkOiAke2d1ZXN0VGFyZ2V0fWA7XG4gICAgICByZXR1cm4gZ3Vlc3RIYW5kbGVyLmFwcGx5TWV0aG9kU2VuZE9ubHkoXG4gICAgICAgIGd1ZXN0VGFyZ2V0LFxuICAgICAgICB2b2lkIDAsXG4gICAgICAgIGd1ZXN0QXJnc1xuICAgICAgKTtcbiAgICB9LFxuICAgIGFwcGx5RnVuY3Rpb24oZ3Vlc3RUYXJnZXQsIGd1ZXN0QXJncywgZ3Vlc3RSZXR1cm5lZFApIHtcbiAgICAgIF9fZXZlbnR1YWxTZW5kRm9yVGVzdGluZyB8fCBQYW5pY2BndWVzdCBldmVudHVhbCBhcHBseUZ1bmN0aW9uIG5vdCB5ZXQgc3VwcG9ydGVkOiAke2d1ZXN0VGFyZ2V0fSAtPiAke2JhcmVPclF1b3RlKGd1ZXN0UmV0dXJuZWRQKX1gO1xuICAgICAgcmV0dXJuIGd1ZXN0SGFuZGxlci5hcHBseU1ldGhvZChcbiAgICAgICAgZ3Vlc3RUYXJnZXQsXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgZ3Vlc3RBcmdzLFxuICAgICAgICBndWVzdFJldHVybmVkUFxuICAgICAgKTtcbiAgICB9LFxuICAgIGdldFNlbmRPbmx5KGd1ZXN0VGFyZ2V0LCBwcm9wKSB7XG4gICAgICB0aHJvdyBQYW5pY2BndWVzdCBldmVudHVhbCBnZXRTZW5kT25seSBub3QgeWV0IHN1cHBvcnRlZDogJHtndWVzdFRhcmdldH0uJHtiYXJlT3JRdW90ZShwcm9wKX1gO1xuICAgIH0sXG4gICAgZ2V0KGd1ZXN0VGFyZ2V0LCBwcm9wLCBndWVzdFJldHVybmVkUCkge1xuICAgICAgdGhyb3cgUGFuaWNgZ3Vlc3QgZXZlbnR1YWwgZ2V0IG5vdCB5ZXQgc3VwcG9ydGVkOiAke2d1ZXN0VGFyZ2V0fS4ke2JhcmVPclF1b3RlKHByb3ApfSAtPiAke2JhcmVPclF1b3RlKGd1ZXN0UmV0dXJuZWRQKX1gO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IG1ha2VHdWVzdFByZXNlbmNlID0gKGlmYWNlLCBtZXRob2RFbnRyaWVzKSA9PiB7XG4gICAgbGV0IGd1ZXN0UHJlc2VuY2U7XG4gICAgdm9pZCBuZXcgSGFuZGxlZFByb21pc2UoKF9yZXMsIF9yZWosIHJlc29sdmVXaXRoUHJlc2VuY2UpID0+IHtcbiAgICAgIGd1ZXN0UHJlc2VuY2UgPSByZXNvbHZlV2l0aFByZXNlbmNlKGd1ZXN0SGFuZGxlcik7XG4gICAgfSk7XG4gICAgaWYgKHR5cGVvZiBndWVzdFByZXNlbmNlICE9PSBcIm9iamVjdFwiKSB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHByZXNlbmNlIGV4cGVjdGVkIHRvIGJlIG9iamVjdCAke2d1ZXN0UHJlc2VuY2V9YDtcbiAgICB9XG4gICAgYXNzaWduMyhndWVzdFByZXNlbmNlLCBmcm9tRW50cmllczEzKG1ldGhvZEVudHJpZXMpKTtcbiAgICBjb25zdCByZXN1bHQgPSBSZW1vdGFibGUoaWZhY2UsIHZvaWQgMCwgZ3Vlc3RQcmVzZW5jZSk7XG4gICAgcmVzdWx0ID09PSBndWVzdFByZXNlbmNlIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlIGV4cGVjdGVkIHRvIG1ha2UgcHJlc2VuY2UgaW4gcGxhY2U6ICR7Z3Vlc3RQcmVzZW5jZX0gdnMgJHtyZXN1bHR9YDtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuICBjb25zdCBtYWtlR3Vlc3RQcm9taXNlS2l0ID0gKCkgPT4ge1xuICAgIGxldCByZXNvbHZlMjtcbiAgICBsZXQgcmVqZWN0O1xuICAgIGNvbnN0IHByb21pc2UgPSBuZXcgSGFuZGxlZFByb21pc2UoKHJlcywgcmVqLCBfcmVzUHJlcykgPT4ge1xuICAgICAgcmVzb2x2ZTIgPSByZXM7XG4gICAgICByZWplY3QgPSByZWo7XG4gICAgfSwgZ3Vlc3RIYW5kbGVyKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgcHJvbWlzZSwgcmVzb2x2ZTogcmVzb2x2ZTIsIHJlamVjdCB9KTtcbiAgfTtcbiAgY29uc3QgbWFrZUd1ZXN0Rm9ySG9zdFJlbW90YWJsZSA9IChoUmVtKSA9PiB7XG4gICAgbGV0IGdSZW07XG4gICAgY29uc3QgbWFrZUd1ZXN0TWV0aG9kID0gKG9wdFZlcmIgPSB2b2lkIDApID0+IHtcbiAgICAgIGNvbnN0IGd1ZXN0TWV0aG9kID0gKC4uLmd1ZXN0QXJncykgPT4ge1xuICAgICAgICBjb25zdCBjYWxsSW5kZXggPSBsb2cuZ2V0SW5kZXgoKTtcbiAgICAgICAgcmV0dXJuIGd1ZXN0Q2FsbHNIb3N0KGdSZW0sIG9wdFZlcmIsIGd1ZXN0QXJncywgY2FsbEluZGV4KTtcbiAgICAgIH07XG4gICAgICBpZiAob3B0VmVyYikge1xuICAgICAgICBkZWZpbmVQcm9wZXJ0aWVzNShndWVzdE1ldGhvZCwge1xuICAgICAgICAgIG5hbWU6IHsgdmFsdWU6IFN0cmluZyhoUmVtW29wdFZlcmJdLm5hbWUgfHwgb3B0VmVyYikgfSxcbiAgICAgICAgICBsZW5ndGg6IHsgdmFsdWU6IE51bWJlcihoUmVtW29wdFZlcmJdLmxlbmd0aCB8fCAwKSB9XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGVmaW5lUHJvcGVydGllczUoZ3Vlc3RNZXRob2QsIHtcbiAgICAgICAgICBuYW1lOiB7IHZhbHVlOiBTdHJpbmcoaFJlbS5uYW1lIHx8IFwiYW5vblwiKSB9LFxuICAgICAgICAgIGxlbmd0aDogeyB2YWx1ZTogTnVtYmVyKGhSZW0ubGVuZ3RoIHx8IDApIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZ3Vlc3RNZXRob2Q7XG4gICAgfTtcbiAgICBjb25zdCBpZmFjZSA9IFN0cmluZyhnZXRJbnRlcmZhY2VPZihoUmVtKSB8fCBcInJlbW90YWJsZVwiKTtcbiAgICBjb25zdCBndWVzdElmYWNlID0gYCR7aWZhY2V9IGd1ZXN0IHdyYXBwZXJgO1xuICAgIGlmICh0eXBlb2YgaFJlbSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICBnUmVtID0gUmVtb3RhYmxlKGd1ZXN0SWZhY2UsIHZvaWQgMCwgbWFrZUd1ZXN0TWV0aG9kKCkpO1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBob3N0IGZhciBmdW5jdGlvbnMgbm90IHlldCBwYXNzYWJsZWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG1ldGhvZE5hbWVzID0gZ2V0TWV0aG9kTmFtZXMoaFJlbSk7XG4gICAgICBjb25zdCBndWVzdE1ldGhvZHMgPSBtZXRob2ROYW1lcy5tYXAoKG5hbWUpID0+IFtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgbWFrZUd1ZXN0TWV0aG9kKG5hbWUpXG4gICAgICBdKTtcbiAgICAgIGdSZW0gPSBtYWtlR3Vlc3RQcmVzZW5jZShndWVzdElmYWNlLCBndWVzdE1ldGhvZHMpO1xuICAgIH1cbiAgICBoUmVtID0gdm9pZCAwO1xuICAgIHJldHVybiBnUmVtO1xuICB9O1xuICBoYXJkZW4obWFrZUd1ZXN0Rm9ySG9zdFJlbW90YWJsZSk7XG4gIGNvbnN0IG1ha2VHdWVzdEZvckhvc3RWb3cgPSAoaFZvdywgcHJvbWlzZUtleSA9IHZvaWQgMCkgPT4ge1xuICAgIGlzVm93KGhWb3cpIHx8IHRocm93UmVkYWN0ZWRgdm93IGV4cGVjdGVkICR7aFZvd31gO1xuICAgIGNvbnN0IHsgcHJvbWlzZSwgcmVzb2x2ZTogcmVzb2x2ZTIsIHJlamVjdCB9ID0gbWFrZUd1ZXN0UHJvbWlzZUtpdCgpO1xuICAgIHByb21pc2VLZXkgPz89IHByb21pc2U7XG4gICAgZ3Vlc3RQcm9taXNlTWFwLnNldChwcm9taXNlS2V5LCBoYXJkZW4oeyByZXNvbHZlOiByZXNvbHZlMiwgcmVqZWN0IH0pKTtcbiAgICB3YXRjaFdha2UoaFZvdyk7XG4gICAgdm9pZCB3aGVuKFxuICAgICAgaFZvdyxcbiAgICAgIGFzeW5jIChob3N0RnVsZmlsbG1lbnQpID0+IHtcbiAgICAgICAgYXdhaXQgbG9nLnByb21pc2VSZXBsYXlEb25lKCk7XG4gICAgICAgIGlmICghc3RvcHBlZCAmJiBndWVzdFByb21pc2VNYXAuZ2V0KHByb21pc2VLZXkpICE9PSBcInNldHRsZWRcIikge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gaGFyZGVuKFtcImRvRnVsZmlsbFwiLCBoVm93LCBob3N0RnVsZmlsbG1lbnRdKTtcbiAgICAgICAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaW50ZXJwcmV0T25lKHRvcERpc3BhdGNoLCBlbnRyeSk7XG4gICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYXN5bmMgKGhvc3RSZWFzb24pID0+IHtcbiAgICAgICAgYXdhaXQgbG9nLnByb21pc2VSZXBsYXlEb25lKCk7XG4gICAgICAgIGlmICghc3RvcHBlZCAmJiBndWVzdFByb21pc2VNYXAuZ2V0KHByb21pc2VLZXkpICE9PSBcInNldHRsZWRcIikge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gaGFyZGVuKFtcImRvUmVqZWN0XCIsIGhWb3csIGhvc3RSZWFzb25dKTtcbiAgICAgICAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaW50ZXJwcmV0T25lKHRvcERpc3BhdGNoLCBlbnRyeSk7XG4gICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgICByZXR1cm4gcHJvbWlzZTtcbiAgfTtcbiAgaGFyZGVuKG1ha2VHdWVzdEZvckhvc3RWb3cpO1xuICBjb25zdCB7IGd1ZXN0VG9Ib3N0LCBob3N0VG9HdWVzdCB9ID0gbWFrZUNvbnZlcnRLaXQoXG4gICAgYmlqZWN0aW9uLFxuICAgIG1ha2VHdWVzdEZvckhvc3RSZW1vdGFibGUsXG4gICAgbWFrZUd1ZXN0Rm9ySG9zdFZvd1xuICApO1xuICBjb25zdCB0b3BEaXNwYXRjaCA9IGhhcmRlbih7XG4gICAgc3RhcnRHZW5lcmF0aW9uLFxuICAgIGRvRnVsZmlsbCxcbiAgICBkb1JlamVjdFxuICAgIC8vXG4gIH0pO1xuICBjb25zdCBuZXN0RGlzcGF0Y2ggPSBoYXJkZW4oe1xuICAgIGRvUmV0dXJuLFxuICAgIGRvVGhyb3dcbiAgICAvL1xuICB9KTtcbiAgY29uc3QgaW50ZXJwcmV0T25lID0gKGRpc3BhdGNoLCBbb3AsIC4uLmFyZ3NdKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIG9wIGluIGRpc3BhdGNoIHx8IC8vXG4gICAgICB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZGlzcGF0Y2ggb3A6ICR7cXVvdGUob3ApfWA7XG4gICAgICByZXR1cm4gZGlzcGF0Y2hbb3BdKC4uLmFyZ3MpO1xuICAgIH0gY2F0Y2ggKHByb2JsZW0pIHtcbiAgICAgIHRocm93IHBhbmljKHByb2JsZW0pO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgbG9nRG8gPSAoZGlzcGF0Y2gsIGVudHJ5KSA9PiB7XG4gICAgbG9nLnB1c2hFbnRyeShlbnRyeSk7XG4gICAgcmV0dXJuIGludGVycHJldE9uZShkaXNwYXRjaCwgZW50cnkpO1xuICB9O1xuICBjb25zdCBjYWxsU3RhY2sgPSBbXTtcbiAgbGV0IHVubmVzdEZsYWcgPSBmYWxzZTtcbiAgY29uc3QgbmVzdEludGVycHJldGVyID0gKGNhbGxJbmRleCkgPT4ge1xuICAgIGNhbGxTdGFjay5wdXNoKGNhbGxJbmRleCk7XG4gICAgd2hpbGUgKGxvZy5pc1JlcGxheWluZygpICYmICFzdG9wcGVkKSB7XG4gICAgICBjb25zdCBlbnRyeSA9IGxvZy5uZXh0VW5maWx0ZXJlZEVudHJ5KCk7XG4gICAgICBjb25zdCBvcHRPdXRjb21lID0gaW50ZXJwcmV0T25lKG5lc3REaXNwYXRjaCwgZW50cnkpO1xuICAgICAgaWYgKHVubmVzdEZsYWcpIHtcbiAgICAgICAgb3B0T3V0Y29tZSB8fCAvL1xuICAgICAgICB0aHJvd1JlZGFjdGVkYG9ubHkgdW5uZXN0IHdpdGggYW4gb3V0Y29tZTogJHtxdW90ZShlbnRyeVswXSl9YDtcbiAgICAgICAgdW5uZXN0RmxhZyA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gb3B0T3V0Y29tZTtcbiAgICAgIH1cbiAgICB9XG4gICAgdW5uZXN0RmxhZyA9IGZhbHNlO1xuICB9O1xuICBjb25zdCB1bm5lc3RJbnRlcnByZXRlciA9IChjYWxsSW5kZXgpID0+IHtcbiAgICAhc3RvcHBlZCB8fCB0aHJvd1JlZGFjdGVkYFRoaXMgbWVtYnJhbmUgc3RvcHBlZC4gUmVzdGFydCB3aXRoIG5ldyBtZW1icmFuZSAke3JlcGxheU1lbWJyYW5lfWA7XG4gICAgY2FsbFN0YWNrLmxlbmd0aCA+PSAxIHx8IC8vXG4gICAgdGhyb3dSZWRhY3RlZGBVbm1hdGNoZWQgdW5uZXN0OiAke3F1b3RlKGNhbGxJbmRleCl9YDtcbiAgICBjb25zdCBpMiA9IGNhbGxTdGFjay5wb3AoKTtcbiAgICBpMiA9PT0gY2FsbEluZGV4IHx8IC8vXG4gICAgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIHVubmVzdDogJHtxdW90ZShjYWxsSW5kZXgpfSB2cyAke3F1b3RlKGkyKX1gO1xuICAgIHVubmVzdEZsYWcgPSB0cnVlO1xuICAgIGlmIChjYWxsU3RhY2subGVuZ3RoID09PSAwKSB7XG4gICAgICB2b2lkIEUud2hlbih2b2lkIDAsIHdha2UpO1xuICAgIH1cbiAgfTtcbiAgY29uc3Qgd2FrZSA9ICgpID0+IHtcbiAgICB3aGlsZSAobG9nLmlzUmVwbGF5aW5nKCkgJiYgIXN0b3BwZWQpIHtcbiAgICAgIGNhbGxTdGFjay5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGB3YWtlIG9ubHkgd2l0aCBlbXB0eSBjYWxsU3RhY2s6ICR7cXVvdGUoY2FsbFN0YWNrKX1gO1xuICAgICAgY29uc3QgZW50cnkgPSBsb2cucGVla0VudHJ5KCk7XG4gICAgICBjb25zdCBvcCA9IGVudHJ5WzBdO1xuICAgICAgaWYgKCEob3AgaW4gdG9wRGlzcGF0Y2gpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZvaWQgbG9nLm5leHRVbmZpbHRlcmVkRW50cnkoKTtcbiAgICAgIGludGVycHJldE9uZSh0b3BEaXNwYXRjaCwgZW50cnkpO1xuICAgIH1cbiAgfTtcbiAgY29uc3Qgc3RvcCA9ICgpID0+IHtcbiAgICBzdG9wcGVkID0gdHJ1ZTtcbiAgfTtcbiAgY29uc3QgcmVwbGF5TWVtYnJhbmUgPSBGYXIoXCJyZXBsYXlNZW1icmFuZVwiLCB7XG4gICAgaG9zdFRvR3Vlc3QsXG4gICAgZ3Vlc3RUb0hvc3QsXG4gICAgd2FrZSxcbiAgICBzdG9wXG4gIH0pO1xuICByZXR1cm4gcmVwbGF5TWVtYnJhbmU7XG59O1xuaGFyZGVuKG1ha2VSZXBsYXlNZW1icmFuZSk7XG5cbi8vXG52YXIgRmxvd1N0YXRlU2hhcGUgPSBNLm9yKFxuICBcIlJ1bm5pbmdcIixcbiAgXCJTbGVlcGluZ1wiLFxuICBcIlJlcGxheWluZ1wiLFxuICBcIkZhaWxlZFwiLFxuICBcIkRvbmVcIlxuKTtcbnZhciBQcm9wZXJ0eUtleVNoYXBlID0gTS5vcihNLnN0cmluZygpLCBNLnN5bWJvbCgpKTtcbnZhciBMb2dFbnRyeVNoYXBlID0gTS5vcihcbiAgW1wic3RhcnRHZW5lcmF0aW9uXCIsIE0ubnVtYmVyKCldLFxuICAvL1xuICBbXCJkb0Z1bGZpbGxcIiwgVm93U2hhcGUsIE0uYW55KCldLFxuICBbXCJkb1JlamVjdFwiLCBWb3dTaGFwZSwgTS5hbnkoKV0sXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIFtcImRvUmV0dXJuXCIsIE0ubnVtYmVyKCksIE0uYW55KCldLFxuICBbXCJkb1Rocm93XCIsIE0ubnVtYmVyKCksIE0uYW55KCldLFxuICAvL1xuICAvL1xuICAvL1xuICBbXG4gICAgXCJjaGVja0NhbGxcIixcbiAgICBNLnJlbW90YWJsZShcImhvc3QgdGFyZ2V0XCIpLFxuICAgIE0ub3B0KFByb3BlcnR5S2V5U2hhcGUpLFxuICAgIE0uYXJyYXlPZihNLmFueSgpKSxcbiAgICBNLm51bWJlcigpXG4gIF0sXG4gIFtcbiAgICBcImNoZWNrU2VuZE9ubHlcIixcbiAgICBNLm9yKE0ucmVtb3RhYmxlKFwiaG9zdCB0YXJnZXRcIiksIFZvd1NoYXBlKSxcbiAgICBNLm9wdChQcm9wZXJ0eUtleVNoYXBlKSxcbiAgICBNLmFycmF5T2YoTS5hbnkoKSksXG4gICAgTS5udW1iZXIoKVxuICBdLFxuICBbXG4gICAgXCJjaGVja1NlbmRcIixcbiAgICBNLm9yKE0ucmVtb3RhYmxlKFwiaG9zdCB0YXJnZXRcIiksIFZvd1NoYXBlKSxcbiAgICBNLm9wdChQcm9wZXJ0eUtleVNoYXBlKSxcbiAgICBNLmFycmF5T2YoTS5hbnkoKSksXG4gICAgTS5udW1iZXIoKVxuICBdXG4gIC8vXG4gIC8vXG4pO1xuXG4vL1xudmFyIG1ha2VFcGhlbWVyYSA9IChyZWluaXQpID0+IHtcbiAgY29uc3QgbWFwID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGZvcihzZWxmKSB7XG4gICAgICBpZiAoIW1hcC5oYXMoc2VsZikpIHtcbiAgICAgICAgbWFwLnNldChzZWxmLCByZWluaXQoc2VsZikpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgICBtYXAuZ2V0KHNlbGYpXG4gICAgICApO1xuICAgIH0sXG4gICAgcmVzZXRGb3Ioc2VsZikge1xuICAgICAgcmV0dXJuIG1hcC5kZWxldGUoc2VsZik7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUVwaGVtZXJhKTtcblxuLy9cbnZhciBMb2dTdG9yZUkgPSBNLmludGVyZmFjZShcIkxvZ1N0b3JlXCIsIHtcbiAgcmVzZXQ6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgZGlzcG9zZTogTS5jYWxsKCkucmV0dXJucygpLFxuICBnZXRVbmZpbHRlcmVkSW5kZXg6IE0uY2FsbCgpLnJldHVybnMoTS5udW1iZXIoKSksXG4gIGdldEluZGV4OiBNLmNhbGwoKS5yZXR1cm5zKE0ubnVtYmVyKCkpLFxuICBnZXRMZW5ndGg6IE0uY2FsbCgpLnJldHVybnMoTS5udW1iZXIoKSksXG4gIGlzUmVwbGF5aW5nOiBNLmNhbGwoKS5yZXR1cm5zKE0uYm9vbGVhbigpKSxcbiAgcGVla0VudHJ5OiBNLmNhbGwoKS5yZXR1cm5zKExvZ0VudHJ5U2hhcGUpLFxuICBuZXh0RW50cnk6IE0uY2FsbCgpLnJldHVybnMoTG9nRW50cnlTaGFwZSksXG4gIG5leHRVbmZpbHRlcmVkRW50cnk6IE0uY2FsbCgpLnJldHVybnMoTG9nRW50cnlTaGFwZSksXG4gIHB1c2hFbnRyeTogTS5jYWxsKExvZ0VudHJ5U2hhcGUpLnJldHVybnMoTS5udW1iZXIoKSksXG4gIGR1bXBVbmZpbHRlcmVkOiBNLmNhbGwoKS5yZXR1cm5zKE0uYXJyYXlPZihMb2dFbnRyeVNoYXBlKSksXG4gIGR1bXA6IE0uY2FsbCgpLnJldHVybnMoTS5hcnJheU9mKExvZ0VudHJ5U2hhcGUpKSxcbiAgcHJvbWlzZVJlcGxheURvbmU6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpXG59KTtcbnZhciBuZXh0R2VuZXJhdGlvbiA9ICh6b25lKSA9PiB7XG4gIGNvbnN0IGxvZ1N0b3JlTWV0YWRhdGEgPSB6b25lLm1hcFN0b3JlKFwiTG9nU3RvcmVNZXRhZGF0YVwiKTtcbiAgY29uc3QgZ2VuZXJhdGlvbktleSA9IFwiZ2VuZXJhdGlvblwiO1xuICBpZiAoIWxvZ1N0b3JlTWV0YWRhdGEuaGFzKGdlbmVyYXRpb25LZXkpKSB7XG4gICAgY29uc3QgZmlyc3RHZW4gPSAwO1xuICAgIGxvZ1N0b3JlTWV0YWRhdGEuaW5pdChnZW5lcmF0aW9uS2V5LCBmaXJzdEdlbik7XG4gICAgcmV0dXJuIGZpcnN0R2VuO1xuICB9XG4gIGNvbnN0IG5leHRHZW4gPSBsb2dTdG9yZU1ldGFkYXRhLmdldChnZW5lcmF0aW9uS2V5KSArIDE7XG4gIGxvZ1N0b3JlTWV0YWRhdGEuc2V0KGdlbmVyYXRpb25LZXksIG5leHRHZW4pO1xuICByZXR1cm4gbmV4dEdlbjtcbn07XG52YXIgcHJlcGFyZUxvZ1N0b3JlID0gKHpvbmUpID0+IHtcbiAgY29uc3QgaW5pdGlhbFB1c2ggPSBoYXJkZW4oW1tcInN0YXJ0R2VuZXJhdGlvblwiLCBuZXh0R2VuZXJhdGlvbih6b25lKV1dKTtcbiAgY29uc3QgZW50cnlJc1Zpc2libGUgPSAoZW50cnkpID0+IGVudHJ5WzBdICE9PSBcInN0YXJ0R2VuZXJhdGlvblwiO1xuICBjb25zdCB0bXAgPSBtYWtlRXBoZW1lcmEoKGxvZykgPT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IHtcbiAgICAgIGluZGV4OiAwLFxuICAgICAgdW5maWx0ZXJlZEluZGV4OiAwLFxuICAgICAgaW5pdGlhbFB1c2gsXG4gICAgICByZXBsYXlEb25lS2l0OiBtYWtlUHJvbWlzZUtpdCgpXG4gICAgfTtcbiAgICBpZiAobG9nLmdldExlbmd0aCgpID09PSAwKSB7XG4gICAgICByZXN1bHQucmVwbGF5RG9uZUtpdC5yZXNvbHZlKHZvaWQgMCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH0pO1xuICByZXR1cm4gem9uZS5leG9DbGFzcyhcbiAgICBcIkxvZ1N0b3JlXCIsXG4gICAgTG9nU3RvcmVJLFxuICAgICgpID0+IHtcbiAgICAgIGNvbnN0IG1hcFN0b3JlID0gem9uZS5kZXRhY2hlZCgpLm1hcFN0b3JlKFwibG9nTWFwU3RvcmVcIiwge1xuICAgICAgICBrZXlTaGFwZTogTS5udW1iZXIoKSxcbiAgICAgICAgdmFsdWVTaGFwZTogTG9nRW50cnlTaGFwZVxuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBtYXBTdG9yZVxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIHJlc2V0KCkge1xuICAgICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIHRtcC5yZXNldEZvcihzZWxmKTtcbiAgICAgIH0sXG4gICAgICBkaXNwb3NlKCkge1xuICAgICAgICBjb25zdCB7IHN0YXRlLCBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IG1hcFN0b3JlIH0gPSBzdGF0ZTtcbiAgICAgICAgdG1wLnJlc2V0Rm9yKHNlbGYpO1xuICAgICAgICBtYXBTdG9yZS5jbGVhcigpO1xuICAgICAgfSxcbiAgICAgIGdldFVuZmlsdGVyZWRJbmRleCgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICByZXR1cm4gZXBoLnVuZmlsdGVyZWRJbmRleDtcbiAgICAgIH0sXG4gICAgICBnZXRJbmRleCgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICByZXR1cm4gZXBoLmluZGV4O1xuICAgICAgfSxcbiAgICAgIGdldExlbmd0aCgpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtYXBTdG9yZSB9ID0gc3RhdGU7XG4gICAgICAgIHJldHVybiBtYXBTdG9yZS5nZXRTaXplKCk7XG4gICAgICB9LFxuICAgICAgaXNSZXBsYXlpbmcoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUsIHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbWFwU3RvcmUgfSA9IHN0YXRlO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICByZXR1cm4gZXBoLnVuZmlsdGVyZWRJbmRleCA8IG1hcFN0b3JlLmdldFNpemUoKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIHBlZWtFbnRyeSgpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSwgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtYXBTdG9yZSB9ID0gc3RhdGU7XG4gICAgICAgIGNvbnN0IGVwaCA9IHRtcC5mb3Ioc2VsZik7XG4gICAgICAgIHNlbGYuaXNSZXBsYXlpbmcoKSB8fCB0aHJvd1JlZGFjdGVkYE5vIGxvbmdlciByZXBsYXlpbmc6ICR7cXVvdGUoZXBoLnVuZmlsdGVyZWRJbmRleCl9IHZzICR7cXVvdGUoXG4gICAgICAgICAgbWFwU3RvcmUuZ2V0U2l6ZSgpXG4gICAgICAgICl9YDtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gbWFwU3RvcmUuZ2V0KGVwaC51bmZpbHRlcmVkSW5kZXgpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSxcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgbmV4dFVuZmlsdGVyZWRFbnRyeSgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBzZWxmLnBlZWtFbnRyeSgpO1xuICAgICAgICBlcGgudW5maWx0ZXJlZEluZGV4ICs9IDE7XG4gICAgICAgIGlmIChlbnRyeUlzVmlzaWJsZShyZXN1bHQpKSB7XG4gICAgICAgICAgZXBoLmluZGV4ICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFzZWxmLmlzUmVwbGF5aW5nKCkpIHtcbiAgICAgICAgICBlcGgucmVwbGF5RG9uZUtpdC5yZXNvbHZlKHZvaWQgMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0sXG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIG5leHRFbnRyeSgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBsZXQgcmVzdWx0ID0gc2VsZi5uZXh0VW5maWx0ZXJlZEVudHJ5KCk7XG4gICAgICAgIHdoaWxlICghZW50cnlJc1Zpc2libGUocmVzdWx0KSkge1xuICAgICAgICAgIHNlbGYuaXNSZXBsYXlpbmcoKSB8fCB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgZW50cnkgYXQgbG9nIHRhaWw6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmVzdWx0ID0gc2VsZi5uZXh0VW5maWx0ZXJlZEVudHJ5KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0sXG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIHB1c2hFbnRyeShsYXRlc3RFbnRyeSkge1xuICAgICAgICBjb25zdCB7IHN0YXRlLCBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IG1hcFN0b3JlIH0gPSBzdGF0ZTtcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgIXNlbGYuaXNSZXBsYXlpbmcoKSB8fCB0aHJvd1JlZGFjdGVkYHN0aWxsIHJlcGxheWluZzogJHtxdW90ZShlcGgudW5maWx0ZXJlZEluZGV4KX0gdnMgJHtxdW90ZShtYXBTdG9yZS5nZXRTaXplKCkpfWA7XG4gICAgICAgIGNvbnN0IHB1c2hPbmUgPSAoZW50cnkpID0+IHtcbiAgICAgICAgICBlcGgudW5maWx0ZXJlZEluZGV4ID09PSBtYXBTdG9yZS5nZXRTaXplKCkgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogdW5maWx0ZXJlZEluZGV4IGNvbmZ1c2lvbiAke3F1b3RlKGVwaC51bmZpbHRlcmVkSW5kZXgpfSB2cyAke3F1b3RlKFxuICAgICAgICAgICAgbWFwU3RvcmUuZ2V0U2l6ZSgpXG4gICAgICAgICAgKX1gO1xuICAgICAgICAgIG1hcFN0b3JlLmluaXQoZXBoLnVuZmlsdGVyZWRJbmRleCwgZW50cnkpO1xuICAgICAgICAgIGVwaC51bmZpbHRlcmVkSW5kZXggKz0gMTtcbiAgICAgICAgICBpZiAoZW50cnlJc1Zpc2libGUoZW50cnkpKSB7XG4gICAgICAgICAgICBlcGguaW5kZXggKz0gMTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZXBoLnVuZmlsdGVyZWRJbmRleCA9PT0gbWFwU3RvcmUuZ2V0U2l6ZSgpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IHVuZmlsdGVyZWRJbmRleCBjb25mdXNpb24gJHtxdW90ZShlcGgudW5maWx0ZXJlZEluZGV4KX0gdnMgJHtxdW90ZShcbiAgICAgICAgICAgIG1hcFN0b3JlLmdldFNpemUoKVxuICAgICAgICAgICl9YDtcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGVwaC5pbml0aWFsUHVzaCkge1xuICAgICAgICAgIGNvbnN0IGluaXRpYWxFbnRyaWVzID0gZXBoLmluaXRpYWxQdXNoO1xuICAgICAgICAgIGVwaC5pbml0aWFsUHVzaCA9IHZvaWQgMDtcbiAgICAgICAgICBmb3IgKGNvbnN0IGluaXRpYWxFbnRyeSBvZiBpbml0aWFsRW50cmllcykge1xuICAgICAgICAgICAgcHVzaE9uZShpbml0aWFsRW50cnkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBwdXNoT25lKGxhdGVzdEVudHJ5KTtcbiAgICAgICAgcmV0dXJuIGVwaC51bmZpbHRlcmVkSW5kZXg7XG4gICAgICB9LFxuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBkdW1wVW5maWx0ZXJlZCgpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtYXBTdG9yZSB9ID0gc3RhdGU7XG4gICAgICAgIGNvbnN0IGxlbiA9IG1hcFN0b3JlLmdldFNpemUoKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBsZW47IGkyICs9IDEpIHtcbiAgICAgICAgICByZXN1bHQucHVzaChtYXBTdG9yZS5nZXQoaTIpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaGFyZGVuKHJlc3VsdCk7XG4gICAgICB9LFxuICAgICAgZHVtcCgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHNlbGYuZHVtcFVuZmlsdGVyZWQoKS5maWx0ZXIoZW50cnlJc1Zpc2libGUpKTtcbiAgICAgIH0sXG4gICAgICBwcm9taXNlUmVwbGF5RG9uZSgpIHtcbiAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICByZXR1cm4gZXBoLnJlcGxheURvbmVLaXQucHJvbWlzZTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG59O1xuXG4vL1xudmFyIEJpamVjdGlvbkkgPSBNLmludGVyZmFjZShcIkJpamVjdGlvblwiLCB7XG4gIHJlc2V0OiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gIHVud3JhcEluaXQ6IE0uY2FsbChNLnJhdygpLCBNLmFueSgpKS5yZXR1cm5zKE0ucmF3KCkpLFxuICBoYXNHdWVzdDogTS5jYWxsKE0ucmF3KCkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICBoYXNIb3N0OiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucyhNLmJvb2xlYW4oKSksXG4gIGhhczogTS5jYWxsKE0ucmF3KCksIE0uYW55KCkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICBndWVzdFRvSG9zdDogTS5jYWxsKE0ucmF3KCkpLnJldHVybnMoTS5hbnkoKSksXG4gIGhvc3RUb0d1ZXN0OiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucyhNLnJhdygpKVxufSk7XG52YXIgdG9LZXkgPSAoaykgPT4gKFxuICAvL1xuICBpc1Bhc3NhYmxlKGspID8gdG9QYXNzYWJsZUNhcChrKSA6IGtcbik7XG52YXIgbWFrZVZvd2lzaFN0b3JlID0gKG5hbWUpID0+IHtcbiAgY29uc3QgbWFwID0gLyogICAgICAgICAgICovIG5ldyBNYXAoKTtcbiAgcmV0dXJuIEZhcihuYW1lLCB7XG4gICAgaW5pdDogKGssIHYzKSA9PiB7XG4gICAgICBjb25zdCBrMiA9IHRvS2V5KGspO1xuICAgICAgIW1hcC5oYXMoazIpIHx8IC8vXG4gICAgICB0aHJvd1JlZGFjdGVkYCR7YmFyZU9yUXVvdGUobmFtZSl9IGtleSBhbHJlYWR5IGJvdW5kOiAke2t9IC0+ICR7bWFwLmdldChrMil9IHZzICR7djN9YDtcbiAgICAgIG1hcC5zZXQoazIsIHYzKTtcbiAgICB9LFxuICAgIGhhczogKGspID0+IG1hcC5oYXModG9LZXkoaykpLFxuICAgIGdldDogKGspID0+IHtcbiAgICAgIGNvbnN0IGsyID0gdG9LZXkoayk7XG4gICAgICBtYXAuaGFzKGsyKSB8fCAvL1xuICAgICAgdGhyb3dSZWRhY3RlZGAke2JhcmVPclF1b3RlKG5hbWUpfSBrZXkgbm90IGZvdW5kOiAke2t9YDtcbiAgICAgIHJldHVybiBtYXAuZ2V0KGsyKTtcbiAgICB9XG4gIH0pO1xufTtcbnZhciBwcmVwYXJlQmlqZWN0aW9uID0gKHpvbmUsIHVud3JhcCA9IChfaG9zdFdyYXBwZXIsIGd1ZXN0V3JhcHBlcikgPT4gZ3Vlc3RXcmFwcGVyKSA9PiB7XG4gIGNvbnN0IGcyaCA9IG1ha2VFcGhlbWVyYSgoKSA9PiBtYWtlVm93aXNoU3RvcmUoXCJndWVzdFRvSG9zdFwiKSk7XG4gIGNvbnN0IGgyZyA9IG1ha2VFcGhlbWVyYSgoKSA9PiBtYWtlVm93aXNoU3RvcmUoXCJob3N0VG9HdWVzdFwiKSk7XG4gIHJldHVybiB6b25lLmV4b0NsYXNzKFwiQmlqZWN0aW9uXCIsIEJpamVjdGlvbkksICgpID0+ICh7fSksIHtcbiAgICByZXNldCgpIHtcbiAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgIGcyaC5yZXNldEZvcihzZWxmKTtcbiAgICAgIGgyZy5yZXNldEZvcihzZWxmKTtcbiAgICB9LFxuICAgIHVud3JhcEluaXQoZzMsIGgpIHtcbiAgICAgIGhhcmRlbihnMyk7XG4gICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICBjb25zdCBndWVzdFRvSG9zdCA9IGcyaC5mb3Ioc2VsZik7XG4gICAgICBjb25zdCBob3N0VG9HdWVzdCA9IGgyZy5mb3Ioc2VsZik7XG4gICAgICBjb25zdCBnVW53cmFwcGVkID0gdW53cmFwKGgsIGczKTtcbiAgICAgICFob3N0VG9HdWVzdC5oYXMoaCkgfHwgdGhyb3dSZWRhY3RlZGBob3N0VG9HdWVzdCBrZXkgYWxyZWFkeSBib3VuZDogJHtofSAtPiAke2hvc3RUb0d1ZXN0LmdldChoKX0gdnMgJHtnVW53cmFwcGVkfWA7XG4gICAgICBndWVzdFRvSG9zdC5pbml0KGdVbndyYXBwZWQsIGgpO1xuICAgICAgaG9zdFRvR3Vlc3QuaW5pdChoLCBnVW53cmFwcGVkKTtcbiAgICAgIHNlbGYuaGFzKGdVbndyYXBwZWQsIGgpIHx8IC8vXG4gICAgICB0aHJvd1JlZGFjdGVkYGludGVybmFsOiAke2czfSA8LT4gJHtofWA7XG4gICAgICBpZiAoZzMgIT09IGdVbndyYXBwZWQpIHtcbiAgICAgICAgIWd1ZXN0VG9Ib3N0LmhhcyhnMykgfHwgLy9cbiAgICAgICAgdGhyb3dSZWRhY3RlZGBoaWRkZW4gZ3Vlc3Qgd3JhcHBlciBhbHJlYWR5IGJvdW5kICR7ZzN9YDtcbiAgICAgICAgZ3Vlc3RUb0hvc3QuaW5pdChnMywgaCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZ1Vud3JhcHBlZDtcbiAgICB9LFxuICAgIGhhc0d1ZXN0KGczKSB7XG4gICAgICBoYXJkZW4oZzMpO1xuICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgY29uc3QgZ3Vlc3RUb0hvc3QgPSBnMmguZm9yKHNlbGYpO1xuICAgICAgcmV0dXJuIGd1ZXN0VG9Ib3N0LmhhcyhnMyk7XG4gICAgfSxcbiAgICBoYXNIb3N0KGgpIHtcbiAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgIGNvbnN0IGhvc3RUb0d1ZXN0ID0gaDJnLmZvcihzZWxmKTtcbiAgICAgIHJldHVybiBob3N0VG9HdWVzdC5oYXMoaCk7XG4gICAgfSxcbiAgICBoYXMoZzMsIGgpIHtcbiAgICAgIGhhcmRlbihnMyk7XG4gICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICBjb25zdCBndWVzdFRvSG9zdCA9IGcyaC5mb3Ioc2VsZik7XG4gICAgICBjb25zdCBob3N0VG9HdWVzdCA9IGgyZy5mb3Ioc2VsZik7XG4gICAgICBpZiAoZ3Vlc3RUb0hvc3QuaGFzKGczKSkge1xuICAgICAgICB0b1Bhc3NhYmxlQ2FwKGd1ZXN0VG9Ib3N0LmdldChnMykpID09PSB0b1Bhc3NhYmxlQ2FwKGgpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGctPmggJHtnM30gLT4gJHtofSB2cyAke2d1ZXN0VG9Ib3N0LmdldChnMyl9YDtcbiAgICAgICAgaG9zdFRvR3Vlc3QuZ2V0KGgpID09PSBnMyB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsIGgtPmc6ICR7aH0gLT4gJHtnM30gdnMgJHtob3N0VG9HdWVzdC5nZXQoaCl9YDtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAhaG9zdFRvR3Vlc3QuaGFzKGgpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IHVuZXhwZWN0ZWQgaC0+ZyAke2h9IC0+ICR7aG9zdFRvR3Vlc3QuZ2V0KGgpfWA7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGd1ZXN0VG9Ib3N0KGczKSB7XG4gICAgICBoYXJkZW4oZzMpO1xuICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgY29uc3QgZ3Vlc3RUb0hvc3QgPSBnMmguZm9yKHNlbGYpO1xuICAgICAgcmV0dXJuIGd1ZXN0VG9Ib3N0LmdldChnMyk7XG4gICAgfSxcbiAgICBob3N0VG9HdWVzdChoKSB7XG4gICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICBjb25zdCBob3N0VG9HdWVzdCA9IGgyZy5mb3Ioc2VsZik7XG4gICAgICByZXR1cm4gaG9zdFRvR3Vlc3QuZ2V0KGgpO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVCaWplY3Rpb24pO1xuXG4vL1xudmFyIHtcbiAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IzLFxuICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOCxcbiAgY3JlYXRlOiBjcmVhdGU3LFxuICBmcm9tRW50cmllczogZnJvbUVudHJpZXMxNCxcbiAgZW50cmllczogZW50cmllczksXG4gIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlNlxufSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IG93bktleXMyMSB9ID0gUmVmbGVjdDtcbnZhciBGdW5jdGlvbldyYXBwZXJJID0gTS5pbnRlcmZhY2UoXCJGdW5jdGlvbldyYXBwZXJcIiwge1xuICBhcHBseTogTS5jYWxsKE0uYXJyYXkoKSkucmV0dXJucyhNLmFueSgpKVxufSk7XG52YXIgU3RhdGVBY2Nlc3NvckkgPSBNLmludGVyZmFjZShcIlN0YXRlQWNjZXNzb3JcIiwge1xuICBnZXQ6IE0uY2FsbChQcm9wZXJ0eUtleVNoYXBlKS5yZXR1cm5zKE0uYW55KCkpLFxuICBzZXQ6IE0uY2FsbChQcm9wZXJ0eUtleVNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKClcbn0pO1xudmFyIFVud3JhcHBlckkgPSBNLmludGVyZmFjZShcIlVud3JhcHBlclwiLCB7XG4gIHVud3JhcDogTS5jYWxsKE0ucmVtb3RhYmxlKFwiZ3Vlc3RXcmFwcGVkXCIpKS5yZXR1cm5zKE0ucmF3KCkpXG59KTtcbnZhciBmb3J3YXJkaW5nTWV0aG9kcyA9IChyZW0pID0+IHtcbiAgY29uc3Qga2V5czQgPSByZW1bR0VUX01FVEhPRF9OQU1FU10oKTtcbiAgY29uc3QgbWFrZU1ldGhvZEVudHJ5ID0gKGtleSkgPT4gZW50cmllczkoe1xuICAgIFtrZXldKC4uLmFyZ3MpIHtcbiAgICAgIHJldHVybiByZW1ba2V5XSguLi5hcmdzKTtcbiAgICB9XG4gIH0pWzBdO1xuICByZXR1cm4gZnJvbUVudHJpZXMxNChrZXlzNC5tYXAobWFrZU1ldGhvZEVudHJ5KSk7XG59O1xudmFyIHByZXBhcmVFbmRvd21lbnRUb29scyA9IChvdXRlclpvbmUsIG91dGVyT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHsgdm93VG9vbHMgPSBwcmVwYXJlU3dpbmdzZXRWb3dUb29scyhvdXRlclpvbmUpIH0gPSBvdXRlck9wdGlvbnM7XG4gIGNvbnN0IHsgbWFrZVZvd0tpdCB9ID0gdm93VG9vbHM7XG4gIGNvbnN0IGZ1bmN0aW9uVW53cmFwcGVyID0gb3V0ZXJab25lLmV4byhcIkZ1bmN0aW9uVW53cmFwcGVyXCIsIFVud3JhcHBlckksIHtcbiAgICB1bndyYXAoZ3Vlc3RXcmFwcGVkKSB7XG4gICAgICByZXR1cm4gRmFyKFwiVW53cmFwcGVkRnVuY3Rpb25cIiwgKC4uLmFyZ3MpID0+IGd1ZXN0V3JhcHBlZC5hcHBseShhcmdzKSk7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgbWFrZVN0YXRlVW53cmFwcGVyID0gb3V0ZXJab25lLmV4b0NsYXNzKFxuICAgIFwiU3RhdGVVbndyYXBwZXJcIixcbiAgICBVbndyYXBwZXJJLFxuICAgIChrZXlzNCkgPT4gKHsga2V5czoga2V5czQgfSksXG4gICAge1xuICAgICAgdW53cmFwKGd1ZXN0V3JhcHBlZCkge1xuICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IGtleXM6IGtleXM0IH0gPSBzdGF0ZTtcbiAgICAgICAgcmV0dXJuIGhhcmRlbihcbiAgICAgICAgICBjcmVhdGU3KFxuICAgICAgICAgICAgb2JqZWN0UHJvdG90eXBlNixcbiAgICAgICAgICAgIGZyb21FbnRyaWVzMTQoXG4gICAgICAgICAgICAgIGtleXM0LmZsYXRNYXAoXG4gICAgICAgICAgICAgICAgKGtleSkgPT4gZW50cmllczkoXG4gICAgICAgICAgICAgICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzOCh7XG4gICAgICAgICAgICAgICAgICAgIGdldCBba2V5XSgpIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ3Vlc3RXcmFwcGVkLmdldChrZXkpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzZXQgW2tleV0obmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICBndWVzdFdyYXBwZWQuc2V0KGtleSwgbmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IGVuZG93bWVudEtpbmRPZiA9IChlMikgPT4ge1xuICAgIGhhcmRlbihlMik7XG4gICAgaWYgKGlzUHJvbWlzZShlMikpIHtcbiAgICAgIHJldHVybiBcInByb21pc2VcIjtcbiAgICB9IGVsc2UgaWYgKG91dGVyWm9uZS5pc1N0b3JhYmxlKGUyKSkge1xuICAgICAgcmV0dXJuIFwic3RvcmFibGVcIjtcbiAgICB9IGVsc2UgaWYgKGlzUGFzc2FibGUoZTIpICYmIGlzUmVtb3RhYmxlKGUyKSkge1xuICAgICAgcmV0dXJuIFwiZmFyXCI7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZTIgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgcmV0dXJuIFwiZnVuY3Rpb25cIjtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBlMiA9PT0gXCJvYmplY3RcIikge1xuICAgICAgaWYgKGUyID09PSBudWxsKSB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IG51bGwgaXMgYWx3YXlzIHN0b3JhYmxlYDtcbiAgICAgIH1cbiAgICAgIGlmIChBcnJheS5pc0FycmF5KGUyKSkge1xuICAgICAgICByZXR1cm4gXCJhcnJheVwiO1xuICAgICAgfVxuICAgICAgY29uc3Qga2V5czQgPSBvd25LZXlzMjEoZTIpO1xuICAgICAga2V5czQubGVuZ3RoID49IDEgfHwgdGhyb3dSZWRhY3RlZGBlbXB0eSByZWNvcmQgc2hvdWxkIGJlIHN0b3JhYmxlICR7ZTJ9YDtcbiAgICAgIGNvbnN0IGRlc2MgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IzKGUyLCBrZXlzNFswXSlcbiAgICAgICk7XG4gICAgICBpZiAoXCJ2YWx1ZVwiIGluIGRlc2MpIHtcbiAgICAgICAgcmV0dXJuIFwicmVjb3JkXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBcImdldFwiIGluIGRlc2MgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogdW5leHBlY3RlZCBkZXNjcmlwdG9yICR7ZGVzY31gO1xuICAgICAgICByZXR1cm4gXCJzdGF0ZVwiO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZW5kb3dtZW50ICR7ZTJ9YDtcbiAgICB9XG4gIH07XG4gIGhhcmRlbihlbmRvd21lbnRLaW5kT2YpO1xuICBjb25zdCB1bndyYXBNYXAgPSBvdXRlclpvbmUud2Vha01hcFN0b3JlKFwidW53cmFwTWFwXCIsIHtcbiAgICBrZXlTaGFwZTogTS5yZW1vdGFibGUoXCJ3cmFwcGVkXCIpLFxuICAgIHZhbHVlU2hhcGU6IE0ucmVtb3RhYmxlKFwidW53cmFwcGVyXCIpXG4gIH0pO1xuICBjb25zdCB1bndyYXBNYXBIYXMgPSAoaykgPT4ge1xuICAgIGlmIChpc1ZvdyhrKSB8fCBpc1JlbW90YWJsZShrKSkge1xuICAgICAgcmV0dXJuIHVud3JhcE1hcC5oYXModG9QYXNzYWJsZUNhcChrKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHVud3JhcE1hcEdldCA9IChrKSA9PiB1bndyYXBNYXAuZ2V0KHRvUGFzc2FibGVDYXAoaykpO1xuICBjb25zdCB1bndyYXBNYXBTZXQgPSAoaywgdjMpID0+IHtcbiAgICBjb25zdCBrMiA9IHRvUGFzc2FibGVDYXAoayk7XG4gICAgaWYgKHVud3JhcE1hcEhhcyhrKSkge1xuICAgICAgdW53cmFwTWFwLnNldChrMiwgdjMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB1bndyYXBNYXAuaW5pdChrMiwgdjMpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgcHJlcGFyZUVuZG93bWVudCA9ICh6b25lLCB0YWcsIGUyKSA9PiB7XG4gICAgY29uc3QgZUtpbmQgPSBlbmRvd21lbnRLaW5kT2YoZTIpO1xuICAgIHN3aXRjaCAoZUtpbmQpIHtcbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgY29uc3QgcDMgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGUyXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHsgdm93LCByZXNvbHZlciB9ID0gbWFrZVZvd0tpdCgpO1xuICAgICAgICB2b2lkIEUud2hlbihcbiAgICAgICAgICBwMyxcbiAgICAgICAgICAodjMpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmVyLnJlc29sdmUodjMpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgKHJlYXNvbikgPT4ge1xuICAgICAgICAgICAgaWYgKCFpc1VwZ3JhZGVEaXNjb25uZWN0aW9uKHJlYXNvbikpIHtcbiAgICAgICAgICAgICAgcmVzb2x2ZXIucmVqZWN0KHJlYXNvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gdm93O1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0b3JhYmxlXCI6IHtcbiAgICAgICAgcmV0dXJuIGUyO1xuICAgICAgfVxuICAgICAgY2FzZSBcImZhclwiOiB7XG4gICAgICAgIGNvbnN0IHI1ID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGUyXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IG1ldGhvZHMgPSBmb3J3YXJkaW5nTWV0aG9kcyhyNSk7XG4gICAgICAgIHJldHVybiB6b25lLmV4byhcbiAgICAgICAgICB0YWcsXG4gICAgICAgICAgTS5pbnRlcmZhY2UoXCJGYXJXcmFwcGVkXCIsIHt9LCB7IGRlZmF1bHRHdWFyZHM6IFwicmF3XCIgfSksXG4gICAgICAgICAgbWV0aG9kc1xuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcImZ1bmN0aW9uXCI6IHtcbiAgICAgICAgY29uc3QgZjIgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBlMlxuICAgICAgICApO1xuICAgICAgICBjb25zdCB3cmFwcGVkID0gem9uZS5leG8odGFnLCBGdW5jdGlvbldyYXBwZXJJLCB7XG4gICAgICAgICAgYXBwbHkoYXJncykge1xuICAgICAgICAgICAgcmV0dXJuIGYyKC4uLmFyZ3MpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHVud3JhcE1hcFNldCh3cmFwcGVkLCBmdW5jdGlvblVud3JhcHBlcik7XG4gICAgICAgIHJldHVybiB3cmFwcGVkO1xuICAgICAgfVxuICAgICAgY2FzZSBcImFycmF5XCI6IHtcbiAgICAgICAgY29uc3QgYTIgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgZTJcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3Qgc3ViWm9uZSA9IHpvbmUuc3ViWm9uZSh0YWcpO1xuICAgICAgICByZXR1cm4gYTIubWFwKChzdWJFLCBpMikgPT4gcHJlcGFyZUVuZG93bWVudChzdWJab25lLCBgJHtpMn1gLCBzdWJFKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVjb3JkXCI6IHtcbiAgICAgICAgY29uc3QgcjUgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGUyXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHN1YlpvbmUgPSB6b25lLnN1YlpvbmUodGFnKTtcbiAgICAgICAgcmV0dXJuIG9iamVjdE1hcChcbiAgICAgICAgICByNSxcbiAgICAgICAgICAoc3ViRSwgaykgPT4gcHJlcGFyZUVuZG93bWVudChzdWJab25lLCBTdHJpbmcoayksIHN1YkUpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjYXNlIFwic3RhdGVcIjoge1xuICAgICAgICBjb25zdCBzdGF0ZSA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgZTJcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3Qga2V5czQgPSBoYXJkZW4ob3duS2V5czIxKHN0YXRlKSk7XG4gICAgICAgIGNvbnN0IHdyYXBwZWQgPSB6b25lLmV4byh0YWcsIFN0YXRlQWNjZXNzb3JJLCB7XG4gICAgICAgICAgZ2V0KGtleSkge1xuICAgICAgICAgICAgcmV0dXJuIHN0YXRlW2tleV07XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXQoa2V5LCBuZXdWYWx1ZSkge1xuICAgICAgICAgICAgc3RhdGVba2V5XSA9IG5ld1ZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHN0YXRlVW53cmFwcGVyID0gbWFrZVN0YXRlVW53cmFwcGVyKGtleXM0KTtcbiAgICAgICAgdW53cmFwTWFwU2V0KHdyYXBwZWQsIHN0YXRlVW53cmFwcGVyKTtcbiAgICAgICAgcmV0dXJuIHdyYXBwZWQ7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBlbmRvd21lbnQgJHtlMn1gO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgdW53cmFwID0gKHdyYXBwZWQsIGd1ZXN0V3JhcHBlZCkgPT4ge1xuICAgIGlmICh1bndyYXBNYXBIYXMod3JhcHBlZCkpIHtcbiAgICAgIGNvbnN0IHVud3JhcHBlciA9IHVud3JhcE1hcEdldCh3cmFwcGVkKTtcbiAgICAgIHJldHVybiB1bndyYXBwZXIudW53cmFwKGd1ZXN0V3JhcHBlZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBndWVzdFdyYXBwZWQ7XG4gICAgfVxuICB9O1xuICByZXR1cm4gaGFyZGVuKHsgcHJlcGFyZUVuZG93bWVudCwgdW53cmFwIH0pO1xufTtcbmhhcmRlbihwcmVwYXJlRW5kb3dtZW50VG9vbHMpO1xuXG4vL1xudmFyIHsgZGVmaW5lUHJvcGVydGllczogZGVmaW5lUHJvcGVydGllczYgfSA9IE9iamVjdDtcbnZhciBBc3luY0Zsb3dJS2l0ID0gaGFyZGVuKHtcbiAgZmxvdzogTS5pbnRlcmZhY2UoXCJGbG93XCIsIHtcbiAgICBnZXRGbG93U3RhdGU6IE0uY2FsbCgpLnJldHVybnMoRmxvd1N0YXRlU2hhcGUpLFxuICAgIHJlc3RhcnQ6IE0uY2FsbCgpLm9wdGlvbmFsKE0uYm9vbGVhbigpKS5yZXR1cm5zKCksXG4gICAgd2FrZTogTS5jYWxsKCkucmV0dXJucygpLFxuICAgIGdldE91dGNvbWU6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpLFxuICAgIGR1bXA6IE0uY2FsbCgpLnJldHVybnMoTS5hcnJheU9mKExvZ0VudHJ5U2hhcGUpKSxcbiAgICBnZXRPcHRGYXRhbFByb2JsZW06IE0uY2FsbCgpLnJldHVybnMoTS5vcHQoTS5lcnJvcigpKSlcbiAgfSksXG4gIGFkbWluOiBNLmludGVyZmFjZShcIkZsb3dBZG1pblwiLCB7XG4gICAgcmVzZXQ6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgICBjb21wbGV0ZTogTS5jYWxsKCkucmV0dXJucygpLFxuICAgIHBhbmljOiBNLmNhbGwoTS5lcnJvcigpKS5yZXR1cm5zKE0ubm90KE0uYW55KCkpKVxuICAgIC8vXG4gIH0pLFxuICB3YWtlV2F0Y2hlcjogUHJvbWlzZVdhdGNoZXJJXG59KTtcbnZhciBBZG1pbkFzeW5jRmxvd0kgPSBNLmludGVyZmFjZShcIkFzeW5jRmxvd0FkbWluXCIsIHtcbiAgZ2V0RmFpbHVyZXM6IE0uY2FsbCgpLnJldHVybnMoTS5tYXBPZihNLnJlbW90YWJsZShcImFzeW5jRmxvd1wiKSwgTS5lcnJvcigpKSksXG4gIHdha2VBbGw6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgZ2V0Rmxvd0Zvck91dGNvbWVWb3c6IE0uY2FsbChWb3dTaGFwZSkucmV0dXJucyhNLm9wdChNLnJlbW90YWJsZShcImZsb3dcIikpKVxufSk7XG52YXIgcHJlcGFyZUFzeW5jRmxvd1Rvb2xzID0gKG91dGVyWm9uZSwgb3V0ZXJPcHRpb25zID0ge30pID0+IHtcbiAgY29uc3Qge1xuICAgIHZvd1Rvb2xzID0gcHJlcGFyZVN3aW5nc2V0Vm93VG9vbHMob3V0ZXJab25lKSxcbiAgICBtYWtlTG9nU3RvcmUgPSBwcmVwYXJlTG9nU3RvcmUob3V0ZXJab25lKSxcbiAgICBlbmRvd21lbnRUb29sczogeyBwcmVwYXJlRW5kb3dtZW50LCB1bndyYXAgfSA9IHByZXBhcmVFbmRvd21lbnRUb29scyhcbiAgICAgIG91dGVyWm9uZSxcbiAgICAgIHsgdm93VG9vbHMgfVxuICAgICksXG4gICAgbWFrZUJpamVjdGlvbiA9IHByZXBhcmVCaWplY3Rpb24ob3V0ZXJab25lLCB1bndyYXApLFxuICAgIHBhbmljSGFuZGxlciA9IChlcnIpID0+IHtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH0gPSBvdXRlck9wdGlvbnM7XG4gIGNvbnN0IHsgd2F0Y2gsIG1ha2VWb3dLaXQgfSA9IHZvd1Rvb2xzO1xuICBjb25zdCBmYWlsdXJlcyA9IG91dGVyWm9uZS5tYXBTdG9yZShcImFzeW5jRnVuY0ZhaWx1cmVzXCIsIHtcbiAgICBrZXlTaGFwZTogTS5yZW1vdGFibGUoXCJmbG93XCIpLFxuICAgIC8vXG4gICAgdmFsdWVTaGFwZTogTS5lcnJvcigpXG4gIH0pO1xuICBjb25zdCBlYWdlcldha2VycyA9IG91dGVyWm9uZS5zZXRTdG9yZShgYXN5bmNGdW5jRWFnZXJXYWtlcnNgLCB7XG4gICAga2V5U2hhcGU6IE0ucmVtb3RhYmxlKFwiZmxvd1wiKVxuICAgIC8vXG4gIH0pO1xuICBjb25zdCBtZW1icmFuZU1hcCA9IG1ha2VTY2FsYXJXZWFrTWFwU3RvcmUoXCJtZW1icmFuZUZvclwiLCB7XG4gICAga2V5U2hhcGU6IE0ucmVtb3RhYmxlKFwiZmxvd1wiKSxcbiAgICB2YWx1ZVNoYXBlOiBNLnJlbW90YWJsZShcIm1lbWJyYW5lXCIpXG4gIH0pO1xuICBjb25zdCBoYXNNZW1icmFuZSA9IChmbG93KSA9PiBtZW1icmFuZU1hcC5oYXMoZmxvdyk7XG4gIGNvbnN0IGdldE1lbWJyYW5lID0gKGZsb3cpID0+IG1lbWJyYW5lTWFwLmdldChmbG93KTtcbiAgY29uc3QgaW5pdE1lbWJyYW5lID0gKGZsb3csIG1lbWJyYW5lKSA9PiBtZW1icmFuZU1hcC5pbml0KGZsb3csIG1lbWJyYW5lKTtcbiAgY29uc3QgZGVsZXRlTWVtYnJhbmUgPSAoZmxvdykgPT4gbWVtYnJhbmVNYXAuZGVsZXRlKGZsb3cpO1xuICBjb25zdCBmbG93Rm9yT3V0Y29tZVZvd0tleSA9IG91dGVyWm9uZS5tYXBTdG9yZShcImZsb3dGb3JPdXRjb21lVm93XCIsIHtcbiAgICBrZXlTaGFwZTogTS5yZW1vdGFibGUoXCJ0b1Bhc3NhYmxlQ2FwXCIpLFxuICAgIHZhbHVlU2hhcGU6IE0ucmVtb3RhYmxlKFwiZmxvd1wiKVxuICAgIC8vXG4gIH0pO1xuICBjb25zdCBwcmVwYXJlQXN5bmNGbG93S2l0ID0gKHpvbmUsIHRhZywgZ3Vlc3RBc3luY0Z1bmMsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICAgIHR5cGVvZiBndWVzdEFzeW5jRnVuYyA9PT0gXCJmdW5jdGlvblwiIHx8IHRocm93UmVkYWN0ZWRgZ3Vlc3RBc3luY0Z1bmMgbXVzdCBiZSBhIGNhbGxhYmxlIGZ1bmN0aW9uICR7Z3Vlc3RBc3luY0Z1bmN9YDtcbiAgICBjb25zdCB7XG4gICAgICAvL1xuICAgICAgc3RhcnRFYWdlciA9IHRydWVcbiAgICB9ID0gb3B0aW9ucztcbiAgICBjb25zdCBpbnRlcm5hbE1ha2VBc3luY0Zsb3dLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgICAgdGFnLFxuICAgICAgQXN5bmNGbG93SUtpdCxcbiAgICAgIChhY3RpdmF0aW9uQXJncykgPT4ge1xuICAgICAgICBoYXJkZW4oYWN0aXZhdGlvbkFyZ3MpO1xuICAgICAgICBjb25zdCBsb2cgPSBtYWtlTG9nU3RvcmUoKTtcbiAgICAgICAgY29uc3QgYmlqZWN0aW9uID0gbWFrZUJpamVjdGlvbigpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFjdGl2YXRpb25BcmdzLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgbG9nLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgYmlqZWN0aW9uLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgb3V0Y29tZUtpdDogbWFrZVZvd0tpdCgpLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgaXNEb25lOiBmYWxzZVxuICAgICAgICAgIC8vXG4gICAgICAgIH07XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBmbG93OiB7XG4gICAgICAgICAgLypcblxuICAgICAgICAgICAqL1xuICAgICAgICAgIGdldEZsb3dTdGF0ZSgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgbG9nLCBvdXRjb21lS2l0LCBpc0RvbmUgfSA9IHN0YXRlO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93IH0gPSBmYWNldHM7XG4gICAgICAgICAgICBpZiAoaXNEb25lKSB7XG4gICAgICAgICAgICAgICFoYXNNZW1icmFuZShmbG93KSB8fCB0aHJvd1JlZGFjdGVkYERvbmUgZmxvdyBtdXN0IGRyb3AgbWVtYnJhbmUgJHtmbG93fSAke2dldE1lbWJyYW5lKGZsb3cpfWA7XG4gICAgICAgICAgICAgICFmYWlsdXJlcy5oYXMoZmxvdykgfHwgdGhyb3dSZWRhY3RlZGBEb25lIGZsb3cgbXVzdCBub3QgYmUgaW4gZmFpbHVyZXMgJHtmbG93fSAke2ZhaWx1cmVzLmdldChmbG93KX1gO1xuICAgICAgICAgICAgICAhZWFnZXJXYWtlcnMuaGFzKGZsb3cpIHx8IHRocm93UmVkYWN0ZWRgRG9uZSBmbG93IG11c3Qgbm90IGJlIGluIGVhZ2VyV2FrZXJzICR7Zmxvd31gO1xuICAgICAgICAgICAgICAhZmxvd0Zvck91dGNvbWVWb3dLZXkuaGFzKG91dGNvbWVLaXQudm93KSB8fCB0aHJvd1JlZGFjdGVkYERvbmUgZmxvdyBtdXN0IGRyb3AgZmxvdyBsb29rdXAgZnJvbSB2b3cgJHtvdXRjb21lS2l0LnZvd31gO1xuICAgICAgICAgICAgICBsb2cuZ2V0SW5kZXgoKSA9PT0gMCAmJiBsb2cuZ2V0TGVuZ3RoKCkgPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBEb25lIGZsb3cgbXVzdCBlbXB0eSBsb2cgJHtmbG93fSAke2xvZ31gO1xuICAgICAgICAgICAgICByZXR1cm4gXCJEb25lXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZmFpbHVyZXMuaGFzKGZsb3cpKSB7XG4gICAgICAgICAgICAgIHJldHVybiBcIkZhaWxlZFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFoYXNNZW1icmFuZShmbG93KSkge1xuICAgICAgICAgICAgICBsb2cuZ2V0SW5kZXgoKSA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYFNsZWVwaW5nIGZsb3cgbXVzdCBwbGF5IGZyb20gbG9nIHN0YXJ0ICR7Zmxvd30gJHtsb2cuZ2V0SW5kZXgoKX1gO1xuICAgICAgICAgICAgICByZXR1cm4gXCJTbGVlcGluZ1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGxvZy5pc1JlcGxheWluZygpKSB7XG4gICAgICAgICAgICAgIHJldHVybiBcIlJlcGxheWluZ1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFwiUnVubmluZ1wiO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgLypcblxuXG5cblxuICAgICAgICAgICAqL1xuICAgICAgICAgIHJlc3RhcnQoZWFnZXIgPSBzdGFydEVhZ2VyKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGFjdGl2YXRpb25BcmdzLCBsb2csIGJpamVjdGlvbiwgb3V0Y29tZUtpdCB9ID0gc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3csIGFkbWluLCB3YWtlV2F0Y2hlciB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgY29uc3Qgc3RhcnRGbG93U3RhdGUgPSBmbG93LmdldEZsb3dTdGF0ZSgpO1xuICAgICAgICAgICAgc3RhcnRGbG93U3RhdGUgIT09IFwiRG9uZVwiIHx8IC8vXG4gICAgICAgICAgICB0aHJvd1JlZGFjdGVkYENhbm5vdCByZXN0YXJ0IGEgZG9uZSBmbG93ICR7Zmxvd31gO1xuICAgICAgICAgICAgYWRtaW4ucmVzZXQoKTtcbiAgICAgICAgICAgIGlmIChlYWdlcikge1xuICAgICAgICAgICAgICBlYWdlcldha2Vycy5hZGQoZmxvdyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVhZ2VyV2FrZXJzLmhhcyhmbG93KSkge1xuICAgICAgICAgICAgICBlYWdlcldha2Vycy5kZWxldGUoZmxvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB3YXRjaFdha2UgPSAodm93aXNoKSA9PiB7XG4gICAgICAgICAgICAgIHpvbmUuaXNTdG9yYWJsZSh2b3dpc2gpIHx8IHRocm93UmVkYWN0ZWRgdm93aXNoIG11c3QgYmUgc3RvcmFibGUgaW4gdGhpcyB6b25lICh1c3VhbGx5LCBtdXN0IGJlIGR1cmFibGUpOiAke3Zvd2lzaH1gO1xuICAgICAgICAgICAgICB6b25lLmlzU3RvcmFibGUod2FrZVdhdGNoZXIpIHx8IHRocm93UmVkYWN0ZWRgd2FrZVdhdGNoZXIgbXVzdCBiZSBzdG9yYWJsZSBpbiB0aGlzIHpvbmUgKHVzdWFsbHksIG11c3QgYmUgZHVyYWJsZSk6ICR7d2FrZVdhdGNoZXJ9YDtcbiAgICAgICAgICAgICAgd2F0Y2godm93aXNoLCB3YWtlV2F0Y2hlcik7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgcGFuaWMgPSAoZXJyKSA9PiBhZG1pbi5wYW5pYyhlcnIpO1xuICAgICAgICAgICAgY29uc3QgbWVtYnJhbmUgPSBtYWtlUmVwbGF5TWVtYnJhbmUoe1xuICAgICAgICAgICAgICBsb2csXG4gICAgICAgICAgICAgIGJpamVjdGlvbixcbiAgICAgICAgICAgICAgdm93VG9vbHMsXG4gICAgICAgICAgICAgIHdhdGNoV2FrZSxcbiAgICAgICAgICAgICAgcGFuaWNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaW5pdE1lbWJyYW5lKGZsb3csIG1lbWJyYW5lKTtcbiAgICAgICAgICAgIGNvbnN0IGd1ZXN0QXJncyA9IG1lbWJyYW5lLmhvc3RUb0d1ZXN0KGFjdGl2YXRpb25BcmdzKTtcbiAgICAgICAgICAgIGNvbnN0IGZsb3dTdGF0ZSA9IGZsb3cuZ2V0Rmxvd1N0YXRlKCk7XG4gICAgICAgICAgICBmbG93U3RhdGUgPT09IFwiUnVubmluZ1wiIHx8IGZsb3dTdGF0ZSA9PT0gXCJSZXBsYXlpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYFJlc3RhcnRlZCBmbG93IG11c3QgYmUgUnVubmluZyBvciBSZXBsYXlpbmcgJHtmbG93fWA7XG4gICAgICAgICAgICBtZW1icmFuZS53YWtlKCk7XG4gICAgICAgICAgICBjb25zdCBndWVzdFJlc3VsdFAgPSAoYXN5bmMgKCkgPT4gKFxuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBndWVzdEFzeW5jRnVuYyguLi5ndWVzdEFyZ3MpXG4gICAgICAgICAgICApKSgpO1xuICAgICAgICAgICAgaWYgKGZsb3cuZ2V0Rmxvd1N0YXRlKCkgIT09IFwiRmFpbGVkXCIpIHtcbiAgICAgICAgICAgICAgY29uc3QgZzMgPSBiaWplY3Rpb24udW53cmFwSW5pdChndWVzdFJlc3VsdFAsIG91dGNvbWVLaXQudm93KTtcbiAgICAgICAgICAgICAgZzMgPT09IGd1ZXN0UmVzdWx0UCB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBwcm9taXNlcyBzaG91bGQgbm90IGJlIHVud3JhcHBlZCAke2czfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2b2lkIEUud2hlbihcbiAgICAgICAgICAgICAgZ3Vlc3RSZXN1bHRQLFxuICAgICAgICAgICAgICAoZ0Z1bGZpbGxtZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGJpamVjdGlvbi5oYXNHdWVzdChndWVzdFJlc3VsdFApKSB7XG4gICAgICAgICAgICAgICAgICAhbG9nLmlzUmVwbGF5aW5nKCkgfHwgcGFuaWMoXG4gICAgICAgICAgICAgICAgICAgIG1ha2VFcnJvcihcbiAgICAgICAgICAgICAgICAgICAgICByZWRhY3RlZGBndWVzdCBmdWxmaWxsZWQgd2l0aCAke2dGdWxmaWxsbWVudH0gYmVmb3JlIGZpbmlzaGluZyByZXBsYXlgXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICBvdXRjb21lS2l0LnJlc29sdmVyLnJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgIG1lbWJyYW5lLmd1ZXN0VG9Ib3N0KGdGdWxmaWxsbWVudClcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICBhZG1pbi5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgKGd1ZXN0UmVhc29uKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGJpamVjdGlvbi5oYXNHdWVzdChndWVzdFJlc3VsdFApKSB7XG4gICAgICAgICAgICAgICAgICAhbG9nLmlzUmVwbGF5aW5nKCkgfHwgcGFuaWMoXG4gICAgICAgICAgICAgICAgICAgIG1ha2VFcnJvcihcbiAgICAgICAgICAgICAgICAgICAgICByZWRhY3RlZGBndWVzdCByZWplY3RlZCB3aXRoICR7Z3Vlc3RSZWFzb259IGJlZm9yZSBmaW5pc2hpbmcgcmVwbGF5YFxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgb3V0Y29tZUtpdC5yZXNvbHZlci5yZWplY3QobWVtYnJhbmUuZ3Vlc3RUb0hvc3QoZ3Vlc3RSZWFzb24pKTtcbiAgICAgICAgICAgICAgICAgIGFkbWluLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApLnRoZW4oXG4gICAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmxvdy5nZXRGbG93U3RhdGUoKSA9PT0gXCJGYWlsZWRcIikge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgZmxvdy5nZXRPcHRGYXRhbFByb2JsZW0oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIChtYXliZVBhbmljUmVhc29uKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGZsb3cuZ2V0Rmxvd1N0YXRlKCkgPT09IFwiRmFpbGVkXCIpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGVycjIgPSBmbG93LmdldE9wdEZhdGFsUHJvYmxlbSgpO1xuICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyMjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgZXJyID0gbWFrZUVycm9yKFxuICAgICAgICAgICAgICAgICAgcmVkYWN0ZWRgaW50ZXJuYWw6IHVuZXhwZWN0ZWQgZXJyb3IgaW4gZ3Vlc3QgY29tcGxldGlvbiBoYW5kbGluZyAke21heWJlUGFuaWNSZWFzb259YFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgIHBhbmljKGVycik7XG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoX2UpIHtcbiAgICAgICAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICkuY2F0Y2gocGFuaWNIYW5kbGVyKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHdha2UoKSB7XG4gICAgICAgICAgICBjb25zdCB7IGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgZmxvd1N0YXRlID0gZmxvdy5nZXRGbG93U3RhdGUoKTtcbiAgICAgICAgICAgIHN3aXRjaCAoZmxvd1N0YXRlKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJEb25lXCI6XG4gICAgICAgICAgICAgIGNhc2UgXCJGYWlsZWRcIjoge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjYXNlIFwiUnVubmluZ1wiOlxuICAgICAgICAgICAgICBjYXNlIFwiUmVwbGF5aW5nXCI6IHtcbiAgICAgICAgICAgICAgICBnZXRNZW1icmFuZShmbG93KS53YWtlKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNhc2UgXCJTbGVlcGluZ1wiOiB7XG4gICAgICAgICAgICAgICAgZmxvdy5yZXN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZmxvd1N0YXRlICR7cXVvdGUoZmxvd1N0YXRlKX1gO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXRPdXRjb21lKCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgb3V0Y29tZUtpdCB9ID0gc3RhdGU7XG4gICAgICAgICAgICByZXR1cm4gb3V0Y29tZUtpdC52b3c7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkdW1wKCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgbG9nIH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIHJldHVybiBsb2cuZHVtcCgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0T3B0RmF0YWxQcm9ibGVtKCkge1xuICAgICAgICAgICAgY29uc3QgeyBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3cgfSA9IGZhY2V0cztcbiAgICAgICAgICAgIHJldHVybiBmYWlsdXJlcy5oYXMoZmxvdykgPyBmYWlsdXJlcy5nZXQoZmxvdykgOiB2b2lkIDA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBhZG1pbjoge1xuICAgICAgICAgIHJlc2V0KCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBiaWplY3Rpb24sIGxvZyB9ID0gc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3cgfSA9IGZhY2V0cztcbiAgICAgICAgICAgICFzdGF0ZS5pc0RvbmUgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcmVzZXQgYSBkb25lIGZsb3dgO1xuICAgICAgICAgICAgaWYgKGZhaWx1cmVzLmhhcyhmbG93KSkge1xuICAgICAgICAgICAgICBmYWlsdXJlcy5kZWxldGUoZmxvdyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaGFzTWVtYnJhbmUoZmxvdykpIHtcbiAgICAgICAgICAgICAgZ2V0TWVtYnJhbmUoZmxvdykuc3RvcCgpO1xuICAgICAgICAgICAgICBkZWxldGVNZW1icmFuZShmbG93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxvZy5yZXNldCgpO1xuICAgICAgICAgICAgYmlqZWN0aW9uLnJlc2V0KCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb21wbGV0ZSgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgbG9nIH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdywgYWRtaW4gfSA9IGZhY2V0cztcbiAgICAgICAgICAgIGFkbWluLnJlc2V0KCk7XG4gICAgICAgICAgICBpZiAoZWFnZXJXYWtlcnMuaGFzKGZsb3cpKSB7XG4gICAgICAgICAgICAgIGVhZ2VyV2FrZXJzLmRlbGV0ZShmbG93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZsb3dGb3JPdXRjb21lVm93S2V5LmRlbGV0ZSh0b1Bhc3NhYmxlQ2FwKGZsb3cuZ2V0T3V0Y29tZSgpKSk7XG4gICAgICAgICAgICBzdGF0ZS5pc0RvbmUgPSB0cnVlO1xuICAgICAgICAgICAgbG9nLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgIGZsb3cuZ2V0Rmxvd1N0YXRlKCkgPT09IFwiRG9uZVwiIHx8IHRocm93UmVkYWN0ZWRgQ29tcGxldGUgZmxvdyBtdXN0IGJlIERvbmUgJHtmbG93fWA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwYW5pYyhmYXRhbFByb2JsZW0pIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgYmlqZWN0aW9uLCBsb2cgfSA9IHN0YXRlO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93IH0gPSBmYWNldHM7XG4gICAgICAgICAgICBpZiAoZmFpbHVyZXMuaGFzKGZsb3cpKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHByZXZFcnIgPSBmYWlsdXJlcy5nZXQoZmxvdyk7XG4gICAgICAgICAgICAgIG5vdGUoXG4gICAgICAgICAgICAgICAgcHJldkVycixcbiAgICAgICAgICAgICAgICByZWRhY3RlZGBkb3VibHkgZmFpbGVkIHNvbWVob3cgd2l0aCAke2ZhdGFsUHJvYmxlbX1gXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIGZhdGFsUHJvYmxlbSA9IHByZXZFcnI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBmYWlsdXJlcy5pbml0KGZsb3csIGZhdGFsUHJvYmxlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaGFzTWVtYnJhbmUoZmxvdykpIHtcbiAgICAgICAgICAgICAgZ2V0TWVtYnJhbmUoZmxvdykuc3RvcCgpO1xuICAgICAgICAgICAgICBkZWxldGVNZW1icmFuZShmbG93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxvZy5yZXNldCgpO1xuICAgICAgICAgICAgYmlqZWN0aW9uLnJlc2V0KCk7XG4gICAgICAgICAgICBmbG93LmdldEZsb3dTdGF0ZSgpID09PSBcIkZhaWxlZFwiIHx8IHRocm93UmVkYWN0ZWRgUGFuaWNrZWQgZmxvdyBtdXN0IGJlIEZhaWxlZCAke2Zsb3d9YDtcbiAgICAgICAgICAgIGNvbnN0IGVyciA9IG1ha2VFcnJvcihcbiAgICAgICAgICAgICAgcmVkYWN0ZWRgSW4gYSBGYWlsZWQgc3RhdGU6IHNlZSBnZXRGYWlsdXJlcygpIG9yIGdldE9wdEZhdGFsUHJvYmxlbSgpIGZvciBtb3JlIGluZm9ybWF0aW9uYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIG5vdGUoZXJyLCByZWRhY3RlZGBkdWUgdG8gJHtmYXRhbFByb2JsZW19YCk7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB3YWtlV2F0Y2hlcjoge1xuICAgICAgICAgIG9uRnVsZmlsbGVkKF9mdWxmaWxsbWVudCkge1xuICAgICAgICAgICAgY29uc3QgeyBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBmYWNldHMuZmxvdy53YWtlKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvblJlamVjdGVkKF9mdWxmaWxsbWVudCkge1xuICAgICAgICAgICAgY29uc3QgeyBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBmYWNldHMuZmxvdy53YWtlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgICBjb25zdCBtYWtlQXN5bmNGbG93S2l0ID0gKGFjdGl2YXRpb25BcmdzKSA9PiB7XG4gICAgICBjb25zdCBhc3luY0Zsb3dLaXQgPSBpbnRlcm5hbE1ha2VBc3luY0Zsb3dLaXQoYWN0aXZhdGlvbkFyZ3MpO1xuICAgICAgY29uc3QgeyBmbG93IH0gPSBhc3luY0Zsb3dLaXQ7XG4gICAgICBjb25zdCB2b3cgPSBmbG93LmdldE91dGNvbWUoKTtcbiAgICAgIGZsb3dGb3JPdXRjb21lVm93S2V5LmluaXQodG9QYXNzYWJsZUNhcCh2b3cpLCBmbG93KTtcbiAgICAgIGZsb3cucmVzdGFydCgpO1xuICAgICAgcmV0dXJuIGFzeW5jRmxvd0tpdDtcbiAgICB9O1xuICAgIHJldHVybiBoYXJkZW4obWFrZUFzeW5jRmxvd0tpdCk7XG4gIH07XG4gIGNvbnN0IGFzeW5jRmxvdyA9ICh6b25lLCB0YWcsIGd1ZXN0RnVuYywgb3B0aW9ucyA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IG1ha2VBc3luY0Zsb3dLaXQgPSBwcmVwYXJlQXN5bmNGbG93S2l0KHpvbmUsIHRhZywgZ3Vlc3RGdW5jLCBvcHRpb25zKTtcbiAgICBjb25zdCBob3N0RnVuY05hbWUgPSBgJHt0YWd9X2hvc3RGbG93YDtcbiAgICBjb25zdCB3cmFwcGVyRnVuYyA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAge1xuICAgICAgICBbaG9zdEZ1bmNOYW1lXSguLi5hcmdzKSB7XG4gICAgICAgICAgY29uc3QgeyBmbG93IH0gPSBtYWtlQXN5bmNGbG93S2l0KGFyZ3MpO1xuICAgICAgICAgIHJldHVybiBmbG93LmdldE91dGNvbWUoKTtcbiAgICAgICAgfVxuICAgICAgfVtob3N0RnVuY05hbWVdXG4gICAgKTtcbiAgICBkZWZpbmVQcm9wZXJ0aWVzNih3cmFwcGVyRnVuYywge1xuICAgICAgbGVuZ3RoOiB7IHZhbHVlOiBndWVzdEZ1bmMubGVuZ3RoIH1cbiAgICB9KTtcbiAgICByZXR1cm4gaGFyZGVuKHdyYXBwZXJGdW5jKTtcbiAgfTtcbiAgY29uc3QgYWRtaW5Bc3luY0Zsb3cgPSBvdXRlclpvbmUuZXhvKFwiQWRtaW5Bc3luY0Zsb3dcIiwgQWRtaW5Bc3luY0Zsb3dJLCB7XG4gICAgZ2V0RmFpbHVyZXMoKSB7XG4gICAgICByZXR1cm4gZmFpbHVyZXMuc25hcHNob3QoKTtcbiAgICB9LFxuICAgIHdha2VBbGwoKSB7XG4gICAgICBjb25zdCBmYWlsdXJlc1RvUmVzdGFydCA9IFsuLi5mYWlsdXJlcy5rZXlzKCldO1xuICAgICAgY29uc3QgZmxvd3NUb1dha2UgPSBbLi4uZWFnZXJXYWtlcnMua2V5cygpXTtcbiAgICAgIGZvciAoY29uc3QgZmxvdyBvZiBmYWlsdXJlc1RvUmVzdGFydCkge1xuICAgICAgICBmbG93LnJlc3RhcnQoKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3QgZmxvdyBvZiBmbG93c1RvV2FrZSkge1xuICAgICAgICBmbG93Lndha2UoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGdldEZsb3dGb3JPdXRjb21lVm93KG91dGNvbWVWb3cpIHtcbiAgICAgIHJldHVybiBmbG93Rm9yT3V0Y29tZVZvd0tleS5nZXQodG9QYXNzYWJsZUNhcChvdXRjb21lVm93KSk7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgYWxsV29rZW5QID0gRS53aGVuKG51bGwsICgpID0+IGFkbWluQXN5bmNGbG93Lndha2VBbGwoKSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIHByZXBhcmVBc3luY0Zsb3dLaXQsXG4gICAgYXN5bmNGbG93LFxuICAgIGFkbWluQXN5bmNGbG93LFxuICAgIGFsbFdva2VuUCxcbiAgICBwcmVwYXJlRW5kb3dtZW50XG4gIH0pO1xufTtcbmhhcmRlbihwcmVwYXJlQXN5bmNGbG93VG9vbHMpO1xuXG4vL1xudmFyIGV2ZW50TG9vcEl0ZXJhdGlvbiA9IGFzeW5jICgpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlMikgPT4gc2V0SW1tZWRpYXRlKHJlc29sdmUyKSk7XG5oYXJkZW4oZXZlbnRMb29wSXRlcmF0aW9uKTtcbnZhciBzdHJpbmdPclRhZyA9ICh2YWx1ZSkgPT4ge1xuICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIiAmJiBTeW1ib2wudG9TdHJpbmdUYWcgaW4gdmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWVbU3ltYm9sLnRvU3RyaW5nVGFnXTtcbiAgfVxuICByZXR1cm4gU3RyaW5nKHZhbHVlKTtcbn07XG52YXIgaW5zcGVjdE1hcFN0b3JlID0gKHN0b3JlKSA9PiB7XG4gIGNvbnN0IG9iaiA9IHt9O1xuICBmb3IgKGNvbnN0IGtleSBvZiBzdG9yZS5rZXlzKCkpIHtcbiAgICBjb25zdCB2YWx1ZSA9IHN0b3JlLmdldChrZXkpO1xuICAgIGNvbnN0IGhhc0tleXMgPSB0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgXCJrZXlzXCIgaW4gdmFsdWU7XG4gICAgY29uc3QgaW5kZXggPSBzdHJpbmdPclRhZyhrZXkpO1xuICAgIGlmIChoYXNLZXlzICYmIFwiZ2V0XCIgaW4gdmFsdWUpIHtcbiAgICAgIG9ialtpbmRleF0gPSBpbnNwZWN0TWFwU3RvcmUodmFsdWUpO1xuICAgIH0gZWxzZSBpZiAoaGFzS2V5cykge1xuICAgICAgb2JqW2luZGV4XSA9IEFycmF5LmZyb20odmFsdWUua2V5cygpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb2JqW2luZGV4XSA9IHZhbHVlIGluc3RhbmNlb2YgT2JqZWN0ICYmIFN5bWJvbC50b1N0cmluZ1RhZyBpbiB2YWx1ZSA/IHZhbHVlW1N5bWJvbC50b1N0cmluZ1RhZ10gOiB2YWx1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG9iajtcbn07XG5oYXJkZW4oaW5zcGVjdE1hcFN0b3JlKTtcblxuLy9cbnZhciBtYWtlRmFrZVN0b3JhZ2UgPSAocGF0aCwgcHVibGljYXRpb24pID0+IHtcbiAgbGV0IHNldFZhbHVlQ2FsbHMgPSAwO1xuICBjb25zdCBmdWxsUGF0aCA9IGBwdWJsaXNoLiR7cGF0aH1gO1xuICBjb25zdCBzdG9yZUtleSA9IGhhcmRlbih7XG4gICAgc3RvcmVOYW1lOiBcInN3aW5nc2V0XCIsXG4gICAgc3RvcmVTdWJrZXk6IGBzd2luZ3NldC9kYXRhOiR7ZnVsbFBhdGh9YCxcbiAgICBkYXRhUHJlZml4Qnl0ZXM6IFwiXCJcbiAgfSk7XG4gIGNvbnN0IHN0b3JhZ2UgPSBGYXIoXCJTdG9yYWdlTm9kZVwiLCB7XG4gICAgZ2V0UGF0aDogKCkgPT4gcGF0aCxcbiAgICBnZXRTdG9yZUtleTogYXN5bmMgKCkgPT4gc3RvcmVLZXksXG4gICAgc2V0VmFsdWU6IGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgc2V0VmFsdWVDYWxscyArPSAxO1xuICAgICAgYXNzZXJ0LnR5cGVvZih2YWx1ZSwgXCJzdHJpbmdcIik7XG4gICAgICBpZiAocHVibGljYXRpb24pIHtcbiAgICAgICAgcHVibGljYXRpb24udXBkYXRlU3RhdGUodmFsdWUpO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUNoaWxkTm9kZTogKCkgPT4gc3RvcmFnZSxcbiAgICBjb3VudFNldFZhbHVlQ2FsbHM6ICgpID0+IHNldFZhbHVlQ2FsbHNcbiAgfSk7XG4gIHJldHVybiBzdG9yYWdlO1xufTtcbmhhcmRlbihtYWtlRmFrZVN0b3JhZ2UpO1xudmFyIG1ha2VGYWtlTWFyc2hhbGxlciA9ICgpID0+IG1ha2VNYXJzaGFsKHZvaWQgMCwgdm9pZCAwLCB7XG4gIG1hcnNoYWxTYXZlRXJyb3I6ICgpID0+IHtcbiAgfVxufSk7XG5oYXJkZW4obWFrZUZha2VNYXJzaGFsbGVyKTtcblxuLy9cbnZhciBwcmVwYXJlUmVjb3JkZXIgPSAoYmFnZ2FnZSwgbWFyc2hhbGxlcikgPT4ge1xuICBjb25zdCBtYWtlUmVjb3JkZXIgPSBwcmVwYXJlRXhvQ2xhc3MoXG4gICAgYmFnZ2FnZSxcbiAgICBcIlJlY29yZGVyXCIsXG4gICAgTS5pbnRlcmZhY2UoXCJSZWNvcmRlclwiLCB7XG4gICAgICBnZXRTdG9yYWdlTm9kZTogTS5jYWxsKCkucmV0dXJucyhTdG9yYWdlTm9kZVNoYXBlKSxcbiAgICAgIGdldFN0b3JhZ2VQYXRoOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZShcbiAgICAgICAgLyogICAgICAgICovXG4gICAgICApKSxcbiAgICAgIHdyaXRlOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICB3cml0ZUZpbmFsOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICB9KSxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgKHB1Ymxpc2hlciwgc3RvcmFnZU5vZGUsIHZhbHVlU2hhcGUgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgTS5hbnkoKVxuICAgICkpID0+IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNsb3NlZDogZmFsc2UsXG4gICAgICAgIHB1Ymxpc2hlcixcbiAgICAgICAgc3RvcmFnZU5vZGUsXG4gICAgICAgIHN0b3JhZ2VQYXRoOiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgdm9pZCAwXG4gICAgICAgICksXG4gICAgICAgIHZhbHVlU2hhcGVcbiAgICAgIH07XG4gICAgfSxcbiAgICB7XG4gICAgICBnZXRTdG9yYWdlTm9kZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuc3RvcmFnZU5vZGU7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgYXN5bmMgZ2V0U3RvcmFnZVBhdGgoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RvcmFnZVBhdGg6IGhlbGRQYXRoIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBhd2FpdCBudWxsO1xuICAgICAgICBpZiAoaGVsZFBhdGggIT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiBoZWxkUGF0aDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwYXRoID0gYXdhaXQgRSh0aGlzLnN0YXRlLnN0b3JhZ2VOb2RlKS5nZXRQYXRoKCk7XG4gICAgICAgIHRoaXMuc3RhdGUuc3RvcmFnZVBhdGggPSBwYXRoO1xuICAgICAgICByZXR1cm4gcGF0aDtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFzeW5jIHdyaXRlKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHsgY2xvc2VkLCBwdWJsaXNoZXIsIHN0b3JhZ2VOb2RlLCB2YWx1ZVNoYXBlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAhY2xvc2VkIHx8IHRocm93UmVkYWN0ZWRgY2Fubm90IHdyaXRlIHRvIGNsb3NlZCByZWNvcmRlcmA7XG4gICAgICAgIG11c3RNYXRjaDIodmFsdWUsIHZhbHVlU2hhcGUpO1xuICAgICAgICBjb25zdCBlbmNvZGVkID0gYXdhaXQgRShtYXJzaGFsbGVyKS50b0NhcERhdGEodmFsdWUpO1xuICAgICAgICBjb25zdCBzZXJpYWxpemVkID0gSlNPTi5zdHJpbmdpZnkoZW5jb2RlZCk7XG4gICAgICAgIGF3YWl0IEUoc3RvcmFnZU5vZGUpLnNldFZhbHVlKHNlcmlhbGl6ZWQpO1xuICAgICAgICByZXR1cm4gcHVibGlzaGVyLnB1Ymxpc2godmFsdWUpO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgYXN5bmMgd3JpdGVGaW5hbCh2YWx1ZSkge1xuICAgICAgICBjb25zdCB7IGNsb3NlZCwgcHVibGlzaGVyLCBzdG9yYWdlTm9kZSwgdmFsdWVTaGFwZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgIWNsb3NlZCB8fCB0aHJvd1JlZGFjdGVkYGNhbm5vdCB3cml0ZSB0byBjbG9zZWQgcmVjb3JkZXJgO1xuICAgICAgICBtdXN0TWF0Y2gyKHZhbHVlLCB2YWx1ZVNoYXBlKTtcbiAgICAgICAgY29uc3QgZW5jb2RlZCA9IGF3YWl0IEUobWFyc2hhbGxlcikudG9DYXBEYXRhKHZhbHVlKTtcbiAgICAgICAgY29uc3Qgc2VyaWFsaXplZCA9IEpTT04uc3RyaW5naWZ5KGVuY29kZWQpO1xuICAgICAgICBhd2FpdCBFKHN0b3JhZ2VOb2RlKS5zZXRWYWx1ZShzZXJpYWxpemVkKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5jbG9zZWQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gcHVibGlzaGVyLmZpbmlzaCh2YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4gbWFrZVJlY29yZGVyO1xufTtcbmhhcmRlbihwcmVwYXJlUmVjb3JkZXIpO1xudmFyIGRlZmluZVJlY29yZGVyS2l0ID0gKHsgbWFrZVJlY29yZGVyLCBtYWtlRHVyYWJsZVB1Ymxpc2hLaXQgfSkgPT4ge1xuICBjb25zdCBtYWtlUmVjb3JkZXJLaXQgPSAoc3RvcmFnZU5vZGUsIHZhbHVlU2hhcGUpID0+IHtcbiAgICBjb25zdCB7IHN1YnNjcmliZXIsIHB1Ymxpc2hlciB9ID0gbWFrZUR1cmFibGVQdWJsaXNoS2l0KCk7XG4gICAgY29uc3QgcmVjb3JkZXIgPSBtYWtlUmVjb3JkZXIoXG4gICAgICBwdWJsaXNoZXIsXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgc3RvcmFnZU5vZGUsXG4gICAgICB2YWx1ZVNoYXBlXG4gICAgKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgc3Vic2NyaWJlciwgcmVjb3JkZXIgfSk7XG4gIH07XG4gIHJldHVybiBtYWtlUmVjb3JkZXJLaXQ7XG59O1xudmFyIGRlZmluZUVSZWNvcmRlcktpdCA9ICh7IG1ha2VSZWNvcmRlciwgbWFrZUR1cmFibGVQdWJsaXNoS2l0IH0pID0+IHtcbiAgY29uc3QgbWFrZUVSZWNvcmRlcktpdCA9IChzdG9yYWdlTm9kZVAsIHZhbHVlU2hhcGUpID0+IHtcbiAgICBjb25zdCB7IHB1Ymxpc2hlciwgc3Vic2NyaWJlciB9ID0gbWFrZUR1cmFibGVQdWJsaXNoS2l0KCk7XG4gICAgY29uc3QgcmVjb3JkZXJQID0gRS53aGVuKFxuICAgICAgc3RvcmFnZU5vZGVQLFxuICAgICAgKHN0b3JhZ2VOb2RlKSA9PiBtYWtlUmVjb3JkZXIoXG4gICAgICAgIHB1Ymxpc2hlcixcbiAgICAgICAgLy9cbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc3RvcmFnZU5vZGUsXG4gICAgICAgIHZhbHVlU2hhcGVcbiAgICAgIClcbiAgICApO1xuICAgIHJldHVybiB7IHN1YnNjcmliZXIsIHJlY29yZGVyUCB9O1xuICB9O1xuICByZXR1cm4gbWFrZUVSZWNvcmRlcktpdDtcbn07XG5oYXJkZW4oZGVmaW5lRVJlY29yZGVyS2l0KTtcbnZhciBwcmVwYXJlUmVjb3JkZXJLaXRNYWtlcnMgPSAoYmFnZ2FnZSwgbWFyc2hhbGxlcikgPT4ge1xuICBjb25zdCBtYWtlRHVyYWJsZVB1Ymxpc2hLaXQgPSBwcmVwYXJlRHVyYWJsZVB1Ymxpc2hLaXQoXG4gICAgYmFnZ2FnZSxcbiAgICBcIkR1cmFibGUgUHVibGlzaCBLaXRcIlxuICApO1xuICBjb25zdCBtYWtlUmVjb3JkZXIgPSBwcmVwYXJlUmVjb3JkZXIoYmFnZ2FnZSwgbWFyc2hhbGxlcik7XG4gIGNvbnN0IG1ha2VSZWNvcmRlcktpdCA9IGRlZmluZVJlY29yZGVyS2l0KHtcbiAgICBtYWtlUmVjb3JkZXIsXG4gICAgbWFrZUR1cmFibGVQdWJsaXNoS2l0XG4gIH0pO1xuICBjb25zdCBtYWtlRVJlY29yZGVyS2l0ID0gZGVmaW5lRVJlY29yZGVyS2l0KHtcbiAgICBtYWtlUmVjb3JkZXIsXG4gICAgbWFrZUR1cmFibGVQdWJsaXNoS2l0XG4gIH0pO1xuICByZXR1cm4ge1xuICAgIG1ha2VEdXJhYmxlUHVibGlzaEtpdCxcbiAgICBtYWtlUmVjb3JkZXIsXG4gICAgbWFrZVJlY29yZGVyS2l0LFxuICAgIG1ha2VFUmVjb3JkZXJLaXRcbiAgfTtcbn07XG52YXIgUmVjb3JkZXJLaXRTaGFwZSA9IHtcbiAgcmVjb3JkZXI6IE0ucmVtb3RhYmxlKCksXG4gIHN1YnNjcmliZXI6IE0ucmVtb3RhYmxlKClcbn07XG5oYXJkZW4oUmVjb3JkZXJLaXRTaGFwZSk7XG5cbi8vXG52YXIgY2FpcElkRnJvbUluZm8gPSAoaW5mbykgPT4ge1xuICByZXR1cm4gYCR7aW5mby5uYW1lc3BhY2V9OiR7aW5mby5yZWZlcmVuY2V9YDtcbn07XG5cbi8vXG52YXIgUEZNX1JFQ0VJVkVSID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBcInBmbVwiXG4pO1xudmFyIEh1Yk5hbWUgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQ2hhaW46IFwiY2hhaW5cIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBDaGFpbkFzc2V0czogXCJjaGFpbkFzc2V0c1wiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBDaGFpbkNvbm5lY3Rpb246IFwiY2hhaW5Db25uZWN0aW9uXCJcbiAgfVxuKTtcbmhhcmRlbihIdWJOYW1lKTtcbnZhciBDSEFJTl9LRVkgPSBIdWJOYW1lLkNoYWluO1xudmFyIENPTk5FQ1RJT05TX0tFWSA9IEh1Yk5hbWUuQ2hhaW5Db25uZWN0aW9uO1xudmFyIEFTU0VUU19LRVkgPSBIdWJOYW1lLkNoYWluQXNzZXRzO1xudmFyIENIQUlOX0lEX1NFUEFSQVRPUiA9IFwiX1wiO1xudmFyIGVuY29kZUNoYWluSWQgPSAoY2hhaW5JZCkgPT4gY2hhaW5JZC5yZXBsYWNlQWxsKFxuICBDSEFJTl9JRF9TRVBBUkFUT1IsXG4gIGAke0NIQUlOX0lEX1NFUEFSQVRPUn0ke0NIQUlOX0lEX1NFUEFSQVRPUn1gXG4pO1xudmFyIGNvbm5lY3Rpb25LZXkgPSAoY2hhaW5JZDEsIGNoYWluSWQyKSA9PiB7XG4gIGNvbnN0IGNoYWluSWQxU2FuaXRpemVkID0gZW5jb2RlQ2hhaW5JZChjaGFpbklkMSk7XG4gIGNvbnN0IGNoYWluSWQyU2FuaXRpemVkID0gZW5jb2RlQ2hhaW5JZChjaGFpbklkMik7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIFtjaGFpbklkMVNhbml0aXplZCwgY2hhaW5JZDJTYW5pdGl6ZWRdLnNvcnQoKS5qb2luKENIQUlOX0lEX1NFUEFSQVRPUilcbiAgKTtcbn07XG52YXIgcmV2ZXJzZUNvbm5JbmZvID0gKGNvbm5JbmZvKSA9PiB7XG4gIGNvbnN0IHsgdHJhbnNmZXJDaGFubmVsIH0gPSBjb25uSW5mbztcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgaWQ6IGNvbm5JbmZvLmNvdW50ZXJwYXJ0eS5jb25uZWN0aW9uX2lkLFxuICAgIGNsaWVudF9pZDogY29ubkluZm8uY291bnRlcnBhcnR5LmNsaWVudF9pZCxcbiAgICBjb3VudGVycGFydHk6IHtcbiAgICAgIGNsaWVudF9pZDogY29ubkluZm8uY2xpZW50X2lkLFxuICAgICAgY29ubmVjdGlvbl9pZDogY29ubkluZm8uaWRcbiAgICB9LFxuICAgIHN0YXRlOiBjb25uSW5mby5zdGF0ZSxcbiAgICB0cmFuc2ZlckNoYW5uZWw6IHtcbiAgICAgIC4uLnRyYW5zZmVyQ2hhbm5lbCxcbiAgICAgIGNoYW5uZWxJZDogdHJhbnNmZXJDaGFubmVsLmNvdW50ZXJQYXJ0eUNoYW5uZWxJZCxcbiAgICAgIGNvdW50ZXJQYXJ0eUNoYW5uZWxJZDogdHJhbnNmZXJDaGFubmVsLmNoYW5uZWxJZCxcbiAgICAgIHBvcnRJZDogdHJhbnNmZXJDaGFubmVsLmNvdW50ZXJQYXJ0eVBvcnRJZCxcbiAgICAgIGNvdW50ZXJQYXJ0eVBvcnRJZDogdHJhbnNmZXJDaGFubmVsLnBvcnRJZFxuICAgIH1cbiAgfSk7XG59O1xudmFyIG5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvID0gKHByaW1hcnlDaGFpbklkLCBjb3VudGVyQ2hhaW5JZCwgZGlyZWN0ZWQpID0+IHtcbiAgY29uc3Qga2V5ID0gY29ubmVjdGlvbktleShwcmltYXJ5Q2hhaW5JZCwgY291bnRlckNoYWluSWQpO1xuICBpZiAocHJpbWFyeUNoYWluSWQgPCBjb3VudGVyQ2hhaW5JZCkge1xuICAgIHJldHVybiBba2V5LCBkaXJlY3RlZF07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFtrZXksIHJldmVyc2VDb25uSW5mbyhkaXJlY3RlZCldO1xuICB9XG59O1xudmFyIGRlbm9ybWFsaXplQ29ubmVjdGlvbkluZm8gPSAocHJpbWFyeUNoYWluSWQsIGNvdW50ZXJDaGFpbklkLCBub3JtYWxpemVkKSA9PiB7XG4gIGlmIChwcmltYXJ5Q2hhaW5JZCA8IGNvdW50ZXJDaGFpbklkKSB7XG4gICAgcmV0dXJuIG5vcm1hbGl6ZWQ7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHJldmVyc2VDb25uSW5mbyhub3JtYWxpemVkKTtcbiAgfVxufTtcbnZhciBDaGFpbklkQXJnU2hhcGUgPSBNLm9yKFxuICBNLnN0cmluZygpLFxuICBNLnNwbGl0UmVjb3JkKFxuICAgIHtcbiAgICAgIGNoYWluSWQ6IE0uc3RyaW5nKClcbiAgICB9LFxuICAgIHZvaWQgMCxcbiAgICBNLmFueSgpXG4gIClcbik7XG52YXIgRGVmYXVsdFBmbVRpbWVvdXRPcHRzID0gaGFyZGVuKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgcmV0cmllczogMyxcbiAgICB0aW1lb3V0OiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgXCIxMG1cIlxuICAgIClcbiAgfVxuKTtcbnZhciBUcmFuc2ZlclJvdXRlU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgc291cmNlUG9ydDogTS5zdHJpbmcoKSxcbiAgICBzb3VyY2VDaGFubmVsOiBJQkNDaGFubmVsSURTaGFwZSxcbiAgICB0b2tlbjogQ29pblNoYXBlLFxuICAgIHJlY2VpdmVyOiBNLnN0cmluZygpXG4gIH0sXG4gIHsgZm9yd2FyZEluZm86IEZvcndhcmRJbmZvU2hhcGUgfSxcbiAge31cbik7XG52YXIgQ2hhaW5IdWJJID0gTS5pbnRlcmZhY2UoXCJDaGFpbkh1YlwiLCB7XG4gIHJlZ2lzdGVyQ2hhaW46IE0uY2FsbChNLnN0cmluZygpLCBDaGFpbkluZm9TaGFwZSkucmV0dXJucygpLFxuICB1cGRhdGVDaGFpbjogTS5jYWxsKE0uc3RyaW5nKCksIENoYWluSW5mb1NoYXBlKS5yZXR1cm5zKCksXG4gIGdldENoYWluSW5mbzogTS5jYWxsKE0uc3RyaW5nKCkpLnJldHVybnMoVm93U2hhcGUpLFxuICBnZXRDaGFpbkluZm9CeUNoYWluSWQ6IE0uY2FsbChNLnN0cmluZygpKS5yZXR1cm5zKENoYWluSW5mb1NoYXBlKSxcbiAgcmVnaXN0ZXJDb25uZWN0aW9uOiBNLmNhbGwoXG4gICAgTS5zdHJpbmcoKSxcbiAgICBNLnN0cmluZygpLFxuICAgIElCQ0Nvbm5lY3Rpb25JbmZvU2hhcGVcbiAgKS5yZXR1cm5zKCksXG4gIHVwZGF0ZUNvbm5lY3Rpb246IE0uY2FsbChcbiAgICBNLnN0cmluZygpLFxuICAgIE0uc3RyaW5nKCksXG4gICAgSUJDQ29ubmVjdGlvbkluZm9TaGFwZVxuICApLnJldHVybnMoKSxcbiAgZ2V0Q29ubmVjdGlvbkluZm86IE0uY2FsbChDaGFpbklkQXJnU2hhcGUsIENoYWluSWRBcmdTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldENoYWluc0FuZENvbm5lY3Rpb246IE0uY2FsbChNLnN0cmluZygpLCBNLnN0cmluZygpKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgcmVnaXN0ZXJBc3NldDogTS5jYWxsKE0uc3RyaW5nKCksIERlbm9tRGV0YWlsU2hhcGUpLnJldHVybnMoKSxcbiAgdXBkYXRlQXNzZXQ6IE0uY2FsbChNLnN0cmluZygpLCBEZW5vbURldGFpbFNoYXBlKS5yZXR1cm5zKCksXG4gIGdldEFzc2V0OiBNLmNhbGwoTS5zdHJpbmcoKSwgTS5zdHJpbmcoKSkucmV0dXJucyhcbiAgICBNLm9yKERlbm9tRGV0YWlsU2hhcGUsIE0udW5kZWZpbmVkKCkpXG4gICksXG4gIGdldERlbm9tOiBNLmNhbGwoQnJhbmRTaGFwZSkucmV0dXJucyhNLm9yKE0uc3RyaW5nKCksIE0udW5kZWZpbmVkKCkpKSxcbiAgY29lcmNlQ29zbW9zQWRkcmVzczogTS5jYWxsKEFjY291bnRJZEFyZ1NoYXBlKS5yZXR1cm5zKFxuICAgIENvc21vc0NoYWluQWRkcmVzc1NoYXBlXG4gICksXG4gIHJlc29sdmVBY2NvdW50SWQ6IE0uY2FsbChNLnN0cmluZygpKS5yZXR1cm5zKE0uc3RyaW5nKCkpLFxuICBtYWtlVHJhbnNmZXJSb3V0ZTogTS5jYWxsKEFjY291bnRJZEFyZ1NoYXBlLCBEZW5vbUFtb3VudFNoYXBlLCBNLnN0cmluZygpKS5vcHRpb25hbChGb3J3YXJkT3B0c1NoYXBlKS5yZXR1cm5zKE0ub3IoTS51bmRlZmluZWQoKSwgVHJhbnNmZXJSb3V0ZVNoYXBlKSlcbn0pO1xudmFyIG1ha2VDaGFpbkh1YiA9ICh6b25lLCBhZ29yaWNOYW1lcywgdm93VG9vbHMsIHsgY2hhaW5JbmZvVmFsdWVTaGFwZSA9IChcbiAgLyogICAgICAgICAgICAgICAgICAqL1xuICBDaGFpbkluZm9TaGFwZVxuKSB9ID0ge30pID0+IHtcbiAgY29uc3QgY2hhaW5JbmZvcyA9IHpvbmUubWFwU3RvcmUoXCJjaGFpbkluZm9zXCIsIHtcbiAgICBrZXlTaGFwZTogTS5zdHJpbmcoKSxcbiAgICB2YWx1ZVNoYXBlOiBjaGFpbkluZm9WYWx1ZVNoYXBlXG4gIH0pO1xuICBjb25zdCBjb25uZWN0aW9uSW5mb3MgPSB6b25lLm1hcFN0b3JlKFwiY29ubmVjdGlvbkluZm9zXCIsIHtcbiAgICBrZXlTaGFwZTogTS5zdHJpbmcoKSxcbiAgICB2YWx1ZVNoYXBlOiBJQkNDb25uZWN0aW9uSW5mb1NoYXBlXG4gIH0pO1xuICBjb25zdCBkZW5vbURldGFpbHMgPSB6b25lLm1hcFN0b3JlKFwiZGVub21cIiwge1xuICAgIGtleVNoYXBlOiBNLnN0cmluZygpLFxuICAgIHZhbHVlU2hhcGU6IERlbm9tRGV0YWlsU2hhcGVcbiAgfSk7XG4gIGNvbnN0IGJyYW5kRGVub21zID0gem9uZS5tYXBTdG9yZShcImJyYW5kRGVub21cIiwge1xuICAgIGtleVNoYXBlOiBCcmFuZFNoYXBlLFxuICAgIHZhbHVlU2hhcGU6IE0uc3RyaW5nKClcbiAgfSk7XG4gIGNvbnN0IGJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lID0gem9uZS5tYXBTdG9yZShcImJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lXCIsIHtcbiAgICBrZXlTaGFwZTogTS5zdHJpbmcoKSxcbiAgICB2YWx1ZVNoYXBlOiBNLnN0cmluZygpXG4gIH0pO1xuICBjb25zdCBjaGFpbklkVG9DaGFpbk5hbWUgPSB6b25lLm1hcFN0b3JlKFwiY2hhaW5JZFRvQ2hhaW5OYW1lXCIsIHtcbiAgICBrZXlTaGFwZTogTS5zdHJpbmcoKSxcbiAgICB2YWx1ZVNoYXBlOiBNLnN0cmluZygpXG4gIH0pO1xuICBjb25zdCBtYWtlRGVub21LZXkgPSAoZGVub20sIHNyY0NoYWluTmFtZSkgPT4gYCR7c3JjQ2hhaW5OYW1lfToke2Rlbm9tfWA7XG4gIGNvbnN0IHJlc29sdmVDb3Ntb3NDaGFpbklkID0gKGFkZHJlc3MpID0+IHtcbiAgICBjb25zdCBwcmVmaXggPSBnZXRCZWNoMzJQcmVmaXgoYWRkcmVzcyk7XG4gICAgaWYgKCFiZWNoMzJQcmVmaXhUb0NoYWluTmFtZS5oYXMocHJlZml4KSkge1xuICAgICAgdGhyb3cgbWFrZUVycm9yKGBDaGFpbiBpbmZvIG5vdCBmb3VuZCBmb3IgYmVjaDMyUHJlZml4ICR7cXVvdGUocHJlZml4KX1gKTtcbiAgICB9XG4gICAgY29uc3QgY2hhaW5OYW1lID0gYmVjaDMyUHJlZml4VG9DaGFpbk5hbWUuZ2V0KHByZWZpeCk7XG4gICAgY29uc3QgeyBjaGFpbklkIH0gPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGNoYWluSW5mb3MuZ2V0KGNoYWluTmFtZSlcbiAgICApO1xuICAgIHJldHVybiBjaGFpbklkO1xuICB9O1xuICBjb25zdCBsb29rdXBDaGFpbkluZm8gPSB2b3dUb29scy5yZXRyeWFibGUoXG4gICAgem9uZSxcbiAgICBcImxvb2t1cENoYWluSW5mb1wiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgLy9cbiAgICBhc3luYyAoY2hhaW5OYW1lKSA9PiB7XG4gICAgICBhd2FpdCBudWxsO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY2hhaW5JbmZvID0gYXdhaXQgRShhZ29yaWNOYW1lcykubG9va3VwKEh1Yk5hbWUuQ2hhaW4sIGNoYWluTmFtZSk7XG4gICAgICAgIGlmICghY2hhaW5JbmZvcy5oYXMoY2hhaW5OYW1lKSkge1xuICAgICAgICAgIGNoYWluSW5mb3MuaW5pdChjaGFpbk5hbWUsIGNoYWluSW5mbyk7XG4gICAgICAgICAgY2hhaW5JZFRvQ2hhaW5OYW1lLmluaXQoY2FpcElkRnJvbUluZm8oY2hhaW5JbmZvKSwgY2hhaW5OYW1lKTtcbiAgICAgICAgICBpZiAoY2hhaW5JbmZvLmJlY2gzMlByZWZpeCkge1xuICAgICAgICAgICAgYmVjaDMyUHJlZml4VG9DaGFpbk5hbWUuaW5pdChjaGFpbkluZm8uYmVjaDMyUHJlZml4LCBjaGFpbk5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY2hhaW5JbmZvO1xuICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcImxvb2t1cENoYWluSW5mb1wiLCBjaGFpbk5hbWUsIFwiZXJyb3JcIiwgZTIpO1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoYGNoYWluIG5vdCBmb3VuZDoke2NoYWluTmFtZX1gKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IGxvb2t1cENvbm5lY3Rpb25JbmZvID0gdm93VG9vbHMucmV0cnlhYmxlKFxuICAgIHpvbmUsXG4gICAgXCJsb29rdXBDb25uZWN0aW9uSW5mb1wiLFxuICAgIC8qXG5cblxuICAgICAqL1xuICAgIC8vXG4gICAgYXN5bmMgKGNoYWluSWQxLCBjaGFpbklkMikgPT4ge1xuICAgICAgYXdhaXQgbnVsbDtcbiAgICAgIGNvbnN0IGtleSA9IGNvbm5lY3Rpb25LZXkoY2hhaW5JZDEsIGNoYWluSWQyKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb25JbmZvID0gYXdhaXQgRShhZ29yaWNOYW1lcykubG9va3VwKFxuICAgICAgICAgIEh1Yk5hbWUuQ2hhaW5Db25uZWN0aW9uLFxuICAgICAgICAgIGtleVxuICAgICAgICApO1xuICAgICAgICBpZiAoIWNvbm5lY3Rpb25JbmZvcy5oYXMoa2V5KSkge1xuICAgICAgICAgIGNvbm5lY3Rpb25JbmZvcy5pbml0KGtleSwgY29ubmVjdGlvbkluZm8pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkZW5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvKGNoYWluSWQxLCBjaGFpbklkMiwgY29ubmVjdGlvbkluZm8pO1xuICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcImxvb2t1cENvbm5lY3Rpb25JbmZvXCIsIGNoYWluSWQxLCBjaGFpbklkMiwgXCJlcnJvclwiLCBlMik7XG4gICAgICAgIHRocm93IG1ha2VFcnJvcihgY29ubmVjdGlvbiBub3QgZm91bmQ6ICR7Y2hhaW5JZDF9PC0+JHtjaGFpbklkMn1gKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IGxvb2t1cENoYWluc0FuZENvbm5lY3Rpb24gPSB2b3dUb29scy5yZXRyeWFibGUoXG4gICAgem9uZSxcbiAgICBcImxvb2t1cENoYWluc0FuZENvbm5lY3Rpb25cIixcbiAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICAvL1xuICAgIGFzeW5jIChwcmltYXJ5TmFtZSwgY291bnRlck5hbWUpID0+IHtcbiAgICAgIGNvbnN0IFtwcmltYXJ5LCBjb3VudGVyXSA9IGF3YWl0IHZvd1Rvb2xzLmFzUHJvbWlzZShcbiAgICAgICAgdm93VG9vbHMuYWxsVm93cyhbXG4gICAgICAgICAgY2hhaW5IdWIuZ2V0Q2hhaW5JbmZvKHByaW1hcnlOYW1lKSxcbiAgICAgICAgICBjaGFpbkh1Yi5nZXRDaGFpbkluZm8oY291bnRlck5hbWUpXG4gICAgICAgIF0pXG4gICAgICApO1xuICAgICAgY29uc3QgY29ubmVjdGlvbkluZm8gPSBwcmltYXJ5Lm5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIiAmJiBjb3VudGVyLm5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIiA/IGF3YWl0IHZvd1Rvb2xzLmFzUHJvbWlzZShcbiAgICAgICAgY2hhaW5IdWIuZ2V0Q29ubmVjdGlvbkluZm8ocHJpbWFyeSwgY291bnRlcilcbiAgICAgICkgOiB2b2lkIDA7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFtwcmltYXJ5LCBjb3VudGVyLCBjb25uZWN0aW9uSW5mb11cbiAgICAgICk7XG4gICAgfVxuICApO1xuICBjb25zdCBjaGFpbkh1YiA9IHpvbmUuZXhvKFwiQ2hhaW5IdWJcIiwgQ2hhaW5IdWJJLCB7XG4gICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIHJlZ2lzdGVyQ2hhaW4obmFtZSwgY2hhaW5JbmZvKSB7XG4gICAgICBjaGFpbkluZm9zLmluaXQobmFtZSwgY2hhaW5JbmZvKTtcbiAgICAgIGNoYWluSWRUb0NoYWluTmFtZS5pbml0KGNhaXBJZEZyb21JbmZvKGNoYWluSW5mbyksIG5hbWUpO1xuICAgICAgaWYgKGNoYWluSW5mby5uYW1lc3BhY2UgPT09IFwiY29zbW9zXCIgJiYgY2hhaW5JbmZvLmJlY2gzMlByZWZpeCkge1xuICAgICAgICBiZWNoMzJQcmVmaXhUb0NoYWluTmFtZS5pbml0KGNoYWluSW5mby5iZWNoMzJQcmVmaXgsIG5hbWUpO1xuICAgICAgfVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG4gICAgICovXG4gICAgdXBkYXRlQ2hhaW4oY2hhaW5OYW1lLCBjaGFpbkluZm8pIHtcbiAgICAgIGlmICghY2hhaW5JbmZvcy5oYXMoY2hhaW5OYW1lKSkge1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoYENoYWluICR7cXVvdGUoY2hhaW5OYW1lKX0gbm90IHJlZ2lzdGVyZWRgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG9sZEluZm8gPSBjaGFpbkluZm9zLmdldChjaGFpbk5hbWUpO1xuICAgICAgaWYgKGNoYWluSWRUb0NoYWluTmFtZS5oYXMoY2FpcElkRnJvbUluZm8ob2xkSW5mbykpKSB7XG4gICAgICAgIGNoYWluSWRUb0NoYWluTmFtZS5kZWxldGUoY2FpcElkRnJvbUluZm8ob2xkSW5mbykpO1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb2xkSW5mby5iZWNoMzJQcmVmaXhcbiAgICAgICkge1xuICAgICAgICBiZWNoMzJQcmVmaXhUb0NoYWluTmFtZS5kZWxldGUoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgb2xkSW5mby5iZWNoMzJQcmVmaXhcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNoYWluSW5mb3Muc2V0KGNoYWluTmFtZSwgY2hhaW5JbmZvKTtcbiAgICAgIGNoYWluSWRUb0NoYWluTmFtZS5pbml0KGNhaXBJZEZyb21JbmZvKGNoYWluSW5mbyksIGNoYWluTmFtZSk7XG4gICAgICBpZiAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBjaGFpbkluZm8uYmVjaDMyUHJlZml4XG4gICAgICApIHtcbiAgICAgICAgYmVjaDMyUHJlZml4VG9DaGFpbk5hbWUuaW5pdChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBjaGFpbkluZm8uYmVjaDMyUHJlZml4LFxuICAgICAgICAgIGNoYWluTmFtZVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG4gICAgLypcblxuXG5cbiAgICAgKi9cbiAgICBnZXRDaGFpbkluZm8oY2hhaW5OYW1lKSB7XG4gICAgICBjaGFpbk5hbWUuaW5jbHVkZXMoXCI6XCIpICYmIHRocm93UmVkYWN0ZWRgJHtjaGFpbk5hbWV9IG11c3QgYmUgYSBiYXJlIGNoYWluIG5hbWUuIE1heWJlIHRyeSBnZXRDaGFpbkluZm9CeUNoYWluSWQoKWA7XG4gICAgICBpZiAoY2hhaW5JbmZvcy5oYXMoY2hhaW5OYW1lKSkge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgdm93VG9vbHMuYXNWb3coXG4gICAgICAgICAgICAoKSA9PiAoXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIGNoYWluSW5mb3MuZ2V0KGNoYWluTmFtZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbG9va3VwQ2hhaW5JbmZvKGNoYWluTmFtZSk7XG4gICAgfSxcbiAgICAvKlxuXG5cbiAgICAgKi9cbiAgICBnZXRDaGFpbkluZm9CeUNoYWluSWQoY2hhaW5JZCkge1xuICAgICAgY2hhaW5JZFRvQ2hhaW5OYW1lLmhhcyhjaGFpbklkKSB8fCB0aHJvd1JlZGFjdGVkYENoYWluIG5hbWUgbm90IGZvdW5kIGZvciAke3F1b3RlKGNoYWluSWQpfWA7XG4gICAgICBjb25zdCBjaGFpbk5hbWUgPSBjaGFpbklkVG9DaGFpbk5hbWUuZ2V0KGNoYWluSWQpO1xuICAgICAgY2hhaW5JbmZvcy5oYXMoY2hhaW5OYW1lKSB8fCB0aHJvd1JlZGFjdGVkYENoYWluIEluZm8gbm90IGZvdW5kIGZvciAke3F1b3RlKGNoYWluSWQpfWA7XG4gICAgICByZXR1cm4gY2hhaW5JbmZvcy5nZXQoY2hhaW5OYW1lKTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuICAgICAqL1xuICAgIHJlZ2lzdGVyQ29ubmVjdGlvbihwcmltYXJ5Q2hhaW5JZCwgY291bnRlcnBhcnR5Q2hhaW5JZCwgY29ubmVjdGlvbkluZm8pIHtcbiAgICAgIGNvbnN0IFtrZXksIG5vcm1hbGl6ZWRdID0gbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oXG4gICAgICAgIHByaW1hcnlDaGFpbklkLFxuICAgICAgICBjb3VudGVycGFydHlDaGFpbklkLFxuICAgICAgICBjb25uZWN0aW9uSW5mb1xuICAgICAgKTtcbiAgICAgIGNvbm5lY3Rpb25JbmZvcy5pbml0KGtleSwgbm9ybWFsaXplZCk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgdXBkYXRlQ29ubmVjdGlvbihwcmltYXJ5Q2hhaW5JZCwgY291bnRlcnBhcnR5Q2hhaW5JZCwgY29ubmVjdGlvbkluZm8pIHtcbiAgICAgIGNvbnN0IGtleSA9IGNvbm5lY3Rpb25LZXkocHJpbWFyeUNoYWluSWQsIGNvdW50ZXJwYXJ0eUNoYWluSWQpO1xuICAgICAgaWYgKCFjb25uZWN0aW9uSW5mb3MuaGFzKGtleSkpIHtcbiAgICAgICAgdGhyb3cgbWFrZUVycm9yKFxuICAgICAgICAgIGBDb25uZWN0aW9uICR7cXVvdGUocHJpbWFyeUNoYWluSWQpfTwtPiR7cXVvdGUoY291bnRlcnBhcnR5Q2hhaW5JZCl9IG5vdCByZWdpc3RlcmVkYFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgW18sIG5vcm1hbGl6ZWRJbmZvXSA9IG5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvKFxuICAgICAgICBwcmltYXJ5Q2hhaW5JZCxcbiAgICAgICAgY291bnRlcnBhcnR5Q2hhaW5JZCxcbiAgICAgICAgY29ubmVjdGlvbkluZm9cbiAgICAgICk7XG4gICAgICBjb25uZWN0aW9uSW5mb3Muc2V0KGtleSwgbm9ybWFsaXplZEluZm8pO1xuICAgIH0sXG4gICAgLypcblxuXG5cbiAgICAgKi9cbiAgICBnZXRDb25uZWN0aW9uSW5mbyhwcmltYXJ5LCBjb3VudGVyKSB7XG4gICAgICBjb25zdCBwcmltYXJ5SWQgPSB0eXBlb2YgcHJpbWFyeSA9PT0gXCJzdHJpbmdcIiA/IHByaW1hcnkgOiBwcmltYXJ5LmNoYWluSWQ7XG4gICAgICBjb25zdCBjb3VudGVySWQgPSB0eXBlb2YgY291bnRlciA9PT0gXCJzdHJpbmdcIiA/IGNvdW50ZXIgOiBjb3VudGVyLmNoYWluSWQ7XG4gICAgICBjb25zdCBrZXkgPSBjb25uZWN0aW9uS2V5KHByaW1hcnlJZCwgY291bnRlcklkKTtcbiAgICAgIGlmIChjb25uZWN0aW9uSW5mb3MuaGFzKGtleSkpIHtcbiAgICAgICAgcmV0dXJuIHZvd1Rvb2xzLmFzVm93KFxuICAgICAgICAgICgpID0+IGRlbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oXG4gICAgICAgICAgICBwcmltYXJ5SWQsXG4gICAgICAgICAgICBjb3VudGVySWQsXG4gICAgICAgICAgICBjb25uZWN0aW9uSW5mb3MuZ2V0KGtleSlcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbG9va3VwQ29ubmVjdGlvbkluZm8ocHJpbWFyeUlkLCBjb3VudGVySWQpO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIGdldENoYWluc0FuZENvbm5lY3Rpb24ocHJpbWFyeU5hbWUsIGNvdW50ZXJOYW1lKSB7XG4gICAgICByZXR1cm4gbG9va3VwQ2hhaW5zQW5kQ29ubmVjdGlvbihwcmltYXJ5TmFtZSwgY291bnRlck5hbWUpO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICByZWdpc3RlckFzc2V0KGRlbm9tLCBkZXRhaWwpIHtcbiAgICAgIGNvbnN0IHsgY2hhaW5OYW1lLCBiYXNlTmFtZSB9ID0gZGV0YWlsO1xuICAgICAgY2hhaW5JbmZvcy5oYXMoY2hhaW5OYW1lKSB8fCB0aHJvd1JlZGFjdGVkYG11c3QgcmVnaXN0ZXIgY2hhaW4gJHtxdW90ZShjaGFpbk5hbWUpfSBmaXJzdGA7XG4gICAgICBjaGFpbkluZm9zLmhhcyhiYXNlTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBtdXN0IHJlZ2lzdGVyIGNoYWluICR7cXVvdGUoYmFzZU5hbWUpfSBmaXJzdGA7XG4gICAgICBjb25zdCBkZW5vbUtleSA9IG1ha2VEZW5vbUtleShkZW5vbSwgZGV0YWlsLmNoYWluTmFtZSk7XG4gICAgICBkZW5vbURldGFpbHMuaGFzKGRlbm9tS2V5KSAmJiB0aHJvd1JlZGFjdGVkYGFscmVhZHkgcmVnaXN0ZXJlZCAke3F1b3RlKGRlbm9tKX0gb24gJHtxdW90ZShjaGFpbk5hbWUpfWA7XG4gICAgICBkZW5vbURldGFpbHMuaW5pdChkZW5vbUtleSwgZGV0YWlsKTtcbiAgICAgIGlmIChkZXRhaWwuYnJhbmQpIHtcbiAgICAgICAgY2hhaW5OYW1lID09PSBcImFnb3JpY1wiIHx8IHRocm93UmVkYWN0ZWRgYnJhbmRzIG9ubHkgcmVnaXN0ZXJhYmxlIGZvciBhZ29yaWMtaGVsZCBhc3NldHNgO1xuICAgICAgICBicmFuZERlbm9tcy5pbml0KGRldGFpbC5icmFuZCwgZGVub20pO1xuICAgICAgfVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICB1cGRhdGVBc3NldChkZW5vbSwgZGV0YWlsKSB7XG4gICAgICBjb25zdCB7IGJhc2VOYW1lLCBicmFuZCwgY2hhaW5OYW1lIH0gPSBkZXRhaWw7XG4gICAgICBjb25zdCBkZW5vbUtleSA9IG1ha2VEZW5vbUtleShkZW5vbSwgY2hhaW5OYW1lKTtcbiAgICAgIGlmICghZGVub21EZXRhaWxzLmhhcyhkZW5vbUtleSkpIHtcbiAgICAgICAgdGhyb3cgbWFrZUVycm9yKGBBc3NldCAke3F1b3RlKGRlbm9tKX0gb24gJHtxdW90ZShjaGFpbk5hbWUpfSBub3QgcmVnaXN0ZXJlZGApO1xuICAgICAgfVxuICAgICAgaWYgKCFjaGFpbkluZm9zLmhhcyhjaGFpbk5hbWUpKSB7XG4gICAgICAgIHRocm93IG1ha2VFcnJvcihgQ2hhaW4gJHtxdW90ZShjaGFpbk5hbWUpfSBub3QgcmVnaXN0ZXJlZGApO1xuICAgICAgfVxuICAgICAgaWYgKCFjaGFpbkluZm9zLmhhcyhiYXNlTmFtZSkpIHtcbiAgICAgICAgdGhyb3cgbWFrZUVycm9yKGBDaGFpbiAke3F1b3RlKGJhc2VOYW1lKX0gbm90IHJlZ2lzdGVyZWRgKTtcbiAgICAgIH1cbiAgICAgIGlmIChicmFuZCkge1xuICAgICAgICBpZiAoY2hhaW5OYW1lICE9PSBcImFnb3JpY1wiKSB7XG4gICAgICAgICAgdGhyb3cgbWFrZUVycm9yKFwiQnJhbmRzIG9ubHkgcmVnaXN0ZXJhYmxlIGZvciBhZ29yaWMtaGVsZCBhc3NldHNcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnN0IG9sZERldGFpbCA9IGRlbm9tRGV0YWlscy5nZXQoZGVub21LZXkpO1xuICAgICAgaWYgKG9sZERldGFpbC5icmFuZCkge1xuICAgICAgICBicmFuZERlbm9tcy5kZWxldGUob2xkRGV0YWlsLmJyYW5kKTtcbiAgICAgIH1cbiAgICAgIGRlbm9tRGV0YWlscy5zZXQoZGVub21LZXksIGRldGFpbCk7XG4gICAgICBpZiAoYnJhbmQpIHtcbiAgICAgICAgYnJhbmREZW5vbXMuaW5pdChicmFuZCwgZGVub20pO1xuICAgICAgfVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG4gICAgICovXG4gICAgZ2V0QXNzZXQoZGVub20sIHNyY0NoYWluTmFtZSkge1xuICAgICAgY29uc3QgZGVub21LZXkgPSBtYWtlRGVub21LZXkoZGVub20sIHNyY0NoYWluTmFtZSk7XG4gICAgICBpZiAoZGVub21EZXRhaWxzLmhhcyhkZW5vbUtleSkpIHtcbiAgICAgICAgcmV0dXJuIGRlbm9tRGV0YWlscy5nZXQoZGVub21LZXkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICBnZXREZW5vbShicmFuZCkge1xuICAgICAgaWYgKGJyYW5kRGVub21zLmhhcyhicmFuZCkpIHtcbiAgICAgICAgcmV0dXJuIGJyYW5kRGVub21zLmdldChicmFuZCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgIHJlc29sdmVBY2NvdW50SWQocGFydGlhbElkKSB7XG4gICAgICBpZiAocGFydGlhbElkLnNwbGl0KFwiOlwiKS5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBwYXJ0aWFsSWRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvc21vc0NoYWluSWQgPSByZXNvbHZlQ29zbW9zQ2hhaW5JZChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBwYXJ0aWFsSWRcbiAgICAgICk7XG4gICAgICByZXR1cm4gYGNvc21vczoke2Nvc21vc0NoYWluSWR9OiR7cGFydGlhbElkfWA7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIGNvZXJjZUNvc21vc0FkZHJlc3MocGFydGlhbElkKSB7XG4gICAgICBpZiAodHlwZW9mIHBhcnRpYWxJZCAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4gcGFydGlhbElkO1xuICAgICAgfVxuICAgICAgY29uc3QgcGFydHMgPSBwYXJ0aWFsSWQuc3BsaXQoXCI6XCIpO1xuICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMykge1xuICAgICAgICBhc3NlcnQuZXF1YWwocGFydHNbMF0sIFwiY29zbW9zXCIpO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgICBjaGFpbklkOiBwYXJ0c1sxXSxcbiAgICAgICAgICBlbmNvZGluZzogXCJiZWNoMzJcIixcbiAgICAgICAgICB2YWx1ZTogKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgcGFydHNbMl1cbiAgICAgICAgICApXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgYXNzZXJ0LmVxdWFsKHBhcnRzLmxlbmd0aCwgMSk7XG4gICAgICBjb25zdCB2YWx1ZSA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBwYXJ0aWFsSWRcbiAgICAgICk7XG4gICAgICBjb25zdCBjb3Ntb3NDaGFpbklkID0gcmVzb2x2ZUNvc21vc0NoYWluSWQodmFsdWUpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgIGNoYWluSWQ6IGNvc21vc0NoYWluSWQsXG4gICAgICAgIHZhbHVlLFxuICAgICAgICBlbmNvZGluZzogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgXCJiZWNoMzJcIlxuICAgICAgICApXG4gICAgICB9KTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIG1ha2VUcmFuc2ZlclJvdXRlKGRlc3RpbmF0aW9uLCBkZW5vbUFtb3VudCwgc3JjQ2hhaW5OYW1lLCBmb3J3YXJkT3B0cykge1xuICAgICAgY2hhaW5JbmZvcy5oYXMoc3JjQ2hhaW5OYW1lKSB8fCB0aHJvd1JlZGFjdGVkYGNoYWluIGluZm8gbm90IGZvdW5kIGZvciBob2xkaW5nIGNoYWluOiAke3F1b3RlKHNyY0NoYWluTmFtZSl9YDtcbiAgICAgIGNvbnN0IGRlbm9tRGV0YWlsID0gY2hhaW5IdWIuZ2V0QXNzZXQoZGVub21BbW91bnQuZGVub20sIHNyY0NoYWluTmFtZSk7XG4gICAgICBkZW5vbURldGFpbCB8fCB0aHJvd1JlZGFjdGVkYG5vIGRlbm9tIGRldGFpbCBmb3I6ICR7cXVvdGUoZGVub21BbW91bnQuZGVub20pfSBvbiAke3F1b3RlKHNyY0NoYWluTmFtZSl9LiBlbnN1cmUgaXQgaXMgcmVnaXN0ZXJlZCBpbiBjaGFpbkh1Yi5gO1xuICAgICAgY29uc3QgeyBiYXNlTmFtZSwgY2hhaW5OYW1lIH0gPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGRlbm9tRGV0YWlsXG4gICAgICApO1xuICAgICAgY2hhaW5OYW1lID09PSBzcmNDaGFpbk5hbWUgfHwgdGhyb3dSZWRhY3RlZGBjYW5ub3QgdHJhbnNmZXIgYXNzZXQgJHtxdW90ZShkZW5vbUFtb3VudC5kZW5vbSl9LiBoZWxkIG9uICR7cXVvdGUoY2hhaW5OYW1lKX0gbm90ICR7cXVvdGUoc3JjQ2hhaW5OYW1lKX0uYDtcbiAgICAgIGNoYWluSW5mb3MuaGFzKGJhc2VOYW1lKSB8fCB0aHJvd1JlZGFjdGVkYGNoYWluIGluZm8gbm90IGZvdW5kIGZvciBpc3N1aW5nIGNoYWluOiAke3F1b3RlKGJhc2VOYW1lKX1gO1xuICAgICAgY29uc3QgYmFzZUNoYWluSW5mbyA9IGNoYWluSW5mb3MuZ2V0KGJhc2VOYW1lKTtcbiAgICAgIGlmIChiYXNlQ2hhaW5JbmZvLm5hbWVzcGFjZSAhPT0gXCJjb3Ntb3NcIilcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBPbmx5IGNvc21vcyBzdXBwb3J0ZWQ7IGdvdCAke3F1b3RlKGJhc2VDaGFpbkluZm8ubmFtZXNwYWNlKX1gO1xuICAgICAgY29uc3QgeyBjaGFpbklkOiBiYXNlQ2hhaW5JZCwgcGZtRW5hYmxlZCB9ID0gYmFzZUNoYWluSW5mbztcbiAgICAgIGNvbnN0IGhvbGRpbmdDaGFpbkluZm8gPSBjaGFpbkluZm9zLmdldChzcmNDaGFpbk5hbWUpO1xuICAgICAgaWYgKGhvbGRpbmdDaGFpbkluZm8ubmFtZXNwYWNlICE9PSBcImNvc21vc1wiKSB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgT25seSBjb3Ntb3Mgc3VwcG9ydGVkOyBnb3QgJHtxdW90ZShob2xkaW5nQ2hhaW5JbmZvLm5hbWVzcGFjZSl9YDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgY2hhaW5JZDogaG9sZGluZ0NoYWluSWQgfSA9IGhvbGRpbmdDaGFpbkluZm87XG4gICAgICBjb25zdCBjb3Ntb3NEZXN0ID0gY2hhaW5IdWIuY29lcmNlQ29zbW9zQWRkcmVzcyhkZXN0aW5hdGlvbik7XG4gICAgICBpZiAoYmFzZUNoYWluSWQgPT09IGNvc21vc0Rlc3QuY2hhaW5JZCB8fCBiYXNlTmFtZSA9PT0gc3JjQ2hhaW5OYW1lKSB7XG4gICAgICAgIGNvbnN0IGNvbm5LZXkgPSBjb25uZWN0aW9uS2V5KGhvbGRpbmdDaGFpbklkLCBjb3Ntb3NEZXN0LmNoYWluSWQpO1xuICAgICAgICBjb25uZWN0aW9uSW5mb3MuaGFzKGNvbm5LZXkpIHx8IHRocm93UmVkYWN0ZWRgbm8gY29ubmVjdGlvbiBpbmZvIGZvdW5kIGZvciAke2hvbGRpbmdDaGFpbklkfTwtPiR7Y29zbW9zRGVzdC5jaGFpbklkfWA7XG4gICAgICAgIGNvbnN0IHsgdHJhbnNmZXJDaGFubmVsIH0gPSBkZW5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvKFxuICAgICAgICAgIGhvbGRpbmdDaGFpbklkLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY29zbW9zRGVzdC5jaGFpbklkLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY29ubmVjdGlvbkluZm9zLmdldChjb25uS2V5KVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgICBzb3VyY2VQb3J0OiB0cmFuc2ZlckNoYW5uZWwucG9ydElkLFxuICAgICAgICAgIHNvdXJjZUNoYW5uZWw6IHRyYW5zZmVyQ2hhbm5lbC5jaGFubmVsSWQsXG4gICAgICAgICAgdG9rZW46IHtcbiAgICAgICAgICAgIGFtb3VudDogU3RyaW5nKGRlbm9tQW1vdW50LnZhbHVlKSxcbiAgICAgICAgICAgIGRlbm9tOiBkZW5vbUFtb3VudC5kZW5vbVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVjZWl2ZXI6IGNvc21vc0Rlc3QudmFsdWVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBwZm1FbmFibGVkIHx8IHRocm93UmVkYWN0ZWRgcGZtIG5vdCBlbmFibGVkIG9uIGlzc3VpbmcgY2hhaW46ICR7cXVvdGUoYmFzZU5hbWUpfWA7XG4gICAgICBjb25zdCBjdXJyVG9Jc3N1ZXJLZXkgPSBjb25uZWN0aW9uS2V5KGhvbGRpbmdDaGFpbklkLCBiYXNlQ2hhaW5JZCk7XG4gICAgICBjb25uZWN0aW9uSW5mb3MuaGFzKGN1cnJUb0lzc3VlcktleSkgfHwgdGhyb3dSZWRhY3RlZGBubyBjb25uZWN0aW9uIGluZm8gZm91bmQgZm9yICR7aG9sZGluZ0NoYWluSWR9PC0+JHtiYXNlQ2hhaW5JZH1gO1xuICAgICAgY29uc3QgaXNzdWVyVG9EZXN0S2V5ID0gY29ubmVjdGlvbktleShiYXNlQ2hhaW5JZCwgY29zbW9zRGVzdC5jaGFpbklkKTtcbiAgICAgIGNvbm5lY3Rpb25JbmZvcy5oYXMoaXNzdWVyVG9EZXN0S2V5KSB8fCB0aHJvd1JlZGFjdGVkYG5vIGNvbm5lY3Rpb24gaW5mbyBmb3VuZCBmb3IgJHtiYXNlQ2hhaW5JZH08LT4ke2Nvc21vc0Rlc3QuY2hhaW5JZH1gO1xuICAgICAgY29uc3QgY3VyclRvSXNzdWVyID0gZGVub3JtYWxpemVDb25uZWN0aW9uSW5mbyhcbiAgICAgICAgaG9sZGluZ0NoYWluSWQsXG4gICAgICAgIGJhc2VDaGFpbklkLFxuICAgICAgICBjb25uZWN0aW9uSW5mb3MuZ2V0KGN1cnJUb0lzc3VlcktleSlcbiAgICAgICk7XG4gICAgICBjb25zdCBpc3N1ZXJUb0Rlc3QgPSBkZW5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvKFxuICAgICAgICBiYXNlQ2hhaW5JZCxcbiAgICAgICAgY29zbW9zRGVzdC5jaGFpbklkLFxuICAgICAgICBjb25uZWN0aW9uSW5mb3MuZ2V0KGlzc3VlclRvRGVzdEtleSlcbiAgICAgICk7XG4gICAgICBjb25zdCB7IGludGVybWVkaWF0ZVJlY2lwaWVudCwgLi4ucmVzdCB9ID0gZm9yd2FyZE9wdHMgPz8ge307XG4gICAgICBjb25zdCBmb3J3YXJkSW5mbyA9IGhhcmRlbih7XG4gICAgICAgIGZvcndhcmQ6IHtcbiAgICAgICAgICByZWNlaXZlcjogY29zbW9zRGVzdC52YWx1ZSxcbiAgICAgICAgICBwb3J0OiBpc3N1ZXJUb0Rlc3QudHJhbnNmZXJDaGFubmVsLnBvcnRJZCxcbiAgICAgICAgICBjaGFubmVsOiBpc3N1ZXJUb0Rlc3QudHJhbnNmZXJDaGFubmVsLmNoYW5uZWxJZCxcbiAgICAgICAgICAuLi5EZWZhdWx0UGZtVGltZW91dE9wdHMsXG4gICAgICAgICAgLi4uLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICByZXN0XG4gICAgICAgICAgLy9cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgc291cmNlUG9ydDogY3VyclRvSXNzdWVyLnRyYW5zZmVyQ2hhbm5lbC5wb3J0SWQsXG4gICAgICAgIHNvdXJjZUNoYW5uZWw6IGN1cnJUb0lzc3Vlci50cmFuc2ZlckNoYW5uZWwuY2hhbm5lbElkLFxuICAgICAgICB0b2tlbjoge1xuICAgICAgICAgIGFtb3VudDogU3RyaW5nKGRlbm9tQW1vdW50LnZhbHVlKSxcbiAgICAgICAgICBkZW5vbTogZGVub21BbW91bnQuZGVub21cbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICByZWNlaXZlcjogaW50ZXJtZWRpYXRlUmVjaXBpZW50Py52YWx1ZSB8fCBQRk1fUkVDRUlWRVIsXG4gICAgICAgIGZvcndhcmRJbmZvXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gY2hhaW5IdWI7XG59O1xuXG4vL1xudmFyIHR5cGVkSnNvbiA9IChlMiwgdDUpID0+ICh7IFwiQHR5cGVcIjogZTIsIC4uLnQ1IH0pO1xudmFyIHQzID0gL15cXC8oPzxzZXJ2aWNlTmFtZT5cXHcrKD86XFwuXFx3KykqKVxcLlF1ZXJ5KD88bWV0aG9kTmFtZT5cXHcrKVJlcXVlc3QkLztcbnZhciB0eXBlVXJsVG9HcnBjUGF0aCA9IChlMikgPT4ge1xuICBjb25zdCByNSA9IGUyLm1hdGNoKHQzKTtcbiAgaWYgKCFyNSB8fCAhcjUuZ3JvdXBzKSB0aHJvdyBUeXBlRXJyb3IoYEludmFsaWQgdHlwZVVybDogJHtlMn0uIE11c3QgYmUgYSBRdWVyeSBSZXF1ZXN0LmApO1xuICBjb25zdCB7IHNlcnZpY2VOYW1lOiBvMiwgbWV0aG9kTmFtZTogczMgfSA9IHI1Lmdyb3VwcztcbiAgcmV0dXJuIGAvJHtvMn0uUXVlcnkvJHtzM31gO1xufTtcbnZhciB0b1JlcXVlc3RRdWVyeUpzb24gPSAodDUsIHI1ID0ge30pID0+IFJlcXVlc3RRdWVyeS50b0pTT04oUmVxdWVzdFF1ZXJ5LmZyb21QYXJ0aWFsKHsgcGF0aDogdHlwZVVybFRvR3JwY1BhdGgodDUudHlwZVVybCksIGRhdGE6IHQ1LnZhbHVlLCAuLi5yNSB9KSk7XG5cbi8vXG5mdW5jdGlvbiByMigpIHtcbiAgcmV0dXJuIHsgZnJvbTogXCJcIiwgYW1vdW50OiBcIlwiLCBkZXN0aW5hdGlvbkRvbWFpbjogMCwgbWludFJlY2lwaWVudDogbmV3IFVpbnQ4QXJyYXkoKSwgYnVyblRva2VuOiBcIlwiIH07XG59XG52YXIgTXNnRGVwb3NpdEZvckJ1cm4gPSB7IHR5cGVVcmw6IFwiL2NpcmNsZS5jY3RwLnYxLk1zZ0RlcG9zaXRGb3JCdXJuXCIsIGVuY29kZTogKG4yLCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG4yLmZyb20gJiYgZTIudWludDMyKDEwKS5zdHJpbmcobjIuZnJvbSksIFwiXCIgIT09IG4yLmFtb3VudCAmJiBlMi51aW50MzIoMTgpLnN0cmluZyhuMi5hbW91bnQpLCAwICE9PSBuMi5kZXN0aW5hdGlvbkRvbWFpbiAmJiBlMi51aW50MzIoMjQpLnVpbnQzMihuMi5kZXN0aW5hdGlvbkRvbWFpbiksIDAgIT09IG4yLm1pbnRSZWNpcGllbnQubGVuZ3RoICYmIGUyLnVpbnQzMigzNCkuYnl0ZXMobjIubWludFJlY2lwaWVudCksIFwiXCIgIT09IG4yLmJ1cm5Ub2tlbiAmJiBlMi51aW50MzIoNDIpLnN0cmluZyhuMi5idXJuVG9rZW4pLCBlMiksIGRlY29kZSh0NSwgZTIpIHtcbiAgY29uc3QgbzIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gZTIgPyBvMi5sZW4gOiBvMi5wb3MgKyBlMjtcbiAgY29uc3QgczMgPSByMigpO1xuICBmb3IgKDsgbzIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IG4yID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChuMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzMy5mcm9tID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBzMy5hbW91bnQgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHMzLmRlc3RpbmF0aW9uRG9tYWluID0gbzIudWludDMyKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBzMy5taW50UmVjaXBpZW50ID0gbzIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDU6XG4gICAgICAgIHMzLmJ1cm5Ub2tlbiA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBuMik7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMztcbn0sIGZyb21KU09OOiAobjIpID0+ICh7IGZyb206IGlzU2V0KG4yLmZyb20pID8gU3RyaW5nKG4yLmZyb20pIDogXCJcIiwgYW1vdW50OiBpc1NldChuMi5hbW91bnQpID8gU3RyaW5nKG4yLmFtb3VudCkgOiBcIlwiLCBkZXN0aW5hdGlvbkRvbWFpbjogaXNTZXQobjIuZGVzdGluYXRpb25Eb21haW4pID8gTnVtYmVyKG4yLmRlc3RpbmF0aW9uRG9tYWluKSA6IDAsIG1pbnRSZWNpcGllbnQ6IGlzU2V0KG4yLm1pbnRSZWNpcGllbnQpID8gZGVjb2RlQmFzZTY0KG4yLm1pbnRSZWNpcGllbnQpIDogbmV3IFVpbnQ4QXJyYXkoKSwgYnVyblRva2VuOiBpc1NldChuMi5idXJuVG9rZW4pID8gU3RyaW5nKG4yLmJ1cm5Ub2tlbikgOiBcIlwiIH0pLCB0b0pTT04objIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbjIuZnJvbSAmJiAodDUuZnJvbSA9IG4yLmZyb20pLCB2b2lkIDAgIT09IG4yLmFtb3VudCAmJiAodDUuYW1vdW50ID0gbjIuYW1vdW50KSwgdm9pZCAwICE9PSBuMi5kZXN0aW5hdGlvbkRvbWFpbiAmJiAodDUuZGVzdGluYXRpb25Eb21haW4gPSBNYXRoLnJvdW5kKG4yLmRlc3RpbmF0aW9uRG9tYWluKSksIHZvaWQgMCAhPT0gbjIubWludFJlY2lwaWVudCAmJiAodDUubWludFJlY2lwaWVudCA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IG4yLm1pbnRSZWNpcGllbnQgPyBuMi5taW50UmVjaXBpZW50IDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB2b2lkIDAgIT09IG4yLmJ1cm5Ub2tlbiAmJiAodDUuYnVyblRva2VuID0gbjIuYnVyblRva2VuKSwgdDU7XG59LCBmcm9tUGFydGlhbChuMikge1xuICBjb25zdCB0NSA9IHIyKCk7XG4gIHJldHVybiB0NS5mcm9tID0gbjIuZnJvbSA/PyBcIlwiLCB0NS5hbW91bnQgPSBuMi5hbW91bnQgPz8gXCJcIiwgdDUuZGVzdGluYXRpb25Eb21haW4gPSBuMi5kZXN0aW5hdGlvbkRvbWFpbiA/PyAwLCB0NS5taW50UmVjaXBpZW50ID0gbjIubWludFJlY2lwaWVudCA/PyBuZXcgVWludDhBcnJheSgpLCB0NS5idXJuVG9rZW4gPSBuMi5idXJuVG9rZW4gPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChuMikgPT4gTXNnRGVwb3NpdEZvckJ1cm4uZGVjb2RlKG4yLnZhbHVlKSwgdG9Qcm90bzogKG4yKSA9PiBNc2dEZXBvc2l0Rm9yQnVybi5lbmNvZGUobjIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobjIpID0+ICh7IHR5cGVVcmw6IFwiL2NpcmNsZS5jY3RwLnYxLk1zZ0RlcG9zaXRGb3JCdXJuXCIsIHZhbHVlOiBNc2dEZXBvc2l0Rm9yQnVybi5lbmNvZGUobjIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBhKCkge1xuICByZXR1cm4geyBmcm9tOiBcIlwiLCBhbW91bnQ6IFwiXCIsIGRlc3RpbmF0aW9uRG9tYWluOiAwLCBtaW50UmVjaXBpZW50OiBuZXcgVWludDhBcnJheSgpLCBidXJuVG9rZW46IFwiXCIsIGRlc3RpbmF0aW9uQ2FsbGVyOiBuZXcgVWludDhBcnJheSgpIH07XG59XG52YXIgTXNnRGVwb3NpdEZvckJ1cm5XaXRoQ2FsbGVyID0geyB0eXBlVXJsOiBcIi9jaXJjbGUuY2N0cC52MS5Nc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXJcIiwgZW5jb2RlOiAobjIsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbjIuZnJvbSAmJiBlMi51aW50MzIoMTApLnN0cmluZyhuMi5mcm9tKSwgXCJcIiAhPT0gbjIuYW1vdW50ICYmIGUyLnVpbnQzMigxOCkuc3RyaW5nKG4yLmFtb3VudCksIDAgIT09IG4yLmRlc3RpbmF0aW9uRG9tYWluICYmIGUyLnVpbnQzMigyNCkudWludDMyKG4yLmRlc3RpbmF0aW9uRG9tYWluKSwgMCAhPT0gbjIubWludFJlY2lwaWVudC5sZW5ndGggJiYgZTIudWludDMyKDM0KS5ieXRlcyhuMi5taW50UmVjaXBpZW50KSwgXCJcIiAhPT0gbjIuYnVyblRva2VuICYmIGUyLnVpbnQzMig0Mikuc3RyaW5nKG4yLmJ1cm5Ub2tlbiksIDAgIT09IG4yLmRlc3RpbmF0aW9uQ2FsbGVyLmxlbmd0aCAmJiBlMi51aW50MzIoNTApLmJ5dGVzKG4yLmRlc3RpbmF0aW9uQ2FsbGVyKSwgZTIpLCBkZWNvZGUodDUsIGUyKSB7XG4gIGNvbnN0IG8yID0gdDUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyB0NSA6IG5ldyBCaW5hcnlSZWFkZXIodDUpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IGUyID8gbzIubGVuIDogbzIucG9zICsgZTI7XG4gIGNvbnN0IHI1ID0gYSgpO1xuICBmb3IgKDsgbzIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IG4yID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChuMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5mcm9tID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNS5hbW91bnQgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHI1LmRlc3RpbmF0aW9uRG9tYWluID0gbzIudWludDMyKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICByNS5taW50UmVjaXBpZW50ID0gbzIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDU6XG4gICAgICAgIHI1LmJ1cm5Ub2tlbiA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNjpcbiAgICAgICAgcjUuZGVzdGluYXRpb25DYWxsZXIgPSBvMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBuMik7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAobjIpID0+ICh7IGZyb206IGlzU2V0KG4yLmZyb20pID8gU3RyaW5nKG4yLmZyb20pIDogXCJcIiwgYW1vdW50OiBpc1NldChuMi5hbW91bnQpID8gU3RyaW5nKG4yLmFtb3VudCkgOiBcIlwiLCBkZXN0aW5hdGlvbkRvbWFpbjogaXNTZXQobjIuZGVzdGluYXRpb25Eb21haW4pID8gTnVtYmVyKG4yLmRlc3RpbmF0aW9uRG9tYWluKSA6IDAsIG1pbnRSZWNpcGllbnQ6IGlzU2V0KG4yLm1pbnRSZWNpcGllbnQpID8gZGVjb2RlQmFzZTY0KG4yLm1pbnRSZWNpcGllbnQpIDogbmV3IFVpbnQ4QXJyYXkoKSwgYnVyblRva2VuOiBpc1NldChuMi5idXJuVG9rZW4pID8gU3RyaW5nKG4yLmJ1cm5Ub2tlbikgOiBcIlwiLCBkZXN0aW5hdGlvbkNhbGxlcjogaXNTZXQobjIuZGVzdGluYXRpb25DYWxsZXIpID8gZGVjb2RlQmFzZTY0KG4yLmRlc3RpbmF0aW9uQ2FsbGVyKSA6IG5ldyBVaW50OEFycmF5KCkgfSksIHRvSlNPTihuMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBuMi5mcm9tICYmICh0NS5mcm9tID0gbjIuZnJvbSksIHZvaWQgMCAhPT0gbjIuYW1vdW50ICYmICh0NS5hbW91bnQgPSBuMi5hbW91bnQpLCB2b2lkIDAgIT09IG4yLmRlc3RpbmF0aW9uRG9tYWluICYmICh0NS5kZXN0aW5hdGlvbkRvbWFpbiA9IE1hdGgucm91bmQobjIuZGVzdGluYXRpb25Eb21haW4pKSwgdm9pZCAwICE9PSBuMi5taW50UmVjaXBpZW50ICYmICh0NS5taW50UmVjaXBpZW50ID0gZW5jb2RlQmFzZTY0KHZvaWQgMCAhPT0gbjIubWludFJlY2lwaWVudCA/IG4yLm1pbnRSZWNpcGllbnQgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gbjIuYnVyblRva2VuICYmICh0NS5idXJuVG9rZW4gPSBuMi5idXJuVG9rZW4pLCB2b2lkIDAgIT09IG4yLmRlc3RpbmF0aW9uQ2FsbGVyICYmICh0NS5kZXN0aW5hdGlvbkNhbGxlciA9IGVuY29kZUJhc2U2NCh2b2lkIDAgIT09IG4yLmRlc3RpbmF0aW9uQ2FsbGVyID8gbjIuZGVzdGluYXRpb25DYWxsZXIgOiBuZXcgVWludDhBcnJheSgpKSksIHQ1O1xufSwgZnJvbVBhcnRpYWwobjIpIHtcbiAgY29uc3QgdDUgPSBhKCk7XG4gIHJldHVybiB0NS5mcm9tID0gbjIuZnJvbSA/PyBcIlwiLCB0NS5hbW91bnQgPSBuMi5hbW91bnQgPz8gXCJcIiwgdDUuZGVzdGluYXRpb25Eb21haW4gPSBuMi5kZXN0aW5hdGlvbkRvbWFpbiA/PyAwLCB0NS5taW50UmVjaXBpZW50ID0gbjIubWludFJlY2lwaWVudCA/PyBuZXcgVWludDhBcnJheSgpLCB0NS5idXJuVG9rZW4gPSBuMi5idXJuVG9rZW4gPz8gXCJcIiwgdDUuZGVzdGluYXRpb25DYWxsZXIgPSBuMi5kZXN0aW5hdGlvbkNhbGxlciA/PyBuZXcgVWludDhBcnJheSgpLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG4yKSA9PiBNc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXIuZGVjb2RlKG4yLnZhbHVlKSwgdG9Qcm90bzogKG4yKSA9PiBNc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXIuZW5jb2RlKG4yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG4yKSA9PiAoeyB0eXBlVXJsOiBcIi9jaXJjbGUuY2N0cC52MS5Nc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXJcIiwgdmFsdWU6IE1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlci5lbmNvZGUobjIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG5mdW5jdGlvbiByMygpIHtcbiAgcmV0dXJuIHsga2V5OiBuZXcgVWludDhBcnJheSgpLCBvZmZzZXQ6IEJpZ0ludCgwKSwgbGltaXQ6IEJpZ0ludCgwKSwgY291bnRUb3RhbDogZmFsc2UsIHJldmVyc2U6IGZhbHNlIH07XG59XG52YXIgUGFnZVJlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnF1ZXJ5LnYxYmV0YTEuUGFnZVJlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoMCAhPT0gZTIua2V5Lmxlbmd0aCAmJiBvMi51aW50MzIoMTApLmJ5dGVzKGUyLmtleSksIGUyLm9mZnNldCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMigxNikudWludDY0KGUyLm9mZnNldCksIGUyLmxpbWl0ICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDI0KS51aW50NjQoZTIubGltaXQpLCB0cnVlID09PSBlMi5jb3VudFRvdGFsICYmIG8yLnVpbnQzMigzMikuYm9vbChlMi5jb3VudFRvdGFsKSwgdHJ1ZSA9PT0gZTIucmV2ZXJzZSAmJiBvMi51aW50MzIoNDApLmJvb2woZTIucmV2ZXJzZSksIG8yKSwgZGVjb2RlKHQ1LCBvMikge1xuICBjb25zdCBuMiA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBvMiA/IG4yLmxlbiA6IG4yLnBvcyArIG8yO1xuICBjb25zdCBzMyA9IHIzKCk7XG4gIGZvciAoOyBuMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTIgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUyID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHMzLmtleSA9IG4yLmJ5dGVzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBzMy5vZmZzZXQgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHMzLmxpbWl0ID0gbjIudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBzMy5jb3VudFRvdGFsID0gbjIuYm9vbCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgczMucmV2ZXJzZSA9IG4yLmJvb2woKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gczM7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBrZXk6IGlzU2V0KGUyLmtleSkgPyBkZWNvZGVCYXNlNjQoZTIua2V5KSA6IG5ldyBVaW50OEFycmF5KCksIG9mZnNldDogaXNTZXQoZTIub2Zmc2V0KSA/IEJpZ0ludChlMi5vZmZzZXQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGxpbWl0OiBpc1NldChlMi5saW1pdCkgPyBCaWdJbnQoZTIubGltaXQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGNvdW50VG90YWw6ICEhaXNTZXQoZTIuY291bnRUb3RhbCkgJiYgQm9vbGVhbihlMi5jb3VudFRvdGFsKSwgcmV2ZXJzZTogISFpc1NldChlMi5yZXZlcnNlKSAmJiBCb29sZWFuKGUyLnJldmVyc2UpIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIua2V5ICYmICh0NS5rZXkgPSBlbmNvZGVCYXNlNjQodm9pZCAwICE9PSBlMi5rZXkgPyBlMi5rZXkgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gZTIub2Zmc2V0ICYmICh0NS5vZmZzZXQgPSAoZTIub2Zmc2V0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIubGltaXQgJiYgKHQ1LmxpbWl0ID0gKGUyLmxpbWl0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuY291bnRUb3RhbCAmJiAodDUuY291bnRUb3RhbCA9IGUyLmNvdW50VG90YWwpLCB2b2lkIDAgIT09IGUyLnJldmVyc2UgJiYgKHQ1LnJldmVyc2UgPSBlMi5yZXZlcnNlKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHIzKCk7XG4gIHJldHVybiB0NS5rZXkgPSBlMi5rZXkgPz8gbmV3IFVpbnQ4QXJyYXkoKSwgdDUub2Zmc2V0ID0gdm9pZCAwICE9PSBlMi5vZmZzZXQgJiYgbnVsbCAhPT0gZTIub2Zmc2V0ID8gQmlnSW50KGUyLm9mZnNldC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgdDUubGltaXQgPSB2b2lkIDAgIT09IGUyLmxpbWl0ICYmIG51bGwgIT09IGUyLmxpbWl0ID8gQmlnSW50KGUyLmxpbWl0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB0NS5jb3VudFRvdGFsID0gZTIuY291bnRUb3RhbCA/PyBmYWxzZSwgdDUucmV2ZXJzZSA9IGUyLnJldmVyc2UgPz8gZmFsc2UsIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFBhZ2VSZXF1ZXN0LmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUGFnZVJlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS5xdWVyeS52MWJldGExLlBhZ2VSZXF1ZXN0XCIsIHZhbHVlOiBQYWdlUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBzMigpIHtcbiAgcmV0dXJuIHsgbmV4dEtleTogbmV3IFVpbnQ4QXJyYXkoKSwgdG90YWw6IEJpZ0ludCgwKSB9O1xufVxudmFyIFBhZ2VSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhc2UucXVlcnkudjFiZXRhMS5QYWdlUmVzcG9uc2VcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoMCAhPT0gZTIubmV4dEtleS5sZW5ndGggJiYgbzIudWludDMyKDEwKS5ieXRlcyhlMi5uZXh0S2V5KSwgZTIudG90YWwgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoMTYpLnVpbnQ2NChlMi50b3RhbCksIG8yKSwgZGVjb2RlKHQ1LCBvMikge1xuICBjb25zdCBuMiA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBvMiA/IG4yLmxlbiA6IG4yLnBvcyArIG8yO1xuICBjb25zdCByNSA9IHMyKCk7XG4gIGZvciAoOyBuMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTIgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUyID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1Lm5leHRLZXkgPSBuMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUudG90YWwgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBuZXh0S2V5OiBpc1NldChlMi5uZXh0S2V5KSA/IGRlY29kZUJhc2U2NChlMi5uZXh0S2V5KSA6IG5ldyBVaW50OEFycmF5KCksIHRvdGFsOiBpc1NldChlMi50b3RhbCkgPyBCaWdJbnQoZTIudG90YWwudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCkgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5uZXh0S2V5ICYmICh0NS5uZXh0S2V5ID0gZW5jb2RlQmFzZTY0KHZvaWQgMCAhPT0gZTIubmV4dEtleSA/IGUyLm5leHRLZXkgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gZTIudG90YWwgJiYgKHQ1LnRvdGFsID0gKGUyLnRvdGFsIHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSBzMigpO1xuICByZXR1cm4gdDUubmV4dEtleSA9IGUyLm5leHRLZXkgPz8gbmV3IFVpbnQ4QXJyYXkoKSwgdDUudG90YWwgPSB2b2lkIDAgIT09IGUyLnRvdGFsICYmIG51bGwgIT09IGUyLnRvdGFsID8gQmlnSW50KGUyLnRvdGFsLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBQYWdlUmVzcG9uc2UuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBQYWdlUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS5xdWVyeS52MWJldGExLlBhZ2VSZXNwb25zZVwiLCB2YWx1ZTogUGFnZVJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBRdWVyeUJhbGFuY2VSZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QmFsYW5jZVJlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuYWRkcmVzcyAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi5hZGRyZXNzKSwgXCJcIiAhPT0gZTIuZGVub20gJiYgbzIudWludDMyKDE4KS5zdHJpbmcoZTIuZGVub20pLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgbjIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBhMiA9IHZvaWQgMCA9PT0gbzIgPyBuMi5sZW4gOiBuMi5wb3MgKyBvMjtcbiAgY29uc3QgdDUgPSB7IGFkZHJlc3M6IFwiXCIsIGRlbm9tOiBcIlwiIH07XG4gIGZvciAoOyBuMi5wb3MgPCBhMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHQ1LmFkZHJlc3MgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHQ1LmRlbm9tID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHQ1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgYWRkcmVzczogaXNTZXQoZTIuYWRkcmVzcykgPyBTdHJpbmcoZTIuYWRkcmVzcykgOiBcIlwiLCBkZW5vbTogaXNTZXQoZTIuZGVub20pID8gU3RyaW5nKGUyLmRlbm9tKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5hZGRyZXNzICYmIChvMi5hZGRyZXNzID0gZTIuYWRkcmVzcyksIHZvaWQgMCAhPT0gZTIuZGVub20gJiYgKG8yLmRlbm9tID0gZTIuZGVub20pLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0geyBhZGRyZXNzOiBcIlwiLCBkZW5vbTogXCJcIiB9O1xuICByZXR1cm4gbzIuYWRkcmVzcyA9IGUyLmFkZHJlc3MgPz8gXCJcIiwgbzIuZGVub20gPSBlMi5kZW5vbSA/PyBcIlwiLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeUJhbGFuY2VSZXF1ZXN0LmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlCYWxhbmNlUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlCYWxhbmNlUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlCYWxhbmNlUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlCYWxhbmNlUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlCYWxhbmNlUmVzcG9uc2VcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodm9pZCAwICE9PSBlMi5iYWxhbmNlICYmIENvaW4uZW5jb2RlKGUyLmJhbGFuY2UsIG8yLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IGEyID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgdDUgPSB2b2lkIDAgPT09IG8yID8gYTIubGVuIDogYTIucG9zICsgbzI7XG4gIGNvbnN0IGkyID0geyBiYWxhbmNlOiB2b2lkIDAgfTtcbiAgZm9yICg7IGEyLnBvcyA8IHQ1OyApIHtcbiAgICBjb25zdCBlMyA9IGEyLnVpbnQzMigpO1xuICAgIGlmIChlMyA+Pj4gMyA9PSAxKSBpMi5iYWxhbmNlID0gQ29pbi5kZWNvZGUoYTIsIGEyLnVpbnQzMigpKTtcbiAgICBlbHNlIGEyLnNraXBUeXBlKDcgJiBlMyk7XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgYmFsYW5jZTogaXNTZXQoZTIuYmFsYW5jZSkgPyBDb2luLmZyb21KU09OKGUyLmJhbGFuY2UpIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiAobzIuYmFsYW5jZSA9IGUyLmJhbGFuY2UgPyBDb2luLnRvSlNPTihlMi5iYWxhbmNlKSA6IHZvaWQgMCksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB7IGJhbGFuY2U6IHZvaWQgMCB9O1xuICByZXR1cm4gbzIuYmFsYW5jZSA9IHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiBudWxsICE9PSBlMi5iYWxhbmNlID8gQ29pbi5mcm9tUGFydGlhbChlMi5iYWxhbmNlKSA6IHZvaWQgMCwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlCYWxhbmNlUmVzcG9uc2UuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeUJhbGFuY2VSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlCYWxhbmNlUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5QmFsYW5jZVJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeUFsbEJhbGFuY2VzUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUFsbEJhbGFuY2VzUmVxdWVzdFwiLCBlbmNvZGU6IChvMiwgbjIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5hZGRyZXNzICYmIG4yLnVpbnQzMigxMCkuc3RyaW5nKG8yLmFkZHJlc3MpLCB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgUGFnZVJlcXVlc3QuZW5jb2RlKG8yLnBhZ2luYXRpb24sIG4yLnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgbjIpLCBkZWNvZGUobzIsIG4yKSB7XG4gIGNvbnN0IGEyID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgdDUgPSB2b2lkIDAgPT09IG4yID8gYTIubGVuIDogYTIucG9zICsgbjI7XG4gIGNvbnN0IGkyID0geyBhZGRyZXNzOiBcIlwiLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgZm9yICg7IGEyLnBvcyA8IHQ1OyApIHtcbiAgICBjb25zdCBvMyA9IGEyLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTIuYWRkcmVzcyA9IGEyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIucGFnaW5hdGlvbiA9IFBhZ2VSZXF1ZXN0LmRlY29kZShhMiwgYTIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGEyLnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGFkZHJlc3M6IGlzU2V0KG8yLmFkZHJlc3MpID8gU3RyaW5nKG8yLmFkZHJlc3MpIDogXCJcIiwgcGFnaW5hdGlvbjogaXNTZXQobzIucGFnaW5hdGlvbikgPyBQYWdlUmVxdWVzdC5mcm9tSlNPTihvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IG4yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLmFkZHJlc3MgJiYgKG4yLmFkZHJlc3MgPSBvMi5hZGRyZXNzKSwgdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmIChuMi5wYWdpbmF0aW9uID0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXF1ZXN0LnRvSlNPTihvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCksIG4yO1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgbjIgPSB7IGFkZHJlc3M6IFwiXCIsIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICByZXR1cm4gbjIuYWRkcmVzcyA9IG8yLmFkZHJlc3MgPz8gXCJcIiwgbjIucGFnaW5hdGlvbiA9IHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBudWxsICE9PSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QuZnJvbVBhcnRpYWwobzIucGFnaW5hdGlvbikgOiB2b2lkIDAsIG4yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0LmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0XCIsIHZhbHVlOiBRdWVyeUFsbEJhbGFuY2VzUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QWxsQmFsYW5jZXNSZXNwb25zZVwiLCBlbmNvZGUoZTIsIGEyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgbzIgb2YgZTIuYmFsYW5jZXMpIENvaW4uZW5jb2RlKG8yLCBhMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgUGFnZVJlc3BvbnNlLmVuY29kZShlMi5wYWdpbmF0aW9uLCBhMi51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIGEyO1xufSwgZGVjb2RlKGUyLCBhMikge1xuICBjb25zdCB0NSA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBhMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIGEyO1xuICBjb25zdCByNSA9IHsgYmFsYW5jZXM6IFtdLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgZm9yICg7IHQ1LnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCBlMyA9IHQ1LnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjUuYmFsYW5jZXMucHVzaChDb2luLmRlY29kZSh0NSwgdDUudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LnBhZ2luYXRpb24gPSBQYWdlUmVzcG9uc2UuZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgYmFsYW5jZXM6IEFycmF5LmlzQXJyYXkoZTI/LmJhbGFuY2VzKSA/IGUyLmJhbGFuY2VzLm1hcCgoZTMpID0+IENvaW4uZnJvbUpTT04oZTMpKSA6IFtdLCBwYWdpbmF0aW9uOiBpc1NldChlMi5wYWdpbmF0aW9uKSA/IFBhZ2VSZXNwb25zZS5mcm9tSlNPTihlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IGEyID0ge307XG4gIHJldHVybiBlMi5iYWxhbmNlcyA/IGEyLmJhbGFuY2VzID0gZTIuYmFsYW5jZXMubWFwKChlMykgPT4gZTMgPyBDb2luLnRvSlNPTihlMykgOiB2b2lkIDApIDogYTIuYmFsYW5jZXMgPSBbXSwgdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIChhMi5wYWdpbmF0aW9uID0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS50b0pTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDApLCBhMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IGEyID0geyBiYWxhbmNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICByZXR1cm4gYTIuYmFsYW5jZXMgPSBlMi5iYWxhbmNlcz8ubWFwKChlMykgPT4gQ29pbi5mcm9tUGFydGlhbChlMykpIHx8IFtdLCBhMi5wYWdpbmF0aW9uID0gdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIG51bGwgIT09IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVzcG9uc2UuZnJvbVBhcnRpYWwoZTIucGFnaW5hdGlvbikgOiB2b2lkIDAsIGEyO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5QWxsQmFsYW5jZXNSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5QWxsQmFsYW5jZXNSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlXCIsIHZhbHVlOiBRdWVyeUFsbEJhbGFuY2VzUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIE1zZ1NlbmQgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuTXNnU2VuZFwiLCBlbmNvZGUoczMsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIFwiXCIgIT09IHMzLmZyb21BZGRyZXNzICYmIGUyLnVpbnQzMigxMCkuc3RyaW5nKHMzLmZyb21BZGRyZXNzKSwgXCJcIiAhPT0gczMudG9BZGRyZXNzICYmIGUyLnVpbnQzMigxOCkuc3RyaW5nKHMzLnRvQWRkcmVzcyk7XG4gIGZvciAoY29uc3QgdDUgb2YgczMuYW1vdW50KSBDb2luLmVuY29kZSh0NSwgZTIudWludDMyKDI2KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gZTI7XG59LCBkZWNvZGUoczMsIGUyKSB7XG4gIGNvbnN0IG4yID0gczMgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBzMyA6IG5ldyBCaW5hcnlSZWFkZXIoczMpO1xuICBsZXQgcjUgPSB2b2lkIDAgPT09IGUyID8gbjIubGVuIDogbjIucG9zICsgZTI7XG4gIGNvbnN0IGQgPSB7IGZyb21BZGRyZXNzOiBcIlwiLCB0b0FkZHJlc3M6IFwiXCIsIGFtb3VudDogW10gfTtcbiAgZm9yICg7IG4yLnBvcyA8IHI1OyApIHtcbiAgICBjb25zdCBzNCA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoczQgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgZC5mcm9tQWRkcmVzcyA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgZC50b0FkZHJlc3MgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGQuYW1vdW50LnB1c2goQ29pbi5kZWNvZGUobjIsIG4yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIHM0KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGQ7XG59LCBmcm9tSlNPTjogKHMzKSA9PiAoeyBmcm9tQWRkcmVzczogaXNTZXQoczMuZnJvbUFkZHJlc3MpID8gU3RyaW5nKHMzLmZyb21BZGRyZXNzKSA6IFwiXCIsIHRvQWRkcmVzczogaXNTZXQoczMudG9BZGRyZXNzKSA/IFN0cmluZyhzMy50b0FkZHJlc3MpIDogXCJcIiwgYW1vdW50OiBBcnJheS5pc0FycmF5KHMzPy5hbW91bnQpID8gczMuYW1vdW50Lm1hcCgoczQpID0+IENvaW4uZnJvbUpTT04oczQpKSA6IFtdIH0pLCB0b0pTT04oczMpIHtcbiAgY29uc3QgZTIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gczMuZnJvbUFkZHJlc3MgJiYgKGUyLmZyb21BZGRyZXNzID0gczMuZnJvbUFkZHJlc3MpLCB2b2lkIDAgIT09IHMzLnRvQWRkcmVzcyAmJiAoZTIudG9BZGRyZXNzID0gczMudG9BZGRyZXNzKSwgczMuYW1vdW50ID8gZTIuYW1vdW50ID0gczMuYW1vdW50Lm1hcCgoczQpID0+IHM0ID8gQ29pbi50b0pTT04oczQpIDogdm9pZCAwKSA6IGUyLmFtb3VudCA9IFtdLCBlMjtcbn0sIGZyb21QYXJ0aWFsKHMzKSB7XG4gIGNvbnN0IGUyID0geyBmcm9tQWRkcmVzczogXCJcIiwgdG9BZGRyZXNzOiBcIlwiLCBhbW91bnQ6IFtdIH07XG4gIHJldHVybiBlMi5mcm9tQWRkcmVzcyA9IHMzLmZyb21BZGRyZXNzID8/IFwiXCIsIGUyLnRvQWRkcmVzcyA9IHMzLnRvQWRkcmVzcyA/PyBcIlwiLCBlMi5hbW91bnQgPSBzMy5hbW91bnQ/Lm1hcCgoczQpID0+IENvaW4uZnJvbVBhcnRpYWwoczQpKSB8fCBbXSwgZTI7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gTXNnU2VuZC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IE1zZ1NlbmQuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLk1zZ1NlbmRcIiwgdmFsdWU6IE1zZ1NlbmQuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5EZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkXCIsIGVuY29kZSh0NSwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgXCJcIiAhPT0gdDUudmFsaWRhdG9yQWRkcmVzcyAmJiBlMi51aW50MzIoMTApLnN0cmluZyh0NS52YWxpZGF0b3JBZGRyZXNzKTtcbiAgZm9yIChjb25zdCByNSBvZiB0NS5yZXdhcmQpIERlY0NvaW4uZW5jb2RlKHI1LCBlMi51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiBlMjtcbn0sIGRlY29kZSh0NSwgcjUpIHtcbiAgY29uc3QgaTIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gcjUgPyBpMi5sZW4gOiBpMi5wb3MgKyByNTtcbiAgY29uc3QgYTIgPSB7IHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIHJld2FyZDogW10gfTtcbiAgZm9yICg7IGkyLnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCB0NiA9IGkyLnVpbnQzMigpO1xuICAgIHN3aXRjaCAodDYgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgYTIudmFsaWRhdG9yQWRkcmVzcyA9IGkyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgYTIucmV3YXJkLnB1c2goRGVjQ29pbi5kZWNvZGUoaTIsIGkyLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgaTIuc2tpcFR5cGUoNyAmIHQ2KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGEyO1xufSwgZnJvbUpTT046ICh0NSkgPT4gKHsgdmFsaWRhdG9yQWRkcmVzczogaXNTZXQodDUudmFsaWRhdG9yQWRkcmVzcykgPyBTdHJpbmcodDUudmFsaWRhdG9yQWRkcmVzcykgOiBcIlwiLCByZXdhcmQ6IEFycmF5LmlzQXJyYXkodDU/LnJld2FyZCkgPyB0NS5yZXdhcmQubWFwKCh0NikgPT4gRGVjQ29pbi5mcm9tSlNPTih0NikpIDogW10gfSksIHRvSlNPTih0NSkge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSB0NS52YWxpZGF0b3JBZGRyZXNzICYmIChlMi52YWxpZGF0b3JBZGRyZXNzID0gdDUudmFsaWRhdG9yQWRkcmVzcyksIHQ1LnJld2FyZCA/IGUyLnJld2FyZCA9IHQ1LnJld2FyZC5tYXAoKHQ2KSA9PiB0NiA/IERlY0NvaW4udG9KU09OKHQ2KSA6IHZvaWQgMCkgOiBlMi5yZXdhcmQgPSBbXSwgZTI7XG59LCBmcm9tUGFydGlhbCh0NSkge1xuICBjb25zdCBlMiA9IHsgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgcmV3YXJkOiBbXSB9O1xuICByZXR1cm4gZTIudmFsaWRhdG9yQWRkcmVzcyA9IHQ1LnZhbGlkYXRvckFkZHJlc3MgPz8gXCJcIiwgZTIucmV3YXJkID0gdDUucmV3YXJkPy5tYXAoKHQ2KSA9PiBEZWNDb2luLmZyb21QYXJ0aWFsKHQ2KSkgfHwgW10sIGUyO1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLkRlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmRcIiwgdmFsdWU6IERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1JlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgXCJcIiAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTgpLnN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHMzID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgdDUgPSB2b2lkIDAgPT09IG8yID8gczMubGVuIDogczMucG9zICsgbzI7XG4gIGNvbnN0IHI1ID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiIH07XG4gIGZvciAoOyBzMy5wb3MgPCB0NTsgKSB7XG4gICAgY29uc3QgZTMgPSBzMy51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LmRlbGVnYXRvckFkZHJlc3MgPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LnZhbGlkYXRvckFkZHJlc3MgPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBzMy5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpIDogXCJcIiB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIChvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIgfTtcbiAgcmV0dXJuIG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzID8/IFwiXCIsIG8yLnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzID8/IFwiXCIsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0LmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1JlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2VcIiwgZW5jb2RlKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IHMzIG9mIGUyLnJld2FyZHMpIERlY0NvaW4uZW5jb2RlKHMzLCBvMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiBvMjtcbn0sIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgczMgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCB0NSA9IHZvaWQgMCA9PT0gbzIgPyBzMy5sZW4gOiBzMy5wb3MgKyBvMjtcbiAgY29uc3QgcjUgPSB7IHJld2FyZHM6IFtdIH07XG4gIGZvciAoOyBzMy5wb3MgPCB0NTsgKSB7XG4gICAgY29uc3QgZTMgPSBzMy51aW50MzIoKTtcbiAgICBpZiAoZTMgPj4+IDMgPT0gMSkgcjUucmV3YXJkcy5wdXNoKERlY0NvaW4uZGVjb2RlKHMzLCBzMy51aW50MzIoKSkpO1xuICAgIGVsc2UgczMuc2tpcFR5cGUoNyAmIGUzKTtcbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyByZXdhcmRzOiBBcnJheS5pc0FycmF5KGUyPy5yZXdhcmRzKSA/IGUyLnJld2FyZHMubWFwKChlMykgPT4gRGVjQ29pbi5mcm9tSlNPTihlMykpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gZTIucmV3YXJkcyA/IG8yLnJld2FyZHMgPSBlMi5yZXdhcmRzLm1hcCgoZTMpID0+IGUzID8gRGVjQ29pbi50b0pTT04oZTMpIDogdm9pZCAwKSA6IG8yLnJld2FyZHMgPSBbXSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgcmV3YXJkczogW10gfTtcbiAgcmV0dXJuIG8yLnJld2FyZHMgPSBlMi5yZXdhcmRzPy5tYXAoKGUzKSA9PiBEZWNDb2luLmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1JlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHMzID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgdDUgPSB2b2lkIDAgPT09IG8yID8gczMubGVuIDogczMucG9zICsgbzI7XG4gIGNvbnN0IHI1ID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiIH07XG4gIGZvciAoOyBzMy5wb3MgPCB0NTsgKSB7XG4gICAgY29uc3QgZTMgPSBzMy51aW50MzIoKTtcbiAgICBpZiAoZTMgPj4+IDMgPT0gMSkgcjUuZGVsZWdhdG9yQWRkcmVzcyA9IHMzLnN0cmluZygpO1xuICAgIGVsc2UgczMuc2tpcFR5cGUoNyAmIGUzKTtcbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIChvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIgfTtcbiAgcmV0dXJuIG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzID8/IFwiXCIsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1JlcXVlc3QuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1JlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1Jlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVzcG9uc2VcIiwgZW5jb2RlKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IHMzIG9mIGUyLnJld2FyZHMpIERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQuZW5jb2RlKHMzLCBvMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIGZvciAoY29uc3QgczMgb2YgZTIudG90YWwpIERlY0NvaW4uZW5jb2RlKHMzLCBvMi51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiBvMjtcbn0sIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgczMgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCB0NSA9IHZvaWQgMCA9PT0gbzIgPyBzMy5sZW4gOiBzMy5wb3MgKyBvMjtcbiAgY29uc3QgcjUgPSB7IHJld2FyZHM6IFtdLCB0b3RhbDogW10gfTtcbiAgZm9yICg7IHMzLnBvcyA8IHQ1OyApIHtcbiAgICBjb25zdCBlMyA9IHMzLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjUucmV3YXJkcy5wdXNoKERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQuZGVjb2RlKHMzLCBzMy51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUudG90YWwucHVzaChEZWNDb2luLmRlY29kZShzMywgczMudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBzMy5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyByZXdhcmRzOiBBcnJheS5pc0FycmF5KGUyPy5yZXdhcmRzKSA/IGUyLnJld2FyZHMubWFwKChlMykgPT4gRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZC5mcm9tSlNPTihlMykpIDogW10sIHRvdGFsOiBBcnJheS5pc0FycmF5KGUyPy50b3RhbCkgPyBlMi50b3RhbC5tYXAoKGUzKSA9PiBEZWNDb2luLmZyb21KU09OKGUzKSkgOiBbXSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiBlMi5yZXdhcmRzID8gbzIucmV3YXJkcyA9IGUyLnJld2FyZHMubWFwKChlMykgPT4gZTMgPyBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLnRvSlNPTihlMykgOiB2b2lkIDApIDogbzIucmV3YXJkcyA9IFtdLCBlMi50b3RhbCA/IG8yLnRvdGFsID0gZTIudG90YWwubWFwKChlMykgPT4gZTMgPyBEZWNDb2luLnRvSlNPTihlMykgOiB2b2lkIDApIDogbzIudG90YWwgPSBbXSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgcmV3YXJkczogW10sIHRvdGFsOiBbXSB9O1xuICByZXR1cm4gbzIucmV3YXJkcyA9IGUyLnJld2FyZHM/Lm1hcCgoZTMpID0+IERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQuZnJvbVBhcnRpYWwoZTMpKSB8fCBbXSwgbzIudG90YWwgPSBlMi50b3RhbD8ubWFwKChlMykgPT4gRGVjQ29pbi5mcm9tUGFydGlhbChlMykpIHx8IFtdLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1Jlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1Jlc3BvbnNlXCIsIHZhbHVlOiBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmQgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5Nc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFwiLCBlbmNvZGU6IChvMiwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5kZWxlZ2F0b3JBZGRyZXNzICYmIGUyLnVpbnQzMigxMCkuc3RyaW5nKG8yLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBvMi52YWxpZGF0b3JBZGRyZXNzICYmIGUyLnVpbnQzMigxOCkuc3RyaW5nKG8yLnZhbGlkYXRvckFkZHJlc3MpLCBlMiksIGRlY29kZShvMiwgczMpIHtcbiAgY29uc3QgdDUgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCByNSA9IHZvaWQgMCA9PT0gczMgPyB0NS5sZW4gOiB0NS5wb3MgKyBzMztcbiAgY29uc3QgZCA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiB9O1xuICBmb3IgKDsgdDUucG9zIDwgcjU7ICkge1xuICAgIGNvbnN0IG8zID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBkLmRlbGVnYXRvckFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGQudmFsaWRhdG9yQWRkcmVzcyA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHQ1LnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBkO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQobzIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcobzIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldChvMi52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyhvMi52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZWxlZ2F0b3JBZGRyZXNzICYmIChlMi5kZWxlZ2F0b3JBZGRyZXNzID0gbzIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gbzIudmFsaWRhdG9yQWRkcmVzcyAmJiAoZTIudmFsaWRhdG9yQWRkcmVzcyA9IG8yLnZhbGlkYXRvckFkZHJlc3MpLCBlMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IGUyID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiIH07XG4gIHJldHVybiBlMi5kZWxlZ2F0b3JBZGRyZXNzID0gbzIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBlMi52YWxpZGF0b3JBZGRyZXNzID0gbzIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLk1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkXCIsIHZhbHVlOiBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLk1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2VcIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IHMzIG9mIGUyLmFtb3VudCkgQ29pbi5lbmNvZGUoczMsIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHQ1O1xufSwgZGVjb2RlKHMzLCB0NSkge1xuICBjb25zdCByNSA9IHMzIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gczMgOiBuZXcgQmluYXJ5UmVhZGVyKHMzKTtcbiAgbGV0IGQgPSB2b2lkIDAgPT09IHQ1ID8gcjUubGVuIDogcjUucG9zICsgdDU7XG4gIGNvbnN0IGEyID0geyBhbW91bnQ6IFtdIH07XG4gIGZvciAoOyByNS5wb3MgPCBkOyApIHtcbiAgICBjb25zdCBlMiA9IHI1LnVpbnQzMigpO1xuICAgIGlmIChlMiA+Pj4gMyA9PSAxKSBhMi5hbW91bnQucHVzaChDb2luLmRlY29kZShyNSwgcjUudWludDMyKCkpKTtcbiAgICBlbHNlIHI1LnNraXBUeXBlKDcgJiBlMik7XG4gIH1cbiAgcmV0dXJuIGEyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgYW1vdW50OiBBcnJheS5pc0FycmF5KGUyPy5hbW91bnQpID8gZTIuYW1vdW50Lm1hcCgoZTMpID0+IENvaW4uZnJvbUpTT04oZTMpKSA6IFtdIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgczMgPSB7fTtcbiAgcmV0dXJuIGUyLmFtb3VudCA/IHMzLmFtb3VudCA9IGUyLmFtb3VudC5tYXAoKGUzKSA9PiBlMyA/IENvaW4udG9KU09OKGUzKSA6IHZvaWQgMCkgOiBzMy5hbW91bnQgPSBbXSwgczM7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBzMyA9IHsgYW1vdW50OiBbXSB9O1xuICByZXR1cm4gczMuYW1vdW50ID0gZTIuYW1vdW50Py5tYXAoKGUzKSA9PiBDb2luLmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHMzO1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2UuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLk1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2VcIiwgdmFsdWU6IE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIEJvbmRTdGF0dXM7XG4hZnVuY3Rpb24oZTIpIHtcbiAgZTJbZTIuQk9ORF9TVEFUVVNfVU5TUEVDSUZJRUQgPSAwXSA9IFwiQk9ORF9TVEFUVVNfVU5TUEVDSUZJRURcIiwgZTJbZTIuQk9ORF9TVEFUVVNfVU5CT05ERUQgPSAxXSA9IFwiQk9ORF9TVEFUVVNfVU5CT05ERURcIiwgZTJbZTIuQk9ORF9TVEFUVVNfVU5CT05ESU5HID0gMl0gPSBcIkJPTkRfU1RBVFVTX1VOQk9ORElOR1wiLCBlMltlMi5CT05EX1NUQVRVU19CT05ERUQgPSAzXSA9IFwiQk9ORF9TVEFUVVNfQk9OREVEXCIsIGUyW2UyLlVOUkVDT0dOSVpFRCA9IC0xXSA9IFwiVU5SRUNPR05JWkVEXCI7XG59KEJvbmRTdGF0dXMgfHwgKEJvbmRTdGF0dXMgPSB7fSkpO1xudmFyIERlbGVnYXRpb24gPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuRGVsZWdhdGlvblwiLCBlbmNvZGU6IChlMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi5zaGFyZXMgJiYgdDUudWludDMyKDI2KS5zdHJpbmcoRGVjaW1hbC5mcm9tVXNlcklucHV0KGUyLnNoYXJlcywgMTgpLmF0b21pY3MpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbzIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gdDUgPyBvMi5sZW4gOiBvMi5wb3MgKyB0NTtcbiAgY29uc3QgbjIgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIHNoYXJlczogXCJcIiB9O1xuICBmb3IgKDsgbzIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBuMi5kZWxlZ2F0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBuMi52YWxpZGF0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBuMi5zaGFyZXMgPSBEZWNpbWFsLmZyb21BdG9taWNzKG8yLnN0cmluZygpLCAxOCkudG9TdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbjI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpIDogXCJcIiwgc2hhcmVzOiBpc1NldChlMi5zaGFyZXMpID8gU3RyaW5nKGUyLnNoYXJlcykgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiAodDUuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgKHQ1LnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5zaGFyZXMgJiYgKHQ1LnNoYXJlcyA9IGUyLnNoYXJlcyksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIHNoYXJlczogXCJcIiB9O1xuICByZXR1cm4gdDUuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUuc2hhcmVzID0gZTIuc2hhcmVzID8/IFwiXCIsIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IERlbGVnYXRpb24uZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBEZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5EZWxlZ2F0aW9uXCIsIHZhbHVlOiBEZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBVbmJvbmRpbmdEZWxlZ2F0aW9uID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlVuYm9uZGluZ0RlbGVnYXRpb25cIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpO1xuICBmb3IgKGNvbnN0IG8yIG9mIGUyLmVudHJpZXMpIFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5lbmNvZGUobzIsIHQ1LnVpbnQzMigyNikuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHQ1O1xufSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBvMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSB0NSA/IG8yLmxlbiA6IG8yLnBvcyArIHQ1O1xuICBjb25zdCBuMiA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgZW50cmllczogW10gfTtcbiAgZm9yICg7IG8yLnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCBlMyA9IG8yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgbjIuZGVsZWdhdG9yQWRkcmVzcyA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgbjIudmFsaWRhdG9yQWRkcmVzcyA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgbjIuZW50cmllcy5wdXNoKFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5kZWNvZGUobzIsIG8yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG4yO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIsIGVudHJpZXM6IEFycmF5LmlzQXJyYXkoZTI/LmVudHJpZXMpID8gZTIuZW50cmllcy5tYXAoKGUzKSA9PiBVbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnkuZnJvbUpTT04oZTMpKSA6IFtdIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiAodDUuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgKHQ1LnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzKSwgZTIuZW50cmllcyA/IHQ1LmVudHJpZXMgPSBlMi5lbnRyaWVzLm1hcCgoZTMpID0+IGUzID8gVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUuZW50cmllcyA9IFtdLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiLCBlbnRyaWVzOiBbXSB9O1xuICByZXR1cm4gdDUuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MgPz8gXCJcIiwgdDUuZW50cmllcyA9IGUyLmVudHJpZXM/Lm1hcCgoZTMpID0+IFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5mcm9tUGFydGlhbChlMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gVW5ib25kaW5nRGVsZWdhdGlvbi5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuVW5ib25kaW5nRGVsZWdhdGlvblwiLCB2YWx1ZTogVW5ib25kaW5nRGVsZWdhdGlvbi5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBwMigpIHtcbiAgcmV0dXJuIHsgY3JlYXRpb25IZWlnaHQ6IEJpZ0ludCgwKSwgY29tcGxldGlvblRpbWU6IFRpbWVzdGFtcC5mcm9tUGFydGlhbCh7fSksIGluaXRpYWxCYWxhbmNlOiBcIlwiLCBiYWxhbmNlOiBcIlwiIH07XG59XG52YXIgVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChlMi5jcmVhdGlvbkhlaWdodCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMig4KS5pbnQ2NChlMi5jcmVhdGlvbkhlaWdodCksIHZvaWQgMCAhPT0gZTIuY29tcGxldGlvblRpbWUgJiYgVGltZXN0YW1wLmVuY29kZShlMi5jb21wbGV0aW9uVGltZSwgbzIudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCBcIlwiICE9PSBlMi5pbml0aWFsQmFsYW5jZSAmJiBvMi51aW50MzIoMjYpLnN0cmluZyhlMi5pbml0aWFsQmFsYW5jZSksIFwiXCIgIT09IGUyLmJhbGFuY2UgJiYgbzIudWludDMyKDM0KS5zdHJpbmcoZTIuYmFsYW5jZSksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBpMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSBvMiA/IGkyLmxlbiA6IGkyLnBvcyArIG8yO1xuICBjb25zdCByNSA9IHAyKCk7XG4gIGZvciAoOyBpMi5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTMgPSBpMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LmNyZWF0aW9uSGVpZ2h0ID0gaTIuaW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LmNvbXBsZXRpb25UaW1lID0gVGltZXN0YW1wLmRlY29kZShpMiwgaTIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgcjUuaW5pdGlhbEJhbGFuY2UgPSBpMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIHI1LmJhbGFuY2UgPSBpMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBpMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBjcmVhdGlvbkhlaWdodDogaXNTZXQoZTIuY3JlYXRpb25IZWlnaHQpID8gQmlnSW50KGUyLmNyZWF0aW9uSGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBjb21wbGV0aW9uVGltZTogaXNTZXQoZTIuY29tcGxldGlvblRpbWUpID8gZnJvbUpzb25UaW1lc3RhbXAoZTIuY29tcGxldGlvblRpbWUpIDogdm9pZCAwLCBpbml0aWFsQmFsYW5jZTogaXNTZXQoZTIuaW5pdGlhbEJhbGFuY2UpID8gU3RyaW5nKGUyLmluaXRpYWxCYWxhbmNlKSA6IFwiXCIsIGJhbGFuY2U6IGlzU2V0KGUyLmJhbGFuY2UpID8gU3RyaW5nKGUyLmJhbGFuY2UpIDogXCJcIiB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmNyZWF0aW9uSGVpZ2h0ICYmICh0NS5jcmVhdGlvbkhlaWdodCA9IChlMi5jcmVhdGlvbkhlaWdodCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmICh0NS5jb21wbGV0aW9uVGltZSA9IGZyb21UaW1lc3RhbXAoZTIuY29tcGxldGlvblRpbWUpLnRvSVNPU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLmluaXRpYWxCYWxhbmNlICYmICh0NS5pbml0aWFsQmFsYW5jZSA9IGUyLmluaXRpYWxCYWxhbmNlKSwgdm9pZCAwICE9PSBlMi5iYWxhbmNlICYmICh0NS5iYWxhbmNlID0gZTIuYmFsYW5jZSksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSBwMigpO1xuICByZXR1cm4gbzIuY3JlYXRpb25IZWlnaHQgPSB2b2lkIDAgIT09IGUyLmNyZWF0aW9uSGVpZ2h0ICYmIG51bGwgIT09IGUyLmNyZWF0aW9uSGVpZ2h0ID8gQmlnSW50KGUyLmNyZWF0aW9uSGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBvMi5jb21wbGV0aW9uVGltZSA9IHZvaWQgMCAhPT0gZTIuY29tcGxldGlvblRpbWUgJiYgbnVsbCAhPT0gZTIuY29tcGxldGlvblRpbWUgPyBUaW1lc3RhbXAuZnJvbVBhcnRpYWwoZTIuY29tcGxldGlvblRpbWUpIDogdm9pZCAwLCBvMi5pbml0aWFsQmFsYW5jZSA9IGUyLmluaXRpYWxCYWxhbmNlID8/IFwiXCIsIG8yLmJhbGFuY2UgPSBlMi5iYWxhbmNlID8/IFwiXCIsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5XCIsIHZhbHVlOiBVbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gdigpIHtcbiAgcmV0dXJuIHsgY3JlYXRpb25IZWlnaHQ6IEJpZ0ludCgwKSwgY29tcGxldGlvblRpbWU6IFRpbWVzdGFtcC5mcm9tUGFydGlhbCh7fSksIGluaXRpYWxCYWxhbmNlOiBcIlwiLCBzaGFyZXNEc3Q6IFwiXCIgfTtcbn1cbnZhciBSZWRlbGVnYXRpb25FbnRyeSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25FbnRyeVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChlMi5jcmVhdGlvbkhlaWdodCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMig4KS5pbnQ2NChlMi5jcmVhdGlvbkhlaWdodCksIHZvaWQgMCAhPT0gZTIuY29tcGxldGlvblRpbWUgJiYgVGltZXN0YW1wLmVuY29kZShlMi5jb21wbGV0aW9uVGltZSwgbzIudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCBcIlwiICE9PSBlMi5pbml0aWFsQmFsYW5jZSAmJiBvMi51aW50MzIoMjYpLnN0cmluZyhlMi5pbml0aWFsQmFsYW5jZSksIFwiXCIgIT09IGUyLnNoYXJlc0RzdCAmJiBvMi51aW50MzIoMzQpLnN0cmluZyhEZWNpbWFsLmZyb21Vc2VySW5wdXQoZTIuc2hhcmVzRHN0LCAxOCkuYXRvbWljcyksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBpMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSBvMiA/IGkyLmxlbiA6IGkyLnBvcyArIG8yO1xuICBjb25zdCByNSA9IHYoKTtcbiAgZm9yICg7IGkyLnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBlMyA9IGkyLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjUuY3JlYXRpb25IZWlnaHQgPSBpMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUuY29tcGxldGlvblRpbWUgPSBUaW1lc3RhbXAuZGVjb2RlKGkyLCBpMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICByNS5pbml0aWFsQmFsYW5jZSA9IGkyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgcjUuc2hhcmVzRHN0ID0gRGVjaW1hbC5mcm9tQXRvbWljcyhpMi5zdHJpbmcoKSwgMTgpLnRvU3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgaTIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgY3JlYXRpb25IZWlnaHQ6IGlzU2V0KGUyLmNyZWF0aW9uSGVpZ2h0KSA/IEJpZ0ludChlMi5jcmVhdGlvbkhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgY29tcGxldGlvblRpbWU6IGlzU2V0KGUyLmNvbXBsZXRpb25UaW1lKSA/IGZyb21Kc29uVGltZXN0YW1wKGUyLmNvbXBsZXRpb25UaW1lKSA6IHZvaWQgMCwgaW5pdGlhbEJhbGFuY2U6IGlzU2V0KGUyLmluaXRpYWxCYWxhbmNlKSA/IFN0cmluZyhlMi5pbml0aWFsQmFsYW5jZSkgOiBcIlwiLCBzaGFyZXNEc3Q6IGlzU2V0KGUyLnNoYXJlc0RzdCkgPyBTdHJpbmcoZTIuc2hhcmVzRHN0KSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5jcmVhdGlvbkhlaWdodCAmJiAodDUuY3JlYXRpb25IZWlnaHQgPSAoZTIuY3JlYXRpb25IZWlnaHQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiAodDUuY29tcGxldGlvblRpbWUgPSBmcm9tVGltZXN0YW1wKGUyLmNvbXBsZXRpb25UaW1lKS50b0lTT1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi5pbml0aWFsQmFsYW5jZSAmJiAodDUuaW5pdGlhbEJhbGFuY2UgPSBlMi5pbml0aWFsQmFsYW5jZSksIHZvaWQgMCAhPT0gZTIuc2hhcmVzRHN0ICYmICh0NS5zaGFyZXNEc3QgPSBlMi5zaGFyZXNEc3QpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0gdigpO1xuICByZXR1cm4gbzIuY3JlYXRpb25IZWlnaHQgPSB2b2lkIDAgIT09IGUyLmNyZWF0aW9uSGVpZ2h0ICYmIG51bGwgIT09IGUyLmNyZWF0aW9uSGVpZ2h0ID8gQmlnSW50KGUyLmNyZWF0aW9uSGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBvMi5jb21wbGV0aW9uVGltZSA9IHZvaWQgMCAhPT0gZTIuY29tcGxldGlvblRpbWUgJiYgbnVsbCAhPT0gZTIuY29tcGxldGlvblRpbWUgPyBUaW1lc3RhbXAuZnJvbVBhcnRpYWwoZTIuY29tcGxldGlvblRpbWUpIDogdm9pZCAwLCBvMi5pbml0aWFsQmFsYW5jZSA9IGUyLmluaXRpYWxCYWxhbmNlID8/IFwiXCIsIG8yLnNoYXJlc0RzdCA9IGUyLnNoYXJlc0RzdCA/PyBcIlwiLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBSZWRlbGVnYXRpb25FbnRyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlZGVsZWdhdGlvbkVudHJ5LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25FbnRyeVwiLCB2YWx1ZTogUmVkZWxlZ2F0aW9uRW50cnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFJlZGVsZWdhdGlvbiA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25cIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIHQ1LnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzICYmIHQ1LnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzICYmIHQ1LnVpbnQzMigyNikuc3RyaW5nKGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpO1xuICBmb3IgKGNvbnN0IG8yIG9mIGUyLmVudHJpZXMpIFJlZGVsZWdhdGlvbkVudHJ5LmVuY29kZShvMiwgdDUudWludDMyKDM0KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdDU7XG59LCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IG4yID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JTcmNBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JEc3RBZGRyZXNzOiBcIlwiLCBlbnRyaWVzOiBbXSB9O1xuICBmb3IgKDsgbzIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBuMi5kZWxlZ2F0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBuMi52YWxpZGF0b3JTcmNBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBuMi52YWxpZGF0b3JEc3RBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBuMi5lbnRyaWVzLnB1c2goUmVkZWxlZ2F0aW9uRW50cnkuZGVjb2RlKG8yLCBvMi51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBuMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yU3JjQWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yU3JjQWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yU3JjQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JEc3RBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSA6IFwiXCIsIGVudHJpZXM6IEFycmF5LmlzQXJyYXkoZTI/LmVudHJpZXMpID8gZTIuZW50cmllcy5tYXAoKGUzKSA9PiBSZWRlbGVnYXRpb25FbnRyeS5mcm9tSlNPTihlMykpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmICh0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyAmJiAodDUudmFsaWRhdG9yU3JjQWRkcmVzcyA9IGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MgJiYgKHQ1LnZhbGlkYXRvckRzdEFkZHJlc3MgPSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSwgZTIuZW50cmllcyA/IHQ1LmVudHJpZXMgPSBlMi5lbnRyaWVzLm1hcCgoZTMpID0+IGUzID8gUmVkZWxlZ2F0aW9uRW50cnkudG9KU09OKGUzKSA6IHZvaWQgMCkgOiB0NS5lbnRyaWVzID0gW10sIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvclNyY0FkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckRzdEFkZHJlc3M6IFwiXCIsIGVudHJpZXM6IFtdIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCB0NS52YWxpZGF0b3JTcmNBZGRyZXNzID0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyA/PyBcIlwiLCB0NS52YWxpZGF0b3JEc3RBZGRyZXNzID0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyA/PyBcIlwiLCB0NS5lbnRyaWVzID0gZTIuZW50cmllcz8ubWFwKChlMykgPT4gUmVkZWxlZ2F0aW9uRW50cnkuZnJvbVBhcnRpYWwoZTMpKSB8fCBbXSwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUmVkZWxlZ2F0aW9uLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUmVkZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25cIiwgdmFsdWU6IFJlZGVsZWdhdGlvbi5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBiMigpIHtcbiAgcmV0dXJuIHsgZGVsZWdhdGlvbjogRGVsZWdhdGlvbi5mcm9tUGFydGlhbCh7fSksIGJhbGFuY2U6IENvaW4uZnJvbVBhcnRpYWwoe30pIH07XG59XG52YXIgRGVsZWdhdGlvblJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLkRlbGVnYXRpb25SZXNwb25zZVwiLCBlbmNvZGU6IChlMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICh2b2lkIDAgIT09IGUyLmRlbGVnYXRpb24gJiYgRGVsZWdhdGlvbi5lbmNvZGUoZTIuZGVsZWdhdGlvbiwgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpLCB2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgQ29pbi5lbmNvZGUoZTIuYmFsYW5jZSwgdDUudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbzIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gdDUgPyBvMi5sZW4gOiBvMi5wb3MgKyB0NTtcbiAgY29uc3QgcjUgPSBiMigpO1xuICBmb3IgKDsgbzIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5kZWxlZ2F0aW9uID0gRGVsZWdhdGlvbi5kZWNvZGUobzIsIG8yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LmJhbGFuY2UgPSBDb2luLmRlY29kZShvMiwgbzIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRpb246IGlzU2V0KGUyLmRlbGVnYXRpb24pID8gRGVsZWdhdGlvbi5mcm9tSlNPTihlMi5kZWxlZ2F0aW9uKSA6IHZvaWQgMCwgYmFsYW5jZTogaXNTZXQoZTIuYmFsYW5jZSkgPyBDb2luLmZyb21KU09OKGUyLmJhbGFuY2UpIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdGlvbiAmJiAodDUuZGVsZWdhdGlvbiA9IGUyLmRlbGVnYXRpb24gPyBEZWxlZ2F0aW9uLnRvSlNPTihlMi5kZWxlZ2F0aW9uKSA6IHZvaWQgMCksIHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiAodDUuYmFsYW5jZSA9IGUyLmJhbGFuY2UgPyBDb2luLnRvSlNPTihlMi5iYWxhbmNlKSA6IHZvaWQgMCksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSBiMigpO1xuICByZXR1cm4gdDUuZGVsZWdhdGlvbiA9IHZvaWQgMCAhPT0gZTIuZGVsZWdhdGlvbiAmJiBudWxsICE9PSBlMi5kZWxlZ2F0aW9uID8gRGVsZWdhdGlvbi5mcm9tUGFydGlhbChlMi5kZWxlZ2F0aW9uKSA6IHZvaWQgMCwgdDUuYmFsYW5jZSA9IHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiBudWxsICE9PSBlMi5iYWxhbmNlID8gQ29pbi5mcm9tUGFydGlhbChlMi5iYWxhbmNlKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gRGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gRGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5EZWxlZ2F0aW9uUmVzcG9uc2VcIiwgdmFsdWU6IERlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBTKCkge1xuICByZXR1cm4geyByZWRlbGVnYXRpb25FbnRyeTogUmVkZWxlZ2F0aW9uRW50cnkuZnJvbVBhcnRpYWwoe30pLCBiYWxhbmNlOiBcIlwiIH07XG59XG52YXIgUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlXCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHZvaWQgMCAhPT0gZTIucmVkZWxlZ2F0aW9uRW50cnkgJiYgUmVkZWxlZ2F0aW9uRW50cnkuZW5jb2RlKGUyLnJlZGVsZWdhdGlvbkVudHJ5LCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIFwiXCIgIT09IGUyLmJhbGFuY2UgJiYgdDUudWludDMyKDM0KS5zdHJpbmcoZTIuYmFsYW5jZSksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBvMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSB0NSA/IG8yLmxlbiA6IG8yLnBvcyArIHQ1O1xuICBjb25zdCBuMiA9IFMoKTtcbiAgZm9yICg7IG8yLnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCBlMyA9IG8yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgbjIucmVkZWxlZ2F0aW9uRW50cnkgPSBSZWRlbGVnYXRpb25FbnRyeS5kZWNvZGUobzIsIG8yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIG4yLmJhbGFuY2UgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbjI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyByZWRlbGVnYXRpb25FbnRyeTogaXNTZXQoZTIucmVkZWxlZ2F0aW9uRW50cnkpID8gUmVkZWxlZ2F0aW9uRW50cnkuZnJvbUpTT04oZTIucmVkZWxlZ2F0aW9uRW50cnkpIDogdm9pZCAwLCBiYWxhbmNlOiBpc1NldChlMi5iYWxhbmNlKSA/IFN0cmluZyhlMi5iYWxhbmNlKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb25FbnRyeSAmJiAodDUucmVkZWxlZ2F0aW9uRW50cnkgPSBlMi5yZWRlbGVnYXRpb25FbnRyeSA/IFJlZGVsZWdhdGlvbkVudHJ5LnRvSlNPTihlMi5yZWRlbGVnYXRpb25FbnRyeSkgOiB2b2lkIDApLCB2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgKHQ1LmJhbGFuY2UgPSBlMi5iYWxhbmNlKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IFMoKTtcbiAgcmV0dXJuIHQ1LnJlZGVsZWdhdGlvbkVudHJ5ID0gdm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb25FbnRyeSAmJiBudWxsICE9PSBlMi5yZWRlbGVnYXRpb25FbnRyeSA/IFJlZGVsZWdhdGlvbkVudHJ5LmZyb21QYXJ0aWFsKGUyLnJlZGVsZWdhdGlvbkVudHJ5KSA6IHZvaWQgMCwgdDUuYmFsYW5jZSA9IGUyLmJhbGFuY2UgPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2VcIiwgdmFsdWU6IFJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gQSgpIHtcbiAgcmV0dXJuIHsgcmVkZWxlZ2F0aW9uOiBSZWRlbGVnYXRpb24uZnJvbVBhcnRpYWwoe30pLCBlbnRyaWVzOiBbXSB9O1xufVxudmFyIFJlZGVsZWdhdGlvblJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvblJlc3BvbnNlXCIsIGVuY29kZShlMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgdm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb24gJiYgUmVkZWxlZ2F0aW9uLmVuY29kZShlMi5yZWRlbGVnYXRpb24sIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgZm9yIChjb25zdCBvMiBvZiBlMi5lbnRyaWVzKSBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLmVuY29kZShvMiwgdDUudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdDU7XG59LCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IG4yID0gQSgpO1xuICBmb3IgKDsgbzIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBuMi5yZWRlbGVnYXRpb24gPSBSZWRlbGVnYXRpb24uZGVjb2RlKG8yLCBvMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBuMi5lbnRyaWVzLnB1c2goUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5kZWNvZGUobzIsIG8yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG4yO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgcmVkZWxlZ2F0aW9uOiBpc1NldChlMi5yZWRlbGVnYXRpb24pID8gUmVkZWxlZ2F0aW9uLmZyb21KU09OKGUyLnJlZGVsZWdhdGlvbikgOiB2b2lkIDAsIGVudHJpZXM6IEFycmF5LmlzQXJyYXkoZTI/LmVudHJpZXMpID8gZTIuZW50cmllcy5tYXAoKGUzKSA9PiBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLmZyb21KU09OKGUzKSkgOiBbXSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLnJlZGVsZWdhdGlvbiAmJiAodDUucmVkZWxlZ2F0aW9uID0gZTIucmVkZWxlZ2F0aW9uID8gUmVkZWxlZ2F0aW9uLnRvSlNPTihlMi5yZWRlbGVnYXRpb24pIDogdm9pZCAwKSwgZTIuZW50cmllcyA/IHQ1LmVudHJpZXMgPSBlMi5lbnRyaWVzLm1hcCgoZTMpID0+IGUzID8gUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS50b0pTT04oZTMpIDogdm9pZCAwKSA6IHQ1LmVudHJpZXMgPSBbXSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IEEoKTtcbiAgcmV0dXJuIHQ1LnJlZGVsZWdhdGlvbiA9IHZvaWQgMCAhPT0gZTIucmVkZWxlZ2F0aW9uICYmIG51bGwgIT09IGUyLnJlZGVsZWdhdGlvbiA/IFJlZGVsZWdhdGlvbi5mcm9tUGFydGlhbChlMi5yZWRlbGVnYXRpb24pIDogdm9pZCAwLCB0NS5lbnRyaWVzID0gZTIuZW50cmllcz8ubWFwKChlMykgPT4gUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5mcm9tUGFydGlhbChlMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBSZWRlbGVnYXRpb25SZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlZGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5SZWRlbGVnYXRpb25SZXNwb25zZVwiLCB2YWx1ZTogUmVkZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIFF1ZXJ5RGVsZWdhdGlvblJlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdFwiLCBlbmNvZGU6IChvMiwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5kZWxlZ2F0b3JBZGRyICYmIGUyLnVpbnQzMigxMCkuc3RyaW5nKG8yLmRlbGVnYXRvckFkZHIpLCBcIlwiICE9PSBvMi52YWxpZGF0b3JBZGRyICYmIGUyLnVpbnQzMigxOCkuc3RyaW5nKG8yLnZhbGlkYXRvckFkZHIpLCBlMiksIGRlY29kZShvMiwgZTIpIHtcbiAgY29uc3QgdDUgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gZTIgPyB0NS5sZW4gOiB0NS5wb3MgKyBlMjtcbiAgY29uc3QgYTIgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHZhbGlkYXRvckFkZHI6IFwiXCIgfTtcbiAgZm9yICg7IHQ1LnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBvMyA9IHQ1LnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgYTIuZGVsZWdhdG9yQWRkciA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgYTIudmFsaWRhdG9yQWRkciA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHQ1LnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGRlbGVnYXRvckFkZHI6IGlzU2V0KG8yLmRlbGVnYXRvckFkZHIpID8gU3RyaW5nKG8yLmRlbGVnYXRvckFkZHIpIDogXCJcIiwgdmFsaWRhdG9yQWRkcjogaXNTZXQobzIudmFsaWRhdG9yQWRkcikgPyBTdHJpbmcobzIudmFsaWRhdG9yQWRkcikgOiBcIlwiIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgZTIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZGVsZWdhdG9yQWRkciAmJiAoZTIuZGVsZWdhdG9yQWRkciA9IG8yLmRlbGVnYXRvckFkZHIpLCB2b2lkIDAgIT09IG8yLnZhbGlkYXRvckFkZHIgJiYgKGUyLnZhbGlkYXRvckFkZHIgPSBvMi52YWxpZGF0b3JBZGRyKSwgZTI7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCBlMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgdmFsaWRhdG9yQWRkcjogXCJcIiB9O1xuICByZXR1cm4gZTIuZGVsZWdhdG9yQWRkciA9IG8yLmRlbGVnYXRvckFkZHIgPz8gXCJcIiwgZTIudmFsaWRhdG9yQWRkciA9IG8yLnZhbGlkYXRvckFkZHIgPz8gXCJcIiwgZTI7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5RGVsZWdhdGlvblJlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdGlvblJlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlXCIsIGVuY29kZTogKG8yLCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHZvaWQgMCAhPT0gbzIuZGVsZWdhdGlvblJlc3BvbnNlICYmIERlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUobzIuZGVsZWdhdGlvblJlc3BvbnNlLCBlMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCB0NSA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSBlMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIGUyO1xuICBjb25zdCBpMiA9IHsgZGVsZWdhdGlvblJlc3BvbnNlOiB2b2lkIDAgfTtcbiAgZm9yICg7IHQ1LnBvcyA8IGEyOyApIHtcbiAgICBjb25zdCBvMyA9IHQ1LnVpbnQzMigpO1xuICAgIGlmIChvMyA+Pj4gMyA9PSAxKSBpMi5kZWxlZ2F0aW9uUmVzcG9uc2UgPSBEZWxlZ2F0aW9uUmVzcG9uc2UuZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgZWxzZSB0NS5za2lwVHlwZSg3ICYgbzMpO1xuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IGRlbGVnYXRpb25SZXNwb25zZTogaXNTZXQobzIuZGVsZWdhdGlvblJlc3BvbnNlKSA/IERlbGVnYXRpb25SZXNwb25zZS5mcm9tSlNPTihvMi5kZWxlZ2F0aW9uUmVzcG9uc2UpIDogdm9pZCAwIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgZTIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuZGVsZWdhdGlvblJlc3BvbnNlICYmIChlMi5kZWxlZ2F0aW9uUmVzcG9uc2UgPSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2UgPyBEZWxlZ2F0aW9uUmVzcG9uc2UudG9KU09OKG8yLmRlbGVnYXRpb25SZXNwb25zZSkgOiB2b2lkIDApLCBlMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IGUyID0geyBkZWxlZ2F0aW9uUmVzcG9uc2U6IHZvaWQgMCB9O1xuICByZXR1cm4gZTIuZGVsZWdhdGlvblJlc3BvbnNlID0gdm9pZCAwICE9PSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2UgJiYgbnVsbCAhPT0gbzIuZGVsZWdhdGlvblJlc3BvbnNlID8gRGVsZWdhdGlvblJlc3BvbnNlLmZyb21QYXJ0aWFsKG8yLmRlbGVnYXRpb25SZXNwb25zZSkgOiB2b2lkIDAsIGUyO1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IFF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlXCIsIHZhbHVlOiBRdWVyeURlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0XCIsIGVuY29kZTogKG8yLCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG8yLmRlbGVnYXRvckFkZHIgJiYgZTIudWludDMyKDEwKS5zdHJpbmcobzIuZGVsZWdhdG9yQWRkciksIFwiXCIgIT09IG8yLnZhbGlkYXRvckFkZHIgJiYgZTIudWludDMyKDE4KS5zdHJpbmcobzIudmFsaWRhdG9yQWRkciksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCB0NSA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSBlMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIGUyO1xuICBjb25zdCBhMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgdmFsaWRhdG9yQWRkcjogXCJcIiB9O1xuICBmb3IgKDsgdDUucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IG8zID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBhMi5kZWxlZ2F0b3JBZGRyID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBhMi52YWxpZGF0b3JBZGRyID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGEyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVsZWdhdG9yQWRkcjogaXNTZXQobzIuZGVsZWdhdG9yQWRkcikgPyBTdHJpbmcobzIuZGVsZWdhdG9yQWRkcikgOiBcIlwiLCB2YWxpZGF0b3JBZGRyOiBpc1NldChvMi52YWxpZGF0b3JBZGRyKSA/IFN0cmluZyhvMi52YWxpZGF0b3JBZGRyKSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZWxlZ2F0b3JBZGRyICYmIChlMi5kZWxlZ2F0b3JBZGRyID0gbzIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gbzIudmFsaWRhdG9yQWRkciAmJiAoZTIudmFsaWRhdG9yQWRkciA9IG8yLnZhbGlkYXRvckFkZHIpLCBlMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IGUyID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCB2YWxpZGF0b3JBZGRyOiBcIlwiIH07XG4gIHJldHVybiBlMi5kZWxlZ2F0b3JBZGRyID0gbzIuZGVsZWdhdG9yQWRkciA/PyBcIlwiLCBlMi52YWxpZGF0b3JBZGRyID0gbzIudmFsaWRhdG9yQWRkciA/PyBcIlwiLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0LmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBjKCkge1xuICByZXR1cm4geyB1bmJvbmQ6IFVuYm9uZGluZ0RlbGVnYXRpb24uZnJvbVBhcnRpYWwoe30pIH07XG59XG52YXIgUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVzcG9uc2VcIiwgZW5jb2RlOiAobzIsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodm9pZCAwICE9PSBvMi51bmJvbmQgJiYgVW5ib25kaW5nRGVsZWdhdGlvbi5lbmNvZGUobzIudW5ib25kLCBlMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCB0NSA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSBlMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIGUyO1xuICBjb25zdCBpMiA9IGMoKTtcbiAgZm9yICg7IHQ1LnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBvMyA9IHQ1LnVpbnQzMigpO1xuICAgIGlmIChvMyA+Pj4gMyA9PSAxKSBpMi51bmJvbmQgPSBVbmJvbmRpbmdEZWxlZ2F0aW9uLmRlY29kZSh0NSwgdDUudWludDMyKCkpO1xuICAgIGVsc2UgdDUuc2tpcFR5cGUoNyAmIG8zKTtcbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyB1bmJvbmQ6IGlzU2V0KG8yLnVuYm9uZCkgPyBVbmJvbmRpbmdEZWxlZ2F0aW9uLmZyb21KU09OKG8yLnVuYm9uZCkgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi51bmJvbmQgJiYgKGUyLnVuYm9uZCA9IG8yLnVuYm9uZCA/IFVuYm9uZGluZ0RlbGVnYXRpb24udG9KU09OKG8yLnVuYm9uZCkgOiB2b2lkIDApLCBlMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IGUyID0gYygpO1xuICByZXR1cm4gZTIudW5ib25kID0gdm9pZCAwICE9PSBvMi51bmJvbmQgJiYgbnVsbCAhPT0gbzIudW5ib25kID8gVW5ib25kaW5nRGVsZWdhdGlvbi5mcm9tUGFydGlhbChvMi51bmJvbmQpIDogdm9pZCAwLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZS5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHIgJiYgdDUudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiBQYWdlUmVxdWVzdC5lbmNvZGUoZTIucGFnaW5hdGlvbiwgdDUudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbjIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBhMiA9IHZvaWQgMCA9PT0gdDUgPyBuMi5sZW4gOiBuMi5wb3MgKyB0NTtcbiAgY29uc3QgaTIgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgbjIucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IGUzID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5kZWxlZ2F0b3JBZGRyID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMi5wYWdpbmF0aW9uID0gUGFnZVJlcXVlc3QuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcjogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcikgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcikgOiBcIlwiLCBwYWdpbmF0aW9uOiBpc1NldChlMi5wYWdpbmF0aW9uKSA/IFBhZ2VSZXF1ZXN0LmZyb21KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkciAmJiAodDUuZGVsZWdhdG9yQWRkciA9IGUyLmRlbGVnYXRvckFkZHIpLCB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgKHQ1LnBhZ2luYXRpb24gPSBlMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QudG9KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyID0gZTIuZGVsZWdhdG9yQWRkciA/PyBcIlwiLCB0NS5wYWdpbmF0aW9uID0gdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIG51bGwgIT09IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC5mcm9tUGFydGlhbChlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3QuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0LmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlXCIsIGVuY29kZShvMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBlMiBvZiBvMi5kZWxlZ2F0aW9uUmVzcG9uc2VzKSBEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKGUyLCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgUGFnZVJlc3BvbnNlLmVuY29kZShvMi5wYWdpbmF0aW9uLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1O1xufSwgZGVjb2RlKG8yLCB0NSkge1xuICBjb25zdCBhMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSB0NSA/IGEyLmxlbiA6IGEyLnBvcyArIHQ1O1xuICBjb25zdCByNSA9IHsgZGVsZWdhdGlvblJlc3BvbnNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgYTIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IG8zID0gYTIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5kZWxlZ2F0aW9uUmVzcG9uc2VzLnB1c2goRGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShhMiwgYTIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LnBhZ2luYXRpb24gPSBQYWdlUmVzcG9uc2UuZGVjb2RlKGEyLCBhMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYTIuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVsZWdhdGlvblJlc3BvbnNlczogQXJyYXkuaXNBcnJheShvMj8uZGVsZWdhdGlvblJlc3BvbnNlcykgPyBvMi5kZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcCgobzMpID0+IERlbGVnYXRpb25SZXNwb25zZS5mcm9tSlNPTihvMykpIDogW10sIHBhZ2luYXRpb246IGlzU2V0KG8yLnBhZ2luYXRpb24pID8gUGFnZVJlc3BvbnNlLmZyb21KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIG8yLmRlbGVnYXRpb25SZXNwb25zZXMgPyB0NS5kZWxlZ2F0aW9uUmVzcG9uc2VzID0gbzIuZGVsZWdhdGlvblJlc3BvbnNlcy5tYXAoKG8zKSA9PiBvMyA/IERlbGVnYXRpb25SZXNwb25zZS50b0pTT04obzMpIDogdm9pZCAwKSA6IHQ1LmRlbGVnYXRpb25SZXNwb25zZXMgPSBbXSwgdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmICh0NS5wYWdpbmF0aW9uID0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS50b0pTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0aW9uUmVzcG9uc2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0aW9uUmVzcG9uc2VzID0gbzIuZGVsZWdhdGlvblJlc3BvbnNlcz8ubWFwKChvMykgPT4gRGVsZWdhdGlvblJlc3BvbnNlLmZyb21QYXJ0aWFsKG8zKSkgfHwgW10sIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS5mcm9tUGFydGlhbChvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1JlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1JlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkciAmJiB0NS51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXF1ZXN0LmVuY29kZShlMi5wYWdpbmF0aW9uLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSB0NSA/IG4yLmxlbiA6IG4yLnBvcyArIHQ1O1xuICBjb25zdCBpMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyBuMi5wb3MgPCBhMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRlbGVnYXRvckFkZHIgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkyLnBhZ2luYXRpb24gPSBQYWdlUmVxdWVzdC5kZWNvZGUobjIsIG4yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSA6IFwiXCIsIHBhZ2luYXRpb246IGlzU2V0KGUyLnBhZ2luYXRpb24pID8gUGFnZVJlcXVlc3QuZnJvbUpTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyICYmICh0NS5kZWxlZ2F0b3JBZGRyID0gZTIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiAodDUucGFnaW5hdGlvbiA9IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC50b0pTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIHQ1LmRlbGVnYXRvckFkZHIgPSBlMi5kZWxlZ2F0b3JBZGRyID8/IFwiXCIsIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXF1ZXN0LmZyb21QYXJ0aWFsKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXF1ZXN0LmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2VcIiwgZW5jb2RlKG8yLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IGUyIG9mIG8yLnVuYm9uZGluZ1Jlc3BvbnNlcykgVW5ib25kaW5nRGVsZWdhdGlvbi5lbmNvZGUoZTIsIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBQYWdlUmVzcG9uc2UuZW5jb2RlKG8yLnBhZ2luYXRpb24sIHQ1LnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgdDU7XG59LCBkZWNvZGUobzIsIHQ1KSB7XG4gIGNvbnN0IG4yID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IHQ1ID8gbjIubGVuIDogbjIucG9zICsgdDU7XG4gIGNvbnN0IHI1ID0geyB1bmJvbmRpbmdSZXNwb25zZXM6IFtdLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgZm9yICg7IG4yLnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCBvMyA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAobzMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjUudW5ib25kaW5nUmVzcG9uc2VzLnB1c2goVW5ib25kaW5nRGVsZWdhdGlvbi5kZWNvZGUobjIsIG4yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNS5wYWdpbmF0aW9uID0gUGFnZVJlc3BvbnNlLmRlY29kZShuMiwgbjIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IHVuYm9uZGluZ1Jlc3BvbnNlczogQXJyYXkuaXNBcnJheShvMj8udW5ib25kaW5nUmVzcG9uc2VzKSA/IG8yLnVuYm9uZGluZ1Jlc3BvbnNlcy5tYXAoKG8zKSA9PiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmZyb21KU09OKG8zKSkgOiBbXSwgcGFnaW5hdGlvbjogaXNTZXQobzIucGFnaW5hdGlvbikgPyBQYWdlUmVzcG9uc2UuZnJvbUpTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gbzIudW5ib25kaW5nUmVzcG9uc2VzID8gdDUudW5ib25kaW5nUmVzcG9uc2VzID0gbzIudW5ib25kaW5nUmVzcG9uc2VzLm1hcCgobzMpID0+IG8zID8gVW5ib25kaW5nRGVsZWdhdGlvbi50b0pTT04obzMpIDogdm9pZCAwKSA6IHQ1LnVuYm9uZGluZ1Jlc3BvbnNlcyA9IFtdLCB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgKHQ1LnBhZ2luYXRpb24gPSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLnRvSlNPTihvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCksIHQ1O1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgdDUgPSB7IHVuYm9uZGluZ1Jlc3BvbnNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICByZXR1cm4gdDUudW5ib25kaW5nUmVzcG9uc2VzID0gbzIudW5ib25kaW5nUmVzcG9uc2VzPy5tYXAoKG8zKSA9PiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmZyb21QYXJ0aWFsKG8zKSkgfHwgW10sIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS5mcm9tUGFydGlhbChvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1Jlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVJlZGVsZWdhdGlvbnNSZXF1ZXN0XCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHIgJiYgdDUudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkciksIFwiXCIgIT09IGUyLnNyY1ZhbGlkYXRvckFkZHIgJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIuc3JjVmFsaWRhdG9yQWRkciksIFwiXCIgIT09IGUyLmRzdFZhbGlkYXRvckFkZHIgJiYgdDUudWludDMyKDI2KS5zdHJpbmcoZTIuZHN0VmFsaWRhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiBQYWdlUmVxdWVzdC5lbmNvZGUoZTIucGFnaW5hdGlvbiwgdDUudWludDMyKDM0KS5mb3JrKCkpLmxkZWxpbSgpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbjIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBhMiA9IHZvaWQgMCA9PT0gdDUgPyBuMi5sZW4gOiBuMi5wb3MgKyB0NTtcbiAgY29uc3QgaTIgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHNyY1ZhbGlkYXRvckFkZHI6IFwiXCIsIGRzdFZhbGlkYXRvckFkZHI6IFwiXCIsIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgbjIucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IGUzID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5kZWxlZ2F0b3JBZGRyID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMi5zcmNWYWxpZGF0b3JBZGRyID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBpMi5kc3RWYWxpZGF0b3JBZGRyID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBpMi5wYWdpbmF0aW9uID0gUGFnZVJlcXVlc3QuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcjogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcikgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcikgOiBcIlwiLCBzcmNWYWxpZGF0b3JBZGRyOiBpc1NldChlMi5zcmNWYWxpZGF0b3JBZGRyKSA/IFN0cmluZyhlMi5zcmNWYWxpZGF0b3JBZGRyKSA6IFwiXCIsIGRzdFZhbGlkYXRvckFkZHI6IGlzU2V0KGUyLmRzdFZhbGlkYXRvckFkZHIpID8gU3RyaW5nKGUyLmRzdFZhbGlkYXRvckFkZHIpIDogXCJcIiwgcGFnaW5hdGlvbjogaXNTZXQoZTIucGFnaW5hdGlvbikgPyBQYWdlUmVxdWVzdC5mcm9tSlNPTihlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHIgJiYgKHQ1LmRlbGVnYXRvckFkZHIgPSBlMi5kZWxlZ2F0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5zcmNWYWxpZGF0b3JBZGRyICYmICh0NS5zcmNWYWxpZGF0b3JBZGRyID0gZTIuc3JjVmFsaWRhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIuZHN0VmFsaWRhdG9yQWRkciAmJiAodDUuZHN0VmFsaWRhdG9yQWRkciA9IGUyLmRzdFZhbGlkYXRvckFkZHIpLCB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgKHQ1LnBhZ2luYXRpb24gPSBlMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QudG9KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgc3JjVmFsaWRhdG9yQWRkcjogXCJcIiwgZHN0VmFsaWRhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyID0gZTIuZGVsZWdhdG9yQWRkciA/PyBcIlwiLCB0NS5zcmNWYWxpZGF0b3JBZGRyID0gZTIuc3JjVmFsaWRhdG9yQWRkciA/PyBcIlwiLCB0NS5kc3RWYWxpZGF0b3JBZGRyID0gZTIuZHN0VmFsaWRhdG9yQWRkciA/PyBcIlwiLCB0NS5wYWdpbmF0aW9uID0gdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIG51bGwgIT09IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC5mcm9tUGFydGlhbChlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlXCIsIGVuY29kZShvMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBlMiBvZiBvMi5yZWRlbGVnYXRpb25SZXNwb25zZXMpIFJlZGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShlMiwgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXNwb25zZS5lbmNvZGUobzIucGFnaW5hdGlvbiwgdDUudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCB0NTtcbn0sIGRlY29kZShvMiwgdDUpIHtcbiAgY29uc3QgbjIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBhMiA9IHZvaWQgMCA9PT0gdDUgPyBuMi5sZW4gOiBuMi5wb3MgKyB0NTtcbiAgY29uc3QgcjUgPSB7IHJlZGVsZWdhdGlvblJlc3BvbnNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgbjIucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IG8zID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5yZWRlbGVnYXRpb25SZXNwb25zZXMucHVzaChSZWRlbGVnYXRpb25SZXNwb25zZS5kZWNvZGUobjIsIG4yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNS5wYWdpbmF0aW9uID0gUGFnZVJlc3BvbnNlLmRlY29kZShuMiwgbjIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBvMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IHJlZGVsZWdhdGlvblJlc3BvbnNlczogQXJyYXkuaXNBcnJheShvMj8ucmVkZWxlZ2F0aW9uUmVzcG9uc2VzKSA/IG8yLnJlZGVsZWdhdGlvblJlc3BvbnNlcy5tYXAoKG8zKSA9PiBSZWRlbGVnYXRpb25SZXNwb25zZS5mcm9tSlNPTihvMykpIDogW10sIHBhZ2luYXRpb246IGlzU2V0KG8yLnBhZ2luYXRpb24pID8gUGFnZVJlc3BvbnNlLmZyb21KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIG8yLnJlZGVsZWdhdGlvblJlc3BvbnNlcyA/IHQ1LnJlZGVsZWdhdGlvblJlc3BvbnNlcyA9IG8yLnJlZGVsZWdhdGlvblJlc3BvbnNlcy5tYXAoKG8zKSA9PiBvMyA/IFJlZGVsZWdhdGlvblJlc3BvbnNlLnRvSlNPTihvMykgOiB2b2lkIDApIDogdDUucmVkZWxlZ2F0aW9uUmVzcG9uc2VzID0gW10sIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiAodDUucGFnaW5hdGlvbiA9IG8yLnBhZ2luYXRpb24gPyBQYWdlUmVzcG9uc2UudG9KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiB0NS5yZWRlbGVnYXRpb25SZXNwb25zZXMgPSBvMi5yZWRlbGVnYXRpb25SZXNwb25zZXM/Lm1hcCgobzMpID0+IFJlZGVsZWdhdGlvblJlc3BvbnNlLmZyb21QYXJ0aWFsKG8zKSkgfHwgW10sIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS5mcm9tUGFydGlhbChvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2UuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeVJlZGVsZWdhdGlvbnNSZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbmZ1bmN0aW9uIHYyKCkge1xuICByZXR1cm4geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiLCBhbW91bnQ6IENvaW4uZnJvbVBhcnRpYWwoe30pIH07XG59XG52YXIgTXNnRGVsZWdhdGUgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnRGVsZWdhdGVcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgXCJcIiAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTgpLnN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgQ29pbi5lbmNvZGUoZTIuYW1vdW50LCBvMi51aW50MzIoMjYpLmZvcmsoKSkubGRlbGltKCksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCB0NSA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBvMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIG8yO1xuICBjb25zdCBkID0gdjIoKTtcbiAgZm9yICg7IHQ1LnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCBlMyA9IHQ1LnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgZC5kZWxlZ2F0b3JBZGRyZXNzID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBkLnZhbGlkYXRvckFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGQuYW1vdW50ID0gQ29pbi5kZWNvZGUodDUsIHQ1LnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZDtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcykgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KGUyLmFtb3VudCkgPyBDb2luLmZyb21KU09OKGUyLmFtb3VudCkgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIChvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiAobzIudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiAobzIuYW1vdW50ID0gZTIuYW1vdW50ID8gQ29pbi50b0pTT04oZTIuYW1vdW50KSA6IHZvaWQgMCksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB2MigpO1xuICByZXR1cm4gbzIuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgbzIudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MgPz8gXCJcIiwgbzIuYW1vdW50ID0gdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgbnVsbCAhPT0gZTIuYW1vdW50ID8gQ29pbi5mcm9tUGFydGlhbChlMi5hbW91bnQpIDogdm9pZCAwLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBNc2dEZWxlZ2F0ZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IE1zZ0RlbGVnYXRlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dEZWxlZ2F0ZVwiLCB2YWx1ZTogTXNnRGVsZWdhdGUuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gdSgpIHtcbiAgcmV0dXJuIHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yU3JjQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yRHN0QWRkcmVzczogXCJcIiwgYW1vdW50OiBDb2luLmZyb21QYXJ0aWFsKHt9KSB9O1xufVxudmFyIE1zZ0JlZ2luUmVkZWxlZ2F0ZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dCZWdpblJlZGVsZWdhdGVcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgXCJcIiAhPT0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyAmJiBvMi51aW50MzIoMTgpLnN0cmluZyhlMi52YWxpZGF0b3JTcmNBZGRyZXNzKSwgXCJcIiAhPT0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyAmJiBvMi51aW50MzIoMjYpLnN0cmluZyhlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgQ29pbi5lbmNvZGUoZTIuYW1vdW50LCBvMi51aW50MzIoMzQpLmZvcmsoKSkubGRlbGltKCksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCB0NSA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBvMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIG8yO1xuICBjb25zdCBkID0gdSgpO1xuICBmb3IgKDsgdDUucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUzID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBkLmRlbGVnYXRvckFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGQudmFsaWRhdG9yU3JjQWRkcmVzcyA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgZC52YWxpZGF0b3JEc3RBZGRyZXNzID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBkLmFtb3VudCA9IENvaW4uZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGQ7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvclNyY0FkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yRHN0QWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yRHN0QWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yRHN0QWRkcmVzcykgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KGUyLmFtb3VudCkgPyBDb2luLmZyb21KU09OKGUyLmFtb3VudCkgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIChvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyAmJiAobzIudmFsaWRhdG9yU3JjQWRkcmVzcyA9IGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MgJiYgKG8yLnZhbGlkYXRvckRzdEFkZHJlc3MgPSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgKG8yLmFtb3VudCA9IGUyLmFtb3VudCA/IENvaW4udG9KU09OKGUyLmFtb3VudCkgOiB2b2lkIDApLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0gdSgpO1xuICByZXR1cm4gbzIuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgbzIudmFsaWRhdG9yU3JjQWRkcmVzcyA9IGUyLnZhbGlkYXRvclNyY0FkZHJlc3MgPz8gXCJcIiwgbzIudmFsaWRhdG9yRHN0QWRkcmVzcyA9IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MgPz8gXCJcIiwgbzIuYW1vdW50ID0gdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgbnVsbCAhPT0gZTIuYW1vdW50ID8gQ29pbi5mcm9tUGFydGlhbChlMi5hbW91bnQpIDogdm9pZCAwLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBNc2dCZWdpblJlZGVsZWdhdGUuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBNc2dCZWdpblJlZGVsZWdhdGUuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ0JlZ2luUmVkZWxlZ2F0ZVwiLCB2YWx1ZTogTXNnQmVnaW5SZWRlbGVnYXRlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIGYoKSB7XG4gIHJldHVybiB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIGFtb3VudDogQ29pbi5mcm9tUGFydGlhbCh7fSkgfTtcbn1cbnZhciBNc2dVbmRlbGVnYXRlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ1VuZGVsZWdhdGVcIiwgZW5jb2RlOiAoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgXCJcIiAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiBvMi51aW50MzIoMTgpLnN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgQ29pbi5lbmNvZGUoZTIuYW1vdW50LCBvMi51aW50MzIoMjYpLmZvcmsoKSkubGRlbGltKCksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCB0NSA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBvMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIG8yO1xuICBjb25zdCBkID0gZigpO1xuICBmb3IgKDsgdDUucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUzID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBkLmRlbGVnYXRvckFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGQudmFsaWRhdG9yQWRkcmVzcyA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgZC5hbW91bnQgPSBDb2luLmRlY29kZSh0NSwgdDUudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHQ1LnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBkO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIsIGFtb3VudDogaXNTZXQoZTIuYW1vdW50KSA/IENvaW4uZnJvbUpTT04oZTIuYW1vdW50KSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIChvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIChvMi5hbW91bnQgPSBlMi5hbW91bnQgPyBDb2luLnRvSlNPTihlMi5hbW91bnQpIDogdm9pZCAwKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IGYoKTtcbiAgcmV0dXJuIG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzID8/IFwiXCIsIG8yLnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzID8/IFwiXCIsIG8yLmFtb3VudCA9IHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIG51bGwgIT09IGUyLmFtb3VudCA/IENvaW4uZnJvbVBhcnRpYWwoZTIuYW1vdW50KSA6IHZvaWQgMCwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gTXNnVW5kZWxlZ2F0ZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IE1zZ1VuZGVsZWdhdGUuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ1VuZGVsZWdhdGVcIiwgdmFsdWU6IE1zZ1VuZGVsZWdhdGUuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gQTIoKSB7XG4gIHJldHVybiB7IGNvbXBsZXRpb25UaW1lOiBUaW1lc3RhbXAuZnJvbVBhcnRpYWwoe30pIH07XG59XG52YXIgTXNnVW5kZWxlZ2F0ZVJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ1VuZGVsZWdhdGVSZXNwb25zZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICh2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmIFRpbWVzdGFtcC5lbmNvZGUoZTIuY29tcGxldGlvblRpbWUsIG8yLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgczMgPSB2b2lkIDAgPT09IG8yID8gdDUubGVuIDogdDUucG9zICsgbzI7XG4gIGNvbnN0IGQgPSBBMigpO1xuICBmb3IgKDsgdDUucG9zIDwgczM7ICkge1xuICAgIGNvbnN0IGUzID0gdDUudWludDMyKCk7XG4gICAgaWYgKGUzID4+PiAzID09IDEpIGQuY29tcGxldGlvblRpbWUgPSBUaW1lc3RhbXAuZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgZWxzZSB0NS5za2lwVHlwZSg3ICYgZTMpO1xuICB9XG4gIHJldHVybiBkO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgY29tcGxldGlvblRpbWU6IGlzU2V0KGUyLmNvbXBsZXRpb25UaW1lKSA/IGZyb21Kc29uVGltZXN0YW1wKGUyLmNvbXBsZXRpb25UaW1lKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmIChvMi5jb21wbGV0aW9uVGltZSA9IGZyb21UaW1lc3RhbXAoZTIuY29tcGxldGlvblRpbWUpLnRvSVNPU3RyaW5nKCkpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0gQTIoKTtcbiAgcmV0dXJuIG8yLmNvbXBsZXRpb25UaW1lID0gdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBudWxsICE9PSBlMi5jb21wbGV0aW9uVGltZSA/IFRpbWVzdGFtcC5mcm9tUGFydGlhbChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ1VuZGVsZWdhdGVSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IE1zZ1VuZGVsZWdhdGVSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnVW5kZWxlZ2F0ZVJlc3BvbnNlXCIsIHZhbHVlOiBNc2dVbmRlbGVnYXRlUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xuZnVuY3Rpb24gbDIoKSB7XG4gIHJldHVybiB7IHJldmlzaW9uTnVtYmVyOiBCaWdJbnQoMCksIHJldmlzaW9uSGVpZ2h0OiBCaWdJbnQoMCkgfTtcbn1cbnZhciBIZWlnaHQgPSB7IHR5cGVVcmw6IFwiL2liYy5jb3JlLmNsaWVudC52MS5IZWlnaHRcIiwgZW5jb2RlOiAodDUsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodDUucmV2aXNpb25OdW1iZXIgIT09IEJpZ0ludCgwKSAmJiBlMi51aW50MzIoOCkudWludDY0KHQ1LnJldmlzaW9uTnVtYmVyKSwgdDUucmV2aXNpb25IZWlnaHQgIT09IEJpZ0ludCgwKSAmJiBlMi51aW50MzIoMTYpLnVpbnQ2NCh0NS5yZXZpc2lvbkhlaWdodCksIGUyKSwgZGVjb2RlKHQ1LCBlMikge1xuICBjb25zdCBuMiA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IG8yID0gdm9pZCAwID09PSBlMiA/IG4yLmxlbiA6IG4yLnBvcyArIGUyO1xuICBjb25zdCBzMyA9IGwyKCk7XG4gIGZvciAoOyBuMi5wb3MgPCBvMjsgKSB7XG4gICAgY29uc3QgdDYgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKHQ2ID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHMzLnJldmlzaW9uTnVtYmVyID0gbjIudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBzMy5yZXZpc2lvbkhlaWdodCA9IG4yLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiB0Nik7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMztcbn0sIGZyb21KU09OOiAodDUpID0+ICh7IHJldmlzaW9uTnVtYmVyOiBpc1NldCh0NS5yZXZpc2lvbk51bWJlcikgPyBCaWdJbnQodDUucmV2aXNpb25OdW1iZXIudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIHJldmlzaW9uSGVpZ2h0OiBpc1NldCh0NS5yZXZpc2lvbkhlaWdodCkgPyBCaWdJbnQodDUucmV2aXNpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCkgfSksIHRvSlNPTih0NSkge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSB0NS5yZXZpc2lvbk51bWJlciAmJiAoZTIucmV2aXNpb25OdW1iZXIgPSAodDUucmV2aXNpb25OdW1iZXIgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSB0NS5yZXZpc2lvbkhlaWdodCAmJiAoZTIucmV2aXNpb25IZWlnaHQgPSAodDUucmV2aXNpb25IZWlnaHQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgZTI7XG59LCBmcm9tUGFydGlhbCh0NSkge1xuICBjb25zdCBlMiA9IGwyKCk7XG4gIHJldHVybiBlMi5yZXZpc2lvbk51bWJlciA9IHZvaWQgMCAhPT0gdDUucmV2aXNpb25OdW1iZXIgJiYgbnVsbCAhPT0gdDUucmV2aXNpb25OdW1iZXIgPyBCaWdJbnQodDUucmV2aXNpb25OdW1iZXIudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGUyLnJldmlzaW9uSGVpZ2h0ID0gdm9pZCAwICE9PSB0NS5yZXZpc2lvbkhlaWdodCAmJiBudWxsICE9PSB0NS5yZXZpc2lvbkhlaWdodCA/IEJpZ0ludCh0NS5yZXZpc2lvbkhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgZTI7XG59LCBmcm9tUHJvdG9Nc2c6ICh0NSkgPT4gSGVpZ2h0LmRlY29kZSh0NS52YWx1ZSksIHRvUHJvdG86ICh0NSkgPT4gSGVpZ2h0LmVuY29kZSh0NSkuZmluaXNoKCksIHRvUHJvdG9Nc2c6ICh0NSkgPT4gKHsgdHlwZVVybDogXCIvaWJjLmNvcmUuY2xpZW50LnYxLkhlaWdodFwiLCB2YWx1ZTogSGVpZ2h0LmVuY29kZSh0NSkuZmluaXNoKCkgfSkgfTtcblxuLy9cbmZ1bmN0aW9uIGkoKSB7XG4gIHJldHVybiB7IHNvdXJjZVBvcnQ6IFwiXCIsIHNvdXJjZUNoYW5uZWw6IFwiXCIsIHRva2VuOiBDb2luLmZyb21QYXJ0aWFsKHt9KSwgc2VuZGVyOiBcIlwiLCByZWNlaXZlcjogXCJcIiwgdGltZW91dEhlaWdodDogSGVpZ2h0LmZyb21QYXJ0aWFsKHt9KSwgdGltZW91dFRpbWVzdGFtcDogQmlnSW50KDApLCBtZW1vOiBcIlwiIH07XG59XG52YXIgTXNnVHJhbnNmZXIgPSB7IHR5cGVVcmw6IFwiL2liYy5hcHBsaWNhdGlvbnMudHJhbnNmZXIudjEuTXNnVHJhbnNmZXJcIiwgZW5jb2RlOiAobzIsIG4yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbzIuc291cmNlUG9ydCAmJiBuMi51aW50MzIoMTApLnN0cmluZyhvMi5zb3VyY2VQb3J0KSwgXCJcIiAhPT0gbzIuc291cmNlQ2hhbm5lbCAmJiBuMi51aW50MzIoMTgpLnN0cmluZyhvMi5zb3VyY2VDaGFubmVsKSwgdm9pZCAwICE9PSBvMi50b2tlbiAmJiBDb2luLmVuY29kZShvMi50b2tlbiwgbjIudWludDMyKDI2KS5mb3JrKCkpLmxkZWxpbSgpLCBcIlwiICE9PSBvMi5zZW5kZXIgJiYgbjIudWludDMyKDM0KS5zdHJpbmcobzIuc2VuZGVyKSwgXCJcIiAhPT0gbzIucmVjZWl2ZXIgJiYgbjIudWludDMyKDQyKS5zdHJpbmcobzIucmVjZWl2ZXIpLCB2b2lkIDAgIT09IG8yLnRpbWVvdXRIZWlnaHQgJiYgSGVpZ2h0LmVuY29kZShvMi50aW1lb3V0SGVpZ2h0LCBuMi51aW50MzIoNTApLmZvcmsoKSkubGRlbGltKCksIG8yLnRpbWVvdXRUaW1lc3RhbXAgIT09IEJpZ0ludCgwKSAmJiBuMi51aW50MzIoNTYpLnVpbnQ2NChvMi50aW1lb3V0VGltZXN0YW1wKSwgXCJcIiAhPT0gbzIubWVtbyAmJiBuMi51aW50MzIoNjYpLnN0cmluZyhvMi5tZW1vKSwgbjIpLCBkZWNvZGUocjUsIG4yKSB7XG4gIGNvbnN0IHMzID0gcjUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyByNSA6IG5ldyBCaW5hcnlSZWFkZXIocjUpO1xuICBsZXQgbTIgPSB2b2lkIDAgPT09IG4yID8gczMubGVuIDogczMucG9zICsgbjI7XG4gIGNvbnN0IGMyID0gaSgpO1xuICBmb3IgKDsgczMucG9zIDwgbTI7ICkge1xuICAgIGNvbnN0IG8yID0gczMudWludDMyKCk7XG4gICAgc3dpdGNoIChvMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBjMi5zb3VyY2VQb3J0ID0gczMuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBjMi5zb3VyY2VDaGFubmVsID0gczMuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBjMi50b2tlbiA9IENvaW4uZGVjb2RlKHMzLCBzMy51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICBjMi5zZW5kZXIgPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDU6XG4gICAgICAgIGMyLnJlY2VpdmVyID0gczMuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA2OlxuICAgICAgICBjMi50aW1lb3V0SGVpZ2h0ID0gSGVpZ2h0LmRlY29kZShzMywgczMudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNzpcbiAgICAgICAgYzIudGltZW91dFRpbWVzdGFtcCA9IHMzLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgODpcbiAgICAgICAgYzIubWVtbyA9IHMzLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHMzLnNraXBUeXBlKDcgJiBvMik7XG4gICAgfVxuICB9XG4gIHJldHVybiBjMjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IHNvdXJjZVBvcnQ6IGlzU2V0KG8yLnNvdXJjZVBvcnQpID8gU3RyaW5nKG8yLnNvdXJjZVBvcnQpIDogXCJcIiwgc291cmNlQ2hhbm5lbDogaXNTZXQobzIuc291cmNlQ2hhbm5lbCkgPyBTdHJpbmcobzIuc291cmNlQ2hhbm5lbCkgOiBcIlwiLCB0b2tlbjogaXNTZXQobzIudG9rZW4pID8gQ29pbi5mcm9tSlNPTihvMi50b2tlbikgOiB2b2lkIDAsIHNlbmRlcjogaXNTZXQobzIuc2VuZGVyKSA/IFN0cmluZyhvMi5zZW5kZXIpIDogXCJcIiwgcmVjZWl2ZXI6IGlzU2V0KG8yLnJlY2VpdmVyKSA/IFN0cmluZyhvMi5yZWNlaXZlcikgOiBcIlwiLCB0aW1lb3V0SGVpZ2h0OiBpc1NldChvMi50aW1lb3V0SGVpZ2h0KSA/IEhlaWdodC5mcm9tSlNPTihvMi50aW1lb3V0SGVpZ2h0KSA6IHZvaWQgMCwgdGltZW91dFRpbWVzdGFtcDogaXNTZXQobzIudGltZW91dFRpbWVzdGFtcCkgPyBCaWdJbnQobzIudGltZW91dFRpbWVzdGFtcC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbWVtbzogaXNTZXQobzIubWVtbykgPyBTdHJpbmcobzIubWVtbykgOiBcIlwiIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgcjUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuc291cmNlUG9ydCAmJiAocjUuc291cmNlUG9ydCA9IG8yLnNvdXJjZVBvcnQpLCB2b2lkIDAgIT09IG8yLnNvdXJjZUNoYW5uZWwgJiYgKHI1LnNvdXJjZUNoYW5uZWwgPSBvMi5zb3VyY2VDaGFubmVsKSwgdm9pZCAwICE9PSBvMi50b2tlbiAmJiAocjUudG9rZW4gPSBvMi50b2tlbiA/IENvaW4udG9KU09OKG8yLnRva2VuKSA6IHZvaWQgMCksIHZvaWQgMCAhPT0gbzIuc2VuZGVyICYmIChyNS5zZW5kZXIgPSBvMi5zZW5kZXIpLCB2b2lkIDAgIT09IG8yLnJlY2VpdmVyICYmIChyNS5yZWNlaXZlciA9IG8yLnJlY2VpdmVyKSwgdm9pZCAwICE9PSBvMi50aW1lb3V0SGVpZ2h0ICYmIChyNS50aW1lb3V0SGVpZ2h0ID0gbzIudGltZW91dEhlaWdodCA/IEhlaWdodC50b0pTT04obzIudGltZW91dEhlaWdodCkgOiB2b2lkIDApLCB2b2lkIDAgIT09IG8yLnRpbWVvdXRUaW1lc3RhbXAgJiYgKHI1LnRpbWVvdXRUaW1lc3RhbXAgPSAobzIudGltZW91dFRpbWVzdGFtcCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IG8yLm1lbW8gJiYgKHI1Lm1lbW8gPSBvMi5tZW1vKSwgcjU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCByNSA9IGkoKTtcbiAgcmV0dXJuIHI1LnNvdXJjZVBvcnQgPSBvMi5zb3VyY2VQb3J0ID8/IFwiXCIsIHI1LnNvdXJjZUNoYW5uZWwgPSBvMi5zb3VyY2VDaGFubmVsID8/IFwiXCIsIHI1LnRva2VuID0gdm9pZCAwICE9PSBvMi50b2tlbiAmJiBudWxsICE9PSBvMi50b2tlbiA/IENvaW4uZnJvbVBhcnRpYWwobzIudG9rZW4pIDogdm9pZCAwLCByNS5zZW5kZXIgPSBvMi5zZW5kZXIgPz8gXCJcIiwgcjUucmVjZWl2ZXIgPSBvMi5yZWNlaXZlciA/PyBcIlwiLCByNS50aW1lb3V0SGVpZ2h0ID0gdm9pZCAwICE9PSBvMi50aW1lb3V0SGVpZ2h0ICYmIG51bGwgIT09IG8yLnRpbWVvdXRIZWlnaHQgPyBIZWlnaHQuZnJvbVBhcnRpYWwobzIudGltZW91dEhlaWdodCkgOiB2b2lkIDAsIHI1LnRpbWVvdXRUaW1lc3RhbXAgPSB2b2lkIDAgIT09IG8yLnRpbWVvdXRUaW1lc3RhbXAgJiYgbnVsbCAhPT0gbzIudGltZW91dFRpbWVzdGFtcCA/IEJpZ0ludChvMi50aW1lb3V0VGltZXN0YW1wLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCByNS5tZW1vID0gbzIubWVtbyA/PyBcIlwiLCByNTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBNc2dUcmFuc2Zlci5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IE1zZ1RyYW5zZmVyLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvaWJjLmFwcGxpY2F0aW9ucy50cmFuc2Zlci52MS5Nc2dUcmFuc2ZlclwiLCB2YWx1ZTogTXNnVHJhbnNmZXIuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIGNvZXJjZURlbm9tID0gKGNoYWluSHViLCBkZW5vbUFyZykgPT4ge1xuICBpZiAodHlwZW9mIGRlbm9tQXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIGRlbm9tQXJnO1xuICB9XG4gIGNvbnN0IGRlbm9tID0gY2hhaW5IdWIuZ2V0RGVub20oZGVub21BcmcpO1xuICBpZiAoIWRlbm9tKSB7XG4gICAgdGhyb3cgbWFrZUVycm9yKGBObyBkZW5vbSBmb3IgYnJhbmQgJHtkZW5vbUFyZ31gKTtcbiAgfVxuICByZXR1cm4gZGVub207XG59O1xudmFyIGNvZXJjZURlbm9tQW1vdW50ID0gKGNoYWluSHViLCBhbW91bnQpID0+IHtcbiAgaWYgKFwiZGVub21cIiBpbiBhbW91bnQpIHtcbiAgICByZXR1cm4gYW1vdW50O1xuICB9XG4gIGNvbnN0IGRlbm9tID0gY29lcmNlRGVub20oY2hhaW5IdWIsIGFtb3VudC5icmFuZCk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGRlbm9tLFxuICAgIHZhbHVlOiBhbW91bnQudmFsdWVcbiAgfSk7XG59O1xudmFyIGNvZXJjZUNvaW4gPSAoY2hhaW5IdWIsIGFtb3VudCkgPT4ge1xuICBjb25zdCBkZW5vbSA9IFwiZGVub21cIiBpbiBhbW91bnQgPyBhbW91bnQuZGVub20gOiBjb2VyY2VEZW5vbShjaGFpbkh1YiwgYW1vdW50LmJyYW5kKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgZGVub20sXG4gICAgYW1vdW50OiBTdHJpbmcoYW1vdW50LnZhbHVlKVxuICB9KTtcbn07XG5cbi8vXG52YXIgbWF4Q2xvY2tTa2V3ID0gMTBuICogNjBuO1xudmFyIHRyeURlY29kZVJlc3BvbnNlID0gKGFja1N0ciwgZnJvbVByb3RvTXNnKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgYW55ID0gQW55LmRlY29kZShkZWNvZGVCYXNlNjQoYWNrU3RyKSk7XG4gICAgY29uc3QgcHJvdG9Nc2cgPSBBbnkuZGVjb2RlKGFueS52YWx1ZSk7XG4gICAgY29uc3QgbXNnID0gZnJvbVByb3RvTXNnKHByb3RvTXNnKTtcbiAgICByZXR1cm4gbXNnO1xuICB9IGNhdGNoIChjYXVzZSkge1xuICAgIHRocm93IG1ha2VFcnJvcihgYmFkIHJlc3BvbnNlOiAke2Fja1N0cn1gLCB2b2lkIDAsIHsgY2F1c2UgfSk7XG4gIH1cbn07XG52YXIgdG9EZW5vbUFtb3VudCA9IChjMikgPT4gKHsgZGVub206IGMyLmRlbm9tLCB2YWx1ZTogQmlnSW50KGMyLmFtb3VudCkgfSk7XG52YXIgdG9UcnVuY2F0ZWREZW5vbUFtb3VudCA9IChjMikgPT4gKHtcbiAgZGVub206IGMyLmRlbm9tLFxuICB2YWx1ZTogQmlnSW50KGMyLmFtb3VudC5zcGxpdChcIi5cIilbMF0pXG59KTtcbnZhciB0b0Nvc21vc1ZhbGlkYXRvckFkZHJlc3MgPSAocjUsIGNoYWluSWQpID0+ICh7XG4gIGVuY29kaW5nOiBcImJlY2gzMlwiLFxuICB2YWx1ZTogKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICByNS52YWxpZGF0b3JBZGRyZXNzXG4gICksXG4gIGNoYWluSWRcbn0pO1xudmFyIHRvQ29zbW9zRGVsZWdhdGlvblJlc3BvbnNlID0gKHsgY2hhaW5JZCB9LCByNSkgPT4gKHtcbiAgZGVsZWdhdG9yOiB7XG4gICAgY2hhaW5JZCxcbiAgICBlbmNvZGluZzogXCJiZWNoMzJcIixcbiAgICB2YWx1ZTogKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgcjUuZGVsZWdhdGlvbi5kZWxlZ2F0b3JBZGRyZXNzXG4gICAgKVxuICB9LFxuICB2YWxpZGF0b3I6IHRvQ29zbW9zVmFsaWRhdG9yQWRkcmVzcyhyNS5kZWxlZ2F0aW9uLCBjaGFpbklkKSxcbiAgYW1vdW50OiB0b0Rlbm9tQW1vdW50KHI1LmJhbGFuY2UpXG59KTtcblxuLy9cbnZhciBQdWJsaWNUb3BpY1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIHN1YnNjcmliZXI6IFN1YnNjcmliZXJTaGFwZSxcbiAgICBzdG9yYWdlUGF0aDogTS5vcihNLnByb21pc2UoXG4gICAgICAvKiAgICAgICAgKi9cbiAgICApLCBNLnN0cmluZygpKVxuICB9LFxuICB7IGRlc2NyaXB0aW9uOiBNLnN0cmluZygpIH1cbik7XG52YXIgVG9waWNzUmVjb3JkU2hhcGUgPSBNLnJlY29yZE9mKE0uc3RyaW5nKCksIFB1YmxpY1RvcGljU2hhcGUpO1xudmFyIG1ha2VSZWNvcmRlclRvcGljID0gKGRlc2NyaXB0aW9uLCByZWNvcmRlcktpdCkgPT4ge1xuICBjb25zdCByZWNQID0gXCJyZWNvcmRlclwiIGluIHJlY29yZGVyS2l0ID8gcmVjb3JkZXJLaXQucmVjb3JkZXIgOiByZWNvcmRlcktpdC5yZWNvcmRlclA7XG4gIHJldHVybiB7XG4gICAgZGVzY3JpcHRpb24sXG4gICAgc3Vic2NyaWJlcjogcmVjb3JkZXJLaXQuc3Vic2NyaWJlcixcbiAgICBzdG9yYWdlUGF0aDogRShyZWNQKS5nZXRTdG9yYWdlUGF0aCgpXG4gIH07XG59O1xuXG4vL1xudmFyIHsgVm93JDogVm93JDIgfSA9IFNoYXBlO1xudmFyIG9yY2hlc3RyYXRpb25BY2NvdW50TWV0aG9kcyA9IHtcbiAgZ2V0QWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSksXG4gIGdldEJhbGFuY2U6IE0uY2FsbChNLm9yKEJyYW5kU2hhcGUsIE0uc3RyaW5nKCkpKS5yZXR1cm5zKFxuICAgIFZvdyQyKERlbm9tQW1vdW50U2hhcGUpXG4gICksXG4gIGdldEJhbGFuY2VzOiBNLmNhbGwoKS5yZXR1cm5zKFZvdyQyKE0uYXJyYXlPZihEZW5vbUFtb3VudFNoYXBlKSkpLFxuICBzZW5kOiBNLmNhbGwoQWNjb3VudElkQXJnU2hhcGUsIEFtb3VudEFyZ1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgc2VuZEFsbDogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlLCBNLmFycmF5T2YoQW1vdW50QXJnU2hhcGUpKS5yZXR1cm5zKFxuICAgIFZvd1NoYXBlXG4gICksXG4gIHRyYW5zZmVyOiBNLmNhbGwoQWNjb3VudElkQXJnU2hhcGUsIEFtb3VudEFyZ1NoYXBlKS5vcHRpb25hbChJQkNUcmFuc2Zlck9wdGlvbnNTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIHRyYW5zZmVyU3RlcHM6IE0uY2FsbChBbW91bnRBcmdTaGFwZSwgTS5hbnkoKSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGFzQ29udGludWluZ09mZmVyOiBNLmNhbGwoKS5yZXR1cm5zKFxuICAgIFZvdyQyKHtcbiAgICAgIHB1YmxpY1N1YnNjcmliZXJzOiBUb3BpY3NSZWNvcmRTaGFwZSxcbiAgICAgIGludml0YXRpb25NYWtlcnM6IE0uYW55KCksXG4gICAgICBob2xkZXI6IE0ucmVtb3RhYmxlKClcbiAgICB9KVxuICApLFxuICBnZXRQdWJsaWNUb3BpY3M6IE0uY2FsbCgpLnJldHVybnMoVm93JDIoVG9waWNzUmVjb3JkU2hhcGUpKVxufTtcblxuLy9cbnZhciBUaW1lckJyYW5kU2hhcGUgPSBNLnJlbW90YWJsZShcIlRpbWVyQnJhbmRcIik7XG52YXIgVGltZXN0YW1wVmFsdWVTaGFwZSA9IE0ubmF0KCk7XG52YXIgUmVsYXRpdmVUaW1lVmFsdWVTaGFwZSA9IE0ubmF0KCk7XG52YXIgVGltZXN0YW1wUmVjb3JkU2hhcGUgPSB7XG4gIHRpbWVyQnJhbmQ6IFRpbWVyQnJhbmRTaGFwZSxcbiAgYWJzVmFsdWU6IFRpbWVzdGFtcFZhbHVlU2hhcGVcbn07XG5oYXJkZW4oVGltZXN0YW1wUmVjb3JkU2hhcGUpO1xudmFyIFJlbGF0aXZlVGltZVJlY29yZFNoYXBlID0ge1xuICB0aW1lckJyYW5kOiBUaW1lckJyYW5kU2hhcGUsXG4gIHJlbFZhbHVlOiBSZWxhdGl2ZVRpbWVWYWx1ZVNoYXBlXG59O1xuaGFyZGVuKFJlbGF0aXZlVGltZVJlY29yZFNoYXBlKTtcbnZhciBUaW1lc3RhbXBTaGFwZSA9IE0ub3IoVGltZXN0YW1wUmVjb3JkU2hhcGUsIFRpbWVzdGFtcFZhbHVlU2hhcGUpO1xudmFyIFJlbGF0aXZlVGltZVNoYXBlID0gTS5vcihcbiAgUmVsYXRpdmVUaW1lUmVjb3JkU2hhcGUsXG4gIFJlbGF0aXZlVGltZVZhbHVlU2hhcGVcbik7XG52YXIgVGltZXJTZXJ2aWNlU2hhcGUgPSBNLnJlbW90YWJsZShcIlRpbWVyU2VydmljZVwiKTtcblxuLy9cbnZhciBhZ3JlZWRUaW1lckJyYW5kID0gKGxlZnRCcmFuZCwgcmlnaHRCcmFuZCkgPT4ge1xuICBpZiAobGVmdEJyYW5kID09PSB2b2lkIDApIHtcbiAgICBpZiAocmlnaHRCcmFuZCA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcmlnaHRCcmFuZDtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmlnaHRCcmFuZCA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIGxlZnRCcmFuZDtcbiAgfSBlbHNlIHtcbiAgICBsZWZ0QnJhbmQgPT09IHJpZ2h0QnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBUaW1lckJyYW5kcyBtdXN0IG1hdGNoOiAke3F1b3RlKGxlZnRCcmFuZCl9IHZzICR7cXVvdGUocmlnaHRCcmFuZCl9YDtcbiAgICByZXR1cm4gbGVmdEJyYW5kO1xuICB9XG59O1xudmFyIHNoYXJlZFRpbWVyQnJhbmQgPSAobGVmdCwgcmlnaHQpID0+IHtcbiAgY29uc3QgbGVmdEJyYW5kID0gdHlwZW9mIGxlZnQgPT09IFwiYmlnaW50XCIgPyB2b2lkIDAgOiBsZWZ0LnRpbWVyQnJhbmQ7XG4gIGNvbnN0IHJpZ2h0QnJhbmQgPSB0eXBlb2YgcmlnaHQgPT09IFwiYmlnaW50XCIgPyB2b2lkIDAgOiByaWdodC50aW1lckJyYW5kO1xuICByZXR1cm4gYWdyZWVkVGltZXJCcmFuZChsZWZ0QnJhbmQsIHJpZ2h0QnJhbmQpO1xufTtcbnZhciBhYnNMaWtlID0gKGxlZnQsIHJpZ2h0LCBhYnNWYWx1ZTIpID0+IHtcbiAgTmF0KGFic1ZhbHVlMik7XG4gIGNvbnN0IHRpbWVyQnJhbmQgPSBzaGFyZWRUaW1lckJyYW5kKGxlZnQsIHJpZ2h0KTtcbiAgaWYgKHRpbWVyQnJhbmQpIHtcbiAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgIHRpbWVyQnJhbmQsXG4gICAgICBhYnNWYWx1ZTogYWJzVmFsdWUyXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGFic1ZhbHVlMjtcbiAgfVxufTtcbnZhciByZWxMaWtlID0gKGxlZnQsIHJpZ2h0LCByZWxWYWx1ZTIpID0+IHtcbiAgTmF0KHJlbFZhbHVlMik7XG4gIGNvbnN0IHRpbWVyQnJhbmQgPSBzaGFyZWRUaW1lckJyYW5kKGxlZnQsIHJpZ2h0KTtcbiAgaWYgKHRpbWVyQnJhbmQpIHtcbiAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgIHRpbWVyQnJhbmQsXG4gICAgICByZWxWYWx1ZTogcmVsVmFsdWUyXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHJlbFZhbHVlMjtcbiAgfVxufTtcbnZhciBhYnNWYWx1ZSA9IChhYnMpID0+IHtcbiAgaWYgKHR5cGVvZiBhYnMgPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4gTmF0KGFicyk7XG4gIH1cbiAgbXVzdE1hdGNoMihhYnMsIFRpbWVzdGFtcFJlY29yZFNoYXBlLCBcInRpbWVzdGFtcFwiKTtcbiAgcmV0dXJuIE5hdChhYnMuYWJzVmFsdWUpO1xufTtcbnZhciByZWxWYWx1ZSA9IChyZWwpID0+IHtcbiAgaWYgKHR5cGVvZiByZWwgPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4gTmF0KHJlbCk7XG4gIH1cbiAgbXVzdE1hdGNoMihyZWwsIFJlbGF0aXZlVGltZVJlY29yZFNoYXBlLCBcInJlbGF0aXZlXCIpO1xuICByZXR1cm4gTmF0KHJlbC5yZWxWYWx1ZSk7XG59O1xudmFyIG1ha2VUaW1lc3RhbXBSZWNvcmQgPSAoYWJzLCB0aW1lckJyYW5kKSA9PiBoYXJkZW4oeyBhYnNWYWx1ZTogYWJzLCB0aW1lckJyYW5kIH0pO1xudmFyIG1ha2VSZWxhdGl2ZVRpbWVSZWNvcmQgPSAocmVsLCB0aW1lckJyYW5kKSA9PiBoYXJkZW4oeyByZWxWYWx1ZTogcmVsLCB0aW1lckJyYW5kIH0pO1xudmFyIGNvZXJjZVRpbWVzdGFtcFJlY29yZCA9ICh0cywgYnJhbmQpID0+IHtcbiAgYnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBtdXN0IGhhdmUgYSBicmFuZGA7XG4gIGlmICh0eXBlb2YgdHMgPT09IFwibnVtYmVyXCIpIHtcbiAgICB0cyA9IE5hdCh0cyk7XG4gIH1cbiAgaWYgKHR5cGVvZiB0cyA9PT0gXCJiaWdpbnRcIikge1xuICAgIHJldHVybiBtYWtlVGltZXN0YW1wUmVjb3JkKHRzLCBicmFuZCk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgeyB0aW1lckJyYW5kIH0gPSB0cztcbiAgICBtdXN0TWF0Y2gyKHRzLCBUaW1lc3RhbXBSZWNvcmRTaGFwZSwgXCJ0aW1lc3RhbXBcIik7XG4gICAgYWdyZWVkVGltZXJCcmFuZCh0aW1lckJyYW5kLCBicmFuZCk7XG4gICAgcmV0dXJuIHRzO1xuICB9XG59O1xudmFyIGNvZXJjZVJlbGF0aXZlVGltZVJlY29yZCA9IChydCwgYnJhbmQpID0+IHtcbiAgYnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBtdXN0IGhhdmUgYSBicmFuZGA7XG4gIGlmICh0eXBlb2YgcnQgPT09IFwibnVtYmVyXCIpIHtcbiAgICBydCA9IE5hdChydCk7XG4gIH1cbiAgaWYgKHR5cGVvZiBydCA9PT0gXCJiaWdpbnRcIikge1xuICAgIHJldHVybiBtYWtlUmVsYXRpdmVUaW1lUmVjb3JkKHJ0LCBicmFuZCk7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgeyB0aW1lckJyYW5kIH0gPSBydDtcbiAgICBtdXN0TWF0Y2gyKHJ0LCBSZWxhdGl2ZVRpbWVSZWNvcmRTaGFwZSwgXCJyZWxhdGl2ZVRpbWVcIik7XG4gICAgYWdyZWVkVGltZXJCcmFuZCh0aW1lckJyYW5kLCBicmFuZCk7XG4gICAgcmV0dXJuIHJ0O1xuICB9XG59O1xudmFyIGFkZEFic1JlbCA9IChhYnMsIHJlbCkgPT4gYWJzTGlrZShhYnMsIHJlbCwgYWJzVmFsdWUoYWJzKSArIHJlbFZhbHVlKHJlbCkpO1xudmFyIGFkZFJlbFJlbCA9IChyZWwxLCByZWwyKSA9PiByZWxMaWtlKHJlbDEsIHJlbDIsIHJlbFZhbHVlKHJlbDEpICsgcmVsVmFsdWUocmVsMikpO1xudmFyIHN1YnRyYWN0QWJzQWJzID0gKGFiczEsIGFiczIpID0+IHJlbExpa2UoYWJzMSwgYWJzMiwgYWJzVmFsdWUoYWJzMSkgLSBhYnNWYWx1ZShhYnMyKSk7XG52YXIgY2xhbXBlZFN1YnRyYWN0QWJzQWJzID0gKGFiczEsIGFiczIpID0+IHtcbiAgY29uc3QgdmFsMSA9IGFic1ZhbHVlKGFiczEpO1xuICBjb25zdCB2YWwyID0gYWJzVmFsdWUoYWJzMik7XG4gIHJldHVybiByZWxMaWtlKGFiczEsIGFiczIsIHZhbDEgPiB2YWwyID8gdmFsMSAtIHZhbDIgOiAwbik7XG59O1xudmFyIHN1YnRyYWN0QWJzUmVsID0gKGFicywgcmVsKSA9PiBhYnNMaWtlKGFicywgcmVsLCBhYnNWYWx1ZShhYnMpIC0gcmVsVmFsdWUocmVsKSk7XG52YXIgc3VidHJhY3RSZWxSZWwgPSAocmVsMSwgcmVsMikgPT4gcmVsTGlrZShyZWwxLCByZWwyLCByZWxWYWx1ZShyZWwxKSAtIHJlbFZhbHVlKHJlbDIpKTtcbnZhciBpc1JlbFplcm8gPSAocmVsKSA9PiByZWxWYWx1ZShyZWwpID09PSAwbjtcbnZhciBtdWx0aXBseVJlbE5hdCA9IChyZWwsIG5hdCkgPT4gcmVsTGlrZShyZWwsIG5hdCwgcmVsVmFsdWUocmVsKSAqIG5hdCk7XG52YXIgZGl2aWRlUmVsTmF0ID0gKHJlbCwgbmF0KSA9PiByZWxMaWtlKHJlbCwgbmF0LCByZWxWYWx1ZShyZWwpIC8gbmF0KTtcbnZhciBkaXZpZGVSZWxSZWwgPSAocmVsMSwgcmVsMikgPT4ge1xuICBzaGFyZWRUaW1lckJyYW5kKHJlbDEsIHJlbDIpO1xuICByZXR1cm4gcmVsVmFsdWUocmVsMSkgLyByZWxWYWx1ZShyZWwyKTtcbn07XG52YXIgbW9kQWJzUmVsID0gKGFicywgc3RlcCkgPT4gcmVsTGlrZShhYnMsIHN0ZXAsIGFic1ZhbHVlKGFicykgJSByZWxWYWx1ZShzdGVwKSk7XG52YXIgbW9kUmVsUmVsID0gKHJlbCwgc3RlcCkgPT4gcmVsTGlrZShyZWwsIHN0ZXAsIHJlbFZhbHVlKHJlbCkgJSByZWxWYWx1ZShzdGVwKSk7XG52YXIgY29tcGFyZVZhbHVlcyA9IChsZWZ0LCByaWdodCwgdjEsIHYyMikgPT4ge1xuICBzaGFyZWRUaW1lckJyYW5kKGxlZnQsIHJpZ2h0KTtcbiAgaWYgKHYxIDwgdjIyKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9IGVsc2UgaWYgKHYxID09PSB2MjIpIHtcbiAgICByZXR1cm4gMDtcbiAgfSBlbHNlIHtcbiAgICBhc3NlcnQodjEgPiB2MjIpO1xuICAgIHJldHVybiAxO1xuICB9XG59O1xudmFyIFRpbWVNYXRoID0gaGFyZGVuKHtcbiAgYWJzVmFsdWUsXG4gIHJlbFZhbHVlLFxuICBjb2VyY2VUaW1lc3RhbXBSZWNvcmQsXG4gIGNvZXJjZVJlbGF0aXZlVGltZVJlY29yZCxcbiAgLy9cbiAgYWRkQWJzUmVsLFxuICAvL1xuICBhZGRSZWxSZWwsXG4gIHN1YnRyYWN0QWJzQWJzLFxuICBjbGFtcGVkU3VidHJhY3RBYnNBYnMsXG4gIHN1YnRyYWN0QWJzUmVsLFxuICBzdWJ0cmFjdFJlbFJlbCxcbiAgaXNSZWxaZXJvLFxuICBtdWx0aXBseVJlbE5hdCxcbiAgZGl2aWRlUmVsTmF0LFxuICBkaXZpZGVSZWxSZWwsXG4gIG1vZEFic1JlbCxcbiAgbW9kUmVsUmVsLFxuICBjb21wYXJlQWJzOiAoYWJzMSwgYWJzMikgPT4gY29tcGFyZVZhbHVlcyhhYnMxLCBhYnMyLCBhYnNWYWx1ZShhYnMxKSwgYWJzVmFsdWUoYWJzMikpLFxuICBjb21wYXJlUmVsOiAocmVsMSwgcmVsMikgPT4gY29tcGFyZVZhbHVlcyhyZWwxLCByZWwyLCByZWxWYWx1ZShyZWwxKSwgcmVsVmFsdWUocmVsMikpXG59KTtcblxuLy9cbnZhciBTRUNPTkRTX1BFUl9NSU5VVEUgPSA2MG47XG52YXIgTkFOT1NFQ09ORFNfUEVSX1NFQ09ORCA9IDEwMDAwMDAwMDBuO1xuZnVuY3Rpb24gbWFrZVRpbWVzdGFtcEhlbHBlcih0aW1lcikge1xuICBjb25zdCBzZWxmID0gaGFyZGVuKHtcbiAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIGFzeW5jIGdldFRpbWVvdXRUaW1lc3RhbXBOUyhzZWNvbmRzSW5GdXR1cmUgPSBTRUNPTkRTX1BFUl9NSU5VVEUgKiA1bikge1xuICAgICAgY29uc3QgY3VycmVudFRpbWUgPSBhd2FpdCBFKHRpbWVyKS5nZXRDdXJyZW50VGltZXN0YW1wKCk7XG4gICAgICBjb25zdCB0aW1lb3V0ID0gVGltZU1hdGguY29lcmNlUmVsYXRpdmVUaW1lUmVjb3JkKFxuICAgICAgICBzZWNvbmRzSW5GdXR1cmUsXG4gICAgICAgIGN1cnJlbnRUaW1lLnRpbWVyQnJhbmRcbiAgICAgICk7XG4gICAgICByZXR1cm4gVGltZU1hdGguYWRkQWJzUmVsKGN1cnJlbnRUaW1lLCB0aW1lb3V0KS5hYnNWYWx1ZSAqIE5BTk9TRUNPTkRTX1BFUl9TRUNPTkQ7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHZvd09yVmFsdWVGcm9tT3B0cyhvcHRzKSB7XG4gICAgICBpZiAob3B0cyAmJiBcInRpbWVvdXRUaW1lc3RhbXBcIiBpbiBvcHRzKSByZXR1cm4gb3B0cy50aW1lb3V0VGltZXN0YW1wO1xuICAgICAgaWYgKG9wdHMgJiYgXCJ0aW1lb3V0SGVpZ2h0XCIgaW4gb3B0cykgcmV0dXJuIDBuO1xuICAgICAgcmV0dXJuIHNlbGYuZ2V0VGltZW91dFRpbWVzdGFtcE5TKFxuICAgICAgICBvcHRzICYmIFwidGltZW91dFJlbGF0aXZlU2Vjb25kc1wiIGluIG9wdHMgPyBvcHRzLnRpbWVvdXRSZWxhdGl2ZVNlY29uZHMgOiB2b2lkIDBcbiAgICAgICk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHNlbGY7XG59XG5cbi8vXG52YXIgdHJhY2UzID0gbWFrZVRyYWNlcihcIkNvc21vc09yY2hBY2NvdW50XCIpO1xudmFyIHsgVm93JDogVm93JDMgfSA9IFNoYXBlO1xudmFyIHN0YWtpbmdBY2NvdW50QWN0aW9uc01ldGhvZHMgPSB7XG4gIGRlbGVnYXRlOiBNLmNhbGwoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsIEFtb3VudEFyZ1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgcmVkZWxlZ2F0ZTogTS5jYWxsKFxuICAgIENvc21vc0NoYWluQWRkcmVzc1NoYXBlLFxuICAgIENvc21vc0NoYWluQWRkcmVzc1NoYXBlLFxuICAgIEFtb3VudEFyZ1NoYXBlXG4gICkucmV0dXJucyhWb3dTaGFwZSksXG4gIHVuZGVsZWdhdGU6IE0uY2FsbChNLmFycmF5T2YoRGVsZWdhdGlvblNoYXBlKSkucmV0dXJucyhWb3dTaGFwZSksXG4gIHdpdGhkcmF3UmV3YXJkOiBNLmNhbGwoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpLnJldHVybnMoXG4gICAgVm93JDMoTS5hcnJheU9mKERlbm9tQW1vdW50U2hhcGUpKVxuICApLFxuICB3aXRoZHJhd1Jld2FyZHM6IE0uY2FsbCgpLnJldHVybnMoVm93JDMoTS5hcnJheU9mKERlbm9tQW1vdW50U2hhcGUpKSlcbn07XG52YXIgc3Rha2luZ0FjY291bnRRdWVyaWVzTWV0aG9kcyA9IHtcbiAgZ2V0RGVsZWdhdGlvbjogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0RGVsZWdhdGlvbnM6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpLFxuICBnZXRVbmJvbmRpbmdEZWxlZ2F0aW9uOiBNLmNhbGwoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICBnZXRVbmJvbmRpbmdEZWxlZ2F0aW9uczogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldFJlZGVsZWdhdGlvbnM6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpLFxuICBnZXRSZXdhcmQ6IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldFJld2FyZHM6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpXG59O1xudmFyIG5vYmxlTWV0aG9kcyA9IHtcbiAgZGVwb3NpdEZvckJ1cm46IE0uY2FsbChNLnN0cmluZygpLCBBbW91bnRBcmdTaGFwZSkub3B0aW9uYWwoTS5zdHJpbmcoKSkucmV0dXJucyhWb3dTaGFwZSlcbn07XG52YXIgSWNhQWNjb3VudEhvbGRlckkgPSBNLmludGVyZmFjZShcIkljYUFjY291bnRIb2xkZXJcIiwge1xuICAuLi5ub2JsZU1ldGhvZHMsXG4gIC4uLm9yY2hlc3RyYXRpb25BY2NvdW50TWV0aG9kcyxcbiAgLi4uc3Rha2luZ0FjY291bnRBY3Rpb25zTWV0aG9kcyxcbiAgLi4uc3Rha2luZ0FjY291bnRRdWVyaWVzTWV0aG9kcyxcbiAgZGVhY3RpdmF0ZTogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIHJlYWN0aXZhdGU6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpLFxuICBleGVjdXRlRW5jb2RlZFR4OiBNLmNhbGwoTS5hcnJheU9mKFByb3RvM1NoYXBlKSkub3B0aW9uYWwoRXhlY3V0ZUlDQVR4T3B0c1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKVxufSk7XG52YXIgUFVCTElDX1RPUElDUyA9IHtcbiAgYWNjb3VudDogW1wiU3Rha2luZyBBY2NvdW50IGhvbGRlciBzdGF0dXNcIiwgTS5hbnkoKV1cbn07XG52YXIgQ29zbW9zT3JjaGVzdHJhdGlvbkludml0YXRpb25NYWtlcnNJID0gTS5pbnRlcmZhY2UoXG4gIFwiaW52aXRhdGlvbk1ha2Vyc1wiLFxuICB7XG4gICAgRGVsZWdhdGU6IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSwgQW1vdW50QXJnU2hhcGUpLnJldHVybnMoXG4gICAgICBNLnByb21pc2UoKVxuICAgICksXG4gICAgUmVkZWxlZ2F0ZTogTS5jYWxsKFxuICAgICAgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsXG4gICAgICBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICAgIEFtb3VudEFyZ1NoYXBlXG4gICAgKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICBXaXRoZHJhd1Jld2FyZDogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICBVbmRlbGVnYXRlOiBNLmNhbGwoTS5hcnJheU9mKERlbGVnYXRpb25TaGFwZSkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIERlYWN0aXZhdGVBY2NvdW50OiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICBSZWFjdGl2YXRlQWNjb3VudDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgVHJhbnNmZXJBY2NvdW50OiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICBTZW5kOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICBTZW5kQWxsOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICBUcmFuc2ZlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgfVxuKTtcbmhhcmRlbihDb3Ntb3NPcmNoZXN0cmF0aW9uSW52aXRhdGlvbk1ha2Vyc0kpO1xudmFyIHByZXBhcmVDb3Ntb3NPcmNoZXN0cmF0aW9uQWNjb3VudEtpdCA9ICh6b25lLCB7XG4gIGNoYWluSHViLFxuICBtYWtlUmVjb3JkZXJLaXQsXG4gIHRpbWVyU2VydmljZSxcbiAgdm93VG9vbHM6IHsgd2F0Y2gsIGFzVm93LCB3aGVuLCBhbGxWb3dzIH0sXG4gIHpjZlxufSkgPT4ge1xuICBjb25zdCB0aW1lc3RhbXBIZWxwZXIgPSBtYWtlVGltZXN0YW1wSGVscGVyKHRpbWVyU2VydmljZSk7XG4gIGNvbnN0IG1ha2VDb3Ntb3NPcmNoZXN0cmF0aW9uQWNjb3VudEtpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJDb3Ntb3MgT3JjaGVzdHJhdGlvbiBBY2NvdW50IEhvbGRlclwiLFxuICAgIHtcbiAgICAgIGhlbHBlcjogTS5pbnRlcmZhY2UoXCJoZWxwZXJcIiwge1xuICAgICAgICBvd25lZDogTS5jYWxsKCkucmV0dXJucyhNLnJlbW90YWJsZSgpKSxcbiAgICAgICAgZ2V0VXBkYXRlcjogTS5jYWxsKCkucmV0dXJucyhNLnJlbW90YWJsZSgpKSxcbiAgICAgICAgYW1vdW50VG9Db2luOiBNLmNhbGwoQW1vdW50QXJnU2hhcGUpLnJldHVybnMoTS5yZWNvcmQoKSlcbiAgICAgIH0pLFxuICAgICAgcmV0dXJuVm9pZFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmV0dXJuVm9pZFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhNLnVuZGVmaW5lZCgpKVxuICAgICAgfSksXG4gICAgICBiYWxhbmNlUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcImJhbGFuY2VRdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKE0ub3IoTS5yZWNvcmQoKSwgTS51bmRlZmluZWQoKSkpXG4gICAgICB9KSxcbiAgICAgIGFsbEJhbGFuY2VzUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcImFsbEJhbGFuY2VzUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoXG4gICAgICAgICAgTS5hcnJheU9mKE0ucmVjb3JkKCkpXG4gICAgICAgIClcbiAgICAgIH0pLFxuICAgICAgdW5kZWxlZ2F0ZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwidW5kZWxlZ2F0ZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhWb3ckMyhNLnByb21pc2UoKSkpXG4gICAgICB9KSxcbiAgICAgIHdpdGhkcmF3UmV3YXJkV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJ3aXRoZHJhd1Jld2FyZFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhNLmFycmF5T2YoRGVub21BbW91bnRTaGFwZSkpXG4gICAgICB9KSxcbiAgICAgIHRyYW5zZmVyV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJ0cmFuc2ZlcldhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKFtNLnJlY29yZCgpLCBNLm5hdCgpXSkub3B0aW9uYWwoe1xuICAgICAgICAgIGRlc3RpbmF0aW9uOiBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICAgICAgICBvcHRzOiBNLm9yKE0udW5kZWZpbmVkKCksIElCQ1RyYW5zZmVyT3B0aW9uc1NoYXBlKSxcbiAgICAgICAgICB0b2tlbjoge1xuICAgICAgICAgICAgZGVub206IE0uc3RyaW5nKCksXG4gICAgICAgICAgICBhbW91bnQ6IE0uc3RyaW5nKClcbiAgICAgICAgICB9XG4gICAgICAgIH0pLnJldHVybnMoVm93JDMoTS5yZWNvcmQoKSkpXG4gICAgICB9KSxcbiAgICAgIGRlbGVnYXRpb25RdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5yZXR1cm5zKE0ucmVjb3JkKCkpXG4gICAgICB9KSxcbiAgICAgIGRlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcImRlbGVnYXRpb25zUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoXG4gICAgICAgICAgTS5hcnJheU9mKE0ucmVjb3JkKCkpXG4gICAgICAgIClcbiAgICAgIH0pLFxuICAgICAgdW5ib25kaW5nRGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICAgIFwidW5ib25kaW5nRGVsZWdhdGlvblF1ZXJ5V2F0Y2hlclwiLFxuICAgICAgICB7XG4gICAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoTS5yZWNvcmQoKSlcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHVuYm9uZGluZ0RlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcbiAgICAgICAgXCJ1bmJvbmRpbmdEZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlclwiLFxuICAgICAgICB7XG4gICAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoXG4gICAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgICApXG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICByZWRlbGVnYXRpb25RdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmVkZWxlZ2F0aW9uUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoXG4gICAgICAgICAgTS5hcnJheU9mKE0ucmVjb3JkKCkpXG4gICAgICAgIClcbiAgICAgIH0pLFxuICAgICAgcmVkZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZWRlbGVnYXRpb25zUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoXG4gICAgICAgICAgTS5hcnJheU9mKE0ucmVjb3JkKCkpXG4gICAgICAgIClcbiAgICAgIH0pLFxuICAgICAgcmV3YXJkUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcInJld2FyZFF1ZXJ5V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5yZXR1cm5zKFxuICAgICAgICAgIE0uYXJyYXlPZihNLnJlY29yZCgpKVxuICAgICAgICApXG4gICAgICB9KSxcbiAgICAgIHJld2FyZHNRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmV3YXJkc1F1ZXJ5V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5yZXR1cm5zKE0ucmVjb3JkKCkpXG4gICAgICB9KSxcbiAgICAgIGhvbGRlcjogSWNhQWNjb3VudEhvbGRlckksXG4gICAgICBpbnZpdGF0aW9uTWFrZXJzOiBDb3Ntb3NPcmNoZXN0cmF0aW9uSW52aXRhdGlvbk1ha2Vyc0lcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICAoeyBjaGFpbkFkZHJlc3MsIGxvY2FsQWRkcmVzcywgcmVtb3RlQWRkcmVzcyB9LCBpbykgPT4ge1xuICAgICAgdHJhY2UzKFwiY29zbW9zIG9yY2ggYWNjdCBpbml0XCIsIHtcbiAgICAgICAgY2hhaW5BZGRyZXNzLFxuICAgICAgICBsb2NhbEFkZHJlc3MsXG4gICAgICAgIHJlbW90ZUFkZHJlc3NcbiAgICAgIH0pO1xuICAgICAgY29uc3QgeyBzdG9yYWdlTm9kZSB9ID0gaW87XG4gICAgICBjb25zdCB0b3BpY0tpdCA9IHN0b3JhZ2VOb2RlID8gbWFrZVJlY29yZGVyS2l0KHN0b3JhZ2VOb2RlLCBQVUJMSUNfVE9QSUNTLmFjY291bnRbMV0pIDogdm9pZCAwO1xuICAgICAgaWYgKHRvcGljS2l0KSB7XG4gICAgICAgIHZvaWQgRSh0b3BpY0tpdC5yZWNvcmRlcikud3JpdGUoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB7XG4gICAgICAgICAgICBsb2NhbEFkZHJlc3MsXG4gICAgICAgICAgICByZW1vdGVBZGRyZXNzXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBhY2NvdW50LCBpY3FDb25uZWN0aW9uLCB0aW1lciB9ID0gaW87XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhY2NvdW50LFxuICAgICAgICBjaGFpbkFkZHJlc3MsXG4gICAgICAgIGljcUNvbm5lY3Rpb24sXG4gICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgcmVtb3RlQWRkcmVzcyxcbiAgICAgICAgdGltZXIsXG4gICAgICAgIHRvcGljS2l0XG4gICAgICB9O1xuICAgIH0sXG4gICAge1xuICAgICAgaGVscGVyOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG93bmVkKCkge1xuICAgICAgICAgIGNvbnN0IHsgYWNjb3VudCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoIWFjY291bnQpIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgVXNpbmcgYWNjb3VudCBob2xkZXIgYWZ0ZXIgdHJhbnNmZXJgO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gYWNjb3VudDtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0VXBkYXRlcigpIHtcbiAgICAgICAgICBpZiAoIXRoaXMuc3RhdGUudG9waWNLaXQpIHRocm93IHRocm93UmVkYWN0ZWRgbm8gdG9waWNLaXRgO1xuICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLnRvcGljS2l0LnJlY29yZGVyO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGFtb3VudFRvQ29pbihhbW91bnQpIHtcbiAgICAgICAgICAhKFwiYnJhbmRcIiBpbiBhbW91bnQpIHx8IHRocm93UmVkYWN0ZWRgJ2Ftb3VudFRvQ29pbicgbm90IHdvcmtpbmcgZm9yICR7cXVvdGUoYW1vdW50LmJyYW5kKX0gdW50aWwgIzEwNDQ5OyB1c2UgJ0Rlbm9tQW1vdW50JyBmb3Igbm93YDtcbiAgICAgICAgICByZXR1cm4gY29lcmNlQ29pbihjaGFpbkh1YiwgYW1vdW50KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGJhbGFuY2VRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBpZiAoIXJlc3VsdD8ua2V5KSB0aHJvdyB0aHJvd1JlZGFjdGVkYEVycm9yIHBhcnNpbmcgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlIH0gPSBRdWVyeUJhbGFuY2VSZXNwb25zZS5kZWNvZGUoXG4gICAgICAgICAgICBkZWNvZGVCYXNlNjQocmVzdWx0LmtleSlcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghYmFsYW5jZSkgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIGJhbGFuY2Uga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4odG9EZW5vbUFtb3VudChiYWxhbmNlKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkZWxlZ2F0aW9uUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBpZiAoIXJlc3VsdD8ua2V5KSB0aHJvdyB0aHJvd1JlZGFjdGVkYEVycm9yIHBhcnNpbmcgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyBkZWxlZ2F0aW9uUmVzcG9uc2UgfSA9IFF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShcbiAgICAgICAgICAgIGRlY29kZUJhc2U2NChyZXN1bHQua2V5KVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFkZWxlZ2F0aW9uUmVzcG9uc2UpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgZGVsZWdhdGlvblJlc3BvbnNlIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKFxuICAgICAgICAgICAgdG9Db3Ntb3NEZWxlZ2F0aW9uUmVzcG9uc2UoY2hhaW5BZGRyZXNzLCBkZWxlZ2F0aW9uUmVzcG9uc2UpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBpZiAoIXJlc3VsdD8ua2V5KSB0aHJvdyB0aHJvd1JlZGFjdGVkYEVycm9yIHBhcnNpbmcgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyBkZWxlZ2F0aW9uUmVzcG9uc2VzIH0gPSBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2UuZGVjb2RlKGRlY29kZUJhc2U2NChyZXN1bHQua2V5KSk7XG4gICAgICAgICAgaWYgKCFkZWxlZ2F0aW9uUmVzcG9uc2VzKVxuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIGRlbGVnYXRpb25SZXNwb25zZXMga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oXG4gICAgICAgICAgICBkZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcChcbiAgICAgICAgICAgICAgKHI1KSA9PiB0b0Nvc21vc0RlbGVnYXRpb25SZXNwb25zZShjaGFpbkFkZHJlc3MsIHI1KVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB1bmJvbmRpbmdEZWxlZ2F0aW9uUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgaWYgKCFyZXN1bHQ/LmtleSkgdGhyb3cgdGhyb3dSZWRhY3RlZGBFcnJvciBwYXJzaW5nIHJlc3VsdCAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgdW5ib25kIH0gPSBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZS5kZWNvZGUoXG4gICAgICAgICAgICBkZWNvZGVCYXNlNjQocmVzdWx0LmtleSlcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghdW5ib25kKSB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgdW5ib25kIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHVuYm9uZCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB1bmJvbmRpbmdEZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGlmICghcmVzdWx0Py5rZXkpIHRocm93IHRocm93UmVkYWN0ZWRgRXJyb3IgcGFyc2luZyByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IHVuYm9uZGluZ1Jlc3BvbnNlcyB9ID0gUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1Jlc3BvbnNlLmRlY29kZShcbiAgICAgICAgICAgIGRlY29kZUJhc2U2NChyZXN1bHQua2V5KVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCF1bmJvbmRpbmdSZXNwb25zZXMpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgdW5ib25kaW5nUmVzcG9uc2VzIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHVuYm9uZGluZ1Jlc3BvbnNlcyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZWRlbGVnYXRpb25RdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBpZiAoIXJlc3VsdD8ua2V5KSB0aHJvdyB0aHJvd1JlZGFjdGVkYEVycm9yIHBhcnNpbmcgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyByZWRlbGVnYXRpb25SZXNwb25zZXMgfSA9IFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlLmRlY29kZShcbiAgICAgICAgICAgIGRlY29kZUJhc2U2NChyZXN1bHQua2V5KVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFyZWRlbGVnYXRpb25SZXNwb25zZXMpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHJlZGVsZWdhdGlvblJlc3BvbnNlcyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZWRlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgaWYgKCFyZXN1bHQ/LmtleSkgdGhyb3cgdGhyb3dSZWRhY3RlZGBFcnJvciBwYXJzaW5nIHJlc3VsdCAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzIH0gPSBRdWVyeVJlZGVsZWdhdGlvbnNSZXNwb25zZS5kZWNvZGUoXG4gICAgICAgICAgICBkZWNvZGVCYXNlNjQocmVzdWx0LmtleSlcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghcmVkZWxlZ2F0aW9uUmVzcG9uc2VzKVxuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIHJlZGVsZWdhdGlvblJlc3BvbnNlcyBrZXk6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbihyZWRlbGVnYXRpb25SZXNwb25zZXMpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmV3YXJkUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgaWYgKCFyZXN1bHQ/LmtleSkgdGhyb3cgdGhyb3dSZWRhY3RlZGBFcnJvciBwYXJzaW5nIHJlc3VsdCAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgcmV3YXJkcyB9ID0gUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1Jlc3BvbnNlLmRlY29kZShcbiAgICAgICAgICAgIGRlY29kZUJhc2U2NChyZXN1bHQua2V5KVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFyZXdhcmRzKSB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgcmV3YXJkcyBrZXk6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbihyZXdhcmRzLm1hcCh0b1RydW5jYXRlZERlbm9tQW1vdW50KSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXdhcmRzUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBpZiAoIXJlc3VsdD8ua2V5KSB0aHJvdyB0aHJvd1JlZGFjdGVkYEVycm9yIHBhcnNpbmcgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyByZXdhcmRzLCB0b3RhbCB9ID0gUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVzcG9uc2UuZGVjb2RlKFxuICAgICAgICAgICAgZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXJld2FyZHMgfHwgIXRvdGFsKVxuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIHJld2FyZHMgb3IgdG90YWwga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgcmV3YXJkczogcmV3YXJkcy5tYXAoKHJld2FyZCkgPT4gKHtcbiAgICAgICAgICAgICAgdmFsaWRhdG9yOiB0b0Nvc21vc1ZhbGlkYXRvckFkZHJlc3MocmV3YXJkLCBjaGFpbkFkZHJlc3MuY2hhaW5JZCksXG4gICAgICAgICAgICAgIHJld2FyZDogcmV3YXJkLnJld2FyZC5tYXAodG9UcnVuY2F0ZWREZW5vbUFtb3VudClcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgIHRvdGFsOiB0b3RhbC5tYXAodG9UcnVuY2F0ZWREZW5vbUFtb3VudClcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGFsbEJhbGFuY2VzUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgbGV0IHJlc3BvbnNlO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IFF1ZXJ5QWxsQmFsYW5jZXNSZXNwb25zZS5kZWNvZGUoXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIGRlY29kZUJhc2U2NChyZXN1bHQua2V5KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGNhdGNoIChjYXVzZSkge1xuICAgICAgICAgICAgdGhyb3cgbWFrZUVycm9yKFxuICAgICAgICAgICAgICBgRXJyb3IgcGFyc2luZyBRdWVyeUFsbEJhbGFuY2VzIHJlc3VsdCAke3F1b3RlKHJlc3VsdCl9YCxcbiAgICAgICAgICAgICAgdm9pZCAwLFxuICAgICAgICAgICAgICB7IGNhdXNlIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHsgYmFsYW5jZXMgfSA9IHJlc3BvbnNlO1xuICAgICAgICAgIGlmICghYmFsYW5jZXMpIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCBiYWxhbmNlcyBrZXk6ICR7cXVvdGUocmVzdWx0KX1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oYmFsYW5jZXMubWFwKChjb2luKSA9PiB0b0Rlbm9tQW1vdW50KGNvaW4pKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB1bmRlbGVnYXRlV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChyZXN1bHQpIHtcbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHRyeURlY29kZVJlc3BvbnNlKFxuICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgTXNnVW5kZWxlZ2F0ZVJlc3BvbnNlLmZyb21Qcm90b01zZ1xuICAgICAgICAgICk7XG4gICAgICAgICAgdHJhY2UzKFwidW5kZWxlZ2F0ZSByZXNwb25zZVwiLCByZXNwb25zZSk7XG4gICAgICAgICAgY29uc3QgeyBjb21wbGV0aW9uVGltZSB9ID0gcmVzcG9uc2U7XG4gICAgICAgICAgY29tcGxldGlvblRpbWUgfHwgdGhyb3dSZWRhY3RlZGBObyBjb21wbGV0aW9uIHRpbWUgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIEUodGhpcy5zdGF0ZS50aW1lcikud2FrZUF0KGNvbXBsZXRpb25UaW1lLnNlY29uZHMgKyBtYXhDbG9ja1NrZXcpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICByZXR1cm5Wb2lkV2F0Y2hlcjoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCkge1xuICAgICAgICAgIHRyYWNlMyhcIlJlc3VsdFwiLCByZXN1bHQpO1xuICAgICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3aXRoZHJhd1Jld2FyZFdhdGNoZXI6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0KSB7XG4gICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB0cnlEZWNvZGVSZXNwb25zZShcbiAgICAgICAgICAgIHJlc3VsdCxcbiAgICAgICAgICAgIE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2UuZnJvbVByb3RvTXNnXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0cmFjZTMoXCJ3aXRoZHJhd1Jld2FyZCByZXNwb25zZVwiLCByZXNwb25zZSk7XG4gICAgICAgICAgY29uc3QgeyBhbW91bnQ6IGNvaW5zIH0gPSByZXNwb25zZTtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKGNvaW5zLm1hcCh0b0Rlbm9tQW1vdW50KSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0cmFuc2ZlcldhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFt7IHRyYW5zZmVyQ2hhbm5lbCB9LCB0aW1lb3V0VGltZXN0YW1wXSwgeyBvcHRzLCB0b2tlbjogdG9rZW4yLCBkZXN0aW5hdGlvbiB9KSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUodGhpcy5mYWNldHMuaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoW1xuICAgICAgICAgICAgQW55LnRvSlNPTihcbiAgICAgICAgICAgICAgTXNnVHJhbnNmZXIudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgc291cmNlUG9ydDogdHJhbnNmZXJDaGFubmVsLnBvcnRJZCxcbiAgICAgICAgICAgICAgICBzb3VyY2VDaGFubmVsOiB0cmFuc2ZlckNoYW5uZWwuY2hhbm5lbElkLFxuICAgICAgICAgICAgICAgIHRva2VuOiB0b2tlbjIsXG4gICAgICAgICAgICAgICAgc2VuZGVyOiB0aGlzLnN0YXRlLmNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICByZWNlaXZlcjogZGVzdGluYXRpb24udmFsdWUsXG4gICAgICAgICAgICAgICAgdGltZW91dEhlaWdodDogb3B0cz8udGltZW91dEhlaWdodCA/PyB7XG4gICAgICAgICAgICAgICAgICByZXZpc2lvbkhlaWdodDogMG4sXG4gICAgICAgICAgICAgICAgICByZXZpc2lvbk51bWJlcjogMG5cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRpbWVvdXRUaW1lc3RhbXAsXG4gICAgICAgICAgICAgICAgbWVtbzogb3B0cz8ubWVtbyA/PyBcIlwiXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgXSk7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGludml0YXRpb25NYWtlcnM6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBEZWxlZ2F0ZSh2YWxpZGF0b3IsIGFtb3VudCkge1xuICAgICAgICAgIHRyYWNlMyhcIkRlbGVnYXRlXCIsIHZhbGlkYXRvciwgYW1vdW50KTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIuZGVsZWdhdGUodmFsaWRhdG9yLCBhbW91bnQpKTtcbiAgICAgICAgICB9LCBcIkRlbGVnYXRlXCIpO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgUmVkZWxlZ2F0ZShzcmNWYWxpZGF0b3IsIGRzdFZhbGlkYXRvciwgYW1vdW50KSB7XG4gICAgICAgICAgdHJhY2UzKFwiUmVkZWxlZ2F0ZVwiLCBzcmNWYWxpZGF0b3IsIGRzdFZhbGlkYXRvciwgYW1vdW50KTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMuaG9sZGVyLnJlZGVsZWdhdGUoc3JjVmFsaWRhdG9yLCBkc3RWYWxpZGF0b3IsIGFtb3VudClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSwgXCJSZWRlbGVnYXRlXCIpO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgV2l0aGRyYXdSZXdhcmQodmFsaWRhdG9yKSB7XG4gICAgICAgICAgdHJhY2UzKFwiV2l0aGRyYXdSZXdhcmRcIiwgdmFsaWRhdG9yKTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIud2l0aGRyYXdSZXdhcmQodmFsaWRhdG9yKSk7XG4gICAgICAgICAgfSwgXCJXaXRoZHJhd1Jld2FyZFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgVW5kZWxlZ2F0ZShkZWxlZ2F0aW9ucykge1xuICAgICAgICAgIHRyYWNlMyhcIlVuZGVsZWdhdGVcIiwgZGVsZWdhdGlvbnMpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci51bmRlbGVnYXRlKGRlbGVnYXRpb25zKSk7XG4gICAgICAgICAgfSwgXCJVbmRlbGVnYXRlXCIpO1xuICAgICAgICB9LFxuICAgICAgICBEZWFjdGl2YXRlQWNjb3VudCgpIHtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIuZGVhY3RpdmF0ZSgpKTtcbiAgICAgICAgICB9LCBcIkRlYWN0aXZhdGVBY2NvdW50XCIpO1xuICAgICAgICB9LFxuICAgICAgICBSZWFjdGl2YXRlQWNjb3VudCgpIHtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIucmVhY3RpdmF0ZSgpKTtcbiAgICAgICAgICB9LCBcIlJlYWN0aXZhdGVBY2NvdW50XCIpO1xuICAgICAgICB9LFxuICAgICAgICBTZW5kKCkge1xuICAgICAgICAgIGNvbnN0IG9mZmVySGFuZGxlciA9IChzZWF0LCB7IHRvQWNjb3VudCwgYW1vdW50IH0pID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5zZW5kKHRvQWNjb3VudCwgYW1vdW50KSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKG9mZmVySGFuZGxlciwgXCJTZW5kXCIpO1xuICAgICAgICB9LFxuICAgICAgICBTZW5kQWxsKCkge1xuICAgICAgICAgIGNvbnN0IG9mZmVySGFuZGxlciA9IChzZWF0LCB7IHRvQWNjb3VudCwgYW1vdW50cyB9KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIuc2VuZEFsbCh0b0FjY291bnQsIGFtb3VudHMpKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24ob2ZmZXJIYW5kbGVyLCBcIlNlbmRBbGxcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBUcmFuc2ZlckFjY291bnQoKSB7XG4gICAgICAgICAgdGhyb3cgRXJyb3IoXCJub3QgeWV0IGltcGxlbWVudGVkXCIpO1xuICAgICAgICB9LFxuICAgICAgICBUcmFuc2ZlcigpIHtcbiAgICAgICAgICBjb25zdCBvZmZlckhhbmRsZXIgPSAoc2VhdCwgeyBhbW91bnQsIGRlc3RpbmF0aW9uLCBvcHRzIH0pID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5ob2xkZXIudHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwgb3B0cylcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKG9mZmVySGFuZGxlciwgXCJUcmFuc2ZlclwiKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGhvbGRlcjoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGFzQ29udGludWluZ09mZmVyKCkge1xuICAgICAgICAgIHJldHVybiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBudWxsO1xuICAgICAgICAgICAgY29uc3QgeyBob2xkZXIsIGludml0YXRpb25NYWtlcnM6IGltIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IGludml0YXRpb25NYWtlcnMgPSAoXG4gICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICBpbVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBwdWJsaWNTdWJzY3JpYmVyczogYXdhaXQgd2hlbihob2xkZXIuZ2V0UHVibGljVG9waWNzKCkpLFxuICAgICAgICAgICAgICBpbnZpdGF0aW9uTWFrZXJzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0UHVibGljVG9waWNzKCkge1xuICAgICAgICAgIHJldHVybiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBudWxsO1xuICAgICAgICAgICAgY29uc3QgeyB0b3BpY0tpdCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghdG9waWNLaXQpIHRocm93IHRocm93UmVkYWN0ZWRgTm8gdG9waWNLaXQ7IHN0b3JhZ2VOb2RlIG5vdCBwcm92aWRlZGA7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgICAgICAgYWNjb3VudDoge1xuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBQVUJMSUNfVE9QSUNTLmFjY291bnRbMF0sXG4gICAgICAgICAgICAgICAgc3Vic2NyaWJlcjogdG9waWNLaXQuc3Vic2NyaWJlcixcbiAgICAgICAgICAgICAgICBzdG9yYWdlUGF0aDogYXdhaXQgdG9waWNLaXQucmVjb3JkZXIuZ2V0U3RvcmFnZVBhdGgoKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEFkZHJlc3MoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuY2hhaW5BZGRyZXNzO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBkZWxlZ2F0ZSh2YWxpZGF0b3IsIGFtb3VudCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJkZWxlZ2F0ZVwiLCB2YWxpZGF0b3IsIGFtb3VudCk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IGFtb3VudEFzQ29pbiA9IGhlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGhlbHBlci5vd25lZCgpKS5leGVjdXRlRW5jb2RlZFR4KFtcbiAgICAgICAgICAgICAgQW55LnRvSlNPTihcbiAgICAgICAgICAgICAgICBNc2dEZWxlZ2F0ZS50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIHZhbGlkYXRvckFkZHJlc3M6IHZhbGlkYXRvci52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIGFtb3VudDogYW1vdW50QXNDb2luXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHJlZGVsZWdhdGUoc3JjVmFsaWRhdG9yLCBkc3RWYWxpZGF0b3IsIGFtb3VudCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJyZWRlbGVnYXRlXCIsIHNyY1ZhbGlkYXRvciwgZHN0VmFsaWRhdG9yLCBhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShoZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChbXG4gICAgICAgICAgICAgIEFueS50b0pTT04oXG4gICAgICAgICAgICAgICAgTXNnQmVnaW5SZWRlbGVnYXRlLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yU3JjQWRkcmVzczogc3JjVmFsaWRhdG9yLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yRHN0QWRkcmVzczogZHN0VmFsaWRhdG9yLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgYW1vdW50OiBoZWxwZXIuYW1vdW50VG9Db2luKGFtb3VudClcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgcmVzdWx0cyxcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHdpdGhkcmF3UmV3YXJkKHZhbGlkYXRvcikge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJ3aXRoZHJhd1Jld2FyZFwiLCB2YWxpZGF0b3IpO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBjb25zdCBtc2cgPSBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyZXNzOiB2YWxpZGF0b3IudmFsdWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc3QgYWNjb3VudCA9IGhlbHBlci5vd25lZCgpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoYWNjb3VudCkuZXhlY3V0ZUVuY29kZWRUeChbQW55LnRvSlNPTihtc2cpXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMud2l0aGRyYXdSZXdhcmRXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEJhbGFuY2UoZGVub20pIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeUJhbGFuY2VSZXF1ZXN0LnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgYWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgZGVub206IGNvZXJjZURlbm9tKGNoYWluSHViLCBkZW5vbSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5iYWxhbmNlUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRCYWxhbmNlcygpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeUFsbEJhbGFuY2VzUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLmFsbEJhbGFuY2VzUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNlbmQodG9BY2NvdW50LCBhbW91bnQpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwic2VuZFwiLCB0b0FjY291bnQsIGFtb3VudCk7XG4gICAgICAgICAgICBjb25zdCBjb3Ntb3NEZXN0ID0gY2hhaW5IdWIuY29lcmNlQ29zbW9zQWRkcmVzcyh0b0FjY291bnQpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBjb3Ntb3NEZXN0LmNoYWluSWQgPT09IGNoYWluQWRkcmVzcy5jaGFpbklkIHx8IHRocm93UmVkYWN0ZWRgYmFuay9zZW5kIGNhbm5vdCBzZW5kIHRvIGEgZGlmZmVyZW50IGNoYWluICR7cXVvdGUoY29zbW9zRGVzdC5jaGFpbklkKX1gO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICBFKGhlbHBlci5vd25lZCgpKS5leGVjdXRlRW5jb2RlZFR4KFtcbiAgICAgICAgICAgICAgICBBbnkudG9KU09OKFxuICAgICAgICAgICAgICAgICAgTXNnU2VuZC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgICAgZnJvbUFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgdG9BZGRyZXNzOiBjb3Ntb3NEZXN0LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IFtoZWxwZXIuYW1vdW50VG9Db2luKGFtb3VudCldXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc2VuZEFsbCh0b0FjY291bnQsIGFtb3VudHMpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwic2VuZEFsbFwiLCB0b0FjY291bnQsIGFtb3VudHMpO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUoaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoW1xuICAgICAgICAgICAgICAgIEFueS50b0pTT04oXG4gICAgICAgICAgICAgICAgICBNc2dTZW5kLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgICBmcm9tQWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICB0b0FkZHJlc3M6IHRvQWNjb3VudC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnRzLm1hcCgoeCkgPT4gaGVscGVyLmFtb3VudFRvQ29pbih4KSlcbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwgb3B0cykge1xuICAgICAgICAgIHRyYWNlMyhcInRyYW5zZmVyXCIsIGRlc3RpbmF0aW9uLCBhbW91bnQsIG9wdHMpO1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb3Ntb3NEZXN0ID0gY2hhaW5IdWIuY29lcmNlQ29zbW9zQWRkcmVzcyhkZXN0aW5hdGlvbik7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB0b2tlbjIgPSBoZWxwZXIuYW1vdW50VG9Db2luKGFtb3VudCk7XG4gICAgICAgICAgICBjb25zdCBjb25uZWN0aW9uSW5mb1YgPSB3YXRjaChcbiAgICAgICAgICAgICAgY2hhaW5IdWIuZ2V0Q29ubmVjdGlvbkluZm8oXG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5jaGFpbkFkZHJlc3MuY2hhaW5JZCxcbiAgICAgICAgICAgICAgICBjb3Ntb3NEZXN0LmNoYWluSWRcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgYWxsVm93cyhbXG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbkluZm9WLFxuICAgICAgICAgICAgICAgIHRpbWVzdGFtcEhlbHBlci52b3dPclZhbHVlRnJvbU9wdHMob3B0cylcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnRyYW5zZmVyV2F0Y2hlcixcbiAgICAgICAgICAgICAgeyBvcHRzLCB0b2tlbjogdG9rZW4yLCBkZXN0aW5hdGlvbjogY29zbW9zRGVzdCB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdHJhbnNmZXJTdGVwcyhhbW91bnQsIG1zZykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwidHJhbnNmZXJTdGVwcyBnb3RcIiwgYW1vdW50LCBtc2cpO1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB0aHJvd1JlZGFjdGVkYG5vdCB5ZXQgaW1wbGVtZW50ZWRgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHdpdGhkcmF3UmV3YXJkcygpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4gdGhyb3dSZWRhY3RlZGBOb3QgSW1wbGVtZW50ZWQuIFRyeSB1c2luZyB3aXRoZHJhd1Jld2FyZC5gKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB1bmRlbGVnYXRlKGRlbGVnYXRpb25zKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcInVuZGVsZWdhdGVcIiwgZGVsZWdhdGlvbnMpO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBkZWxlZ2F0aW9ucy5ldmVyeShcbiAgICAgICAgICAgICAgKGQpID0+IGQuZGVsZWdhdG9yID8gZC5kZWxlZ2F0b3IudmFsdWUgPT09IGNoYWluQWRkcmVzcy52YWx1ZSA6IHRydWVcbiAgICAgICAgICAgICkgfHwgdGhyb3dSZWRhY3RlZGBTb21lIGRlbGVnYXRpb24gcmVjb3JkIGlzIGZvciBhbm90aGVyIGRlbGVnYXRvcmA7XG4gICAgICAgICAgICBjb25zdCB1bmRlbGVnYXRlViA9IHdhdGNoKFxuICAgICAgICAgICAgICBFKGhlbHBlci5vd25lZCgpKS5leGVjdXRlRW5jb2RlZFR4KFxuICAgICAgICAgICAgICAgIGRlbGVnYXRpb25zLm1hcChcbiAgICAgICAgICAgICAgICAgICh7IHZhbGlkYXRvciwgYW1vdW50IH0pID0+IEFueS50b0pTT04oXG4gICAgICAgICAgICAgICAgICAgIE1zZ1VuZGVsZWdhdGUudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRvckFkZHJlc3M6IHZhbGlkYXRvci52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGNvZXJjZUNvaW4oY2hhaW5IdWIsIGFtb3VudClcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnVuZGVsZWdhdGVXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHVuZGVsZWdhdGVWLCB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGRlYWN0aXZhdGUoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHdhdGNoKEUodGhpcy5mYWNldHMuaGVscGVyLm93bmVkKCkpLmRlYWN0aXZhdGUoKSkpO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICByZWFjdGl2YXRlKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB3YXRjaChFKHRoaXMuZmFjZXRzLmhlbHBlci5vd25lZCgpKS5yZWFjdGl2YXRlKCkpKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXREZWxlZ2F0aW9uKHZhbGlkYXRvcikge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJnZXREZWxlZ2F0aW9uXCIsIHZhbGlkYXRvcik7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5RGVsZWdhdGlvblJlcXVlc3QudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyOiB2YWxpZGF0b3IudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5kZWxlZ2F0aW9uUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0RGVsZWdhdGlvbnMoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImdldERlbGVnYXRpb25zXCIpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHI6IGNoYWluQWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLmRlbGVnYXRpb25zUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRVbmJvbmRpbmdEZWxlZ2F0aW9uKHZhbGlkYXRvcikge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJnZXRVbmJvbmRpbmdEZWxlZ2F0aW9uXCIsIHZhbGlkYXRvcik7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlcXVlc3QudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyOiB2YWxpZGF0b3IudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy51bmJvbmRpbmdEZWxlZ2F0aW9uUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0VW5ib25kaW5nRGVsZWdhdGlvbnMoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImdldFVuYm9uZGluZ0RlbGVnYXRpb25zXCIpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHI6IGNoYWluQWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLnVuYm9uZGluZ0RlbGVnYXRpb25zUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRSZWRlbGVnYXRpb25zKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJnZXRSZWRlbGVnYXRpb25zXCIpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeVJlZGVsZWdhdGlvbnNSZXF1ZXN0LnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcjogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgIGRzdFZhbGlkYXRvckFkZHI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICBzcmNWYWxpZGF0b3JBZGRyOiBcIlwiXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMucmVkZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRSZXdhcmQodmFsaWRhdG9yKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImdldFJld2FyZFwiLCB2YWxpZGF0b3IpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIHZhbGlkYXRvckFkZHJlc3M6IHZhbGlkYXRvci52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLnJld2FyZFF1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0UmV3YXJkcygpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwiZ2V0UmV3YXJkc1wiKTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzLCBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCFpY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluQWRkcmVzcy5jaGFpbklkKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaWNxQ29ubmVjdGlvbikucXVlcnkoW1xuICAgICAgICAgICAgICB0b1JlcXVlc3RRdWVyeUpzb24oXG4gICAgICAgICAgICAgICAgUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLnJld2FyZHNRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBleGVjdXRlRW5jb2RlZFR4KG1zZ3MsIG9wdHMpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coXG4gICAgICAgICAgICAoKSA9PiB3YXRjaChFKHRoaXMuZmFjZXRzLmhlbHBlci5vd25lZCgpKS5leGVjdXRlRW5jb2RlZFR4KG1zZ3MsIG9wdHMpKVxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIGRlcG9zaXRGb3JCdXJuKGRlc3RpbmF0aW9uLCBhbW91bnQsIGNhbGxlcikge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJkZXBvc2l0Rm9yQnVyblwiLCB7IGRlc3RpbmF0aW9uLCBhbW91bnQgfSk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3RQYXJ0cyA9IHBhcnNlQWNjb3VudElkKGRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIGNvbnN0IGNoYWluSWQgPSBgJHtkZXN0UGFydHMubmFtZXNwYWNlfToke2Rlc3RQYXJ0cy5yZWZlcmVuY2V9YDtcbiAgICAgICAgICAgIGNvbnN0IHsgY2N0cERlc3RpbmF0aW9uRG9tYWluIH0gPSBjaGFpbkh1Yi5nZXRDaGFpbkluZm9CeUNoYWluSWQoY2hhaW5JZCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNjdHBEZXN0aW5hdGlvbkRvbWFpbiAhPT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoY2hhaW5JZCl9IGRvZXMgbm90IGhhdmUgXCJjY3RwRGVzdGluYXRpb25Eb21haW5cIiBzZXQgaW4gQ2hhaW5JbmZvYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGRlcG9zaXRGb3JCdXJuID0ge1xuICAgICAgICAgICAgICBhbW91bnQ6IGhlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KT8uYW1vdW50LFxuICAgICAgICAgICAgICBmcm9tOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgIGRlc3RpbmF0aW9uRG9tYWluOiBjY3RwRGVzdGluYXRpb25Eb21haW4sXG4gICAgICAgICAgICAgIG1pbnRSZWNpcGllbnQ6IGFjY291bnRJZFRvMzJCeXRlcyhkZXN0aW5hdGlvbiksXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIGJ1cm5Ub2tlbjogXCJ1dXNkY1wiXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25DYWxsZXIgPSAoKCkgPT4ge1xuICAgICAgICAgICAgICBpZiAoIWNhbGxlcikgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgICAgICAgY29uc3QgY2FsbGVyUGFydHMgPSBwYXJzZUFjY291bnRJZChjYWxsZXIpO1xuICAgICAgICAgICAgICBjYWxsZXJQYXJ0cy5uYW1lc3BhY2UgPT09IGRlc3RQYXJ0cy5uYW1lc3BhY2UgfHwgdGhyb3dSZWRhY3RlZGBjYWxsZXIgJHtxdW90ZShjYWxsZXIpfSBtdXN0IGJlIGluIHNhbWUgbmFtZXNwYWNlIGFzIGRlc3RpbmF0aW9uICR7cXVvdGUoZGVzdGluYXRpb24pfWA7XG4gICAgICAgICAgICAgIHJldHVybiBhY2NvdW50SWRUbzMyQnl0ZXMoY2FsbGVyKTtcbiAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUoaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoW1xuICAgICAgICAgICAgICAgIEFueS50b0pTT04oXG4gICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbkNhbGxlciA/IE1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlci50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgICAgLi4uZGVwb3NpdEZvckJ1cm4sXG4gICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uQ2FsbGVyXG4gICAgICAgICAgICAgICAgICB9KSA6IE1zZ0RlcG9zaXRGb3JCdXJuLnRvUHJvdG9Nc2coZGVwb3NpdEZvckJ1cm4pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnRLaXQ7XG59O1xudmFyIHByZXBhcmVDb3Ntb3NPcmNoZXN0cmF0aW9uQWNjb3VudCA9ICh6b25lLCB7IGNoYWluSHViLCBtYWtlUmVjb3JkZXJLaXQsIHRpbWVyU2VydmljZSwgdm93VG9vbHMsIHpjZiB9KSA9PiB7XG4gIGNvbnN0IG1ha2VLaXQgPSBwcmVwYXJlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnRLaXQoem9uZSwge1xuICAgIGNoYWluSHViLFxuICAgIG1ha2VSZWNvcmRlcktpdCxcbiAgICB0aW1lclNlcnZpY2UsXG4gICAgdm93VG9vbHMsXG4gICAgemNmXG4gIH0pO1xuICByZXR1cm4gKC4uLmFyZ3MpID0+IG1ha2VLaXQoLi4uYXJncykuaG9sZGVyO1xufTtcblxuLy9cbnZhciBwcmVwYXJlTG9jYWxDaGFpbkZhY2FkZUtpdCA9ICh6b25lLCB7XG4gIG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0LFxuICBhZ29yaWNOYW1lcyxcbiAgbG9jYWxjaGFpbixcbiAgLy9cbiAgLy9cbiAgc3RvcmFnZU5vZGUsXG4gIHZvd1Rvb2xzOiB7IGFsbFZvd3MsIHdhdGNoLCBhc1ZvdyB9XG59KSA9PiB6b25lLmV4b0NsYXNzS2l0KFxuICBcIkxvY2FsQ2hhaW5GYWNhZGVcIixcbiAge1xuICAgIHB1YmxpYzogTS5pbnRlcmZhY2UoXCJMb2NhbENoYWluRmFjYWRlXCIsIHtcbiAgICAgIC4uLmNoYWluRmFjYWRlTWV0aG9kcyxcbiAgICAgIHF1ZXJ5OiBNLmNhbGwoTS5hcnJheU9mKFR5cGVkSnNvblNoYXBlKSkucmV0dXJucyhWb3dTaGFwZSksXG4gICAgICBnZXRWQmFua0Fzc2V0SW5mbzogTS5jYWxsKCkub3B0aW9uYWwoTS5ib29sZWFuKCkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgfSksXG4gICAgdmJhbmtBc3NldFZhbHVlc1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwidmJhbmtBc3NldFZhbHVlc1dhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhWb3dTaGFwZSlcbiAgICB9KSxcbiAgICBtYWtlQWNjb3VudFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwibWFrZUFjY291bnRXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoW00ucmVtb3RhYmxlKFwiTENBIEFjY291bnRcIiksIE0uc3RyaW5nKCldKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgfSksXG4gICAgbWFrZUNoaWxkTm9kZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwibWFrZUNoaWxkTm9kZVdhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLm9yKE0ucmVtb3RhYmxlKCksIE0udW5kZWZpbmVkKCkpKS5vcHRpb25hbCh7IGFjY291bnQ6IE0ucmVtb3RhYmxlKCksIGFkZHJlc3M6IE0uc3RyaW5nKCkgfSkucmV0dXJucyhNLnJlbW90YWJsZSgpKVxuICAgIH0pXG4gIH0sXG4gIC8qXG5cbiAgICovXG4gIChsb2NhbENoYWluSW5mbykgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBsb2NhbENoYWluSW5mbyxcbiAgICAgIHZiYW5rQXNzZXRzOiAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZvaWQgMFxuICAgICAgKVxuICAgIH07XG4gIH0sXG4gIHtcbiAgICBwdWJsaWM6IHtcbiAgICAgIGdldENoYWluSW5mbygpIHtcbiAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuc3RhdGUubG9jYWxDaGFpbkluZm8pO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIG1ha2VBY2NvdW50KCkge1xuICAgICAgICBjb25zdCBsY2FQID0gRShsb2NhbGNoYWluKS5tYWtlQWNjb3VudCgpO1xuICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgLy9cbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vXG4gICAgICAgICAgYWxsVm93cyhbbGNhUCwgaGVhcFZvd0UobGNhUCkuZ2V0QWRkcmVzcygpXSksXG4gICAgICAgICAgdGhpcy5mYWNldHMubWFrZUFjY291bnRXYXRjaGVyXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHF1ZXJ5KHJlcXVlc3RzKSB7XG4gICAgICAgIHJldHVybiB3YXRjaChFKGxvY2FsY2hhaW4pLnF1ZXJ5TWFueShyZXF1ZXN0cykpO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBnZXRWQmFua0Fzc2V0SW5mbygpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBjb25zdCB7IHZiYW5rQXNzZXRzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICh2YmFua0Fzc2V0cykge1xuICAgICAgICAgICAgcmV0dXJuIHZiYW5rQXNzZXRzO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB2YmFua0Fzc2V0TmFtZUh1YlAgPSBFKGFnb3JpY05hbWVzKS5sb29rdXAoXCJ2YmFua0Fzc2V0XCIpO1xuICAgICAgICAgIGNvbnN0IHZiYW5rQXNzZXRWYWx1ZXNQID0gRSh2YmFua0Fzc2V0TmFtZUh1YlApLnZhbHVlcygpO1xuICAgICAgICAgIGNvbnN0IHsgdmJhbmtBc3NldFZhbHVlc1dhdGNoZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIHJldHVybiB3YXRjaCh2YmFua0Fzc2V0VmFsdWVzUCwgdmJhbmtBc3NldFZhbHVlc1dhdGNoZXIpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHZiYW5rQXNzZXRWYWx1ZXNXYXRjaGVyOiB7XG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKGFzc2V0cykge1xuICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgIHN0YXRlLnZiYW5rQXNzZXRzID0gYXNzZXRzO1xuICAgICAgICAgIHJldHVybiBhc3NldHM7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUFjY291bnRXYXRjaGVyOiB7XG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKFthY2NvdW50LCBhZGRyZXNzXSkge1xuICAgICAgICBjb25zdCBvcHRpb25hbFN0b3JhZ2VOb2RlID0gc3RvcmFnZU5vZGUgPyBFKHN0b3JhZ2VOb2RlKS5tYWtlQ2hpbGROb2RlKGFkZHJlc3MpIDogdm9pZCAwO1xuICAgICAgICByZXR1cm4gd2F0Y2gob3B0aW9uYWxTdG9yYWdlTm9kZSwgdGhpcy5mYWNldHMubWFrZUNoaWxkTm9kZVdhdGNoZXIsIHtcbiAgICAgICAgICBhY2NvdW50LFxuICAgICAgICAgIGFkZHJlc3NcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtYWtlQ2hpbGROb2RlV2F0Y2hlcjoge1xuICAgICAgLypcblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKGNoaWxkTm9kZSwgeyBhY2NvdW50LCBhZGRyZXNzIH0pIHtcbiAgICAgICAgY29uc3QgeyBsb2NhbENoYWluSW5mbyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgeyBob2xkZXIgfSA9IG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0KHtcbiAgICAgICAgICBhY2NvdW50LFxuICAgICAgICAgIGFkZHJlc3M6IGhhcmRlbih7XG4gICAgICAgICAgICB2YWx1ZTogYWRkcmVzcyxcbiAgICAgICAgICAgIGVuY29kaW5nOiBcImJlY2gzMlwiLFxuICAgICAgICAgICAgY2hhaW5JZDogbG9jYWxDaGFpbkluZm8uY2hhaW5JZFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgc3RvcmFnZU5vZGU6IGNoaWxkTm9kZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGhvbGRlcjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG5oYXJkZW4ocHJlcGFyZUxvY2FsQ2hhaW5GYWNhZGVLaXQpO1xudmFyIHByZXBhcmVMb2NhbENoYWluRmFjYWRlID0gKHpvbmUsIHBvd2VycykgPT4ge1xuICBjb25zdCBtYWtlTG9jYWxDaGFpbkZhY2FkZUtpdCA9IHByZXBhcmVMb2NhbENoYWluRmFjYWRlS2l0KHpvbmUsIHBvd2Vycyk7XG4gIHJldHVybiBwaWNrRmFjZXQobWFrZUxvY2FsQ2hhaW5GYWNhZGVLaXQsIFwicHVibGljXCIpO1xufTtcbmhhcmRlbihwcmVwYXJlTG9jYWxDaGFpbkZhY2FkZSk7XG5cbi8vXG52YXIgdHJhY2U0ID0gbWFrZVRyYWNlcihcIlBhY2tldFRvb2xzXCIpO1xudmFyIHsgdG9DYXBEYXRhIH0gPSBtYWtlTWFyc2hhbCh2b2lkIDAsIHZvaWQgMCwge1xuICBtYXJzaGFsTmFtZTogXCJKdXN0RW5jb2RlclwiLFxuICBzZXJpYWxpemVCb2R5Rm9ybWF0OiBcImNhcGRhdGFcIlxufSk7XG52YXIganVzdCA9IChvYmopID0+IHtcbiAgY29uc3QgeyBib2R5IH0gPSB0b0NhcERhdGEob2JqKTtcbiAgcmV0dXJuIGRlY29kZVRvSnVzdGluKEpTT04ucGFyc2UoYm9keSksIGZhbHNlKTtcbn07XG52YXIgeyBWb3ckOiBWb3ckNCB9ID0gU2hhcGU7XG52YXIgRVZvdyQgPSAoc2hhcGUpID0+IE0ub3IoVm93JDQoc2hhcGUpLCBNLnByb21pc2UoXG4gIC8qICAgICAgICovXG4pKTtcbnZhciBzaW5rNSA9ICgpID0+IHtcbn07XG5oYXJkZW4oc2luazUpO1xudmFyIHByZXBhcmVQYWNrZXRUb29scyA9ICh6b25lLCB2b3dUb29scykgPT4ge1xuICBjb25zdCB7IGFsbFZvd3MsIG1ha2VWb3dLaXQsIHdhdGNoLCB3aGVuIH0gPSB2b3dUb29scztcbiAgY29uc3QgbWFrZVBhY2tldFRvb2xzS2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIlBhY2tldFRvb2xzS2l0XCIsXG4gICAge1xuICAgICAgcHVibGljOiBNLmludGVyZmFjZShcIlBhY2tldFRvb2xzXCIsIHtcbiAgICAgICAgc2VuZFRoZW5XYWl0Rm9yQWNrOiBNLmNhbGwoRVZvdyQoTS5yZW1vdGFibGUoXCJQYWNrZXRTZW5kZXJcIikpKS5vcHRpb25hbChNLmFueSgpKS5yZXR1cm5zKEVWb3ckKE0uYW55KCkpKSxcbiAgICAgICAgbWF0Y2hGaXJzdFBhY2tldDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoRVZvdyQoTS5hbnkoKSkpLFxuICAgICAgICBtb25pdG9yVHJhbnNmZXJzOiBNLmNhbGwoTS5yZW1vdGFibGUoXCJUYXJnZXRBcHBcIikpLnJldHVybnMoXG4gICAgICAgICAgRVZvdyQoTS5hbnkoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICB0YXA6IE0uaW50ZXJmYWNlKFwidGFwXCIsIHtcbiAgICAgICAgLy9cbiAgICAgICAgcmVjZWl2ZVVwY2FsbDogTS5jYWxsV2hlbihNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIG1vbml0b3JSZWdpc3RyYXRpb246IE0uaW50ZXJmYWNlKFwibW9uaXRvclJlZ2lzdHJhdGlvblwiLCB7XG4gICAgICAgIC8vXG4gICAgICAgIHVwZGF0ZVRhcmdldEFwcDogTS5jYWxsV2hlbihcbiAgICAgICAgICBNLmF3YWl0KE0ucmVtb3RhYmxlKFwiVGFyZ2V0QXBwXCIpKVxuICAgICAgICApLnJldHVybnMoKSxcbiAgICAgICAgLy9cbiAgICAgICAgcmV2b2tlOiBNLmNhbGxXaGVuKCkucmV0dXJucygpXG4gICAgICB9KSxcbiAgICAgIHdhdGNoUGFja2V0TWF0Y2g6IE0uaW50ZXJmYWNlKFwid2F0Y2hQYWNrZXRNYXRjaFwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSwgTS5yZWNvcmQoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICB3YXRjaFBhY2tldFBhdHRlcm46IE0uaW50ZXJmYWNlKFwid2F0Y2hQYWNrZXRQYXR0ZXJuXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpLCBNLnJlY29yZCgpKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSwgTS5yZWNvcmQoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICB3YXRjaERlY3JQZW5kaW5nUGF0dGVybnM6IE0uaW50ZXJmYWNlKFwid2F0Y2hEZWNyUGVuZGluZ1BhdHRlcm5zXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBzZW5kUGFja2V0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJzZW5kUGFja2V0V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoXG4gICAgICAgICAgW00ucmVjb3JkKCksIE0ucmVtb3RhYmxlKFwiUGFja2V0U2VuZGVyXCIpXSxcbiAgICAgICAgICBNLnJlY29yZCgpXG4gICAgICAgICkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBwYWNrZXRXYXNTZW50V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJwYWNrZXRXYXNTZW50V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoXG4gICAgICAgICAgeyBldmVudFBhdHRlcm46IE0ucGF0dGVybigpLCByZXN1bHRWOiBWb3ckNChNLmFueSgpKSB9LFxuICAgICAgICAgIE0ucmVjb3JkKClcbiAgICAgICAgKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHV0aWxzOiBNLmludGVyZmFjZShcInV0aWxzXCIsIHtcbiAgICAgICAgc3Vic2NyaWJlVG9UcmFuc2ZlcnM6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICB1bnN1YnNjcmliZUZyb21UcmFuc2ZlcnM6IE0uY2FsbCgpLnJldHVybnMoTS51bmRlZmluZWQoKSksXG4gICAgICAgIGluY3JQZW5kaW5nUGF0dGVybnM6IE0uY2FsbCgpLnJldHVybnMoVm93JDQoTS51bmRlZmluZWQoKSkpLFxuICAgICAgICBkZWNyUGVuZGluZ1BhdHRlcm5zOiBNLmNhbGwoKS5yZXR1cm5zKFZvdyQ0KE0udW5kZWZpbmVkKCkpKVxuICAgICAgfSksXG4gICAgICByZWplY3RSZXNvbHZlckFuZFJldGhyb3dXYXRjaGVyOiBNLmludGVyZmFjZShcInJlamVjdFJlc29sdmVyV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpLCB7XG4gICAgICAgICAgcmVzb2x2ZXI6IE0ucmVtb3RhYmxlKFwicmVzb2x2ZXJcIilcbiAgICAgICAgfSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSlcbiAgICB9LFxuICAgIC8qXG5cbiAgICAgKi9cbiAgICAobGNhKSA9PiB7XG4gICAgICBjb25zdCByZXNvbHZlclRvUGF0dGVybiA9IHpvbmUuZGV0YWNoZWQoKS5tYXBTdG9yZShcInJlc29sdmVyVG9QYXR0ZXJuXCIpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbGNhLFxuICAgICAgICByZWc6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBudWxsXG4gICAgICAgICksXG4gICAgICAgIHJlc29sdmVyVG9QYXR0ZXJuLFxuICAgICAgICB1cGNhbGxRdWV1ZTogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG51bGxcbiAgICAgICAgKSxcbiAgICAgICAgcGVuZGluZzogMCxcbiAgICAgICAgZXh0cmE6IG51bGwsXG4gICAgICAgIG1vbml0b3I6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBudWxsXG4gICAgICAgIClcbiAgICAgIH07XG4gICAgfSxcbiAgICB7XG4gICAgICBwdWJsaWM6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgLy9cbiAgICAgICAgYXN5bmMgbW9uaXRvclRyYW5zZmVycyhtb25pdG9yKSB7XG4gICAgICAgICAgY29uc3QgbXJlZyA9IHRoaXMuZmFjZXRzLm1vbml0b3JSZWdpc3RyYXRpb247XG4gICAgICAgICAgYXdhaXQgbXJlZy51cGRhdGVUYXJnZXRBcHAobW9uaXRvcik7XG4gICAgICAgICAgcmV0dXJuIG1yZWc7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG1hdGNoRmlyc3RQYWNrZXQocGF0dGVyblApIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy51dGlscy5pbmNyUGVuZGluZ1BhdHRlcm5zKCksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy53YXRjaFBhY2tldE1hdGNoLFxuICAgICAgICAgICAgeyBwYXR0ZXJuUCB9XG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHNlbmRUaGVuV2FpdEZvckFjayhwYWNrZXRTZW5kZXIsIG9wdHMgPSB7fSkge1xuICAgICAgICAgIGNvbnN0IHBhdHRlcm4gPSBtYWtlVm93S2l0KCk7XG4gICAgICAgICAgY29uc3QgbWF0Y2hWID0gd2F0Y2goXG4gICAgICAgICAgICBhbGxWb3dzKFtcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucHVibGljLm1hdGNoRmlyc3RQYWNrZXQocGF0dGVybi52b3cpLFxuICAgICAgICAgICAgICBwYWNrZXRTZW5kZXJcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMuc2VuZFBhY2tldFdhdGNoZXIsXG4gICAgICAgICAgICB7IG9wdHMgfVxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ViA9IHdhdGNoKG1hdGNoViwgdGhpcy5mYWNldHMucGFja2V0V2FzU2VudFdhdGNoZXIsIHtcbiAgICAgICAgICAgIG9wdHMsXG4gICAgICAgICAgICBwYXR0ZXJuUmVzb2x2ZXI6IHBhdHRlcm4ucmVzb2x2ZXJcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0ViwgdGhpcy5mYWNldHMucmVqZWN0UmVzb2x2ZXJBbmRSZXRocm93V2F0Y2hlciwge1xuICAgICAgICAgICAgcmVzb2x2ZXI6IHBhdHRlcm4ucmVzb2x2ZXJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG1vbml0b3JSZWdpc3RyYXRpb246IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAvL1xuICAgICAgICBhc3luYyB1cGRhdGVUYXJnZXRBcHAodGFwKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5tb25pdG9yID0gYXdhaXQgdGFwO1xuICAgICAgICAgIGF3YWl0IHRoaXMuZmFjZXRzLnV0aWxzLnN1YnNjcmliZVRvVHJhbnNmZXJzKCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgLy9cbiAgICAgICAgYXN5bmMgcmV2b2tlKCkge1xuICAgICAgICAgIHRoaXMuc3RhdGUubW9uaXRvciA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0YXA6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgYXN5bmMgcmVjZWl2ZVVwY2FsbChvYmopIHtcbiAgICAgICAgICBjb25zdCB7IG1vbml0b3IsIHJlc29sdmVyVG9QYXR0ZXJuLCB1cGNhbGxRdWV1ZSwgcGVuZGluZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB0cmFjZTQoXG4gICAgICAgICAgICBgVHJ5aW5nICR7cmVzb2x2ZXJUb1BhdHRlcm4uZ2V0U2l6ZSgpfSBjdXJyZW50IHBhdHRlcm5zIGFuZCAke3BlbmRpbmd9IHBlbmRpbmcgcGF0dGVybnMgYWdhaW5zdGAsXG4gICAgICAgICAgICBqdXN0KG9iailcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChtb25pdG9yKSB7XG4gICAgICAgICAgICB2b2lkIEUobW9uaXRvcikucmVjZWl2ZVVwY2FsbChvYmopO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3IgKGNvbnN0IFtyZXNvbHZlciwgcGF0dGVybl0gb2YgcmVzb2x2ZXJUb1BhdHRlcm4uZW50cmllcygpKSB7XG4gICAgICAgICAgICBpZiAobWF0Y2hlcyhvYmosIHBhdHRlcm4pKSB7XG4gICAgICAgICAgICAgIHRyYWNlNChcIk1hdGNoZWQgcGF0dGVybjpcIiwganVzdChwYXR0ZXJuKSk7XG4gICAgICAgICAgICAgIHJlc29sdmVyLnJlc29sdmUob2JqKTtcbiAgICAgICAgICAgICAgcmVzb2x2ZXJUb1BhdHRlcm4uZGVsZXRlKHJlc29sdmVyKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodXBjYWxsUXVldWUpIHtcbiAgICAgICAgICAgIHRyYWNlNChcIlN0YXNoaW5nIG9iamVjdCBpbiB1cGNhbGxRdWV1ZVwiKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUudXBjYWxsUXVldWUgPSBoYXJkZW4odXBjYWxsUXVldWUuY29uY2F0KG9iaikpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0cmFjZTQoXCJObyBtYXRjaCB5ZXQuXCIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgc2VuZFBhY2tldFdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3sgbWF0Y2ggfSwgc2VuZGVyXSwgY3R4KSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUoc2VuZGVyKS5zZW5kUGFja2V0KG1hdGNoLCBjdHgub3B0cykpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcGFja2V0V2FzU2VudFdhdGNoZXI6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoeyBldmVudFBhdHRlcm4sIHJlc3VsdFYgfSwgY3R4KSB7XG4gICAgICAgICAgY29uc3QgeyBwYXR0ZXJuUmVzb2x2ZXIgfSA9IGN0eDtcbiAgICAgICAgICBwYXR0ZXJuUmVzb2x2ZXIucmVzb2x2ZShldmVudFBhdHRlcm4pO1xuICAgICAgICAgIHJldHVybiByZXN1bHRWO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmVqZWN0UmVzb2x2ZXJBbmRSZXRocm93V2F0Y2hlcjoge1xuICAgICAgICBvblJlamVjdGVkKHJlaiwgeyByZXNvbHZlciB9KSB7XG4gICAgICAgICAgcmVzb2x2ZXIucmVqZWN0KHJlaik7XG4gICAgICAgICAgdGhyb3cgcmVqO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2F0Y2hQYWNrZXRNYXRjaDoge1xuICAgICAgICBvbkZ1bGZpbGxlZChfLCB7IHBhdHRlcm5QIH0pIHtcbiAgICAgICAgICBjb25zdCB7IHZvdywgcmVzb2x2ZXIgfSA9IG1ha2VWb3dLaXQoKTtcbiAgICAgICAgICBjb25zdCBwYXR0ZXJuViA9IHdhdGNoKFxuICAgICAgICAgICAgcGF0dGVyblAsXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy53YXRjaFBhY2tldFBhdHRlcm4sXG4gICAgICAgICAgICBoYXJkZW4oeyByZXNvbHZlciB9KVxuICAgICAgICAgICk7XG4gICAgICAgICAgd2F0Y2gocGF0dGVyblYsIHRoaXMuZmFjZXRzLndhdGNoRGVjclBlbmRpbmdQYXR0ZXJucyk7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IG1hdGNoOiB2b3csIHJlc29sdmVyIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2F0Y2hEZWNyUGVuZGluZ1BhdHRlcm5zOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmZhY2V0cy51dGlscy5kZWNyUGVuZGluZ1BhdHRlcm5zKCk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmFjZXRzLnV0aWxzLmRlY3JQZW5kaW5nUGF0dGVybnMoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdhdGNoUGFja2V0UGF0dGVybjoge1xuICAgICAgICBvbkZ1bGZpbGxlZChwYXR0ZXJuLCB7IHJlc29sdmVyIH0pIHtcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmVyVG9QYXR0ZXJuLCB1cGNhbGxRdWV1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB0cmFjZTQoXCJ3YXRjaFBhY2tldFBhdHRlcm4gb25GdWxmaWxsZWRcIiwganVzdChwYXR0ZXJuKSk7XG4gICAgICAgICAgaWYgKCF1cGNhbGxRdWV1ZSkge1xuICAgICAgICAgICAgdHJhY2U0KFwiTm8gdXBjYWxsIHF1ZXVlIHlldC4gIFNhdmUgdGhlIHBhdHRlcm4gZm9yIGxhdGVyLlwiKTtcbiAgICAgICAgICAgIHJlc29sdmVyVG9QYXR0ZXJuLmluaXQocmVzb2x2ZXIsIHBhdHRlcm4pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBpMiA9IHVwY2FsbFF1ZXVlLmZpbmRJbmRleCgob2JqKSA9PiBtYXRjaGVzKG9iaiwgcGF0dGVybikpO1xuICAgICAgICAgIGlmIChpMiA9PT0gLTEpIHtcbiAgICAgICAgICAgIHRyYWNlNChcIk5vIG1hdGNoIHlldC4gU2F2ZSB0aGUgcGF0dGVybiBmb3IgbGF0ZXIuXCIpO1xuICAgICAgICAgICAgcmVzb2x2ZXJUb1BhdHRlcm4uaW5pdChyZXNvbHZlciwgcGF0dGVybik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHRyYWNlNChcbiAgICAgICAgICAgIFwiU3VjY2VzcyEgUmVtb3ZlIHRoZSBtYXRjaGVkIG9iamVjdCBmcm9tIHRoZSBxdWV1ZS5cIixcbiAgICAgICAgICAgIGp1c3QodXBjYWxsUXVldWVbaTJdKVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmVzb2x2ZXIucmVzb2x2ZSh1cGNhbGxRdWV1ZVtpMl0pO1xuICAgICAgICAgIHRoaXMuc3RhdGUudXBjYWxsUXVldWUgPSBoYXJkZW4oXG4gICAgICAgICAgICB1cGNhbGxRdWV1ZS5zbGljZSgwLCBpMikuY29uY2F0KHVwY2FsbFF1ZXVlLnNsaWNlKGkyICsgMSkpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZWplY3RlZChyZWFzb24sIHsgcmVzb2x2ZXIgfSkge1xuICAgICAgICAgIHJlc29sdmVyLnJlamVjdChyZWFzb24pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdXRpbHM6IHtcbiAgICAgICAgaW5jclBlbmRpbmdQYXR0ZXJucygpIHtcbiAgICAgICAgICBjb25zdCB7IHBlbmRpbmcsIHJlZywgdXBjYWxsUXVldWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5wZW5kaW5nICs9IDE7XG4gICAgICAgICAgaWYgKCF1cGNhbGxRdWV1ZSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS51cGNhbGxRdWV1ZSA9IGhhcmRlbihbXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChyZWcgfHwgcGVuZGluZyA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh2b2lkIDApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMudXRpbHMuc3Vic2NyaWJlVG9UcmFuc2ZlcnMoKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGRlY3JQZW5kaW5nUGF0dGVybnMoKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5wZW5kaW5nIC09IDE7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGUucGVuZGluZyA+IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zdGF0ZS5wZW5kaW5nID0gMDtcbiAgICAgICAgICB0aGlzLnN0YXRlLnVwY2FsbFF1ZXVlID0gbnVsbDtcbiAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMudXRpbHMudW5zdWJzY3JpYmVGcm9tVHJhbnNmZXJzKCkpO1xuICAgICAgICB9LFxuICAgICAgICBzdWJzY3JpYmVUb1RyYW5zZmVycygpIHtcbiAgICAgICAgICBjb25zdCB7IGxjYSwgcmVnOiBjYWNoZWRSZWcgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKGNhY2hlZFJlZykge1xuICAgICAgICAgICAgcmV0dXJuIHdoZW4oY2FjaGVkUmVnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgeyB0YXAgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IHJlZyA9IHdhdGNoKEUobGNhKS5tb25pdG9yVHJhbnNmZXJzKHRhcCkpO1xuICAgICAgICAgIHRoaXMuc3RhdGUucmVnID0gcmVnO1xuICAgICAgICAgIHJldHVybiB3aGVuKHJlZyk7XG4gICAgICAgIH0sXG4gICAgICAgIHVuc3Vic2NyaWJlRnJvbVRyYW5zZmVycygpIHtcbiAgICAgICAgICBjb25zdCB7IHJlZywgbW9uaXRvciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoIXJlZyB8fCBtb25pdG9yKSB7XG4gICAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAge1xuICAgICAgZmluaXNoKGNvbnRleHQpIHtcbiAgICAgICAgdm9pZCBjb250ZXh0LmZhY2V0cy51dGlscy5zdWJzY3JpYmVUb1RyYW5zZmVycygpO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZVBhY2tldFRvb2xzID0gcGlja0ZhY2V0KG1ha2VQYWNrZXRUb29sc0tpdCwgXCJwdWJsaWNcIik7XG4gIHJldHVybiBtYWtlUGFja2V0VG9vbHM7XG59O1xuaGFyZGVuKHByZXBhcmVQYWNrZXRUb29scyk7XG5cbi8vXG52YXIgSUNTMjBfVFJBTlNGRVJfU1VDQ0VTU19SRVNVTFQgPSBcIkFRPT1cIjtcbnZhciB0cmFjZTUgPSBtYWtlVHJhY2VyKFwiSUJDUFwiKTtcbnZhciB7IEZhaWw6IEZhaWw2LCBiYXJlOiBiYXJlMyB9ID0gYXNzZXJ0O1xudmFyIHsgVm93JDogVm93JDUgfSA9IFNoYXBlO1xudmFyIGNyZWF0ZVNlcXVlbmNlUGF0dGVybiA9IChzZXF1ZW5jZSkgPT4ge1xuICBjb25zdCBzZXF1ZW5jZVBhdHRlcm5zID0gW107XG4gIHRyeSB7XG4gICAgY29uc3QgYmludFNlcXVlbmNlID0gQmlnSW50KHNlcXVlbmNlKTtcbiAgICBiaW50U2VxdWVuY2UgPiAwbiAmJiBzZXF1ZW5jZVBhdHRlcm5zLnB1c2goYmludFNlcXVlbmNlKTtcbiAgfSBjYXRjaCAoZTIpIHtcbiAgfVxuICBjb25zdCBudW1TZXF1ZW5jZSA9IE51bWJlcihzZXF1ZW5jZSk7XG4gIG51bVNlcXVlbmNlID4gMCAmJiBOdW1iZXIuaXNTYWZlSW50ZWdlcihudW1TZXF1ZW5jZSkgJiYgc2VxdWVuY2VQYXR0ZXJucy5wdXNoKG51bVNlcXVlbmNlKTtcbiAgY29uc3Qgc3RyU2VxdWVuY2UgPSBTdHJpbmcoc2VxdWVuY2UpO1xuICBzdHJTZXF1ZW5jZSAmJiBzZXF1ZW5jZVBhdHRlcm5zLnB1c2goc3RyU2VxdWVuY2UpO1xuICBpZiAoIXNlcXVlbmNlUGF0dGVybnMuZmluZCgoc2VxKSA9PiBzZXEgPT09IHNlcXVlbmNlKSkge1xuICAgIHNlcXVlbmNlUGF0dGVybnMucHVzaChzZXF1ZW5jZSk7XG4gIH1cbiAgc3dpdGNoIChzZXF1ZW5jZVBhdHRlcm5zLmxlbmd0aCkge1xuICAgIGNhc2UgMDpcbiAgICAgIHRocm93IEZhaWw2YHNlcXVlbmNlICR7c2VxdWVuY2V9IGlzIG5vdCB2YWxpZGA7XG4gICAgY2FzZSAxOlxuICAgICAgcmV0dXJuIHNlcXVlbmNlUGF0dGVybnNbMF07XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBNLm9yKC4uLnNlcXVlbmNlUGF0dGVybnMpO1xuICB9XG59O1xuaGFyZGVuKGNyZWF0ZVNlcXVlbmNlUGF0dGVybik7XG52YXIgcHJlcGFyZUlCQ1RyYW5zZmVyU2VuZGVyID0gKHpvbmUsIHsgd2F0Y2gsIG1ha2VJQkNSZXBseUtpdCB9KSA9PiB7XG4gIGNvbnN0IG1ha2VJQkNUcmFuc2ZlclNlbmRlcktpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJJQkNUcmFuc2ZlclNlbmRlcktpdFwiLFxuICAgIHtcbiAgICAgIHB1YmxpYzogTS5pbnRlcmZhY2UoXCJJQkNUcmFuc2ZlclNlbmRlclwiLCB7XG4gICAgICAgIHNlbmRQYWNrZXQ6IE0uY2FsbChWb3ckNShNLmFueSgpKSwgTS5hbnkoKSkucmV0dXJucyhWb3ckNShNLnJlY29yZCgpKSlcbiAgICAgIH0pLFxuICAgICAgcmVzcG9uc2VXYXRjaGVyOiBNLmludGVyZmFjZShcInJlc3BvbnNlV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoW00ucmVjb3JkKCldLCBNLnJlY29yZCgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHZlcmlmeVRyYW5zZmVyU3VjY2VzczogTS5pbnRlcmZhY2UoXCJ2ZXJpZnlUcmFuc2ZlclN1Y2Nlc3NcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoKVxuICAgICAgfSlcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICAodHhFeGVjdXRvciwgdHJhbnNmZXJNc2cpID0+ICh7XG4gICAgICB0eEV4ZWN1dG9yLFxuICAgICAgdHJhbnNmZXJNc2c6IGhhcmRlbih0cmFuc2Zlck1zZylcbiAgICB9KSxcbiAgICB7XG4gICAgICBwdWJsaWM6IHtcbiAgICAgICAgLypcblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZFBhY2tldChtYXRjaCwgb3B0cykge1xuICAgICAgICAgIGNvbnN0IHsgdHhFeGVjdXRvciwgdHJhbnNmZXJNc2cgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgRSh0eEV4ZWN1dG9yKS5leGVjdXRlVHgoW3RyYW5zZmVyTXNnXSksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXNwb25zZVdhdGNoZXIsXG4gICAgICAgICAgICB7IG9wdHMsIG1hdGNoIH1cbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmVzcG9uc2VXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbeyBzZXF1ZW5jZSB9XSwgY3R4KSB7XG4gICAgICAgICAgY29uc3QgeyBtYXRjaCwgb3B0cyB9ID0gY3R4O1xuICAgICAgICAgIGNvbnN0IHsgdHJhbnNmZXJNc2cgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgdHJhY2U1KFwic2VxdWVuY2VcIiwgc2VxdWVuY2UsIHRyYW5zZmVyTXNnKTtcbiAgICAgICAgICBjb25zdCByZXBseVBhY2tldFBhdHRlcm4gPSBNLnNwbGl0UmVjb3JkKHtcbiAgICAgICAgICAgIHNvdXJjZV9wb3J0OiB0cmFuc2Zlck1zZy5zb3VyY2VQb3J0LFxuICAgICAgICAgICAgc291cmNlX2NoYW5uZWw6IHRyYW5zZmVyTXNnLnNvdXJjZUNoYW5uZWwsXG4gICAgICAgICAgICBzZXF1ZW5jZTogY3JlYXRlU2VxdWVuY2VQYXR0ZXJuKHNlcXVlbmNlKVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IHsgcmVzdWx0VjogYWNrRGF0YVYsIC4uLnJlc3QgfSA9IG1ha2VJQkNSZXBseUtpdChcbiAgICAgICAgICAgIHJlcGx5UGFja2V0UGF0dGVybixcbiAgICAgICAgICAgIG1hdGNoLFxuICAgICAgICAgICAgeyBvcE5hbWU6IFwidHJhbnNmZXJcIiwgLi4ub3B0cyB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCByZXN1bHRWID0gd2F0Y2goYWNrRGF0YVYsIHRoaXMuZmFjZXRzLnZlcmlmeVRyYW5zZmVyU3VjY2Vzcyk7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IHJlc3VsdFYsIC4uLnJlc3QgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB2ZXJpZnlUcmFuc2ZlclN1Y2Nlc3M6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoYWNrRGF0YSkge1xuICAgICAgICAgIGxldCBvYmo7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIG9iaiA9IEpTT04ucGFyc2UoYWNrRGF0YSk7XG4gICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICBGYWlsNmBJQ1MyMC0xIHRyYW5zZmVyIGFjayBkYXRhIGlzIG5vdCBKU09OOiAke2Fja0RhdGF9YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgeyByZXN1bHQsIGVycm9yIH0gPSBvYmo7XG4gICAgICAgICAgZXJyb3IgPT09IHZvaWQgMCB8fCBGYWlsNmBJQ1MyMC0xIHRyYW5zZmVyIGVycm9yICR7ZXJyb3J9YDtcbiAgICAgICAgICByZXN1bHQgPz8gRmFpbDZgTWlzc2luZyByZXN1bHQgaW4gSUNTMjAtMSB0cmFuc2ZlciBhY2sgJHtvYmp9YDtcbiAgICAgICAgICByZXN1bHQgPT09IElDUzIwX1RSQU5TRkVSX1NVQ0NFU1NfUkVTVUxUIHx8IEZhaWw2YElDUzIwLTEgdHJhbnNmZXIgdW5zdWNjZXNzZnVsIHdpdGggYWNrIHJlc3VsdCAke3Jlc3VsdH1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4gKC4uLmFyZ3MpID0+IG1ha2VJQkNUcmFuc2ZlclNlbmRlcktpdCguLi5hcmdzKS5wdWJsaWM7XG59O1xuaGFyZGVuKHByZXBhcmVJQkNUcmFuc2ZlclNlbmRlcik7XG52YXIgcHJlcGFyZUlCQ1JlcGx5S2l0ID0gKHpvbmUsIHZvd1Rvb2xzKSA9PiB7XG4gIGNvbnN0IHsgd2F0Y2ggfSA9IHZvd1Rvb2xzO1xuICBjb25zdCBpYmNXYXRjaGVyID0gem9uZS5leG8oXG4gICAgXCJpYmNSZXN1bHRXYXRjaGVyXCIsXG4gICAgTS5pbnRlcmZhY2UoXCJwcm9jZXNzSUJDV2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKFxuICAgICAgICBNLnNwbGl0UmVjb3JkKHsgZXZlbnQ6IE0uc3RyaW5nKCkgfSwgeyBhY2tub3dsZWRnZW1lbnQ6IE0uc3RyaW5nKCkgfSksXG4gICAgICAgIE0uc3BsaXRSZWNvcmQoe30sIHsgb3BOYW1lOiBNLnN0cmluZygpLCB0aW1lb3V0OiBNLnJlY29yZCgpIH0pXG4gICAgICApLnJldHVybnMoVm93JDUoTS5zdHJpbmcoKSkpXG4gICAgfSksXG4gICAge1xuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoaWJjRXZlbnQsIHsgb3BOYW1lID0gXCJ1bmtub3duXCIgfSkge1xuICAgICAgICBjb25zdCB7IGV2ZW50IH0gPSBpYmNFdmVudDtcbiAgICAgICAgc3dpdGNoIChldmVudCkge1xuICAgICAgICAgIGNhc2UgXCJhY2tub3dsZWRnZW1lbnRQYWNrZXRcIjoge1xuICAgICAgICAgICAgY29uc3QgeyBhY2tub3dsZWRnZW1lbnQgfSA9IGliY0V2ZW50O1xuICAgICAgICAgICAgYWNrbm93bGVkZ2VtZW50IHx8IEZhaWw2YGFja25vd2xlZGdlbWVudFBhY2tldCBtaXNzaW5nICdhY2tub3dsZWRnZW1lbnQnYDtcbiAgICAgICAgICAgIHJldHVybiBiYXNlNjRUb0J5dGVzKGFja25vd2xlZGdlbWVudCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgXCJ0aW1lb3V0UGFja2V0XCI6XG4gICAgICAgICAgICB0aHJvdyBGYWlsNmAke2JhcmUzKG9wTmFtZSl9IG9wZXJhdGlvbiByZWNlaXZlZCB0aW1lb3V0IHBhY2tldGA7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHRocm93IEZhaWw2YFVuZXhwZWN0ZWQgZXZlbnQ6ICR7ZXZlbnR9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZUlCQ1JlcGx5S2l0ID0gKHJlcGx5UGFja2V0UGF0dGVybiwgbWF0Y2hWLCBvcHRzKSA9PiB7XG4gICAgY29uc3QgZXZlbnRQYXR0ZXJuID0gTS5vcihcbiAgICAgIE0uc3BsaXRSZWNvcmQoe1xuICAgICAgICBldmVudDogXCJhY2tub3dsZWRnZW1lbnRQYWNrZXRcIixcbiAgICAgICAgcGFja2V0OiByZXBseVBhY2tldFBhdHRlcm4sXG4gICAgICAgIGFja25vd2xlZGdlbWVudDogTS5zdHJpbmcoKVxuICAgICAgfSksXG4gICAgICBNLnNwbGl0UmVjb3JkKHtcbiAgICAgICAgZXZlbnQ6IFwidGltZW91dFBhY2tldFwiLFxuICAgICAgICBwYWNrZXQ6IHJlcGx5UGFja2V0UGF0dGVyblxuICAgICAgfSlcbiAgICApO1xuICAgIGNvbnN0IHJlc3VsdFYgPSB3YXRjaChtYXRjaFYsIGliY1dhdGNoZXIsIG9wdHMpO1xuICAgIHJldHVybiBoYXJkZW4oeyBldmVudFBhdHRlcm4sIHJlc3VsdFYgfSk7XG4gIH07XG4gIHJldHVybiBtYWtlSUJDUmVwbHlLaXQ7XG59O1xuaGFyZGVuKHByZXBhcmVJQkNSZXBseUtpdCk7XG52YXIgcHJlcGFyZUlCQ1Rvb2xzID0gKHpvbmUsIHZvd1Rvb2xzKSA9PiB7XG4gIGNvbnN0IG1ha2VJQkNSZXBseUtpdCA9IHByZXBhcmVJQkNSZXBseUtpdCh6b25lLCB2b3dUb29scyk7XG4gIGNvbnN0IG1ha2VJQkNUcmFuc2ZlclNlbmRlciA9IHByZXBhcmVJQkNUcmFuc2ZlclNlbmRlcih6b25lLCB7XG4gICAgbWFrZUlCQ1JlcGx5S2l0LFxuICAgIC4uLnZvd1Rvb2xzXG4gIH0pO1xuICByZXR1cm4gaGFyZGVuKHsgbWFrZUlCQ1RyYW5zZmVyU2VuZGVyLCBtYWtlSUJDUmVwbHlLaXQgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVJQkNUb29scyk7XG5cbi8vXG52YXIgdHJhY2U2ID0gbWFrZVRyYWNlcihcIkxvY2FsT3JjaEFjY291bnRcIik7XG52YXIgeyBWb3ckOiBWb3ckNiB9ID0gU2hhcGU7XG52YXIgRVZvdyQyID0gKHNoYXBlKSA9PiBNLm9yKFZvdyQ2KHNoYXBlKSwgTS5wcm9taXNlKFxuICAvKiAgICAgICAqL1xuKSk7XG52YXIgSG9sZGVySSA9IE0uaW50ZXJmYWNlKFwiaG9sZGVyXCIsIHtcbiAgLi4ub3JjaGVzdHJhdGlvbkFjY291bnRNZXRob2RzLFxuICBkZWxlZ2F0ZTogTS5jYWxsKE0uc3RyaW5nKCksIEFtb3VudFNoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgdW5kZWxlZ2F0ZTogTS5jYWxsKE0uc3RyaW5nKCksIEFtb3VudFNoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZGVwb3NpdDogTS5jYWxsKFBheW1lbnRTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIHdpdGhkcmF3OiBNLmNhbGwoQW1vdW50U2hhcGUpLnJldHVybnMoVm93JDYoUGF5bWVudFNoYXBlKSksXG4gIGV4ZWN1dGVUeDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhWb3ckNihNLnJlY29yZCgpKSksXG4gIHNlbmRUaGVuV2FpdEZvckFjazogTS5jYWxsKEVWb3ckMihNLnJlbW90YWJsZShcIlBhY2tldFNlbmRlclwiKSkpLm9wdGlvbmFsKE0uYW55KCkpLnJldHVybnMoRVZvdyQyKE0uc3RyaW5nKCkpKSxcbiAgbWF0Y2hGaXJzdFBhY2tldDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoRVZvdyQyKE0uYW55KCkpKSxcbiAgbW9uaXRvclRyYW5zZmVyczogTS5jYWxsKE0ucmVtb3RhYmxlKFwiVGFyZ2V0QXBwXCIpKS5yZXR1cm5zKEVWb3ckMihNLmFueSgpKSlcbn0pO1xudmFyIFBVQkxJQ19UT1BJQ1MyID0ge1xuICBhY2NvdW50OiBbXCJBY2NvdW50IGhvbGRlciBzdGF0dXNcIiwgTS5hbnkoKV1cbn07XG52YXIgcHJlcGFyZUxvY2FsT3JjaGVzdHJhdGlvbkFjY291bnRLaXQgPSAoem9uZSwge1xuICBtYWtlUmVjb3JkZXJLaXQsXG4gIHpjZixcbiAgdGltZXJTZXJ2aWNlLFxuICB2b3dUb29scyxcbiAgY2hhaW5IdWIsXG4gIGxvY2FsY2hhaW4sXG4gIHpvZVRvb2xzXG59KSA9PiB7XG4gIGNvbnN0IHsgd2F0Y2gsIGFzVm93LCB3aGVuIH0gPSB2b3dUb29scztcbiAgY29uc3QgeyBtYWtlSUJDVHJhbnNmZXJTZW5kZXIgfSA9IHByZXBhcmVJQkNUb29scyhcbiAgICB6b25lLnN1YlpvbmUoXCJpYmNUb29sc1wiKSxcbiAgICB2b3dUb29sc1xuICApO1xuICBjb25zdCBtYWtlUGFja2V0VG9vbHMgPSBwcmVwYXJlUGFja2V0VG9vbHMoXG4gICAgem9uZS5zdWJab25lKFwicGFja2V0VG9vbHNcIiksXG4gICAgdm93VG9vbHNcbiAgKTtcbiAgY29uc3QgdGltZXN0YW1wSGVscGVyID0gbWFrZVRpbWVzdGFtcEhlbHBlcih0aW1lclNlcnZpY2UpO1xuICBjb25zdCBtYWtlTG9jYWxPcmNoZXN0cmF0aW9uQWNjb3VudEtpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJMb2NhbCBPcmNoZXN0cmF0aW9uIEFjY291bnQgS2l0XCIsXG4gICAge1xuICAgICAgaGVscGVyOiBNLmludGVyZmFjZShcImhlbHBlclwiLCB7XG4gICAgICAgIGFtb3VudFRvQ29pbjogTS5jYWxsKEFtb3VudEFyZ1NoYXBlKS5yZXR1cm5zKE0ucmVjb3JkKCkpXG4gICAgICB9KSxcbiAgICAgIGhvbGRlcjogSG9sZGVySSxcbiAgICAgIHVuZGVsZWdhdGVXYXRjaGVyOiBNLmludGVyZmFjZShcInVuZGVsZWdhdGVXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbXG4gICAgICAgICAgTS5zcGxpdFJlY29yZCh7IGNvbXBsZXRpb25UaW1lOiBUaW1lc3RhbXBQcm90b1NoYXBlIH0pXG4gICAgICAgIF0pLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhWb3dTaGFwZSlcbiAgICAgIH0pLFxuICAgICAgdHJhbnNmZXJXYXRjaGVyOiBNLmludGVyZmFjZShcInRyYW5zZmVyV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5uYXQoKSkub3B0aW9uYWwoe1xuICAgICAgICAgIG9wdHM6IE0ub3IoTS51bmRlZmluZWQoKSwgSUJDVHJhbnNmZXJPcHRpb25zU2hhcGUpLFxuICAgICAgICAgIHJvdXRlOiBUcmFuc2ZlclJvdXRlU2hhcGVcbiAgICAgICAgfSkucmV0dXJucyhWb3ckNihNLnJlY29yZCgpKSlcbiAgICAgIH0pLFxuICAgICAgZXh0cmFjdEZpcnN0UmVzdWx0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJleHRyYWN0Rmlyc3RSZXN1bHRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbTS5yZWNvcmQoKV0pLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICByZXR1cm5Wb2lkV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZXR1cm5Wb2lkV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkub3B0aW9uYWwoTS5hbnkoKSkucmV0dXJucyhNLnVuZGVmaW5lZCgpKVxuICAgICAgfSksXG4gICAgICBzZWF0RXhpdGVySGFuZGxlcjogTS5pbnRlcmZhY2UoXCJzZWF0RXhpdGVySGFuZGxlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS51bmRlZmluZWQoKSwgTS5yZW1vdGFibGUoKSkucmV0dXJucyhcbiAgICAgICAgICBNLnVuZGVmaW5lZCgpXG4gICAgICAgICksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIE0ucmVtb3RhYmxlKCkpLnJldHVybnMoTS51bmRlZmluZWQoKSlcbiAgICAgIH0pLFxuICAgICAgZ2V0QmFsYW5jZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiZ2V0QmFsYW5jZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKEFtb3VudFNoYXBlLCBEZW5vbVNoYXBlKS5yZXR1cm5zKERlbm9tQW1vdW50U2hhcGUpXG4gICAgICB9KSxcbiAgICAgIHF1ZXJ5QmFsYW5jZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicXVlcnlCYWxhbmNlV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoVHlwZWRKc29uU2hhcGUpLnJldHVybnMoRGVub21BbW91bnRTaGFwZSlcbiAgICAgIH0pLFxuICAgICAgcXVlcnlCYWxhbmNlc1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwicXVlcnlCYWxhbmNlc1dhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKFR5cGVkSnNvblNoYXBlKS5yZXR1cm5zKFxuICAgICAgICAgIE0uYXJyYXlPZihEZW5vbUFtb3VudFNoYXBlKVxuICAgICAgICApXG4gICAgICB9KSxcbiAgICAgIGludml0YXRpb25NYWtlcnM6IE0uaW50ZXJmYWNlKFwiaW52aXRhdGlvbk1ha2Vyc1wiLCB7XG4gICAgICAgIENsb3NlQWNjb3VudDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIERlbGVnYXRlOiBNLmNhbGwoTS5zdHJpbmcoKSwgQW1vdW50U2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBEZXBvc2l0OiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgU2VuZDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIFNlbmRBbGw6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBUcmFuc2ZlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIFVuZGVsZWdhdGU6IE0uY2FsbChNLnN0cmluZygpLCBBbW91bnRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIFdpdGhkcmF3OiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgICAgfSlcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuICAgICAqL1xuICAgICh7IGFjY291bnQsIGFkZHJlc3MsIHN0b3JhZ2VOb2RlIH0pID0+IHtcbiAgICAgIGNvbnN0IHRvcGljS2l0ID0gc3RvcmFnZU5vZGUgPyBtYWtlUmVjb3JkZXJLaXQoc3RvcmFnZU5vZGUsIFBVQkxJQ19UT1BJQ1MyLmFjY291bnRbMV0pIDogdm9pZCAwO1xuICAgICAgaWYgKHRvcGljS2l0KSB7XG4gICAgICAgIHZvaWQgRSh0b3BpY0tpdC5yZWNvcmRlcikud3JpdGUoXCJcIik7XG4gICAgICB9XG4gICAgICBjb25zdCBwYWNrZXRUb29scyA9IG1ha2VQYWNrZXRUb29scyhhY2NvdW50KTtcbiAgICAgIHJldHVybiB7IGFjY291bnQsIGFkZHJlc3MsIHBhY2tldFRvb2xzLCB0b3BpY0tpdCB9O1xuICAgIH0sXG4gICAge1xuICAgICAgaGVscGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgYW1vdW50VG9Db2luKGFtb3VudCkge1xuICAgICAgICAgIHJldHVybiBjb2VyY2VDb2luKGNoYWluSHViLCBhbW91bnQpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaW52aXRhdGlvbk1ha2Vyczoge1xuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIERlbGVnYXRlKHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpIHtcbiAgICAgICAgICB0cmFjZTYoXCJEZWxlZ2F0ZVwiLCB2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKChzZWF0KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMuaG9sZGVyLmRlbGVnYXRlKHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sIFwiRGVsZWdhdGVcIik7XG4gICAgICAgIH0sXG4gICAgICAgIERlcG9zaXQoKSB7XG4gICAgICAgICAgdHJhY2U2KFwiRGVwb3NpdFwiKTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKFxuICAgICAgICAgICAgKHNlYXQpID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgeyBnaXZlIH0gPSBzZWF0LmdldFByb3Bvc2FsKCk7XG4gICAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgICB6b2VUb29scy5sb2NhbFRyYW5zZmVyKFxuICAgICAgICAgICAgICAgICAgc2VhdCxcbiAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmFjY291bnQsXG4gICAgICAgICAgICAgICAgICBnaXZlXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5zZWF0RXhpdGVySGFuZGxlcixcbiAgICAgICAgICAgICAgICBzZWF0XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJEZXBvc2l0XCIsXG4gICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICBNLnNwbGl0UmVjb3JkKHsgZ2l2ZTogQW55TmF0QW1vdW50c1JlY29yZCwgd2FudDoge30gfSlcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFVuZGVsZWdhdGUodmFsaWRhdG9yQWRkcmVzcywgZXJ0cEFtb3VudCkge1xuICAgICAgICAgIHRyYWNlNihcIlVuZGVsZWdhdGVcIiwgdmFsaWRhdG9yQWRkcmVzcywgZXJ0cEFtb3VudCk7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmhvbGRlci51bmRlbGVnYXRlKHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sIFwiVW5kZWxlZ2F0ZVwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgQ2xvc2VBY2NvdW50KCkge1xuICAgICAgICAgIHRocm93IEVycm9yKFwibm90IHlldCBpbXBsZW1lbnRlZFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgU2VuZCgpIHtcbiAgICAgICAgICBjb25zdCBvZmZlckhhbmRsZXIgPSAoc2VhdCwgeyB0b0FjY291bnQsIGFtb3VudCB9KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy5ob2xkZXIuc2VuZCh0b0FjY291bnQsIGFtb3VudCkpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihvZmZlckhhbmRsZXIsIFwiU2VuZFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgU2VuZEFsbCgpIHtcbiAgICAgICAgICBjb25zdCBvZmZlckhhbmRsZXIgPSAoc2VhdCwgeyB0b0FjY291bnQsIGFtb3VudHMgfSkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLnNlbmRBbGwodG9BY2NvdW50LCBhbW91bnRzKSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKG9mZmVySGFuZGxlciwgXCJTZW5kQWxsXCIpO1xuICAgICAgICB9LFxuICAgICAgICBUcmFuc2ZlcigpIHtcbiAgICAgICAgICBjb25zdCBvZmZlckhhbmRsZXIgPSAoc2VhdCwgeyBhbW91bnQsIGRlc3RpbmF0aW9uLCBvcHRzIH0pID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5ob2xkZXIudHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwgb3B0cylcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKG9mZmVySGFuZGxlciwgXCJUcmFuc2ZlclwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgV2l0aGRyYXcoKSB7XG4gICAgICAgICAgdHJhY2U2KFwiV2l0aGRyYXdcIik7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihcbiAgICAgICAgICAgIChzZWF0KSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHsgd2FudCB9ID0gc2VhdC5nZXRQcm9wb3NhbCgpO1xuICAgICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgICAgem9lVG9vbHMud2l0aGRyYXdUb1NlYXQoXG4gICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5hY2NvdW50LFxuICAgICAgICAgICAgICAgICAgc2VhdCxcbiAgICAgICAgICAgICAgICAgIHdhbnRcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnNlYXRFeGl0ZXJIYW5kbGVyLFxuICAgICAgICAgICAgICAgIHNlYXRcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIldpdGhkcmF3XCIsXG4gICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICBNLnNwbGl0UmVjb3JkKHsgZ2l2ZToge30sIHdhbnQ6IEFueU5hdEFtb3VudHNSZWNvcmQgfSlcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdW5kZWxlZ2F0ZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChyZXNwb25zZSkge1xuICAgICAgICAgIGNvbnN0IHsgY29tcGxldGlvblRpbWUgfSA9IHJlc3BvbnNlWzBdO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUodGltZXJTZXJ2aWNlKS53YWtlQXQoXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIEJpZ0ludChjb21wbGV0aW9uVGltZS5zZWNvbmRzKSArIG1heENsb2NrU2tld1xuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRyYW5zZmVyV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHRpbWVvdXRUaW1lc3RhbXAsIHsgb3B0cywgcm91dGUgfSkge1xuICAgICAgICAgIGNvbnN0IHsgZm9yd2FyZEluZm8sIC4uLnRyYW5zZmVyRGV0YWlscyB9ID0gcm91dGU7XG4gICAgICAgICAgbGV0IG1lbW87XG4gICAgICAgICAgaWYgKG9wdHMgJiYgXCJtZW1vXCIgaW4gb3B0cykge1xuICAgICAgICAgICAgbWVtbyA9IG9wdHMubWVtbztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGZvcndhcmRJbmZvKSB7XG4gICAgICAgICAgICBtZW1vID0gSlNPTi5zdHJpbmdpZnkoZm9yd2FyZEluZm8pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB0cmFuc2Zlck1zZyA9IHR5cGVkSnNvbihcbiAgICAgICAgICAgIFwiL2liYy5hcHBsaWNhdGlvbnMudHJhbnNmZXIudjEuTXNnVHJhbnNmZXJcIixcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgLi4udHJhbnNmZXJEZXRhaWxzLFxuICAgICAgICAgICAgICBzZW5kZXI6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgdGltZW91dEhlaWdodDogb3B0cz8udGltZW91dEhlaWdodCA/PyB7XG4gICAgICAgICAgICAgICAgcmV2aXNpb25IZWlnaHQ6IDBuLFxuICAgICAgICAgICAgICAgIHJldmlzaW9uTnVtYmVyOiAwblxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB0aW1lb3V0VGltZXN0YW1wLFxuICAgICAgICAgICAgICBtZW1vOiBtZW1vID8/IFwiXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHsgaG9sZGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCBzZW5kZXIgPSBtYWtlSUJDVHJhbnNmZXJTZW5kZXIoXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGhvbGRlcixcbiAgICAgICAgICAgIHRyYW5zZmVyTXNnXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gaG9sZGVyLnNlbmRUaGVuV2FpdEZvckFjayhzZW5kZXIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIGV4dHJhY3RGaXJzdFJlc3VsdFdhdGNoZXI6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0cykge1xuICAgICAgICAgIHJlc3VsdHMubGVuZ3RoID09PSAxIHx8IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQgZXhhY3RseSBvbmUgcmVzdWx0OyBnb3QgJHtyZXN1bHRzfWA7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdHNbMF07XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXR1cm5Wb2lkV2F0Y2hlcjoge1xuICAgICAgICBvbkZ1bGZpbGxlZCgpIHtcbiAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIGdldEJhbGFuY2VXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChuYXRBbW91bnQsIGRlbm9tKSB7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRlbm9tLCB2YWx1ZTogbmF0QW1vdW50LnZhbHVlIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHNlYXRFeGl0ZXJIYW5kbGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoXywgc2VhdCkge1xuICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCBzZWF0KSB7XG4gICAgICAgICAgc2VhdC5leGl0KHJlYXNvbik7XG4gICAgICAgICAgdGhyb3cgcmVhc29uO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIHF1ZXJ5QmFsYW5jZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0KSB7XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlIH0gPSByZXN1bHQ7XG4gICAgICAgICAgaWYgKCFiYWxhbmNlIHx8ICFiYWxhbmNlPy5kZW5vbSkge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCBiYWxhbmNlICR7cXVvdGUocmVzdWx0KX07YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih0b0Rlbm9tQW1vdW50KGJhbGFuY2UpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBxdWVyeUJhbGFuY2VzV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0KSB7XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlcyB9ID0gcmVzdWx0O1xuICAgICAgICAgIGlmICghYmFsYW5jZXMgfHwgIUFycmF5LmlzQXJyYXkoYmFsYW5jZXMpKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkIGJhbGFuY2VzICR7cXVvdGUocmVzdWx0KX07YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbihiYWxhbmNlcy5tYXAodG9EZW5vbUFtb3VudCkpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaG9sZGVyOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYXNDb250aW51aW5nT2ZmZXIoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IG51bGw7XG4gICAgICAgICAgICBjb25zdCB7IGhvbGRlciwgaW52aXRhdGlvbk1ha2VyczogaW0gfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgaW52aXRhdGlvbk1ha2VycyA9IChcbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgIGltXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIHB1YmxpY1N1YnNjcmliZXJzOiBhd2FpdCB3aGVuKGhvbGRlci5nZXRQdWJsaWNUb3BpY3MoKSksXG4gICAgICAgICAgICAgIGludml0YXRpb25NYWtlcnNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0QmFsYW5jZShkZW5vbUFyZykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBbYnJhbmQsIGRlbm9tXSA9IHR5cGVvZiBkZW5vbUFyZyA9PT0gXCJzdHJpbmdcIiA/IFtjaGFpbkh1Yi5nZXRBc3NldChkZW5vbUFyZywgXCJhZ29yaWNcIik/LmJyYW5kLCBkZW5vbUFyZ10gOiBbZGVub21BcmcsIGNoYWluSHViLmdldERlbm9tKGRlbm9tQXJnKV07XG4gICAgICAgICAgICBpZiAoIWRlbm9tKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgTm8gZGVub20gZm9yIGJyYW5kOiAke2Rlbm9tQXJnfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYnJhbmQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICAgIEUodGhpcy5zdGF0ZS5hY2NvdW50KS5nZXRCYWxhbmNlKGJyYW5kKSxcbiAgICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5nZXRCYWxhbmNlV2F0Y2hlcixcbiAgICAgICAgICAgICAgICBkZW5vbVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICBFKGxvY2FsY2hhaW4pLnF1ZXJ5KFxuICAgICAgICAgICAgICAgIHR5cGVkSnNvbihcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QmFsYW5jZVJlcXVlc3RcIiwge1xuICAgICAgICAgICAgICAgICAgYWRkcmVzczogdGhpcy5zdGF0ZS5hZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgZGVub21cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5xdWVyeUJhbGFuY2VXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEJhbGFuY2VzKCkge1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUobG9jYWxjaGFpbikucXVlcnkoXG4gICAgICAgICAgICAgIHR5cGVkSnNvbihcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0XCIsIHtcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiB0aGlzLnN0YXRlLmFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5xdWVyeUJhbGFuY2VzV2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldFB1YmxpY1RvcGljcygpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgbnVsbDtcbiAgICAgICAgICAgIGNvbnN0IHsgdG9waWNLaXQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIXRvcGljS2l0KSB0aHJvdyB0aHJvd1JlZGFjdGVkYE5vIHRvcGljS2l0OyBzdG9yYWdlTm9kZSBub3QgcHJvdmlkZWRgO1xuICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgICAgICAgIGFjY291bnQ6IHtcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogUFVCTElDX1RPUElDUzIuYWNjb3VudFswXSxcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyOiB0b3BpY0tpdC5zdWJzY3JpYmVyLFxuICAgICAgICAgICAgICAgIHN0b3JhZ2VQYXRoOiBhd2FpdCB0b3BpY0tpdC5yZWNvcmRlci5nZXRTdG9yYWdlUGF0aCgpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvL1xuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGRlbGVnYXRlKHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpIHtcbiAgICAgICAgICBjb25zdCB7IGFjY291bnQ6IGxjYSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCBhbW91bnQgPSBjb2VyY2VDb2luKGNoYWluSHViLCBlcnRwQW1vdW50KTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKGxjYSkuZXhlY3V0ZVR4KFtcbiAgICAgICAgICAgICAgdHlwZWRKc29uKFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnRGVsZWdhdGVcIiwge1xuICAgICAgICAgICAgICAgIGFtb3VudCxcbiAgICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyZXNzLFxuICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHJlc3M6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5leHRyYWN0Rmlyc3RSZXN1bHRXYXRjaGVyXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLy9cbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHVuZGVsZWdhdGUodmFsaWRhdG9yQWRkcmVzcywgZXJ0cEFtb3VudCkge1xuICAgICAgICAgIGNvbnN0IGFtb3VudCA9IGNvZXJjZUNvaW4oY2hhaW5IdWIsIGVydHBBbW91bnQpO1xuICAgICAgICAgIGNvbnN0IHsgYWNjb3VudDogbGNhIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUobGNhKS5leGVjdXRlVHgoW1xuICAgICAgICAgICAgICB0eXBlZEpzb24oXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dVbmRlbGVnYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcmVzcyxcbiAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiB0aGlzLnN0YXRlLmFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMudW5kZWxlZ2F0ZVdhdGNoZXJcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZGVwb3NpdChwYXltZW50KSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgRSh0aGlzLnN0YXRlLmFjY291bnQpLmRlcG9zaXQocGF5bWVudCksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB3aXRoZHJhdyhhbW91bnQpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goRSh0aGlzLnN0YXRlLmFjY291bnQpLndpdGhkcmF3KGFtb3VudCkpO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBleGVjdXRlVHgobWVzc2FnZXMpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goRSh0aGlzLnN0YXRlLmFjY291bnQpLmV4ZWN1dGVUeChtZXNzYWdlcykpO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEFkZHJlc3MoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuYWRkcmVzcztcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHNlbmQodG9BY2NvdW50LCBhbW91bnQpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2U2KFwic2VuZFwiLCB0b0FjY291bnQsIGFtb3VudCk7XG4gICAgICAgICAgICBjb25zdCBjb3Ntb3NEZXN0ID0gY2hhaW5IdWIuY29lcmNlQ29zbW9zQWRkcmVzcyh0b0FjY291bnQpO1xuICAgICAgICAgICAgY29zbW9zRGVzdC5jaGFpbklkID09PSB0aGlzLnN0YXRlLmFkZHJlc3MuY2hhaW5JZCB8fCB0aHJvd1JlZGFjdGVkYGJhbmsvc2VuZCBjYW5ub3Qgc2VuZCB0byBhIGRpZmZlcmVudCBjaGFpbiAke3F1b3RlKGNvc21vc0Rlc3QuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRSh0aGlzLnN0YXRlLmFjY291bnQpLmV4ZWN1dGVUeChbXG4gICAgICAgICAgICAgICAgdHlwZWRKc29uKFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuTXNnU2VuZFwiLCB7XG4gICAgICAgICAgICAgICAgICBhbW91bnQ6IFtoZWxwZXIuYW1vdW50VG9Db2luKGFtb3VudCldLFxuICAgICAgICAgICAgICAgICAgdG9BZGRyZXNzOiBjb3Ntb3NEZXN0LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgZnJvbUFkZHJlc3M6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHNlbmRBbGwodG9BY2NvdW50LCBhbW91bnRzKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlNihcInNlbmRBbGxcIiwgdG9BY2NvdW50LCBhbW91bnRzKTtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRSh0aGlzLnN0YXRlLmFjY291bnQpLmV4ZWN1dGVUeChbXG4gICAgICAgICAgICAgICAgdHlwZWRKc29uKFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuTXNnU2VuZFwiLCB7XG4gICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtb3VudHMubWFwKChhMikgPT4gaGVscGVyLmFtb3VudFRvQ29pbihhMikpLFxuICAgICAgICAgICAgICAgICAgdG9BZGRyZXNzOiB0b0FjY291bnQudmFsdWUsXG4gICAgICAgICAgICAgICAgICBmcm9tQWRkcmVzczogdGhpcy5zdGF0ZS5hZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgXSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJldHVyblZvaWRXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICB0cmFuc2ZlcihkZXN0aW5hdGlvbiwgYW1vdW50LCBvcHRzKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlNihcIlRyYW5zZmVycmluZyBmdW5kcyBvdmVyIElCQ1wiKTtcbiAgICAgICAgICAgIGNvbnN0IGRlbm9tQW1vdW50ID0gY29lcmNlRGVub21BbW91bnQoY2hhaW5IdWIsIGFtb3VudCk7XG4gICAgICAgICAgICBjb25zdCB7IGZvcndhcmRPcHRzLCAuLi5yZXN0IH0gPSBvcHRzID8/IHt9O1xuICAgICAgICAgICAgY29uc3Qgcm91dGUgPSBjaGFpbkh1Yi5tYWtlVHJhbnNmZXJSb3V0ZShcbiAgICAgICAgICAgICAgZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgIGRlbm9tQW1vdW50LFxuICAgICAgICAgICAgICBcImFnb3JpY1wiLFxuICAgICAgICAgICAgICBmb3J3YXJkT3B0c1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRyYWNlNihcImdvdCB0cmFuc2ZlciByb3V0ZVwiLCByb3V0ZSk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRWID0gd2F0Y2goXG4gICAgICAgICAgICAgIHRpbWVzdGFtcEhlbHBlci52b3dPclZhbHVlRnJvbU9wdHMob3B0cyksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnRyYW5zZmVyV2F0Y2hlcixcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG9wdHM6IHJlc3QsXG4gICAgICAgICAgICAgICAgcm91dGVcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRWO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdHJhbnNmZXJTdGVwcyhhbW91bnQsIG1zZykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInRyYW5zZmVyU3RlcHMgZ290XCIsIGFtb3VudCwgbXNnKTtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgbm90IHlldCBpbXBsZW1lbnRlZGA7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNlbmRUaGVuV2FpdEZvckFjayhzZW5kZXIsIG9wdHMpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKHRoaXMuc3RhdGUucGFja2V0VG9vbHMpLnNlbmRUaGVuV2FpdEZvckFjayhzZW5kZXIsIG9wdHMpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG1hdGNoRmlyc3RQYWNrZXQocGF0dGVyblYpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goRSh0aGlzLnN0YXRlLnBhY2tldFRvb2xzKS5tYXRjaEZpcnN0UGFja2V0KHBhdHRlcm5WKSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG1vbml0b3JUcmFuc2ZlcnModGFwKSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUodGhpcy5zdGF0ZS5wYWNrZXRUb29scykubW9uaXRvclRyYW5zZmVycyh0YXApKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuIG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0O1xufTtcblxuLy9cbnZhciB7IFZvdyQ6IFZvdyQ3IH0gPSBTaGFwZTtcbnZhciB0cmFjZTcgPSBtYWtlVHJhY2VyKFwiT3JjaGVzdHJhdG9yXCIpO1xudmFyIE9yY2hlc3RyYXRvckkgPSBNLmludGVyZmFjZShcIk9yY2hlc3RyYXRvclwiLCB7XG4gIGdldENoYWluOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhWb3ckNyhNLnJlbW90YWJsZShcIkNoYWluRmFjYWRlXCIpKSksXG4gIGdldERlbm9tSW5mbzogTS5jYWxsKERlbm9tU2hhcGUsIE0uc3RyaW5nKCkpLnJldHVybnMoRGVub21JbmZvU2hhcGUpLFxuICBhc0Ftb3VudDogTS5jYWxsKERlbm9tQW1vdW50U2hhcGUpLnJldHVybnMoQW1vdW50U2hhcGUpXG59KTtcbnZhciBwcmVwYXJlT3JjaGVzdHJhdG9yS2l0ID0gKHpvbmUsIHtcbiAgY2hhaW5IdWIsXG4gIG1ha2VMb2NhbENoYWluRmFjYWRlLFxuICBtYWtlUmVtb3RlQ2hhaW5GYWNhZGUsXG4gIHZvd1Rvb2xzOiB7IHdhdGNoLCBhc1ZvdyB9XG59KSA9PiB7XG4gIGNvbnN0IGNoYWluQnlOYW1lID0gbWFrZVNjYWxhck1hcFN0b3JlKFwiY2hhaW5OYW1lXCIpO1xuICByZXR1cm4gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIk9yY2hlc3RyYXRvclwiLFxuICAgIHtcbiAgICAgIG9yY2hlc3RyYXRvcjogT3JjaGVzdHJhdG9ySSxcbiAgICAgIG1ha2VMb2NhbENoYWluRmFjYWRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJtYWtlTG9jYWxDaGFpbkZhY2FkZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVjb3JkKCkpLnJldHVybnMoTS5yZW1vdGFibGUoKSlcbiAgICAgIH0pLFxuICAgICAgbWFrZVJlbW90ZUNoYWluRmFjYWRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICAgIFwibWFrZVJlbW90ZUNoYWluRmFjYWRlV2F0Y2hlclwiLFxuICAgICAgICB7XG4gICAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpLCBNLnN0cmluZygpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS5yZW1vdGFibGUoKSlcbiAgICAgICAgfVxuICAgICAgKVxuICAgIH0sXG4gICAgKCkgPT4ge1xuICAgICAgdHJhY2U3KFwibWFraW5nIGFuIE9yY2hlc3RyYXRvclwiKTtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9LFxuICAgIHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBtYWtlTG9jYWxDaGFpbkZhY2FkZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoYWdvcmljQ2hhaW5JbmZvKSB7XG4gICAgICAgICAgY29uc3QgaXQgPSBtYWtlTG9jYWxDaGFpbkZhY2FkZShhZ29yaWNDaGFpbkluZm8pO1xuICAgICAgICAgIGNoYWluQnlOYW1lLnNldChcImFnb3JpY1wiLCBoYXJkZW4oeyB2YWx1ZTogaXQsIHBlbmRpbmc6IGZhbHNlIH0pKTtcbiAgICAgICAgICByZXR1cm4gaXQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgbWFrZVJlbW90ZUNoYWluRmFjYWRlV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtfYWdvcmljQ2hhaW5JbmZvLCByZW1vdGVDaGFpbkluZm8sIGNvbm5lY3Rpb25JbmZvXSwgbmFtZSkge1xuICAgICAgICAgIGNvbnN0IGl0ID0gbWFrZVJlbW90ZUNoYWluRmFjYWRlKHJlbW90ZUNoYWluSW5mbywgY29ubmVjdGlvbkluZm8pO1xuICAgICAgICAgIGNoYWluQnlOYW1lLnNldChuYW1lLCBoYXJkZW4oeyB2YWx1ZTogaXQsIHBlbmRpbmc6IGZhbHNlIH0pKTtcbiAgICAgICAgICByZXR1cm4gaXQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvcmNoZXN0cmF0b3I6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0Q2hhaW4obmFtZSkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBpZiAoY2hhaW5CeU5hbWUuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICAgIGNvbnN0IG1heWJlQ2hhaW4gPSBjaGFpbkJ5TmFtZS5nZXQobmFtZSk7XG4gICAgICAgICAgICAgIHJldHVybiBtYXliZUNoYWluLnBlbmRpbmcgPyBtYXliZUNoYWluLnZvdyA6IG1heWJlQ2hhaW4udmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB2b3cgPSBuYW1lID09PSBcImFnb3JpY1wiID8gd2F0Y2goXG4gICAgICAgICAgICAgIGNoYWluSHViLmdldENoYWluSW5mbyhcImFnb3JpY1wiKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMubWFrZUxvY2FsQ2hhaW5GYWNhZGVXYXRjaGVyXG4gICAgICAgICAgICApIDogd2F0Y2goXG4gICAgICAgICAgICAgIGNoYWluSHViLmdldENoYWluc0FuZENvbm5lY3Rpb24oXCJhZ29yaWNcIiwgbmFtZSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLm1ha2VSZW1vdGVDaGFpbkZhY2FkZVdhdGNoZXIsXG4gICAgICAgICAgICAgIG5hbWVcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjaGFpbkJ5TmFtZS5pbml0KG5hbWUsIGhhcmRlbih7IHZvdywgcGVuZGluZzogdHJ1ZSB9KSk7XG4gICAgICAgICAgICByZXR1cm4gdm93O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0RGVub21JbmZvKGRlbm9tLCBob2xkaW5nQ2hhaW5OYW1lKSB7XG4gICAgICAgICAgY29uc3QgZGVub21EZXRhaWwgPSBjaGFpbkh1Yi5nZXRBc3NldChkZW5vbSwgaG9sZGluZ0NoYWluTmFtZSk7XG4gICAgICAgICAgaWYgKCFkZW5vbURldGFpbCkgdGhyb3cgdGhyb3dSZWRhY3RlZGBObyBkZW5vbSBkZXRhaWwgZm9yICR7cXVvdGUoZGVub20pfWA7XG4gICAgICAgICAgY29uc3QgeyBjaGFpbk5hbWUsIGJhc2VOYW1lLCBiYXNlRGVub20sIGJyYW5kIH0gPSBkZW5vbURldGFpbDtcbiAgICAgICAgICBjaGFpbkJ5TmFtZS5oYXMoY2hhaW5OYW1lKSB8fCB0aHJvd1JlZGFjdGVkYHVzZSBnZXRDaGFpbigke3F1b3RlKGNoYWluTmFtZSl9KSBiZWZvcmUgZ2V0RGVub21JbmZvKCR7cXVvdGUoZGVub20pfSlgO1xuICAgICAgICAgIGNvbnN0IG1heWJlQ2hhaW4gPSBjaGFpbkJ5TmFtZS5nZXQoY2hhaW5OYW1lKTtcbiAgICAgICAgICBpZiAobWF5YmVDaGFpbi5wZW5kaW5nKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHdhaXQgdW50aWwgZ2V0Q2hhaW4oJHtxdW90ZShjaGFpbk5hbWUpfSkgY29tcGxldGVzIGJlZm9yZSBnZXREZW5vbUluZm8oJHtxdW90ZShkZW5vbSl9KWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGNoYWluID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgbWF5YmVDaGFpbi52YWx1ZVxuICAgICAgICAgICk7XG4gICAgICAgICAgY2hhaW5CeU5hbWUuaGFzKGJhc2VOYW1lKSB8fCB0aHJvd1JlZGFjdGVkYHVzZSBnZXRDaGFpbigke3F1b3RlKGJhc2VOYW1lKX0pIGJlZm9yZSBnZXREZW5vbUluZm8oJHtxdW90ZShkZW5vbSl9KWA7XG4gICAgICAgICAgY29uc3QgbWF5YmVCYXNlID0gY2hhaW5CeU5hbWUuZ2V0KGJhc2VOYW1lKTtcbiAgICAgICAgICBpZiAobWF5YmVCYXNlLnBlbmRpbmcpIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgd2FpdCB1bnRpbCBnZXRDaGFpbigke3F1b3RlKGJhc2VOYW1lKX0pIGNvbXBsZXRlcyBiZWZvcmUgZ2V0RGVub21JbmZvKCR7cXVvdGUoZGVub20pfSlgO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBiYXNlMiA9IChcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG1heWJlQmFzZS52YWx1ZVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGNoYWluLCBiYXNlOiBiYXNlMiwgYnJhbmQsIGJhc2VEZW5vbSB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYXNBbW91bnQ6ICgpID0+IHRocm93UmVkYWN0ZWRgbm90IHlldCBpbXBsZW1lbnRlZGBcbiAgICAgIH1cbiAgICB9XG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVPcmNoZXN0cmF0b3JLaXQpO1xudmFyIHByZXBhcmVPcmNoZXN0cmF0b3IgPSAoem9uZSwgcG93ZXJzKSA9PiB7XG4gIGNvbnN0IG1ha2VPcmNoZXN0cmF0b3JLaXQgPSBwcmVwYXJlT3JjaGVzdHJhdG9yS2l0KHpvbmUsIHBvd2Vycyk7XG4gIHJldHVybiBwaWNrRmFjZXQobWFrZU9yY2hlc3RyYXRvcktpdCwgXCJvcmNoZXN0cmF0b3JcIik7XG59O1xuXG4vL1xudmFyIHRyYWNlOCA9IG1ha2VUcmFjZXIoXCJSZW1vdGVDaGFpbkZhY2FkZVwiKTtcbnZhciBwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGVLaXQgPSAoem9uZSwge1xuICBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnQsXG4gIG9yY2hlc3RyYXRpb24sXG4gIC8vXG4gIC8vXG4gIHN0b3JhZ2VOb2RlLFxuICB0aW1lcixcbiAgdm93VG9vbHM6IHsgYWxsVm93cywgYXNWb3csIHdhdGNoIH1cbn0pID0+IHpvbmUuZXhvQ2xhc3NLaXQoXG4gIFwiUmVtb3RlQ2hhaW5GYWNhZGVcIixcbiAge1xuICAgIHB1YmxpYzogTS5pbnRlcmZhY2UoXCJSZW1vdGVDaGFpbkZhY2FkZVwiLCB7XG4gICAgICAuLi5jaGFpbkZhY2FkZU1ldGhvZHMsXG4gICAgICBxdWVyeTogTS5jYWxsKE0uYXJyYXlPZihJQ1FNc2dTaGFwZSkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgfSksXG4gICAgbWFrZUlDUUNvbm5lY3Rpb25RdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgXCJtYWtlSUNRQ29ubmVjdGlvblF1ZXJ5V2F0Y2hlclwiLFxuICAgICAge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVtb3RhYmxlKCksIE0uYXJyYXlPZihJQ1FNc2dTaGFwZSkpLnJldHVybnMoXG4gICAgICAgICAgVm93U2hhcGVcbiAgICAgICAgKVxuICAgICAgfVxuICAgICksXG4gICAgbWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICBcIm1ha2VBY2NvdW50QW5kUHJvdmlkZVF1ZXJ5Q29ubldhdGNoZXJcIixcbiAgICAgIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbXG4gICAgICAgICAgTS5yZW1vdGFibGUoKSxcbiAgICAgICAgICBNLm9yKE0ucmVtb3RhYmxlKCksIE0udW5kZWZpbmVkKCkpXG4gICAgICAgIF0pLnJldHVybnMoVm93U2hhcGUpXG4gICAgICB9XG4gICAgKSxcbiAgICBnZXRBZGRyZXNzZXNXYXRjaGVyOiBNLmludGVyZmFjZShcImdldEFkZHJlc3NXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoXG4gICAgICAgIFtDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSwgTS5zdHJpbmcoKSwgTS5zdHJpbmcoKV0sXG4gICAgICAgIE0ucmVtb3RhYmxlKClcbiAgICAgICkucmV0dXJucyhWb3dTaGFwZSlcbiAgICB9KSxcbiAgICBtYWtlQ2hpbGROb2RlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJtYWtlQ2hpbGROb2RlV2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ub3IoTS5yZW1vdGFibGUoKSwgTS51bmRlZmluZWQoKSksIHtcbiAgICAgICAgYWNjb3VudDogTS5yZW1vdGFibGUoKSxcbiAgICAgICAgY2hhaW5BZGRyZXNzOiBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICAgICAgbG9jYWxBZGRyZXNzOiBNLnN0cmluZygpLFxuICAgICAgICByZW1vdGVBZGRyZXNzOiBNLnN0cmluZygpXG4gICAgICB9KS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpXG4gICAgfSlcbiAgfSxcbiAgLypcblxuXG4gICAqL1xuICAocmVtb3RlQ2hhaW5JbmZvLCBjb25uZWN0aW9uSW5mbykgPT4ge1xuICAgIHRyYWNlOChcIm1ha2luZyBhIFJlbW90ZUNoYWluRmFjYWRlXCIpO1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICB7XG4gICAgICAgIHJlbW90ZUNoYWluSW5mbyxcbiAgICAgICAgY29ubmVjdGlvbkluZm8sXG4gICAgICAgIGljcUNvbm5lY3Rpb246IHZvaWQgMFxuICAgICAgfVxuICAgICk7XG4gIH0sXG4gIHtcbiAgICBwdWJsaWM6IHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBnZXRDaGFpbkluZm8oKSB7XG4gICAgICAgIHJldHVybiB3YXRjaCh0aGlzLnN0YXRlLnJlbW90ZUNoYWluSW5mbyk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgbWFrZUFjY291bnQoKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyByZW1vdGVDaGFpbkluZm8sIGNvbm5lY3Rpb25JbmZvIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChyZW1vdGVDaGFpbkluZm8ubmFtZXNwYWNlICE9PSBcImNvc21vc1wiKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYG9ubHkgc3VwcG9ydGVkIG9uICdjb3Ntb3MnIGNoYWlucywgbm90ICR7cmVtb3RlQ2hhaW5JbmZvLm5hbWVzcGFjZX1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWNvbm5lY3Rpb25JbmZvKSB0aHJvdyB0aHJvd1JlZGFjdGVkYElCQyBjb25uZWN0aW9uIGluZm8gbm90IGZvdW5kYDtcbiAgICAgICAgICBjb25zdCBpY3FDb25uT3JVbmRlZmluZWRWID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICByZW1vdGVDaGFpbkluZm8/LmljcUVuYWJsZWQgJiYgIXRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbiA/IEUob3JjaGVzdHJhdGlvbikucHJvdmlkZUlDUUNvbm5lY3Rpb24oY29ubmVjdGlvbkluZm8uaWQpIDogdm9pZCAwXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCBtYWtlQWNjb3VudFYgPSBFKG9yY2hlc3RyYXRpb24pLm1ha2VBY2NvdW50KFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICByZW1vdGVDaGFpbkluZm8uY2hhaW5JZCxcbiAgICAgICAgICAgIGNvbm5lY3Rpb25JbmZvLmNvdW50ZXJwYXJ0eS5jb25uZWN0aW9uX2lkLFxuICAgICAgICAgICAgY29ubmVjdGlvbkluZm8uaWRcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIGFsbFZvd3MoW21ha2VBY2NvdW50ViwgaWNxQ29ubk9yVW5kZWZpbmVkVl0pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMubWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHF1ZXJ5KG1zZ3MpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHJlbW90ZUNoYWluSW5mbzogeyBpY3FFbmFibGVkLCBjaGFpbklkIH0sXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgY29ubmVjdGlvbkluZm9cbiAgICAgICAgICB9ID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLnN0YXRlXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIWljcUVuYWJsZWQpIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluSWQpfWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghY29ubmVjdGlvbkluZm8pIHRocm93IHRocm93UmVkYWN0ZWRgSUJDIGNvbm5lY3Rpb24gaW5mbyBub3QgZm91bmRgO1xuICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUob3JjaGVzdHJhdGlvbikucHJvdmlkZUlDUUNvbm5lY3Rpb24oY29ubmVjdGlvbkluZm8uaWQpLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5tYWtlSUNRQ29ubmVjdGlvblF1ZXJ5V2F0Y2hlcixcbiAgICAgICAgICAgICAgbXNnc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUodGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKS5xdWVyeShtc2dzKSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlcjoge1xuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChbYWNjb3VudCwgaWNxQ29ubmVjdGlvbl0pIHtcbiAgICAgICAgaWYgKGljcUNvbm5lY3Rpb24gJiYgIXRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgIHRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbiA9IGljcUNvbm5lY3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgIGFsbFZvd3MoW1xuICAgICAgICAgICAgRShhY2NvdW50KS5nZXRBZGRyZXNzKCksXG4gICAgICAgICAgICBFKGFjY291bnQpLmdldExvY2FsQWRkcmVzcygpLFxuICAgICAgICAgICAgRShhY2NvdW50KS5nZXRSZW1vdGVBZGRyZXNzKClcbiAgICAgICAgICBdKSxcbiAgICAgICAgICB0aGlzLmZhY2V0cy5nZXRBZGRyZXNzZXNXYXRjaGVyLFxuICAgICAgICAgIGFjY291bnRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1ha2VJQ1FDb25uZWN0aW9uUXVlcnlXYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChpY3FDb25uZWN0aW9uLCBtc2dzKSB7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uID0gaWNxQ29ubmVjdGlvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gd2F0Y2goRShpY3FDb25uZWN0aW9uKS5xdWVyeShtc2dzKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBnZXRBZGRyZXNzZXNXYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoW2NoYWluQWRkcmVzcywgbG9jYWxBZGRyZXNzLCByZW1vdGVBZGRyZXNzXSwgYWNjb3VudCkge1xuICAgICAgICBjb25zdCBvcHRpb25hbFN0b3JhZ2VOb2RlID0gc3RvcmFnZU5vZGUgPyBFKHN0b3JhZ2VOb2RlKS5tYWtlQ2hpbGROb2RlKGNoYWluQWRkcmVzcy52YWx1ZSkgOiB2b2lkIDA7XG4gICAgICAgIHJldHVybiB3YXRjaChvcHRpb25hbFN0b3JhZ2VOb2RlLCB0aGlzLmZhY2V0cy5tYWtlQ2hpbGROb2RlV2F0Y2hlciwge1xuICAgICAgICAgIGFjY291bnQsXG4gICAgICAgICAgY2hhaW5BZGRyZXNzLFxuICAgICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgICByZW1vdGVBZGRyZXNzXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUNoaWxkTm9kZVdhdGNoZXI6IHtcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoY2hpbGROb2RlLCB7IGFjY291bnQsIGNoYWluQWRkcmVzcywgbG9jYWxBZGRyZXNzLCByZW1vdGVBZGRyZXNzIH0pIHtcbiAgICAgICAgY29uc3QgeyBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICByZXR1cm4gbWFrZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50KFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGNoYWluQWRkcmVzcyxcbiAgICAgICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgICAgIHJlbW90ZUFkZHJlc3NcbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGFjY291bnQsXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgc3RvcmFnZU5vZGU6IGNoaWxkTm9kZSxcbiAgICAgICAgICAgIGljcUNvbm5lY3Rpb24sXG4gICAgICAgICAgICB0aW1lclxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG5oYXJkZW4ocHJlcGFyZVJlbW90ZUNoYWluRmFjYWRlS2l0KTtcbnZhciBwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGUgPSAoem9uZSwgcG93ZXJzKSA9PiB7XG4gIGNvbnN0IG1ha2VMb2NhbENoYWluRmFjYWRlS2l0ID0gcHJlcGFyZVJlbW90ZUNoYWluRmFjYWRlS2l0KHpvbmUsIHBvd2Vycyk7XG4gIHJldHVybiBwaWNrRmFjZXQobWFrZUxvY2FsQ2hhaW5GYWNhZGVLaXQsIFwicHVibGljXCIpO1xufTtcbmhhcmRlbihwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGUpO1xuXG4vL1xudmFyIG1ha2VPcmNoZXN0cmF0aW9uRmFjYWRlID0gKHtcbiAgem9uZSxcbiAgdGltZXJTZXJ2aWNlLFxuICB6Y2YsXG4gIG9yY2hlc3RyYXRpb25TZXJ2aWNlLFxuICBtYWtlT3JjaGVzdHJhdG9yLFxuICB2b3dUb29scyxcbiAgYXN5bmNGbG93VG9vbHNcbn0pID0+IHtcbiAgYXNzZXJ0QWxsRGVmaW5lZCh7XG4gICAgem9uZSxcbiAgICB0aW1lclNlcnZpY2UsXG4gICAgemNmLFxuICAgIG9yY2hlc3RyYXRpb25TZXJ2aWNlLFxuICAgIG1ha2VPcmNoZXN0cmF0b3IsXG4gICAgdm93VG9vbHMsXG4gICAgYXN5bmNGbG93VG9vbHNcbiAgfSk7XG4gIGNvbnN0IHsgcHJlcGFyZUVuZG93bWVudCwgYXN5bmNGbG93IH0gPSBhc3luY0Zsb3dUb29scztcbiAgY29uc3Qgb3JjaGVzdHJhdGUgPSAoZHVyYWJsZU5hbWUsIGhvc3RDdHgsIGd1ZXN0Rm4pID0+IHtcbiAgICBjb25zdCBzdWJab25lID0gem9uZS5zdWJab25lKGR1cmFibGVOYW1lKTtcbiAgICBjb25zdCBbd3JhcHBlZEN0eF0gPSBwcmVwYXJlRW5kb3dtZW50KHN1YlpvbmUsIFwiZW5kb3dtZW50c1wiLCBbaG9zdEN0eF0pO1xuICAgIGNvbnN0IGhvc3RGbiA9IGFzeW5jRmxvdyhzdWJab25lLCBcImFzeW5jRmxvd1wiLCBndWVzdEZuKTtcbiAgICBkZWVwTWFwT2JqZWN0KFxuICAgICAgd3JhcHBlZEN0eCxcbiAgICAgICh2YWwpID0+IHZhbCA9PT0gemNmICYmIGFzc2VydC5mYWlsKFwiZG8gbm90IHVzZSB6Y2YgaW4gb3JjaGVzdHJhdGlvbiBjb250ZXh0OyB0cnkgemNmVG9vbHNcIilcbiAgICApO1xuICAgIGNvbnN0IG9yY0ZuID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgY29uc3QgaG9zdE9yYyA9IG1ha2VPcmNoZXN0cmF0b3IoKTtcbiAgICAgICAgcmV0dXJuIGhvc3RGbihob3N0T3JjLCB3cmFwcGVkQ3R4LCAuLi5hcmdzKTtcbiAgICAgIH1cbiAgICApO1xuICAgIHJldHVybiBoYXJkZW4ob3JjRm4pO1xuICB9O1xuICBjb25zdCBvcmNoZXN0cmF0ZUFsbCA9IChndWVzdEZucywgaG9zdEN0eCkgPT4ge1xuICAgIGNvbnN0IG1hcHBlZEZsb3dzID0gbmV3IE1hcChcbiAgICAgIE9iamVjdC5lbnRyaWVzKGd1ZXN0Rm5zKS5tYXAoKFtuYW1lLCBndWVzdEZuXSkgPT4gW1xuICAgICAgICBndWVzdEZuLFxuICAgICAgICAoLi4uYXJncykgPT4gb3JjRm5zW25hbWVdKC4uLmFyZ3MpXG4gICAgICBdKVxuICAgICk7XG4gICAgY29uc3QgbWFwcGVkQ29udGV4dCA9IGRlZXBNYXBPYmplY3QoXG4gICAgICBob3N0Q3R4LFxuICAgICAgKHZhbCkgPT4gbWFwcGVkRmxvd3MuZ2V0KFxuICAgICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApIHx8IHZhbFxuICAgICk7XG4gICAgY29uc3Qgb3JjRm5zID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICAgIE9iamVjdC5lbnRyaWVzKGd1ZXN0Rm5zKS5tYXAoKFtuYW1lLCBndWVzdEZuXSkgPT4gW1xuICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgb3JjaGVzdHJhdGUobmFtZSwgbWFwcGVkQ29udGV4dCwgZ3Vlc3RGbilcbiAgICAgICAgXSlcbiAgICAgIClcbiAgICApO1xuICAgIHJldHVybiB7IC4uLm9yY0ZucyB9O1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBvcmNoZXN0cmF0ZSxcbiAgICBvcmNoZXN0cmF0ZUFsbFxuICB9KTtcbn07XG5oYXJkZW4obWFrZU9yY2hlc3RyYXRpb25GYWNhZGUpO1xuXG4vL1xudmFyIG5hdFNhZmVNYXRoID0gaGFyZGVuKHtcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgLy9cbiAgYWRkOiAoeCwgeSkgPT4gTmF0KHgpICsgTmF0KHkpLFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBzdWJ0cmFjdDogKHgsIHkpID0+IE5hdChOYXQoeCkgLSBOYXQoeSkpLFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBtdWx0aXBseTogKHgsIHkpID0+IE5hdCh4KSAqIE5hdCh5KSxcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgZmxvb3JEaXZpZGU6ICh4LCB5KSA9PiBOYXQoeCkgLyBOYXQoeSksXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIGNlaWxEaXZpZGU6ICh4LCB5KSA9PiB7XG4gICAgeSA9IE5hdCh5KTtcbiAgICByZXR1cm4gTmF0KE5hdCh4KSArIHkgLSAxbikgLyB5O1xuICB9LFxuICAvKlxuXG5cblxuXG4gICAqL1xuICBiYW5rZXJzRGl2aWRlOiAoYTIsIGIzKSA9PiB7XG4gICAgYTIgPSBOYXQoYTIpO1xuICAgIGIzID0gTmF0KGIzKTtcbiAgICBjb25zdCBkaXYgPSBhMiAvIGIzO1xuICAgIGNvbnN0IHJlbSA9IGEyICUgYjM7XG4gICAgaWYgKHJlbSAqIDJuID4gYjMpIHtcbiAgICAgIHJldHVybiBkaXYgKyAxbjtcbiAgICB9IGVsc2UgaWYgKHJlbSAqIDJuID09PSBiMykge1xuICAgICAgaWYgKGRpdiAlIDJuID09PSAxbikgcmV0dXJuIGRpdiArIDFuO1xuICAgIH1cbiAgICByZXR1cm4gZGl2O1xuICB9LFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgaXNHVEU6ICh4LCB5KSA9PiBOYXQoeCkgPj0gTmF0KHkpXG59KTtcblxuLy9cbnZhciB7IHN1YnRyYWN0LCBhZGQsIG11bHRpcGx5LCBmbG9vckRpdmlkZSB9ID0gbmF0U2FmZU1hdGg7XG5cbi8vXG52YXIgbWFrZVN0YXRlTWFjaGluZSA9IChpbml0aWFsU3RhdGUsIGFsbG93ZWRUcmFuc2l0aW9uc0FycmF5KSA9PiB7XG4gIGxldCBzdGF0ZSA9IGluaXRpYWxTdGF0ZTtcbiAgY29uc3QgYWxsb3dlZFRyYW5zaXRpb25zID0gbmV3IE1hcChhbGxvd2VkVHJhbnNpdGlvbnNBcnJheSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGNhblRyYW5zaXRpb25UbzogKG5leHRTdGF0ZSkgPT4gYWxsb3dlZFRyYW5zaXRpb25zLmdldChzdGF0ZSkuaW5jbHVkZXMobmV4dFN0YXRlKSxcbiAgICB0cmFuc2l0aW9uVG86IChuZXh0U3RhdGUpID0+IHtcbiAgICAgIGFzc2VydDIoYWxsb3dlZFRyYW5zaXRpb25zLmdldChzdGF0ZSkuaW5jbHVkZXMobmV4dFN0YXRlKSk7XG4gICAgICBzdGF0ZSA9IG5leHRTdGF0ZTtcbiAgICB9LFxuICAgIGdldFN0YXR1czogKF8pID0+IHN0YXRlXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU3RhdGVNYWNoaW5lKTtcblxuLy9cbnZhciBLZXl3b3JkU2hhcGUgPSBNLnN0cmluZygpO1xudmFyIEludml0YXRpb25IYW5kbGVTaGFwZSA9IE0ucmVtb3RhYmxlKFwiSW52aXRhdGlvbkhhbmRsZVwiKTtcbnZhciBJbnZpdGF0aW9uU2hhcGUgPSBNLnJlbW90YWJsZShcIkludml0YXRpb25cIik7XG52YXIgSW5zdGFuY2VIYW5kbGVTaGFwZSA9IE0ucmVtb3RhYmxlKFwiSW5zdGFuY2VIYW5kbGVcIik7XG52YXIgSW5zdGFsbGF0aW9uU2hhcGUgPSBNLnJlbW90YWJsZShcIkluc3RhbGxhdGlvblwiKTtcbnZhciBTZWF0U2hhcGUgPSBNLnJlbW90YWJsZShcIlNlYXRcIik7XG52YXIgQW1vdW50S2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihLZXl3b3JkU2hhcGUsIEFtb3VudFNoYXBlKTtcbnZhciBBbW91bnRQYXR0ZXJuS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihcbiAgS2V5d29yZFNoYXBlLFxuICBNLnBhdHRlcm4oKVxuKTtcbnZhciBQYXltZW50UEtleXdvcmRSZWNvcmRTaGFwZSA9IE0ucmVjb3JkT2YoXG4gIEtleXdvcmRTaGFwZSxcbiAgTS5lcmVmKFBheW1lbnRTaGFwZSlcbik7XG52YXIgSXNzdWVyS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihLZXl3b3JkU2hhcGUsIElzc3VlclNoYXBlKTtcbnZhciBJc3N1ZXJQS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihcbiAgS2V5d29yZFNoYXBlLFxuICBNLmVyZWYoSXNzdWVyU2hhcGUpXG4pO1xudmFyIEJyYW5kS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihLZXl3b3JkU2hhcGUsIEJyYW5kU2hhcGUpO1xudmFyIElzc3VlclJlY29yZFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGJyYW5kOiBCcmFuZFNoYXBlLFxuICAgIGlzc3VlcjogSXNzdWVyU2hhcGUsXG4gICAgYXNzZXRLaW5kOiBBc3NldEtpbmRTaGFwZVxuICB9LFxuICB7IGRpc3BsYXlJbmZvOiBEaXNwbGF5SW5mb1NoYXBlIH1cbik7XG52YXIgVGVybXNTaGFwZSA9IHtcbiAgaXNzdWVyczogSXNzdWVyS2V5d29yZFJlY29yZFNoYXBlLFxuICBicmFuZHM6IEJyYW5kS2V5d29yZFJlY29yZFNoYXBlXG59O1xuaGFyZGVuKFRlcm1zU2hhcGUpO1xudmFyIEluc3RhbmNlUmVjb3JkU2hhcGUgPSB7XG4gIGluc3RhbGxhdGlvbjogSW5zdGFsbGF0aW9uU2hhcGUsXG4gIGluc3RhbmNlOiBJbnN0YW5jZUhhbmRsZVNoYXBlLFxuICB0ZXJtczogTS5zcGxpdFJlY29yZChUZXJtc1NoYXBlKVxufTtcbmhhcmRlbihJbnN0YW5jZVJlY29yZFNoYXBlKTtcbnZhciBIYW5kbGVJID0gTS5pbnRlcmZhY2UoXCJIYW5kbGVcIiwge30pO1xudmFyIG1ha2VIYW5kbGVTaGFwZSA9IChuYW1lKSA9PiBNLnJlbW90YWJsZShgJHtuYW1lfUhhbmRsZWApO1xudmFyIFRpbWVyU2hhcGUgPSBtYWtlSGFuZGxlU2hhcGUoXCJ0aW1lclwiKTtcbnZhciBGdWxsUHJvcG9zYWxTaGFwZSA9IHtcbiAgd2FudDogQW1vdW50UGF0dGVybktleXdvcmRSZWNvcmRTaGFwZSxcbiAgZ2l2ZTogQW1vdW50S2V5d29yZFJlY29yZFNoYXBlLFxuICAvL1xuICAvL1xuICAvL1xuICBleGl0OiBNLnNwbGl0UmVjb3JkKFxuICAgIHt9LFxuICAgIHtcbiAgICAgIG9uRGVtYW5kOiBudWxsLFxuICAgICAgd2FpdmVkOiBudWxsLFxuICAgICAgYWZ0ZXJEZWFkbGluZToge1xuICAgICAgICB0aW1lcjogTS5lcmVmKFRpbWVyU2hhcGUpLFxuICAgICAgICBkZWFkbGluZTogVGltZXN0YW1wU2hhcGVcbiAgICAgIH1cbiAgICB9LFxuICAgIHt9XG4gIClcbn07XG5oYXJkZW4oRnVsbFByb3Bvc2FsU2hhcGUpO1xudmFyIFByb3Bvc2FsU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHt9LCBGdWxsUHJvcG9zYWxTaGFwZSwge30pO1xudmFyIEVtcHR5UHJvcG9zYWxTaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBnaXZlOiB7fSxcbiAgd2FudDoge30sXG4gIGV4aXQ6IHsgb25EZW1hbmQ6IG51bGwgfVxufSk7XG52YXIgaXNPbkRlbWFuZEV4aXRSdWxlID0gKGV4aXQpID0+IHtcbiAgY29uc3QgW2V4aXRLZXldID0gT2JqZWN0LmtleXMoZXhpdCk7XG4gIHJldHVybiBleGl0S2V5ID09PSBcIm9uRGVtYW5kXCI7XG59O1xuaGFyZGVuKGlzT25EZW1hbmRFeGl0UnVsZSk7XG52YXIgaXNXYWl2ZWRFeGl0UnVsZSA9IChleGl0KSA9PiB7XG4gIGNvbnN0IFtleGl0S2V5XSA9IE9iamVjdC5rZXlzKGV4aXQpO1xuICByZXR1cm4gZXhpdEtleSA9PT0gXCJ3YWl2ZWRcIjtcbn07XG5oYXJkZW4oaXNXYWl2ZWRFeGl0UnVsZSk7XG52YXIgaXNBZnRlckRlYWRsaW5lRXhpdFJ1bGUgPSAoZXhpdCkgPT4ge1xuICBjb25zdCBbZXhpdEtleV0gPSBPYmplY3Qua2V5cyhleGl0KTtcbiAgcmV0dXJuIGV4aXRLZXkgPT09IFwiYWZ0ZXJEZWFkbGluZVwiO1xufTtcbmhhcmRlbihpc0FmdGVyRGVhZGxpbmVFeGl0UnVsZSk7XG52YXIgSW52aXRhdGlvbkVsZW1lbnRTaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBkZXNjcmlwdGlvbjogTS5zdHJpbmcoKSxcbiAgaGFuZGxlOiBJbnZpdGF0aW9uSGFuZGxlU2hhcGUsXG4gIGluc3RhbmNlOiBJbnN0YW5jZUhhbmRsZVNoYXBlLFxuICBpbnN0YWxsYXRpb246IEluc3RhbGxhdGlvblNoYXBlXG59KTtcbnZhciBPZmZlckhhbmRsZXJJID0gTS5pbnRlcmZhY2UoXCJPZmZlckhhbmRsZXJcIiwge1xuICBoYW5kbGU6IE0uY2FsbChTZWF0U2hhcGUpLm9wdGlvbmFsKE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbn0pO1xudmFyIFNlYXRIYW5kbGVBbGxvY2F0aW9uc1NoYXBlID0gTS5hcnJheU9mKHtcbiAgc2VhdEhhbmRsZTogU2VhdFNoYXBlLFxuICBhbGxvY2F0aW9uOiBBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGVcbn0pO1xudmFyIFpvZU1pbnRTaGFwZSA9IE0ucmVtb3RhYmxlKFwiWm9lTWludFwiKTtcbnZhciBab2VNaW50SSA9IE0uaW50ZXJmYWNlKFwiWm9lTWludFwiLCB7XG4gIGdldElzc3VlclJlY29yZDogTS5jYWxsKCkucmV0dXJucyhJc3N1ZXJSZWNvcmRTaGFwZSksXG4gIG1pbnRBbmRFc2Nyb3c6IE0uY2FsbChBbW91bnRTaGFwZSkucmV0dXJucygpLFxuICB3aXRoZHJhd0FuZEJ1cm46IE0uY2FsbChBbW91bnRTaGFwZSkucmV0dXJucygpXG59KTtcbnZhciBGZWVNaW50QWNjZXNzU2hhcGUgPSBNLnJlbW90YWJsZShcIkZlZU1pbnRBY2Nlc3NcIik7XG52YXIgRXhpdE9iamVjdEkgPSBNLmludGVyZmFjZShcIkV4aXQgT2JqZWN0XCIsIHtcbiAgZXhpdDogTS5jYWxsKCkucmV0dXJucygpXG59KTtcbnZhciBFeGl0T2JqZWN0U2hhcGUgPSBNLnJlbW90YWJsZShcIkV4aXRPYmpcIik7XG52YXIgSW5zdGFuY2VBZG1pblNoYXBlID0gTS5yZW1vdGFibGUoXCJJbnN0YW5jZUFkbWluXCIpO1xudmFyIEluc3RhbmNlQWRtaW5JID0gTS5pbnRlcmZhY2UoXCJJbnN0YW5jZUFkbWluXCIsIHtcbiAgbWFrZUludml0YXRpb246IE0uY2FsbChJbnZpdGF0aW9uSGFuZGxlU2hhcGUsIE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0ucmVjb3JkKCksIE0ucGF0dGVybigpKS5yZXR1cm5zKEludml0YXRpb25TaGFwZSksXG4gIHNhdmVJc3N1ZXI6IE0uY2FsbFdoZW4oTS5hd2FpdChJc3N1ZXJTaGFwZSksIEtleXdvcmRTaGFwZSkucmV0dXJucyhcbiAgICBJc3N1ZXJSZWNvcmRTaGFwZVxuICApLFxuICBtYWtlTm9Fc2Nyb3dTZWF0OiBNLmNhbGwoXG4gICAgQW1vdW50S2V5d29yZFJlY29yZFNoYXBlLFxuICAgIFByb3Bvc2FsU2hhcGUsXG4gICAgRXhpdE9iamVjdFNoYXBlLFxuICAgIFNlYXRTaGFwZVxuICApLnJldHVybnMoU2VhdFNoYXBlKSxcbiAgZXhpdEFsbFNlYXRzOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpLFxuICBmYWlsQWxsU2VhdHM6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKCksXG4gIGV4aXRTZWF0OiBNLmNhbGwoU2VhdFNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKCksXG4gIGZhaWxTZWF0OiBNLmNhbGwoU2VhdFNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKCksXG4gIG1ha2Vab2VNaW50OiBNLmNhbGwoS2V5d29yZFNoYXBlKS5vcHRpb25hbChcbiAgICBBc3NldEtpbmRTaGFwZSxcbiAgICBEaXNwbGF5SW5mb1NoYXBlLFxuICAgIE0uc3BsaXRSZWNvcmQoe30sIHsgZWxlbWVudFNoYXBlOiBNLnBhdHRlcm4oKSB9KVxuICApLnJldHVybnMoTS5yZW1vdGFibGUoXCJ6b2VNaW50XCIpKSxcbiAgcmVnaXN0ZXJGZWVNaW50OiBNLmNhbGwoS2V5d29yZFNoYXBlLCBGZWVNaW50QWNjZXNzU2hhcGUpLnJldHVybnMoXG4gICAgTS5yZW1vdGFibGUoXCJmZWVNaW50XCIpXG4gICksXG4gIHJlcGxhY2VBbGxvY2F0aW9uczogTS5jYWxsKFNlYXRIYW5kbGVBbGxvY2F0aW9uc1NoYXBlKS5yZXR1cm5zKCksXG4gIHN0b3BBY2NlcHRpbmdPZmZlcnM6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgc2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbChNLmFycmF5T2YoTS5zdHJpbmcoKSkpLnJldHVybnMoKSxcbiAgZ2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbCgpLnJldHVybnMoTS5hcnJheU9mKE0uc3RyaW5nKCkpKSxcbiAgZ2V0RXhpdFN1YnNjcmliZXI6IE0uY2FsbChTZWF0U2hhcGUpLnJldHVybnMoU3Vic2NyaWJlclNoYXBlKSxcbiAgaXNCbG9ja2VkOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhNLmJvb2xlYW4oKSksXG4gIHJlcGFpckNvbnRyYWN0Q29tcGxldGlvbldhdGNoZXI6IE0uY2FsbCgpLnJldHVybnMoKVxufSk7XG52YXIgSW5zdGFuY2VTdG9yYWdlTWFuYWdlcklLaXQgPSB7XG4gIGluc3RhbmNlU3RvcmFnZU1hbmFnZXI6IE0uaW50ZXJmYWNlKFwiSW5zdGFuY2VTdG9yYWdlTWFuYWdlclwiLCB7XG4gICAgZ2V0VGVybXM6IE0uY2FsbCgpLnJldHVybnMoTS5zcGxpdFJlY29yZChUZXJtc1NoYXBlKSksXG4gICAgZ2V0SXNzdWVyczogTS5jYWxsKCkucmV0dXJucyhJc3N1ZXJLZXl3b3JkUmVjb3JkU2hhcGUpLFxuICAgIGdldEJyYW5kczogTS5jYWxsKCkucmV0dXJucyhCcmFuZEtleXdvcmRSZWNvcmRTaGFwZSksXG4gICAgZ2V0SW5zdGFsbGF0aW9uOiBNLmNhbGwoKS5yZXR1cm5zKEluc3RhbGxhdGlvblNoYXBlKSxcbiAgICBnZXRJbnZpdGF0aW9uSXNzdWVyOiBNLmNhbGwoKS5yZXR1cm5zKElzc3VlclNoYXBlKSxcbiAgICBzYXZlSXNzdWVyOiBNLmNhbGwoSXNzdWVyU2hhcGUsIEtleXdvcmRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgbWFrZVpvZU1pbnQ6IE0uY2FsbChLZXl3b3JkU2hhcGUpLm9wdGlvbmFsKFxuICAgICAgQXNzZXRLaW5kU2hhcGUsXG4gICAgICBEaXNwbGF5SW5mb1NoYXBlLFxuICAgICAgTS5zcGxpdFJlY29yZCh7fSwgeyBlbGVtZW50U2hhcGU6IE0ucGF0dGVybigpIH0pXG4gICAgKS5yZXR1cm5zKE0uZXJlZihab2VNaW50U2hhcGUpKSxcbiAgICByZWdpc3RlckZlZU1pbnQ6IE0uY2FsbChLZXl3b3JkU2hhcGUsIEZlZU1pbnRBY2Nlc3NTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ucmVtb3RhYmxlKFwiZmVlTWludFwiKVxuICAgICksXG4gICAgZ2V0SW5zdGFuY2VSZWNvcmQ6IE0uY2FsbCgpLnJldHVybnMoSW5zdGFuY2VSZWNvcmRTaGFwZSksXG4gICAgZ2V0SXNzdWVyUmVjb3JkczogTS5jYWxsKCkucmV0dXJucyhNLmFycmF5T2YoSXNzdWVyUmVjb3JkU2hhcGUpKSxcbiAgICBnZXRXaXRoZHJhd0ZhY2V0OiBNLmNhbGwoKS5yZXR1cm5zKE0ucmVtb3RhYmxlKFwiV2l0aGRyYXdGYWNldFwiKSksXG4gICAgaW5pdEluc3RhbmNlQWRtaW46IE0uY2FsbChcbiAgICAgIEluc3RhbmNlSGFuZGxlU2hhcGUsXG4gICAgICBNLnJlbW90YWJsZShcImluc3RhbmNlQWRtaW5cIilcbiAgICApLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIGRlbGV0ZUluc3RhbmNlQWRtaW46IE0uY2FsbChJbnN0YW5jZUFkbWluU2hhcGUpLnJldHVybnMoKSxcbiAgICBtYWtlSW52aXRhdGlvbjogTS5jYWxsKEludml0YXRpb25IYW5kbGVTaGFwZSwgTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5yZWNvcmQoKSwgTS5wYXR0ZXJuKCkpLnJldHVybnMoUGF5bWVudFNoYXBlKSxcbiAgICBnZXRSb290OiBNLmNhbGwoKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgIGdldEFkbWluTm9kZTogTS5jYWxsKCkucmV0dXJucyhNLnJlbW90YWJsZShcImFkbWluTm9kZVwiKSlcbiAgfSksXG4gIHdpdGhkcmF3RmFjZXQ6IE0uaW50ZXJmYWNlKFwiV2l0aGRyYXdGYWNldFwiLCB7XG4gICAgd2l0aGRyYXdQYXltZW50czogTS5jYWxsKEFtb3VudEtleXdvcmRSZWNvcmRTaGFwZSkucmV0dXJucyhcbiAgICAgIFBheW1lbnRQS2V5d29yZFJlY29yZFNoYXBlXG4gICAgKVxuICB9KSxcbiAgaGVscGVyczogTS5pbnRlcmZhY2UoXCJJbnN0YW5jZVN0b3JhZ2VNYW5hZ2VyIGhlbHBlclwiLCB7XG4gICAgd3JhcElzc3VlcktpdFdpdGhab2VNaW50OiBNLmNhbGwoXG4gICAgICBLZXl3b3JkU2hhcGUsXG4gICAgICBJc3N1ZXJLaXRTaGFwZSxcbiAgICAgIE0ucmVtb3RhYmxlKFwiYWRtaW5Ob2RlXCIpXG4gICAgKS5yZXR1cm5zKFpvZU1pbnRTaGFwZSlcbiAgfSlcbn07XG5oYXJkZW4oSW5zdGFuY2VTdG9yYWdlTWFuYWdlcklLaXQpO1xudmFyIEJ1bmRsZUNhcFNoYXBlID0gTS5yZW1vdGFibGUoXCJidW5kbGVDYXBcIik7XG52YXIgQnVuZGxlU2hhcGUgPSBNLmFuZChcbiAgTS5zcGxpdFJlY29yZCh7IG1vZHVsZUZvcm1hdDogTS5hbnkoKSB9KSxcbiAgTS5yZWNvcmRPZihNLnN0cmluZygpLCBNLnN0cmluZyh7IHN0cmluZ0xlbmd0aExpbWl0OiBJbmZpbml0eSB9KSlcbik7XG52YXIgVW53cmFwcGVkSW5zdGFsbGF0aW9uU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7IGluc3RhbGxhdGlvbjogSW5zdGFsbGF0aW9uU2hhcGUgfSxcbiAge1xuICAgIGJ1bmRsZTogTS5yZWNvcmRPZihNLnN0cmluZygpLCBNLnN0cmluZyh7IHN0cmluZ0xlbmd0aExpbWl0OiBJbmZpbml0eSB9KSksXG4gICAgYnVuZGxlQ2FwOiBCdW5kbGVDYXBTaGFwZSxcbiAgICBidW5kbGVJRDogTS5zdHJpbmcoKVxuICB9LFxuICB7fVxuKTtcbnZhciBab2VTdG9yYWdlTWFuYWdlcklLaXQgPSB7XG4gIHpvZVNlcnZpY2VEYXRhQWNjZXNzOiBNLmludGVyZmFjZShcIlpvZVNlcnZpY2UgZGF0YUFjY2Vzc1wiLCB7XG4gICAgZ2V0VGVybXM6IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKE0uc3BsaXRSZWNvcmQoVGVybXNTaGFwZSkpLFxuICAgIGdldElzc3VlcnM6IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKElzc3VlcktleXdvcmRSZWNvcmRTaGFwZSksXG4gICAgZ2V0QnJhbmRzOiBNLmNhbGwoSW5zdGFuY2VIYW5kbGVTaGFwZSkucmV0dXJucyhCcmFuZEtleXdvcmRSZWNvcmRTaGFwZSksXG4gICAgZ2V0SW5zdGFsbGF0aW9uOiBNLmNhbGwoSW5zdGFuY2VIYW5kbGVTaGFwZSkucmV0dXJucyhcbiAgICAgIE0uZXJlZihNLnJlbW90YWJsZShcIkluc3RhbGxhdGlvblwiKSlcbiAgICApLFxuICAgIGdldEludml0YXRpb25Jc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUpLFxuICAgIGdldEJ1bmRsZUlERnJvbUluc3RhbGxhdGlvbjogTS5jYWxsKEluc3RhbGxhdGlvblNoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5lcmVmKE0uc3RyaW5nKCkpXG4gICAgKSxcbiAgICBpbnN0YWxsQnVuZGxlOiBNLmNhbGwoQnVuZGxlU2hhcGUpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIGluc3RhbGxCdW5kbGVJRDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIGdldFB1YmxpY0ZhY2V0OiBNLmNhbGwoSW5zdGFuY2VIYW5kbGVTaGFwZSkucmV0dXJucyhcbiAgICAgIE0uZXJlZihNLnJlbW90YWJsZShcIlB1YmxpY0ZhY2V0XCIpKVxuICAgICksXG4gICAgZ2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKE0uYXJyYXlPZihNLnN0cmluZygpKSksXG4gICAgZ2V0UHJvcG9zYWxTaGFwZUZvckludml0YXRpb246IE0uY2FsbChJbnZpdGF0aW9uSGFuZGxlU2hhcGUpLnJldHVybnMoXG4gICAgICBNLm9wdChNLnBhdHRlcm4oKSlcbiAgICApXG4gIH0pLFxuICBtYWtlT2ZmZXJBY2Nlc3M6IE0uaW50ZXJmYWNlKFwiWm9lU3RvcmFnZSBtYWtlT2ZmZXIgYWNjZXNzXCIsIHtcbiAgICBnZXRBc3NldEtpbmRCeUJyYW5kOiBNLmNhbGwoQnJhbmRTaGFwZSkucmV0dXJucyhBc3NldEtpbmRTaGFwZSksXG4gICAgZ2V0SW5zdGFuY2VBZG1pbjogTS5jYWxsKEluc3RhbmNlSGFuZGxlU2hhcGUpLnJldHVybnMoXG4gICAgICBNLnJlbW90YWJsZShcImluc3RhbmNlQWRtaW5cIilcbiAgICApLFxuICAgIGdldFByb3Bvc2FsU2hhcGVGb3JJbnZpdGF0aW9uOiBNLmNhbGwoSW52aXRhdGlvbkhhbmRsZVNoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5vcHQoTS5wYXR0ZXJuKCkpXG4gICAgKSxcbiAgICBnZXRJbnZpdGF0aW9uSXNzdWVyOiBNLmNhbGwoKS5yZXR1cm5zKElzc3VlclNoYXBlKSxcbiAgICBkZXBvc2l0UGF5bWVudHM6IE0uY2FsbChQcm9wb3NhbFNoYXBlLCBQYXltZW50UEtleXdvcmRSZWNvcmRTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ucHJvbWlzZSgpXG4gICAgKVxuICB9KSxcbiAgc3RhcnRJbnN0YW5jZUFjY2VzczogTS5pbnRlcmZhY2UoXCJab2VTdG9yYWdlIHN0YXJ0SW5zdGFuY2UgYWNjZXNzXCIsIHtcbiAgICBtYWtlWm9lSW5zdGFuY2VTdG9yYWdlTWFuYWdlcjogTS5jYWxsKFxuICAgICAgSW5zdGFsbGF0aW9uU2hhcGUsXG4gICAgICBNLmFueSgpLFxuICAgICAgSXNzdWVyUEtleXdvcmRSZWNvcmRTaGFwZSxcbiAgICAgIEluc3RhbmNlSGFuZGxlU2hhcGUsXG4gICAgICBNLm9yKEJ1bmRsZUNhcFNoYXBlLCBCdW5kbGVTaGFwZSksXG4gICAgICBNLnN0cmluZygpXG4gICAgKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICB1bndyYXBJbnN0YWxsYXRpb246IE0uY2FsbFdoZW4oTS5lcmVmKEluc3RhbGxhdGlvblNoYXBlKSkucmV0dXJucyhcbiAgICAgIFVud3JhcHBlZEluc3RhbGxhdGlvblNoYXBlXG4gICAgKVxuICB9KSxcbiAgaW52aXRhdGlvbklzc3VlckFjY2VzczogTS5pbnRlcmZhY2UoXCJab2VTdG9yYWdlIGludml0YXRpb25Jc3N1ZXJcIiwge1xuICAgIGdldEludml0YXRpb25Jc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUpXG4gIH0pXG59O1xuaGFyZGVuKFpvZVN0b3JhZ2VNYW5hZ2VySUtpdCk7XG52YXIgWm9lU2VydmljZUkgPSBNLmludGVyZmFjZShcIlpvZVNlcnZpY2VcIiwge1xuICBpbnN0YWxsOiBNLmNhbGwoTS5hbnkoKSkub3B0aW9uYWwoTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGluc3RhbGxCdW5kbGVJRDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBzdGFydEluc3RhbmNlOiBNLmNhbGwoTS5lcmVmKEluc3RhbGxhdGlvblNoYXBlKSkub3B0aW9uYWwoSXNzdWVyUEtleXdvcmRSZWNvcmRTaGFwZSwgTS5yZWNvcmQoKSwgTS5yZWNvcmQoKSwgTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIG9mZmVyOiBNLmNhbGwoTS5lcmVmKEludml0YXRpb25TaGFwZSkpLm9wdGlvbmFsKFByb3Bvc2FsU2hhcGUsIFBheW1lbnRQS2V5d29yZFJlY29yZFNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBNLmFycmF5T2YoTS5zdHJpbmcoKSlcbiAgKSxcbiAgZ2V0SW52aXRhdGlvbklzc3VlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldEZlZUlzc3VlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldEJyYW5kczogTS5jYWxsV2hlbihNLmF3YWl0KEluc3RhbmNlSGFuZGxlU2hhcGUpKS5yZXR1cm5zKFxuICAgIEJyYW5kS2V5d29yZFJlY29yZFNoYXBlXG4gICksXG4gIGdldElzc3VlcnM6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBJc3N1ZXJLZXl3b3JkUmVjb3JkU2hhcGVcbiAgKSxcbiAgZ2V0UHVibGljRmFjZXQ6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBNLnJlbW90YWJsZShcIlB1YmxpY0ZhY2V0XCIpXG4gICksXG4gIGdldFRlcm1zOiBNLmNhbGxXaGVuKE0uYXdhaXQoSW5zdGFuY2VIYW5kbGVTaGFwZSkpLnJldHVybnMoTS5hbnkoKSksXG4gIGdldEluc3RhbGxhdGlvbkZvckluc3RhbmNlOiBNLmNhbGxXaGVuKE0uYXdhaXQoSW5zdGFuY2VIYW5kbGVTaGFwZSkpLnJldHVybnMoXG4gICAgTS5lcmVmKE0ucmVtb3RhYmxlKFwiSW5zdGFsbGF0aW9uXCIpKVxuICApLFxuICBnZXRCdW5kbGVJREZyb21JbnN0YWxsYXRpb246IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YWxsYXRpb25TaGFwZSkpLnJldHVybnMoXG4gICAgTS5lcmVmKE0uc3RyaW5nKCkpXG4gICksXG4gIGdldEluc3RhbGxhdGlvbjogTS5jYWxsKE0uZXJlZihJbnZpdGF0aW9uU2hhcGUpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0SW5zdGFuY2U6IE0uY2FsbChNLmVyZWYoSW52aXRhdGlvblNoYXBlKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldENvbmZpZ3VyYXRpb246IE0uY2FsbCgpLnJldHVybnMoe1xuICAgIGZlZUlzc3VlckNvbmZpZzoge1xuICAgICAgbmFtZTogTS5zdHJpbmcoKSxcbiAgICAgIGFzc2V0S2luZDogXCJuYXRcIixcbiAgICAgIGRpc3BsYXlJbmZvOiBEaXNwbGF5SW5mb1NoYXBlXG4gICAgfVxuICB9KSxcbiAgZ2V0SW52aXRhdGlvbkRldGFpbHM6IE0uY2FsbChNLmVyZWYoSW52aXRhdGlvblNoYXBlKSkucmV0dXJucyhNLmFueSgpKSxcbiAgZ2V0UHJvcG9zYWxTaGFwZUZvckludml0YXRpb246IE0uY2FsbChJbnZpdGF0aW9uSGFuZGxlU2hhcGUpLnJldHVybnMoXG4gICAgTS5vcHQoTS5wYXR0ZXJuKCkpXG4gIClcbn0pO1xudmFyIEFkbWluRmFjZXRJID0gTS5pbnRlcmZhY2UoXCJaY2ZBZG1pbkZhY2V0XCIsIHtcbiAgZ2V0VmF0U2h1dGRvd25Qcm9taXNlOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgcmVzdGFydENvbnRyYWN0OiBNLmNhbGwoKS5vcHRpb25hbChNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgdXBncmFkZUNvbnRyYWN0OiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hbnkoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIHRlcm1pbmF0ZUNvbnRyYWN0OiBNLmNhbGwoTS5lcnJvcigpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxufSk7XG52YXIgU2VhdERhdGFTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBwcm9wb3NhbDogUHJvcG9zYWxTaGFwZSxcbiAgICBpbml0aWFsQWxsb2NhdGlvbjogQW1vdW50S2V5d29yZFJlY29yZFNoYXBlLFxuICAgIHNlYXRIYW5kbGU6IFNlYXRTaGFwZVxuICB9LFxuICB7XG4gICAgb2ZmZXJBcmdzOiBNLmFueSgpXG4gIH1cbik7XG52YXIgSGFuZGxlT2ZmZXJJID0gTS5pbnRlcmZhY2UoXCJIYW5kbGVPZmZlclwiLCB7XG4gIGhhbmRsZU9mZmVyOiBNLmNhbGwoSW52aXRhdGlvbkhhbmRsZVNoYXBlLCBTZWF0RGF0YVNoYXBlKS5yZXR1cm5zKHtcbiAgICBvZmZlclJlc3VsdFByb21pc2U6IE0ucHJvbWlzZSgpLFxuICAgIGV4aXRPYmo6IEV4aXRPYmplY3RTaGFwZVxuICB9KVxufSk7XG52YXIgUHJpY2VRdW90ZVNoYXBlID0ge1xuICBxdW90ZUFtb3VudDogQW1vdW50U2hhcGUsXG4gIHF1b3RlUGF5bWVudDogTS5lcmVmKFBheW1lbnRTaGFwZSlcbn07XG5oYXJkZW4oUHJpY2VRdW90ZVNoYXBlKTtcblxuLy9cbnZhciBUcmFuc2ZlclBhcnRTaGFwZSA9IE0uc3BsaXRBcnJheShcbiAgaGFyZGVuKFtNLm9wdChTZWF0U2hhcGUpLCBNLm9wdChTZWF0U2hhcGUpLCBNLm9wdChBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUpXSksXG4gIGhhcmRlbihbTS5vcHQoQW1vdW50S2V5d29yZFJlY29yZFNoYXBlKV0pXG4pO1xudmFyIGZyb21Pbmx5ID0gKGZyb21TZWF0LCBmcm9tQW1vdW50cykgPT4gaGFyZGVuKFtmcm9tU2VhdCwgdm9pZCAwLCBmcm9tQW1vdW50c10pO1xudmFyIHRvT25seSA9ICh0b1NlYXQsIHRvQW1vdW50cykgPT4gaGFyZGVuKFt2b2lkIDAsIHRvU2VhdCwgdm9pZCAwLCB0b0Ftb3VudHNdKTtcbnZhciBhdG9taWNUcmFuc2ZlciA9ICh6Y2YsIGZyb21TZWF0ID0gdm9pZCAwLCB0b1NlYXQgPSB2b2lkIDAsIGZyb21BbW91bnRzID0gdm9pZCAwLCB0b0Ftb3VudHMgPSB2b2lkIDApID0+IHpjZi5hdG9taWNSZWFycmFuZ2UoaGFyZGVuKFtbZnJvbVNlYXQsIHRvU2VhdCwgZnJvbUFtb3VudHMsIHRvQW1vdW50c11dKSk7XG5cbi8vXG52YXIgc2F0aXNmaWVzSW50ZXJuYWwgPSAoZ2l2ZU9yV2FudCA9IHt9LCBhbGxvY2F0aW9uKSA9PiB7XG4gIGNvbnN0IGlzR1RFQnlLZXl3b3JkID0gKFtrZXl3b3JkLCByZXF1aXJlZEFtb3VudF0pID0+IHtcbiAgICBpZiAoYWxsb2NhdGlvbltrZXl3b3JkXSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgY29uc3QgYWxsb2NhdGlvbkFtb3VudCA9IGFsbG9jYXRpb25ba2V5d29yZF07XG4gICAgcmV0dXJuIEFtb3VudE1hdGguaXNHVEUoYWxsb2NhdGlvbkFtb3VudCwgcmVxdWlyZWRBbW91bnQpID8gMSA6IDA7XG4gIH07XG4gIHJldHVybiBPYmplY3QuZW50cmllcyhnaXZlT3JXYW50KS5ldmVyeShpc0dURUJ5S2V5d29yZCkgPyAxIDogMDtcbn07XG52YXIgc2F0aXNmaWVzV2FudCA9IChwcm9wb3NhbCwgYWxsb2NhdGlvbikgPT4gc2F0aXNmaWVzSW50ZXJuYWwocHJvcG9zYWwud2FudCwgYWxsb2NhdGlvbik7XG52YXIgc2F0aXNmaWVzR2l2ZSA9IChwcm9wb3NhbCwgYWxsb2NhdGlvbikgPT4gc2F0aXNmaWVzSW50ZXJuYWwocHJvcG9zYWwuZ2l2ZSwgYWxsb2NhdGlvbik7XG5mdW5jdGlvbiBpc09mZmVyU2FmZShwcm9wb3NhbCwgYWxsb2NhdGlvbikge1xuICByZXR1cm4gc2F0aXNmaWVzR2l2ZShwcm9wb3NhbCwgYWxsb2NhdGlvbikgPiAwIHx8IHNhdGlzZmllc1dhbnQocHJvcG9zYWwsIGFsbG9jYXRpb24pID4gMDtcbn1cbmhhcmRlbihpc09mZmVyU2FmZSk7XG5oYXJkZW4oc2F0aXNmaWVzV2FudCk7XG5cbi8vXG52YXIgZGVwb3NpdFRvU2VhdFN1Y2Nlc3NNc2cgPSBgRGVwb3NpdCBhbmQgcmVhbGxvY2F0aW9uIHN1Y2Nlc3NmdWwuYDtcbnZhciBkZXBvc2l0VG9TZWF0ID0gYXN5bmMgKHpjZiwgcmVjaXBpZW50U2VhdCwgYW1vdW50cywgcGF5bWVudHMpID0+IHtcbiAgIXJlY2lwaWVudFNlYXQuaGFzRXhpdGVkKCkgfHwgdGhyb3dSZWRhY3RlZGBUaGUgcmVjaXBpZW50U2VhdCBjYW5ub3QgaGF2ZSBleGl0ZWQuYDtcbiAgY29uc3QgcmVhbGxvY2F0ZUFmdGVyRGVwb3NpdCA9ICh0ZW1wU2VhdCkgPT4ge1xuICAgIGF0b21pY1RyYW5zZmVyKHpjZiwgdGVtcFNlYXQsIHJlY2lwaWVudFNlYXQsIGFtb3VudHMpO1xuICAgIHRlbXBTZWF0LmV4aXQoKTtcbiAgICByZXR1cm4gZGVwb3NpdFRvU2VhdFN1Y2Nlc3NNc2c7XG4gIH07XG4gIGNvbnN0IGludml0YXRpb24gPSB6Y2YubWFrZUludml0YXRpb24oXG4gICAgcmVhbGxvY2F0ZUFmdGVyRGVwb3NpdCxcbiAgICBcInRlbXBvcmFyeSBzZWF0IGZvciBkZXBvc2l0XCJcbiAgKTtcbiAgY29uc3QgcHJvcG9zYWwgPSBoYXJkZW4oeyBnaXZlOiBhbW91bnRzIH0pO1xuICBoYXJkZW4ocGF5bWVudHMpO1xuICBjb25zdCB6b2UgPSB6Y2YuZ2V0Wm9lU2VydmljZSgpO1xuICBjb25zdCB0ZW1wVXNlclNlYXQgPSBFKHpvZSkub2ZmZXIoaW52aXRhdGlvbiwgcHJvcG9zYWwsIHBheW1lbnRzKTtcbiAgcmV0dXJuIEUodGVtcFVzZXJTZWF0KS5nZXRPZmZlclJlc3VsdCgpO1xufTtcblxuLy9cbnZhciB7IG11bHRpcGx5OiBtdWx0aXBseTIsIGZsb29yRGl2aWRlOiBmbG9vckRpdmlkZTIsIGNlaWxEaXZpZGUsIGJhbmtlcnNEaXZpZGUsIGFkZDogYWRkMiwgc3VidHJhY3Q6IHN1YnRyYWN0MiB9ID0gbmF0U2FmZU1hdGg7XG52YXIgUEVSQ0VOVCA9IDEwMG47XG52YXIgcmF0aW9Qcm9wZXJ0eU5hbWVzID0gW1wibnVtZXJhdG9yXCIsIFwiZGVub21pbmF0b3JcIl07XG52YXIgYXNzZXJ0SXNSYXRpbyA9IChyYXRpbykgPT4ge1xuICBhc3NlcnRSZWNvcmQocmF0aW8sIFwicmF0aW9cIik7XG4gIGNvbnN0IGtleXM0ID0gT2JqZWN0LmtleXMocmF0aW8pO1xuICBrZXlzNC5sZW5ndGggPT09IDIgfHwgdGhyb3dSZWRhY3RlZGBSYXRpbyAke3JhdGlvfSBtdXN0IGJlIGEgcmVjb3JkIHdpdGggMiBmaWVsZHMuYDtcbiAgZm9yIChjb25zdCBuYW1lIG9mIGtleXM0KSB7XG4gICAgcmF0aW9Qcm9wZXJ0eU5hbWVzLmluY2x1ZGVzKG5hbWUpIHx8IHRocm93UmVkYWN0ZWRgUGFyYW1ldGVyIG11c3QgYmUgYSBSYXRpbyByZWNvcmQsIGJ1dCAke3JhdGlvfSBoYXMgJHtxdW90ZShuYW1lKX1gO1xuICB9XG4gIGNvbnN0IG51bWVyYXRvclZhbHVlID0gcmF0aW8ubnVtZXJhdG9yLnZhbHVlO1xuICBjb25zdCBkZW5vbWluYXRvclZhbHVlID0gcmF0aW8uZGVub21pbmF0b3IudmFsdWU7XG4gIGlzTmF0KG51bWVyYXRvclZhbHVlKSB8fCB0aHJvd1JlZGFjdGVkYFRoZSBudW1lcmF0b3IgdmFsdWUgbXVzdCBiZSBhIE5hdFZhbHVlLCBub3QgJHtudW1lcmF0b3JWYWx1ZX1gO1xuICBpc05hdChkZW5vbWluYXRvclZhbHVlKSB8fCB0aHJvd1JlZGFjdGVkYFRoZSBkZW5vbWluYXRvciB2YWx1ZSBtdXN0IGJlIGEgTmF0VmFsdWUsIG5vdCAke2Rlbm9taW5hdG9yVmFsdWV9YDtcbn07XG52YXIgbWFrZVJhdGlvID0gKG51bWVyYXRvciwgbnVtZXJhdG9yQnJhbmQsIGRlbm9taW5hdG9yID0gUEVSQ0VOVCwgZGVub21pbmF0b3JCcmFuZCA9IG51bWVyYXRvckJyYW5kKSA9PiB7XG4gIGRlbm9taW5hdG9yID4gMG4gfHwgdGhyb3dSZWRhY3RlZGBObyBpbmZpbml0ZSByYXRpb3MhIERlbm9taW5hdG9yIHdhcyAwICR7cXVvdGUoZGVub21pbmF0b3JCcmFuZCl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgbnVtZXJhdG9yOiBBbW91bnRNYXRoLm1ha2UobnVtZXJhdG9yQnJhbmQsIG51bWVyYXRvciksXG4gICAgZGVub21pbmF0b3I6IEFtb3VudE1hdGgubWFrZShkZW5vbWluYXRvckJyYW5kLCBkZW5vbWluYXRvcilcbiAgfSk7XG59O1xudmFyIG1ha2VSYXRpb0Zyb21BbW91bnRzID0gKG51bWVyYXRvckFtb3VudCwgZGVub21pbmF0b3JBbW91bnQpID0+IHtcbiAgQW1vdW50TWF0aC5jb2VyY2UobnVtZXJhdG9yQW1vdW50LmJyYW5kLCBudW1lcmF0b3JBbW91bnQpO1xuICBBbW91bnRNYXRoLmNvZXJjZShkZW5vbWluYXRvckFtb3VudC5icmFuZCwgZGVub21pbmF0b3JBbW91bnQpO1xuICByZXR1cm4gbWFrZVJhdGlvKFxuICAgIC8vXG4gICAgbnVtZXJhdG9yQW1vdW50LnZhbHVlLFxuICAgIG51bWVyYXRvckFtb3VudC5icmFuZCxcbiAgICBkZW5vbWluYXRvckFtb3VudC52YWx1ZSxcbiAgICBkZW5vbWluYXRvckFtb3VudC5icmFuZFxuICApO1xufTtcbnZhciBtdWx0aXBseUhlbHBlciA9IChhbW91bnQsIHJhdGlvLCBkaXZpZGVPcCkgPT4ge1xuICBBbW91bnRNYXRoLmNvZXJjZShhbW91bnQuYnJhbmQsIGFtb3VudCk7XG4gIGFzc2VydElzUmF0aW8ocmF0aW8pO1xuICBhbW91bnQuYnJhbmQgPT09IHJhdGlvLmRlbm9taW5hdG9yLmJyYW5kIHx8IHRocm93UmVkYWN0ZWRgYW1vdW50J3MgYnJhbmQgJHtxdW90ZShhbW91bnQuYnJhbmQpfSBtdXN0IG1hdGNoIHJhdGlvJ3MgZGVub21pbmF0b3IgJHtxdW90ZShcbiAgICByYXRpby5kZW5vbWluYXRvci5icmFuZFxuICApfWA7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEFtb3VudE1hdGgubWFrZShcbiAgICAgIHJhdGlvLm51bWVyYXRvci5icmFuZCxcbiAgICAgIGRpdmlkZU9wKFxuICAgICAgICBtdWx0aXBseTIoYW1vdW50LnZhbHVlLCByYXRpby5udW1lcmF0b3IudmFsdWUpLFxuICAgICAgICByYXRpby5kZW5vbWluYXRvci52YWx1ZVxuICAgICAgKVxuICAgIClcbiAgKTtcbn07XG52YXIgbXVsdGlwbHlCeSA9IChhbW91bnQsIHJhdGlvKSA9PiB7XG4gIHJldHVybiBtdWx0aXBseUhlbHBlcihhbW91bnQsIHJhdGlvLCBiYW5rZXJzRGl2aWRlKTtcbn07XG52YXIgZGl2aWRlSGVscGVyID0gKGFtb3VudCwgcmF0aW8sIGRpdmlkZU9wKSA9PiB7XG4gIEFtb3VudE1hdGguY29lcmNlKGFtb3VudC5icmFuZCwgYW1vdW50KTtcbiAgYXNzZXJ0SXNSYXRpbyhyYXRpbyk7XG4gIGFtb3VudC5icmFuZCA9PT0gcmF0aW8ubnVtZXJhdG9yLmJyYW5kIHx8IHRocm93UmVkYWN0ZWRgYW1vdW50J3MgYnJhbmQgJHtxdW90ZShhbW91bnQuYnJhbmQpfSBtdXN0IG1hdGNoIHJhdGlvJ3MgbnVtZXJhdG9yICR7cXVvdGUoXG4gICAgcmF0aW8ubnVtZXJhdG9yLmJyYW5kXG4gICl9YDtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQW1vdW50TWF0aC5tYWtlKFxuICAgICAgcmF0aW8uZGVub21pbmF0b3IuYnJhbmQsXG4gICAgICBkaXZpZGVPcChcbiAgICAgICAgbXVsdGlwbHkyKGFtb3VudC52YWx1ZSwgcmF0aW8uZGVub21pbmF0b3IudmFsdWUpLFxuICAgICAgICByYXRpby5udW1lcmF0b3IudmFsdWVcbiAgICAgIClcbiAgICApXG4gICk7XG59O1xudmFyIGRpdmlkZUJ5ID0gKGFtb3VudCwgcmF0aW8pID0+IHtcbiAgcmV0dXJuIGRpdmlkZUhlbHBlcihhbW91bnQsIHJhdGlvLCBiYW5rZXJzRGl2aWRlKTtcbn07XG5cbi8vXG52YXIgbWFrZUVwaGVtZXJhUHJvdmlkZXIgPSAoaW5pdCkgPT4ge1xuICBjb25zdCBleHRhbnQgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgcmV0dXJuIChrZXkpID0+IHtcbiAgICBpZiAoZXh0YW50LmhhcyhrZXkpKSB7XG4gICAgICByZXR1cm4gZXh0YW50LmdldChrZXkpO1xuICAgIH1cbiAgICBjb25zdCBuZXdFcGggPSBpbml0KGtleSk7XG4gICAgZXh0YW50LnNldChrZXksIG5ld0VwaCk7XG4gICAgcmV0dXJuIG5ld0VwaDtcbiAgfTtcbn07XG5oYXJkZW4obWFrZUVwaGVtZXJhUHJvdmlkZXIpO1xudmFyIHByb3ZpZGVFbXB0eVNlYXQgPSAoemNmLCBiYWdnYWdlLCBuYW1lKSA9PiB7XG4gIHJldHVybiBwcm92aWRlKGJhZ2dhZ2UsIG5hbWUsICgpID0+IHpjZi5tYWtlRW1wdHlTZWF0S2l0KCkuemNmU2VhdCk7XG59O1xuaGFyZGVuKHByb3ZpZGVFbXB0eVNlYXQpO1xudmFyIHByb3ZpZGVBbGwgPSAoYmFnZ2FnZSwgdGh1bmtzKSA9PiB7XG4gIGNvbnN0IGtleXM0ID0gT2JqZWN0LmtleXModGh1bmtzKTtcbiAgY29uc3QgaW5CYWdnYWdlID0gYmFnZ2FnZS5oYXMoa2V5czRbMF0pO1xuICBpZiAoaW5CYWdnYWdlKSB7XG4gICAgY29uc3Qgb2JqID0gb2JqZWN0TWFwKFxuICAgICAgdGh1bmtzLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIChfLCBrKSA9PiBiYWdnYWdlLmdldChrKVxuICAgICk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShoYXJkZW4ob2JqKSk7XG4gIH1cbiAgY29uc3Qga2V5ZWRQcm9taXNlcyA9IG9iamVjdE1hcCh0aHVua3MsIChmbikgPT4gZm4oKSk7XG4gIHJldHVybiBhbGxWYWx1ZXMoa2V5ZWRQcm9taXNlcykudGhlbigoa2V5ZWRWYWxzKSA9PiB7XG4gICAgZm9yIChjb25zdCBbaywgdjNdIG9mIE9iamVjdC5lbnRyaWVzKGtleWVkVmFscykpIHtcbiAgICAgIGJhZ2dhZ2UuaW5pdChrLCB2Myk7XG4gICAgfVxuICAgIHJldHVybiBrZXllZFZhbHM7XG4gIH0pO1xufTtcbmhhcmRlbihwcm92aWRlQWxsKTtcbnZhciBwcm92aWRlU2luZ2xldG9uID0gKG1hcFN0b3JlLCBrZXksIG1ha2VWYWx1ZSwgd2l0aFZhbHVlKSA9PiB7XG4gIGNvbnN0IHN0b3JlZCA9IG1hcFN0b3JlLmhhcyhrZXkpID8gdm9pZCAwIDogRS53aGVuKG1ha2VWYWx1ZSgpLCAodjMpID0+IG1hcFN0b3JlLmluaXQoa2V5LCBoYXJkZW4odjMpKSk7XG4gIHJldHVybiBFLndoZW4oc3RvcmVkLCAoKSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBtYXBTdG9yZS5nZXQoa2V5KTtcbiAgICBpZiAod2l0aFZhbHVlKSB7XG4gICAgICB3aXRoVmFsdWUodmFsdWUpO1xuICAgIH1cbiAgICByZXR1cm4gdmFsdWU7XG4gIH0pO1xufTtcblxuLy9cbnZhciB3cmFwcGVyTWV0aG9kcyA9ICh3cmFwcGVyS2luZE5hbWUsIHVNZXRob2ROYW1lcywgZXh0cmFNZXRob2RzID0ge30pID0+IGhhcmRlbih7XG4gIC4uLmZyb21VbmlxdWVFbnRyaWVzKFxuICAgIHVNZXRob2ROYW1lcy5tYXAoKG5hbWUpID0+IFtcbiAgICAgIG5hbWUsXG4gICAgICB7XG4gICAgICAgIC8vXG4gICAgICAgIFtuYW1lXSguLi5hcmdzKSB7XG4gICAgICAgICAgY29uc3QgeyB1bmRlcmx5aW5nIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHVuZGVybHlpbmcgIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUod3JhcHBlcktpbmROYW1lKX0gcmV2b2tlZGA7XG4gICAgICAgICAgcmV0dXJuIHVuZGVybHlpbmdbbmFtZV0oLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgIH1bbmFtZV1cbiAgICBdKVxuICApLFxuICAuLi5leHRyYU1ldGhvZHNcbn0pO1xuaGFyZGVuKHdyYXBwZXJNZXRob2RzKTtcbnZhciBwcmVwYXJlQXR0ZW51YXRvck1ha2VyID0gKHpvbmUsIHVLaW5kTmFtZSwgdU1ldGhvZE5hbWVzLCBvcHRpb25zID0ge30pID0+IHtcbiAgY29uc3Qge1xuICAgIHVJbnRlcmZhY2VOYW1lID0gdUtpbmROYW1lLFxuICAgIGV4dHJhTWV0aG9kR3VhcmRzID0ge30sXG4gICAgZXh0cmFNZXRob2RzID0ge31cbiAgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IEF0dGVudWF0b3JJID0gTS5pbnRlcmZhY2UoXG4gICAgYCR7dUludGVyZmFjZU5hbWV9X2F0dGVudWF0b3JgLFxuICAgIGV4dHJhTWV0aG9kR3VhcmRzLFxuICAgIHsgZGVmYXVsdEd1YXJkczogXCJyYXdcIiB9XG4gICk7XG4gIGNvbnN0IGF0dGVudWF0b3JLaW5kTmFtZSA9IGAke3VLaW5kTmFtZX1fYXR0ZW51YXRvcmA7XG4gIHJldHVybiB6b25lLmV4b0NsYXNzKFxuICAgIGF0dGVudWF0b3JLaW5kTmFtZSxcbiAgICBBdHRlbnVhdG9ySSxcbiAgICAodW5kZXJseWluZykgPT4gKHsgdW5kZXJseWluZyB9KSxcbiAgICB3cmFwcGVyTWV0aG9kcyhhdHRlbnVhdG9yS2luZE5hbWUsIHVNZXRob2ROYW1lcywgZXh0cmFNZXRob2RzKSxcbiAgICB7XG4gICAgICBzdGF0ZVNoYXBlOiB7IHVuZGVybHlpbmc6IE0ub3B0KE0ucmVtb3RhYmxlKFwidW5kZXJseWluZ1wiKSkgfVxuICAgIH1cbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZUF0dGVudWF0b3JNYWtlcik7XG52YXIgUmVtb3RhYmxlUHJlZml4UkUgPSAvXihBbGxlZ2VkOiB8RGVidWdOYW1lOiApLztcbnZhciBhdHRlbnVhdGVPbmUgPSAodW5kZXJseWluZywgdU1ldGhvZE5hbWVzLCBvcHRpb25zID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IGhlYXBab25lID0gbWFrZUhlYXBab25lKCk7XG4gIGNvbnN0IHVLaW5kTmFtZSA9ICh1bmRlcmx5aW5nW1N5bWJvbC50b1N0cmluZ1RhZ10gfHwgXCJVbmRlcmx5aW5nXCIpLnJlcGxhY2UoXG4gICAgUmVtb3RhYmxlUHJlZml4UkUsXG4gICAgXCJcIlxuICApO1xuICBjb25zdCBtYWtlQXR0ZW51YXRvciA9IHByZXBhcmVBdHRlbnVhdG9yTWFrZXIoXG4gICAgaGVhcFpvbmUsXG4gICAgdUtpbmROYW1lLFxuICAgIHVNZXRob2ROYW1lcyxcbiAgICBvcHRpb25zXG4gICk7XG4gIHJldHVybiBtYWtlQXR0ZW51YXRvcih1bmRlcmx5aW5nKTtcbn07XG5oYXJkZW4oYXR0ZW51YXRlT25lKTtcblxuLy9cbnZhciBwcmVwYXJlUmV2b2NhYmxlTWFrZXJLaXQgPSAoem9uZSwgdUtpbmROYW1lLCB1TWV0aG9kTmFtZXMsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgdUludGVyZmFjZU5hbWUgPSB1S2luZE5hbWUsXG4gICAgZXh0cmFNZXRob2RHdWFyZHMgPSB7fSxcbiAgICBleHRyYU1ldGhvZHMgPSB7fVxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgUmV2b2NhYmxlSUtpdCA9IGhhcmRlbih7XG4gICAgcmV2b2tlcjogTS5pbnRlcmZhY2UoYCR7dUludGVyZmFjZU5hbWV9X3Jldm9rZXJgLCB7XG4gICAgICByZXZva2U6IE0uY2FsbCgpLnJldHVybnMoTS5ib29sZWFuKCkpXG4gICAgfSksXG4gICAgcmV2b2NhYmxlOiBNLmludGVyZmFjZShgJHt1SW50ZXJmYWNlTmFtZX1fcmV2b2NhYmxlYCwgZXh0cmFNZXRob2RHdWFyZHMsIHtcbiAgICAgIGRlZmF1bHRHdWFyZHM6IFwicmF3XCJcbiAgICB9KVxuICB9KTtcbiAgY29uc3QgcmV2b2NhYmxlS2luZE5hbWUgPSBgJHt1S2luZE5hbWV9X2NhcmV0YWtlcmA7XG4gIGxldCBhbXBsaWZpZXI7XG4gIGNvbnN0IG1ha2VSZXZvY2FibGVLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIHJldm9jYWJsZUtpbmROYW1lLFxuICAgIFJldm9jYWJsZUlLaXQsXG4gICAgKHVuZGVybHlpbmcpID0+ICh7IHVuZGVybHlpbmcgfSksXG4gICAge1xuICAgICAgcmV2b2tlcjoge1xuICAgICAgICByZXZva2UoKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICBpZiAoc3RhdGUudW5kZXJseWluZyA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHN0YXRlLnVuZGVybHlpbmcgPSB2b2lkIDA7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXZvY2FibGU6IHdyYXBwZXJNZXRob2RzKHJldm9jYWJsZUtpbmROYW1lLCB1TWV0aG9kTmFtZXMsIGV4dHJhTWV0aG9kcylcbiAgICB9LFxuICAgIHtcbiAgICAgIHN0YXRlU2hhcGU6IHsgdW5kZXJseWluZzogTS5vcHQoTS5yZW1vdGFibGUoXCJ1bmRlcmx5aW5nXCIpKSB9LFxuICAgICAgcmVjZWl2ZUFtcGxpZmllcjogKGFtcCkgPT4ge1xuICAgICAgICBhbXBsaWZpZXIgPSBhbXA7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlUmV2b2NhYmxlID0gKHVuZGVybHlpbmcpID0+IG1ha2VSZXZvY2FibGVLaXQodW5kZXJseWluZykucmV2b2NhYmxlO1xuICBjb25zdCByZXZva2UgPSAocmV2b2NhYmxlKSA9PiB7XG4gICAgY29uc3QgZmFjZXRzID0gYW1wbGlmaWVyKHJldm9jYWJsZSk7XG4gICAgaWYgKGZhY2V0cyA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiBmYWNldHMucmV2b2tlci5yZXZva2UoKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgcmV2b2tlLFxuICAgIG1ha2VSZXZvY2FibGVcbiAgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVSZXZvY2FibGVNYWtlcktpdCk7XG5cbi8vXG52YXIgVHJhbnNmZXJQcm9wb3NhbFNoYXBlID0gTS5zcGxpdFJlY29yZCh7XG4gIGdpdmU6IHt9LFxuICB3YW50OiB7fSxcbiAgZXhpdDoge1xuICAgIG9uRGVtYW5kOiBudWxsXG4gIH1cbn0pO1xudmFyIHByZXBhcmVPd25hYmxlID0gKHpvbmUsIG1ha2VJbnZpdGF0aW9uLCB1S2luZE5hbWUsIHVNZXRob2ROYW1lcywgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHsgdUludGVyZmFjZU5hbWUgPSB1S2luZE5hbWUgfSA9IG9wdGlvbnM7XG4gIGNvbnN0IHsgcmV2b2tlLCBtYWtlUmV2b2NhYmxlIH0gPSBwcmVwYXJlUmV2b2NhYmxlTWFrZXJLaXQoXG4gICAgem9uZSxcbiAgICB1S2luZE5hbWUsXG4gICAgdU1ldGhvZE5hbWVzLFxuICAgIHtcbiAgICAgIHVJbnRlcmZhY2VOYW1lLFxuICAgICAgZXh0cmFNZXRob2RHdWFyZHM6IHtcbiAgICAgICAgbWFrZVRyYW5zZmVySW52aXRhdGlvbjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICAgIH0sXG4gICAgICBleHRyYU1ldGhvZHM6IHtcbiAgICAgICAgbWFrZVRyYW5zZmVySW52aXRhdGlvbigpIHtcbiAgICAgICAgICBjb25zdCB7IHVuZGVybHlpbmcgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyByZXZvY2FibGUgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IGN1c3RvbURldGFpbHMgPSB1bmRlcmx5aW5nLmdldEludml0YXRpb25DdXN0b21EZXRhaWxzKCk7XG4gICAgICAgICAgY29uc3QgdHJhbnNmZXJIYW5kbGVyID0gbWFrZVRyYW5zZmVySGFuZGxlcih1bmRlcmx5aW5nKTtcbiAgICAgICAgICBjb25zdCBpbnZpdGF0aW9uID0gbWFrZUludml0YXRpb24oXG4gICAgICAgICAgICB0cmFuc2ZlckhhbmRsZXIsXG4gICAgICAgICAgICBcInRyYW5zZmVyXCIsXG4gICAgICAgICAgICBjdXN0b21EZXRhaWxzLFxuICAgICAgICAgICAgVHJhbnNmZXJQcm9wb3NhbFNoYXBlXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXZva2UocmV2b2NhYmxlKTtcbiAgICAgICAgICByZXR1cm4gaW52aXRhdGlvbjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZVRyYW5zZmVySGFuZGxlciA9IHpvbmUuZXhvQ2xhc3MoXG4gICAgXCJUcmFuc2ZlckhhbmRsZXJcIixcbiAgICBPZmZlckhhbmRsZXJJLFxuICAgICh1bmRlcmx5aW5nKSA9PiAoe1xuICAgICAgdW5kZXJseWluZ1xuICAgIH0pLFxuICAgIHtcbiAgICAgIGhhbmRsZShzZWF0KSB7XG4gICAgICAgIGNvbnN0IHsgdW5kZXJseWluZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgcmV2b2NhYmxlID0gbWFrZVJldm9jYWJsZSh1bmRlcmx5aW5nKTtcbiAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgIHJldHVybiByZXZvY2FibGU7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlT3duYWJsZSA9ICh1bmRlcmx5aW5nKSA9PiBtYWtlUmV2b2NhYmxlKHVuZGVybHlpbmcpO1xuICByZXR1cm4gaGFyZGVuKG1ha2VPd25hYmxlKTtcbn07XG5oYXJkZW4ocHJlcGFyZU93bmFibGUpO1xuXG4vL1xudmFyIHRyYWNlOSA9IG1ha2VUcmFjZXIoXCJQQVwiLCBmYWxzZSk7XG52YXIgR3VhcmRDYWxsQW1vdW50VHVwbGUgPSBNLmNhbGwoQW1vdW50U2hhcGUsIEFtb3VudFNoYXBlKS5yZXR1cm5zKFxuICBNLnByb21pc2UoKVxuKTtcbnZhciBQcmljZUF1dGhvcml0eUkgPSBNLmludGVyZmFjZShcIlByaWNlQXV0aG9yaXR5XCIsIHtcbiAgZ2V0UXVvdGVJc3N1ZXI6IE0uY2FsbChCcmFuZFNoYXBlLCBCcmFuZFNoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0VGltZXJTZXJ2aWNlOiBNLmNhbGwoQnJhbmRTaGFwZSwgQnJhbmRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIHF1b3RlR2l2ZW46IE0uY2FsbChBbW91bnRTaGFwZSwgQnJhbmRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIHF1b3RlV2FudGVkOiBNLmNhbGwoQnJhbmRTaGFwZSwgQW1vdW50U2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBtYWtlUXVvdGVOb3RpZmllcjogTS5jYWxsKEFtb3VudFNoYXBlLCBCcmFuZFNoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgcXVvdGVBdFRpbWU6IE0uY2FsbChUaW1lc3RhbXBTaGFwZSwgQW1vdW50U2hhcGUsIEJyYW5kU2hhcGUpLnJldHVybnMoXG4gICAgTS5wcm9taXNlKClcbiAgKSxcbiAgcXVvdGVXaGVuTFQ6IEd1YXJkQ2FsbEFtb3VudFR1cGxlLFxuICBxdW90ZVdoZW5MVEU6IEd1YXJkQ2FsbEFtb3VudFR1cGxlLFxuICBxdW90ZVdoZW5HVEU6IEd1YXJkQ2FsbEFtb3VudFR1cGxlLFxuICBxdW90ZVdoZW5HVDogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIG11dGFibGVRdW90ZVdoZW5MVDogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIG11dGFibGVRdW90ZVdoZW5MVEU6IEd1YXJkQ2FsbEFtb3VudFR1cGxlLFxuICBtdXRhYmxlUXVvdGVXaGVuR1RFOiBHdWFyZENhbGxBbW91bnRUdXBsZSxcbiAgbXV0YWJsZVF1b3RlV2hlbkdUOiBHdWFyZENhbGxBbW91bnRUdXBsZVxufSk7XG5cbi8vXG52YXIgdW5pdEFtb3VudCA9IGFzeW5jIChicmFuZCkgPT4ge1xuICBjb25zdCBkaXNwbGF5SW5mbyA9IGF3YWl0IEUoYnJhbmQpLmdldERpc3BsYXlJbmZvKCk7XG4gIGNvbnN0IGRlY2ltYWxQbGFjZXMgPSBkaXNwbGF5SW5mby5kZWNpbWFsUGxhY2VzID8/IDA7XG4gIHJldHVybiBBbW91bnRNYXRoLm1ha2UoYnJhbmQsIDEwbiAqKiBOYXQoZGVjaW1hbFBsYWNlcykpO1xufTtcbmhhcmRlbih1bml0QW1vdW50KTtcblxuLy9cbnZhciB0cmFjZTEwID0gbWFrZVRyYWNlcihcIlpvZVRvb2xzXCIpO1xudmFyIHsgYXNzaWduOiBhc3NpZ240LCBrZXlzOiBrZXlzMiwgdmFsdWVzOiB2YWx1ZXM1IH0gPSBPYmplY3Q7XG52YXIgbWFrZVpvZVRvb2xzID0gKHpjZiwgeyB3aGVuLCBhbGxWb3dzLCBhbGxTZXR0bGVkLCBhc1ZvdyB9KSA9PiB7XG4gIGNvbnN0IGxvY2FsVHJhbnNmZXIgPSAoc3JjU2VhdCwgbG9jYWxBY2NvdW50LCBhbW91bnRzKSA9PiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgIXNyY1NlYXQuaGFzRXhpdGVkKCkgfHwgdGhyb3dSZWRhY3RlZGBUaGUgc2VhdCBjYW5ub3QgaGF2ZSBleGl0ZWQuYDtcbiAgICBjb25zdCB7IHpjZlNlYXQ6IHRlbXBTZWF0LCB1c2VyU2VhdDogdXNlclNlYXRQIH0gPSB6Y2YubWFrZUVtcHR5U2VhdEtpdCgpO1xuICAgIGNvbnN0IHVzZXJTZWF0ID0gYXdhaXQgdXNlclNlYXRQO1xuICAgIHpjZi5hdG9taWNSZWFycmFuZ2UoaGFyZGVuKFtbc3JjU2VhdCwgdGVtcFNlYXQsIGFtb3VudHNdXSkpO1xuICAgIHRlbXBTZWF0LmV4aXQoKTtcbiAgICBjb25zdCBwYXltZW50cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAga2V5czIoYW1vdW50cykubWFwKChrdykgPT4gRSh1c2VyU2VhdCkuZ2V0UGF5b3V0KGt3KSlcbiAgICApO1xuICAgIGNvbnN0IHNldHRsZURlcG9zaXRzID0gYXdhaXQgd2hlbihcbiAgICAgIGFsbFNldHRsZWQocGF5bWVudHMubWFwKChwbXQpID0+IEUobG9jYWxBY2NvdW50KS5kZXBvc2l0KHBtdCkpKVxuICAgICk7XG4gICAgaWYgKHNldHRsZURlcG9zaXRzLmZpbmQoKHgpID0+IHguc3RhdHVzID09PSBcInJlamVjdGVkXCIpKSB7XG4gICAgICBjb25zdCBhbXRzID0gdmFsdWVzNShhbW91bnRzKTtcbiAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuICAgICAgY29uc3QgcGF5bWVudHNPcldpdGhkcmF3VnMgPSBzZXR0bGVEZXBvc2l0cy5tYXAoKHgsIGkyKSA9PiB7XG4gICAgICAgIGlmICh4LnN0YXR1cyA9PT0gXCJyZWplY3RlZFwiKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goeC5yZWFzb24pO1xuICAgICAgICAgIHJldHVybiBwYXltZW50c1tpMl07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEUobG9jYWxBY2NvdW50KS53aXRoZHJhdyhhbXRzW2kyXSk7XG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHBheW1lbnRzVG9SZXR1cm4gPSBhd2FpdCB3aGVuKGFsbFZvd3MocGF5bWVudHNPcldpdGhkcmF3VnMpKTtcbiAgICAgIGNvbnN0IHBheW1lbnRLd3IgPSBoYXJkZW4oXG4gICAgICAgIGtleXMyKGFtb3VudHMpLnJlZHVjZShcbiAgICAgICAgICAoa3dyLCBrdywgaTIpID0+IGFzc2lnbjQoa3dyLCB7IFtrd106IHBheW1lbnRzVG9SZXR1cm5baTJdIH0pLFxuICAgICAgICAgIHt9XG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICBjb25zdCBkZXBvc2l0UmVzcG9uc2UgPSBhd2FpdCBkZXBvc2l0VG9TZWF0KFxuICAgICAgICB6Y2YsXG4gICAgICAgIHNyY1NlYXQsXG4gICAgICAgIGFtb3VudHMsXG4gICAgICAgIHBheW1lbnRLd3JcbiAgICAgICk7XG4gICAgICB0cmFjZTEwKFwibG9jYWxUcmFuc2ZlciBkZXBvc2l0UmVzcG9uc2VcIiwgZGVwb3NpdFJlc3BvbnNlKTtcbiAgICAgIHRocm93IG1ha2VFcnJvcihgT25lIG9yIG1vcmUgZGVwb3NpdHMgZmFpbGVkICR7cXVvdGUoZXJyb3JzKX1gKTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCB3aXRoZHJhd1RvU2VhdCA9IChsb2NhbEFjY291bnQsIGRlc3RTZWF0LCBhbW91bnRzKSA9PiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgIWRlc3RTZWF0Lmhhc0V4aXRlZCgpIHx8IHRocm93UmVkYWN0ZWRgVGhlIHNlYXQgY2Fubm90IGhhdmUgZXhpdGVkLmA7XG4gICAgY29uc3Qgc2V0dGxlZFdpdGhkcmF3YWxzID0gYXdhaXQgd2hlbihcbiAgICAgIGFsbFNldHRsZWQodmFsdWVzNShhbW91bnRzKS5tYXAoKGFtdCkgPT4gRShsb2NhbEFjY291bnQpLndpdGhkcmF3KGFtdCkpKVxuICAgICk7XG4gICAgaWYgKHNldHRsZWRXaXRoZHJhd2Fscy5maW5kKCh4KSA9PiB4LnN0YXR1cyA9PT0gXCJyZWplY3RlZFwiKSkge1xuICAgICAgY29uc3QgcmV0dXJuUGF5bWVudFZzID0gW107XG4gICAgICBjb25zdCBlcnJvcnMgPSBbXTtcbiAgICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHNldHRsZWRXaXRoZHJhd2Fscykge1xuICAgICAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gXCJmdWxmaWxsZWRcIikge1xuICAgICAgICAgIHJldHVyblBheW1lbnRWcy5wdXNoKEUobG9jYWxBY2NvdW50KS5kZXBvc2l0KHJlc3VsdC52YWx1ZSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVycm9ycy5wdXNoKHJlc3VsdC5yZWFzb24pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBhd2FpdCB3aGVuKGFsbFZvd3MocmV0dXJuUGF5bWVudFZzKSk7XG4gICAgICB0aHJvdyBtYWtlRXJyb3IoYE9uZSBvciBtb3JlIHdpdGhkcmF3YWxzIGZhaWxlZCAke3F1b3RlKGVycm9ycyl9YCk7XG4gICAgfVxuICAgIGNvbnN0IHBheW1lbnRLd3IgPSBoYXJkZW4oXG4gICAgICBrZXlzMihhbW91bnRzKS5yZWR1Y2UoXG4gICAgICAgIChhY2MsIGt3LCBpMikgPT4gYXNzaWduNChhY2MsIHtcbiAgICAgICAgICBba3ddOiAoXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICBzZXR0bGVkV2l0aGRyYXdhbHNbaTJdLnZhbHVlXG4gICAgICAgICAgKVxuICAgICAgICB9KSxcbiAgICAgICAge31cbiAgICAgIClcbiAgICApO1xuICAgIGNvbnN0IGRlcG9zaXRSZXNwb25zZSA9IGF3YWl0IGRlcG9zaXRUb1NlYXQoXG4gICAgICB6Y2YsXG4gICAgICBkZXN0U2VhdCxcbiAgICAgIGFtb3VudHMsXG4gICAgICBwYXltZW50S3dyXG4gICAgKTtcbiAgICB0cmFjZTEwKFwid2l0aGRyYXdUb1NlYXQgZGVwb3NpdFJlc3BvbnNlXCIsIGRlcG9zaXRSZXNwb25zZSk7XG4gIH0pO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBsb2NhbFRyYW5zZmVyLFxuICAgIHdpdGhkcmF3VG9TZWF0XG4gIH0pO1xufTtcblxuLy9cbnZhciBIYW5kbGVyU2hhcGUgPSBNLnJlbW90YWJsZShcIk9mZmVySGFuZGxlclwiKTtcbnZhciBtYWtlWmNmVG9vbHMgPSAoemNmLCB2b3dUb29scykgPT4gaGFyZGVuKHtcbiAgbWFrZUludml0YXRpb24ob2ZmZXJIYW5kbGVyLCBkZXNjcmlwdGlvbiwgY3VzdG9tRGV0YWlscywgcHJvcG9zYWxTaGFwZSkge1xuICAgIG11c3RNYXRjaChvZmZlckhhbmRsZXIsIEhhbmRsZXJTaGFwZSk7XG4gICAgcmV0dXJuIHZvd1Rvb2xzLndhdGNoKFxuICAgICAgemNmLm1ha2VJbnZpdGF0aW9uKFxuICAgICAgICBvZmZlckhhbmRsZXIsXG4gICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICBjdXN0b21EZXRhaWxzLFxuICAgICAgICBwcm9wb3NhbFNoYXBlXG4gICAgICApXG4gICAgKTtcbiAgfSxcbiAgYXRvbWljUmVhcnJhbmdlKHRyYW5zZmVycykge1xuICAgIHpjZi5hdG9taWNSZWFycmFuZ2UodHJhbnNmZXJzKTtcbiAgfSxcbiAgYXNzZXJ0VW5pcXVlS2V5d29yZChrZXl3b3JkKSB7XG4gICAgemNmLmFzc2VydFVuaXF1ZUtleXdvcmQoa2V5d29yZCk7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHByb3ZpZGVPcmNoZXN0cmF0aW9uID0gKHpjZiwgYmFnZ2FnZSwgcmVtb3RlUG93ZXJzLCBtYXJzaGFsbGVyLCBvcHRzID0ge30pID0+IHtcbiAgY29uc3Qgem9uZXMgPSAoKCkgPT4ge1xuICAgIGNvbnN0IHpvbmUgPSBtYWtlRHVyYWJsZVpvbmUoYmFnZ2FnZSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGFzeW5jRmxvdzogem9uZS5zdWJab25lKFwiYXN5bmNGbG93XCIpLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgb3JjaGVzdHJhdGlvbjogem9uZS5zdWJab25lKFwib3JjaGVzdHJhdGlvblwiKSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBjaGFpbkh1Yjogem9uZS5zdWJab25lKFwiY2hhaW5IdWJcIiksXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICB2b3dzOiB6b25lLnN1YlpvbmUoXCJ2b3dzXCIpLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGNvbnRyYWN0OiB6b25lLnN1YlpvbmUoXCJjb250cmFjdFwiKVxuICAgIH07XG4gIH0pKCk7XG4gIGNvbnN0IHsgYWdvcmljTmFtZXMsIHRpbWVyU2VydmljZSwgbG9jYWxjaGFpbiB9ID0gcmVtb3RlUG93ZXJzO1xuICBjb25zdCB2b3dUb29scyA9IHByZXBhcmVTd2luZ3NldFZvd1Rvb2xzKHpvbmVzLnZvd3MpO1xuICBjb25zdCBjaGFpbkh1YiA9IG1ha2VDaGFpbkh1Yih6b25lcy5jaGFpbkh1YiwgYWdvcmljTmFtZXMsIHZvd1Rvb2xzLCB7XG4gICAgY2hhaW5JbmZvVmFsdWVTaGFwZTogb3B0cy5jaGFpbkluZm9WYWx1ZVNoYXBlXG4gIH0pO1xuICBjb25zdCB6b2VUb29scyA9IG1ha2Vab2VUb29scyh6Y2YsIHZvd1Rvb2xzKTtcbiAgY29uc3QgemNmVG9vbHMgPSBtYWtlWmNmVG9vbHMoemNmLCB2b3dUb29scyk7XG4gIGNvbnN0IHsgbWFrZVJlY29yZGVyS2l0IH0gPSBwcmVwYXJlUmVjb3JkZXJLaXRNYWtlcnMoYmFnZ2FnZSwgbWFyc2hhbGxlcik7XG4gIGNvbnN0IG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0ID0gcHJlcGFyZUxvY2FsT3JjaGVzdHJhdGlvbkFjY291bnRLaXQoXG4gICAgem9uZXMub3JjaGVzdHJhdGlvbixcbiAgICB7XG4gICAgICBtYWtlUmVjb3JkZXJLaXQsXG4gICAgICB6Y2YsXG4gICAgICB0aW1lclNlcnZpY2UsXG4gICAgICB2b3dUb29scyxcbiAgICAgIGNoYWluSHViLFxuICAgICAgbG9jYWxjaGFpbixcbiAgICAgIHpvZVRvb2xzXG4gICAgfVxuICApO1xuICBjb25zdCBhc3luY0Zsb3dUb29scyA9IHByZXBhcmVBc3luY0Zsb3dUb29scyh6b25lcy5hc3luY0Zsb3csIHtcbiAgICB2b3dUb29sc1xuICB9KTtcbiAgY29uc3QgbWFrZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50ID0gcHJlcGFyZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50KFxuICAgIHpvbmVzLm9yY2hlc3RyYXRpb24sXG4gICAge1xuICAgICAgY2hhaW5IdWIsXG4gICAgICBtYWtlUmVjb3JkZXJLaXQsXG4gICAgICB0aW1lclNlcnZpY2UsXG4gICAgICB2b3dUb29scyxcbiAgICAgIHpjZlxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZVJlbW90ZUNoYWluRmFjYWRlID0gcHJlcGFyZVJlbW90ZUNoYWluRmFjYWRlKHpvbmVzLm9yY2hlc3RyYXRpb24sIHtcbiAgICBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnQsXG4gICAgb3JjaGVzdHJhdGlvbjogcmVtb3RlUG93ZXJzLm9yY2hlc3RyYXRpb25TZXJ2aWNlLFxuICAgIHN0b3JhZ2VOb2RlOiByZW1vdGVQb3dlcnMuc3RvcmFnZU5vZGUsXG4gICAgdGltZXI6IHJlbW90ZVBvd2Vycy50aW1lclNlcnZpY2UsXG4gICAgdm93VG9vbHNcbiAgfSk7XG4gIGNvbnN0IG1ha2VMb2NhbENoYWluRmFjYWRlID0gcHJlcGFyZUxvY2FsQ2hhaW5GYWNhZGUoem9uZXMub3JjaGVzdHJhdGlvbiwge1xuICAgIG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0LFxuICAgIGxvY2FsY2hhaW46IHJlbW90ZVBvd2Vycy5sb2NhbGNoYWluLFxuICAgIC8vXG4gICAgc3RvcmFnZU5vZGU6IHJlbW90ZVBvd2Vycy5zdG9yYWdlTm9kZSxcbiAgICBhZ29yaWNOYW1lcyxcbiAgICBvcmNoZXN0cmF0aW9uOiByZW1vdGVQb3dlcnMub3JjaGVzdHJhdGlvblNlcnZpY2UsXG4gICAgdGltZXI6IHJlbW90ZVBvd2Vycy50aW1lclNlcnZpY2UsXG4gICAgdm93VG9vbHNcbiAgfSk7XG4gIGNvbnN0IG1ha2VPcmNoZXN0cmF0b3IgPSBwcmVwYXJlT3JjaGVzdHJhdG9yKHpvbmVzLm9yY2hlc3RyYXRpb24sIHtcbiAgICBjaGFpbkh1YixcbiAgICBtYWtlTG9jYWxDaGFpbkZhY2FkZSxcbiAgICBtYWtlUmVtb3RlQ2hhaW5GYWNhZGUsXG4gICAgdm93VG9vbHNcbiAgfSk7XG4gIGNvbnN0IG1ha2VPcmNoZXN0cmF0ZUtpdCA9ICh6b25lKSA9PiBtYWtlT3JjaGVzdHJhdGlvbkZhY2FkZSh7XG4gICAgem9uZSxcbiAgICB6Y2YsXG4gICAgbWFrZU9yY2hlc3RyYXRvcixcbiAgICBhc3luY0Zsb3dUb29scyxcbiAgICB2b3dUb29scyxcbiAgICAuLi5yZW1vdGVQb3dlcnNcbiAgfSk7XG4gIGNvbnN0IGRlZmF1bHRPcmNoZXN0cmF0ZUtpdCA9IG1ha2VPcmNoZXN0cmF0ZUtpdChcbiAgICB6b25lcy5jb250cmFjdC5zdWJab25lKFwib3JjaGVzdHJhdGlvblwiKVxuICApO1xuICB6Y2Yuc2V0VGVzdEppZygoKSA9PiAoe1xuICAgIGJhZ2dhZ2UsXG4gICAgY2hhaW5IdWJcbiAgfSkpO1xuICByZXR1cm4ge1xuICAgIC4uLmRlZmF1bHRPcmNoZXN0cmF0ZUtpdCxcbiAgICBtYWtlT3JjaGVzdHJhdGVLaXQsXG4gICAgYmFnZ2FnZSxcbiAgICBjaGFpbkh1YixcbiAgICB2b3dUb29scyxcbiAgICBhc3luY0Zsb3dUb29scyxcbiAgICB6Y2ZUb29scyxcbiAgICB6b2VUb29scyxcbiAgICB6b25lOiB6b25lcy5jb250cmFjdFxuICB9O1xufTtcbmhhcmRlbihwcm92aWRlT3JjaGVzdHJhdGlvbik7XG52YXIgd2l0aE9yY2hlc3RyYXRpb24gPSAoY29udHJhY3RGbiwgb3B0cykgPT4gYXN5bmMgKHpjZiwgcHJpdmF0ZUFyZ3MsIGJhZ2dhZ2UpID0+IHtcbiAgY29uc3QgeyBtYXJzaGFsbGVyLCAuLi5hbGxPcmNoUG93ZXJzIH0gPSBwcml2YXRlQXJncztcbiAgY29uc3QgeyBzdG9yYWdlTm9kZTogXywgLi4ucmVxdWlyZWRPcmNoUG93ZXJzIH0gPSBhbGxPcmNoUG93ZXJzO1xuICBjb25zdCB7IHB1Ymxpc2hBY2NvdW50SW5mbywgY2hhaW5JbmZvVmFsdWVTaGFwZSB9ID0gb3B0cyA/PyB7fTtcbiAgY29uc3QgeyB6b25lLCAuLi50b29scyB9ID0gcHJvdmlkZU9yY2hlc3RyYXRpb24oXG4gICAgemNmLFxuICAgIGJhZ2dhZ2UsXG4gICAgcHVibGlzaEFjY291bnRJbmZvID8gYWxsT3JjaFBvd2VycyA6IHJlcXVpcmVkT3JjaFBvd2VycyxcbiAgICBtYXJzaGFsbGVyLFxuICAgIHsgY2hhaW5JbmZvVmFsdWVTaGFwZSB9XG4gICk7XG4gIHJldHVybiBjb250cmFjdEZuKHpjZiwgcHJpdmF0ZUFyZ3MsIHpvbmUsIHRvb2xzKTtcbn07XG5oYXJkZW4od2l0aE9yY2hlc3RyYXRpb24pO1xuXG4vL1xudmFyIEljcUVuYWJsZWQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBvbW5pZmxpeGh1YjogdHJ1ZSxcbiAgICBvc21vc2lzOiB0cnVlXG4gIH1cbik7XG5oYXJkZW4oSWNxRW5hYmxlZCk7XG52YXIgUGZtRW5hYmxlZCA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIGFnb3JpYzogdHJ1ZSxcbiAgICBjZWxlc3RpYTogdHJ1ZSxcbiAgICBjb3Ntb3NodWI6IHRydWUsXG4gICAganVubzogdHJ1ZSxcbiAgICBuZXV0cm9uOiB0cnVlLFxuICAgIG5vYmxlOiB0cnVlLFxuICAgIG9tbmlmbGl4aHViOiB0cnVlLFxuICAgIG9zbW9zaXM6IHRydWUsXG4gICAgc2VjcmV0bmV0d29yazogdHJ1ZSxcbiAgICBzdGFyZ2F6ZTogdHJ1ZSxcbiAgICBzdHJpZGU6IHRydWUsXG4gICAgdW1lZTogdHJ1ZVxuICB9XG4pO1xuaGFyZGVuKFBmbUVuYWJsZWQpO1xudmFyIEljYUVuYWJsZWQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBjZWxlc3RpYTogdHJ1ZSxcbiAgICBjb3Ntb3NodWI6IHRydWUsXG4gICAgZHlkeDogdHJ1ZSxcbiAgICBqdW5vOiB0cnVlLFxuICAgIG5ldXRyb246IHRydWUsXG4gICAgbm9ibGU6IHRydWUsXG4gICAgb21uaWZsaXhodWI6IHRydWUsXG4gICAgb3Ntb3NpczogdHJ1ZSxcbiAgICBzZWNyZXRuZXR3b3JrOiB0cnVlLFxuICAgIHN0YXJnYXplOiB0cnVlLFxuICAgIHN0cmlkZTogdHJ1ZSxcbiAgICB1bWVlOiB0cnVlXG4gIH1cbik7XG5oYXJkZW4oSWNhRW5hYmxlZCk7XG5cbi8vXG52YXIgcmVnaXN0ZXJDaGFpbnNBbmRBc3NldHMgPSAoY2hhaW5IdWIsIGJyYW5kcywgY2hhaW5JbmZvLCBhc3NldEluZm8sIHsgbG9nID0gKCkgPT4ge1xufSB9ID0ge30pID0+IHtcbiAgbG9nKFwiY2hhaW5IdWI6IHJlZ2lzdGVyaW5nIGNoYWluc1wiLCBPYmplY3Qua2V5cyhjaGFpbkluZm8gfHwge30pKTtcbiAgaWYgKCFjaGFpbkluZm8pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgY29ubnMgPSB7fTtcbiAgZm9yIChjb25zdCBbY2hhaW5OYW1lLCBhbGxJbmZvXSBvZiBPYmplY3QuZW50cmllcyhjaGFpbkluZm8pKSB7XG4gICAgaWYgKGFsbEluZm8ubmFtZXNwYWNlID09PSBcImNvc21vc1wiKSB7XG4gICAgICBjb25zdCB7IGNvbm5lY3Rpb25zLCAuLi5pbmZvIH0gPSBhbGxJbmZvO1xuICAgICAgY2hhaW5IdWIucmVnaXN0ZXJDaGFpbihjaGFpbk5hbWUsIGluZm8pO1xuICAgICAgaWYgKGNvbm5lY3Rpb25zKSBjb25uc1tpbmZvLmNoYWluSWRdID0gY29ubmVjdGlvbnM7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNoYWluSHViLnJlZ2lzdGVyQ2hhaW4oY2hhaW5OYW1lLCBhbGxJbmZvKTtcbiAgICB9XG4gIH1cbiAgY29uc3QgcmVnaXN0ZXJlZFBhaXJzID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgZm9yIChjb25zdCBbcENoYWluSWQsIGNvbm5JbmZvc10gb2YgT2JqZWN0LmVudHJpZXMoY29ubnMpKSB7XG4gICAgZm9yIChjb25zdCBbY0NoYWluSWQsIGNvbm5JbmZvXSBvZiBPYmplY3QuZW50cmllcyhjb25uSW5mb3MpKSB7XG4gICAgICBjb25zdCBwYWlyID0gW3BDaGFpbklkLCBjQ2hhaW5JZF0uc29ydCgpLmpvaW4oXCI8LT5cIik7XG4gICAgICBpZiAoIXJlZ2lzdGVyZWRQYWlycy5oYXMocGFpcikpIHtcbiAgICAgICAgY2hhaW5IdWIucmVnaXN0ZXJDb25uZWN0aW9uKHBDaGFpbklkLCBjQ2hhaW5JZCwgY29ubkluZm8pO1xuICAgICAgICByZWdpc3RlcmVkUGFpcnMuYWRkKHBhaXIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBsb2coXCJjaGFpbkh1YjogcmVnaXN0ZXJlZCBjb25uZWN0aW9uc1wiLCBbLi4ucmVnaXN0ZXJlZFBhaXJzXS5zb3J0KCkpO1xuICBsb2coXG4gICAgXCJjaGFpbkh1YjogcmVnaXN0ZXJpbmcgYXNzZXRzXCIsXG4gICAgYXNzZXRJbmZvPy5tYXAoKFtkZW5vbSwgeyBjaGFpbk5hbWUgfV0pID0+IGAke2NoYWluTmFtZX06ICR7ZGVub219YClcbiAgKTtcbiAgaWYgKCFhc3NldEluZm8pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgZm9yIChjb25zdCBbZGVub20sIGluZm9dIG9mIGFzc2V0SW5mbykge1xuICAgIGNvbnN0IHsgYnJhbmRLZXksIC4uLnJlc3QgfSA9IGluZm87XG4gICAgY29uc3QgaW5mb1dpdGhCcmFuZCA9IGJyYW5kS2V5ID8geyAuLi5yZXN0LCBicmFuZDogYnJhbmRzW2JyYW5kS2V5XSB9IDogcmVzdDtcbiAgICBjaGFpbkh1Yi5yZWdpc3RlckFzc2V0KGRlbm9tLCBpbmZvV2l0aEJyYW5kKTtcbiAgfVxufTtcblxuLy9cbnZhciBpbXBvcnRfYmVjaDMyID0gX190b0VTTShyZXF1aXJlX2Rpc3QoKSwgMSk7XG5cbi8vXG52YXIgYmFzZV9leHBvcnRzID0ge307XG5fX2V4cG9ydChiYXNlX2V4cG9ydHMsIHtcbiAgZXhjbHVkZTogKCkgPT4gZXhjbHVkZSxcbiAgZXh0cmFjdDogKCkgPT4gZXh0cmFjdCxcbiAgcGFyc2U6ICgpID0+IHBhcnNlMixcbiAgcGFyc2VVcmw6ICgpID0+IHBhcnNlVXJsLFxuICBwaWNrOiAoKSA9PiBwaWNrLFxuICBzdHJpbmdpZnk6ICgpID0+IHN0cmluZ2lmeTIsXG4gIHN0cmluZ2lmeVVybDogKCkgPT4gc3RyaW5naWZ5VXJsXG59KTtcblxuLy9cbnZhciB0b2tlbiA9IFwiJVthLWYwLTldezJ9XCI7XG52YXIgc2luZ2xlTWF0Y2hlciA9IG5ldyBSZWdFeHAoXCIoXCIgKyB0b2tlbiArIFwiKXwoW14lXSs/KVwiLCBcImdpXCIpO1xudmFyIG11bHRpTWF0Y2hlciA9IG5ldyBSZWdFeHAoXCIoXCIgKyB0b2tlbiArIFwiKStcIiwgXCJnaVwiKTtcbmZ1bmN0aW9uIGRlY29kZUNvbXBvbmVudHMoY29tcG9uZW50cywgc3BsaXQpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gW2RlY29kZVVSSUNvbXBvbmVudChjb21wb25lbnRzLmpvaW4oXCJcIikpXTtcbiAgfSBjYXRjaCB7XG4gIH1cbiAgaWYgKGNvbXBvbmVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgcmV0dXJuIGNvbXBvbmVudHM7XG4gIH1cbiAgc3BsaXQgPSBzcGxpdCB8fCAxO1xuICBjb25zdCBsZWZ0ID0gY29tcG9uZW50cy5zbGljZSgwLCBzcGxpdCk7XG4gIGNvbnN0IHJpZ2h0ID0gY29tcG9uZW50cy5zbGljZShzcGxpdCk7XG4gIHJldHVybiBBcnJheS5wcm90b3R5cGUuY29uY2F0LmNhbGwoW10sIGRlY29kZUNvbXBvbmVudHMobGVmdCksIGRlY29kZUNvbXBvbmVudHMocmlnaHQpKTtcbn1cbmZ1bmN0aW9uIGRlY29kZShpbnB1dCkge1xuICB0cnkge1xuICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoaW5wdXQpO1xuICB9IGNhdGNoIHtcbiAgICBsZXQgdG9rZW5zID0gaW5wdXQubWF0Y2goc2luZ2xlTWF0Y2hlcikgfHwgW107XG4gICAgZm9yIChsZXQgaTIgPSAxOyBpMiA8IHRva2Vucy5sZW5ndGg7IGkyKyspIHtcbiAgICAgIGlucHV0ID0gZGVjb2RlQ29tcG9uZW50cyh0b2tlbnMsIGkyKS5qb2luKFwiXCIpO1xuICAgICAgdG9rZW5zID0gaW5wdXQubWF0Y2goc2luZ2xlTWF0Y2hlcikgfHwgW107XG4gICAgfVxuICAgIHJldHVybiBpbnB1dDtcbiAgfVxufVxuZnVuY3Rpb24gY3VzdG9tRGVjb2RlVVJJQ29tcG9uZW50KGlucHV0KSB7XG4gIGNvbnN0IHJlcGxhY2VNYXAgPSB7XG4gICAgXCIlRkUlRkZcIjogXCJcXHVGRkZEXFx1RkZGRFwiLFxuICAgIFwiJUZGJUZFXCI6IFwiXFx1RkZGRFxcdUZGRkRcIlxuICB9O1xuICBsZXQgbWF0Y2ggPSBtdWx0aU1hdGNoZXIuZXhlYyhpbnB1dCk7XG4gIHdoaWxlIChtYXRjaCkge1xuICAgIHRyeSB7XG4gICAgICByZXBsYWNlTWFwW21hdGNoWzBdXSA9IGRlY29kZVVSSUNvbXBvbmVudChtYXRjaFswXSk7XG4gICAgfSBjYXRjaCB7XG4gICAgICBjb25zdCByZXN1bHQgPSBkZWNvZGUobWF0Y2hbMF0pO1xuICAgICAgaWYgKHJlc3VsdCAhPT0gbWF0Y2hbMF0pIHtcbiAgICAgICAgcmVwbGFjZU1hcFttYXRjaFswXV0gPSByZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuICAgIG1hdGNoID0gbXVsdGlNYXRjaGVyLmV4ZWMoaW5wdXQpO1xuICB9XG4gIHJlcGxhY2VNYXBbXCIlQzJcIl0gPSBcIlxcdUZGRkRcIjtcbiAgY29uc3QgZW50cmllczEwID0gT2JqZWN0LmtleXMocmVwbGFjZU1hcCk7XG4gIGZvciAoY29uc3Qga2V5IG9mIGVudHJpZXMxMCkge1xuICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZShuZXcgUmVnRXhwKGtleSwgXCJnXCIpLCByZXBsYWNlTWFwW2tleV0pO1xuICB9XG4gIHJldHVybiBpbnB1dDtcbn1cbmZ1bmN0aW9uIGRlY29kZVVyaUNvbXBvbmVudChlbmNvZGVkVVJJKSB7XG4gIGlmICh0eXBlb2YgZW5jb2RlZFVSSSAhPT0gXCJzdHJpbmdcIikge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJFeHBlY3RlZCBgZW5jb2RlZFVSSWAgdG8gYmUgb2YgdHlwZSBgc3RyaW5nYCwgZ290IGBcIiArIHR5cGVvZiBlbmNvZGVkVVJJICsgXCJgXCIpO1xuICB9XG4gIHRyeSB7XG4gICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlbmNvZGVkVVJJKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIGN1c3RvbURlY29kZVVSSUNvbXBvbmVudChlbmNvZGVkVVJJKTtcbiAgfVxufVxuXG4vL1xuZnVuY3Rpb24gaW5jbHVkZUtleXMob2JqZWN0LCBwcmVkaWNhdGUpIHtcbiAgY29uc3QgcmVzdWx0ID0ge307XG4gIGlmIChBcnJheS5pc0FycmF5KHByZWRpY2F0ZSkpIHtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBwcmVkaWNhdGUpIHtcbiAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwga2V5KTtcbiAgICAgIGlmIChkZXNjcmlwdG9yPy5lbnVtZXJhYmxlKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXN1bHQsIGtleSwgZGVzY3JpcHRvcik7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGZvciAoY29uc3Qga2V5IG9mIFJlZmxlY3Qub3duS2V5cyhvYmplY3QpKSB7XG4gICAgICBjb25zdCBkZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIGtleSk7XG4gICAgICBpZiAoZGVzY3JpcHRvci5lbnVtZXJhYmxlKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gb2JqZWN0W2tleV07XG4gICAgICAgIGlmIChwcmVkaWNhdGUoa2V5LCB2YWx1ZSwgb2JqZWN0KSkge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXN1bHQsIGtleSwgZGVzY3JpcHRvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLy9cbmZ1bmN0aW9uIHNwbGl0T25GaXJzdChzdHJpbmcsIHNlcGFyYXRvcikge1xuICBpZiAoISh0eXBlb2Ygc3RyaW5nID09PSBcInN0cmluZ1wiICYmIHR5cGVvZiBzZXBhcmF0b3IgPT09IFwic3RyaW5nXCIpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkV4cGVjdGVkIHRoZSBhcmd1bWVudHMgdG8gYmUgb2YgdHlwZSBgc3RyaW5nYFwiKTtcbiAgfVxuICBpZiAoc3RyaW5nID09PSBcIlwiIHx8IHNlcGFyYXRvciA9PT0gXCJcIikge1xuICAgIHJldHVybiBbXTtcbiAgfVxuICBjb25zdCBzZXBhcmF0b3JJbmRleCA9IHN0cmluZy5pbmRleE9mKHNlcGFyYXRvcik7XG4gIGlmIChzZXBhcmF0b3JJbmRleCA9PT0gLTEpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgcmV0dXJuIFtcbiAgICBzdHJpbmcuc2xpY2UoMCwgc2VwYXJhdG9ySW5kZXgpLFxuICAgIHN0cmluZy5zbGljZShzZXBhcmF0b3JJbmRleCArIHNlcGFyYXRvci5sZW5ndGgpXG4gIF07XG59XG5cbi8vXG52YXIgaXNOdWxsT3JVbmRlZmluZWQgPSAodmFsdWUpID0+IHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB2b2lkIDA7XG52YXIgc3RyaWN0VXJpRW5jb2RlID0gKHN0cmluZykgPT4gZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZykucmVwbGFjZUFsbCgvWyEnKCkqXS9nLCAoeCkgPT4gYCUke3guY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKX1gKTtcbnZhciBlbmNvZGVGcmFnbWVudElkZW50aWZpZXIgPSBTeW1ib2woXCJlbmNvZGVGcmFnbWVudElkZW50aWZpZXJcIik7XG5mdW5jdGlvbiBlbmNvZGVyRm9yQXJyYXlGb3JtYXQob3B0aW9ucykge1xuICBzd2l0Y2ggKG9wdGlvbnMuYXJyYXlGb3JtYXQpIHtcbiAgICBjYXNlIFwiaW5kZXhcIjoge1xuICAgICAgcmV0dXJuIChrZXkpID0+IChyZXN1bHQsIHZhbHVlKSA9PiB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gcmVzdWx0Lmxlbmd0aDtcbiAgICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDAgfHwgb3B0aW9ucy5za2lwTnVsbCAmJiB2YWx1ZSA9PT0gbnVsbCB8fCBvcHRpb25zLnNraXBFbXB0eVN0cmluZyAmJiB2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgXCJbXCIsIGluZGV4LCBcIl1cIl0uam9pbihcIlwiKVxuICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgW2VuY29kZShrZXksIG9wdGlvbnMpLCBcIltcIiwgZW5jb2RlKGluZGV4LCBvcHRpb25zKSwgXCJdPVwiLCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKFwiXCIpXG4gICAgICAgIF07XG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiYnJhY2tldFwiOiB7XG4gICAgICByZXR1cm4gKGtleSkgPT4gKHJlc3VsdCwgdmFsdWUpID0+IHtcbiAgICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDAgfHwgb3B0aW9ucy5za2lwTnVsbCAmJiB2YWx1ZSA9PT0gbnVsbCB8fCBvcHRpb25zLnNraXBFbXB0eVN0cmluZyAmJiB2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgXCJbXVwiXS5qb2luKFwiXCIpXG4gICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICBbZW5jb2RlKGtleSwgb3B0aW9ucyksIFwiW109XCIsIGVuY29kZSh2YWx1ZSwgb3B0aW9ucyldLmpvaW4oXCJcIilcbiAgICAgICAgXTtcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgXCJjb2xvbi1saXN0LXNlcGFyYXRvclwiOiB7XG4gICAgICByZXR1cm4gKGtleSkgPT4gKHJlc3VsdCwgdmFsdWUpID0+IHtcbiAgICAgICAgaWYgKHZhbHVlID09PSB2b2lkIDAgfHwgb3B0aW9ucy5za2lwTnVsbCAmJiB2YWx1ZSA9PT0gbnVsbCB8fCBvcHRpb25zLnNraXBFbXB0eVN0cmluZyAmJiB2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLnJlc3VsdCxcbiAgICAgICAgICAgIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgXCI6bGlzdD1cIl0uam9pbihcIlwiKVxuICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgW2VuY29kZShrZXksIG9wdGlvbnMpLCBcIjpsaXN0PVwiLCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKFwiXCIpXG4gICAgICAgIF07XG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiY29tbWFcIjpcbiAgICBjYXNlIFwic2VwYXJhdG9yXCI6XG4gICAgY2FzZSBcImJyYWNrZXQtc2VwYXJhdG9yXCI6IHtcbiAgICAgIGNvbnN0IGtleVZhbHVlU2VwYXJhdG9yID0gb3B0aW9ucy5hcnJheUZvcm1hdCA9PT0gXCJicmFja2V0LXNlcGFyYXRvclwiID8gXCJbXT1cIiA6IFwiPVwiO1xuICAgICAgcmV0dXJuIChrZXkpID0+IChyZXN1bHQsIHZhbHVlKSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwIHx8IG9wdGlvbnMuc2tpcE51bGwgJiYgdmFsdWUgPT09IG51bGwgfHwgb3B0aW9ucy5za2lwRW1wdHlTdHJpbmcgJiYgdmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIHZhbHVlID0gdmFsdWUgPT09IG51bGwgPyBcIlwiIDogdmFsdWU7XG4gICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIFtbZW5jb2RlKGtleSwgb3B0aW9ucyksIGtleVZhbHVlU2VwYXJhdG9yLCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKFwiXCIpXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW1tyZXN1bHQsIGVuY29kZSh2YWx1ZSwgb3B0aW9ucyldLmpvaW4ob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcildO1xuICAgICAgfTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgcmV0dXJuIChrZXkpID0+IChyZXN1bHQsIHZhbHVlKSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwIHx8IG9wdGlvbnMuc2tpcE51bGwgJiYgdmFsdWUgPT09IG51bGwgfHwgb3B0aW9ucy5za2lwRW1wdHlTdHJpbmcgJiYgdmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgICBlbmNvZGUoa2V5LCBvcHRpb25zKVxuICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgW2VuY29kZShrZXksIG9wdGlvbnMpLCBcIj1cIiwgZW5jb2RlKHZhbHVlLCBvcHRpb25zKV0uam9pbihcIlwiKVxuICAgICAgICBdO1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIHBhcnNlckZvckFycmF5Rm9ybWF0KG9wdGlvbnMpIHtcbiAgbGV0IHJlc3VsdDtcbiAgc3dpdGNoIChvcHRpb25zLmFycmF5Rm9ybWF0KSB7XG4gICAgY2FzZSBcImluZGV4XCI6IHtcbiAgICAgIHJldHVybiAoa2V5LCB2YWx1ZSwgYWNjdW11bGF0b3IpID0+IHtcbiAgICAgICAgcmVzdWx0ID0gL1xcWyhcXGQqKV0kLy5leGVjKGtleSk7XG4gICAgICAgIGtleSA9IGtleS5yZXBsYWNlKC9cXFtcXGQqXSQvLCBcIlwiKTtcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gdmFsdWU7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhY2N1bXVsYXRvcltrZXldID09PSB2b2lkIDApIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0ge307XG4gICAgICAgIH1cbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XVtyZXN1bHRbMV1dID0gdmFsdWU7XG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiYnJhY2tldFwiOiB7XG4gICAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG4gICAgICAgIHJlc3VsdCA9IC8oXFxbXSkkLy5leGVjKGtleSk7XG4gICAgICAgIGtleSA9IGtleS5yZXBsYWNlKC9cXFtdJC8sIFwiXCIpO1xuICAgICAgICBpZiAoIXJlc3VsdCkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFjY3VtdWxhdG9yW2tleV0gPT09IHZvaWQgMCkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSBbdmFsdWVdO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gWy4uLmFjY3VtdWxhdG9yW2tleV0sIHZhbHVlXTtcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgXCJjb2xvbi1saXN0LXNlcGFyYXRvclwiOiB7XG4gICAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG4gICAgICAgIHJlc3VsdCA9IC8oOmxpc3QpJC8uZXhlYyhrZXkpO1xuICAgICAgICBrZXkgPSBrZXkucmVwbGFjZSgvOmxpc3QkLywgXCJcIik7XG4gICAgICAgIGlmICghcmVzdWx0KSB7XG4gICAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IHZhbHVlO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWNjdW11bGF0b3Jba2V5XSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IFt2YWx1ZV07XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSBbLi4uYWNjdW11bGF0b3Jba2V5XSwgdmFsdWVdO1xuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBcImNvbW1hXCI6XG4gICAgY2FzZSBcInNlcGFyYXRvclwiOiB7XG4gICAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG4gICAgICAgIGNvbnN0IGlzQXJyYXk5ID0gdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiICYmIHZhbHVlLmluY2x1ZGVzKG9wdGlvbnMuYXJyYXlGb3JtYXRTZXBhcmF0b3IpO1xuICAgICAgICBjb25zdCBpc0VuY29kZWRBcnJheSA9IHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiAhaXNBcnJheTkgJiYgZGVjb2RlMih2YWx1ZSwgb3B0aW9ucykuaW5jbHVkZXMob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gICAgICAgIHZhbHVlID0gaXNFbmNvZGVkQXJyYXkgPyBkZWNvZGUyKHZhbHVlLCBvcHRpb25zKSA6IHZhbHVlO1xuICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IGlzQXJyYXk5IHx8IGlzRW5jb2RlZEFycmF5ID8gdmFsdWUuc3BsaXQob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcikubWFwKChpdGVtKSA9PiBkZWNvZGUyKGl0ZW0sIG9wdGlvbnMpKSA6IHZhbHVlID09PSBudWxsID8gdmFsdWUgOiBkZWNvZGUyKHZhbHVlLCBvcHRpb25zKTtcbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IG5ld1ZhbHVlO1xuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBcImJyYWNrZXQtc2VwYXJhdG9yXCI6IHtcbiAgICAgIHJldHVybiAoa2V5LCB2YWx1ZSwgYWNjdW11bGF0b3IpID0+IHtcbiAgICAgICAgY29uc3QgaXNBcnJheTkgPSAvKFxcW10pJC8udGVzdChrZXkpO1xuICAgICAgICBrZXkgPSBrZXkucmVwbGFjZSgvXFxbXSQvLCBcIlwiKTtcbiAgICAgICAgaWYgKCFpc0FycmF5OSkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSB2YWx1ZSA/IGRlY29kZTIodmFsdWUsIG9wdGlvbnMpIDogdmFsdWU7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFycmF5VmFsdWUgPSB2YWx1ZSA9PT0gbnVsbCA/IFtdIDogZGVjb2RlMih2YWx1ZSwgb3B0aW9ucykuc3BsaXQob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gICAgICAgIGlmIChhY2N1bXVsYXRvcltrZXldID09PSB2b2lkIDApIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gYXJyYXlWYWx1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IFsuLi5hY2N1bXVsYXRvcltrZXldLCAuLi5hcnJheVZhbHVlXTtcbiAgICAgIH07XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHJldHVybiAoa2V5LCB2YWx1ZSwgYWNjdW11bGF0b3IpID0+IHtcbiAgICAgICAgaWYgKGFjY3VtdWxhdG9yW2tleV0gPT09IHZvaWQgMCkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IFsuLi5bYWNjdW11bGF0b3Jba2V5XV0uZmxhdCgpLCB2YWx1ZV07XG4gICAgICB9O1xuICAgIH1cbiAgfVxufVxuZnVuY3Rpb24gdmFsaWRhdGVBcnJheUZvcm1hdFNlcGFyYXRvcih2YWx1ZSkge1xuICBpZiAodHlwZW9mIHZhbHVlICE9PSBcInN0cmluZ1wiIHx8IHZhbHVlLmxlbmd0aCAhPT0gMSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJhcnJheUZvcm1hdFNlcGFyYXRvciBtdXN0IGJlIHNpbmdsZSBjaGFyYWN0ZXIgc3RyaW5nXCIpO1xuICB9XG59XG5mdW5jdGlvbiBlbmNvZGUodmFsdWUsIG9wdGlvbnMpIHtcbiAgaWYgKG9wdGlvbnMuZW5jb2RlKSB7XG4gICAgcmV0dXJuIG9wdGlvbnMuc3RyaWN0ID8gc3RyaWN0VXJpRW5jb2RlKHZhbHVlKSA6IGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gZGVjb2RlMih2YWx1ZSwgb3B0aW9ucykge1xuICBpZiAob3B0aW9ucy5kZWNvZGUpIHtcbiAgICByZXR1cm4gZGVjb2RlVXJpQ29tcG9uZW50KHZhbHVlKTtcbiAgfVxuICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiBrZXlzU29ydGVyKGlucHV0KSB7XG4gIGlmIChBcnJheS5pc0FycmF5KGlucHV0KSkge1xuICAgIHJldHVybiBpbnB1dC5zb3J0KCk7XG4gIH1cbiAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gXCJvYmplY3RcIikge1xuICAgIHJldHVybiBrZXlzU29ydGVyKE9iamVjdC5rZXlzKGlucHV0KSkuc29ydCgoYTIsIGIzKSA9PiBOdW1iZXIoYTIpIC0gTnVtYmVyKGIzKSkubWFwKChrZXkpID0+IGlucHV0W2tleV0pO1xuICB9XG4gIHJldHVybiBpbnB1dDtcbn1cbmZ1bmN0aW9uIHJlbW92ZUhhc2goaW5wdXQpIHtcbiAgY29uc3QgaGFzaFN0YXJ0ID0gaW5wdXQuaW5kZXhPZihcIiNcIik7XG4gIGlmIChoYXNoU3RhcnQgIT09IC0xKSB7XG4gICAgaW5wdXQgPSBpbnB1dC5zbGljZSgwLCBoYXNoU3RhcnQpO1xuICB9XG4gIHJldHVybiBpbnB1dDtcbn1cbmZ1bmN0aW9uIGdldEhhc2godXJsKSB7XG4gIGxldCBoYXNoID0gXCJcIjtcbiAgY29uc3QgaGFzaFN0YXJ0ID0gdXJsLmluZGV4T2YoXCIjXCIpO1xuICBpZiAoaGFzaFN0YXJ0ICE9PSAtMSkge1xuICAgIGhhc2ggPSB1cmwuc2xpY2UoaGFzaFN0YXJ0KTtcbiAgfVxuICByZXR1cm4gaGFzaDtcbn1cbmZ1bmN0aW9uIHBhcnNlVmFsdWUodmFsdWUsIG9wdGlvbnMsIHR5cGUpIHtcbiAgaWYgKHR5cGUgPT09IFwic3RyaW5nXCIgJiYgdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIGlmICh0eXBlb2YgdHlwZSA9PT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiB0eXBlKHZhbHVlKTtcbiAgfVxuICBpZiAob3B0aW9ucy5wYXJzZUJvb2xlYW5zICYmIHZhbHVlICE9PSBudWxsICYmICh2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSBcInRydWVcIiB8fCB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSBcImZhbHNlXCIpKSB7XG4gICAgcmV0dXJuIHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IFwidHJ1ZVwiO1xuICB9XG4gIGlmICh0eXBlID09PSBcIm51bWJlclwiICYmICFOdW1iZXIuaXNOYU4oTnVtYmVyKHZhbHVlKSkgJiYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS50cmltKCkgIT09IFwiXCIpKSB7XG4gICAgcmV0dXJuIE51bWJlcih2YWx1ZSk7XG4gIH1cbiAgaWYgKG9wdGlvbnMucGFyc2VOdW1iZXJzICYmICFOdW1iZXIuaXNOYU4oTnVtYmVyKHZhbHVlKSkgJiYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS50cmltKCkgIT09IFwiXCIpKSB7XG4gICAgcmV0dXJuIE51bWJlcih2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gZXh0cmFjdChpbnB1dCkge1xuICBpbnB1dCA9IHJlbW92ZUhhc2goaW5wdXQpO1xuICBjb25zdCBxdWVyeVN0YXJ0ID0gaW5wdXQuaW5kZXhPZihcIj9cIik7XG4gIGlmIChxdWVyeVN0YXJ0ID09PSAtMSkge1xuICAgIHJldHVybiBcIlwiO1xuICB9XG4gIHJldHVybiBpbnB1dC5zbGljZShxdWVyeVN0YXJ0ICsgMSk7XG59XG5mdW5jdGlvbiBwYXJzZTIocXVlcnksIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IHtcbiAgICBkZWNvZGU6IHRydWUsXG4gICAgc29ydDogdHJ1ZSxcbiAgICBhcnJheUZvcm1hdDogXCJub25lXCIsXG4gICAgYXJyYXlGb3JtYXRTZXBhcmF0b3I6IFwiLFwiLFxuICAgIHBhcnNlTnVtYmVyczogZmFsc2UsXG4gICAgcGFyc2VCb29sZWFuczogZmFsc2UsXG4gICAgdHlwZXM6IC8qICAgICAgICAgICAqLyBPYmplY3QuY3JlYXRlKG51bGwpLFxuICAgIC4uLm9wdGlvbnNcbiAgfTtcbiAgdmFsaWRhdGVBcnJheUZvcm1hdFNlcGFyYXRvcihvcHRpb25zLmFycmF5Rm9ybWF0U2VwYXJhdG9yKTtcbiAgY29uc3QgZm9ybWF0dGVyID0gcGFyc2VyRm9yQXJyYXlGb3JtYXQob3B0aW9ucyk7XG4gIGNvbnN0IHJldHVyblZhbHVlID0gLyogICAgICAgICAgICovIE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIGlmICh0eXBlb2YgcXVlcnkgIT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gIH1cbiAgcXVlcnkgPSBxdWVyeS50cmltKCkucmVwbGFjZSgvXls/IyZdLywgXCJcIik7XG4gIGlmICghcXVlcnkpIHtcbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gIH1cbiAgZm9yIChjb25zdCBwYXJhbWV0ZXIgb2YgcXVlcnkuc3BsaXQoXCImXCIpKSB7XG4gICAgaWYgKHBhcmFtZXRlciA9PT0gXCJcIikge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIGNvbnN0IHBhcmFtZXRlcl8gPSBvcHRpb25zLmRlY29kZSA/IHBhcmFtZXRlci5yZXBsYWNlQWxsKFwiK1wiLCBcIiBcIikgOiBwYXJhbWV0ZXI7XG4gICAgbGV0IFtrZXksIHZhbHVlXSA9IHNwbGl0T25GaXJzdChwYXJhbWV0ZXJfLCBcIj1cIik7XG4gICAgaWYgKGtleSA9PT0gdm9pZCAwKSB7XG4gICAgICBrZXkgPSBwYXJhbWV0ZXJfO1xuICAgIH1cbiAgICB2YWx1ZSA9IHZhbHVlID09PSB2b2lkIDAgPyBudWxsIDogW1wiY29tbWFcIiwgXCJzZXBhcmF0b3JcIiwgXCJicmFja2V0LXNlcGFyYXRvclwiXS5pbmNsdWRlcyhvcHRpb25zLmFycmF5Rm9ybWF0KSA/IHZhbHVlIDogZGVjb2RlMih2YWx1ZSwgb3B0aW9ucyk7XG4gICAgZm9ybWF0dGVyKGRlY29kZTIoa2V5LCBvcHRpb25zKSwgdmFsdWUsIHJldHVyblZhbHVlKTtcbiAgfVxuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhyZXR1cm5WYWx1ZSkpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIHZhbHVlICE9PSBudWxsICYmIG9wdGlvbnMudHlwZXNba2V5XSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgZm9yIChjb25zdCBba2V5MiwgdmFsdWUyXSBvZiBPYmplY3QuZW50cmllcyh2YWx1ZSkpIHtcbiAgICAgICAgY29uc3QgdHlwZSA9IG9wdGlvbnMudHlwZXNba2V5XSA/IG9wdGlvbnMudHlwZXNba2V5XS5yZXBsYWNlKFwiW11cIiwgXCJcIikgOiB2b2lkIDA7XG4gICAgICAgIHZhbHVlW2tleTJdID0gcGFyc2VWYWx1ZSh2YWx1ZTIsIG9wdGlvbnMsIHR5cGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIHZhbHVlICE9PSBudWxsICYmIG9wdGlvbnMudHlwZXNba2V5XSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgcmV0dXJuVmFsdWVba2V5XSA9IE9iamVjdC52YWx1ZXModmFsdWUpLmpvaW4ob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVyblZhbHVlW2tleV0gPSBwYXJzZVZhbHVlKHZhbHVlLCBvcHRpb25zLCBvcHRpb25zLnR5cGVzW2tleV0pO1xuICAgIH1cbiAgfVxuICBpZiAob3B0aW9ucy5zb3J0ID09PSBmYWxzZSkge1xuICAgIHJldHVybiByZXR1cm5WYWx1ZTtcbiAgfVxuICByZXR1cm4gKG9wdGlvbnMuc29ydCA9PT0gdHJ1ZSA/IE9iamVjdC5rZXlzKHJldHVyblZhbHVlKS5zb3J0KCkgOiBPYmplY3Qua2V5cyhyZXR1cm5WYWx1ZSkuc29ydChvcHRpb25zLnNvcnQpKS5yZWR1Y2UoKHJlc3VsdCwga2V5KSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSByZXR1cm5WYWx1ZVtrZXldO1xuICAgIHJlc3VsdFtrZXldID0gQm9vbGVhbih2YWx1ZSkgJiYgdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmICFBcnJheS5pc0FycmF5KHZhbHVlKSA/IGtleXNTb3J0ZXIodmFsdWUpIDogdmFsdWU7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSwgLyogICAgICAgICAgICovIE9iamVjdC5jcmVhdGUobnVsbCkpO1xufVxuZnVuY3Rpb24gc3RyaW5naWZ5MihvYmplY3QsIG9wdGlvbnMpIHtcbiAgaWYgKCFvYmplY3QpIHtcbiAgICByZXR1cm4gXCJcIjtcbiAgfVxuICBvcHRpb25zID0ge1xuICAgIGVuY29kZTogdHJ1ZSxcbiAgICBzdHJpY3Q6IHRydWUsXG4gICAgYXJyYXlGb3JtYXQ6IFwibm9uZVwiLFxuICAgIGFycmF5Rm9ybWF0U2VwYXJhdG9yOiBcIixcIixcbiAgICAuLi5vcHRpb25zXG4gIH07XG4gIHZhbGlkYXRlQXJyYXlGb3JtYXRTZXBhcmF0b3Iob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gIGNvbnN0IHNob3VsZEZpbHRlciA9IChrZXkpID0+IG9wdGlvbnMuc2tpcE51bGwgJiYgaXNOdWxsT3JVbmRlZmluZWQob2JqZWN0W2tleV0pIHx8IG9wdGlvbnMuc2tpcEVtcHR5U3RyaW5nICYmIG9iamVjdFtrZXldID09PSBcIlwiO1xuICBjb25zdCBmb3JtYXR0ZXIgPSBlbmNvZGVyRm9yQXJyYXlGb3JtYXQob3B0aW9ucyk7XG4gIGNvbnN0IG9iamVjdENvcHkgPSB7fTtcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMob2JqZWN0KSkge1xuICAgIGlmICghc2hvdWxkRmlsdGVyKGtleSkpIHtcbiAgICAgIG9iamVjdENvcHlba2V5XSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuICBjb25zdCBrZXlzNCA9IE9iamVjdC5rZXlzKG9iamVjdENvcHkpO1xuICBpZiAob3B0aW9ucy5zb3J0ICE9PSBmYWxzZSkge1xuICAgIGtleXM0LnNvcnQob3B0aW9ucy5zb3J0KTtcbiAgfVxuICByZXR1cm4ga2V5czQubWFwKChrZXkpID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IG9iamVjdFtrZXldO1xuICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gZW5jb2RlKGtleSwgb3B0aW9ucyk7XG4gICAgfVxuICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCAmJiBvcHRpb25zLmFycmF5Rm9ybWF0ID09PSBcImJyYWNrZXQtc2VwYXJhdG9yXCIpIHtcbiAgICAgICAgcmV0dXJuIGVuY29kZShrZXksIG9wdGlvbnMpICsgXCJbXVwiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZhbHVlLnJlZHVjZShmb3JtYXR0ZXIoa2V5KSwgW10pLmpvaW4oXCImXCIpO1xuICAgIH1cbiAgICByZXR1cm4gZW5jb2RlKGtleSwgb3B0aW9ucykgKyBcIj1cIiArIGVuY29kZSh2YWx1ZSwgb3B0aW9ucyk7XG4gIH0pLmZpbHRlcigoeCkgPT4geC5sZW5ndGggPiAwKS5qb2luKFwiJlwiKTtcbn1cbmZ1bmN0aW9uIHBhcnNlVXJsKHVybCwgb3B0aW9ucykge1xuICBvcHRpb25zID0ge1xuICAgIGRlY29kZTogdHJ1ZSxcbiAgICAuLi5vcHRpb25zXG4gIH07XG4gIGxldCBbdXJsXywgaGFzaF0gPSBzcGxpdE9uRmlyc3QodXJsLCBcIiNcIik7XG4gIGlmICh1cmxfID09PSB2b2lkIDApIHtcbiAgICB1cmxfID0gdXJsO1xuICB9XG4gIHJldHVybiB7XG4gICAgdXJsOiB1cmxfPy5zcGxpdChcIj9cIik/LlswXSA/PyBcIlwiLFxuICAgIHF1ZXJ5OiBwYXJzZTIoZXh0cmFjdCh1cmwpLCBvcHRpb25zKSxcbiAgICAuLi4ob3B0aW9ucyYmIG9wdGlvbnMucGFyc2VGcmFnbWVudElkZW50aWZpZXIgJiYgaGFzaCA/IHsgZnJhZ21lbnRJZGVudGlmaWVyOiBkZWNvZGUyKGhhc2gsIG9wdGlvbnMpIH0gOiB7fSlcbiAgfTtcbn1cbmZ1bmN0aW9uIHN0cmluZ2lmeVVybChvYmplY3QsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IHtcbiAgICBlbmNvZGU6IHRydWUsXG4gICAgc3RyaWN0OiB0cnVlLFxuICAgIFtlbmNvZGVGcmFnbWVudElkZW50aWZpZXJdOiB0cnVlLFxuICAgIC4uLm9wdGlvbnNcbiAgfTtcbiAgY29uc3QgdXJsID0gcmVtb3ZlSGFzaChvYmplY3QudXJsKS5zcGxpdChcIj9cIilbMF0gfHwgXCJcIjtcbiAgY29uc3QgcXVlcnlGcm9tVXJsID0gZXh0cmFjdChvYmplY3QudXJsKTtcbiAgY29uc3QgcXVlcnkgPSB7XG4gICAgLi4ucGFyc2UyKHF1ZXJ5RnJvbVVybCwgeyBzb3J0OiBmYWxzZSB9KSxcbiAgICAuLi5vYmplY3QucXVlcnlcbiAgfTtcbiAgbGV0IHF1ZXJ5U3RyaW5nID0gc3RyaW5naWZ5MihxdWVyeSwgb3B0aW9ucyk7XG4gIHF1ZXJ5U3RyaW5nICYmPSBgPyR7cXVlcnlTdHJpbmd9YDtcbiAgbGV0IGhhc2ggPSBnZXRIYXNoKG9iamVjdC51cmwpO1xuICBpZiAodHlwZW9mIG9iamVjdC5mcmFnbWVudElkZW50aWZpZXIgPT09IFwic3RyaW5nXCIpIHtcbiAgICBjb25zdCB1cmxPYmplY3RGb3JGcmFnbWVudEVuY29kZSA9IG5ldyBVUkwodXJsKTtcbiAgICB1cmxPYmplY3RGb3JGcmFnbWVudEVuY29kZS5oYXNoID0gb2JqZWN0LmZyYWdtZW50SWRlbnRpZmllcjtcbiAgICBoYXNoID0gb3B0aW9uc1tlbmNvZGVGcmFnbWVudElkZW50aWZpZXJdID8gdXJsT2JqZWN0Rm9yRnJhZ21lbnRFbmNvZGUuaGFzaCA6IGAjJHtvYmplY3QuZnJhZ21lbnRJZGVudGlmaWVyfWA7XG4gIH1cbiAgcmV0dXJuIGAke3VybH0ke3F1ZXJ5U3RyaW5nfSR7aGFzaH1gO1xufVxuZnVuY3Rpb24gcGljayhpbnB1dCwgZmlsdGVyLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSB7XG4gICAgcGFyc2VGcmFnbWVudElkZW50aWZpZXI6IHRydWUsXG4gICAgW2VuY29kZUZyYWdtZW50SWRlbnRpZmllcl06IGZhbHNlLFxuICAgIC4uLm9wdGlvbnNcbiAgfTtcbiAgY29uc3QgeyB1cmwsIHF1ZXJ5LCBmcmFnbWVudElkZW50aWZpZXIgfSA9IHBhcnNlVXJsKGlucHV0LCBvcHRpb25zKTtcbiAgcmV0dXJuIHN0cmluZ2lmeVVybCh7XG4gICAgdXJsLFxuICAgIHF1ZXJ5OiBpbmNsdWRlS2V5cyhxdWVyeSwgZmlsdGVyKSxcbiAgICBmcmFnbWVudElkZW50aWZpZXJcbiAgfSwgb3B0aW9ucyk7XG59XG5mdW5jdGlvbiBleGNsdWRlKGlucHV0LCBmaWx0ZXIsIG9wdGlvbnMpIHtcbiAgY29uc3QgZXhjbHVzaW9uRmlsdGVyID0gQXJyYXkuaXNBcnJheShmaWx0ZXIpID8gKGtleSkgPT4gIWZpbHRlci5pbmNsdWRlcyhrZXkpIDogKGtleSwgdmFsdWUpID0+ICFmaWx0ZXIoa2V5LCB2YWx1ZSk7XG4gIHJldHVybiBwaWNrKGlucHV0LCBleGNsdXNpb25GaWx0ZXIsIG9wdGlvbnMpO1xufVxuXG4vL1xudmFyIHF1ZXJ5X3N0cmluZ19kZWZhdWx0ID0gYmFzZV9leHBvcnRzO1xuXG4vL1xudmFyIHI0ID0gZ2xvYmFsVGhpcy5oYXJkZW4gfHwgT2JqZWN0LmZyZWV6ZTtcbnZhciB0NCA9IFsxMjAsIDI0MSwgMTEyXTtcbnI0KHQ0KTtcbnZhciBkZWNvZGVCZWNoMzIgPSAobzIsIHQ1ID0gMTAyNCkgPT4ge1xuICBjb25zdCB7IHByZWZpeDogczMsIHdvcmRzOiBuMiB9ID0gaW1wb3J0X2JlY2gzMi5iZWNoMzIuZGVjb2RlKG8yLCB0NSksIGQgPSBpbXBvcnRfYmVjaDMyLmJlY2gzMi5mcm9tV29yZHMobjIpLCBjMiA9IG5ldyBVaW50OEFycmF5KGQpO1xuICByZXR1cm4gcjQoeyBwcmVmaXg6IHMzLCBieXRlczogYzIgfSk7XG59O1xucjQoZGVjb2RlQmVjaDMyKTtcbnZhciBlbmNvZGVCZWNoMzIgPSAobzIsIHI1LCB0NSA9IDEwMjQpID0+IHtcbiAgY29uc3QgczMgPSBpbXBvcnRfYmVjaDMyLmJlY2gzMi50b1dvcmRzKHI1KTtcbiAgcmV0dXJuIGltcG9ydF9iZWNoMzIuYmVjaDMyLmVuY29kZShvMiwgczMsIHQ1KTtcbn07XG5yNChlbmNvZGVCZWNoMzIpO1xudmFyIGpvaW5Ib29rZWRBZGRyZXNzID0gKGUyLCBvMiwgcjUgPSAxMDI0KSA9PiB7XG4gIGNvbnN0IHsgcHJlZml4OiBzMywgYnl0ZXM6IG4yIH0gPSBkZWNvZGVCZWNoMzIoZTIsIHI1KSwgZCA9IG4yLmxlbmd0aCwgYzIgPSBvMi5sZW5ndGgsIGEyID0gNjU1MzY7XG4gIGlmIChkID49IGEyKSB0aHJvdyBSYW5nZUVycm9yKGBCYXNlIGFkZHJlc3MgbGVuZ3RoIDB4JHtkLnRvU3RyaW5nKDE2KX0gZXhjZWVkcyBtYXhpbXVtIDB4JHthMi50b1N0cmluZygxNil9YCk7XG4gIGlmICghTnVtYmVyLmlzU2FmZUludGVnZXIoYzIpIHx8IGMyIDwgMCkgdGhyb3cgUmFuZ2VFcnJvcihgSG9vayBkYXRhIGxlbmd0aCAke2MyfSBpcyBub3QgYSBub24tbmVnYXRpdmUgaW50ZWdlcmApO1xuICBjb25zdCBpMiA9IHQ0Lmxlbmd0aCwgaCA9IG5ldyBVaW50OEFycmF5KGkyICsgZCArIGMyICsgMik7XG4gIGguc2V0KHQ0LCAwKSwgaFtpMiAtIDFdIHw9IDAsIGguc2V0KG4yLCBpMiksIGguc2V0KG8yLCBpMiArIGQpO1xuICBsZXQgZzMgPSBkO1xuICBmb3IgKGxldCBlMyA9IDA7IGUzIDwgMjsgZTMgKz0gMSkgaFtoLmxlbmd0aCAtIDEgLSBlM10gPSAyNTUgJiBnMywgZzMgPj4+PSA4O1xuICByZXR1cm4gZW5jb2RlQmVjaDMyKHMzLCBoLCByNSk7XG59O1xucjQoam9pbkhvb2tlZEFkZHJlc3MpO1xudmFyIGVuY29kZUFkZHJlc3NIb29rID0gKGUyLCByNSwgdDUpID0+IHtcbiAgY29uc3QgczMgPSBxdWVyeV9zdHJpbmdfZGVmYXVsdC5zdHJpbmdpZnkocjUpLCBuMiA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShgPyR7czN9YCk7XG4gIHJldHVybiBqb2luSG9va2VkQWRkcmVzcyhlMiwgbjIsIHQ1KTtcbn07XG5yNChlbmNvZGVBZGRyZXNzSG9vayk7XG52YXIgZGVjb2RlQWRkcmVzc0hvb2sgPSAoZTIsIHQ1KSA9PiB7XG4gIGNvbnN0IHsgYmFzZUFkZHJlc3M6IHMzLCBob29rRGF0YTogbjIgfSA9IHNwbGl0SG9va2VkQWRkcmVzcyhlMiwgdDUpLCBkID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKG4yKTtcbiAgaWYgKGQgJiYgIWQuc3RhcnRzV2l0aChcIj9cIikpIHRocm93IEVycm9yKGBIb29rIGRhdGEgZG9lcyBub3Qgc3RhcnQgd2l0aCAnPyc6ICR7ZH1gKTtcbiAgY29uc3QgYzIgPSBxdWVyeV9zdHJpbmdfZGVmYXVsdC5wYXJzZShkKSwgYTIgPSByNCh7IC4uLmMyIH0pO1xuICByZXR1cm4gcjQoeyBiYXNlQWRkcmVzczogczMsIHF1ZXJ5OiBhMiB9KTtcbn07XG5yNChkZWNvZGVBZGRyZXNzSG9vayk7XG52YXIgc3BsaXRIb29rZWRBZGRyZXNzID0gKGUyLCBvMiA9IDEwMjQpID0+IHtcbiAgY29uc3QgeyBwcmVmaXg6IHMzLCBieXRlczogbjIgfSA9IGRlY29kZUJlY2gzMihlMiwgbzIpLCBkID0gdDQubGVuZ3RoO1xuICBsZXQgYzIgPSAyNTU7XG4gIGZvciAobGV0IG8zID0gMDsgbzMgPCBkOyBvMyArPSAxKSB7XG4gICAgbGV0IHM0ID0gbjJbbzNdO1xuICAgIGlmIChvMyA9PT0gZCAtIDEgJiYgKGMyID0gMTUgJiBzNCwgczQgJj0gMjQwKSwgczQgIT09IHQ0W28zXSkgcmV0dXJuIHI0KHsgYmFzZUFkZHJlc3M6IGUyLCBob29rRGF0YTogbmV3IFVpbnQ4QXJyYXkoKSB9KTtcbiAgfVxuICBpZiAoMCAhPT0gYzIpIHRocm93IFR5cGVFcnJvcihgVW5zdXBwb3J0ZWQgYWRkcmVzcyBob29rIHZlcnNpb24gJHtjMn1gKTtcbiAgbGV0IGEyID0gMDtcbiAgZm9yIChsZXQgZTMgPSAxOyBlMyA+PSAwOyBlMyAtPSAxKSB7XG4gICAgY29uc3QgbzMgPSBuMi5hdCgtZTMgLSAxKTtcbiAgICBpZiAodm9pZCAwID09PSBvMykgdGhyb3cgVHlwZUVycm9yKGBDYW5ub3QgZ2V0IGJhc2UgYWRkcmVzcyBsZW5ndGggZnJvbSBieXRlICR7LWUzIC0gMX0gb2YgJHtuMi5sZW5ndGh9YCk7XG4gICAgYTIgPDw9IDgsIGEyIHw9IG8zO1xuICB9XG4gIGNvbnN0IGkyID0gYTI7XG4gIGlmIChpMiA+IG4yLmxlbmd0aCAtIDIgLSBkKSB0aHJvdyBUeXBlRXJyb3IoYEJhc2UgYWRkcmVzcyBsZW5ndGggMHgke2kyLnRvU3RyaW5nKDE2KX0gaXMgbG9uZ2VyIHRoYW4gc3BlY2ltZW4gbGVuZ3RoICR7bjIubGVuZ3RoIC0gMiAtIGR9YCk7XG4gIGNvbnN0IGggPSBuMi5zdWJhcnJheShkLCBkICsgaTIpLCBnMyA9IGVuY29kZUJlY2gzMihzMywgaCwgbzIpLCBsMyA9IG4yLnN1YmFycmF5KGQgKyBpMiwgLTIpO1xuICByZXR1cm4gcjQoeyBiYXNlQWRkcmVzczogZzMsIGhvb2tEYXRhOiBsMyB9KTtcbn07XG5yNChzcGxpdEhvb2tlZEFkZHJlc3MpO1xuXG4vL1xudmFyIHsgYWRkOiBhZGQzLCBpc0dURTogaXNHVEUyLCBzdWJ0cmFjdDogc3VidHJhY3QzLCBtYWtlRW1wdHkgfSA9IEFtb3VudE1hdGg7XG52YXIgZ2V0Q29uZmlnVmFsdWUgPSAoZmVlQ29uZmlnLCBrZXksIGRlc3RpbmF0aW9uKSA9PiB7XG4gIGNvbnN0IGNoYWluSWQgPSBjaGFpbk9mQWNjb3VudChkZXN0aW5hdGlvbik7XG4gIGlmIChmZWVDb25maWcuZGVzdGluYXRpb25PdmVycmlkZXM/LltjaGFpbklkXSAmJiBmZWVDb25maWcuZGVzdGluYXRpb25PdmVycmlkZXNbY2hhaW5JZF1ba2V5XSAhPT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIGZlZUNvbmZpZy5kZXN0aW5hdGlvbk92ZXJyaWRlc1tjaGFpbklkXVtrZXldO1xuICB9XG4gIHJldHVybiBmZWVDb25maWdba2V5XTtcbn07XG52YXIgbWFrZUZlZVRvb2xzID0gKGZlZUNvbmZpZykgPT4ge1xuICBtdXN0TWF0Y2goZmVlQ29uZmlnLCBGZWVDb25maWdTaGFwZSwgXCJNdXN0IHByb3ZpZGUgZmVlQ29uZmlnXCIpO1xuICBjb25zdCBlbXB0eUFtb3VudCA9IG1ha2VFbXB0eShmZWVDb25maWcuZmxhdC5icmFuZCk7XG4gIGNvbnN0IGZlZVRvb2xzID0gaGFyZGVuKHtcbiAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgY2FsY3VsYXRlQmFzZUZlZShyZXF1ZXN0ZWQsIGRlc3RpbmF0aW9uKSB7XG4gICAgICBjb25zdCBmbGF0ID0gZ2V0Q29uZmlnVmFsdWUoZmVlQ29uZmlnLCBcImZsYXRcIiwgZGVzdGluYXRpb24pO1xuICAgICAgY29uc3QgdmFyaWFibGVSYXRlID0gZ2V0Q29uZmlnVmFsdWUoXG4gICAgICAgIGZlZUNvbmZpZyxcbiAgICAgICAgXCJ2YXJpYWJsZVJhdGVcIixcbiAgICAgICAgZGVzdGluYXRpb25cbiAgICAgICk7XG4gICAgICByZXR1cm4gYWRkMyhtdWx0aXBseUJ5KHJlcXVlc3RlZCwgdmFyaWFibGVSYXRlKSwgZmxhdCk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cbiAgICAgKi9cbiAgICBjYWxjdWxhdGVSZWxheUZlZShkZXN0aW5hdGlvbikge1xuICAgICAgY29uc3QgcmVsYXkgPSBnZXRDb25maWdWYWx1ZShmZWVDb25maWcsIFwicmVsYXlcIiwgZGVzdGluYXRpb24pO1xuICAgICAgcmV0dXJuIHJlbGF5IHx8IGVtcHR5QW1vdW50O1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG4gICAgICovXG4gICAgY2FsY3VsYXRlQWR2YW5jZUZlZShyZXF1ZXN0ZWQsIGRlc3RpbmF0aW9uKSB7XG4gICAgICBjb25zdCBiYXNlRmVlID0gZmVlVG9vbHMuY2FsY3VsYXRlQmFzZUZlZShyZXF1ZXN0ZWQsIGRlc3RpbmF0aW9uKTtcbiAgICAgIGNvbnN0IHJlbGF5RmVlID0gZmVlVG9vbHMuY2FsY3VsYXRlUmVsYXlGZWUoZGVzdGluYXRpb24pO1xuICAgICAgY29uc3QgZmVlID0gYWRkMyhiYXNlRmVlLCByZWxheUZlZSk7XG4gICAgICAhaXNHVEUyKGZlZSwgcmVxdWVzdGVkKSB8fCB0aHJvd1JlZGFjdGVkYFJlcXVlc3QgbXVzdCBleGNlZWQgZmVlcy5gO1xuICAgICAgcmV0dXJuIGZlZTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuICAgICAqL1xuICAgIGNhbGN1bGF0ZUFkdmFuY2UocmVxdWVzdGVkLCBkZXN0aW5hdGlvbikge1xuICAgICAgY29uc3QgZmVlID0gZmVlVG9vbHMuY2FsY3VsYXRlQWR2YW5jZUZlZShyZXF1ZXN0ZWQsIGRlc3RpbmF0aW9uKTtcbiAgICAgIHJldHVybiBzdWJ0cmFjdDMocmVxdWVzdGVkLCBmZWUpO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgY2FsY3VsYXRlU3BsaXQocmVxdWVzdGVkLCBkZXN0aW5hdGlvbikge1xuICAgICAgY29uc3QgYmFzZUZlZSA9IGZlZVRvb2xzLmNhbGN1bGF0ZUJhc2VGZWUocmVxdWVzdGVkLCBkZXN0aW5hdGlvbik7XG4gICAgICBjb25zdCByZWxheUZlZSA9IGZlZVRvb2xzLmNhbGN1bGF0ZVJlbGF5RmVlKGRlc3RpbmF0aW9uKTtcbiAgICAgIGNvbnN0IHRvdGFsRmVlID0gYWRkMyhiYXNlRmVlLCByZWxheUZlZSk7XG4gICAgICAhaXNHVEUyKHRvdGFsRmVlLCByZXF1ZXN0ZWQpIHx8IHRocm93UmVkYWN0ZWRgUmVxdWVzdCBtdXN0IGV4Y2VlZCBmZWVzLmA7XG4gICAgICBjb25zdCBjb250cmFjdFJhdGUgPSBnZXRDb25maWdWYWx1ZShcbiAgICAgICAgZmVlQ29uZmlnLFxuICAgICAgICBcImNvbnRyYWN0UmF0ZVwiLFxuICAgICAgICBkZXN0aW5hdGlvblxuICAgICAgKTtcbiAgICAgIGNvbnN0IFByaW5jaXBhbCA9IHN1YnRyYWN0MyhyZXF1ZXN0ZWQsIHRvdGFsRmVlKTtcbiAgICAgIGNvbnN0IENvbnRyYWN0RmVlID0gbXVsdGlwbHlCeShiYXNlRmVlLCBjb250cmFjdFJhdGUpO1xuICAgICAgY29uc3QgUG9vbEZlZSA9IHN1YnRyYWN0MyhiYXNlRmVlLCBDb250cmFjdEZlZSk7XG4gICAgICByZXR1cm4gaGFyZGVuKHsgUHJpbmNpcGFsLCBQb29sRmVlLCBDb250cmFjdEZlZSwgUmVsYXlGZWU6IHJlbGF5RmVlIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBmZWVUb29scztcbn07XG5cbi8vXG52YXIgbWFrZVN1cHBvcnRzQ2N0cCA9IChjaGFpbkh1YikgPT4gKGRlc3QpID0+IHtcbiAgY29uc3QgeyBuYW1lc3BhY2UsIHJlZmVyZW5jZSB9ID0gcGFyc2VBY2NvdW50SWQoZGVzdCk7XG4gIGlmIChuYW1lc3BhY2UgIT09IFwiZWlwMTU1XCIpIHJldHVybiBmYWxzZTtcbiAgdHJ5IHtcbiAgICBjb25zdCBjaSA9IGNoYWluSHViLmdldENoYWluSW5mb0J5Q2hhaW5JZChgJHtuYW1lc3BhY2V9OiR7cmVmZXJlbmNlfWApO1xuICAgIHJldHVybiB0eXBlb2YgY2kuY2N0cERlc3RpbmF0aW9uRG9tYWluID09PSBcIm51bWJlclwiO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cbi8vXG52YXIgRk9SV0FSRF9USU1FT1VUID0ge1xuICBzZWM6IDEwbiAqIDYwbixcbiAgcDogXCIxMG1cIlxufTtcbmhhcmRlbihGT1JXQVJEX1RJTUVPVVQpO1xudmFyIG1ha2VMb2NhbEFjY291bnQgPSBhc3luYyAob3JjaCkgPT4ge1xuICBjb25zdCBhZ29yaWNDaGFpbiA9IGF3YWl0IG9yY2guZ2V0Q2hhaW4oXCJhZ29yaWNcIik7XG4gIHJldHVybiBhZ29yaWNDaGFpbi5tYWtlQWNjb3VudCgpO1xufTtcbmhhcmRlbihtYWtlTG9jYWxBY2NvdW50KTtcbnZhciBtYWtlTm9ibGVBY2NvdW50ID0gYXN5bmMgKG9yY2gpID0+IHtcbiAgY29uc3Qgbm9ibGVDaGFpbiA9IGF3YWl0IG9yY2guZ2V0Q2hhaW4oXCJub2JsZVwiKTtcbiAgcmV0dXJuIG5vYmxlQ2hhaW4ubWFrZUFjY291bnQoKTtcbn07XG5oYXJkZW4obWFrZU5vYmxlQWNjb3VudCk7XG52YXIgZm9yd2FyZEZ1bmRzID0gYXN5bmMgKG9yY2gsIHtcbiAgY3VycmVudENoYWluUmVmZXJlbmNlLFxuICBzdXBwb3J0c0NjdHAsXG4gIGxvZyxcbiAgZ2V0Tm9ibGVJQ0EsXG4gIHNldHRsZW1lbnRBY2NvdW50LFxuICBzdGF0dXNNYW5hZ2VyXG59LCB0eCkgPT4ge1xuICBhd2FpdCBudWxsO1xuICBhc3NlcnRBbGxEZWZpbmVkKHtcbiAgICBjdXJyZW50Q2hhaW5SZWZlcmVuY2UsXG4gICAgc3VwcG9ydHNDY3RwLFxuICAgIGxvZyxcbiAgICBnZXROb2JsZUlDQSxcbiAgICBzZXR0bGVtZW50QWNjb3VudCxcbiAgICBzdGF0dXNNYW5hZ2VyLFxuICAgIHR4XG4gIH0pO1xuICBjb25zdCB7IGFtb3VudCwgZGVzdGluYXRpb24sIHR4SGFzaCB9ID0gdHg7XG4gIGxvZyhcInRyeWluZyBmb3J3YXJkIGZvclwiLCBhbW91bnQsIFwidG9cIiwgZGVzdGluYXRpb24sIFwiZm9yXCIsIHR4SGFzaCk7XG4gIGNvbnN0IHsgbmFtZXNwYWNlLCByZWZlcmVuY2UgfSA9IHBhcnNlQWNjb3VudElkKGRlc3RpbmF0aW9uKTtcbiAgY29uc3Qgc2V0dGxlbWVudCA9IGF3YWl0IHNldHRsZW1lbnRBY2NvdW50O1xuICBjb25zdCBpbnRlcm1lZGlhdGVSZWNpcGllbnQgPSBnZXROb2JsZUlDQSgpLmdldEFkZHJlc3MoKTtcbiAgaWYgKG5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIikge1xuICAgIGNvbnN0IGNvbXBsZXRpb24gPSByZWZlcmVuY2UgPT09IGN1cnJlbnRDaGFpblJlZmVyZW5jZSA/IHNldHRsZW1lbnQuc2VuZChkZXN0aW5hdGlvbiwgYW1vdW50KSA6IHNldHRsZW1lbnQudHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwge1xuICAgICAgdGltZW91dFJlbGF0aXZlU2Vjb25kczogRk9SV0FSRF9USU1FT1VULnNlYyxcbiAgICAgIGZvcndhcmRPcHRzOiB7XG4gICAgICAgIGludGVybWVkaWF0ZVJlY2lwaWVudCxcbiAgICAgICAgdGltZW91dDogRk9SV0FSRF9USU1FT1VULnBcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0cnkge1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkaW5nKHR4SGFzaCk7XG4gICAgICBhd2FpdCBjb21wbGV0aW9uO1xuICAgICAgbG9nKFwiZm9yd2FyZCBzdWNjZXNzZnVsIGZvclwiLCB0eEhhc2gpO1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkZWQodHhIYXNoLCB7XG4gICAgICAgIHR4SGFzaCxcbiAgICAgICAgZGVzdGluYXRpb24sXG4gICAgICAgIGFtb3VudDogYW1vdW50LnZhbHVlXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChyZWFzb24pIHtcbiAgICAgIGxvZyhcIlxcdTI2QTBcXHVGRTBGIGZvcndhcmQgdHJhbnNmZXIgcmVqZWN0ZWRcIiwgcmVhc29uLCB0eEhhc2gpO1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkRmFpbGVkKHR4SGFzaCwge1xuICAgICAgICB0eEhhc2gsXG4gICAgICAgIGRlc3RpbmF0aW9uLFxuICAgICAgICBhbW91bnQ6IGFtb3VudC52YWx1ZVxuICAgICAgfSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKHN1cHBvcnRzQ2N0cChkZXN0aW5hdGlvbikpIHtcbiAgICB0cnkge1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkaW5nKHR4SGFzaCk7XG4gICAgICBhd2FpdCBzZXR0bGVtZW50LnRyYW5zZmVyKGludGVybWVkaWF0ZVJlY2lwaWVudCwgYW1vdW50LCB7XG4gICAgICAgIHRpbWVvdXRSZWxhdGl2ZVNlY29uZHM6IEZPUldBUkRfVElNRU9VVC5zZWNcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKHJlYXNvbikge1xuICAgICAgbG9nKFwiXFx1MjZBMFxcdUZFMEYgZm9yd2FyZCBpbnRlcm1lZGlhdGUgdHJhbnNmZXIgcmVqZWN0ZWRcIiwgcmVhc29uLCB0eEhhc2gpO1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkRmFpbGVkKHR4SGFzaCwge1xuICAgICAgICB0eEhhc2gsXG4gICAgICAgIGRlc3RpbmF0aW9uLFxuICAgICAgICBhbW91bnQ6IGFtb3VudC52YWx1ZVxuICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IGJ1cm5BbW91bnQgPSB7IGRlbm9tOiBcInV1c2RjXCIsIHZhbHVlOiBhbW91bnQudmFsdWUgfTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZ2V0Tm9ibGVJQ0EoKS5kZXBvc2l0Rm9yQnVybihkZXN0aW5hdGlvbiwgYnVybkFtb3VudCk7XG4gICAgICBsb2coXCJmb3J3YXJkIHRyYW5zZmVyIGFuZCBkZXBvc2l0Rm9yQnVybiBzdWNjZXNzZnVsIGZvclwiLCB0eEhhc2gpO1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkZWQodHgudHhIYXNoKTtcbiAgICB9IGNhdGNoIChyZWFzb24pIHtcbiAgICAgIGxvZyhcIlxcdTI2QTBcXHVGRTBGIGZvcndhcmQgZGVwb3NpdEZvckJ1cm4gcmVqZWN0ZWRcIiwgcmVhc29uLCB0eEhhc2gpO1xuICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkRmFpbGVkKHR4SGFzaCwge1xuICAgICAgICB0eEhhc2gsXG4gICAgICAgIGRlc3RpbmF0aW9uLFxuICAgICAgICBhbW91bnQ6IGFtb3VudC52YWx1ZSxcbiAgICAgICAgZnVuZHNJbk5vYmxlSWNhOiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbG9nKFxuICAgICAgXCJcXHUyNkEwXFx1RkUwRiBmb3J3YXJkIG5vdCBhdHRlbXB0ZWRcIixcbiAgICAgIFwidW5zdXBwb3J0ZWQgZGVzdGluYXRpb25cIixcbiAgICAgIHR4SGFzaCxcbiAgICAgIGRlc3RpbmF0aW9uXG4gICAgKTtcbiAgICBzdGF0dXNNYW5hZ2VyLmZvcndhcmRTa2lwcGVkKHR4SGFzaCk7XG4gIH1cbn07XG5oYXJkZW4oZm9yd2FyZEZ1bmRzKTtcbnZhciBhZHZhbmNlRnVuZHMgPSBhc3luYyAob3JjaCwge1xuICBjaGFpbkh1YlRvb2xzLFxuICBmZWVDb25maWcsXG4gIGdldE5vYmxlSUNBLFxuICBsb2csXG4gIHN0YXR1c01hbmFnZXIsXG4gIHVzZGMsXG4gIHpjZlRvb2xzLFxuICB6b2VUb29sczogeyBsb2NhbFRyYW5zZmVyLCB3aXRoZHJhd1RvU2VhdCB9XG59LCB7IGV2aWRlbmNlLCByaXNrIH0sIGNvbmZpZykgPT4ge1xuICBjb25zdCBmZWVUb29scyA9IG1ha2VGZWVUb29scyhmZWVDb25maWcpO1xuICBjb25zdCB0b0Ftb3VudCA9ICh2YWx1ZSkgPT4gQW1vdW50TWF0aC5tYWtlKHVzZGMuYnJhbmQsIHZhbHVlKTtcbiAgY29uc3Qgc3VwcG9ydHNDY3RwID0gbWFrZVN1cHBvcnRzQ2N0cChjaGFpbkh1YlRvb2xzKTtcbiAgYXdhaXQgbnVsbDtcbiAgdHJ5IHtcbiAgICBsZXQgZGVwb3NpdFJlamVjdGVkID0gZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgIGxvZyhcbiAgICAgICAgXCJcXHUyNkEwXFx1RkUwRiBkZXBvc2l0IHRvIGxvY2FsT3JjaEFjY291bnQgZmFpbGVkLCBhdHRlbXB0aW5nIHRvIHJldHVybiBwYXltZW50IHRvIExQXCIsXG4gICAgICAgIGVycm9yXG4gICAgICApO1xuICAgICAgdHJ5IHtcbiAgICAgICAgbm90aWZpZXIubm90aWZ5QWR2YW5jaW5nUmVzdWx0KGRldGFpbCwgZmFsc2UpO1xuICAgICAgICBib3Jyb3dlci5yZXR1cm5Ub1Bvb2wodG1wU2VhdCwgYWR2YW5jZUFtb3VudCk7XG4gICAgICAgIHRtcFNlYXQuZXhpdCgpO1xuICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgbG9nKFwiXFx1ezFGNkE4fSBkZXBvc2l0IHRvIGxvY2FsT3JjaEFjY291bnQgZmFpbHVyZSByZWNvdmVyeSBmYWlsZWRcIiwgZTIpO1xuICAgICAgfVxuICAgIH0sIHdpdGhkcmF3UmVqZWN0ZWQgPSBmdW5jdGlvbihlcnJvciwgdG1wUmV0dXJuU2VhdCkge1xuICAgICAgbG9nKFxuICAgICAgICBgXFx1ezFGNkE4fSB3aXRoZHJhdyAke3F1b3RlKGFkdmFuY2VBbW91bnQpfSBmcm9tIFwicG9vbEFjY291bnRcIiB0byByZXR1cm4gdG8gcG9vbCBmYWlsZWRgLFxuICAgICAgICBlcnJvclxuICAgICAgKTtcbiAgICAgIHRtcFJldHVyblNlYXQuZXhpdCgpO1xuICAgIH07XG4gICAgaWYgKHN0YXR1c01hbmFnZXIuaGFzQmVlbk9ic2VydmVkKGV2aWRlbmNlKSkge1xuICAgICAgbG9nKFwidHhIYXNoIGFscmVhZHkgc2VlbjpcIiwgZXZpZGVuY2UudHhIYXNoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHJpc2sucmlza3NJZGVudGlmaWVkPy5sZW5ndGgpIHtcbiAgICAgIGxvZyhcInJpc2tzIGlkZW50aWZpZWQsIHNraXBwaW5nIGFkdmFuY2VcIik7XG4gICAgICBzdGF0dXNNYW5hZ2VyLnNraXBBZHZhbmNlKGV2aWRlbmNlLCByaXNrLnJpc2tzSWRlbnRpZmllZCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHsgc2V0dGxlbWVudEFkZHJlc3MgfSA9IGNvbmZpZztcbiAgICBjb25zdCB7IEVVRCB9ID0gKCgpID0+IHtcbiAgICAgIGNvbnN0IHsgcmVjaXBpZW50QWRkcmVzcyB9ID0gZXZpZGVuY2UuYXV4O1xuICAgICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZUFkZHJlc3NIb29rKHJlY2lwaWVudEFkZHJlc3MpO1xuICAgICAgbXVzdE1hdGNoMyhkZWNvZGVkLCBBZGRyZXNzSG9va1NoYXBlKTtcbiAgICAgIGlmIChkZWNvZGVkLmJhc2VBZGRyZXNzICE9PSBzZXR0bGVtZW50QWRkcmVzcy52YWx1ZSkge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYOKaoO+4jyBiYXNlQWRkcmVzcyBvZiBhZGRyZXNzIGhvb2sgJHtxdW90ZShkZWNvZGVkLmJhc2VBZGRyZXNzKX0gZG9lcyBub3QgbWF0Y2ggdGhlIGV4cGVjdGVkIGFkZHJlc3MgJHtxdW90ZShzZXR0bGVtZW50QWRkcmVzcy52YWx1ZSl9YDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkZWNvZGVkLnF1ZXJ5O1xuICAgIH0pKCk7XG4gICAgbG9nKGBkZWNvZGVkIEVVRDogJHtFVUR9YCk7XG4gICAgY29uc3QgZGVzdGluYXRpb24gPSBjaGFpbkh1YlRvb2xzLnJlc29sdmVBY2NvdW50SWQoRVVEKTtcbiAgICBjb25zdCBhY2NvdW50SWQgPSBwYXJzZUFjY291bnRJZChkZXN0aW5hdGlvbik7XG4gICAgaWYgKCEoYWNjb3VudElkLm5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIiB8fCBzdXBwb3J0c0NjdHAoZGVzdGluYXRpb24pKSkge1xuICAgICAgY29uc3QgZGVzdENoYWluID0gY2hhaW5PZkFjY291bnQoZGVzdGluYXRpb24pO1xuICAgICAgc3RhdHVzTWFuYWdlci5za2lwQWR2YW5jZShldmlkZW5jZSwgW1xuICAgICAgICBgVHJhbnNmZXIgdG8gJHtkZXN0Q2hhaW59IG5vdCBzdXBwb3J0ZWQuYFxuICAgICAgXSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGZ1bGxBbW91bnQgPSB0b0Ftb3VudChldmlkZW5jZS50eC5hbW91bnQpO1xuICAgIGNvbnN0IHsgYm9ycm93ZXIsIG5vdGlmaWVyLCBwb29sQWNjb3VudCB9ID0gY29uZmlnO1xuICAgIGNvbnN0IG1pbnRlZEVhcmx5ID0gbm90aWZpZXIuY2hlY2tNaW50ZWRFYXJseShldmlkZW5jZSwgZGVzdGluYXRpb24pO1xuICAgIGlmIChtaW50ZWRFYXJseSkgcmV0dXJuO1xuICAgIGNvbnN0IGFkdmFuY2VBbW91bnQgPSBmZWVUb29scy5jYWxjdWxhdGVBZHZhbmNlKGZ1bGxBbW91bnQsIGRlc3RpbmF0aW9uKTtcbiAgICBjb25zdCBhbW91bnQgPSBoYXJkZW4oeyBkZW5vbTogdXNkYy5kZW5vbSwgdmFsdWU6IGFkdmFuY2VBbW91bnQudmFsdWUgfSk7XG4gICAgY29uc3QgdG1wU2VhdCA9IHpjZlRvb2xzLm1ha2VFbXB0eVpDRlNlYXQoKTtcbiAgICBib3Jyb3dlci5ib3Jyb3codG1wU2VhdCwgYWR2YW5jZUFtb3VudCk7XG4gICAgc3RhdHVzTWFuYWdlci5hZHZhbmNlKGV2aWRlbmNlKTtcbiAgICBjb25zdCBkZXRhaWwgPSB7XG4gICAgICB0eEhhc2g6IGV2aWRlbmNlLnR4SGFzaCxcbiAgICAgIGZvcndhcmRpbmdBZGRyZXNzOiBldmlkZW5jZS50eC5mb3J3YXJkaW5nQWRkcmVzcyxcbiAgICAgIGZ1bGxBbW91bnQsXG4gICAgICBkZXN0aW5hdGlvblxuICAgIH07XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGxvY2FsVHJhbnNmZXIoXG4gICAgICAgIHRtcFNlYXQsXG4gICAgICAgIHBvb2xBY2NvdW50LFxuICAgICAgICBoYXJkZW4oeyBVU0RDOiBhZHZhbmNlQW1vdW50IH0pXG4gICAgICApO1xuICAgICAgdG1wU2VhdC5leGl0KCk7XG4gICAgICBjb25zdCBpbnRlcm1lZGlhdGVSZWNpcGllbnQgPSBnZXROb2JsZUlDQSgpLmdldEFkZHJlc3MoKTtcbiAgICAgIGNvbnN0IGRlc3RJbmZvID0gcGFyc2VBY2NvdW50SWRBcmcoZGVzdGluYXRpb24pO1xuICAgICAgaWYgKGRlc3RJbmZvLm5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IChkZXN0SW5mby5yZWZlcmVuY2UgPT09IHNldHRsZW1lbnRBZGRyZXNzLmNoYWluSWQgPyAoXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgcG9vbEFjY291bnQuc2VuZChkZXN0aW5hdGlvbiwgYW1vdW50KVxuICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgcG9vbEFjY291bnQudHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwge1xuICAgICAgICAgICAgICBmb3J3YXJkT3B0czoge1xuICAgICAgICAgICAgICAgIGludGVybWVkaWF0ZVJlY2lwaWVudFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICkpO1xuICAgICAgICAgIGxvZyhcIkFkdmFuY2Ugc3VjY2VlZGVkXCIsIHsgYWR2YW5jZUFtb3VudCwgZGVzdGluYXRpb24gfSk7XG4gICAgICAgICAgbm90aWZpZXIubm90aWZ5QWR2YW5jaW5nUmVzdWx0KGRldGFpbCwgdHJ1ZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgYXdhaXQgdHJhbnNmZXJSZWplY3RlZChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydHNDY3RwKGRlc3RpbmF0aW9uKSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHBvb2xBY2NvdW50LnRyYW5zZmVyKGludGVybWVkaWF0ZVJlY2lwaWVudCwgYW1vdW50KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gdHJhbnNmZXJSZWplY3RlZChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW50ZXJtZWRpYXJ5QWNjb3VudCA9IGdldE5vYmxlSUNBKCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgaW50ZXJtZWRpYXJ5QWNjb3VudC5kZXBvc2l0Rm9yQnVybihkZXN0aW5hdGlvbiwgYW1vdW50KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gY2N0cEZyb21Ob2JsZVJlamVjdGVkKGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICBsb2coXCJBZHZhbmNlIHN1Y2NlZWRlZFwiLCB7IGFkdmFuY2VBbW91bnQsIGRlc3RpbmF0aW9uIH0pO1xuICAgICAgICBub3RpZmllci5ub3RpZnlBZHZhbmNpbmdSZXN1bHQoZGV0YWlsLCB0cnVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93UmVkYWN0ZWRg8J+aqCBjYW4gb25seSB0cmFuc2ZlciB0byBBZ29yaWMgYWRkcmVzc2VzLCB2aWEgSUJDLCBvciB2aWEgQ0NUUGA7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGRlcG9zaXRSZWplY3RlZChlcnJvcik7XG4gICAgfVxuICAgIGFzeW5jIGZ1bmN0aW9uIHJlcGF5UG9vbCgpIHtcbiAgICAgIGNvbnN0IHRtcFJldHVyblNlYXQgPSB6Y2ZUb29scy5tYWtlRW1wdHlaQ0ZTZWF0KCk7XG4gICAgICBhd2FpdCBudWxsO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgd2l0aGRyYXdUb1NlYXQoXG4gICAgICAgICAgcG9vbEFjY291bnQsXG4gICAgICAgICAgdG1wUmV0dXJuU2VhdCxcbiAgICAgICAgICBoYXJkZW4oeyBVU0RDOiBhZHZhbmNlQW1vdW50IH0pXG4gICAgICAgICk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYm9ycm93ZXIucmV0dXJuVG9Qb29sKHRtcFJldHVyblNlYXQsIGFkdmFuY2VBbW91bnQpO1xuICAgICAgICB9IGNhdGNoIChlMikge1xuICAgICAgICAgIGxvZyhcbiAgICAgICAgICAgIGBcXHV7MUY2QTh9IHJldHVybiAke3F1b3RlKGFkdmFuY2VBbW91bnQpfSB0byBwb29sIGZhaWxlZC4gZnVuZHMgcmVtYWluIG9uIFwidG1wUmV0dXJuU2VhdFwiYCxcbiAgICAgICAgICAgIGUyXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgd2l0aGRyYXdSZWplY3RlZChlcnJvciwgdG1wUmV0dXJuU2VhdCk7XG4gICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGZ1bmN0aW9uIHRyYW5zZmVyUmVqZWN0ZWQocmVhc29uKSB7XG4gICAgICBsb2coXCJBZHZhbmNlIGZhaWxlZFwiLCByZWFzb24pO1xuICAgICAgbm90aWZpZXIubm90aWZ5QWR2YW5jaW5nUmVzdWx0KGRldGFpbCwgZmFsc2UpO1xuICAgICAgcmV0dXJuIHJlcGF5UG9vbCgpO1xuICAgIH1cbiAgICBhc3luYyBmdW5jdGlvbiBjY3RwRnJvbU5vYmxlUmVqZWN0ZWQocmVhc29uKSB7XG4gICAgICBsb2coXCJcXHUyNkEwXFx1RkUwRiBDQ1RQIHRyYW5zZmVyIGZhaWxlZFwiLCByZWFzb24pO1xuICAgICAgbm90aWZpZXIubm90aWZ5QWR2YW5jaW5nUmVzdWx0KGRldGFpbCwgZmFsc2UpO1xuICAgICAgYXdhaXQgbnVsbDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGdldE5vYmxlSUNBKCkudHJhbnNmZXIocG9vbEFjY291bnQuZ2V0QWRkcmVzcygpLCBhbW91bnQpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nKFwiXFx1ezFGNkE4fSBmYWlsZWQgdG8gdHJhbnNmZXIgYmFjayBmcm9tIG5vYmxlIElDQVwiLCBhbW91bnQudmFsdWUsIGVycm9yKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXBheVBvb2woKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nKFwiQWR2YW5jZXIgZXJyb3I6XCIsIGVycm9yKTtcbiAgICBzdGF0dXNNYW5hZ2VyLnNraXBBZHZhbmNlKGV2aWRlbmNlLCBbZXJyb3IubWVzc2FnZV0pO1xuICB9XG59O1xuaGFyZGVuKGFkdmFuY2VGdW5kcyk7XG5cbi8vXG52YXIgQWR2YW5jZXJWb3dDdHhTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBmdWxsQW1vdW50OiBBbnlOYXRBbW91bnRTaGFwZSxcbiAgICBhZHZhbmNlQW1vdW50OiBBbnlOYXRBbW91bnRTaGFwZSxcbiAgICBkZXN0aW5hdGlvbjogQWNjb3VudElkQXJnU2hhcGUsXG4gICAgLy9cbiAgICBmb3J3YXJkaW5nQWRkcmVzczogTS5zdHJpbmcoKSxcbiAgICB0eEhhc2g6IEV2bUhhc2hTaGFwZVxuICB9LFxuICB7IHRtcFNlYXQ6IE0ucmVtb3RhYmxlKCkgfVxuKTtcbnZhciBBZHZhbmNlcktpdEkgPSBoYXJkZW4oe1xuICBhZHZhbmNlcjogTS5pbnRlcmZhY2UoXCJBZHZhbmNlcklcIiwge1xuICAgIGhhbmRsZVRyYW5zYWN0aW9uRXZlbnQ6IE0uY2FsbChFdmlkZW5jZVdpdGhSaXNrU2hhcGUpLnJldHVybnMoKVxuICB9KSxcbiAgZGVwb3NpdEhhbmRsZXI6IE0uaW50ZXJmYWNlKFwiRGVwb3NpdEhhbmRsZXJJXCIsIHtcbiAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0udW5kZWZpbmVkKCksIEFkdmFuY2VyVm93Q3R4U2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIEFkdmFuY2VyVm93Q3R4U2hhcGUpLnJldHVybnMoKVxuICB9KSxcbiAgdHJhbnNmZXJIYW5kbGVyOiBNLmludGVyZmFjZShcIlRyYW5zZmVySGFuZGxlcklcIiwge1xuICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS51bmRlZmluZWQoKSwgQWR2YW5jZXJWb3dDdHhTaGFwZSkucmV0dXJucyhcbiAgICAgIE0udW5kZWZpbmVkKClcbiAgICApLFxuICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIEFkdmFuY2VyVm93Q3R4U2hhcGUpLnJldHVybnMoTS51bmRlZmluZWQoKSlcbiAgfSksXG4gIHRyYW5zZmVyQ2N0cEhhbmRsZXI6IE0uaW50ZXJmYWNlKFwiVHJhbnNmZXJIYW5kbGVySVwiLCB7XG4gICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnVuZGVmaW5lZCgpLCBBZHZhbmNlclZvd0N0eFNoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5lcnJvcigpLCBBZHZhbmNlclZvd0N0eFNoYXBlKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpXG4gIH0pLFxuICB3aXRoZHJhd0hhbmRsZXI6IE0uaW50ZXJmYWNlKFwiV2l0aGRyYXdIYW5kbGVySVwiLCB7XG4gICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnVuZGVmaW5lZCgpLCB7XG4gICAgICBhZHZhbmNlQW1vdW50OiBBbnlOYXRBbW91bnRTaGFwZSxcbiAgICAgIHRtcFJldHVyblNlYXQ6IE0ucmVtb3RhYmxlKClcbiAgICB9KS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpLFxuICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIHtcbiAgICAgIGFkdmFuY2VBbW91bnQ6IEFueU5hdEFtb3VudFNoYXBlLFxuICAgICAgdG1wUmV0dXJuU2VhdDogTS5yZW1vdGFibGUoKVxuICAgIH0pLnJldHVybnMoTS51bmRlZmluZWQoKSlcbiAgfSlcbn0pO1xudmFyIHN0YXRlU2hhcGUgPSBoYXJkZW4oe1xuICBub3RpZmllcjogTS5yZW1vdGFibGUoKSxcbiAgYm9ycm93ZXI6IE0ucmVtb3RhYmxlKCksXG4gIHBvb2xBY2NvdW50OiBNLnJlbW90YWJsZSgpLFxuICAvKiAgICAgICAgICAgICAgKi9cbiAgaW50ZXJtZWRpYXRlUmVjaXBpZW50OiBNLm9wdChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSksXG4gIHNldHRsZW1lbnRBZGRyZXNzOiBNLm9wdChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSlcbn0pO1xudmFyIHByZXBhcmVBZHZhbmNlcktpdCA9ICh6b25lLCB7XG4gIGFkdmFuY2VGdW5kczogYWR2YW5jZUZ1bmRzMixcbiAgY2hhaW5IdWIsXG4gIGdldE5vYmxlSUNBLFxuICBsb2cgPSBtYWtlVHJhY2VyKFwiQWR2YW5jZXJcIiwgdHJ1ZSksXG4gIHN0YXR1c01hbmFnZXIsXG4gIHVzZGMsXG4gIHZvd1Rvb2xzOiB7IGFzVm93LCB3YXRjaCB9LFxuICB6Y2YsXG4gIHpvZVRvb2xzOiB7IHdpdGhkcmF3VG9TZWF0IH1cbn0pID0+IHtcbiAgYXNzZXJ0QWxsRGVmaW5lZCh7XG4gICAgY2hhaW5IdWIsXG4gICAgc3RhdHVzTWFuYWdlcixcbiAgICB3YXRjaFxuICB9KTtcbiAgY29uc3Qgc3VwcG9ydHNDY3RwID0gbWFrZVN1cHBvcnRzQ2N0cChjaGFpbkh1Yik7XG4gIHJldHVybiB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiRmFzdCBVU0RDIEFkdmFuY2VyXCIsXG4gICAgQWR2YW5jZXJLaXRJLFxuICAgIChjb25maWcpID0+IGhhcmRlbih7XG4gICAgICAuLi5jb25maWcsXG4gICAgICAvL1xuICAgICAgaW50ZXJtZWRpYXRlUmVjaXBpZW50OiB2b2lkIDBcbiAgICB9KSxcbiAgICB7XG4gICAgICBhZHZhbmNlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGhhbmRsZVRyYW5zYWN0aW9uRXZlbnQoeyBldmlkZW5jZSwgcmlzayB9KSB7XG4gICAgICAgICAgY29uc3QgeyBub3RpZmllciwgYm9ycm93ZXIsIHBvb2xBY2NvdW50LCBzZXR0bGVtZW50QWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB2b2lkIGFkdmFuY2VGdW5kczIoXG4gICAgICAgICAgICBoYXJkZW4oeyBldmlkZW5jZSwgcmlzayB9KSxcbiAgICAgICAgICAgIGhhcmRlbih7XG4gICAgICAgICAgICAgIG5vdGlmaWVyLFxuICAgICAgICAgICAgICBib3Jyb3dlcixcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgcG9vbEFjY291bnQsXG4gICAgICAgICAgICAgIHNldHRsZW1lbnRBZGRyZXNzXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICBkZXBvc2l0SGFuZGxlcjoge1xuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0LCBjdHgpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBwb29sQWNjb3VudCwgc2V0dGxlbWVudEFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IHRtcFNlYXQsIC4uLnZvd0NvbnRleHQgfSA9IGN0eDtcbiAgICAgICAgICAgIGNvbnN0IHsgYWR2YW5jZUFtb3VudCB9ID0gdm93Q29udGV4dDtcbiAgICAgICAgICAgIHRtcFNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgY29uc3QgYW1vdW50ID0gaGFyZGVuKHtcbiAgICAgICAgICAgICAgZGVub206IHVzZGMuZGVub20sXG4gICAgICAgICAgICAgIHZhbHVlOiBhZHZhbmNlQW1vdW50LnZhbHVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gY29lcmNlQWNjb3VudElkKHZvd0NvbnRleHQuZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgY29uc3QgaW50ZXJtZWRpYXRlUmVjaXBpZW50ID0gZ2V0Tm9ibGVJQ0EoKS5nZXRBZGRyZXNzKCk7XG4gICAgICAgICAgICBjb25zdCBkZXN0SW5mbyA9IHBhcnNlQWNjb3VudElkQXJnKGRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIGlmIChkZXN0SW5mby5uYW1lc3BhY2UgPT09IFwiY29zbW9zXCIpIHtcbiAgICAgICAgICAgICAgY29uc3Qgdm93ID0gZGVzdEluZm8ucmVmZXJlbmNlID09PSBzZXR0bGVtZW50QWRkcmVzcy5jaGFpbklkID8gKFxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgRShwb29sQWNjb3VudCkuc2VuZChkZXN0aW5hdGlvbiwgYW1vdW50KVxuICAgICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgRShwb29sQWNjb3VudCkudHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwge1xuICAgICAgICAgICAgICAgICAgZm9yd2FyZE9wdHM6IHtcbiAgICAgICAgICAgICAgICAgICAgaW50ZXJtZWRpYXRlUmVjaXBpZW50XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHZvdywgdGhpcy5mYWNldHMudHJhbnNmZXJIYW5kbGVyLCB2b3dDb250ZXh0KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydHNDY3RwKGRlc3RpbmF0aW9uKSkge1xuICAgICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgICAgRShwb29sQWNjb3VudCkudHJhbnNmZXIoaW50ZXJtZWRpYXRlUmVjaXBpZW50LCBhbW91bnQpLFxuICAgICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnRyYW5zZmVyQ2N0cEhhbmRsZXIsXG4gICAgICAgICAgICAgICAgdm93Q29udGV4dFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhyb3dSZWRhY3RlZGDwn5qoIGNhbiBvbmx5IHRyYW5zZmVyIHRvIEFnb3JpYyBhZGRyZXNzZXMsIHZpYSBJQkMsIG9yIHZpYSBDQ1RQYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25SZWplY3RlZChlcnJvciwge1xuICAgICAgICAgIHRtcFNlYXQsXG4gICAgICAgICAgYWR2YW5jZUFtb3VudCxcbiAgICAgICAgICAuLi5yZXN0Q3R4XG4gICAgICAgIH0pIHtcbiAgICAgICAgICBsb2coXG4gICAgICAgICAgICBcIlxcdTI2QTBcXHVGRTBGIGRlcG9zaXQgdG8gbG9jYWxPcmNoQWNjb3VudCBmYWlsZWQsIGF0dGVtcHRpbmcgdG8gcmV0dXJuIHBheW1lbnQgdG8gTFBcIixcbiAgICAgICAgICAgIGVycm9yXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgeyBib3Jyb3dlciwgbm90aWZpZXIgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBub3RpZmllci5ub3RpZnlBZHZhbmNpbmdSZXN1bHQocmVzdEN0eCwgZmFsc2UpO1xuICAgICAgICAgICAgYm9ycm93ZXIucmV0dXJuVG9Qb29sKHRtcFNlYXQsIGFkdmFuY2VBbW91bnQpO1xuICAgICAgICAgICAgdG1wU2VhdC5leGl0KCk7XG4gICAgICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgICAgIGxvZyhcIlxcdXsxRjZBOH0gZGVwb3NpdCB0byBsb2NhbE9yY2hBY2NvdW50IGZhaWx1cmUgcmVjb3ZlcnkgZmFpbGVkXCIsIGUyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0cmFuc2ZlckhhbmRsZXI6IHtcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCwgY3R4KSB7XG4gICAgICAgICAgY29uc3QgeyBub3RpZmllciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IGFkdmFuY2VBbW91bnQsIGRlc3RpbmF0aW9uLCAuLi5kZXRhaWwgfSA9IGN0eDtcbiAgICAgICAgICBsb2coXCJBZHZhbmNlIHN1Y2NlZWRlZFwiLCB7IGFkdmFuY2VBbW91bnQsIGRlc3RpbmF0aW9uIH0pO1xuICAgICAgICAgIG5vdGlmaWVyLm5vdGlmeUFkdmFuY2luZ1Jlc3VsdCh7IGRlc3RpbmF0aW9uLCAuLi5kZXRhaWwgfSwgdHJ1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQoZXJyb3IsIGN0eCkge1xuICAgICAgICAgIGNvbnN0IHsgbm90aWZpZXIsIHBvb2xBY2NvdW50IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGxvZyhcIkFkdmFuY2UgZmFpbGVkXCIsIGVycm9yKTtcbiAgICAgICAgICBjb25zdCB7IGFkdmFuY2VBbW91bnQsIC4uLnJlc3RDdHggfSA9IGN0eDtcbiAgICAgICAgICBub3RpZmllci5ub3RpZnlBZHZhbmNpbmdSZXN1bHQocmVzdEN0eCwgZmFsc2UpO1xuICAgICAgICAgIGNvbnN0IHsgemNmU2VhdDogdG1wUmV0dXJuU2VhdCB9ID0gemNmLm1ha2VFbXB0eVNlYXRLaXQoKTtcbiAgICAgICAgICBjb25zdCB3aXRoZHJhd1YgPSB3aXRoZHJhd1RvU2VhdChcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBwb29sQWNjb3VudCxcbiAgICAgICAgICAgIHRtcFJldHVyblNlYXQsXG4gICAgICAgICAgICBoYXJkZW4oeyBVU0RDOiBhZHZhbmNlQW1vdW50IH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgICB2b2lkIHdhdGNoKHdpdGhkcmF3ViwgdGhpcy5mYWNldHMud2l0aGRyYXdIYW5kbGVyLCB7XG4gICAgICAgICAgICBhZHZhbmNlQW1vdW50LFxuICAgICAgICAgICAgdG1wUmV0dXJuU2VhdFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdHJhbnNmZXJDY3RwSGFuZGxlcjoge1xuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0LCBjdHgpIHtcbiAgICAgICAgICBjb25zdCB7IGFkdmFuY2VBbW91bnQgfSA9IGN0eDtcbiAgICAgICAgICBjb25zdCBpbnRlcm1lZGlhcnlBY2NvdW50ID0gZ2V0Tm9ibGVJQ0EoKTtcbiAgICAgICAgICBjb25zdCBhbW91bnQgPSBoYXJkZW4oe1xuICAgICAgICAgICAgZGVub206IHVzZGMuZGVub20sXG4gICAgICAgICAgICB2YWx1ZTogYWR2YW5jZUFtb3VudC52YWx1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gY29lcmNlQWNjb3VudElkKGN0eC5kZXN0aW5hdGlvbik7XG4gICAgICAgICAgY29uc3QgYnVybiA9IGludGVybWVkaWFyeUFjY291bnQuZGVwb3NpdEZvckJ1cm4oZGVzdGluYXRpb24sIGFtb3VudCk7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKGJ1cm4sIHRoaXMuZmFjZXRzLnRyYW5zZmVySGFuZGxlciwgY3R4KTtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZWplY3RlZChlcnJvciwgX2N0eCkge1xuICAgICAgICAgIGxvZyhcIlxcdXsxRjZBOH0gQ0NUUCB0cmFuc2ZlciBmYWlsZWRcIiwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2l0aGRyYXdIYW5kbGVyOiB7XG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0LCB7XG4gICAgICAgICAgYWR2YW5jZUFtb3VudCxcbiAgICAgICAgICB0bXBSZXR1cm5TZWF0XG4gICAgICAgIH0pIHtcbiAgICAgICAgICBjb25zdCB7IGJvcnJvd2VyIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBib3Jyb3dlci5yZXR1cm5Ub1Bvb2wodG1wUmV0dXJuU2VhdCwgYWR2YW5jZUFtb3VudCk7XG4gICAgICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgICAgIGxvZyhcbiAgICAgICAgICAgICAgYFxcdXsxRjZBOH0gcmV0dXJuICR7cXVvdGUoYWR2YW5jZUFtb3VudCl9IHRvIHBvb2wgZmFpbGVkLiBmdW5kcyByZW1haW4gb24gXCJ0bXBSZXR1cm5TZWF0XCJgLFxuICAgICAgICAgICAgICBlMlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uUmVqZWN0ZWQoZXJyb3IsIHtcbiAgICAgICAgICBhZHZhbmNlQW1vdW50LFxuICAgICAgICAgIHRtcFJldHVyblNlYXRcbiAgICAgICAgfSkge1xuICAgICAgICAgIGxvZyhcbiAgICAgICAgICAgIGBcXHV7MUY2QTh9IHdpdGhkcmF3ICR7cXVvdGUoYWR2YW5jZUFtb3VudCl9IGZyb20gXCJwb29sQWNjb3VudFwiIHRvIHJldHVybiB0byBwb29sIGZhaWxlZGAsXG4gICAgICAgICAgICBlcnJvclxuICAgICAgICAgICk7XG4gICAgICAgICAgdG1wUmV0dXJuU2VhdC5leGl0KCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgfSxcbiAgICB7XG4gICAgICBzdGF0ZVNoYXBlXG4gICAgfVxuICApO1xufTtcbmhhcmRlbihwcmVwYXJlQWR2YW5jZXJLaXQpO1xudmFyIHByZXBhcmVBZHZhbmNlciA9ICh6b25lLCBjYXBzKSA9PiB7XG4gIGNvbnN0IG1ha2VBZHZhbmNlcktpdCA9IHByZXBhcmVBZHZhbmNlcktpdCh6b25lLCBjYXBzKTtcbiAgcmV0dXJuIHBpY2tGYWNldChtYWtlQWR2YW5jZXJLaXQsIFwiYWR2YW5jZXJcIik7XG59O1xuaGFyZGVuKHByZXBhcmVBZHZhbmNlcik7XG5cbi8vXG52YXIgeyBrZXlzOiBrZXlzMyB9ID0gT2JqZWN0O1xudmFyIHsgYWRkOiBhZGQ0LCBpc0VtcHR5LCBpc0VxdWFsLCBpc0dURTogaXNHVEUzLCBtYWtlLCBtYWtlRW1wdHk6IG1ha2VFbXB0eTIsIHN1YnRyYWN0OiBzdWJ0cmFjdDQgfSA9IEFtb3VudE1hdGg7XG52YXIgbWFrZVBhcml0eSA9IChudW1lcmF0b3JCcmFuZCwgZGVub21pbmF0b3JCcmFuZCkgPT4ge1xuICBjb25zdCBkdXN0ID0gMW47XG4gIHJldHVybiBtYWtlUmF0aW8oZHVzdCwgbnVtZXJhdG9yQnJhbmQsIGR1c3QsIGRlbm9taW5hdG9yQnJhbmQpO1xufTtcbnZhciBkZXBvc2l0Q2FsYyA9IChzaGFyZVdvcnRoLCB7IGdpdmUsIHdhbnQgfSkgPT4ge1xuICBhc3NlcnQoIWlzRW1wdHkoZ2l2ZS5VU0RDKSk7XG4gIGNvbnN0IHsgZGVub21pbmF0b3I6IHNoYXJlc091dHN0YW5kaW5nLCBudW1lcmF0b3I6IHBvb2xCYWxhbmNlIH0gPSBzaGFyZVdvcnRoO1xuICBjb25zdCBmYWlyUG9vbFNoYXJlID0gZGl2aWRlQnkoZ2l2ZS5VU0RDLCBzaGFyZVdvcnRoKTtcbiAgaWYgKHdhbnQ/LlBvb2xTaGFyZSkge1xuICAgIGlzR1RFMyhmYWlyUG9vbFNoYXJlLCB3YW50LlBvb2xTaGFyZSkgfHwgdGhyb3dSZWRhY3RlZGBkZXBvc2l0IGNhbm5vdCBwYXkgb3V0ICR7cXVvdGUod2FudC5Qb29sU2hhcmUpfTsgJHtxdW90ZShnaXZlLlVTREMpfSBvbmx5IGdldHMgJHtxdW90ZShmYWlyUG9vbFNoYXJlKX1gO1xuICB9XG4gIGNvbnN0IG91dHN0YW5kaW5nUG9zdCA9IGFkZDQoc2hhcmVzT3V0c3RhbmRpbmcsIGZhaXJQb29sU2hhcmUpO1xuICBjb25zdCBiYWxhbmNlUG9zdCA9IGFkZDQocG9vbEJhbGFuY2UsIGdpdmUuVVNEQyk7XG4gIGNvbnN0IHdvcnRoUG9zdCA9IG1ha2VSYXRpb0Zyb21BbW91bnRzKGJhbGFuY2VQb3N0LCBvdXRzdGFuZGluZ1Bvc3QpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBwYXlvdXRzOiB7IFBvb2xTaGFyZTogZmFpclBvb2xTaGFyZSB9LFxuICAgIHNoYXJlV29ydGg6IHdvcnRoUG9zdFxuICB9KTtcbn07XG52YXIgY2hlY2tQb29sQmFsYW5jZSA9IChwb29sQWxsb2MsIHNoYXJlV29ydGgsIGVuY3VtYmVyZWRCYWxhbmNlKSA9PiB7XG4gIGNvbnN0IHsgYnJhbmQ6IHVzZGNCcmFuZCB9ID0gZW5jdW1iZXJlZEJhbGFuY2U7XG4gIGNvbnN0IHVuZW5jdW1iZXJlZEJhbGFuY2UgPSBwb29sQWxsb2MuVVNEQyB8fCBtYWtlRW1wdHkyKHVzZGNCcmFuZCk7XG4gIGNvbnN0IGt3ZHMgPSBrZXlzMyhwb29sQWxsb2MpO1xuICBrd2RzLmxlbmd0aCA9PT0gMCB8fCBrd2RzLmxlbmd0aCA9PT0gMSAmJiBrd2RzWzBdID09PSBcIlVTRENcIiB8fCB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgcG9vbCBhbGxvY2F0aW9uczogJHtwb29sQWxsb2N9YDtcbiAgY29uc3QgZHVzdCA9IG1ha2UodXNkY0JyYW5kLCAxbik7XG4gIGNvbnN0IGdyb3NzQmFsYW5jZSA9IGFkZDQoYWRkNCh1bmVuY3VtYmVyZWRCYWxhbmNlLCBkdXN0KSwgZW5jdW1iZXJlZEJhbGFuY2UpO1xuICBpc0VxdWFsKGdyb3NzQmFsYW5jZSwgc2hhcmVXb3J0aC5udW1lcmF0b3IpIHx8IHRocm93UmVkYWN0ZWRg8J+aqCBwb29sIGJhbGFuY2UgJHtxdW90ZSh1bmVuY3VtYmVyZWRCYWxhbmNlKX0gYW5kIGVuY3VtYmVyZWQgYmFsYW5jZSAke3F1b3RlKGVuY3VtYmVyZWRCYWxhbmNlKX0gaW5jb25zaXN0ZW50IHdpdGggc2hhcmVXb3J0aCAke3F1b3RlKHNoYXJlV29ydGgpfWA7XG4gIHJldHVybiBoYXJkZW4oeyB1bmVuY3VtYmVyZWRCYWxhbmNlLCBncm9zc0JhbGFuY2UgfSk7XG59O1xudmFyIHdpdGhkcmF3Q2FsYyA9IChzaGFyZVdvcnRoLCB7IGdpdmUsIHdhbnQgfSwgcG9vbEFsbG9jLCBlbmN1bWJlcmVkQmFsYW5jZSA9IG1ha2VFbXB0eTIoc2hhcmVXb3J0aC5udW1lcmF0b3IuYnJhbmQpKSA9PiB7XG4gIGNvbnN0IHsgdW5lbmN1bWJlcmVkQmFsYW5jZSB9ID0gY2hlY2tQb29sQmFsYW5jZShcbiAgICBwb29sQWxsb2MsXG4gICAgc2hhcmVXb3J0aCxcbiAgICBlbmN1bWJlcmVkQmFsYW5jZVxuICApO1xuICBhc3NlcnQoIWlzRW1wdHkoZ2l2ZS5Qb29sU2hhcmUpKTtcbiAgYXNzZXJ0KCFpc0VtcHR5KHdhbnQuVVNEQykpO1xuICBjb25zdCBwYXlvdXQgPSBtdWx0aXBseUJ5KGdpdmUuUG9vbFNoYXJlLCBzaGFyZVdvcnRoKTtcbiAgaXNHVEUzKHBheW91dCwgd2FudC5VU0RDKSB8fCB0aHJvd1JlZGFjdGVkYGNhbm5vdCB3aXRoZHJhdyAke3F1b3RlKHdhbnQuVVNEQyl9OyAke3F1b3RlKGdpdmUuUG9vbFNoYXJlKX0gb25seSB3b3J0aCAke3F1b3RlKHBheW91dCl9YDtcbiAgY29uc3QgeyBkZW5vbWluYXRvcjogc2hhcmVzT3V0c3RhbmRpbmcsIG51bWVyYXRvcjogcG9vbEJhbGFuY2UgfSA9IHNoYXJlV29ydGg7XG4gICFpc0dURTMod2FudC5VU0RDLCBwb29sQmFsYW5jZSkgfHwgdGhyb3dSZWRhY3RlZGBjYW5ub3Qgd2l0aGRyYXcgJHtxdW90ZSh3YW50LlVTREMpfTsgb25seSAke3F1b3RlKHBvb2xCYWxhbmNlKX0gaW4gcG9vbGA7XG4gIGlzR1RFMyh1bmVuY3VtYmVyZWRCYWxhbmNlLCB3YW50LlVTREMpIHx8IHRocm93UmVkYWN0ZWRgY2Fubm90IHdpdGhkcmF3ICR7cXVvdGUod2FudC5VU0RDKX07ICR7cXVvdGUoZW5jdW1iZXJlZEJhbGFuY2UpfSBpcyBpbiB1c2U7IHN0YW5kIGJ5IGZvciBwb29sIHRvIHJldHVybiB0byAke3F1b3RlKHBvb2xCYWxhbmNlKX1gO1xuICBjb25zdCBiYWxhbmNlUG9zdCA9IHN1YnRyYWN0NChwb29sQmFsYW5jZSwgcGF5b3V0KTtcbiAgY29uc3Qgb3V0c3RhbmRpbmdQb3N0ID0gc3VidHJhY3Q0KHNoYXJlc091dHN0YW5kaW5nLCBnaXZlLlBvb2xTaGFyZSk7XG4gIGNvbnN0IHdvcnRoUG9zdCA9IG1ha2VSYXRpb0Zyb21BbW91bnRzKGJhbGFuY2VQb3N0LCBvdXRzdGFuZGluZ1Bvc3QpO1xuICByZXR1cm4gaGFyZGVuKHsgc2hhcmVXb3J0aDogd29ydGhQb3N0LCBwYXlvdXRzOiB7IFVTREM6IHBheW91dCB9IH0pO1xufTtcbnZhciB3aXRoRmVlcyA9IChzaGFyZVdvcnRoLCBmZWVzKSA9PiB7XG4gIGNvbnN0IGJhbGFuY2VQb3N0ID0gYWRkNChzaGFyZVdvcnRoLm51bWVyYXRvciwgZmVlcyk7XG4gIHJldHVybiBtYWtlUmF0aW9Gcm9tQW1vdW50cyhiYWxhbmNlUG9zdCwgc2hhcmVXb3J0aC5kZW5vbWluYXRvcik7XG59O1xudmFyIGJvcnJvd0NhbGMgPSAocmVxdWVzdGVkLCBwb29sU2VhdEFsbG9jYXRpb24sIGVuY3VtYmVyZWRCYWxhbmNlLCBwb29sU3RhdHMpID0+IHtcbiAgIWlzR1RFMyhyZXF1ZXN0ZWQsIHBvb2xTZWF0QWxsb2NhdGlvbikgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgYm9ycm93LiBSZXF1ZXN0ZWQgJHtxdW90ZShyZXF1ZXN0ZWQpfSBtdXN0IGJlIGxlc3MgdGhhbiBwb29sIGJhbGFuY2UgJHtxdW90ZShwb29sU2VhdEFsbG9jYXRpb24pfS5gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBlbmN1bWJlcmVkQmFsYW5jZTogYWRkNChlbmN1bWJlcmVkQmFsYW5jZSwgcmVxdWVzdGVkKSxcbiAgICBwb29sU3RhdHM6IHtcbiAgICAgIC4uLnBvb2xTdGF0cyxcbiAgICAgIHRvdGFsQm9ycm93czogYWRkNChwb29sU3RhdHMudG90YWxCb3Jyb3dzLCByZXF1ZXN0ZWQpXG4gICAgfVxuICB9KTtcbn07XG52YXIgcmVwYXlDYWxjID0gKHNoYXJlV29ydGgsIHNwbGl0LCBlbmN1bWJlcmVkQmFsYW5jZSwgcG9vbFN0YXRzKSA9PiB7XG4gIGlzR1RFMyhlbmN1bWJlcmVkQmFsYW5jZSwgc3BsaXQuUHJpbmNpcGFsKSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCByZXBheS4gUHJpbmNpcGFsICR7cXVvdGUoc3BsaXQuUHJpbmNpcGFsKX0gZXhjZWVkcyBlbmN1bWJlcmVkQmFsYW5jZSAke3F1b3RlKGVuY3VtYmVyZWRCYWxhbmNlKX0uYDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgc2hhcmVXb3J0aDogd2l0aEZlZXMoc2hhcmVXb3J0aCwgc3BsaXQuUG9vbEZlZSksXG4gICAgZW5jdW1iZXJlZEJhbGFuY2U6IHN1YnRyYWN0NChlbmN1bWJlcmVkQmFsYW5jZSwgc3BsaXQuUHJpbmNpcGFsKSxcbiAgICBwb29sU3RhdHM6IHtcbiAgICAgIC4uLnBvb2xTdGF0cyxcbiAgICAgIHRvdGFsUmVwYXlzOiBhZGQ0KHBvb2xTdGF0cy50b3RhbFJlcGF5cywgc3BsaXQuUHJpbmNpcGFsKSxcbiAgICAgIHRvdGFsUG9vbEZlZXM6IGFkZDQocG9vbFN0YXRzLnRvdGFsUG9vbEZlZXMsIHNwbGl0LlBvb2xGZWUpLFxuICAgICAgdG90YWxDb250cmFjdEZlZXM6IGFkZDQoXG4gICAgICAgIGFkZDQocG9vbFN0YXRzLnRvdGFsQ29udHJhY3RGZWVzLCBzcGxpdC5Db250cmFjdEZlZSksXG4gICAgICAgIHNwbGl0LlJlbGF5RmVlXG4gICAgICApXG4gICAgfVxuICB9KTtcbn07XG5cbi8vXG52YXIgeyBhZGQ6IGFkZDUsIGlzR1RFOiBpc0dURTQsIG1ha2VFbXB0eTogbWFrZUVtcHR5MyB9ID0gQW1vdW50TWF0aDtcbnZhciBzdGF0ZVNoYXBlMiA9IGhhcmRlbih7XG4gIGVuY3VtYmVyZWRCYWxhbmNlOiBBbW91bnRTaGFwZSxcbiAgZmVlU2VhdDogTS5yZW1vdGFibGUoKSxcbiAgcG9vbFN0YXRzOiBNLnJlY29yZCgpLFxuICBwb29sTWV0cmljc1JlY29yZGVyS2l0OiBSZWNvcmRlcktpdFNoYXBlLFxuICBwb29sU2VhdDogTS5yZW1vdGFibGUoKSxcbiAgUG9vbFNoYXJlczogTS5yZW1vdGFibGUoKSxcbiAgcHJvcG9zYWxTaGFwZXM6IHtcbiAgICBkZXBvc2l0OiBNLnBhdHRlcm4oKSxcbiAgICB3aXRoZHJhdzogTS5wYXR0ZXJuKCksXG4gICAgd2l0aGRyYXdGZWVzOiBNLnBhdHRlcm4oKVxuICB9LFxuICBzaGFyZU1pbnQ6IE0ucmVtb3RhYmxlKCksXG4gIHNoYXJlV29ydGg6IFJhdGlvU2hhcGVcbn0pO1xudmFyIHByZXBhcmVMaXF1aWRpdHlQb29sS2l0ID0gKHpvbmUsIHpjZiwgVVNEQywgdG9vbHMpID0+IHtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJMaXF1aWRpdHkgUG9vbFwiLFxuICAgIHtcbiAgICAgIGJvcnJvd2VyOiBNLmludGVyZmFjZShcImJvcnJvd2VyXCIsIHtcbiAgICAgICAgYm9ycm93OiBNLmNhbGwoU2VhdFNoYXBlLCBtYWtlTmF0QW1vdW50U2hhcGUoVVNEQywgMW4pKS5yZXR1cm5zKCksXG4gICAgICAgIHJldHVyblRvUG9vbDogTS5jYWxsKFNlYXRTaGFwZSwgbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDFuKSkucmV0dXJucygpXG4gICAgICB9KSxcbiAgICAgIHJlcGF5ZXI6IE0uaW50ZXJmYWNlKFwicmVwYXllclwiLCB7XG4gICAgICAgIHJlcGF5OiBNLmNhbGwoXG4gICAgICAgICAgVHJhbnNmZXJQYXJ0U2hhcGUsXG4gICAgICAgICAgaGFyZGVuKHtcbiAgICAgICAgICAgIFByaW5jaXBhbDogbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDFuKSxcbiAgICAgICAgICAgIFBvb2xGZWU6IG1ha2VOYXRBbW91bnRTaGFwZShVU0RDLCAwbiksXG4gICAgICAgICAgICBDb250cmFjdEZlZTogbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDBuKSxcbiAgICAgICAgICAgIFJlbGF5RmVlOiBtYWtlTmF0QW1vdW50U2hhcGUoVVNEQywgMG4pXG4gICAgICAgICAgfSlcbiAgICAgICAgKS5yZXR1cm5zKClcbiAgICAgIH0pLFxuICAgICAgZXh0ZXJuYWw6IE0uaW50ZXJmYWNlKFwiZXh0ZXJuYWxcIiwge1xuICAgICAgICBwdWJsaXNoUG9vbE1ldHJpY3M6IE0uY2FsbCgpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICBkZXBvc2l0SGFuZGxlcjogTS5pbnRlcmZhY2UoXCJkZXBvc2l0SGFuZGxlclwiLCB7XG4gICAgICAgIGhhbmRsZTogTS5jYWxsKFNlYXRTaGFwZSwgTS5hbnkoKSkucmV0dXJucygpXG4gICAgICB9KSxcbiAgICAgIHdpdGhkcmF3SGFuZGxlcjogTS5pbnRlcmZhY2UoXCJ3aXRoZHJhd0hhbmRsZXJcIiwge1xuICAgICAgICBoYW5kbGU6IE0uY2FsbChTZWF0U2hhcGUsIE0uYW55KCkpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICB3aXRoZHJhd0ZlZXNIYW5kbGVyOiBNLmludGVyZmFjZShcIndpdGhkcmF3RmVlc0hhbmRsZXJcIiwge1xuICAgICAgICBoYW5kbGU6IE0uY2FsbChTZWF0U2hhcGUsIE0uYW55KCkpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICBwdWJsaWM6IE0uaW50ZXJmYWNlKFwicHVibGljXCIsIHtcbiAgICAgICAgbWFrZURlcG9zaXRJbnZpdGF0aW9uOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgbWFrZVdpdGhkcmF3SW52aXRhdGlvbjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIGdldFB1YmxpY1RvcGljczogTS5jYWxsKCkucmV0dXJucyhUb3BpY3NSZWNvcmRTaGFwZSlcbiAgICAgIH0pLFxuICAgICAgZmVlUmVjaXBpZW50OiBNLmludGVyZmFjZShcImZlZVJlY2lwaWVudFwiLCB7XG4gICAgICAgIGdldENvbnRyYWN0RmVlQmFsYW5jZTogTS5jYWxsKCkucmV0dXJucyhBbW91bnRTaGFwZSksXG4gICAgICAgIG1ha2VXaXRoZHJhd0ZlZXNJbnZpdGF0aW9uOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgICAgfSlcbiAgICB9LFxuICAgIChzaGFyZU1pbnQsIG5vZGUpID0+IHtcbiAgICAgIGNvbnN0IHsgYnJhbmQ6IFBvb2xTaGFyZXMgfSA9IHNoYXJlTWludC5nZXRJc3N1ZXJSZWNvcmQoKTtcbiAgICAgIGNvbnN0IHByb3Bvc2FsU2hhcGVzID0gbWFrZVByb3Bvc2FsU2hhcGVzKHsgVVNEQywgUG9vbFNoYXJlcyB9KTtcbiAgICAgIGNvbnN0IHNoYXJlV29ydGggPSBtYWtlUGFyaXR5KFVTREMsIFBvb2xTaGFyZXMpO1xuICAgICAgY29uc3QgeyB6Y2ZTZWF0OiBwb29sU2VhdCB9ID0gemNmLm1ha2VFbXB0eVNlYXRLaXQoKTtcbiAgICAgIGNvbnN0IHsgemNmU2VhdDogZmVlU2VhdCB9ID0gemNmLm1ha2VFbXB0eVNlYXRLaXQoKTtcbiAgICAgIGNvbnN0IHBvb2xNZXRyaWNzUmVjb3JkZXJLaXQgPSB0b29scy5tYWtlUmVjb3JkZXJLaXQoXG4gICAgICAgIG5vZGUsXG4gICAgICAgIFBvb2xNZXRyaWNzU2hhcGVcbiAgICAgICk7XG4gICAgICBjb25zdCBlbmN1bWJlcmVkQmFsYW5jZSA9IG1ha2VFbXB0eTMoVVNEQyk7XG4gICAgICBjb25zdCBwb29sU3RhdHMgPSBoYXJkZW4oe1xuICAgICAgICB0b3RhbEJvcnJvd3M6IG1ha2VFbXB0eTMoVVNEQyksXG4gICAgICAgIHRvdGFsQ29udHJhY3RGZWVzOiBtYWtlRW1wdHkzKFVTREMpLFxuICAgICAgICB0b3RhbFBvb2xGZWVzOiBtYWtlRW1wdHkzKFVTREMpLFxuICAgICAgICB0b3RhbFJlcGF5czogbWFrZUVtcHR5MyhVU0RDKVxuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBlbmN1bWJlcmVkQmFsYW5jZSxcbiAgICAgICAgZmVlU2VhdCxcbiAgICAgICAgcG9vbFN0YXRzLFxuICAgICAgICBwb29sTWV0cmljc1JlY29yZGVyS2l0LFxuICAgICAgICBwb29sU2VhdCxcbiAgICAgICAgUG9vbFNoYXJlcyxcbiAgICAgICAgcHJvcG9zYWxTaGFwZXMsXG4gICAgICAgIHNoYXJlTWludCxcbiAgICAgICAgc2hhcmVXb3J0aFxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGJvcnJvd2VyOiB7XG4gICAgICAgIGJvcnJvdyh0b1NlYXQsIGFtb3VudCkge1xuICAgICAgICAgIGNvbnN0IHsgZW5jdW1iZXJlZEJhbGFuY2UsIHBvb2xTZWF0LCBwb29sU3RhdHMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgcG9zdCA9IGJvcnJvd0NhbGMoXG4gICAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgICBwb29sU2VhdC5nZXRBbW91bnRBbGxvY2F0ZWQoXCJVU0RDXCIsIFVTREMpLFxuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2UsXG4gICAgICAgICAgICBwb29sU3RhdHNcbiAgICAgICAgICApO1xuICAgICAgICAgIHpjZi5hdG9taWNSZWFycmFuZ2UoaGFyZGVuKFtbcG9vbFNlYXQsIHRvU2VhdCwgeyBVU0RDOiBhbW91bnQgfV1dKSk7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLnN0YXRlLCBwb3N0KTtcbiAgICAgICAgICB0aGlzLmZhY2V0cy5leHRlcm5hbC5wdWJsaXNoUG9vbE1ldHJpY3MoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuVG9Qb29sKGJvcnJvd1NlYXQsIGFtb3VudCkge1xuICAgICAgICAgIGNvbnN0IHJldHVybkFtb3VudHMgPSBoYXJkZW4oe1xuICAgICAgICAgICAgUHJpbmNpcGFsOiBhbW91bnQsXG4gICAgICAgICAgICBQb29sRmVlOiBtYWtlRW1wdHkzKFVTREMpLFxuICAgICAgICAgICAgQ29udHJhY3RGZWU6IG1ha2VFbXB0eTMoVVNEQyksXG4gICAgICAgICAgICBSZWxheUZlZTogbWFrZUVtcHR5MyhVU0RDKVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IGJvcnJvd1NlYXRBbGxvY2F0aW9uID0gYm9ycm93U2VhdC5nZXRDdXJyZW50QWxsb2NhdGlvbigpO1xuICAgICAgICAgIGlzR1RFNChib3Jyb3dTZWF0QWxsb2NhdGlvbi5VU0RDLCBhbW91bnQpIHx8IHRocm93UmVkYWN0ZWRg4pqg77iPIGJvcnJvd1NlYXRBbGxvY2F0aW9uICR7cXVvdGUoYm9ycm93U2VhdEFsbG9jYXRpb24pfSBsZXNzIHRoYW4gYW1vdW50S1dSICR7cXVvdGUoYW1vdW50KX1gO1xuICAgICAgICAgIGNvbnN0IHRyYW5zZmVyU291cmNlUGFydCA9IGZyb21Pbmx5KGJvcnJvd1NlYXQsIHsgVVNEQzogYW1vdW50IH0pO1xuICAgICAgICAgIHRoaXMuZmFjZXRzLnJlcGF5ZXIucmVwYXkodHJhbnNmZXJTb3VyY2VQYXJ0LCByZXR1cm5BbW91bnRzKTtcbiAgICAgICAgICBib3Jyb3dTZWF0LmV4aXQoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlcGF5ZXI6IHtcbiAgICAgICAgcmVwYXkoc291cmNlVHJhbnNmZXIsIHNwbGl0KSB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2UsXG4gICAgICAgICAgICBmZWVTZWF0LFxuICAgICAgICAgICAgcG9vbFNlYXQsXG4gICAgICAgICAgICBwb29sU3RhdHMsXG4gICAgICAgICAgICBzaGFyZVdvcnRoXG4gICAgICAgICAgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY2hlY2tQb29sQmFsYW5jZShcbiAgICAgICAgICAgIHBvb2xTZWF0LmdldEN1cnJlbnRBbGxvY2F0aW9uKCksXG4gICAgICAgICAgICBzaGFyZVdvcnRoLFxuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2VcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHBvc3QgPSByZXBheUNhbGMoXG4gICAgICAgICAgICBzaGFyZVdvcnRoLFxuICAgICAgICAgICAgc3BsaXQsXG4gICAgICAgICAgICBlbmN1bWJlcmVkQmFsYW5jZSxcbiAgICAgICAgICAgIHBvb2xTdGF0c1xuICAgICAgICAgICk7XG4gICAgICAgICAgemNmLmF0b21pY1JlYXJyYW5nZShcbiAgICAgICAgICAgIGhhcmRlbihbXG4gICAgICAgICAgICAgIHNvdXJjZVRyYW5zZmVyLFxuICAgICAgICAgICAgICB0b09ubHkocG9vbFNlYXQsIHsgVVNEQzogYWRkNShzcGxpdC5Qb29sRmVlLCBzcGxpdC5QcmluY2lwYWwpIH0pLFxuICAgICAgICAgICAgICB0b09ubHkoZmVlU2VhdCwgeyBVU0RDOiBhZGQ1KHNwbGl0LkNvbnRyYWN0RmVlLCBzcGxpdC5SZWxheUZlZSkgfSlcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKTtcbiAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuc3RhdGUsIHBvc3QpO1xuICAgICAgICAgIHRoaXMuZmFjZXRzLmV4dGVybmFsLnB1Ymxpc2hQb29sTWV0cmljcygpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXh0ZXJuYWw6IHtcbiAgICAgICAgcHVibGlzaFBvb2xNZXRyaWNzKCkge1xuICAgICAgICAgIGNvbnN0IHsgcG9vbFN0YXRzLCBzaGFyZVdvcnRoLCBlbmN1bWJlcmVkQmFsYW5jZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IHJlY29yZGVyIH0gPSB0aGlzLnN0YXRlLnBvb2xNZXRyaWNzUmVjb3JkZXJLaXQ7XG4gICAgICAgICAgdm9pZCByZWNvcmRlci53cml0ZSh7XG4gICAgICAgICAgICBlbmN1bWJlcmVkQmFsYW5jZSxcbiAgICAgICAgICAgIHNoYXJlV29ydGgsXG4gICAgICAgICAgICAuLi5wb29sU3RhdHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlcG9zaXRIYW5kbGVyOiB7XG4gICAgICAgIGhhbmRsZShscCkge1xuICAgICAgICAgIGNvbnN0IHsgc2hhcmVXb3J0aCwgc2hhcmVNaW50LCBwb29sU2VhdCwgZW5jdW1iZXJlZEJhbGFuY2UgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyBleHRlcm5hbCB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgcHJvcG9zYWwgPSAoXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgbHAuZ2V0UHJvcG9zYWwoKVxuICAgICAgICAgICk7XG4gICAgICAgICAgY2hlY2tQb29sQmFsYW5jZShcbiAgICAgICAgICAgIHBvb2xTZWF0LmdldEN1cnJlbnRBbGxvY2F0aW9uKCksXG4gICAgICAgICAgICBzaGFyZVdvcnRoLFxuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2VcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHBvc3QgPSBkZXBvc2l0Q2FsYyhzaGFyZVdvcnRoLCBwcm9wb3NhbCk7XG4gICAgICAgICAgY29uc3Qgc2hhcmVQYXlvdXQgPSBzaGFyZU1pbnQubWludEdhaW5zKHBvc3QucGF5b3V0cyk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuc2hhcmVXb3J0aCA9IHBvc3Quc2hhcmVXb3J0aDtcbiAgICAgICAgICAgIHpjZi5hdG9taWNSZWFycmFuZ2UoXG4gICAgICAgICAgICAgIGhhcmRlbihbXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICBbbHAsIHBvb2xTZWF0LCBwcm9wb3NhbC5naXZlXSxcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIFtzaGFyZVBheW91dCwgbHAsIHBvc3QucGF5b3V0c11cbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBjYXRjaCAoY2F1c2UpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlxcdXsxRjZBOH0gY2Fubm90IGNvbW1pdCBkZXBvc2l0XCIsIHsgY2F1c2UgfSk7XG4gICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIGxwLmV4aXQoKTtcbiAgICAgICAgICAgIHNoYXJlUGF5b3V0LmV4aXQoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZXh0ZXJuYWwucHVibGlzaFBvb2xNZXRyaWNzKCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3aXRoZHJhd0hhbmRsZXI6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgaGFuZGxlKGxwKSB7XG4gICAgICAgICAgY29uc3QgeyBzaGFyZVdvcnRoLCBzaGFyZU1pbnQsIHBvb2xTZWF0LCBlbmN1bWJlcmVkQmFsYW5jZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IGV4dGVybmFsIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCBwcm9wb3NhbCA9IGxwLmdldFByb3Bvc2FsKCk7XG4gICAgICAgICAgY29uc3QgeyB6Y2ZTZWF0OiBidXJuIH0gPSB6Y2YubWFrZUVtcHR5U2VhdEtpdCgpO1xuICAgICAgICAgIGNvbnN0IHBvc3QgPSB3aXRoZHJhd0NhbGMoXG4gICAgICAgICAgICBzaGFyZVdvcnRoLFxuICAgICAgICAgICAgcHJvcG9zYWwsXG4gICAgICAgICAgICBwb29sU2VhdC5nZXRDdXJyZW50QWxsb2NhdGlvbigpLFxuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2VcbiAgICAgICAgICApO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnNoYXJlV29ydGggPSBwb3N0LnNoYXJlV29ydGg7XG4gICAgICAgICAgICB6Y2YuYXRvbWljUmVhcnJhbmdlKFxuICAgICAgICAgICAgICBoYXJkZW4oW1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgW2xwLCBidXJuLCBwcm9wb3NhbC5naXZlXSxcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIFtwb29sU2VhdCwgbHAsIHBvc3QucGF5b3V0c11cbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBzaGFyZU1pbnQuYnVybkxvc3Nlcyhwcm9wb3NhbC5naXZlLCBidXJuKTtcbiAgICAgICAgICB9IGNhdGNoIChjYXVzZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiXFx1ezFGNkE4fSBjYW5ub3QgY29tbWl0IHdpdGhkcmF3XCIsIHsgY2F1c2UgfSk7XG4gICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIGxwLmV4aXQoKTtcbiAgICAgICAgICAgIGJ1cm4uZXhpdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBleHRlcm5hbC5wdWJsaXNoUG9vbE1ldHJpY3MoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdpdGhkcmF3RmVlc0hhbmRsZXI6IHtcbiAgICAgICAgaGFuZGxlKHNlYXQpIHtcbiAgICAgICAgICBjb25zdCB7IGZlZVNlYXQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyB3YW50IH0gPSBzZWF0LmdldFByb3Bvc2FsKCk7XG4gICAgICAgICAgY29uc3QgYXZhaWxhYmxlID0gZmVlU2VhdC5nZXRBbW91bnRBbGxvY2F0ZWQoXCJVU0RDXCIsIHdhbnQuVVNEQy5icmFuZCk7XG4gICAgICAgICAgaXNHVEU0KGF2YWlsYWJsZSwgd2FudC5VU0RDKSB8fCB0aHJvd1JlZGFjdGVkYGNhbm5vdCB3aXRoZHJhdyAke3dhbnQuVVNEQ307IG9ubHkgJHthdmFpbGFibGV9IGF2YWlsYWJsZWA7XG4gICAgICAgICAgemNmLmF0b21pY1JlYXJyYW5nZShoYXJkZW4oW1tmZWVTZWF0LCBzZWF0LCB3YW50XV0pKTtcbiAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHB1YmxpYzoge1xuICAgICAgICBtYWtlRGVwb3NpdEludml0YXRpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLmRlcG9zaXRIYW5kbGVyLFxuICAgICAgICAgICAgXCJEZXBvc2l0XCIsXG4gICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnByb3Bvc2FsU2hhcGVzLmRlcG9zaXRcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICBtYWtlV2l0aGRyYXdJbnZpdGF0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy53aXRoZHJhd0hhbmRsZXIsXG4gICAgICAgICAgICBcIldpdGhkcmF3XCIsXG4gICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnByb3Bvc2FsU2hhcGVzLndpdGhkcmF3XG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0UHVibGljVG9waWNzKCkge1xuICAgICAgICAgIGNvbnN0IHsgcG9vbE1ldHJpY3NSZWNvcmRlcktpdCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcG9vbE1ldHJpY3M6IG1ha2VSZWNvcmRlclRvcGljKFxuICAgICAgICAgICAgICBcInBvb2xNZXRyaWNzXCIsXG4gICAgICAgICAgICAgIHBvb2xNZXRyaWNzUmVjb3JkZXJLaXRcbiAgICAgICAgICAgIClcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZmVlUmVjaXBpZW50OiB7XG4gICAgICAgIGdldENvbnRyYWN0RmVlQmFsYW5jZSgpIHtcbiAgICAgICAgICBjb25zdCB7IGZlZVNlYXQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgcmV0dXJuIGZlZVNlYXQuZ2V0Q3VycmVudEFsbG9jYXRpb24oKS5VU0RDO1xuICAgICAgICB9LFxuICAgICAgICBtYWtlV2l0aGRyYXdGZWVzSW52aXRhdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKFxuICAgICAgICAgICAgdGhpcy5mYWNldHMud2l0aGRyYXdGZWVzSGFuZGxlcixcbiAgICAgICAgICAgIFwiV2l0aGRyYXcgRmVlc1wiLFxuICAgICAgICAgICAgdm9pZCAwLFxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5wcm9wb3NhbFNoYXBlcy53aXRoZHJhd0ZlZXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBmaW5pc2g6ICh7IGZhY2V0czogeyBleHRlcm5hbCB9IH0pID0+IHtcbiAgICAgICAgdm9pZCBleHRlcm5hbC5wdWJsaXNoUG9vbE1ldHJpY3MoKTtcbiAgICAgIH0sXG4gICAgICBzdGF0ZVNoYXBlOiBzdGF0ZVNoYXBlMlxuICAgIH1cbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZUxpcXVpZGl0eVBvb2xLaXQpO1xuXG4vL1xudmFyIGFzTXVsdGlzZXQgPSAobWFwU3RvcmUpID0+IGhhcmRlbih7XG4gIC8qXG5cblxuXG5cbiAgICovXG4gIGFkZDogKGl0ZW0sIGNvdW50ID0gMSkgPT4ge1xuICAgIGNvdW50ID4gMCAmJiBOdW1iZXIuaXNJbnRlZ2VyKGNvdW50KSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCBhZGQgYSBub24tcG9zaXRpdmUgaW50ZWdlciBjb3VudCAke2NvdW50fSB0byBiYWdgO1xuICAgIGlmIChtYXBTdG9yZS5oYXMoaXRlbSkpIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRDb3VudCA9IG1hcFN0b3JlLmdldChpdGVtKTtcbiAgICAgIG1hcFN0b3JlLnNldChpdGVtLCBjdXJyZW50Q291bnQgKyBjb3VudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hcFN0b3JlLmluaXQoaXRlbSwgY291bnQpO1xuICAgIH1cbiAgfSxcbiAgLypcblxuXG5cblxuXG5cblxuICAgKi9cbiAgcmVtb3ZlOiAoaXRlbSwgY291bnQgPSAxKSA9PiB7XG4gICAgY291bnQgPiAwICYmIE51bWJlci5pc0ludGVnZXIoY291bnQpIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlbW92ZSBhIG5vbi1wb3NpdGl2ZSBpbnRlZ2VyIGNvdW50ICR7Y291bnR9IGZyb20gYmFnYDtcbiAgICBpZiAoIW1hcFN0b3JlLmhhcyhpdGVtKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBjdXJyZW50Q291bnQgPSBtYXBTdG9yZS5nZXQoaXRlbSk7XG4gICAgaWYgKGN1cnJlbnRDb3VudCA8IGNvdW50KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChjdXJyZW50Q291bnQgPT09IGNvdW50KSB7XG4gICAgICBtYXBTdG9yZS5kZWxldGUoaXRlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hcFN0b3JlLnNldChpdGVtLCBjdXJyZW50Q291bnQgLSBjb3VudCk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuICAvKlxuXG5cblxuXG4gICAqL1xuICBjb3VudDogKGl0ZW0pID0+IHtcbiAgICByZXR1cm4gbWFwU3RvcmUuaGFzKGl0ZW0pID8gbWFwU3RvcmUuZ2V0KGl0ZW0pIDogMDtcbiAgfSxcbiAgLypcblxuXG5cblxuICAgKi9cbiAgaGFzOiAoaXRlbSkgPT4ge1xuICAgIHJldHVybiBtYXBTdG9yZS5oYXMoaXRlbSk7XG4gIH0sXG4gIC8qXG5cblxuXG4gICAqL1xuICBrZXlzOiAoKSA9PiB7XG4gICAgcmV0dXJuIG1hcFN0b3JlLmtleXMoKTtcbiAgfSxcbiAgLypcblxuXG5cbiAgICovXG4gIGVudHJpZXM6ICgpID0+IHtcbiAgICByZXR1cm4gbWFwU3RvcmUuZW50cmllcygpO1xuICB9LFxuICAvKlxuXG5cblxuICAgKi9cbiAgc2l6ZTogKCkgPT4ge1xuICAgIHJldHVybiBtYXBTdG9yZS5nZXRTaXplKCk7XG4gIH0sXG4gIC8qXG5cbiAgICovXG4gIGNsZWFyOiAoKSA9PiB7XG4gICAgbWFwU3RvcmUuY2xlYXIoKTtcbiAgfVxufSk7XG52YXIgaW5zZXJ0SW50b1NvcnRlZEFycmF5ID0gKGFycmF5LCBpdGVtLCBjb21wYXJlKSA9PiB7XG4gIGxldCBpMiA9IGFycmF5Lmxlbmd0aDtcbiAgd2hpbGUgKGkyID4gMCAmJiBjb21wYXJlKGl0ZW0sIGFycmF5W2kyIC0gMV0pIDwgMCkge1xuICAgIGkyIC09IDE7XG4gIH1cbiAgYXJyYXkuc3BsaWNlKGkyLCAwLCBpdGVtKTtcbn07XG5oYXJkZW4oaW5zZXJ0SW50b1NvcnRlZEFycmF5KTtcblxuLy9cbnZhciBkZWNvZGVFdmVudFBhY2tldCA9ICh7IGRhdGEgfSwgcmVtb3RlRGVub20pID0+IHtcbiAgbGV0IHR4O1xuICB0cnkge1xuICAgIHR4ID0gSlNPTi5wYXJzZShhdG9iKGRhdGEpKTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIHsgZXJyb3I6IFtcImNvdWxkIG5vdCBwYXJzZSBwYWNrZXQgZGF0YVwiLCBkYXRhXSB9O1xuICB9XG4gIGNvbnN0IG5mYSA9IHR4LnNlbmRlcjtcbiAgaWYgKHR4LmRlbm9tICE9PSByZW1vdGVEZW5vbSkge1xuICAgIGNvbnN0IHsgZGVub206IGFjdHVhbCB9ID0gdHg7XG4gICAgcmV0dXJuIHsgZXJyb3I6IFtcInVuZXhwZWN0ZWQgZGVub21cIiwgeyBhY3R1YWwsIGV4cGVjdGVkOiByZW1vdGVEZW5vbSB9XSB9O1xuICB9XG4gIGxldCBFVUQ7XG4gIHRyeSB7XG4gICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZUFkZHJlc3NIb29rKHR4LnJlY2VpdmVyKTtcbiAgICBtdXN0TWF0Y2gyKGRlY29kZWQsIEFkZHJlc3NIb29rU2hhcGUpO1xuICAgICh7IEVVRCB9ID0gZGVjb2RlZC5xdWVyeSk7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiB7IGVycm9yOiBbXCJubyBxdWVyeSBwYXJhbXNcIiwgdHgucmVjZWl2ZXJdIH07XG4gIH1cbiAgbGV0IGFtb3VudDtcbiAgdHJ5IHtcbiAgICBhbW91bnQgPSBCaWdJbnQodHguYW1vdW50KTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIHsgZXJyb3I6IFtcImludmFsaWQgYW1vdW50XCIsIHR4LmFtb3VudF0gfTtcbiAgfVxuICByZXR1cm4geyBuZmEsIGFtb3VudCwgRVVEIH07XG59O1xuaGFyZGVuKGRlY29kZUV2ZW50UGFja2V0KTtcbnZhciBtYWtlTWludGVkRWFybHlLZXkgPSAoYWRkciwgYW1vdW50KSA9PiBgcGVuZGluZ1R4OiR7SlNPTi5zdHJpbmdpZnkoW2FkZHIsIFN0cmluZyhhbW91bnQpXSl9YDtcbnZhciBwYXJzZU1pbnRlZEVhcmx5S2V5ID0gKGtleSkgPT4ge1xuICBjb25zdCBbYWRkcmVzcywgYW1vdW50XSA9IEpTT04ucGFyc2Uoa2V5LnNwbGl0KFwiOlwiKVsxXSk7XG4gIHJldHVybiBoYXJkZW4oeyBhZGRyZXNzLCBhbW91bnQ6IEJpZ0ludChhbW91bnQpIH0pO1xufTtcbnZhciBtYWtlQWR2YW5jZURldGFpbHNTaGFwZSA9IChVU0RDKSA9PiBoYXJkZW4oe1xuICBkZXN0aW5hdGlvbjogQWNjb3VudElkQXJnU2hhcGUsXG4gIC8vXG4gIGZvcndhcmRpbmdBZGRyZXNzOiBNLnN0cmluZygpLFxuICBmdWxsQW1vdW50OiBtYWtlTmF0QW1vdW50U2hhcGUoVVNEQyksXG4gIHR4SGFzaDogRXZtSGFzaFNoYXBlXG59KTtcbnZhciBzdGF0ZVNoYXBlMyA9IGhhcmRlbih7XG4gIHJlcGF5ZXI6IE0ucmVtb3RhYmxlKFwiUmVwYXllclwiKSxcbiAgc2V0dGxlbWVudEFjY291bnQ6IE0ucmVtb3RhYmxlKFwiQWNjb3VudFwiKSxcbiAgcmVnaXN0cmF0aW9uOiBNLm9yKE0udW5kZWZpbmVkKCksIE0ucmVtb3RhYmxlKFwiUmVnaXN0cmF0aW9uXCIpKSxcbiAgc291cmNlQ2hhbm5lbDogTS5zdHJpbmcoKSxcbiAgcmVtb3RlRGVub206IE0uc3RyaW5nKCksXG4gIG1pbnRlZEVhcmx5OiBNLnJlbW90YWJsZShcIm1pbnRlZEVhcmx5XCIpLFxuICAvKiAgICAgICAgICAgICAgKi9cbiAgaW50ZXJtZWRpYXRlUmVjaXBpZW50OiBNLm9wdChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSlcbn0pO1xudmFyIHByZXBhcmVTZXR0bGVyID0gKHpvbmUsIHtcbiAgY2hhaW5IdWIsXG4gIGZlZUNvbmZpZyxcbiAgZm9yd2FyZEZ1bmRzOiBmb3J3YXJkRnVuZHMyLFxuICBnZXROb2JsZUlDQSxcbiAgbG9nID0gbWFrZVRyYWNlcihcIlNldHRsZXJcIiwgdHJ1ZSksXG4gIHN0YXR1c01hbmFnZXIsXG4gIFVTREMsXG4gIHZvd1Rvb2xzLFxuICB3aXRoZHJhd1RvU2VhdCxcbiAgemNmXG59KSA9PiB7XG4gIGFzc2VydEFsbERlZmluZWQoeyBzdGF0dXNNYW5hZ2VyIH0pO1xuICBjb25zdCBVc2RjQW1vdW50U2hhcGUgPSBtYWtlTmF0QW1vdW50U2hhcGUoVVNEQyk7XG4gIHJldHVybiB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiRmFzdCBVU0RDIFNldHRsZXJcIixcbiAgICB7XG4gICAgICBjcmVhdG9yOiBNLmludGVyZmFjZShcIlNldHRsZXJDcmVhdG9ySVwiLCB7XG4gICAgICAgIG1vbml0b3JNaW50aW5nRGVwb3NpdHM6IE0uY2FsbCgpLnJldHVybnMoTS5hbnkoKSksXG4gICAgICAgIHJlbWVkaWF0ZU1pbnRlZEVhcmx5OiBNLmNhbGwoTS5iaWdpbnQoKSkucmV0dXJucygpXG4gICAgICB9KSxcbiAgICAgIHRhcDogTS5pbnRlcmZhY2UoXCJTZXR0bGVyVGFwSVwiLCB7XG4gICAgICAgIHJlY2VpdmVVcGNhbGw6IE0uY2FsbChNLnJlY29yZCgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgICAgfSksXG4gICAgICBub3RpZmllcjogTS5pbnRlcmZhY2UoXCJTZXR0bGVyTm90aWZ5SVwiLCB7XG4gICAgICAgIG5vdGlmeUFkdmFuY2luZ1Jlc3VsdDogTS5jYWxsKFxuICAgICAgICAgIG1ha2VBZHZhbmNlRGV0YWlsc1NoYXBlKFVTREMpLFxuICAgICAgICAgIE0uYm9vbGVhbigpXG4gICAgICAgICkucmV0dXJucygpLFxuICAgICAgICBjaGVja01pbnRlZEVhcmx5OiBNLmNhbGwoQ2N0cFR4RXZpZGVuY2VTaGFwZSwgTS5zdHJpbmcoKSkucmV0dXJucyhcbiAgICAgICAgICBNLmJvb2xlYW4oKVxuICAgICAgICApXG4gICAgICB9KSxcbiAgICAgIHNlbGY6IE0uaW50ZXJmYWNlKFwiU2V0dGxlclNlbGZJXCIsIHtcbiAgICAgICAgYWRkTWludGVkRWFybHk6IE0uY2FsbChNLnN0cmluZygpLCBVc2RjQW1vdW50U2hhcGUpLnJldHVybnMoKSxcbiAgICAgICAgZGlzYnVyc2U6IE0uY2FsbChFdm1IYXNoU2hhcGUsIFVzZGNBbW91bnRTaGFwZSwgTS5zdHJpbmcoKSkucmV0dXJucyhcbiAgICAgICAgICBNLnByb21pc2UoKVxuICAgICAgICApLFxuICAgICAgICBmb3J3YXJkOiBNLmNhbGwoRXZtSGFzaFNoYXBlLCBVc2RjQW1vdW50U2hhcGUsIE0uc3RyaW5nKCkpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgdHJhbnNmZXJIYW5kbGVyOiBNLmludGVyZmFjZShcIlNldHRsZXJUcmFuc2ZlcklcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0udW5kZWZpbmVkKCksIE0uc3RyaW5nKCkpLnJldHVybnMoKSxcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uZXJyb3IoKSwgTS5zdHJpbmcoKSkucmV0dXJucygpXG4gICAgICB9KSxcbiAgICAgIGludGVybWVkaWF0ZVRyYW5zZmVySGFuZGxlcjogTS5pbnRlcmZhY2UoXCJTZXR0bGVySW50ZXJtZWRpYXRlVHJhbnNmZXJJXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnVuZGVmaW5lZCgpLCBNLnJlY29yZCgpKS5yZXR1cm5zKCksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIE0ucmVjb3JkKCkpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICBkZXBvc2l0Rm9yQnVybkhhbmRsZXI6IE0uaW50ZXJmYWNlKFwiU2V0dGxlckRlcG9zaXRGb3JCdXJuSVwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS51bmRlZmluZWQoKSwgTS5zdHJpbmcoKSkucmV0dXJucygpLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5lcnJvcigpLCBNLnN0cmluZygpKS5yZXR1cm5zKClcbiAgICAgIH0pXG4gICAgfSxcbiAgICAoY29uZmlnKSA9PiB7XG4gICAgICBsb2coXCJjb25maWdcIiwgY29uZmlnKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmNvbmZpZyxcbiAgICAgICAgLy9cbiAgICAgICAgaW50ZXJtZWRpYXRlUmVjaXBpZW50OiB2b2lkIDAsXG4gICAgICAgIHJlZ2lzdHJhdGlvbjogdm9pZCAwLFxuICAgICAgICBtaW50ZWRFYXJseTogem9uZS5kZXRhY2hlZCgpLm1hcFN0b3JlKFwibWludGVkRWFybHlcIilcbiAgICAgIH07XG4gICAgfSxcbiAgICB7XG4gICAgICBjcmVhdG9yOiB7XG4gICAgICAgIC8vXG4gICAgICAgIGFzeW5jIG1vbml0b3JNaW50aW5nRGVwb3NpdHMoKSB7XG4gICAgICAgICAgY29uc3QgeyBzZXR0bGVtZW50QWNjb3VudCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCByZWdpc3RyYXRpb24gPSBhd2FpdCB2b3dUb29scy53aGVuKFxuICAgICAgICAgICAgc2V0dGxlbWVudEFjY291bnQubW9uaXRvclRyYW5zZmVycyh0aGlzLmZhY2V0cy50YXApXG4gICAgICAgICAgKTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKHJlZ2lzdHJhdGlvbiwgXCJvYmplY3RcIik7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5yZWdpc3RyYXRpb24gPSByZWdpc3RyYXRpb247XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHJlbWVkaWF0ZU1pbnRlZEVhcmx5KG1pblV1c2RjKSB7XG4gICAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCB7IG1pbnRlZEVhcmx5IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGxvZyhcInJlbWVkaWF0ZU1pbnRlZEVhcmx5XCIsIG1pblV1c2RjLCBbLi4ubWludGVkRWFybHkua2V5cygpXSk7XG4gICAgICAgICAgY29uc3QgYmF0Y2hlcyA9IG1pbnRlZEVhcmx5LmVudHJpZXMoKTtcbiAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIGNvdW50XSBvZiBiYXRjaGVzKSB7XG4gICAgICAgICAgICBjb25zdCB7IGFkZHJlc3MsIGFtb3VudCB9ID0gcGFyc2VNaW50ZWRFYXJseUtleShrZXkpO1xuICAgICAgICAgICAgaWYgKGFtb3VudCA8IG1pblV1c2RjKSB7XG4gICAgICAgICAgICAgIGxvZyhcInNraXBwaW5nXCIsIGtleSwgXCJsZXNzIHRoYW5cIiwgbWluVXVzZGMpO1xuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGFsbFBlbmRpbmcgPSBzdGF0dXNNYW5hZ2VyLmxvb2t1cFBlbmRpbmcoYWRkcmVzcywgYW1vdW50KTtcbiAgICAgICAgICAgIGlmIChhbGxQZW5kaW5nLnNvbWUoXG4gICAgICAgICAgICAgICh7IHN0YXR1cyB9KSA9PiBzdGF0dXMgIT09IFBlbmRpbmdUeFN0YXR1cy5BZHZhbmNlZFxuICAgICAgICAgICAgKSkge1xuICAgICAgICAgICAgICBsb2coXCJcXHV7MUY2QTh9IHBlbmRpbmcgdHhzIGluY2x1ZGVkIG9uZSBub3QgYWR2YW5jZWRcIiwgYWxsUGVuZGluZyk7XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGNvdW50OyBpMiArPSAxKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHBlbmRpbmdUeHMgPSBzdGF0dXNNYW5hZ2VyLm1hdGNoQW5kRGVxdWV1ZVNldHRsZW1lbnQoXG4gICAgICAgICAgICAgICAgYWRkcmVzcyxcbiAgICAgICAgICAgICAgICBhbW91bnRcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgZm9yIChjb25zdCBwMyBvZiBwZW5kaW5nVHhzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZnVsbFZhbHVlID0gQW1vdW50TWF0aC5tYWtlKFVTREMsIHAzLnR4LmFtb3VudCk7XG4gICAgICAgICAgICAgICAgdm9pZCBzZWxmLmRpc2J1cnNlKHAzLnR4SGFzaCwgZnVsbFZhbHVlLCBwMy5hdXgucmVjaXBpZW50QWRkcmVzcyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgbWludGVkRWFybHkuZGVsZXRlKGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGFwOiB7XG4gICAgICAgIGFzeW5jIHJlY2VpdmVVcGNhbGwoZXZlbnQpIHtcbiAgICAgICAgICBsb2coXCJ1cGNhbGwgZXZlbnRcIiwgZXZlbnQucGFja2V0LnNlcXVlbmNlLCBldmVudC5ibG9ja1RpbWUpO1xuICAgICAgICAgIGNvbnN0IHsgc291cmNlQ2hhbm5lbCwgcmVtb3RlRGVub20gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyBwYWNrZXQgfSA9IGV2ZW50O1xuICAgICAgICAgIGlmIChwYWNrZXQuc291cmNlX2NoYW5uZWwgIT09IHNvdXJjZUNoYW5uZWwpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc291cmNlX2NoYW5uZWw6IGFjdHVhbCB9ID0gcGFja2V0O1xuICAgICAgICAgICAgaWYgKHBhY2tldC5kZXN0aW5hdGlvbl9jaGFubmVsICE9PSBzb3VyY2VDaGFubmVsKSB7XG4gICAgICAgICAgICAgIGxvZyhcIlxcdTI2QTBcXHVGRTBGIHVuZXhwZWN0ZWQgY2hhbm5lbFwiLCB7IGFjdHVhbCwgZXhwZWN0ZWQ6IHNvdXJjZUNoYW5uZWwgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGRlY29kZWQgPSBkZWNvZGVFdmVudFBhY2tldChldmVudC5wYWNrZXQsIHJlbW90ZURlbm9tKTtcbiAgICAgICAgICBpZiAoXCJlcnJvclwiIGluIGRlY29kZWQpIHtcbiAgICAgICAgICAgIGxvZyhcImludmFsaWQgZXZlbnQgcGFja2V0XCIsIGRlY29kZWQuZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB7IG5mYSwgYW1vdW50LCBFVUQgfSA9IGRlY29kZWQ7XG4gICAgICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCBkZXF1ZXVlZCA9IHN0YXR1c01hbmFnZXIubWF0Y2hBbmREZXF1ZXVlU2V0dGxlbWVudChuZmEsIGFtb3VudCk7XG4gICAgICAgICAgaWYgKGRlcXVldWVkLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgbG9nKFwiXFx1MjZBMFxcdUZFMEYgdGFwOiBtaW50ZWQgYmVmb3JlIG9ic2VydmVkXCIsIG5mYSwgYW1vdW50KTtcbiAgICAgICAgICAgIHNlbGYuYWRkTWludGVkRWFybHkobmZhLCBBbW91bnRNYXRoLm1ha2UoVVNEQywgYW1vdW50KSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGxvZyhcImRlcXVldWVkXCIsIGRlcXVldWVkLCBcImZvclwiLCBuZmEsIGFtb3VudCk7XG4gICAgICAgICAgZm9yIChjb25zdCBmb3VuZCBvZiBkZXF1ZXVlZCkge1xuICAgICAgICAgICAgY29uc3QgZnVsbFZhbHVlID0gQW1vdW50TWF0aC5tYWtlKFVTREMsIGZvdW5kLnR4LmFtb3VudCk7XG4gICAgICAgICAgICBzd2l0Y2ggKGZvdW5kLnN0YXR1cykge1xuICAgICAgICAgICAgICBjYXNlIFBlbmRpbmdUeFN0YXR1cy5BZHZhbmNlZDpcbiAgICAgICAgICAgICAgICB2b2lkIHNlbGYuZGlzYnVyc2UoZm91bmQudHhIYXNoLCBmdWxsVmFsdWUsIEVVRCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgUGVuZGluZ1R4U3RhdHVzLkFkdmFuY2luZzpcbiAgICAgICAgICAgICAgICBsb2coXCJcXHUyNkEwXFx1RkUwRiB0YXA6IG1pbnRlZCB3aGlsZSBhZHZhbmNpbmdcIiwgbmZhLCBmb3VuZC50eC5hbW91bnQpO1xuICAgICAgICAgICAgICAgIHNlbGYuYWRkTWludGVkRWFybHkobmZhLCBmdWxsVmFsdWUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlIFBlbmRpbmdUeFN0YXR1cy5BZHZhbmNlU2tpcHBlZDpcbiAgICAgICAgICAgICAgY2FzZSBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZUZhaWxlZDpcbiAgICAgICAgICAgICAgICBzZWxmLmZvcndhcmQoZm91bmQudHhIYXNoLCBmdWxsVmFsdWUsIEVVRCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgbG9nKFwiXFx1MjZBMFxcdUZFMEYgdW5leHBlY3RlZCBzdGF0dXNcIiwgZm91bmQuc3RhdHVzLCBcImZvclwiLCBmb3VuZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgbm90aWZpZXI6IHtcbiAgICAgICAgbm90aWZ5QWR2YW5jaW5nUmVzdWx0KHtcbiAgICAgICAgICB0eEhhc2gsXG4gICAgICAgICAgZm9yd2FyZGluZ0FkZHJlc3MsXG4gICAgICAgICAgZnVsbEFtb3VudCxcbiAgICAgICAgICBkZXN0aW5hdGlvbjogZGVzdEFyZ1xuICAgICAgICB9LCBzdWNjZXNzKSB7XG4gICAgICAgICAgY29uc3QgeyBtaW50ZWRFYXJseSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IHZhbHVlOiBmdWxsVmFsdWUgfSA9IGZ1bGxBbW91bnQ7XG4gICAgICAgICAgY29uc3Qga2V5ID0gbWFrZU1pbnRlZEVhcmx5S2V5KGZvcndhcmRpbmdBZGRyZXNzLCBmdWxsVmFsdWUpO1xuICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gY29lcmNlQWNjb3VudElkKGRlc3RBcmcpO1xuICAgICAgICAgIGlmIChtaW50ZWRFYXJseS5oYXMoa2V5KSkge1xuICAgICAgICAgICAgYXNNdWx0aXNldChtaW50ZWRFYXJseSkucmVtb3ZlKGtleSk7XG4gICAgICAgICAgICBzdGF0dXNNYW5hZ2VyLmFkdmFuY2VPdXRjb21lRm9yTWludGVkRWFybHkodHhIYXNoLCBzdWNjZXNzKTtcbiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgICAgIHZvaWQgdGhpcy5mYWNldHMuc2VsZi5kaXNidXJzZSh0eEhhc2gsIGZ1bGxBbW91bnQsIGRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHZvaWQgdGhpcy5mYWNldHMuc2VsZi5mb3J3YXJkKHR4SGFzaCwgZnVsbEFtb3VudCwgZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdGF0dXNNYW5hZ2VyLmFkdmFuY2VPdXRjb21lKFxuICAgICAgICAgICAgICBmb3J3YXJkaW5nQWRkcmVzcyxcbiAgICAgICAgICAgICAgZnVsbFZhbHVlLFxuICAgICAgICAgICAgICBzdWNjZXNzLFxuICAgICAgICAgICAgICB7IGRlc3RpbmF0aW9uIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgY2hlY2tNaW50ZWRFYXJseShldmlkZW5jZSwgZGVzdGluYXRpb24pIHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICB0eDogeyBmb3J3YXJkaW5nQWRkcmVzcywgYW1vdW50IH0sXG4gICAgICAgICAgICB0eEhhc2hcbiAgICAgICAgICB9ID0gZXZpZGVuY2U7XG4gICAgICAgICAgY29uc3Qga2V5ID0gbWFrZU1pbnRlZEVhcmx5S2V5KGZvcndhcmRpbmdBZGRyZXNzLCBhbW91bnQpO1xuICAgICAgICAgIGNvbnN0IHsgbWludGVkRWFybHkgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKG1pbnRlZEVhcmx5LmhhcyhrZXkpKSB7XG4gICAgICAgICAgICBsb2coXG4gICAgICAgICAgICAgIFwibWF0Y2hlZCBtaW50ZWQgZWFybHkga2V5LCBpbml0aWF0aW5nIGZvcndhcmRcIixcbiAgICAgICAgICAgICAgZm9yd2FyZGluZ0FkZHJlc3MsXG4gICAgICAgICAgICAgIGFtb3VudFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGFzTXVsdGlzZXQobWludGVkRWFybHkpLnJlbW92ZShrZXkpO1xuICAgICAgICAgICAgc3RhdHVzTWFuYWdlci5hZHZhbmNlT3V0Y29tZUZvclVua25vd25NaW50KGV2aWRlbmNlKTtcbiAgICAgICAgICAgIHZvaWQgdGhpcy5mYWNldHMuc2VsZi5mb3J3YXJkKFxuICAgICAgICAgICAgICB0eEhhc2gsXG4gICAgICAgICAgICAgIEFtb3VudE1hdGgubWFrZShVU0RDLCBhbW91bnQpLFxuICAgICAgICAgICAgICBkZXN0aW5hdGlvblxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzZWxmOiB7XG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBhZGRNaW50ZWRFYXJseShhZGRyZXNzLCBhbW91bnQpIHtcbiAgICAgICAgICBjb25zdCBrZXkgPSBtYWtlTWludGVkRWFybHlLZXkoYWRkcmVzcywgYW1vdW50LnZhbHVlKTtcbiAgICAgICAgICBjb25zdCB7IG1pbnRlZEVhcmx5IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGFzTXVsdGlzZXQobWludGVkRWFybHkpLmFkZChrZXkpO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIC8vXG4gICAgICAgIGFzeW5jIGRpc2J1cnNlKHR4SGFzaCwgcmVjZWl2ZWQsIEVVRCkge1xuICAgICAgICAgIGNvbnN0IHsgcmVwYXllciwgc2V0dGxlbWVudEFjY291bnQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyB6Y2ZTZWF0OiBzZXR0bGluZ1NlYXQgfSA9IHpjZi5tYWtlRW1wdHlTZWF0S2l0KCk7XG4gICAgICAgICAgY29uc3QgeyBjYWxjdWxhdGVTcGxpdCB9ID0gbWFrZUZlZVRvb2xzKGZlZUNvbmZpZyk7XG4gICAgICAgICAgY29uc3QgYWNjb3VudElkID0gY2hhaW5IdWIucmVzb2x2ZUFjY291bnRJZChFVUQpO1xuICAgICAgICAgIGNvbnN0IHNwbGl0ID0gY2FsY3VsYXRlU3BsaXQocmVjZWl2ZWQsIGFjY291bnRJZCk7XG4gICAgICAgICAgbG9nKFwiZGlzYnVyc2luZ1wiLCBzcGxpdCk7XG4gICAgICAgICAgYXdhaXQgdm93VG9vbHMud2hlbihcbiAgICAgICAgICAgIHdpdGhkcmF3VG9TZWF0KFxuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBzZXR0bGVtZW50QWNjb3VudCxcbiAgICAgICAgICAgICAgc2V0dGxpbmdTZWF0LFxuICAgICAgICAgICAgICBoYXJkZW4oeyBJbjogcmVjZWl2ZWQgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHRyYW5zZmVyUGFydCA9IGZyb21Pbmx5KHNldHRsaW5nU2VhdCwgeyBJbjogcmVjZWl2ZWQgfSk7XG4gICAgICAgICAgcmVwYXllci5yZXBheSh0cmFuc2ZlclBhcnQsIHNwbGl0KTtcbiAgICAgICAgICBzZXR0bGluZ1NlYXQuZXhpdCgpO1xuICAgICAgICAgIHN0YXR1c01hbmFnZXIuZGlzYnVyc2VkKHR4SGFzaCwgc3BsaXQpO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGZvcndhcmQodHhIYXNoLCBmdWxsVmFsdWUsIEVVRCkge1xuICAgICAgICAgIGxvZyhcImZvcndhcmRpbmdcIiwgZnVsbFZhbHVlLnZhbHVlLCBcInRvXCIsIEVVRCwgXCJmb3JcIiwgdHhIYXNoKTtcbiAgICAgICAgICBjb25zdCBkZXN0ID0gKCgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIHJldHVybiBjaGFpbkh1Yi5yZXNvbHZlQWNjb3VudElkKEVVRCk7XG4gICAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgICAgbG9nKFxuICAgICAgICAgICAgICAgIFwiXFx1MjZBMFxcdUZFMEYgZm9yd2FyZCBub3QgYXR0ZW1wdGVkXCIsXG4gICAgICAgICAgICAgICAgXCJ1bnJlc29sdmFibGUgZGVzdGluYXRpb25cIixcbiAgICAgICAgICAgICAgICB0eEhhc2gsXG4gICAgICAgICAgICAgICAgRVVEXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIHN0YXR1c01hbmFnZXIuZm9yd2FyZFNraXBwZWQodHhIYXNoKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSkoKTtcbiAgICAgICAgICBpZiAoIWRlc3QpIHJldHVybjtcbiAgICAgICAgICB2b2lkIGZvcndhcmRGdW5kczIoeyB0eEhhc2gsIGFtb3VudDogZnVsbFZhbHVlLCBkZXN0aW5hdGlvbjogZGVzdCB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHRyYW5zZmVySGFuZGxlcjoge1xuICAgICAgICBvbkZ1bGZpbGxlZChfcmVzdWx0LCB0eEhhc2gpIHtcbiAgICAgICAgICBzdGF0dXNNYW5hZ2VyLmZvcndhcmRlZCh0eEhhc2gpO1xuICAgICAgICB9LFxuICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgdHhIYXNoKSB7XG4gICAgICAgICAgbG9nKFwiXFx1ezFGNkE4fSBmb3J3YXJkIHRyYW5zZmVyIHJlamVjdGVkIVwiLCByZWFzb24sIHR4SGFzaCk7XG4gICAgICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkRmFpbGVkKHR4SGFzaCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBpbnRlcm1lZGlhdGVUcmFuc2ZlckhhbmRsZXI6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoX3Jlc3VsdCwge1xuICAgICAgICAgIGFtdCxcbiAgICAgICAgICBkZXN0LFxuICAgICAgICAgIHR4SGFzaFxuICAgICAgICB9KSB7XG4gICAgICAgICAgY29uc3Qgbm9ibGVJY2EgPSBnZXROb2JsZUlDQSgpO1xuICAgICAgICAgIHZvaWQgdm93VG9vbHMud2F0Y2goXG4gICAgICAgICAgICBFKG5vYmxlSWNhKS5kZXBvc2l0Rm9yQnVybihkZXN0LCBhbXQpLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMuZGVwb3NpdEZvckJ1cm5IYW5kbGVyLFxuICAgICAgICAgICAgdHhIYXNoXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZWplY3RlZChyZWFzb24sIHsgdHhIYXNoIH0pIHtcbiAgICAgICAgICBsb2coXCJcXHV7MUY2QTh9IGZvcndhcmQgaW50ZXJtZWRpYXRlIHRyYW5zZmVyIHJlamVjdGVkIVwiLCByZWFzb24sIHR4SGFzaCk7XG4gICAgICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkRmFpbGVkKHR4SGFzaCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkZXBvc2l0Rm9yQnVybkhhbmRsZXI6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoX3Jlc3VsdCwgdHhIYXNoKSB7XG4gICAgICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkZWQodHhIYXNoKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZWplY3RlZChyZWFzb24sIHR4SGFzaCkge1xuICAgICAgICAgIGxvZyhcIlxcdXsxRjZBOH0gZm9yd2FyZCBkZXBvc2l0Rm9yQnVybiByZWplY3RlZCFcIiwgcmVhc29uLCB0eEhhc2gpO1xuICAgICAgICAgIHN0YXR1c01hbmFnZXIuZm9yd2FyZEZhaWxlZCh0eEhhc2gpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgIH0sXG4gICAge1xuICAgICAgc3RhdGVTaGFwZTogc3RhdGVTaGFwZTNcbiAgICB9XG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVTZXR0bGVyKTtcblxuLy9cbnZhciBGb3J3YXJkRmFpbGVkVHhTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBkZXN0aW5hdGlvbjogTS5zdHJpbmcoKSxcbiAgICBhbW91bnQ6IE0uYmlnaW50KCksXG4gICAgdHhIYXNoOiBFdm1IYXNoU2hhcGVcbiAgfSxcbiAge1xuICAgIGNoYWluSWQ6IE0uc3RyaW5nKCksXG4gICAgZnVuZHNJbk5vYmxlSWNhOiBNLmJvb2xlYW4oKVxuICB9XG4pO1xuXG4vL1xudmFyIG1ha2VSb3V0ZUhlYWx0aCA9IChtYXhGYWlsdXJlcykgPT4ge1xuICBjb25zdCBmYWlsdXJlcyA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGNvbnN0IGdldEZhaWx1cmVDb3VudCA9IChyb3V0ZSkgPT4gZmFpbHVyZXMuZ2V0KHJvdXRlKSA/PyAwO1xuICBsZXQgaGFuZGxlcnMgPSB7XG4gICAgb25FYWNoRmFpbHVyZTogKF9yb3V0ZSkgPT4ge1xuICAgIH0sXG4gICAgb25FYWNoU3VjY2VzczogKF9yb3V0ZSkgPT4ge1xuICAgIH0sXG4gICAgb25Xb3JraW5nOiAoX3JvdXRlKSA9PiB7XG4gICAgfSxcbiAgICBvbkRlcmVsaWN0OiAoX3JvdXRlKSA9PiB7XG4gICAgfVxuICB9O1xuICByZXR1cm4ge1xuICAgIG5vdGVGYWlsdXJlOiAocm91dGUpID0+IHtcbiAgICAgIGNvbnN0IG9sZENvdW50ID0gZ2V0RmFpbHVyZUNvdW50KHJvdXRlKTtcbiAgICAgIGNvbnN0IG5ld0NvdW50ID0gb2xkQ291bnQgKyAxO1xuICAgICAgZmFpbHVyZXMuc2V0KHJvdXRlLCBuZXdDb3VudCk7XG4gICAgICBoYW5kbGVycy5vbkVhY2hGYWlsdXJlKHJvdXRlKTtcbiAgICAgIGlmIChuZXdDb3VudCA9PT0gbWF4RmFpbHVyZXMgJiYgb2xkQ291bnQgPCBtYXhGYWlsdXJlcykge1xuICAgICAgICBoYW5kbGVycy5vbkRlcmVsaWN0KHJvdXRlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIG5vdGVTdWNjZXNzOiAocm91dGUpID0+IHtcbiAgICAgIGNvbnN0IG9sZENvdW50ID0gZ2V0RmFpbHVyZUNvdW50KHJvdXRlKTtcbiAgICAgIGZhaWx1cmVzLmRlbGV0ZShyb3V0ZSk7XG4gICAgICBoYW5kbGVycy5vbkVhY2hTdWNjZXNzKHJvdXRlKTtcbiAgICAgIGlmIChvbGRDb3VudCA+PSBtYXhGYWlsdXJlcykge1xuICAgICAgICBoYW5kbGVycy5vbldvcmtpbmcocm91dGUpO1xuICAgICAgfVxuICAgIH0sXG4gICAgLypcblxuICAgICAqL1xuICAgIGlzV29ya2luZzogKHJvdXRlKSA9PiB7XG4gICAgICByZXR1cm4gZ2V0RmFpbHVyZUNvdW50KHJvdXRlKSA8IG1heEZhaWx1cmVzO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgIHNldEV2ZW50SGFuZGxlcnM6IChjYikgPT4ge1xuICAgICAgaGFuZGxlcnMgPSB7IC4uLmhhbmRsZXJzLCAuLi5jYiB9O1xuICAgIH1cbiAgfTtcbn07XG5cbi8vXG52YXIgTUFYX01BVENIX0RFUFRIID0gMjU7XG52YXIgY29tcGFyZVBlbmRpbmdUeERlc2MgPSAoYTIsIGIzKSA9PiBOdW1iZXIoYjMudHguYW1vdW50IC0gYTIudHguYW1vdW50KTtcbmhhcmRlbihjb21wYXJlUGVuZGluZ1R4RGVzYyk7XG52YXIgZ3JlZWR5TWF0Y2ggPSAocGVuZGluZywgdGFyZ2V0KSA9PiB7XG4gIGlmICh0YXJnZXQgPT09IDBuKSByZXR1cm4gW107XG4gIGlmIChwZW5kaW5nLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdO1xuICBjb25zdCBkZWFkRW5kcyA9IC8qICAgICAgICAgICAqLyBuZXcgU2V0KCk7XG4gIGNvbnN0IHBhdGggPSBbXTtcbiAgY29uc3QgZGZzID0gKGluZGV4LCBzdW0pID0+IHtcbiAgICBpZiAoc3VtID09PSB0YXJnZXQpIHJldHVybiB0cnVlO1xuICAgIGlmIChzdW0gPiB0YXJnZXQpIHtcbiAgICAgIHRocm93IEVycm9yKFxuICAgICAgICBgaW50ZXJuYWw6IHRhcmdldCBleGNlZWRlZCBmb3IgJHtwZW5kaW5nWzBdLnR4LmZvcndhcmRpbmdBZGRyZXNzfWBcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChwYXRoLmxlbmd0aCA+PSBNQVhfTUFUQ0hfREVQVEgpXG4gICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgYE1BWF9NQVRDSF9ERVBUSDogJHtNQVhfTUFUQ0hfREVQVEh9IGV4Y2VlZGVkIGZvciAke3BlbmRpbmdbMF0udHguZm9yd2FyZGluZ0FkZHJlc3N9YFxuICAgICAgKTtcbiAgICBpZiAoaW5kZXggPj0gcGVuZGluZy5sZW5ndGgpIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCBrZXkgPSBgJHtpbmRleH06JHtzdW19YDtcbiAgICBpZiAoZGVhZEVuZHMuaGFzKGtleSkpIHJldHVybiBmYWxzZTtcbiAgICBmb3IgKGxldCBpMiA9IGluZGV4OyBpMiA8IHBlbmRpbmcubGVuZ3RoOyBpMiArPSAxKSB7XG4gICAgICBjb25zdCB0eCA9IHBlbmRpbmdbaTJdO1xuICAgICAgY29uc3QgbmV4dFN1bSA9IHN1bSArIHR4LnR4LmFtb3VudDtcbiAgICAgIGlmIChuZXh0U3VtID4gdGFyZ2V0KSBjb250aW51ZTtcbiAgICAgIHBhdGgucHVzaCh0eCk7XG4gICAgICBpZiAoZGZzKGkyICsgMSwgbmV4dFN1bSkpIHJldHVybiB0cnVlO1xuICAgICAgcGF0aC5wb3AoKTtcbiAgICB9XG4gICAgZGVhZEVuZHMuYWRkKGtleSk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICByZXR1cm4gZGZzKDAsIDBuKSA/IHBhdGggOiBbXTtcbn07XG5oYXJkZW4oZ3JlZWR5TWF0Y2gpO1xudmFyIG1ha2VTZXR0bGVtZW50TWF0Y2hlciA9ICgpID0+IHtcbiAgY29uc3QgYWRkUGVuZGluZ1NldHRsZVR4ID0gKHBlbmRpbmdTZXR0bGVUeHMsIHBlbmRpbmcpID0+IHtcbiAgICBjb25zdCBuZmEgPSBwZW5kaW5nLnR4LmZvcndhcmRpbmdBZGRyZXNzO1xuICAgIGlmICghcGVuZGluZ1NldHRsZVR4cy5oYXMobmZhKSkge1xuICAgICAgcGVuZGluZ1NldHRsZVR4cy5pbml0KG5mYSwgaGFyZGVuKFtwZW5kaW5nXSkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBsaXN0ID0gWy4uLnBlbmRpbmdTZXR0bGVUeHMuZ2V0KG5mYSldO1xuICAgIGluc2VydEludG9Tb3J0ZWRBcnJheShsaXN0LCBwZW5kaW5nLCBjb21wYXJlUGVuZGluZ1R4RGVzYyk7XG4gICAgcGVuZGluZ1NldHRsZVR4cy5zZXQobmZhLCBoYXJkZW4obGlzdCkpO1xuICB9O1xuICBjb25zdCBtYXRjaEFuZERlcXVldWVTZXR0bGVtZW50ID0gKHBlbmRpbmdTZXR0bGVUeHMsIG5mYSwgYW1vdW50KSA9PiB7XG4gICAgaWYgKCFwZW5kaW5nU2V0dGxlVHhzLmhhcyhuZmEpKSByZXR1cm4gW107XG4gICAgY29uc3QgbGlzdCA9IHBlbmRpbmdTZXR0bGVUeHMuZ2V0KG5mYSk7XG4gICAgY29uc3QgaXggPSBsaXN0LmZpbmRJbmRleCgodHgpID0+IHR4LnR4LmFtb3VudCA9PT0gYW1vdW50KTtcbiAgICBpZiAoaXggPj0gMCkge1xuICAgICAgY29uc3QgbWF0Y2ggPSBsaXN0W2l4XTtcbiAgICAgIGlmIChsaXN0Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgY29uc3QgcmVtYWluaW5nID0gWy4uLmxpc3Quc2xpY2UoMCwgaXgpLCAuLi5saXN0LnNsaWNlKGl4ICsgMSldO1xuICAgICAgICBwZW5kaW5nU2V0dGxlVHhzLnNldChuZmEsIGhhcmRlbihyZW1haW5pbmcpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBlbmRpbmdTZXR0bGVUeHMuZGVsZXRlKG5mYSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gaGFyZGVuKFttYXRjaF0pO1xuICAgIH1cbiAgICBjb25zdCBjb21ibyA9IGdyZWVkeU1hdGNoKGxpc3QsIGFtb3VudCk7XG4gICAgaWYgKGNvbWJvLmxlbmd0aCkge1xuICAgICAgaWYgKGNvbWJvLmxlbmd0aCAhPT0gbGlzdC5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgbWF0Y2hlZFNldCA9IG5ldyBTZXQoY29tYm8pO1xuICAgICAgICBjb25zdCByZW1haW5pbmcgPSBsaXN0LmZpbHRlcigodHgpID0+ICFtYXRjaGVkU2V0Lmhhcyh0eCkpO1xuICAgICAgICBwZW5kaW5nU2V0dGxlVHhzLnNldChuZmEsIGhhcmRlbihyZW1haW5pbmcpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBlbmRpbmdTZXR0bGVUeHMuZGVsZXRlKG5mYSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oY29tYm8pO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHsgYWRkUGVuZGluZ1NldHRsZVR4LCBtYXRjaEFuZERlcXVldWVTZXR0bGVtZW50IH0pO1xufTtcblxuLy9cbnZhciBzdGF0ZVNoYXBlNCA9IGhhcmRlbih7XG4gIHBlbmRpbmdTZXR0bGVUeHM6IE0ucmVtb3RhYmxlKCksXG4gIHNlZW5UeHM6IE0ucmVtb3RhYmxlKCksXG4gIHN0b3JlZENvbXBsZXRlZFR4czogTS5yZW1vdGFibGUoKVxufSk7XG52YXIgcHJlcGFyZVN0YXR1c01hbmFnZXIgPSAoem9uZSwgdHhuc05vZGUsIHsgbWFyc2hhbGxlciwgcm91dGVIZWFsdGggfSkgPT4ge1xuICBjb25zdCBwZW5kaW5nU2V0dGxlVHhzID0gem9uZS5tYXBTdG9yZShcbiAgICBcIlBlbmRpbmdTZXR0bGVUeHNcIixcbiAgICB7XG4gICAgICBrZXlTaGFwZTogTS5zdHJpbmcoKSxcbiAgICAgIHZhbHVlU2hhcGU6IE0uYXJyYXlPZihQZW5kaW5nVHhTaGFwZSlcbiAgICB9XG4gICk7XG4gIGNvbnN0IHsgYWRkUGVuZGluZ1NldHRsZVR4LCBtYXRjaEFuZERlcXVldWVTZXR0bGVtZW50IH0gPSBtYWtlU2V0dGxlbWVudE1hdGNoZXIoKTtcbiAgY29uc3QgbWV0YTIgPSB6b25lLm1hcFN0b3JlKFwiTWV0YWRhdGFcIiwge1xuICAgIGtleVNoYXBlOiBNLnN0cmluZygpXG4gIH0pO1xuICBjb25zdCBzY2hlbWFWZXJzaW9uID0gTmF0KFxuICAgIG1ldGEyLmhhcyhcInNjaGVtYVZlcnNpb25cIikgPyBtZXRhMi5nZXQoXCJzY2hlbWFWZXJzaW9uXCIpIDogMG5cbiAgKTtcbiAgaWYgKHNjaGVtYVZlcnNpb24gPCAxbikge1xuICAgIGNvbnN0IG9sZFZhbHVlcyA9IFsuLi5wZW5kaW5nU2V0dGxlVHhzLnZhbHVlcygpXTtcbiAgICBwZW5kaW5nU2V0dGxlVHhzLmNsZWFyKCk7XG4gICAgZm9yIChjb25zdCB0eHMgb2Ygb2xkVmFsdWVzKSB7XG4gICAgICBmb3IgKGNvbnN0IHR4IG9mIHR4cykge1xuICAgICAgICBhZGRQZW5kaW5nU2V0dGxlVHgocGVuZGluZ1NldHRsZVR4cywgdHgpO1xuICAgICAgfVxuICAgIH1cbiAgICBtZXRhMi5pbml0KFwic2NoZW1hVmVyc2lvblwiLCAxbik7XG4gIH1cbiAgY29uc3Qgc2VlblR4cyA9IHpvbmUubWFwU3RvcmUoXCJTZWVuVHhzXCIsIHtcbiAgICBrZXlTaGFwZTogTS5zdHJpbmcoKSxcbiAgICB2YWx1ZVNoYXBlOiBNLm5hdCgpXG4gIH0pO1xuICBjb25zdCBmYWlsZWRGb3J3YXJkcyA9IHpvbmUubWFwU3RvcmUoXG4gICAgXCJGYWlsZWRGb3J3YXJkc1wiLFxuICAgIHtcbiAgICAgIGtleVNoYXBlOiBFdm1IYXNoU2hhcGUsXG4gICAgICB2YWx1ZVNoYXBlOiBGb3J3YXJkRmFpbGVkVHhTaGFwZVxuICAgIH1cbiAgKTtcbiAgY29uc3QgZm9yd2FyZEluUHJvZ3Jlc3MgPSB6b25lLnNldFN0b3JlKFxuICAgIFwiRm9yd2FyZEluUHJvZ3Jlc3NcIixcbiAgICB7XG4gICAgICBrZXlTaGFwZTogTS5zdHJpbmcoKVxuICAgIH1cbiAgKTtcbiAgY29uc3Qgc3RvcmVkQ29tcGxldGVkVHhzID0gem9uZS5zZXRTdG9yZShcbiAgICBcIlN0b3JlZENvbXBsZXRlZFR4c1wiLFxuICAgIHtcbiAgICAgIGtleVNoYXBlOiBNLnN0cmluZygpXG4gICAgfVxuICApO1xuICBjb25zdCBub3RlUm91dGVIZWFsdGggPSAodHgsIGlzV29ya2luZykgPT4ge1xuICAgIGNvbnN0IGNoYWluSWQgPSBjaGFpbk9mQWNjb3VudCh0eC5kZXN0aW5hdGlvbik7XG4gICAgaWYgKGlzV29ya2luZykge1xuICAgICAgcm91dGVIZWFsdGgubm90ZVN1Y2Nlc3MoY2hhaW5JZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvdXRlSGVhbHRoLm5vdGVGYWlsdXJlKGNoYWluSWQpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgcHVibGlzaFR4blJlY29yZCA9ICh0eElkLCByZWNvcmQpID0+IHtcbiAgICBjb25zdCB0eE5vZGUgPSBFKHR4bnNOb2RlKS5tYWtlQ2hpbGROb2RlKHR4SWQsIHtcbiAgICAgIHNlcXVlbmNlOiB0cnVlXG4gICAgICAvL1xuICAgIH0pO1xuICAgIGlmIChyZWNvcmQuc3RhdHVzICYmIFRlcm1pbmFsVHhTdGF0dXNbcmVjb3JkLnN0YXR1c10pIHtcbiAgICAgIHN0b3JlZENvbXBsZXRlZFR4cy5hZGQodHhJZCk7XG4gICAgfVxuICAgIHZvaWQgRS53aGVuKFxuICAgICAgRShtYXJzaGFsbGVyKS50b0NhcERhdGEocmVjb3JkKSxcbiAgICAgIChjYXBEYXRhKSA9PiBFKHR4Tm9kZSkuc2V0VmFsdWUoSlNPTi5zdHJpbmdpZnkoY2FwRGF0YSkpXG4gICAgKTtcbiAgfTtcbiAgY29uc3QgcHVibGlzaEV2aWRlbmNlID0gKGhhc2gsIGV2aWRlbmNlKSA9PiB7XG4gICAgcHVibGlzaFR4blJlY29yZChoYXNoLCBoYXJkZW4oeyBldmlkZW5jZSwgc3RhdHVzOiBUeFN0YXR1cy5PYnNlcnZlZCB9KSk7XG4gIH07XG4gIGNvbnN0IGluaXRQZW5kaW5nVHggPSAoZXZpZGVuY2UsIHN0YXR1cywgcmlza3NJZGVudGlmaWVkKSA9PiB7XG4gICAgY29uc3QgeyB0eEhhc2ggfSA9IGV2aWRlbmNlO1xuICAgIGlmIChzZWVuVHhzLmhhcyh0eEhhc2gpKSB7XG4gICAgICB0aHJvdyBtYWtlRXJyb3IoYFRyYW5zYWN0aW9uIGFscmVhZHkgc2VlbjogJHtxdW90ZSh0eEhhc2gpfWApO1xuICAgIH1cbiAgICBzZWVuVHhzLmluaXQodHhIYXNoLCBldmlkZW5jZS5ibG9ja1RpbWVzdGFtcCk7XG4gICAgYWRkUGVuZGluZ1NldHRsZVR4KHBlbmRpbmdTZXR0bGVUeHMsIHsgLi4uZXZpZGVuY2UsIHN0YXR1cyB9KTtcbiAgICBwdWJsaXNoRXZpZGVuY2UodHhIYXNoLCBldmlkZW5jZSk7XG4gICAgaWYgKHN0YXR1cyA9PT0gUGVuZGluZ1R4U3RhdHVzLkFkdmFuY2VTa2lwcGVkKSB7XG4gICAgICBwdWJsaXNoVHhuUmVjb3JkKHR4SGFzaCwgaGFyZGVuKHsgc3RhdHVzLCByaXNrc0lkZW50aWZpZWQgfSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwdWJsaXNoVHhuUmVjb3JkKHR4SGFzaCwgaGFyZGVuKHsgc3RhdHVzIH0pKTtcbiAgICB9XG4gIH07XG4gIGZ1bmN0aW9uIHNldFBlbmRpbmdUeFN0YXR1cyh7IG5mYSwgYW1vdW50IH0sIHN0YXR1cykge1xuICAgIGNvbnN0IHBlbmRpbmcgPSBwZW5kaW5nU2V0dGxlVHhzLmdldChuZmEpO1xuICAgIGNvbnN0IGl4ID0gcGVuZGluZy5maW5kSW5kZXgoXG4gICAgICAodHgyKSA9PiB0eDIuc3RhdHVzID09PSBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jaW5nICYmIHR4Mi50eC5hbW91bnQgPT09IGFtb3VudFxuICAgICk7XG4gICAgaXggPj0gMCB8fCB0aHJvd1JlZGFjdGVkYG5vIGFkdmFuY2luZyB0eCB3aXRoICR7eyBuZmEsIGFtb3VudCB9fWA7XG4gICAgY29uc3QgW3ByZWZpeCwgdHgsIHN1ZmZpeF0gPSBbXG4gICAgICBwZW5kaW5nLnNsaWNlKDAsIGl4KSxcbiAgICAgIHBlbmRpbmdbaXhdLFxuICAgICAgcGVuZGluZy5zbGljZShpeCArIDEpXG4gICAgXTtcbiAgICBjb25zdCB0eHBvc3QgPSB7IC4uLnR4LCBzdGF0dXMgfTtcbiAgICBwZW5kaW5nU2V0dGxlVHhzLnNldChuZmEsIGhhcmRlbihbLi4ucHJlZml4LCB0eHBvc3QsIC4uLnN1ZmZpeF0pKTtcbiAgICBwdWJsaXNoVHhuUmVjb3JkKHR4LnR4SGFzaCwgaGFyZGVuKHsgc3RhdHVzIH0pKTtcbiAgfVxuICByZXR1cm4gem9uZS5leG8oXG4gICAgXCJGYXN0IFVTREMgU3RhdHVzIE1hbmFnZXJcIixcbiAgICBNLmludGVyZmFjZShcIlN0YXR1c01hbmFnZXJJXCIsIHtcbiAgICAgIC8vXG4gICAgICBhZHZhbmNlOiBNLmNhbGwoQ2N0cFR4RXZpZGVuY2VTaGFwZSkucmV0dXJucygpLFxuICAgICAgYWR2YW5jZU91dGNvbWU6IE0uY2FsbChNLnN0cmluZygpLCBNLm5hdCgpLCBNLmJvb2xlYW4oKSkub3B0aW9uYWwoTS5zcGxpdFJlY29yZCh7IGRlc3RpbmF0aW9uOiBNLnN0cmluZygpIH0pKS5yZXR1cm5zKCksXG4gICAgICBza2lwQWR2YW5jZTogTS5jYWxsKENjdHBUeEV2aWRlbmNlU2hhcGUsIE0uYXJyYXlPZihNLnN0cmluZygpKSkucmV0dXJucygpLFxuICAgICAgYWR2YW5jZU91dGNvbWVGb3JNaW50ZWRFYXJseTogTS5jYWxsKEV2bUhhc2hTaGFwZSwgTS5ib29sZWFuKCkpLnJldHVybnMoKSxcbiAgICAgIGFkdmFuY2VPdXRjb21lRm9yVW5rbm93bk1pbnQ6IE0uY2FsbChDY3RwVHhFdmlkZW5jZVNoYXBlKS5yZXR1cm5zKCksXG4gICAgICBnZXRGb3J3YXJkc1RvUmV0cnk6IE0uY2FsbChNLnN0cmluZygpKS5yZXR1cm5zKFxuICAgICAgICBNLmFycmF5T2YoRm9yd2FyZEZhaWxlZFR4U2hhcGUpXG4gICAgICApLFxuICAgICAgaGFzQmVlbk9ic2VydmVkOiBNLmNhbGwoQ2N0cFR4RXZpZGVuY2VTaGFwZSkucmV0dXJucyhNLmJvb2xlYW4oKSksXG4gICAgICBkZWxldGVDb21wbGV0ZWRUeHM6IE0uY2FsbCgpLnJldHVybnMoTS51bmRlZmluZWQoKSksXG4gICAgICBtYXRjaEFuZERlcXVldWVTZXR0bGVtZW50OiBNLmNhbGwoTS5zdHJpbmcoKSwgTS5iaWdpbnQoKSkucmV0dXJucyhcbiAgICAgICAgTS5hcnJheU9mKFxuICAgICAgICAgIE0uc3BsaXRSZWNvcmQoe1xuICAgICAgICAgICAgdHhIYXNoOiBFdm1IYXNoU2hhcGUsXG4gICAgICAgICAgICBzdGF0dXM6IE0ub3IoLi4uT2JqZWN0LnZhbHVlcyhQZW5kaW5nVHhTdGF0dXMpKVxuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgICksXG4gICAgICBkaXNidXJzZWQ6IE0uY2FsbChFdm1IYXNoU2hhcGUsIEFtb3VudEtleXdvcmRSZWNvcmRTaGFwZSkucmV0dXJucyhcbiAgICAgICAgTS51bmRlZmluZWQoKVxuICAgICAgKSxcbiAgICAgIGZvcndhcmRlZDogTS5jYWxsKEV2bUhhc2hTaGFwZSkub3B0aW9uYWwoTS5zcGxpdFJlY29yZCh7IGRlc3RpbmF0aW9uOiBNLnN0cmluZygpIH0pKS5yZXR1cm5zKCksXG4gICAgICBmb3J3YXJkRmFpbGVkOiBNLmNhbGwoRXZtSGFzaFNoYXBlKS5vcHRpb25hbChGb3J3YXJkRmFpbGVkVHhTaGFwZSkucmV0dXJucygpLFxuICAgICAgZm9yd2FyZGluZzogTS5jYWxsKEV2bUhhc2hTaGFwZSkucmV0dXJucygpLFxuICAgICAgZm9yd2FyZFNraXBwZWQ6IE0uY2FsbChFdm1IYXNoU2hhcGUpLnJldHVybnMoKSxcbiAgICAgIGxvb2t1cFBlbmRpbmc6IE0uY2FsbChNLnN0cmluZygpLCBNLmJpZ2ludCgpKS5yZXR1cm5zKFxuICAgICAgICBNLmFycmF5T2YoUGVuZGluZ1R4U2hhcGUpXG4gICAgICApXG4gICAgfSksXG4gICAge1xuICAgICAgLypcblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFkdmFuY2UoZXZpZGVuY2UpIHtcbiAgICAgICAgaW5pdFBlbmRpbmdUeChldmlkZW5jZSwgUGVuZGluZ1R4U3RhdHVzLkFkdmFuY2luZyk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgc2tpcEFkdmFuY2UoZXZpZGVuY2UsIHJpc2tzSWRlbnRpZmllZCkge1xuICAgICAgICBpbml0UGVuZGluZ1R4KFxuICAgICAgICAgIGV2aWRlbmNlLFxuICAgICAgICAgIFBlbmRpbmdUeFN0YXR1cy5BZHZhbmNlU2tpcHBlZCxcbiAgICAgICAgICByaXNrc0lkZW50aWZpZWRcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBhZHZhbmNlT3V0Y29tZShuZmEsIGFtb3VudCwgc3VjY2VzcywgdHgpIHtcbiAgICAgICAgaWYgKHR4KSB7XG4gICAgICAgICAgbm90ZVJvdXRlSGVhbHRoKHR4LCBzdWNjZXNzKTtcbiAgICAgICAgfVxuICAgICAgICBzZXRQZW5kaW5nVHhTdGF0dXMoXG4gICAgICAgICAgeyBuZmEsIGFtb3VudCB9LFxuICAgICAgICAgIHN1Y2Nlc3MgPyBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZWQgOiBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZUZhaWxlZFxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgYWR2YW5jZU91dGNvbWVGb3JNaW50ZWRFYXJseSh0eEhhc2gsIHN1Y2Nlc3MsIHR4KSB7XG4gICAgICAgIGlmICh0eCkge1xuICAgICAgICAgIG5vdGVSb3V0ZUhlYWx0aCh0eCwgc3VjY2Vzcyk7XG4gICAgICAgIH1cbiAgICAgICAgcHVibGlzaFR4blJlY29yZChcbiAgICAgICAgICB0eEhhc2gsXG4gICAgICAgICAgaGFyZGVuKHtcbiAgICAgICAgICAgIHN0YXR1czogc3VjY2VzcyA/IFBlbmRpbmdUeFN0YXR1cy5BZHZhbmNlZCA6IFBlbmRpbmdUeFN0YXR1cy5BZHZhbmNlRmFpbGVkXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBhZHZhbmNlT3V0Y29tZUZvclVua25vd25NaW50KGV2aWRlbmNlKSB7XG4gICAgICAgIGNvbnN0IHsgdHhIYXNoIH0gPSBldmlkZW5jZTtcbiAgICAgICAgaWYgKHNlZW5UeHMuaGFzKHR4SGFzaCkpIHtcbiAgICAgICAgICB0aHJvdyBtYWtlRXJyb3IoYFRyYW5zYWN0aW9uIGFscmVhZHkgc2VlbjogJHtxdW90ZSh0eEhhc2gpfWApO1xuICAgICAgICB9XG4gICAgICAgIHNlZW5UeHMuaW5pdCh0eEhhc2gsIGV2aWRlbmNlLmJsb2NrVGltZXN0YW1wKTtcbiAgICAgICAgcHVibGlzaEV2aWRlbmNlKHR4SGFzaCwgZXZpZGVuY2UpO1xuICAgICAgfSxcbiAgICAgIGdldEZvcndhcmRzVG9SZXRyeShjaGFpbklkKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlUGF0dGVybiA9IE0uc3BsaXRSZWNvcmQoeyBjaGFpbklkIH0pO1xuICAgICAgICBjb25zdCBmYWlsZWQgPSBbLi4uZmFpbGVkRm9yd2FyZHMudmFsdWVzKHZvaWQgMCwgdmFsdWVQYXR0ZXJuKV07XG4gICAgICAgIHJldHVybiBmYWlsZWQuZmlsdGVyKCh0eCkgPT4gIWZvcndhcmRJblByb2dyZXNzLmhhcyh0eC50eEhhc2gpKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgaGFzQmVlbk9ic2VydmVkKGV2aWRlbmNlKSB7XG4gICAgICAgIHJldHVybiBzZWVuVHhzLmhhcyhldmlkZW5jZS50eEhhc2gpO1xuICAgICAgfSxcbiAgICAgIC8vXG4gICAgICBkZWxldGVDb21wbGV0ZWRUeHMoKSB7XG4gICAgICAgIGZvciAoY29uc3QgdHhIYXNoIG9mIHN0b3JlZENvbXBsZXRlZFR4cy52YWx1ZXMoKSkge1xuICAgICAgICAgIGNvbnN0IHR4Tm9kZSA9IEUodHhuc05vZGUpLm1ha2VDaGlsZE5vZGUodHhIYXNoLCB7XG4gICAgICAgICAgICBzZXF1ZW5jZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB2b2lkIEUodHhOb2RlKS5zZXRWYWx1ZShcIlwiKS50aGVuKCgpID0+IHN0b3JlZENvbXBsZXRlZFR4cy5kZWxldGUodHhIYXNoKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgbWF0Y2hBbmREZXF1ZXVlU2V0dGxlbWVudChuZmEsIGFtb3VudCkge1xuICAgICAgICByZXR1cm4gbWF0Y2hBbmREZXF1ZXVlU2V0dGxlbWVudChwZW5kaW5nU2V0dGxlVHhzLCBuZmEsIGFtb3VudCk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgZGlzYnVyc2VkKHR4SGFzaCwgc3BsaXQpIHtcbiAgICAgICAgcHVibGlzaFR4blJlY29yZCh0eEhhc2gsIGhhcmRlbih7IHNwbGl0LCBzdGF0dXM6IFR4U3RhdHVzLkRpc2J1cnNlZCB9KSk7XG4gICAgICB9LFxuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBmb3J3YXJkaW5nKHR4SGFzaCkge1xuICAgICAgICBpZiAoZm9yd2FyZEluUHJvZ3Jlc3MuaGFzKHR4SGFzaCkpIHtcbiAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFRyYW5zYWN0aW9uIGFscmVhZHkgaW4gcHJvZ3Jlc3M6ICR7cXVvdGUodHhIYXNoKX1gO1xuICAgICAgICB9XG4gICAgICAgIGZvcndhcmRJblByb2dyZXNzLmFkZCh0eEhhc2gpO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBmb3J3YXJkZWQodHhIYXNoLCB0eCkge1xuICAgICAgICBpZiAoZm9yd2FyZEluUHJvZ3Jlc3MuaGFzKHR4SGFzaCkpIHtcbiAgICAgICAgICBmb3J3YXJkSW5Qcm9ncmVzcy5kZWxldGUodHhIYXNoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICBgVHJhbnNhY3Rpb24gJHt0eEhhc2h9IGZvcndhcmRlZCB3aXRob3V0IGJlaW5nIG1hcmtlZCBhcyBpbiBwcm9ncmVzc2BcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eCkge1xuICAgICAgICAgIGlmIChmYWlsZWRGb3J3YXJkcy5oYXModHhIYXNoKSkge1xuICAgICAgICAgICAgZmFpbGVkRm9yd2FyZHMuZGVsZXRlKHR4SGFzaCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG5vdGVSb3V0ZUhlYWx0aCh0eCwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcHVibGlzaFR4blJlY29yZChcbiAgICAgICAgICB0eEhhc2gsXG4gICAgICAgICAgaGFyZGVuKHtcbiAgICAgICAgICAgIHN0YXR1czogVHhTdGF0dXMuRm9yd2FyZGVkXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgZm9yd2FyZEZhaWxlZCh0eEhhc2gsIHR4KSB7XG4gICAgICAgIGlmIChmb3J3YXJkSW5Qcm9ncmVzcy5oYXModHhIYXNoKSkge1xuICAgICAgICAgIGZvcndhcmRJblByb2dyZXNzLmRlbGV0ZSh0eEhhc2gpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgIGBUcmFuc2FjdGlvbiAke3R4SGFzaH0gZm9yd2FyZCBmYWlsZWQgd2l0aG91dCBiZWluZyBtYXJrZWQgYXMgaW4gcHJvZ3Jlc3NgXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHgpIHtcbiAgICAgICAgICB0eC50eEhhc2ggPT09IHR4SGFzaCB8fCB0aHJvd1JlZGFjdGVkYHR4SGFzaCBtaXNtYXRjaCBpbiBmb3J3YXJkRmFpbGVkYDtcbiAgICAgICAgICBjb25zdCBjaGFpbklkID0gY2hhaW5PZkFjY291bnQodHguZGVzdGluYXRpb24pO1xuICAgICAgICAgIGlmICghZmFpbGVkRm9yd2FyZHMuaGFzKHR4SGFzaCkpIHtcbiAgICAgICAgICAgIGZhaWxlZEZvcndhcmRzLmluaXQodHgudHhIYXNoLCBoYXJkZW4oeyAuLi50eCwgY2hhaW5JZCB9KSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG5vdGVSb3V0ZUhlYWx0aCh0eCwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIHB1Ymxpc2hUeG5SZWNvcmQoXG4gICAgICAgICAgdHhIYXNoLFxuICAgICAgICAgIGhhcmRlbih7XG4gICAgICAgICAgICBzdGF0dXM6IFR4U3RhdHVzLkZvcndhcmRGYWlsZWRcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBmb3J3YXJkU2tpcHBlZCh0eEhhc2gpIHtcbiAgICAgICAgcHVibGlzaFR4blJlY29yZChcbiAgICAgICAgICB0eEhhc2gsXG4gICAgICAgICAgaGFyZGVuKHtcbiAgICAgICAgICAgIHN0YXR1czogXCJGT1JXQVJEX1NLSVBQRURcIlxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuICAgICAgICovXG4gICAgICBsb29rdXBQZW5kaW5nKG5mYSwgYW1vdW50KSB7XG4gICAgICAgIGlmICghcGVuZGluZ1NldHRsZVR4cy5oYXMobmZhKSkge1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oW10pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBlbmRpbmdUeHMgPSBwZW5kaW5nU2V0dGxlVHhzLmdldChuZmEpO1xuICAgICAgICByZXR1cm4gaGFyZGVuKHBlbmRpbmdUeHMuZmlsdGVyKCh0eCkgPT4gdHgudHguYW1vdW50ID09PSBhbW91bnQpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHsgc3RhdGVTaGFwZTogc3RhdGVTaGFwZTQgfVxuICApO1xufTtcbmhhcmRlbihwcmVwYXJlU3RhdHVzTWFuYWdlcik7XG5cbi8vXG52YXIgSU5WSVRBVElPTl9NQUtFUlNfREVTQyA9IFwib3JhY2xlIG9wZXJhdG9yIGludml0YXRpb25cIjtcbnZhciBPcGVyYXRvcktpdEkgPSB7XG4gIGFkbWluOiBNLmludGVyZmFjZShcIkFkbWluXCIsIHtcbiAgICBkaXNhYmxlOiBNLmNhbGwoKS5yZXR1cm5zKClcbiAgfSksXG4gIGludml0YXRpb25NYWtlcnM6IE0uaW50ZXJmYWNlKFwiSW52aXRhdGlvbk1ha2Vyc1wiLCB7XG4gICAgU3VibWl0RXZpZGVuY2U6IE0uY2FsbChDY3RwVHhFdmlkZW5jZVNoYXBlKS5vcHRpb25hbChSaXNrQXNzZXNzbWVudFNoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICB9KSxcbiAgb3BlcmF0b3I6IE0uaW50ZXJmYWNlKFwiT3BlcmF0b3JcIiwge1xuICAgIHN1Ym1pdEV2aWRlbmNlOiBNLmNhbGwoQ2N0cFR4RXZpZGVuY2VTaGFwZSkub3B0aW9uYWwoUmlza0Fzc2Vzc21lbnRTaGFwZSkucmV0dXJucygpLFxuICAgIGdldFN0YXR1czogTS5jYWxsKCkucmV0dXJucyhNLnJlY29yZCgpKVxuICB9KVxufTtcblxuLy9cbnZhciB0cmFjZTExID0gbWFrZVRyYWNlcihcIlpvZVV0aWxzXCIpO1xudmFyIGRlZmluZUluZXJ0SW52aXRhdGlvbiA9ICh6Y2YsIGRlc2NyaXB0aW9uKSA9PiB7XG4gIHJldHVybiAoKSA9PiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICB0cmFjZTExKGBcXHUyMTM5XFx1RkUwRiBBbiBvZmZlciB3YXMgbWFkZSBvbiBhbiBpbmVydCBpbnZpdGF0aW9uIGZvciAke2Rlc2NyaXB0aW9ufWApO1xuICAgIHNlYXQuZXhpdCgpO1xuICAgIHJldHVybiBcImluZXJ0OyBub3RoaW5nIHNob3VsZCBiZSBleHBlY3RlZCBmcm9tIHRoaXMgb2ZmZXJcIjtcbiAgfSwgZGVzY3JpcHRpb24pO1xufTtcblxuLy9cbnZhciB0cmFjZTEyID0gbWFrZVRyYWNlcihcIlR4T3BlcmF0b3JcIik7XG52YXIgcHJlcGFyZU9wZXJhdG9yS2l0ID0gKHpvbmUsIHN0YXRpY1Bvd2VycykgPT4gem9uZS5leG9DbGFzc0tpdChcbiAgXCJPcGVyYXRvciBLaXRcIixcbiAgT3BlcmF0b3JLaXRJLFxuICAvKlxuXG5cbiAgICovXG4gIChvcGVyYXRvcklkLCBwb3dlcnMpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgb3BlcmF0b3JJZCxcbiAgICAgIHBvd2VycyxcbiAgICAgIGRpc2FibGVkOiBmYWxzZVxuICAgIH07XG4gIH0sXG4gIHtcbiAgICBhZG1pbjoge1xuICAgICAgZGlzYWJsZSgpIHtcbiAgICAgICAgdHJhY2UxMihgb3BlcmF0b3IgJHt0aGlzLnN0YXRlLm9wZXJhdG9ySWR9IGRpc2FibGVkYCk7XG4gICAgICAgIHRoaXMuc3RhdGUuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0sXG4gICAgLypcblxuXG4gICAgICovXG4gICAgaW52aXRhdGlvbk1ha2Vyczoge1xuICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgU3VibWl0RXZpZGVuY2UoZXZpZGVuY2UsIHJpc2tBc3Nlc3NtZW50KSB7XG4gICAgICAgIGNvbnN0IHsgb3BlcmF0b3IgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICBvcGVyYXRvci5zdWJtaXRFdmlkZW5jZShldmlkZW5jZSwgcmlza0Fzc2Vzc21lbnQpO1xuICAgICAgICByZXR1cm4gc3RhdGljUG93ZXJzLm1ha2VJbmVydEludml0YXRpb24oKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG9wZXJhdG9yOiB7XG4gICAgICAvKlxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHN1Ym1pdEV2aWRlbmNlKGV2aWRlbmNlLCByaXNrQXNzZXNzbWVudCA9IHt9KSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICFzdGF0ZS5kaXNhYmxlZCB8fCB0aHJvd1JlZGFjdGVkYHN1Ym1pdEV2aWRlbmNlIGZvciBkaXNhYmxlZCBvcGVyYXRvcmA7XG4gICAgICAgIHN0YXRlLnBvd2Vycy5hdHRlc3QoZXZpZGVuY2UsIHJpc2tBc3Nlc3NtZW50LCBzdGF0ZS5vcGVyYXRvcklkKTtcbiAgICAgIH0sXG4gICAgICBnZXRTdGF0dXMoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgb3BlcmF0b3JJZDogc3RhdGUub3BlcmF0b3JJZCxcbiAgICAgICAgICBkaXNhYmxlZDogc3RhdGUuZGlzYWJsZWRcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG5cbi8vXG52YXIgdHJhY2UxMyA9IG1ha2VUcmFjZXIoXCJUeEZlZWRcIiwgdHJ1ZSk7XG52YXIgVHJhbnNhY3Rpb25GZWVkS2l0SSA9IGhhcmRlbih7XG4gIG9wZXJhdG9yUG93ZXJzOiBNLmludGVyZmFjZShcIlRyYW5zYWN0aW9uIEZlZWQgQWRtaW5cIiwge1xuICAgIGF0dGVzdDogTS5jYWxsKFxuICAgICAgQ2N0cFR4RXZpZGVuY2VTaGFwZSxcbiAgICAgIFJpc2tBc3Nlc3NtZW50U2hhcGUsXG4gICAgICBNLnN0cmluZygpXG4gICAgKS5yZXR1cm5zKClcbiAgfSksXG4gIGNyZWF0b3I6IE0uaW50ZXJmYWNlKFwiVHJhbnNhY3Rpb24gRmVlZCBDcmVhdG9yXCIsIHtcbiAgICBpbml0T3BlcmF0b3I6IE0uY2FsbChNLnN0cmluZygpKS5yZXR1cm5zKHtcbiAgICAgIGludml0YXRpb25NYWtlcnM6IE0ucmVtb3RhYmxlKCksXG4gICAgICBvcGVyYXRvcjogTS5yZW1vdGFibGUoKVxuICAgIH0pLFxuICAgIG1ha2VPcGVyYXRvckludml0YXRpb246IE0uY2FsbChNLnN0cmluZygpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICByZW1vdmVPcGVyYXRvcjogTS5jYWxsKE0uc3RyaW5nKCkpLnJldHVybnMoKVxuICB9KSxcbiAgcHVibGljOiBNLmludGVyZmFjZShcIlRyYW5zYWN0aW9uIEZlZWQgUHVibGljXCIsIHtcbiAgICBnZXRFdmlkZW5jZVN1YnNjcmliZXI6IE0uY2FsbCgpLnJldHVybnMoTS5yZW1vdGFibGUoKSlcbiAgfSlcbn0pO1xudmFyIGFsbFJpc2tzSWRlbnRpZmllZCA9IChyaXNrU3RvcmVzLCB0eEhhc2gpID0+IHtcbiAgY29uc3Qgc2V0T2ZSaXNrcyA9IC8qICAgICAgICAgICAqLyBuZXcgU2V0KCk7XG4gIGZvciAoY29uc3Qgc3RvcmUgb2Ygcmlza1N0b3Jlcykge1xuICAgIGNvbnN0IG5leHQgPSBzdG9yZS5nZXQodHhIYXNoKTtcbiAgICBmb3IgKGNvbnN0IHJpc2sgb2YgbmV4dC5yaXNrc0lkZW50aWZpZWQgPz8gW10pIHtcbiAgICAgIHNldE9mUmlza3MuYWRkKHJpc2spO1xuICAgIH1cbiAgfVxuICByZXR1cm4gWy4uLnNldE9mUmlza3MudmFsdWVzKCldLnNvcnQoKTtcbn07XG52YXIgc3RhdGVTaGFwZTUgPSB7XG4gIG9wZXJhdG9yczogTS5yZW1vdGFibGUoKSxcbiAgcGVuZGluZzogTS5yZW1vdGFibGUoKSxcbiAgcmlza3M6IE0ucmVtb3RhYmxlKClcbn07XG5oYXJkZW4oc3RhdGVTaGFwZTUpO1xudmFyIHByZXBhcmVUcmFuc2FjdGlvbkZlZWRLaXQgPSAoem9uZSwgemNmKSA9PiB7XG4gIGNvbnN0IGtpbmRzID0gem9uZS5tYXBTdG9yZShcIktpbmRzXCIpO1xuICBjb25zdCBtYWtlRHVyYWJsZVB1Ymxpc2hLaXQgPSBwcmVwYXJlRHVyYWJsZVB1Ymxpc2hLaXQoXG4gICAga2luZHMsXG4gICAgXCJUcmFuc2FjdGlvbiBGZWVkXCJcbiAgKTtcbiAgY29uc3QgeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSA9IG1ha2VEdXJhYmxlUHVibGlzaEtpdCgpO1xuICBjb25zdCBtYWtlSW5lcnRJbnZpdGF0aW9uID0gZGVmaW5lSW5lcnRJbnZpdGF0aW9uKHpjZiwgXCJzdWJtaXR0aW5nIGV2aWRlbmNlXCIpO1xuICBjb25zdCBtYWtlT3BlcmF0b3JLaXQgPSBwcmVwYXJlT3BlcmF0b3JLaXQoem9uZSwge1xuICAgIG1ha2VJbmVydEludml0YXRpb25cbiAgfSk7XG4gIHJldHVybiB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiRmFzdCBVU0RDIEZlZWRcIixcbiAgICBUcmFuc2FjdGlvbkZlZWRLaXRJLFxuICAgICgpID0+IHtcbiAgICAgIGNvbnN0IG9wZXJhdG9ycyA9IHpvbmUubWFwU3RvcmUoXCJvcGVyYXRvcnNcIik7XG4gICAgICBjb25zdCBwZW5kaW5nID0gem9uZS5tYXBTdG9yZShcbiAgICAgICAgXCJwZW5kaW5nXCJcbiAgICAgICk7XG4gICAgICBjb25zdCByaXNrcyA9IHpvbmUubWFwU3RvcmUoXG4gICAgICAgIFwicmlza3NcIlxuICAgICAgKTtcbiAgICAgIHJldHVybiB7IG9wZXJhdG9ycywgcGVuZGluZywgcmlza3MgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGNyZWF0b3I6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBtYWtlT3BlcmF0b3JJbnZpdGF0aW9uKG9wZXJhdG9ySWQpIHtcbiAgICAgICAgICBjb25zdCB7IGNyZWF0b3IgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIHRyYWNlMTMoXCJtYWtlT3BlcmF0b3JJbnZpdGF0aW9uXCIsIG9wZXJhdG9ySWQpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIGNyZWF0b3IuaW5pdE9wZXJhdG9yKG9wZXJhdG9ySWQpO1xuICAgICAgICAgIH0sIElOVklUQVRJT05fTUFLRVJTX0RFU0MpO1xuICAgICAgICB9LFxuICAgICAgICBpbml0T3BlcmF0b3Iob3BlcmF0b3JJZCkge1xuICAgICAgICAgIGNvbnN0IHsgb3BlcmF0b3JzLCBwZW5kaW5nLCByaXNrcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB0cmFjZTEzKFwiaW5pdE9wZXJhdG9yXCIsIG9wZXJhdG9ySWQpO1xuICAgICAgICAgIGNvbnN0IG9wZXJhdG9yS2l0ID0gbWFrZU9wZXJhdG9yS2l0KFxuICAgICAgICAgICAgb3BlcmF0b3JJZCxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLm9wZXJhdG9yUG93ZXJzXG4gICAgICAgICAgKTtcbiAgICAgICAgICBvcGVyYXRvcnMuaW5pdChvcGVyYXRvcklkLCBvcGVyYXRvcktpdCk7XG4gICAgICAgICAgcGVuZGluZy5pbml0KFxuICAgICAgICAgICAgb3BlcmF0b3JJZCxcbiAgICAgICAgICAgIHpvbmUuZGV0YWNoZWQoKS5tYXBTdG9yZShcInBlbmRpbmcgZXZpZGVuY2VcIilcbiAgICAgICAgICApO1xuICAgICAgICAgIHJpc2tzLmluaXQob3BlcmF0b3JJZCwgem9uZS5kZXRhY2hlZCgpLm1hcFN0b3JlKFwicmlzayBhc3Nlc3NtZW50c1wiKSk7XG4gICAgICAgICAgY29uc3QgeyBpbnZpdGF0aW9uTWFrZXJzLCBvcGVyYXRvciB9ID0gb3BlcmF0b3JLaXQ7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGludml0YXRpb25NYWtlcnMsXG4gICAgICAgICAgICBvcGVyYXRvclxuICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIHJlbW92ZU9wZXJhdG9yKG9wZXJhdG9ySWQpIHtcbiAgICAgICAgICBjb25zdCB7IG9wZXJhdG9ycywgcGVuZGluZywgcmlza3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgdHJhY2UxMyhcInJlbW92ZU9wZXJhdG9yXCIsIG9wZXJhdG9ySWQpO1xuICAgICAgICAgIGNvbnN0IG9wZXJhdG9yS2l0ID0gb3BlcmF0b3JzLmdldChvcGVyYXRvcklkKTtcbiAgICAgICAgICBvcGVyYXRvcktpdC5hZG1pbi5kaXNhYmxlKCk7XG4gICAgICAgICAgb3BlcmF0b3JzLmRlbGV0ZShvcGVyYXRvcklkKTtcbiAgICAgICAgICBwZW5kaW5nLmRlbGV0ZShvcGVyYXRvcklkKTtcbiAgICAgICAgICByaXNrcy5kZWxldGUob3BlcmF0b3JJZCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvcGVyYXRvclBvd2Vyczoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBhdHRlc3QoZXZpZGVuY2UsIHJpc2tBc3Nlc3NtZW50LCBvcGVyYXRvcklkKSB7XG4gICAgICAgICAgY29uc3QgeyBvcGVyYXRvcnMsIHBlbmRpbmcsIHJpc2tzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHRyYWNlMTMoXCJhdHRlc3RcIiwgb3BlcmF0b3JJZCwgZXZpZGVuY2UpO1xuICAgICAgICAgIGNvbnN0IHsgdHhIYXNoIH0gPSBldmlkZW5jZTtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCBwZW5kaW5nU3RvcmUgPSBwZW5kaW5nLmdldChvcGVyYXRvcklkKTtcbiAgICAgICAgICAgIGlmIChwZW5kaW5nU3RvcmUuaGFzKHR4SGFzaCkpIHtcbiAgICAgICAgICAgICAgdHJhY2UxMyhgb3BlcmF0b3IgJHtvcGVyYXRvcklkfSBhbHJlYWR5IHJlcG9ydGVkICR7dHhIYXNofWApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcGVuZGluZ1N0b3JlLmluaXQodHhIYXNoLCBldmlkZW5jZSk7XG4gICAgICAgICAgICAgIGNvbnN0IHJpc2tTdG9yZSA9IHJpc2tzLmdldChvcGVyYXRvcklkKTtcbiAgICAgICAgICAgICAgcmlza1N0b3JlLmluaXQodHhIYXNoLCByaXNrQXNzZXNzbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGZvdW5kID0gWy4uLnBlbmRpbmcudmFsdWVzKCldLmZpbHRlcihcbiAgICAgICAgICAgIChzdG9yZSkgPT4gc3RvcmUuaGFzKHR4SGFzaClcbiAgICAgICAgICApO1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGxldCBsYXN0RXZpZGVuY2U7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHN0b3JlIG9mIGZvdW5kKSB7XG4gICAgICAgICAgICAgIGNvbnN0IG5leHQgPSBzdG9yZS5nZXQodHhIYXNoKTtcbiAgICAgICAgICAgICAgaWYgKGxhc3RFdmlkZW5jZSAmJiAha2V5RVEobGFzdEV2aWRlbmNlLCBuZXh0KSkge1xuICAgICAgICAgICAgICAgIHRyYWNlMTMoXG4gICAgICAgICAgICAgICAgICBcIlxcdXsxRjZBOH0gY29uZmxpY3RpbmcgZXZpZGVuY2UgZm9yXCIsXG4gICAgICAgICAgICAgICAgICB0eEhhc2gsXG4gICAgICAgICAgICAgICAgICBcIjpcIixcbiAgICAgICAgICAgICAgICAgIGxhc3RFdmlkZW5jZSxcbiAgICAgICAgICAgICAgICAgIFwiIT1cIixcbiAgICAgICAgICAgICAgICAgIG5leHRcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHRocm93UmVkYWN0ZWRgY29uZmxpY3RpbmcgZXZpZGVuY2UgZm9yICR7cXVvdGUodHhIYXNoKX1gO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGxhc3RFdmlkZW5jZSA9IG5leHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IG1pbkF0dGVzdGF0aW9ucyA9IE1hdGguY2VpbChvcGVyYXRvcnMuZ2V0U2l6ZSgpIC8gMik7XG4gICAgICAgICAgdHJhY2UxMyhcbiAgICAgICAgICAgIFwidHJhbnNhY3Rpb25cIixcbiAgICAgICAgICAgIHR4SGFzaCxcbiAgICAgICAgICAgIFwiaGFzXCIsXG4gICAgICAgICAgICBmb3VuZC5sZW5ndGgsXG4gICAgICAgICAgICBcIm9mXCIsXG4gICAgICAgICAgICBtaW5BdHRlc3RhdGlvbnMsXG4gICAgICAgICAgICBcIm5lY2Vzc2FyeSBhdHRlc3RhdGlvbnNcIlxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKGZvdW5kLmxlbmd0aCA8IG1pbkF0dGVzdGF0aW9ucykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCByaXNrU3RvcmVzID0gWy4uLnJpc2tzLnZhbHVlcygpXS5maWx0ZXIoXG4gICAgICAgICAgICAoc3RvcmUpID0+IHN0b3JlLmhhcyh0eEhhc2gpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoZm91bmQubGVuZ3RoID09PSBtaW5BdHRlc3RhdGlvbnMpIHtcbiAgICAgICAgICAgIGNvbnN0IHJpc2tzSWRlbnRpZmllZCA9IGFsbFJpc2tzSWRlbnRpZmllZChyaXNrU3RvcmVzLCB0eEhhc2gpO1xuICAgICAgICAgICAgdHJhY2UxMyhcInB1Ymxpc2hpbmcgZXZpZGVuY2VcIiwgZXZpZGVuY2UsIHJpc2tzSWRlbnRpZmllZCk7XG4gICAgICAgICAgICBwdWJsaXNoZXIucHVibGlzaCh7XG4gICAgICAgICAgICAgIGV2aWRlbmNlLFxuICAgICAgICAgICAgICByaXNrOiB7IHJpc2tzSWRlbnRpZmllZCB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGZvdW5kLmxlbmd0aCA9PT0gcGVuZGluZy5nZXRTaXplKCkpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3Qgc3RvcmUgb2YgZm91bmQpIHtcbiAgICAgICAgICAgICAgc3RvcmUuZGVsZXRlKHR4SGFzaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHN0b3JlIG9mIHJpc2tTdG9yZXMpIHtcbiAgICAgICAgICAgICAgc3RvcmUuZGVsZXRlKHR4SGFzaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcHVibGljOiB7XG4gICAgICAgIGdldEV2aWRlbmNlU3Vic2NyaWJlcjogKCkgPT4gc3Vic2NyaWJlclxuICAgICAgfVxuICAgIH0sXG4gICAgeyBzdGF0ZVNoYXBlOiBzdGF0ZVNoYXBlNSB9XG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVUcmFuc2FjdGlvbkZlZWRLaXQpO1xuXG4vL1xudmFyIHN0YXJ0Rm9yd2FyZFJldHJpZXIgPSAoe1xuICBnZXRGb3J3YXJkc1RvUmV0cnksXG4gIGZvcndhcmRGdW5kczogZm9yd2FyZEZ1bmRzMixcbiAgbG9nID0gKCkgPT4ge1xuICB9LFxuICByb3V0ZUhlYWx0aCxcbiAgVVNEQ1xufSkgPT4ge1xuICBjb25zdCBmb3J3YXJkRmFpbGVkID0gKGZhaWxlZEZvcndhcmQpID0+IHtcbiAgICBjb25zdCB7IHR4SGFzaCwgYW1vdW50OiBhbXRWYWx1ZSwgZGVzdGluYXRpb24gfSA9IGZhaWxlZEZvcndhcmQ7XG4gICAgY29uc3QgYW1vdW50ID0gQW1vdW50TWF0aC5tYWtlKFVTREMsIGFtdFZhbHVlKTtcbiAgICB2b2lkIGZvcndhcmRGdW5kczIoe1xuICAgICAgdHhIYXNoLFxuICAgICAgYW1vdW50LFxuICAgICAgZGVzdGluYXRpb25cbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgYXR0ZW1wdFRvQ2xlYXIgPSAoY2hhaW4pID0+IHtcbiAgICBjb25zdCBmYWlsZWRGb3J3YXJkcyA9IGdldEZvcndhcmRzVG9SZXRyeShjaGFpbik7XG4gICAgaWYgKCFmYWlsZWRGb3J3YXJkcy5sZW5ndGgpIHtcbiAgICAgIGxvZyhgTm8gZmFpbGVkIGZvcndhcmRzIHRvIGNsZWFyIGZvciAke2NoYWlufWApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsb2coXG4gICAgICBgQXR0ZW1wdGluZyB0byBjbGVhciAke2ZhaWxlZEZvcndhcmRzLmxlbmd0aH0gZmFpbGVkIGZvcndhcmRzIGZvciAke2NoYWlufWBcbiAgICApO1xuICAgIGZvciAoY29uc3QgZmFpbGVkRm9yd2FyZCBvZiBmYWlsZWRGb3J3YXJkcykge1xuICAgICAgaWYgKCFyb3V0ZUhlYWx0aC5pc1dvcmtpbmcoY2hhaW4pKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgZm9yd2FyZEZhaWxlZChmYWlsZWRGb3J3YXJkKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGF0dGVtcHRPbmUgPSAoY2hhaW4pID0+IHtcbiAgICBjb25zdCBmYWlsZWRGb3J3YXJkcyA9IGdldEZvcndhcmRzVG9SZXRyeShjaGFpbik7XG4gICAgaWYgKCFmYWlsZWRGb3J3YXJkcy5sZW5ndGgpIHtcbiAgICAgIGxvZyhgTm8gZmFpbGVkIGZvcndhcmRzIHRvIHRyeSBmb3IgJHtjaGFpbn1gKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbG9nKFxuICAgICAgYFJldHJ5aW5nIG9uZSBvZiAke2ZhaWxlZEZvcndhcmRzLmxlbmd0aH0gZmFpbGVkIGZvcndhcmRzIGZvciAke2NoYWlufWBcbiAgICApO1xuICAgIGZvcndhcmRGYWlsZWQoZmFpbGVkRm9yd2FyZHNbMF0pO1xuICB9O1xuICBjb25zdCBvbkVhY2hGYWlsdXJlID0gKGNoYWluKSA9PiB7XG4gICAgbG9nKGBSb3V0ZSAke2NoYWlufSBmYWlsZWQuYCk7XG4gICAgaWYgKHJvdXRlSGVhbHRoLmlzV29ya2luZyhjaGFpbikpIHtcbiAgICAgIGF0dGVtcHRPbmUoY2hhaW4pO1xuICAgIH1cbiAgfTtcbiAgY29uc3Qgb25Xb3JraW5nID0gKGNoYWluKSA9PiB7XG4gICAgbG9nKGBSb3V0ZSAke2NoYWlufSBpcyB3b3JraW5nIGFnYWluLmApO1xuICAgIGF0dGVtcHRUb0NsZWFyKGNoYWluKTtcbiAgfTtcbiAgY29uc3Qgb25EZXJlbGljdCA9IChjaGFpbikgPT4gbG9nKFxuICAgIGBSb3V0ZSAke2NoYWlufSBpcyBkZXJlbGljdC4gQSBzdWNjZXNzZnVsIHRyYW5zZmVyIG11c3QgYmUgb2JzZXJ2ZWQgZm9yIGZhaWxlZCBmb3J3YXJkcyB0byBiZSByZWF0dGVtcHRlZC5gXG4gICk7XG4gIHJvdXRlSGVhbHRoLnNldEV2ZW50SGFuZGxlcnMoe1xuICAgIG9uRWFjaEZhaWx1cmUsXG4gICAgb25Xb3JraW5nLFxuICAgIG9uRGVyZWxpY3RcbiAgfSk7XG59O1xuXG4vL1xudmFyIHRyYWNlMTQgPSBtYWtlVHJhY2VyKFwiRmFzdFVzZGNcIik7XG52YXIgTUFYX1JPVVRFX0ZBSUxVUkVTID0gNjtcbnZhciBUWE5TX05PREUgPSBcInR4bnNcIjtcbnZhciBGRUVfTk9ERSA9IFwiZmVlQ29uZmlnXCI7XG52YXIgQUREUkVTU0VTX0JBR0dBR0VfS0VZID0gXCJhZGRyZXNzZXNcIjtcbnZhciBOT0JMRV9JQ0FfQkFHR0FHRV9LRVkgPSBcIm5vYmxlSUNBXCI7XG52YXIgJGPNj19tZXRhPXtcbiAgY3VzdG9tVGVybXNTaGFwZTogRmFzdFVTRENUZXJtc1NoYXBlLFxuICBwcml2YXRlQXJnc1NoYXBlOiB7XG4gICAgLy9cbiAgICAuLi5PcmNoZXN0cmF0aW9uUG93ZXJzU2hhcGUsXG4gICAgYXNzZXRJbmZvOiBNLmFycmF5T2YoW0Rlbm9tU2hhcGUsIERlbm9tRGV0YWlsU2hhcGVdKSxcbiAgICBjaGFpbkluZm86IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgQ29zbW9zQ2hhaW5JbmZvU2hhcGVWMSksXG4gICAgZmVlQ29uZmlnOiBGZWVDb25maWdTaGFwZSxcbiAgICBtYXJzaGFsbGVyOiBNLnJlbW90YWJsZSgpLFxuICAgIHBvb2xNZXRyaWNzTm9kZTogTS5yZW1vdGFibGUoKVxuICB9XG59O21ldGE9JGPNj19tZXRhO1xuaGFyZGVuKG1ldGEpO1xudmFyIHB1Ymxpc2hGZWVDb25maWcgPSAobm9kZSwgbWFyc2hhbGxlciwgZmVlQ29uZmlnKSA9PiB7XG4gIGNvbnN0IGZlZU5vZGUgPSBFKG5vZGUpLm1ha2VDaGlsZE5vZGUoRkVFX05PREUpO1xuICB2b2lkIEUud2hlbihcbiAgICBFKG1hcnNoYWxsZXIpLnRvQ2FwRGF0YShmZWVDb25maWcpLFxuICAgICh2YWx1ZSkgPT4gRShmZWVOb2RlKS5zZXRWYWx1ZShKU09OLnN0cmluZ2lmeSh2YWx1ZSkpXG4gICk7XG59O1xudmFyIHB1Ymxpc2hBZGRyZXNzZXMgPSAoY29udHJhY3ROb2RlLCBhZGRyZXNzZXMpID0+IHtcbiAgcmV0dXJuIEUoY29udHJhY3ROb2RlKS5zZXRWYWx1ZShKU09OLnN0cmluZ2lmeShhZGRyZXNzZXMpKTtcbn07XG52YXIgJGPNj19jb250cmFjdD1hc3luYyh6Y2YscHJpdmF0ZUFyZ3MsIHpvbmUsIHRvb2xzKSA9PiB7XG4gIGFzc2VydCh0b29scywgXCJubyB0b29sc1wiKTtcbiAgY29uc3QgdGVybXMgPSB6Y2YuZ2V0VGVybXMoKTtcbiAgYXNzZXJ0KFwiVVNEQ1wiIGluIHRlcm1zLmJyYW5kcywgXCJubyBVU0RDIGJyYW5kXCIpO1xuICBhc3NlcnQoXCJ1c2RjRGVub21cIiBpbiB0ZXJtcywgXCJubyB1c2RjRGVub21cIik7XG4gIGNvbnN0IHsgZmVlQ29uZmlnLCBtYXJzaGFsbGVyLCBzdG9yYWdlTm9kZSB9ID0gcHJpdmF0ZUFyZ3M7XG4gIGNvbnN0IHsgbWFrZVJlY29yZGVyS2l0IH0gPSBwcmVwYXJlUmVjb3JkZXJLaXRNYWtlcnMoXG4gICAgem9uZS5tYXBTdG9yZShcInZzdG9yYWdlXCIpLFxuICAgIG1hcnNoYWxsZXJcbiAgKTtcbiAgY29uc3Qgcm91dGVIZWFsdGggPSBtYWtlUm91dGVIZWFsdGgoTUFYX1JPVVRFX0ZBSUxVUkVTKTtcbiAgY29uc3Qgc3RhdHVzTWFuYWdlciA9IHByZXBhcmVTdGF0dXNNYW5hZ2VyKFxuICAgIHpvbmUsXG4gICAgRShzdG9yYWdlTm9kZSkubWFrZUNoaWxkTm9kZShUWE5TX05PREUpLFxuICAgIHsgbWFyc2hhbGxlciwgcm91dGVIZWFsdGggfVxuICApO1xuICBjb25zdCB7IFVTREMgfSA9IHRlcm1zLmJyYW5kcztcbiAgY29uc3QgeyB3aXRoZHJhd1RvU2VhdCB9ID0gdG9vbHMuem9lVG9vbHM7XG4gIGNvbnN0IHsgYmFnZ2FnZSwgY2hhaW5IdWIsIG9yY2hlc3RyYXRlQWxsLCB2b3dUb29scyB9ID0gdG9vbHM7XG4gIGNvbnN0IGdldE5vYmxlSUNBID0gKCkgPT4gYmFnZ2FnZS5nZXQoTk9CTEVfSUNBX0JBR0dBR0VfS0VZKTtcbiAgY29uc3QgZmlyc3RJbmNhcm5hdGlvbktleSA9IFwiZmlyc3RJbmNhcm5hdGlvbktleVwiO1xuICBpZiAoIWJhZ2dhZ2UuaGFzKGZpcnN0SW5jYXJuYXRpb25LZXkpKSB7XG4gICAgYmFnZ2FnZS5pbml0KGZpcnN0SW5jYXJuYXRpb25LZXksIHRydWUpO1xuICAgIHJlZ2lzdGVyQ2hhaW5zQW5kQXNzZXRzKFxuICAgICAgY2hhaW5IdWIsXG4gICAgICB0ZXJtcy5icmFuZHMsXG4gICAgICBwcml2YXRlQXJncy5jaGFpbkluZm8sXG4gICAgICBwcml2YXRlQXJncy5hc3NldEluZm8sXG4gICAgICB7IGxvZzogdHJhY2UxNCB9XG4gICAgKTtcbiAgfVxuICBjb25zdCBzdXBwb3J0c0NjdHAgPSBtYWtlU3VwcG9ydHNDY3RwKGNoYWluSHViKTtcbiAgY29uc3QgeyBtYWtlTG9jYWxBY2NvdW50OiBtYWtlTG9jYWxBY2NvdW50MiwgbWFrZU5vYmxlQWNjb3VudDogbWFrZU5vYmxlQWNjb3VudDIgfSA9IG9yY2hlc3RyYXRlQWxsKFxuICAgIHtcbiAgICAgIC8vXG4gICAgICBtYWtlTG9jYWxBY2NvdW50LFxuICAgICAgbWFrZU5vYmxlQWNjb3VudFxuICAgIH0sXG4gICAge31cbiAgKTtcbiAgY29uc3QgcG9vbEFjY291bnRWID0gem9uZS5tYWtlT25jZShcIlBvb2xBY2NvdW50XCIsICgpID0+IG1ha2VMb2NhbEFjY291bnQyKCkpO1xuICBjb25zdCBzZXR0bGVBY2NvdW50ViA9IHpvbmUubWFrZU9uY2UoXG4gICAgXCJTZXR0bGVBY2NvdW50XCIsXG4gICAgKCkgPT4gbWFrZUxvY2FsQWNjb3VudDIoKVxuICApO1xuICBjb25zdCB7IGZvcndhcmRGdW5kczogZm9yd2FyZEZ1bmRzMiB9ID0gb3JjaGVzdHJhdGVBbGwoXG4gICAgLy9cbiAgICB7IGZvcndhcmRGdW5kcyB9LFxuICAgIHtcbiAgICAgIGN1cnJlbnRDaGFpblJlZmVyZW5jZTogcHJpdmF0ZUFyZ3MuY2hhaW5JbmZvLmFnb3JpYy5jaGFpbklkLFxuICAgICAgZ2V0Tm9ibGVJQ0EsXG4gICAgICBsb2c6IG1ha2VUcmFjZXIoXCJGb3J3YXJkRnVuZHNcIiksXG4gICAgICBzZXR0bGVtZW50QWNjb3VudDogc2V0dGxlQWNjb3VudFYsXG4gICAgICBzdXBwb3J0c0NjdHAsXG4gICAgICBzdGF0dXNNYW5hZ2VyXG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlU2V0dGxlciA9IHByZXBhcmVTZXR0bGVyKHpvbmUsIHtcbiAgICBzdGF0dXNNYW5hZ2VyLFxuICAgIFVTREMsXG4gICAgd2l0aGRyYXdUb1NlYXQsXG4gICAgZmVlQ29uZmlnLFxuICAgIGZvcndhcmRGdW5kczogZm9yd2FyZEZ1bmRzMixcbiAgICBnZXROb2JsZUlDQSxcbiAgICB2b3dUb29sczogdG9vbHMudm93VG9vbHMsXG4gICAgemNmLFxuICAgIC8vXG4gICAgY2hhaW5IdWI6IHsgcmVzb2x2ZUFjY291bnRJZDogY2hhaW5IdWIucmVzb2x2ZUFjY291bnRJZC5iaW5kKGNoYWluSHViKSB9XG4gIH0pO1xuICBjb25zdCB6b2VUb29scyA9IG1ha2Vab2VUb29scyh6Y2YsIHZvd1Rvb2xzKTtcbiAgY29uc3QgeyBhZHZhbmNlRnVuZHM6IGFkdmFuY2VGdW5kczIgfSA9IG9yY2hlc3RyYXRlQWxsKFxuICAgIC8vXG4gICAgeyBhZHZhbmNlRnVuZHMgfSxcbiAgICB7XG4gICAgICAvL1xuICAgICAgY2hhaW5IdWJUb29sczoge1xuICAgICAgICBnZXRDaGFpbkluZm9CeUNoYWluSWQ6IGNoYWluSHViLmdldENoYWluSW5mb0J5Q2hhaW5JZC5iaW5kKGNoYWluSHViKSxcbiAgICAgICAgcmVzb2x2ZUFjY291bnRJZDogY2hhaW5IdWIucmVzb2x2ZUFjY291bnRJZC5iaW5kKGNoYWluSHViKVxuICAgICAgfSxcbiAgICAgIGZlZUNvbmZpZyxcbiAgICAgIGdldE5vYmxlSUNBLFxuICAgICAgbG9nOiBtYWtlVHJhY2VyKFwiQWR2YW5jZUZ1bmRzXCIpLFxuICAgICAgc2V0dGxlbWVudEFjY291bnQ6IHNldHRsZUFjY291bnRWLFxuICAgICAgc3RhdHVzTWFuYWdlcixcbiAgICAgIHVzZGM6IGhhcmRlbih7XG4gICAgICAgIGJyYW5kOiB0ZXJtcy5icmFuZHMuVVNEQyxcbiAgICAgICAgZGVub206IHRlcm1zLnVzZGNEZW5vbVxuICAgICAgfSksXG4gICAgICB6Y2ZUb29sczogaGFyZGVuKHtcbiAgICAgICAgbWFrZUVtcHR5WkNGU2VhdDogKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgemNmU2VhdCB9ID0gemNmLm1ha2VFbXB0eVNlYXRLaXQoKTtcbiAgICAgICAgICByZXR1cm4gemNmU2VhdDtcbiAgICAgICAgfVxuICAgICAgfSksXG4gICAgICB6b2VUb29sc1xuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZUFkdmFuY2VyID0gcHJlcGFyZUFkdmFuY2VyKHpvbmUsIHtcbiAgICBhZHZhbmNlRnVuZHM6IGFkdmFuY2VGdW5kczIsXG4gICAgY2hhaW5IdWIsXG4gICAgZ2V0Tm9ibGVJQ0EsXG4gICAgdXNkYzogaGFyZGVuKHtcbiAgICAgIGJyYW5kOiB0ZXJtcy5icmFuZHMuVVNEQyxcbiAgICAgIGRlbm9tOiB0ZXJtcy51c2RjRGVub21cbiAgICB9KSxcbiAgICBzdGF0dXNNYW5hZ2VyLFxuICAgIHZvd1Rvb2xzLFxuICAgIHpjZixcbiAgICB6b2VUb29sc1xuICB9KTtcbiAgY29uc3QgbWFrZUZlZWRLaXQgPSBwcmVwYXJlVHJhbnNhY3Rpb25GZWVkS2l0KHpvbmUsIHpjZik7XG4gIGNvbnN0IG1ha2VMaXF1aWRpdHlQb29sS2l0ID0gcHJlcGFyZUxpcXVpZGl0eVBvb2xLaXQoXG4gICAgem9uZSxcbiAgICB6Y2YsXG4gICAgdGVybXMuYnJhbmRzLlVTREMsXG4gICAgeyBtYWtlUmVjb3JkZXJLaXQgfVxuICApO1xuICBjb25zdCBjcmVhdG9yRmFjZXQgPSB6b25lLmV4byhcIkZhc3QgVVNEQyBDcmVhdG9yXCIsIHZvaWQgMCwge1xuICAgIGFzeW5jIG1ha2VPcGVyYXRvckludml0YXRpb24ob3BlcmF0b3JJZCkge1xuICAgICAgcmV0dXJuIGZlZWRLaXQuY3JlYXRvci5tYWtlT3BlcmF0b3JJbnZpdGF0aW9uKG9wZXJhdG9ySWQpO1xuICAgIH0sXG4gICAgcmVtb3ZlT3BlcmF0b3Iob3BlcmF0b3JJZCkge1xuICAgICAgcmV0dXJuIGZlZWRLaXQuY3JlYXRvci5yZW1vdmVPcGVyYXRvcihvcGVyYXRvcklkKTtcbiAgICB9LFxuICAgIGFzeW5jIGdldENvbnRyYWN0RmVlQmFsYW5jZSgpIHtcbiAgICAgIHJldHVybiBwb29sS2l0LmZlZVJlY2lwaWVudC5nZXRDb250cmFjdEZlZUJhbGFuY2UoKTtcbiAgICB9LFxuICAgIGFzeW5jIG1ha2VXaXRoZHJhd0ZlZXNJbnZpdGF0aW9uKCkge1xuICAgICAgcmV0dXJuIHBvb2xLaXQuZmVlUmVjaXBpZW50Lm1ha2VXaXRoZHJhd0ZlZXNJbnZpdGF0aW9uKCk7XG4gICAgfSxcbiAgICBhc3luYyBjb25uZWN0VG9Ob2JsZShhZ29yaWNDaGFpbklkLCBub2JsZUNoYWluSWQsIGFnb3JpY1RvTm9ibGUpIHtcbiAgICAgIGNvbnN0IHNob3VsZFVwZGF0ZSA9IGFnb3JpY0NoYWluSWQgJiYgbm9ibGVDaGFpbklkICYmIGFnb3JpY1RvTm9ibGU7XG4gICAgICBpZiAoc2hvdWxkVXBkYXRlKSB7XG4gICAgICAgIHRyYWNlMTQoXCJjb25uZWN0VG9Ob2JsZVwiLCBhZ29yaWNDaGFpbklkLCBub2JsZUNoYWluSWQsIGFnb3JpY1RvTm9ibGUpO1xuICAgICAgICBjaGFpbkh1Yi51cGRhdGVDb25uZWN0aW9uKGFnb3JpY0NoYWluSWQsIG5vYmxlQ2hhaW5JZCwgYWdvcmljVG9Ob2JsZSk7XG4gICAgICB9XG4gICAgICBjb25zdCBub2JsZUlDQUxhYmVsID0gYE5vYmxlSUNBLSR7KHNob3VsZFVwZGF0ZSA/IGFnb3JpY1RvTm9ibGUgOiBhZ1RvTm9ibGUpLmNvdW50ZXJwYXJ0eS5jb25uZWN0aW9uX2lkfWA7XG4gICAgICB0cmFjZTE0KFwiTm9ibGVJQ0FcIiwgbm9ibGVJQ0FMYWJlbCk7XG4gICAgICBjb25zdCBub2JsZUFjY291bnRWID0gem9uZS5tYWtlT25jZShcbiAgICAgICAgbm9ibGVJQ0FMYWJlbCxcbiAgICAgICAgKCkgPT4gbWFrZU5vYmxlQWNjb3VudDIoKVxuICAgICAgKTtcbiAgICAgIHJldHVybiB2b3dUb29scy53aGVuKG5vYmxlQWNjb3VudFYsIChub2JsZUFjY291bnQpID0+IHtcbiAgICAgICAgdHJhY2UxNChcIm5vYmxlQWNjb3VudFwiLCBub2JsZUFjY291bnQpO1xuICAgICAgICBpZiAoYmFnZ2FnZS5oYXMoTk9CTEVfSUNBX0JBR0dBR0VfS0VZKSkge1xuICAgICAgICAgIHRyYWNlMTQoXG4gICAgICAgICAgICBcIk5vYmxlIElDQSBhbHJlYWR5IHNldCBpbiBiYWdnYWdlLiBFcXVhbD9cIixcbiAgICAgICAgICAgIGJhZ2dhZ2UuZ2V0KE5PQkxFX0lDQV9CQUdHQUdFX0tFWSkgPT09IG5vYmxlQWNjb3VudFxuICAgICAgICAgICk7XG4gICAgICAgICAgYmFnZ2FnZS5zZXQoTk9CTEVfSUNBX0JBR0dBR0VfS0VZLCBub2JsZUFjY291bnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJhZ2dhZ2UuaW5pdChOT0JMRV9JQ0FfQkFHR0FHRV9LRVksIG5vYmxlQWNjb3VudCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vYmxlQWNjb3VudC5nZXRBZGRyZXNzKCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIHB1Ymxpc2hBZGRyZXNzZXMoKSB7XG4gICAgICAhYmFnZ2FnZS5oYXMoQUREUkVTU0VTX0JBR0dBR0VfS0VZKSB8fCB0aHJvd1JlZGFjdGVkYEFkZHJlc3NlcyBhbHJlYWR5IHB1Ymxpc2hlZGA7XG4gICAgICBjb25zdCBbcG9vbEFjY291bnRBZGRyZXNzXSA9IGF3YWl0IHZvd1Rvb2xzLndoZW4oXG4gICAgICAgIHZvd1Rvb2xzLmFsbChbRShwb29sQWNjb3VudCkuZ2V0QWRkcmVzcygpXSlcbiAgICAgICk7XG4gICAgICBjb25zdCBhZGRyZXNzZXMgPSBoYXJkZW4oe1xuICAgICAgICBwb29sQWNjb3VudDogcG9vbEFjY291bnRBZGRyZXNzLnZhbHVlLFxuICAgICAgICBzZXR0bGVtZW50QWNjb3VudDogc2V0dGxlbWVudEFkZHJlc3MudmFsdWVcbiAgICAgIH0pO1xuICAgICAgYmFnZ2FnZS5pbml0KEFERFJFU1NFU19CQUdHQUdFX0tFWSwgYWRkcmVzc2VzKTtcbiAgICAgIGF3YWl0IHB1Ymxpc2hBZGRyZXNzZXMoc3RvcmFnZU5vZGUsIGFkZHJlc3Nlcyk7XG4gICAgICByZXR1cm4gYWRkcmVzc2VzO1xuICAgIH0sXG4gICAgZGVsZXRlQ29tcGxldGVkVHhzKCkge1xuICAgICAgcmV0dXJuIHN0YXR1c01hbmFnZXIuZGVsZXRlQ29tcGxldGVkVHhzKCk7XG4gICAgfSxcbiAgICByZW1lZGlhdGVVbmRldGVjdGVkQmF0Y2hlcyhtaW5VdXNkYykge1xuICAgICAgcmV0dXJuIHNldHRsZXJLaXQuY3JlYXRvci5yZW1lZGlhdGVNaW50ZWRFYXJseShtaW5VdXNkYyk7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICB1cGRhdGVDaGFpbihjaGFpbk5hbWUsIGNoYWluSW5mbykge1xuICAgICAgcmV0dXJuIGNoYWluSHViLnVwZGF0ZUNoYWluKGNoYWluTmFtZSwgY2hhaW5JbmZvKTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgcmVnaXN0ZXJDaGFpbihjaGFpbk5hbWUsIGNoYWluSW5mbykge1xuICAgICAgcmV0dXJuIGNoYWluSHViLnJlZ2lzdGVyQ2hhaW4oY2hhaW5OYW1lLCBjaGFpbkluZm8pO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IHB1YmxpY0ZhY2V0ID0gem9uZS5leG8oXCJGYXN0IFVTREMgUHVibGljXCIsIHZvaWQgMCwge1xuICAgIG1ha2VEZXBvc2l0SW52aXRhdGlvbigpIHtcbiAgICAgIHJldHVybiBwb29sS2l0LnB1YmxpYy5tYWtlRGVwb3NpdEludml0YXRpb24oKTtcbiAgICB9LFxuICAgIG1ha2VXaXRoZHJhd0ludml0YXRpb24oKSB7XG4gICAgICByZXR1cm4gcG9vbEtpdC5wdWJsaWMubWFrZVdpdGhkcmF3SW52aXRhdGlvbigpO1xuICAgIH0sXG4gICAgZ2V0UHVibGljVG9waWNzKCkge1xuICAgICAgcmV0dXJuIHBvb2xLaXQucHVibGljLmdldFB1YmxpY1RvcGljcygpO1xuICAgIH0sXG4gICAgZ2V0U3RhdGljSW5mbygpIHtcbiAgICAgIGJhZ2dhZ2UuaGFzKEFERFJFU1NFU19CQUdHQUdFX0tFWSkgfHwgdGhyb3dSZWRhY3RlZGBubyBhZGRyZXNzZXMuIGNyZWF0b3IgbXVzdCAncHVibGlzaEFkZHJlc3NlcycgZmlyc3RgO1xuICAgICAgY29uc3QgYWRkcmVzc2VzID0gYmFnZ2FnZS5nZXQoQUREUkVTU0VTX0JBR0dBR0VfS0VZKTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBbQUREUkVTU0VTX0JBR0dBR0VfS0VZXTogYWRkcmVzc2VzXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICBwdWJsaXNoRmVlQ29uZmlnKHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyLCBmZWVDb25maWcpO1xuICBjb25zdCBzaGFyZU1pbnQgPSBhd2FpdCBwcm92aWRlU2luZ2xldG9uKFxuICAgIHpvbmUubWFwU3RvcmUoXCJtaW50XCIpLFxuICAgIFwiUG9vbFNoYXJlXCIsXG4gICAgKCkgPT4gemNmLm1ha2VaQ0ZNaW50KFwiUG9vbFNoYXJlc1wiLCBBc3NldEtpbmQuTkFULCB7XG4gICAgICBkZWNpbWFsUGxhY2VzOiA2XG4gICAgfSlcbiAgKTtcbiAgY29uc3QgcG9vbEtpdCA9IHpvbmUubWFrZU9uY2UoXG4gICAgXCJMaXF1aWRpdHkgUG9vbCBraXRcIixcbiAgICAoKSA9PiBtYWtlTGlxdWlkaXR5UG9vbEtpdChzaGFyZU1pbnQsIHByaXZhdGVBcmdzLnBvb2xNZXRyaWNzTm9kZSlcbiAgKTtcbiAgY29uc3QgZmVlZEtpdCA9IHpvbmUubWFrZU9uY2UoXCJGZWVkIEtpdFwiLCAoKSA9PiBtYWtlRmVlZEtpdCgpKTtcbiAgY29uc3QgW3Bvb2xBY2NvdW50LCBzZXR0bGVtZW50QWNjb3VudF0gPSBhd2FpdCB2b3dUb29scy53aGVuKFxuICAgIHZvd1Rvb2xzLmFsbChbcG9vbEFjY291bnRWLCBzZXR0bGVBY2NvdW50Vl0pXG4gICk7XG4gIHRyYWNlMTQoXCJzZXR0bGVtZW50QWNjb3VudFwiLCBzZXR0bGVtZW50QWNjb3VudCk7XG4gIHRyYWNlMTQoXCJwb29sQWNjb3VudFwiLCBwb29sQWNjb3VudCk7XG4gIGNvbnN0IHNldHRsZW1lbnRBZGRyZXNzID0gYXdhaXQgRShzZXR0bGVtZW50QWNjb3VudCkuZ2V0QWRkcmVzcygpO1xuICB0cmFjZTE0KFwic2V0dGxlbWVudEFkZHJlc3NcIiwgc2V0dGxlbWVudEFkZHJlc3MpO1xuICBjb25zdCBbX2Fnb3JpYywgX25vYmxlLCBhZ1RvTm9ibGVdID0gYXdhaXQgdm93VG9vbHMud2hlbihcbiAgICBjaGFpbkh1Yi5nZXRDaGFpbnNBbmRDb25uZWN0aW9uKFwiYWdvcmljXCIsIFwibm9ibGVcIilcbiAgKTtcbiAgY29uc3Qgc2V0dGxlcktpdCA9IHpvbmUubWFrZU9uY2UoXG4gICAgXCJzZXR0bGVyS2l0XCIsXG4gICAgKCkgPT4gbWFrZVNldHRsZXIoe1xuICAgICAgcmVwYXllcjogcG9vbEtpdC5yZXBheWVyLFxuICAgICAgc291cmNlQ2hhbm5lbDogYWdUb05vYmxlLnRyYW5zZmVyQ2hhbm5lbC5jb3VudGVyUGFydHlDaGFubmVsSWQsXG4gICAgICByZW1vdGVEZW5vbTogXCJ1dXNkY1wiLFxuICAgICAgc2V0dGxlbWVudEFjY291bnRcbiAgICB9KVxuICApO1xuICBjb25zdCBhZHZhbmNlciA9IG1ha2VBZHZhbmNlcih7XG4gICAgYm9ycm93ZXI6IHBvb2xLaXQuYm9ycm93ZXIsXG4gICAgbm90aWZpZXI6IHNldHRsZXJLaXQubm90aWZpZXIsXG4gICAgcG9vbEFjY291bnQsXG4gICAgc2V0dGxlbWVudEFkZHJlc3NcbiAgfSk7XG4gIHZvaWQgb2JzZXJ2ZUl0ZXJhdGlvbihzdWJzY3JpYmVFYWNoKGZlZWRLaXQucHVibGljLmdldEV2aWRlbmNlU3Vic2NyaWJlcigpKSwge1xuICAgIHVwZGF0ZVN0YXRlKGV2aWRlbmNlV2l0aFJpc2spIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZvaWQgYWR2YW5jZXIuaGFuZGxlVHJhbnNhY3Rpb25FdmVudChldmlkZW5jZVdpdGhSaXNrKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICB0cmFjZTE0KFwiXFx1ezFGNkE4fSBFcnJvciBoYW5kbGluZyB0cmFuc2FjdGlvbiBldmVudFwiLCBlcnIpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIGF3YWl0IHNldHRsZXJLaXQuY3JlYXRvci5tb25pdG9yTWludGluZ0RlcG9zaXRzKCk7XG4gIHN0YXJ0Rm9yd2FyZFJldHJpZXIoe1xuICAgIGZvcndhcmRGdW5kczogZm9yd2FyZEZ1bmRzMixcbiAgICBnZXRGb3J3YXJkc1RvUmV0cnk6IHN0YXR1c01hbmFnZXIuZ2V0Rm9yd2FyZHNUb1JldHJ5LmJpbmQoc3RhdHVzTWFuYWdlciksXG4gICAgbG9nOiB0cmFjZTE0LFxuICAgIHJvdXRlSGVhbHRoLFxuICAgIFVTRENcbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oeyBjcmVhdG9yRmFjZXQsIHB1YmxpY0ZhY2V0IH0pO1xufTtjb250cmFjdD0kY82PX2NvbnRyYWN0O1xuaGFyZGVuKGNvbnRyYWN0KTtcbnZhciAkY82PX3N0YXJ0PXdpdGhPcmNoZXN0cmF0aW9uKGNvbnRyYWN0LHtcbiAgY2hhaW5JbmZvVmFsdWVTaGFwZTogQ29zbW9zQ2hhaW5JbmZvU2hhcGVWMVxufSk7c3RhcnQ9JGPNj19zdGFydDtcbmhhcmRlbihzdGFydCk7XG59KSgpXG4iLCJfX2xpdmVFeHBvcnRNYXBfXyI6eyJtZXRhIjpbIm1ldGEiLHRydWVdLCJjb250cmFjdCI6WyJjb250cmFjdCIsdHJ1ZV0sInN0YXJ0IjpbInN0YXJ0Iix0cnVlXX0sIl9fcmVleHBvcnRNYXBfXyI6e30sIl9fZml4ZWRFeHBvcnRNYXBfXyI6e30sIl9fbmVlZHNJbXBvcnRfXyI6ZmFsc2UsIl9fbmVlZHNJbXBvcnRNZXRhX18iOmZhbHNlfVBLAQIeAwoAAAAAAAAAAACs55LetgIAALYCAAAUAAAAAAAAAAAAAACkgQAAAABjb21wYXJ0bWVudC1tYXAuanNvblBLAQIeAwoAAAAAAAAAAAC6cxetIRUNACEVDQBCAAAAAAAAAAAAAACkgegCAABAYWdsb2NhbC9mYXN0LXVzZGMtZGVwbG95LXYwLjEuMC9kaXN0L2Zhc3QtdXNkYy5jb250cmFjdC5idW5kbGUuanNQSwUGAAAAAAIAAgCyAAAAaRgNAAAA","endoZipBase64Sha512":"2412ad1aecd532da4bd8003718925fe907098fe7afa69b61b67aac7a265229a8d1a8c30d1a8368c62d121087a4f6895f5d2fca9de54a965be99bf6a88ecedfb6"}