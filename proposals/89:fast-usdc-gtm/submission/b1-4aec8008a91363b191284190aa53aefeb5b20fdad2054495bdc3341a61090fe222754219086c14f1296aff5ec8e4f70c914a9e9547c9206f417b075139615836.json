{
  "moduleFormat": "endoZipBase64",
  "endoZipBase64": "UEsDBAoAAAAAAAAAAACGA31gtgIAALYCAAAUAAAAY29tcGFydG1lbnQtbWFwLmpzb257CiAgInRhZ3MiOiBbXSwKICAiZW50cnkiOiB7CiAgICAiY29tcGFydG1lbnQiOiAiQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAiLAogICAgIm1vZHVsZSI6ICIuL2Rpc3QvZmFzdC11c2RjLmNvbnRyYWN0LmJ1bmRsZS5qcyIKICB9LAogICJjb21wYXJ0bWVudHMiOiB7CiAgICAiQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAiOiB7CiAgICAgICJuYW1lIjogIkBhZ2xvY2FsL2Zhc3QtdXNkYy1kZXBsb3kiLAogICAgICAibGFiZWwiOiAiQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAiLAogICAgICAibG9jYXRpb24iOiAiQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAiLAogICAgICAibW9kdWxlcyI6IHsKICAgICAgICAiLi9kaXN0L2Zhc3QtdXNkYy5jb250cmFjdC5idW5kbGUuanMiOiB7CiAgICAgICAgICAibG9jYXRpb24iOiAiZGlzdC9mYXN0LXVzZGMuY29udHJhY3QuYnVuZGxlLmpzIiwKICAgICAgICAgICJwYXJzZXIiOiAicHJlLW1qcy1qc29uIiwKICAgICAgICAgICJzaGE1MTIiOiAiZDU5ZmU0ZGE1YWI1YmVlMjFlMjgyMmYyNmZlOTUyODU4MTYzNDdlMzliYTA0ZjZmMjA2MDJkOWE1MWI5YjkzOGMwZDZhOTAwMmE3YzdlYmY1MWI3YTMwYjY2ZDJkOThjNDRhMmY5NGI1MDk1ODYwMWFjZjY5NzFmMDczNWYzYzIiCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9UEsDBAoAAAAAAAAAAADawq+o6MMMAOjDDABCAAAAQGFnbG9jYWwvZmFzdC11c2RjLWRlcGxveS12MC4xLjAvZGlzdC9mYXN0LXVzZGMuY29udHJhY3QuYnVuZGxlLmpzeyJpbXBvcnRzIjpbXSwiZXhwb3J0cyI6WyJjb250cmFjdCIsIm1ldGEiLCJzdGFydCJdLCJyZWV4cG9ydHMiOltdLCJfX3N5bmNNb2R1bGVQcm9ncmFtX18iOiIoe2ltcG9ydHM6JGjNj19pbXBvcnRzLGxpdmVWYXI6JGjNj19saXZlLG9uY2VWYXI6JGjNj19vbmNlLGltcG9ydDokaM2PX2ltcG9ydCxpbXBvcnRNZXRhOiRozY9fX19fbWV0YX0pPT4oZnVuY3Rpb24oKXsndXNlIHN0cmljdCc7JGjNj19pbXBvcnRzKFtdKTskaM2PX2xpdmUubWV0YSgpOyRozY9fbGl2ZS5jb250cmFjdCgpOyRozY9fbGl2ZS5zdGFydCgpO3ZhciBfX2NyZWF0ZSA9IE9iamVjdC5jcmVhdGU7XG52YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5O1xudmFyIF9fZ2V0T3duUHJvcERlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO1xudmFyIF9fZ2V0T3duUHJvcE5hbWVzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXM7XG52YXIgX19nZXRQcm90b09mID0gT2JqZWN0LmdldFByb3RvdHlwZU9mO1xudmFyIF9faGFzT3duUHJvcCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7XG52YXIgX19jb21tb25KUyA9IChjYiwgbW9kKSA9PiBmdW5jdGlvbiBfX3JlcXVpcmUoKSB7XG4gIHJldHVybiBtb2QgfHwgKDAsIGNiW19fZ2V0T3duUHJvcE5hbWVzKGNiKVswXV0pKChtb2QgPSB7IGV4cG9ydHM6IHt9IH0pLmV4cG9ydHMsIG1vZCksIG1vZC5leHBvcnRzO1xufTtcbnZhciBfX2V4cG9ydCA9ICh0YXJnZXQsIGFsbCkgPT4ge1xuICBmb3IgKHZhciBuYW1lIGluIGFsbClcbiAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pO1xufTtcbnZhciBfX2NvcHlQcm9wcyA9ICh0bywgZnJvbSwgZXhjZXB0LCBkZXNjKSA9PiB7XG4gIGlmIChmcm9tICYmIHR5cGVvZiBmcm9tID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBmcm9tID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBmb3IgKGxldCBrZXkgb2YgX19nZXRPd25Qcm9wTmFtZXMoZnJvbSkpXG4gICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KVxuICAgICAgICBfX2RlZlByb3AodG8sIGtleSwgeyBnZXQ6ICgpID0+IGZyb21ba2V5XSwgZW51bWVyYWJsZTogIShkZXNjID0gX19nZXRPd25Qcm9wRGVzYyhmcm9tLCBrZXkpKSB8fCBkZXNjLmVudW1lcmFibGUgfSk7XG4gIH1cbiAgcmV0dXJuIHRvO1xufTtcbnZhciBfX3RvRVNNID0gKG1vZCwgaXNOb2RlTW9kZSwgdGFyZ2V0KSA9PiAodGFyZ2V0ID0gbW9kICE9IG51bGwgPyBfX2NyZWF0ZShfX2dldFByb3RvT2YobW9kKSkgOiB7fSwgX19jb3B5UHJvcHMoXG4gIC8vXG4gIC8vXG4gIC8vXG4gIC8vXG4gIGlzTm9kZU1vZGUgfHwgIW1vZCB8fCAhbW9kLl9fZXNNb2R1bGUgPyBfX2RlZlByb3AodGFyZ2V0LCBcImRlZmF1bHRcIiwgeyB2YWx1ZTogbW9kLCBlbnVtZXJhYmxlOiB0cnVlIH0pIDogdGFyZ2V0LFxuICBtb2RcbikpO1xuXG4vL1xudmFyIHJlcXVpcmVfYXNjaWkgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9idWlsZC9hc2NpaS5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy5mcm9tQXNjaWkgPSBleHBvcnRzLnRvQXNjaWkgPSB2b2lkIDA7XG4gICAgZnVuY3Rpb24gdG9Bc2NpaShpbnB1dCkge1xuICAgICAgY29uc3QgdG9OdW1zID0gKHN0cikgPT4gc3RyLnNwbGl0KFwiXCIpLm1hcCgoeCkgPT4ge1xuICAgICAgICBjb25zdCBjaGFyQ29kZSA9IHguY2hhckNvZGVBdCgwKTtcbiAgICAgICAgaWYgKGNoYXJDb2RlIDwgMzIgfHwgY2hhckNvZGUgPiAxMjYpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgZW5jb2RlIGNoYXJhY3RlciB0aGF0IGlzIG91dCBvZiBwcmludGFibGUgQVNDSUkgcmFuZ2U6IFwiICsgY2hhckNvZGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGFyQ29kZTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIFVpbnQ4QXJyYXkuZnJvbSh0b051bXMoaW5wdXQpKTtcbiAgICB9XG4gICAgZXhwb3J0cy50b0FzY2lpID0gdG9Bc2NpaTtcbiAgICBmdW5jdGlvbiBmcm9tQXNjaWkoZGF0YSkge1xuICAgICAgY29uc3QgZnJvbU51bXMgPSAobGlzdE9mTnVtYmVycykgPT4gbGlzdE9mTnVtYmVycy5tYXAoKHgpID0+IHtcbiAgICAgICAgaWYgKHggPCAzMiB8fCB4ID4gMTI2KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IGRlY29kZSBjaGFyYWN0ZXIgdGhhdCBpcyBvdXQgb2YgcHJpbnRhYmxlIEFTQ0lJIHJhbmdlOiBcIiArIHgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZnJvbU51bXMoQXJyYXkuZnJvbShkYXRhKSkuam9pbihcIlwiKTtcbiAgICB9XG4gICAgZXhwb3J0cy5mcm9tQXNjaWkgPSBmcm9tQXNjaWk7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYmFzZTY0X2pzID0gX19jb21tb25KUyh7XG4gIFwiLi4vLi4vbm9kZV9tb2R1bGVzL2Jhc2U2NC1qcy9pbmRleC5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBleHBvcnRzLmJ5dGVMZW5ndGggPSBieXRlTGVuZ3RoO1xuICAgIGV4cG9ydHMudG9CeXRlQXJyYXkgPSB0b0J5dGVBcnJheTtcbiAgICBleHBvcnRzLmZyb21CeXRlQXJyYXkgPSBmcm9tQnl0ZUFycmF5O1xuICAgIHZhciBsb29rdXAgPSBbXTtcbiAgICB2YXIgcmV2TG9va3VwID0gW107XG4gICAgdmFyIEFyciA9IHR5cGVvZiBVaW50OEFycmF5ICE9PSBcInVuZGVmaW5lZFwiID8gVWludDhBcnJheSA6IEFycmF5O1xuICAgIHZhciBjb2RlID0gXCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvXCI7XG4gICAgZm9yIChpMiA9IDAsIGxlbiA9IGNvZGUubGVuZ3RoOyBpMiA8IGxlbjsgKytpMikge1xuICAgICAgbG9va3VwW2kyXSA9IGNvZGVbaTJdO1xuICAgICAgcmV2TG9va3VwW2NvZGUuY2hhckNvZGVBdChpMildID0gaTI7XG4gICAgfVxuICAgIHZhciBpMjtcbiAgICB2YXIgbGVuO1xuICAgIHJldkxvb2t1cFtcIi1cIi5jaGFyQ29kZUF0KDApXSA9IDYyO1xuICAgIHJldkxvb2t1cFtcIl9cIi5jaGFyQ29kZUF0KDApXSA9IDYzO1xuICAgIGZ1bmN0aW9uIGdldExlbnMoYjY0KSB7XG4gICAgICB2YXIgbGVuMiA9IGI2NC5sZW5ndGg7XG4gICAgICBpZiAobGVuMiAlIDQgPiAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgc3RyaW5nLiBMZW5ndGggbXVzdCBiZSBhIG11bHRpcGxlIG9mIDRcIik7XG4gICAgICB9XG4gICAgICB2YXIgdmFsaWRMZW4gPSBiNjQuaW5kZXhPZihcIj1cIik7XG4gICAgICBpZiAodmFsaWRMZW4gPT09IC0xKSB2YWxpZExlbiA9IGxlbjI7XG4gICAgICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gdmFsaWRMZW4gPT09IGxlbjIgPyAwIDogNCAtIHZhbGlkTGVuICUgNDtcbiAgICAgIHJldHVybiBbdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbl07XG4gICAgfVxuICAgIGZ1bmN0aW9uIGJ5dGVMZW5ndGgoYjY0KSB7XG4gICAgICB2YXIgbGVucyA9IGdldExlbnMoYjY0KTtcbiAgICAgIHZhciB2YWxpZExlbiA9IGxlbnNbMF07XG4gICAgICB2YXIgcGxhY2VIb2xkZXJzTGVuID0gbGVuc1sxXTtcbiAgICAgIHJldHVybiAodmFsaWRMZW4gKyBwbGFjZUhvbGRlcnNMZW4pICogMyAvIDQgLSBwbGFjZUhvbGRlcnNMZW47XG4gICAgfVxuICAgIGZ1bmN0aW9uIF9ieXRlTGVuZ3RoKGI2NCwgdmFsaWRMZW4sIHBsYWNlSG9sZGVyc0xlbikge1xuICAgICAgcmV0dXJuICh2YWxpZExlbiArIHBsYWNlSG9sZGVyc0xlbikgKiAzIC8gNCAtIHBsYWNlSG9sZGVyc0xlbjtcbiAgICB9XG4gICAgZnVuY3Rpb24gdG9CeXRlQXJyYXkoYjY0KSB7XG4gICAgICB2YXIgdG1wO1xuICAgICAgdmFyIGxlbnMgPSBnZXRMZW5zKGI2NCk7XG4gICAgICB2YXIgdmFsaWRMZW4gPSBsZW5zWzBdO1xuICAgICAgdmFyIHBsYWNlSG9sZGVyc0xlbiA9IGxlbnNbMV07XG4gICAgICB2YXIgYXJyID0gbmV3IEFycihfYnl0ZUxlbmd0aChiNjQsIHZhbGlkTGVuLCBwbGFjZUhvbGRlcnNMZW4pKTtcbiAgICAgIHZhciBjdXJCeXRlID0gMDtcbiAgICAgIHZhciBsZW4yID0gcGxhY2VIb2xkZXJzTGVuID4gMCA/IHZhbGlkTGVuIC0gNCA6IHZhbGlkTGVuO1xuICAgICAgdmFyIGkzO1xuICAgICAgZm9yIChpMyA9IDA7IGkzIDwgbGVuMjsgaTMgKz0gNCkge1xuICAgICAgICB0bXAgPSByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTMpXSA8PCAxOCB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyArIDEpXSA8PCAxMiB8IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyArIDIpXSA8PCA2IHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkzICsgMyldO1xuICAgICAgICBhcnJbY3VyQnl0ZSsrXSA9IHRtcCA+PiAxNiAmIDI1NTtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgPj4gOCAmIDI1NTtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAyNTU7XG4gICAgICB9XG4gICAgICBpZiAocGxhY2VIb2xkZXJzTGVuID09PSAyKSB7XG4gICAgICAgIHRtcCA9IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyldIDw8IDIgfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTMgKyAxKV0gPj4gNDtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAyNTU7XG4gICAgICB9XG4gICAgICBpZiAocGxhY2VIb2xkZXJzTGVuID09PSAxKSB7XG4gICAgICAgIHRtcCA9IHJldkxvb2t1cFtiNjQuY2hhckNvZGVBdChpMyldIDw8IDEwIHwgcmV2TG9va3VwW2I2NC5jaGFyQ29kZUF0KGkzICsgMSldIDw8IDQgfCByZXZMb29rdXBbYjY0LmNoYXJDb2RlQXQoaTMgKyAyKV0gPj4gMjtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgPj4gOCAmIDI1NTtcbiAgICAgICAgYXJyW2N1ckJ5dGUrK10gPSB0bXAgJiAyNTU7XG4gICAgICB9XG4gICAgICByZXR1cm4gYXJyO1xuICAgIH1cbiAgICBmdW5jdGlvbiB0cmlwbGV0VG9CYXNlNjQobnVtKSB7XG4gICAgICByZXR1cm4gbG9va3VwW251bSA+PiAxOCAmIDYzXSArIGxvb2t1cFtudW0gPj4gMTIgJiA2M10gKyBsb29rdXBbbnVtID4+IDYgJiA2M10gKyBsb29rdXBbbnVtICYgNjNdO1xuICAgIH1cbiAgICBmdW5jdGlvbiBlbmNvZGVDaHVuayh1aW50OCwgc3RhcnQyLCBlbmQpIHtcbiAgICAgIHZhciB0bXA7XG4gICAgICB2YXIgb3V0cHV0ID0gW107XG4gICAgICBmb3IgKHZhciBpMyA9IHN0YXJ0MjsgaTMgPCBlbmQ7IGkzICs9IDMpIHtcbiAgICAgICAgdG1wID0gKHVpbnQ4W2kzXSA8PCAxNiAmIDE2NzExNjgwKSArICh1aW50OFtpMyArIDFdIDw8IDggJiA2NTI4MCkgKyAodWludDhbaTMgKyAyXSAmIDI1NSk7XG4gICAgICAgIG91dHB1dC5wdXNoKHRyaXBsZXRUb0Jhc2U2NCh0bXApKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvdXRwdXQuam9pbihcIlwiKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbUJ5dGVBcnJheSh1aW50OCkge1xuICAgICAgdmFyIHRtcDtcbiAgICAgIHZhciBsZW4yID0gdWludDgubGVuZ3RoO1xuICAgICAgdmFyIGV4dHJhQnl0ZXMgPSBsZW4yICUgMztcbiAgICAgIHZhciBwYXJ0cyA9IFtdO1xuICAgICAgdmFyIG1heENodW5rTGVuZ3RoID0gMTYzODM7XG4gICAgICBmb3IgKHZhciBpMyA9IDAsIGxlbjIyID0gbGVuMiAtIGV4dHJhQnl0ZXM7IGkzIDwgbGVuMjI7IGkzICs9IG1heENodW5rTGVuZ3RoKSB7XG4gICAgICAgIHBhcnRzLnB1c2goZW5jb2RlQ2h1bmsodWludDgsIGkzLCBpMyArIG1heENodW5rTGVuZ3RoID4gbGVuMjIgPyBsZW4yMiA6IGkzICsgbWF4Q2h1bmtMZW5ndGgpKTtcbiAgICAgIH1cbiAgICAgIGlmIChleHRyYUJ5dGVzID09PSAxKSB7XG4gICAgICAgIHRtcCA9IHVpbnQ4W2xlbjIgLSAxXTtcbiAgICAgICAgcGFydHMucHVzaChcbiAgICAgICAgICBsb29rdXBbdG1wID4+IDJdICsgbG9va3VwW3RtcCA8PCA0ICYgNjNdICsgXCI9PVwiXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKGV4dHJhQnl0ZXMgPT09IDIpIHtcbiAgICAgICAgdG1wID0gKHVpbnQ4W2xlbjIgLSAyXSA8PCA4KSArIHVpbnQ4W2xlbjIgLSAxXTtcbiAgICAgICAgcGFydHMucHVzaChcbiAgICAgICAgICBsb29rdXBbdG1wID4+IDEwXSArIGxvb2t1cFt0bXAgPj4gNCAmIDYzXSArIGxvb2t1cFt0bXAgPDwgMiAmIDYzXSArIFwiPVwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGFydHMuam9pbihcIlwiKTtcbiAgICB9XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYmFzZTY0ID0gX19jb21tb25KUyh7XG4gIFwiLi4vLi4vbm9kZV9tb2R1bGVzL0Bjb3NtanMvZW5jb2RpbmcvYnVpbGQvYmFzZTY0LmpzXCIoZXhwb3J0cykge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIHZhciBfX2NyZWF0ZUJpbmRpbmcgPSBleHBvcnRzICYmIGV4cG9ydHMuX19jcmVhdGVCaW5kaW5nIHx8IChPYmplY3QuY3JlYXRlID8gZnVuY3Rpb24obzIsIG0yLCBrLCBrMikge1xuICAgICAgaWYgKGsyID09PSB2b2lkIDApIGsyID0gaztcbiAgICAgIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtMiwgayk7XG4gICAgICBpZiAoIWRlc2MgfHwgKFwiZ2V0XCIgaW4gZGVzYyA/ICFtMi5fX2VzTW9kdWxlIDogZGVzYy53cml0YWJsZSB8fCBkZXNjLmNvbmZpZ3VyYWJsZSkpIHtcbiAgICAgICAgZGVzYyA9IHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gbTJba107XG4gICAgICAgIH0gfTtcbiAgICAgIH1cbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvMiwgazIsIGRlc2MpO1xuICAgIH0gOiBmdW5jdGlvbihvMiwgbTIsIGssIGsyKSB7XG4gICAgICBpZiAoazIgPT09IHZvaWQgMCkgazIgPSBrO1xuICAgICAgbzJbazJdID0gbTJba107XG4gICAgfSk7XG4gICAgdmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9IGV4cG9ydHMgJiYgZXhwb3J0cy5fX3NldE1vZHVsZURlZmF1bHQgfHwgKE9iamVjdC5jcmVhdGUgPyBmdW5jdGlvbihvMiwgdjMpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvMiwgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYzIH0pO1xuICAgIH0gOiBmdW5jdGlvbihvMiwgdjMpIHtcbiAgICAgIG8yW1wiZGVmYXVsdFwiXSA9IHYzO1xuICAgIH0pO1xuICAgIHZhciBfX2ltcG9ydFN0YXIgPSBleHBvcnRzICYmIGV4cG9ydHMuX19pbXBvcnRTdGFyIHx8IGZ1bmN0aW9uKG1vZCkge1xuICAgICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICAgIGlmIChtb2QgIT0gbnVsbCkge1xuICAgICAgICBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgICAgfVxuICAgICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy5mcm9tQmFzZTY0ID0gZXhwb3J0cy50b0Jhc2U2NCA9IHZvaWQgMDtcbiAgICB2YXIgYmFzZTY0anMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZV9iYXNlNjRfanMoKSk7XG4gICAgZnVuY3Rpb24gdG9CYXNlNjQoZGF0YSkge1xuICAgICAgcmV0dXJuIGJhc2U2NGpzLmZyb21CeXRlQXJyYXkoZGF0YSk7XG4gICAgfVxuICAgIGV4cG9ydHMudG9CYXNlNjQgPSB0b0Jhc2U2NDtcbiAgICBmdW5jdGlvbiBmcm9tQmFzZTY0KGJhc2U2NFN0cmluZykge1xuICAgICAgaWYgKCFiYXNlNjRTdHJpbmcubWF0Y2goL15bYS16QS1aMC05Ky9dKj17MCwyfSQvKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGJhc2U2NCBzdHJpbmcgZm9ybWF0XCIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJhc2U2NGpzLnRvQnl0ZUFycmF5KGJhc2U2NFN0cmluZyk7XG4gICAgfVxuICAgIGV4cG9ydHMuZnJvbUJhc2U2NCA9IGZyb21CYXNlNjQ7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYmVjaDMyID0gX19jb21tb25KUyh7XG4gIFwiLi4vLi4vbm9kZV9tb2R1bGVzL0Bjb3NtanMvZW5jb2Rpbmcvbm9kZV9tb2R1bGVzL2JlY2gzMi9pbmRleC5qc1wiKGV4cG9ydHMsIG1vZHVsZSkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuICAgIHZhciBBTFBIQUJFVDIgPSBcInFwenJ5OXg4Z2YydHZkdzBzM2puNTRraGNlNm11YTdsXCI7XG4gICAgdmFyIEFMUEhBQkVUX01BUCA9IHt9O1xuICAgIGZvciAoeiA9IDA7IHogPCBBTFBIQUJFVDIubGVuZ3RoOyB6KyspIHtcbiAgICAgIHggPSBBTFBIQUJFVDIuY2hhckF0KHopO1xuICAgICAgaWYgKEFMUEhBQkVUX01BUFt4XSAhPT0gdm9pZCAwKSB0aHJvdyBuZXcgVHlwZUVycm9yKHggKyBcIiBpcyBhbWJpZ3VvdXNcIik7XG4gICAgICBBTFBIQUJFVF9NQVBbeF0gPSB6O1xuICAgIH1cbiAgICB2YXIgeDtcbiAgICB2YXIgejtcbiAgICBmdW5jdGlvbiBwb2x5bW9kU3RlcChwcmUpIHtcbiAgICAgIHZhciBiMyA9IHByZSA+PiAyNTtcbiAgICAgIHJldHVybiAocHJlICYgMzM1NTQ0MzEpIDw8IDUgXiAtKGIzID4+IDAgJiAxKSAmIDk5NjgyNTAxMCBeIC0oYjMgPj4gMSAmIDEpICYgNjQyODEzNTQ5IF4gLShiMyA+PiAyICYgMSkgJiA1MTM4NzQ0MjYgXiAtKGIzID4+IDMgJiAxKSAmIDEwMjc3NDg4MjkgXiAtKGIzID4+IDQgJiAxKSAmIDcwNTk3OTA1OTtcbiAgICB9XG4gICAgZnVuY3Rpb24gcHJlZml4Q2hrKHByZWZpeCkge1xuICAgICAgdmFyIGNoayA9IDE7XG4gICAgICBmb3IgKHZhciBpMiA9IDA7IGkyIDwgcHJlZml4Lmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YXIgYzIgPSBwcmVmaXguY2hhckNvZGVBdChpMik7XG4gICAgICAgIGlmIChjMiA8IDMzIHx8IGMyID4gMTI2KSByZXR1cm4gXCJJbnZhbGlkIHByZWZpeCAoXCIgKyBwcmVmaXggKyBcIilcIjtcbiAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIGMyID4+IDU7XG4gICAgICB9XG4gICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspO1xuICAgICAgZm9yIChpMiA9IDA7IGkyIDwgcHJlZml4Lmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YXIgdjMgPSBwcmVmaXguY2hhckNvZGVBdChpMik7XG4gICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoaykgXiB2MyAmIDMxO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNoaztcbiAgICB9XG4gICAgZnVuY3Rpb24gZW5jb2RlMihwcmVmaXgsIHdvcmRzLCBMSU1JVCkge1xuICAgICAgTElNSVQgPSBMSU1JVCB8fCA5MDtcbiAgICAgIGlmIChwcmVmaXgubGVuZ3RoICsgNyArIHdvcmRzLmxlbmd0aCA+IExJTUlUKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRXhjZWVkcyBsZW5ndGggbGltaXRcIik7XG4gICAgICBwcmVmaXggPSBwcmVmaXgudG9Mb3dlckNhc2UoKTtcbiAgICAgIHZhciBjaGsgPSBwcmVmaXhDaGsocHJlZml4KTtcbiAgICAgIGlmICh0eXBlb2YgY2hrID09PSBcInN0cmluZ1wiKSB0aHJvdyBuZXcgRXJyb3IoY2hrKTtcbiAgICAgIHZhciByZXN1bHQgPSBwcmVmaXggKyBcIjFcIjtcbiAgICAgIGZvciAodmFyIGkyID0gMDsgaTIgPCB3b3Jkcy5sZW5ndGg7ICsraTIpIHtcbiAgICAgICAgdmFyIHgyID0gd29yZHNbaTJdO1xuICAgICAgICBpZiAoeDIgPj4gNSAhPT0gMCkgdGhyb3cgbmV3IEVycm9yKFwiTm9uIDUtYml0IHdvcmRcIik7XG4gICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoaykgXiB4MjtcbiAgICAgICAgcmVzdWx0ICs9IEFMUEhBQkVUMi5jaGFyQXQoeDIpO1xuICAgICAgfVxuICAgICAgZm9yIChpMiA9IDA7IGkyIDwgNjsgKytpMikge1xuICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspO1xuICAgICAgfVxuICAgICAgY2hrIF49IDE7XG4gICAgICBmb3IgKGkyID0gMDsgaTIgPCA2OyArK2kyKSB7XG4gICAgICAgIHZhciB2MyA9IGNoayA+PiAoNSAtIGkyKSAqIDUgJiAzMTtcbiAgICAgICAgcmVzdWx0ICs9IEFMUEhBQkVUMi5jaGFyQXQodjMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgZnVuY3Rpb24gX19kZWNvZGUoc3RyLCBMSU1JVCkge1xuICAgICAgTElNSVQgPSBMSU1JVCB8fCA5MDtcbiAgICAgIGlmIChzdHIubGVuZ3RoIDwgOCkgcmV0dXJuIHN0ciArIFwiIHRvbyBzaG9ydFwiO1xuICAgICAgaWYgKHN0ci5sZW5ndGggPiBMSU1JVCkgcmV0dXJuIFwiRXhjZWVkcyBsZW5ndGggbGltaXRcIjtcbiAgICAgIHZhciBsb3dlcmVkID0gc3RyLnRvTG93ZXJDYXNlKCk7XG4gICAgICB2YXIgdXBwZXJlZCA9IHN0ci50b1VwcGVyQ2FzZSgpO1xuICAgICAgaWYgKHN0ciAhPT0gbG93ZXJlZCAmJiBzdHIgIT09IHVwcGVyZWQpIHJldHVybiBcIk1peGVkLWNhc2Ugc3RyaW5nIFwiICsgc3RyO1xuICAgICAgc3RyID0gbG93ZXJlZDtcbiAgICAgIHZhciBzcGxpdCA9IHN0ci5sYXN0SW5kZXhPZihcIjFcIik7XG4gICAgICBpZiAoc3BsaXQgPT09IC0xKSByZXR1cm4gXCJObyBzZXBhcmF0b3IgY2hhcmFjdGVyIGZvciBcIiArIHN0cjtcbiAgICAgIGlmIChzcGxpdCA9PT0gMCkgcmV0dXJuIFwiTWlzc2luZyBwcmVmaXggZm9yIFwiICsgc3RyO1xuICAgICAgdmFyIHByZWZpeCA9IHN0ci5zbGljZSgwLCBzcGxpdCk7XG4gICAgICB2YXIgd29yZENoYXJzID0gc3RyLnNsaWNlKHNwbGl0ICsgMSk7XG4gICAgICBpZiAod29yZENoYXJzLmxlbmd0aCA8IDYpIHJldHVybiBcIkRhdGEgdG9vIHNob3J0XCI7XG4gICAgICB2YXIgY2hrID0gcHJlZml4Q2hrKHByZWZpeCk7XG4gICAgICBpZiAodHlwZW9mIGNoayA9PT0gXCJzdHJpbmdcIikgcmV0dXJuIGNoaztcbiAgICAgIHZhciB3b3JkcyA9IFtdO1xuICAgICAgZm9yICh2YXIgaTIgPSAwOyBpMiA8IHdvcmRDaGFycy5sZW5ndGg7ICsraTIpIHtcbiAgICAgICAgdmFyIGMyID0gd29yZENoYXJzLmNoYXJBdChpMik7XG4gICAgICAgIHZhciB2MyA9IEFMUEhBQkVUX01BUFtjMl07XG4gICAgICAgIGlmICh2MyA9PT0gdm9pZCAwKSByZXR1cm4gXCJVbmtub3duIGNoYXJhY3RlciBcIiArIGMyO1xuICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspIF4gdjM7XG4gICAgICAgIGlmIChpMiArIDYgPj0gd29yZENoYXJzLmxlbmd0aCkgY29udGludWU7XG4gICAgICAgIHdvcmRzLnB1c2godjMpO1xuICAgICAgfVxuICAgICAgaWYgKGNoayAhPT0gMSkgcmV0dXJuIFwiSW52YWxpZCBjaGVja3N1bSBmb3IgXCIgKyBzdHI7XG4gICAgICByZXR1cm4geyBwcmVmaXgsIHdvcmRzIH07XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRlY29kZVVuc2FmZSgpIHtcbiAgICAgIHZhciByZXMgPSBfX2RlY29kZS5hcHBseShudWxsLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKHR5cGVvZiByZXMgPT09IFwib2JqZWN0XCIpIHJldHVybiByZXM7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGRlY29kZTMoc3RyKSB7XG4gICAgICB2YXIgcmVzID0gX19kZWNvZGUuYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcbiAgICAgIGlmICh0eXBlb2YgcmVzID09PSBcIm9iamVjdFwiKSByZXR1cm4gcmVzO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGNvbnZlcnQoZGF0YSwgaW5CaXRzLCBvdXRCaXRzLCBwYWQpIHtcbiAgICAgIHZhciB2YWx1ZSA9IDA7XG4gICAgICB2YXIgYml0cyA9IDA7XG4gICAgICB2YXIgbWF4ViA9ICgxIDw8IG91dEJpdHMpIC0gMTtcbiAgICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICAgIGZvciAodmFyIGkyID0gMDsgaTIgPCBkYXRhLmxlbmd0aDsgKytpMikge1xuICAgICAgICB2YWx1ZSA9IHZhbHVlIDw8IGluQml0cyB8IGRhdGFbaTJdO1xuICAgICAgICBiaXRzICs9IGluQml0cztcbiAgICAgICAgd2hpbGUgKGJpdHMgPj0gb3V0Qml0cykge1xuICAgICAgICAgIGJpdHMgLT0gb3V0Qml0cztcbiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSA+PiBiaXRzICYgbWF4Vik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChwYWQpIHtcbiAgICAgICAgaWYgKGJpdHMgPiAwKSB7XG4gICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUgPDwgb3V0Qml0cyAtIGJpdHMgJiBtYXhWKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGJpdHMgPj0gaW5CaXRzKSByZXR1cm4gXCJFeGNlc3MgcGFkZGluZ1wiO1xuICAgICAgICBpZiAodmFsdWUgPDwgb3V0Qml0cyAtIGJpdHMgJiBtYXhWKSByZXR1cm4gXCJOb24temVybyBwYWRkaW5nXCI7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b1dvcmRzVW5zYWZlKGJ5dGVzKSB7XG4gICAgICB2YXIgcmVzID0gY29udmVydChieXRlcywgOCwgNSwgdHJ1ZSk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpKSByZXR1cm4gcmVzO1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b1dvcmRzKGJ5dGVzKSB7XG4gICAgICB2YXIgcmVzID0gY29udmVydChieXRlcywgOCwgNSwgdHJ1ZSk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpKSByZXR1cm4gcmVzO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21Xb3Jkc1Vuc2FmZSh3b3Jkcykge1xuICAgICAgdmFyIHJlcyA9IGNvbnZlcnQod29yZHMsIDUsIDgsIGZhbHNlKTtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlcykpIHJldHVybiByZXM7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21Xb3Jkcyh3b3Jkcykge1xuICAgICAgdmFyIHJlcyA9IGNvbnZlcnQod29yZHMsIDUsIDgsIGZhbHNlKTtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlcykpIHJldHVybiByZXM7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzKTtcbiAgICB9XG4gICAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgICBkZWNvZGVVbnNhZmUsXG4gICAgICBkZWNvZGU6IGRlY29kZTMsXG4gICAgICBlbmNvZGU6IGVuY29kZTIsXG4gICAgICB0b1dvcmRzVW5zYWZlLFxuICAgICAgdG9Xb3JkcyxcbiAgICAgIGZyb21Xb3Jkc1Vuc2FmZSxcbiAgICAgIGZyb21Xb3Jkc1xuICAgIH07XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYmVjaDMyMiA9IF9fY29tbW9uSlMoe1xuICBcIi4uLy4uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL2JlY2gzMi5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICB2YXIgX19jcmVhdGVCaW5kaW5nID0gZXhwb3J0cyAmJiBleHBvcnRzLl9fY3JlYXRlQmluZGluZyB8fCAoT2JqZWN0LmNyZWF0ZSA/IGZ1bmN0aW9uKG8yLCBtMiwgaywgazIpIHtcbiAgICAgIGlmIChrMiA9PT0gdm9pZCAwKSBrMiA9IGs7XG4gICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobTIsIGspO1xuICAgICAgaWYgKCFkZXNjIHx8IChcImdldFwiIGluIGRlc2MgPyAhbTIuX19lc01vZHVsZSA6IGRlc2Mud3JpdGFibGUgfHwgZGVzYy5jb25maWd1cmFibGUpKSB7XG4gICAgICAgIGRlc2MgPSB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIG0yW2tdO1xuICAgICAgICB9IH07XG4gICAgICB9XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobzIsIGsyLCBkZXNjKTtcbiAgICB9IDogZnVuY3Rpb24obzIsIG0yLCBrLCBrMikge1xuICAgICAgaWYgKGsyID09PSB2b2lkIDApIGsyID0gaztcbiAgICAgIG8yW2syXSA9IG0yW2tdO1xuICAgIH0pO1xuICAgIHZhciBfX3NldE1vZHVsZURlZmF1bHQgPSBleHBvcnRzICYmIGV4cG9ydHMuX19zZXRNb2R1bGVEZWZhdWx0IHx8IChPYmplY3QuY3JlYXRlID8gZnVuY3Rpb24obzIsIHYzKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobzIsIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2MyB9KTtcbiAgICB9IDogZnVuY3Rpb24obzIsIHYzKSB7XG4gICAgICBvMltcImRlZmF1bHRcIl0gPSB2MztcbiAgICB9KTtcbiAgICB2YXIgX19pbXBvcnRTdGFyID0gZXhwb3J0cyAmJiBleHBvcnRzLl9faW1wb3J0U3RhciB8fCBmdW5jdGlvbihtb2QpIHtcbiAgICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgICBpZiAobW9kICE9IG51bGwpIHtcbiAgICAgICAgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICAgIH1cbiAgICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMubm9ybWFsaXplQmVjaDMyID0gZXhwb3J0cy5mcm9tQmVjaDMyID0gZXhwb3J0cy50b0JlY2gzMiA9IHZvaWQgMDtcbiAgICB2YXIgYmVjaDMyID0gX19pbXBvcnRTdGFyKHJlcXVpcmVfYmVjaDMyKCkpO1xuICAgIGZ1bmN0aW9uIHRvQmVjaDMyKHByZWZpeCwgZGF0YSwgbGltaXQyKSB7XG4gICAgICBjb25zdCBhZGRyZXNzID0gYmVjaDMyLmVuY29kZShwcmVmaXgsIGJlY2gzMi50b1dvcmRzKGRhdGEpLCBsaW1pdDIpO1xuICAgICAgcmV0dXJuIGFkZHJlc3M7XG4gICAgfVxuICAgIGV4cG9ydHMudG9CZWNoMzIgPSB0b0JlY2gzMjtcbiAgICBmdW5jdGlvbiBmcm9tQmVjaDMyKGFkZHJlc3MsIGxpbWl0MiA9IEluZmluaXR5KSB7XG4gICAgICBjb25zdCBkZWNvZGVkQWRkcmVzcyA9IGJlY2gzMi5kZWNvZGUoYWRkcmVzcywgbGltaXQyKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByZWZpeDogZGVjb2RlZEFkZHJlc3MucHJlZml4LFxuICAgICAgICBkYXRhOiBuZXcgVWludDhBcnJheShiZWNoMzIuZnJvbVdvcmRzKGRlY29kZWRBZGRyZXNzLndvcmRzKSlcbiAgICAgIH07XG4gICAgfVxuICAgIGV4cG9ydHMuZnJvbUJlY2gzMiA9IGZyb21CZWNoMzI7XG4gICAgZnVuY3Rpb24gbm9ybWFsaXplQmVjaDMyKGFkZHJlc3MpIHtcbiAgICAgIGNvbnN0IHsgcHJlZml4LCBkYXRhIH0gPSBmcm9tQmVjaDMyKGFkZHJlc3MpO1xuICAgICAgcmV0dXJuIHRvQmVjaDMyKHByZWZpeCwgZGF0YSk7XG4gICAgfVxuICAgIGV4cG9ydHMubm9ybWFsaXplQmVjaDMyID0gbm9ybWFsaXplQmVjaDMyO1xuICB9XG59KTtcblxuLy9cbnZhciByZXF1aXJlX2hleCA9IF9fY29tbW9uSlMoe1xuICBcIi4uLy4uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL2hleC5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy5mcm9tSGV4ID0gZXhwb3J0cy50b0hleCA9IHZvaWQgMDtcbiAgICBmdW5jdGlvbiB0b0hleChkYXRhKSB7XG4gICAgICBsZXQgb3V0ID0gXCJcIjtcbiAgICAgIGZvciAoY29uc3QgYnl0ZSBvZiBkYXRhKSB7XG4gICAgICAgIG91dCArPSAoXCIwXCIgKyBieXRlLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG4gICAgZXhwb3J0cy50b0hleCA9IHRvSGV4O1xuICAgIGZ1bmN0aW9uIGZyb21IZXgyKGhleHN0cmluZykge1xuICAgICAgaWYgKGhleHN0cmluZy5sZW5ndGggJSAyICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImhleCBzdHJpbmcgbGVuZ3RoIG11c3QgYmUgYSBtdWx0aXBsZSBvZiAyXCIpO1xuICAgICAgfVxuICAgICAgY29uc3Qgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoaGV4c3RyaW5nLmxlbmd0aCAvIDIpO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IG91dC5sZW5ndGg7IGkyKyspIHtcbiAgICAgICAgY29uc3QgaiA9IDIgKiBpMjtcbiAgICAgICAgY29uc3QgaGV4Qnl0ZUFzU3RyaW5nID0gaGV4c3RyaW5nLnNsaWNlKGosIGogKyAyKTtcbiAgICAgICAgaWYgKCFoZXhCeXRlQXNTdHJpbmcubWF0Y2goL1swLTlhLWZdezJ9L2kpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiaGV4IHN0cmluZyBjb250YWlucyBpbnZhbGlkIGNoYXJhY3RlcnNcIik7XG4gICAgICAgIH1cbiAgICAgICAgb3V0W2kyXSA9IHBhcnNlSW50KGhleEJ5dGVBc1N0cmluZywgMTYpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG91dDtcbiAgICB9XG4gICAgZXhwb3J0cy5mcm9tSGV4ID0gZnJvbUhleDI7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfcmZjMzMzOSA9IF9fY29tbW9uSlMoe1xuICBcIi4uLy4uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL3JmYzMzMzkuanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMudG9SZmMzMzM5ID0gZXhwb3J0cy5mcm9tUmZjMzMzOSA9IHZvaWQgMDtcbiAgICB2YXIgcmZjMzMzOU1hdGNoZXIgPSAvXihcXGR7NH0pLShcXGR7Mn0pLShcXGR7Mn0pW1QgXShcXGR7Mn0pOihcXGR7Mn0pOihcXGR7Mn0pKFxcLlxcZHsxLDl9KT8oKD86WystXVxcZHsyfTpcXGR7Mn0pfFopJC87XG4gICAgZnVuY3Rpb24gcGFkZGVkKGludGVnZXIsIGxlbmd0aCA9IDIpIHtcbiAgICAgIHJldHVybiBpbnRlZ2VyLnRvU3RyaW5nKCkucGFkU3RhcnQobGVuZ3RoLCBcIjBcIik7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21SZmMzMzM5KHN0cikge1xuICAgICAgY29uc3QgbWF0Y2hlczIgPSByZmMzMzM5TWF0Y2hlci5leGVjKHN0cik7XG4gICAgICBpZiAoIW1hdGNoZXMyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRhdGUgc3RyaW5nIGlzIG5vdCBpbiBSRkMzMzM5IGZvcm1hdFwiKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHllYXIgPSArbWF0Y2hlczJbMV07XG4gICAgICBjb25zdCBtb250aCA9ICttYXRjaGVzMlsyXTtcbiAgICAgIGNvbnN0IGRheSA9ICttYXRjaGVzMlszXTtcbiAgICAgIGNvbnN0IGhvdXIgPSArbWF0Y2hlczJbNF07XG4gICAgICBjb25zdCBtaW51dGUgPSArbWF0Y2hlczJbNV07XG4gICAgICBjb25zdCBzZWNvbmQgPSArbWF0Y2hlczJbNl07XG4gICAgICBjb25zdCBtaWxsaVNlY29uZHMgPSBtYXRjaGVzMls3XSA/IE1hdGguZmxvb3IoK21hdGNoZXMyWzddICogMWUzKSA6IDA7XG4gICAgICBsZXQgdHpPZmZzZXRTaWduO1xuICAgICAgbGV0IHR6T2Zmc2V0SG91cnM7XG4gICAgICBsZXQgdHpPZmZzZXRNaW51dGVzO1xuICAgICAgaWYgKG1hdGNoZXMyWzhdID09PSBcIlpcIikge1xuICAgICAgICB0ek9mZnNldFNpZ24gPSAxO1xuICAgICAgICB0ek9mZnNldEhvdXJzID0gMDtcbiAgICAgICAgdHpPZmZzZXRNaW51dGVzID0gMDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHR6T2Zmc2V0U2lnbiA9IG1hdGNoZXMyWzhdLnN1YnN0cmluZygwLCAxKSA9PT0gXCItXCIgPyAtMSA6IDE7XG4gICAgICAgIHR6T2Zmc2V0SG91cnMgPSArbWF0Y2hlczJbOF0uc3Vic3RyaW5nKDEsIDMpO1xuICAgICAgICB0ek9mZnNldE1pbnV0ZXMgPSArbWF0Y2hlczJbOF0uc3Vic3RyaW5nKDQsIDYpO1xuICAgICAgfVxuICAgICAgY29uc3QgdHpPZmZzZXQgPSB0ek9mZnNldFNpZ24gKiAodHpPZmZzZXRIb3VycyAqIDYwICsgdHpPZmZzZXRNaW51dGVzKSAqIDYwO1xuICAgICAgY29uc3QgZGF0ZSA9IC8qICAgICAgICAgICAqLyBuZXcgRGF0ZSgpO1xuICAgICAgZGF0ZS5zZXRVVENGdWxsWWVhcih5ZWFyLCBtb250aCAtIDEsIGRheSk7XG4gICAgICBkYXRlLnNldFVUQ0hvdXJzKGhvdXIsIG1pbnV0ZSwgc2Vjb25kLCBtaWxsaVNlY29uZHMpO1xuICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpIC0gdHpPZmZzZXQgKiAxZTMpO1xuICAgIH1cbiAgICBleHBvcnRzLmZyb21SZmMzMzM5ID0gZnJvbVJmYzMzMzk7XG4gICAgZnVuY3Rpb24gdG9SZmMzMzM5KGRhdGUpIHtcbiAgICAgIGNvbnN0IHllYXIgPSBkYXRlLmdldFVUQ0Z1bGxZZWFyKCk7XG4gICAgICBjb25zdCBtb250aCA9IHBhZGRlZChkYXRlLmdldFVUQ01vbnRoKCkgKyAxKTtcbiAgICAgIGNvbnN0IGRheSA9IHBhZGRlZChkYXRlLmdldFVUQ0RhdGUoKSk7XG4gICAgICBjb25zdCBob3VyID0gcGFkZGVkKGRhdGUuZ2V0VVRDSG91cnMoKSk7XG4gICAgICBjb25zdCBtaW51dGUgPSBwYWRkZWQoZGF0ZS5nZXRVVENNaW51dGVzKCkpO1xuICAgICAgY29uc3Qgc2Vjb25kID0gcGFkZGVkKGRhdGUuZ2V0VVRDU2Vjb25kcygpKTtcbiAgICAgIGNvbnN0IG1zID0gcGFkZGVkKGRhdGUuZ2V0VVRDTWlsbGlzZWNvbmRzKCksIDMpO1xuICAgICAgcmV0dXJuIGAke3llYXJ9LSR7bW9udGh9LSR7ZGF5fVQke2hvdXJ9OiR7bWludXRlfToke3NlY29uZH0uJHttc31aYDtcbiAgICB9XG4gICAgZXhwb3J0cy50b1JmYzMzMzkgPSB0b1JmYzMzMzk7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfdXRmOCA9IF9fY29tbW9uSlMoe1xuICBcIi4uLy4uL25vZGVfbW9kdWxlcy9AY29zbWpzL2VuY29kaW5nL2J1aWxkL3V0ZjguanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMuZnJvbVV0ZjggPSBleHBvcnRzLnRvVXRmOCA9IHZvaWQgMDtcbiAgICBmdW5jdGlvbiB0b1V0Zjgoc3RyKSB7XG4gICAgICByZXR1cm4gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKHN0cik7XG4gICAgfVxuICAgIGV4cG9ydHMudG9VdGY4ID0gdG9VdGY4O1xuICAgIGZ1bmN0aW9uIGZyb21VdGY4KGRhdGEsIGxvc3N5ID0gZmFsc2UpIHtcbiAgICAgIGNvbnN0IGZhdGFsID0gIWxvc3N5O1xuICAgICAgcmV0dXJuIG5ldyBUZXh0RGVjb2RlcihcInV0Zi04XCIsIHsgZmF0YWwgfSkuZGVjb2RlKGRhdGEpO1xuICAgIH1cbiAgICBleHBvcnRzLmZyb21VdGY4ID0gZnJvbVV0Zjg7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHJlcXVpcmVfYnVpbGQgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvQGNvc21qcy9lbmNvZGluZy9idWlsZC9pbmRleC5qc1wiKGV4cG9ydHMpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG4gICAgZXhwb3J0cy50b1V0ZjggPSBleHBvcnRzLmZyb21VdGY4ID0gZXhwb3J0cy50b1JmYzMzMzkgPSBleHBvcnRzLmZyb21SZmMzMzM5ID0gZXhwb3J0cy50b0hleCA9IGV4cG9ydHMuZnJvbUhleCA9IGV4cG9ydHMudG9CZWNoMzIgPSBleHBvcnRzLm5vcm1hbGl6ZUJlY2gzMiA9IGV4cG9ydHMuZnJvbUJlY2gzMiA9IGV4cG9ydHMudG9CYXNlNjQgPSBleHBvcnRzLmZyb21CYXNlNjQgPSBleHBvcnRzLnRvQXNjaWkgPSBleHBvcnRzLmZyb21Bc2NpaSA9IHZvaWQgMDtcbiAgICB2YXIgYXNjaWlfMSA9IHJlcXVpcmVfYXNjaWkoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tQXNjaWlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGFzY2lpXzEuZnJvbUFzY2lpO1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9Bc2NpaVwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYXNjaWlfMS50b0FzY2lpO1xuICAgIH0gfSk7XG4gICAgdmFyIGJhc2U2NF8xID0gcmVxdWlyZV9iYXNlNjQoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tQmFzZTY0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBiYXNlNjRfMS5mcm9tQmFzZTY0O1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9CYXNlNjRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGJhc2U2NF8xLnRvQmFzZTY0O1xuICAgIH0gfSk7XG4gICAgdmFyIGJlY2gzMl8xID0gcmVxdWlyZV9iZWNoMzIyKCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiZnJvbUJlY2gzMlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYmVjaDMyXzEuZnJvbUJlY2gzMjtcbiAgICB9IH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIm5vcm1hbGl6ZUJlY2gzMlwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gYmVjaDMyXzEubm9ybWFsaXplQmVjaDMyO1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9CZWNoMzJcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGJlY2gzMl8xLnRvQmVjaDMyO1xuICAgIH0gfSk7XG4gICAgdmFyIGhleF8xID0gcmVxdWlyZV9oZXgoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJmcm9tSGV4XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBoZXhfMS5mcm9tSGV4O1xuICAgIH0gfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwidG9IZXhcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGhleF8xLnRvSGV4O1xuICAgIH0gfSk7XG4gICAgdmFyIHJmYzMzMzlfMSA9IHJlcXVpcmVfcmZjMzMzOSgpO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcImZyb21SZmMzMzM5XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiByZmMzMzM5XzEuZnJvbVJmYzMzMzk7XG4gICAgfSB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJ0b1JmYzMzMzlcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHJmYzMzMzlfMS50b1JmYzMzMzk7XG4gICAgfSB9KTtcbiAgICB2YXIgdXRmOF8xID0gcmVxdWlyZV91dGY4KCk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiZnJvbVV0ZjhcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHV0ZjhfMS5mcm9tVXRmODtcbiAgICB9IH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcInRvVXRmOFwiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdXRmOF8xLnRvVXRmODtcbiAgICB9IH0pO1xuICB9XG59KTtcblxuLy9cbnZhciByZXF1aXJlX2Rpc3QgPSBfX2NvbW1vbkpTKHtcbiAgXCIuLi8uLi9ub2RlX21vZHVsZXMvYmVjaDMyL2Rpc3QvaW5kZXguanNcIihleHBvcnRzKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuICAgIGV4cG9ydHMuYmVjaDMybSA9IGV4cG9ydHMuYmVjaDMyID0gdm9pZCAwO1xuICAgIHZhciBBTFBIQUJFVDIgPSBcInFwenJ5OXg4Z2YydHZkdzBzM2puNTRraGNlNm11YTdsXCI7XG4gICAgdmFyIEFMUEhBQkVUX01BUCA9IHt9O1xuICAgIGZvciAobGV0IHogPSAwOyB6IDwgQUxQSEFCRVQyLmxlbmd0aDsgeisrKSB7XG4gICAgICBjb25zdCB4ID0gQUxQSEFCRVQyLmNoYXJBdCh6KTtcbiAgICAgIEFMUEhBQkVUX01BUFt4XSA9IHo7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHBvbHltb2RTdGVwKHByZSkge1xuICAgICAgY29uc3QgYjMgPSBwcmUgPj4gMjU7XG4gICAgICByZXR1cm4gKHByZSAmIDMzNTU0NDMxKSA8PCA1IF4gLShiMyA+PiAwICYgMSkgJiA5OTY4MjUwMTAgXiAtKGIzID4+IDEgJiAxKSAmIDY0MjgxMzU0OSBeIC0oYjMgPj4gMiAmIDEpICYgNTEzODc0NDI2IF4gLShiMyA+PiAzICYgMSkgJiAxMDI3NzQ4ODI5IF4gLShiMyA+PiA0ICYgMSkgJiA3MDU5NzkwNTk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHByZWZpeENoayhwcmVmaXgpIHtcbiAgICAgIGxldCBjaGsgPSAxO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IHByZWZpeC5sZW5ndGg7ICsraTIpIHtcbiAgICAgICAgY29uc3QgYzIgPSBwcmVmaXguY2hhckNvZGVBdChpMik7XG4gICAgICAgIGlmIChjMiA8IDMzIHx8IGMyID4gMTI2KVxuICAgICAgICAgIHJldHVybiBcIkludmFsaWQgcHJlZml4IChcIiArIHByZWZpeCArIFwiKVwiO1xuICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspIF4gYzIgPj4gNTtcbiAgICAgIH1cbiAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoayk7XG4gICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgcHJlZml4Lmxlbmd0aDsgKytpMikge1xuICAgICAgICBjb25zdCB2MyA9IHByZWZpeC5jaGFyQ29kZUF0KGkyKTtcbiAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIHYzICYgMzE7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2hrO1xuICAgIH1cbiAgICBmdW5jdGlvbiBjb252ZXJ0KGRhdGEsIGluQml0cywgb3V0Qml0cywgcGFkKSB7XG4gICAgICBsZXQgdmFsdWUgPSAwO1xuICAgICAgbGV0IGJpdHMgPSAwO1xuICAgICAgY29uc3QgbWF4ViA9ICgxIDw8IG91dEJpdHMpIC0gMTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGRhdGEubGVuZ3RoOyArK2kyKSB7XG4gICAgICAgIHZhbHVlID0gdmFsdWUgPDwgaW5CaXRzIHwgZGF0YVtpMl07XG4gICAgICAgIGJpdHMgKz0gaW5CaXRzO1xuICAgICAgICB3aGlsZSAoYml0cyA+PSBvdXRCaXRzKSB7XG4gICAgICAgICAgYml0cyAtPSBvdXRCaXRzO1xuICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlID4+IGJpdHMgJiBtYXhWKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHBhZCkge1xuICAgICAgICBpZiAoYml0cyA+IDApIHtcbiAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSA8PCBvdXRCaXRzIC0gYml0cyAmIG1heFYpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoYml0cyA+PSBpbkJpdHMpXG4gICAgICAgICAgcmV0dXJuIFwiRXhjZXNzIHBhZGRpbmdcIjtcbiAgICAgICAgaWYgKHZhbHVlIDw8IG91dEJpdHMgLSBiaXRzICYgbWF4VilcbiAgICAgICAgICByZXR1cm4gXCJOb24temVybyBwYWRkaW5nXCI7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBmdW5jdGlvbiB0b1dvcmRzKGJ5dGVzKSB7XG4gICAgICByZXR1cm4gY29udmVydChieXRlcywgOCwgNSwgdHJ1ZSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZyb21Xb3Jkc1Vuc2FmZSh3b3Jkcykge1xuICAgICAgY29uc3QgcmVzID0gY29udmVydCh3b3JkcywgNSwgOCwgZmFsc2UpO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVzKSlcbiAgICAgICAgcmV0dXJuIHJlcztcbiAgICB9XG4gICAgZnVuY3Rpb24gZnJvbVdvcmRzKHdvcmRzKSB7XG4gICAgICBjb25zdCByZXMgPSBjb252ZXJ0KHdvcmRzLCA1LCA4LCBmYWxzZSk7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXMpKVxuICAgICAgICByZXR1cm4gcmVzO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldExpYnJhcnlGcm9tRW5jb2RpbmcoZW5jb2RpbmcpIHtcbiAgICAgIGxldCBFTkNPRElOR19DT05TVDtcbiAgICAgIGlmIChlbmNvZGluZyA9PT0gXCJiZWNoMzJcIikge1xuICAgICAgICBFTkNPRElOR19DT05TVCA9IDE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBFTkNPRElOR19DT05TVCA9IDczNDUzOTkzOTtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIGVuY29kZTIocHJlZml4LCB3b3JkcywgTElNSVQpIHtcbiAgICAgICAgTElNSVQgPSBMSU1JVCB8fCA5MDtcbiAgICAgICAgaWYgKHByZWZpeC5sZW5ndGggKyA3ICsgd29yZHMubGVuZ3RoID4gTElNSVQpXG4gICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkV4Y2VlZHMgbGVuZ3RoIGxpbWl0XCIpO1xuICAgICAgICBwcmVmaXggPSBwcmVmaXgudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgbGV0IGNoayA9IHByZWZpeENoayhwcmVmaXgpO1xuICAgICAgICBpZiAodHlwZW9mIGNoayA9PT0gXCJzdHJpbmdcIilcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoY2hrKTtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHByZWZpeCArIFwiMVwiO1xuICAgICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgd29yZHMubGVuZ3RoOyArK2kyKSB7XG4gICAgICAgICAgY29uc3QgeCA9IHdvcmRzW2kyXTtcbiAgICAgICAgICBpZiAoeCA+PiA1ICE9PSAwKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm9uIDUtYml0IHdvcmRcIik7XG4gICAgICAgICAgY2hrID0gcG9seW1vZFN0ZXAoY2hrKSBeIHg7XG4gICAgICAgICAgcmVzdWx0ICs9IEFMUEhBQkVUMi5jaGFyQXQoeCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IDY7ICsraTIpIHtcbiAgICAgICAgICBjaGsgPSBwb2x5bW9kU3RlcChjaGspO1xuICAgICAgICB9XG4gICAgICAgIGNoayBePSBFTkNPRElOR19DT05TVDtcbiAgICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IDY7ICsraTIpIHtcbiAgICAgICAgICBjb25zdCB2MyA9IGNoayA+PiAoNSAtIGkyKSAqIDUgJiAzMTtcbiAgICAgICAgICByZXN1bHQgKz0gQUxQSEFCRVQyLmNoYXJBdCh2Myk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIF9fZGVjb2RlKHN0ciwgTElNSVQpIHtcbiAgICAgICAgTElNSVQgPSBMSU1JVCB8fCA5MDtcbiAgICAgICAgaWYgKHN0ci5sZW5ndGggPCA4KVxuICAgICAgICAgIHJldHVybiBzdHIgKyBcIiB0b28gc2hvcnRcIjtcbiAgICAgICAgaWYgKHN0ci5sZW5ndGggPiBMSU1JVClcbiAgICAgICAgICByZXR1cm4gXCJFeGNlZWRzIGxlbmd0aCBsaW1pdFwiO1xuICAgICAgICBjb25zdCBsb3dlcmVkID0gc3RyLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IHVwcGVyZWQgPSBzdHIudG9VcHBlckNhc2UoKTtcbiAgICAgICAgaWYgKHN0ciAhPT0gbG93ZXJlZCAmJiBzdHIgIT09IHVwcGVyZWQpXG4gICAgICAgICAgcmV0dXJuIFwiTWl4ZWQtY2FzZSBzdHJpbmcgXCIgKyBzdHI7XG4gICAgICAgIHN0ciA9IGxvd2VyZWQ7XG4gICAgICAgIGNvbnN0IHNwbGl0ID0gc3RyLmxhc3RJbmRleE9mKFwiMVwiKTtcbiAgICAgICAgaWYgKHNwbGl0ID09PSAtMSlcbiAgICAgICAgICByZXR1cm4gXCJObyBzZXBhcmF0b3IgY2hhcmFjdGVyIGZvciBcIiArIHN0cjtcbiAgICAgICAgaWYgKHNwbGl0ID09PSAwKVxuICAgICAgICAgIHJldHVybiBcIk1pc3NpbmcgcHJlZml4IGZvciBcIiArIHN0cjtcbiAgICAgICAgY29uc3QgcHJlZml4ID0gc3RyLnNsaWNlKDAsIHNwbGl0KTtcbiAgICAgICAgY29uc3Qgd29yZENoYXJzID0gc3RyLnNsaWNlKHNwbGl0ICsgMSk7XG4gICAgICAgIGlmICh3b3JkQ2hhcnMubGVuZ3RoIDwgNilcbiAgICAgICAgICByZXR1cm4gXCJEYXRhIHRvbyBzaG9ydFwiO1xuICAgICAgICBsZXQgY2hrID0gcHJlZml4Q2hrKHByZWZpeCk7XG4gICAgICAgIGlmICh0eXBlb2YgY2hrID09PSBcInN0cmluZ1wiKVxuICAgICAgICAgIHJldHVybiBjaGs7XG4gICAgICAgIGNvbnN0IHdvcmRzID0gW107XG4gICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCB3b3JkQ2hhcnMubGVuZ3RoOyArK2kyKSB7XG4gICAgICAgICAgY29uc3QgYzIgPSB3b3JkQ2hhcnMuY2hhckF0KGkyKTtcbiAgICAgICAgICBjb25zdCB2MyA9IEFMUEhBQkVUX01BUFtjMl07XG4gICAgICAgICAgaWYgKHYzID09PSB2b2lkIDApXG4gICAgICAgICAgICByZXR1cm4gXCJVbmtub3duIGNoYXJhY3RlciBcIiArIGMyO1xuICAgICAgICAgIGNoayA9IHBvbHltb2RTdGVwKGNoaykgXiB2MztcbiAgICAgICAgICBpZiAoaTIgKyA2ID49IHdvcmRDaGFycy5sZW5ndGgpXG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB3b3Jkcy5wdXNoKHYzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hrICE9PSBFTkNPRElOR19DT05TVClcbiAgICAgICAgICByZXR1cm4gXCJJbnZhbGlkIGNoZWNrc3VtIGZvciBcIiArIHN0cjtcbiAgICAgICAgcmV0dXJuIHsgcHJlZml4LCB3b3JkcyB9O1xuICAgICAgfVxuICAgICAgZnVuY3Rpb24gZGVjb2RlVW5zYWZlKHN0ciwgTElNSVQpIHtcbiAgICAgICAgY29uc3QgcmVzID0gX19kZWNvZGUoc3RyLCBMSU1JVCk7XG4gICAgICAgIGlmICh0eXBlb2YgcmVzID09PSBcIm9iamVjdFwiKVxuICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBkZWNvZGUzKHN0ciwgTElNSVQpIHtcbiAgICAgICAgY29uc3QgcmVzID0gX19kZWNvZGUoc3RyLCBMSU1JVCk7XG4gICAgICAgIGlmICh0eXBlb2YgcmVzID09PSBcIm9iamVjdFwiKVxuICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihyZXMpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGVjb2RlVW5zYWZlLFxuICAgICAgICBkZWNvZGU6IGRlY29kZTMsXG4gICAgICAgIGVuY29kZTogZW5jb2RlMixcbiAgICAgICAgdG9Xb3JkcyxcbiAgICAgICAgZnJvbVdvcmRzVW5zYWZlLFxuICAgICAgICBmcm9tV29yZHNcbiAgICAgIH07XG4gICAgfVxuICAgIGV4cG9ydHMuYmVjaDMyID0gZ2V0TGlicmFyeUZyb21FbmNvZGluZyhcImJlY2gzMlwiKTtcbiAgICBleHBvcnRzLmJlY2gzMm0gPSBnZXRMaWJyYXJ5RnJvbUVuY29kaW5nKFwiYmVjaDMybVwiKTtcbiAgfVxufSk7XG5cbi8vXG52YXIgZ2xvYmFsQXNzZXJ0ID0gZ2xvYmFsVGhpcy5hc3NlcnQ7XG5pZiAoZ2xvYmFsQXNzZXJ0ID09PSB2b2lkIDApIHtcbiAgdGhyb3cgRXJyb3IoXG4gICAgYENhbm5vdCBpbml0aWFsaXplIEBlbmRvL2Vycm9ycywgbWlzc2luZyBnbG9iYWxUaGlzLmFzc2VydCwgaW1wb3J0ICdzZXMnIGJlZm9yZSAnQGVuZG8vZXJyb3JzJ2BcbiAgKTtcbn1cbnZhciBtaXNzaW5nID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBbXG4gICAgXCJ0eXBlb2ZcIixcbiAgICBcImVycm9yXCIsXG4gICAgXCJmYWlsXCIsXG4gICAgXCJlcXVhbFwiLFxuICAgIFwic3RyaW5nXCIsXG4gICAgXCJub3RlXCIsXG4gICAgXCJkZXRhaWxzXCIsXG4gICAgXCJGYWlsXCIsXG4gICAgXCJxdW90ZVwiLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgXCJtYWtlQXNzZXJ0XCJcbiAgXS5maWx0ZXIoKG5hbWUpID0+IGdsb2JhbEFzc2VydFtuYW1lXSA9PT0gdm9pZCAwKVxuKTtcbmlmIChtaXNzaW5nLmxlbmd0aCA+IDApIHtcbiAgdGhyb3cgRXJyb3IoXG4gICAgYENhbm5vdCBpbml0aWFsaXplIEBlbmRvL2Vycm9ycywgbWlzc2luZyBnbG9iYWxUaGlzLmFzc2VydCBtZXRob2RzICR7bWlzc2luZy5qb2luKFxuICAgICAgXCIsIFwiXG4gICAgKX1gXG4gICk7XG59XG52YXIge1xuICBiYXJlLFxuICBkZXRhaWxzOiByZWRhY3RlZCxcbiAgZXJyb3I6IG1ha2VFcnJvcixcbiAgRmFpbDogdGhyb3dSZWRhY3RlZCxcbiAgbWFrZUFzc2VydDogX29taXR0ZWRNYWtlQXNzZXJ0LFxuICBub3RlLFxuICBxdW90ZSxcbiAgLi4uYXNzZXJ0aW9uc1xufSA9IGdsb2JhbEFzc2VydDtcbnZhciBhc3NlcnQyID0gKHZhbHVlLCBvcHREZXRhaWxzLCBlcnJDb250cnVjdG9yLCBvcHRpb25zKSA9PiBnbG9iYWxBc3NlcnQodmFsdWUsIG9wdERldGFpbHMsIGVyckNvbnRydWN0b3IsIG9wdGlvbnMpO1xuT2JqZWN0LmFzc2lnbihhc3NlcnQyLCBhc3NlcnRpb25zKTtcbnZhciBiYXJlT3JRdW90ZSA9IGJhcmUgfHwgcXVvdGU7XG5cbi8vXG52YXIgeyBmcmVlemUgfSA9IE9iamVjdDtcbnZhciB7IGFwcGx5IH0gPSBSZWZsZWN0O1xudmFyIHVuY3VycnlUaGlzID0gKGZuKSA9PiAocmVjZWl2ZXIsIC4uLmFyZ3MpID0+IGFwcGx5KGZuLCByZWNlaXZlciwgYXJncyk7XG52YXIgYXJyYXlQdXNoID0gdW5jdXJyeVRoaXMoQXJyYXkucHJvdG90eXBlLnB1c2gpO1xudmFyIGFycmF5SW5jbHVkZXMgPSB1bmN1cnJ5VGhpcyhBcnJheS5wcm90b3R5cGUuaW5jbHVkZXMpO1xudmFyIHN0cmluZ1NwbGl0ID0gdW5jdXJyeVRoaXMoU3RyaW5nLnByb3RvdHlwZS5zcGxpdCk7XG52YXIgcSA9IEpTT04uc3RyaW5naWZ5O1xudmFyIEZhaWwgPSAobGl0ZXJhbHMsIC4uLmFyZ3MpID0+IHtcbiAgbGV0IG1zZyA9IGxpdGVyYWxzWzBdO1xuICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgYXJncy5sZW5ndGg7IGkyICs9IDEpIHtcbiAgICBtc2cgPSBgJHttc2d9JHthcmdzW2kyXX0ke2xpdGVyYWxzW2kyICsgMV19YDtcbiAgfVxuICB0aHJvdyBFcnJvcihtc2cpO1xufTtcbnZhciBtYWtlRW52aXJvbm1lbnRDYXB0b3IgPSAoYUdsb2JhbCwgZHJvcE5hbWVzID0gZmFsc2UpID0+IHtcbiAgY29uc3QgY2FwdHVyZWRFbnZpcm9ubWVudE9wdGlvbk5hbWVzID0gW107XG4gIGNvbnN0IGdldEVudmlyb25tZW50T3B0aW9uMiA9IChvcHRpb25OYW1lLCBkZWZhdWx0U2V0dGluZywgb3B0T3RoZXJWYWx1ZXMgPSB2b2lkIDApID0+IHtcbiAgICB0eXBlb2Ygb3B0aW9uTmFtZSA9PT0gXCJzdHJpbmdcIiB8fCBGYWlsYEVudmlyb25tZW50IG9wdGlvbiBuYW1lICR7cShvcHRpb25OYW1lKX0gbXVzdCBiZSBhIHN0cmluZy5gO1xuICAgIHR5cGVvZiBkZWZhdWx0U2V0dGluZyA9PT0gXCJzdHJpbmdcIiB8fCBGYWlsYEVudmlyb25tZW50IG9wdGlvbiBkZWZhdWx0IHNldHRpbmcgJHtxKFxuICAgICAgZGVmYXVsdFNldHRpbmdcbiAgICApfSBtdXN0IGJlIGEgc3RyaW5nLmA7XG4gICAgbGV0IHNldHRpbmcgPSBkZWZhdWx0U2V0dGluZztcbiAgICBjb25zdCBnbG9iYWxQcm9jZXNzID0gYUdsb2JhbC5wcm9jZXNzIHx8IHZvaWQgMDtcbiAgICBjb25zdCBnbG9iYWxFbnYgPSB0eXBlb2YgZ2xvYmFsUHJvY2VzcyA9PT0gXCJvYmplY3RcIiAmJiBnbG9iYWxQcm9jZXNzLmVudiB8fCB2b2lkIDA7XG4gICAgaWYgKHR5cGVvZiBnbG9iYWxFbnYgPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGlmIChvcHRpb25OYW1lIGluIGdsb2JhbEVudikge1xuICAgICAgICBpZiAoIWRyb3BOYW1lcykge1xuICAgICAgICAgIGFycmF5UHVzaChjYXB0dXJlZEVudmlyb25tZW50T3B0aW9uTmFtZXMsIG9wdGlvbk5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9wdGlvblZhbHVlID0gZ2xvYmFsRW52W29wdGlvbk5hbWVdO1xuICAgICAgICB0eXBlb2Ygb3B0aW9uVmFsdWUgPT09IFwic3RyaW5nXCIgfHwgRmFpbGBFbnZpcm9ubWVudCBvcHRpb24gbmFtZWQgJHtxKFxuICAgICAgICAgIG9wdGlvbk5hbWVcbiAgICAgICAgKX0sIGlmIHByZXNlbnQsIG11c3QgaGF2ZSBhIGNvcnJlc3BvbmRpbmcgc3RyaW5nIHZhbHVlLCBnb3QgJHtxKFxuICAgICAgICAgIG9wdGlvblZhbHVlXG4gICAgICAgICl9YDtcbiAgICAgICAgc2V0dGluZyA9IG9wdGlvblZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICBvcHRPdGhlclZhbHVlcyA9PT0gdm9pZCAwIHx8IHNldHRpbmcgPT09IGRlZmF1bHRTZXR0aW5nIHx8IGFycmF5SW5jbHVkZXMob3B0T3RoZXJWYWx1ZXMsIHNldHRpbmcpIHx8IEZhaWxgVW5yZWNvZ25pemVkICR7cShvcHRpb25OYW1lKX0gdmFsdWUgJHtxKFxuICAgICAgc2V0dGluZ1xuICAgICl9LiBFeHBlY3RlZCBvbmUgb2YgJHtxKFtkZWZhdWx0U2V0dGluZywgLi4ub3B0T3RoZXJWYWx1ZXNdKX1gO1xuICAgIHJldHVybiBzZXR0aW5nO1xuICB9O1xuICBmcmVlemUoZ2V0RW52aXJvbm1lbnRPcHRpb24yKTtcbiAgY29uc3QgZ2V0RW52aXJvbm1lbnRPcHRpb25zTGlzdDIgPSAob3B0aW9uTmFtZSkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGdldEVudmlyb25tZW50T3B0aW9uMihvcHRpb25OYW1lLCBcIlwiKTtcbiAgICByZXR1cm4gZnJlZXplKG9wdGlvbiA9PT0gXCJcIiA/IFtdIDogc3RyaW5nU3BsaXQob3B0aW9uLCBcIixcIikpO1xuICB9O1xuICBmcmVlemUoZ2V0RW52aXJvbm1lbnRPcHRpb25zTGlzdDIpO1xuICBjb25zdCBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzMiA9IChvcHRpb25OYW1lLCBlbGVtZW50KSA9PiBhcnJheUluY2x1ZGVzKGdldEVudmlyb25tZW50T3B0aW9uc0xpc3QyKG9wdGlvbk5hbWUpLCBlbGVtZW50KTtcbiAgY29uc3QgZ2V0Q2FwdHVyZWRFbnZpcm9ubWVudE9wdGlvbk5hbWVzID0gKCkgPT4ge1xuICAgIHJldHVybiBmcmVlemUoWy4uLmNhcHR1cmVkRW52aXJvbm1lbnRPcHRpb25OYW1lc10pO1xuICB9O1xuICBmcmVlemUoZ2V0Q2FwdHVyZWRFbnZpcm9ubWVudE9wdGlvbk5hbWVzKTtcbiAgcmV0dXJuIGZyZWV6ZSh7XG4gICAgZ2V0RW52aXJvbm1lbnRPcHRpb246IGdldEVudmlyb25tZW50T3B0aW9uMixcbiAgICBnZXRFbnZpcm9ubWVudE9wdGlvbnNMaXN0OiBnZXRFbnZpcm9ubWVudE9wdGlvbnNMaXN0MixcbiAgICBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzOiBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzMixcbiAgICBnZXRDYXB0dXJlZEVudmlyb25tZW50T3B0aW9uTmFtZXNcbiAgfSk7XG59O1xuZnJlZXplKG1ha2VFbnZpcm9ubWVudENhcHRvcik7XG52YXIge1xuICBnZXRFbnZpcm9ubWVudE9wdGlvbixcbiAgZ2V0RW52aXJvbm1lbnRPcHRpb25zTGlzdCxcbiAgZW52aXJvbm1lbnRPcHRpb25zTGlzdEhhc1xufSA9IG1ha2VFbnZpcm9ubWVudENhcHRvcihnbG9iYWxUaGlzLCB0cnVlKTtcblxuLy9cbnZhciB7IHF1b3RlOiBxMiwgRmFpbDogRmFpbDIgfSA9IGFzc2VydDtcbnZhciB7IGhhc093biwgZnJlZXplOiBmcmVlemUyLCBlbnRyaWVzIH0gPSBPYmplY3Q7XG52YXIgaXNKU09OUmVjb3JkID0gKHZhbCkgPT4gdHlwZW9mIHZhbCA9PT0gXCJvYmplY3RcIiAmJiB2YWwgIT09IG51bGwgJiYgIUFycmF5LmlzQXJyYXkodmFsKTtcbnZhciBzaW1wbGlmeVRhZyA9ICh0YWcpID0+IHtcbiAgZm9yIChjb25zdCBwcmVmaXggb2YgW1wiQWxsZWdlZDogXCIsIFwiRGVidWdOYW1lOiBcIl0pIHtcbiAgICBpZiAodGFnLnN0YXJ0c1dpdGgocHJlZml4KSkge1xuICAgICAgcmV0dXJuIHRhZy5zbGljZShwcmVmaXgubGVuZ3RoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRhZztcbn07XG52YXIgbWFrZU1lc3NhZ2VCcmVha3BvaW50VGVzdGVyID0gKG9wdGlvbk5hbWUpID0+IHtcbiAgbGV0IGJyZWFrcG9pbnRzID0gSlNPTi5wYXJzZShnZXRFbnZpcm9ubWVudE9wdGlvbihvcHRpb25OYW1lLCBcIm51bGxcIikpO1xuICBpZiAoYnJlYWtwb2ludHMgPT09IG51bGwpIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIGxldCBicmVha3BvaW50c1RhYmxlO1xuICBjb25zdCBnZXRCcmVha3BvaW50cyA9ICgpID0+IGJyZWFrcG9pbnRzO1xuICBmcmVlemUyKGdldEJyZWFrcG9pbnRzKTtcbiAgY29uc3Qgc2V0QnJlYWtwb2ludHMgPSAobmV3QnJlYWtwb2ludHMgPSBicmVha3BvaW50cykgPT4ge1xuICAgIGlzSlNPTlJlY29yZChuZXdCcmVha3BvaW50cykgfHwgRmFpbDJgRXhwZWN0ZWQgJHtxMihvcHRpb25OYW1lKX0gb3B0aW9uIHRvIGJlIGEgSlNPTiBicmVha3BvaW50cyByZWNvcmRgO1xuICAgIGNvbnN0IG5ld0JyZWFrcG9pbnRzVGFibGUgPSB7IF9fcHJvdG9fXzogbnVsbCB9O1xuICAgIGZvciAoY29uc3QgW3RhZywgbWV0aG9kQlBzXSBvZiBlbnRyaWVzKG5ld0JyZWFrcG9pbnRzKSkge1xuICAgICAgdGFnID09PSBzaW1wbGlmeVRhZyh0YWcpIHx8IEZhaWwyYEp1c3QgdXNlIHNpbXBsZSB0YWcgJHtxMihzaW1wbGlmeVRhZyh0YWcpKX0gcmF0aGVyIHRoYW4gJHtxMih0YWcpfWA7XG4gICAgICBpc0pTT05SZWNvcmQobWV0aG9kQlBzKSB8fCBGYWlsMmBFeHBlY3RlZCAke3EyKG9wdGlvbk5hbWUpfSBvcHRpb24ncyAke3EyKFxuICAgICAgICB0YWdcbiAgICAgICl9IHRvIGJlIGEgSlNPTiBtZXRob2RzIGJyZWFrcG9pbnRzIHJlY29yZGA7XG4gICAgICBmb3IgKGNvbnN0IFttZXRob2ROYW1lLCBjb3VudF0gb2YgZW50cmllcyhtZXRob2RCUHMpKSB7XG4gICAgICAgIGNvdW50ID09PSBcIipcIiB8fCB0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIgJiYgTnVtYmVyLmlzU2FmZUludGVnZXIoY291bnQpICYmIGNvdW50ID49IDAgfHwgRmFpbDJgRXhwZWN0ZWQgJHtxMihvcHRpb25OYW1lKX0gb3B0aW9uJ3MgJHtxMih0YWcpfS4ke3EyKFxuICAgICAgICAgIG1ldGhvZE5hbWVcbiAgICAgICAgKX0gdG8gYmUgXCIqXCIgb3IgYSBub24tbmVnYXRpdmUgaW50ZWdlcmA7XG4gICAgICAgIGNvbnN0IGNsYXNzQlBzID0gaGFzT3duKG5ld0JyZWFrcG9pbnRzVGFibGUsIG1ldGhvZE5hbWUpID8gbmV3QnJlYWtwb2ludHNUYWJsZVttZXRob2ROYW1lXSA6IG5ld0JyZWFrcG9pbnRzVGFibGVbbWV0aG9kTmFtZV0gPSB7XG4gICAgICAgICAgLy9cbiAgICAgICAgICBfX3Byb3RvX186IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgY2xhc3NCUHNbdGFnXSA9IGNvdW50O1xuICAgICAgfVxuICAgIH1cbiAgICBicmVha3BvaW50cyA9IG5ld0JyZWFrcG9pbnRzO1xuICAgIGJyZWFrcG9pbnRzVGFibGUgPSBuZXdCcmVha3BvaW50c1RhYmxlO1xuICB9O1xuICBmcmVlemUyKHNldEJyZWFrcG9pbnRzKTtcbiAgY29uc3Qgc2hvdWxkQnJlYWtwb2ludCA9IChyZWNpcGllbnQsIG1ldGhvZE5hbWUpID0+IHtcbiAgICBpZiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwIHx8IG1ldGhvZE5hbWUgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgY2xhc3NCUHMgPSBicmVha3BvaW50c1RhYmxlW21ldGhvZE5hbWVdIHx8IGJyZWFrcG9pbnRzVGFibGVbXCIqXCJdO1xuICAgIGlmIChjbGFzc0JQcyA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGxldCB0YWcgPSBzaW1wbGlmeVRhZyhyZWNpcGllbnRbU3ltYm9sLnRvU3RyaW5nVGFnXSk7XG4gICAgbGV0IGNvdW50ID0gY2xhc3NCUHNbdGFnXTtcbiAgICBpZiAoY291bnQgPT09IHZvaWQgMCkge1xuICAgICAgdGFnID0gXCIqXCI7XG4gICAgICBjb3VudCA9IGNsYXNzQlBzW3RhZ107XG4gICAgICBpZiAoY291bnQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChjb3VudCA9PT0gXCIqXCIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoY291bnQgPT09IDApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBhc3NlcnQodHlwZW9mIGNvdW50ID09PSBcIm51bWJlclwiICYmIGNvdW50ID49IDEpO1xuICAgIGNsYXNzQlBzW3RhZ10gPSBjb3VudCAtIDE7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICBmcmVlemUyKHNob3VsZEJyZWFrcG9pbnQpO1xuICBjb25zdCBicmVha3BvaW50VGVzdGVyID0gZnJlZXplMih7XG4gICAgZ2V0QnJlYWtwb2ludHMsXG4gICAgc2V0QnJlYWtwb2ludHMsXG4gICAgc2hvdWxkQnJlYWtwb2ludFxuICB9KTtcbiAgYnJlYWtwb2ludFRlc3Rlci5zZXRCcmVha3BvaW50cygpO1xuICByZXR1cm4gYnJlYWtwb2ludFRlc3Rlcjtcbn07XG5mcmVlemUyKG1ha2VNZXNzYWdlQnJlYWtwb2ludFRlc3Rlcik7XG5cbi8vXG52YXIgeyBkZXRhaWxzOiBYLCBxdW90ZTogcTMsIEZhaWw6IEZhaWwzIH0gPSBhc3NlcnQ7XG52YXIgeyBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzLCBnZXRQcm90b3R5cGVPZiwgZnJlZXplOiBmcmVlemUzIH0gPSBPYmplY3Q7XG52YXIgeyBhcHBseTogYXBwbHkyLCBvd25LZXlzIH0gPSBSZWZsZWN0O1xudmFyIG9uRGVsaXZlcnkgPSBtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIoXCJFTkRPX0RFTElWRVJZX0JSRUFLUE9JTlRTXCIpO1xudmFyIGlzT2JqZWN0ID0gKHZhbCkgPT4gT2JqZWN0KHZhbCkgPT09IHZhbDtcbnZhciBjb21wYXJlU3RyaW5naWZpZWQgPSAoYTIsIGIzKSA9PiB7XG4gIGlmICh0eXBlb2YgYTIgPT09IHR5cGVvZiBiMykge1xuICAgIGNvbnN0IGxlZnQgPSBTdHJpbmcoYTIpO1xuICAgIGNvbnN0IHJpZ2h0ID0gU3RyaW5nKGIzKTtcbiAgICByZXR1cm4gbGVmdCA8IHJpZ2h0ID8gLTEgOiBsZWZ0ID4gcmlnaHQgPyAxIDogMDtcbiAgfVxuICBpZiAodHlwZW9mIGEyID09PSBcInN5bWJvbFwiKSB7XG4gICAgYXNzZXJ0KHR5cGVvZiBiMyA9PT0gXCJzdHJpbmdcIik7XG4gICAgcmV0dXJuIC0xO1xuICB9XG4gIGFzc2VydCh0eXBlb2YgYTIgPT09IFwic3RyaW5nXCIpO1xuICBhc3NlcnQodHlwZW9mIGIzID09PSBcInN5bWJvbFwiKTtcbiAgcmV0dXJuIDE7XG59O1xudmFyIGdldE1ldGhvZE5hbWVzID0gKHZhbCkgPT4ge1xuICBsZXQgbGF5ZXIgPSB2YWw7XG4gIGNvbnN0IG5hbWVzID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgd2hpbGUgKGxheWVyICE9PSBudWxsICYmIGxheWVyICE9PSBPYmplY3QucHJvdG90eXBlKSB7XG4gICAgY29uc3QgZGVzY3MgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKGxheWVyKTtcbiAgICBmb3IgKGNvbnN0IG5hbWUgb2Ygb3duS2V5cyhkZXNjcykpIHtcbiAgICAgIGlmICh0eXBlb2YgdmFsW25hbWVdID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgbmFtZXMuYWRkKG5hbWUpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWlzT2JqZWN0KHZhbCkpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBsYXllciA9IGdldFByb3RvdHlwZU9mKGxheWVyKTtcbiAgfVxuICByZXR1cm4gaGFyZGVuKFsuLi5uYW1lc10uc29ydChjb21wYXJlU3RyaW5naWZpZWQpKTtcbn07XG5mcmVlemUzKGdldE1ldGhvZE5hbWVzKTtcblxuLy9cbnZhciB7IGlzQXJyYXkgfSA9IEFycmF5O1xudmFyIHsgcHJvdG90eXBlOiBmdW5jdGlvblByb3RvdHlwZSB9ID0gRnVuY3Rpb247XG52YXIge1xuICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsXG4gIGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjIsXG4gIGhhc093blByb3BlcnR5OiBvYmplY3RIYXNPd25Qcm9wZXJ0eSxcbiAgaXNGcm96ZW4sXG4gIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlXG59ID0gT2JqZWN0O1xudmFyIHsgYXBwbHk6IGFwcGx5MyB9ID0gUmVmbGVjdDtcbnZhciB7IHRvU3RyaW5nVGFnOiB0b1N0cmluZ1RhZ1N5bWJvbCB9ID0gU3ltYm9sO1xudmFyIHR5cGVkQXJyYXlQcm90b3R5cGUgPSBnZXRQcm90b3R5cGVPZjIoVWludDhBcnJheS5wcm90b3R5cGUpO1xudmFyIHR5cGVkQXJyYXlUb1N0cmluZ1RhZ0Rlc2MgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoXG4gIHR5cGVkQXJyYXlQcm90b3R5cGUsXG4gIHRvU3RyaW5nVGFnU3ltYm9sXG4pO1xuYXNzZXJ0KHR5cGVkQXJyYXlUb1N0cmluZ1RhZ0Rlc2MpO1xudmFyIGdldFR5cGVkQXJyYXlUb1N0cmluZ1RhZyA9IHR5cGVkQXJyYXlUb1N0cmluZ1RhZ0Rlc2MuZ2V0O1xuYXNzZXJ0KHR5cGVvZiBnZXRUeXBlZEFycmF5VG9TdHJpbmdUYWcgPT09IFwiZnVuY3Rpb25cIik7XG52YXIgaGFzT3duUHJvcGVydHlPZiA9IChvYmosIHByb3ApID0+IGFwcGx5MyhvYmplY3RIYXNPd25Qcm9wZXJ0eSwgb2JqLCBbcHJvcF0pO1xuaGFyZGVuKGhhc093blByb3BlcnR5T2YpO1xudmFyIGlzT2JqZWN0MiA9ICh2YWwpID0+IE9iamVjdCh2YWwpID09PSB2YWw7XG5oYXJkZW4oaXNPYmplY3QyKTtcbnZhciBpc1R5cGVkQXJyYXkgPSAob2JqZWN0KSA9PiB7XG4gIGNvbnN0IHRhZyA9IGFwcGx5MyhnZXRUeXBlZEFycmF5VG9TdHJpbmdUYWcsIG9iamVjdCwgW10pO1xuICByZXR1cm4gdGFnICE9PSB2b2lkIDA7XG59O1xuaGFyZGVuKGlzVHlwZWRBcnJheSk7XG52YXIgUEFTU19TVFlMRSA9IFN5bWJvbC5mb3IoXCJwYXNzU3R5bGVcIik7XG52YXIgY2FuQmVNZXRob2QgPSAoZnVuYykgPT4gdHlwZW9mIGZ1bmMgPT09IFwiZnVuY3Rpb25cIiAmJiAhKFBBU1NfU1RZTEUgaW4gZnVuYyk7XG5oYXJkZW4oY2FuQmVNZXRob2QpO1xudmFyIGFzc2VydENoZWNrZXIgPSAoY29uZCwgZGV0YWlscykgPT4ge1xuICBhc3NlcnQoY29uZCwgZGV0YWlscyk7XG4gIHJldHVybiB0cnVlO1xufTtcbmhhcmRlbihhc3NlcnRDaGVja2VyKTtcbnZhciBDWCA9IChjaGVjaykgPT4ge1xuICBjb25zdCByZWplY3QgPSAoVCwgLi4uc3VicykgPT4gY2hlY2soZmFsc2UsIHJlZGFjdGVkKFQsIC4uLnN1YnMpKTtcbiAgcmV0dXJuIHJlamVjdDtcbn07XG5oYXJkZW4oQ1gpO1xudmFyIGdldE93bkRhdGFEZXNjcmlwdG9yID0gKGNhbmRpZGF0ZSwgcHJvcE5hbWUsIHNob3VsZEJlRW51bWVyYWJsZSwgY2hlY2spID0+IHtcbiAgY29uc3QgZGVzYyA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoY2FuZGlkYXRlLCBwcm9wTmFtZSlcbiAgKTtcbiAgcmV0dXJuIChkZXNjICE9PSB2b2lkIDAgfHwgISFjaGVjayAmJiBDWChjaGVjaylgJHtxdW90ZShwcm9wTmFtZSl9IHByb3BlcnR5IGV4cGVjdGVkOiAke2NhbmRpZGF0ZX1gKSAmJiAoaGFzT3duUHJvcGVydHlPZihkZXNjLCBcInZhbHVlXCIpIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgY2hlY2tcbiAgKWAke3F1b3RlKHByb3BOYW1lKX0gbXVzdCBub3QgYmUgYW4gYWNjZXNzb3IgcHJvcGVydHk6ICR7Y2FuZGlkYXRlfWApICYmIChzaG91bGRCZUVudW1lcmFibGUgPyBkZXNjLmVudW1lcmFibGUgfHwgISFjaGVjayAmJiBDWChcbiAgICBjaGVja1xuICApYCR7cXVvdGUocHJvcE5hbWUpfSBtdXN0IGJlIGFuIGVudW1lcmFibGUgcHJvcGVydHk6ICR7Y2FuZGlkYXRlfWAgOiAhZGVzYy5lbnVtZXJhYmxlIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgY2hlY2tcbiAgKWAke3F1b3RlKHByb3BOYW1lKX0gbXVzdCBub3QgYmUgYW4gZW51bWVyYWJsZSBwcm9wZXJ0eTogJHtjYW5kaWRhdGV9YCkgPyBkZXNjIDogKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICB2b2lkIDBcbiAgKTtcbn07XG5oYXJkZW4oZ2V0T3duRGF0YURlc2NyaXB0b3IpO1xudmFyIGdldFRhZyA9ICh0YWdSZWNvcmQpID0+IHRhZ1JlY29yZFtTeW1ib2wudG9TdHJpbmdUYWddO1xuaGFyZGVuKGdldFRhZyk7XG52YXIgY2hlY2tQYXNzU3R5bGUgPSAob2JqLCBwYXNzU3R5bGUsIGV4cGVjdGVkUGFzc1N0eWxlLCBjaGVjaykgPT4ge1xuICByZXR1cm4gcGFzc1N0eWxlID09PSBleHBlY3RlZFBhc3NTdHlsZSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBFeHBlY3RlZCAke3F1b3RlKGV4cGVjdGVkUGFzc1N0eWxlKX0sIG5vdCAke3F1b3RlKHBhc3NTdHlsZSl9OiAke29ian1gO1xufTtcbmhhcmRlbihjaGVja1Bhc3NTdHlsZSk7XG52YXIgbWFrZUNoZWNrVGFnUmVjb3JkID0gKGNoZWNrUHJvdG8pID0+IHtcbiAgY29uc3QgY2hlY2tUYWdSZWNvcmQyID0gKHRhZ1JlY29yZCwgZXhwZWN0ZWRQYXNzU3R5bGUsIGNoZWNrKSA9PiB7XG4gICAgcmV0dXJuIChpc09iamVjdDIodGFnUmVjb3JkKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBBIG5vbi1vYmplY3QgY2Fubm90IGJlIGEgdGFnUmVjb3JkOiAke3RhZ1JlY29yZH1gKSAmJiAoaXNGcm96ZW4odGFnUmVjb3JkKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBBIHRhZ1JlY29yZCBtdXN0IGJlIGZyb3plbjogJHt0YWdSZWNvcmR9YCkgJiYgKCFpc0FycmF5KHRhZ1JlY29yZCkgfHwgISFjaGVjayAmJiBDWChjaGVjaylgQW4gYXJyYXkgY2Fubm90IGJlIGEgdGFnUmVjb3JkOiAke3RhZ1JlY29yZH1gKSAmJiBjaGVja1Bhc3NTdHlsZShcbiAgICAgIHRhZ1JlY29yZCxcbiAgICAgIGdldE93bkRhdGFEZXNjcmlwdG9yKHRhZ1JlY29yZCwgUEFTU19TVFlMRSwgZmFsc2UsIGNoZWNrKS52YWx1ZSxcbiAgICAgIGV4cGVjdGVkUGFzc1N0eWxlLFxuICAgICAgY2hlY2tcbiAgICApICYmICh0eXBlb2YgZ2V0T3duRGF0YURlc2NyaXB0b3IodGFnUmVjb3JkLCBTeW1ib2wudG9TdHJpbmdUYWcsIGZhbHNlLCBjaGVjaykudmFsdWUgPT09IFwic3RyaW5nXCIgfHwgISFjaGVjayAmJiBDWChcbiAgICAgIGNoZWNrXG4gICAgKWBBIFtTeW1ib2wudG9TdHJpbmdUYWddLW5hbWVkIHByb3BlcnR5IG11c3QgYmUgYSBzdHJpbmc6ICR7dGFnUmVjb3JkfWApICYmIGNoZWNrUHJvdG8odGFnUmVjb3JkLCBnZXRQcm90b3R5cGVPZjIodGFnUmVjb3JkKSwgY2hlY2spO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKGNoZWNrVGFnUmVjb3JkMik7XG59O1xudmFyIGNoZWNrVGFnUmVjb3JkID0gbWFrZUNoZWNrVGFnUmVjb3JkKFxuICAodmFsLCBwcm90bywgY2hlY2spID0+IHByb3RvID09PSBvYmplY3RQcm90b3R5cGUgfHwgISFjaGVjayAmJiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSB0YWdSZWNvcmQgbXVzdCBpbmhlcml0IGZyb20gT2JqZWN0LnByb3RvdHlwZTogJHt2YWx9YClcbik7XG5oYXJkZW4oY2hlY2tUYWdSZWNvcmQpO1xudmFyIGNoZWNrRnVuY3Rpb25UYWdSZWNvcmQgPSBtYWtlQ2hlY2tUYWdSZWNvcmQoXG4gICh2YWwsIHByb3RvLCBjaGVjaykgPT4gcHJvdG8gPT09IGZ1bmN0aW9uUHJvdG90eXBlIHx8IHByb3RvICE9PSBudWxsICYmIGdldFByb3RvdHlwZU9mMihwcm90bykgPT09IGZ1bmN0aW9uUHJvdG90eXBlIHx8ICEhY2hlY2sgJiYgY2hlY2soXG4gICAgZmFsc2UsXG4gICAgcmVkYWN0ZWRgRm9yIGZ1bmN0aW9ucywgYSB0YWdSZWNvcmQgbXVzdCBpbmhlcml0IGZyb20gRnVuY3Rpb24ucHJvdG90eXBlOiAke3ZhbH1gXG4gIClcbik7XG5oYXJkZW4oY2hlY2tGdW5jdGlvblRhZ1JlY29yZCk7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzMiB9ID0gUmVmbGVjdDtcbnZhciB7IGlzQXJyYXk6IGlzQXJyYXkyIH0gPSBBcnJheTtcbnZhciB7XG4gIGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjMsXG4gIGlzRnJvemVuOiBpc0Zyb3plbjIsXG4gIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlMixcbiAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczJcbn0gPSBPYmplY3Q7XG52YXIgY2hlY2tJZmFjZSA9IChpZmFjZSwgY2hlY2spID0+IHtcbiAgcmV0dXJuIChcbiAgICAvL1xuICAgICh0eXBlb2YgaWZhY2UgPT09IFwic3RyaW5nXCIgfHwgISFjaGVjayAmJiBDWChcbiAgICAgIGNoZWNrXG4gICAgKWBGb3Igbm93LCBpbnRlcmZhY2UgJHtpZmFjZX0gbXVzdCBiZSBhIHN0cmluZzsgdW5pbXBsZW1lbnRlZGApICYmIChpZmFjZSA9PT0gXCJSZW1vdGFibGVcIiB8fCBpZmFjZS5zdGFydHNXaXRoKFwiQWxsZWdlZDogXCIpIHx8IGlmYWNlLnN0YXJ0c1dpdGgoXCJEZWJ1Z05hbWU6IFwiKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBGb3Igbm93LCBpZmFjZSAke3F1b3RlKFxuICAgICAgaWZhY2VcbiAgICApfSBtdXN0IGJlIFwiUmVtb3RhYmxlXCIgb3IgYmVnaW4gd2l0aCBcIkFsbGVnZWQ6IFwiIG9yIFwiRGVidWdOYW1lOiBcIjsgdW5pbXBsZW1lbnRlZGApXG4gICk7XG59O1xudmFyIGFzc2VydElmYWNlID0gKGlmYWNlKSA9PiBjaGVja0lmYWNlKGlmYWNlLCBhc3NlcnRDaGVja2VyKTtcbmhhcmRlbihhc3NlcnRJZmFjZSk7XG52YXIgY2hlY2tSZW1vdGFibGVQcm90b09mID0gKG9yaWdpbmFsLCBjaGVjaykgPT4ge1xuICBpc09iamVjdDIob3JpZ2luYWwpIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlcyBtdXN0IGJlIG9iamVjdHMgb3IgZnVuY3Rpb25zOiAke29yaWdpbmFsfWA7XG4gIGNvbnN0IHByb3RvID0gZ2V0UHJvdG90eXBlT2YzKG9yaWdpbmFsKTtcbiAgaWYgKHByb3RvID09PSBvYmplY3RQcm90b3R5cGUyIHx8IHByb3RvID09PSBudWxsIHx8IHByb3RvID09PSBGdW5jdGlvbi5wcm90b3R5cGUpIHtcbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgUmVtb3RhYmxlcyBtdXN0IGJlIGV4cGxpY2l0bHkgZGVjbGFyZWQ6ICR7cXVvdGUob3JpZ2luYWwpfWA7XG4gIH1cbiAgaWYgKHR5cGVvZiBvcmlnaW5hbCA9PT0gXCJvYmplY3RcIikge1xuICAgIGNvbnN0IHByb3RvUHJvdG8gPSBnZXRQcm90b3R5cGVPZjMocHJvdG8pO1xuICAgIGlmIChwcm90b1Byb3RvICE9PSBvYmplY3RQcm90b3R5cGUyICYmIHByb3RvUHJvdG8gIT09IG51bGwpIHtcbiAgICAgIHJldHVybiBjaGVja1JlbW90YWJsZShwcm90bywgY2hlY2spO1xuICAgIH1cbiAgICBpZiAoIWNoZWNrVGFnUmVjb3JkKHByb3RvLCBcInJlbW90YWJsZVwiLCBjaGVjaykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH0gZWxzZSBpZiAodHlwZW9mIG9yaWdpbmFsID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBpZiAoIWNoZWNrRnVuY3Rpb25UYWdSZWNvcmQocHJvdG8sIFwicmVtb3RhYmxlXCIsIGNoZWNrKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICBjb25zdCBwYXNzU3R5bGVLZXkgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgIFBBU1NfU1RZTEVcbiAgKTtcbiAgY29uc3QgdGFnS2V5ID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBTeW1ib2wudG9TdHJpbmdUYWdcbiAgKTtcbiAgY29uc3Qge1xuICAgIC8vXG4gICAgW1xuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICBwYXNzU3R5bGVLZXlcbiAgICBdOiBfcGFzc1N0eWxlRGVzYyxcbiAgICBbXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHRhZ0tleVxuICAgIF06IHsgdmFsdWU6IGlmYWNlIH0sXG4gICAgLi4ucmVzdERlc2NzXG4gIH0gPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzMihwcm90byk7XG4gIHJldHVybiAob3duS2V5czIocmVzdERlc2NzKS5sZW5ndGggPT09IDAgfHwgISFjaGVjayAmJiBDWChcbiAgICBjaGVja1xuICApYFVuZXhwZWN0ZWQgcHJvcGVydGllcyBvbiBSZW1vdGFibGUgUHJvdG8gJHtvd25LZXlzMihyZXN0RGVzY3MpfWApICYmIGNoZWNrSWZhY2UoaWZhY2UsIGNoZWNrKTtcbn07XG52YXIgY29uZmlybWVkUmVtb3RhYmxlcyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrUmVtb3RhYmxlID0gKHZhbCwgY2hlY2spID0+IHtcbiAgaWYgKGNvbmZpcm1lZFJlbW90YWJsZXMuaGFzKHZhbCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoIWlzRnJvemVuMih2YWwpKSB7XG4gICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goY2hlY2spYGNhbm5vdCBzZXJpYWxpemUgbm9uLWZyb3plbiBvYmplY3RzIGxpa2UgJHt2YWx9YDtcbiAgfVxuICBpZiAoIVJlbW90YWJsZUhlbHBlci5jYW5CZVZhbGlkKHZhbCwgY2hlY2spKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNvbnN0IHJlc3VsdCA9IGNoZWNrUmVtb3RhYmxlUHJvdG9PZih2YWwsIGNoZWNrKTtcbiAgaWYgKHJlc3VsdCkge1xuICAgIGNvbmZpcm1lZFJlbW90YWJsZXMuYWRkKHZhbCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgZ2V0SW50ZXJmYWNlT2YgPSAodmFsKSA9PiB7XG4gIGlmICghaXNPYmplY3QyKHZhbCkgfHwgdmFsW1BBU1NfU1RZTEVdICE9PSBcInJlbW90YWJsZVwiIHx8ICFjaGVja1JlbW90YWJsZSh2YWwpKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICByZXR1cm4gZ2V0VGFnKHZhbCk7XG59O1xuaGFyZGVuKGdldEludGVyZmFjZU9mKTtcbnZhciBSZW1vdGFibGVIZWxwZXIgPSBoYXJkZW4oe1xuICBzdHlsZU5hbWU6IFwicmVtb3RhYmxlXCIsXG4gIGNhbkJlVmFsaWQ6IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiB7XG4gICAgY29uc3QgdmFsaWRUeXBlID0gKGlzT2JqZWN0MihjYW5kaWRhdGUpIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYGNhbm5vdCBzZXJpYWxpemUgbm9uLW9iamVjdHMgYXMgUmVtb3RhYmxlICR7Y2FuZGlkYXRlfWApICYmICghaXNBcnJheTIoY2FuZGlkYXRlKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBjYW5ub3Qgc2VyaWFsaXplIGFycmF5cyBhcyBSZW1vdGFibGUgJHtjYW5kaWRhdGV9YCk7XG4gICAgaWYgKCF2YWxpZFR5cGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY29uc3QgZGVzY3MgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzMihjYW5kaWRhdGUpO1xuICAgIGlmICh0eXBlb2YgY2FuZGlkYXRlID09PSBcIm9iamVjdFwiKSB7XG4gICAgICByZXR1cm4gb3duS2V5czIoZGVzY3MpLmV2ZXJ5KChrZXkpID0+IHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAvL1xuICAgICAgICAgIChoYXNPd25Qcm9wZXJ0eU9mKGRlc2NzW1xuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICBrZXlcbiAgICAgICAgICBdLCBcInZhbHVlXCIpIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYGNhbm5vdCBzZXJpYWxpemUgUmVtb3RhYmxlcyB3aXRoIGFjY2Vzc29ycyBsaWtlICR7cXVvdGUoXG4gICAgICAgICAgICBTdHJpbmcoa2V5KVxuICAgICAgICAgICl9IGluICR7Y2FuZGlkYXRlfWApICYmIChrZXkgPT09IFN5bWJvbC50b1N0cmluZ1RhZyAmJiBjaGVja0lmYWNlKGNhbmRpZGF0ZVtrZXldLCBjaGVjaykgfHwgKGNhbkJlTWV0aG9kKGNhbmRpZGF0ZVtrZXldKSB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBjYW5ub3Qgc2VyaWFsaXplIFJlbW90YWJsZXMgd2l0aCBub24tbWV0aG9kcyBsaWtlICR7cXVvdGUoXG4gICAgICAgICAgICBTdHJpbmcoa2V5KVxuICAgICAgICAgICl9IGluICR7Y2FuZGlkYXRlfWApICYmIChrZXkgIT09IFBBU1NfU1RZTEUgfHwgISFjaGVjayAmJiBDWChjaGVjaylgQSBwYXNzLWJ5LXJlbW90ZSBjYW5ub3Qgc2hhZG93ICR7cXVvdGUoUEFTU19TVFlMRSl9YCkpXG4gICAgICAgICk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBjYW5kaWRhdGUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgY29uc3Qge1xuICAgICAgICBuYW1lOiBuYW1lRGVzYyxcbiAgICAgICAgbGVuZ3RoOiBsZW5ndGhEZXNjLFxuICAgICAgICAvL1xuICAgICAgICBbU3ltYm9sLnRvU3RyaW5nVGFnXTogdG9TdHJpbmdUYWdEZXNjLFxuICAgICAgICAuLi5yZXN0RGVzY3NcbiAgICAgIH0gPSBkZXNjcztcbiAgICAgIGNvbnN0IHJlc3RLZXlzID0gb3duS2V5czIocmVzdERlc2NzKTtcbiAgICAgIHJldHVybiAobmFtZURlc2MgJiYgdHlwZW9mIG5hbWVEZXNjLnZhbHVlID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYEZhciBmdW5jdGlvbiBuYW1lIG11c3QgYmUgYSBzdHJpbmcsIGluICR7Y2FuZGlkYXRlfWApICYmIChsZW5ndGhEZXNjICYmIHR5cGVvZiBsZW5ndGhEZXNjLnZhbHVlID09PSBcIm51bWJlclwiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgICAgIGNoZWNrXG4gICAgICApYEZhciBmdW5jdGlvbiBsZW5ndGggbXVzdCBiZSBhIG51bWJlciwgaW4gJHtjYW5kaWRhdGV9YCkgJiYgKHRvU3RyaW5nVGFnRGVzYyA9PT0gdm9pZCAwIHx8ICh0eXBlb2YgdG9TdHJpbmdUYWdEZXNjLnZhbHVlID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgICAgIGNoZWNrXG4gICAgICApYEZhciBmdW5jdGlvbiBAQHRvU3RyaW5nVGFnIG11c3QgYmUgYSBzdHJpbmcsIGluICR7Y2FuZGlkYXRlfWApICYmIGNoZWNrSWZhY2UodG9TdHJpbmdUYWdEZXNjLnZhbHVlLCBjaGVjaykpICYmIChyZXN0S2V5cy5sZW5ndGggPT09IDAgfHwgISFjaGVjayAmJiBDWChcbiAgICAgICAgY2hlY2tcbiAgICAgIClgRmFyIGZ1bmN0aW9ucyB1bmV4cGVjdGVkIHByb3BlcnRpZXMgYmVzaWRlcyAubmFtZSBhbmQgLmxlbmd0aCAke3Jlc3RLZXlzfWApO1xuICAgIH1cbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgdW5yZWNvZ25pemVkIHR5cGVvZiAke2NhbmRpZGF0ZX1gO1xuICB9LFxuICBhc3NlcnRSZXN0VmFsaWQ6IChjYW5kaWRhdGUpID0+IGNoZWNrUmVtb3RhYmxlKGNhbmRpZGF0ZSwgYXNzZXJ0Q2hlY2tlciksXG4gIGV2ZXJ5OiAoX3Bhc3NhYmxlLCBfZm4pID0+IHRydWVcbn0pO1xuXG4vL1xudmFyIHsgcHJvdG90eXBlOiBmdW5jdGlvblByb3RvdHlwZTIgfSA9IEZ1bmN0aW9uO1xudmFyIHtcbiAgZ2V0UHJvdG90eXBlT2Y6IGdldFByb3RvdHlwZU9mNCxcbiAgc2V0UHJvdG90eXBlT2YsXG4gIGNyZWF0ZSxcbiAgaXNGcm96ZW46IGlzRnJvemVuMyxcbiAgcHJvdG90eXBlOiBvYmplY3RQcm90b3R5cGUzXG59ID0gT2JqZWN0O1xudmFyIG1ha2VSZW1vdGFibGVQcm90byA9IChyZW1vdGFibGUsIGlmYWNlKSA9PiB7XG4gIGxldCBvbGRQcm90byA9IGdldFByb3RvdHlwZU9mNChyZW1vdGFibGUpO1xuICBpZiAodHlwZW9mIHJlbW90YWJsZSA9PT0gXCJvYmplY3RcIikge1xuICAgIGlmIChvbGRQcm90byA9PT0gbnVsbCkge1xuICAgICAgb2xkUHJvdG8gPSBvYmplY3RQcm90b3R5cGUzO1xuICAgIH1cbiAgICBvbGRQcm90byA9PT0gb2JqZWN0UHJvdG90eXBlMyB8fCB0aHJvd1JlZGFjdGVkYEZvciBub3csIHJlbW90YWJsZXMgY2Fubm90IGluaGVyaXQgZnJvbSBhbnl0aGluZyB1bnVzdWFsLCBpbiAke3JlbW90YWJsZX1gO1xuICB9IGVsc2UgaWYgKHR5cGVvZiByZW1vdGFibGUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIG9sZFByb3RvICE9PSBudWxsIHx8IHRocm93UmVkYWN0ZWRgT3JpZ2luYWwgZnVuY3Rpb24gbXVzdCBub3QgaW5oZXJpdCBmcm9tIG51bGw6ICR7cmVtb3RhYmxlfWA7XG4gICAgb2xkUHJvdG8gPT09IGZ1bmN0aW9uUHJvdG90eXBlMiB8fCBnZXRQcm90b3R5cGVPZjQob2xkUHJvdG8pID09PSBmdW5jdGlvblByb3RvdHlwZTIgfHwgdGhyb3dSZWRhY3RlZGBGYXIgZnVuY3Rpb25zIG11c3Qgb3JpZ2luYWxseSBpbmhlcml0IGZyb20gRnVuY3Rpb24ucHJvdG90eXBlLCBpbiAke3JlbW90YWJsZX1gO1xuICB9IGVsc2Uge1xuICAgIHRocm93UmVkYWN0ZWRgdW5yZWNvZ25pemVkIHR5cGVvZiAke3JlbW90YWJsZX1gO1xuICB9XG4gIHJldHVybiBoYXJkZW4oXG4gICAgY3JlYXRlKG9sZFByb3RvLCB7XG4gICAgICBbUEFTU19TVFlMRV06IHsgdmFsdWU6IFwicmVtb3RhYmxlXCIgfSxcbiAgICAgIFtTeW1ib2wudG9TdHJpbmdUYWddOiB7IHZhbHVlOiBpZmFjZSB9XG4gICAgfSlcbiAgKTtcbn07XG52YXIgYXNzZXJ0Q2FuQmVSZW1vdGFibGUgPSAoY2FuZGlkYXRlKSA9PiBSZW1vdGFibGVIZWxwZXIuY2FuQmVWYWxpZChjYW5kaWRhdGUsIGFzc2VydENoZWNrZXIpO1xudmFyIFJlbW90YWJsZSA9IChpZmFjZSA9IFwiUmVtb3RhYmxlXCIsIHByb3BzID0gdm9pZCAwLCByZW1vdGFibGUgPSAoXG4gIC8qICAgICAgICAgICAgKi9cbiAge31cbikpID0+IHtcbiAgYXNzZXJ0SWZhY2UoaWZhY2UpO1xuICBhc3NlcnQoaWZhY2UpO1xuICBwcm9wcyA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlIHByb3BzIG5vdCB5ZXQgaW1wbGVtZW50ZWQgJHtwcm9wc31gO1xuICBhc3NlcnRDYW5CZVJlbW90YWJsZShyZW1vdGFibGUpO1xuICAhKFBBU1NfU1RZTEUgaW4gcmVtb3RhYmxlKSB8fCB0aHJvd1JlZGFjdGVkYFJlbW90YWJsZSAke3JlbW90YWJsZX0gaXMgYWxyZWFkeSBtYXJrZWQgYXMgYSAke3F1b3RlKFxuICAgIHJlbW90YWJsZVtQQVNTX1NUWUxFXVxuICApfWA7XG4gIGhhcmRlbi5pc0Zha2UgfHwgLy9cbiAgIWlzRnJvemVuMyhyZW1vdGFibGUpIHx8IHRocm93UmVkYWN0ZWRgUmVtb3RhYmxlICR7cmVtb3RhYmxlfSBpcyBhbHJlYWR5IGZyb3plbmA7XG4gIGNvbnN0IHJlbW90YWJsZVByb3RvID0gbWFrZVJlbW90YWJsZVByb3RvKHJlbW90YWJsZSwgaWZhY2UpO1xuICBjb25zdCBtdXRhdGVIYXJkZW5BbmRDaGVjayA9ICh0YXJnZXQpID0+IHtcbiAgICBzZXRQcm90b3R5cGVPZih0YXJnZXQsIHJlbW90YWJsZVByb3RvKTtcbiAgICBoYXJkZW4odGFyZ2V0KTtcbiAgICBhc3NlcnRDYW5CZVJlbW90YWJsZSh0YXJnZXQpO1xuICB9O1xuICBtdXRhdGVIYXJkZW5BbmRDaGVjayh7fSk7XG4gIG11dGF0ZUhhcmRlbkFuZENoZWNrKHJlbW90YWJsZSk7XG4gIGFzc2VydChpZmFjZSAhPT0gdm9pZCAwKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICByZW1vdGFibGVcbiAgKTtcbn07XG5oYXJkZW4oUmVtb3RhYmxlKTtcbnZhciBHRVRfTUVUSE9EX05BTUVTID0gXCJfX2dldE1ldGhvZE5hbWVzX19cIjtcbnZhciBnZXRNZXRob2ROYW1lc01ldGhvZCA9IGhhcmRlbih7XG4gIFtHRVRfTUVUSE9EX05BTUVTXSgpIHtcbiAgICByZXR1cm4gZ2V0TWV0aG9kTmFtZXModGhpcyk7XG4gIH1cbn0pW0dFVF9NRVRIT0RfTkFNRVNdO1xudmFyIGdldE1ldGhvZE5hbWVzRGVzY3JpcHRvciA9IGhhcmRlbih7XG4gIHZhbHVlOiBnZXRNZXRob2ROYW1lc01ldGhvZCxcbiAgZW51bWVyYWJsZTogZmFsc2UsXG4gIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gIHdyaXRhYmxlOiBmYWxzZVxufSk7XG52YXIgRmFyID0gKGZhck5hbWUsIHJlbW90YWJsZSA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCByNSA9IHJlbW90YWJsZSA9PT0gdm9pZCAwID8gKFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICB7fVxuICApIDogcmVtb3RhYmxlO1xuICBpZiAodHlwZW9mIHI1ID09PSBcIm9iamVjdFwiICYmICEoR0VUX01FVEhPRF9OQU1FUyBpbiByNSkpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocjUsIEdFVF9NRVRIT0RfTkFNRVMsIGdldE1ldGhvZE5hbWVzRGVzY3JpcHRvcik7XG4gIH1cbiAgcmV0dXJuIFJlbW90YWJsZShgQWxsZWdlZDogJHtmYXJOYW1lfWAsIHZvaWQgMCwgcjUpO1xufTtcbmhhcmRlbihGYXIpO1xudmFyIFRvRmFyRnVuY3Rpb24gPSAoZmFyTmFtZSwgZnVuYykgPT4ge1xuICBpZiAoZ2V0SW50ZXJmYWNlT2YoZnVuYykgIT09IHZvaWQgMCkge1xuICAgIHJldHVybiBmdW5jO1xuICB9XG4gIHJldHVybiBGYXIoZmFyTmFtZSwgKC4uLmFyZ3MpID0+IGZ1bmMoLi4uYXJncykpO1xufTtcbmhhcmRlbihUb0ZhckZ1bmN0aW9uKTtcblxuLy9cbnZhciBtYXBJdGVyYWJsZSA9IChiYXNlSXRlcmFibGUsIGZ1bmMpID0+IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgRmFyKFwibWFwcGVkIGl0ZXJhYmxlXCIsIHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgY29uc3QgYmFzZUl0ZXJhdG9yID0gYmFzZUl0ZXJhYmxlW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgIHJldHVybiBGYXIoXCJtYXBwZWQgaXRlcmF0b3JcIiwge1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyB2YWx1ZTogYmFzZVZhbHVlLCBkb25lIH0gPSBiYXNlSXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gZG9uZSA/IGJhc2VWYWx1ZSA6IGZ1bmMoYmFzZVZhbHVlKTtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWUsIGRvbmUgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSlcbik7XG5oYXJkZW4obWFwSXRlcmFibGUpO1xudmFyIGZpbHRlckl0ZXJhYmxlID0gKGJhc2VJdGVyYWJsZSwgcHJlZCkgPT4gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICBGYXIoXCJmaWx0ZXJlZCBpdGVyYWJsZVwiLCB7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGNvbnN0IGJhc2VJdGVyYXRvciA9IGJhc2VJdGVyYWJsZVtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICByZXR1cm4gRmFyKFwiZmlsdGVyZWQgaXRlcmF0b3JcIiwge1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgZm9yICg7IDsgKSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBiYXNlSXRlcmF0b3IubmV4dCgpO1xuICAgICAgICAgICAgY29uc3QgeyB2YWx1ZSwgZG9uZSB9ID0gcmVzdWx0O1xuICAgICAgICAgICAgaWYgKGRvbmUgfHwgcHJlZCh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSlcbik7XG5oYXJkZW4oZmlsdGVySXRlcmFibGUpO1xuXG4vL1xudmFyIHsgZ2V0UHJvdG90eXBlT2Y6IGdldFByb3RvdHlwZU9mNSwgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczMsIGhhc093bjogaGFzT3duMiwgZW50cmllczogZW50cmllczIgfSA9IE9iamVjdDtcbnZhciBlcnJvckNvbnN0cnVjdG9ycyA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKFxuICAvL1xuICAvL1xuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgW1xuICAgIFtcIkVycm9yXCIsIEVycm9yXSxcbiAgICBbXCJFdmFsRXJyb3JcIiwgRXZhbEVycm9yXSxcbiAgICBbXCJSYW5nZUVycm9yXCIsIFJhbmdlRXJyb3JdLFxuICAgIFtcIlJlZmVyZW5jZUVycm9yXCIsIFJlZmVyZW5jZUVycm9yXSxcbiAgICBbXCJTeW50YXhFcnJvclwiLCBTeW50YXhFcnJvcl0sXG4gICAgW1wiVHlwZUVycm9yXCIsIFR5cGVFcnJvcl0sXG4gICAgW1wiVVJJRXJyb3JcIiwgVVJJRXJyb3JdXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgXVxuKTtcbmlmICh0eXBlb2YgQWdncmVnYXRlRXJyb3IgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgZXJyb3JDb25zdHJ1Y3RvcnMuc2V0KFwiQWdncmVnYXRlRXJyb3JcIiwgQWdncmVnYXRlRXJyb3IpO1xufVxudmFyIGdldEVycm9yQ29uc3RydWN0b3IgPSAobmFtZSkgPT4gZXJyb3JDb25zdHJ1Y3RvcnMuZ2V0KG5hbWUpO1xuaGFyZGVuKGdldEVycm9yQ29uc3RydWN0b3IpO1xudmFyIGNoZWNrRXJyb3JMaWtlID0gKGNhbmRpZGF0ZSwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgcmV0dXJuIGNhbmRpZGF0ZSBpbnN0YW5jZW9mIEVycm9yIHx8ICEhY2hlY2sgJiYgQ1goY2hlY2spYEVycm9yIGV4cGVjdGVkOiAke2NhbmRpZGF0ZX1gO1xufTtcbmhhcmRlbihjaGVja0Vycm9yTGlrZSk7XG52YXIgaXNFcnJvckxpa2UgPSAoY2FuZGlkYXRlKSA9PiBjaGVja0Vycm9yTGlrZShjYW5kaWRhdGUpO1xuaGFyZGVuKGlzRXJyb3JMaWtlKTtcbnZhciBjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvclByb3BlcnR5RGVzYyA9IChwcm9wTmFtZSwgZGVzYywgcGFzc1N0eWxlT2ZSZWN1ciwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgaWYgKGRlc2MuZW51bWVyYWJsZSkge1xuICAgIHJldHVybiAhIWNoZWNrICYmIENYKGNoZWNrKWBQYXNzYWJsZSBFcnJvciAke3F1b3RlKFxuICAgICAgcHJvcE5hbWVcbiAgICApfSBvd24gcHJvcGVydHkgbXVzdCBub3QgYmUgZW51bWVyYWJsZTogJHtkZXNjfWA7XG4gIH1cbiAgaWYgKCFoYXNPd24yKGRlc2MsIFwidmFsdWVcIikpIHtcbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChjaGVjaylgUGFzc2FibGUgRXJyb3IgJHtxdW90ZShcbiAgICAgIHByb3BOYW1lXG4gICAgKX0gb3duIHByb3BlcnR5IG11c3QgYmUgYSBkYXRhIHByb3BlcnR5OiAke2Rlc2N9YDtcbiAgfVxuICBjb25zdCB7IHZhbHVlIH0gPSBkZXNjO1xuICBzd2l0Y2ggKHByb3BOYW1lKSB7XG4gICAgY2FzZSBcIm1lc3NhZ2VcIjpcbiAgICBjYXNlIFwic3RhY2tcIjoge1xuICAgICAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBQYXNzYWJsZSBFcnJvciAke3F1b3RlKFxuICAgICAgICBwcm9wTmFtZVxuICAgICAgKX0gb3duIHByb3BlcnR5IG11c3QgYmUgYSBzdHJpbmc6ICR7dmFsdWV9YDtcbiAgICB9XG4gICAgY2FzZSBcImNhdXNlXCI6IHtcbiAgICAgIHJldHVybiBjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvcih2YWx1ZSwgcGFzc1N0eWxlT2ZSZWN1ciwgY2hlY2spO1xuICAgIH1cbiAgICBjYXNlIFwiZXJyb3JzXCI6IHtcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgcGFzc1N0eWxlT2ZSZWN1cih2YWx1ZSkgIT09IFwiY29weUFycmF5XCIpIHtcbiAgICAgICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goY2hlY2spYFBhc3NhYmxlIEVycm9yICR7cXVvdGUoXG4gICAgICAgICAgcHJvcE5hbWVcbiAgICAgICAgKX0gb3duIHByb3BlcnR5IG11c3QgYmUgYSBjb3B5QXJyYXk6ICR7dmFsdWV9YDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZS5ldmVyeShcbiAgICAgICAgKGVycikgPT4gKFxuICAgICAgICAgIC8vXG4gICAgICAgICAgY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3IoZXJyLCBwYXNzU3R5bGVPZlJlY3VyLCBjaGVjaylcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIHJldHVybiAhIWNoZWNrICYmIENYKGNoZWNrKWBQYXNzYWJsZSBFcnJvciBoYXMgZXh0cmEgdW5wYXNzZWQgcHJvcGVydHkgJHtxdW90ZShwcm9wTmFtZSl9YDtcbn07XG5oYXJkZW4oY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MpO1xudmFyIGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yID0gKGNhbmRpZGF0ZSwgcGFzc1N0eWxlT2ZSZWN1ciwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgaWYgKCFjaGVja0Vycm9yTGlrZShjYW5kaWRhdGUsIGNoZWNrKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCBwcm90byA9IGdldFByb3RvdHlwZU9mNShjYW5kaWRhdGUpO1xuICBjb25zdCB7IG5hbWUgfSA9IHByb3RvO1xuICBjb25zdCBlcnJDb25zdHJ1Y3RvciA9IGdldEVycm9yQ29uc3RydWN0b3IobmFtZSk7XG4gIGlmIChlcnJDb25zdHJ1Y3RvciA9PT0gdm9pZCAwIHx8IGVyckNvbnN0cnVjdG9yLnByb3RvdHlwZSAhPT0gcHJvdG8pIHtcbiAgICByZXR1cm4gISFjaGVjayAmJiBDWChcbiAgICAgIGNoZWNrXG4gICAgKWBQYXNzYWJsZSBFcnJvciBtdXN0IGluaGVyaXQgZnJvbSBhbiBlcnJvciBjbGFzcyAucHJvdG90eXBlOiAke2NhbmRpZGF0ZX1gO1xuICB9XG4gIGNvbnN0IGRlc2NzID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczMoY2FuZGlkYXRlKTtcbiAgaWYgKCEoXCJtZXNzYWdlXCIgaW4gZGVzY3MpKSB7XG4gICAgcmV0dXJuICEhY2hlY2sgJiYgQ1goXG4gICAgICBjaGVja1xuICAgIClgUGFzc2FibGUgRXJyb3IgbXVzdCBoYXZlIGFuIG93biBcIm1lc3NhZ2VcIiBzdHJpbmcgcHJvcGVydHk6ICR7Y2FuZGlkYXRlfWA7XG4gIH1cbiAgcmV0dXJuIGVudHJpZXMyKGRlc2NzKS5ldmVyeShcbiAgICAoW3Byb3BOYW1lLCBkZXNjXSkgPT4gY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MoXG4gICAgICBwcm9wTmFtZSxcbiAgICAgIGRlc2MsXG4gICAgICBwYXNzU3R5bGVPZlJlY3VyLFxuICAgICAgY2hlY2tcbiAgICApXG4gICk7XG59O1xuaGFyZGVuKGNoZWNrUmVjdXJzaXZlbHlQYXNzYWJsZUVycm9yKTtcbnZhciBFcnJvckhlbHBlciA9IGhhcmRlbih7XG4gIHN0eWxlTmFtZTogXCJlcnJvclwiLFxuICBjYW5CZVZhbGlkOiBjaGVja0Vycm9yTGlrZSxcbiAgYXNzZXJ0UmVzdFZhbGlkOiAoY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyKSA9PiBjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvcihjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIsIGFzc2VydENoZWNrZXIpXG59KTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXMzIH0gPSBSZWZsZWN0O1xudmFyIHdlbGxLbm93blN5bWJvbE5hbWVzID0gbmV3IE1hcChcbiAgb3duS2V5czMoU3ltYm9sKS5maWx0ZXIoXG4gICAgKG5hbWUpID0+IHR5cGVvZiBuYW1lID09PSBcInN0cmluZ1wiICYmIHR5cGVvZiBTeW1ib2xbbmFtZV0gPT09IFwic3ltYm9sXCJcbiAgKS5maWx0ZXIoKG5hbWUpID0+IHtcbiAgICAhbmFtZS5zdGFydHNXaXRoKFwiQEBcIikgfHwgdGhyb3dSZWRhY3RlZGBEaWQgbm90IGV4cGVjdCBTeW1ib2wgdG8gaGF2ZSBhIHN5bWJvbC12YWx1ZWQgcHJvcGVydHkgbmFtZSBzdGFydGluZyB3aXRoIFwiQEBcIiAke3F1b3RlKFxuICAgICAgbmFtZVxuICAgICl9YDtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSkubWFwKChuYW1lKSA9PiBbU3ltYm9sW25hbWVdLCBgQEAke25hbWV9YF0pXG4pO1xudmFyIGlzUGFzc2FibGVTeW1ib2wgPSAoc3ltKSA9PiB0eXBlb2Ygc3ltID09PSBcInN5bWJvbFwiICYmICh0eXBlb2YgU3ltYm9sLmtleUZvcihzeW0pID09PSBcInN0cmluZ1wiIHx8IHdlbGxLbm93blN5bWJvbE5hbWVzLmhhcyhzeW0pKTtcbmhhcmRlbihpc1Bhc3NhYmxlU3ltYm9sKTtcbnZhciBhc3NlcnRQYXNzYWJsZVN5bWJvbCA9IChzeW0pID0+IGlzUGFzc2FibGVTeW1ib2woc3ltKSB8fCB0aHJvd1JlZGFjdGVkYE9ubHkgcmVnaXN0ZXJlZCBzeW1ib2xzIG9yIHdlbGwta25vd24gc3ltYm9scyBhcmUgcGFzc2FibGU6ICR7cXVvdGUoc3ltKX1gO1xuaGFyZGVuKGFzc2VydFBhc3NhYmxlU3ltYm9sKTtcbnZhciBuYW1lRm9yUGFzc2FibGVTeW1ib2wgPSAoc3ltKSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBTeW1ib2wua2V5Rm9yKHN5bSk7XG4gIGlmIChuYW1lID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gd2VsbEtub3duU3ltYm9sTmFtZXMuZ2V0KHN5bSk7XG4gIH1cbiAgaWYgKG5hbWUuc3RhcnRzV2l0aChcIkBAXCIpKSB7XG4gICAgcmV0dXJuIGBAQCR7bmFtZX1gO1xuICB9XG4gIHJldHVybiBuYW1lO1xufTtcbmhhcmRlbihuYW1lRm9yUGFzc2FibGVTeW1ib2wpO1xudmFyIEF0QXRQcmVmaXhQYXR0ZXJuID0gL15AQCguKikkLztcbmhhcmRlbihBdEF0UHJlZml4UGF0dGVybik7XG52YXIgcGFzc2FibGVTeW1ib2xGb3JOYW1lID0gKG5hbWUpID0+IHtcbiAgaWYgKHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxuICBjb25zdCBtYXRjaCA9IEF0QXRQcmVmaXhQYXR0ZXJuLmV4ZWMobmFtZSk7XG4gIGlmIChtYXRjaCkge1xuICAgIGNvbnN0IHN1ZmZpeCA9IG1hdGNoWzFdO1xuICAgIGlmIChzdWZmaXguc3RhcnRzV2l0aChcIkBAXCIpKSB7XG4gICAgICByZXR1cm4gU3ltYm9sLmZvcihzdWZmaXgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBzeW0gPSBTeW1ib2xbc3VmZml4XTtcbiAgICAgIGlmICh0eXBlb2Ygc3ltID09PSBcInN5bWJvbFwiKSB7XG4gICAgICAgIHJldHVybiBzeW07XG4gICAgICB9XG4gICAgICB0aHJvd1JlZGFjdGVkYFJlc2VydmVkIGZvciB3ZWxsIGtub3duIHN5bWJvbCAke3F1b3RlKHN1ZmZpeCl9OiAke3F1b3RlKG5hbWUpfWA7XG4gICAgfVxuICB9XG4gIHJldHVybiBTeW1ib2wuZm9yKG5hbWUpO1xufTtcbmhhcmRlbihwYXNzYWJsZVN5bWJvbEZvck5hbWUpO1xuXG4vL1xudmFyIGhhc1dlbGxGb3JtZWRTdHJpbmdNZXRob2QgPSAhIVN0cmluZy5wcm90b3R5cGUuaXNXZWxsRm9ybWVkO1xudmFyIGlzV2VsbEZvcm1lZFN0cmluZyA9IGhhc1dlbGxGb3JtZWRTdHJpbmdNZXRob2QgPyAoc3RyKSA9PiB0eXBlb2Ygc3RyID09PSBcInN0cmluZ1wiICYmIHN0ci5pc1dlbGxGb3JtZWQoKSA6IChzdHIpID0+IHtcbiAgaWYgKHR5cGVvZiBzdHIgIT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZm9yIChjb25zdCBjaCBvZiBzdHIpIHtcbiAgICBjb25zdCBjcCA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgY2guY29kZVBvaW50QXQoMClcbiAgICApO1xuICAgIGlmIChjcCA+PSA1NTI5NiAmJiBjcCA8PSA1NzM0Mykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5oYXJkZW4oaXNXZWxsRm9ybWVkU3RyaW5nKTtcbnZhciBhc3NlcnRXZWxsRm9ybWVkU3RyaW5nID0gKHN0cikgPT4ge1xuICBpc1dlbGxGb3JtZWRTdHJpbmcoc3RyKSB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkIHdlbGwtZm9ybWVkIHVuaWNvZGUgc3RyaW5nOiAke3N0cn1gO1xufTtcbmhhcmRlbihhc3NlcnRXZWxsRm9ybWVkU3RyaW5nKTtcbnZhciBPTkxZX1dFTExfRk9STUVEX1NUUklOR1NfUEFTU0FCTEUgPSBnZXRFbnZpcm9ubWVudE9wdGlvbihcIk9OTFlfV0VMTF9GT1JNRURfU1RSSU5HU19QQVNTQUJMRVwiLCBcImRpc2FibGVkXCIsIFtcbiAgXCJlbmFibGVkXCJcbl0pID09PSBcImVuYWJsZWRcIjtcbnZhciBhc3NlcnRQYXNzYWJsZVN0cmluZyA9IChzdHIpID0+IHtcbiAgdHlwZW9mIHN0ciA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkIHN0cmluZyAke3N0cn1gO1xuICAhT05MWV9XRUxMX0ZPUk1FRF9TVFJJTkdTX1BBU1NBQkxFIHx8IGFzc2VydFdlbGxGb3JtZWRTdHJpbmcoc3RyKTtcbn07XG5oYXJkZW4oYXNzZXJ0UGFzc2FibGVTdHJpbmcpO1xuXG4vL1xudmFyIG1ha2VSZWxlYXNpbmdFeGVjdXRvcktpdCA9ICgpID0+IHtcbiAgbGV0IGludGVybmFsUmVzb2x2ZTtcbiAgbGV0IGludGVybmFsUmVqZWN0O1xuICBjb25zdCByZXNvbHZlMiA9ICh2YWx1ZSkgPT4ge1xuICAgIGlmIChpbnRlcm5hbFJlc29sdmUpIHtcbiAgICAgIGludGVybmFsUmVzb2x2ZSh2YWx1ZSk7XG4gICAgICBpbnRlcm5hbFJlc29sdmUgPSBudWxsO1xuICAgICAgaW50ZXJuYWxSZWplY3QgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBhc3NlcnQoaW50ZXJuYWxSZXNvbHZlID09PSBudWxsKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHJlamVjdCA9IChyZWFzb24pID0+IHtcbiAgICBpZiAoaW50ZXJuYWxSZWplY3QpIHtcbiAgICAgIGludGVybmFsUmVqZWN0KHJlYXNvbik7XG4gICAgICBpbnRlcm5hbFJlc29sdmUgPSBudWxsO1xuICAgICAgaW50ZXJuYWxSZWplY3QgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBhc3NlcnQoaW50ZXJuYWxSZWplY3QgPT09IG51bGwpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgZXhlY3V0b3IgPSAocmVzLCByZWopID0+IHtcbiAgICBhc3NlcnQoaW50ZXJuYWxSZXNvbHZlID09PSB2b2lkIDAgJiYgaW50ZXJuYWxSZWplY3QgPT09IHZvaWQgMCk7XG4gICAgaW50ZXJuYWxSZXNvbHZlID0gcmVzO1xuICAgIGludGVybmFsUmVqZWN0ID0gcmVqO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHsgcmVzb2x2ZTogcmVzb2x2ZTIsIHJlamVjdCwgZXhlY3V0b3IgfSk7XG59O1xuaGFyZGVuKG1ha2VSZWxlYXNpbmdFeGVjdXRvcktpdCk7XG5cbi8vXG52YXIgaXNPYmplY3QzID0gKHZhbHVlKSA9PiBPYmplY3QodmFsdWUpID09PSB2YWx1ZTtcbnZhciBrbm93blByb21pc2VzID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG52YXIgbWFya1NldHRsZWQgPSAocmVjb3JkKSA9PiB7XG4gIGlmICghcmVjb3JkIHx8IHJlY29yZC5zZXR0bGVkKSB7XG4gICAgcmV0dXJuIC8qICAgICAgICAgICAqLyBuZXcgU2V0KCk7XG4gIH1cbiAgY29uc3QgeyBkZWZlcnJlZHMgfSA9IHJlY29yZDtcbiAgT2JqZWN0LmFzc2lnbihyZWNvcmQsIHtcbiAgICBkZWZlcnJlZHM6IHZvaWQgMCxcbiAgICBzZXR0bGVkOiB0cnVlXG4gIH0pO1xuICBPYmplY3QuZnJlZXplKHJlY29yZCk7XG4gIHJldHVybiBkZWZlcnJlZHM7XG59O1xudmFyIGdldE1lbW9SZWNvcmQgPSAodmFsdWUpID0+IHtcbiAgaWYgKCFpc09iamVjdDModmFsdWUpKSB7XG4gICAgcmV0dXJuIGhhcmRlbih7IHNldHRsZWQ6IHRydWUgfSk7XG4gIH1cbiAgbGV0IHJlY29yZCA9IGtub3duUHJvbWlzZXMuZ2V0KHZhbHVlKTtcbiAgaWYgKCFyZWNvcmQpIHtcbiAgICByZWNvcmQgPSB7IGRlZmVycmVkczogLyogICAgICAgICAgICovIG5ldyBTZXQoKSwgc2V0dGxlZDogZmFsc2UgfTtcbiAgICBrbm93blByb21pc2VzLnNldCh2YWx1ZSwgcmVjb3JkKTtcbiAgICBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oXG4gICAgICAodmFsKSA9PiB7XG4gICAgICAgIGZvciAoY29uc3QgeyByZXNvbHZlOiByZXNvbHZlMiB9IG9mIG1hcmtTZXR0bGVkKHJlY29yZCkpIHtcbiAgICAgICAgICByZXNvbHZlMih2YWwpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgKGVycikgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IHsgcmVqZWN0IH0gb2YgbWFya1NldHRsZWQocmVjb3JkKSkge1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgfVxuICByZXR1cm4gcmVjb3JkO1xufTtcbnZhciB7IHJhY2UgfSA9IHtcbiAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAqL1xuICByYWNlKHZhbHVlczYpIHtcbiAgICBsZXQgZGVmZXJyZWQ7XG4gICAgY29uc3QgY2FjaGVkVmFsdWVzID0gW107XG4gICAgY29uc3QgQyA9IHRoaXM7XG4gICAgY29uc3QgcmVzdWx0ID0gbmV3IEMoKHJlc29sdmUyLCByZWplY3QpID0+IHtcbiAgICAgIGRlZmVycmVkID0geyByZXNvbHZlOiByZXNvbHZlMiwgcmVqZWN0IH07XG4gICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHZhbHVlczYpIHtcbiAgICAgICAgY2FjaGVkVmFsdWVzLnB1c2godmFsdWUpO1xuICAgICAgICBjb25zdCB7IHNldHRsZWQsIGRlZmVycmVkcyB9ID0gZ2V0TWVtb1JlY29yZCh2YWx1ZSk7XG4gICAgICAgIGlmIChzZXR0bGVkKSB7XG4gICAgICAgICAgQy5yZXNvbHZlKHZhbHVlKS50aGVuKHJlc29sdmUyLCByZWplY3QpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRlZmVycmVkcy5hZGQoZGVmZXJyZWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdC5maW5hbGx5KCgpID0+IHtcbiAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgY2FjaGVkVmFsdWVzKSB7XG4gICAgICAgIGNvbnN0IHsgZGVmZXJyZWRzIH0gPSBnZXRNZW1vUmVjb3JkKHZhbHVlKTtcbiAgICAgICAgaWYgKGRlZmVycmVkcykge1xuICAgICAgICAgIGRlZmVycmVkcy5kZWxldGUoZGVmZXJyZWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn07XG5cbi8vXG5mdW5jdGlvbiBpc1Byb21pc2UobWF5YmVQcm9taXNlKSB7XG4gIHJldHVybiBQcm9taXNlLnJlc29sdmUobWF5YmVQcm9taXNlKSA9PT0gbWF5YmVQcm9taXNlO1xufVxuaGFyZGVuKGlzUHJvbWlzZSk7XG5cbi8vXG52YXIgQmVzdFBpcGVsaW5hYmxlUHJvbWlzZSA9IGdsb2JhbFRoaXMuSGFuZGxlZFByb21pc2UgfHwgUHJvbWlzZTtcbmZ1bmN0aW9uIG1ha2VQcm9taXNlS2l0KCkge1xuICBjb25zdCB7IHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QsIGV4ZWN1dG9yIH0gPSBtYWtlUmVsZWFzaW5nRXhlY3V0b3JLaXQoKTtcbiAgY29uc3QgcHJvbWlzZSA9IG5ldyBCZXN0UGlwZWxpbmFibGVQcm9taXNlKGV4ZWN1dG9yKTtcbiAgcmV0dXJuIGhhcmRlbih7IHByb21pc2UsIHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QgfSk7XG59XG5oYXJkZW4obWFrZVByb21pc2VLaXQpO1xuZnVuY3Rpb24gcmFjZVByb21pc2VzKHZhbHVlczYpIHtcbiAgcmV0dXJuIGhhcmRlbihyYWNlLmNhbGwoQmVzdFBpcGVsaW5hYmxlUHJvbWlzZSwgdmFsdWVzNikpO1xufVxuaGFyZGVuKHJhY2VQcm9taXNlcyk7XG5cbi8vXG52YXIgeyBnZXRQcm90b3R5cGVPZjogZ2V0UHJvdG90eXBlT2Y2IH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzNCB9ID0gUmVmbGVjdDtcbnZhciB7IGlzQXJyYXk6IGlzQXJyYXkzLCBwcm90b3R5cGU6IGFycmF5UHJvdG90eXBlIH0gPSBBcnJheTtcbnZhciBDb3B5QXJyYXlIZWxwZXIgPSBoYXJkZW4oe1xuICBzdHlsZU5hbWU6IFwiY29weUFycmF5XCIsXG4gIGNhbkJlVmFsaWQ6IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiBpc0FycmF5MyhjYW5kaWRhdGUpIHx8ICEhY2hlY2sgJiYgY2hlY2soZmFsc2UsIHJlZGFjdGVkYEFycmF5IGV4cGVjdGVkOiAke2NhbmRpZGF0ZX1gKSxcbiAgYXNzZXJ0UmVzdFZhbGlkOiAoY2FuZGlkYXRlLCBwYXNzU3R5bGVPZlJlY3VyKSA9PiB7XG4gICAgZ2V0UHJvdG90eXBlT2Y2KGNhbmRpZGF0ZSkgPT09IGFycmF5UHJvdG90eXBlIHx8IGFzc2VydC5mYWlsKHJlZGFjdGVkYE1hbGZvcm1lZCBhcnJheTogJHtjYW5kaWRhdGV9YCwgVHlwZUVycm9yKTtcbiAgICBjb25zdCBsZW4gPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGdldE93bkRhdGFEZXNjcmlwdG9yKGNhbmRpZGF0ZSwgXCJsZW5ndGhcIiwgZmFsc2UsIGFzc2VydENoZWNrZXIpLnZhbHVlXG4gICAgKTtcbiAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbGVuOyBpMiArPSAxKSB7XG4gICAgICBwYXNzU3R5bGVPZlJlY3VyKFxuICAgICAgICBnZXRPd25EYXRhRGVzY3JpcHRvcihjYW5kaWRhdGUsIGkyLCB0cnVlLCBhc3NlcnRDaGVja2VyKS52YWx1ZVxuICAgICAgKTtcbiAgICB9XG4gICAgb3duS2V5czQoY2FuZGlkYXRlKS5sZW5ndGggPT09IGxlbiArIDEgfHwgYXNzZXJ0LmZhaWwocmVkYWN0ZWRgQXJyYXlzIG11c3Qgbm90IGhhdmUgbm9uLWluZGV4ZXM6ICR7Y2FuZGlkYXRlfWAsIFR5cGVFcnJvcik7XG4gIH1cbn0pO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czUgfSA9IFJlZmxlY3Q7XG52YXIgeyBnZXRQcm90b3R5cGVPZjogZ2V0UHJvdG90eXBlT2Y3LCBwcm90b3R5cGU6IG9iamVjdFByb3RvdHlwZTQgfSA9IE9iamVjdDtcbnZhciBjaGVja09iamVjdFByb3RvdHlwZSA9IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiB7XG4gIHJldHVybiBnZXRQcm90b3R5cGVPZjcoY2FuZGlkYXRlKSA9PT0gb2JqZWN0UHJvdG90eXBlNCB8fCAhIWNoZWNrICYmIENYKGNoZWNrKWBSZWNvcmRzIG11c3QgaW5oZXJpdCBmcm9tIE9iamVjdC5wcm90b3R5cGU6ICR7Y2FuZGlkYXRlfWA7XG59O1xudmFyIGNoZWNrUHJvcGVydHlDYW5CZVZhbGlkID0gKGNhbmRpZGF0ZSwga2V5LCB2YWx1ZSwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgcmV0dXJuICh0eXBlb2Yga2V5ID09PSBcInN0cmluZ1wiIHx8ICEhY2hlY2sgJiYgQ1goXG4gICAgY2hlY2tcbiAgKWBSZWNvcmRzIGNhbiBvbmx5IGhhdmUgc3RyaW5nLW5hbWVkIHByb3BlcnRpZXM6ICR7Y2FuZGlkYXRlfWApICYmICghY2FuQmVNZXRob2QodmFsdWUpIHx8ICEhY2hlY2sgJiYgLy9cbiAgQ1goXG4gICAgY2hlY2tcbiAgKWBSZWNvcmRzIGNhbm5vdCBjb250YWluIG5vbi1mYXIgZnVuY3Rpb25zIGJlY2F1c2UgdGhleSBtYXkgYmUgbWV0aG9kcyBvZiBhbiBpbXBsaWNpdCBSZW1vdGFibGU6ICR7Y2FuZGlkYXRlfWApO1xufTtcbnZhciBDb3B5UmVjb3JkSGVscGVyID0gaGFyZGVuKHtcbiAgc3R5bGVOYW1lOiBcImNvcHlSZWNvcmRcIixcbiAgY2FuQmVWYWxpZDogKGNhbmRpZGF0ZSwgY2hlY2sgPSB2b2lkIDApID0+IHtcbiAgICByZXR1cm4gY2hlY2tPYmplY3RQcm90b3R5cGUoY2FuZGlkYXRlLCBjaGVjaykgJiYgLy9cbiAgICAvL1xuICAgIG93bktleXM1KGNhbmRpZGF0ZSkuZXZlcnkoXG4gICAgICAoa2V5KSA9PiBjaGVja1Byb3BlcnR5Q2FuQmVWYWxpZChjYW5kaWRhdGUsIGtleSwgY2FuZGlkYXRlW2tleV0sIGNoZWNrKVxuICAgICk7XG4gIH0sXG4gIGFzc2VydFJlc3RWYWxpZDogKGNhbmRpZGF0ZSwgcGFzc1N0eWxlT2ZSZWN1cikgPT4ge1xuICAgIGZvciAoY29uc3QgbmFtZSBvZiBvd25LZXlzNShjYW5kaWRhdGUpKSB7XG4gICAgICBjb25zdCB7IHZhbHVlIH0gPSBnZXRPd25EYXRhRGVzY3JpcHRvcihcbiAgICAgICAgY2FuZGlkYXRlLFxuICAgICAgICBuYW1lLFxuICAgICAgICB0cnVlLFxuICAgICAgICBhc3NlcnRDaGVja2VyXG4gICAgICApO1xuICAgICAgcGFzc1N0eWxlT2ZSZWN1cih2YWx1ZSk7XG4gICAgfVxuICB9XG59KTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXM2IH0gPSBSZWZsZWN0O1xudmFyIHsgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczQgfSA9IE9iamVjdDtcbnZhciBUYWdnZWRIZWxwZXIgPSBoYXJkZW4oe1xuICBzdHlsZU5hbWU6IFwidGFnZ2VkXCIsXG4gIGNhbkJlVmFsaWQ6IChjYW5kaWRhdGUsIGNoZWNrID0gdm9pZCAwKSA9PiBjaGVja1Bhc3NTdHlsZShjYW5kaWRhdGUsIGNhbmRpZGF0ZVtQQVNTX1NUWUxFXSwgXCJ0YWdnZWRcIiwgY2hlY2spLFxuICBhc3NlcnRSZXN0VmFsaWQ6IChjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIpID0+IHtcbiAgICBjaGVja1RhZ1JlY29yZChjYW5kaWRhdGUsIFwidGFnZ2VkXCIsIGFzc2VydENoZWNrZXIpO1xuICAgIGNvbnN0IHBhc3NTdHlsZUtleSA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIFBBU1NfU1RZTEVcbiAgICApO1xuICAgIGNvbnN0IHRhZ0tleSA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIFN5bWJvbC50b1N0cmluZ1RhZ1xuICAgICk7XG4gICAgY29uc3Qge1xuICAgICAgLy9cbiAgICAgIFtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgIHBhc3NTdHlsZUtleVxuICAgICAgXTogX3Bhc3NTdHlsZURlc2MsXG4gICAgICBbXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB0YWdLZXlcbiAgICAgIF06IF9sYWJlbERlc2MsXG4gICAgICBwYXlsb2FkOiBfcGF5bG9hZERlc2MsXG4gICAgICAvL1xuICAgICAgLi4ucmVzdERlc2NzXG4gICAgfSA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM0KGNhbmRpZGF0ZSk7XG4gICAgb3duS2V5czYocmVzdERlc2NzKS5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIHByb3BlcnRpZXMgb24gdGFnZ2VkIHJlY29yZCAke293bktleXM2KHJlc3REZXNjcyl9YDtcbiAgICBwYXNzU3R5bGVPZlJlY3VyKFxuICAgICAgZ2V0T3duRGF0YURlc2NyaXB0b3IoY2FuZGlkYXRlLCBcInBheWxvYWRcIiwgdHJ1ZSwgYXNzZXJ0Q2hlY2tlcikudmFsdWVcbiAgICApO1xuICB9XG59KTtcblxuLy9cbnZhciB7IGlzRnJvemVuOiBpc0Zyb3plbjQsIGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjgsIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMiB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czcgfSA9IFJlZmxlY3Q7XG52YXIgeyB0b1N0cmluZ1RhZyB9ID0gU3ltYm9sO1xudmFyIGNoZWNrUHJvbWlzZU93bktleXMgPSAocHIsIGNoZWNrKSA9PiB7XG4gIGNvbnN0IGtleXM0ID0gb3duS2V5czcocHIpO1xuICBpZiAoa2V5czQubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgY29uc3QgdW5rbm93bktleXMgPSBrZXlzNC5maWx0ZXIoXG4gICAgKGtleSkgPT4gdHlwZW9mIGtleSAhPT0gXCJzeW1ib2xcIiB8fCAhaGFzT3duUHJvcGVydHlPZihQcm9taXNlLnByb3RvdHlwZSwga2V5KVxuICApO1xuICBpZiAodW5rbm93bktleXMubGVuZ3RoICE9PSAwKSB7XG4gICAgcmV0dXJuIENYKFxuICAgICAgY2hlY2tcbiAgICApYCR7cHJ9IC0gTXVzdCBub3QgaGF2ZSBhbnkgb3duIHByb3BlcnRpZXM6ICR7cXVvdGUodW5rbm93bktleXMpfWA7XG4gIH1cbiAgY29uc3QgY2hlY2tTYWZlT3duS2V5ID0gKGtleSkgPT4ge1xuICAgIGlmIChrZXkgPT09IHRvU3RyaW5nVGFnKSB7XG4gICAgICBjb25zdCB0YWdEZXNjID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMihwciwgdG9TdHJpbmdUYWcpO1xuICAgICAgYXNzZXJ0KHRhZ0Rlc2MgIT09IHZvaWQgMCk7XG4gICAgICByZXR1cm4gKGhhc093blByb3BlcnR5T2YodGFnRGVzYywgXCJ2YWx1ZVwiKSB8fCBDWChcbiAgICAgICAgY2hlY2tcbiAgICAgIClgT3duIEBAdG9TdHJpbmdUYWcgbXVzdCBiZSBhIGRhdGEgcHJvcGVydHksIG5vdCBhbiBhY2Nlc3NvcjogJHtxdW90ZSh0YWdEZXNjKX1gKSAmJiAodHlwZW9mIHRhZ0Rlc2MudmFsdWUgPT09IFwic3RyaW5nXCIgfHwgQ1goXG4gICAgICAgIGNoZWNrXG4gICAgICApYE93biBAQHRvU3RyaW5nVGFnIHZhbHVlIG11c3QgYmUgYSBzdHJpbmc6ICR7cXVvdGUodGFnRGVzYy52YWx1ZSl9YCkgJiYgKCF0YWdEZXNjLmVudW1lcmFibGUgfHwgQ1goY2hlY2spYE93biBAQHRvU3RyaW5nVGFnIG11c3Qgbm90IGJlIGVudW1lcmFibGU6ICR7cXVvdGUodGFnRGVzYyl9YCk7XG4gICAgfVxuICAgIGNvbnN0IHZhbCA9IHByW2tleV07XG4gICAgaWYgKHZhbCA9PT0gdm9pZCAwIHx8IHR5cGVvZiB2YWwgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHZhbCA9PT0gXCJvYmplY3RcIiAmJiB2YWwgIT09IG51bGwgJiYgaXNGcm96ZW40KHZhbCkgJiYgZ2V0UHJvdG90eXBlT2Y4KHZhbCkgPT09IE9iamVjdC5wcm90b3R5cGUpIHtcbiAgICAgIGNvbnN0IHN1YktleXMgPSBvd25LZXlzNyh2YWwpO1xuICAgICAgaWYgKHN1YktleXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKHN1YktleXMubGVuZ3RoID09PSAxICYmIHN1YktleXNbMF0gPT09IFwiZGVzdHJveWVkXCIgJiYgdmFsLmRlc3Ryb3llZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBDWChcbiAgICAgIGNoZWNrXG4gICAgKWBVbmV4cGVjdGVkIE5vZGUgYXN5bmNfaG9va3MgYWRkaXRpb25zIHRvIHByb21pc2U6ICR7cHJ9LiR7cXVvdGUoXG4gICAgICBTdHJpbmcoa2V5KVxuICAgICl9IGlzICR7dmFsfWA7XG4gIH07XG4gIHJldHVybiBrZXlzNC5ldmVyeShjaGVja1NhZmVPd25LZXkpO1xufTtcbnZhciBjaGVja1NhZmVQcm9taXNlID0gKHByLCBjaGVjaykgPT4ge1xuICByZXR1cm4gKGlzRnJvemVuNChwcikgfHwgQ1goY2hlY2spYCR7cHJ9IC0gTXVzdCBiZSBmcm96ZW5gKSAmJiAoaXNQcm9taXNlKHByKSB8fCBDWChjaGVjaylgJHtwcn0gLSBNdXN0IGJlIGEgcHJvbWlzZWApICYmIChnZXRQcm90b3R5cGVPZjgocHIpID09PSBQcm9taXNlLnByb3RvdHlwZSB8fCBDWChjaGVjaylgJHtwcn0gLSBNdXN0IGluaGVyaXQgZnJvbSBQcm9taXNlLnByb3RvdHlwZTogJHtxdW90ZShcbiAgICBnZXRQcm90b3R5cGVPZjgocHIpXG4gICl9YCkgJiYgY2hlY2tQcm9taXNlT3duS2V5cyhcbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgcHIsXG4gICAgY2hlY2tcbiAgKTtcbn07XG5oYXJkZW4oY2hlY2tTYWZlUHJvbWlzZSk7XG52YXIgaXNTYWZlUHJvbWlzZSA9IChwcikgPT4gY2hlY2tTYWZlUHJvbWlzZShwciwgKHgpID0+IHgpO1xuaGFyZGVuKGlzU2FmZVByb21pc2UpO1xudmFyIGFzc2VydFNhZmVQcm9taXNlID0gKHByKSA9PiBjaGVja1NhZmVQcm9taXNlKHByLCBhc3NlcnRDaGVja2VyKTtcblxuLy9cbnZhciB7IG93bktleXM6IG93bktleXM4IH0gPSBSZWZsZWN0O1xudmFyIHsgaXNGcm96ZW46IGlzRnJvemVuNSwgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczUsIHZhbHVlcyB9ID0gT2JqZWN0O1xudmFyIG1ha2VIZWxwZXJUYWJsZSA9IChwYXNzU3R5bGVIZWxwZXJzKSA9PiB7XG4gIGNvbnN0IEhlbHBlclRhYmxlID0ge1xuICAgIF9fcHJvdG9fXzogbnVsbCxcbiAgICBjb3B5QXJyYXk6IHZvaWQgMCxcbiAgICBjb3B5UmVjb3JkOiB2b2lkIDAsXG4gICAgdGFnZ2VkOiB2b2lkIDAsXG4gICAgZXJyb3I6IHZvaWQgMCxcbiAgICByZW1vdGFibGU6IHZvaWQgMFxuICB9O1xuICBmb3IgKGNvbnN0IGhlbHBlciBvZiBwYXNzU3R5bGVIZWxwZXJzKSB7XG4gICAgY29uc3QgeyBzdHlsZU5hbWUgfSA9IGhlbHBlcjtcbiAgICBzdHlsZU5hbWUgaW4gSGVscGVyVGFibGUgfHwgdGhyb3dSZWRhY3RlZGBVbnJlY29nbml6ZWQgaGVscGVyOiAke3F1b3RlKHN0eWxlTmFtZSl9YDtcbiAgICBIZWxwZXJUYWJsZVtzdHlsZU5hbWVdID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBjb25mbGljdGluZyBoZWxwZXJzIGZvciAke3F1b3RlKHN0eWxlTmFtZSl9YDtcbiAgICBIZWxwZXJUYWJsZVtzdHlsZU5hbWVdID0gaGVscGVyO1xuICB9XG4gIGZvciAoY29uc3Qgc3R5bGVOYW1lIG9mIG93bktleXM4KEhlbHBlclRhYmxlKSkge1xuICAgIEhlbHBlclRhYmxlW3N0eWxlTmFtZV0gIT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYG1pc3NpbmcgaGVscGVyIGZvciAke3F1b3RlKHN0eWxlTmFtZSl9YDtcbiAgfVxuICByZXR1cm4gaGFyZGVuKEhlbHBlclRhYmxlKTtcbn07XG52YXIgYXNzZXJ0VmFsaWQgPSAoaGVscGVyLCBjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIpID0+IHtcbiAgaGVscGVyLmNhbkJlVmFsaWQoY2FuZGlkYXRlLCBhc3NlcnRDaGVja2VyKTtcbiAgaGVscGVyLmFzc2VydFJlc3RWYWxpZChjYW5kaWRhdGUsIHBhc3NTdHlsZU9mUmVjdXIpO1xufTtcbnZhciBtYWtlUGFzc1N0eWxlT2YgPSAocGFzc1N0eWxlSGVscGVycykgPT4ge1xuICBjb25zdCBIZWxwZXJUYWJsZSA9IG1ha2VIZWxwZXJUYWJsZShwYXNzU3R5bGVIZWxwZXJzKTtcbiAgY29uc3QgcmVtb3RhYmxlSGVscGVyID0gSGVscGVyVGFibGUucmVtb3RhYmxlO1xuICBjb25zdCBwYXNzU3R5bGVNZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IHBhc3NTdHlsZU9mMiA9IChwYXNzYWJsZSkgPT4ge1xuICAgIGNvbnN0IGluUHJvZ3Jlc3MgPSAvKiAgICAgICAgICAgKi8gbmV3IFNldCgpO1xuICAgIGNvbnN0IHBhc3NTdHlsZU9mUmVjdXIgPSAoaW5uZXIpID0+IHtcbiAgICAgIGNvbnN0IGlubmVySXNPYmplY3QgPSBpc09iamVjdDIoaW5uZXIpO1xuICAgICAgaWYgKGlubmVySXNPYmplY3QpIHtcbiAgICAgICAgY29uc3QgaW5uZXJTdHlsZSA9IHBhc3NTdHlsZU1lbW8uZ2V0KGlubmVyKTtcbiAgICAgICAgaWYgKGlubmVyU3R5bGUpIHtcbiAgICAgICAgICByZXR1cm4gaW5uZXJTdHlsZTtcbiAgICAgICAgfVxuICAgICAgICAhaW5Qcm9ncmVzcy5oYXMoaW5uZXIpIHx8IHRocm93UmVkYWN0ZWRgUGFzcy1ieS1jb3B5IGRhdGEgY2Fubm90IGJlIGN5Y2xpYyAke2lubmVyfWA7XG4gICAgICAgIGluUHJvZ3Jlc3MuYWRkKGlubmVyKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mSW50ZXJuYWwoaW5uZXIpO1xuICAgICAgaWYgKGlubmVySXNPYmplY3QpIHtcbiAgICAgICAgcGFzc1N0eWxlTWVtby5zZXQoaW5uZXIsIHBhc3NTdHlsZSk7XG4gICAgICAgIGluUHJvZ3Jlc3MuZGVsZXRlKGlubmVyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXNzU3R5bGU7XG4gICAgfTtcbiAgICBjb25zdCBwYXNzU3R5bGVPZkludGVybmFsID0gKGlubmVyKSA9PiB7XG4gICAgICBjb25zdCB0eXBlc3RyID0gdHlwZW9mIGlubmVyO1xuICAgICAgc3dpdGNoICh0eXBlc3RyKSB7XG4gICAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjpcbiAgICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgICByZXR1cm4gdHlwZXN0cjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic3RyaW5nXCI6IHtcbiAgICAgICAgICBhc3NlcnRQYXNzYWJsZVN0cmluZyhpbm5lcik7XG4gICAgICAgICAgcmV0dXJuIFwic3RyaW5nXCI7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICAgICAgYXNzZXJ0UGFzc2FibGVTeW1ib2woaW5uZXIpO1xuICAgICAgICAgIHJldHVybiBcInN5bWJvbFwiO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJvYmplY3RcIjoge1xuICAgICAgICAgIGlmIChpbm5lciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIFwibnVsbFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWlzRnJvemVuNShpbm5lcikpIHtcbiAgICAgICAgICAgIGFzc2VydC5mYWlsKFxuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBpc1R5cGVkQXJyYXkoaW5uZXIpID8gcmVkYWN0ZWRgQ2Fubm90IHBhc3MgbXV0YWJsZSB0eXBlZCBhcnJheXMgbGlrZSAke2lubmVyfS5gIDogcmVkYWN0ZWRgQ2Fubm90IHBhc3Mgbm9uLWZyb3plbiBvYmplY3RzIGxpa2UgJHtpbm5lcn0uIFVzZSBoYXJkZW4oKWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChpc1Byb21pc2UoaW5uZXIpKSB7XG4gICAgICAgICAgICBhc3NlcnRTYWZlUHJvbWlzZShpbm5lcik7XG4gICAgICAgICAgICByZXR1cm4gXCJwcm9taXNlXCI7XG4gICAgICAgICAgfVxuICAgICAgICAgIHR5cGVvZiBpbm5lci50aGVuICE9PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcGFzcyBub24tcHJvbWlzZSB0aGVuYWJsZXNgO1xuICAgICAgICAgIGNvbnN0IHBhc3NTdHlsZVRhZyA9IGlubmVyW1BBU1NfU1RZTEVdO1xuICAgICAgICAgIGlmIChwYXNzU3R5bGVUYWcgIT09IHZvaWQgMCkge1xuICAgICAgICAgICAgYXNzZXJ0LnR5cGVvZihwYXNzU3R5bGVUYWcsIFwic3RyaW5nXCIpO1xuICAgICAgICAgICAgY29uc3QgaGVscGVyID0gSGVscGVyVGFibGVbcGFzc1N0eWxlVGFnXTtcbiAgICAgICAgICAgIGhlbHBlciAhPT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIFBhc3NTdHlsZTogJHtxdW90ZShwYXNzU3R5bGVUYWcpfWA7XG4gICAgICAgICAgICBhc3NlcnRWYWxpZChoZWxwZXIsIGlubmVyLCBwYXNzU3R5bGVPZlJlY3VyKTtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICBwYXNzU3R5bGVUYWdcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAoY29uc3QgaGVscGVyIG9mIHBhc3NTdHlsZUhlbHBlcnMpIHtcbiAgICAgICAgICAgIGlmIChoZWxwZXIuY2FuQmVWYWxpZChpbm5lcikpIHtcbiAgICAgICAgICAgICAgaGVscGVyLmFzc2VydFJlc3RWYWxpZChpbm5lciwgcGFzc1N0eWxlT2ZSZWN1cik7XG4gICAgICAgICAgICAgIHJldHVybiBoZWxwZXIuc3R5bGVOYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBhc3NlcnRWYWxpZChyZW1vdGFibGVIZWxwZXIsIGlubmVyLCBwYXNzU3R5bGVPZlJlY3VyKTtcbiAgICAgICAgICByZXR1cm4gXCJyZW1vdGFibGVcIjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiZnVuY3Rpb25cIjoge1xuICAgICAgICAgIGlzRnJvemVuNShpbm5lcikgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcGFzcyBub24tZnJvemVuIG9iamVjdHMgbGlrZSAke2lubmVyfS4gVXNlIGhhcmRlbigpYDtcbiAgICAgICAgICB0eXBlb2YgaW5uZXIudGhlbiAhPT0gXCJmdW5jdGlvblwiIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHBhc3Mgbm9uLXByb21pc2UgdGhlbmFibGVzYDtcbiAgICAgICAgICBhc3NlcnRWYWxpZChyZW1vdGFibGVIZWxwZXIsIGlubmVyLCBwYXNzU3R5bGVPZlJlY3VyKTtcbiAgICAgICAgICByZXR1cm4gXCJyZW1vdGFibGVcIjtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwocmVkYWN0ZWRgVW5yZWNvZ25pemVkIHR5cGVvZiAke3F1b3RlKHR5cGVzdHIpfWAsIFR5cGVFcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBwYXNzU3R5bGVPZlJlY3VyKHBhc3NhYmxlKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbihwYXNzU3R5bGVPZjIpO1xufTtcbnZhciBQYXNzU3R5bGVPZkVuZG93bWVudFN5bWJvbCA9IFN5bWJvbC5mb3IoXCJAZW5kbyBwYXNzU3R5bGVPZlwiKTtcbnZhciBwYXNzU3R5bGVPZiA9IGdsb2JhbFRoaXMgJiYgZ2xvYmFsVGhpc1tQYXNzU3R5bGVPZkVuZG93bWVudFN5bWJvbF0gfHwgbWFrZVBhc3NTdHlsZU9mKFtcbiAgQ29weUFycmF5SGVscGVyLFxuICBDb3B5UmVjb3JkSGVscGVyLFxuICBUYWdnZWRIZWxwZXIsXG4gIEVycm9ySGVscGVyLFxuICBSZW1vdGFibGVIZWxwZXJcbl0pO1xudmFyIGFzc2VydFBhc3NhYmxlID0gKHZhbCkgPT4ge1xuICBwYXNzU3R5bGVPZih2YWwpO1xufTtcbmhhcmRlbihhc3NlcnRQYXNzYWJsZSk7XG52YXIgaXNQYXNzYWJsZSA9IChzcGVjaW1lbikgPT4ge1xuICB0cnkge1xuICAgIHJldHVybiBwYXNzU3R5bGVPZihzcGVjaW1lbikgIT09IHZvaWQgMDtcbiAgfSBjYXRjaCAoXykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcbmhhcmRlbihpc1Bhc3NhYmxlKTtcbnZhciBpc1Bhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MgPSAobmFtZSwgZGVzYykgPT4gY2hlY2tSZWN1cnNpdmVseVBhc3NhYmxlRXJyb3JQcm9wZXJ0eURlc2MobmFtZSwgZGVzYywgcGFzc1N0eWxlT2YpO1xudmFyIHRvUGFzc2FibGVFcnJvciA9IChlcnIpID0+IHtcbiAgaGFyZGVuKGVycik7XG4gIGlmIChjaGVja1JlY3Vyc2l2ZWx5UGFzc2FibGVFcnJvcihlcnIsIHBhc3NTdHlsZU9mKSkge1xuICAgIHJldHVybiBlcnI7XG4gIH1cbiAgY29uc3QgeyBuYW1lLCBtZXNzYWdlIH0gPSBlcnI7XG4gIGNvbnN0IHsgY2F1c2U6IGNhdXNlRGVzYywgZXJyb3JzOiBlcnJvcnNEZXNjIH0gPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNShlcnIpO1xuICBsZXQgY2F1c2U7XG4gIGxldCBlcnJvcnM7XG4gIGlmIChjYXVzZURlc2MgJiYgaXNQYXNzYWJsZUVycm9yUHJvcGVydHlEZXNjKFwiY2F1c2VcIiwgY2F1c2VEZXNjKSkge1xuICAgIGNhdXNlID0gY2F1c2VEZXNjLnZhbHVlO1xuICB9XG4gIGlmIChlcnJvcnNEZXNjICYmIGlzUGFzc2FibGVFcnJvclByb3BlcnR5RGVzYyhcImVycm9yc1wiLCBlcnJvcnNEZXNjKSkge1xuICAgIGVycm9ycyA9IGVycm9yc0Rlc2MudmFsdWU7XG4gIH1cbiAgY29uc3QgZXJyQ29uc3RydWN0b3IgPSBnZXRFcnJvckNvbnN0cnVjdG9yKGAke25hbWV9YCkgfHwgRXJyb3I7XG4gIGNvbnN0IG5ld0Vycm9yID0gbWFrZUVycm9yKGAke21lc3NhZ2V9YCwgZXJyQ29uc3RydWN0b3IsIHtcbiAgICAvL1xuICAgIGNhdXNlLFxuICAgIGVycm9yc1xuICB9KTtcbiAgaGFyZGVuKG5ld0Vycm9yKTtcbiAgbm90ZShuZXdFcnJvciwgcmVkYWN0ZWRgY29waWVkIGZyb20gZXJyb3IgJHtlcnJ9YCk7XG4gIHBhc3NTdHlsZU9mKG5ld0Vycm9yKSA9PT0gXCJlcnJvclwiIHx8IHRocm93UmVkYWN0ZWRgRXhwZWN0ZWQgJHtuZXdFcnJvcn0gdG8gYmUgYSBwYXNzYWJsZSBlcnJvcmA7XG4gIHJldHVybiBuZXdFcnJvcjtcbn07XG5oYXJkZW4odG9QYXNzYWJsZUVycm9yKTtcbnZhciB0b1Rocm93YWJsZSA9IChzcGVjaW1lbikgPT4ge1xuICBoYXJkZW4oc3BlY2ltZW4pO1xuICBpZiAoaXNFcnJvckxpa2Uoc3BlY2ltZW4pKSB7XG4gICAgcmV0dXJuIHRvUGFzc2FibGVFcnJvcihcbiAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICBzcGVjaW1lblxuICAgICk7XG4gIH1cbiAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2Yoc3BlY2ltZW4pO1xuICBpZiAoaXNPYmplY3QyKHNwZWNpbWVuKSkge1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgc3BlY2ltZW5cbiAgICAgICAgKTtcbiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7XG4gICAgICAgICAgZWxlbWVudCA9PT0gdG9UaHJvd2FibGUoZWxlbWVudCkgfHwgdGhyb3dSZWRhY3RlZGBuZXN0ZWQgdG9UaHJvd2FibGUgY29lcmNpb24gbm90IHlldCBzdXBwb3J0ZWQgJHtlbGVtZW50fWA7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGNvbnN0IHJlYyA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgc3BlY2ltZW5cbiAgICAgICAgKTtcbiAgICAgICAgZm9yIChjb25zdCB2YWwgb2YgdmFsdWVzKHJlYykpIHtcbiAgICAgICAgICB2YWwgPT09IHRvVGhyb3dhYmxlKHZhbCkgfHwgdGhyb3dSZWRhY3RlZGBuZXN0ZWQgdG9UaHJvd2FibGUgY29lcmNpb24gbm90IHlldCBzdXBwb3J0ZWQgJHt2YWx9YDtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICBjb25zdCB0ZyA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgc3BlY2ltZW5cbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgeyBwYXlsb2FkIH0gPSB0ZztcbiAgICAgICAgcGF5bG9hZCA9PT0gdG9UaHJvd2FibGUocGF5bG9hZCkgfHwgdGhyb3dSZWRhY3RlZGBuZXN0ZWQgdG9UaHJvd2FibGUgY29lcmNpb24gbm90IHlldCBzdXBwb3J0ZWQgJHtwYXlsb2FkfWA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgY29uc3QgZXIgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBzcGVjaW1lblxuICAgICAgICApO1xuICAgICAgICBlciA9PT0gdG9UaHJvd2FibGUoZXIpIHx8IHRocm93UmVkYWN0ZWRgbmVzdGVkIHRvVGhyb3dhYmxlIGNvZXJjaW9uIG5vdCB5ZXQgc3VwcG9ydGVkICR7ZXJ9YDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgQSAke3F1b3RlKHBhc3NTdHlsZSl9IGlzIG5vdCB0aHJvd2FibGU6ICR7c3BlY2ltZW59YDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBzcGVjaW1lblxuICApO1xufTtcbmhhcmRlbih0b1Rocm93YWJsZSk7XG5cbi8vXG52YXIgeyBjcmVhdGU6IGNyZWF0ZTIsIHByb3RvdHlwZTogb2JqZWN0UHJvdG90eXBlNSB9ID0gT2JqZWN0O1xudmFyIG1ha2VUYWdnZWQgPSAodGFnLCBwYXlsb2FkKSA9PiB7XG4gIHR5cGVvZiB0YWcgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBUaGUgdGFnIG9mIGEgdGFnZ2VkIHJlY29yZCBtdXN0IGJlIGEgc3RyaW5nOiAke3RhZ31gO1xuICBhc3NlcnRQYXNzYWJsZShoYXJkZW4ocGF5bG9hZCkpO1xuICByZXR1cm4gaGFyZGVuKFxuICAgIGNyZWF0ZTIob2JqZWN0UHJvdG90eXBlNSwge1xuICAgICAgW1BBU1NfU1RZTEVdOiB7IHZhbHVlOiBcInRhZ2dlZFwiIH0sXG4gICAgICBbU3ltYm9sLnRvU3RyaW5nVGFnXTogeyB2YWx1ZTogdGFnIH0sXG4gICAgICBwYXlsb2FkOiB7IHZhbHVlOiBwYXlsb2FkLCBlbnVtZXJhYmxlOiB0cnVlIH1cbiAgICB9KVxuICApO1xufTtcbmhhcmRlbihtYWtlVGFnZ2VkKTtcblxuLy9cbnZhciBpc0NvcHlBcnJheSA9IChhcnIpID0+IHBhc3NTdHlsZU9mKGFycikgPT09IFwiY29weUFycmF5XCI7XG5oYXJkZW4oaXNDb3B5QXJyYXkpO1xudmFyIGlzUmVjb3JkID0gKHJlY29yZCkgPT4gcGFzc1N0eWxlT2YocmVjb3JkKSA9PT0gXCJjb3B5UmVjb3JkXCI7XG5oYXJkZW4oaXNSZWNvcmQpO1xudmFyIGlzUmVtb3RhYmxlID0gKHJlbW90YWJsZSkgPT4gcGFzc1N0eWxlT2YocmVtb3RhYmxlKSA9PT0gXCJyZW1vdGFibGVcIjtcbmhhcmRlbihpc1JlbW90YWJsZSk7XG52YXIgYXNzZXJ0Q29weUFycmF5ID0gKGFyciwgb3B0TmFtZU9mQXJyYXkgPSBcIkFsbGVnZWQgYXJyYXlcIikgPT4ge1xuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihhcnIpO1xuICBwYXNzU3R5bGUgPT09IFwiY29weUFycmF5XCIgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKG9wdE5hbWVPZkFycmF5KX0gJHthcnJ9IG11c3QgYmUgYSBwYXNzLWJ5LWNvcHkgYXJyYXksIG5vdCAke3F1b3RlKFxuICAgIHBhc3NTdHlsZVxuICApfWA7XG59O1xuaGFyZGVuKGFzc2VydENvcHlBcnJheSk7XG52YXIgYXNzZXJ0UmVjb3JkID0gKHJlY29yZCwgb3B0TmFtZU9mUmVjb3JkID0gXCJBbGxlZ2VkIHJlY29yZFwiKSA9PiB7XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHJlY29yZCk7XG4gIHBhc3NTdHlsZSA9PT0gXCJjb3B5UmVjb3JkXCIgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKG9wdE5hbWVPZlJlY29yZCl9ICR7cmVjb3JkfSBtdXN0IGJlIGEgcGFzcy1ieS1jb3B5IHJlY29yZCwgbm90ICR7cXVvdGUoXG4gICAgcGFzc1N0eWxlXG4gICl9YDtcbn07XG5oYXJkZW4oYXNzZXJ0UmVjb3JkKTtcbnZhciBhc3NlcnRSZW1vdGFibGUgPSAocmVtb3RhYmxlLCBvcHROYW1lT2ZSZW1vdGFibGUgPSBcIkFsbGVnZWQgcmVtb3RhYmxlXCIpID0+IHtcbiAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocmVtb3RhYmxlKTtcbiAgcGFzc1N0eWxlID09PSBcInJlbW90YWJsZVwiIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShvcHROYW1lT2ZSZW1vdGFibGUpfSAke3JlbW90YWJsZX0gbXVzdCBiZSBhIHJlbW90YWJsZSwgbm90ICR7cXVvdGUoXG4gICAgcGFzc1N0eWxlXG4gICl9YDtcbn07XG5oYXJkZW4oYXNzZXJ0UmVtb3RhYmxlKTtcblxuLy9cbnZhciBoaWRkZW5QcmlvckVycm9yO1xudmFyIGhpZGRlbkN1cnJlbnRUdXJuID0gMDtcbnZhciBoaWRkZW5DdXJyZW50RXZlbnQgPSAwO1xudmFyIFZFUkJPU0UgPSBlbnZpcm9ubWVudE9wdGlvbnNMaXN0SGFzKFwiREVCVUdcIiwgXCJ0cmFjay10dXJuc1wiKTtcbnZhciBFTkFCTEVEID0gZ2V0RW52aXJvbm1lbnRPcHRpb24oXCJUUkFDS19UVVJOU1wiLCBcImRpc2FibGVkXCIsIFtcImVuYWJsZWRcIl0pID09PSBcImVuYWJsZWRcIjtcbnZhciBhZGRSZWplY3Rpb25Ob3RlID0gKGRldGFpbHNOb3RlKSA9PiAocmVhc29uKSA9PiB7XG4gIGlmIChyZWFzb24gaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIGdsb2JhbFRoaXMuYXNzZXJ0Lm5vdGUocmVhc29uLCBkZXRhaWxzTm90ZSk7XG4gIH1cbiAgaWYgKFZFUkJPU0UpIHtcbiAgICBjb25zb2xlLmxvZyhcIlJFSkVDVEVEIGF0IHRvcCBvZiBldmVudCBsb29wXCIsIHJlYXNvbik7XG4gIH1cbn07XG52YXIgd3JhcEZ1bmN0aW9uID0gKGZ1bmMsIHNlbmRpbmdFcnJvciwgWDUpID0+ICguLi5hcmdzKSA9PiB7XG4gIGhpZGRlblByaW9yRXJyb3IgPSBzZW5kaW5nRXJyb3I7XG4gIGhpZGRlbkN1cnJlbnRUdXJuICs9IDE7XG4gIGhpZGRlbkN1cnJlbnRFdmVudCA9IDA7XG4gIHRyeSB7XG4gICAgbGV0IHJlc3VsdDtcbiAgICB0cnkge1xuICAgICAgcmVzdWx0ID0gZnVuYyguLi5hcmdzKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICBnbG9iYWxUaGlzLmFzc2VydC5ub3RlKFxuICAgICAgICAgIGVycixcbiAgICAgICAgICBYNWBUaHJvd24gZnJvbTogJHtoaWRkZW5QcmlvckVycm9yfToke2hpZGRlbkN1cnJlbnRUdXJufS4ke2hpZGRlbkN1cnJlbnRFdmVudH1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAoVkVSQk9TRSkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlRIUk9XTiB0byB0b3Agb2YgZXZlbnQgbG9vcFwiLCBlcnIpO1xuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICBjb25zdCBkZXRhaWxzTm90ZSA9IFg1YFJlamVjdGlvbiBmcm9tOiAke2hpZGRlblByaW9yRXJyb3J9OiR7aGlkZGVuQ3VycmVudFR1cm59LiR7aGlkZGVuQ3VycmVudEV2ZW50fWA7XG4gICAgUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCkuY2F0Y2goYWRkUmVqZWN0aW9uTm90ZShkZXRhaWxzTm90ZSkpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH0gZmluYWxseSB7XG4gICAgaGlkZGVuUHJpb3JFcnJvciA9IHZvaWQgMDtcbiAgfVxufTtcbnZhciB0cmFja1R1cm5zID0gKGZ1bmNzKSA9PiB7XG4gIGlmICghRU5BQkxFRCB8fCB0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gXCJ1bmRlZmluZWRcIiB8fCAhZ2xvYmFsVGhpcy5hc3NlcnQpIHtcbiAgICByZXR1cm4gZnVuY3M7XG4gIH1cbiAgY29uc3QgeyBkZXRhaWxzOiBYNSwgbm90ZTogYW5ub3RhdGVFcnJvciB9ID0gZ2xvYmFsVGhpcy5hc3NlcnQ7XG4gIGhpZGRlbkN1cnJlbnRFdmVudCArPSAxO1xuICBjb25zdCBzZW5kaW5nRXJyb3IgPSBFcnJvcihcbiAgICBgRXZlbnQ6ICR7aGlkZGVuQ3VycmVudFR1cm59LiR7aGlkZGVuQ3VycmVudEV2ZW50fWBcbiAgKTtcbiAgaWYgKGhpZGRlblByaW9yRXJyb3IgIT09IHZvaWQgMCkge1xuICAgIGFubm90YXRlRXJyb3Ioc2VuZGluZ0Vycm9yLCBYNWBDYXVzZWQgYnk6ICR7aGlkZGVuUHJpb3JFcnJvcn1gKTtcbiAgfVxuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICBmdW5jcy5tYXAoKGZ1bmMpID0+IGZ1bmMgJiYgd3JhcEZ1bmN0aW9uKGZ1bmMsIHNlbmRpbmdFcnJvciwgWDUpKVxuICApO1xufTtcblxuLy9cbnZhciB7IGRldGFpbHM6IFgyLCBxdW90ZTogcTQsIEZhaWw6IEZhaWw0LCBlcnJvcjogbWFrZUVycm9yMiB9ID0gYXNzZXJ0O1xudmFyIHsgYXNzaWduLCBmcmVlemU6IGZyZWV6ZTQgfSA9IE9iamVjdDtcbnZhciBvblNlbmQgPSBtYWtlTWVzc2FnZUJyZWFrcG9pbnRUZXN0ZXIoXCJFTkRPX1NFTkRfQlJFQUtQT0lOVFNcIik7XG52YXIgYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlciA9IHtcbiAgc2V0KF90YXJnZXQsIF9wcm9wLCBfdmFsdWUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIGlzRXh0ZW5zaWJsZShfdGFyZ2V0KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBzZXRQcm90b3R5cGVPZihfdGFyZ2V0LCBfdmFsdWUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIGRlbGV0ZVByb3BlcnR5KF90YXJnZXQsIF9wcm9wKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xudmFyIG1ha2VFUHJveHlIYW5kbGVyID0gKHJlY2lwaWVudCwgSGFuZGxlZFByb21pc2UyKSA9PiBoYXJkZW4oe1xuICAuLi5iYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyLFxuICBnZXQ6IChfdGFyZ2V0LCBwcm9wZXJ0eUtleSwgcmVjZWl2ZXIpID0+IHtcbiAgICByZXR1cm4gaGFyZGVuKFxuICAgICAge1xuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICAvL1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgW3Byb3BlcnR5S2V5XSguLi5hcmdzKSB7XG4gICAgICAgICAgaWYgKHRoaXMgIT09IHJlY2VpdmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gSGFuZGxlZFByb21pc2UyLnJlamVjdChcbiAgICAgICAgICAgICAgbWFrZUVycm9yMihcbiAgICAgICAgICAgICAgICBYMmBVbmV4cGVjdGVkIHJlY2VpdmVyIGZvciBcIiR7cTQocHJvcGVydHlLZXkpfVwiIG1ldGhvZCBvZiBFKCR7cTQoXG4gICAgICAgICAgICAgICAgICByZWNpcGllbnRcbiAgICAgICAgICAgICAgICApfSlgXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvblNlbmQgJiYgb25TZW5kLnNob3VsZEJyZWFrcG9pbnQocmVjaXBpZW50LCBwcm9wZXJ0eUtleSkpIHtcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gSGFuZGxlZFByb21pc2UyLmFwcGx5TWV0aG9kKHJlY2lwaWVudCwgcHJvcGVydHlLZXksIGFyZ3MpO1xuICAgICAgICB9XG4gICAgICAgIC8vXG4gICAgICB9W3Byb3BlcnR5S2V5XVxuICAgICk7XG4gIH0sXG4gIGFwcGx5OiAoX3RhcmdldCwgX3RoaXNBcmcsIGFyZ0FycmF5ID0gW10pID0+IHtcbiAgICBpZiAob25TZW5kICYmIG9uU2VuZC5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgdm9pZCAwKSkge1xuICAgICAgZGVidWdnZXI7XG4gICAgfVxuICAgIHJldHVybiBIYW5kbGVkUHJvbWlzZTIuYXBwbHlGdW5jdGlvbihyZWNpcGllbnQsIGFyZ0FycmF5KTtcbiAgfSxcbiAgaGFzOiAoX3RhcmdldCwgX3ApID0+IHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufSk7XG52YXIgbWFrZUVTZW5kT25seVByb3h5SGFuZGxlciA9IChyZWNpcGllbnQsIEhhbmRsZWRQcm9taXNlMikgPT4gaGFyZGVuKHtcbiAgLi4uYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlcixcbiAgZ2V0OiAoX3RhcmdldCwgcHJvcGVydHlLZXksIHJlY2VpdmVyKSA9PiB7XG4gICAgcmV0dXJuIGhhcmRlbihcbiAgICAgIHtcbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgW3Byb3BlcnR5S2V5XSguLi5hcmdzKSB7XG4gICAgICAgICAgdGhpcyA9PT0gcmVjZWl2ZXIgfHwgRmFpbDRgVW5leHBlY3RlZCByZWNlaXZlciBmb3IgXCIke3E0KFxuICAgICAgICAgICAgcHJvcGVydHlLZXlcbiAgICAgICAgICApfVwiIG1ldGhvZCBvZiBFLnNlbmRPbmx5KCR7cTQocmVjaXBpZW50KX0pYDtcbiAgICAgICAgICBpZiAob25TZW5kICYmIG9uU2VuZC5zaG91bGRCcmVha3BvaW50KHJlY2lwaWVudCwgcHJvcGVydHlLZXkpKSB7XG4gICAgICAgICAgICBkZWJ1Z2dlcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgSGFuZGxlZFByb21pc2UyLmFwcGx5TWV0aG9kU2VuZE9ubHkocmVjaXBpZW50LCBwcm9wZXJ0eUtleSwgYXJncyk7XG4gICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgfVxuICAgICAgICAvL1xuICAgICAgfVtwcm9wZXJ0eUtleV1cbiAgICApO1xuICB9LFxuICBhcHBseTogKF90YXJnZXQsIF90aGlzQXJnLCBhcmdzQXJyYXkgPSBbXSkgPT4ge1xuICAgIGlmIChvblNlbmQgJiYgb25TZW5kLnNob3VsZEJyZWFrcG9pbnQocmVjaXBpZW50LCB2b2lkIDApKSB7XG4gICAgICBkZWJ1Z2dlcjtcbiAgICB9XG4gICAgSGFuZGxlZFByb21pc2UyLmFwcGx5RnVuY3Rpb25TZW5kT25seShyZWNpcGllbnQsIGFyZ3NBcnJheSk7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfSxcbiAgaGFzOiAoX3RhcmdldCwgX3ApID0+IHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufSk7XG52YXIgbWFrZUVHZXRQcm94eUhhbmRsZXIgPSAoeCwgSGFuZGxlZFByb21pc2UyKSA9PiBoYXJkZW4oe1xuICAuLi5iYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyLFxuICBoYXM6IChfdGFyZ2V0LCBfcHJvcCkgPT4gdHJ1ZSxcbiAgZ2V0OiAoX3RhcmdldCwgcHJvcCkgPT4gSGFuZGxlZFByb21pc2UyLmdldCh4LCBwcm9wKVxufSk7XG52YXIgZnVuY1RhcmdldCA9IGZyZWV6ZTQoKCkgPT4ge1xufSk7XG52YXIgb2JqVGFyZ2V0ID0gZnJlZXplNCh7IF9fcHJvdG9fXzogbnVsbCB9KTtcbnZhciBtYWtlRSA9IChIYW5kbGVkUHJvbWlzZTIpID0+IHtcbiAgcmV0dXJuIGhhcmRlbihcbiAgICBhc3NpZ24oXG4gICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICAvL1xuICAgICAgKHgpID0+IG5ldyBQcm94eShmdW5jVGFyZ2V0LCBtYWtlRVByb3h5SGFuZGxlcih4LCBIYW5kbGVkUHJvbWlzZTIpKSxcbiAgICAgIHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIC8vXG4gICAgICAgIGdldDogKHgpID0+IG5ldyBQcm94eShvYmpUYXJnZXQsIG1ha2VFR2V0UHJveHlIYW5kbGVyKHgsIEhhbmRsZWRQcm9taXNlMikpLFxuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICByZXNvbHZlOiBIYW5kbGVkUHJvbWlzZTIucmVzb2x2ZSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZE9ubHk6ICh4KSA9PiAoXG4gICAgICAgICAgLy9cbiAgICAgICAgICBuZXcgUHJveHkoZnVuY1RhcmdldCwgbWFrZUVTZW5kT25seVByb3h5SGFuZGxlcih4LCBIYW5kbGVkUHJvbWlzZTIpKVxuICAgICAgICApLFxuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICB3aGVuOiAoeCwgb25mdWxmaWxsZWQsIG9ucmVqZWN0ZWQpID0+IEhhbmRsZWRQcm9taXNlMi5yZXNvbHZlKHgpLnRoZW4oXG4gICAgICAgICAgLi4udHJhY2tUdXJucyhbb25mdWxmaWxsZWQsIG9ucmVqZWN0ZWRdKVxuICAgICAgICApXG4gICAgICB9XG4gICAgKVxuICApO1xufTtcbnZhciBFX2RlZmF1bHQgPSBtYWtlRTtcblxuLy9cbnZhciBocCA9IEhhbmRsZWRQcm9taXNlO1xudmFyIEUgPSBFX2RlZmF1bHQoaHApO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czkgfSA9IFJlZmxlY3Q7XG52YXIgeyBmcm9tRW50cmllcyB9ID0gT2JqZWN0O1xudmFyIGRlZXBseUZ1bGZpbGxlZCA9IGFzeW5jICh2YWwpID0+IHtcbiAgaWYgKCFpc09iamVjdDIodmFsKSkge1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICB2YWxcbiAgICApO1xuICB9XG4gIGlmIChpc1Byb21pc2UodmFsKSkge1xuICAgIHJldHVybiBFLndoZW4odmFsLCAobm9ucCkgPT4gZGVlcGx5RnVsZmlsbGVkKG5vbnApKTtcbiAgfVxuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZih2YWwpO1xuICBzd2l0Y2ggKHBhc3NTdHlsZSkge1xuICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgIGNvbnN0IHJlYyA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB2YWxcbiAgICAgICk7XG4gICAgICBjb25zdCBuYW1lcyA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb3duS2V5czkocmVjKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHZhbFBzID0gbmFtZXMubWFwKChuYW1lKSA9PiBkZWVwbHlGdWxmaWxsZWQocmVjW25hbWVdKSk7XG4gICAgICByZXR1cm4gRS53aGVuKFxuICAgICAgICBQcm9taXNlLmFsbCh2YWxQcyksXG4gICAgICAgICh2YWxzKSA9PiBoYXJkZW4oZnJvbUVudHJpZXModmFscy5tYXAoKGMyLCBpMikgPT4gW25hbWVzW2kyXSwgYzJdKSkpXG4gICAgICApO1xuICAgIH1cbiAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgIGNvbnN0IGFyciA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZhbFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHZhbFBzID0gYXJyLm1hcCgocDMpID0+IGRlZXBseUZ1bGZpbGxlZChwMykpO1xuICAgICAgcmV0dXJuIEUud2hlbihQcm9taXNlLmFsbCh2YWxQcyksICh2YWxzKSA9PiBoYXJkZW4odmFscykpO1xuICAgIH1cbiAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgIGNvbnN0IHRnZCA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB2YWxcbiAgICAgICk7XG4gICAgICBjb25zdCB0YWcgPSBnZXRUYWcodGdkKTtcbiAgICAgIHJldHVybiBFLndoZW4oXG4gICAgICAgIGRlZXBseUZ1bGZpbGxlZCh0Z2QucGF5bG9hZCksXG4gICAgICAgIChwYXlsb2FkKSA9PiBtYWtlVGFnZ2VkKHRhZywgcGF5bG9hZClcbiAgICAgICk7XG4gICAgfVxuICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgY29uc3QgcmVtID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApO1xuICAgICAgcmV0dXJuIHJlbTtcbiAgICB9XG4gICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgIGNvbnN0IGVyciA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdmFsXG4gICAgICApO1xuICAgICAgcmV0dXJuIGVycjtcbiAgICB9XG4gICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgY29uc3QgcHJvbSA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZhbFxuICAgICAgKTtcbiAgICAgIHJldHVybiBFLndoZW4ocHJvbSwgKG5vbnApID0+IGRlZXBseUZ1bGZpbGxlZChub25wKSk7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHRocm93IGFzc2VydC5mYWlsKHJlZGFjdGVkYFVuZXhwZWN0ZWQgcGFzc1N0eWxlICR7cXVvdGUocGFzc1N0eWxlKX1gLCBUeXBlRXJyb3IpO1xuICAgIH1cbiAgfVxufTtcbmhhcmRlbihkZWVwbHlGdWxmaWxsZWQpO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czEwIH0gPSBSZWZsZWN0O1xudmFyIHsgaXNBcnJheTogaXNBcnJheTQgfSA9IEFycmF5O1xudmFyIHtcbiAgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczYsXG4gIGRlZmluZVByb3BlcnRpZXMsXG4gIGlzLFxuICBlbnRyaWVzOiBlbnRyaWVzMyxcbiAgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMixcbiAgZnJlZXplOiBmcmVlemU1XG59ID0gT2JqZWN0O1xudmFyIFFDTEFTUyA9IFwiQHFjbGFzc1wiO1xudmFyIGhhc1FDbGFzcyA9IChlbmNvZGVkKSA9PiBoYXNPd25Qcm9wZXJ0eU9mKGVuY29kZWQsIFFDTEFTUyk7XG52YXIgcWNsYXNzTWF0Y2hlcyA9IChlbmNvZGVkLCBxY2xhc3MpID0+IGlzT2JqZWN0MihlbmNvZGVkKSAmJiAhaXNBcnJheTQoZW5jb2RlZCkgJiYgaGFzUUNsYXNzKGVuY29kZWQpICYmIGVuY29kZWRbUUNMQVNTXSA9PT0gcWNsYXNzO1xudmFyIGRvbnRFbmNvZGVSZW1vdGFibGVUb0NhcERhdGEgPSAocmVtKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke3JlbX1gO1xudmFyIGRvbnRFbmNvZGVQcm9taXNlVG9DYXBEYXRhID0gKHByb20pID0+IHRocm93UmVkYWN0ZWRgcHJvbWlzZSB1bmV4cGVjdGVkOiAke3Byb219YDtcbnZhciBkb250RW5jb2RlRXJyb3JUb0NhcERhdGEgPSAoZXJyKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIG9iamVjdCB1bmV4cGVjdGVkOiAke2Vycn1gO1xudmFyIG1ha2VFbmNvZGVUb0NhcERhdGEgPSAoZW5jb2RlT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBlbmNvZGVSZW1vdGFibGVUb0NhcERhdGEgPSBkb250RW5jb2RlUmVtb3RhYmxlVG9DYXBEYXRhLFxuICAgIGVuY29kZVByb21pc2VUb0NhcERhdGEgPSBkb250RW5jb2RlUHJvbWlzZVRvQ2FwRGF0YSxcbiAgICBlbmNvZGVFcnJvclRvQ2FwRGF0YSA9IGRvbnRFbmNvZGVFcnJvclRvQ2FwRGF0YVxuICB9ID0gZW5jb2RlT3B0aW9ucztcbiAgY29uc3QgZW5jb2RlVG9DYXBEYXRhUmVjdXIgPSAocGFzc2FibGUpID0+IHtcbiAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihwYXNzYWJsZSk7XG4gICAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICAgIGNhc2UgXCJudWxsXCI6XG4gICAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgIHJldHVybiBwYXNzYWJsZTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjoge1xuICAgICAgICByZXR1cm4geyBbUUNMQVNTXTogXCJ1bmRlZmluZWRcIiB9O1xuICAgICAgfVxuICAgICAgY2FzZSBcIm51bWJlclwiOiB7XG4gICAgICAgIGlmIChOdW1iZXIuaXNOYU4ocGFzc2FibGUpKSB7XG4gICAgICAgICAgcmV0dXJuIHsgW1FDTEFTU106IFwiTmFOXCIgfTtcbiAgICAgICAgfSBlbHNlIGlmIChwYXNzYWJsZSA9PT0gSW5maW5pdHkpIHtcbiAgICAgICAgICByZXR1cm4geyBbUUNMQVNTXTogXCJJbmZpbml0eVwiIH07XG4gICAgICAgIH0gZWxzZSBpZiAocGFzc2FibGUgPT09IC1JbmZpbml0eSkge1xuICAgICAgICAgIHJldHVybiB7IFtRQ0xBU1NdOiBcIi1JbmZpbml0eVwiIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlzKHBhc3NhYmxlLCAtMCkgPyAwIDogcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBbUUNMQVNTXTogXCJiaWdpbnRcIixcbiAgICAgICAgICBkaWdpdHM6IFN0cmluZyhwYXNzYWJsZSlcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgICBhc3NlcnRQYXNzYWJsZVN5bWJvbChwYXNzYWJsZSk7XG4gICAgICAgIGNvbnN0IG5hbWUgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgbmFtZUZvclBhc3NhYmxlU3ltYm9sKHBhc3NhYmxlKVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIFtRQ0xBU1NdOiBcInN5bWJvbFwiLFxuICAgICAgICAgIG5hbWVcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgaWYgKGhhc093blByb3BlcnR5T2YocGFzc2FibGUsIFFDTEFTUykpIHtcbiAgICAgICAgICBjb25zdCB7IFtRQ0xBU1NdOiBxY2xhc3NWYWx1ZSwgLi4ucmVzdCB9ID0gcGFzc2FibGU7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgICAgICAgW1FDTEFTU106IFwiaGlsYmVydFwiLFxuICAgICAgICAgICAgb3JpZ2luYWw6IGVuY29kZVRvQ2FwRGF0YVJlY3VyKHFjbGFzc1ZhbHVlKVxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYgKG93bktleXMxMChyZXN0KS5sZW5ndGggPj0gMSkge1xuICAgICAgICAgICAgcmVzdWx0LnJlc3QgPSBlbmNvZGVUb0NhcERhdGFSZWN1cihmcmVlemU1KHJlc3QpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuYW1lcyA9IG93bktleXMxMChwYXNzYWJsZSkuc29ydCgpO1xuICAgICAgICByZXR1cm4gZnJvbUVudHJpZXMyKFxuICAgICAgICAgIG5hbWVzLm1hcCgobmFtZSkgPT4gW25hbWUsIGVuY29kZVRvQ2FwRGF0YVJlY3VyKHBhc3NhYmxlW25hbWVdKV0pXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgcmV0dXJuIHBhc3NhYmxlLm1hcChlbmNvZGVUb0NhcERhdGFSZWN1cik7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBbUUNMQVNTXTogXCJ0YWdnZWRcIixcbiAgICAgICAgICB0YWc6IGdldFRhZyhwYXNzYWJsZSksXG4gICAgICAgICAgcGF5bG9hZDogZW5jb2RlVG9DYXBEYXRhUmVjdXIocGFzc2FibGUucGF5bG9hZClcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJyZW1vdGFibGVcIjoge1xuICAgICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlUmVtb3RhYmxlVG9DYXBEYXRhKFxuICAgICAgICAgIHBhc3NhYmxlLFxuICAgICAgICAgIGVuY29kZVRvQ2FwRGF0YVJlY3VyXG4gICAgICAgICk7XG4gICAgICAgIGlmIChxY2xhc3NNYXRjaGVzKGVuY29kZWQsIFwic2xvdFwiKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGVkO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFJlbW90YWJsZSBlbmNvZGluZyBtdXN0IGJlIGFuIG9iamVjdCB3aXRoICR7cXVvdGUoXG4gICAgICAgICAgUUNMQVNTXG4gICAgICAgICl9ICR7cXVvdGUoXCJzbG90XCIpfTogJHtlbmNvZGVkfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIGNvbnN0IGVuY29kZWQgPSBlbmNvZGVQcm9taXNlVG9DYXBEYXRhKHBhc3NhYmxlLCBlbmNvZGVUb0NhcERhdGFSZWN1cik7XG4gICAgICAgIGlmIChxY2xhc3NNYXRjaGVzKGVuY29kZWQsIFwic2xvdFwiKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGVkO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFByb21pc2UgZW5jb2RpbmcgbXVzdCBiZSBhbiBvYmplY3Qgd2l0aCAke3F1b3RlKFxuICAgICAgICAgIFFDTEFTUyxcbiAgICAgICAgICBcInNsb3RcIlxuICAgICAgICApfTogJHtlbmNvZGVkfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlRXJyb3JUb0NhcERhdGEocGFzc2FibGUsIGVuY29kZVRvQ2FwRGF0YVJlY3VyKTtcbiAgICAgICAgaWYgKHFjbGFzc01hdGNoZXMoZW5jb2RlZCwgXCJlcnJvclwiKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGVkO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IEVycm9yIGVuY29kaW5nIG11c3QgYmUgYW4gb2JqZWN0IHdpdGggJHtxdW90ZShcbiAgICAgICAgICBRQ0xBU1MsXG4gICAgICAgICAgXCJlcnJvclwiXG4gICAgICAgICl9OiAke2VuY29kZWR9YDtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgcmVkYWN0ZWRgaW50ZXJuYWw6IFVucmVjb2duaXplZCBwYXNzU3R5bGUgJHtxdW90ZShwYXNzU3R5bGUpfWAsXG4gICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBlbmNvZGVUb0NhcERhdGEgPSAocGFzc2FibGUpID0+IHtcbiAgICBpZiAoaXNFcnJvckxpa2UocGFzc2FibGUpKSB7XG4gICAgICByZXR1cm4gaGFyZGVuKGVuY29kZUVycm9yVG9DYXBEYXRhKHBhc3NhYmxlLCBlbmNvZGVUb0NhcERhdGFSZWN1cikpO1xuICAgIH1cbiAgICByZXR1cm4gaGFyZGVuKGVuY29kZVRvQ2FwRGF0YVJlY3VyKHBhc3NhYmxlKSk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oZW5jb2RlVG9DYXBEYXRhKTtcbn07XG5oYXJkZW4obWFrZUVuY29kZVRvQ2FwRGF0YSk7XG52YXIgZG9udERlY29kZVJlbW90YWJsZU9yUHJvbWlzZUZyb21DYXBEYXRhID0gKHNsb3RFbmNvZGluZykgPT4gdGhyb3dSZWRhY3RlZGByZW1vdGFibGUgb3IgcHJvbWlzZSB1bmV4cGVjdGVkOiAke3Nsb3RFbmNvZGluZ31gO1xudmFyIGRvbnREZWNvZGVFcnJvckZyb21DYXBEYXRhID0gKGVycm9yRW5jb2RpbmcpID0+IHRocm93UmVkYWN0ZWRgZXJyb3IgdW5leHBlY3RlZDogJHtlcnJvckVuY29kaW5nfWA7XG52YXIgbWFrZURlY29kZUZyb21DYXBEYXRhID0gKGRlY29kZU9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgZGVjb2RlUmVtb3RhYmxlRnJvbUNhcERhdGEgPSBkb250RGVjb2RlUmVtb3RhYmxlT3JQcm9taXNlRnJvbUNhcERhdGEsXG4gICAgZGVjb2RlUHJvbWlzZUZyb21DYXBEYXRhID0gZG9udERlY29kZVJlbW90YWJsZU9yUHJvbWlzZUZyb21DYXBEYXRhLFxuICAgIGRlY29kZUVycm9yRnJvbUNhcERhdGEgPSBkb250RGVjb2RlRXJyb3JGcm9tQ2FwRGF0YVxuICB9ID0gZGVjb2RlT3B0aW9ucztcbiAgZGVjb2RlUmVtb3RhYmxlRnJvbUNhcERhdGEgPT09IGRlY29kZVByb21pc2VGcm9tQ2FwRGF0YSB8fCB0aHJvd1JlZGFjdGVkYEFuIGltcGxlbWVudGF0aW9uIHJlc3RyaWN0aW9uIGZvciBub3c6IElmIGVpdGhlciBkZWNvZGVSZW1vdGFibGVGcm9tQ2FwRGF0YSBvciBkZWNvZGVQcm9taXNlRnJvbUNhcERhdGEgaXMgcHJvdmlkZWQsIGJvdGggbXVzdCBiZSBwcm92aWRlZCBhbmQgdGhleSBtdXN0IGJlIHRoZSBzYW1lOiAke3F1b3RlKFxuICAgIGRlY29kZVJlbW90YWJsZUZyb21DYXBEYXRhXG4gICl9IHZzICR7cXVvdGUoZGVjb2RlUHJvbWlzZUZyb21DYXBEYXRhKX1gO1xuICBjb25zdCBkZWNvZGVGcm9tQ2FwRGF0YSA9IChqc29uRW5jb2RlZCkgPT4ge1xuICAgIGlmICghaXNPYmplY3QyKGpzb25FbmNvZGVkKSkge1xuICAgICAgcmV0dXJuIGpzb25FbmNvZGVkO1xuICAgIH1cbiAgICBpZiAoaXNBcnJheTQoanNvbkVuY29kZWQpKSB7XG4gICAgICByZXR1cm4ganNvbkVuY29kZWQubWFwKChlbmNvZGVkVmFsKSA9PiBkZWNvZGVGcm9tQ2FwRGF0YShlbmNvZGVkVmFsKSk7XG4gICAgfSBlbHNlIGlmIChoYXNRQ2xhc3MoanNvbkVuY29kZWQpKSB7XG4gICAgICBjb25zdCBxY2xhc3MgPSBqc29uRW5jb2RlZFtRQ0xBU1NdO1xuICAgICAgdHlwZW9mIHFjbGFzcyA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGludmFsaWQgJHtxdW90ZShRQ0xBU1MpfSB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgcWNsYXNzKX1gO1xuICAgICAgc3dpdGNoIChxY2xhc3MpIHtcbiAgICAgICAgLy9cbiAgICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOiB7XG4gICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiTmFOXCI6IHtcbiAgICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJJbmZpbml0eVwiOiB7XG4gICAgICAgICAgcmV0dXJuIEluZmluaXR5O1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCItSW5maW5pdHlcIjoge1xuICAgICAgICAgIHJldHVybiAtSW5maW5pdHk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImJpZ2ludFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBkaWdpdHMgfSA9IGpzb25FbmNvZGVkO1xuICAgICAgICAgIHR5cGVvZiBkaWdpdHMgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGRpZ2l0cyB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgZGlnaXRzKX1gO1xuICAgICAgICAgIHJldHVybiBCaWdJbnQoZGlnaXRzKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiQEBhc3luY0l0ZXJhdG9yXCI6IHtcbiAgICAgICAgICByZXR1cm4gU3ltYm9sLmFzeW5jSXRlcmF0b3I7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSBqc29uRW5jb2RlZDtcbiAgICAgICAgICByZXR1cm4gcGFzc2FibGVTeW1ib2xGb3JOYW1lKG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgdGFnLCBwYXlsb2FkIH0gPSBqc29uRW5jb2RlZDtcbiAgICAgICAgICByZXR1cm4gbWFrZVRhZ2dlZCh0YWcsIGRlY29kZUZyb21DYXBEYXRhKHBheWxvYWQpKTtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwic2xvdFwiOiB7XG4gICAgICAgICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZVJlbW90YWJsZUZyb21DYXBEYXRhKFxuICAgICAgICAgICAganNvbkVuY29kZWQsXG4gICAgICAgICAgICBkZWNvZGVGcm9tQ2FwRGF0YVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGRlY29kZWQ7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgICBjb25zdCBkZWNvZGVkID0gZGVjb2RlRXJyb3JGcm9tQ2FwRGF0YShcbiAgICAgICAgICAgIGpzb25FbmNvZGVkLFxuICAgICAgICAgICAgZGVjb2RlRnJvbUNhcERhdGFcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChwYXNzU3R5bGVPZihkZWNvZGVkKSA9PT0gXCJlcnJvclwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZGVjb2RlZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogZGVjb2RlRXJyb3JGcm9tQ2FwRGF0YSBvcHRpb24gbXVzdCByZXR1cm4gYW4gZXJyb3I6ICR7ZGVjb2RlZH1gO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJoaWxiZXJ0XCI6IHtcbiAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsLCByZXN0IH0gPSBqc29uRW5jb2RlZDtcbiAgICAgICAgICBoYXNPd25Qcm9wZXJ0eU9mKGpzb25FbmNvZGVkLCBcIm9yaWdpbmFsXCIpIHx8IHRocm93UmVkYWN0ZWRgSW52YWxpZCBIaWxiZXJ0IEhvdGVsIGVuY29kaW5nICR7anNvbkVuY29kZWR9YDtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSB7IFtRQ0xBU1NdOiBkZWNvZGVGcm9tQ2FwRGF0YShvcmlnaW5hbCkgfTtcbiAgICAgICAgICBpZiAoaGFzT3duUHJvcGVydHlPZihqc29uRW5jb2RlZCwgXCJyZXN0XCIpKSB7XG4gICAgICAgICAgICBjb25zdCBpc05vbkVtcHR5T2JqZWN0ID0gdHlwZW9mIHJlc3QgPT09IFwib2JqZWN0XCIgJiYgcmVzdCAhPT0gbnVsbCAmJiBvd25LZXlzMTAocmVzdCkubGVuZ3RoID49IDE7XG4gICAgICAgICAgICBpZiAoIWlzTm9uRW1wdHlPYmplY3QpIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN0IGVuY29kaW5nIG11c3QgYmUgYSBub24tZW1wdHkgb2JqZWN0OiAke3Jlc3R9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3RPYmogPSBkZWNvZGVGcm9tQ2FwRGF0YShyZXN0KTtcbiAgICAgICAgICAgICFoYXNPd25Qcm9wZXJ0eU9mKHJlc3RPYmosIFFDTEFTUykgfHwgdGhyb3dSZWRhY3RlZGBSZXN0IG11c3Qgbm90IGNvbnRhaW4gaXRzIG93biBkZWZpbml0aW9uIG9mICR7cXVvdGUoUUNMQVNTKX1gO1xuICAgICAgICAgICAgZGVmaW5lUHJvcGVydGllcyhyZXN1bHQsIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM2KHJlc3RPYmopKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICAvL1xuICAgICAgICBjYXNlIFwiaWJpZFwiOiB7XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBUaGUgY2FwRGF0YSBwcm90b2NvbCBubyBsb25nZXIgc3VwcG9ydHMgJHtxdW90ZShRQ0xBU1MpfSAke3F1b3RlKFxuICAgICAgICAgICAgcWNsYXNzXG4gICAgICAgICAgKX1gO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICB0aHJvdyBhc3NlcnQuZmFpbChcbiAgICAgICAgICAgIHJlZGFjdGVkYHVucmVjb2duaXplZCAke3F1b3RlKFFDTEFTUyl9ICR7cXVvdGUocWNsYXNzKX1gLFxuICAgICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBhc3NlcnQodHlwZW9mIGpzb25FbmNvZGVkID09PSBcIm9iamVjdFwiICYmIGpzb25FbmNvZGVkICE9PSBudWxsKTtcbiAgICAgIGNvbnN0IGRlY29kZUVudHJ5ID0gKFtuYW1lLCBlbmNvZGVkVmFsXSkgPT4ge1xuICAgICAgICB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYFByb3BlcnR5ICR7cXVvdGUobmFtZSl9IG9mICR7anNvbkVuY29kZWR9IG11c3QgYmUgYSBzdHJpbmdgO1xuICAgICAgICByZXR1cm4gW25hbWUsIGRlY29kZUZyb21DYXBEYXRhKGVuY29kZWRWYWwpXTtcbiAgICAgIH07XG4gICAgICBjb25zdCBkZWNvZGVkRW50cmllcyA9IGVudHJpZXMzKGpzb25FbmNvZGVkKS5tYXAoZGVjb2RlRW50cnkpO1xuICAgICAgcmV0dXJuIGZyb21FbnRyaWVzMihkZWNvZGVkRW50cmllcyk7XG4gICAgfVxuICB9O1xuICByZXR1cm4gaGFyZGVuKGRlY29kZUZyb21DYXBEYXRhKTtcbn07XG5cbi8vXG5mdW5jdGlvbiBpc05hdChhbGxlZ2VkTnVtKSB7XG4gIGlmICh0eXBlb2YgYWxsZWdlZE51bSA9PT0gXCJiaWdpbnRcIikge1xuICAgIHJldHVybiBhbGxlZ2VkTnVtID49IDA7XG4gIH1cbiAgaWYgKHR5cGVvZiBhbGxlZ2VkTnVtICE9PSBcIm51bWJlclwiKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHJldHVybiBOdW1iZXIuaXNTYWZlSW50ZWdlcihhbGxlZ2VkTnVtKSAmJiBhbGxlZ2VkTnVtID49IDA7XG59XG5mdW5jdGlvbiBOYXQoYWxsZWdlZE51bSkge1xuICBpZiAodHlwZW9mIGFsbGVnZWROdW0gPT09IFwiYmlnaW50XCIpIHtcbiAgICBpZiAoYWxsZWdlZE51bSA8IDBuKSB7XG4gICAgICB0aHJvdyBSYW5nZUVycm9yKGAke2FsbGVnZWROdW19IGlzIG5lZ2F0aXZlYCk7XG4gICAgfVxuICAgIHJldHVybiBhbGxlZ2VkTnVtO1xuICB9XG4gIGlmICh0eXBlb2YgYWxsZWdlZE51bSA9PT0gXCJudW1iZXJcIikge1xuICAgIGlmICghTnVtYmVyLmlzU2FmZUludGVnZXIoYWxsZWdlZE51bSkpIHtcbiAgICAgIHRocm93IFJhbmdlRXJyb3IoYCR7YWxsZWdlZE51bX0gaXMgbm90IGEgc2FmZSBpbnRlZ2VyYCk7XG4gICAgfVxuICAgIGlmIChhbGxlZ2VkTnVtIDwgMCkge1xuICAgICAgdGhyb3cgUmFuZ2VFcnJvcihgJHthbGxlZ2VkTnVtfSBpcyBuZWdhdGl2ZWApO1xuICAgIH1cbiAgICByZXR1cm4gQmlnSW50KGFsbGVnZWROdW0pO1xuICB9XG4gIHRocm93IFR5cGVFcnJvcihcbiAgICBgJHthbGxlZ2VkTnVtfSBpcyBhICR7dHlwZW9mIGFsbGVnZWROdW19IGJ1dCBtdXN0IGJlIGEgYmlnaW50IG9yIGEgbnVtYmVyYFxuICApO1xufVxuXG4vL1xudmFyIHsgZW50cmllczogZW50cmllczQsIGZyb21FbnRyaWVzOiBmcm9tRW50cmllczMgfSA9IE9iamVjdDtcbnZhciBvYmplY3RNYXAgPSAob3JpZ2luYWwsIG1hcEZuKSA9PiB7XG4gIGNvbnN0IGVudHMgPSBlbnRyaWVzNChvcmlnaW5hbCk7XG4gIGNvbnN0IG1hcEVudHMgPSBlbnRzLm1hcChcbiAgICAoW2ssIHYzXSkgPT4gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBbaywgbWFwRm4odjMsIGspXVxuICAgIClcbiAgKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBoYXJkZW4oZnJvbUVudHJpZXMzKG1hcEVudHMpKVxuICApO1xufTtcbmhhcmRlbihvYmplY3RNYXApO1xuXG4vL1xudmFyIHsgb3duS2V5czogb3duS2V5czExIH0gPSBSZWZsZWN0O1xudmFyIHsgaXNBcnJheTogaXNBcnJheTUgfSA9IEFycmF5O1xudmFyIHsgaXM6IGlzMiwgZW50cmllczogZW50cmllczUsIGZyb21FbnRyaWVzOiBmcm9tRW50cmllczQgfSA9IE9iamVjdDtcbnZhciBCQU5HID0gXCIhXCIuY2hhckNvZGVBdCgwKTtcbnZhciBEQVNIID0gXCItXCIuY2hhckNvZGVBdCgwKTtcbnZhciBzdGFydHNTcGVjaWFsID0gKGVuY29kZWRTdHIpID0+IHtcbiAgaWYgKGVuY29kZWRTdHIgPT09IFwiXCIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29uc3QgY29kZSA9IGVuY29kZWRTdHIuY2hhckNvZGVBdCgwKTtcbiAgcmV0dXJuIEJBTkcgPD0gY29kZSAmJiBjb2RlIDw9IERBU0g7XG59O1xudmFyIGRvbnRFbmNvZGVSZW1vdGFibGVUb1NtYWxsY2FwcyA9IChyZW0pID0+IHRocm93UmVkYWN0ZWRgcmVtb3RhYmxlIHVuZXhwZWN0ZWQ6ICR7cmVtfWA7XG52YXIgZG9udEVuY29kZVByb21pc2VUb1NtYWxsY2FwcyA9IChwcm9tKSA9PiB0aHJvd1JlZGFjdGVkYHByb21pc2UgdW5leHBlY3RlZDogJHtwcm9tfWA7XG52YXIgZG9udEVuY29kZUVycm9yVG9TbWFsbGNhcHMgPSAoZXJyKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIG9iamVjdCB1bmV4cGVjdGVkOiAke3F1b3RlKGVycil9YDtcbnZhciBtYWtlRW5jb2RlVG9TbWFsbGNhcHMgPSAoZW5jb2RlT3B0aW9ucyA9IHt9KSA9PiB7XG4gIGNvbnN0IHtcbiAgICBlbmNvZGVSZW1vdGFibGVUb1NtYWxsY2FwcyA9IGRvbnRFbmNvZGVSZW1vdGFibGVUb1NtYWxsY2FwcyxcbiAgICBlbmNvZGVQcm9taXNlVG9TbWFsbGNhcHMgPSBkb250RW5jb2RlUHJvbWlzZVRvU21hbGxjYXBzLFxuICAgIGVuY29kZUVycm9yVG9TbWFsbGNhcHMgPSBkb250RW5jb2RlRXJyb3JUb1NtYWxsY2Fwc1xuICB9ID0gZW5jb2RlT3B0aW9ucztcbiAgY29uc3QgYXNzZXJ0RW5jb2RlZEVycm9yID0gKGVuY29kaW5nKSA9PiB7XG4gICAgdHlwZW9mIGVuY29kaW5nID09PSBcIm9iamVjdFwiICYmIGhhc093blByb3BlcnR5T2YoZW5jb2RpbmcsIFwiI2Vycm9yXCIpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IEVycm9yIGVuY29kaW5nIG11c3QgaGF2ZSBcIiNlcnJvclwiIHByb3BlcnR5OiAke3F1b3RlKFxuICAgICAgZW5jb2RpbmdcbiAgICApfWA7XG4gICAgY29uc3QgbWVzc2FnZSA9IGVuY29kaW5nW1wiI2Vycm9yXCJdO1xuICAgIHR5cGVvZiBtZXNzYWdlID09PSBcInN0cmluZ1wiICYmICghc3RhcnRzU3BlY2lhbChtZXNzYWdlKSB8fCBtZXNzYWdlLmNoYXJBdCgwKSA9PT0gXCIhXCIpIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IEVycm9yIGVuY29kaW5nIG11c3QgaGF2ZSBzdHJpbmcgbWVzc2FnZTogJHtxdW90ZShtZXNzYWdlKX1gO1xuICB9O1xuICBjb25zdCBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyID0gKHBhc3NhYmxlKSA9PiB7XG4gICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2YocGFzc2FibGUpO1xuICAgIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgICBjYXNlIFwibnVsbFwiOlxuICAgICAgY2FzZSBcImJvb2xlYW5cIjoge1xuICAgICAgICByZXR1cm4gcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwic3RyaW5nXCI6IHtcbiAgICAgICAgaWYgKHN0YXJ0c1NwZWNpYWwocGFzc2FibGUpKSB7XG4gICAgICAgICAgcmV0dXJuIGAhJHtwYXNzYWJsZX1gO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXNzYWJsZTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjoge1xuICAgICAgICByZXR1cm4gXCIjdW5kZWZpbmVkXCI7XG4gICAgICB9XG4gICAgICBjYXNlIFwibnVtYmVyXCI6IHtcbiAgICAgICAgaWYgKE51bWJlci5pc05hTihwYXNzYWJsZSkpIHtcbiAgICAgICAgICByZXR1cm4gXCIjTmFOXCI7XG4gICAgICAgIH0gZWxzZSBpZiAocGFzc2FibGUgPT09IEluZmluaXR5KSB7XG4gICAgICAgICAgcmV0dXJuIFwiI0luZmluaXR5XCI7XG4gICAgICAgIH0gZWxzZSBpZiAocGFzc2FibGUgPT09IC1JbmZpbml0eSkge1xuICAgICAgICAgIHJldHVybiBcIiMtSW5maW5pdHlcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXMyKHBhc3NhYmxlLCAtMCkgPyAwIDogcGFzc2FibGU7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgY29uc3Qgc3RyID0gU3RyaW5nKHBhc3NhYmxlKTtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBwYXNzYWJsZSA8IDBuID8gc3RyIDogYCske3N0cn1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgYXNzZXJ0UGFzc2FibGVTeW1ib2wocGFzc2FibGUpO1xuICAgICAgICBjb25zdCBuYW1lID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG5hbWVGb3JQYXNzYWJsZVN5bWJvbChwYXNzYWJsZSlcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIGAlJHtuYW1lfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGNvbnN0IG5hbWVzID0gb3duS2V5czExKHBhc3NhYmxlKS5zb3J0KCk7XG4gICAgICAgIHJldHVybiBmcm9tRW50cmllczQoXG4gICAgICAgICAgbmFtZXMubWFwKChuYW1lKSA9PiBbXG4gICAgICAgICAgICBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKG5hbWUpLFxuICAgICAgICAgICAgZW5jb2RlVG9TbWFsbGNhcHNSZWN1cihwYXNzYWJsZVtuYW1lXSlcbiAgICAgICAgICBdKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIHJldHVybiBwYXNzYWJsZS5tYXAoZW5jb2RlVG9TbWFsbGNhcHNSZWN1cik7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBcIiN0YWdcIjogZW5jb2RlVG9TbWFsbGNhcHNSZWN1cihnZXRUYWcocGFzc2FibGUpKSxcbiAgICAgICAgICBwYXlsb2FkOiBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKHBhc3NhYmxlLnBheWxvYWQpXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMoXG4gICAgICAgICAgcGFzc2FibGUsXG4gICAgICAgICAgZW5jb2RlVG9TbWFsbGNhcHNSZWN1clxuICAgICAgICApO1xuICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gXCJzdHJpbmdcIiAmJiByZXN1bHQuY2hhckF0KDApID09PSBcIiRcIikge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogUmVtb3RhYmxlIGVuY29kaW5nIG11c3Qgc3RhcnQgd2l0aCBcIiRcIjogJHtyZXN1bHR9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZW5jb2RlUHJvbWlzZVRvU21hbGxjYXBzKFxuICAgICAgICAgIHBhc3NhYmxlLFxuICAgICAgICAgIGVuY29kZVRvU21hbGxjYXBzUmVjdXJcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKHR5cGVvZiByZXN1bHQgPT09IFwic3RyaW5nXCIgJiYgcmVzdWx0LmNoYXJBdCgwKSA9PT0gXCImXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFByb21pc2UgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiJlwiOiAke3Jlc3VsdH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gZW5jb2RlRXJyb3JUb1NtYWxsY2FwcyhwYXNzYWJsZSwgZW5jb2RlVG9TbWFsbGNhcHNSZWN1cik7XG4gICAgICAgIGFzc2VydEVuY29kZWRFcnJvcihyZXN1bHQpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyBhc3NlcnQuZmFpbChcbiAgICAgICAgICByZWRhY3RlZGBpbnRlcm5hbDogVW5yZWNvZ25pemVkIHBhc3NTdHlsZSAke3F1b3RlKHBhc3NTdHlsZSl9YCxcbiAgICAgICAgICBUeXBlRXJyb3JcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IGVuY29kZVRvU21hbGxjYXBzID0gKHBhc3NhYmxlKSA9PiB7XG4gICAgaWYgKGlzRXJyb3JMaWtlKHBhc3NhYmxlKSkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gaGFyZGVuKFxuICAgICAgICBlbmNvZGVFcnJvclRvU21hbGxjYXBzKHBhc3NhYmxlLCBlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKVxuICAgICAgKTtcbiAgICAgIGFzc2VydEVuY29kZWRFcnJvcihyZXN1bHQpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbihlbmNvZGVUb1NtYWxsY2Fwc1JlY3VyKHBhc3NhYmxlKSk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oZW5jb2RlVG9TbWFsbGNhcHMpO1xufTtcbmhhcmRlbihtYWtlRW5jb2RlVG9TbWFsbGNhcHMpO1xudmFyIGRvbnREZWNvZGVSZW1vdGFibGVGcm9tU21hbGxjYXBzID0gKGVuY29kaW5nKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke2VuY29kaW5nfWA7XG52YXIgZG9udERlY29kZVByb21pc2VGcm9tU21hbGxjYXBzID0gKGVuY29kaW5nKSA9PiB0aHJvd1JlZGFjdGVkYHByb21pc2UgdW5leHBlY3RlZDogJHtlbmNvZGluZ31gO1xudmFyIGRvbnREZWNvZGVFcnJvckZyb21TbWFsbGNhcHMgPSAoZW5jb2RpbmcpID0+IHRocm93UmVkYWN0ZWRgZXJyb3IgdW5leHBlY3RlZDogJHtxdW90ZShlbmNvZGluZyl9YDtcbnZhciBtYWtlRGVjb2RlRnJvbVNtYWxsY2FwcyA9IChkZWNvZGVPcHRpb25zID0ge30pID0+IHtcbiAgY29uc3Qge1xuICAgIGRlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMgPSBkb250RGVjb2RlUmVtb3RhYmxlRnJvbVNtYWxsY2FwcyxcbiAgICBkZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyA9IGRvbnREZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyxcbiAgICBkZWNvZGVFcnJvckZyb21TbWFsbGNhcHMgPSBkb250RGVjb2RlRXJyb3JGcm9tU21hbGxjYXBzXG4gIH0gPSBkZWNvZGVPcHRpb25zO1xuICBjb25zdCBkZWNvZGVGcm9tU21hbGxjYXBzID0gKGVuY29kaW5nKSA9PiB7XG4gICAgc3dpdGNoICh0eXBlb2YgZW5jb2RpbmcpIHtcbiAgICAgIGNhc2UgXCJib29sZWFuXCI6XG4gICAgICBjYXNlIFwibnVtYmVyXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kaW5nO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgIGlmICghc3RhcnRzU3BlY2lhbChlbmNvZGluZykpIHtcbiAgICAgICAgICByZXR1cm4gZW5jb2Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYzIgPSBlbmNvZGluZy5jaGFyQXQoMCk7XG4gICAgICAgIHN3aXRjaCAoYzIpIHtcbiAgICAgICAgICBjYXNlIFwiIVwiOiB7XG4gICAgICAgICAgICByZXR1cm4gZW5jb2Rpbmcuc2xpY2UoMSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgXCIlXCI6IHtcbiAgICAgICAgICAgIHJldHVybiBwYXNzYWJsZVN5bWJvbEZvck5hbWUoZW5jb2Rpbmcuc2xpY2UoMSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiI1wiOiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGVuY29kaW5nKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCIjdW5kZWZpbmVkXCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNhc2UgXCIjTmFOXCI6IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNhc2UgXCIjSW5maW5pdHlcIjoge1xuICAgICAgICAgICAgICAgIHJldHVybiBJbmZpbml0eTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjYXNlIFwiIy1JbmZpbml0eVwiOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC1JbmZpbml0eTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgICAgICAgICByZWRhY3RlZGB1bmtub3duIGNvbnN0YW50IFwiJHtxdW90ZShlbmNvZGluZyl9XCJgLFxuICAgICAgICAgICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiK1wiOlxuICAgICAgICAgIGNhc2UgXCItXCI6IHtcbiAgICAgICAgICAgIHJldHVybiBCaWdJbnQoZW5jb2RpbmcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXNlIFwiJFwiOiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBkZWNvZGVSZW1vdGFibGVGcm9tU21hbGxjYXBzKFxuICAgICAgICAgICAgICBlbmNvZGluZyxcbiAgICAgICAgICAgICAgZGVjb2RlRnJvbVNtYWxsY2Fwc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChwYXNzU3R5bGVPZihyZXN1bHQpICE9PSBcInJlbW90YWJsZVwiKSB7XG4gICAgICAgICAgICAgIHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGRlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMgb3B0aW9uIG11c3QgcmV0dXJuIGEgcmVtb3RhYmxlOiAke3Jlc3VsdH1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FzZSBcIiZcIjoge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZGVjb2RlUHJvbWlzZUZyb21TbWFsbGNhcHMoXG4gICAgICAgICAgICAgIGVuY29kaW5nLFxuICAgICAgICAgICAgICBkZWNvZGVGcm9tU21hbGxjYXBzXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKHBhc3NTdHlsZU9mKHJlc3VsdCkgIT09IFwicHJvbWlzZVwiKSB7XG4gICAgICAgICAgICAgIHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGRlY29kZVByb21pc2VGcm9tU21hbGxjYXBzIG9wdGlvbiBtdXN0IHJldHVybiBhIHByb21pc2U6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgIH1cbiAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFNwZWNpYWwgY2hhciAke3F1b3RlKFxuICAgICAgICAgICAgICBjMlxuICAgICAgICAgICAgKX0gcmVzZXJ2ZWQgZm9yIGZ1dHVyZSB1c2U6ICR7ZW5jb2Rpbmd9YDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNhc2UgXCJvYmplY3RcIjoge1xuICAgICAgICBpZiAoZW5jb2RpbmcgPT09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gZW5jb2Rpbmc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzQXJyYXk1KGVuY29kaW5nKSkge1xuICAgICAgICAgIHJldHVybiBlbmNvZGluZy5tYXAoKHZhbCkgPT4gZGVjb2RlRnJvbVNtYWxsY2Fwcyh2YWwpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGFzT3duUHJvcGVydHlPZihlbmNvZGluZywgXCIjdGFnXCIpKSB7XG4gICAgICAgICAgY29uc3QgeyBcIiN0YWdcIjogdGFnLCBwYXlsb2FkLCAuLi5yZXN0IH0gPSBlbmNvZGluZztcbiAgICAgICAgICB0eXBlb2YgdGFnID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgVmFsdWUgb2YgXCIjdGFnXCIsIHRoZSB0YWcsIG11c3QgYmUgYSBzdHJpbmc6ICR7ZW5jb2Rpbmd9YDtcbiAgICAgICAgICBvd25LZXlzMTEocmVzdCkubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgI3RhZyByZWNvcmQgdW5leHBlY3RlZCBwcm9wZXJ0aWVzOiAke3F1b3RlKG93bktleXMxMShyZXN0KSl9YDtcbiAgICAgICAgICByZXR1cm4gbWFrZVRhZ2dlZChcbiAgICAgICAgICAgIGRlY29kZUZyb21TbWFsbGNhcHModGFnKSxcbiAgICAgICAgICAgIGRlY29kZUZyb21TbWFsbGNhcHMocGF5bG9hZClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNPd25Qcm9wZXJ0eU9mKGVuY29kaW5nLCBcIiNlcnJvclwiKSkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGRlY29kZUVycm9yRnJvbVNtYWxsY2FwcyhcbiAgICAgICAgICAgIGVuY29kaW5nLFxuICAgICAgICAgICAgZGVjb2RlRnJvbVNtYWxsY2Fwc1xuICAgICAgICAgICk7XG4gICAgICAgICAgcGFzc1N0eWxlT2YocmVzdWx0KSA9PT0gXCJlcnJvclwiIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IGRlY29kZUVycm9yRnJvbVNtYWxsY2FwcyBvcHRpb24gbXVzdCByZXR1cm4gYW4gZXJyb3I6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBkZWNvZGVFbnRyeSA9IChbZW5jb2RlZE5hbWUsIGVuY29kZWRWYWxdKSA9PiB7XG4gICAgICAgICAgdHlwZW9mIGVuY29kZWROYW1lID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgUHJvcGVydHkgbmFtZSAke3F1b3RlKFxuICAgICAgICAgICAgZW5jb2RlZE5hbWVcbiAgICAgICAgICApfSBvZiAke2VuY29kaW5nfSBtdXN0IGJlIGEgc3RyaW5nYDtcbiAgICAgICAgICBlbmNvZGVkTmFtZS5jaGFyQXQoMCkgIT09IFwiI1wiIHx8IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIHJlY29yZCB0eXBlICR7cXVvdGUoZW5jb2RlZE5hbWUpfTogJHtlbmNvZGluZ31gO1xuICAgICAgICAgIGNvbnN0IG5hbWUgPSBkZWNvZGVGcm9tU21hbGxjYXBzKGVuY29kZWROYW1lKTtcbiAgICAgICAgICB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYERlY29kZWQgcHJvcGVydHkgbmFtZSAke25hbWV9IGZyb20gJHtlbmNvZGluZ30gbXVzdCBiZSBhIHN0cmluZ2A7XG4gICAgICAgICAgcmV0dXJuIFtuYW1lLCBkZWNvZGVGcm9tU21hbGxjYXBzKGVuY29kZWRWYWwpXTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZGVjb2RlZEVudHJpZXMgPSBlbnRyaWVzNShlbmNvZGluZykubWFwKGRlY29kZUVudHJ5KTtcbiAgICAgICAgcmV0dXJuIGZyb21FbnRyaWVzNChkZWNvZGVkRW50cmllcyk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHRocm93IGFzc2VydC5mYWlsKFxuICAgICAgICAgIHJlZGFjdGVkYGludGVybmFsOiB1bnJlY29nbml6ZWQgSlNPTiB0eXBlb2YgJHtxdW90ZShcbiAgICAgICAgICAgIHR5cGVvZiBlbmNvZGluZ1xuICAgICAgICAgICl9OiAke2VuY29kaW5nfWAsXG4gICAgICAgICAgVHlwZUVycm9yXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gaGFyZGVuKGRlY29kZUZyb21TbWFsbGNhcHMpO1xufTtcblxuLy9cbnZhciB7IGRlZmluZVByb3BlcnRpZXM6IGRlZmluZVByb3BlcnRpZXMyIH0gPSBPYmplY3Q7XG52YXIgeyBpc0FycmF5OiBpc0FycmF5NiB9ID0gQXJyYXk7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTIgfSA9IFJlZmxlY3Q7XG52YXIgZGVmYXVsdFZhbFRvU2xvdEZuID0gKHgpID0+IHg7XG52YXIgZGVmYXVsdFNsb3RUb1ZhbEZuID0gKHgsIF8pID0+IHg7XG52YXIgbWFrZU1hcnNoYWwgPSAoY29udmVydFZhbFRvU2xvdCA9IGRlZmF1bHRWYWxUb1Nsb3RGbiwgY29udmVydFNsb3RUb1ZhbCA9IGRlZmF1bHRTbG90VG9WYWxGbiwge1xuICBlcnJvclRhZ2dpbmcgPSBcIm9uXCIsXG4gIG1hcnNoYWxOYW1lID0gXCJhbm9uLW1hcnNoYWxcIixcbiAgLy9cbiAgLy9cbiAgZXJyb3JJZE51bSA9IDFlNCxcbiAgLy9cbiAgLy9cbiAgbWFyc2hhbFNhdmVFcnJvciA9IChlcnIpID0+IGNvbnNvbGUubG9nKFwiVGVtcG9yYXJ5IGxvZ2dpbmcgb2Ygc2VudCBlcnJvclwiLCBlcnIpLFxuICAvL1xuICAvL1xuICBzZXJpYWxpemVCb2R5Rm9ybWF0ID0gXCJjYXBkYXRhXCJcbn0gPSB7fSkgPT4ge1xuICBhc3NlcnQudHlwZW9mKG1hcnNoYWxOYW1lLCBcInN0cmluZ1wiKTtcbiAgZXJyb3JUYWdnaW5nID09PSBcIm9uXCIgfHwgZXJyb3JUYWdnaW5nID09PSBcIm9mZlwiIHx8IHRocm93UmVkYWN0ZWRgVGhlIGVycm9yVGFnZ2luZyBvcHRpb24gY2FuIG9ubHkgYmUgXCJvblwiIG9yIFwib2ZmXCIgJHtlcnJvclRhZ2dpbmd9YDtcbiAgY29uc3QgbmV4dEVycm9ySWQgPSAoKSA9PiB7XG4gICAgZXJyb3JJZE51bSArPSAxO1xuICAgIHJldHVybiBgZXJyb3I6JHttYXJzaGFsTmFtZX0jJHtlcnJvcklkTnVtfWA7XG4gIH07XG4gIGNvbnN0IHRvQ2FwRGF0YTIgPSAocm9vdCkgPT4ge1xuICAgIGNvbnN0IHNsb3RzID0gW107XG4gICAgY29uc3Qgc2xvdE1hcCA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gICAgY29uc3QgZW5jb2RlU2xvdENvbW1vbiA9IChwYXNzYWJsZSkgPT4ge1xuICAgICAgbGV0IGluZGV4ID0gc2xvdE1hcC5nZXQocGFzc2FibGUpO1xuICAgICAgaWYgKGluZGV4ICE9PSB2b2lkIDApIHtcbiAgICAgICAgYXNzZXJ0LnR5cGVvZihpbmRleCwgXCJudW1iZXJcIik7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBpbmRleCwgcmVwZWF0OiB0cnVlIH0pO1xuICAgICAgfVxuICAgICAgaW5kZXggPSBzbG90cy5sZW5ndGg7XG4gICAgICBjb25zdCBzbG90ID0gY29udmVydFZhbFRvU2xvdChwYXNzYWJsZSk7XG4gICAgICBzbG90cy5wdXNoKHNsb3QpO1xuICAgICAgc2xvdE1hcC5zZXQocGFzc2FibGUsIGluZGV4KTtcbiAgICAgIHJldHVybiBoYXJkZW4oeyBpbmRleCwgcmVwZWF0OiBmYWxzZSB9KTtcbiAgICB9O1xuICAgIGNvbnN0IGVuY29kZUVycm9yQ29tbW9uID0gKGVyciwgZW5jb2RlUmVjdXIpID0+IHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlbmNvZGVSZWN1cihgJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIGFzc2VydC50eXBlb2YobWVzc2FnZSwgXCJzdHJpbmdcIik7XG4gICAgICBjb25zdCBuYW1lID0gZW5jb2RlUmVjdXIoYCR7ZXJyLm5hbWV9YCk7XG4gICAgICBhc3NlcnQudHlwZW9mKG5hbWUsIFwic3RyaW5nXCIpO1xuICAgICAgaWYgKGVycm9yVGFnZ2luZyA9PT0gXCJvblwiKSB7XG4gICAgICAgIGNvbnN0IGVycm9ySWQgPSBlbmNvZGVSZWN1cihuZXh0RXJyb3JJZCgpKTtcbiAgICAgICAgYXNzZXJ0LnR5cGVvZihlcnJvcklkLCBcInN0cmluZ1wiKTtcbiAgICAgICAgbm90ZShlcnIsIHJlZGFjdGVkYFNlbnQgYXMgJHtlcnJvcklkfWApO1xuICAgICAgICBtYXJzaGFsU2F2ZUVycm9yKGVycik7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBlcnJvcklkLCBtZXNzYWdlLCBuYW1lIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7IG1lc3NhZ2UsIG5hbWUgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBpZiAoc2VyaWFsaXplQm9keUZvcm1hdCA9PT0gXCJjYXBkYXRhXCIpIHtcbiAgICAgIGNvbnN0IGVuY29kZVNsb3RUb0NhcERhdGEgPSAocGFzc2FibGUsIGlmYWNlID0gdm9pZCAwKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaW5kZXgsIHJlcGVhdCB9ID0gZW5jb2RlU2xvdENvbW1vbihwYXNzYWJsZSk7XG4gICAgICAgIGlmIChyZXBlYXQgPT09IHRydWUgfHwgaWZhY2UgPT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBbUUNMQVNTXTogXCJzbG90XCIsIGluZGV4IH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBbUUNMQVNTXTogXCJzbG90XCIsIGlmYWNlLCBpbmRleCB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IGVuY29kZVJlbW90YWJsZVRvQ2FwRGF0YSA9ICh2YWwsIF9lbmNvZGVSZWN1cikgPT4gZW5jb2RlU2xvdFRvQ2FwRGF0YSh2YWwsIGdldEludGVyZmFjZU9mKHZhbCkpO1xuICAgICAgY29uc3QgZW5jb2RlUHJvbWlzZVRvQ2FwRGF0YSA9IChwcm9taXNlLCBfZW5jb2RlUmVjdXIpID0+IGVuY29kZVNsb3RUb0NhcERhdGEocHJvbWlzZSk7XG4gICAgICBjb25zdCBlbmNvZGVFcnJvclRvQ2FwRGF0YSA9IChlcnIsIGVuY29kZVJlY3VyKSA9PiB7XG4gICAgICAgIGNvbnN0IGVyckRhdGEgPSBlbmNvZGVFcnJvckNvbW1vbihlcnIsIGVuY29kZVJlY3VyKTtcbiAgICAgICAgcmV0dXJuIGhhcmRlbih7IFtRQ0xBU1NdOiBcImVycm9yXCIsIC4uLmVyckRhdGEgfSk7XG4gICAgICB9O1xuICAgICAgY29uc3QgZW5jb2RlVG9DYXBEYXRhID0gbWFrZUVuY29kZVRvQ2FwRGF0YSh7XG4gICAgICAgIGVuY29kZVJlbW90YWJsZVRvQ2FwRGF0YSxcbiAgICAgICAgZW5jb2RlUHJvbWlzZVRvQ2FwRGF0YSxcbiAgICAgICAgZW5jb2RlRXJyb3JUb0NhcERhdGFcbiAgICAgIH0pO1xuICAgICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZVRvQ2FwRGF0YShyb290KTtcbiAgICAgIGNvbnN0IGJvZHkgPSBKU09OLnN0cmluZ2lmeShlbmNvZGVkKTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBib2R5LFxuICAgICAgICBzbG90c1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChzZXJpYWxpemVCb2R5Rm9ybWF0ID09PSBcInNtYWxsY2Fwc1wiKSB7XG4gICAgICBjb25zdCBlbmNvZGVTbG90VG9TbWFsbGNhcHMgPSAocHJlZml4LCBwYXNzYWJsZSwgaWZhY2UgPSB2b2lkIDApID0+IHtcbiAgICAgICAgY29uc3QgeyBpbmRleCwgcmVwZWF0IH0gPSBlbmNvZGVTbG90Q29tbW9uKHBhc3NhYmxlKTtcbiAgICAgICAgaWYgKHJlcGVhdCA9PT0gdHJ1ZSB8fCBpZmFjZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgcmV0dXJuIGAke3ByZWZpeH0ke2luZGV4fWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGAke3ByZWZpeH0ke2luZGV4fS4ke2lmYWNlfWA7XG4gICAgICB9O1xuICAgICAgY29uc3QgZW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMgPSAocmVtb3RhYmxlLCBfZW5jb2RlUmVjdXIpID0+IGVuY29kZVNsb3RUb1NtYWxsY2FwcyhcIiRcIiwgcmVtb3RhYmxlLCBnZXRJbnRlcmZhY2VPZihyZW1vdGFibGUpKTtcbiAgICAgIGNvbnN0IGVuY29kZVByb21pc2VUb1NtYWxsY2FwcyA9IChwcm9taXNlLCBfZW5jb2RlUmVjdXIpID0+IGVuY29kZVNsb3RUb1NtYWxsY2FwcyhcIiZcIiwgcHJvbWlzZSk7XG4gICAgICBjb25zdCBlbmNvZGVFcnJvclRvU21hbGxjYXBzID0gKGVyciwgZW5jb2RlUmVjdXIpID0+IHtcbiAgICAgICAgY29uc3QgZXJyRGF0YSA9IGVuY29kZUVycm9yQ29tbW9uKGVyciwgZW5jb2RlUmVjdXIpO1xuICAgICAgICBjb25zdCB7IG1lc3NhZ2UsIC4uLnJlc3QgfSA9IGVyckRhdGE7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBcIiNlcnJvclwiOiBtZXNzYWdlLCAuLi5yZXN0IH0pO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGVuY29kZVRvU21hbGxjYXBzID0gbWFrZUVuY29kZVRvU21hbGxjYXBzKHtcbiAgICAgICAgZW5jb2RlUmVtb3RhYmxlVG9TbWFsbGNhcHMsXG4gICAgICAgIGVuY29kZVByb21pc2VUb1NtYWxsY2FwcyxcbiAgICAgICAgZW5jb2RlRXJyb3JUb1NtYWxsY2Fwc1xuICAgICAgfSk7XG4gICAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlVG9TbWFsbGNhcHMocm9vdCk7XG4gICAgICBjb25zdCBzbWFsbGNhcHNCb2R5ID0gSlNPTi5zdHJpbmdpZnkoZW5jb2RlZCk7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgYm9keTogYCMke3NtYWxsY2Fwc0JvZHl9YCxcbiAgICAgICAgc2xvdHNcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFVucmVjb2duaXplZCBzZXJpYWxpemVCb2R5Rm9ybWF0OiAke3F1b3RlKHNlcmlhbGl6ZUJvZHlGb3JtYXQpfWA7XG4gICAgfVxuICB9O1xuICBjb25zdCBtYWtlRnVsbFJldml2ZSA9IChzbG90cykgPT4ge1xuICAgIGNvbnN0IHZhbE1hcCA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gICAgY29uc3QgZGVjb2RlU2xvdENvbW1vbiA9IChzbG90RGF0YSkgPT4ge1xuICAgICAgY29uc3QgeyBpZmFjZSA9IHZvaWQgMCwgaW5kZXgsIC4uLnJlc3QgfSA9IHNsb3REYXRhO1xuICAgICAgb3duS2V5czEyKHJlc3QpLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgZW5jb2RlZCBzbG90IHByb3BlcnRpZXMgJHtxdW90ZShvd25LZXlzMTIocmVzdCkpfWA7XG4gICAgICBjb25zdCBleHRhbnQgPSB2YWxNYXAuZ2V0KGluZGV4KTtcbiAgICAgIGlmIChleHRhbnQpIHtcbiAgICAgICAgcmV0dXJuIGV4dGFudDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHNsb3QgPSBzbG90c1tOdW1iZXIoTmF0KGluZGV4KSldO1xuICAgICAgY29uc3QgdmFsID0gY29udmVydFNsb3RUb1ZhbChzbG90LCBpZmFjZSk7XG4gICAgICB2YWxNYXAuc2V0KGluZGV4LCB2YWwpO1xuICAgICAgcmV0dXJuIHZhbDtcbiAgICB9O1xuICAgIGNvbnN0IGRlY29kZUVycm9yQ29tbW9uID0gKGVyckRhdGEsIGRlY29kZVJlY3VyKSA9PiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGVycm9ySWQgPSB2b2lkIDAsXG4gICAgICAgIG1lc3NhZ2UsXG4gICAgICAgIG5hbWUsXG4gICAgICAgIGNhdXNlID0gdm9pZCAwLFxuICAgICAgICBlcnJvcnMgPSB2b2lkIDAsXG4gICAgICAgIC4uLnJlc3RcbiAgICAgIH0gPSBlcnJEYXRhO1xuICAgICAgY29uc3QgZE5hbWUgPSBkZWNvZGVSZWN1cihuYW1lKTtcbiAgICAgIGNvbnN0IGRNZXNzYWdlID0gZGVjb2RlUmVjdXIobWVzc2FnZSk7XG4gICAgICBjb25zdCBkRXJyb3JJZCA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgIGVycm9ySWQgJiYgZGVjb2RlUmVjdXIoZXJyb3JJZClcbiAgICAgICk7XG4gICAgICBpZiAodHlwZW9mIGROYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW52YWxpZCBlcnJvciBuYW1lIHR5cGVvZiAke3F1b3RlKHR5cGVvZiBkTmFtZSl9YDtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2YgZE1lc3NhZ2UgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGVycm9yIG1lc3NhZ2UgdHlwZW9mICR7cXVvdGUodHlwZW9mIGRNZXNzYWdlKX1gO1xuICAgICAgfVxuICAgICAgY29uc3QgZXJyQ29uc3RydWN0b3IgPSBnZXRFcnJvckNvbnN0cnVjdG9yKGROYW1lKSB8fCBFcnJvcjtcbiAgICAgIGNvbnN0IGVycm9yTmFtZSA9IGRFcnJvcklkID09PSB2b2lkIDAgPyBgUmVtb3RlJHtlcnJDb25zdHJ1Y3Rvci5uYW1lfWAgOiBgUmVtb3RlJHtlcnJDb25zdHJ1Y3Rvci5uYW1lfSgke2RFcnJvcklkfSlgO1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgICAgZXJyb3JOYW1lLFxuICAgICAgICBzYW5pdGl6ZTogZmFsc2VcbiAgICAgIH07XG4gICAgICBpZiAoY2F1c2UpIHtcbiAgICAgICAgb3B0aW9ucy5jYXVzZSA9IGRlY29kZVJlY3VyKGNhdXNlKTtcbiAgICAgIH1cbiAgICAgIGlmIChlcnJvcnMpIHtcbiAgICAgICAgb3B0aW9ucy5lcnJvcnMgPSBkZWNvZGVSZWN1cihlcnJvcnMpO1xuICAgICAgfVxuICAgICAgY29uc3QgcmF3RXJyb3IgPSBtYWtlRXJyb3IoZE1lc3NhZ2UsIGVyckNvbnN0cnVjdG9yLCBvcHRpb25zKTtcbiAgICAgIGNvbnN0IGRlc2NzID0gb2JqZWN0TWFwKHJlc3QsIChkYXRhKSA9PiAoe1xuICAgICAgICB2YWx1ZTogZGVjb2RlUmVjdXIoZGF0YSksXG4gICAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2VcbiAgICAgIH0pKTtcbiAgICAgIGRlZmluZVByb3BlcnRpZXMyKHJhd0Vycm9yLCBkZXNjcyk7XG4gICAgICBoYXJkZW4ocmF3RXJyb3IpO1xuICAgICAgcmV0dXJuIHRvUGFzc2FibGVFcnJvcihyYXdFcnJvcik7XG4gICAgfTtcbiAgICBjb25zdCBkZWNvZGVSZW1vdGFibGVPclByb21pc2VGcm9tQ2FwRGF0YSA9IChyYXdUcmVlLCBfZGVjb2RlUmVjdXIpID0+IHtcbiAgICAgIGNvbnN0IHsgW1FDTEFTU106IF8sIC4uLnNsb3REYXRhIH0gPSByYXdUcmVlO1xuICAgICAgcmV0dXJuIGRlY29kZVNsb3RDb21tb24oc2xvdERhdGEpO1xuICAgIH07XG4gICAgY29uc3QgZGVjb2RlRXJyb3JGcm9tQ2FwRGF0YSA9IChyYXdUcmVlLCBkZWNvZGVSZWN1cikgPT4ge1xuICAgICAgY29uc3QgeyBbUUNMQVNTXTogXywgLi4uZXJyRGF0YSB9ID0gcmF3VHJlZTtcbiAgICAgIHJldHVybiBkZWNvZGVFcnJvckNvbW1vbihlcnJEYXRhLCBkZWNvZGVSZWN1cik7XG4gICAgfTtcbiAgICBjb25zdCByZXZpdmVGcm9tQ2FwRGF0YSA9IG1ha2VEZWNvZGVGcm9tQ2FwRGF0YSh7XG4gICAgICBkZWNvZGVSZW1vdGFibGVGcm9tQ2FwRGF0YTogZGVjb2RlUmVtb3RhYmxlT3JQcm9taXNlRnJvbUNhcERhdGEsXG4gICAgICBkZWNvZGVQcm9taXNlRnJvbUNhcERhdGE6IGRlY29kZVJlbW90YWJsZU9yUHJvbWlzZUZyb21DYXBEYXRhLFxuICAgICAgZGVjb2RlRXJyb3JGcm9tQ2FwRGF0YVxuICAgIH0pO1xuICAgIGNvbnN0IG1ha2VEZWNvZGVTbG90RnJvbVNtYWxsY2FwcyA9IChwcmVmaXgpID0+IHtcbiAgICAgIHJldHVybiAoc3RyaW5nRW5jb2RpbmcsIF9kZWNvZGVSZWN1cikgPT4ge1xuICAgICAgICBhc3NlcnQoc3RyaW5nRW5jb2RpbmcuY2hhckF0KDApID09PSBwcmVmaXgpO1xuICAgICAgICBjb25zdCBpMiA9IHN0cmluZ0VuY29kaW5nLmluZGV4T2YoXCIuXCIpO1xuICAgICAgICBjb25zdCBpbmRleCA9IE51bWJlcihzdHJpbmdFbmNvZGluZy5zbGljZSgxLCBpMiA8IDAgPyB2b2lkIDAgOiBpMikpO1xuICAgICAgICBjb25zdCBpZmFjZSA9IGkyIDwgMCA/IHZvaWQgMCA6IHN0cmluZ0VuY29kaW5nLnNsaWNlKGkyICsgMSk7XG4gICAgICAgIHJldHVybiBkZWNvZGVTbG90Q29tbW9uKHsgaWZhY2UsIGluZGV4IH0pO1xuICAgICAgfTtcbiAgICB9O1xuICAgIGNvbnN0IGRlY29kZVJlbW90YWJsZUZyb21TbWFsbGNhcHMgPSBtYWtlRGVjb2RlU2xvdEZyb21TbWFsbGNhcHMoXCIkXCIpO1xuICAgIGNvbnN0IGRlY29kZVByb21pc2VGcm9tU21hbGxjYXBzID0gbWFrZURlY29kZVNsb3RGcm9tU21hbGxjYXBzKFwiJlwiKTtcbiAgICBjb25zdCBkZWNvZGVFcnJvckZyb21TbWFsbGNhcHMgPSAoZW5jb2RpbmcsIGRlY29kZVJlY3VyKSA9PiB7XG4gICAgICBjb25zdCB7IFwiI2Vycm9yXCI6IG1lc3NhZ2UsIC4uLnJlc3RFcnJEYXRhIH0gPSBlbmNvZGluZztcbiAgICAgICFoYXNPd25Qcm9wZXJ0eU9mKHJlc3RFcnJEYXRhLCBcIm1lc3NhZ2VcIikgfHwgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGVuY29kZWQgZXJyb3IgcHJvcGVydHkgJHtxdW90ZShcIm1lc3NhZ2VcIil9YDtcbiAgICAgIHJldHVybiBkZWNvZGVFcnJvckNvbW1vbih7IG1lc3NhZ2UsIC4uLnJlc3RFcnJEYXRhIH0sIGRlY29kZVJlY3VyKTtcbiAgICB9O1xuICAgIGNvbnN0IHJldml2ZUZyb21TbWFsbGNhcHMgPSBtYWtlRGVjb2RlRnJvbVNtYWxsY2Fwcyh7XG4gICAgICAvL1xuICAgICAgZGVjb2RlUmVtb3RhYmxlRnJvbVNtYWxsY2FwcyxcbiAgICAgIC8vXG4gICAgICBkZWNvZGVQcm9taXNlRnJvbVNtYWxsY2FwcyxcbiAgICAgIGRlY29kZUVycm9yRnJvbVNtYWxsY2Fwc1xuICAgIH0pO1xuICAgIHJldHVybiBoYXJkZW4oeyByZXZpdmVGcm9tQ2FwRGF0YSwgcmV2aXZlRnJvbVNtYWxsY2FwcyB9KTtcbiAgfTtcbiAgY29uc3QgZnJvbUNhcERhdGEgPSAoZGF0YSkgPT4ge1xuICAgIGNvbnN0IHsgYm9keSwgc2xvdHMgfSA9IGRhdGE7XG4gICAgdHlwZW9mIGJvZHkgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGB1bnNlcmlhbGl6ZSgpIGdpdmVuIG5vbi1jYXBkYXRhICguYm9keSBpcyAke2JvZHl9LCBub3Qgc3RyaW5nKWA7XG4gICAgaXNBcnJheTYoZGF0YS5zbG90cykgfHwgdGhyb3dSZWRhY3RlZGB1bnNlcmlhbGl6ZSgpIGdpdmVuIG5vbi1jYXBkYXRhICguc2xvdHMgYXJlIG5vdCBBcnJheSlgO1xuICAgIGNvbnN0IHsgcmV2aXZlRnJvbUNhcERhdGEsIHJldml2ZUZyb21TbWFsbGNhcHMgfSA9IG1ha2VGdWxsUmV2aXZlKHNsb3RzKTtcbiAgICBsZXQgcmVzdWx0O1xuICAgIGlmIChib2R5LmNoYXJBdCgwKSA9PT0gXCIjXCIpIHtcbiAgICAgIGNvbnN0IHNtYWxsY2Fwc0JvZHkgPSBib2R5LnNsaWNlKDEpO1xuICAgICAgY29uc3QgZW5jb2RpbmcgPSBoYXJkZW4oSlNPTi5wYXJzZShzbWFsbGNhcHNCb2R5KSk7XG4gICAgICByZXN1bHQgPSBoYXJkZW4ocmV2aXZlRnJvbVNtYWxsY2FwcyhlbmNvZGluZykpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCByYXdUcmVlID0gaGFyZGVuKEpTT04ucGFyc2UoYm9keSkpO1xuICAgICAgcmVzdWx0ID0gaGFyZGVuKHJldml2ZUZyb21DYXBEYXRhKHJhd1RyZWUpKTtcbiAgICB9XG4gICAgYXNzZXJ0UGFzc2FibGUocmVzdWx0KTtcbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHJlc3VsdFxuICAgICk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIHRvQ2FwRGF0YTogdG9DYXBEYXRhMixcbiAgICBmcm9tQ2FwRGF0YSxcbiAgICAvL1xuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgc2VyaWFsaXplOiB0b0NhcERhdGEyLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICB1bnNlcmlhbGl6ZTogZnJvbUNhcERhdGFcbiAgfSk7XG59O1xuXG4vL1xudmFyIHsgZnJlZXplOiBmcmVlemU2IH0gPSBPYmplY3Q7XG52YXIgZG9Ob3RDb252ZXJ0VmFsVG9TbG90ID0gKHZhbCkgPT4gdGhyb3dSZWRhY3RlZGBNYXJzaGFsJ3Mgc3RyaW5naWZ5IHJlamVjdHMgcHJlc2VuY2VzIGFuZCBwcm9taXNlcyAke3ZhbH1gO1xudmFyIGRvTm90Q29udmVydFNsb3RUb1ZhbCA9IChzbG90LCBfaWZhY2UpID0+IHRocm93UmVkYWN0ZWRgTWFyc2hhbCdzIHBhcnNlIG11c3Qgbm90IGVuY29kZSBhbnkgc2xvdHMgJHtzbG90fWA7XG52YXIgYmFkQXJyYXlIYW5kbGVyID0gaGFyZGVuKHtcbiAgZ2V0OiAoX3RhcmdldCwgbmFtZSwgX3JlY2VpdmVyKSA9PiB7XG4gICAgaWYgKG5hbWUgPT09IFwibGVuZ3RoXCIpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYE1hcnNoYWwncyBwYXJzZSBtdXN0IG5vdCBlbmNvZGUgYW55IHNsb3QgcG9zaXRpb25zICR7bmFtZX1gO1xuICB9XG59KTtcbnZhciBhcnJheVRhcmdldCA9IGZyZWV6ZTYoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIFtdXG4pO1xudmFyIGJhZEFycmF5ID0gbmV3IFByb3h5KGFycmF5VGFyZ2V0LCBiYWRBcnJheUhhbmRsZXIpO1xudmFyIHsgc2VyaWFsaXplLCB1bnNlcmlhbGl6ZSB9ID0gbWFrZU1hcnNoYWwoXG4gIGRvTm90Q29udmVydFZhbFRvU2xvdCxcbiAgZG9Ob3RDb252ZXJ0U2xvdFRvVmFsLFxuICB7XG4gICAgZXJyb3JUYWdnaW5nOiBcIm9mZlwiLFxuICAgIC8vXG4gICAgc2VyaWFsaXplQm9keUZvcm1hdDogXCJjYXBkYXRhXCJcbiAgfVxuKTtcbnZhciBzdHJpbmdpZnkgPSAodmFsKSA9PiBzZXJpYWxpemUodmFsKS5ib2R5O1xuaGFyZGVuKHN0cmluZ2lmeSk7XG52YXIgcGFyc2UgPSAoc3RyKSA9PiB1bnNlcmlhbGl6ZShcbiAgLy9cbiAgLy9cbiAgLy9cbiAgZnJlZXplNih7XG4gICAgYm9keTogc3RyLFxuICAgIHNsb3RzOiBiYWRBcnJheVxuICB9KVxuKTtcbmhhcmRlbihwYXJzZSk7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTMgfSA9IFJlZmxlY3Q7XG52YXIgeyBpc0FycmF5OiBpc0FycmF5NyB9ID0gQXJyYXk7XG52YXIgeyBzdHJpbmdpZnk6IHF1b3RlMiB9ID0gSlNPTjtcbnZhciBtYWtlWWVzSW5kZW50ZXIgPSAoKSA9PiB7XG4gIGNvbnN0IHN0cmluZ3MgPSBbXTtcbiAgbGV0IGxldmVsID0gMDtcbiAgbGV0IG5lZWRTcGFjZSA9IGZhbHNlO1xuICBjb25zdCBsaW5lID0gKCkgPT4ge1xuICAgIG5lZWRTcGFjZSA9IGZhbHNlO1xuICAgIHJldHVybiBzdHJpbmdzLnB1c2goXCJcXG5cIiwgXCIgIFwiLnJlcGVhdChsZXZlbCkpO1xuICB9O1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBvcGVuOiAob3BlbkJyYWNrZXQpID0+IHtcbiAgICAgIGxldmVsICs9IDE7XG4gICAgICBpZiAobmVlZFNwYWNlKSB7XG4gICAgICAgIHN0cmluZ3MucHVzaChcIiBcIik7XG4gICAgICB9XG4gICAgICBuZWVkU3BhY2UgPSBmYWxzZTtcbiAgICAgIHJldHVybiBzdHJpbmdzLnB1c2gob3BlbkJyYWNrZXQpO1xuICAgIH0sXG4gICAgbGluZSxcbiAgICBuZXh0OiAodG9rZW4yKSA9PiB7XG4gICAgICBpZiAobmVlZFNwYWNlICYmIHRva2VuMiAhPT0gXCIsXCIpIHtcbiAgICAgICAgc3RyaW5ncy5wdXNoKFwiIFwiKTtcbiAgICAgIH1cbiAgICAgIG5lZWRTcGFjZSA9IHRydWU7XG4gICAgICByZXR1cm4gc3RyaW5ncy5wdXNoKHRva2VuMik7XG4gICAgfSxcbiAgICBjbG9zZTogKGNsb3NlQnJhY2tldCkgPT4ge1xuICAgICAgYXNzZXJ0KGxldmVsID49IDEpO1xuICAgICAgbGV2ZWwgLT0gMTtcbiAgICAgIGxpbmUoKTtcbiAgICAgIHJldHVybiBzdHJpbmdzLnB1c2goY2xvc2VCcmFja2V0KTtcbiAgICB9LFxuICAgIGRvbmU6ICgpID0+IHtcbiAgICAgIGFzc2VydC5lcXVhbChsZXZlbCwgMCk7XG4gICAgICByZXR1cm4gc3RyaW5ncy5qb2luKFwiXCIpO1xuICAgIH1cbiAgfSk7XG59O1xudmFyIGJhZFBhaXJQYXR0ZXJuID0gL14oPzpcXHdcXHd8PDx8Pj58XFwrXFwrfC0tfDwhfC0+KSQvO1xudmFyIG1ha2VOb0luZGVudGVyID0gKCkgPT4ge1xuICBjb25zdCBzdHJpbmdzID0gW107XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIG9wZW46IChvcGVuQnJhY2tldCkgPT4gc3RyaW5ncy5wdXNoKG9wZW5CcmFja2V0KSxcbiAgICBsaW5lOiAoKSA9PiBzdHJpbmdzLmxlbmd0aCxcbiAgICBuZXh0OiAodG9rZW4yKSA9PiB7XG4gICAgICBpZiAoc3RyaW5ncy5sZW5ndGggPj0gMSkge1xuICAgICAgICBjb25zdCBsYXN0ID0gc3RyaW5nc1tzdHJpbmdzLmxlbmd0aCAtIDFdO1xuICAgICAgICBpZiAobGFzdC5sZW5ndGggPj0gMSAmJiB0b2tlbjIubGVuZ3RoID49IDEpIHtcbiAgICAgICAgICBjb25zdCBwYWlyID0gYCR7bGFzdFtsYXN0Lmxlbmd0aCAtIDFdfSR7dG9rZW4yWzBdfWA7XG4gICAgICAgICAgaWYgKGJhZFBhaXJQYXR0ZXJuLnRlc3QocGFpcikpIHtcbiAgICAgICAgICAgIHN0cmluZ3MucHVzaChcIiBcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RyaW5ncy5wdXNoKHRva2VuMik7XG4gICAgfSxcbiAgICBjbG9zZTogKGNsb3NlQnJhY2tldCkgPT4ge1xuICAgICAgaWYgKHN0cmluZ3MubGVuZ3RoID49IDEgJiYgc3RyaW5nc1tzdHJpbmdzLmxlbmd0aCAtIDFdID09PSBcIixcIikge1xuICAgICAgICBzdHJpbmdzLnBvcCgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0cmluZ3MucHVzaChjbG9zZUJyYWNrZXQpO1xuICAgIH0sXG4gICAgZG9uZTogKCkgPT4gc3RyaW5ncy5qb2luKFwiXCIpXG4gIH0pO1xufTtcbnZhciBpZGVudFBhdHRlcm4gPSAvXlthLXpBLVpdXFx3KiQvO1xuaGFyZGVuKGlkZW50UGF0dGVybik7XG52YXIgQXRBdFByZWZpeFBhdHRlcm4yID0gL15AQCguKikkLztcbmhhcmRlbihBdEF0UHJlZml4UGF0dGVybjIpO1xudmFyIGRlY29kZVRvSnVzdGluID0gKGVuY29kaW5nLCBzaG91bGRJbmRlbnQgPSBmYWxzZSwgc2xvdHMgPSBbXSkgPT4ge1xuICBjb25zdCBwcmVwYXJlID0gKHJhd1RyZWUpID0+IHtcbiAgICBpZiAoIWlzT2JqZWN0MihyYXdUcmVlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBhc3NlcnQudHlwZW9mKHJhd1RyZWUsIFwib2JqZWN0XCIpO1xuICAgIGFzc2VydChyYXdUcmVlICE9PSBudWxsKTtcbiAgICBpZiAoUUNMQVNTIGluIHJhd1RyZWUpIHtcbiAgICAgIGNvbnN0IHFjbGFzcyA9IHJhd1RyZWVbUUNMQVNTXTtcbiAgICAgIHR5cGVvZiBxY2xhc3MgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIHFjbGFzcyB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgcWNsYXNzKX1gO1xuICAgICAgYXNzZXJ0KCFpc0FycmF5NyhyYXdUcmVlKSk7XG4gICAgICBzd2l0Y2ggKHJhd1RyZWVbXCJAcWNsYXNzXCJdKSB7XG4gICAgICAgIGNhc2UgXCJ1bmRlZmluZWRcIjpcbiAgICAgICAgY2FzZSBcIk5hTlwiOlxuICAgICAgICBjYXNlIFwiSW5maW5pdHlcIjpcbiAgICAgICAgY2FzZSBcIi1JbmZpbml0eVwiOiB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJiaWdpbnRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgZGlnaXRzIH0gPSByYXdUcmVlO1xuICAgICAgICAgIHR5cGVvZiBkaWdpdHMgPT09IFwic3RyaW5nXCIgfHwgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGRpZ2l0cyB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgZGlnaXRzKX1gO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiQEBhc3luY0l0ZXJhdG9yXCI6IHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICAgICAgY29uc3QgeyBuYW1lIH0gPSByYXdUcmVlO1xuICAgICAgICAgIGFzc2VydC50eXBlb2YobmFtZSwgXCJzdHJpbmdcIik7XG4gICAgICAgICAgY29uc3Qgc3ltID0gcGFzc2FibGVTeW1ib2xGb3JOYW1lKG5hbWUpO1xuICAgICAgICAgIGFzc2VydC50eXBlb2Yoc3ltLCBcInN5bWJvbFwiKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgICAgY29uc3QgeyB0YWcsIHBheWxvYWQgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZih0YWcsIFwic3RyaW5nXCIpO1xuICAgICAgICAgIHByZXBhcmUocGF5bG9hZCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzbG90XCI6IHtcbiAgICAgICAgICBjb25zdCB7IGluZGV4LCBpZmFjZSB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKGluZGV4LCBcIm51bWJlclwiKTtcbiAgICAgICAgICBOYXQoaW5kZXgpO1xuICAgICAgICAgIGlmIChpZmFjZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgICBhc3NlcnQudHlwZW9mKGlmYWNlLCBcInN0cmluZ1wiKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJoaWxiZXJ0XCI6IHtcbiAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsLCByZXN0IH0gPSByYXdUcmVlO1xuICAgICAgICAgIFwib3JpZ2luYWxcIiBpbiByYXdUcmVlIHx8IHRocm93UmVkYWN0ZWRgSW52YWxpZCBIaWxiZXJ0IEhvdGVsIGVuY29kaW5nICR7cmF3VHJlZX1gO1xuICAgICAgICAgIHByZXBhcmUob3JpZ2luYWwpO1xuICAgICAgICAgIGlmIChcInJlc3RcIiBpbiByYXdUcmVlKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHJlc3QgIT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN0ICR7cmVzdH0gZW5jb2RpbmcgbXVzdCBiZSBhbiBvYmplY3RgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlc3QgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN0ICR7cmVzdH0gZW5jb2RpbmcgbXVzdCBub3QgYmUgbnVsbGA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNBcnJheTcocmVzdCkpIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN0ICR7cmVzdH0gZW5jb2RpbmcgbXVzdCBub3QgYmUgYW4gYXJyYXlgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKFFDTEFTUyBpbiByZXN0KSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdCBlbmNvZGluZyAke3Jlc3R9IG11c3Qgbm90IGNvbnRhaW4gJHtxdW90ZShRQ0xBU1MpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBuYW1lcyA9IG93bktleXMxMyhyZXN0KTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykge1xuICAgICAgICAgICAgICB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYFByb3BlcnR5IG5hbWUgJHtuYW1lfSBvZiAke3Jhd1RyZWV9IG11c3QgYmUgYSBzdHJpbmdgO1xuICAgICAgICAgICAgICBwcmVwYXJlKHJlc3RbbmFtZV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgICBjb25zdCB7IG5hbWUsIG1lc3NhZ2UgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgaWYgKHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludmFsaWQgZXJyb3IgbmFtZSB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgbmFtZSl9YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgZ2V0RXJyb3JDb25zdHJ1Y3RvcihuYW1lKSAhPT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgTXVzdCBiZSB0aGUgbmFtZSBvZiBhbiBFcnJvciBjb25zdHJ1Y3RvciAke25hbWV9YDtcbiAgICAgICAgICB0eXBlb2YgbWVzc2FnZSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGludmFsaWQgZXJyb3IgbWVzc2FnZSB0eXBlb2YgJHtxdW90ZSh0eXBlb2YgbWVzc2FnZSl9YDtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIGFzc2VydC5mYWlsKHJlZGFjdGVkYHVucmVjb2duaXplZCAke3F1b3RlKFFDTEFTUyl9ICR7cXVvdGUocWNsYXNzKX1gLCBUeXBlRXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChpc0FycmF5NyhyYXdUcmVlKSkge1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHJhd1RyZWU7XG4gICAgICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgbGVuZ3RoOyBpMiArPSAxKSB7XG4gICAgICAgIHByZXBhcmUocmF3VHJlZVtpMl0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBuYW1lcyA9IG93bktleXMxMyhyYXdUcmVlKTtcbiAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykge1xuICAgICAgICBpZiAodHlwZW9mIG5hbWUgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFByb3BlcnR5IG5hbWUgJHtuYW1lfSBvZiAke3Jhd1RyZWV9IG11c3QgYmUgYSBzdHJpbmdgO1xuICAgICAgICB9XG4gICAgICAgIHByZXBhcmUocmF3VHJlZVtuYW1lXSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBtYWtlSW5kZW50ZXIgPSBzaG91bGRJbmRlbnQgPyBtYWtlWWVzSW5kZW50ZXIgOiBtYWtlTm9JbmRlbnRlcjtcbiAgbGV0IG91dCA9IG1ha2VJbmRlbnRlcigpO1xuICBjb25zdCBkZWNvZGUzID0gKHJhd1RyZWUpID0+IHtcbiAgICByZXR1cm4gcmVjdXIocmF3VHJlZSk7XG4gIH07XG4gIGNvbnN0IGRlY29kZVByb3BlcnR5ID0gKG5hbWUsIHZhbHVlKSA9PiB7XG4gICAgb3V0LmxpbmUoKTtcbiAgICBpZiAobmFtZSA9PT0gXCJfX3Byb3RvX19cIikge1xuICAgICAgb3V0Lm5leHQoYFtcIl9fcHJvdG9fX1wiXTpgKTtcbiAgICB9IGVsc2UgaWYgKGlkZW50UGF0dGVybi50ZXN0KG5hbWUpKSB7XG4gICAgICBvdXQubmV4dChgJHtuYW1lfTpgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3V0Lm5leHQoYCR7cXVvdGUyKG5hbWUpfTpgKTtcbiAgICB9XG4gICAgZGVjb2RlMyh2YWx1ZSk7XG4gICAgb3V0Lm5leHQoXCIsXCIpO1xuICB9O1xuICBjb25zdCByZWN1ciA9IChyYXdUcmVlKSA9PiB7XG4gICAgaWYgKCFpc09iamVjdDIocmF3VHJlZSkpIHtcbiAgICAgIHJldHVybiBvdXQubmV4dChxdW90ZTIocmF3VHJlZSkpO1xuICAgIH1cbiAgICBhc3NlcnQudHlwZW9mKHJhd1RyZWUsIFwib2JqZWN0XCIpO1xuICAgIGFzc2VydChyYXdUcmVlICE9PSBudWxsKTtcbiAgICBpZiAoUUNMQVNTIGluIHJhd1RyZWUpIHtcbiAgICAgIGNvbnN0IHFjbGFzcyA9IHJhd1RyZWVbUUNMQVNTXTtcbiAgICAgIGFzc2VydC50eXBlb2YocWNsYXNzLCBcInN0cmluZ1wiKTtcbiAgICAgIGFzc2VydCghaXNBcnJheTcocmF3VHJlZSkpO1xuICAgICAgc3dpdGNoIChyYXdUcmVlW1wiQHFjbGFzc1wiXSkge1xuICAgICAgICAvL1xuICAgICAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgICAgIGNhc2UgXCJOYU5cIjpcbiAgICAgICAgY2FzZSBcIkluZmluaXR5XCI6XG4gICAgICAgIGNhc2UgXCItSW5maW5pdHlcIjoge1xuICAgICAgICAgIHJldHVybiBvdXQubmV4dChxY2xhc3MpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJiaWdpbnRcIjoge1xuICAgICAgICAgIGNvbnN0IHsgZGlnaXRzIH0gPSByYXdUcmVlO1xuICAgICAgICAgIGFzc2VydC50eXBlb2YoZGlnaXRzLCBcInN0cmluZ1wiKTtcbiAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoYCR7QmlnSW50KGRpZ2l0cyl9bmApO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJAQGFzeW5jSXRlcmF0b3JcIjoge1xuICAgICAgICAgIHJldHVybiBvdXQubmV4dChcIlN5bWJvbC5hc3luY0l0ZXJhdG9yXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzeW1ib2xcIjoge1xuICAgICAgICAgIGNvbnN0IHsgbmFtZSB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKG5hbWUsIFwic3RyaW5nXCIpO1xuICAgICAgICAgIGNvbnN0IHN5bSA9IHBhc3NhYmxlU3ltYm9sRm9yTmFtZShuYW1lKTtcbiAgICAgICAgICBhc3NlcnQudHlwZW9mKHN5bSwgXCJzeW1ib2xcIik7XG4gICAgICAgICAgY29uc3QgcmVnaXN0ZXJlZE5hbWUgPSBTeW1ib2wua2V5Rm9yKHN5bSk7XG4gICAgICAgICAgaWYgKHJlZ2lzdGVyZWROYW1lID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gQXRBdFByZWZpeFBhdHRlcm4yLmV4ZWMobmFtZSk7XG4gICAgICAgICAgICBhc3NlcnQobWF0Y2ggIT09IG51bGwpO1xuICAgICAgICAgICAgY29uc3Qgc3VmZml4ID0gbWF0Y2hbMV07XG4gICAgICAgICAgICBhc3NlcnQoU3ltYm9sW3N1ZmZpeF0gPT09IHN5bSk7XG4gICAgICAgICAgICBhc3NlcnQoaWRlbnRQYXR0ZXJuLnRlc3Qoc3VmZml4KSk7XG4gICAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoYFN5bWJvbC4ke3N1ZmZpeH1gKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGBTeW1ib2wuZm9yKCR7cXVvdGUyKHJlZ2lzdGVyZWROYW1lKX0pYCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInRhZ2dlZFwiOiB7XG4gICAgICAgICAgY29uc3QgeyB0YWcsIHBheWxvYWQgfSA9IHJhd1RyZWU7XG4gICAgICAgICAgb3V0Lm5leHQoYG1ha2VUYWdnZWQoJHtxdW90ZTIodGFnKX0sYCk7XG4gICAgICAgICAgZGVjb2RlMyhwYXlsb2FkKTtcbiAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoXCIpXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJzbG90XCI6IHtcbiAgICAgICAgICBsZXQgeyBpZmFjZSB9ID0gcmF3VHJlZTtcbiAgICAgICAgICBjb25zdCBpbmRleCA9IE51bWJlcihOYXQocmF3VHJlZS5pbmRleCkpO1xuICAgICAgICAgIGNvbnN0IG5lc3RlZFJlbmRlciA9IChhcmcpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9sZE91dCA9IG91dDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIG91dCA9IG1ha2VOb0luZGVudGVyKCk7XG4gICAgICAgICAgICAgIGRlY29kZTMoYXJnKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG91dC5kb25lKCk7XG4gICAgICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgICBvdXQgPSBvbGRPdXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZiAoaW5kZXggPCBzbG90cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IHNsb3QgPSBuZXN0ZWRSZW5kZXIoc2xvdHNbaW5kZXhdKTtcbiAgICAgICAgICAgIGlmIChpZmFjZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiBvdXQubmV4dChgc2xvdFRvVmFsKCR7c2xvdH0pYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZmFjZSA9IG5lc3RlZFJlbmRlcihpZmFjZSk7XG4gICAgICAgICAgICByZXR1cm4gb3V0Lm5leHQoYHNsb3RUb1ZhbCgke3Nsb3R9LCR7aWZhY2V9KWApO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaWZhY2UgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGBzbG90KCR7aW5kZXh9KWApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZmFjZSA9IG5lc3RlZFJlbmRlcihpZmFjZSk7XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGBzbG90KCR7aW5kZXh9LCR7aWZhY2V9KWApO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJoaWxiZXJ0XCI6IHtcbiAgICAgICAgICBjb25zdCB7IG9yaWdpbmFsLCByZXN0IH0gPSByYXdUcmVlO1xuICAgICAgICAgIG91dC5vcGVuKFwie1wiKTtcbiAgICAgICAgICBkZWNvZGVQcm9wZXJ0eShRQ0xBU1MsIG9yaWdpbmFsKTtcbiAgICAgICAgICBpZiAoXCJyZXN0XCIgaW4gcmF3VHJlZSkge1xuICAgICAgICAgICAgYXNzZXJ0LnR5cGVvZihyZXN0LCBcIm9iamVjdFwiKTtcbiAgICAgICAgICAgIGFzc2VydChyZXN0ICE9PSBudWxsKTtcbiAgICAgICAgICAgIGNvbnN0IG5hbWVzID0gb3duS2V5czEzKHJlc3QpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBuYW1lIG9mIG5hbWVzKSB7XG4gICAgICAgICAgICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUHJvcGVydHkgbmFtZSAke3F1b3RlKFxuICAgICAgICAgICAgICAgICAgbmFtZVxuICAgICAgICAgICAgICAgICl9IG9mICR7cmVzdH0gbXVzdCBiZSBhIHN0cmluZ2A7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZGVjb2RlUHJvcGVydHkobmFtZSwgcmVzdFtuYW1lXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBvdXQuY2xvc2UoXCJ9XCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICBjYXVzZSA9IHZvaWQgMCxcbiAgICAgICAgICAgIGVycm9ycyA9IHZvaWQgMFxuICAgICAgICAgIH0gPSByYXdUcmVlO1xuICAgICAgICAgIGNhdXNlID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBlcnJvciBjYXVzZSBub3QgeWV0IGltcGxlbWVudGVkIGluIG1hcnNoYWwtanVzdGluYDtcbiAgICAgICAgICBuYW1lICE9PSBgQWdncmVnYXRlRXJyb3JgIHx8IHRocm93UmVkYWN0ZWRgQWdncmVnYXRlRXJyb3Igbm90IHlldCBpbXBsZW1lbnRlZCBpbiBtYXJzaGFsLWp1c3RpbmA7XG4gICAgICAgICAgZXJyb3JzID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBlcnJvciBlcnJvcnMgbm90IHlldCBpbXBsZW1lbnRlZCBpbiBtYXJzaGFsLWp1c3RpbmA7XG4gICAgICAgICAgcmV0dXJuIG91dC5uZXh0KGAke25hbWV9KCR7cXVvdGUyKG1lc3NhZ2UpfSlgKTtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgdGhyb3cgYXNzZXJ0LmZhaWwoXG4gICAgICAgICAgICByZWRhY3RlZGB1bnJlY29nbml6ZWQgJHtxdW90ZShRQ0xBU1MpfSAke3F1b3RlKHFjbGFzcyl9YCxcbiAgICAgICAgICAgIFR5cGVFcnJvclxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGlzQXJyYXk3KHJhd1RyZWUpKSB7XG4gICAgICBjb25zdCB7IGxlbmd0aCB9ID0gcmF3VHJlZTtcbiAgICAgIGlmIChsZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIG91dC5uZXh0KFwiW11cIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvdXQub3BlbihcIltcIik7XG4gICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBsZW5ndGg7IGkyICs9IDEpIHtcbiAgICAgICAgICBvdXQubGluZSgpO1xuICAgICAgICAgIGRlY29kZTMocmF3VHJlZVtpMl0pO1xuICAgICAgICAgIG91dC5uZXh0KFwiLFwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0LmNsb3NlKFwiXVwiKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbmFtZXMgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG93bktleXMxMyhyYXdUcmVlKVxuICAgICAgKTtcbiAgICAgIGlmIChuYW1lcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIG91dC5uZXh0KFwie31cIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvdXQub3BlbihcIntcIik7XG4gICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykge1xuICAgICAgICAgIGRlY29kZVByb3BlcnR5KG5hbWUsIHJhd1RyZWVbbmFtZV0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvdXQuY2xvc2UoXCJ9XCIpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgcHJlcGFyZShlbmNvZGluZyk7XG4gIGRlY29kZTMoZW5jb2RpbmcpO1xuICByZXR1cm4gb3V0LmRvbmUoKTtcbn07XG5oYXJkZW4oZGVjb2RlVG9KdXN0aW4pO1xuXG4vL1xudmFyIHsgaXNBcnJheTogaXNBcnJheTggfSA9IEFycmF5O1xudmFyIHsgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzNSwgaXM6IGlzMyB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czE0IH0gPSBSZWZsZWN0O1xudmFyIHJDMCA9IC9bXFx4MDAtXFx4MUZdLztcbnZhciBnZXRTdWZmaXggPSAoc3RyLCBpbmRleCkgPT4gaW5kZXggPT09IDAgPyBzdHIgOiBzdHIuc3Vic3RyaW5nKGluZGV4KTtcbnZhciByZWNvcmROYW1lcyA9IChyZWNvcmQpID0+IChcbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgaGFyZGVuKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgb3duS2V5czE0KHJlY29yZCkuc29ydCgpLnJldmVyc2UoKVxuICApXG4pO1xuaGFyZGVuKHJlY29yZE5hbWVzKTtcbnZhciByZWNvcmRWYWx1ZXMgPSAocmVjb3JkLCBuYW1lcykgPT4gaGFyZGVuKG5hbWVzLm1hcCgobmFtZSkgPT4gcmVjb3JkW25hbWVdKSk7XG5oYXJkZW4ocmVjb3JkVmFsdWVzKTtcbnZhciB6ZXJvZXMgPSBBcnJheSgxNikuZmlsbCh2b2lkIDApLm1hcCgoXywgaTIpID0+IFwiMFwiLnJlcGVhdChpMikpO1xudmFyIHplcm9QYWQgPSAobjIsIHNpemUpID0+IHtcbiAgY29uc3QgblN0ciA9IGAke24yfWA7XG4gIGNvbnN0IGZpbGxMZW4gPSBzaXplIC0gblN0ci5sZW5ndGg7XG4gIGlmIChmaWxsTGVuID09PSAwKSByZXR1cm4gblN0cjtcbiAgYXNzZXJ0KGZpbGxMZW4gPiAwICYmIGZpbGxMZW4gPCB6ZXJvZXMubGVuZ3RoKTtcbiAgcmV0dXJuIGAke3plcm9lc1tmaWxsTGVuXX0ke25TdHJ9YDtcbn07XG5oYXJkZW4oemVyb1BhZCk7XG52YXIgYXNOdW1iZXIgPSBuZXcgRmxvYXQ2NEFycmF5KDEpO1xudmFyIGFzQml0cyA9IG5ldyBCaWdVaW50NjRBcnJheShhc051bWJlci5idWZmZXIpO1xudmFyIENhbm9uaWNhbE5hTkJpdHMgPSBcImZmZjgwMDAwMDAwMDAwMDBcIjtcbnZhciBlbmNvZGVCaW5hcnk2NCA9IChuMikgPT4ge1xuICBpZiAoaXMzKG4yLCAtMCkpIHtcbiAgICBuMiA9IDA7XG4gIH0gZWxzZSBpZiAoaXMzKG4yLCBOYU4pKSB7XG4gICAgcmV0dXJuIGBmJHtDYW5vbmljYWxOYU5CaXRzfWA7XG4gIH1cbiAgYXNOdW1iZXJbMF0gPSBuMjtcbiAgbGV0IGJpdHMgPSBhc0JpdHNbMF07XG4gIGlmIChuMiA8IDApIHtcbiAgICBiaXRzIF49IDB4ZmZmZmZmZmZmZmZmZmZmZm47XG4gIH0gZWxzZSB7XG4gICAgYml0cyBePSAweDgwMDAwMDAwMDAwMDAwMDBuO1xuICB9XG4gIHJldHVybiBgZiR7emVyb1BhZChiaXRzLnRvU3RyaW5nKDE2KSwgMTYpfWA7XG59O1xudmFyIGRlY29kZUJpbmFyeTY0ID0gKGVuY29kZWQsIHNraXAgPSAwKSA9PiB7XG4gIGVuY29kZWQuY2hhckF0KHNraXApID09PSBcImZcIiB8fCB0aHJvd1JlZGFjdGVkYEVuY29kZWQgbnVtYmVyIGV4cGVjdGVkOiAke2VuY29kZWR9YDtcbiAgbGV0IGJpdHMgPSBCaWdJbnQoYDB4JHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCArIDEpfWApO1xuICBpZiAoZW5jb2RlZC5jaGFyQXQoc2tpcCArIDEpIDwgXCI4XCIpIHtcbiAgICBiaXRzIF49IDB4ZmZmZmZmZmZmZmZmZmZmZm47XG4gIH0gZWxzZSB7XG4gICAgYml0cyBePSAweDgwMDAwMDAwMDAwMDAwMDBuO1xuICB9XG4gIGFzQml0c1swXSA9IGJpdHM7XG4gIGNvbnN0IHJlc3VsdCA9IGFzTnVtYmVyWzBdO1xuICAhaXMzKHJlc3VsdCwgLTApIHx8IHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCBuZWdhdGl2ZSB6ZXJvOiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBlbmNvZGVCaWdJbnQgPSAobjIpID0+IHtcbiAgY29uc3QgYWJzID0gbjIgPCAwbiA/IC1uMiA6IG4yO1xuICBjb25zdCBuRGlnaXRzID0gYWJzLnRvU3RyaW5nKCkubGVuZ3RoO1xuICBjb25zdCBsRGlnaXRzID0gbkRpZ2l0cy50b1N0cmluZygpLmxlbmd0aDtcbiAgaWYgKG4yIDwgMG4pIHtcbiAgICByZXR1cm4gYG4key8vXG4gICAgLy9cbiAgICBcIiNcIi5yZXBlYXQobERpZ2l0cyAtIDEpfSR7Ly9cbiAgICAoMTAgKiogbERpZ2l0cyAtIG5EaWdpdHMpLnRvU3RyaW5nKCkucGFkU3RhcnQobERpZ2l0cywgXCIwXCIpfTokey8vXG4gICAgKDEwbiAqKiBCaWdJbnQobkRpZ2l0cykgKyBuMikudG9TdHJpbmcoKS5wYWRTdGFydChuRGlnaXRzLCBcIjBcIil9YDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYHAkey8vXG4gICAgLy9cbiAgICBcIn5cIi5yZXBlYXQobERpZ2l0cyAtIDEpfSR7Ly9cbiAgICBuRGlnaXRzfTokey8vXG4gICAgbjJ9YDtcbiAgfVxufTtcbnZhciByQmlnSW50UGF5bG9hZCA9IC8oWzAtOV0rKSg6KFswLTldKyR8KXwpL3M7XG52YXIgZGVjb2RlQmlnSW50ID0gKGVuY29kZWQpID0+IHtcbiAgY29uc3QgdHlwZVByZWZpeCA9IGVuY29kZWQuY2hhckF0KDApO1xuICB0eXBlUHJlZml4ID09PSBcInBcIiB8fCB0eXBlUHJlZml4ID09PSBcIm5cIiB8fCB0aHJvd1JlZGFjdGVkYEVuY29kZWQgYmlnaW50IGV4cGVjdGVkOiAke2VuY29kZWR9YDtcbiAgY29uc3Qge1xuICAgIGluZGV4OiBsRGlnaXRzLFxuICAgIDE6IHNuRGlnaXRzLFxuICAgIDI6IHRhaWwsXG4gICAgMzogZGlnaXRzXG4gIH0gPSBlbmNvZGVkLm1hdGNoKHJCaWdJbnRQYXlsb2FkKSB8fCB0aHJvd1JlZGFjdGVkYERpZ2l0IGNvdW50IGV4cGVjdGVkOiAke2VuY29kZWR9YDtcbiAgc25EaWdpdHMubGVuZ3RoID09PSBsRGlnaXRzIHx8IHRocm93UmVkYWN0ZWRgVW5hcnktcHJlZml4ZWQgZGVjaW1hbCBkaWdpdCBjb3VudCBleHBlY3RlZDogJHtlbmNvZGVkfWA7XG4gIGxldCBuRGlnaXRzID0gcGFyc2VJbnQoc25EaWdpdHMsIDEwKTtcbiAgaWYgKHR5cGVQcmVmaXggPT09IFwiblwiKSB7XG4gICAgbkRpZ2l0cyA9IDEwICoqIC8qICAgICAgICAgICAgICAgICAqL1xuICAgIGxEaWdpdHMgLSBuRGlnaXRzO1xuICB9XG4gIHRhaWwuY2hhckF0KDApID09PSBcIjpcIiB8fCB0aHJvd1JlZGFjdGVkYFNlcGFyYXRvciBleHBlY3RlZDogJHtlbmNvZGVkfWA7XG4gIGRpZ2l0cy5sZW5ndGggPT09IG5EaWdpdHMgfHwgdGhyb3dSZWRhY3RlZGBGaXhlZC1sZW5ndGggZGlnaXQgc2VxdWVuY2UgZXhwZWN0ZWQ6ICR7ZW5jb2RlZH1gO1xuICBsZXQgbjIgPSBCaWdJbnQoZGlnaXRzKTtcbiAgaWYgKHR5cGVQcmVmaXggPT09IFwiblwiKSB7XG4gICAgbjIgPSAtKDEwbiAqKiBCaWdJbnQobkRpZ2l0cykgLSBuMik7XG4gIH1cbiAgcmV0dXJuIG4yO1xufTtcbnZhciBzdHJpbmdFc2NhcGVzID0gQXJyYXkoMzQpLmZpbGwodm9pZCAwKS5tYXAoKF8sIGNwKSA9PiB7XG4gIHN3aXRjaCAoU3RyaW5nLmZyb21DaGFyQ29kZShjcCkpIHtcbiAgICBjYXNlIFwiIFwiOlxuICAgICAgcmV0dXJuIFwiIV9cIjtcbiAgICBjYXNlIFwiIVwiOlxuICAgICAgcmV0dXJuIFwiIXxcIjtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIGAhJHtTdHJpbmcuZnJvbUNoYXJDb2RlKGNwICsgMzMpfWA7XG4gIH1cbn0pO1xuc3RyaW5nRXNjYXBlc1tcIl5cIi5jaGFyQ29kZUF0KDApXSA9IFwiX0BcIjtcbnN0cmluZ0VzY2FwZXNbXCJfXCIuY2hhckNvZGVBdCgwKV0gPSBcIl9fXCI7XG52YXIgZW5jb2RlQ29tcGFjdFN0cmluZ1N1ZmZpeCA9IChzdHIpID0+IHN0ci5yZXBsYWNlKC9bXFwwLSFeX10vZywgKGNoKSA9PiBzdHJpbmdFc2NhcGVzW2NoLmNoYXJDb2RlQXQoMCldKTtcbnZhciBkZWNvZGVDb21wYWN0U3RyaW5nU3VmZml4ID0gKGVuY29kZWQpID0+IHtcbiAgcmV0dXJuIGVuY29kZWQucmVwbGFjZSgvKFtcXDAtIV9dKSgufFxcbik/L2csIChlc2MsIHByZWZpeCwgc3VmZml4KSA9PiB7XG4gICAgc3dpdGNoIChlc2MpIHtcbiAgICAgIGNhc2UgXCIhX1wiOlxuICAgICAgICByZXR1cm4gXCIgXCI7XG4gICAgICBjYXNlIFwiIXxcIjpcbiAgICAgICAgcmV0dXJuIFwiIVwiO1xuICAgICAgY2FzZSBcIl9AXCI6XG4gICAgICAgIHJldHVybiBcIl5cIjtcbiAgICAgIGNhc2UgXCJfX1wiOlxuICAgICAgICByZXR1cm4gXCJfXCI7XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIGNvbnN0IGNoID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHN1ZmZpeFxuICAgICAgICApO1xuICAgICAgICBwcmVmaXggPT09IFwiIVwiICYmIHN1ZmZpeCAhPT0gdm9pZCAwICYmIGNoID49IFwiIVwiICYmIGNoIDw9IFwiQFwiIHx8IHRocm93UmVkYWN0ZWRgaW52YWxpZCBzdHJpbmcgZXNjYXBlOiAke3F1b3RlKGVzYyl9YDtcbiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2guY2hhckNvZGVBdCgwKSAtIDMzKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBlbmNvZGVMZWdhY3lTdHJpbmdTdWZmaXggPSAoc3RyKSA9PiBzdHI7XG52YXIgZGVjb2RlTGVnYWN5U3RyaW5nU3VmZml4ID0gKGVuY29kZWQpID0+IGVuY29kZWQ7XG52YXIgZW5jb2RlQ29tcGFjdEFycmF5ID0gKGFycmF5LCBlbmNvZGVQYXNzYWJsZSkgPT4ge1xuICBjb25zdCBjaGFycyA9IFtcIl5cIl07XG4gIGZvciAoY29uc3QgZWxlbWVudCBvZiBhcnJheSkge1xuICAgIGNvbnN0IGVuYyA9IGVuY29kZVBhc3NhYmxlKGVsZW1lbnQpO1xuICAgIGNoYXJzLnB1c2goZW5jLCBcIiBcIik7XG4gIH1cbiAgcmV0dXJuIGNoYXJzLmpvaW4oXCJcIik7XG59O1xudmFyIGRlY29kZUNvbXBhY3RBcnJheSA9IChlbmNvZGVkLCBkZWNvZGVQYXNzYWJsZSwgc2tpcCA9IDApID0+IHtcbiAgY29uc3QgZWxlbWVudHMgPSBbXTtcbiAgbGV0IGRlcHRoID0gMDtcbiAgbGV0IG5leHRJbmRleCA9IHNraXAgKyAxO1xuICBsZXQgY3VycmVudEVsZW1lbnRTdGFydCA9IHNraXAgKyAxO1xuICBmb3IgKGNvbnN0IHsgMDogY2gsIGluZGV4OiBpMiB9IG9mIGVuY29kZWQubWF0Y2hBbGwoL1tcXF4gXS9nKSkge1xuICAgIGNvbnN0IGluZGV4ID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICBpMlxuICAgICk7XG4gICAgaWYgKGluZGV4IDw9IHNraXApIHtcbiAgICAgIGlmIChpbmRleCA9PT0gc2tpcCkge1xuICAgICAgICBjaCA9PT0gXCJeXCIgfHwgdGhyb3dSZWRhY3RlZGBFbmNvZGVkIGFycmF5IGV4cGVjdGVkOiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY2ggPT09IFwiXlwiKSB7XG4gICAgICBkZXB0aCArPSAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoaW5kZXggPT09IG5leHRJbmRleCkge1xuICAgICAgICBkZXB0aCAtPSAxO1xuICAgICAgICBkZXB0aCA+PSAwIHx8IC8vXG4gICAgICAgIHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBhcnJheSBlbGVtZW50IHRlcm1pbmF0b3I6ICR7ZW5jb2RlZC5zbGljZShza2lwLCBpbmRleCArIDIpfWA7XG4gICAgICB9XG4gICAgICBpZiAoZGVwdGggPT09IDApIHtcbiAgICAgICAgZWxlbWVudHMucHVzaChcbiAgICAgICAgICBkZWNvZGVQYXNzYWJsZShlbmNvZGVkLnNsaWNlKGN1cnJlbnRFbGVtZW50U3RhcnQsIGluZGV4KSlcbiAgICAgICAgKTtcbiAgICAgICAgY3VycmVudEVsZW1lbnRTdGFydCA9IGluZGV4ICsgMTtcbiAgICAgIH1cbiAgICB9XG4gICAgbmV4dEluZGV4ID0gaW5kZXggKyAxO1xuICB9XG4gIGRlcHRoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgdW50ZXJtaW5hdGVkIGFycmF5OiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICBuZXh0SW5kZXggPT09IGVuY29kZWQubGVuZ3RoIHx8IHRocm93UmVkYWN0ZWRgdW50ZXJtaW5hdGVkIGFycmF5IGVsZW1lbnQ6ICR7Z2V0U3VmZml4KFxuICAgIGVuY29kZWQsXG4gICAgY3VycmVudEVsZW1lbnRTdGFydFxuICApfWA7XG4gIHJldHVybiBoYXJkZW4oZWxlbWVudHMpO1xufTtcbnZhciBlbmNvZGVMZWdhY3lBcnJheSA9IChhcnJheSwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgY29uc3QgY2hhcnMgPSBbXCJbXCJdO1xuICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgYXJyYXkpIHtcbiAgICBjb25zdCBlbmMgPSBlbmNvZGVQYXNzYWJsZShlbGVtZW50KTtcbiAgICBmb3IgKGNvbnN0IGMyIG9mIGVuYykge1xuICAgICAgaWYgKGMyID09PSBcIlxcMFwiIHx8IGMyID09PSBcIlx1MDAwMVwiKSB7XG4gICAgICAgIGNoYXJzLnB1c2goXCJcdTAwMDFcIik7XG4gICAgICB9XG4gICAgICBjaGFycy5wdXNoKGMyKTtcbiAgICB9XG4gICAgY2hhcnMucHVzaChcIlxcMFwiKTtcbiAgfVxuICByZXR1cm4gY2hhcnMuam9pbihcIlwiKTtcbn07XG52YXIgZGVjb2RlTGVnYWN5QXJyYXkgPSAoZW5jb2RlZCwgZGVjb2RlUGFzc2FibGUsIHNraXAgPSAwKSA9PiB7XG4gIGNvbnN0IGVsZW1lbnRzID0gW107XG4gIGNvbnN0IGVsZW1DaGFycyA9IFtdO1xuICBsZXQgc3RpbGxUb1NraXAgPSBza2lwICsgMTtcbiAgbGV0IGluRXNjYXBlID0gZmFsc2U7XG4gIGZvciAoY29uc3QgYzIgb2YgZW5jb2RlZCkge1xuICAgIGlmIChzdGlsbFRvU2tpcCA+IDApIHtcbiAgICAgIHN0aWxsVG9Ta2lwIC09IDE7XG4gICAgICBpZiAoc3RpbGxUb1NraXAgPT09IDApIHtcbiAgICAgICAgYzIgPT09IFwiW1wiIHx8IHRocm93UmVkYWN0ZWRgRW5jb2RlZCBhcnJheSBleHBlY3RlZDogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGluRXNjYXBlKSB7XG4gICAgICBjMiA9PT0gXCJcXDBcIiB8fCBjMiA9PT0gXCJcdTAwMDFcIiB8fCB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgY2hhcmFjdGVyIGFmdGVyIHUwMDAxIGVzY2FwZTogJHtjMn1gO1xuICAgICAgZWxlbUNoYXJzLnB1c2goYzIpO1xuICAgIH0gZWxzZSBpZiAoYzIgPT09IFwiXFwwXCIpIHtcbiAgICAgIGNvbnN0IGVuY29kZWRFbGVtZW50ID0gZWxlbUNoYXJzLmpvaW4oXCJcIik7XG4gICAgICBlbGVtQ2hhcnMubGVuZ3RoID0gMDtcbiAgICAgIGNvbnN0IGVsZW1lbnQgPSBkZWNvZGVQYXNzYWJsZShlbmNvZGVkRWxlbWVudCk7XG4gICAgICBlbGVtZW50cy5wdXNoKGVsZW1lbnQpO1xuICAgIH0gZWxzZSBpZiAoYzIgPT09IFwiXHUwMDAxXCIpIHtcbiAgICAgIGluRXNjYXBlID0gdHJ1ZTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbGVtQ2hhcnMucHVzaChjMik7XG4gICAgfVxuICAgIGluRXNjYXBlID0gZmFsc2U7XG4gIH1cbiAgIWluRXNjYXBlIHx8IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBlbmQgb2YgZW5jb2RpbmcgJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgZWxlbUNoYXJzLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYGVuY29kaW5nIHRlcm1pbmF0ZWQgZWFybHk6ICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gIHJldHVybiBoYXJkZW4oZWxlbWVudHMpO1xufTtcbnZhciBlbmNvZGVSZWNvcmQgPSAocmVjb3JkLCBlbmNvZGVBcnJheSwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgY29uc3QgbmFtZXMgPSByZWNvcmROYW1lcyhyZWNvcmQpO1xuICBjb25zdCB2YWx1ZXM2ID0gcmVjb3JkVmFsdWVzKHJlY29yZCwgbmFtZXMpO1xuICByZXR1cm4gYCgke2VuY29kZUFycmF5KGhhcmRlbihbbmFtZXMsIHZhbHVlczZdKSwgZW5jb2RlUGFzc2FibGUpfWA7XG59O1xudmFyIGRlY29kZVJlY29yZCA9IChlbmNvZGVkLCBkZWNvZGVBcnJheSwgZGVjb2RlUGFzc2FibGUsIHNraXAgPSAwKSA9PiB7XG4gIGFzc2VydChlbmNvZGVkLmNoYXJBdChza2lwKSA9PT0gXCIoXCIpO1xuICBjb25zdCB1bnppcHBlZEVudHJpZXMgPSBkZWNvZGVBcnJheShlbmNvZGVkLCBkZWNvZGVQYXNzYWJsZSwgc2tpcCArIDEpO1xuICB1bnppcHBlZEVudHJpZXMubGVuZ3RoID09PSAyIHx8IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQga2V5cyx2YWx1ZXMgcGFpcjogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgY29uc3QgW2tleXM0LCB2YWxzXSA9IHVuemlwcGVkRW50cmllcztcbiAgcGFzc1N0eWxlT2Yoa2V5czQpID09PSBcImNvcHlBcnJheVwiICYmIHBhc3NTdHlsZU9mKHZhbHMpID09PSBcImNvcHlBcnJheVwiICYmIGtleXM0Lmxlbmd0aCA9PT0gdmFscy5sZW5ndGggJiYga2V5czQuZXZlcnkoKGtleSkgPT4gdHlwZW9mIGtleSA9PT0gXCJzdHJpbmdcIikgfHwgdGhyb3dSZWRhY3RlZGBub3QgYSB2YWxpZCByZWNvcmQgZW5jb2Rpbmc6ICR7Z2V0U3VmZml4KGVuY29kZWQsIHNraXApfWA7XG4gIGNvbnN0IG1hcEVudHJpZXMgPSBrZXlzNC5tYXAoKGtleSwgaTIpID0+IFtrZXksIHZhbHNbaTJdXSk7XG4gIGNvbnN0IHJlY29yZCA9IGhhcmRlbihmcm9tRW50cmllczUobWFwRW50cmllcykpO1xuICBhc3NlcnRSZWNvcmQocmVjb3JkLCBcImRlY29kZWQgcmVjb3JkXCIpO1xuICByZXR1cm4gcmVjb3JkO1xufTtcbnZhciBlbmNvZGVUYWdnZWQgPSAodGFnZ2VkLCBlbmNvZGVBcnJheSwgZW5jb2RlUGFzc2FibGUpID0+IGA6JHtlbmNvZGVBcnJheShoYXJkZW4oW2dldFRhZyh0YWdnZWQpLCB0YWdnZWQucGF5bG9hZF0pLCBlbmNvZGVQYXNzYWJsZSl9YDtcbnZhciBkZWNvZGVUYWdnZWQgPSAoZW5jb2RlZCwgZGVjb2RlQXJyYXksIGRlY29kZVBhc3NhYmxlLCBza2lwID0gMCkgPT4ge1xuICBhc3NlcnQoZW5jb2RlZC5jaGFyQXQoc2tpcCkgPT09IFwiOlwiKTtcbiAgY29uc3QgdGFnZ2VkUGF5bG9hZCA9IGRlY29kZUFycmF5KGVuY29kZWQsIGRlY29kZVBhc3NhYmxlLCBza2lwICsgMSk7XG4gIHRhZ2dlZFBheWxvYWQubGVuZ3RoID09PSAyIHx8IHRocm93UmVkYWN0ZWRgZXhwZWN0ZWQgdGFnLHBheWxvYWQgcGFpcjogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgY29uc3QgW3RhZywgcGF5bG9hZF0gPSB0YWdnZWRQYXlsb2FkO1xuICBwYXNzU3R5bGVPZih0YWcpID09PSBcInN0cmluZ1wiIHx8IHRocm93UmVkYWN0ZWRgbm90IGEgdmFsaWQgdGFnZ2VkIGVuY29kaW5nOiAke2dldFN1ZmZpeChlbmNvZGVkLCBza2lwKX1gO1xuICByZXR1cm4gbWFrZVRhZ2dlZCh0YWcsIHBheWxvYWQpO1xufTtcbnZhciBtYWtlRW5jb2RlUmVtb3RhYmxlID0gKHVuc2FmZUVuY29kZVJlbW90YWJsZSwgdmVyaWZ5RW5jb2RpbmcpID0+IHtcbiAgY29uc3QgZW5jb2RlUmVtb3RhYmxlID0gKHI1LCBpbm5lckVuY29kZSkgPT4ge1xuICAgIGNvbnN0IGVuY29kaW5nID0gdW5zYWZlRW5jb2RlUmVtb3RhYmxlKHI1LCBpbm5lckVuY29kZSk7XG4gICAgdHlwZW9mIGVuY29kaW5nID09PSBcInN0cmluZ1wiICYmIGVuY29kaW5nLmNoYXJBdCgwKSA9PT0gXCJyXCIgfHwgdGhyb3dSZWRhY3RlZGBSZW1vdGFibGUgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiclwiOiAke2VuY29kaW5nfWA7XG4gICAgdmVyaWZ5RW5jb2RpbmcoZW5jb2RpbmcsIFwiUmVtb3RhYmxlXCIpO1xuICAgIHJldHVybiBlbmNvZGluZztcbiAgfTtcbiAgcmV0dXJuIGVuY29kZVJlbW90YWJsZTtcbn07XG52YXIgbWFrZUVuY29kZVByb21pc2UgPSAodW5zYWZlRW5jb2RlUHJvbWlzZSwgdmVyaWZ5RW5jb2RpbmcpID0+IHtcbiAgY29uc3QgZW5jb2RlUHJvbWlzZSA9IChwMywgaW5uZXJFbmNvZGUpID0+IHtcbiAgICBjb25zdCBlbmNvZGluZyA9IHVuc2FmZUVuY29kZVByb21pc2UocDMsIGlubmVyRW5jb2RlKTtcbiAgICB0eXBlb2YgZW5jb2RpbmcgPT09IFwic3RyaW5nXCIgJiYgZW5jb2RpbmcuY2hhckF0KDApID09PSBcIj9cIiB8fCB0aHJvd1JlZGFjdGVkYFByb21pc2UgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiP1wiOiAke2VuY29kaW5nfWA7XG4gICAgdmVyaWZ5RW5jb2RpbmcoZW5jb2RpbmcsIFwiUHJvbWlzZVwiKTtcbiAgICByZXR1cm4gZW5jb2Rpbmc7XG4gIH07XG4gIHJldHVybiBlbmNvZGVQcm9taXNlO1xufTtcbnZhciBtYWtlRW5jb2RlRXJyb3IgPSAodW5zYWZlRW5jb2RlRXJyb3IsIHZlcmlmeUVuY29kaW5nKSA9PiB7XG4gIGNvbnN0IGVuY29kZUVycm9yID0gKGVyciwgaW5uZXJFbmNvZGUpID0+IHtcbiAgICBjb25zdCBlbmNvZGluZyA9IHVuc2FmZUVuY29kZUVycm9yKGVyciwgaW5uZXJFbmNvZGUpO1xuICAgIHR5cGVvZiBlbmNvZGluZyA9PT0gXCJzdHJpbmdcIiAmJiBlbmNvZGluZy5jaGFyQXQoMCkgPT09IFwiIVwiIHx8IHRocm93UmVkYWN0ZWRgRXJyb3IgZW5jb2RpbmcgbXVzdCBzdGFydCB3aXRoIFwiIVwiOiAke2VuY29kaW5nfWA7XG4gICAgdmVyaWZ5RW5jb2RpbmcoZW5jb2RpbmcsIFwiRXJyb3JcIik7XG4gICAgcmV0dXJuIGVuY29kaW5nO1xuICB9O1xuICByZXR1cm4gZW5jb2RlRXJyb3I7XG59O1xudmFyIG1ha2VJbm5lckVuY29kZSA9IChlbmNvZGVTdHJpbmdTdWZmaXgsIGVuY29kZUFycmF5LCBvcHRpb25zKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBlbmNvZGVSZW1vdGFibGU6IHVuc2FmZUVuY29kZVJlbW90YWJsZSxcbiAgICBlbmNvZGVQcm9taXNlOiB1bnNhZmVFbmNvZGVQcm9taXNlLFxuICAgIGVuY29kZUVycm9yOiB1bnNhZmVFbmNvZGVFcnJvcixcbiAgICB2ZXJpZnlFbmNvZGluZyA9ICgpID0+IHtcbiAgICB9XG4gIH0gPSBvcHRpb25zO1xuICBjb25zdCBlbmNvZGVSZW1vdGFibGUgPSBtYWtlRW5jb2RlUmVtb3RhYmxlKFxuICAgIHVuc2FmZUVuY29kZVJlbW90YWJsZSxcbiAgICB2ZXJpZnlFbmNvZGluZ1xuICApO1xuICBjb25zdCBlbmNvZGVQcm9taXNlID0gbWFrZUVuY29kZVByb21pc2UodW5zYWZlRW5jb2RlUHJvbWlzZSwgdmVyaWZ5RW5jb2RpbmcpO1xuICBjb25zdCBlbmNvZGVFcnJvciA9IG1ha2VFbmNvZGVFcnJvcih1bnNhZmVFbmNvZGVFcnJvciwgdmVyaWZ5RW5jb2RpbmcpO1xuICBjb25zdCBpbm5lckVuY29kZSA9IChwYXNzYWJsZSkgPT4ge1xuICAgIGlmIChpc0Vycm9yTGlrZShwYXNzYWJsZSkpIHtcbiAgICAgIHJldHVybiBlbmNvZGVFcnJvcihwYXNzYWJsZSwgaW5uZXJFbmNvZGUpO1xuICAgIH1cbiAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihwYXNzYWJsZSk7XG4gICAgc3dpdGNoIChwYXNzU3R5bGUpIHtcbiAgICAgIGNhc2UgXCJudWxsXCI6IHtcbiAgICAgICAgcmV0dXJuIFwidlwiO1xuICAgICAgfVxuICAgICAgY2FzZSBcInVuZGVmaW5lZFwiOiB7XG4gICAgICAgIHJldHVybiBcInpcIjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJudW1iZXJcIjoge1xuICAgICAgICByZXR1cm4gZW5jb2RlQmluYXJ5NjQocGFzc2FibGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcInN0cmluZ1wiOiB7XG4gICAgICAgIHJldHVybiBgcyR7ZW5jb2RlU3RyaW5nU3VmZml4KHBhc3NhYmxlKX1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJvb2xlYW5cIjoge1xuICAgICAgICByZXR1cm4gYGIke3Bhc3NhYmxlfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYmlnaW50XCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZUJpZ0ludChwYXNzYWJsZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZVJlbW90YWJsZShwYXNzYWJsZSwgaW5uZXJFbmNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZUVycm9yKHBhc3NhYmxlLCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVQcm9taXNlKHBhc3NhYmxlLCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgY29uc3QgbmFtZSA9IG5hbWVGb3JQYXNzYWJsZVN5bWJvbChwYXNzYWJsZSk7XG4gICAgICAgIGFzc2VydC50eXBlb2YobmFtZSwgXCJzdHJpbmdcIik7XG4gICAgICAgIHJldHVybiBgeSR7ZW5jb2RlU3RyaW5nU3VmZml4KG5hbWUpfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZUFycmF5KHBhc3NhYmxlLCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIHJldHVybiBlbmNvZGVSZWNvcmQocGFzc2FibGUsIGVuY29kZUFycmF5LCBpbm5lckVuY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgcmV0dXJuIGVuY29kZVRhZ2dlZChwYXNzYWJsZSwgZW5jb2RlQXJyYXksIGlubmVyRW5jb2RlKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBhICR7cXVvdGUocGFzc1N0eWxlKX0gY2Fubm90IGJlIHVzZWQgYXMgYSBjb2xsZWN0aW9uIHBhc3NhYmxlYDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiBpbm5lckVuY29kZTtcbn07XG52YXIgbGliZXJhbERlY29kZXJzID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAvKiAgICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBkZWNvZGVSZW1vdGFibGU6IChfZW5jb2RpbmcsIF9pbm5lckRlY29kZSkgPT4gdm9pZCAwLFxuICAgIGRlY29kZVByb21pc2U6IChfZW5jb2RpbmcsIF9pbm5lckRlY29kZSkgPT4gdm9pZCAwLFxuICAgIGRlY29kZUVycm9yOiAoX2VuY29kaW5nLCBfaW5uZXJEZWNvZGUpID0+IHZvaWQgMFxuICB9XG4pO1xudmFyIG1ha2VJbm5lckRlY29kZSA9IChkZWNvZGVTdHJpbmdTdWZmaXgsIGRlY29kZUFycmF5LCBvcHRpb25zKSA9PiB7XG4gIGNvbnN0IHsgZGVjb2RlUmVtb3RhYmxlLCBkZWNvZGVQcm9taXNlLCBkZWNvZGVFcnJvciB9ID0gb3B0aW9ucztcbiAgY29uc3QgaW5uZXJEZWNvZGUgPSAoZW5jb2RlZCwgc2tpcCA9IDApID0+IHtcbiAgICBzd2l0Y2ggKGVuY29kZWQuY2hhckF0KHNraXApKSB7XG4gICAgICBjYXNlIFwidlwiOiB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgY2FzZSBcInpcIjoge1xuICAgICAgICByZXR1cm4gdm9pZCAwO1xuICAgICAgfVxuICAgICAgY2FzZSBcImZcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlQmluYXJ5NjQoZW5jb2RlZCwgc2tpcCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwic1wiOiB7XG4gICAgICAgIHJldHVybiBkZWNvZGVTdHJpbmdTdWZmaXgoZ2V0U3VmZml4KGVuY29kZWQsIHNraXAgKyAxKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYlwiOiB7XG4gICAgICAgIGNvbnN0IHN1YnN0cmluZyA9IGdldFN1ZmZpeChlbmNvZGVkLCBza2lwICsgMSk7XG4gICAgICAgIGlmIChzdWJzdHJpbmcgPT09IFwidHJ1ZVwiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoc3Vic3RyaW5nID09PSBcImZhbHNlXCIpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBleHBlY3RlZCBlbmNvZGVkIGJvb2xlYW4gdG8gYmUgXCJidHJ1ZVwiIG9yIFwiYmZhbHNlXCI6ICR7c3Vic3RyaW5nfWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwiblwiOlxuICAgICAgY2FzZSBcInBcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlQmlnSW50KGdldFN1ZmZpeChlbmNvZGVkLCBza2lwKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiclwiOiB7XG4gICAgICAgIHJldHVybiBkZWNvZGVSZW1vdGFibGUoZ2V0U3VmZml4KGVuY29kZWQsIHNraXApLCBpbm5lckRlY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiP1wiOiB7XG4gICAgICAgIHJldHVybiBkZWNvZGVQcm9taXNlKGdldFN1ZmZpeChlbmNvZGVkLCBza2lwKSwgaW5uZXJEZWNvZGUpO1xuICAgICAgfVxuICAgICAgY2FzZSBcIiFcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlRXJyb3IoZ2V0U3VmZml4KGVuY29kZWQsIHNraXApLCBpbm5lckRlY29kZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwieVwiOiB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSBkZWNvZGVTdHJpbmdTdWZmaXgoZ2V0U3VmZml4KGVuY29kZWQsIHNraXAgKyAxKSk7XG4gICAgICAgIHJldHVybiBwYXNzYWJsZVN5bWJvbEZvck5hbWUobmFtZSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiW1wiOlxuICAgICAgY2FzZSBcIl5cIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlQXJyYXkoZW5jb2RlZCwgaW5uZXJEZWNvZGUsIHNraXApO1xuICAgICAgfVxuICAgICAgY2FzZSBcIihcIjoge1xuICAgICAgICByZXR1cm4gZGVjb2RlUmVjb3JkKGVuY29kZWQsIGRlY29kZUFycmF5LCBpbm5lckRlY29kZSwgc2tpcCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiOlwiOiB7XG4gICAgICAgIHJldHVybiBkZWNvZGVUYWdnZWQoZW5jb2RlZCwgZGVjb2RlQXJyYXksIGlubmVyRGVjb2RlLCBza2lwKTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnZhbGlkIGRhdGFiYXNlIGtleTogJHtnZXRTdWZmaXgoZW5jb2RlZCwgc2tpcCl9YDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiBpbm5lckRlY29kZTtcbn07XG52YXIgbWFrZVBhc3NhYmxlS2l0ID0gKG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgZW5jb2RlUmVtb3RhYmxlID0gKHI1LCBfKSA9PiB0aHJvd1JlZGFjdGVkYHJlbW90YWJsZSB1bmV4cGVjdGVkOiAke3I1fWAsXG4gICAgZW5jb2RlUHJvbWlzZSA9IChwMywgXykgPT4gdGhyb3dSZWRhY3RlZGBwcm9taXNlIHVuZXhwZWN0ZWQ6ICR7cDN9YCxcbiAgICBlbmNvZGVFcnJvciA9IChlcnIsIF8pID0+IHRocm93UmVkYWN0ZWRgZXJyb3IgdW5leHBlY3RlZDogJHtlcnJ9YCxcbiAgICBmb3JtYXQgPSBcImxlZ2FjeU9yZGVyZWRcIixcbiAgICBkZWNvZGVSZW1vdGFibGUgPSAoZW5jb2RpbmcsIF8pID0+IHRocm93UmVkYWN0ZWRgcmVtb3RhYmxlIHVuZXhwZWN0ZWQ6ICR7ZW5jb2Rpbmd9YCxcbiAgICBkZWNvZGVQcm9taXNlID0gKGVuY29kaW5nLCBfKSA9PiB0aHJvd1JlZGFjdGVkYHByb21pc2UgdW5leHBlY3RlZDogJHtlbmNvZGluZ31gLFxuICAgIGRlY29kZUVycm9yID0gKGVuY29kaW5nLCBfKSA9PiB0aHJvd1JlZGFjdGVkYGVycm9yIHVuZXhwZWN0ZWQ6ICR7ZW5jb2Rpbmd9YFxuICB9ID0gb3B0aW9ucztcbiAgbGV0IGVuY29kZVBhc3NhYmxlO1xuICBjb25zdCBlbmNvZGVPcHRpb25zID0geyBlbmNvZGVSZW1vdGFibGUsIGVuY29kZVByb21pc2UsIGVuY29kZUVycm9yLCBmb3JtYXQgfTtcbiAgaWYgKGZvcm1hdCA9PT0gXCJjb21wYWN0T3JkZXJlZFwiKSB7XG4gICAgY29uc3QgbGliZXJhbERlY29kZSA9IG1ha2VJbm5lckRlY29kZShcbiAgICAgIGRlY29kZUNvbXBhY3RTdHJpbmdTdWZmaXgsXG4gICAgICBkZWNvZGVDb21wYWN0QXJyYXksXG4gICAgICBsaWJlcmFsRGVjb2RlcnNcbiAgICApO1xuICAgIGNvbnN0IHZlcmlmeUVuY29kaW5nID0gKGVuY29kaW5nLCBsYWJlbCkgPT4ge1xuICAgICAgIWVuY29kaW5nLm1hdGNoKHJDMCkgfHwgdGhyb3dSZWRhY3RlZGAke2JhcmVPclF1b3RlKFxuICAgICAgICBsYWJlbFxuICAgICAgKX0gZW5jb2RpbmcgbXVzdCBub3QgY29udGFpbiBhIEMwIGNvbnRyb2wgY2hhcmFjdGVyOiAke2VuY29kaW5nfWA7XG4gICAgICBjb25zdCBkZWNvZGVkID0gZGVjb2RlQ29tcGFjdEFycmF5KGBediAke2VuY29kaW5nfSB2IGAsIGxpYmVyYWxEZWNvZGUpO1xuICAgICAgaXNBcnJheTgoZGVjb2RlZCkgJiYgZGVjb2RlZC5sZW5ndGggPT09IDMgJiYgZGVjb2RlZFswXSA9PT0gbnVsbCAmJiBkZWNvZGVkWzJdID09PSBudWxsIHx8IHRocm93UmVkYWN0ZWRgJHtiYXJlT3JRdW90ZShsYWJlbCl9IGVuY29kaW5nIG11c3QgYmUgZW1iZWRkYWJsZTogJHtlbmNvZGluZ31gO1xuICAgIH07XG4gICAgY29uc3QgZW5jb2RlQ29tcGFjdCA9IG1ha2VJbm5lckVuY29kZShcbiAgICAgIGVuY29kZUNvbXBhY3RTdHJpbmdTdWZmaXgsXG4gICAgICBlbmNvZGVDb21wYWN0QXJyYXksXG4gICAgICB7IC4uLmVuY29kZU9wdGlvbnMsIHZlcmlmeUVuY29kaW5nIH1cbiAgICApO1xuICAgIGVuY29kZVBhc3NhYmxlID0gKHBhc3NhYmxlKSA9PiBgfiR7ZW5jb2RlQ29tcGFjdChwYXNzYWJsZSl9YDtcbiAgfSBlbHNlIGlmIChmb3JtYXQgPT09IFwibGVnYWN5T3JkZXJlZFwiKSB7XG4gICAgZW5jb2RlUGFzc2FibGUgPSBtYWtlSW5uZXJFbmNvZGUoXG4gICAgICBlbmNvZGVMZWdhY3lTdHJpbmdTdWZmaXgsXG4gICAgICBlbmNvZGVMZWdhY3lBcnJheSxcbiAgICAgIGVuY29kZU9wdGlvbnNcbiAgICApO1xuICB9IGVsc2Uge1xuICAgIHRocm93IHRocm93UmVkYWN0ZWRgVW5yZWNvZ25pemVkIGZvcm1hdDogJHtxdW90ZShmb3JtYXQpfWA7XG4gIH1cbiAgY29uc3QgZGVjb2RlT3B0aW9ucyA9IHsgZGVjb2RlUmVtb3RhYmxlLCBkZWNvZGVQcm9taXNlLCBkZWNvZGVFcnJvciB9O1xuICBjb25zdCBkZWNvZGVDb21wYWN0ID0gbWFrZUlubmVyRGVjb2RlKFxuICAgIGRlY29kZUNvbXBhY3RTdHJpbmdTdWZmaXgsXG4gICAgZGVjb2RlQ29tcGFjdEFycmF5LFxuICAgIGRlY29kZU9wdGlvbnNcbiAgKTtcbiAgY29uc3QgZGVjb2RlTGVnYWN5ID0gbWFrZUlubmVyRGVjb2RlKFxuICAgIGRlY29kZUxlZ2FjeVN0cmluZ1N1ZmZpeCxcbiAgICBkZWNvZGVMZWdhY3lBcnJheSxcbiAgICBkZWNvZGVPcHRpb25zXG4gICk7XG4gIGNvbnN0IGRlY29kZVBhc3NhYmxlID0gKGVuY29kZWQpID0+IHtcbiAgICBpZiAoZW5jb2RlZC5jaGFyQXQoMCkgPT09IFwiflwiKSB7XG4gICAgICByZXR1cm4gZGVjb2RlQ29tcGFjdChlbmNvZGVkLCAxKTtcbiAgICB9XG4gICAgcmV0dXJuIGRlY29kZUxlZ2FjeShlbmNvZGVkKTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IGVuY29kZVBhc3NhYmxlLCBkZWNvZGVQYXNzYWJsZSB9KTtcbn07XG5oYXJkZW4obWFrZVBhc3NhYmxlS2l0KTtcbnZhciBtYWtlRW5jb2RlUGFzc2FibGUgPSAoZW5jb2RlT3B0aW9ucykgPT4ge1xuICBjb25zdCB7IGVuY29kZVBhc3NhYmxlIH0gPSBtYWtlUGFzc2FibGVLaXQoZW5jb2RlT3B0aW9ucyk7XG4gIHJldHVybiBlbmNvZGVQYXNzYWJsZTtcbn07XG5oYXJkZW4obWFrZUVuY29kZVBhc3NhYmxlKTtcbnZhciBtYWtlRGVjb2RlUGFzc2FibGUgPSAoZGVjb2RlT3B0aW9ucykgPT4ge1xuICBjb25zdCB7IGRlY29kZVBhc3NhYmxlIH0gPSBtYWtlUGFzc2FibGVLaXQoZGVjb2RlT3B0aW9ucyk7XG4gIHJldHVybiBkZWNvZGVQYXNzYWJsZTtcbn07XG5oYXJkZW4obWFrZURlY29kZVBhc3NhYmxlKTtcbnZhciBpc0VuY29kZWRSZW1vdGFibGUgPSAoZW5jb2RlZCkgPT4gZW5jb2RlZC5jaGFyQXQoMCkgPT09IFwiclwiO1xuaGFyZGVuKGlzRW5jb2RlZFJlbW90YWJsZSk7XG52YXIgcGFzc1N0eWxlUHJlZml4ZXMgPSB7XG4gIGVycm9yOiBcIiFcIixcbiAgY29weVJlY29yZDogXCIoXCIsXG4gIHRhZ2dlZDogXCI6XCIsXG4gIHByb21pc2U6IFwiP1wiLFxuICBjb3B5QXJyYXk6IFwiW15cIixcbiAgYm9vbGVhbjogXCJiXCIsXG4gIG51bWJlcjogXCJmXCIsXG4gIGJpZ2ludDogXCJucFwiLFxuICByZW1vdGFibGU6IFwiclwiLFxuICBzdHJpbmc6IFwic1wiLFxuICBudWxsOiBcInZcIixcbiAgc3ltYm9sOiBcInlcIixcbiAgLy9cbiAgLy9cbiAgLy9cbiAgdW5kZWZpbmVkOiBcInpcIlxufTtcbk9iamVjdC5zZXRQcm90b3R5cGVPZihwYXNzU3R5bGVQcmVmaXhlcywgbnVsbCk7XG5oYXJkZW4ocGFzc1N0eWxlUHJlZml4ZXMpO1xuXG4vL1xudmFyIHsgZW50cmllczogZW50cmllczYsIGZyb21FbnRyaWVzOiBmcm9tRW50cmllczYsIHNldFByb3RvdHlwZU9mOiBzZXRQcm90b3R5cGVPZjIsIGlzOiBpczQgfSA9IE9iamVjdDtcbnZhciBzYW1lVmFsdWVaZXJvID0gKHgsIHkpID0+IHggPT09IHkgfHwgaXM0KHgsIHkpO1xudmFyIHRyaXZpYWxDb21wYXJhdG9yID0gKGxlZnQsIHJpZ2h0KSA9PiAoXG4gIC8vXG4gIGxlZnQgPCByaWdodCA/IC0xIDogbGVmdCA9PT0gcmlnaHQgPyAwIDogMVxuKTtcbnZhciBwYXNzU3R5bGVSYW5rcyA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgZnJvbUVudHJpZXM2KFxuICAgIGVudHJpZXM2KHBhc3NTdHlsZVByZWZpeGVzKS5zb3J0KChbX2xlZnRTdHlsZSwgbGVmdFByZWZpeGVzXSwgW19yaWdodFN0eWxlLCByaWdodFByZWZpeGVzXSkgPT4ge1xuICAgICAgcmV0dXJuIHRyaXZpYWxDb21wYXJhdG9yKGxlZnRQcmVmaXhlcywgcmlnaHRQcmVmaXhlcyk7XG4gICAgfSkubWFwKChbcGFzc1N0eWxlLCBwcmVmaXhlc10sIGluZGV4KSA9PiB7XG4gICAgICBwcmVmaXhlcyA9PT0gWy4uLnByZWZpeGVzXS5zb3J0KCkuam9pbihcIlwiKSB8fCB0aHJvd1JlZGFjdGVkYHVuc29ydGVkIHByZWZpeGVzIGZvciBwYXNzU3R5bGUgJHtxdW90ZShwYXNzU3R5bGUpfTogJHtxdW90ZShwcmVmaXhlcyl9YDtcbiAgICAgIGNvbnN0IGNvdmVyID0gW1xuICAgICAgICBwcmVmaXhlcy5jaGFyQXQoMCksXG4gICAgICAgIFN0cmluZy5mcm9tQ2hhckNvZGUocHJlZml4ZXMuY2hhckNvZGVBdChwcmVmaXhlcy5sZW5ndGggLSAxKSArIDEpXG4gICAgICBdO1xuICAgICAgcmV0dXJuIFtwYXNzU3R5bGUsIHsgaW5kZXgsIGNvdmVyIH1dO1xuICAgIH0pXG4gIClcbik7XG5zZXRQcm90b3R5cGVPZjIocGFzc1N0eWxlUmFua3MsIG51bGwpO1xuaGFyZGVuKHBhc3NTdHlsZVJhbmtzKTtcbnZhciBnZXRQYXNzU3R5bGVDb3ZlciA9IChwYXNzU3R5bGUpID0+IHBhc3NTdHlsZVJhbmtzW3Bhc3NTdHlsZV0uY292ZXI7XG5oYXJkZW4oZ2V0UGFzc1N0eWxlQ292ZXIpO1xudmFyIG1lbW9PZlNvcnRlZCA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xudmFyIGNvbXBhcmF0b3JNaXJyb3JJbWFnZXMgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbnZhciBtYWtlQ29tcGFyYXRvcktpdCA9IChjb21wYXJlUmVtb3RhYmxlcyA9IChfeCwgX3kpID0+IE5hTikgPT4ge1xuICBjb25zdCBjb21wYXJhdG9yID0gKGxlZnQsIHJpZ2h0KSA9PiB7XG4gICAgaWYgKHNhbWVWYWx1ZVplcm8obGVmdCwgcmlnaHQpKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgY29uc3QgbGVmdFN0eWxlID0gcGFzc1N0eWxlT2YobGVmdCk7XG4gICAgY29uc3QgcmlnaHRTdHlsZSA9IHBhc3NTdHlsZU9mKHJpZ2h0KTtcbiAgICBpZiAobGVmdFN0eWxlICE9PSByaWdodFN0eWxlKSB7XG4gICAgICByZXR1cm4gdHJpdmlhbENvbXBhcmF0b3IoXG4gICAgICAgIHBhc3NTdHlsZVJhbmtzW2xlZnRTdHlsZV0uaW5kZXgsXG4gICAgICAgIHBhc3NTdHlsZVJhbmtzW3JpZ2h0U3R5bGVdLmluZGV4XG4gICAgICApO1xuICAgIH1cbiAgICBzd2l0Y2ggKGxlZnRTdHlsZSkge1xuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIHJldHVybiBjb21wYXJlUmVtb3RhYmxlcyhsZWZ0LCByaWdodCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgICBjYXNlIFwibnVsbFwiOlxuICAgICAgY2FzZSBcImVycm9yXCI6XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgIGNhc2UgXCJiaWdpbnRcIjpcbiAgICAgIGNhc2UgXCJzdHJpbmdcIjoge1xuICAgICAgICBpZiAobGVmdCA8IHJpZ2h0KSB7XG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFzc2VydChsZWZ0ID4gcmlnaHQpO1xuICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjYXNlIFwic3ltYm9sXCI6IHtcbiAgICAgICAgcmV0dXJuIGNvbXBhcmF0b3IoXG4gICAgICAgICAgbmFtZUZvclBhc3NhYmxlU3ltYm9sKGxlZnQpLFxuICAgICAgICAgIG5hbWVGb3JQYXNzYWJsZVN5bWJvbChyaWdodClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJudW1iZXJcIjoge1xuICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKGxlZnQpKSB7XG4gICAgICAgICAgYXNzZXJ0KCFOdW1iZXIuaXNOYU4ocmlnaHQpKTtcbiAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgfSBlbHNlIGlmIChOdW1iZXIuaXNOYU4ocmlnaHQpKSB7XG4gICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsZWZ0IDwgcmlnaHQpIHtcbiAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXNzZXJ0KGxlZnQgPiByaWdodCk7XG4gICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgY29uc3QgbGVmdE5hbWVzID0gcmVjb3JkTmFtZXMobGVmdCk7XG4gICAgICAgIGNvbnN0IHJpZ2h0TmFtZXMgPSByZWNvcmROYW1lcyhyaWdodCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbXBhcmF0b3IobGVmdE5hbWVzLCByaWdodE5hbWVzKTtcbiAgICAgICAgaWYgKHJlc3VsdCAhPT0gMCkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGVmdFZhbHVlcyA9IHJlY29yZFZhbHVlcyhsZWZ0LCBsZWZ0TmFtZXMpO1xuICAgICAgICBjb25zdCByaWdodFZhbHVlcyA9IHJlY29yZFZhbHVlcyhyaWdodCwgcmlnaHROYW1lcyk7XG4gICAgICAgIHJldHVybiBjb21wYXJhdG9yKGxlZnRWYWx1ZXMsIHJpZ2h0VmFsdWVzKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICBjb25zdCBsZW4gPSBNYXRoLm1pbihsZWZ0Lmxlbmd0aCwgcmlnaHQubGVuZ3RoKTtcbiAgICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlbjsgaTIgKz0gMSkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNvbXBhcmF0b3IobGVmdFtpMl0sIHJpZ2h0W2kyXSk7XG4gICAgICAgICAgaWYgKHJlc3VsdCAhPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbXBhcmF0b3IobGVmdC5sZW5ndGgsIHJpZ2h0Lmxlbmd0aCk7XG4gICAgICB9XG4gICAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgICAgY29uc3QgbGFiZWxDb21wID0gY29tcGFyYXRvcihnZXRUYWcobGVmdCksIGdldFRhZyhyaWdodCkpO1xuICAgICAgICBpZiAobGFiZWxDb21wICE9PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIGxhYmVsQ29tcDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29tcGFyYXRvcihsZWZ0LnBheWxvYWQsIHJpZ2h0LnBheWxvYWQpO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFVucmVjb2duaXplZCBwYXNzU3R5bGU6ICR7cXVvdGUobGVmdFN0eWxlKX1gO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3Qgb3V0ZXJDb21wYXJhdG9yID0gKHgsIHkpID0+IChcbiAgICAvL1xuICAgIC8vXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNvbXBhcmF0b3IoeCwgeSkgfHwgMFxuICApO1xuICBjb25zdCBhbnRpQ29tcGFyYXRvciA9ICh4LCB5KSA9PiBvdXRlckNvbXBhcmF0b3IoeSwgeCk7XG4gIG1lbW9PZlNvcnRlZC5zZXQob3V0ZXJDb21wYXJhdG9yLCAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKSk7XG4gIG1lbW9PZlNvcnRlZC5zZXQoYW50aUNvbXBhcmF0b3IsIC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpKTtcbiAgY29tcGFyYXRvck1pcnJvckltYWdlcy5zZXQob3V0ZXJDb21wYXJhdG9yLCBhbnRpQ29tcGFyYXRvcik7XG4gIGNvbXBhcmF0b3JNaXJyb3JJbWFnZXMuc2V0KGFudGlDb21wYXJhdG9yLCBvdXRlckNvbXBhcmF0b3IpO1xuICByZXR1cm4gaGFyZGVuKHsgY29tcGFyYXRvcjogb3V0ZXJDb21wYXJhdG9yLCBhbnRpQ29tcGFyYXRvciB9KTtcbn07XG52YXIgaXNSYW5rU29ydGVkID0gKHBhc3NhYmxlcywgY29tcGFyZSkgPT4ge1xuICBjb25zdCBzdWJNZW1vT2ZTb3J0ZWQgPSBtZW1vT2ZTb3J0ZWQuZ2V0KGNvbXBhcmUpO1xuICBhc3NlcnQoc3ViTWVtb09mU29ydGVkICE9PSB2b2lkIDApO1xuICBpZiAoc3ViTWVtb09mU29ydGVkLmhhcyhwYXNzYWJsZXMpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgYXNzZXJ0KHBhc3NTdHlsZU9mKHBhc3NhYmxlcykgPT09IFwiY29weUFycmF5XCIpO1xuICBmb3IgKGxldCBpMiA9IDE7IGkyIDwgcGFzc2FibGVzLmxlbmd0aDsgaTIgKz0gMSkge1xuICAgIGlmIChjb21wYXJlKHBhc3NhYmxlc1tpMiAtIDFdLCBwYXNzYWJsZXNbaTJdKSA+PSAxKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIHN1Yk1lbW9PZlNvcnRlZC5hZGQocGFzc2FibGVzKTtcbiAgcmV0dXJuIHRydWU7XG59O1xuaGFyZGVuKGlzUmFua1NvcnRlZCk7XG52YXIgYXNzZXJ0UmFua1NvcnRlZCA9IChzb3J0ZWQsIGNvbXBhcmUpID0+IGlzUmFua1NvcnRlZChzb3J0ZWQsIGNvbXBhcmUpIHx8IC8vXG4vL1xudGhyb3dSZWRhY3RlZGBNdXN0IGJlIHJhbmsgc29ydGVkOiAke3NvcnRlZH0gdnMgJHtzb3J0QnlSYW5rKHNvcnRlZCwgY29tcGFyZSl9YDtcbmhhcmRlbihhc3NlcnRSYW5rU29ydGVkKTtcbnZhciBzb3J0QnlSYW5rID0gKHBhc3NhYmxlcywgY29tcGFyZSkgPT4ge1xuICBpZiAoQXJyYXkuaXNBcnJheShwYXNzYWJsZXMpKSB7XG4gICAgaGFyZGVuKHBhc3NhYmxlcyk7XG4gICAgaWYgKGlzUmFua1NvcnRlZChwYXNzYWJsZXMsIGNvbXBhcmUpKSB7XG4gICAgICByZXR1cm4gcGFzc2FibGVzO1xuICAgIH1cbiAgfVxuICBjb25zdCB1bnNvcnRlZCA9IFsuLi5wYXNzYWJsZXNdO1xuICB1bnNvcnRlZC5mb3JFYWNoKGhhcmRlbik7XG4gIGNvbnN0IHNvcnRlZCA9IHVuc29ydGVkLnNvcnQoY29tcGFyZSk7XG4gIGlmIChjb21wYXJlKHRydWUsIHZvaWQgMCkgPiAwKSB7XG4gICAgbGV0IGkyID0gc29ydGVkLmxlbmd0aCAtIDE7XG4gICAgd2hpbGUgKGkyID49IDAgJiYgc29ydGVkW2kyXSA9PT0gdm9pZCAwKSBpMiAtPSAxO1xuICAgIGNvbnN0IG4yID0gc29ydGVkLmxlbmd0aCAtIGkyIC0gMTtcbiAgICBpZiAobjIgPiAwICYmIG4yIDwgc29ydGVkLmxlbmd0aCkge1xuICAgICAgc29ydGVkLmNvcHlXaXRoaW4objIsIDApO1xuICAgICAgc29ydGVkLmZpbGwoXG4gICAgICAgIC8qICAgICAgICAgICAgKi9cbiAgICAgICAgdm9pZCAwLFxuICAgICAgICAwLFxuICAgICAgICBuMlxuICAgICAgKTtcbiAgICB9XG4gIH1cbiAgaGFyZGVuKHNvcnRlZCk7XG4gIGNvbnN0IHN1Yk1lbW9PZlNvcnRlZCA9IG1lbW9PZlNvcnRlZC5nZXQoY29tcGFyZSk7XG4gIGFzc2VydChzdWJNZW1vT2ZTb3J0ZWQgIT09IHZvaWQgMCk7XG4gIHN1Yk1lbW9PZlNvcnRlZC5hZGQoc29ydGVkKTtcbiAgcmV0dXJuIHNvcnRlZDtcbn07XG5oYXJkZW4oc29ydEJ5UmFuayk7XG52YXIgcmFua1NlYXJjaCA9IChzb3J0ZWQsIGNvbXBhcmUsIGtleSwgYmlhcyA9IFwibGVmdE1vc3RcIikgPT4ge1xuICBhc3NlcnRSYW5rU29ydGVkKHNvcnRlZCwgY29tcGFyZSk7XG4gIGxldCBsZWZ0ID0gMDtcbiAgbGV0IHJpZ2h0ID0gc29ydGVkLmxlbmd0aDtcbiAgd2hpbGUgKGxlZnQgPCByaWdodCkge1xuICAgIGNvbnN0IG0yID0gTWF0aC5mbG9vcigobGVmdCArIHJpZ2h0KSAvIDIpO1xuICAgIGNvbnN0IGNvbXAgPSBjb21wYXJlKHNvcnRlZFttMl0sIGtleSk7XG4gICAgaWYgKGNvbXAgPD0gLTEgfHwgY29tcCA9PT0gMCAmJiBiaWFzID09PSBcInJpZ2h0TW9zdFwiKSB7XG4gICAgICBsZWZ0ID0gbTIgKyAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBhc3NlcnQoY29tcCA+PSAxIHx8IGNvbXAgPT09IDAgJiYgYmlhcyA9PT0gXCJsZWZ0TW9zdFwiKTtcbiAgICAgIHJpZ2h0ID0gbTI7XG4gICAgfVxuICB9XG4gIHJldHVybiBiaWFzID09PSBcImxlZnRNb3N0XCIgPyBsZWZ0IDogcmlnaHQgLSAxO1xufTtcbnZhciBnZXRJbmRleENvdmVyID0gKHNvcnRlZCwgY29tcGFyZSwgW2xlZnRLZXksIHJpZ2h0S2V5XSkgPT4ge1xuICBhc3NlcnRSYW5rU29ydGVkKHNvcnRlZCwgY29tcGFyZSk7XG4gIGNvbnN0IGxlZnRJbmRleCA9IHJhbmtTZWFyY2goc29ydGVkLCBjb21wYXJlLCBsZWZ0S2V5LCBcImxlZnRNb3N0XCIpO1xuICBjb25zdCByaWdodEluZGV4ID0gcmFua1NlYXJjaChzb3J0ZWQsIGNvbXBhcmUsIHJpZ2h0S2V5LCBcInJpZ2h0TW9zdFwiKTtcbiAgcmV0dXJuIFtsZWZ0SW5kZXgsIHJpZ2h0SW5kZXhdO1xufTtcbmhhcmRlbihnZXRJbmRleENvdmVyKTtcbnZhciBGdWxsUmFua0NvdmVyID0gaGFyZGVuKFtcIlwiLCBcIntcIl0pO1xudmFyIGNvdmVyZWRFbnRyaWVzID0gKHNvcnRlZCwgW2xlZnRJbmRleCwgcmlnaHRJbmRleF0pID0+IHtcbiAgY29uc3QgaXRlcmFibGUgPSBoYXJkZW4oe1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBsZXQgaTIgPSBsZWZ0SW5kZXg7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGlmIChpMiA8PSByaWdodEluZGV4KSB7XG4gICAgICAgICAgICBjb25zdCBlbGVtZW50ID0gc29ydGVkW2kyXTtcbiAgICAgICAgICAgIGkyICs9IDE7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWU6IFtpMiwgZWxlbWVudF0sIGRvbmU6IGZhbHNlIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWU6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBpdGVyYWJsZTtcbn07XG5oYXJkZW4oY292ZXJlZEVudHJpZXMpO1xudmFyIG1heFJhbmsgPSAoY29tcGFyZSwgYTIsIGIzKSA9PiBjb21wYXJlKGEyLCBiMykgPj0gMCA/IGEyIDogYjM7XG52YXIgbWluUmFuayA9IChjb21wYXJlLCBhMiwgYjMpID0+IGNvbXBhcmUoYTIsIGIzKSA8PSAwID8gYTIgOiBiMztcbnZhciB1bmlvblJhbmtDb3ZlcnMgPSAoY29tcGFyZSwgY292ZXJzKSA9PiB7XG4gIGNvbnN0IHVuaW9uUmFua0NvdmVyUGFpciA9IChbbGVmdEEsIHJpZ2h0QV0sIFtsZWZ0QiwgcmlnaHRCXSkgPT4gW1xuICAgIG1pblJhbmsoY29tcGFyZSwgbGVmdEEsIGxlZnRCKSxcbiAgICBtYXhSYW5rKGNvbXBhcmUsIHJpZ2h0QSwgcmlnaHRCKVxuICBdO1xuICByZXR1cm4gY292ZXJzLnJlZHVjZSh1bmlvblJhbmtDb3ZlclBhaXIsIFtcIntcIiwgXCJcIl0pO1xufTtcbmhhcmRlbih1bmlvblJhbmtDb3ZlcnMpO1xudmFyIGludGVyc2VjdFJhbmtDb3ZlcnMgPSAoY29tcGFyZSwgY292ZXJzKSA9PiB7XG4gIGNvbnN0IGludGVyc2VjdFJhbmtDb3ZlclBhaXIgPSAoW2xlZnRBLCByaWdodEFdLCBbbGVmdEIsIHJpZ2h0Ql0pID0+IFtcbiAgICBtYXhSYW5rKGNvbXBhcmUsIGxlZnRBLCBsZWZ0QiksXG4gICAgbWluUmFuayhjb21wYXJlLCByaWdodEEsIHJpZ2h0QilcbiAgXTtcbiAgcmV0dXJuIGNvdmVycy5yZWR1Y2UoaW50ZXJzZWN0UmFua0NvdmVyUGFpciwgW1wiXCIsIFwie1wiXSk7XG59O1xudmFyIHsgY29tcGFyYXRvcjogY29tcGFyZVJhbmssIGFudGlDb21wYXJhdG9yOiBjb21wYXJlQW50aVJhbmsgfSA9IG1ha2VDb21wYXJhdG9yS2l0KCk7XG52YXIgbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQgPSAobG9uZ0xpdmVkID0gZmFsc2UpID0+IHtcbiAgbGV0IG51bVNlZW4gPSAwO1xuICBjb25zdCBNYXBDb25zdHJ1Y3RvciA9IGxvbmdMaXZlZCA/IFdlYWtNYXAgOiBNYXA7XG4gIGNvbnN0IHNlZW4gPSBuZXcgTWFwQ29uc3RydWN0b3IoKTtcbiAgY29uc3QgdGFnID0gKHI1KSA9PiB7XG4gICAgaWYgKHNlZW4uaGFzKHI1KSkge1xuICAgICAgcmV0dXJuIHNlZW4uZ2V0KHI1KTtcbiAgICB9XG4gICAgbnVtU2VlbiArPSAxO1xuICAgIHNlZW4uc2V0KHI1LCBudW1TZWVuKTtcbiAgICByZXR1cm4gbnVtU2VlbjtcbiAgfTtcbiAgY29uc3QgY29tcGFyZVJlbW90YWJsZXMgPSAoeCwgeSkgPT4gY29tcGFyZVJhbmsodGFnKHgpLCB0YWcoeSkpO1xuICByZXR1cm4gbWFrZUNvbXBhcmF0b3JLaXQoY29tcGFyZVJlbW90YWJsZXMpO1xufTtcbmhhcmRlbihtYWtlRnVsbE9yZGVyQ29tcGFyYXRvcktpdCk7XG5cbi8vXG52YXIgaWRlbnRDaGVja2VyID0gKGNvbmQsIF9kZXRhaWxzKSA9PiBjb25kO1xuaGFyZGVuKGlkZW50Q2hlY2tlcik7XG5cbi8vXG52YXIgY2hlY2tOb0R1cGxpY2F0ZXMgPSAoZWxlbWVudHMsIGZ1bGxDb21wYXJlLCBjaGVjaykgPT4ge1xuICBmdWxsQ29tcGFyZSA9IGZ1bGxDb21wYXJlIHx8IG1ha2VGdWxsT3JkZXJDb21wYXJhdG9yS2l0KCkuYW50aUNvbXBhcmF0b3I7XG4gIGVsZW1lbnRzID0gc29ydEJ5UmFuayhlbGVtZW50cywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB7IGxlbmd0aCB9ID0gZWxlbWVudHM7XG4gIGZvciAobGV0IGkyID0gMTsgaTIgPCBsZW5ndGg7IGkyICs9IDEpIHtcbiAgICBjb25zdCBrMCA9IGVsZW1lbnRzW2kyIC0gMV07XG4gICAgY29uc3QgazEgPSBlbGVtZW50c1tpMl07XG4gICAgaWYgKGZ1bGxDb21wYXJlKGswLCBrMSkgPT09IDApIHtcbiAgICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgdmFsdWUgaGFzIGR1cGxpY2F0ZSBrZXlzOiAke2swfWApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgYXNzZXJ0Tm9EdXBsaWNhdGVzID0gKGVsZW1lbnRzLCBmdWxsQ29tcGFyZSA9IHZvaWQgMCkgPT4ge1xuICBjaGVja05vRHVwbGljYXRlcyhlbGVtZW50cywgZnVsbENvbXBhcmUsIGFzc2VydENoZWNrZXIpO1xufTtcbnZhciBjaGVja0VsZW1lbnRzID0gKGVsZW1lbnRzLCBjaGVjaykgPT4ge1xuICBpZiAocGFzc1N0eWxlT2YoZWxlbWVudHMpICE9PSBcImNvcHlBcnJheVwiKSB7XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgZmFsc2UsXG4gICAgICByZWRhY3RlZGBUaGUga2V5cyBvZiBhIGNvcHlTZXQgb3IgY29weU1hcCBtdXN0IGJlIGEgY29weUFycmF5OiAke2VsZW1lbnRzfWBcbiAgICApO1xuICB9XG4gIGlmICghaXNSYW5rU29ydGVkKGVsZW1lbnRzLCBjb21wYXJlQW50aVJhbmspKSB7XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgZmFsc2UsXG4gICAgICByZWRhY3RlZGBUaGUga2V5cyBvZiBhIGNvcHlTZXQgb3IgY29weU1hcCBtdXN0IGJlIHNvcnRlZCBpbiByZXZlcnNlIHJhbmsgb3JkZXI6ICR7ZWxlbWVudHN9YFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGNoZWNrTm9EdXBsaWNhdGVzKGVsZW1lbnRzLCB2b2lkIDAsIGNoZWNrKTtcbn07XG5oYXJkZW4oY2hlY2tFbGVtZW50cyk7XG52YXIgYXNzZXJ0RWxlbWVudHMgPSAoZWxlbWVudHMpID0+IHtcbiAgY2hlY2tFbGVtZW50cyhlbGVtZW50cywgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydEVsZW1lbnRzKTtcbnZhciBjb2VyY2VUb0VsZW1lbnRzID0gKGVsZW1lbnRzTGlzdCkgPT4ge1xuICBjb25zdCBlbGVtZW50cyA9IHNvcnRCeVJhbmsoZWxlbWVudHNMaXN0LCBjb21wYXJlQW50aVJhbmspO1xuICBhc3NlcnRFbGVtZW50cyhlbGVtZW50cyk7XG4gIHJldHVybiBlbGVtZW50cztcbn07XG5oYXJkZW4oY29lcmNlVG9FbGVtZW50cyk7XG52YXIgbWFrZVNldE9mRWxlbWVudHMgPSAoZWxlbWVudEl0ZXIpID0+IG1ha2VUYWdnZWQoXCJjb3B5U2V0XCIsIGNvZXJjZVRvRWxlbWVudHMoZWxlbWVudEl0ZXIpKTtcbmhhcmRlbihtYWtlU2V0T2ZFbGVtZW50cyk7XG5cbi8vXG52YXIgY2hlY2tOb0R1cGxpY2F0ZUtleXMgPSAoYmFnRW50cmllcywgZnVsbENvbXBhcmUsIGNoZWNrKSA9PiB7XG4gIGZ1bGxDb21wYXJlID0gZnVsbENvbXBhcmUgfHwgbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgYmFnRW50cmllcyA9IHNvcnRCeVJhbmsoYmFnRW50cmllcywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB7IGxlbmd0aCB9ID0gYmFnRW50cmllcztcbiAgZm9yIChsZXQgaTIgPSAxOyBpMiA8IGxlbmd0aDsgaTIgKz0gMSkge1xuICAgIGNvbnN0IGswID0gYmFnRW50cmllc1tpMiAtIDFdWzBdO1xuICAgIGNvbnN0IGsxID0gYmFnRW50cmllc1tpMl1bMF07XG4gICAgaWYgKGZ1bGxDb21wYXJlKGswLCBrMSkgPT09IDApIHtcbiAgICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgdmFsdWUgaGFzIGR1cGxpY2F0ZSBrZXlzOiAke2swfWApO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgYXNzZXJ0Tm9EdXBsaWNhdGVLZXlzID0gKGJhZ0VudHJpZXMsIGZ1bGxDb21wYXJlID0gdm9pZCAwKSA9PiB7XG4gIGNoZWNrTm9EdXBsaWNhdGVLZXlzKGJhZ0VudHJpZXMsIGZ1bGxDb21wYXJlLCBhc3NlcnRDaGVja2VyKTtcbn07XG52YXIgY2hlY2tCYWdFbnRyaWVzID0gKGJhZ0VudHJpZXMsIGNoZWNrKSA9PiB7XG4gIGlmIChwYXNzU3R5bGVPZihiYWdFbnRyaWVzKSAhPT0gXCJjb3B5QXJyYXlcIikge1xuICAgIHJldHVybiBjaGVjayhcbiAgICAgIGZhbHNlLFxuICAgICAgcmVkYWN0ZWRgVGhlIGVudHJpZXMgb2YgYSBjb3B5QmFnIG11c3QgYmUgYSBjb3B5QXJyYXk6ICR7YmFnRW50cmllc31gXG4gICAgKTtcbiAgfVxuICBpZiAoIWlzUmFua1NvcnRlZChiYWdFbnRyaWVzLCBjb21wYXJlQW50aVJhbmspKSB7XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgZmFsc2UsXG4gICAgICByZWRhY3RlZGBUaGUgZW50cmllcyBvZiBhIGNvcHlCYWcgbXVzdCBiZSBzb3J0ZWQgaW4gcmV2ZXJzZSByYW5rIG9yZGVyOiAke2JhZ0VudHJpZXN9YFxuICAgICk7XG4gIH1cbiAgZm9yIChjb25zdCBlbnRyeSBvZiBiYWdFbnRyaWVzKSB7XG4gICAgaWYgKHBhc3NTdHlsZU9mKGVudHJ5KSAhPT0gXCJjb3B5QXJyYXlcIiB8fCBlbnRyeS5sZW5ndGggIT09IDIgfHwgdHlwZW9mIGVudHJ5WzFdICE9PSBcImJpZ2ludFwiKSB7XG4gICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICByZWRhY3RlZGBFYWNoIGVudHJ5IG9mIGEgY29weUJhZyBtdXN0IGJlIHBhaXIgb2YgYSBrZXkgYW5kIGEgYmlnaW50IHJlcHJlc2VudGluZyBhIGNvdW50OiAke2VudHJ5fWBcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChlbnRyeVsxXSA8IDEpIHtcbiAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYEVhY2ggZW50cnkgb2YgYSBjb3B5QmFnIG11c3QgaGF2ZSBhIHBvc2l0aXZlIGNvdW50OiAke2VudHJ5fWBcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIHJldHVybiBjaGVja05vRHVwbGljYXRlS2V5cyhiYWdFbnRyaWVzLCB2b2lkIDAsIGNoZWNrKTtcbn07XG5oYXJkZW4oY2hlY2tCYWdFbnRyaWVzKTtcbnZhciBhc3NlcnRCYWdFbnRyaWVzID0gKGJhZ0VudHJpZXMpID0+IHtcbiAgY2hlY2tCYWdFbnRyaWVzKGJhZ0VudHJpZXMsIGFzc2VydENoZWNrZXIpO1xufTtcbmhhcmRlbihhc3NlcnRCYWdFbnRyaWVzKTtcbnZhciBjb2VyY2VUb0JhZ0VudHJpZXMgPSAoYmFnRW50cmllc0xpc3QpID0+IHtcbiAgY29uc3QgYmFnRW50cmllcyA9IHNvcnRCeVJhbmsoYmFnRW50cmllc0xpc3QsIGNvbXBhcmVBbnRpUmFuayk7XG4gIGFzc2VydEJhZ0VudHJpZXMoYmFnRW50cmllcyk7XG4gIHJldHVybiBiYWdFbnRyaWVzO1xufTtcbmhhcmRlbihjb2VyY2VUb0JhZ0VudHJpZXMpO1xudmFyIG1ha2VCYWdPZkVudHJpZXMgPSAoYmFnRW50cnlJdGVyKSA9PiBtYWtlVGFnZ2VkKFwiY29weUJhZ1wiLCBjb2VyY2VUb0JhZ0VudHJpZXMoYmFnRW50cnlJdGVyKSk7XG5oYXJkZW4obWFrZUJhZ09mRW50cmllcyk7XG5cbi8vXG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTUgfSA9IFJlZmxlY3Q7XG52YXIgY2hlY2tQcmltaXRpdmVLZXkgPSAodmFsLCBjaGVjaykgPT4ge1xuICBpZiAoaXNPYmplY3QyKHZhbCkpIHtcbiAgICByZXR1cm4gY2hlY2sgIT09IGlkZW50Q2hlY2tlciAmJiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSAke3F1b3RlKHR5cGVvZiB2YWwpfSBjYW5ub3QgYmUgYSBwcmltaXRpdmU6ICR7dmFsfWApO1xuICB9XG4gIGFzc2VydFBhc3NhYmxlKHZhbCk7XG4gIHJldHVybiB0cnVlO1xufTtcbnZhciBpc1ByaW1pdGl2ZUtleSA9ICh2YWwpID0+IGNoZWNrUHJpbWl0aXZlS2V5KHZhbCwgaWRlbnRDaGVja2VyKTtcbmhhcmRlbihpc1ByaW1pdGl2ZUtleSk7XG52YXIgYXNzZXJ0UHJpbWl0aXZlS2V5ID0gKHZhbCkgPT4ge1xuICBjaGVja1ByaW1pdGl2ZUtleSh2YWwsIGFzc2VydENoZWNrZXIpO1xufTtcbmhhcmRlbihhc3NlcnRQcmltaXRpdmVLZXkpO1xudmFyIGNoZWNrU2NhbGFyS2V5ID0gKHZhbCwgY2hlY2spID0+IHtcbiAgaWYgKGlzUHJpbWl0aXZlS2V5KHZhbCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZih2YWwpO1xuICBpZiAocGFzc1N0eWxlID09PSBcInJlbW90YWJsZVwiKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBBICR7cXVvdGUocGFzc1N0eWxlKX0gY2Fubm90IGJlIGEgc2NhbGFyIGtleTogJHt2YWx9YCk7XG59O1xudmFyIGlzU2NhbGFyS2V5ID0gKHZhbCkgPT4gY2hlY2tTY2FsYXJLZXkodmFsLCBpZGVudENoZWNrZXIpO1xuaGFyZGVuKGlzU2NhbGFyS2V5KTtcbnZhciBhc3NlcnRTY2FsYXJLZXkgPSAodmFsKSA9PiB7XG4gIGNoZWNrU2NhbGFyS2V5KHZhbCwgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydFNjYWxhcktleSk7XG52YXIga2V5TWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrS2V5ID0gKHZhbCwgY2hlY2spID0+IHtcbiAgaWYgKCFpc09iamVjdDIodmFsKSkge1xuICAgIGFzc2VydFBhc3NhYmxlKHZhbCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKGtleU1lbW8uaGFzKHZhbCkpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSBjaGVja0tleUludGVybmFsKHZhbCwgY2hlY2spO1xuICBpZiAocmVzdWx0KSB7XG4gICAga2V5TWVtby5hZGQodmFsKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbmhhcmRlbihjaGVja0tleSk7XG52YXIgaXNLZXkgPSAodmFsKSA9PiBjaGVja0tleSh2YWwsIGlkZW50Q2hlY2tlcik7XG5oYXJkZW4oaXNLZXkpO1xudmFyIGFzc2VydEtleSA9ICh2YWwpID0+IHtcbiAgY2hlY2tLZXkodmFsLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0S2V5KTtcbnZhciBjb3B5U2V0TWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrQ29weVNldCA9IChzMywgY2hlY2spID0+IHtcbiAgaWYgKGNvcHlTZXRNZW1vLmhhcyhzMykpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSAocGFzc1N0eWxlT2YoczMpID09PSBcInRhZ2dlZFwiICYmIGdldFRhZyhzMykgPT09IFwiY29weVNldFwiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBOb3QgYSBjb3B5U2V0OiAke3MzfWApKSAmJiBjaGVja0VsZW1lbnRzKHMzLnBheWxvYWQsIGNoZWNrKSAmJiBjaGVja0tleShzMy5wYXlsb2FkLCBjaGVjayk7XG4gIGlmIChyZXN1bHQpIHtcbiAgICBjb3B5U2V0TWVtby5hZGQoczMpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuaGFyZGVuKGNoZWNrQ29weVNldCk7XG52YXIgaXNDb3B5U2V0ID0gKHMzKSA9PiBjaGVja0NvcHlTZXQoczMsIGlkZW50Q2hlY2tlcik7XG5oYXJkZW4oaXNDb3B5U2V0KTtcbnZhciBhc3NlcnRDb3B5U2V0ID0gKHMzKSA9PiB7XG4gIGNoZWNrQ29weVNldChzMywgYXNzZXJ0Q2hlY2tlcik7XG59O1xuaGFyZGVuKGFzc2VydENvcHlTZXQpO1xudmFyIGdldENvcHlTZXRLZXlzID0gKHMzKSA9PiB7XG4gIGFzc2VydENvcHlTZXQoczMpO1xuICByZXR1cm4gczMucGF5bG9hZDtcbn07XG5oYXJkZW4oZ2V0Q29weVNldEtleXMpO1xudmFyIGV2ZXJ5Q29weVNldEtleSA9IChzMywgZm4pID0+IGdldENvcHlTZXRLZXlzKHMzKS5ldmVyeSgoa2V5LCBpbmRleCkgPT4gZm4oa2V5LCBpbmRleCkpO1xuaGFyZGVuKGV2ZXJ5Q29weVNldEtleSk7XG52YXIgbWFrZUNvcHlTZXQgPSAoZWxlbWVudEl0ZXIpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gbWFrZVNldE9mRWxlbWVudHMoZWxlbWVudEl0ZXIpO1xuICBhc3NlcnRDb3B5U2V0KHJlc3VsdCk7XG4gIHJldHVybiByZXN1bHQ7XG59O1xuaGFyZGVuKG1ha2VDb3B5U2V0KTtcbnZhciBjb3B5QmFnTWVtbyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xudmFyIGNoZWNrQ29weUJhZyA9IChiMywgY2hlY2spID0+IHtcbiAgaWYgKGNvcHlCYWdNZW1vLmhhcyhiMykpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCByZXN1bHQgPSAocGFzc1N0eWxlT2YoYjMpID09PSBcInRhZ2dlZFwiICYmIGdldFRhZyhiMykgPT09IFwiY29weUJhZ1wiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBOb3QgYSBjb3B5QmFnOiAke2IzfWApKSAmJiBjaGVja0JhZ0VudHJpZXMoYjMucGF5bG9hZCwgY2hlY2spICYmIGNoZWNrS2V5KGIzLnBheWxvYWQsIGNoZWNrKTtcbiAgaWYgKHJlc3VsdCkge1xuICAgIGNvcHlCYWdNZW1vLmFkZChiMyk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4oY2hlY2tDb3B5QmFnKTtcbnZhciBpc0NvcHlCYWcgPSAoYjMpID0+IGNoZWNrQ29weUJhZyhiMywgaWRlbnRDaGVja2VyKTtcbmhhcmRlbihpc0NvcHlCYWcpO1xudmFyIGFzc2VydENvcHlCYWcgPSAoYjMpID0+IHtcbiAgY2hlY2tDb3B5QmFnKGIzLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0Q29weUJhZyk7XG52YXIgZ2V0Q29weUJhZ0VudHJpZXMgPSAoYjMpID0+IHtcbiAgYXNzZXJ0Q29weUJhZyhiMyk7XG4gIHJldHVybiBiMy5wYXlsb2FkO1xufTtcbmhhcmRlbihnZXRDb3B5QmFnRW50cmllcyk7XG52YXIgZXZlcnlDb3B5QmFnRW50cnkgPSAoYjMsIGZuKSA9PiBnZXRDb3B5QmFnRW50cmllcyhiMykuZXZlcnkoKGVudHJ5LCBpbmRleCkgPT4gZm4oZW50cnksIGluZGV4KSk7XG5oYXJkZW4oZXZlcnlDb3B5QmFnRW50cnkpO1xudmFyIG1ha2VDb3B5QmFnID0gKGJhZ0VudHJ5SXRlcikgPT4ge1xuICBjb25zdCByZXN1bHQgPSBtYWtlQmFnT2ZFbnRyaWVzKGJhZ0VudHJ5SXRlcik7XG4gIGFzc2VydENvcHlCYWcocmVzdWx0KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4obWFrZUNvcHlCYWcpO1xudmFyIG1ha2VDb3B5QmFnRnJvbUVsZW1lbnRzID0gKGVsZW1lbnRJdGVyKSA9PiB7XG4gIGNvbnN0IGZ1bGxDb21wYXJlID0gbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgY29uc3Qgc29ydGVkID0gc29ydEJ5UmFuayhlbGVtZW50SXRlciwgZnVsbENvbXBhcmUpO1xuICBjb25zdCBlbnRyaWVzMTAgPSBbXTtcbiAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IHNvcnRlZC5sZW5ndGg7ICkge1xuICAgIGNvbnN0IGsgPSBzb3J0ZWRbaTJdO1xuICAgIGxldCBqID0gaTIgKyAxO1xuICAgIHdoaWxlIChqIDwgc29ydGVkLmxlbmd0aCAmJiBmdWxsQ29tcGFyZShrLCBzb3J0ZWRbal0pID09PSAwKSB7XG4gICAgICBqICs9IDE7XG4gICAgfVxuICAgIGVudHJpZXMxMC5wdXNoKFtrLCBCaWdJbnQoaiAtIGkyKV0pO1xuICAgIGkyID0gajtcbiAgfVxuICByZXR1cm4gbWFrZUNvcHlCYWcoZW50cmllczEwKTtcbn07XG5oYXJkZW4obWFrZUNvcHlCYWdGcm9tRWxlbWVudHMpO1xudmFyIGNvcHlNYXBNZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrU2V0KCk7XG52YXIgY2hlY2tDb3B5TWFwID0gKG0yLCBjaGVjaykgPT4ge1xuICBpZiAoY29weU1hcE1lbW8uaGFzKG0yKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmICghKHBhc3NTdHlsZU9mKG0yKSA9PT0gXCJ0YWdnZWRcIiAmJiBnZXRUYWcobTIpID09PSBcImNvcHlNYXBcIikpIHtcbiAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYE5vdCBhIGNvcHlNYXA6ICR7bTJ9YCk7XG4gIH1cbiAgY29uc3QgeyBwYXlsb2FkIH0gPSBtMjtcbiAgaWYgKHBhc3NTdHlsZU9mKHBheWxvYWQpICE9PSBcImNvcHlSZWNvcmRcIikge1xuICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSBjb3B5TWFwJ3MgcGF5bG9hZCBtdXN0IGJlIGEgcmVjb3JkOiAke20yfWApO1xuICB9XG4gIGNvbnN0IHsga2V5czoga2V5czQsIHZhbHVlczogdmFsdWVzNiwgLi4ucmVzdCB9ID0gcGF5bG9hZDtcbiAgY29uc3QgcmVzdWx0ID0gKG93bktleXMxNShyZXN0KS5sZW5ndGggPT09IDAgfHwgY2hlY2soXG4gICAgZmFsc2UsXG4gICAgcmVkYWN0ZWRgQSBjb3B5TWFwJ3MgcGF5bG9hZCBtdXN0IG9ubHkgaGF2ZSAua2V5cyBhbmQgLnZhbHVlczogJHttMn1gXG4gICkpICYmIGNoZWNrRWxlbWVudHMoa2V5czQsIGNoZWNrKSAmJiBjaGVja0tleShrZXlzNCwgY2hlY2spICYmIChwYXNzU3R5bGVPZih2YWx1ZXM2KSA9PT0gXCJjb3B5QXJyYXlcIiB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSBjb3B5TWFwJ3MgLnZhbHVlcyBtdXN0IGJlIGEgY29weUFycmF5OiAke20yfWApKSAmJiAoa2V5czQubGVuZ3RoID09PSB2YWx1ZXM2Lmxlbmd0aCB8fCBjaGVjayhcbiAgICBmYWxzZSxcbiAgICByZWRhY3RlZGBBIGNvcHlNYXAgbXVzdCBoYXZlIHRoZSBzYW1lIG51bWJlciBvZiBrZXlzIGFuZCB2YWx1ZXM6ICR7bTJ9YFxuICApKTtcbiAgaWYgKHJlc3VsdCkge1xuICAgIGNvcHlNYXBNZW1vLmFkZChtMik7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5oYXJkZW4oY2hlY2tDb3B5TWFwKTtcbnZhciBpc0NvcHlNYXAgPSAobTIpID0+IGNoZWNrQ29weU1hcChtMiwgaWRlbnRDaGVja2VyKTtcbmhhcmRlbihpc0NvcHlNYXApO1xudmFyIGFzc2VydENvcHlNYXAgPSAobTIpID0+IHtcbiAgY2hlY2tDb3B5TWFwKG0yLCBhc3NlcnRDaGVja2VyKTtcbn07XG5oYXJkZW4oYXNzZXJ0Q29weU1hcCk7XG52YXIgZ2V0Q29weU1hcEtleXMgPSAobTIpID0+IHtcbiAgYXNzZXJ0Q29weU1hcChtMik7XG4gIHJldHVybiBtMi5wYXlsb2FkLmtleXM7XG59O1xuaGFyZGVuKGdldENvcHlNYXBLZXlzKTtcbnZhciBnZXRDb3B5TWFwVmFsdWVzID0gKG0yKSA9PiB7XG4gIGFzc2VydENvcHlNYXAobTIpO1xuICByZXR1cm4gbTIucGF5bG9hZC52YWx1ZXM7XG59O1xuaGFyZGVuKGdldENvcHlNYXBWYWx1ZXMpO1xudmFyIGdldENvcHlNYXBFbnRyeUFycmF5ID0gKG0yKSA9PiB7XG4gIGFzc2VydENvcHlNYXAobTIpO1xuICBjb25zdCB7XG4gICAgcGF5bG9hZDogeyBrZXlzOiBrZXlzNCwgdmFsdWVzOiB2YWx1ZXM2IH1cbiAgfSA9IG0yO1xuICByZXR1cm4gaGFyZGVuKGtleXM0Lm1hcCgoa2V5LCBpMikgPT4gW2tleSwgdmFsdWVzNltpMl1dKSk7XG59O1xuaGFyZGVuKGdldENvcHlNYXBFbnRyeUFycmF5KTtcbnZhciBnZXRDb3B5TWFwRW50cmllcyA9IChtMikgPT4ge1xuICBhc3NlcnRDb3B5TWFwKG0yKTtcbiAgY29uc3Qge1xuICAgIHBheWxvYWQ6IHsga2V5czoga2V5czQsIHZhbHVlczogdmFsdWVzNiB9XG4gIH0gPSBtMjtcbiAgY29uc3QgeyBsZW5ndGggfSA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgIGtleXM0XG4gICk7XG4gIHJldHVybiBGYXIoXCJDb3B5TWFwIGVudHJpZXMgaXRlcmFibGVcIiwge1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBsZXQgaTIgPSAwO1xuICAgICAgcmV0dXJuIEZhcihcIkNvcHlNYXAgZW50cmllcyBpdGVyYXRvclwiLCB7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBsZXQgcmVzdWx0O1xuICAgICAgICAgIGlmIChpMiA8IGxlbmd0aCkge1xuICAgICAgICAgICAgcmVzdWx0ID0gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlOiBba2V5czRbaTJdLCB2YWx1ZXM2W2kyXV0gfSk7XG4gICAgICAgICAgICBpMiArPSAxO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ID0gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHZvaWQgMCB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4oZ2V0Q29weU1hcEVudHJpZXMpO1xudmFyIGV2ZXJ5Q29weU1hcEtleSA9IChtMiwgZm4pID0+IGdldENvcHlNYXBLZXlzKG0yKS5ldmVyeSgoa2V5LCBpbmRleCkgPT4gZm4oa2V5LCBpbmRleCkpO1xuaGFyZGVuKGV2ZXJ5Q29weU1hcEtleSk7XG52YXIgZXZlcnlDb3B5TWFwVmFsdWUgPSAobTIsIGZuKSA9PiBnZXRDb3B5TWFwVmFsdWVzKG0yKS5ldmVyeSgodmFsdWUsIGluZGV4KSA9PiBmbih2YWx1ZSwgaW5kZXgpKTtcbmhhcmRlbihldmVyeUNvcHlNYXBWYWx1ZSk7XG52YXIgY29weU1hcEtleVNldCA9IChtMikgPT4gKFxuICAvL1xuICBtYWtlVGFnZ2VkKFwiY29weVNldFwiLCBtMi5wYXlsb2FkLmtleXMpXG4pO1xuaGFyZGVuKGNvcHlNYXBLZXlTZXQpO1xudmFyIG1ha2VDb3B5TWFwID0gKGVudHJpZXMxMCkgPT4ge1xuICBjb25zdCBzb3J0ZWRFbnRyaWVzID0gc29ydEJ5UmFuayhlbnRyaWVzMTAsIGNvbXBhcmVBbnRpUmFuayk7XG4gIGNvbnN0IGtleXM0ID0gc29ydGVkRW50cmllcy5tYXAoKFtrLCBfdl0pID0+IGspO1xuICBjb25zdCB2YWx1ZXM2ID0gc29ydGVkRW50cmllcy5tYXAoKFtfaywgdjNdKSA9PiB2Myk7XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VUYWdnZWQoXCJjb3B5TWFwXCIsIHsga2V5czoga2V5czQsIHZhbHVlczogdmFsdWVzNiB9KTtcbiAgYXNzZXJ0Q29weU1hcChyZXN1bHQpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbmhhcmRlbihtYWtlQ29weU1hcCk7XG52YXIgY2hlY2tLZXlJbnRlcm5hbCA9ICh2YWwsIGNoZWNrKSA9PiB7XG4gIGNvbnN0IGNoZWNrSXQgPSAoY2hpbGQpID0+IGNoZWNrS2V5KGNoaWxkLCBjaGVjayk7XG4gIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHZhbCk7XG4gIHN3aXRjaCAocGFzc1N0eWxlKSB7XG4gICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXModmFsKS5ldmVyeShjaGVja0l0KTtcbiAgICB9XG4gICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICByZXR1cm4gdmFsLmV2ZXJ5KGNoZWNrSXQpO1xuICAgIH1cbiAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgIGNvbnN0IHRhZyA9IGdldFRhZyh2YWwpO1xuICAgICAgc3dpdGNoICh0YWcpIHtcbiAgICAgICAgY2FzZSBcImNvcHlTZXRcIjoge1xuICAgICAgICAgIHJldHVybiBjaGVja0NvcHlTZXQodmFsLCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImNvcHlCYWdcIjoge1xuICAgICAgICAgIHJldHVybiBjaGVja0NvcHlCYWcodmFsLCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICAgIHJldHVybiBjaGVja0NvcHlNYXAodmFsLCBjaGVjaykgJiYgLy9cbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vXG4gICAgICAgICAgZXZlcnlDb3B5TWFwVmFsdWUodmFsLCBjaGVja0l0KTtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrICE9PSBpZGVudENoZWNrZXIgJiYgY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgcGFzc2FibGUgdGFnZ2VkICR7cXVvdGUodGFnKX0gaXMgbm90IGEga2V5OiAke3ZhbH1gKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBjYXNlIFwicmVtb3RhYmxlXCI6IHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjYXNlIFwiZXJyb3JcIjpcbiAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICByZXR1cm4gY2hlY2soZmFsc2UsIHJlZGFjdGVkYEEgJHtxdW90ZShwYXNzU3R5bGUpfSBjYW5ub3QgYmUgYSBrZXlgKTtcbiAgICB9XG4gICAgZGVmYXVsdDoge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIHBhc3NTdHlsZSAke3F1b3RlKHBhc3NTdHlsZSl9OiAke3ZhbH1gO1xuICAgIH1cbiAgfVxufTtcblxuLy9cbnZhciBtYWtlSXRlcmF0b3IgPSAobmV4dCkgPT4ge1xuICBjb25zdCBpdGVyID0gaGFyZGVuKHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4gaXRlcixcbiAgICBuZXh0XG4gIH0pO1xuICByZXR1cm4gaXRlcjtcbn07XG5oYXJkZW4obWFrZUl0ZXJhdG9yKTtcblxuLy9cbnZhciBtYWtlQXJyYXlJdGVyYXRvciA9IChhcnIpID0+IHtcbiAgY29uc3QgeyBsZW5ndGggfSA9IGFycjtcbiAgbGV0IGkyID0gMDtcbiAgcmV0dXJuIG1ha2VJdGVyYXRvcigoKSA9PiB7XG4gICAgbGV0IHZhbHVlO1xuICAgIGlmIChpMiA8IGxlbmd0aCkge1xuICAgICAgdmFsdWUgPSBhcnJbaTJdO1xuICAgICAgaTIgKz0gMTtcbiAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWUgfSk7XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZSB9KTtcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VBcnJheUl0ZXJhdG9yKTtcblxuLy9cbnZhciBnZW5lcmF0ZUZ1bGxTb3J0ZWRFbnRyaWVzID0gKGVudHJpZXMxMCwgcmFua0NvbXBhcmUsIGZ1bGxDb21wYXJlKSA9PiB7XG4gIGFzc2VydFJhbmtTb3J0ZWQoZW50cmllczEwLCByYW5rQ29tcGFyZSk7XG4gIGNvbnN0IHsgbGVuZ3RoIH0gPSBlbnRyaWVzMTA7XG4gIGxldCBpMiA9IDA7XG4gIGxldCBzYW1lUmFua0l0ZXJhdG9yO1xuICByZXR1cm4gbWFrZUl0ZXJhdG9yKCgpID0+IHtcbiAgICBpZiAoc2FtZVJhbmtJdGVyYXRvcikge1xuICAgICAgY29uc3QgcmVzdWx0ID0gc2FtZVJhbmtJdGVyYXRvci5uZXh0KCk7XG4gICAgICBpZiAoIXJlc3VsdC5kb25lKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICBzYW1lUmFua0l0ZXJhdG9yID0gdm9pZCAwO1xuICAgIH1cbiAgICBpZiAoaTIgPCBsZW5ndGgpIHtcbiAgICAgIGNvbnN0IGVudHJ5ID0gZW50cmllczEwW2kyXTtcbiAgICAgIGxldCBqID0gaTIgKyAxO1xuICAgICAgd2hpbGUgKGogPCBsZW5ndGggJiYgcmFua0NvbXBhcmUoZW50cnlbMF0sIGVudHJpZXMxMFtqXVswXSkgPT09IDApIHtcbiAgICAgICAgaiArPSAxO1xuICAgICAgfVxuICAgICAgaWYgKGogPT09IGkyICsgMSkge1xuICAgICAgICBpMiA9IGo7XG4gICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWU6IGVudHJ5IH0pO1xuICAgICAgfVxuICAgICAgY29uc3QgdGllcyA9IGVudHJpZXMxMC5zbGljZShpMiwgaik7XG4gICAgICBpMiA9IGo7XG4gICAgICBjb25zdCBzb3J0ZWRUaWVzID0gc29ydEJ5UmFuayh0aWVzLCBmdWxsQ29tcGFyZSk7XG4gICAgICBmb3IgKGxldCBrID0gMTsgayA8IHNvcnRlZFRpZXMubGVuZ3RoOyBrICs9IDEpIHtcbiAgICAgICAgY29uc3QgW2tleTBdID0gc29ydGVkVGllc1trIC0gMV07XG4gICAgICAgIGNvbnN0IFtrZXkxXSA9IHNvcnRlZFRpZXNba107XG4gICAgICAgIE1hdGguc2lnbihmdWxsQ29tcGFyZShrZXkwLCBrZXkxKSkgfHwgdGhyb3dSZWRhY3RlZGBEdXBsaWNhdGUgZW50cnkga2V5OiAke2tleTB9YDtcbiAgICAgIH1cbiAgICAgIHNhbWVSYW5rSXRlcmF0b3IgPSBtYWtlQXJyYXlJdGVyYXRvcihzb3J0ZWRUaWVzKTtcbiAgICAgIHJldHVybiBzYW1lUmFua0l0ZXJhdG9yLm5leHQoKTtcbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IHRydWUsIHZhbHVlOiB2b2lkIDAgfSk7XG4gIH0pO1xufTtcbmhhcmRlbihnZW5lcmF0ZUZ1bGxTb3J0ZWRFbnRyaWVzKTtcbnZhciBnZW5lcmF0ZUNvbGxlY3Rpb25QYWlyRW50cmllcyA9IChjMSwgYzIsIGdldEVudHJpZXMsIGFic2VudFZhbHVlKSA9PiB7XG4gIGNvbnN0IGUxID0gZ2V0RW50cmllcyhjMSk7XG4gIGNvbnN0IGUyID0gZ2V0RW50cmllcyhjMik7XG4gIGNvbnN0IGZ1bGxDb21wYXJlID0gbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgY29uc3QgeCA9IGdlbmVyYXRlRnVsbFNvcnRlZEVudHJpZXMoZTEsIGNvbXBhcmVBbnRpUmFuaywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB5ID0gZ2VuZXJhdGVGdWxsU29ydGVkRW50cmllcyhlMiwgY29tcGFyZUFudGlSYW5rLCBmdWxsQ29tcGFyZSk7XG4gIGxldCB4RG9uZTtcbiAgbGV0IHhLZXk7XG4gIGxldCB4VmFsdWU7XG4gIGxldCB5RG9uZTtcbiAgbGV0IHlLZXk7XG4gIGxldCB5VmFsdWU7XG4gIGNvbnN0IG5vbkVudHJ5ID0gW3ZvaWQgMCwgdm9pZCAwXTtcbiAgY29uc3QgbmV4dFggPSAoKSA9PiB7XG4gICAgIXhEb25lIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IG5leHRYIG11c3Qgbm90IGJlIGNhbGxlZCBvbmNlIGRvbmVgO1xuICAgIGNvbnN0IHJlc3VsdCA9IHhWYWx1ZTtcbiAgICAoeyBkb25lOiB4RG9uZSwgdmFsdWU6IFt4S2V5LCB4VmFsdWVdID0gbm9uRW50cnkgfSA9IHgubmV4dCgpKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuICBuZXh0WCgpO1xuICBjb25zdCBuZXh0WSA9ICgpID0+IHtcbiAgICAheURvbmUgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogbmV4dFkgbXVzdCBub3QgYmUgY2FsbGVkIG9uY2UgZG9uZWA7XG4gICAgY29uc3QgcmVzdWx0ID0geVZhbHVlO1xuICAgICh7IGRvbmU6IHlEb25lLCB2YWx1ZTogW3lLZXksIHlWYWx1ZV0gPSBub25FbnRyeSB9ID0geS5uZXh0KCkpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG4gIG5leHRZKCk7XG4gIHJldHVybiBtYWtlSXRlcmF0b3IoKCkgPT4ge1xuICAgIGxldCBkb25lID0gZmFsc2U7XG4gICAgbGV0IHZhbHVlO1xuICAgIGlmICh4RG9uZSAmJiB5RG9uZSkge1xuICAgICAgZG9uZSA9IHRydWU7XG4gICAgICB2YWx1ZSA9IFt2b2lkIDAsIGFic2VudFZhbHVlLCBhYnNlbnRWYWx1ZV07XG4gICAgfSBlbHNlIGlmICh4RG9uZSkge1xuICAgICAgdmFsdWUgPSBbeUtleSwgYWJzZW50VmFsdWUsIG5leHRZKCldO1xuICAgIH0gZWxzZSBpZiAoeURvbmUpIHtcbiAgICAgIHZhbHVlID0gW3hLZXksIG5leHRYKCksIGFic2VudFZhbHVlXTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgY29tcCA9IGZ1bGxDb21wYXJlKHhLZXksIHlLZXkpO1xuICAgICAgaWYgKGNvbXAgPT09IDApIHtcbiAgICAgICAgdmFsdWUgPSBbeEtleSwgbmV4dFgoKSwgbmV4dFkoKV07XG4gICAgICB9IGVsc2UgaWYgKGNvbXAgPCAwKSB7XG4gICAgICAgIHZhbHVlID0gW3hLZXksIG5leHRYKCksIGFic2VudFZhbHVlXTtcbiAgICAgIH0gZWxzZSBpZiAoY29tcCA+IDApIHtcbiAgICAgICAgdmFsdWUgPSBbeUtleSwgYWJzZW50VmFsdWUsIG5leHRZKCldO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIGtleSBjb21wYXJpc29uICR7cXVvdGUoY29tcCl9IGZvciAke3hLZXl9IHZzICR7eUtleX1gO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaGFyZGVuKHsgZG9uZSwgdmFsdWUgfSk7XG4gIH0pO1xufTtcbmhhcmRlbihnZW5lcmF0ZUNvbGxlY3Rpb25QYWlyRW50cmllcyk7XG52YXIgbWFrZUNvbXBhcmVDb2xsZWN0aW9uID0gKGdldEVudHJpZXMsIGFic2VudFZhbHVlLCBjb21wYXJlVmFsdWVzMikgPT4gaGFyZGVuKChsZWZ0LCByaWdodCkgPT4ge1xuICBjb25zdCBtZXJnZWQgPSBnZW5lcmF0ZUNvbGxlY3Rpb25QYWlyRW50cmllcyhcbiAgICBsZWZ0LFxuICAgIHJpZ2h0LFxuICAgIGdldEVudHJpZXMsXG4gICAgYWJzZW50VmFsdWVcbiAgKTtcbiAgbGV0IGxlZnRJc0JpZ2dlciA9IGZhbHNlO1xuICBsZXQgcmlnaHRJc0JpZ2dlciA9IGZhbHNlO1xuICBmb3IgKGNvbnN0IFtfa2V5LCBsZWZ0VmFsdWUsIHJpZ2h0VmFsdWVdIG9mIG1lcmdlZCkge1xuICAgIGNvbnN0IGNvbXAgPSBjb21wYXJlVmFsdWVzMihsZWZ0VmFsdWUsIHJpZ2h0VmFsdWUpO1xuICAgIGlmIChjb21wID09PSAwKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9IGVsc2UgaWYgKGNvbXAgPCAwKSB7XG4gICAgICByaWdodElzQmlnZ2VyID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGNvbXAgPiAwKSB7XG4gICAgICBsZWZ0SXNCaWdnZXIgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBOdW1iZXIuaXNOYU4oY29tcCkgfHwgLy9cbiAgICAgIHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCB2YWx1ZSBjb21wYXJpc29uICR7cXVvdGUoY29tcCl9IGZvciAke2xlZnRWYWx1ZX0gdnMgJHtyaWdodFZhbHVlfWA7XG4gICAgICByZXR1cm4gTmFOO1xuICAgIH1cbiAgICBpZiAobGVmdElzQmlnZ2VyICYmIHJpZ2h0SXNCaWdnZXIpIHtcbiAgICAgIHJldHVybiBOYU47XG4gICAgfVxuICB9XG4gIHJldHVybiBsZWZ0SXNCaWdnZXIgPyAxIDogcmlnaHRJc0JpZ2dlciA/IC0xIDogMDtcbn0pO1xuaGFyZGVuKG1ha2VDb21wYXJlQ29sbGVjdGlvbik7XG5cbi8vXG52YXIgc2V0Q29tcGFyZSA9IG1ha2VDb21wYXJlQ29sbGVjdGlvbihcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgKHMzKSA9PiBoYXJkZW4oZ2V0Q29weVNldEtleXMoczMpLm1hcCgoa2V5KSA9PiBba2V5LCAxXSkpLFxuICAwLFxuICB0cml2aWFsQ29tcGFyYXRvclxuKTtcbmhhcmRlbihzZXRDb21wYXJlKTtcbnZhciBiYWdDb21wYXJlID0gbWFrZUNvbXBhcmVDb2xsZWN0aW9uKFxuICBnZXRDb3B5QmFnRW50cmllcyxcbiAgMG4sXG4gIHRyaXZpYWxDb21wYXJhdG9yXG4pO1xuaGFyZGVuKGJhZ0NvbXBhcmUpO1xudmFyIEFCU0VOVCA9IFN5bWJvbChcImFic2VudFwiKTtcbnZhciBfbWFwQ29tcGFyZSA9IG1ha2VDb21wYXJlQ29sbGVjdGlvbihcbiAgZ2V0Q29weU1hcEVudHJ5QXJyYXksXG4gIEFCU0VOVCxcbiAgKGxlZnRWYWx1ZSwgcmlnaHRWYWx1ZSkgPT4ge1xuICAgIGlmIChsZWZ0VmFsdWUgPT09IEFCU0VOVCAmJiByaWdodFZhbHVlID09PSBBQlNFTlQpIHtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IFVuZXhwZWN0ZWQgYWJzZW50IGVudHJ5IHBhaXJgO1xuICAgIH0gZWxzZSBpZiAobGVmdFZhbHVlID09PSBBQlNFTlQpIHtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9IGVsc2UgaWYgKHJpZ2h0VmFsdWUgPT09IEFCU0VOVCkge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBjb21wYXJlS2V5cyhsZWZ0VmFsdWUsIHJpZ2h0VmFsdWUpO1xuICAgIH1cbiAgfVxuKTtcbmhhcmRlbihfbWFwQ29tcGFyZSk7XG52YXIgY29tcGFyZUtleXMgPSAobGVmdCwgcmlnaHQpID0+IHtcbiAgYXNzZXJ0S2V5KGxlZnQpO1xuICBhc3NlcnRLZXkocmlnaHQpO1xuICBjb25zdCBsZWZ0U3R5bGUgPSBwYXNzU3R5bGVPZihsZWZ0KTtcbiAgY29uc3QgcmlnaHRTdHlsZSA9IHBhc3NTdHlsZU9mKHJpZ2h0KTtcbiAgaWYgKGxlZnRTdHlsZSAhPT0gcmlnaHRTdHlsZSkge1xuICAgIHJldHVybiBOYU47XG4gIH1cbiAgc3dpdGNoIChsZWZ0U3R5bGUpIHtcbiAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgY2FzZSBcIm51bGxcIjpcbiAgICBjYXNlIFwiYm9vbGVhblwiOlxuICAgIGNhc2UgXCJiaWdpbnRcIjpcbiAgICBjYXNlIFwic3RyaW5nXCI6XG4gICAgY2FzZSBcInN5bWJvbFwiOiB7XG4gICAgICByZXR1cm4gY29tcGFyZVJhbmsobGVmdCwgcmlnaHQpO1xuICAgIH1cbiAgICBjYXNlIFwibnVtYmVyXCI6IHtcbiAgICAgIGNvbnN0IHJhbmtDb21wID0gY29tcGFyZVJhbmsobGVmdCwgcmlnaHQpO1xuICAgICAgaWYgKHJhbmtDb21wID09PSAwKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgaWYgKE51bWJlci5pc05hTihsZWZ0KSB8fCBOdW1iZXIuaXNOYU4ocmlnaHQpKSB7XG4gICAgICAgIGFzc2VydCghTnVtYmVyLmlzTmFOKGxlZnQpIHx8ICFOdW1iZXIuaXNOYU4ocmlnaHQpKTtcbiAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgIH1cbiAgICAgIHJldHVybiByYW5rQ29tcDtcbiAgICB9XG4gICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICBpZiAobGVmdCA9PT0gcmlnaHQpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgICByZXR1cm4gTmFOO1xuICAgIH1cbiAgICBjYXNlIFwiY29weUFycmF5XCI6IHtcbiAgICAgIGNvbnN0IGxlbiA9IE1hdGgubWluKGxlZnQubGVuZ3RoLCByaWdodC5sZW5ndGgpO1xuICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlbjsgaTIgKz0gMSkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjb21wYXJlS2V5cyhsZWZ0W2kyXSwgcmlnaHRbaTJdKTtcbiAgICAgICAgaWYgKHJlc3VsdCAhPT0gMCkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBjb21wYXJlUmFuayhsZWZ0Lmxlbmd0aCwgcmlnaHQubGVuZ3RoKTtcbiAgICB9XG4gICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgY29uc3QgbGVmdE5hbWVzID0gcmVjb3JkTmFtZXMobGVmdCk7XG4gICAgICBjb25zdCByaWdodE5hbWVzID0gcmVjb3JkTmFtZXMocmlnaHQpO1xuICAgICAgaWYgKCFrZXlFUShsZWZ0TmFtZXMsIHJpZ2h0TmFtZXMpKSB7XG4gICAgICAgIHJldHVybiBOYU47XG4gICAgICB9XG4gICAgICBjb25zdCBsZWZ0VmFsdWVzID0gcmVjb3JkVmFsdWVzKGxlZnQsIGxlZnROYW1lcyk7XG4gICAgICBjb25zdCByaWdodFZhbHVlcyA9IHJlY29yZFZhbHVlcyhyaWdodCwgcmlnaHROYW1lcyk7XG4gICAgICBsZXQgcmVzdWx0ID0gMDtcbiAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBsZWZ0VmFsdWVzLmxlbmd0aDsgaTIgKz0gMSkge1xuICAgICAgICBjb25zdCBjb21wID0gY29tcGFyZUtleXMobGVmdFZhbHVlc1tpMl0sIHJpZ2h0VmFsdWVzW2kyXSk7XG4gICAgICAgIGlmIChOdW1iZXIuaXNOYU4oY29tcCkpIHtcbiAgICAgICAgICByZXR1cm4gTmFOO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN1bHQgIT09IGNvbXAgJiYgY29tcCAhPT0gMCkge1xuICAgICAgICAgIGlmIChyZXN1bHQgPT09IDApIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGNvbXA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFzc2VydChcbiAgICAgICAgICAgICAgcmVzdWx0ID09PSAtMSAmJiBjb21wID09PSAxIHx8IHJlc3VsdCA9PT0gMSAmJiBjb21wID09PSAtMVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBOYU47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBjYXNlIFwidGFnZ2VkXCI6IHtcbiAgICAgIGNvbnN0IGxlZnRUYWcgPSBnZXRUYWcobGVmdCk7XG4gICAgICBjb25zdCByaWdodFRhZyA9IGdldFRhZyhyaWdodCk7XG4gICAgICBpZiAobGVmdFRhZyAhPT0gcmlnaHRUYWcpIHtcbiAgICAgICAgcmV0dXJuIE5hTjtcbiAgICAgIH1cbiAgICAgIHN3aXRjaCAobGVmdFRhZykge1xuICAgICAgICBjYXNlIFwiY29weVNldFwiOiB7XG4gICAgICAgICAgcmV0dXJuIHNldENvbXBhcmUobGVmdCwgcmlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJjb3B5QmFnXCI6IHtcbiAgICAgICAgICByZXR1cm4gYmFnQ29tcGFyZShsZWZ0LCByaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgTWFwIGNvbXBhcmlzb24gbm90IHlldCBpbXBsZW1lbnRlZDogJHtsZWZ0fSB2cyAke3JpZ2h0fWA7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCB0YWcgJHtxdW90ZShsZWZ0VGFnKX06ICR7bGVmdH1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBwYXNzU3R5bGUgJHtxdW90ZShsZWZ0U3R5bGUpfTogJHtsZWZ0fWA7XG4gICAgfVxuICB9XG59O1xuaGFyZGVuKGNvbXBhcmVLZXlzKTtcbnZhciBrZXlMVCA9IChsZWZ0LCByaWdodCkgPT4gY29tcGFyZUtleXMobGVmdCwgcmlnaHQpIDwgMDtcbmhhcmRlbihrZXlMVCk7XG52YXIga2V5TFRFID0gKGxlZnQsIHJpZ2h0KSA9PiBjb21wYXJlS2V5cyhsZWZ0LCByaWdodCkgPD0gMDtcbmhhcmRlbihrZXlMVEUpO1xudmFyIGtleUVRID0gKGxlZnQsIHJpZ2h0KSA9PiBjb21wYXJlS2V5cyhsZWZ0LCByaWdodCkgPT09IDA7XG5oYXJkZW4oa2V5RVEpO1xudmFyIGtleUdURSA9IChsZWZ0LCByaWdodCkgPT4gY29tcGFyZUtleXMobGVmdCwgcmlnaHQpID49IDA7XG5oYXJkZW4oa2V5R1RFKTtcbnZhciBrZXlHVCA9IChsZWZ0LCByaWdodCkgPT4gY29tcGFyZUtleXMobGVmdCwgcmlnaHQpID4gMDtcbmhhcmRlbihrZXlHVCk7XG5cbi8vXG52YXIgd2luZG93UmVzb3J0ID0gKGVsZW1lbnRzLCByYW5rQ29tcGFyZSwgZnVsbENvbXBhcmUpID0+IHtcbiAgYXNzZXJ0UmFua1NvcnRlZChlbGVtZW50cywgcmFua0NvbXBhcmUpO1xuICBjb25zdCB7IGxlbmd0aCB9ID0gZWxlbWVudHM7XG4gIGxldCBpMiA9IDA7XG4gIGxldCBvcHRJbm5lckl0ZXJhdG9yO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4gaGFyZGVuKHtcbiAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgaWYgKG9wdElubmVySXRlcmF0b3IpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBvcHRJbm5lckl0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgICAgIG9wdElubmVySXRlcmF0b3IgPSB2b2lkIDA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChpMiA8IGxlbmd0aCkge1xuICAgICAgICAgIGNvbnN0IHZhbHVlID0gZWxlbWVudHNbaTJdO1xuICAgICAgICAgIGxldCBqID0gaTIgKyAxO1xuICAgICAgICAgIHdoaWxlIChqIDwgbGVuZ3RoICYmIHJhbmtDb21wYXJlKHZhbHVlLCBlbGVtZW50c1tqXSkgPT09IDApIHtcbiAgICAgICAgICAgIGogKz0gMTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGogPT09IGkyICsgMSkge1xuICAgICAgICAgICAgaTIgPSBqO1xuICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmU6IGZhbHNlLCB2YWx1ZSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3Qgc2ltaWxhclJ1biA9IGVsZW1lbnRzLnNsaWNlKGkyLCBqKTtcbiAgICAgICAgICBpMiA9IGo7XG4gICAgICAgICAgY29uc3QgcmVzb3J0ZWQgPSBzb3J0QnlSYW5rKHNpbWlsYXJSdW4sIGZ1bGxDb21wYXJlKTtcbiAgICAgICAgICBhc3NlcnROb0R1cGxpY2F0ZXMocmVzb3J0ZWQsIGZ1bGxDb21wYXJlKTtcbiAgICAgICAgICBvcHRJbm5lckl0ZXJhdG9yID0gcmVzb3J0ZWRbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgICAgIHJldHVybiBvcHRJbm5lckl0ZXJhdG9yLm5leHQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IG51bGwgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICB9KTtcbn07XG52YXIgbWVyZ2UgPSAoeGVsZW1lbnRzLCB5ZWxlbWVudHMpID0+IHtcbiAgY29uc3QgZnVsbENvbXBhcmUgPSBtYWtlRnVsbE9yZGVyQ29tcGFyYXRvcktpdCgpLmFudGlDb21wYXJhdG9yO1xuICBjb25zdCB4cyA9IHdpbmRvd1Jlc29ydCh4ZWxlbWVudHMsIGNvbXBhcmVBbnRpUmFuaywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB5cyA9IHdpbmRvd1Jlc29ydCh5ZWxlbWVudHMsIGNvbXBhcmVBbnRpUmFuaywgZnVsbENvbXBhcmUpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBbU3ltYm9sLml0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgbGV0IHg7XG4gICAgICBsZXQgeERvbmU7XG4gICAgICBsZXQgeTtcbiAgICAgIGxldCB5RG9uZTtcbiAgICAgIGNvbnN0IHhpID0geHNbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgY29uc3QgbmV4dFggPSAoKSA9PiB7XG4gICAgICAgICF4RG9uZSB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBuZXh0WCBzaG91bGQgbm90IGJlIGNhbGxlZCBvbmNlIGRvbmVgO1xuICAgICAgICAoeyBkb25lOiB4RG9uZSwgdmFsdWU6IHggfSA9IHhpLm5leHQoKSk7XG4gICAgICB9O1xuICAgICAgbmV4dFgoKTtcbiAgICAgIGNvbnN0IHlpID0geXNbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgY29uc3QgbmV4dFkgPSAoKSA9PiB7XG4gICAgICAgICF5RG9uZSB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBuZXh0WSBzaG91bGQgbm90IGJlIGNhbGxlZCBvbmNlIGRvbmVgO1xuICAgICAgICAoeyBkb25lOiB5RG9uZSwgdmFsdWU6IHkgfSA9IHlpLm5leHQoKSk7XG4gICAgICB9O1xuICAgICAgbmV4dFkoKTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgbGV0IGRvbmUgPSBmYWxzZTtcbiAgICAgICAgICBsZXQgdmFsdWU7XG4gICAgICAgICAgaWYgKHhEb25lICYmIHlEb25lKSB7XG4gICAgICAgICAgICBkb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhbHVlID0gW251bGwsIDBuLCAwbl07XG4gICAgICAgICAgfSBlbHNlIGlmICh4RG9uZSkge1xuICAgICAgICAgICAgdmFsdWUgPSBbeSwgMG4sIDFuXTtcbiAgICAgICAgICAgIG5leHRZKCk7XG4gICAgICAgICAgfSBlbHNlIGlmICh5RG9uZSkge1xuICAgICAgICAgICAgdmFsdWUgPSBbeCwgMW4sIDBuXTtcbiAgICAgICAgICAgIG5leHRYKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbXAgPSBmdWxsQ29tcGFyZSh4LCB5KTtcbiAgICAgICAgICAgIGlmIChjb21wID09PSAwKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gW3gsIDFuLCAxbl07XG4gICAgICAgICAgICAgIG5leHRYKCk7XG4gICAgICAgICAgICAgIG5leHRZKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbXAgPCAwKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gW3gsIDFuLCAwbl07XG4gICAgICAgICAgICAgIG5leHRYKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb21wID4gMCB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBVbmV4cGVjdGVkIGNvbXAgJHtxdW90ZShjb21wKX1gO1xuICAgICAgICAgICAgICB2YWx1ZSA9IFt5LCAwbiwgMW5dO1xuICAgICAgICAgICAgICBuZXh0WSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZSwgdmFsdWUgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1lcmdlKTtcbnZhciBpdGVySXNTdXBlcnNldCA9ICh4eWkpID0+IHtcbiAgZm9yIChjb25zdCBbX20sIHhjLCBfeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA9PT0gMG4pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xudmFyIGl0ZXJJc0Rpc2pvaW50ID0gKHh5aSkgPT4ge1xuICBmb3IgKGNvbnN0IFtfbSwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICBpZiAoeGMgPj0gMW4gJiYgeWMgPj0gMW4pIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xudmFyIGl0ZXJDb21wYXJlID0gKHh5aSkgPT4ge1xuICBsZXQgbG9uZVkgPSBmYWxzZTtcbiAgbGV0IGxvbmVYID0gZmFsc2U7XG4gIGZvciAoY29uc3QgW19tLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA9PT0gMG4pIHtcbiAgICAgIGxvbmVZID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHljID09PSAwbikge1xuICAgICAgbG9uZVggPSB0cnVlO1xuICAgIH1cbiAgICBpZiAobG9uZVggJiYgbG9uZVkpIHtcbiAgICAgIHJldHVybiBOYU47XG4gICAgfVxuICB9XG4gIGlmIChsb25lWCkge1xuICAgIHJldHVybiAxO1xuICB9IGVsc2UgaWYgKGxvbmVZKSB7XG4gICAgcmV0dXJuIC0xO1xuICB9IGVsc2Uge1xuICAgICFsb25lWCAmJiAhbG9uZVkgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogVW5leHBlY3RlZCBsb25lIHBhaXIgJHtxdW90ZShbbG9uZVgsIGxvbmVZXSl9YDtcbiAgICByZXR1cm4gMDtcbiAgfVxufTtcbnZhciBpdGVyVW5pb24gPSAoeHlpKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBmb3IgKGNvbnN0IFttMiwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICBpZiAoeGMgPj0gMG4pIHtcbiAgICAgIHJlc3VsdC5wdXNoKG0yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgeWMgPj0gMG4gfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogVW5leHBlY3RlZCBjb3VudCAke3F1b3RlKHljKX1gO1xuICAgICAgcmVzdWx0LnB1c2gobTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBpdGVyRGlzam9pbnRVbmlvbiA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIHhjID09PSAwbiB8fCB5YyA9PT0gMG4gfHwgdGhyb3dSZWRhY3RlZGBTZXRzIG11c3Qgbm90IGhhdmUgY29tbW9uIGVsZW1lbnRzOiAke20yfWA7XG4gICAgaWYgKHhjID49IDFuKSB7XG4gICAgICByZXN1bHQucHVzaChtMik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHljID49IDFuIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IFVuZXhwZWN0ZWQgY291bnQgJHtxdW90ZSh5Yyl9YDtcbiAgICAgIHJlc3VsdC5wdXNoKG0yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgaXRlckludGVyc2VjdGlvbiA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA+PSAxbiAmJiB5YyA+PSAxbikge1xuICAgICAgcmVzdWx0LnB1c2gobTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBpdGVyRGlzam9pbnRTdWJ0cmFjdCA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIHhjID49IDFuIHx8IHRocm93UmVkYWN0ZWRgcmlnaHQgZWxlbWVudCAke20yfSB3YXMgbm90IGluIGxlZnRgO1xuICAgIGlmICh5YyA9PT0gMG4pIHtcbiAgICAgIHJlc3VsdC5wdXNoKG0yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgbWVyZ2VpZnkgPSAoaXRlck9wKSA9PiAoeGVsZW1lbnRzLCB5ZWxlbWVudHMpID0+IGl0ZXJPcChtZXJnZSh4ZWxlbWVudHMsIHllbGVtZW50cykpO1xudmFyIGVsZW1lbnRzSXNTdXBlcnNldCA9IG1lcmdlaWZ5KGl0ZXJJc1N1cGVyc2V0KTtcbnZhciBlbGVtZW50c0lzRGlzam9pbnQgPSBtZXJnZWlmeShpdGVySXNEaXNqb2ludCk7XG52YXIgZWxlbWVudHNDb21wYXJlID0gbWVyZ2VpZnkoaXRlckNvbXBhcmUpO1xudmFyIGVsZW1lbnRzVW5pb24gPSBtZXJnZWlmeShpdGVyVW5pb24pO1xudmFyIGVsZW1lbnRzRGlzam9pbnRVbmlvbiA9IG1lcmdlaWZ5KGl0ZXJEaXNqb2ludFVuaW9uKTtcbnZhciBlbGVtZW50c0ludGVyc2VjdGlvbiA9IG1lcmdlaWZ5KGl0ZXJJbnRlcnNlY3Rpb24pO1xudmFyIGVsZW1lbnRzRGlzam9pbnRTdWJ0cmFjdCA9IG1lcmdlaWZ5KGl0ZXJEaXNqb2ludFN1YnRyYWN0KTtcbnZhciByYXdTZXRpZnkgPSAoZWxlbWVudHNPcCkgPT4gKHhzZXQsIHlzZXQpID0+IGVsZW1lbnRzT3AoeHNldC5wYXlsb2FkLCB5c2V0LnBheWxvYWQpO1xudmFyIHNldGlmeSA9IChlbGVtZW50c09wKSA9PiAoeHNldCwgeXNldCkgPT4gbWFrZVNldE9mRWxlbWVudHMoZWxlbWVudHNPcCh4c2V0LnBheWxvYWQsIHlzZXQucGF5bG9hZCkpO1xudmFyIHNldElzU3VwZXJzZXQgPSByYXdTZXRpZnkoZWxlbWVudHNJc1N1cGVyc2V0KTtcbnZhciBzZXRJc0Rpc2pvaW50ID0gcmF3U2V0aWZ5KGVsZW1lbnRzSXNEaXNqb2ludCk7XG52YXIgc2V0VW5pb24gPSBzZXRpZnkoZWxlbWVudHNVbmlvbik7XG52YXIgc2V0RGlzam9pbnRVbmlvbiA9IHNldGlmeShlbGVtZW50c0Rpc2pvaW50VW5pb24pO1xudmFyIHNldEludGVyc2VjdGlvbiA9IHNldGlmeShlbGVtZW50c0ludGVyc2VjdGlvbik7XG52YXIgc2V0RGlzam9pbnRTdWJ0cmFjdCA9IHNldGlmeShlbGVtZW50c0Rpc2pvaW50U3VidHJhY3QpO1xuXG4vL1xudmFyIGJhZ1dpbmRvd1Jlc29ydCA9IChiYWdFbnRyaWVzLCByYW5rQ29tcGFyZSwgZnVsbENvbXBhcmUpID0+IHtcbiAgYXNzZXJ0UmFua1NvcnRlZChiYWdFbnRyaWVzLCByYW5rQ29tcGFyZSk7XG4gIGNvbnN0IHsgbGVuZ3RoIH0gPSBiYWdFbnRyaWVzO1xuICBsZXQgaTIgPSAwO1xuICBsZXQgb3B0SW5uZXJJdGVyYXRvcjtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IGhhcmRlbih7XG4gICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgIGlmIChvcHRJbm5lckl0ZXJhdG9yKSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gb3B0SW5uZXJJdGVyYXRvci5uZXh0KCk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICAgICAgICBvcHRJbm5lckl0ZXJhdG9yID0gdm9pZCAwO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoaTIgPCBsZW5ndGgpIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGJhZ0VudHJpZXNbaTJdO1xuICAgICAgICAgIGxldCBqID0gaTIgKyAxO1xuICAgICAgICAgIHdoaWxlIChqIDwgbGVuZ3RoICYmIHJhbmtDb21wYXJlKGVudHJ5WzBdLCBiYWdFbnRyaWVzW2pdWzBdKSA9PT0gMCkge1xuICAgICAgICAgICAgaiArPSAxO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaiA9PT0gaTIgKyAxKSB7XG4gICAgICAgICAgICBpMiA9IGo7XG4gICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlOiBlbnRyeSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3Qgc2ltaWxhclJ1biA9IGJhZ0VudHJpZXMuc2xpY2UoaTIsIGopO1xuICAgICAgICAgIGkyID0gajtcbiAgICAgICAgICBjb25zdCByZXNvcnRlZCA9IHNvcnRCeVJhbmsoc2ltaWxhclJ1biwgZnVsbENvbXBhcmUpO1xuICAgICAgICAgIGFzc2VydE5vRHVwbGljYXRlS2V5cyhyZXNvcnRlZCwgZnVsbENvbXBhcmUpO1xuICAgICAgICAgIG9wdElubmVySXRlcmF0b3IgPSByZXNvcnRlZFtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICAgICAgcmV0dXJuIG9wdElubmVySXRlcmF0b3IubmV4dCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiB0cnVlLCB2YWx1ZTogW251bGwsIDBuXSB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIH0pO1xufTtcbnZhciBtZXJnZTIgPSAoeGJhZ0VudHJpZXMsIHliYWdFbnRyaWVzKSA9PiB7XG4gIGNvbnN0IGZ1bGxDb21wYXJlID0gbWFrZUZ1bGxPcmRlckNvbXBhcmF0b3JLaXQoKS5hbnRpQ29tcGFyYXRvcjtcbiAgY29uc3QgeHMgPSBiYWdXaW5kb3dSZXNvcnQoeGJhZ0VudHJpZXMsIGNvbXBhcmVBbnRpUmFuaywgZnVsbENvbXBhcmUpO1xuICBjb25zdCB5cyA9IGJhZ1dpbmRvd1Jlc29ydCh5YmFnRW50cmllcywgY29tcGFyZUFudGlSYW5rLCBmdWxsQ29tcGFyZSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIFtTeW1ib2wuaXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICBsZXQgeDtcbiAgICAgIGxldCB4YztcbiAgICAgIGxldCB4RG9uZTtcbiAgICAgIGxldCB5O1xuICAgICAgbGV0IHljO1xuICAgICAgbGV0IHlEb25lO1xuICAgICAgY29uc3QgeGkgPSB4c1tTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICBjb25zdCBuZXh0WCA9ICgpID0+IHtcbiAgICAgICAgIXhEb25lIHx8IHRocm93UmVkYWN0ZWRgSW50ZXJuYWw6IG5leHRYIHNob3VsZCBub3QgYmUgY2FsbGVkIG9uY2UgZG9uZWA7XG4gICAgICAgICh7XG4gICAgICAgICAgZG9uZTogeERvbmUsXG4gICAgICAgICAgdmFsdWU6IFt4LCB4Y11cbiAgICAgICAgfSA9IHhpLm5leHQoKSk7XG4gICAgICB9O1xuICAgICAgbmV4dFgoKTtcbiAgICAgIGNvbnN0IHlpID0geXNbU3ltYm9sLml0ZXJhdG9yXSgpO1xuICAgICAgY29uc3QgbmV4dFkgPSAoKSA9PiB7XG4gICAgICAgICF5RG9uZSB8fCB0aHJvd1JlZGFjdGVkYEludGVybmFsOiBuZXh0WSBzaG91bGQgbm90IGJlIGNhbGxlZCBvbmNlIGRvbmVgO1xuICAgICAgICAoe1xuICAgICAgICAgIGRvbmU6IHlEb25lLFxuICAgICAgICAgIHZhbHVlOiBbeSwgeWNdXG4gICAgICAgIH0gPSB5aS5uZXh0KCkpO1xuICAgICAgfTtcbiAgICAgIG5leHRZKCk7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIGxldCBkb25lID0gZmFsc2U7XG4gICAgICAgICAgbGV0IHZhbHVlO1xuICAgICAgICAgIGlmICh4RG9uZSAmJiB5RG9uZSkge1xuICAgICAgICAgICAgZG9uZSA9IHRydWU7XG4gICAgICAgICAgICB2YWx1ZSA9IFtudWxsLCAwbiwgMG5dO1xuICAgICAgICAgIH0gZWxzZSBpZiAoeERvbmUpIHtcbiAgICAgICAgICAgIHZhbHVlID0gW3ksIDBuLCB5Y107XG4gICAgICAgICAgICBuZXh0WSgpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoeURvbmUpIHtcbiAgICAgICAgICAgIHZhbHVlID0gW3gsIHhjLCAwbl07XG4gICAgICAgICAgICBuZXh0WCgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBjb21wID0gZnVsbENvbXBhcmUoeCwgeSk7XG4gICAgICAgICAgICBpZiAoY29tcCA9PT0gMCkge1xuICAgICAgICAgICAgICB2YWx1ZSA9IFt4LCB4YywgeWNdO1xuICAgICAgICAgICAgICBuZXh0WCgpO1xuICAgICAgICAgICAgICBuZXh0WSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjb21wIDwgMCkge1xuICAgICAgICAgICAgICB2YWx1ZSA9IFt4LCB4YywgMG5dO1xuICAgICAgICAgICAgICBuZXh0WCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29tcCA+IDAgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcm5hbDogVW5leHBlY3RlZCBjb21wICR7cXVvdGUoY29tcCl9YDtcbiAgICAgICAgICAgICAgdmFsdWUgPSBbeSwgMG4sIHljXTtcbiAgICAgICAgICAgICAgbmV4dFkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGRvbmUsIHZhbHVlIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihtZXJnZTIpO1xudmFyIGJhZ0l0ZXJJc1N1cGVyYmFnID0gKHh5aSkgPT4ge1xuICBmb3IgKGNvbnN0IFtfbSwgeGMsIHljXSBvZiB4eWkpIHtcbiAgICBpZiAoeGMgPCB5Yykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgYmFnSXRlcklzRGlzam9pbnQgPSAoeHlpKSA9PiB7XG4gIGZvciAoY29uc3QgW19tLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGlmICh4YyA+PSAxbiAmJiB5YyA+PSAxbikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG52YXIgYmFnSXRlclVuaW9uID0gKHh5aSkgPT4ge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgZm9yIChjb25zdCBbbTIsIHhjLCB5Y10gb2YgeHlpKSB7XG4gICAgcmVzdWx0LnB1c2goW20yLCB4YyArIHljXSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgYmFnSXRlckludGVyc2VjdGlvbiA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGNvbnN0IG1jID0geGMgPD0geWMgPyB4YyA6IHljO1xuICAgIHJlc3VsdC5wdXNoKFttMiwgbWNdKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBiYWdJdGVyRGlzam9pbnRTdWJ0cmFjdCA9ICh4eWkpID0+IHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgW20yLCB4YywgeWNdIG9mIHh5aSkge1xuICAgIGNvbnN0IG1jID0geGMgLSB5YztcbiAgICBtYyA+PSAwbiB8fCB0aHJvd1JlZGFjdGVkYHJpZ2h0IGVsZW1lbnQgJHttMn0gd2FzIG5vdCBpbiBsZWZ0YDtcbiAgICBpZiAobWMgPj0gMW4pIHtcbiAgICAgIHJlc3VsdC5wdXNoKFttMiwgbWNdKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgbWVyZ2VpZnkyID0gKGJhZ0l0ZXJPcCkgPT4gKHhiYWdFbnRyaWVzLCB5YmFnRW50cmllcykgPT4gYmFnSXRlck9wKG1lcmdlMih4YmFnRW50cmllcywgeWJhZ0VudHJpZXMpKTtcbnZhciBiYWdFbnRyaWVzSXNTdXBlcmJhZyA9IG1lcmdlaWZ5MihiYWdJdGVySXNTdXBlcmJhZyk7XG52YXIgYmFnRW50cmllc0lzRGlzam9pbnQgPSBtZXJnZWlmeTIoYmFnSXRlcklzRGlzam9pbnQpO1xudmFyIGJhZ0VudHJpZXNVbmlvbiA9IG1lcmdlaWZ5MihiYWdJdGVyVW5pb24pO1xudmFyIGJhZ0VudHJpZXNJbnRlcnNlY3Rpb24gPSBtZXJnZWlmeTIoYmFnSXRlckludGVyc2VjdGlvbik7XG52YXIgYmFnRW50cmllc0Rpc2pvaW50U3VidHJhY3QgPSBtZXJnZWlmeTIoYmFnSXRlckRpc2pvaW50U3VidHJhY3QpO1xudmFyIHJhd0JhZ2lmeSA9IChiYWdFbnRyaWVzT3ApID0+ICh4YmFnLCB5YmFnKSA9PiBiYWdFbnRyaWVzT3AoeGJhZy5wYXlsb2FkLCB5YmFnLnBheWxvYWQpO1xudmFyIGJhZ2lmeSA9IChiYWdFbnRyaWVzT3ApID0+ICh4YmFnLCB5YmFnKSA9PiBtYWtlQmFnT2ZFbnRyaWVzKGJhZ0VudHJpZXNPcCh4YmFnLnBheWxvYWQsIHliYWcucGF5bG9hZCkpO1xudmFyIGJhZ0lzU3VwZXJiYWcgPSByYXdCYWdpZnkoYmFnRW50cmllc0lzU3VwZXJiYWcpO1xudmFyIGJhZ0lzRGlzam9pbnQgPSByYXdCYWdpZnkoYmFnRW50cmllc0lzRGlzam9pbnQpO1xudmFyIGJhZ1VuaW9uID0gYmFnaWZ5KGJhZ0VudHJpZXNVbmlvbik7XG52YXIgYmFnSW50ZXJzZWN0aW9uID0gYmFnaWZ5KGJhZ0VudHJpZXNJbnRlcnNlY3Rpb24pO1xudmFyIGJhZ0Rpc2pvaW50U3VidHJhY3QgPSBiYWdpZnkoYmFnRW50cmllc0Rpc2pvaW50U3VidHJhY3QpO1xuXG4vL1xudmFyIHRocm93TGFiZWxlZCA9IChpbm5lckVyciwgbGFiZWwsIGVyckNvbnN0cnVjdG9yID0gdm9pZCAwLCBvcHRpb25zID0gdm9pZCAwKSA9PiB7XG4gIGlmICh0eXBlb2YgbGFiZWwgPT09IFwibnVtYmVyXCIpIHtcbiAgICBsYWJlbCA9IGBbJHtsYWJlbH1dYDtcbiAgfVxuICBjb25zdCBvdXRlckVyciA9IG1ha2VFcnJvcihcbiAgICBgJHtsYWJlbH06ICR7aW5uZXJFcnIubWVzc2FnZX1gLFxuICAgIGVyckNvbnN0cnVjdG9yLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgbm90ZShvdXRlckVyciwgcmVkYWN0ZWRgQ2F1c2VkIGJ5ICR7aW5uZXJFcnJ9YCk7XG4gIHRocm93IG91dGVyRXJyO1xufTtcbmhhcmRlbih0aHJvd0xhYmVsZWQpO1xuXG4vL1xudmFyIGFwcGx5TGFiZWxpbmdFcnJvciA9IChmdW5jLCBhcmdzLCBsYWJlbCA9IHZvaWQgMCkgPT4ge1xuICBpZiAobGFiZWwgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiBmdW5jKC4uLmFyZ3MpO1xuICB9XG4gIGxldCByZXN1bHQ7XG4gIHRyeSB7XG4gICAgcmVzdWx0ID0gZnVuYyguLi5hcmdzKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgdGhyb3dMYWJlbGVkKGVyciwgbGFiZWwpO1xuICB9XG4gIGlmIChpc1Byb21pc2UocmVzdWx0KSkge1xuICAgIHJldHVybiBFLndoZW4ocmVzdWx0LCB2b2lkIDAsIChyZWFzb24pID0+IHRocm93TGFiZWxlZChyZWFzb24sIGxhYmVsKSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufTtcbmhhcmRlbihhcHBseUxhYmVsaW5nRXJyb3IpO1xuXG4vL1xudmFyIHsgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzNyB9ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czE2IH0gPSBSZWZsZWN0O1xudmFyIGZyb21VbmlxdWVFbnRyaWVzID0gKGFsbEVudHJpZXMpID0+IHtcbiAgY29uc3QgZW50cmllc0FycmF5ID0gWy4uLmFsbEVudHJpZXNdO1xuICBjb25zdCByZXN1bHQgPSBoYXJkZW4oZnJvbUVudHJpZXM3KGVudHJpZXNBcnJheSkpO1xuICBpZiAob3duS2V5czE2KHJlc3VsdCkubGVuZ3RoID09PSBlbnRyaWVzQXJyYXkubGVuZ3RoKSB7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuICBjb25zdCBuYW1lcyA9IC8qICAgICAgICAgICAqLyBuZXcgU2V0KCk7XG4gIGZvciAoY29uc3QgW25hbWUsIF9dIG9mIGVudHJpZXNBcnJheSkge1xuICAgIGlmIChuYW1lcy5oYXMobmFtZSkpIHtcbiAgICAgIHRocm93UmVkYWN0ZWRgY29sbGlzaW9uIG9uIHByb3BlcnR5IG5hbWUgJHtxdW90ZShuYW1lKX06ICR7ZW50cmllc0FycmF5fWA7XG4gICAgfVxuICAgIG5hbWVzLmFkZChuYW1lKTtcbiAgfVxuICB0aHJvdyB0aHJvd1JlZGFjdGVkYGludGVybmFsOiBmYWlsZWQgdG8gY3JlYXRlIG9iamVjdCBmcm9tIHVuaXF1ZSBlbnRyaWVzYDtcbn07XG5oYXJkZW4oZnJvbVVuaXF1ZUVudHJpZXMpO1xuXG4vL1xudmFyIGxpc3REaWZmZXJlbmNlID0gKGxlZnRMaXN0LCByaWdodExpc3QpID0+IHtcbiAgY29uc3QgcmlnaHRTZXQgPSBuZXcgU2V0KHJpZ2h0TGlzdCk7XG4gIHJldHVybiBsZWZ0TGlzdC5maWx0ZXIoKGVsZW1lbnQpID0+ICFyaWdodFNldC5oYXMoZWxlbWVudCkpO1xufTtcbmhhcmRlbihsaXN0RGlmZmVyZW5jZSk7XG5cbi8vXG52YXIgeyBlbnRyaWVzOiBlbnRyaWVzNywgdmFsdWVzOiB2YWx1ZXMyIH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzMTcgfSA9IFJlZmxlY3Q7XG52YXIgcGF0dGVybk1lbW8gPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKTtcbnZhciBNTTtcbnZhciBkZWZhdWx0TGltaXRzID0gaGFyZGVuKHtcbiAgZGVjaW1hbERpZ2l0c0xpbWl0OiAxMDAsXG4gIHN0cmluZ0xlbmd0aExpbWl0OiAxZTUsXG4gIHN5bWJvbE5hbWVMZW5ndGhMaW1pdDogMTAwLFxuICBudW1Qcm9wZXJ0aWVzTGltaXQ6IDgwLFxuICBwcm9wZXJ0eU5hbWVMZW5ndGhMaW1pdDogMTAwLFxuICBhcnJheUxlbmd0aExpbWl0OiAxZTQsXG4gIG51bVNldEVsZW1lbnRzTGltaXQ6IDFlNCxcbiAgbnVtVW5pcXVlQmFnRWxlbWVudHNMaW1pdDogMWU0LFxuICBudW1NYXBFbnRyaWVzTGltaXQ6IDVlM1xufSk7XG52YXIgbGltaXQgPSAobGltaXRzID0ge30pID0+IChcbiAgLyogICAgICAgICAgICAgICAgICAgICovXG4gIGhhcmRlbih7IF9fcHJvdG9fXzogZGVmYXVsdExpbWl0cywgLi4ubGltaXRzIH0pXG4pO1xudmFyIGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0ID0gKHBheWxvYWQsIG1haW5QYXlsb2FkU2hhcGUsIGNoZWNrLCBsYWJlbCkgPT4ge1xuICBhc3NlcnQoQXJyYXkuaXNBcnJheShtYWluUGF5bG9hZFNoYXBlKSk7XG4gIGlmICghQXJyYXkuaXNBcnJheShwYXlsb2FkKSkge1xuICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtxdW90ZShsYWJlbCl9IHBheWxvYWQgbXVzdCBiZSBhbiBhcnJheTogJHtwYXlsb2FkfWApO1xuICB9XG4gIGNvbnN0IG1haW5MZW5ndGggPSBtYWluUGF5bG9hZFNoYXBlLmxlbmd0aDtcbiAgaWYgKCEocGF5bG9hZC5sZW5ndGggPT09IG1haW5MZW5ndGggfHwgcGF5bG9hZC5sZW5ndGggPT09IG1haW5MZW5ndGggKyAxKSkge1xuICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtxdW90ZShsYWJlbCl9IHBheWxvYWQgdW5leHBlY3RlZCBzaXplOiAke3BheWxvYWR9YCk7XG4gIH1cbiAgY29uc3QgbGltaXRzID0gcGF5bG9hZFttYWluTGVuZ3RoXTtcbiAgcGF5bG9hZCA9IGhhcmRlbihwYXlsb2FkLnNsaWNlKDAsIG1haW5MZW5ndGgpKTtcbiAgaWYgKCFjaGVja01hdGNoZXMocGF5bG9hZCwgbWFpblBheWxvYWRTaGFwZSwgY2hlY2ssIGxhYmVsKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBpZiAobGltaXRzID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gKHBhc3NTdHlsZU9mKGxpbWl0cykgPT09IFwiY29weVJlY29yZFwiIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBMaW1pdHMgbXVzdCBiZSBhIHJlY29yZDogJHtxdW90ZShsaW1pdHMpfWApKSAmJiBlbnRyaWVzNyhsaW1pdHMpLmV2ZXJ5KFxuICAgIChba2V5LCB2YWx1ZV0pID0+IHBhc3NTdHlsZU9mKHZhbHVlKSA9PT0gXCJudW1iZXJcIiB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgVmFsdWUgb2YgbGltaXQgJHtxdW90ZShrZXkpfSBidXQgYmUgYSBudW1iZXI6ICR7cXVvdGUodmFsdWUpfWApXG4gICk7XG59O1xudmFyIGNoZWNrRGVjaW1hbERpZ2l0c0xpbWl0ID0gKHNwZWNpbWVuLCBkZWNpbWFsRGlnaXRzTGltaXQsIGNoZWNrKSA9PiB7XG4gIGlmIChNYXRoLmZsb29yKE1hdGgubG9nMTAoTWF0aC5hYnMoTnVtYmVyKHNwZWNpbWVuKSkpKSArIDEgPD0gZGVjaW1hbERpZ2l0c0xpbWl0KSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGNoZWNrKFxuICAgIGZhbHNlLFxuICAgIHJlZGFjdGVkYGJpZ2ludCAke3NwZWNpbWVufSBtdXN0IG5vdCBoYXZlIG1vcmUgdGhhbiAke2RlY2ltYWxEaWdpdHNMaW1pdH0gZGlnaXRzYFxuICApO1xufTtcbnZhciBtYWtlUGF0dGVybktpdCA9ICgpID0+IHtcbiAgY29uc3QgbWF5YmVNYXRjaEhlbHBlciA9ICh0YWcpID0+IChcbiAgICAvL1xuICAgIEhlbHBlcnNCeU1hdGNoVGFnW3RhZ11cbiAgKTtcbiAgY29uc3QgbWF5YmVQYXlsb2FkU2hhcGUgPSAodGFnKSA9PiAoXG4gICAgLy9cbiAgICBHdWFyZFBheWxvYWRTaGFwZXNbdGFnXVxuICApO1xuICBjb25zdCBzaW5nbGV0b25LaW5kcyA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKFtcbiAgICBbXCJudWxsXCIsIG51bGxdLFxuICAgIFtcInVuZGVmaW5lZFwiLCB2b2lkIDBdXG4gIF0pO1xuICBjb25zdCB0YWdNZW1vID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IGNoZWNrVGFnZ2VkID0gKHRhZ2dlZCwgdGFnLCBjaGVjaykgPT4ge1xuICAgIGNvbnN0IG1hdGNoSGVscGVyID0gbWF5YmVNYXRjaEhlbHBlcih0YWcpO1xuICAgIGlmIChtYXRjaEhlbHBlcikge1xuICAgICAgcmV0dXJuIG1hdGNoSGVscGVyLmNoZWNrSXNXZWxsRm9ybWVkKHRhZ2dlZC5wYXlsb2FkLCBjaGVjayk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHBheWxvYWRTaGFwZSA9IG1heWJlUGF5bG9hZFNoYXBlKHRhZyk7XG4gICAgICBpZiAocGF5bG9hZFNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgICAgcmV0dXJuIGNoZWNrTWF0Y2hlczIodGFnZ2VkLnBheWxvYWQsIHBheWxvYWRTaGFwZSwgY2hlY2ssIHRhZyk7XG4gICAgICB9XG4gICAgfVxuICAgIHN3aXRjaCAodGFnKSB7XG4gICAgICBjYXNlIFwiY29weVNldFwiOiB7XG4gICAgICAgIHJldHVybiBjaGVja0NvcHlTZXQodGFnZ2VkLCBjaGVjayk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUJhZ1wiOiB7XG4gICAgICAgIHJldHVybiBjaGVja0NvcHlCYWcodGFnZ2VkLCBjaGVjayk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weU1hcFwiOiB7XG4gICAgICAgIHJldHVybiBjaGVja0NvcHlNYXAodGFnZ2VkLCBjaGVjayk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICByZWRhY3RlZGBjYW5ub3QgY2hlY2sgdW5yZWNvZ25pemVkIHRhZyAke3F1b3RlKHRhZyl9OiAke3RhZ2dlZH1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBraW5kT2YyID0gKHNwZWNpbWVuLCBjaGVjayA9IGlkZW50Q2hlY2tlcikgPT4ge1xuICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHNwZWNpbWVuKTtcbiAgICBpZiAocGFzc1N0eWxlICE9PSBcInRhZ2dlZFwiKSB7XG4gICAgICByZXR1cm4gcGFzc1N0eWxlO1xuICAgIH1cbiAgICBpZiAodGFnTWVtby5oYXMoc3BlY2ltZW4pKSB7XG4gICAgICByZXR1cm4gdGFnTWVtby5nZXQoc3BlY2ltZW4pO1xuICAgIH1cbiAgICBjb25zdCB0YWcgPSBnZXRUYWcoc3BlY2ltZW4pO1xuICAgIGlmIChjaGVja1RhZ2dlZChzcGVjaW1lbiwgdGFnLCBjaGVjaykpIHtcbiAgICAgIHRhZ01lbW8uc2V0KHNwZWNpbWVuLCB0YWcpO1xuICAgICAgcmV0dXJuIHRhZztcbiAgICB9XG4gICAgaWYgKGNoZWNrICE9PSBpZGVudENoZWNrZXIpIHtcbiAgICAgIGNoZWNrKGZhbHNlLCByZWRhY3RlZGBjYW5ub3QgY2hlY2sgdW5yZWNvZ25pemVkIHRhZyAke3F1b3RlKHRhZyl9YCk7XG4gICAgfVxuICAgIHJldHVybiB2b2lkIDA7XG4gIH07XG4gIGhhcmRlbihraW5kT2YyKTtcbiAgY29uc3QgY2hlY2tLaW5kID0gKHNwZWNpbWVuLCBraW5kMiwgY2hlY2spID0+IHtcbiAgICBpZiAoc2luZ2xldG9uS2luZHMuaGFzKGtpbmQyKSkge1xuICAgICAgcmV0dXJuIGNoZWNrQXNLZXlQYXR0KHNwZWNpbWVuLCBzaW5nbGV0b25LaW5kcy5nZXQoa2luZDIpLCBjaGVjayk7XG4gICAgfVxuICAgIGNvbnN0IHJlYWxLaW5kID0ga2luZE9mMihzcGVjaW1lbiwgY2hlY2spO1xuICAgIGlmIChraW5kMiA9PT0gcmVhbEtpbmQpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoY2hlY2sgIT09IGlkZW50Q2hlY2tlcikge1xuICAgICAgY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7YmFyZU9yUXVvdGUocmVhbEtpbmQpfSAke3NwZWNpbWVufSAtIE11c3QgYmUgYSAke2JhcmVPclF1b3RlKGtpbmQyKX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICBjb25zdCBpc0tpbmQgPSAoc3BlY2ltZW4sIGtpbmQyKSA9PiBjaGVja0tpbmQoc3BlY2ltZW4sIGtpbmQyLCBpZGVudENoZWNrZXIpO1xuICBjb25zdCBjaGVja0FzS2V5UGF0dCA9IChzcGVjaW1lbiwga2V5QXNQYXR0ZXJuLCBjaGVjaykgPT4ge1xuICAgIGlmIChpc0tleShzcGVjaW1lbikgJiYga2V5RVEoc3BlY2ltZW4sIGtleUFzUGF0dGVybikpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gY2hlY2sgIT09IGlkZW50Q2hlY2tlciAmJiAvL1xuICAgIC8vXG4gICAgY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZTogJHtrZXlBc1BhdHRlcm59YCk7XG4gIH07XG4gIGNvbnN0IGNoZWNrUGF0dGVybiA9IChwYXR0LCBjaGVjaykgPT4ge1xuICAgIGlmIChpc0tleShwYXR0KSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGlmIChwYXR0ZXJuTWVtby5oYXMocGF0dCkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjb25zdCByZXN1bHQgPSBjaGVja1BhdHRlcm5JbnRlcm5hbChwYXR0LCBjaGVjayk7XG4gICAgaWYgKHJlc3VsdCkge1xuICAgICAgcGF0dGVybk1lbW8uYWRkKHBhdHQpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuICBjb25zdCBjaGVja1BhdHRlcm5JbnRlcm5hbCA9IChwYXR0LCBjaGVjaykgPT4ge1xuICAgIGNvbnN0IGNoZWNrSXQgPSAoY2hpbGQpID0+IGNoZWNrUGF0dGVybihjaGlsZCwgY2hlY2spO1xuICAgIGNvbnN0IGtpbmQyID0ga2luZE9mMihwYXR0LCBjaGVjayk7XG4gICAgc3dpdGNoIChraW5kMikge1xuICAgICAgY2FzZSB2b2lkIDA6IHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICByZXR1cm4gdmFsdWVzMihwYXR0KS5ldmVyeShjaGVja0l0KTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICByZXR1cm4gcGF0dC5ldmVyeShjaGVja0l0KTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5TWFwXCI6IHtcbiAgICAgICAgcmV0dXJuIGNoZWNrUGF0dGVybihwYXR0LnZhbHVlcywgY2hlY2spO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6XG4gICAgICBjYXNlIFwicHJvbWlzZVwiOiB7XG4gICAgICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgQSAke3F1b3RlKGtpbmQyKX0gY2Fubm90IGJlIGEgcGF0dGVybmApO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBpZiAobWF5YmVNYXRjaEhlbHBlcihraW5kMikgIT09IHZvaWQgMCkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICByZWRhY3RlZGBBIHBhc3NhYmxlIG9mIGtpbmQgJHtxdW90ZShraW5kMil9IGlzIG5vdCBhIHBhdHRlcm46ICR7cGF0dH1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBpc1BhdHRlcm4yID0gKHBhdHQpID0+IGNoZWNrUGF0dGVybihwYXR0LCBpZGVudENoZWNrZXIpO1xuICBjb25zdCBhc3NlcnRQYXR0ZXJuMiA9IChwYXR0KSA9PiB7XG4gICAgY2hlY2tQYXR0ZXJuKHBhdHQsIGFzc2VydENoZWNrZXIpO1xuICB9O1xuICBjb25zdCBjaGVja01hdGNoZXMyID0gKHNwZWNpbWVuLCBwYXR0ZXJuLCBjaGVjaywgbGFiZWwgPSB2b2lkIDApID0+IChcbiAgICAvL1xuICAgIGFwcGx5TGFiZWxpbmdFcnJvcihjaGVja01hdGNoZXNJbnRlcm5hbCwgW3NwZWNpbWVuLCBwYXR0ZXJuLCBjaGVja10sIGxhYmVsKVxuICApO1xuICBjb25zdCBjaGVja01hdGNoZXNJbnRlcm5hbCA9IChzcGVjaW1lbiwgcGF0dCwgY2hlY2spID0+IHtcbiAgICBjb25zdCBwYXR0ZXJuS2luZCA9IGtpbmRPZjIocGF0dCwgY2hlY2spO1xuICAgIGNvbnN0IHNwZWNpbWVuS2luZCA9IGtpbmRPZjIoc3BlY2ltZW4pO1xuICAgIHN3aXRjaCAocGF0dGVybktpbmQpIHtcbiAgICAgIGNhc2Ugdm9pZCAwOiB7XG4gICAgICAgIHJldHVybiB0aHJvd1JlZGFjdGVkYHBhdHRlcm4gZXhwZWN0ZWQ6ICR7cGF0dH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICByZXR1cm4gdGhyb3dSZWRhY3RlZGBwcm9taXNlcyBjYW5ub3QgYmUgcGF0dGVybnM6ICR7cGF0dH1gO1xuICAgICAgfVxuICAgICAgY2FzZSBcImVycm9yXCI6IHtcbiAgICAgICAgcmV0dXJuIHRocm93UmVkYWN0ZWRgZXJyb3JzIGNhbm5vdCBiZSBwYXR0ZXJuczogJHtwYXR0fWA7XG4gICAgICB9XG4gICAgICBjYXNlIFwidW5kZWZpbmVkXCI6XG4gICAgICBjYXNlIFwibnVsbFwiOlxuICAgICAgY2FzZSBcImJvb2xlYW5cIjpcbiAgICAgIGNhc2UgXCJudW1iZXJcIjpcbiAgICAgIGNhc2UgXCJiaWdpbnRcIjpcbiAgICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICAgIGNhc2UgXCJzeW1ib2xcIjpcbiAgICAgIGNhc2UgXCJjb3B5U2V0XCI6XG4gICAgICBjYXNlIFwiY29weUJhZ1wiOlxuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIHJldHVybiBjaGVja0FzS2V5UGF0dChzcGVjaW1lbiwgcGF0dCwgY2hlY2spO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIGlmIChpc0tleShwYXR0KSkge1xuICAgICAgICAgIHJldHVybiBjaGVja0FzS2V5UGF0dChzcGVjaW1lbiwgcGF0dCwgY2hlY2spO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzcGVjaW1lbktpbmQgIT09IFwiY29weUFycmF5XCIpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSBhIGNvcHlBcnJheSB0byBtYXRjaCBhIGNvcHlBcnJheSBwYXR0ZXJuOiAke3F1b3RlKFxuICAgICAgICAgICAgICBwYXR0XG4gICAgICAgICAgICApfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSBwYXR0O1xuICAgICAgICBpZiAoc3BlY2ltZW4ubGVuZ3RoICE9PSBsZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIHJlZGFjdGVkYEFycmF5ICR7c3BlY2ltZW59IC0gTXVzdCBiZSBhcyBsb25nIGFzIGNvcHlBcnJheSBwYXR0ZXJuOiAke3F1b3RlKFxuICAgICAgICAgICAgICBwYXR0XG4gICAgICAgICAgICApfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwYXR0LmV2ZXJ5KChwMywgaTIpID0+IGNoZWNrTWF0Y2hlczIoc3BlY2ltZW5baTJdLCBwMywgY2hlY2ssIGkyKSk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVJlY29yZFwiOiB7XG4gICAgICAgIGlmIChpc0tleShwYXR0KSkge1xuICAgICAgICAgIHJldHVybiBjaGVja0FzS2V5UGF0dChzcGVjaW1lbiwgcGF0dCwgY2hlY2spO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzcGVjaW1lbktpbmQgIT09IFwiY29weVJlY29yZFwiKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgYSBjb3B5UmVjb3JkIHRvIG1hdGNoIGEgY29weVJlY29yZCBwYXR0ZXJuOiAke3F1b3RlKFxuICAgICAgICAgICAgICBwYXR0XG4gICAgICAgICAgICApfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNwZWNpbWVuTmFtZXMgPSByZWNvcmROYW1lcyhzcGVjaW1lbik7XG4gICAgICAgIGNvbnN0IHBhdHROYW1lcyA9IHJlY29yZE5hbWVzKHBhdHQpO1xuICAgICAgICBjb25zdCBtaXNzaW5nMiA9IGxpc3REaWZmZXJlbmNlKHBhdHROYW1lcywgc3BlY2ltZW5OYW1lcyk7XG4gICAgICAgIGlmIChtaXNzaW5nMi5sZW5ndGggPj0gMSkge1xuICAgICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGhhdmUgbWlzc2luZyBwcm9wZXJ0aWVzICR7cXVvdGUobWlzc2luZzIpfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVuZXhwZWN0ZWQgPSBsaXN0RGlmZmVyZW5jZShzcGVjaW1lbk5hbWVzLCBwYXR0TmFtZXMpO1xuICAgICAgICBpZiAodW5leHBlY3RlZC5sZW5ndGggPj0gMSkge1xuICAgICAgICAgIHJldHVybiBjaGVjayhcbiAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IG5vdCBoYXZlIHVuZXhwZWN0ZWQgcHJvcGVydGllczogJHtxdW90ZShcbiAgICAgICAgICAgICAgdW5leHBlY3RlZFxuICAgICAgICAgICAgKX1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzcGVjaW1lblZhbHVlcyA9IHJlY29yZFZhbHVlcyhzcGVjaW1lbiwgc3BlY2ltZW5OYW1lcyk7XG4gICAgICAgIGNvbnN0IHBhdHRWYWx1ZXMgPSByZWNvcmRWYWx1ZXMocGF0dCwgcGF0dE5hbWVzKTtcbiAgICAgICAgcmV0dXJuIHBhdHROYW1lcy5ldmVyeShcbiAgICAgICAgICAobGFiZWwsIGkyKSA9PiBjaGVja01hdGNoZXMyKHNwZWNpbWVuVmFsdWVzW2kyXSwgcGF0dFZhbHVlc1tpMl0sIGNoZWNrLCBsYWJlbClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5TWFwXCI6IHtcbiAgICAgICAgaWYgKGlzS2V5KHBhdHQpKSB7XG4gICAgICAgICAgcmV0dXJuIGNoZWNrQXNLZXlQYXR0KHNwZWNpbWVuLCBwYXR0LCBjaGVjayk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNwZWNpbWVuS2luZCAhPT0gXCJjb3B5TWFwXCIpIHtcbiAgICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSBhIGNvcHlNYXAgdG8gbWF0Y2ggYSBjb3B5TWFwIHBhdHRlcm46ICR7cXVvdGUoXG4gICAgICAgICAgICAgIHBhdHRcbiAgICAgICAgICAgICl9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGF0dEtleVNldCA9IGNvcHlNYXBLZXlTZXQocGF0dCk7XG4gICAgICAgIGNvbnN0IHNwZWNpbWVuS2V5U2V0ID0gY29weU1hcEtleVNldChzcGVjaW1lbik7XG4gICAgICAgIGlmICghY2hlY2tNYXRjaGVzMihzcGVjaW1lbktleVNldCwgcGF0dEtleVNldCwgY2hlY2spKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhdHRWYWx1ZXMgPSBbXTtcbiAgICAgICAgY29uc3Qgc3BlY2ltZW5WYWx1ZXMgPSBbXTtcbiAgICAgICAgY29uc3QgZW50cnlQYWlycyA9IGdlbmVyYXRlQ29sbGVjdGlvblBhaXJFbnRyaWVzKFxuICAgICAgICAgIHBhdHQsXG4gICAgICAgICAgc3BlY2ltZW4sXG4gICAgICAgICAgZ2V0Q29weU1hcEVudHJ5QXJyYXksXG4gICAgICAgICAgdm9pZCAwXG4gICAgICAgICk7XG4gICAgICAgIGZvciAoY29uc3QgW19rZXksIHBhdHRWYWx1ZSwgc3BlY2ltZW5WYWx1ZV0gb2YgZW50cnlQYWlycykge1xuICAgICAgICAgIHBhdHRWYWx1ZXMucHVzaChwYXR0VmFsdWUpO1xuICAgICAgICAgIHNwZWNpbWVuVmFsdWVzLnB1c2goc3BlY2ltZW5WYWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNoZWNrTWF0Y2hlczIoaGFyZGVuKHNwZWNpbWVuVmFsdWVzKSwgaGFyZGVuKHBhdHRWYWx1ZXMpLCBjaGVjayk7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIGNvbnN0IG1hdGNoSGVscGVyID0gbWF5YmVNYXRjaEhlbHBlcihwYXR0ZXJuS2luZCk7XG4gICAgICAgIGlmIChtYXRjaEhlbHBlcikge1xuICAgICAgICAgIHJldHVybiBtYXRjaEhlbHBlci5jaGVja01hdGNoZXMoc3BlY2ltZW4sIHBhdHQucGF5bG9hZCwgY2hlY2spO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IHNob3VsZCBoYXZlIHJlY29nbml6ZWQgJHtxdW90ZShwYXR0ZXJuS2luZCl9IGA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBtYXRjaGVzMiA9IChzcGVjaW1lbiwgcGF0dCkgPT4gY2hlY2tNYXRjaGVzMihzcGVjaW1lbiwgcGF0dCwgaWRlbnRDaGVja2VyKTtcbiAgY29uc3QgbXVzdE1hdGNoMyA9IChzcGVjaW1lbiwgcGF0dCwgbGFiZWwgPSB2b2lkIDApID0+IHtcbiAgICBsZXQgaW5uZXJFcnJvcjtcbiAgICB0cnkge1xuICAgICAgaWYgKGNoZWNrTWF0Y2hlczIoc3BlY2ltZW4sIHBhdHQsIGlkZW50Q2hlY2tlciwgdm9pZCAwKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXIpIHtcbiAgICAgIGlubmVyRXJyb3IgPSBlcjtcbiAgICB9XG4gICAgY2hlY2tNYXRjaGVzMihzcGVjaW1lbiwgcGF0dCwgYXNzZXJ0Q2hlY2tlciwgbGFiZWwpO1xuICAgIGNvbnN0IG91dGVyRXJyb3IgPSBtYWtlRXJyb3IoXG4gICAgICByZWRhY3RlZGBpbnRlcm5hbDogJHtsYWJlbH06IGluY29uc2lzdGVudCBwYXR0ZXJuIG1hdGNoOiAke3F1b3RlKHBhdHQpfWBcbiAgICApO1xuICAgIGlmIChpbm5lckVycm9yICE9PSB2b2lkIDApIHtcbiAgICAgIG5vdGUob3V0ZXJFcnJvciwgcmVkYWN0ZWRgY2F1c2VkIGJ5ICR7aW5uZXJFcnJvcn1gKTtcbiAgICB9XG4gICAgdGhyb3cgb3V0ZXJFcnJvcjtcbiAgfTtcbiAgY29uc3QgZ2V0UmFua0NvdmVyMiA9IChwYXR0LCBlbmNvZGVQYXNzYWJsZSkgPT4ge1xuICAgIGlmIChpc0tleShwYXR0KSkge1xuICAgICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZVBhc3NhYmxlKHBhdHQpO1xuICAgICAgaWYgKGVuY29kZWQgIT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gW2VuY29kZWQsIGAke2VuY29kZWR9fmBdO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihwYXR0KTtcbiAgICBzd2l0Y2ggKHBhc3NTdHlsZSkge1xuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBcImNvcHlSZWNvcmRcIjoge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICBjb25zdCB0YWcgPSBnZXRUYWcocGF0dCk7XG4gICAgICAgIGNvbnN0IG1hdGNoSGVscGVyID0gbWF5YmVNYXRjaEhlbHBlcih0YWcpO1xuICAgICAgICBpZiAobWF0Y2hIZWxwZXIpIHtcbiAgICAgICAgICByZXR1cm4gbWF0Y2hIZWxwZXIuZ2V0UmFua0NvdmVyKHBhdHQucGF5bG9hZCwgZW5jb2RlUGFzc2FibGUpO1xuICAgICAgICB9XG4gICAgICAgIHN3aXRjaCAodGFnKSB7XG4gICAgICAgICAgY2FzZSBcImNvcHlTZXRcIjoge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhc2UgXCJjb3B5TWFwXCI6IHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZ2V0UGFzc1N0eWxlQ292ZXIocGFzc1N0eWxlKTtcbiAgfTtcbiAgY29uc3QgYXJyYXlFdmVyeU1hdGNoUGF0dGVybiA9IChhcnJheSwgcGF0dCwgY2hlY2ssIGxhYmVsUHJlZml4ID0gXCJcIikgPT4ge1xuICAgIGlmIChpc0tpbmQocGF0dCwgXCJtYXRjaDphbnlcIikpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gYXJyYXkuZXZlcnkoXG4gICAgICAoZWwsIGkyKSA9PiBjaGVja01hdGNoZXMyKGVsLCBwYXR0LCBjaGVjaywgYCR7bGFiZWxQcmVmaXh9WyR7aTJ9XWApXG4gICAgKTtcbiAgfTtcbiAgY29uc3QgbWF0Y2hBbnlIZWxwZXIgPSBGYXIoXCJtYXRjaDphbnkgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChfc3BlY2ltZW4sIF9tYXRjaGVyUGF5bG9hZCwgX2NoZWNrKSA9PiB0cnVlLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAobWF0Y2hlclBheWxvYWQsIGNoZWNrKSA9PiBtYXRjaGVyUGF5bG9hZCA9PT0gdm9pZCAwIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGBtYXRjaDphbnkgcGF5bG9hZDogJHttYXRjaGVyUGF5bG9hZH0gLSBNdXN0IGJlIHVuZGVmaW5lZGApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gW1wiXCIsIFwie1wiXVxuICB9KTtcbiAgY29uc3QgbWF0Y2hBbmRIZWxwZXIgPSBGYXIoXCJtYXRjaDphbmQgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcGF0dHMsIGNoZWNrKSA9PiB7XG4gICAgICByZXR1cm4gcGF0dHMuZXZlcnkoKHBhdHQpID0+IGNoZWNrTWF0Y2hlczIoc3BlY2ltZW4sIHBhdHQsIGNoZWNrKSk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKGFsbGVnZWRQYXR0cywgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IGNoZWNrSXQgPSAocGF0dCkgPT4gY2hlY2tQYXR0ZXJuKHBhdHQsIGNoZWNrKTtcbiAgICAgIHJldHVybiAocGFzc1N0eWxlT2YoYWxsZWdlZFBhdHRzKSA9PT0gXCJjb3B5QXJyYXlcIiB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgTmVlZHMgYXJyYXkgb2Ygc3ViLXBhdHRlcm5zOiAke3F1b3RlKGFsbGVnZWRQYXR0cyl9YCkpICYmIGFsbGVnZWRQYXR0cy5ldmVyeShjaGVja0l0KTtcbiAgICB9LFxuICAgIGdldFJhbmtDb3ZlcjogKHBhdHRzLCBlbmNvZGVQYXNzYWJsZSkgPT4gaW50ZXJzZWN0UmFua0NvdmVycyhcbiAgICAgIGNvbXBhcmVSYW5rLFxuICAgICAgcGF0dHMubWFwKChwMykgPT4gZ2V0UmFua0NvdmVyMihwMywgZW5jb2RlUGFzc2FibGUpKVxuICAgIClcbiAgfSk7XG4gIGNvbnN0IG1hdGNoT3JIZWxwZXIgPSBGYXIoXCJtYXRjaDpvciBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBwYXR0cywgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSBwYXR0cztcbiAgICAgIGlmIChsZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gbm8gcGF0dGVybiBkaXNqdW5jdHMgdG8gbWF0Y2g6ICR7cXVvdGUocGF0dHMpfWBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGlmIChwYXR0cy5sZW5ndGggPT09IDIgJiYgIW1hdGNoZXMyKHNwZWNpbWVuLCBwYXR0c1swXSkgJiYgaXNLaW5kKHBhdHRzWzBdLCBcIm1hdGNoOmtpbmRcIikgJiYgcGF0dHNbMF0ucGF5bG9hZCA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICByZXR1cm4gY2hlY2tNYXRjaGVzMihzcGVjaW1lbiwgcGF0dHNbMV0sIGNoZWNrKTtcbiAgICAgIH1cbiAgICAgIGlmIChwYXR0cy5zb21lKChwYXR0KSA9PiBtYXRjaGVzMihzcGVjaW1lbiwgcGF0dCkpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgbWF0Y2ggb25lIG9mICR7cXVvdGUocGF0dHMpfWApO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IG1hdGNoQW5kSGVscGVyLmNoZWNrSXNXZWxsRm9ybWVkLFxuICAgIGdldFJhbmtDb3ZlcjogKHBhdHRzLCBlbmNvZGVQYXNzYWJsZSkgPT4gdW5pb25SYW5rQ292ZXJzKFxuICAgICAgY29tcGFyZVJhbmssXG4gICAgICBwYXR0cy5tYXAoKHAzKSA9PiBnZXRSYW5rQ292ZXIyKHAzLCBlbmNvZGVQYXNzYWJsZSkpXG4gICAgKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hOb3RIZWxwZXIgPSBGYXIoXCJtYXRjaDpub3QgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcGF0dCwgY2hlY2spID0+IHtcbiAgICAgIGlmIChtYXRjaGVzMihzcGVjaW1lbiwgcGF0dCkpIHtcbiAgICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBmYWlsIG5lZ2F0ZWQgcGF0dGVybjogJHtxdW90ZShwYXR0KX1gXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBjaGVja1BhdHRlcm4sXG4gICAgZ2V0UmFua0NvdmVyOiAoX3BhdHQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gW1wiXCIsIFwie1wiXVxuICB9KTtcbiAgY29uc3QgbWF0Y2hTY2FsYXJIZWxwZXIgPSBGYXIoXCJtYXRjaDpzY2FsYXIgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgX21hdGNoZXJQYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tTY2FsYXJLZXkoc3BlY2ltZW4sIGNoZWNrKSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogbWF0Y2hBbnlIZWxwZXIuY2hlY2tJc1dlbGxGb3JtZWQsXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBbXCJhXCIsIFwien5cIl1cbiAgfSk7XG4gIGNvbnN0IG1hdGNoS2V5SGVscGVyID0gRmFyKFwibWF0Y2g6a2V5IGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIF9tYXRjaGVyUGF5bG9hZCwgY2hlY2spID0+IGNoZWNrS2V5KHNwZWNpbWVuLCBjaGVjayksXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IG1hdGNoQW55SGVscGVyLmNoZWNrSXNXZWxsRm9ybWVkLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gW1wiYVwiLCBcInp+XCJdXG4gIH0pO1xuICBjb25zdCBtYXRjaFBhdHRlcm5IZWxwZXIgPSBGYXIoXCJtYXRjaDpwYXR0ZXJuIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIF9tYXRjaGVyUGF5bG9hZCwgY2hlY2spID0+IGNoZWNrUGF0dGVybihzcGVjaW1lbiwgY2hlY2spLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBtYXRjaEFueUhlbHBlci5jaGVja0lzV2VsbEZvcm1lZCxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IFtcImFcIiwgXCJ6flwiXVxuICB9KTtcbiAgY29uc3QgbWF0Y2hLaW5kSGVscGVyID0gRmFyKFwibWF0Y2g6a2luZCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogY2hlY2tLaW5kLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAoYWxsZWdlZEtleUtpbmQsIGNoZWNrKSA9PiB0eXBlb2YgYWxsZWdlZEtleUtpbmQgPT09IFwic3RyaW5nXCIgfHwgY2hlY2soXG4gICAgICBmYWxzZSxcbiAgICAgIHJlZGFjdGVkYG1hdGNoOmtpbmQ6IHBheWxvYWQ6ICR7YWxsZWdlZEtleUtpbmR9IC0gQSBraW5kIG5hbWUgbXVzdCBiZSBhIHN0cmluZ2BcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKGtpbmQyLCBfZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgICAgIGxldCBzdHlsZTtcbiAgICAgIHN3aXRjaCAoa2luZDIpIHtcbiAgICAgICAgY2FzZSBcImNvcHlTZXRcIjpcbiAgICAgICAgY2FzZSBcImNvcHlNYXBcIjoge1xuICAgICAgICAgIHN0eWxlID0gXCJ0YWdnZWRcIjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgc3R5bGUgPSBraW5kMjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGdldFBhc3NTdHlsZUNvdmVyKHN0eWxlKTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBtYXRjaFRhZ2dlZEhlbHBlciA9IEZhcihcIm1hdGNoOnRhZ2dlZCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbdGFnUGF0dCwgcGF5bG9hZFBhdHRdLCBjaGVjaykgPT4ge1xuICAgICAgaWYgKHBhc3NTdHlsZU9mKHNwZWNpbWVuKSAhPT0gXCJ0YWdnZWRcIikge1xuICAgICAgICByZXR1cm4gY2hlY2soXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgcmVkYWN0ZWRgRXhwZWN0ZWQgdGFnZ2VkIG9iamVjdCwgbm90ICR7cXVvdGUoXG4gICAgICAgICAgICBwYXNzU3R5bGVPZihzcGVjaW1lbilcbiAgICAgICAgICApfTogJHtzcGVjaW1lbn1gXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2hlY2tNYXRjaGVzMihnZXRUYWcoc3BlY2ltZW4pLCB0YWdQYXR0LCBjaGVjaywgXCJ0YWdcIikgJiYgY2hlY2tNYXRjaGVzMihzcGVjaW1lbi5wYXlsb2FkLCBwYXlsb2FkUGF0dCwgY2hlY2ssIFwicGF5bG9hZFwiKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrTWF0Y2hlczIoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtNTS5wYXR0ZXJuKCksIE1NLnBhdHRlcm4oKV0pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOnRhZ2dlZCBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9raW5kLCBfZW5jb2RlUGFzc2FibGUpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwidGFnZ2VkXCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaEJpZ2ludEhlbHBlciA9IEZhcihcIm1hdGNoOmJpZ2ludCBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgZGVjaW1hbERpZ2l0c0xpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgcmV0dXJuIGNoZWNrS2luZChzcGVjaW1lbiwgXCJiaWdpbnRcIiwgY2hlY2spICYmIGNoZWNrRGVjaW1hbERpZ2l0c0xpbWl0KHNwZWNpbWVuLCBkZWNpbWFsRGlnaXRzTGltaXQsIGNoZWNrKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6YmlnaW50IHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcImJpZ2ludFwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hOYXRIZWxwZXIgPSBGYXIoXCJtYXRjaDpuYXQgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2xpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IGRlY2ltYWxEaWdpdHNMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiYmlnaW50XCIsIGNoZWNrKSAmJiBjaGVjayhcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNwZWNpbWVuID49IDBuLFxuICAgICAgICByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgbm9uLW5lZ2F0aXZlYFxuICAgICAgKSAmJiBjaGVja0RlY2ltYWxEaWdpdHNMaW1pdChzcGVjaW1lbiwgZGVjaW1hbERpZ2l0c0xpbWl0LCBjaGVjayk7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW10pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOm5hdCBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9tYXRjaFBheWxvYWQsIF9lbmNvZGVQYXNzYWJsZSkgPT4gKFxuICAgICAgLy9cbiAgICAgIGdldFBhc3NTdHlsZUNvdmVyKFwiYmlnaW50XCIpXG4gICAgKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hTdHJpbmdIZWxwZXIgPSBGYXIoXCJtYXRjaDpzdHJpbmcgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2xpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IHN0cmluZ0xlbmd0aExpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgcmV0dXJuIGNoZWNrS2luZChzcGVjaW1lbiwgXCJzdHJpbmdcIiwgY2hlY2spICYmIC8vXG4gICAgICAvKiAgICAgICAgICAgICAgICAgKi9cbiAgICAgIChzcGVjaW1lbi5sZW5ndGggPD0gc3RyaW5nTGVuZ3RoTGltaXQgfHwgY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICByZWRhY3RlZGBzdHJpbmcgJHtzcGVjaW1lbn0gbXVzdCBub3QgYmUgYmlnZ2VyIHRoYW4gJHtzdHJpbmdMZW5ndGhMaW1pdH1gXG4gICAgICApKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6c3RyaW5nIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX21hdGNoUGF5bG9hZCwgX2VuY29kZVBhc3NhYmxlKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInN0cmluZ1wiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hTeW1ib2xIZWxwZXIgPSBGYXIoXCJtYXRjaDpzeW1ib2wgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2xpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IHN5bWJvbE5hbWVMZW5ndGhMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIGlmICghY2hlY2tLaW5kKHNwZWNpbWVuLCBcInN5bWJvbFwiLCBjaGVjaykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgY29uc3Qgc3ltYm9sTmFtZSA9IG5hbWVGb3JQYXNzYWJsZVN5bWJvbChzcGVjaW1lbik7XG4gICAgICBpZiAodHlwZW9mIHN5bWJvbE5hbWUgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogUGFzc2FibGUgc3ltYm9sICR7c3BlY2ltZW59IG11c3QgaGF2ZSBhIHBhc3NhYmxlIG5hbWVgO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICBzeW1ib2xOYW1lLmxlbmd0aCA8PSBzeW1ib2xOYW1lTGVuZ3RoTGltaXQsXG4gICAgICAgIHJlZGFjdGVkYFN5bWJvbCBuYW1lICR7cXVvdGUoXG4gICAgICAgICAgc3ltYm9sTmFtZVxuICAgICAgICApfSBtdXN0IG5vdCBiZSBiaWdnZXIgdGhhbiAke3N5bWJvbE5hbWVMZW5ndGhMaW1pdH1gXG4gICAgICApO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtdKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpzeW1ib2wgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6IChfbWF0Y2hQYXlsb2FkLCBfZW5jb2RlUGFzc2FibGUpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwic3ltYm9sXCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaFJlbW90YWJsZUhlbHBlciA9IEZhcihcIm1hdGNoOnJlbW90YWJsZSBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCByZW1vdGFibGVEZXNjLCBjaGVjaykgPT4ge1xuICAgICAgaWYgKGlzS2luZChzcGVjaW1lbiwgXCJyZW1vdGFibGVcIikpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoY2hlY2sgPT09IGlkZW50Q2hlY2tlcikge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGxhYmVsIH0gPSByZW1vdGFibGVEZXNjO1xuICAgICAgY29uc3QgcGFzc1N0eWxlID0gcGFzc1N0eWxlT2Yoc3BlY2ltZW4pO1xuICAgICAgY29uc3Qga2luZERldGFpbHMgPSBwYXNzU3R5bGUgIT09IFwidGFnZ2VkXCIgPyAoXG4gICAgICAgIC8vXG4gICAgICAgIGJhcmVPclF1b3RlKHBhc3NTdHlsZSlcbiAgICAgICkgOiAoXG4gICAgICAgIC8vXG4gICAgICAgIC8vXG4gICAgICAgIHF1b3RlKGdldFRhZyhzcGVjaW1lbikpXG4gICAgICApO1xuICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgLy9cbiAgICAgICAgLy9cbiAgICAgICAgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIGEgcmVtb3RhYmxlICR7YmFyZU9yUXVvdGUobGFiZWwpfSwgbm90ICR7a2luZERldGFpbHN9YFxuICAgICAgKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAoYWxsZWdlZFJlbW90YWJsZURlc2MsIGNoZWNrKSA9PiBjaGVja01hdGNoZXMyKFxuICAgICAgYWxsZWdlZFJlbW90YWJsZURlc2MsXG4gICAgICBoYXJkZW4oeyBsYWJlbDogTU0uc3RyaW5nKCkgfSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6cmVtb3RhYmxlIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX3JlbW90YWJsZURlc2MsIF9lbmNvZGVQYXNzYWJsZSkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJyZW1vdGFibGVcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoTFRFSGVscGVyID0gRmFyKFwibWF0Y2g6bHRlIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCwgY2hlY2spID0+IGtleUxURShzcGVjaW1lbiwgcmlnaHRPcGVyYW5kKSB8fCBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgJHtzcGVjaW1lbn0gLSBNdXN0IGJlIDw9ICR7cmlnaHRPcGVyYW5kfWApLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBjaGVja0tleSxcbiAgICBnZXRSYW5rQ292ZXI6IChyaWdodE9wZXJhbmQsIGVuY29kZVBhc3NhYmxlKSA9PiB7XG4gICAgICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZihyaWdodE9wZXJhbmQpO1xuICAgICAgbGV0IFtsZWZ0Qm91bmQsIHJpZ2h0Qm91bmRdID0gZ2V0UGFzc1N0eWxlQ292ZXIocGFzc1N0eWxlKTtcbiAgICAgIGNvbnN0IG5ld1JpZ2h0Qm91bmQgPSBgJHtlbmNvZGVQYXNzYWJsZShyaWdodE9wZXJhbmQpfX5gO1xuICAgICAgaWYgKG5ld1JpZ2h0Qm91bmQgIT09IHZvaWQgMCkge1xuICAgICAgICByaWdodEJvdW5kID0gbmV3UmlnaHRCb3VuZDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBbbGVmdEJvdW5kLCByaWdodEJvdW5kXTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBtYXRjaExUSGVscGVyID0gRmFyKFwibWF0Y2g6bHQgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcmlnaHRPcGVyYW5kLCBjaGVjaykgPT4ga2V5TFQoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCkgfHwgY2hlY2soZmFsc2UsIHJlZGFjdGVkYCR7c3BlY2ltZW59IC0gTXVzdCBiZSA8ICR7cmlnaHRPcGVyYW5kfWApLFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiBjaGVja0tleSxcbiAgICBnZXRSYW5rQ292ZXI6IG1hdGNoTFRFSGVscGVyLmdldFJhbmtDb3ZlclxuICB9KTtcbiAgY29uc3QgbWF0Y2hHVEVIZWxwZXIgPSBGYXIoXCJtYXRjaDpndGUgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgcmlnaHRPcGVyYW5kLCBjaGVjaykgPT4ga2V5R1RFKHNwZWNpbWVuLCByaWdodE9wZXJhbmQpIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgPj0gJHtyaWdodE9wZXJhbmR9YCksXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IGNoZWNrS2V5LFxuICAgIGdldFJhbmtDb3ZlcjogKHJpZ2h0T3BlcmFuZCwgZW5jb2RlUGFzc2FibGUpID0+IHtcbiAgICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHJpZ2h0T3BlcmFuZCk7XG4gICAgICBsZXQgW2xlZnRCb3VuZCwgcmlnaHRCb3VuZF0gPSBnZXRQYXNzU3R5bGVDb3ZlcihwYXNzU3R5bGUpO1xuICAgICAgY29uc3QgbmV3TGVmdEJvdW5kID0gZW5jb2RlUGFzc2FibGUocmlnaHRPcGVyYW5kKTtcbiAgICAgIGlmIChuZXdMZWZ0Qm91bmQgIT09IHZvaWQgMCkge1xuICAgICAgICBsZWZ0Qm91bmQgPSBuZXdMZWZ0Qm91bmQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gW2xlZnRCb3VuZCwgcmlnaHRCb3VuZF07XG4gICAgfVxuICB9KTtcbiAgY29uc3QgbWF0Y2hHVEhlbHBlciA9IEZhcihcIm1hdGNoOmd0IGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIHJpZ2h0T3BlcmFuZCwgY2hlY2spID0+IGtleUdUKHNwZWNpbWVuLCByaWdodE9wZXJhbmQpIHx8IGNoZWNrKGZhbHNlLCByZWRhY3RlZGAke3NwZWNpbWVufSAtIE11c3QgYmUgPiAke3JpZ2h0T3BlcmFuZH1gKSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogY2hlY2tLZXksXG4gICAgZ2V0UmFua0NvdmVyOiBtYXRjaEdURUhlbHBlci5nZXRSYW5rQ292ZXJcbiAgfSk7XG4gIGNvbnN0IG1hdGNoUmVjb3JkT2ZIZWxwZXIgPSBGYXIoXCJtYXRjaDpyZWNvcmRPZiBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBba2V5UGF0dCwgdmFsdWVQYXR0LCBsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBudW1Qcm9wZXJ0aWVzTGltaXQsIHByb3BlcnR5TmFtZUxlbmd0aExpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgcmV0dXJuIGNoZWNrS2luZChzcGVjaW1lbiwgXCJjb3B5UmVjb3JkXCIsIGNoZWNrKSAmJiBjaGVjayhcbiAgICAgICAgb3duS2V5czE3KHNwZWNpbWVuKS5sZW5ndGggPD0gbnVtUHJvcGVydGllc0xpbWl0LFxuICAgICAgICByZWRhY3RlZGBNdXN0IG5vdCBoYXZlIG1vcmUgdGhhbiAke3F1b3RlKFxuICAgICAgICAgIG51bVByb3BlcnRpZXNMaW1pdFxuICAgICAgICApfSBwcm9wZXJ0aWVzOiAke3NwZWNpbWVufWBcbiAgICAgICkgJiYgZW50cmllczcoc3BlY2ltZW4pLmV2ZXJ5KFxuICAgICAgICAoW2tleSwgdmFsdWVdKSA9PiBhcHBseUxhYmVsaW5nRXJyb3IoXG4gICAgICAgICAgY2hlY2ssXG4gICAgICAgICAgW1xuICAgICAgICAgICAga2V5Lmxlbmd0aCA8PSBwcm9wZXJ0eU5hbWVMZW5ndGhMaW1pdCxcbiAgICAgICAgICAgIHJlZGFjdGVkYFByb3BlcnR5IG5hbWUgbXVzdCBub3QgYmUgbG9uZ2VyIHRoYW4gJHtxdW90ZShcbiAgICAgICAgICAgICAgcHJvcGVydHlOYW1lTGVuZ3RoTGltaXRcbiAgICAgICAgICAgICl9YFxuICAgICAgICAgIF0sXG4gICAgICAgICAga2V5XG4gICAgICAgICkgJiYgY2hlY2tNYXRjaGVzMihcbiAgICAgICAgICBoYXJkZW4oW2tleSwgdmFsdWVdKSxcbiAgICAgICAgICBoYXJkZW4oW2tleVBhdHQsIHZhbHVlUGF0dF0pLFxuICAgICAgICAgIGNoZWNrLFxuICAgICAgICAgIGtleVxuICAgICAgICApXG4gICAgICApO1xuICAgIH0sXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChwYXlsb2FkLCBjaGVjaykgPT4gY2hlY2tJc1dlbGxGb3JtZWRXaXRoTGltaXQoXG4gICAgICBwYXlsb2FkLFxuICAgICAgaGFyZGVuKFtNTS5wYXR0ZXJuKCksIE1NLnBhdHRlcm4oKV0pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOnJlY29yZE9mIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoX2VudHJ5UGF0dCkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJjb3B5UmVjb3JkXCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaEFycmF5T2ZIZWxwZXIgPSBGYXIoXCJtYXRjaDphcnJheU9mIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtzdWJQYXR0LCBsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3QgeyBhcnJheUxlbmd0aExpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgcmV0dXJuIGNoZWNrS2luZChzcGVjaW1lbiwgXCJjb3B5QXJyYXlcIiwgY2hlY2spICYmIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAoc3BlY2ltZW4ubGVuZ3RoIDw9IGFycmF5TGVuZ3RoTGltaXQgfHwgY2hlY2soXG4gICAgICAgIGZhbHNlLFxuICAgICAgICByZWRhY3RlZGBBcnJheSBsZW5ndGggJHtzcGVjaW1lbi5sZW5ndGh9IG11c3QgYmUgPD0gbGltaXQgJHthcnJheUxlbmd0aExpbWl0fWBcbiAgICAgICkpICYmIGFycmF5RXZlcnlNYXRjaFBhdHRlcm4oc3BlY2ltZW4sIHN1YlBhdHQsIGNoZWNrKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbTU0ucGF0dGVybigpXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwibWF0Y2g6YXJyYXlPZiBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKCkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJjb3B5QXJyYXlcIilcbiAgfSk7XG4gIGNvbnN0IG1hdGNoU2V0T2ZIZWxwZXIgPSBGYXIoXCJtYXRjaDpzZXRPZiBoZWxwZXJcIiwge1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBba2V5UGF0dCwgbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgbnVtU2V0RWxlbWVudHNMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiY29weVNldFwiLCBjaGVjaykgJiYgY2hlY2soXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNwZWNpbWVuLnBheWxvYWQubGVuZ3RoIDwgbnVtU2V0RWxlbWVudHNMaW1pdCxcbiAgICAgICAgcmVkYWN0ZWRgU2V0IG11c3Qgbm90IGhhdmUgbW9yZSB0aGFuICR7cXVvdGUobnVtU2V0RWxlbWVudHNMaW1pdCl9IGVsZW1lbnRzOiAke3NwZWNpbWVuLnBheWxvYWQubGVuZ3RofWBcbiAgICAgICkgJiYgYXJyYXlFdmVyeU1hdGNoUGF0dGVybihzcGVjaW1lbi5wYXlsb2FkLCBrZXlQYXR0LCBjaGVjaywgXCJzZXQgZWxlbWVudHNcIik7XG4gICAgfSxcbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHBheWxvYWQsIGNoZWNrKSA9PiBjaGVja0lzV2VsbEZvcm1lZFdpdGhMaW1pdChcbiAgICAgIHBheWxvYWQsXG4gICAgICBoYXJkZW4oW01NLnBhdHRlcm4oKV0pLFxuICAgICAgY2hlY2ssXG4gICAgICBcIm1hdGNoOnNldE9mIHBheWxvYWRcIlxuICAgICksXG4gICAgZ2V0UmFua0NvdmVyOiAoKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihcInRhZ2dlZFwiKVxuICB9KTtcbiAgY29uc3QgbWF0Y2hCYWdPZkhlbHBlciA9IEZhcihcIm1hdGNoOmJhZ09mIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtrZXlQYXR0LCBjb3VudFBhdHQsIGxpbWl0cyA9IHZvaWQgMF0sIGNoZWNrKSA9PiB7XG4gICAgICBjb25zdCB7IG51bVVuaXF1ZUJhZ0VsZW1lbnRzTGltaXQsIGRlY2ltYWxEaWdpdHNMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIHJldHVybiBjaGVja0tpbmQoc3BlY2ltZW4sIFwiY29weUJhZ1wiLCBjaGVjaykgJiYgY2hlY2soXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNwZWNpbWVuLnBheWxvYWQubGVuZ3RoIDw9IG51bVVuaXF1ZUJhZ0VsZW1lbnRzTGltaXQsXG4gICAgICAgIHJlZGFjdGVkYEJhZyBtdXN0IG5vdCBoYXZlIG1vcmUgdGhhbiAke3F1b3RlKFxuICAgICAgICAgIG51bVVuaXF1ZUJhZ0VsZW1lbnRzTGltaXRcbiAgICAgICAgKX0gdW5pcXVlIGVsZW1lbnRzOiAke3NwZWNpbWVufWBcbiAgICAgICkgJiYgc3BlY2ltZW4ucGF5bG9hZC5ldmVyeShcbiAgICAgICAgKFtrZXksIGNvdW50XSwgaTIpID0+IGNoZWNrTWF0Y2hlczIoa2V5LCBrZXlQYXR0LCBjaGVjaywgYGJhZyBrZXlzWyR7aTJ9XWApICYmIGFwcGx5TGFiZWxpbmdFcnJvcihcbiAgICAgICAgICBjaGVja0RlY2ltYWxEaWdpdHNMaW1pdCxcbiAgICAgICAgICBbY291bnQsIGRlY2ltYWxEaWdpdHNMaW1pdCwgY2hlY2tdLFxuICAgICAgICAgIGBiYWcgY291bnRzWyR7aTJ9XWBcbiAgICAgICAgKSAmJiBjaGVja01hdGNoZXMyKGNvdW50LCBjb3VudFBhdHQsIGNoZWNrLCBgYmFnIGNvdW50c1ske2kyfV1gKVxuICAgICAgKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbTU0ucGF0dGVybigpLCBNTS5wYXR0ZXJuKCldKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDpiYWdPZiBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKCkgPT4gZ2V0UGFzc1N0eWxlQ292ZXIoXCJ0YWdnZWRcIilcbiAgfSk7XG4gIGNvbnN0IGVsZW1lbnRzSGFzU3BsaXQgPSAoZWxlbWVudHMsIGVsZW1lbnRQYXR0LCBib3VuZCwgaW5SZXN1bHRzID0gdm9pZCAwLCBvdXRSZXN1bHRzID0gdm9pZCAwLCBjaGVjayA9IGlkZW50Q2hlY2tlcikgPT4ge1xuICAgIGxldCBjb3VudCA9IDBuO1xuICAgIGZvciAobGV0IGkyID0gZWxlbWVudHMubGVuZ3RoIC0gMTsgaTIgPj0gMDsgaTIgLT0gMSkge1xuICAgICAgY29uc3QgZWxlbWVudCA9IGVsZW1lbnRzW2kyXTtcbiAgICAgIGlmIChjb3VudCA8IGJvdW5kKSB7XG4gICAgICAgIGlmIChtYXRjaGVzMihlbGVtZW50LCBlbGVtZW50UGF0dCkpIHtcbiAgICAgICAgICBjb3VudCArPSAxbjtcbiAgICAgICAgICBpZiAoaW5SZXN1bHRzKSBpblJlc3VsdHMucHVzaChlbGVtZW50KTtcbiAgICAgICAgfSBlbHNlIGlmIChvdXRSZXN1bHRzKSB7XG4gICAgICAgICAgb3V0UmVzdWx0cy5wdXNoKGVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKG91dFJlc3VsdHMgPT09IHZvaWQgMCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG91dFJlc3VsdHMucHVzaChlbGVtZW50KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgY291bnQgPj0gYm91bmQsXG4gICAgICByZWRhY3RlZGBIYXMgb25seSAke3F1b3RlKGNvdW50KX0gbWF0Y2hlcywgYnV0IG5lZWRzICR7cXVvdGUoYm91bmQpfWBcbiAgICApO1xuICB9O1xuICBjb25zdCBwYWlyc0hhc1NwbGl0ID0gKHBhaXJzLCBlbGVtZW50UGF0dCwgYm91bmQsIGluUmVzdWx0cyA9IHZvaWQgMCwgb3V0UmVzdWx0cyA9IHZvaWQgMCwgY2hlY2sgPSBpZGVudENoZWNrZXIpID0+IHtcbiAgICBsZXQgY291bnQgPSAwbjtcbiAgICBmb3IgKGxldCBpMiA9IHBhaXJzLmxlbmd0aCAtIDE7IGkyID49IDA7IGkyIC09IDEpIHtcbiAgICAgIGNvbnN0IFtlbGVtZW50LCBudW1dID0gcGFpcnNbaTJdO1xuICAgICAgY29uc3QgbnVtUmVzdCA9IGJvdW5kIC0gY291bnQ7XG4gICAgICBpZiAobnVtUmVzdCA+PSAxbikge1xuICAgICAgICBpZiAobWF0Y2hlczIoZWxlbWVudCwgZWxlbWVudFBhdHQpKSB7XG4gICAgICAgICAgaWYgKG51bSA8PSBudW1SZXN0KSB7XG4gICAgICAgICAgICBjb3VudCArPSBudW07XG4gICAgICAgICAgICBpZiAoaW5SZXN1bHRzKSBpblJlc3VsdHMucHVzaChbZWxlbWVudCwgbnVtXSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG51bUluID0gbnVtUmVzdDtcbiAgICAgICAgICAgIGNvdW50ICs9IG51bUluO1xuICAgICAgICAgICAgaWYgKGluUmVzdWx0cykgaW5SZXN1bHRzLnB1c2goW2VsZW1lbnQsIG51bVJlc3RdKTtcbiAgICAgICAgICAgIGlmIChvdXRSZXN1bHRzKSBvdXRSZXN1bHRzLnB1c2goW2VsZW1lbnQsIG51bSAtIG51bVJlc3RdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAob3V0UmVzdWx0cykge1xuICAgICAgICAgIG91dFJlc3VsdHMucHVzaChbZWxlbWVudCwgbnVtXSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAob3V0UmVzdWx0cyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3V0UmVzdWx0cy5wdXNoKFtlbGVtZW50LCBudW1dKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNoZWNrKFxuICAgICAgY291bnQgPj0gYm91bmQsXG4gICAgICByZWRhY3RlZGBIYXMgb25seSAke3F1b3RlKGNvdW50KX0gbWF0Y2hlcywgYnV0IG5lZWRzICR7cXVvdGUoYm91bmQpfWBcbiAgICApO1xuICB9O1xuICBjb25zdCBjb250YWluZXJIYXNTcGxpdDIgPSAoc3BlY2ltZW4sIGVsZW1lbnRQYXR0LCBib3VuZCwgbmVlZEluUmVzdWx0cyA9IGZhbHNlLCBuZWVkT3V0UmVzdWx0cyA9IGZhbHNlLCBjaGVjayA9IGlkZW50Q2hlY2tlcikgPT4ge1xuICAgIGNvbnN0IGluUmVzdWx0cyA9IG5lZWRJblJlc3VsdHMgPyBbXSA6IHZvaWQgMDtcbiAgICBjb25zdCBvdXRSZXN1bHRzID0gbmVlZE91dFJlc3VsdHMgPyBbXSA6IHZvaWQgMDtcbiAgICBjb25zdCBraW5kMiA9IGtpbmRPZjIoc3BlY2ltZW4pO1xuICAgIHN3aXRjaCAoa2luZDIpIHtcbiAgICAgIGNhc2UgXCJjb3B5QXJyYXlcIjoge1xuICAgICAgICBpZiAoIWVsZW1lbnRzSGFzU3BsaXQoXG4gICAgICAgICAgc3BlY2ltZW4sXG4gICAgICAgICAgZWxlbWVudFBhdHQsXG4gICAgICAgICAgYm91bmQsXG4gICAgICAgICAgaW5SZXN1bHRzLFxuICAgICAgICAgIG91dFJlc3VsdHMsXG4gICAgICAgICAgY2hlY2tcbiAgICAgICAgKSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW2luUmVzdWx0cywgb3V0UmVzdWx0c107XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weVNldFwiOiB7XG4gICAgICAgIGlmICghZWxlbWVudHNIYXNTcGxpdChcbiAgICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLFxuICAgICAgICAgIGVsZW1lbnRQYXR0LFxuICAgICAgICAgIGJvdW5kLFxuICAgICAgICAgIGluUmVzdWx0cyxcbiAgICAgICAgICBvdXRSZXN1bHRzLFxuICAgICAgICAgIGNoZWNrXG4gICAgICAgICkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICBpblJlc3VsdHMgJiYgbWFrZUNvcHlTZXQoaW5SZXN1bHRzKSxcbiAgICAgICAgICBvdXRSZXN1bHRzICYmIG1ha2VDb3B5U2V0KG91dFJlc3VsdHMpXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgICBjYXNlIFwiY29weUJhZ1wiOiB7XG4gICAgICAgIGlmICghcGFpcnNIYXNTcGxpdChcbiAgICAgICAgICBzcGVjaW1lbi5wYXlsb2FkLFxuICAgICAgICAgIGVsZW1lbnRQYXR0LFxuICAgICAgICAgIGJvdW5kLFxuICAgICAgICAgIGluUmVzdWx0cyxcbiAgICAgICAgICBvdXRSZXN1bHRzLFxuICAgICAgICAgIGNoZWNrXG4gICAgICAgICkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICBpblJlc3VsdHMgJiYgbWFrZUNvcHlCYWcoaW5SZXN1bHRzKSxcbiAgICAgICAgICBvdXRSZXN1bHRzICYmIG1ha2VDb3B5QmFnKG91dFJlc3VsdHMpXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgICBkZWZhdWx0OiB7XG4gICAgICAgIHJldHVybiBjaGVjayhmYWxzZSwgcmVkYWN0ZWRgdW5leHBlY3RlZCAke3F1b3RlKGtpbmQyKX1gKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIGNvbnN0IG1hdGNoQ29udGFpbmVySGFzSGVscGVyID0gRmFyKFwiTS5jb250YWluZXJIYXMgaGVscGVyXCIsIHtcbiAgICAvKlxuXG5cblxuICAgICAqL1xuICAgIGNoZWNrTWF0Y2hlczogKHNwZWNpbWVuLCBbZWxlbWVudFBhdHQsIGJvdW5kLCBsaW1pdHMgPSB2b2lkIDBdLCBjaGVjaykgPT4ge1xuICAgICAgY29uc3Qga2luZDIgPSBraW5kT2YyKHNwZWNpbWVuLCBjaGVjayk7XG4gICAgICBjb25zdCB7IGRlY2ltYWxEaWdpdHNMaW1pdCB9ID0gbGltaXQobGltaXRzKTtcbiAgICAgIGlmICghYXBwbHlMYWJlbGluZ0Vycm9yKFxuICAgICAgICBjaGVja0RlY2ltYWxEaWdpdHNMaW1pdCxcbiAgICAgICAgW2JvdW5kLCBkZWNpbWFsRGlnaXRzTGltaXQsIGNoZWNrXSxcbiAgICAgICAgYCR7a2luZDJ9IG1hdGNoZXNgXG4gICAgICApKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAhIWNvbnRhaW5lckhhc1NwbGl0MihcbiAgICAgICAgc3BlY2ltZW4sXG4gICAgICAgIGVsZW1lbnRQYXR0LFxuICAgICAgICBib3VuZCxcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBjaGVja1xuICAgICAgKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbTU0ucGF0dGVybigpLCBNTS5ndGUoMW4pXSksXG4gICAgICBjaGVjayxcbiAgICAgIFwiTS5jb250YWluZXJIYXMgcGF5bG9hZFwiXG4gICAgKSxcbiAgICBnZXRSYW5rQ292ZXI6ICgpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwidGFnZ2VkXCIpXG4gIH0pO1xuICBjb25zdCBtYXRjaE1hcE9mSGVscGVyID0gRmFyKFwibWF0Y2g6bWFwT2YgaGVscGVyXCIsIHtcbiAgICBjaGVja01hdGNoZXM6IChzcGVjaW1lbiwgW2tleVBhdHQsIHZhbHVlUGF0dCwgbGltaXRzID0gdm9pZCAwXSwgY2hlY2spID0+IHtcbiAgICAgIGNvbnN0IHsgbnVtTWFwRW50cmllc0xpbWl0IH0gPSBsaW1pdChsaW1pdHMpO1xuICAgICAgcmV0dXJuIGNoZWNrS2luZChzcGVjaW1lbiwgXCJjb3B5TWFwXCIsIGNoZWNrKSAmJiBjaGVjayhcbiAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc3BlY2ltZW4ucGF5bG9hZC5rZXlzLmxlbmd0aCA8PSBudW1NYXBFbnRyaWVzTGltaXQsXG4gICAgICAgIHJlZGFjdGVkYENvcHlNYXAgbXVzdCBoYXZlIG5vIG1vcmUgdGhhbiAke3F1b3RlKFxuICAgICAgICAgIG51bU1hcEVudHJpZXNMaW1pdFxuICAgICAgICApfSBlbnRyaWVzOiAke3NwZWNpbWVufWBcbiAgICAgICkgJiYgYXJyYXlFdmVyeU1hdGNoUGF0dGVybihcbiAgICAgICAgc3BlY2ltZW4ucGF5bG9hZC5rZXlzLFxuICAgICAgICBrZXlQYXR0LFxuICAgICAgICBjaGVjayxcbiAgICAgICAgXCJtYXAga2V5c1wiXG4gICAgICApICYmIGFycmF5RXZlcnlNYXRjaFBhdHRlcm4oXG4gICAgICAgIHNwZWNpbWVuLnBheWxvYWQudmFsdWVzLFxuICAgICAgICB2YWx1ZVBhdHQsXG4gICAgICAgIGNoZWNrLFxuICAgICAgICBcIm1hcCB2YWx1ZXNcIlxuICAgICAgKTtcbiAgICB9LFxuICAgIGNoZWNrSXNXZWxsRm9ybWVkOiAocGF5bG9hZCwgY2hlY2spID0+IGNoZWNrSXNXZWxsRm9ybWVkV2l0aExpbWl0KFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGhhcmRlbihbTU0ucGF0dGVybigpLCBNTS5wYXR0ZXJuKCldKSxcbiAgICAgIGNoZWNrLFxuICAgICAgXCJtYXRjaDptYXBPZiBwYXlsb2FkXCJcbiAgICApLFxuICAgIGdldFJhbmtDb3ZlcjogKF9lbnRyeVBhdHQpID0+IGdldFBhc3NTdHlsZUNvdmVyKFwidGFnZ2VkXCIpXG4gIH0pO1xuICBjb25zdCBzcGxpdEFycmF5UGFydHMgPSAoc3BlY2ltZW4sIHJlcXVpcmVkUGF0dCwgb3B0aW9uYWxQYXR0KSA9PiB7XG4gICAgY29uc3QgbnVtUmVxdWlyZWQgPSByZXF1aXJlZFBhdHQubGVuZ3RoO1xuICAgIGNvbnN0IG51bU9wdGlvbmFsID0gb3B0aW9uYWxQYXR0Lmxlbmd0aDtcbiAgICBjb25zdCByZXF1aXJlZFNwZWNpbWVuID0gc3BlY2ltZW4uc2xpY2UoMCwgbnVtUmVxdWlyZWQpO1xuICAgIGNvbnN0IG9wdGlvbmFsU3BlY2ltZW4gPSBzcGVjaW1lbi5zbGljZShcbiAgICAgIG51bVJlcXVpcmVkLFxuICAgICAgbnVtUmVxdWlyZWQgKyBudW1PcHRpb25hbFxuICAgICk7XG4gICAgY29uc3QgcmVzdFNwZWNpbWVuID0gc3BlY2ltZW4uc2xpY2UobnVtUmVxdWlyZWQgKyBudW1PcHRpb25hbCk7XG4gICAgcmV0dXJuIGhhcmRlbih7IHJlcXVpcmVkU3BlY2ltZW4sIG9wdGlvbmFsU3BlY2ltZW4sIHJlc3RTcGVjaW1lbiB9KTtcbiAgfTtcbiAgY29uc3QgYWRhcHRBcnJheVBhdHRlcm4gPSAob3B0aW9uYWxQYXR0LCBsZW5ndGgpID0+IGhhcmRlbihvcHRpb25hbFBhdHQuc2xpY2UoMCwgbGVuZ3RoKS5tYXAoKHBhdHQpID0+IE1NLm9wdChwYXR0KSkpO1xuICBjb25zdCBtYXRjaFNwbGl0QXJyYXlIZWxwZXIgPSBGYXIoXCJtYXRjaDpzcGxpdEFycmF5IGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtyZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCA9IFtdLCByZXN0UGF0dCA9IE1NLmFueSgpXSwgY2hlY2spID0+IHtcbiAgICAgIGlmICghY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlBcnJheVwiLCBjaGVjaykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgY29uc3QgeyByZXF1aXJlZFNwZWNpbWVuLCBvcHRpb25hbFNwZWNpbWVuLCByZXN0U3BlY2ltZW4gfSA9IHNwbGl0QXJyYXlQYXJ0cyhzcGVjaW1lbiwgcmVxdWlyZWRQYXR0LCBvcHRpb25hbFBhdHQpO1xuICAgICAgY29uc3QgcGFydGlhbFBhdHQgPSBhZGFwdEFycmF5UGF0dGVybihcbiAgICAgICAgb3B0aW9uYWxQYXR0LFxuICAgICAgICBvcHRpb25hbFNwZWNpbWVuLmxlbmd0aFxuICAgICAgKTtcbiAgICAgIGxldCBhcmdOdW0gPSAwO1xuICAgICAgcmV0dXJuIChyZXF1aXJlZFNwZWNpbWVuLmxlbmd0aCA9PT0gcmVxdWlyZWRQYXR0Lmxlbmd0aCB8fCBjaGVjayhcbiAgICAgICAgZmFsc2UsXG4gICAgICAgIHJlZGFjdGVkYEV4cGVjdGVkIGF0IGxlYXN0ICR7cXVvdGUoXG4gICAgICAgICAgcmVxdWlyZWRQYXR0Lmxlbmd0aFxuICAgICAgICApfSBhcmd1bWVudHM6ICR7c3BlY2ltZW59YFxuICAgICAgKSkgJiYgcmVxdWlyZWRQYXR0LmV2ZXJ5KFxuICAgICAgICAocDMsIGkyKSA9PiAoXG4gICAgICAgICAgLy9cbiAgICAgICAgICBjaGVja01hdGNoZXMyKHJlcXVpcmVkU3BlY2ltZW5baTJdLCBwMywgY2hlY2ssIGBhcmcgJHthcmdOdW0rK31gKVxuICAgICAgICApXG4gICAgICApICYmIHBhcnRpYWxQYXR0LmV2ZXJ5KFxuICAgICAgICAocDMsIGkyKSA9PiAoXG4gICAgICAgICAgLy9cbiAgICAgICAgICBjaGVja01hdGNoZXMyKG9wdGlvbmFsU3BlY2ltZW5baTJdLCBwMywgY2hlY2ssIGBhcmcgJHthcmdOdW0rK30/YClcbiAgICAgICAgKVxuICAgICAgKSAmJiBjaGVja01hdGNoZXMyKHJlc3RTcGVjaW1lbiwgcmVzdFBhdHQsIGNoZWNrLCBcIi4uLnJlc3RcIik7XG4gICAgfSxcbiAgICAvKlxuXG5cbiAgICAgKi9cbiAgICBjaGVja0lzV2VsbEZvcm1lZDogKHNwbGl0QXJyYXksIGNoZWNrKSA9PiB7XG4gICAgICBpZiAocGFzc1N0eWxlT2Yoc3BsaXRBcnJheSkgPT09IFwiY29weUFycmF5XCIgJiYgKHNwbGl0QXJyYXkubGVuZ3RoID49IDEgfHwgc3BsaXRBcnJheS5sZW5ndGggPD0gMykpIHtcbiAgICAgICAgY29uc3QgW3JlcXVpcmVkUGF0dCwgb3B0aW9uYWxQYXR0ID0gdm9pZCAwLCByZXN0UGF0dCA9IHZvaWQgMF0gPSBzcGxpdEFycmF5O1xuICAgICAgICBpZiAoaXNQYXR0ZXJuMihyZXF1aXJlZFBhdHQpICYmIHBhc3NTdHlsZU9mKHJlcXVpcmVkUGF0dCkgPT09IFwiY29weUFycmF5XCIgJiYgKG9wdGlvbmFsUGF0dCA9PT0gdm9pZCAwIHx8IGlzUGF0dGVybjIob3B0aW9uYWxQYXR0KSAmJiBwYXNzU3R5bGVPZihvcHRpb25hbFBhdHQpID09PSBcImNvcHlBcnJheVwiKSAmJiAocmVzdFBhdHQgPT09IHZvaWQgMCB8fCBpc1BhdHRlcm4yKHJlc3RQYXR0KSkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgcmVkYWN0ZWRgTXVzdCBiZSBhbiBhcnJheSBvZiBhIHJlcXVpcmVkUGF0dCBhcnJheSwgYW4gb3B0aW9uYWwgb3B0aW9uYWxQYXR0IGFycmF5LCBhbmQgYW4gb3B0aW9uYWwgcmVzdFBhdHQ6ICR7cXVvdGUoXG4gICAgICAgICAgc3BsaXRBcnJheVxuICAgICAgICApfWBcbiAgICAgICk7XG4gICAgfSxcbiAgICBnZXRSYW5rQ292ZXI6IChbXG4gICAgICBfcmVxdWlyZWRQYXR0LFxuICAgICAgX29wdGlvbmFsUGF0dCA9IHZvaWQgMCxcbiAgICAgIF9yZXN0UGF0dCA9IHZvaWQgMFxuICAgIF0pID0+IGdldFBhc3NTdHlsZUNvdmVyKFwiY29weUFycmF5XCIpXG4gIH0pO1xuICBjb25zdCBzcGxpdFJlY29yZFBhcnRzID0gKHNwZWNpbWVuLCByZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCkgPT4ge1xuICAgIGNvbnN0IHJlcXVpcmVkRW50cmllcyA9IFtdO1xuICAgIGNvbnN0IG9wdGlvbmFsRW50cmllcyA9IFtdO1xuICAgIGNvbnN0IHJlc3RFbnRyaWVzID0gW107XG4gICAgZm9yIChjb25zdCBbbmFtZSwgdmFsdWVdIG9mIGVudHJpZXM3KHNwZWNpbWVuKSkge1xuICAgICAgaWYgKGhhc093blByb3BlcnR5T2YocmVxdWlyZWRQYXR0LCBuYW1lKSkge1xuICAgICAgICByZXF1aXJlZEVudHJpZXMucHVzaChbbmFtZSwgdmFsdWVdKTtcbiAgICAgIH0gZWxzZSBpZiAoaGFzT3duUHJvcGVydHlPZihvcHRpb25hbFBhdHQsIG5hbWUpKSB7XG4gICAgICAgIG9wdGlvbmFsRW50cmllcy5wdXNoKFtuYW1lLCB2YWx1ZV0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdEVudHJpZXMucHVzaChbbmFtZSwgdmFsdWVdKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICByZXF1aXJlZFNwZWNpbWVuOiBmcm9tVW5pcXVlRW50cmllcyhyZXF1aXJlZEVudHJpZXMpLFxuICAgICAgb3B0aW9uYWxTcGVjaW1lbjogZnJvbVVuaXF1ZUVudHJpZXMob3B0aW9uYWxFbnRyaWVzKSxcbiAgICAgIHJlc3RTcGVjaW1lbjogZnJvbVVuaXF1ZUVudHJpZXMocmVzdEVudHJpZXMpXG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGFkYXB0UmVjb3JkUGF0dGVybiA9IChvcHRpb25hbFBhdHQsIG5hbWVzKSA9PiBmcm9tVW5pcXVlRW50cmllcyhuYW1lcy5tYXAoKG5hbWUpID0+IFtuYW1lLCBNTS5vcHQob3B0aW9uYWxQYXR0W25hbWVdKV0pKTtcbiAgY29uc3QgbWF0Y2hTcGxpdFJlY29yZEhlbHBlciA9IEZhcihcIm1hdGNoOnNwbGl0UmVjb3JkIGhlbHBlclwiLCB7XG4gICAgY2hlY2tNYXRjaGVzOiAoc3BlY2ltZW4sIFtyZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCA9IHt9LCByZXN0UGF0dCA9IE1NLmFueSgpXSwgY2hlY2spID0+IHtcbiAgICAgIGlmICghY2hlY2tLaW5kKHNwZWNpbWVuLCBcImNvcHlSZWNvcmRcIiwgY2hlY2spKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgcmVxdWlyZWRTcGVjaW1lbiwgb3B0aW9uYWxTcGVjaW1lbiwgcmVzdFNwZWNpbWVuIH0gPSBzcGxpdFJlY29yZFBhcnRzKHNwZWNpbWVuLCByZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCk7XG4gICAgICBjb25zdCBwYXJ0aWFsTmFtZXMgPSAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG93bktleXMxNyhvcHRpb25hbFNwZWNpbWVuKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHBhcnRpYWxQYXR0ID0gYWRhcHRSZWNvcmRQYXR0ZXJuKG9wdGlvbmFsUGF0dCwgcGFydGlhbE5hbWVzKTtcbiAgICAgIHJldHVybiBjaGVja01hdGNoZXMyKHJlcXVpcmVkU3BlY2ltZW4sIHJlcXVpcmVkUGF0dCwgY2hlY2spICYmIHBhcnRpYWxOYW1lcy5ldmVyeShcbiAgICAgICAgKG5hbWUpID0+IGNoZWNrTWF0Y2hlczIoXG4gICAgICAgICAgb3B0aW9uYWxTcGVjaW1lbltuYW1lXSxcbiAgICAgICAgICBwYXJ0aWFsUGF0dFtuYW1lXSxcbiAgICAgICAgICBjaGVjayxcbiAgICAgICAgICBgJHtuYW1lfT9gXG4gICAgICAgIClcbiAgICAgICkgJiYgY2hlY2tNYXRjaGVzMihyZXN0U3BlY2ltZW4sIHJlc3RQYXR0LCBjaGVjaywgXCIuLi5yZXN0XCIpO1xuICAgIH0sXG4gICAgLypcblxuXG4gICAgICovXG4gICAgY2hlY2tJc1dlbGxGb3JtZWQ6IChzcGxpdEFycmF5LCBjaGVjaykgPT4ge1xuICAgICAgaWYgKHBhc3NTdHlsZU9mKHNwbGl0QXJyYXkpID09PSBcImNvcHlBcnJheVwiICYmIChzcGxpdEFycmF5Lmxlbmd0aCA+PSAxIHx8IHNwbGl0QXJyYXkubGVuZ3RoIDw9IDMpKSB7XG4gICAgICAgIGNvbnN0IFtyZXF1aXJlZFBhdHQsIG9wdGlvbmFsUGF0dCA9IHZvaWQgMCwgcmVzdFBhdHQgPSB2b2lkIDBdID0gc3BsaXRBcnJheTtcbiAgICAgICAgaWYgKGlzUGF0dGVybjIocmVxdWlyZWRQYXR0KSAmJiBwYXNzU3R5bGVPZihyZXF1aXJlZFBhdHQpID09PSBcImNvcHlSZWNvcmRcIiAmJiAob3B0aW9uYWxQYXR0ID09PSB2b2lkIDAgfHwgaXNQYXR0ZXJuMihvcHRpb25hbFBhdHQpICYmIHBhc3NTdHlsZU9mKG9wdGlvbmFsUGF0dCkgPT09IFwiY29weVJlY29yZFwiKSAmJiAocmVzdFBhdHQgPT09IHZvaWQgMCB8fCBpc1BhdHRlcm4yKHJlc3RQYXR0KSkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNoZWNrKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgcmVkYWN0ZWRgTXVzdCBiZSBhbiBhcnJheSBvZiBhIHJlcXVpcmVkUGF0dCByZWNvcmQsIGFuIG9wdGlvbmFsIG9wdGlvbmFsUGF0dCByZWNvcmQsIGFuZCBhbiBvcHRpb25hbCByZXN0UGF0dDogJHtxdW90ZShcbiAgICAgICAgICBzcGxpdEFycmF5XG4gICAgICAgICl9YFxuICAgICAgKTtcbiAgICB9LFxuICAgIGdldFJhbmtDb3ZlcjogKFtcbiAgICAgIHJlcXVpcmVkUGF0dCxcbiAgICAgIF9vcHRpb25hbFBhdHQgPSB2b2lkIDAsXG4gICAgICBfcmVzdFBhdHQgPSB2b2lkIDBcbiAgICBdKSA9PiBnZXRQYXNzU3R5bGVDb3ZlcihwYXNzU3R5bGVPZihyZXF1aXJlZFBhdHQpKVxuICB9KTtcbiAgY29uc3QgSGVscGVyc0J5TWF0Y2hUYWcgPSBoYXJkZW4oe1xuICAgIFwibWF0Y2g6YW55XCI6IG1hdGNoQW55SGVscGVyLFxuICAgIFwibWF0Y2g6YW5kXCI6IG1hdGNoQW5kSGVscGVyLFxuICAgIFwibWF0Y2g6b3JcIjogbWF0Y2hPckhlbHBlcixcbiAgICBcIm1hdGNoOm5vdFwiOiBtYXRjaE5vdEhlbHBlcixcbiAgICBcIm1hdGNoOnNjYWxhclwiOiBtYXRjaFNjYWxhckhlbHBlcixcbiAgICBcIm1hdGNoOmtleVwiOiBtYXRjaEtleUhlbHBlcixcbiAgICBcIm1hdGNoOnBhdHRlcm5cIjogbWF0Y2hQYXR0ZXJuSGVscGVyLFxuICAgIFwibWF0Y2g6a2luZFwiOiBtYXRjaEtpbmRIZWxwZXIsXG4gICAgXCJtYXRjaDp0YWdnZWRcIjogbWF0Y2hUYWdnZWRIZWxwZXIsXG4gICAgXCJtYXRjaDpiaWdpbnRcIjogbWF0Y2hCaWdpbnRIZWxwZXIsXG4gICAgXCJtYXRjaDpuYXRcIjogbWF0Y2hOYXRIZWxwZXIsXG4gICAgXCJtYXRjaDpzdHJpbmdcIjogbWF0Y2hTdHJpbmdIZWxwZXIsXG4gICAgXCJtYXRjaDpzeW1ib2xcIjogbWF0Y2hTeW1ib2xIZWxwZXIsXG4gICAgXCJtYXRjaDpyZW1vdGFibGVcIjogbWF0Y2hSZW1vdGFibGVIZWxwZXIsXG4gICAgXCJtYXRjaDpsdFwiOiBtYXRjaExUSGVscGVyLFxuICAgIFwibWF0Y2g6bHRlXCI6IG1hdGNoTFRFSGVscGVyLFxuICAgIFwibWF0Y2g6Z3RlXCI6IG1hdGNoR1RFSGVscGVyLFxuICAgIFwibWF0Y2g6Z3RcIjogbWF0Y2hHVEhlbHBlcixcbiAgICBcIm1hdGNoOmFycmF5T2ZcIjogbWF0Y2hBcnJheU9mSGVscGVyLFxuICAgIFwibWF0Y2g6cmVjb3JkT2ZcIjogbWF0Y2hSZWNvcmRPZkhlbHBlcixcbiAgICBcIm1hdGNoOnNldE9mXCI6IG1hdGNoU2V0T2ZIZWxwZXIsXG4gICAgXCJtYXRjaDpiYWdPZlwiOiBtYXRjaEJhZ09mSGVscGVyLFxuICAgIFwibWF0Y2g6Y29udGFpbmVySGFzXCI6IG1hdGNoQ29udGFpbmVySGFzSGVscGVyLFxuICAgIFwibWF0Y2g6bWFwT2ZcIjogbWF0Y2hNYXBPZkhlbHBlcixcbiAgICBcIm1hdGNoOnNwbGl0QXJyYXlcIjogbWF0Y2hTcGxpdEFycmF5SGVscGVyLFxuICAgIFwibWF0Y2g6c3BsaXRSZWNvcmRcIjogbWF0Y2hTcGxpdFJlY29yZEhlbHBlclxuICB9KTtcbiAgY29uc3QgbWFrZU1hdGNoZXIgPSAodGFnLCBwYXlsb2FkKSA9PiB7XG4gICAgY29uc3QgbWF0Y2hlciA9IG1ha2VUYWdnZWQodGFnLCBwYXlsb2FkKTtcbiAgICBhc3NlcnRQYXR0ZXJuMihtYXRjaGVyKTtcbiAgICByZXR1cm4gbWF0Y2hlcjtcbiAgfTtcbiAgY29uc3QgbWFrZUtpbmRNYXRjaGVyID0gKGtpbmQyKSA9PiBtYWtlTWF0Y2hlcihcIm1hdGNoOmtpbmRcIiwga2luZDIpO1xuICBjb25zdCBBbnlTaGFwZSA9IG1ha2VNYXRjaGVyKFwibWF0Y2g6YW55XCIsIHZvaWQgMCk7XG4gIGNvbnN0IFNjYWxhclNoYXBlID0gbWFrZU1hdGNoZXIoXCJtYXRjaDpzY2FsYXJcIiwgdm9pZCAwKTtcbiAgY29uc3QgS2V5U2hhcGUgPSBtYWtlTWF0Y2hlcihcIm1hdGNoOmtleVwiLCB2b2lkIDApO1xuICBjb25zdCBQYXR0ZXJuU2hhcGUgPSBtYWtlTWF0Y2hlcihcIm1hdGNoOnBhdHRlcm5cIiwgdm9pZCAwKTtcbiAgY29uc3QgQm9vbGVhblNoYXBlID0gbWFrZUtpbmRNYXRjaGVyKFwiYm9vbGVhblwiKTtcbiAgY29uc3QgTnVtYmVyU2hhcGUgPSBtYWtlS2luZE1hdGNoZXIoXCJudW1iZXJcIik7XG4gIGNvbnN0IEJpZ0ludFNoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOmJpZ2ludFwiLCBbXSk7XG4gIGNvbnN0IE5hdFNoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOm5hdFwiLCBbXSk7XG4gIGNvbnN0IFN0cmluZ1NoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOnN0cmluZ1wiLCBbXSk7XG4gIGNvbnN0IFN5bWJvbFNoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOnN5bWJvbFwiLCBbXSk7XG4gIGNvbnN0IFJlY29yZFNoYXBlID0gbWFrZVRhZ2dlZChcIm1hdGNoOnJlY29yZE9mXCIsIFtBbnlTaGFwZSwgQW55U2hhcGVdKTtcbiAgY29uc3QgQXJyYXlTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDphcnJheU9mXCIsIFtBbnlTaGFwZV0pO1xuICBjb25zdCBTZXRTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDpzZXRPZlwiLCBbQW55U2hhcGVdKTtcbiAgY29uc3QgQmFnU2hhcGUgPSBtYWtlVGFnZ2VkKFwibWF0Y2g6YmFnT2ZcIiwgW0FueVNoYXBlLCBBbnlTaGFwZV0pO1xuICBjb25zdCBNYXBTaGFwZSA9IG1ha2VUYWdnZWQoXCJtYXRjaDptYXBPZlwiLCBbQW55U2hhcGUsIEFueVNoYXBlXSk7XG4gIGNvbnN0IFJlbW90YWJsZVNoYXBlID0gbWFrZUtpbmRNYXRjaGVyKFwicmVtb3RhYmxlXCIpO1xuICBjb25zdCBFcnJvclNoYXBlID0gbWFrZUtpbmRNYXRjaGVyKFwiZXJyb3JcIik7XG4gIGNvbnN0IFByb21pc2VTaGFwZSA9IG1ha2VLaW5kTWF0Y2hlcihcInByb21pc2VcIik7XG4gIGNvbnN0IFVuZGVmaW5lZFNoYXBlID0gbWFrZUtpbmRNYXRjaGVyKFwidW5kZWZpbmVkXCIpO1xuICBjb25zdCBtYWtlTGltaXRzTWF0Y2hlciA9ICh0YWcsIHBheWxvYWQpID0+IHtcbiAgICBpZiAocGF5bG9hZFtwYXlsb2FkLmxlbmd0aCAtIDFdID09PSB2b2lkIDApIHtcbiAgICAgIHBheWxvYWQgPSBoYXJkZW4ocGF5bG9hZC5zbGljZSgwLCBwYXlsb2FkLmxlbmd0aCAtIDEpKTtcbiAgICB9XG4gICAgcmV0dXJuIG1ha2VNYXRjaGVyKHRhZywgcGF5bG9hZCk7XG4gIH07XG4gIGNvbnN0IG1ha2VSZW1vdGFibGVNYXRjaGVyID0gKGxhYmVsID0gdm9pZCAwKSA9PiBsYWJlbCA9PT0gdm9pZCAwID8gUmVtb3RhYmxlU2hhcGUgOiBtYWtlTWF0Y2hlcihcIm1hdGNoOnJlbW90YWJsZVwiLCBoYXJkZW4oeyBsYWJlbCB9KSk7XG4gIGNvbnN0IG1ha2VTcGxpdFBheWxvYWQgPSAoZW1wdHk1LCBiYXNlMiwgb3B0aW9uYWwgPSB2b2lkIDAsIHJlc3QgPSB2b2lkIDApID0+IHtcbiAgICBpZiAocmVzdCkge1xuICAgICAgcmV0dXJuIFtiYXNlMiwgb3B0aW9uYWwgfHwgZW1wdHk1LCByZXN0XTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbmFsKSB7XG4gICAgICByZXR1cm4gW2Jhc2UyLCBvcHRpb25hbF07XG4gICAgfVxuICAgIHJldHVybiBbYmFzZTJdO1xuICB9O1xuICBjb25zdCBNMiA9IGhhcmRlbih7XG4gICAgYW55OiAoKSA9PiBBbnlTaGFwZSxcbiAgICBhbmQ6ICguLi5wYXR0cykgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDphbmRcIiwgcGF0dHMpLFxuICAgIG9yOiAoLi4ucGF0dHMpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6b3JcIiwgcGF0dHMpLFxuICAgIG5vdDogKHN1YlBhdHQpID0+IG1ha2VNYXRjaGVyKFwibWF0Y2g6bm90XCIsIHN1YlBhdHQpLFxuICAgIHNjYWxhcjogKCkgPT4gU2NhbGFyU2hhcGUsXG4gICAga2V5OiAoKSA9PiBLZXlTaGFwZSxcbiAgICBwYXR0ZXJuOiAoKSA9PiBQYXR0ZXJuU2hhcGUsXG4gICAga2luZDogbWFrZUtpbmRNYXRjaGVyLFxuICAgIHRhZ2dlZDogKHRhZ1BhdHQgPSBNMi5zdHJpbmcoKSwgcGF5bG9hZFBhdHQgPSBNMi5hbnkoKSkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDp0YWdnZWRcIiwgaGFyZGVuKFt0YWdQYXR0LCBwYXlsb2FkUGF0dF0pKSxcbiAgICBib29sZWFuOiAoKSA9PiBCb29sZWFuU2hhcGUsXG4gICAgbnVtYmVyOiAoKSA9PiBOdW1iZXJTaGFwZSxcbiAgICBiaWdpbnQ6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6YmlnaW50XCIsIFtsaW1pdHNdKSA6IEJpZ0ludFNoYXBlLFxuICAgIG5hdDogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpuYXRcIiwgW2xpbWl0c10pIDogTmF0U2hhcGUsXG4gICAgc3RyaW5nOiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnN0cmluZ1wiLCBbbGltaXRzXSkgOiBTdHJpbmdTaGFwZSxcbiAgICBzeW1ib2w6IChsaW1pdHMgPSB2b2lkIDApID0+IGxpbWl0cyA/IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6c3ltYm9sXCIsIFtsaW1pdHNdKSA6IFN5bWJvbFNoYXBlLFxuICAgIHJlY29yZDogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gTTIucmVjb3JkT2YoTTIuYW55KCksIE0yLmFueSgpLCBsaW1pdHMpIDogUmVjb3JkU2hhcGUsXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICBhcnJheTogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gTTIuYXJyYXlPZihNMi5hbnkoKSwgbGltaXRzKSA6IEFycmF5U2hhcGUsXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgc2V0OiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBNMi5zZXRPZihNMi5hbnkoKSwgbGltaXRzKSA6IFNldFNoYXBlLFxuICAgIGJhZzogKGxpbWl0cyA9IHZvaWQgMCkgPT4gbGltaXRzID8gTTIuYmFnT2YoTTIuYW55KCksIE0yLmFueSgpLCBsaW1pdHMpIDogQmFnU2hhcGUsXG4gICAgbWFwOiAobGltaXRzID0gdm9pZCAwKSA9PiBsaW1pdHMgPyBNMi5tYXBPZihNMi5hbnkoKSwgTTIuYW55KCksIGxpbWl0cykgOiBNYXBTaGFwZSxcbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIHJlbW90YWJsZTogbWFrZVJlbW90YWJsZU1hdGNoZXIsXG4gICAgZXJyb3I6ICgpID0+IEVycm9yU2hhcGUsXG4gICAgcHJvbWlzZTogKCkgPT4gUHJvbWlzZVNoYXBlLFxuICAgIHVuZGVmaW5lZDogKCkgPT4gVW5kZWZpbmVkU2hhcGUsXG4gICAgbnVsbDogKCkgPT4gbnVsbCxcbiAgICBsdDogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpsdFwiLCByaWdodE9wZXJhbmQpLFxuICAgIGx0ZTogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpsdGVcIiwgcmlnaHRPcGVyYW5kKSxcbiAgICBlcTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5KGtleSk7XG4gICAgICByZXR1cm4ga2V5ID09PSB2b2lkIDAgPyBNMi51bmRlZmluZWQoKSA6IGtleTtcbiAgICB9LFxuICAgIG5lcTogKGtleSkgPT4gTTIubm90KE0yLmVxKGtleSkpLFxuICAgIGd0ZTogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpndGVcIiwgcmlnaHRPcGVyYW5kKSxcbiAgICBndDogKHJpZ2h0T3BlcmFuZCkgPT4gbWFrZU1hdGNoZXIoXCJtYXRjaDpndFwiLCByaWdodE9wZXJhbmQpLFxuICAgIHJlY29yZE9mOiAoa2V5UGF0dCA9IE0yLmFueSgpLCB2YWx1ZVBhdHQgPSBNMi5hbnkoKSwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnJlY29yZE9mXCIsIFtrZXlQYXR0LCB2YWx1ZVBhdHQsIGxpbWl0c10pLFxuICAgIGFycmF5T2Y6IChzdWJQYXR0ID0gTTIuYW55KCksIGxpbWl0cyA9IHZvaWQgMCkgPT4gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDphcnJheU9mXCIsIFtzdWJQYXR0LCBsaW1pdHNdKSxcbiAgICBzZXRPZjogKGtleVBhdHQgPSBNMi5hbnkoKSwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOnNldE9mXCIsIFtrZXlQYXR0LCBsaW1pdHNdKSxcbiAgICBiYWdPZjogKGtleVBhdHQgPSBNMi5hbnkoKSwgY291bnRQYXR0ID0gTTIuYW55KCksIGxpbWl0cyA9IHZvaWQgMCkgPT4gbWFrZUxpbWl0c01hdGNoZXIoXCJtYXRjaDpiYWdPZlwiLCBba2V5UGF0dCwgY291bnRQYXR0LCBsaW1pdHNdKSxcbiAgICBjb250YWluZXJIYXM6IChlbGVtZW50UGF0dCA9IE0yLmFueSgpLCBjb3VudFBhdHQgPSAxbiwgbGltaXRzID0gdm9pZCAwKSA9PiBtYWtlTGltaXRzTWF0Y2hlcihcIm1hdGNoOmNvbnRhaW5lckhhc1wiLCBbZWxlbWVudFBhdHQsIGNvdW50UGF0dCwgbGltaXRzXSksXG4gICAgbWFwT2Y6IChrZXlQYXR0ID0gTTIuYW55KCksIHZhbHVlUGF0dCA9IE0yLmFueSgpLCBsaW1pdHMgPSB2b2lkIDApID0+IG1ha2VMaW1pdHNNYXRjaGVyKFwibWF0Y2g6bWFwT2ZcIiwgW2tleVBhdHQsIHZhbHVlUGF0dCwgbGltaXRzXSksXG4gICAgc3BsaXRBcnJheTogKGJhc2UyLCBvcHRpb25hbCA9IHZvaWQgMCwgcmVzdCA9IHZvaWQgMCkgPT4gbWFrZU1hdGNoZXIoXG4gICAgICBcIm1hdGNoOnNwbGl0QXJyYXlcIixcbiAgICAgIG1ha2VTcGxpdFBheWxvYWQoW10sIGJhc2UyLCBvcHRpb25hbCwgcmVzdClcbiAgICApLFxuICAgIHNwbGl0UmVjb3JkOiAoYmFzZTIsIG9wdGlvbmFsID0gdm9pZCAwLCByZXN0ID0gdm9pZCAwKSA9PiBtYWtlTWF0Y2hlcihcbiAgICAgIFwibWF0Y2g6c3BsaXRSZWNvcmRcIixcbiAgICAgIG1ha2VTcGxpdFBheWxvYWQoe30sIGJhc2UyLCBvcHRpb25hbCwgcmVzdClcbiAgICApLFxuICAgIHNwbGl0OiAoYmFzZTIsIHJlc3QgPSB2b2lkIDApID0+IHtcbiAgICAgIGlmIChwYXNzU3R5bGVPZihoYXJkZW4oYmFzZTIpKSA9PT0gXCJjb3B5QXJyYXlcIikge1xuICAgICAgICByZXR1cm4gTTIuc3BsaXRBcnJheShiYXNlMiwgcmVzdCAmJiBbXSwgcmVzdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gTTIuc3BsaXRSZWNvcmQoYmFzZTIsIHJlc3QgJiYge30sIHJlc3QpO1xuICAgICAgfVxuICAgIH0sXG4gICAgcGFydGlhbDogKGJhc2UyLCByZXN0ID0gdm9pZCAwKSA9PiB7XG4gICAgICBpZiAocGFzc1N0eWxlT2YoaGFyZGVuKGJhc2UyKSkgPT09IFwiY29weUFycmF5XCIpIHtcbiAgICAgICAgcmV0dXJuIE0yLnNwbGl0QXJyYXkoW10sIGJhc2UyLCByZXN0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBNMi5zcGxpdFJlY29yZCh7fSwgYmFzZTIsIHJlc3QpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZXJlZjogKHQ1KSA9PiBNMi5vcih0NSwgTTIucHJvbWlzZSgpKSxcbiAgICBvcHQ6ICh0NSkgPT4gTTIub3IoTTIudW5kZWZpbmVkKCksIHQ1KSxcbiAgICBpbnRlcmZhY2U6IChpbnRlcmZhY2VOYW1lLCBtZXRob2RHdWFyZHMsIG9wdGlvbnMpID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlSW50ZXJmYWNlR3VhcmQoaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCBvcHRpb25zKVxuICAgICksXG4gICAgY2FsbDogKC4uLmFyZ1BhdHRlcm5zKSA9PiAoXG4gICAgICAvL1xuICAgICAgbWFrZU1ldGhvZEd1YXJkTWFrZXIoXCJzeW5jXCIsIGFyZ1BhdHRlcm5zKVxuICAgICksXG4gICAgY2FsbFdoZW46ICguLi5hcmdHdWFyZHMpID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlTWV0aG9kR3VhcmRNYWtlcihcImFzeW5jXCIsIGFyZ0d1YXJkcylcbiAgICApLFxuICAgIGF3YWl0OiAoYXJnUGF0dGVybikgPT4gKFxuICAgICAgLy9cbiAgICAgIG1ha2VBd2FpdEFyZ0d1YXJkKGFyZ1BhdHRlcm4pXG4gICAgKSxcbiAgICByYXc6ICgpID0+IChcbiAgICAgIC8vXG4gICAgICBtYWtlUmF3R3VhcmQoKVxuICAgIClcbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGNoZWNrTWF0Y2hlczogY2hlY2tNYXRjaGVzMixcbiAgICBtYXRjaGVzOiBtYXRjaGVzMixcbiAgICBtdXN0TWF0Y2g6IG11c3RNYXRjaDMsXG4gICAgYXNzZXJ0UGF0dGVybjogYXNzZXJ0UGF0dGVybjIsXG4gICAgaXNQYXR0ZXJuOiBpc1BhdHRlcm4yLFxuICAgIGdldFJhbmtDb3ZlcjogZ2V0UmFua0NvdmVyMixcbiAgICBNOiBNMixcbiAgICBraW5kT2Y6IGtpbmRPZjIsXG4gICAgY29udGFpbmVySGFzU3BsaXQ6IGNvbnRhaW5lckhhc1NwbGl0MlxuICB9KTtcbn07XG52YXIge1xuICBjaGVja01hdGNoZXMsXG4gIG1hdGNoZXMsXG4gIG11c3RNYXRjaCxcbiAgYXNzZXJ0UGF0dGVybixcbiAgaXNQYXR0ZXJuLFxuICBnZXRSYW5rQ292ZXIsXG4gIE0sXG4gIGtpbmRPZixcbiAgY29udGFpbmVySGFzU3BsaXRcbn0gPSBtYWtlUGF0dGVybktpdCgpO1xuTU0gPSBNO1xudmFyIEF3YWl0QXJnR3VhcmRQYXlsb2FkU2hhcGUgPSBoYXJkZW4oe1xuICBhcmdHdWFyZDogTS5wYXR0ZXJuKClcbn0pO1xudmFyIEF3YWl0QXJnR3VhcmRTaGFwZSA9IE0ua2luZChcImd1YXJkOmF3YWl0QXJnR3VhcmRcIik7XG52YXIgaXNBd2FpdEFyZ0d1YXJkID0gKHNwZWNpbWVuKSA9PiBtYXRjaGVzKHNwZWNpbWVuLCBBd2FpdEFyZ0d1YXJkU2hhcGUpO1xuaGFyZGVuKGlzQXdhaXRBcmdHdWFyZCk7XG52YXIgYXNzZXJ0QXdhaXRBcmdHdWFyZCA9IChzcGVjaW1lbikgPT4ge1xuICBtdXN0TWF0Y2goc3BlY2ltZW4sIEF3YWl0QXJnR3VhcmRTaGFwZSwgXCJhd2FpdEFyZ0d1YXJkXCIpO1xufTtcbmhhcmRlbihhc3NlcnRBd2FpdEFyZ0d1YXJkKTtcbnZhciBtYWtlQXdhaXRBcmdHdWFyZCA9IChhcmdQYXR0ZXJuKSA9PiB7XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VUYWdnZWQoXCJndWFyZDphd2FpdEFyZ0d1YXJkXCIsIHtcbiAgICBhcmdHdWFyZDogYXJnUGF0dGVyblxuICB9KTtcbiAgYXNzZXJ0QXdhaXRBcmdHdWFyZChyZXN1bHQpO1xuICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBSYXdHdWFyZFBheWxvYWRTaGFwZSA9IE0ucmVjb3JkKCk7XG52YXIgUmF3R3VhcmRTaGFwZSA9IE0ua2luZChcImd1YXJkOnJhd0d1YXJkXCIpO1xudmFyIGlzUmF3R3VhcmQgPSAoc3BlY2ltZW4pID0+IG1hdGNoZXMoc3BlY2ltZW4sIFJhd0d1YXJkU2hhcGUpO1xudmFyIG1ha2VSYXdHdWFyZCA9ICgpID0+IG1ha2VUYWdnZWQoXCJndWFyZDpyYXdHdWFyZFwiLCB7fSk7XG52YXIgU3luY1ZhbHVlR3VhcmRTaGFwZSA9IE0ub3IoUmF3R3VhcmRTaGFwZSwgTS5wYXR0ZXJuKCkpO1xudmFyIFN5bmNWYWx1ZUd1YXJkTGlzdFNoYXBlID0gTS5hcnJheU9mKFN5bmNWYWx1ZUd1YXJkU2hhcGUpO1xudmFyIEFyZ0d1YXJkU2hhcGUgPSBNLm9yKFJhd0d1YXJkU2hhcGUsIEF3YWl0QXJnR3VhcmRTaGFwZSwgTS5wYXR0ZXJuKCkpO1xudmFyIEFyZ0d1YXJkTGlzdFNoYXBlID0gTS5hcnJheU9mKEFyZ0d1YXJkU2hhcGUpO1xudmFyIFN5bmNNZXRob2RHdWFyZFBheWxvYWRTaGFwZSA9IGhhcmRlbih7XG4gIGNhbGxLaW5kOiBcInN5bmNcIixcbiAgYXJnR3VhcmRzOiBTeW5jVmFsdWVHdWFyZExpc3RTaGFwZSxcbiAgb3B0aW9uYWxBcmdHdWFyZHM6IE0ub3B0KFN5bmNWYWx1ZUd1YXJkTGlzdFNoYXBlKSxcbiAgcmVzdEFyZ0d1YXJkOiBNLm9wdChTeW5jVmFsdWVHdWFyZFNoYXBlKSxcbiAgcmV0dXJuR3VhcmQ6IFN5bmNWYWx1ZUd1YXJkU2hhcGVcbn0pO1xudmFyIEFzeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUgPSBoYXJkZW4oe1xuICBjYWxsS2luZDogXCJhc3luY1wiLFxuICBhcmdHdWFyZHM6IEFyZ0d1YXJkTGlzdFNoYXBlLFxuICBvcHRpb25hbEFyZ0d1YXJkczogTS5vcHQoQXJnR3VhcmRMaXN0U2hhcGUpLFxuICByZXN0QXJnR3VhcmQ6IE0ub3B0KFN5bmNWYWx1ZUd1YXJkU2hhcGUpLFxuICByZXR1cm5HdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxufSk7XG52YXIgTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUgPSBNLm9yKFxuICBTeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUsXG4gIEFzeW5jTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGVcbik7XG52YXIgTWV0aG9kR3VhcmRTaGFwZSA9IE0ua2luZChcImd1YXJkOm1ldGhvZEd1YXJkXCIpO1xudmFyIGFzc2VydE1ldGhvZEd1YXJkID0gKHNwZWNpbWVuKSA9PiB7XG4gIG11c3RNYXRjaChzcGVjaW1lbiwgTWV0aG9kR3VhcmRTaGFwZSwgXCJtZXRob2RHdWFyZFwiKTtcbn07XG5oYXJkZW4oYXNzZXJ0TWV0aG9kR3VhcmQpO1xudmFyIG1ha2VNZXRob2RHdWFyZE1ha2VyID0gKGNhbGxLaW5kLCBhcmdHdWFyZHMsIG9wdGlvbmFsQXJnR3VhcmRzID0gdm9pZCAwLCByZXN0QXJnR3VhcmQgPSB2b2lkIDApID0+IGhhcmRlbih7XG4gIG9wdGlvbmFsOiAoLi4ub3B0QXJnR3VhcmRzKSA9PiB7XG4gICAgb3B0aW9uYWxBcmdHdWFyZHMgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYENhbiBvbmx5IGhhdmUgb25lIHNldCBvZiBvcHRpb25hbCBndWFyZHNgO1xuICAgIHJlc3RBcmdHdWFyZCA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgb3B0aW9uYWwgYXJnIGd1YXJkcyBtdXN0IGNvbWUgYmVmb3JlIHJlc3QgYXJnYDtcbiAgICByZXR1cm4gbWFrZU1ldGhvZEd1YXJkTWFrZXIoY2FsbEtpbmQsIGFyZ0d1YXJkcywgb3B0QXJnR3VhcmRzKTtcbiAgfSxcbiAgcmVzdDogKHJBcmdHdWFyZCkgPT4ge1xuICAgIHJlc3RBcmdHdWFyZCA9PT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgQ2FuIG9ubHkgaGF2ZSBvbmUgcmVzdCBhcmdgO1xuICAgIHJldHVybiBtYWtlTWV0aG9kR3VhcmRNYWtlcihcbiAgICAgIGNhbGxLaW5kLFxuICAgICAgYXJnR3VhcmRzLFxuICAgICAgb3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgICByQXJnR3VhcmRcbiAgICApO1xuICB9LFxuICByZXR1cm5zOiAocmV0dXJuR3VhcmQgPSBNLnVuZGVmaW5lZCgpKSA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gbWFrZVRhZ2dlZChcImd1YXJkOm1ldGhvZEd1YXJkXCIsIHtcbiAgICAgIGNhbGxLaW5kLFxuICAgICAgYXJnR3VhcmRzLFxuICAgICAgb3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgICByZXN0QXJnR3VhcmQsXG4gICAgICByZXR1cm5HdWFyZFxuICAgIH0pO1xuICAgIGFzc2VydE1ldGhvZEd1YXJkKHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufSk7XG52YXIgSW50ZXJmYWNlR3VhcmRQYXlsb2FkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgaW50ZXJmYWNlTmFtZTogTS5zdHJpbmcoKSxcbiAgICBtZXRob2RHdWFyZHM6IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgTWV0aG9kR3VhcmRTaGFwZSlcbiAgfSxcbiAge1xuICAgIGRlZmF1bHRHdWFyZHM6IE0ub3IoTS51bmRlZmluZWQoKSwgXCJwYXNzYWJsZVwiLCBcInJhd1wiKSxcbiAgICBzbG9wcHk6IE0uYm9vbGVhbigpLFxuICAgIHN5bWJvbE1ldGhvZEd1YXJkczogTS5tYXBPZihNLnN5bWJvbCgpLCBNZXRob2RHdWFyZFNoYXBlKVxuICB9XG4pO1xudmFyIEludGVyZmFjZUd1YXJkU2hhcGUgPSBNLmtpbmQoXCJndWFyZDppbnRlcmZhY2VHdWFyZFwiKTtcbnZhciBhc3NlcnRJbnRlcmZhY2VHdWFyZCA9IChzcGVjaW1lbikgPT4ge1xuICBtdXN0TWF0Y2goc3BlY2ltZW4sIEludGVyZmFjZUd1YXJkU2hhcGUsIFwiaW50ZXJmYWNlR3VhcmRcIik7XG59O1xuaGFyZGVuKGFzc2VydEludGVyZmFjZUd1YXJkKTtcbnZhciBtYWtlSW50ZXJmYWNlR3VhcmQgPSAoaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCBvcHRpb25zID0ge30pID0+IHtcbiAgY29uc3QgeyBzbG9wcHkgPSBmYWxzZSwgZGVmYXVsdEd1YXJkcyA9IHNsb3BweSA/IFwicGFzc2FibGVcIiA6IHZvaWQgMCB9ID0gb3B0aW9ucztcbiAgY29uc3Qgc3RyaW5nTWV0aG9kR3VhcmRzID0ge307XG4gIGNvbnN0IHN5bWJvbE1ldGhvZEd1YXJkc0VudHJpZXMgPSBbXTtcbiAgZm9yIChjb25zdCBrZXkgb2Ygb3duS2V5czE3KG1ldGhvZEd1YXJkcykpIHtcbiAgICBjb25zdCB2YWx1ZSA9IG1ldGhvZEd1YXJkc1tcbiAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAga2V5XG4gICAgXTtcbiAgICBpZiAodHlwZW9mIGtleSA9PT0gXCJzeW1ib2xcIikge1xuICAgICAgc3ltYm9sTWV0aG9kR3VhcmRzRW50cmllcy5wdXNoKFtrZXksIHZhbHVlXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0cmluZ01ldGhvZEd1YXJkc1trZXldID0gdmFsdWU7XG4gICAgfVxuICB9XG4gIGNvbnN0IHJlc3VsdCA9IG1ha2VUYWdnZWQoXCJndWFyZDppbnRlcmZhY2VHdWFyZFwiLCB7XG4gICAgaW50ZXJmYWNlTmFtZSxcbiAgICBtZXRob2RHdWFyZHM6IHN0cmluZ01ldGhvZEd1YXJkcyxcbiAgICAuLi4oc3ltYm9sTWV0aG9kR3VhcmRzRW50cmllcy5sZW5ndGg/IHsgc3ltYm9sTWV0aG9kR3VhcmRzOiBtYWtlQ29weU1hcChzeW1ib2xNZXRob2RHdWFyZHNFbnRyaWVzKSB9IDoge30pLFxuICAgIGRlZmF1bHRHdWFyZHNcbiAgfSk7XG4gIGFzc2VydEludGVyZmFjZUd1YXJkKHJlc3VsdCk7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICByZXN1bHRcbiAgKTtcbn07XG52YXIgR3VhcmRQYXlsb2FkU2hhcGVzID0gaGFyZGVuKHtcbiAgXCJndWFyZDphd2FpdEFyZ0d1YXJkXCI6IEF3YWl0QXJnR3VhcmRQYXlsb2FkU2hhcGUsXG4gIFwiZ3VhcmQ6cmF3R3VhcmRcIjogUmF3R3VhcmRQYXlsb2FkU2hhcGUsXG4gIFwiZ3VhcmQ6bWV0aG9kR3VhcmRcIjogTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUsXG4gIFwiZ3VhcmQ6aW50ZXJmYWNlR3VhcmRcIjogSW50ZXJmYWNlR3VhcmRQYXlsb2FkU2hhcGVcbn0pO1xuXG4vL1xudmFyIExlZ2FjeUF3YWl0QXJnR3VhcmRTaGFwZSA9IGhhcmRlbih7XG4gIGtsYXNzOiBcImF3YWl0QXJnXCIsXG4gIGFyZ0d1YXJkOiBNLnBhdHRlcm4oKVxufSk7XG52YXIgZ2V0QXdhaXRBcmdHdWFyZFBheWxvYWQgPSAoYXdhaXRBcmdHdWFyZCkgPT4ge1xuICBpZiAobWF0Y2hlcyhhd2FpdEFyZ0d1YXJkLCBMZWdhY3lBd2FpdEFyZ0d1YXJkU2hhcGUpKSB7XG4gICAgY29uc3QgeyBrbGFzczogXywgLi4ucGF5bG9hZCB9ID0gYXdhaXRBcmdHdWFyZDtcbiAgICByZXR1cm4gcGF5bG9hZDtcbiAgfVxuICBhc3NlcnRBd2FpdEFyZ0d1YXJkKGF3YWl0QXJnR3VhcmQpO1xuICByZXR1cm4gYXdhaXRBcmdHdWFyZC5wYXlsb2FkO1xufTtcbmhhcmRlbihnZXRBd2FpdEFyZ0d1YXJkUGF5bG9hZCk7XG52YXIgTGVnYWN5U3luY01ldGhvZEd1YXJkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAga2xhc3M6IFwibWV0aG9kR3VhcmRcIixcbiAgICBjYWxsS2luZDogXCJzeW5jXCIsXG4gICAgYXJnR3VhcmRzOiBTeW5jVmFsdWVHdWFyZExpc3RTaGFwZSxcbiAgICByZXR1cm5HdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxuICB9LFxuICB7XG4gICAgb3B0aW9uYWxBcmdHdWFyZHM6IFN5bmNWYWx1ZUd1YXJkTGlzdFNoYXBlLFxuICAgIHJlc3RBcmdHdWFyZDogU3luY1ZhbHVlR3VhcmRTaGFwZVxuICB9XG4pO1xudmFyIExlZ2FjeUFyZ0d1YXJkU2hhcGUgPSBNLm9yKFxuICBSYXdHdWFyZFNoYXBlLFxuICBBd2FpdEFyZ0d1YXJkU2hhcGUsXG4gIExlZ2FjeUF3YWl0QXJnR3VhcmRTaGFwZSxcbiAgTS5wYXR0ZXJuKClcbik7XG52YXIgTGVnYWN5QXJnR3VhcmRMaXN0U2hhcGUgPSBNLmFycmF5T2YoTGVnYWN5QXJnR3VhcmRTaGFwZSk7XG52YXIgTGVnYWN5QXN5bmNNZXRob2RHdWFyZFNoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGtsYXNzOiBcIm1ldGhvZEd1YXJkXCIsXG4gICAgY2FsbEtpbmQ6IFwiYXN5bmNcIixcbiAgICBhcmdHdWFyZHM6IExlZ2FjeUFyZ0d1YXJkTGlzdFNoYXBlLFxuICAgIHJldHVybkd1YXJkOiBTeW5jVmFsdWVHdWFyZFNoYXBlXG4gIH0sXG4gIHtcbiAgICBvcHRpb25hbEFyZ0d1YXJkczogQXJnR3VhcmRMaXN0U2hhcGUsXG4gICAgcmVzdEFyZ0d1YXJkOiBTeW5jVmFsdWVHdWFyZFNoYXBlXG4gIH1cbik7XG52YXIgTGVnYWN5TWV0aG9kR3VhcmRTaGFwZSA9IE0ub3IoXG4gIExlZ2FjeVN5bmNNZXRob2RHdWFyZFNoYXBlLFxuICBMZWdhY3lBc3luY01ldGhvZEd1YXJkU2hhcGVcbik7XG52YXIgYWRhcHRMZWdhY3lBcmdHdWFyZCA9IChhcmdHdWFyZCkgPT4gbWF0Y2hlcyhhcmdHdWFyZCwgTGVnYWN5QXdhaXRBcmdHdWFyZFNoYXBlKSA/IE0uYXdhaXQoZ2V0QXdhaXRBcmdHdWFyZFBheWxvYWQoYXJnR3VhcmQpLmFyZ0d1YXJkKSA6IGFyZ0d1YXJkO1xudmFyIGdldE1ldGhvZEd1YXJkUGF5bG9hZCA9IChtZXRob2RHdWFyZCkgPT4ge1xuICBpZiAobWF0Y2hlcyhtZXRob2RHdWFyZCwgTWV0aG9kR3VhcmRTaGFwZSkpIHtcbiAgICByZXR1cm4gbWV0aG9kR3VhcmQucGF5bG9hZDtcbiAgfVxuICBtdXN0TWF0Y2gobWV0aG9kR3VhcmQsIExlZ2FjeU1ldGhvZEd1YXJkU2hhcGUsIFwibGVnYWN5TWV0aG9kR3VhcmRcIik7XG4gIGNvbnN0IHtcbiAgICAvL1xuICAgIGtsYXNzOiBfLFxuICAgIC8vXG4gICAgY2FsbEtpbmQsXG4gICAgLy9cbiAgICByZXR1cm5HdWFyZCxcbiAgICAvL1xuICAgIHJlc3RBcmdHdWFyZFxuICB9ID0gbWV0aG9kR3VhcmQ7XG4gIGxldCB7XG4gICAgLy9cbiAgICBhcmdHdWFyZHMsXG4gICAgLy9cbiAgICBvcHRpb25hbEFyZ0d1YXJkc1xuICB9ID0gbWV0aG9kR3VhcmQ7XG4gIGlmIChjYWxsS2luZCA9PT0gXCJhc3luY1wiKSB7XG4gICAgYXJnR3VhcmRzID0gYXJnR3VhcmRzLm1hcChhZGFwdExlZ2FjeUFyZ0d1YXJkKTtcbiAgICBvcHRpb25hbEFyZ0d1YXJkcyA9IG9wdGlvbmFsQXJnR3VhcmRzICYmIG9wdGlvbmFsQXJnR3VhcmRzLm1hcChhZGFwdExlZ2FjeUFyZ0d1YXJkKTtcbiAgfVxuICBjb25zdCBwYXlsb2FkID0gaGFyZGVuKHtcbiAgICBjYWxsS2luZCxcbiAgICBhcmdHdWFyZHMsXG4gICAgb3B0aW9uYWxBcmdHdWFyZHMsXG4gICAgcmVzdEFyZ0d1YXJkLFxuICAgIHJldHVybkd1YXJkXG4gIH0pO1xuICBtdXN0TWF0Y2gocGF5bG9hZCwgTWV0aG9kR3VhcmRQYXlsb2FkU2hhcGUsIFwiaW50ZXJuYWxNZXRob2RHdWFyZEFkYXB0b3JcIik7XG4gIHJldHVybiBwYXlsb2FkO1xufTtcbmhhcmRlbihnZXRNZXRob2RHdWFyZFBheWxvYWQpO1xudmFyIExlZ2FjeUludGVyZmFjZUd1YXJkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAga2xhc3M6IFwiSW50ZXJmYWNlXCIsXG4gICAgaW50ZXJmYWNlTmFtZTogTS5zdHJpbmcoKSxcbiAgICBtZXRob2RHdWFyZHM6IE0ucmVjb3JkT2YoXG4gICAgICBNLnN0cmluZygpLFxuICAgICAgTS5vcihNZXRob2RHdWFyZFNoYXBlLCBMZWdhY3lNZXRob2RHdWFyZFNoYXBlKVxuICAgIClcbiAgfSxcbiAge1xuICAgIGRlZmF1bHRHdWFyZHM6IE0ub3IoTS51bmRlZmluZWQoKSwgXCJwYXNzYWJsZVwiLCBcInJhd1wiKSxcbiAgICBzbG9wcHk6IE0uYm9vbGVhbigpLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIHN5bWJvbE1ldGhvZEd1YXJkczogTS5tYXBPZihNLnN5bWJvbCgpLCBNZXRob2RHdWFyZFNoYXBlKVxuICB9XG4pO1xudmFyIGFkYXB0TWV0aG9kR3VhcmQgPSAobWV0aG9kR3VhcmQpID0+IHtcbiAgaWYgKG1hdGNoZXMobWV0aG9kR3VhcmQsIExlZ2FjeU1ldGhvZEd1YXJkU2hhcGUpKSB7XG4gICAgY29uc3Qge1xuICAgICAgY2FsbEtpbmQsXG4gICAgICBhcmdHdWFyZHMsXG4gICAgICBvcHRpb25hbEFyZ0d1YXJkcyA9IFtdLFxuICAgICAgcmVzdEFyZ0d1YXJkID0gTS5hbnkoKSxcbiAgICAgIHJldHVybkd1YXJkXG4gICAgfSA9IGdldE1ldGhvZEd1YXJkUGF5bG9hZChtZXRob2RHdWFyZCk7XG4gICAgY29uc3QgbUNhbGwgPSBjYWxsS2luZCA9PT0gXCJzeW5jXCIgPyBNLmNhbGwgOiBNLmNhbGxXaGVuO1xuICAgIHJldHVybiBtQ2FsbCguLi5hcmdHdWFyZHMpLm9wdGlvbmFsKC4uLm9wdGlvbmFsQXJnR3VhcmRzKS5yZXN0KHJlc3RBcmdHdWFyZCkucmV0dXJucyhyZXR1cm5HdWFyZCk7XG4gIH1cbiAgcmV0dXJuIG1ldGhvZEd1YXJkO1xufTtcbnZhciBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQgPSAoaW50ZXJmYWNlR3VhcmQpID0+IHtcbiAgaWYgKG1hdGNoZXMoaW50ZXJmYWNlR3VhcmQsIEludGVyZmFjZUd1YXJkU2hhcGUpKSB7XG4gICAgcmV0dXJuIGludGVyZmFjZUd1YXJkLnBheWxvYWQ7XG4gIH1cbiAgbXVzdE1hdGNoKGludGVyZmFjZUd1YXJkLCBMZWdhY3lJbnRlcmZhY2VHdWFyZFNoYXBlLCBcImxlZ2FjeUludGVyZmFjZUd1YXJkXCIpO1xuICBsZXQgeyBrbGFzczogXywgaW50ZXJmYWNlTmFtZSwgbWV0aG9kR3VhcmRzLCAuLi5yZXN0IH0gPSBpbnRlcmZhY2VHdWFyZDtcbiAgbWV0aG9kR3VhcmRzID0gb2JqZWN0TWFwKG1ldGhvZEd1YXJkcywgYWRhcHRNZXRob2RHdWFyZCk7XG4gIGNvbnN0IHBheWxvYWQgPSBoYXJkZW4oe1xuICAgIGludGVyZmFjZU5hbWUsXG4gICAgbWV0aG9kR3VhcmRzLFxuICAgIC4uLnJlc3RcbiAgfSk7XG4gIG11c3RNYXRjaChcbiAgICBwYXlsb2FkLFxuICAgIEludGVyZmFjZUd1YXJkUGF5bG9hZFNoYXBlLFxuICAgIFwiaW50ZXJuYWxJbnRlcmZhY2VHdWFyZEFkYXB0b3JcIlxuICApO1xuICByZXR1cm4gcGF5bG9hZDtcbn07XG5oYXJkZW4oZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKTtcbnZhciBlbXB0eUNvcHlNYXAgPSBtYWtlQ29weU1hcChbXSk7XG52YXIgZ2V0SW50ZXJmYWNlTWV0aG9kS2V5cyA9IChpbnRlcmZhY2VHdWFyZCkgPT4ge1xuICBjb25zdCB7IG1ldGhvZEd1YXJkcywgc3ltYm9sTWV0aG9kR3VhcmRzID0gZW1wdHlDb3B5TWFwIH0gPSBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoaW50ZXJmYWNlR3VhcmQpO1xuICByZXR1cm4gaGFyZGVuKFtcbiAgICAuLi5SZWZsZWN0Lm93bktleXMobWV0aG9kR3VhcmRzKSxcbiAgICAuLi5nZXRDb3B5TWFwS2V5cyhzeW1ib2xNZXRob2RHdWFyZHMpXG4gIF0pO1xufTtcbmhhcmRlbihnZXRJbnRlcmZhY2VNZXRob2RLZXlzKTtcblxuLy9cbnZhciBtYWtlV2Vha1NldFN0b3JlTWV0aG9kcyA9IChqc3NldCwgYXNzZXJ0S2V5T2tUb0FkZCwgYXNzZXJ0S2V5T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgY29uc3QgYXNzZXJ0S2V5RXhpc3RzID0gKGtleSkgPT4ganNzZXQuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGtleU5hbWUpfSBub3QgZm91bmQ6ICR7a2V5fWA7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGhhczogKGtleSkgPT4ge1xuICAgICAgcmV0dXJuIGpzc2V0LmhhcyhrZXkpO1xuICAgIH0sXG4gICAgYWRkOiAoa2V5KSA9PiB7XG4gICAgICBhc3NlcnRLZXlPa1RvQWRkKGtleSk7XG4gICAgICBqc3NldC5hZGQoa2V5KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBpZiAoYXNzZXJ0S2V5T2tUb0RlbGV0ZSAhPT0gdm9pZCAwKSB7XG4gICAgICAgIGFzc2VydEtleU9rVG9EZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICAgIGpzc2V0LmRlbGV0ZShrZXkpO1xuICAgIH0sXG4gICAgYWRkQWxsOiAoa2V5czQpID0+IHtcbiAgICAgIGlmICh0eXBlb2Yga2V5czRbU3ltYm9sLml0ZXJhdG9yXSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGlmIChPYmplY3QuaXNGcm96ZW4oa2V5czQpICYmIGlzQ29weVNldChrZXlzNCkpIHtcbiAgICAgICAgICBrZXlzNCA9IGdldENvcHlTZXRLZXlzKGtleXM0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvd1JlZGFjdGVkYHByb3ZpZGVkIGRhdGEgc291cmNlIGlzIG5vdCBpdGVyYWJsZTogJHtrZXlzNH1gO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IgKFxuICAgICAgICBjb25zdCBrZXkgb2ZcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAga2V5czRcbiAgICAgICkge1xuICAgICAgICBhc3NlcnRLZXlPa1RvQWRkKGtleSk7XG4gICAgICAgIGpzc2V0LmFkZChrZXkpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJXZWFrU2V0U3RvcmUgPSAodGFnID0gXCJrZXlcIiwgeyBsb25nTGl2ZWQgPSB0cnVlLCBrZXlTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNzZXQgPSBuZXcgKGxvbmdMaXZlZCA/IFdlYWtTZXQgOiBTZXQpKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S2V5T2tUb0FkZCA9IChrZXkpID0+IHtcbiAgICBoYXJkZW4oa2V5KTtcbiAgICBwYXNzU3R5bGVPZihrZXkpID09PSBcInJlbW90YWJsZVwiIHx8IHRocm93UmVkYWN0ZWRgT25seSByZW1vdGFibGVzIGNhbiBiZSBrZXlzIG9mIHNjYWxhciBXZWFrU3RvcmVzOiAke2tleX1gO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJ3ZWFrU2V0U3RvcmUga2V5XCIpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIEZhcihgc2NhbGFyIFdlYWtTZXRTdG9yZSBvZiAke3F1b3RlKHRhZyl9YCwge1xuICAgIC4uLm1ha2VXZWFrU2V0U3RvcmVNZXRob2RzKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCB2b2lkIDAsIHRhZylcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJXZWFrU2V0U3RvcmUpO1xuXG4vL1xudmFyIG1ha2VDdXJyZW50S2V5c0tpdCA9IChnZXRSYXdLZXlzLCBjaGVja0hhcywgY29tcGFyZSwgYXNzZXJ0T2tUb0FkZCwgYXNzZXJ0T2tUb0RlbGV0ZSA9IHZvaWQgMCwga2V5TmFtZSA9IFwia2V5XCIpID0+IHtcbiAgbGV0IHVwZGF0ZUNvdW50ID0gMDtcbiAgbGV0IHNvcnRlZEtleXNNZW1vO1xuICBjb25zdCBhc3NlcnRVcGRhdGVPbkFkZCA9IChrLCB2MyA9IHZvaWQgMCkgPT4ge1xuICAgIGFzc2VydE9rVG9BZGQoaywgdjMpO1xuICAgIHVwZGF0ZUNvdW50ICs9IDE7XG4gICAgc29ydGVkS2V5c01lbW8gPSB2b2lkIDA7XG4gIH07XG4gIGNvbnN0IGFzc2VydFVwZGF0ZU9uRGVsZXRlID0gKGspID0+IGFzc2VydE9rVG9EZWxldGUgJiYgYXNzZXJ0T2tUb0RlbGV0ZShrKTtcbiAgY29uc3QgZ2V0U29ydGVkS2V5cyA9ICgpID0+IHtcbiAgICBpZiAoc29ydGVkS2V5c01lbW8gPT09IHZvaWQgMCkge1xuICAgICAgc29ydGVkS2V5c01lbW8gPSBoYXJkZW4oWy4uLmdldFJhd0tleXMoKV0uc29ydChjb21wYXJlKSk7XG4gICAgfVxuICAgIHJldHVybiBzb3J0ZWRLZXlzTWVtbztcbiAgfTtcbiAgY29uc3QgaXRlcmFibGVLZXlzID0gRmFyKFwiSXRlcmFibGUgb2Yga2V5c1wiLCB7XG4gICAgW1N5bWJvbC5pdGVyYXRvcl06ICgpID0+IHtcbiAgICAgIGNvbnN0IGdlbmVyYXRpb24gPSB1cGRhdGVDb3VudDtcbiAgICAgIGdldFNvcnRlZEtleXMoKTtcbiAgICAgIGNvbnN0IGxlbiA9IHNvcnRlZEtleXNNZW1vLmxlbmd0aDtcbiAgICAgIGxldCBpMiA9IDA7XG4gICAgICByZXR1cm4gRmFyKFwiSXRlcmF0b3Igb2Yga2V5c1wiLCB7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBnZW5lcmF0aW9uID09PSB1cGRhdGVDb3VudCB8fCB0aHJvd1JlZGFjdGVkYFN0b3JlICR7cXVvdGUoa2V5TmFtZSl9IGN1cnNvciBzdGFsZWA7XG4gICAgICAgICAgZm9yICg7IDsgKSB7XG4gICAgICAgICAgICBpZiAoaTIgPCBsZW4pIHtcbiAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBzb3J0ZWRLZXlzTWVtb1tpMl07XG4gICAgICAgICAgICAgIGkyICs9IDE7XG4gICAgICAgICAgICAgIGlmIChjaGVja0hhcyh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogZmFsc2UsIHZhbHVlIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHZvaWQgMCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGFzc2VydFVwZGF0ZU9uQWRkLFxuICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgIGl0ZXJhYmxlS2V5c1xuICB9KTtcbn07XG5oYXJkZW4obWFrZUN1cnJlbnRLZXlzS2l0KTtcbnZhciBwcm92aWRlTGF6eSA9IChtYXBTdG9yZSwga2V5LCBtYWtlVmFsdWUpID0+IHtcbiAgaWYgKCFtYXBTdG9yZS5oYXMoa2V5KSkge1xuICAgIG1hcFN0b3JlLmluaXQoa2V5LCBtYWtlVmFsdWUoa2V5KSk7XG4gIH1cbiAgcmV0dXJuIG1hcFN0b3JlLmdldChrZXkpO1xufTtcbmhhcmRlbihwcm92aWRlTGF6eSk7XG52YXIgbWFrZUF0b21pY1Byb3ZpZGVyID0gKHN0b3JlKSA9PiB7XG4gIGNvbnN0IHBlbmRpbmcgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBjb25zdCBwcm92aWRlQXN5bmMgPSAoa2V5LCBtYWtlVmFsdWUsIGZpbmlzaFZhbHVlKSA9PiB7XG4gICAgaWYgKHN0b3JlLmhhcyhrZXkpKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHN0b3JlLmdldChrZXkpKTtcbiAgICB9XG4gICAgaWYgKCFwZW5kaW5nLmhhcyhrZXkpKSB7XG4gICAgICBjb25zdCB2YWxQMiA9IG1ha2VWYWx1ZShrZXkpLnRoZW4oKHYzKSA9PiB7XG4gICAgICAgIHN0b3JlLmluaXQoa2V5LCB2Myk7XG4gICAgICAgIHJldHVybiB2MztcbiAgICAgIH0pLnRoZW4oKHYzKSA9PiB7XG4gICAgICAgIGlmIChmaW5pc2hWYWx1ZSkge1xuICAgICAgICAgIHJldHVybiBmaW5pc2hWYWx1ZShrZXksIHYzKS50aGVuKCgpID0+IHYzKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdjM7XG4gICAgICB9KS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgcGVuZGluZy5kZWxldGUoa2V5KTtcbiAgICAgIH0pO1xuICAgICAgcGVuZGluZy5zZXQoa2V5LCB2YWxQMik7XG4gICAgfVxuICAgIGNvbnN0IHZhbFAgPSBwZW5kaW5nLmdldChrZXkpO1xuICAgIGFzc2VydCh2YWxQKTtcbiAgICByZXR1cm4gdmFsUDtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IHByb3ZpZGVBc3luYyB9KTtcbn07XG5oYXJkZW4obWFrZUF0b21pY1Byb3ZpZGVyKTtcbnZhciBhcHBlbmRUb1N0b3JlZEFycmF5ID0gKG1hcFN0b3JlLCBrZXksIGl0ZW0pID0+IHtcbiAgaWYgKG1hcFN0b3JlLmhhcyhrZXkpKSB7XG4gICAgY29uc3QgZXh0YW50ID0gbWFwU3RvcmUuZ2V0KGtleSk7XG4gICAgbWFwU3RvcmUuc2V0KGtleSwgaGFyZGVuKFsuLi5leHRhbnQsIGl0ZW1dKSk7XG4gIH0gZWxzZSB7XG4gICAgbWFwU3RvcmUuaW5pdChrZXksIGhhcmRlbihbaXRlbV0pKTtcbiAgfVxufTtcbmhhcmRlbihhcHBlbmRUb1N0b3JlZEFycmF5KTtcblxuLy9cbnZhciBtYWtlU2V0U3RvcmVNZXRob2RzID0gKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCB7IGFzc2VydFVwZGF0ZU9uQWRkLCBhc3NlcnRVcGRhdGVPbkRlbGV0ZSwgaXRlcmFibGVLZXlzIH0gPSBtYWtlQ3VycmVudEtleXNLaXQoXG4gICAgKCkgPT4ganNzZXQua2V5cygpLFxuICAgIChrKSA9PiBqc3NldC5oYXMoayksXG4gICAgY29tcGFyZVJhbmssXG4gICAgYXNzZXJ0S2V5T2tUb0FkZCxcbiAgICBhc3NlcnRLZXlPa1RvRGVsZXRlLFxuICAgIGtleU5hbWVcbiAgKTtcbiAgY29uc3Qga2V5czQgPSAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwID8gaXRlcmFibGVLZXlzIDogZmlsdGVySXRlcmFibGUoaXRlcmFibGVLZXlzLCAoaykgPT4gbWF0Y2hlcyhrLCBrZXlQYXR0KSk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIC4uLm1ha2VXZWFrU2V0U3RvcmVNZXRob2RzKFxuICAgICAganNzZXQsXG4gICAgICBhc3NlcnRVcGRhdGVPbkFkZCxcbiAgICAgIGFzc2VydFVwZGF0ZU9uRGVsZXRlLFxuICAgICAga2V5TmFtZVxuICAgICksXG4gICAga2V5czoga2V5czQsXG4gICAgdmFsdWVzOiBrZXlzNCxcbiAgICBzbmFwc2hvdDogKGtleVBhdHQgPSB2b2lkIDApID0+IG1ha2VDb3B5U2V0KGtleXM0KGtleVBhdHQpKSxcbiAgICBnZXRTaXplOiAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ga2V5UGF0dCA9PT0gdm9pZCAwID8ganNzZXQuc2l6ZSA6IFsuLi5rZXlzNChrZXlQYXR0KV0ubGVuZ3RoLFxuICAgIGNsZWFyOiAoa2V5UGF0dCA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgICBqc3NldC5jbGVhcigpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5czQoa2V5UGF0dCkpIHtcbiAgICAgICAganNzZXQuZGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG52YXIgbWFrZVNjYWxhclNldFN0b3JlID0gKHRhZyA9IFwia2V5XCIsIHsga2V5U2hhcGUgPSB2b2lkIDAgfSA9IHt9KSA9PiB7XG4gIGNvbnN0IGpzc2V0ID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGtleVNoYXBlKTtcbiAgfVxuICBjb25zdCBhc3NlcnRLZXlPa1RvQWRkID0gKGtleSkgPT4ge1xuICAgIGhhcmRlbihrZXkpO1xuICAgIGFzc2VydFNjYWxhcktleShrZXkpO1xuICAgIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgICBtdXN0TWF0Y2goa2V5LCBrZXlTaGFwZSwgXCJzZXRTdG9yZSBrZXlcIik7XG4gICAgfVxuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgU2V0U3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlU2V0U3RvcmVNZXRob2RzKGpzc2V0LCBhc3NlcnRLZXlPa1RvQWRkLCB2b2lkIDAsIHRhZylcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJTZXRTdG9yZSk7XG5cbi8vXG52YXIgbWFrZVdlYWtNYXBTdG9yZU1ldGhvZHMgPSAoanNtYXAsIGFzc2VydEtWT2tUb0FkZCwgYXNzZXJ0S1ZPa1RvU2V0LCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCBrZXlOYW1lID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCBhc3NlcnRLZXlEb2VzTm90RXhpc3QgPSAoa2V5KSA9PiAhanNtYXAuaGFzKGtleSkgfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGtleU5hbWUpfSBhbHJlYWR5IHJlZ2lzdGVyZWQ6ICR7a2V5fWA7XG4gIGNvbnN0IGFzc2VydEtleUV4aXN0cyA9IChrZXkpID0+IGpzbWFwLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShrZXlOYW1lKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiBqc21hcC5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAgICAgICAgICAgICovXG4gICAgICAgIGpzbWFwLmdldChrZXkpXG4gICAgICApO1xuICAgIH0sXG4gICAgaW5pdDogKGtleSwgdmFsdWUpID0+IHtcbiAgICAgIGFzc2VydEtleURvZXNOb3RFeGlzdChrZXkpO1xuICAgICAgYXNzZXJ0S1ZPa1RvQWRkKGtleSwgdmFsdWUpO1xuICAgICAganNtYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgIH0sXG4gICAgc2V0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBhc3NlcnRLVk9rVG9TZXQoa2V5LCB2YWx1ZSk7XG4gICAgICBqc21hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgaWYgKGFzc2VydEtleU9rVG9EZWxldGUgIT09IHZvaWQgMCkge1xuICAgICAgICBhc3NlcnRLZXlPa1RvRGVsZXRlKGtleSk7XG4gICAgICB9XG4gICAgICBqc21hcC5kZWxldGUoa2V5KTtcbiAgICB9LFxuICAgIGFkZEFsbDogKGVudHJpZXMxMCkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiBlbnRyaWVzMTBbU3ltYm9sLml0ZXJhdG9yXSAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGlmIChPYmplY3QuaXNGcm96ZW4oZW50cmllczEwKSAmJiBpc0NvcHlNYXAoZW50cmllczEwKSkge1xuICAgICAgICAgIGVudHJpZXMxMCA9IGdldENvcHlNYXBFbnRyaWVzKGVudHJpZXMxMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3dSZWRhY3RlZGBwcm92aWRlZCBkYXRhIHNvdXJjZSBpcyBub3QgaXRlcmFibGU6ICR7ZW50cmllczEwfWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvciAoXG4gICAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSBvZlxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGVudHJpZXMxMFxuICAgICAgKSB7XG4gICAgICAgIGFzc2VydEtWT2tUb0FkZChrZXksIHZhbHVlKTtcbiAgICAgICAganNtYXAuc2V0KGtleSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xudmFyIG1ha2VTY2FsYXJXZWFrTWFwU3RvcmUgPSAodGFnID0gXCJrZXlcIiwgeyBsb25nTGl2ZWQgPSB0cnVlLCBrZXlTaGFwZSA9IHZvaWQgMCwgdmFsdWVTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNtYXAgPSBuZXcgKGxvbmdMaXZlZCA/IFdlYWtNYXAgOiBNYXApKCk7XG4gIGlmIChrZXlTaGFwZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UGF0dGVybihrZXlTaGFwZSk7XG4gIH1cbiAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4odmFsdWVTaGFwZSk7XG4gIH1cbiAgY29uc3QgYXNzZXJ0S1ZPa1RvU2V0ID0gKF9rZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKHZhbHVlKTtcbiAgICBhc3NlcnRQYXNzYWJsZSh2YWx1ZSk7XG4gICAgaWYgKHZhbHVlU2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKHZhbHVlLCB2YWx1ZVNoYXBlLCBcIndlYWtNYXBTdG9yZSB2YWx1ZVwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydEtWT2tUb0FkZCA9IChrZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgcGFzc1N0eWxlT2Yoa2V5KSA9PT0gXCJyZW1vdGFibGVcIiB8fCB0aHJvd1JlZGFjdGVkYE9ubHkgcmVtb3RhYmxlcyBjYW4gYmUga2V5cyBvZiBzY2FsYXIgV2Vha01hcFN0b3JlczogJHtrZXl9YDtcbiAgICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgICAgbXVzdE1hdGNoKGtleSwga2V5U2hhcGUsIFwid2Vha01hcFN0b3JlIGtleVwiKTtcbiAgICB9XG4gICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgV2Vha01hcFN0b3JlIG9mICR7cXVvdGUodGFnKX1gLCB7XG4gICAgLi4ubWFrZVdlYWtNYXBTdG9yZU1ldGhvZHMoXG4gICAgICBqc21hcCxcbiAgICAgIGFzc2VydEtWT2tUb0FkZCxcbiAgICAgIGFzc2VydEtWT2tUb1NldCxcbiAgICAgIHZvaWQgMCxcbiAgICAgIHRhZ1xuICAgIClcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTY2FsYXJXZWFrTWFwU3RvcmUpO1xuXG4vL1xudmFyIG1ha2VNYXBTdG9yZU1ldGhvZHMgPSAoanNtYXAsIGFzc2VydEtWT2tUb0FkZCwgYXNzZXJ0S1ZPa1RvU2V0LCBhc3NlcnRLZXlPa1RvRGVsZXRlID0gdm9pZCAwLCB0YWcgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IHsgYXNzZXJ0VXBkYXRlT25BZGQsIGFzc2VydFVwZGF0ZU9uRGVsZXRlLCBpdGVyYWJsZUtleXMgfSA9IG1ha2VDdXJyZW50S2V5c0tpdChcbiAgICAoKSA9PiBqc21hcC5rZXlzKCksXG4gICAgKGspID0+IGpzbWFwLmhhcyhrKSxcbiAgICBjb21wYXJlUmFuayxcbiAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgYXNzZXJ0S2V5T2tUb0RlbGV0ZSxcbiAgICB0YWdcbiAgKTtcbiAgY29uc3Qga2V5czQgPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiB7XG4gICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCAmJiB2YWx1ZVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGl0ZXJhYmxlS2V5cztcbiAgICB9XG4gICAgY29uc3QgZmlsdGVyID0gKGspID0+IHtcbiAgICAgIGlmIChrZXlQYXR0ICE9PSB2b2lkIDAgJiYgIW1hdGNoZXMoaywga2V5UGF0dCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKHZhbHVlUGF0dCAhPT0gdm9pZCAwICYmICFtYXRjaGVzKGpzbWFwLmdldChrKSwgdmFsdWVQYXR0KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIHJldHVybiBmaWx0ZXJJdGVyYWJsZShpdGVyYWJsZUtleXMsIGZpbHRlcik7XG4gIH07XG4gIGNvbnN0IHZhbHVlczYgPSAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBtYXBJdGVyYWJsZShrZXlzNChrZXlQYXR0LCB2YWx1ZVBhdHQpLCAoaykgPT4gKFxuICAgIC8qICAgICAgICAgICAgKi9cbiAgICBqc21hcC5nZXQoaylcbiAgKSk7XG4gIGNvbnN0IGVudHJpZXMxMCA9IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IG1hcEl0ZXJhYmxlKGtleXM0KGtleVBhdHQsIHZhbHVlUGF0dCksIChrKSA9PiBbXG4gICAgayxcbiAgICAvKiAgICAgICAgICAgICovXG4gICAganNtYXAuZ2V0KGspXG4gIF0pO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICAuLi5tYWtlV2Vha01hcFN0b3JlTWV0aG9kcyhcbiAgICAgIGpzbWFwLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGFzc2VydFVwZGF0ZU9uQWRkLFxuICAgICAgYXNzZXJ0S1ZPa1RvU2V0LFxuICAgICAgYXNzZXJ0VXBkYXRlT25EZWxldGUsXG4gICAgICB0YWdcbiAgICApLFxuICAgIGtleXM6IGtleXM0LFxuICAgIHZhbHVlczogdmFsdWVzNixcbiAgICBlbnRyaWVzOiBlbnRyaWVzMTAsXG4gICAgc25hcHNob3Q6IChrZXlQYXR0ID0gdm9pZCAwLCB2YWx1ZVBhdHQgPSB2b2lkIDApID0+IG1ha2VDb3B5TWFwKGVudHJpZXMxMChrZXlQYXR0LCB2YWx1ZVBhdHQpKSxcbiAgICBnZXRTaXplOiAoa2V5UGF0dCA9IHZvaWQgMCwgdmFsdWVQYXR0ID0gdm9pZCAwKSA9PiBrZXlQYXR0ID09PSB2b2lkIDAgJiYgdmFsdWVQYXR0ID09PSB2b2lkIDAgPyBqc21hcC5zaXplIDogWy4uLmtleXM0KGtleVBhdHQsIHZhbHVlUGF0dCldLmxlbmd0aCxcbiAgICBjbGVhcjogKGtleVBhdHQgPSB2b2lkIDAsIHZhbHVlUGF0dCA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKGtleVBhdHQgPT09IHZvaWQgMCAmJiB2YWx1ZVBhdHQgPT09IHZvaWQgMCkge1xuICAgICAgICBqc21hcC5jbGVhcigpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5czQoa2V5UGF0dCwgdmFsdWVQYXR0KSkge1xuICAgICAgICBqc21hcC5kZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufTtcbnZhciBtYWtlU2NhbGFyTWFwU3RvcmUgPSAodGFnID0gXCJrZXlcIiwgeyBrZXlTaGFwZSA9IHZvaWQgMCwgdmFsdWVTaGFwZSA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QganNtYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICBpZiAoa2V5U2hhcGUgIT09IHZvaWQgMCkge1xuICAgIGFzc2VydFBhdHRlcm4oa2V5U2hhcGUpO1xuICB9XG4gIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKHZhbHVlU2hhcGUpO1xuICB9XG4gIGNvbnN0IGFzc2VydEtWT2tUb1NldCA9IChfa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGhhcmRlbih2YWx1ZSk7XG4gICAgYXNzZXJ0UGFzc2FibGUodmFsdWUpO1xuICAgIGlmICh2YWx1ZVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaCh2YWx1ZSwgdmFsdWVTaGFwZSwgXCJtYXBTdG9yZSB2YWx1ZVwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydEtWT2tUb0FkZCA9IChrZXksIHZhbHVlKSA9PiB7XG4gICAgaGFyZGVuKGtleSk7XG4gICAgYXNzZXJ0U2NhbGFyS2V5KGtleSk7XG4gICAgaWYgKGtleVNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaChrZXksIGtleVNoYXBlLCBcIm1hcFN0b3JlIGtleVwiKTtcbiAgICB9XG4gICAgYXNzZXJ0S1ZPa1RvU2V0KGtleSwgdmFsdWUpO1xuICB9O1xuICByZXR1cm4gRmFyKGBzY2FsYXIgTWFwU3RvcmUgb2YgJHtxdW90ZSh0YWcpfWAsIHtcbiAgICAuLi5tYWtlTWFwU3RvcmVNZXRob2RzKFxuICAgICAganNtYXAsXG4gICAgICBhc3NlcnRLVk9rVG9BZGQsXG4gICAgICBhc3NlcnRLVk9rVG9TZXQsXG4gICAgICB2b2lkIDAsXG4gICAgICB0YWdcbiAgICApXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlU2NhbGFyTWFwU3RvcmUpO1xuXG4vL1xudmFyIEdFVF9JTlRFUkZBQ0VfR1VBUkQgPSBcIl9fZ2V0SW50ZXJmYWNlR3VhcmRfX1wiO1xuXG4vL1xudmFyIHsgYXBwbHk6IGFwcGx5NCwgb3duS2V5czogb3duS2V5czE4IH0gPSBSZWZsZWN0O1xudmFyIHsgZGVmaW5lUHJvcGVydGllczogZGVmaW5lUHJvcGVydGllczMsIGZyb21FbnRyaWVzOiBmcm9tRW50cmllczggfSA9IE9iamVjdDtcbnZhciBSYXdNZXRob2RHdWFyZCA9IE0uY2FsbCgpLnJlc3QoTS5yYXcoKSkucmV0dXJucyhNLnJhdygpKTtcbnZhciBSRURBQ1RFRF9SQVdfQVJHID0gXCI8cmVkYWN0ZWQgcmF3IGFyZz5cIjtcbnZhciBQYXNzYWJsZU1ldGhvZEd1YXJkID0gTS5jYWxsKCkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpO1xudmFyIGRlZmVuZFN5bmNBcmdzID0gKHN5bmNBcmdzLCBtYXRjaENvbmZpZywgbGFiZWwgPSB2b2lkIDApID0+IHtcbiAgY29uc3Qge1xuICAgIGRlY2xhcmVkTGVuLFxuICAgIGhhc1Jlc3RBcmdHdWFyZCxcbiAgICByZXN0QXJnR3VhcmRJc1JhdyxcbiAgICBwYXJhbXNQYXR0ZXJuLFxuICAgIHJlZGFjdGVkSW5kaWNlc1xuICB9ID0gbWF0Y2hDb25maWc7XG4gIGxldCBtYXRjaGFibGVBcmdzID0gc3luY0FyZ3M7XG4gIGlmIChyZXN0QXJnR3VhcmRJc1JhdyAmJiBzeW5jQXJncy5sZW5ndGggPiBkZWNsYXJlZExlbikge1xuICAgIGNvbnN0IHJlc3RMZW4gPSBzeW5jQXJncy5sZW5ndGggLSBkZWNsYXJlZExlbjtcbiAgICBjb25zdCByZWRhY3RlZFJlc3QgPSBBcnJheShyZXN0TGVuKS5maWxsKFJFREFDVEVEX1JBV19BUkcpO1xuICAgIG1hdGNoYWJsZUFyZ3MgPSBbLi4uc3luY0FyZ3Muc2xpY2UoMCwgZGVjbGFyZWRMZW4pLCAuLi5yZWRhY3RlZFJlc3RdO1xuICB9IGVsc2UgaWYgKHJlZGFjdGVkSW5kaWNlcy5sZW5ndGggPiAwICYmIHJlZGFjdGVkSW5kaWNlc1swXSA8IHN5bmNBcmdzLmxlbmd0aCkge1xuICAgIG1hdGNoYWJsZUFyZ3MgPSBbLi4uc3luY0FyZ3NdO1xuICB9XG4gIGZvciAoY29uc3QgaTIgb2YgcmVkYWN0ZWRJbmRpY2VzKSB7XG4gICAgaWYgKGkyID49IG1hdGNoYWJsZUFyZ3MubGVuZ3RoKSB7XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgbWF0Y2hhYmxlQXJnc1tpMl0gPSBSRURBQ1RFRF9SQVdfQVJHO1xuICB9XG4gIG11c3RNYXRjaChoYXJkZW4obWF0Y2hhYmxlQXJncyksIHBhcmFtc1BhdHRlcm4sIGxhYmVsKTtcbiAgaWYgKGhhc1Jlc3RBcmdHdWFyZCkge1xuICAgIHJldHVybiBzeW5jQXJncztcbiAgfVxuICBzeW5jQXJncy5sZW5ndGggPD0gZGVjbGFyZWRMZW4gfHwgdGhyb3dSZWRhY3RlZGAke3F1b3RlKGxhYmVsKX0gYWNjZXB0cyBhdCBtb3N0ICR7cXVvdGUoZGVjbGFyZWRMZW4pfSBhcmd1bWVudHMsIG5vdCAke3F1b3RlKFxuICAgIHN5bmNBcmdzLmxlbmd0aFxuICApfTogJHtzeW5jQXJnc31gO1xuICByZXR1cm4gc3luY0FyZ3M7XG59O1xudmFyIGJ1aWxkTWF0Y2hDb25maWcgPSAobWV0aG9kR3VhcmRQYXlsb2FkKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBhcmdHdWFyZHMsXG4gICAgb3B0aW9uYWxBcmdHdWFyZHMgPSBbXSxcbiAgICByZXN0QXJnR3VhcmRcbiAgfSA9IG1ldGhvZEd1YXJkUGF5bG9hZDtcbiAgY29uc3QgbWF0Y2hhYmxlQXJnR3VhcmRzID0gWy4uLmFyZ0d1YXJkcywgLi4ub3B0aW9uYWxBcmdHdWFyZHNdO1xuICBjb25zdCByZWRhY3RlZEluZGljZXMgPSBbXTtcbiAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IG1hdGNoYWJsZUFyZ0d1YXJkcy5sZW5ndGg7IGkyICs9IDEpIHtcbiAgICBpZiAoaXNSYXdHdWFyZChtYXRjaGFibGVBcmdHdWFyZHNbaTJdKSkge1xuICAgICAgbWF0Y2hhYmxlQXJnR3VhcmRzW2kyXSA9IFJFREFDVEVEX1JBV19BUkc7XG4gICAgICByZWRhY3RlZEluZGljZXMucHVzaChpMik7XG4gICAgfVxuICB9XG4gIGxldCBtYXRjaGFibGVSZXN0QXJnR3VhcmQgPSByZXN0QXJnR3VhcmQ7XG4gIGlmIChpc1Jhd0d1YXJkKG1hdGNoYWJsZVJlc3RBcmdHdWFyZCkpIHtcbiAgICBtYXRjaGFibGVSZXN0QXJnR3VhcmQgPSBNLmFycmF5T2YoUkVEQUNURURfUkFXX0FSRyk7XG4gIH1cbiAgY29uc3QgbWF0Y2hhYmxlTWV0aG9kR3VhcmRQYXlsb2FkID0gaGFyZGVuKHtcbiAgICAuLi5tZXRob2RHdWFyZFBheWxvYWQsXG4gICAgYXJnR3VhcmRzOiBtYXRjaGFibGVBcmdHdWFyZHMuc2xpY2UoMCwgYXJnR3VhcmRzLmxlbmd0aCksXG4gICAgb3B0aW9uYWxBcmdHdWFyZHM6IG1hdGNoYWJsZUFyZ0d1YXJkcy5zbGljZShhcmdHdWFyZHMubGVuZ3RoKSxcbiAgICByZXN0QXJnR3VhcmQ6IG1hdGNoYWJsZVJlc3RBcmdHdWFyZFxuICB9KTtcbiAgY29uc3QgcGFyYW1zUGF0dGVybiA9IE0uc3BsaXRBcnJheShcbiAgICBtYXRjaGFibGVNZXRob2RHdWFyZFBheWxvYWQuYXJnR3VhcmRzLFxuICAgIG1hdGNoYWJsZU1ldGhvZEd1YXJkUGF5bG9hZC5vcHRpb25hbEFyZ0d1YXJkcyxcbiAgICBtYXRjaGFibGVNZXRob2RHdWFyZFBheWxvYWQucmVzdEFyZ0d1YXJkXG4gICk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGRlY2xhcmVkTGVuOiBtYXRjaGFibGVBcmdHdWFyZHMubGVuZ3RoLFxuICAgIGhhc1Jlc3RBcmdHdWFyZDogcmVzdEFyZ0d1YXJkICE9PSB2b2lkIDAsXG4gICAgcmVzdEFyZ0d1YXJkSXNSYXc6IHJlc3RBcmdHdWFyZCAhPT0gbWF0Y2hhYmxlUmVzdEFyZ0d1YXJkLFxuICAgIHBhcmFtc1BhdHRlcm4sXG4gICAgcmVkYWN0ZWRJbmRpY2VzLFxuICAgIG1hdGNoYWJsZU1ldGhvZEd1YXJkUGF5bG9hZFxuICB9KTtcbn07XG52YXIgZGVmZW5kU3luY01ldGhvZCA9IChnZXRDb250ZXh0LCBiZWhhdmlvck1ldGhvZCwgbWV0aG9kR3VhcmRQYXlsb2FkLCBsYWJlbCkgPT4ge1xuICBjb25zdCB7IHJldHVybkd1YXJkIH0gPSBtZXRob2RHdWFyZFBheWxvYWQ7XG4gIGNvbnN0IGlzUmF3UmV0dXJuID0gaXNSYXdHdWFyZChyZXR1cm5HdWFyZCk7XG4gIGNvbnN0IG1hdGNoQ29uZmlnID0gYnVpbGRNYXRjaENvbmZpZyhtZXRob2RHdWFyZFBheWxvYWQpO1xuICBjb25zdCB7IHN5bmNNZXRob2QgfSA9IHtcbiAgICAvL1xuICAgIHN5bmNNZXRob2QoLi4uc3luY0FyZ3MpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBnZXRDb250ZXh0KHRoaXMpO1xuICAgICAgICBjb25zdCByZWFsQXJncyA9IGRlZmVuZFN5bmNBcmdzKHN5bmNBcmdzLCBtYXRjaENvbmZpZywgbGFiZWwpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhcHBseTQoYmVoYXZpb3JNZXRob2QsIGNvbnRleHQsIHJlYWxBcmdzKTtcbiAgICAgICAgaWYgKCFpc1Jhd1JldHVybikge1xuICAgICAgICAgIG11c3RNYXRjaChoYXJkZW4ocmVzdWx0KSwgcmV0dXJuR3VhcmQsIGAke2xhYmVsfTogcmVzdWx0YCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0gY2F0Y2ggKHRocm93blRoaW5nKSB7XG4gICAgICAgIHRocm93IHRvVGhyb3dhYmxlKHRocm93blRoaW5nKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG4gIHJldHVybiBzeW5jTWV0aG9kO1xufTtcbnZhciBkZXN5bmMgPSAobWV0aG9kR3VhcmRQYXlsb2FkKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBhcmdHdWFyZHMsXG4gICAgb3B0aW9uYWxBcmdHdWFyZHMgPSBbXSxcbiAgICByZXN0QXJnR3VhcmRcbiAgfSA9IG1ldGhvZEd1YXJkUGF5bG9hZDtcbiAgIWlzQXdhaXRBcmdHdWFyZChyZXN0QXJnR3VhcmQpIHx8IHRocm93UmVkYWN0ZWRgUmVzdCBhcmdzIG1heSBub3QgYmUgYXdhaXRlZDogJHtyZXN0QXJnR3VhcmR9YDtcbiAgY29uc3QgcmF3QXJnR3VhcmRzID0gWy4uLmFyZ0d1YXJkcywgLi4ub3B0aW9uYWxBcmdHdWFyZHNdO1xuICBjb25zdCBhd2FpdEluZGV4ZXMgPSBbXTtcbiAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IHJhd0FyZ0d1YXJkcy5sZW5ndGg7IGkyICs9IDEpIHtcbiAgICBjb25zdCBhcmdHdWFyZCA9IHJhd0FyZ0d1YXJkc1tpMl07XG4gICAgaWYgKGlzQXdhaXRBcmdHdWFyZChhcmdHdWFyZCkpIHtcbiAgICAgIHJhd0FyZ0d1YXJkc1tpMl0gPSBnZXRBd2FpdEFyZ0d1YXJkUGF5bG9hZChhcmdHdWFyZCkuYXJnR3VhcmQ7XG4gICAgICBhd2FpdEluZGV4ZXMucHVzaChpMik7XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgYXdhaXRJbmRleGVzLFxuICAgIHJhd01ldGhvZEd1YXJkUGF5bG9hZDoge1xuICAgICAgLi4ubWV0aG9kR3VhcmRQYXlsb2FkLFxuICAgICAgYXJnR3VhcmRzOiByYXdBcmdHdWFyZHMuc2xpY2UoMCwgYXJnR3VhcmRzLmxlbmd0aCksXG4gICAgICBvcHRpb25hbEFyZ0d1YXJkczogcmF3QXJnR3VhcmRzLnNsaWNlKGFyZ0d1YXJkcy5sZW5ndGgpXG4gICAgfVxuICB9O1xufTtcbnZhciBkZWZlbmRBc3luY01ldGhvZCA9IChnZXRDb250ZXh0LCBiZWhhdmlvck1ldGhvZCwgbWV0aG9kR3VhcmRQYXlsb2FkLCBsYWJlbCkgPT4ge1xuICBjb25zdCB7IHJldHVybkd1YXJkIH0gPSBtZXRob2RHdWFyZFBheWxvYWQ7XG4gIGNvbnN0IGlzUmF3UmV0dXJuID0gaXNSYXdHdWFyZChyZXR1cm5HdWFyZCk7XG4gIGNvbnN0IHsgYXdhaXRJbmRleGVzLCByYXdNZXRob2RHdWFyZFBheWxvYWQgfSA9IGRlc3luYyhtZXRob2RHdWFyZFBheWxvYWQpO1xuICBjb25zdCBtYXRjaENvbmZpZyA9IGJ1aWxkTWF0Y2hDb25maWcocmF3TWV0aG9kR3VhcmRQYXlsb2FkKTtcbiAgY29uc3QgeyBhc3luY01ldGhvZCB9ID0ge1xuICAgIC8vXG4gICAgYXN5bmNNZXRob2QoLi4uYXJncykge1xuICAgICAgY29uc3QgYXdhaXRMaXN0ID0gW107XG4gICAgICBmb3IgKGNvbnN0IGkyIG9mIGF3YWl0SW5kZXhlcykge1xuICAgICAgICBpZiAoaTIgPj0gYXJncy5sZW5ndGgpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBhd2FpdExpc3QucHVzaChhcmdzW2kyXSk7XG4gICAgICB9XG4gICAgICBjb25zdCBwMyA9IFByb21pc2UuYWxsKGF3YWl0TGlzdCk7XG4gICAgICBjb25zdCBzeW5jQXJncyA9IFsuLi5hcmdzXTtcbiAgICAgIGNvbnN0IHJlc3VsdFAgPSBFLndoZW4oXG4gICAgICAgIHAzLFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgKGF3YWl0ZWRBcmdzKSA9PiB7XG4gICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBhd2FpdGVkQXJncy5sZW5ndGg7IGogKz0gMSkge1xuICAgICAgICAgICAgc3luY0FyZ3NbYXdhaXRJbmRleGVzW2pdXSA9IGF3YWl0ZWRBcmdzW2pdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBjb250ZXh0ID0gZ2V0Q29udGV4dCh0aGlzKTtcbiAgICAgICAgICBjb25zdCByZWFsQXJncyA9IGRlZmVuZFN5bmNBcmdzKHN5bmNBcmdzLCBtYXRjaENvbmZpZywgbGFiZWwpO1xuICAgICAgICAgIHJldHVybiBhcHBseTQoYmVoYXZpb3JNZXRob2QsIGNvbnRleHQsIHJlYWxBcmdzKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICAgIHJldHVybiBFLndoZW4ocmVzdWx0UCwgKGZ1bGZpbGxtZW50KSA9PiB7XG4gICAgICAgIGlmICghaXNSYXdSZXR1cm4pIHtcbiAgICAgICAgICBtdXN0TWF0Y2goaGFyZGVuKGZ1bGZpbGxtZW50KSwgcmV0dXJuR3VhcmQsIGAke2xhYmVsfTogcmVzdWx0YCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZ1bGZpbGxtZW50O1xuICAgICAgfSkuY2F0Y2goXG4gICAgICAgIChyZWFzb24pID0+IChcbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vXG4gICAgICAgICAgUHJvbWlzZS5yZWplY3QodG9UaHJvd2FibGUocmVhc29uKSlcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBhc3luY01ldGhvZDtcbn07XG52YXIgZGVmZW5kTWV0aG9kID0gKGdldENvbnRleHQsIGJlaGF2aW9yTWV0aG9kLCBtZXRob2RHdWFyZCwgbGFiZWwpID0+IHtcbiAgY29uc3QgbWV0aG9kR3VhcmRQYXlsb2FkID0gZ2V0TWV0aG9kR3VhcmRQYXlsb2FkKG1ldGhvZEd1YXJkKTtcbiAgY29uc3QgeyBjYWxsS2luZCB9ID0gbWV0aG9kR3VhcmRQYXlsb2FkO1xuICBpZiAoY2FsbEtpbmQgPT09IFwic3luY1wiKSB7XG4gICAgcmV0dXJuIGRlZmVuZFN5bmNNZXRob2QoXG4gICAgICBnZXRDb250ZXh0LFxuICAgICAgYmVoYXZpb3JNZXRob2QsXG4gICAgICBtZXRob2RHdWFyZFBheWxvYWQsXG4gICAgICBsYWJlbFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgYXNzZXJ0KGNhbGxLaW5kID09PSBcImFzeW5jXCIpO1xuICAgIHJldHVybiBkZWZlbmRBc3luY01ldGhvZChcbiAgICAgIGdldENvbnRleHQsXG4gICAgICBiZWhhdmlvck1ldGhvZCxcbiAgICAgIG1ldGhvZEd1YXJkUGF5bG9hZCxcbiAgICAgIGxhYmVsXG4gICAgKTtcbiAgfVxufTtcbnZhciBiaW5kTWV0aG9kID0gKG1ldGhvZFRhZywgY29udGV4dFByb3ZpZGVyLCBiZWhhdmlvck1ldGhvZCwgbWV0aG9kR3VhcmQpID0+IHtcbiAgYXNzZXJ0LnR5cGVvZihiZWhhdmlvck1ldGhvZCwgXCJmdW5jdGlvblwiKTtcbiAgY29uc3QgZ2V0Q29udGV4dCA9IChyZXByZXNlbnRhdGl2ZSkgPT4ge1xuICAgIHJlcHJlc2VudGF0aXZlIHx8IC8vXG4gICAgdGhyb3dSZWRhY3RlZGBNZXRob2QgJHttZXRob2RUYWd9IGNhbGxlZCB3aXRob3V0ICd0aGlzJyBvYmplY3RgO1xuICAgIGNvbnN0IGNvbnRleHQgPSBjb250ZXh0UHJvdmlkZXIocmVwcmVzZW50YXRpdmUpO1xuICAgIGlmIChjb250ZXh0ID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgJHtxdW90ZShcbiAgICAgICAgbWV0aG9kVGFnXG4gICAgICApfSBtYXkgb25seSBiZSBhcHBsaWVkIHRvIGEgdmFsaWQgaW5zdGFuY2U6ICR7cmVwcmVzZW50YXRpdmV9YDtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnRleHQ7XG4gIH07XG4gIGNvbnN0IG1ldGhvZCA9IGRlZmVuZE1ldGhvZChcbiAgICBnZXRDb250ZXh0LFxuICAgIGJlaGF2aW9yTWV0aG9kLFxuICAgIG1ldGhvZEd1YXJkLFxuICAgIG1ldGhvZFRhZ1xuICApO1xuICBkZWZpbmVQcm9wZXJ0aWVzMyhtZXRob2QsIHtcbiAgICBuYW1lOiB7IHZhbHVlOiBtZXRob2RUYWcgfSxcbiAgICBsZW5ndGg6IHsgdmFsdWU6IGJlaGF2aW9yTWV0aG9kLmxlbmd0aCB9XG4gIH0pO1xuICByZXR1cm4gbWV0aG9kO1xufTtcbnZhciBkZWZlbmRQcm90b3R5cGUgPSAodGFnLCBjb250ZXh0UHJvdmlkZXIsIGJlaGF2aW9yTWV0aG9kcywgdGhpc2Z1bE1ldGhvZHMgPSBmYWxzZSwgaW50ZXJmYWNlR3VhcmQgPSB2b2lkIDApID0+IHtcbiAgY29uc3QgcHJvdG90eXBlID0ge307XG4gIGNvbnN0IG1ldGhvZE5hbWVzID0gZ2V0TWV0aG9kTmFtZXMoYmVoYXZpb3JNZXRob2RzKS5maWx0ZXIoXG4gICAgLy9cbiAgICAvL1xuICAgIChrZXkpID0+IHtcbiAgICAgIGlmIChrZXkgIT09IFwiY29uc3RydWN0b3JcIikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbnN0cnVjdG9yID0gYmVoYXZpb3JNZXRob2RzLmNvbnN0cnVjdG9yO1xuICAgICAgcmV0dXJuICEoY29uc3RydWN0b3IucHJvdG90eXBlICYmIGNvbnN0cnVjdG9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9PT0gY29uc3RydWN0b3IpO1xuICAgIH1cbiAgKTtcbiAgbGV0IG1ldGhvZEd1YXJkcztcbiAgbGV0IGRlZmF1bHRHdWFyZHM7XG4gIGlmIChpbnRlcmZhY2VHdWFyZCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGludGVyZmFjZU5hbWUsXG4gICAgICBtZXRob2RHdWFyZHM6IG1nLFxuICAgICAgc3ltYm9sTWV0aG9kR3VhcmRzLFxuICAgICAgc2xvcHB5LFxuICAgICAgZGVmYXVsdEd1YXJkczogZGcgPSBzbG9wcHkgPyBcInBhc3NhYmxlXCIgOiBkZWZhdWx0R3VhcmRzXG4gICAgfSA9IGdldEludGVyZmFjZUd1YXJkUGF5bG9hZChpbnRlcmZhY2VHdWFyZCk7XG4gICAgbWV0aG9kR3VhcmRzID0gaGFyZGVuKHtcbiAgICAgIC4uLm1nLFxuICAgICAgLi4uKHN5bWJvbE1ldGhvZEd1YXJkcyYmIGZyb21FbnRyaWVzOChnZXRDb3B5TWFwRW50cmllcyhzeW1ib2xNZXRob2RHdWFyZHMpKSlcbiAgICB9KTtcbiAgICBkZWZhdWx0R3VhcmRzID0gZGc7XG4gICAge1xuICAgICAgY29uc3QgbWV0aG9kR3VhcmROYW1lcyA9IG93bktleXMxOChtZXRob2RHdWFyZHMpO1xuICAgICAgY29uc3QgdW5pbXBsZW1lbnRlZCA9IGxpc3REaWZmZXJlbmNlKG1ldGhvZEd1YXJkTmFtZXMsIG1ldGhvZE5hbWVzKTtcbiAgICAgIHVuaW1wbGVtZW50ZWQubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgbWV0aG9kcyAke3F1b3RlKHVuaW1wbGVtZW50ZWQpfSBub3QgaW1wbGVtZW50ZWQgYnkgJHtxdW90ZSh0YWcpfWA7XG4gICAgICBpZiAoZGVmYXVsdEd1YXJkcyA9PT0gdm9pZCAwKSB7XG4gICAgICAgIGNvbnN0IHVuZ3VhcmRlZCA9IGxpc3REaWZmZXJlbmNlKG1ldGhvZE5hbWVzLCBtZXRob2RHdWFyZE5hbWVzKTtcbiAgICAgICAgdW5ndWFyZGVkLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZHMgJHtxdW90ZSh1bmd1YXJkZWQpfSBub3QgZ3VhcmRlZCBieSAke3F1b3RlKGludGVyZmFjZU5hbWUpfWA7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGZvciAoY29uc3QgcHJvcCBvZiBtZXRob2ROYW1lcykge1xuICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gYmVoYXZpb3JNZXRob2RzW3Byb3BdO1xuICAgIGNvbnN0IHsgc2hpZnRlZE1ldGhvZCB9ID0ge1xuICAgICAgc2hpZnRlZE1ldGhvZCguLi5hcmdzKSB7XG4gICAgICAgIHJldHVybiBvcmlnaW5hbE1ldGhvZCh0aGlzLCAuLi5hcmdzKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGJlaGF2aW9yTWV0aG9kID0gdGhpc2Z1bE1ldGhvZHMgPyBvcmlnaW5hbE1ldGhvZCA6IHNoaWZ0ZWRNZXRob2Q7XG4gICAgbGV0IG1ldGhvZEd1YXJkID0gbWV0aG9kR3VhcmRzICYmIG1ldGhvZEd1YXJkc1twcm9wXTtcbiAgICBpZiAoIW1ldGhvZEd1YXJkKSB7XG4gICAgICBzd2l0Y2ggKGRlZmF1bHRHdWFyZHMpIHtcbiAgICAgICAgY2FzZSB2b2lkIDA6IHtcbiAgICAgICAgICBpZiAodGhpc2Z1bE1ldGhvZHMpIHtcbiAgICAgICAgICAgIG1ldGhvZEd1YXJkID0gUGFzc2FibGVNZXRob2RHdWFyZDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWV0aG9kR3VhcmQgPSBSYXdNZXRob2RHdWFyZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInBhc3NhYmxlXCI6IHtcbiAgICAgICAgICBtZXRob2RHdWFyZCA9IFBhc3NhYmxlTWV0aG9kR3VhcmQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInJhd1wiOiB7XG4gICAgICAgICAgbWV0aG9kR3VhcmQgPSBSYXdNZXRob2RHdWFyZDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBVbnJlY29nbml6ZWQgZGVmYXVsdEd1YXJkcyAke3F1b3RlKGRlZmF1bHRHdWFyZHMpfWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcHJvdG90eXBlW3Byb3BdID0gYmluZE1ldGhvZChcbiAgICAgIGBJbiAke3F1b3RlKHByb3ApfSBtZXRob2Qgb2YgKCR7dGFnfSlgLFxuICAgICAgY29udGV4dFByb3ZpZGVyLFxuICAgICAgYmVoYXZpb3JNZXRob2QsXG4gICAgICBtZXRob2RHdWFyZFxuICAgICk7XG4gIH1cbiAgaWYgKCFoYXNPd25Qcm9wZXJ0eU9mKHByb3RvdHlwZSwgR0VUX0lOVEVSRkFDRV9HVUFSRCkpIHtcbiAgICBjb25zdCBnZXRJbnRlcmZhY2VHdWFyZE1ldGhvZCA9IHtcbiAgICAgIFtHRVRfSU5URVJGQUNFX0dVQVJEXSgpIHtcbiAgICAgICAgcmV0dXJuIGludGVyZmFjZUd1YXJkO1xuICAgICAgfVxuICAgIH1bR0VUX0lOVEVSRkFDRV9HVUFSRF07XG4gICAgcHJvdG90eXBlW0dFVF9JTlRFUkZBQ0VfR1VBUkRdID0gYmluZE1ldGhvZChcbiAgICAgIGBJbiAke3F1b3RlKEdFVF9JTlRFUkZBQ0VfR1VBUkQpfSBtZXRob2Qgb2YgKCR7dGFnfSlgLFxuICAgICAgY29udGV4dFByb3ZpZGVyLFxuICAgICAgZ2V0SW50ZXJmYWNlR3VhcmRNZXRob2QsXG4gICAgICBQYXNzYWJsZU1ldGhvZEd1YXJkXG4gICAgKTtcbiAgfVxuICByZXR1cm4gRmFyKFxuICAgIHRhZyxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHByb3RvdHlwZVxuICApO1xufTtcbmhhcmRlbihkZWZlbmRQcm90b3R5cGUpO1xudmFyIGRlZmVuZFByb3RvdHlwZUtpdCA9ICh0YWcsIGNvbnRleHRQcm92aWRlcktpdCwgYmVoYXZpb3JNZXRob2RzS2l0LCB0aGlzZnVsTWV0aG9kcyA9IGZhbHNlLCBpbnRlcmZhY2VHdWFyZEtpdCA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCBmYWNldE5hbWVzID0gb3duS2V5czE4KGJlaGF2aW9yTWV0aG9kc0tpdCkuc29ydCgpO1xuICBmYWNldE5hbWVzLmxlbmd0aCA+IDEgfHwgdGhyb3dSZWRhY3RlZGBBIG11bHRpLWZhY2V0IG9iamVjdCBtdXN0IGhhdmUgbXVsdGlwbGUgZmFjZXRzYDtcbiAgaWYgKGludGVyZmFjZUd1YXJkS2l0KSB7XG4gICAgY29uc3QgaW50ZXJmYWNlTmFtZXMgPSBvd25LZXlzMTgoaW50ZXJmYWNlR3VhcmRLaXQpO1xuICAgIGNvbnN0IGV4dHJhSW50ZXJmYWNlTmFtZXMgPSBsaXN0RGlmZmVyZW5jZShmYWNldE5hbWVzLCBpbnRlcmZhY2VOYW1lcyk7XG4gICAgZXh0cmFJbnRlcmZhY2VOYW1lcy5sZW5ndGggPT09IDAgfHwgdGhyb3dSZWRhY3RlZGBJbnRlcmZhY2VzICR7cXVvdGUoZXh0cmFJbnRlcmZhY2VOYW1lcyl9IG5vdCBpbXBsZW1lbnRlZCBieSAke3F1b3RlKHRhZyl9YDtcbiAgICBjb25zdCBleHRyYUZhY2V0TmFtZXMyID0gbGlzdERpZmZlcmVuY2UoaW50ZXJmYWNlTmFtZXMsIGZhY2V0TmFtZXMpO1xuICAgIGV4dHJhRmFjZXROYW1lczIubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgRmFjZXRzICR7cXVvdGUoZXh0cmFGYWNldE5hbWVzMil9IG9mICR7cXVvdGUodGFnKX0gbm90IGd1YXJkZWQgYnkgaW50ZXJmYWNlc2A7XG4gIH1cbiAgY29uc3QgY29udGV4dE1hcE5hbWVzID0gb3duS2V5czE4KGNvbnRleHRQcm92aWRlcktpdCk7XG4gIGNvbnN0IGV4dHJhQ29udGV4dE5hbWVzID0gbGlzdERpZmZlcmVuY2UoZmFjZXROYW1lcywgY29udGV4dE1hcE5hbWVzKTtcbiAgZXh0cmFDb250ZXh0TmFtZXMubGVuZ3RoID09PSAwIHx8IHRocm93UmVkYWN0ZWRgQ29udGV4dHMgJHtxdW90ZShleHRyYUNvbnRleHROYW1lcyl9IG5vdCBpbXBsZW1lbnRlZCBieSAke3F1b3RlKHRhZyl9YDtcbiAgY29uc3QgZXh0cmFGYWNldE5hbWVzID0gbGlzdERpZmZlcmVuY2UoY29udGV4dE1hcE5hbWVzLCBmYWNldE5hbWVzKTtcbiAgZXh0cmFGYWNldE5hbWVzLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYEZhY2V0cyAke3F1b3RlKGV4dHJhRmFjZXROYW1lcyl9IG9mICR7cXVvdGUodGFnKX0gbWlzc2luZyBjb250ZXh0c2A7XG4gIGNvbnN0IHByb3RvS2l0ID0gb2JqZWN0TWFwKFxuICAgIGJlaGF2aW9yTWV0aG9kc0tpdCxcbiAgICAoYmVoYXZpb3JNZXRob2RzLCBmYWNldE5hbWUpID0+IGRlZmVuZFByb3RvdHlwZShcbiAgICAgIGAke3RhZ30gJHtTdHJpbmcoZmFjZXROYW1lKX1gLFxuICAgICAgY29udGV4dFByb3ZpZGVyS2l0W2ZhY2V0TmFtZV0sXG4gICAgICBiZWhhdmlvck1ldGhvZHMsXG4gICAgICB0aGlzZnVsTWV0aG9kcyxcbiAgICAgIGludGVyZmFjZUd1YXJkS2l0ICYmIGludGVyZmFjZUd1YXJkS2l0W2ZhY2V0TmFtZV1cbiAgICApXG4gICk7XG4gIHJldHVybiBwcm90b0tpdDtcbn07XG5cbi8vXG52YXIgeyBjcmVhdGU6IGNyZWF0ZTMsIHNlYWwsIGZyZWV6ZTogZnJlZXplNywgZGVmaW5lUHJvcGVydHksIHZhbHVlczogdmFsdWVzMyB9ID0gT2JqZWN0O1xudmFyIExBQkVMX0lOU1RBTkNFUyA9IGVudmlyb25tZW50T3B0aW9uc0xpc3RIYXMoXCJERUJVR1wiLCBcImxhYmVsLWluc3RhbmNlc1wiKTtcbnZhciBtYWtlU2VsZiA9IChwcm90bywgaW5zdGFuY2VDb3VudCkgPT4ge1xuICBjb25zdCBzZWxmID0gY3JlYXRlMyhwcm90byk7XG4gIGlmIChMQUJFTF9JTlNUQU5DRVMpIHtcbiAgICBkZWZpbmVQcm9wZXJ0eShzZWxmLCBTeW1ib2wudG9TdHJpbmdUYWcsIHtcbiAgICAgIHZhbHVlOiBgJHtwcm90b1tTeW1ib2wudG9TdHJpbmdUYWddfSMke2luc3RhbmNlQ291bnR9YCxcbiAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgY29uZmlndXJhYmxlOiBmYWxzZVxuICAgIH0pO1xuICB9XG4gIHJldHVybiBoYXJkZW4oc2VsZik7XG59O1xudmFyIGVtcHR5UmVjb3JkID0gaGFyZGVuKHt9KTtcbnZhciBpbml0RW1wdHkgPSAoKSA9PiBlbXB0eVJlY29yZDtcbnZhciBkZWZpbmVFeG9DbGFzcyA9ICh0YWcsIGludGVyZmFjZUd1YXJkLCBpbml0LCBtZXRob2RzLCBvcHRpb25zID0ge30pID0+IHtcbiAgaGFyZGVuKG1ldGhvZHMpO1xuICBjb25zdCB7XG4gICAgZmluaXNoID0gdm9pZCAwLFxuICAgIHJlY2VpdmVBbXBsaWZpZXIgPSB2b2lkIDAsXG4gICAgcmVjZWl2ZUluc3RhbmNlVGVzdGVyID0gdm9pZCAwXG4gIH0gPSBvcHRpb25zO1xuICByZWNlaXZlQW1wbGlmaWVyID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGBPbmx5IGZhY2V0cyBvZiBhbiBleG8gY2xhc3Mga2l0IGNhbiBiZSBhbXBsaWZpZWQgJHtxdW90ZSh0YWcpfWA7XG4gIGNvbnN0IGNvbnRleHRNYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgcHJvdG8gPSBkZWZlbmRQcm90b3R5cGUoXG4gICAgdGFnLFxuICAgIChzZWxmKSA9PiAoXG4gICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgIGNvbnRleHRNYXAuZ2V0KHNlbGYpXG4gICAgKSxcbiAgICBtZXRob2RzLFxuICAgIHRydWUsXG4gICAgaW50ZXJmYWNlR3VhcmRcbiAgKTtcbiAgbGV0IGluc3RhbmNlQ291bnQgPSAwO1xuICBjb25zdCBtYWtlSW5zdGFuY2UgPSAoLi4uYXJncykgPT4ge1xuICAgIGNvbnN0IHN0YXRlID0gc2VhbChpbml0KC4uLmFyZ3MpKTtcbiAgICBpbnN0YW5jZUNvdW50ICs9IDE7XG4gICAgY29uc3Qgc2VsZiA9IG1ha2VTZWxmKHByb3RvLCBpbnN0YW5jZUNvdW50KTtcbiAgICBjb25zdCBjb250ZXh0ID0gZnJlZXplNyh7IHN0YXRlLCBzZWxmIH0pO1xuICAgIGNvbnRleHRNYXAuc2V0KHNlbGYsIGNvbnRleHQpO1xuICAgIGlmIChmaW5pc2gpIHtcbiAgICAgIGZpbmlzaChjb250ZXh0KTtcbiAgICB9XG4gICAgcmV0dXJuIHNlbGY7XG4gIH07XG4gIGlmIChyZWNlaXZlSW5zdGFuY2VUZXN0ZXIpIHtcbiAgICBjb25zdCBpc0luc3RhbmNlID0gKGV4bywgZmFjZXROYW1lID0gdm9pZCAwKSA9PiB7XG4gICAgICBmYWNldE5hbWUgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYGZhY2V0TmFtZSBjYW4gb25seSBiZSB1c2VkIHdpdGggYW4gZXhvIGNsYXNzIGtpdDogJHtxdW90ZShcbiAgICAgICAgdGFnXG4gICAgICApfSBoYXMgbm8gZmFjZXQgJHtxdW90ZShmYWNldE5hbWUpfWA7XG4gICAgICByZXR1cm4gY29udGV4dE1hcC5oYXMoZXhvKTtcbiAgICB9O1xuICAgIGhhcmRlbihpc0luc3RhbmNlKTtcbiAgICByZWNlaXZlSW5zdGFuY2VUZXN0ZXIoaXNJbnN0YW5jZSk7XG4gIH1cbiAgcmV0dXJuIGhhcmRlbihtYWtlSW5zdGFuY2UpO1xufTtcbmhhcmRlbihkZWZpbmVFeG9DbGFzcyk7XG52YXIgZGVmaW5lRXhvQ2xhc3NLaXQgPSAodGFnLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgbWV0aG9kc0tpdCwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGhhcmRlbihtZXRob2RzS2l0KTtcbiAgY29uc3Qge1xuICAgIGZpbmlzaCA9IHZvaWQgMCxcbiAgICByZWNlaXZlQW1wbGlmaWVyID0gdm9pZCAwLFxuICAgIHJlY2VpdmVJbnN0YW5jZVRlc3RlciA9IHZvaWQgMFxuICB9ID0gb3B0aW9ucztcbiAgY29uc3QgY29udGV4dE1hcEtpdCA9IG9iamVjdE1hcChtZXRob2RzS2l0LCAoKSA9PiAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKSk7XG4gIGNvbnN0IGdldENvbnRleHRLaXQgPSBvYmplY3RNYXAoXG4gICAgY29udGV4dE1hcEtpdCxcbiAgICAoY29udGV4dE1hcCkgPT4gKGZhY2V0KSA9PiBjb250ZXh0TWFwLmdldChmYWNldClcbiAgKTtcbiAgY29uc3QgcHJvdG90eXBlS2l0ID0gZGVmZW5kUHJvdG90eXBlS2l0KFxuICAgIHRhZyxcbiAgICBnZXRDb250ZXh0S2l0LFxuICAgIG1ldGhvZHNLaXQsXG4gICAgdHJ1ZSxcbiAgICBpbnRlcmZhY2VHdWFyZEtpdFxuICApO1xuICBsZXQgaW5zdGFuY2VDb3VudCA9IDA7XG4gIGNvbnN0IG1ha2VJbnN0YW5jZUtpdCA9ICguLi5hcmdzKSA9PiB7XG4gICAgY29uc3Qgc3RhdGUgPSBzZWFsKGluaXQoLi4uYXJncykpO1xuICAgIGNvbnN0IGNvbnRleHQgPSB7IHN0YXRlLCBmYWNldHM6IG51bGwgfTtcbiAgICBpbnN0YW5jZUNvdW50ICs9IDE7XG4gICAgY29uc3QgZmFjZXRzID0gb2JqZWN0TWFwKHByb3RvdHlwZUtpdCwgKHByb3RvLCBmYWNldE5hbWUpID0+IHtcbiAgICAgIGNvbnN0IHNlbGYgPSBtYWtlU2VsZihwcm90bywgaW5zdGFuY2VDb3VudCk7XG4gICAgICBjb250ZXh0TWFwS2l0W2ZhY2V0TmFtZV0uc2V0KHNlbGYsIGNvbnRleHQpO1xuICAgICAgcmV0dXJuIHNlbGY7XG4gICAgfSk7XG4gICAgY29udGV4dC5mYWNldHMgPSBmYWNldHM7XG4gICAgZnJlZXplNyhjb250ZXh0KTtcbiAgICBpZiAoZmluaXNoKSB7XG4gICAgICBmaW5pc2goY29udGV4dCk7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBjb250ZXh0LmZhY2V0c1xuICAgICk7XG4gIH07XG4gIGlmIChyZWNlaXZlQW1wbGlmaWVyKSB7XG4gICAgY29uc3QgYW1wbGlmeSA9IChleG9GYWNldCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBjb250ZXh0TWFwIG9mIHZhbHVlczMoY29udGV4dE1hcEtpdCkpIHtcbiAgICAgICAgaWYgKGNvbnRleHRNYXAuaGFzKGV4b0ZhY2V0KSkge1xuICAgICAgICAgIGNvbnN0IHsgZmFjZXRzIH0gPSBjb250ZXh0TWFwLmdldChleG9GYWNldCk7XG4gICAgICAgICAgcmV0dXJuIGZhY2V0cztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBNdXN0IGJlIGEgZmFjZXQgb2YgJHtxdW90ZSh0YWcpfTogJHtleG9GYWNldH1gO1xuICAgIH07XG4gICAgaGFyZGVuKGFtcGxpZnkpO1xuICAgIHJlY2VpdmVBbXBsaWZpZXIoYW1wbGlmeSk7XG4gIH1cbiAgaWYgKHJlY2VpdmVJbnN0YW5jZVRlc3Rlcikge1xuICAgIGNvbnN0IGlzSW5zdGFuY2UgPSAoZXhvRmFjZXQsIGZhY2V0TmFtZSA9IHZvaWQgMCkgPT4ge1xuICAgICAgaWYgKGZhY2V0TmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZXMzKGNvbnRleHRNYXBLaXQpLnNvbWUoXG4gICAgICAgICAgKGNvbnRleHRNYXAyKSA9PiBjb250ZXh0TWFwMi5oYXMoZXhvRmFjZXQpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBhc3NlcnQudHlwZW9mKGZhY2V0TmFtZSwgXCJzdHJpbmdcIik7XG4gICAgICBjb25zdCBjb250ZXh0TWFwID0gY29udGV4dE1hcEtpdFtmYWNldE5hbWVdO1xuICAgICAgY29udGV4dE1hcCAhPT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgZXhvIGNsYXNzIGtpdCAke3F1b3RlKHRhZyl9IGhhcyBubyBmYWNldCBuYW1lZCAke3F1b3RlKGZhY2V0TmFtZSl9YDtcbiAgICAgIHJldHVybiBjb250ZXh0TWFwLmhhcyhleG9GYWNldCk7XG4gICAgfTtcbiAgICBoYXJkZW4oaXNJbnN0YW5jZSk7XG4gICAgcmVjZWl2ZUluc3RhbmNlVGVzdGVyKGlzSW5zdGFuY2UpO1xuICB9XG4gIHJldHVybiBoYXJkZW4obWFrZUluc3RhbmNlS2l0KTtcbn07XG5oYXJkZW4oZGVmaW5lRXhvQ2xhc3NLaXQpO1xudmFyIG1ha2VFeG8gPSAodGFnLCBpbnRlcmZhY2VHdWFyZCwgbWV0aG9kcywgb3B0aW9ucyA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCBtYWtlSW5zdGFuY2UgPSBkZWZpbmVFeG9DbGFzcyhcbiAgICB0YWcsXG4gICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgaW5pdEVtcHR5LFxuICAgIG1ldGhvZHMsXG4gICAgb3B0aW9uc1xuICApO1xuICByZXR1cm4gbWFrZUluc3RhbmNlKCk7XG59O1xuaGFyZGVuKG1ha2VFeG8pO1xuXG4vL1xudmFyIG1ha2VMZWdhY3lNYXAgPSAodGFnID0gXCJrZXlcIikgPT4ge1xuICBjb25zdCBtMiA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG4gIGNvbnN0IGFzc2VydEtleURvZXNOb3RFeGlzdCA9IChrZXkpID0+ICFtMi5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gYWxyZWFkeSByZWdpc3RlcmVkOiAke2tleX1gO1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiBtMi5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiBtMi5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGluaXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlEb2VzTm90RXhpc3Qoa2V5KTtcbiAgICAgIG0yLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gbTIuZ2V0KGtleSk7XG4gICAgfSxcbiAgICBzZXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlFeGlzdHMoa2V5KTtcbiAgICAgIG0yLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGRlbGV0ZTogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICBtMi5kZWxldGUoa2V5KTtcbiAgICB9LFxuICAgIGtleXM6ICgpID0+IG0yLmtleXMoKSxcbiAgICB2YWx1ZXM6ICgpID0+IG0yLnZhbHVlcygpLFxuICAgIGVudHJpZXM6ICgpID0+IG0yLmVudHJpZXMoKSxcbiAgICBnZXRTaXplOiAoKSA9PiBtMi5zaXplLFxuICAgIGNsZWFyOiAoKSA9PiBtMi5jbGVhcigpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlTGVnYWN5TWFwKTtcblxuLy9cbnZhciBtYWtlTGVnYWN5V2Vha01hcCA9ICh0YWcgPSBcImtleVwiKSA9PiB7XG4gIGNvbnN0IHdtID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IGFzc2VydEtleURvZXNOb3RFeGlzdCA9IChrZXkpID0+ICF3bS5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gYWxyZWFkeSByZWdpc3RlcmVkOiAke2tleX1gO1xuICBjb25zdCBhc3NlcnRLZXlFeGlzdHMgPSAoa2V5KSA9PiB3bS5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gbm90IGZvdW5kOiAke2tleX1gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBoYXM6IChrZXkpID0+IHtcbiAgICAgIHJldHVybiB3bS5oYXMoa2V5KTtcbiAgICB9LFxuICAgIGluaXQ6IChrZXksIHZhbHVlKSA9PiB7XG4gICAgICBhc3NlcnRLZXlEb2VzTm90RXhpc3Qoa2V5KTtcbiAgICAgIHdtLnNldChrZXksIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldDogKGtleSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAgICAgICAgICAgICovXG4gICAgICAgIHdtLmdldChrZXkpXG4gICAgICApO1xuICAgIH0sXG4gICAgc2V0OiAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgYXNzZXJ0S2V5RXhpc3RzKGtleSk7XG4gICAgICB3bS5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfSxcbiAgICBkZWxldGU6IChrZXkpID0+IHtcbiAgICAgIGFzc2VydEtleUV4aXN0cyhrZXkpO1xuICAgICAgd20uZGVsZXRlKGtleSk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUxlZ2FjeVdlYWtNYXApO1xuXG4vL1xudmFyIG11c3RNYXRjaDIgPSBtdXN0TWF0Y2g7XG5cbi8vXG52YXIgZW1wdHkgPSAwbjtcbnZhciBuYXRNYXRoSGVscGVycyA9IGhhcmRlbih7XG4gIGRvQ29lcmNlOiAobmF0KSA9PiB7XG4gICAgYXNzZXJ0LnR5cGVvZihuYXQsIFwiYmlnaW50XCIpO1xuICAgIGlzTmF0KG5hdCkgfHwgdGhyb3dSZWRhY3RlZGB2YWx1ZSAke25hdH0gbXVzdCBiZSBhIG5hdHVyYWwgbnVtYmVyYDtcbiAgICByZXR1cm4gTmF0KG5hdCk7XG4gIH0sXG4gIGRvTWFrZUVtcHR5OiAoKSA9PiBlbXB0eSxcbiAgZG9Jc0VtcHR5OiAobmF0KSA9PiBuYXQgPT09IGVtcHR5LFxuICBkb0lzR1RFOiAobGVmdCwgcmlnaHQpID0+IGxlZnQgPj0gcmlnaHQsXG4gIGRvSXNFcXVhbDogKGxlZnQsIHJpZ2h0KSA9PiBsZWZ0ID09PSByaWdodCxcbiAgLy9cbiAgZG9BZGQ6IChsZWZ0LCByaWdodCkgPT4gbGVmdCArIHJpZ2h0LFxuICBkb1N1YnRyYWN0OiAobGVmdCwgcmlnaHQpID0+IE5hdChsZWZ0IC0gcmlnaHQpXG59KTtcblxuLy9cbnZhciBlbXB0eTIgPSBoYXJkZW4oW10pO1xudmFyIHNldE1hdGhIZWxwZXJzID0gaGFyZGVuKHtcbiAgZG9Db2VyY2U6IChsaXN0KSA9PiB7XG4gICAgbGlzdCA9IGNvZXJjZVRvRWxlbWVudHMobGlzdCk7XG4gICAgYXNzZXJ0S2V5KGxpc3QpO1xuICAgIHJldHVybiBsaXN0O1xuICB9LFxuICBkb01ha2VFbXB0eTogKCkgPT4gZW1wdHkyLFxuICBkb0lzRW1wdHk6IChsaXN0KSA9PiBwYXNzU3R5bGVPZihsaXN0KSA9PT0gXCJjb3B5QXJyYXlcIiAmJiBsaXN0Lmxlbmd0aCA9PT0gMCxcbiAgZG9Jc0dURTogZWxlbWVudHNJc1N1cGVyc2V0LFxuICBkb0lzRXF1YWw6ICh4LCB5KSA9PiBlbGVtZW50c0NvbXBhcmUoeCwgeSkgPT09IDAsXG4gIGRvQWRkOiBlbGVtZW50c0Rpc2pvaW50VW5pb24sXG4gIGRvU3VidHJhY3Q6IGVsZW1lbnRzRGlzam9pbnRTdWJ0cmFjdFxufSk7XG5cbi8vXG52YXIgZW1wdHkzID0gbWFrZUNvcHlTZXQoW10pO1xudmFyIGNvcHlTZXRNYXRoSGVscGVycyA9IGhhcmRlbih7XG4gIGRvQ29lcmNlOiAoc2V0KSA9PiB7XG4gICAgbXVzdE1hdGNoMihzZXQsIE0uc2V0KCksIFwic2V0IG9mIGFtb3VudFwiKTtcbiAgICByZXR1cm4gc2V0O1xuICB9LFxuICBkb01ha2VFbXB0eTogKCkgPT4gZW1wdHkzLFxuICBkb0lzRW1wdHk6IChzZXQpID0+IGdldENvcHlTZXRLZXlzKHNldCkubGVuZ3RoID09PSAwLFxuICBkb0lzR1RFOiBzZXRJc1N1cGVyc2V0LFxuICBkb0lzRXF1YWw6IGtleUVRLFxuICBkb0FkZDogc2V0RGlzam9pbnRVbmlvbixcbiAgZG9TdWJ0cmFjdDogc2V0RGlzam9pbnRTdWJ0cmFjdFxufSk7XG5cbi8vXG52YXIgZW1wdHk0ID0gbWFrZUNvcHlCYWcoW10pO1xudmFyIGNvcHlCYWdNYXRoSGVscGVycyA9IGhhcmRlbih7XG4gIGRvQ29lcmNlOiAoYmFnKSA9PiB7XG4gICAgbXVzdE1hdGNoMihiYWcsIE0uYmFnKCksIFwiYmFnIG9mIGFtb3VudFwiKTtcbiAgICByZXR1cm4gYmFnO1xuICB9LFxuICBkb01ha2VFbXB0eTogKCkgPT4gZW1wdHk0LFxuICBkb0lzRW1wdHk6IChiYWcpID0+IGdldENvcHlCYWdFbnRyaWVzKGJhZykubGVuZ3RoID09PSAwLFxuICBkb0lzR1RFOiBiYWdJc1N1cGVyYmFnLFxuICBkb0lzRXF1YWw6IGtleUVRLFxuICBkb0FkZDogYmFnVW5pb24sXG4gIGRvU3VidHJhY3Q6IGJhZ0Rpc2pvaW50U3VidHJhY3Rcbn0pO1xuXG4vL1xudmFyIEFzc2V0S2luZCA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIE5BVDogXCJuYXRcIixcbiAgICBTRVQ6IFwic2V0XCIsXG4gICAgQ09QWV9TRVQ6IFwiY29weVNldFwiLFxuICAgIENPUFlfQkFHOiBcImNvcHlCYWdcIlxuICB9XG4pO1xuaGFyZGVuKEFzc2V0S2luZCk7XG52YXIgYXNzZXRLaW5kTmFtZXMgPSBoYXJkZW4oT2JqZWN0LnZhbHVlcyhBc3NldEtpbmQpLnNvcnQoKSk7XG52YXIgYXNzZXJ0QXNzZXRLaW5kID0gKGFsbGVnZWRBSykgPT4ge1xuICBhc3NldEtpbmROYW1lcy5pbmNsdWRlcyhhbGxlZ2VkQUspIHx8IHRocm93UmVkYWN0ZWRgVGhlIGFzc2V0S2luZCAke2FsbGVnZWRBS30gbXVzdCBiZSBvbmUgb2YgJHtxdW90ZShhc3NldEtpbmROYW1lcyl9YDtcbn07XG5oYXJkZW4oYXNzZXJ0QXNzZXRLaW5kKTtcbnZhciBoZWxwZXJzID0ge1xuICBuYXQ6IG5hdE1hdGhIZWxwZXJzLFxuICBzZXQ6IHNldE1hdGhIZWxwZXJzLFxuICBjb3B5U2V0OiBjb3B5U2V0TWF0aEhlbHBlcnMsXG4gIGNvcHlCYWc6IGNvcHlCYWdNYXRoSGVscGVyc1xufTtcbnZhciBhc3NlcnRWYWx1ZUdldEFzc2V0S2luZCA9ICh2YWx1ZSkgPT4ge1xuICBjb25zdCBwYXNzU3R5bGUgPSBwYXNzU3R5bGVPZih2YWx1ZSk7XG4gIGlmIChwYXNzU3R5bGUgPT09IFwiYmlnaW50XCIpIHtcbiAgICByZXR1cm4gXCJuYXRcIjtcbiAgfVxuICBpZiAocGFzc1N0eWxlID09PSBcImNvcHlBcnJheVwiKSB7XG4gICAgcmV0dXJuIFwic2V0XCI7XG4gIH1cbiAgaWYgKG1hdGNoZXModmFsdWUsIE0uc2V0KCkpKSB7XG4gICAgcmV0dXJuIFwiY29weVNldFwiO1xuICB9XG4gIGlmIChtYXRjaGVzKHZhbHVlLCBNLmJhZygpKSkge1xuICAgIHJldHVybiBcImNvcHlCYWdcIjtcbiAgfVxuICB0aHJvdyB0aHJvd1JlZGFjdGVkYHZhbHVlICR7dmFsdWV9IG11c3QgYmUgYSBiaWdpbnQsIGNvcHlTZXQsIGNvcHlCYWcsIG9yIGFuIGFycmF5LCBub3QgJHtxdW90ZShcbiAgICBwYXNzU3R5bGVcbiAgKX1gO1xufTtcbnZhciBhc3NlcnRWYWx1ZUdldEhlbHBlcnMgPSAodmFsdWUpID0+IChcbiAgLy9cbiAgaGVscGVyc1thc3NlcnRWYWx1ZUdldEFzc2V0S2luZCh2YWx1ZSldXG4pO1xudmFyIG9wdGlvbmFsQnJhbmRDaGVjayA9IChhbGxlZ2VkQnJhbmQsIGJyYW5kKSA9PiB7XG4gIGlmIChicmFuZCAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGJyYW5kLCBcImJyYW5kXCIpO1xuICAgIGFsbGVnZWRCcmFuZCA9PT0gYnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBhbW91bnQncyBicmFuZCAke3F1b3RlKGFsbGVnZWRCcmFuZCl9IGRpZCBub3QgbWF0Y2ggZXhwZWN0ZWQgYnJhbmQgJHtxdW90ZShcbiAgICAgIGJyYW5kXG4gICAgKX1gO1xuICB9XG59O1xudmFyIGNoZWNrTFJBbmRHZXRIZWxwZXJzID0gKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICBhc3NlcnRSZWNvcmQobGVmdEFtb3VudCwgXCJsZWZ0QW1vdW50XCIpO1xuICBhc3NlcnRSZWNvcmQocmlnaHRBbW91bnQsIFwicmlnaHRBbW91bnRcIik7XG4gIGNvbnN0IHsgdmFsdWU6IGxlZnRWYWx1ZSwgYnJhbmQ6IGxlZnRCcmFuZCB9ID0gbGVmdEFtb3VudDtcbiAgY29uc3QgeyB2YWx1ZTogcmlnaHRWYWx1ZSwgYnJhbmQ6IHJpZ2h0QnJhbmQgfSA9IHJpZ2h0QW1vdW50O1xuICBhc3NlcnRSZW1vdGFibGUobGVmdEJyYW5kLCBcImxlZnRCcmFuZFwiKTtcbiAgYXNzZXJ0UmVtb3RhYmxlKHJpZ2h0QnJhbmQsIFwicmlnaHRCcmFuZFwiKTtcbiAgb3B0aW9uYWxCcmFuZENoZWNrKGxlZnRCcmFuZCwgYnJhbmQpO1xuICBvcHRpb25hbEJyYW5kQ2hlY2socmlnaHRCcmFuZCwgYnJhbmQpO1xuICBsZWZ0QnJhbmQgPT09IHJpZ2h0QnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBCcmFuZHMgaW4gbGVmdCAke3F1b3RlKGxlZnRCcmFuZCl9IGFuZCByaWdodCAke3F1b3RlKFxuICAgIHJpZ2h0QnJhbmRcbiAgKX0gc2hvdWxkIG1hdGNoIGJ1dCBkbyBub3RgO1xuICBjb25zdCBsZWZ0SGVscGVycyA9IGFzc2VydFZhbHVlR2V0SGVscGVycyhsZWZ0VmFsdWUpO1xuICBjb25zdCByaWdodEhlbHBlcnMgPSBhc3NlcnRWYWx1ZUdldEhlbHBlcnMocmlnaHRWYWx1ZSk7XG4gIGxlZnRIZWxwZXJzID09PSByaWdodEhlbHBlcnMgfHwgdGhyb3dSZWRhY3RlZGBUaGUgbGVmdCAke2xlZnRBbW91bnR9IGFuZCByaWdodCBhbW91bnQgJHtyaWdodEFtb3VudH0gaGFkIGRpZmZlcmVudCBhc3NldEtpbmRzYDtcbiAgcmV0dXJuIGxlZnRIZWxwZXJzO1xufTtcbnZhciBjb2VyY2VMUiA9IChoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkgPT4ge1xuICByZXR1cm4gW2guZG9Db2VyY2UobGVmdEFtb3VudC52YWx1ZSksIGguZG9Db2VyY2UocmlnaHRBbW91bnQudmFsdWUpXTtcbn07XG52YXIgaXNHVEUgPSAobGVmdEFtb3VudCwgcmlnaHRBbW91bnQsIGJyYW5kID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVycyhsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICByZXR1cm4gaC5kb0lzR1RFKC4uLmNvZXJjZUxSKGgsIGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50KSk7XG59O1xudmFyIEFtb3VudE1hdGggPSB7XG4gIC8vXG4gIC8vXG4gIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICovXG4gIG1ha2U6IChicmFuZCwgYWxsZWdlZFZhbHVlKSA9PiB7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGJyYW5kLCBcImJyYW5kXCIpO1xuICAgIGNvbnN0IGggPSBhc3NlcnRWYWx1ZUdldEhlbHBlcnMoYWxsZWdlZFZhbHVlKTtcbiAgICBjb25zdCB2YWx1ZSA9IGguZG9Db2VyY2UoYWxsZWdlZFZhbHVlKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgYnJhbmQsIHZhbHVlIH0pO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuXG4gICAqL1xuICBjb2VyY2U6IChicmFuZCwgYWxsZWdlZEFtb3VudCkgPT4ge1xuICAgIGFzc2VydFJlbW90YWJsZShicmFuZCwgXCJicmFuZFwiKTtcbiAgICBhc3NlcnRSZWNvcmQoYWxsZWdlZEFtb3VudCwgXCJhbW91bnRcIik7XG4gICAgY29uc3QgeyBicmFuZDogYWxsZWdlZEJyYW5kLCB2YWx1ZTogYWxsZWdlZFZhbHVlIH0gPSBhbGxlZ2VkQW1vdW50O1xuICAgIGJyYW5kID09PSBhbGxlZ2VkQnJhbmQgfHwgdGhyb3dSZWRhY3RlZGBUaGUgYnJhbmQgaW4gdGhlIGFsbGVnZWRBbW91bnQgJHthbGxlZ2VkQW1vdW50fSBpbiAnY29lcmNlJyBkaWRuJ3QgbWF0Y2ggdGhlIHNwZWNpZmllZCBicmFuZCAke2JyYW5kfS5gO1xuICAgIHJldHVybiBBbW91bnRNYXRoLm1ha2UoYnJhbmQsIGFsbGVnZWRWYWx1ZSk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuXG4gICAqL1xuICBnZXRWYWx1ZTogKGJyYW5kLCBhbW91bnQpID0+IEFtb3VudE1hdGguY29lcmNlKGJyYW5kLCBhbW91bnQpLnZhbHVlLFxuICAvKlxuXG5cblxuXG5cblxuXG4gICAqL1xuICBtYWtlRW1wdHk6IChicmFuZCwgYXNzZXRLaW5kID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgXCJuYXRcIlxuICApKSA9PiB7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGJyYW5kLCBcImJyYW5kXCIpO1xuICAgIGFzc2VydEFzc2V0S2luZChhc3NldEtpbmQpO1xuICAgIGNvbnN0IHZhbHVlID0gaGVscGVyc1thc3NldEtpbmRdLmRvTWFrZUVtcHR5KCk7XG4gICAgcmV0dXJuIGhhcmRlbih7IGJyYW5kLCB2YWx1ZSB9KTtcbiAgfSxcbiAgLypcblxuXG5cblxuXG5cbiAgICovXG4gIG1ha2VFbXB0eUZyb21BbW91bnQ6IChhbW91bnQpID0+IHtcbiAgICBhc3NlcnRSZWNvcmQoYW1vdW50LCBcImFtb3VudFwiKTtcbiAgICBjb25zdCB7IGJyYW5kLCB2YWx1ZSB9ID0gYW1vdW50O1xuICAgIGNvbnN0IGFzc2V0S2luZCA9IGFzc2VydFZhbHVlR2V0QXNzZXRLaW5kKHZhbHVlKTtcbiAgICByZXR1cm4gQW1vdW50TWF0aC5tYWtlRW1wdHkoYnJhbmQsIGFzc2V0S2luZCk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuICAgKi9cbiAgaXNFbXB0eTogKGFtb3VudCwgYnJhbmQgPSB2b2lkIDApID0+IHtcbiAgICBhc3NlcnRSZWNvcmQoYW1vdW50LCBcImFtb3VudFwiKTtcbiAgICBjb25zdCB7IGJyYW5kOiBhbGxlZ2VkQnJhbmQsIHZhbHVlIH0gPSBhbW91bnQ7XG4gICAgYXNzZXJ0UmVtb3RhYmxlKGFsbGVnZWRCcmFuZCwgXCJicmFuZFwiKTtcbiAgICBvcHRpb25hbEJyYW5kQ2hlY2soYWxsZWdlZEJyYW5kLCBicmFuZCk7XG4gICAgY29uc3QgaCA9IGFzc2VydFZhbHVlR2V0SGVscGVycyh2YWx1ZSk7XG4gICAgcmV0dXJuIGguZG9Jc0VtcHR5KGguZG9Db2VyY2UodmFsdWUpKTtcbiAgfSxcbiAgaXNHVEUsXG4gIC8qXG5cblxuXG5cblxuXG5cblxuICAgKi9cbiAgaXNFcXVhbDogKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVycyhsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICAgIHJldHVybiBoLmRvSXNFcXVhbCguLi5jb2VyY2VMUihoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkpO1xuICB9LFxuICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICovXG4gIGFkZDogKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVycyhsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICAgIGNvbnN0IHZhbHVlID0gaC5kb0FkZCguLi5jb2VyY2VMUihoLCBsZWZ0QW1vdW50LCByaWdodEFtb3VudCkpO1xuICAgIHJldHVybiBoYXJkZW4oeyBicmFuZDogbGVmdEFtb3VudC5icmFuZCwgdmFsdWUgfSk7XG4gIH0sXG4gIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAqL1xuICBzdWJ0cmFjdDogKGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50LCBicmFuZCA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IGggPSBjaGVja0xSQW5kR2V0SGVscGVycyhsZWZ0QW1vdW50LCByaWdodEFtb3VudCwgYnJhbmQpO1xuICAgIGNvbnN0IHZhbHVlID0gaC5kb1N1YnRyYWN0KC4uLmNvZXJjZUxSKGgsIGxlZnRBbW91bnQsIHJpZ2h0QW1vdW50KSk7XG4gICAgcmV0dXJuIGhhcmRlbih7IGJyYW5kOiBsZWZ0QW1vdW50LmJyYW5kLCB2YWx1ZSB9KTtcbiAgfSxcbiAgLypcblxuXG5cblxuXG5cblxuICAgKi9cbiAgbWluOiAoeCwgeSwgYnJhbmQgPSB2b2lkIDApID0+IChcbiAgICAvL1xuICAgIGlzR1RFKHgsIHksIGJyYW5kKSA/IHkgOiBpc0dURSh5LCB4LCBicmFuZCkgPyB4IDogdGhyb3dSZWRhY3RlZGAke3h9IGFuZCAke3l9IGFyZSBpbmNvbXBhcmFibGVgXG4gICksXG4gIC8qXG5cblxuXG5cblxuXG5cbiAgICovXG4gIG1heDogKHgsIHksIGJyYW5kID0gdm9pZCAwKSA9PiAoXG4gICAgLy9cbiAgICBpc0dURSh4LCB5LCBicmFuZCkgPyB4IDogaXNHVEUoeSwgeCkgPyB5IDogdGhyb3dSZWRhY3RlZGAke3h9IGFuZCAke3l9IGFyZSBpbmNvbXBhcmFibGVgXG4gIClcbn07XG5oYXJkZW4oQW1vdW50TWF0aCk7XG52YXIgZ2V0QXNzZXRLaW5kID0gKGFtb3VudCkgPT4ge1xuICBhc3NlcnRSZWNvcmQoYW1vdW50LCBcImFtb3VudFwiKTtcbiAgY29uc3QgeyB2YWx1ZSB9ID0gYW1vdW50O1xuICByZXR1cm4gYXNzZXJ0VmFsdWVHZXRBc3NldEtpbmQodmFsdWUpO1xufTtcbmhhcmRlbihnZXRBc3NldEtpbmQpO1xuXG4vL1xudmFyIFZhdERhdGFHbG9iYWw7XG5pZiAoXCJWYXREYXRhXCIgaW4gZ2xvYmFsVGhpcykge1xuICBnbG9iYWxUaGlzLlZhdERhdGEgfHwgdGhyb3dSZWRhY3RlZGBWYXREYXRhIGRlZmluZWQgaW4gZ2xvYmFsIGFzIG51bGwgb3IgdW5kZWZpbmVkYDtcbiAgVmF0RGF0YUdsb2JhbCA9IC8qICAgICAgICAgICAgICAqL1xuICBnbG9iYWxUaGlzLlZhdERhdGE7XG59IGVsc2Uge1xuICBjb25zdCB1bmF2YWlsYWJsZSA9ICgpID0+IHRocm93UmVkYWN0ZWRgVmF0RGF0YSB1bmF2YWlsYWJsZWA7XG4gIFZhdERhdGFHbG9iYWwgPSB7XG4gICAgZGVmaW5lS2luZDogdW5hdmFpbGFibGUsXG4gICAgZGVmaW5lS2luZE11bHRpOiB1bmF2YWlsYWJsZSxcbiAgICBkZWZpbmVEdXJhYmxlS2luZDogdW5hdmFpbGFibGUsXG4gICAgZGVmaW5lRHVyYWJsZUtpbmRNdWx0aTogdW5hdmFpbGFibGUsXG4gICAgbWFrZUtpbmRIYW5kbGU6IHVuYXZhaWxhYmxlLFxuICAgIHByb3ZpZGVQcm9taXNlV2F0Y2hlcjogdW5hdmFpbGFibGUsXG4gICAgd2F0Y2hQcm9taXNlOiB1bmF2YWlsYWJsZSxcbiAgICBtYWtlU2NhbGFyQmlnTWFwU3RvcmU6IHVuYXZhaWxhYmxlLFxuICAgIG1ha2VTY2FsYXJCaWdXZWFrTWFwU3RvcmU6IHVuYXZhaWxhYmxlLFxuICAgIG1ha2VTY2FsYXJCaWdTZXRTdG9yZTogdW5hdmFpbGFibGUsXG4gICAgbWFrZVNjYWxhckJpZ1dlYWtTZXRTdG9yZTogdW5hdmFpbGFibGUsXG4gICAgY2FuQmVEdXJhYmxlOiB1bmF2YWlsYWJsZVxuICB9O1xufVxudmFyIFZhdERhdGFFeHBvcnQgPSBWYXREYXRhR2xvYmFsO1xudmFyIHtcbiAgZGVmaW5lS2luZCxcbiAgZGVmaW5lS2luZE11bHRpLFxuICBkZWZpbmVEdXJhYmxlS2luZCxcbiAgZGVmaW5lRHVyYWJsZUtpbmRNdWx0aVxufSA9IFZhdERhdGFHbG9iYWw7XG52YXIge1xuICBtYWtlS2luZEhhbmRsZSxcbiAgcHJvdmlkZVByb21pc2VXYXRjaGVyLFxuICB3YXRjaFByb21pc2UsXG4gIG1ha2VTY2FsYXJCaWdNYXBTdG9yZSxcbiAgbWFrZVNjYWxhckJpZ1dlYWtNYXBTdG9yZSxcbiAgbWFrZVNjYWxhckJpZ1NldFN0b3JlLFxuICBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlLFxuICBjYW5CZUR1cmFibGVcbn0gPSBWYXREYXRhR2xvYmFsO1xudmFyIHBpY2tGYWNldCA9IChtYWtlciwgZmFjZXROYW1lKSA9PiAoLi4uYXJncykgPT4gbWFrZXIoLi4uYXJncylbZmFjZXROYW1lXTtcbmhhcmRlbihwaWNrRmFjZXQpO1xudmFyIHBhcnRpYWxBc3NpZ24gPSAodGFyZ2V0LCBzb3VyY2UpID0+IHtcbiAgT2JqZWN0LmFzc2lnbih0YXJnZXQsIHNvdXJjZSk7XG59O1xuaGFyZGVuKHBhcnRpYWxBc3NpZ24pO1xudmFyIHByb3ZpZGUgPSAoXG4gIC8vXG4gIC8qXG5cblxuXG5cblxuICAgKi9cbiAgcHJvdmlkZUxhenlcbik7XG52YXIgbWFrZVN0b3JlVXRpbHMgPSAoVmF0RGF0YSkgPT4ge1xuICBjb25zdCB7XG4gICAgLy9cbiAgICBtYWtlU2NhbGFyQmlnTWFwU3RvcmU6IG1ha2VTY2FsYXJCaWdNYXBTdG9yZTIsXG4gICAgLy9cbiAgICBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlOiBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlMixcbiAgICAvL1xuICAgIG1ha2VTY2FsYXJCaWdTZXRTdG9yZTogbWFrZVNjYWxhckJpZ1NldFN0b3JlMixcbiAgICAvL1xuICAgIG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmU6IG1ha2VTY2FsYXJCaWdXZWFrU2V0U3RvcmUyXG4gIH0gPSBWYXREYXRhO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZU1hcFN0b3JlMiA9IChiYWdnYWdlLCBuYW1lLCBvcHRpb25zID0ge30pID0+IHByb3ZpZGUoXG4gICAgYmFnZ2FnZSxcbiAgICBuYW1lLFxuICAgICgpID0+IG1ha2VTY2FsYXJCaWdNYXBTdG9yZTIobmFtZSwgeyBkdXJhYmxlOiB0cnVlLCAuLi5vcHRpb25zIH0pXG4gICk7XG4gIGhhcmRlbihwcm92aWRlRHVyYWJsZU1hcFN0b3JlMik7XG4gIGNvbnN0IHByb3ZpZGVEdXJhYmxlV2Vha01hcFN0b3JlMiA9IChiYWdnYWdlLCBuYW1lLCBvcHRpb25zID0ge30pID0+IHByb3ZpZGUoXG4gICAgYmFnZ2FnZSxcbiAgICBuYW1lLFxuICAgICgpID0+IG1ha2VTY2FsYXJCaWdXZWFrTWFwU3RvcmUyKG5hbWUsIHsgZHVyYWJsZTogdHJ1ZSwgLi4ub3B0aW9ucyB9KVxuICApO1xuICBoYXJkZW4ocHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmUyKTtcbiAgY29uc3QgcHJvdmlkZUR1cmFibGVTZXRTdG9yZTIgPSAoYmFnZ2FnZSwgbmFtZSwgb3B0aW9ucyA9IHt9KSA9PiBwcm92aWRlKFxuICAgIGJhZ2dhZ2UsXG4gICAgbmFtZSxcbiAgICAoKSA9PiBtYWtlU2NhbGFyQmlnU2V0U3RvcmUyKG5hbWUsIHsgZHVyYWJsZTogdHJ1ZSwgLi4ub3B0aW9ucyB9KVxuICApO1xuICBoYXJkZW4ocHJvdmlkZUR1cmFibGVTZXRTdG9yZTIpO1xuICBjb25zdCBwcm92aWRlRHVyYWJsZVdlYWtTZXRTdG9yZTIgPSAoYmFnZ2FnZSwgbmFtZSwgb3B0aW9ucyA9IHt9KSA9PiBwcm92aWRlKFxuICAgIGJhZ2dhZ2UsXG4gICAgbmFtZSxcbiAgICAoKSA9PiBtYWtlU2NhbGFyQmlnV2Vha1NldFN0b3JlMihuYW1lLCB7IGR1cmFibGU6IHRydWUsIC4uLm9wdGlvbnMgfSlcbiAgKTtcbiAgaGFyZGVuKHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlMik7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIHByb3ZpZGVEdXJhYmxlTWFwU3RvcmU6IHByb3ZpZGVEdXJhYmxlTWFwU3RvcmUyLFxuICAgIHByb3ZpZGVEdXJhYmxlV2Vha01hcFN0b3JlOiBwcm92aWRlRHVyYWJsZVdlYWtNYXBTdG9yZTIsXG4gICAgcHJvdmlkZUR1cmFibGVTZXRTdG9yZTogcHJvdmlkZUR1cmFibGVTZXRTdG9yZTIsXG4gICAgcHJvdmlkZUR1cmFibGVXZWFrU2V0U3RvcmU6IHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlMlxuICB9KTtcbn07XG52YXIgZ2xvYmFsU3RvcmVVdGlscyA9IG1ha2VTdG9yZVV0aWxzKFZhdERhdGFHbG9iYWwpO1xudmFyIHtcbiAgcHJvdmlkZUR1cmFibGVNYXBTdG9yZSxcbiAgcHJvdmlkZUR1cmFibGVXZWFrTWFwU3RvcmUsXG4gIHByb3ZpZGVEdXJhYmxlU2V0U3RvcmUsXG4gIHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlXG59ID0gZ2xvYmFsU3RvcmVVdGlscztcblxuLy9cbnZhciBpZ25vcmVDb250ZXh0ID0gKGZuKSA9PiAoX2NvbnRleHQsIC4uLmFyZ3MpID0+IGZuKC4uLmFyZ3MpO1xuaGFyZGVuKGlnbm9yZUNvbnRleHQpO1xudmFyIG1ha2VFeG9VdGlscyA9IChWYXREYXRhKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBkZWZpbmVLaW5kOiBkZWZpbmVLaW5kMixcbiAgICBkZWZpbmVLaW5kTXVsdGk6IGRlZmluZUtpbmRNdWx0aTIsXG4gICAgZGVmaW5lRHVyYWJsZUtpbmQ6IGRlZmluZUR1cmFibGVLaW5kMixcbiAgICBkZWZpbmVEdXJhYmxlS2luZE11bHRpOiBkZWZpbmVEdXJhYmxlS2luZE11bHRpMixcbiAgICBtYWtlS2luZEhhbmRsZTogbWFrZUtpbmRIYW5kbGUyXG4gIH0gPSBWYXREYXRhO1xuICBjb25zdCBwcm92aWRlS2luZEhhbmRsZTIgPSAoYmFnZ2FnZSwga2luZE5hbWUpID0+IHByb3ZpZGUoYmFnZ2FnZSwgYCR7a2luZE5hbWV9X2tpbmRIYW5kbGVgLCAoKSA9PiBtYWtlS2luZEhhbmRsZTIoa2luZE5hbWUpKTtcbiAgaGFyZGVuKHByb3ZpZGVLaW5kSGFuZGxlMik7XG4gIGNvbnN0IHByZXBhcmVLaW5kMiA9IChiYWdnYWdlLCBraW5kTmFtZSwgaW5pdCwgYmVoYXZpb3IsIG9wdGlvbnMgPSB2b2lkIDApID0+IGRlZmluZUR1cmFibGVLaW5kMihcbiAgICBwcm92aWRlS2luZEhhbmRsZTIoYmFnZ2FnZSwga2luZE5hbWUpLFxuICAgIGluaXQsXG4gICAgYmVoYXZpb3IsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUtpbmQyKTtcbiAgY29uc3QgcHJlcGFyZUtpbmRNdWx0aTIgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGluaXQsIGJlaGF2aW9yLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlS2luZE11bHRpMihcbiAgICBwcm92aWRlS2luZEhhbmRsZTIoYmFnZ2FnZSwga2luZE5hbWUpLFxuICAgIGluaXQsXG4gICAgYmVoYXZpb3IsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUtpbmRNdWx0aTIpO1xuICBjb25zdCBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3MyID0gKHRhZywgaW50ZXJmYWNlR3VhcmQsIGluaXQsIG1ldGhvZHMsIG9wdGlvbnMpID0+IChcbiAgICAvL1xuICAgIGRlZmluZUtpbmQyKHRhZywgaW5pdCwgbWV0aG9kcywge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHRoaXNmdWxNZXRob2RzOiB0cnVlLFxuICAgICAgaW50ZXJmYWNlR3VhcmRcbiAgICB9KVxuICApO1xuICBoYXJkZW4oZGVmaW5lVmlydHVhbEV4b0NsYXNzMik7XG4gIGNvbnN0IGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDIgPSAodGFnLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgZmFjZXRzLCBvcHRpb25zKSA9PiAoXG4gICAgLy9cbiAgICBkZWZpbmVLaW5kTXVsdGkyKHRhZywgaW5pdCwgZmFjZXRzLCB7XG4gICAgICAuLi5vcHRpb25zLFxuICAgICAgdGhpc2Z1bE1ldGhvZHM6IHRydWUsXG4gICAgICBpbnRlcmZhY2VHdWFyZEtpdFxuICAgIH0pXG4gICk7XG4gIGhhcmRlbihkZWZpbmVWaXJ0dWFsRXhvQ2xhc3NLaXQyKTtcbiAgY29uc3QgZGVmaW5lRHVyYWJsZUV4b0NsYXNzMiA9IChraW5kSGFuZGxlLCBpbnRlcmZhY2VHdWFyZCwgaW5pdCwgbWV0aG9kcywgb3B0aW9ucykgPT4gKFxuICAgIC8vXG4gICAgZGVmaW5lRHVyYWJsZUtpbmQyKGtpbmRIYW5kbGUsIGluaXQsIG1ldGhvZHMsIHtcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgICB0aGlzZnVsTWV0aG9kczogdHJ1ZSxcbiAgICAgIGludGVyZmFjZUd1YXJkXG4gICAgfSlcbiAgKTtcbiAgaGFyZGVuKGRlZmluZUR1cmFibGVFeG9DbGFzczIpO1xuICBjb25zdCBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQyID0gKGtpbmRIYW5kbGUsIGludGVyZmFjZUd1YXJkS2l0LCBpbml0LCBmYWNldHMsIG9wdGlvbnMpID0+IChcbiAgICAvL1xuICAgIGRlZmluZUR1cmFibGVLaW5kTXVsdGkyKGtpbmRIYW5kbGUsIGluaXQsIGZhY2V0cywge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIHRoaXNmdWxNZXRob2RzOiB0cnVlLFxuICAgICAgaW50ZXJmYWNlR3VhcmRLaXRcbiAgICB9KVxuICApO1xuICBoYXJkZW4oZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0Mik7XG4gIGNvbnN0IHByZXBhcmVFeG9DbGFzczIgPSAoYmFnZ2FnZSwga2luZE5hbWUsIGludGVyZmFjZUd1YXJkLCBpbml0LCBtZXRob2RzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3MyKFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlMihiYWdnYWdlLCBraW5kTmFtZSksXG4gICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgaW5pdCxcbiAgICBtZXRob2RzLFxuICAgIG9wdGlvbnNcbiAgKTtcbiAgaGFyZGVuKHByZXBhcmVFeG9DbGFzczIpO1xuICBjb25zdCBwcmVwYXJlRXhvQ2xhc3NLaXQyID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbnRlcmZhY2VHdWFyZEtpdCwgaW5pdCwgZmFjZXRzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQyKFxuICAgIHByb3ZpZGVLaW5kSGFuZGxlMihiYWdnYWdlLCBraW5kTmFtZSksXG4gICAgaW50ZXJmYWNlR3VhcmRLaXQsXG4gICAgaW5pdCxcbiAgICBmYWNldHMsXG4gICAgb3B0aW9uc1xuICApO1xuICBoYXJkZW4ocHJlcGFyZUV4b0NsYXNzS2l0Mik7XG4gIGNvbnN0IHByZXBhcmVFeG8yID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBpbnRlcmZhY2VHdWFyZCwgbWV0aG9kcywgb3B0aW9ucyA9IHZvaWQgMCkgPT4ge1xuICAgIGNvbnN0IG1ha2VTaW5nbGV0b24gPSBwcmVwYXJlRXhvQ2xhc3MyKFxuICAgICAgYmFnZ2FnZSxcbiAgICAgIGtpbmROYW1lLFxuICAgICAgaW50ZXJmYWNlR3VhcmQsXG4gICAgICBpbml0RW1wdHksXG4gICAgICBtZXRob2RzLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gICAgcmV0dXJuIHByb3ZpZGUoYmFnZ2FnZSwgYCR7a2luZE5hbWV9X3NpbmdsZXRvbmAsICgpID0+IG1ha2VTaW5nbGV0b24oKSk7XG4gIH07XG4gIGhhcmRlbihwcmVwYXJlRXhvMik7XG4gIGNvbnN0IHByZXBhcmVTaW5nbGV0b24yID0gKGJhZ2dhZ2UsIGtpbmROYW1lLCBtZXRob2RzLCBvcHRpb25zID0gdm9pZCAwKSA9PiBwcmVwYXJlRXhvMihiYWdnYWdlLCBraW5kTmFtZSwgdm9pZCAwLCBtZXRob2RzLCBvcHRpb25zKTtcbiAgaGFyZGVuKHByZXBhcmVTaW5nbGV0b24yKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgZGVmaW5lVmlydHVhbEV4b0NsYXNzOiBkZWZpbmVWaXJ0dWFsRXhvQ2xhc3MyLFxuICAgIGRlZmluZVZpcnR1YWxFeG9DbGFzc0tpdDogZGVmaW5lVmlydHVhbEV4b0NsYXNzS2l0MixcbiAgICBkZWZpbmVEdXJhYmxlRXhvQ2xhc3M6IGRlZmluZUR1cmFibGVFeG9DbGFzczIsXG4gICAgZGVmaW5lRHVyYWJsZUV4b0NsYXNzS2l0OiBkZWZpbmVEdXJhYmxlRXhvQ2xhc3NLaXQyLFxuICAgIHByZXBhcmVFeG9DbGFzczogcHJlcGFyZUV4b0NsYXNzMixcbiAgICBwcmVwYXJlRXhvQ2xhc3NLaXQ6IHByZXBhcmVFeG9DbGFzc0tpdDIsXG4gICAgcHJlcGFyZUV4bzogcHJlcGFyZUV4bzIsXG4gICAgcHJlcGFyZVNpbmdsZXRvbjogcHJlcGFyZVNpbmdsZXRvbjIsXG4gICAgcHJvdmlkZUtpbmRIYW5kbGU6IHByb3ZpZGVLaW5kSGFuZGxlMixcbiAgICBwcmVwYXJlS2luZDogcHJlcGFyZUtpbmQyLFxuICAgIHByZXBhcmVLaW5kTXVsdGk6IHByZXBhcmVLaW5kTXVsdGkyXG4gIH0pO1xufTtcbnZhciBnbG9iYWxFeG9VdGlscyA9IG1ha2VFeG9VdGlscyhWYXREYXRhRXhwb3J0KTtcbnZhciB7XG4gIGRlZmluZVZpcnR1YWxFeG9DbGFzcyxcbiAgZGVmaW5lVmlydHVhbEV4b0NsYXNzS2l0LFxuICBkZWZpbmVEdXJhYmxlRXhvQ2xhc3MsXG4gIGRlZmluZUR1cmFibGVFeG9DbGFzc0tpdCxcbiAgcHJlcGFyZUV4b0NsYXNzLFxuICBwcmVwYXJlRXhvQ2xhc3NLaXQsXG4gIHByZXBhcmVFeG8sXG4gIHByZXBhcmVTaW5nbGV0b25cbn0gPSBnbG9iYWxFeG9VdGlscztcbnZhciB7IHByb3ZpZGVLaW5kSGFuZGxlLCBwcmVwYXJlS2luZCwgcHJlcGFyZUtpbmRNdWx0aSB9ID0gZ2xvYmFsRXhvVXRpbHM7XG5cbi8vXG52YXIgZGVmYXVsdExhYmVsVG9LZXlzID0gKGxhYmVsKSA9PiBoYXJkZW4oW2xhYmVsXSk7XG5oYXJkZW4oZGVmYXVsdExhYmVsVG9LZXlzKTtcbnZhciBtYWtlT25jZUtpdCA9IChkZWJ1Z05hbWUsIHN0b3JlcywgYmFja2luZ1N0b3JlID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IHVzZWRLZXlzID0gc3RvcmVzLmRldGFjaGVkKCkuc2V0U3RvcmUoYCR7ZGVidWdOYW1lfSB1c2VkIGtleXNgKTtcbiAgY29uc3QgYXNzZXJ0T25seU9uY2UgPSAoa2V5KSA9PiB7XG4gICAgdHlwZW9mIGtleSA9PT0gXCJzdHJpbmdcIiB8fCB0aHJvd1JlZGFjdGVkYGtleSAke2tleX0gbXVzdCBiZSBhIHN0cmluZ2A7XG4gICAgIXVzZWRLZXlzLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRga2V5ICR7a2V5fSBoYXMgYWxyZWFkeSBiZWVuIHVzZWQgaW4gdGhpcyB6b25lIGFuZCBpbmNhcm5hdGlvbmA7XG4gICAgdXNlZEtleXMuYWRkKGtleSk7XG4gIH07XG4gIGNvbnN0IHdyYXBQcm92aWRlciA9IChwcm92aWRlciwgbGFiZWxUb0tleXMgPSBkZWZhdWx0TGFiZWxUb0tleXMpID0+IHtcbiAgICBjb25zdCB3cmFwcGVyID0gKGxhYmVsLCAuLi5yZXN0KSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiBsYWJlbFRvS2V5cyhsYWJlbCkpIHtcbiAgICAgICAgYXNzZXJ0T25seU9uY2Uoa2V5KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwcm92aWRlcihsYWJlbCwgLi4ucmVzdCk7XG4gICAgfTtcbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgd3JhcHBlclxuICAgICk7XG4gIH07XG4gIGNvbnN0IG1ha2VPbmNlID0gKGtleSwgbWFrZXIpID0+IHtcbiAgICBhc3NlcnRPbmx5T25jZShrZXkpO1xuICAgIGlmIChiYWNraW5nU3RvcmUgJiYgYmFja2luZ1N0b3JlLmhhcyhrZXkpKSB7XG4gICAgICByZXR1cm4gYmFja2luZ1N0b3JlLmdldChrZXkpO1xuICAgIH1cbiAgICBjb25zdCB2YWx1ZSA9IG1ha2VyKGtleSk7XG4gICAgc3RvcmVzLmlzU3RvcmFibGUodmFsdWUpIHx8IHRocm93UmVkYWN0ZWRgbWFrZXIgcmV0dXJuIHZhbHVlICR7dmFsdWV9IGlzIG5vdCBzdG9yYWJsZWA7XG4gICAgYmFja2luZ1N0b3JlICYmIGJhY2tpbmdTdG9yZS5pbml0KGtleSwgdmFsdWUpO1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfTtcbiAgcmV0dXJuIGhhcmRlbih7IG1ha2VPbmNlLCB3cmFwUHJvdmlkZXIgfSk7XG59O1xuaGFyZGVuKG1ha2VPbmNlS2l0KTtcblxuLy9cbnZhciBraW5kID0gKGxhYmVsKSA9PiBgJHtsYWJlbH1fa2luZEhhbmRsZWA7XG52YXIgc2luZ2xldG9uID0gKGxhYmVsKSA9PiBgJHtsYWJlbH1fc2luZ2xldG9uYDtcbnZhciBhZ29yaWNWYXREYXRhS2V5cyA9IHtcbiAgZXhvQ2xhc3M6IChsYWJlbCkgPT4gaGFyZGVuKFtraW5kKGxhYmVsKV0pLFxuICBleG9DbGFzc0tpdDogKGxhYmVsKSA9PiBoYXJkZW4oW2tpbmQobGFiZWwpXSksXG4gIGV4bzogKGxhYmVsKSA9PiBoYXJkZW4oW2tpbmQobGFiZWwpLCBzaW5nbGV0b24obGFiZWwpXSksXG4gIHN0b3JlOiAobGFiZWwpID0+IGhhcmRlbihbbGFiZWxdKSxcbiAgem9uZTogKGxhYmVsKSA9PiBoYXJkZW4oW2xhYmVsXSlcbn07XG5oYXJkZW4oYWdvcmljVmF0RGF0YUtleXMpO1xuXG4vL1xudmFyIHsgYXBwbHk6IGFwcGx5NSB9ID0gUmVmbGVjdDtcbnZhciBQcm9taXNlV2F0Y2hlckhhbmRsZXIgPSBNLmNhbGwoTS5yYXcoKSkucmVzdChNLnJhdygpKS5yZXR1cm5zKCk7XG52YXIgUHJvbWlzZVdhdGNoZXJJID0gTS5pbnRlcmZhY2UoXCJQcm9taXNlV2F0Y2hlclwiLCB7XG4gIG9uRnVsZmlsbGVkOiBQcm9taXNlV2F0Y2hlckhhbmRsZXIsXG4gIG9uUmVqZWN0ZWQ6IFByb21pc2VXYXRjaGVySGFuZGxlclxufSk7XG52YXIgUHJvbWlzZVdhdGNoZXJGdWxmaWxsZWRJID0gTS5pbnRlcmZhY2UoXCJQcm9taXNlV2F0Y2hlckZ1bGZpbGxlZFwiLCB7XG4gIG9uRnVsZmlsbGVkOiBQcm9taXNlV2F0Y2hlckhhbmRsZXJcbn0pO1xudmFyIFByb21pc2VXYXRjaGVyUmVqZWN0ZWRJID0gTS5pbnRlcmZhY2UoXCJQcm9taXNlV2F0Y2hlclJlamVjdGVkXCIsIHtcbiAgb25SZWplY3RlZDogUHJvbWlzZVdhdGNoZXJIYW5kbGVyXG59KTtcbnZhciBjYWxsTWVNYXliZSA9ICh0aGF0LCBwcm9wLCBwb3N0QXJncykgPT4ge1xuICBjb25zdCBmbiA9IHRoYXRbcHJvcF07XG4gIGlmICghZm4pIHtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9XG4gIGFzc2VydC50eXBlb2YoZm4sIFwiZnVuY3Rpb25cIik7XG4gIGNvbnN0IHdyYXBwZWQgPSAoYXJnKSA9PiB7XG4gICAgYXBwbHk1KGZuLCB0aGF0LCBbYXJnLCAuLi5wb3N0QXJnc10pO1xuICB9O1xuICByZXR1cm4gd3JhcHBlZDtcbn07XG52YXIgd2F0Y2hQcm9taXNlMiA9IChwMywgd2F0Y2hlciwgLi4ud2F0Y2hlckFyZ3MpID0+IHtcbiAgUHJvbWlzZS5yZXNvbHZlKHAzKSA9PT0gcDMgfHwgdGhyb3dSZWRhY3RlZGB3YXRjaFByb21pc2Ugb25seSB3YXRjaGVzIHByb21pc2VzYDtcbiAgY29uc3Qgb25GdWxmaWxsZWQgPSBjYWxsTWVNYXliZSh3YXRjaGVyLCBcIm9uRnVsZmlsbGVkXCIsIHdhdGNoZXJBcmdzKTtcbiAgY29uc3Qgb25SZWplY3RlZCA9IGNhbGxNZU1heWJlKHdhdGNoZXIsIFwib25SZWplY3RlZFwiLCB3YXRjaGVyQXJncyk7XG4gIG9uRnVsZmlsbGVkIHx8IG9uUmVqZWN0ZWQgfHwgdGhyb3dSZWRhY3RlZGBwcm9taXNlIHdhdGNoZXIgbXVzdCBpbXBsZW1lbnQgYXQgbGVhc3Qgb25lIGhhbmRsZXIgbWV0aG9kYDtcbiAgdm9pZCBFLndoZW4ocDMsIG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKTtcbn07XG5oYXJkZW4od2F0Y2hQcm9taXNlMik7XG5cbi8vXG52YXIgaXNTdG9yYWJsZSA9IChzcGVjaW1lbikgPT4gaXNQYXNzYWJsZShzcGVjaW1lbikgJiYgY2FuQmVEdXJhYmxlKHNwZWNpbWVuKTtcbmhhcmRlbihpc1N0b3JhYmxlKTtcbnZhciBhdHRhY2hEdXJhYmxlU3RvcmVzID0gKGdldEJhZ2dhZ2UpID0+IHtcbiAgY29uc3QgbWFwU3RvcmUgPSAobGFiZWwsIG9wdGlvbnMpID0+IHtcbiAgICBjb25zdCBiYWdnYWdlID0gZ2V0QmFnZ2FnZSgpO1xuICAgIGNvbnN0IHJldCA9IHByb3ZpZGVEdXJhYmxlTWFwU3RvcmUoYmFnZ2FnZSwgbGFiZWwsIG9wdGlvbnMpO1xuICAgIHJldHVybiByZXQ7XG4gIH07XG4gIGNvbnN0IHNldFN0b3JlID0gKGxhYmVsLCBvcHRpb25zKSA9PiBwcm92aWRlRHVyYWJsZVNldFN0b3JlKGdldEJhZ2dhZ2UoKSwgbGFiZWwsIG9wdGlvbnMpO1xuICBjb25zdCB3ZWFrU2V0U3RvcmUgPSAobGFiZWwsIG9wdGlvbnMpID0+IHByb3ZpZGVEdXJhYmxlV2Vha1NldFN0b3JlKGdldEJhZ2dhZ2UoKSwgbGFiZWwsIG9wdGlvbnMpO1xuICBjb25zdCB3ZWFrTWFwU3RvcmUgPSAobGFiZWwsIG9wdGlvbnMpID0+IHByb3ZpZGVEdXJhYmxlV2Vha01hcFN0b3JlKGdldEJhZ2dhZ2UoKSwgbGFiZWwsIG9wdGlvbnMpO1xuICByZXR1cm4gRmFyKFwiZHVyYWJsZVN0b3Jlc1wiLCB7XG4gICAgZGV0YWNoZWQ6ICgpID0+IGRldGFjaGVkRHVyYWJsZVN0b3JlcyxcbiAgICBpc1N0b3JhYmxlLFxuICAgIG1hcFN0b3JlLFxuICAgIHNldFN0b3JlLFxuICAgIHdlYWtNYXBTdG9yZSxcbiAgICB3ZWFrU2V0U3RvcmVcbiAgfSk7XG59O1xudmFyIGRldGFjaGVkRHVyYWJsZVN0b3JlcyA9IGF0dGFjaER1cmFibGVTdG9yZXMoXG4gICgpID0+IG1ha2VTY2FsYXJNYXBTdG9yZShcImRldGFjaGVkXCIpXG4pO1xudmFyIG1ha2VEdXJhYmxlWm9uZSA9IChiYWdnYWdlLCBiYXNlTGFiZWwgPSBcImR1cmFibGVab25lXCIpID0+IHtcbiAgYmFnZ2FnZSB8fCB0aHJvd1JlZGFjdGVkYGJhZ2dhZ2UgcmVxdWlyZWRgO1xuICBjb25zdCBhdHRhY2hlZFN0b3JlcyA9IGF0dGFjaER1cmFibGVTdG9yZXMoKCkgPT4gYmFnZ2FnZSk7XG4gIGNvbnN0IHsgbWFrZU9uY2UsIHdyYXBQcm92aWRlciB9ID0gbWFrZU9uY2VLaXQoXG4gICAgYmFzZUxhYmVsLFxuICAgIGF0dGFjaGVkU3RvcmVzLFxuICAgIGJhZ2dhZ2VcbiAgKTtcbiAgY29uc3QgZXhvQ2xhc3MgPSAoLi4uYXJncykgPT4gcHJlcGFyZUV4b0NsYXNzKGJhZ2dhZ2UsIC4uLmFyZ3MpO1xuICBjb25zdCBleG9DbGFzc0tpdCA9ICguLi5hcmdzKSA9PiBwcmVwYXJlRXhvQ2xhc3NLaXQoYmFnZ2FnZSwgLi4uYXJncyk7XG4gIGNvbnN0IGV4byA9ICguLi5hcmdzKSA9PiBwcmVwYXJlRXhvKGJhZ2dhZ2UsIC4uLmFyZ3MpO1xuICBjb25zdCBzdWJab25lU3RvcmUgPSB3cmFwUHJvdmlkZXIoYXR0YWNoZWRTdG9yZXMubWFwU3RvcmUsIGFnb3JpY1ZhdERhdGFLZXlzLnpvbmUpO1xuICBjb25zdCBzdWJab25lID0gKGxhYmVsLCBvcHRpb25zID0ge30pID0+IHtcbiAgICBjb25zdCBzdWJCYWdnYWdlID0gc3ViWm9uZVN0b3JlKGxhYmVsLCBvcHRpb25zKTtcbiAgICByZXR1cm4gbWFrZUR1cmFibGVab25lKHN1YkJhZ2dhZ2UsIGAke2Jhc2VMYWJlbH0uJHtsYWJlbH1gKTtcbiAgfTtcbiAgcmV0dXJuIEZhcihcImR1cmFibGVab25lXCIsIHtcbiAgICBleG86IHdyYXBQcm92aWRlcihleG8sIGFnb3JpY1ZhdERhdGFLZXlzLmV4byksXG4gICAgZXhvQ2xhc3M6IHdyYXBQcm92aWRlcihleG9DbGFzcywgYWdvcmljVmF0RGF0YUtleXMuZXhvQ2xhc3MpLFxuICAgIGV4b0NsYXNzS2l0OiB3cmFwUHJvdmlkZXIoZXhvQ2xhc3NLaXQsIGFnb3JpY1ZhdERhdGFLZXlzLmV4b0NsYXNzS2l0KSxcbiAgICBzdWJab25lLFxuICAgIG1ha2VPbmNlLFxuICAgIHdhdGNoUHJvbWlzZSxcbiAgICBkZXRhY2hlZDogYXR0YWNoZWRTdG9yZXMuZGV0YWNoZWQsXG4gICAgaXNTdG9yYWJsZTogYXR0YWNoZWRTdG9yZXMuaXNTdG9yYWJsZSxcbiAgICBtYXBTdG9yZTogd3JhcFByb3ZpZGVyKGF0dGFjaGVkU3RvcmVzLm1hcFN0b3JlLCBhZ29yaWNWYXREYXRhS2V5cy5zdG9yZSksXG4gICAgc2V0U3RvcmU6IHdyYXBQcm92aWRlcihhdHRhY2hlZFN0b3Jlcy5zZXRTdG9yZSwgYWdvcmljVmF0RGF0YUtleXMuc3RvcmUpLFxuICAgIHdlYWtNYXBTdG9yZTogd3JhcFByb3ZpZGVyKGF0dGFjaGVkU3RvcmVzLndlYWtNYXBTdG9yZSwgYWdvcmljVmF0RGF0YUtleXMuc3RvcmUpLFxuICAgIHdlYWtTZXRTdG9yZTogd3JhcFByb3ZpZGVyKGF0dGFjaGVkU3RvcmVzLndlYWtTZXRTdG9yZSwgYWdvcmljVmF0RGF0YUtleXMuc3RvcmUpXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlRHVyYWJsZVpvbmUpO1xuXG4vL1xudmFyIEJyYW5kU2hhcGUgPSBNLnJlbW90YWJsZShcIkJyYW5kXCIpO1xudmFyIElzc3VlclNoYXBlID0gTS5yZW1vdGFibGUoXCJJc3N1ZXJcIik7XG52YXIgUGF5bWVudFNoYXBlID0gTS5yZW1vdGFibGUoXCJQYXltZW50XCIpO1xudmFyIFB1cnNlU2hhcGUgPSBNLnJlbW90YWJsZShcIlB1cnNlXCIpO1xudmFyIERlcG9zaXRGYWNldFNoYXBlID0gTS5yZW1vdGFibGUoXCJEZXBvc2l0RmFjZXRcIik7XG52YXIgTm90aWZpZXJTaGFwZSA9IE0ucmVtb3RhYmxlKFwiTm90aWZpZXJcIik7XG52YXIgTWludFNoYXBlID0gTS5yZW1vdGFibGUoXCJNaW50XCIpO1xudmFyIE5hdFZhbHVlU2hhcGUgPSBNLm5hdCgpO1xudmFyIENvcHlTZXRWYWx1ZVNoYXBlID0gTS5zZXQoKTtcbnZhciBTZXRWYWx1ZVNoYXBlID0gTS5hcnJheU9mKE0ua2V5KCkpO1xudmFyIENvcHlCYWdWYWx1ZVNoYXBlID0gTS5iYWcoKTtcbnZhciBBbW91bnRWYWx1ZVNoYXBlID0gTS5vcihcbiAgTmF0VmFsdWVTaGFwZSxcbiAgQ29weVNldFZhbHVlU2hhcGUsXG4gIFNldFZhbHVlU2hhcGUsXG4gIENvcHlCYWdWYWx1ZVNoYXBlXG4pO1xudmFyIEFtb3VudFNoYXBlID0geyBicmFuZDogQnJhbmRTaGFwZSwgdmFsdWU6IEFtb3VudFZhbHVlU2hhcGUgfTtcbmhhcmRlbihBbW91bnRTaGFwZSk7XG52YXIgQW1vdW50UGF0dGVyblNoYXBlID0gTS5wYXR0ZXJuKCk7XG52YXIgUmF0aW9TaGFwZSA9IHsgbnVtZXJhdG9yOiBBbW91bnRTaGFwZSwgZGVub21pbmF0b3I6IEFtb3VudFNoYXBlIH07XG5oYXJkZW4oUmF0aW9TaGFwZSk7XG52YXIgaXNOYXRWYWx1ZSA9ICh2YWx1ZSkgPT4gbWF0Y2hlcyh2YWx1ZSwgTmF0VmFsdWVTaGFwZSk7XG5oYXJkZW4oaXNOYXRWYWx1ZSk7XG52YXIgaXNDb3B5U2V0VmFsdWUgPSAodmFsdWUpID0+IG1hdGNoZXModmFsdWUsIENvcHlTZXRWYWx1ZVNoYXBlKTtcbmhhcmRlbihpc0NvcHlTZXRWYWx1ZSk7XG52YXIgaXNTZXRWYWx1ZSA9ICh2YWx1ZSkgPT4gbWF0Y2hlcyh2YWx1ZSwgU2V0VmFsdWVTaGFwZSk7XG5oYXJkZW4oaXNTZXRWYWx1ZSk7XG52YXIgaXNDb3B5QmFnVmFsdWUgPSAodmFsdWUpID0+IG1hdGNoZXModmFsdWUsIENvcHlCYWdWYWx1ZVNoYXBlKTtcbmhhcmRlbihpc0NvcHlCYWdWYWx1ZSk7XG52YXIgTUFYX0FCU09MVVRFX0RFQ0lNQUxfUExBQ0VTID0gMTAwO1xudmFyIEFzc2V0S2luZFNoYXBlID0gTS5vcihcIm5hdFwiLCBcInNldFwiLCBcImNvcHlTZXRcIiwgXCJjb3B5QmFnXCIpO1xudmFyIERpc3BsYXlJbmZvU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7fSxcbiAge1xuICAgIGRlY2ltYWxQbGFjZXM6IE0uYW5kKFxuICAgICAgTS5ndGUoLU1BWF9BQlNPTFVURV9ERUNJTUFMX1BMQUNFUyksXG4gICAgICBNLmx0ZShNQVhfQUJTT0xVVEVfREVDSU1BTF9QTEFDRVMpXG4gICAgKSxcbiAgICBhc3NldEtpbmQ6IEFzc2V0S2luZFNoYXBlXG4gIH0sXG4gIHtcbiAgICAvL1xuICAgIC8vXG4gIH1cbik7XG52YXIgSXNzdWVyS2l0U2hhcGUgPSB7XG4gIGJyYW5kOiBCcmFuZFNoYXBlLFxuICBtaW50OiBNaW50U2hhcGUsXG4gIG1pbnRSZWNvdmVyeVB1cnNlOiBQdXJzZVNoYXBlLFxuICBpc3N1ZXI6IElzc3VlclNoYXBlLFxuICBkaXNwbGF5SW5mbzogRGlzcGxheUluZm9TaGFwZVxufTtcbmhhcmRlbihJc3N1ZXJLaXRTaGFwZSk7XG52YXIgQnJhbmRJID0gTS5pbnRlcmZhY2UoXCJCcmFuZFwiLCB7XG4gIGlzTXlJc3N1ZXI6IE0uY2FsbFdoZW4oTS5hd2FpdChJc3N1ZXJTaGFwZSkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICBnZXRBbGxlZ2VkTmFtZTogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgZ2V0RGlzcGxheUluZm86IE0uY2FsbCgpLnJldHVybnMoRGlzcGxheUluZm9TaGFwZSksXG4gIGdldEFtb3VudFNoYXBlOiBNLmNhbGwoKS5yZXR1cm5zKE0ucGF0dGVybigpKVxufSk7XG52YXIgbWFrZUlzc3VlckludGVyZmFjZXMgPSAoYnJhbmRTaGFwZSA9IEJyYW5kU2hhcGUsIGFzc2V0S2luZFNoYXBlID0gQXNzZXRLaW5kU2hhcGUsIGFtb3VudFNoYXBlID0gQW1vdW50U2hhcGUpID0+IHtcbiAgY29uc3QgSXNzdWVySSA9IE0uaW50ZXJmYWNlKFwiSXNzdWVyXCIsIHtcbiAgICBnZXRCcmFuZDogTS5jYWxsKCkucmV0dXJucyhicmFuZFNoYXBlKSxcbiAgICBnZXRBbGxlZ2VkTmFtZTogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgICBnZXRBc3NldEtpbmQ6IE0uY2FsbCgpLnJldHVybnMoYXNzZXRLaW5kU2hhcGUpLFxuICAgIGdldERpc3BsYXlJbmZvOiBNLmNhbGwoKS5yZXR1cm5zKERpc3BsYXlJbmZvU2hhcGUpLFxuICAgIG1ha2VFbXB0eVB1cnNlOiBNLmNhbGwoKS5yZXR1cm5zKFB1cnNlU2hhcGUpLFxuICAgIGlzTGl2ZTogTS5jYWxsV2hlbihNLmF3YWl0KFBheW1lbnRTaGFwZSkpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICAgIGdldEFtb3VudE9mOiBNLmNhbGxXaGVuKE0uYXdhaXQoUGF5bWVudFNoYXBlKSkucmV0dXJucyhhbW91bnRTaGFwZSksXG4gICAgYnVybjogTS5jYWxsV2hlbihNLmF3YWl0KFBheW1lbnRTaGFwZSkpLm9wdGlvbmFsKEFtb3VudFBhdHRlcm5TaGFwZSkucmV0dXJucyhhbW91bnRTaGFwZSlcbiAgfSk7XG4gIGNvbnN0IE1pbnRJID0gTS5pbnRlcmZhY2UoXCJNaW50XCIsIHtcbiAgICBnZXRJc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUpLFxuICAgIG1pbnRQYXltZW50OiBNLmNhbGwoYW1vdW50U2hhcGUpLnJldHVybnMoUGF5bWVudFNoYXBlKVxuICB9KTtcbiAgY29uc3QgUGF5bWVudEkgPSBNLmludGVyZmFjZShcIlBheW1lbnRcIiwge1xuICAgIGdldEFsbGVnZWRCcmFuZDogTS5jYWxsKCkucmV0dXJucyhicmFuZFNoYXBlKVxuICB9KTtcbiAgY29uc3QgUHVyc2VJID0gTS5pbnRlcmZhY2UoXCJQdXJzZVwiLCB7XG4gICAgZ2V0QWxsZWdlZEJyYW5kOiBNLmNhbGwoKS5yZXR1cm5zKGJyYW5kU2hhcGUpLFxuICAgIGdldEN1cnJlbnRBbW91bnQ6IE0uY2FsbCgpLnJldHVybnMoYW1vdW50U2hhcGUpLFxuICAgIGdldEN1cnJlbnRBbW91bnROb3RpZmllcjogTS5jYWxsKCkucmV0dXJucyhOb3RpZmllclNoYXBlKSxcbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIGRlcG9zaXQ6IE0uY2FsbChQYXltZW50U2hhcGUpLm9wdGlvbmFsKEFtb3VudFBhdHRlcm5TaGFwZSkucmV0dXJucyhhbW91bnRTaGFwZSksXG4gICAgZ2V0RGVwb3NpdEZhY2V0OiBNLmNhbGwoKS5yZXR1cm5zKERlcG9zaXRGYWNldFNoYXBlKSxcbiAgICB3aXRoZHJhdzogTS5jYWxsKGFtb3VudFNoYXBlKS5yZXR1cm5zKFBheW1lbnRTaGFwZSksXG4gICAgZ2V0UmVjb3ZlcnlTZXQ6IE0uY2FsbCgpLnJldHVybnMoTS5zZXRPZihQYXltZW50U2hhcGUpKSxcbiAgICByZWNvdmVyQWxsOiBNLmNhbGwoKS5yZXR1cm5zKGFtb3VudFNoYXBlKVxuICB9KTtcbiAgY29uc3QgRGVwb3NpdEZhY2V0SSA9IE0uaW50ZXJmYWNlKFwiRGVwb3NpdEZhY2V0XCIsIHtcbiAgICByZWNlaXZlOiBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoUHVyc2VJKS5tZXRob2RHdWFyZHMuZGVwb3NpdFxuICB9KTtcbiAgY29uc3QgUHVyc2VJS2l0ID0ge1xuICAgIHB1cnNlOiBQdXJzZUksXG4gICAgZGVwb3NpdEZhY2V0OiBEZXBvc2l0RmFjZXRJXG4gIH07XG4gIGhhcmRlbihQdXJzZUlLaXQpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBJc3N1ZXJJLFxuICAgIE1pbnRJLFxuICAgIFBheW1lbnRJLFxuICAgIFB1cnNlSUtpdFxuICB9KTtcbn07XG5oYXJkZW4obWFrZUlzc3VlckludGVyZmFjZXMpO1xuXG4vL1xudmFyIGNvZXJjZURpc3BsYXlJbmZvID0gKGFsbGVnZWREaXNwbGF5SW5mbywgYXNzZXRLaW5kKSA9PiB7XG4gIG11c3RNYXRjaDIoYWxsZWdlZERpc3BsYXlJbmZvLCBEaXNwbGF5SW5mb1NoYXBlLCBcImRpc3BsYXlJbmZvXCIpO1xuICBpZiAoYWxsZWdlZERpc3BsYXlJbmZvLmFzc2V0S2luZCAhPT0gdm9pZCAwKSB7XG4gICAgYWxsZWdlZERpc3BsYXlJbmZvLmFzc2V0S2luZCA9PT0gYXNzZXRLaW5kIHx8IHRocm93UmVkYWN0ZWRgZGlzcGxheUluZm8uYXNzZXRLaW5kIHdhcyBwcmVzZW50ICgke2FsbGVnZWREaXNwbGF5SW5mby5hc3NldEtpbmR9KSBhbmQgZGlkIG5vdCBtYXRjaCB0aGUgYXNzZXRLaW5kIGFyZ3VtZW50ICgke2Fzc2V0S2luZH0pYDtcbiAgfVxuICBjb25zdCBkaXNwbGF5SW5mbyA9IGhhcmRlbih7IC4uLmFsbGVnZWREaXNwbGF5SW5mbywgYXNzZXRLaW5kIH0pO1xuICBpZiAoZGlzcGxheUluZm8uZGVjaW1hbFBsYWNlcyAhPT0gdm9pZCAwKSB7XG4gICAgTnVtYmVyLmlzU2FmZUludGVnZXIoZGlzcGxheUluZm8uZGVjaW1hbFBsYWNlcykgfHwgdGhyb3dSZWRhY3RlZGBkZWNpbWFsUGxhY2VzICR7ZGlzcGxheUluZm8uZGVjaW1hbFBsYWNlc30gaXMgbm90IGEgc2FmZSBpbnRlZ2VyYDtcbiAgfVxuICByZXR1cm4gZGlzcGxheUluZm87XG59O1xuXG4vL1xudmFyIHByZXBhcmVQYXltZW50S2luZCA9IChpc3N1ZXJab25lLCBuYW1lLCBicmFuZCwgUGF5bWVudEkpID0+IHtcbiAgY29uc3QgbWFrZVBheW1lbnQgPSBpc3N1ZXJab25lLmV4b0NsYXNzKFxuICAgIGAke25hbWV9IHBheW1lbnRgLFxuICAgIFBheW1lbnRJLFxuICAgIGluaXRFbXB0eSxcbiAgICB7XG4gICAgICBnZXRBbGxlZ2VkQnJhbmQoKSB7XG4gICAgICAgIHJldHVybiBicmFuZDtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlUGF5bWVudDtcbn07XG5oYXJkZW4ocHJlcGFyZVBheW1lbnRLaW5kKTtcblxuLy9cbnZhciBzaW5rID0gKCkgPT4ge1xufTtcbnZhciBtYWtlUXVpZXRSZWplY3Rpb24gPSAocmVhc29uKSA9PiB7XG4gIGNvbnN0IHJlamVjdGlvbiA9IGhhcmRlbihQcm9taXNlLnJlamVjdChyZWFzb24pKTtcbiAgdm9pZCBFLndoZW4ocmVqZWN0aW9uLCBzaW5rLCBzaW5rKTtcbiAgcmV0dXJuIHJlamVjdGlvbjtcbn07XG52YXIgdG9vRmFyUmVqZWN0aW9uID0gbWFrZVF1aWV0UmVqZWN0aW9uKFxuICBoYXJkZW4oRXJyb3IoXCJDYW5ub3QgcmVhZCBwYXN0IGVuZCBvZiBpdGVyYXRpb24uXCIpKVxuKTtcbnZhciBQdWJsaXNoZXJJID0gTS5pbnRlcmZhY2UoXCJQdWJsaXNoZXJcIiwge1xuICBwdWJsaXNoOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpLFxuICBmaW5pc2g6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKCksXG4gIGZhaWw6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKClcbn0pO1xudmFyIFVwZGF0ZUNvdW50U2hhcGUgPSBNLm9yKE0uYmlnaW50KCksIE0ubnVtYmVyKCkpO1xudmFyIFN1YnNjcmliZXJJID0gTS5pbnRlcmZhY2UoXCJTdWJzY3JpYmVyXCIsIHtcbiAgc3Vic2NyaWJlQWZ0ZXI6IE0uY2FsbCgpLm9wdGlvbmFsKE0uYmlnaW50KCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBnZXRVcGRhdGVTaW5jZTogTS5jYWxsKCkub3B0aW9uYWwoVXBkYXRlQ291bnRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSlcbn0pO1xudmFyIHB1Ymxpc2hLaXRJS2l0ID0gaGFyZGVuKHtcbiAgcHVibGlzaGVyOiBQdWJsaXNoZXJJLFxuICBzdWJzY3JpYmVyOiBTdWJzY3JpYmVySVxufSk7XG52YXIgRm9ya2FibGVBc3luY0l0ZXJhYmxlSXRlcmF0b3JTaGFwZSA9IE0uaW50ZXJmYWNlKFxuICBcIkZvcmthYmxlQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXCIsXG4gIHtcbiAgICBmb3JrOiBNLmNhbGwoKS5yZXR1cm5zKE0uYW55KCkpLFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06IE0uY2FsbCgpLnJldHVybnMoTS5hbnkoKSksXG4gICAgLy9cbiAgICBuZXh0OiBNLmNhbGxXaGVuKCkucmV0dXJucyhNLmFueSgpKVxuICB9XG4pO1xudmFyIEl0ZXJhYmxlRWFjaFRvcGljSSA9IE0uaW50ZXJmYWNlKFwiSXRlcmFibGVFYWNoVG9waWNcIiwge1xuICBzdWJzY3JpYmVBZnRlcjogZ2V0SW50ZXJmYWNlR3VhcmRQYXlsb2FkKFN1YnNjcmliZXJJKS5tZXRob2RHdWFyZHMuc3Vic2NyaWJlQWZ0ZXIsXG4gIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06IE0uY2FsbCgpLnJldHVybnMoXG4gICAgTS5yZW1vdGFibGUoXCJGb3JrYWJsZUFzeW5jSXRlcmFibGVJdGVyYXRvclwiKVxuICApXG59KTtcbnZhciBJdGVyYWJsZUxhdGVzdFRvcGljSSA9IE0uaW50ZXJmYWNlKFwiSXRlcmFibGVMYXRlc3RUb3BpY1wiLCB7XG4gIGdldFVwZGF0ZVNpbmNlOiBnZXRJbnRlcmZhY2VHdWFyZFBheWxvYWQoU3Vic2NyaWJlckkpLm1ldGhvZEd1YXJkcy5nZXRVcGRhdGVTaW5jZSxcbiAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogTS5jYWxsKCkucmV0dXJucyhcbiAgICBNLnJlbW90YWJsZShcIkZvcmthYmxlQXN5bmNJdGVyYWJsZUl0ZXJhdG9yXCIpXG4gIClcbn0pO1xudmFyIHdlYWtNZW1vaXplVW5hcnkgPSAoZm4pID0+IHtcbiAgY29uc3QgY2FjaGUgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgcmV0dXJuIChhcmcpID0+IHtcbiAgICBjb25zdCBvYXJnID0gYXJnO1xuICAgIGlmIChjYWNoZS5oYXMob2FyZykpIHtcbiAgICAgIHJldHVybiBjYWNoZS5nZXQob2FyZyk7XG4gICAgfVxuICAgIGNvbnN0IHJlc3VsdCA9IGZuKGFyZyk7XG4gICAgY2FjaGUuc2V0KG9hcmcsIHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbn07XG52YXIgbWFrZVVwZGF0ZVJlY29yZEZyb21QdWJsaWNhdGlvblJlY29yZCA9IChyZWNvcmQpID0+IHtcbiAgY29uc3Qge1xuICAgIGhlYWQ6IHsgdmFsdWUsIGRvbmUgfSxcbiAgICBwdWJsaXNoQ291bnRcbiAgfSA9IHJlY29yZDtcbiAgaWYgKGRvbmUpIHtcbiAgICByZXR1cm4gaGFyZGVuKHsgdmFsdWUsIHVwZGF0ZUNvdW50OiB2b2lkIDAgfSk7XG4gIH1cbiAgcmV0dXJuIGhhcmRlbih7IHZhbHVlLCB1cGRhdGVDb3VudDogcHVibGlzaENvdW50IH0pO1xufTtcbnZhciBtYWtlUHVibGlzaEtpdCA9ICgpID0+IHtcbiAgbGV0IHRhaWxQO1xuICBsZXQgdGFpbFI7XG4gICh7IHByb21pc2U6IHRhaWxQLCByZXNvbHZlOiB0YWlsUiB9ID0gbWFrZVByb21pc2VLaXQoKSk7XG4gIGxldCBjdXJyZW50UHVibGlzaENvdW50ID0gMG47XG4gIGxldCBjdXJyZW50UCA9IHRhaWxQO1xuICBjb25zdCBhZHZhbmNlQ3VycmVudCA9IChkb25lLCB2YWx1ZSwgcmVqZWN0aW9uKSA9PiB7XG4gICAgaWYgKHRhaWxSID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHVwZGF0ZSBzdGF0ZSBhZnRlciB0ZXJtaW5hdGlvbi5cIik7XG4gICAgfVxuICAgIGN1cnJlbnRQdWJsaXNoQ291bnQgKz0gMW47XG4gICAgY3VycmVudFAgPSB0YWlsUDtcbiAgICBjb25zdCByZXNvbHZlQ3VycmVudCA9IHRhaWxSO1xuICAgIGlmIChkb25lKSB7XG4gICAgICB0YWlsUCA9IHRvb0ZhclJlamVjdGlvbjtcbiAgICAgIHRhaWxSID0gdm9pZCAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAoeyBwcm9taXNlOiB0YWlsUCwgcmVzb2x2ZTogdGFpbFIgfSA9IG1ha2VQcm9taXNlS2l0KCkpO1xuICAgIH1cbiAgICBpZiAocmVqZWN0aW9uKSB7XG4gICAgICByZXNvbHZlQ3VycmVudChyZWplY3Rpb24pO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNvbHZlQ3VycmVudChcbiAgICAgICAgaGFyZGVuKHtcbiAgICAgICAgICBoZWFkOiB7IHZhbHVlLCBkb25lIH0sXG4gICAgICAgICAgcHVibGlzaENvdW50OiBjdXJyZW50UHVibGlzaENvdW50LFxuICAgICAgICAgIHRhaWw6IHRhaWxQXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgbWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkID0gd2Vha01lbW9pemVVbmFyeShcbiAgICBtYWtlVXBkYXRlUmVjb3JkRnJvbVB1YmxpY2F0aW9uUmVjb3JkXG4gICk7XG4gIGNvbnN0IHN1YnNjcmliZXIgPSBGYXIoXCJTdWJzY3JpYmVyXCIsIHtcbiAgICBzdWJzY3JpYmVBZnRlcjogKHB1Ymxpc2hDb3VudCA9IC0xbikgPT4ge1xuICAgICAgYXNzZXJ0LnR5cGVvZihwdWJsaXNoQ291bnQsIFwiYmlnaW50XCIpO1xuICAgICAgaWYgKHB1Ymxpc2hDb3VudCA9PT0gY3VycmVudFB1Ymxpc2hDb3VudCkge1xuICAgICAgICByZXR1cm4gdGFpbFA7XG4gICAgICB9IGVsc2UgaWYgKHB1Ymxpc2hDb3VudCA8IGN1cnJlbnRQdWJsaXNoQ291bnQpIHtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnRQO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgXCJzdWJzY3JpYmVBZnRlciBhcmd1bWVudCBtdXN0IGJlIGEgcHJldmlvdXNseS1pc3N1ZWQgcHVibGlzaENvdW50LlwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcbiAgICBnZXRVcGRhdGVTaW5jZTogKHVwZGF0ZUNvdW50KSA9PiB7XG4gICAgICBpZiAodXBkYXRlQ291bnQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcigpLnRoZW4obWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkKTtcbiAgICAgIH1cbiAgICAgIHVwZGF0ZUNvdW50ID0gQmlnSW50KHVwZGF0ZUNvdW50KTtcbiAgICAgIHJldHVybiBzdWJzY3JpYmVyLnN1YnNjcmliZUFmdGVyKHVwZGF0ZUNvdW50KS50aGVuKCgpID0+IHN1YnNjcmliZXIuZ2V0VXBkYXRlU2luY2UoKSk7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgcHVibGlzaGVyID0gRmFyKFwiUHVibGlzaGVyXCIsIHtcbiAgICBwdWJsaXNoOiAodmFsdWUpID0+IHtcbiAgICAgIGFkdmFuY2VDdXJyZW50KGZhbHNlLCB2YWx1ZSk7XG4gICAgfSxcbiAgICBmaW5pc2g6IChmaW5hbFZhbHVlKSA9PiB7XG4gICAgICBhZHZhbmNlQ3VycmVudCh0cnVlLCBmaW5hbFZhbHVlKTtcbiAgICB9LFxuICAgIGZhaWw6IChyZWFzb24pID0+IHtcbiAgICAgIGFkdmFuY2VDdXJyZW50KHRydWUsIHZvaWQgMCwgbWFrZVF1aWV0UmVqZWN0aW9uKHJlYXNvbikpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBoYXJkZW4oeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSk7XG59O1xuaGFyZGVuKG1ha2VQdWJsaXNoS2l0KTtcbnZhciBEdXJhYmxlUHVibGlzaEtpdFN0YXRlU2hhcGUgPSBoYXJkZW4oe1xuICB2YWx1ZUR1cmFiaWxpdHk6IE0uYW55KCksXG4gIHB1Ymxpc2hDb3VudDogTS5hbnkoKSxcbiAgc3RhdHVzOiBNLmFueSgpLFxuICBoYXNWYWx1ZTogTS5hbnkoKSxcbiAgdmFsdWU6IE0uYW55KClcbn0pO1xudmFyIGluaXREdXJhYmxlUHVibGlzaEtpdFN0YXRlID0gKG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IHZhbHVlRHVyYWJpbGl0eSA9IFwibWFuZGF0b3J5XCIgfSA9IG9wdGlvbnM7XG4gIGFzc2VydC5lcXVhbCh2YWx1ZUR1cmFiaWxpdHksIFwibWFuZGF0b3J5XCIpO1xuICByZXR1cm4ge1xuICAgIC8vXG4gICAgdmFsdWVEdXJhYmlsaXR5LFxuICAgIC8vXG4gICAgcHVibGlzaENvdW50OiAwbixcbiAgICBzdGF0dXM6IFwibGl2ZVwiLFxuICAgIC8vXG4gICAgLy9cbiAgICAvL1xuICAgIC8vXG4gICAgaGFzVmFsdWU6IGZhbHNlLFxuICAgIHZhbHVlOiB2b2lkIDBcbiAgfTtcbn07XG52YXIgZ2V0RXBoZW1lcmFsS2V5ID0gKGZhY2V0cykgPT4gZmFjZXRzLnB1Ymxpc2hlcjtcbnZhciBkdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbnZhciBwcm92aWRlQ3VycmVudFAgPSAoc3RhdGUsIGZhY2V0cywgdGFpbCkgPT4ge1xuICBjb25zdCBlcGhlbWVyYWxLZXkgPSBnZXRFcGhlbWVyYWxLZXkoZmFjZXRzKTtcbiAgY29uc3QgZm91bmREYXRhID0gZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhLmdldChlcGhlbWVyYWxLZXkpO1xuICBjb25zdCBjdXJyZW50UCA9IGZvdW5kRGF0YSAmJiBmb3VuZERhdGEuY3VycmVudFA7XG4gIGlmIChjdXJyZW50UCkge1xuICAgIHJldHVybiBjdXJyZW50UDtcbiAgfVxuICBjb25zdCB7IHB1Ymxpc2hDb3VudCwgc3RhdHVzLCBoYXNWYWx1ZSwgdmFsdWUgfSA9IHN0YXRlO1xuICBpZiAoIWhhc1ZhbHVlKSB7XG4gICAgYXNzZXJ0KHN0YXR1cyA9PT0gXCJsaXZlXCIpO1xuICAgIHJldHVybiB0YWlsO1xuICB9XG4gIGlmIChzdGF0dXMgPT09IFwibGl2ZVwiIHx8IHN0YXR1cyA9PT0gXCJmaW5pc2hlZFwiKSB7XG4gICAgY29uc3QgY2VsbCA9IGhhcmRlbih7XG4gICAgICBoZWFkOiB7IHZhbHVlLCBkb25lOiBzdGF0dXMgIT09IFwibGl2ZVwiIH0sXG4gICAgICBwdWJsaXNoQ291bnQsXG4gICAgICB0YWlsXG4gICAgfSk7XG4gICAgcmV0dXJuIEUucmVzb2x2ZShjZWxsKTtcbiAgfSBlbHNlIGlmIChzdGF0dXMgPT09IFwiZmFpbGVkXCIpIHtcbiAgICByZXR1cm4gbWFrZVF1aWV0UmVqZWN0aW9uKHZhbHVlKTtcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEludmFsaWQgZHVyYWJsZSBwcm9taXNlIGtpdCBzdGF0dXM6ICR7cXVvdGUoc3RhdHVzKX1gO1xuICB9XG59O1xudmFyIHByb3ZpZGVEdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEgPSAoc3RhdGUsIGZhY2V0cykgPT4ge1xuICBjb25zdCBlcGhlbWVyYWxLZXkgPSBnZXRFcGhlbWVyYWxLZXkoZmFjZXRzKTtcbiAgY29uc3QgZm91bmREYXRhID0gZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhLmdldChlcGhlbWVyYWxLZXkpO1xuICBpZiAoZm91bmREYXRhKSB7XG4gICAgcmV0dXJuIGZvdW5kRGF0YTtcbiAgfVxuICBjb25zdCB7IHN0YXR1cyB9ID0gc3RhdGU7XG4gIGxldCB0YWlsUDtcbiAgbGV0IHRhaWxSO1xuICBpZiAoc3RhdHVzID09PSBcImxpdmVcIikge1xuICAgICh7IHByb21pc2U6IHRhaWxQLCByZXNvbHZlOiB0YWlsUiB9ID0gbWFrZVByb21pc2VLaXQoKSk7XG4gICAgdm9pZCBFLndoZW4odGFpbFAsIHNpbmssIHNpbmspO1xuICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gXCJmaW5pc2hlZFwiIHx8IHN0YXR1cyA9PT0gXCJmYWlsZWRcIikge1xuICAgIHRhaWxQID0gdG9vRmFyUmVqZWN0aW9uO1xuICB9IGVsc2Uge1xuICAgIHRocm93IHRocm93UmVkYWN0ZWRgSW52YWxpZCBkdXJhYmxlIHByb21pc2Uga2l0IHN0YXR1czogJHtxdW90ZShzdGF0dXMpfWA7XG4gIH1cbiAgY29uc3Qgb2JqID0gaGFyZGVuKHsgY3VycmVudFA6IHZvaWQgMCwgdGFpbFAsIHRhaWxSIH0pO1xuICBkdXJhYmxlUHVibGlzaEtpdEVwaGVtZXJhbERhdGEuc2V0KGVwaGVtZXJhbEtleSwgb2JqKTtcbiAgcmV0dXJuIG9iajtcbn07XG52YXIgYWR2YW5jZUR1cmFibGVQdWJsaXNoS2l0ID0gKGNvbnRleHQsIHZhbHVlLCB0YXJnZXRTdGF0dXMgPSBcImxpdmVcIikgPT4ge1xuICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IGNvbnRleHQ7XG4gIGNvbnN0IHsgdmFsdWVEdXJhYmlsaXR5LCBzdGF0dXMgfSA9IHN0YXRlO1xuICBpZiAoc3RhdHVzICE9PSBcImxpdmVcIikge1xuICAgIHRocm93IEVycm9yKFwiQ2Fubm90IHVwZGF0ZSBzdGF0ZSBhZnRlciB0ZXJtaW5hdGlvbi5cIik7XG4gIH1cbiAgY29uc3QgZG9uZSA9IHRhcmdldFN0YXR1cyAhPT0gXCJsaXZlXCI7XG4gIGlmIChkb25lIHx8IHZhbHVlRHVyYWJpbGl0eSA9PT0gXCJtYW5kYXRvcnlcIikge1xuICAgIGNhbkJlRHVyYWJsZSh2YWx1ZSkgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgYWNjZXB0IG5vbi1kdXJhYmxlIHZhbHVlOiAke3ZhbHVlfWA7XG4gIH1cbiAgY29uc3QgeyB0YWlsUDogb2xkVGFpbFAsIHRhaWxSOiByZXNvbHZlT2xkVGFpbCB9ID0gcHJvdmlkZUR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YShzdGF0ZSwgZmFjZXRzKTtcbiAgYXNzZXJ0LnR5cGVvZihyZXNvbHZlT2xkVGFpbCwgXCJmdW5jdGlvblwiKTtcbiAgY29uc3QgcHVibGlzaENvdW50ID0gc3RhdGUucHVibGlzaENvdW50ICsgMW47XG4gIHN0YXRlLnB1Ymxpc2hDb3VudCA9IHB1Ymxpc2hDb3VudDtcbiAgbGV0IHRhaWxQO1xuICBsZXQgdGFpbFI7XG4gIGlmIChkb25lKSB7XG4gICAgc3RhdGUuc3RhdHVzID0gdGFyZ2V0U3RhdHVzO1xuICAgIHRhaWxQID0gdG9vRmFyUmVqZWN0aW9uO1xuICAgIHRhaWxSID0gdm9pZCAwO1xuICB9IGVsc2Uge1xuICAgICh7IHByb21pc2U6IHRhaWxQLCByZXNvbHZlOiB0YWlsUiB9ID0gbWFrZVByb21pc2VLaXQoKSk7XG4gICAgdm9pZCBFLndoZW4odGFpbFAsIHNpbmssIHNpbmspO1xuICB9XG4gIGxldCBjdXJyZW50UDtcbiAgaWYgKHRhcmdldFN0YXR1cyA9PT0gXCJmYWlsZWRcIikge1xuICAgIHN0YXRlLmhhc1ZhbHVlID0gdHJ1ZTtcbiAgICBzdGF0ZS52YWx1ZSA9IHZhbHVlO1xuICAgIGNvbnN0IHJlamVjdGlvbiA9IG1ha2VRdWlldFJlamVjdGlvbih2YWx1ZSk7XG4gICAgcmVzb2x2ZU9sZFRhaWwocmVqZWN0aW9uKTtcbiAgfSBlbHNlIHtcbiAgICBpZiAoZG9uZSB8fCB2YWx1ZUR1cmFiaWxpdHkgIT09IFwiaWdub3JlZFwiICYmIGNhbkJlRHVyYWJsZSh2YWx1ZSkpIHtcbiAgICAgIHN0YXRlLmhhc1ZhbHVlID0gdHJ1ZTtcbiAgICAgIHN0YXRlLnZhbHVlID0gdmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0YXRlLmhhc1ZhbHVlID0gZmFsc2U7XG4gICAgICBzdGF0ZS52YWx1ZSA9IHZvaWQgMDtcbiAgICAgIGN1cnJlbnRQID0gb2xkVGFpbFA7XG4gICAgfVxuICAgIHJlc29sdmVPbGRUYWlsKFxuICAgICAgaGFyZGVuKHtcbiAgICAgICAgaGVhZDogeyB2YWx1ZSwgZG9uZSB9LFxuICAgICAgICBwdWJsaXNoQ291bnQsXG4gICAgICAgIHRhaWw6IHRhaWxQXG4gICAgICB9KVxuICAgICk7XG4gIH1cbiAgZHVyYWJsZVB1Ymxpc2hLaXRFcGhlbWVyYWxEYXRhLnNldChcbiAgICBnZXRFcGhlbWVyYWxLZXkoZmFjZXRzKSxcbiAgICBoYXJkZW4oeyBjdXJyZW50UCwgdGFpbFAsIHRhaWxSIH0pXG4gICk7XG59O1xudmFyIHByZXBhcmVEdXJhYmxlUHVibGlzaEtpdCA9IChiYWdnYWdlLCBraW5kTmFtZSkgPT4ge1xuICBjb25zdCBtYWtlTWVtb2l6ZWRVcGRhdGVSZWNvcmQgPSBtYWtlVXBkYXRlUmVjb3JkRnJvbVB1YmxpY2F0aW9uUmVjb3JkO1xuICByZXR1cm4gcHJlcGFyZUV4b0NsYXNzS2l0KFxuICAgIGJhZ2dhZ2UsXG4gICAga2luZE5hbWUsXG4gICAgcHVibGlzaEtpdElLaXQsXG4gICAgaW5pdER1cmFibGVQdWJsaXNoS2l0U3RhdGUsXG4gICAge1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICBwdWJsaXNoZXI6IHtcbiAgICAgICAgcHVibGlzaCh2YWx1ZSkge1xuICAgICAgICAgIGFkdmFuY2VEdXJhYmxlUHVibGlzaEtpdCh0aGlzLCB2YWx1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIGZpbmlzaChmaW5hbFZhbHVlKSB7XG4gICAgICAgICAgYWR2YW5jZUR1cmFibGVQdWJsaXNoS2l0KHRoaXMsIGZpbmFsVmFsdWUsIFwiZmluaXNoZWRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIGZhaWwocmVhc29uKSB7XG4gICAgICAgICAgYWR2YW5jZUR1cmFibGVQdWJsaXNoS2l0KHRoaXMsIHJlYXNvbiwgXCJmYWlsZWRcIik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIHN1YnNjcmliZXI6IHtcbiAgICAgICAgc3Vic2NyaWJlQWZ0ZXIocHVibGlzaENvdW50ID0gLTFuKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgIGNvbnN0IHsgcHVibGlzaENvdW50OiBjdXJyZW50UHVibGlzaENvdW50IH0gPSBzdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IGN1cnJlbnRQLCB0YWlsUCB9ID0gcHJvdmlkZUR1cmFibGVQdWJsaXNoS2l0RXBoZW1lcmFsRGF0YShcbiAgICAgICAgICAgIHN0YXRlLFxuICAgICAgICAgICAgZmFjZXRzXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAocHVibGlzaENvdW50ID09PSBjdXJyZW50UHVibGlzaENvdW50KSB7XG4gICAgICAgICAgICByZXR1cm4gdGFpbFA7XG4gICAgICAgICAgfSBlbHNlIGlmIChwdWJsaXNoQ291bnQgPCBjdXJyZW50UHVibGlzaENvdW50KSB7XG4gICAgICAgICAgICByZXR1cm4gY3VycmVudFAgfHwgcHJvdmlkZUN1cnJlbnRQKHN0YXRlLCBmYWNldHMsIHRhaWxQKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXG4gICAgICAgICAgICAgIFwic3Vic2NyaWJlQWZ0ZXIgYXJndW1lbnQgbXVzdCBiZSBhIHByZXZpb3VzbHktaXNzdWVkIHB1Ymxpc2hDb3VudC5cIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGdldFVwZGF0ZVNpbmNlKHVwZGF0ZUNvdW50KSB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgZmFjZXRzOiB7IHN1YnNjcmliZXIgfVxuICAgICAgICAgIH0gPSB0aGlzO1xuICAgICAgICAgIGlmICh1cGRhdGVDb3VudCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gc3Vic2NyaWJlci5zdWJzY3JpYmVBZnRlcigpLnRoZW4obWFrZU1lbW9pemVkVXBkYXRlUmVjb3JkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdXBkYXRlQ291bnQgPSBCaWdJbnQodXBkYXRlQ291bnQpO1xuICAgICAgICAgIHJldHVybiBzdWJzY3JpYmVyLnN1YnNjcmliZUFmdGVyKHVwZGF0ZUNvdW50KS50aGVuKCgpID0+IHN1YnNjcmliZXIuZ2V0VXBkYXRlU2luY2UoKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIHN0YXRlU2hhcGU6IER1cmFibGVQdWJsaXNoS2l0U3RhdGVTaGFwZVxuICAgIH1cbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZUR1cmFibGVQdWJsaXNoS2l0KTtcbnZhciBTdWJzY3JpYmVyU2hhcGUgPSBNLnJlbW90YWJsZShcIlN1YnNjcmliZXJcIik7XG5cbi8vXG52YXIgeyBpc0Zyb3plbjogaXNGcm96ZW42IH0gPSBPYmplY3Q7XG52YXIgVXBncmFkZURpc2Nvbm5lY3Rpb25TaGFwZSA9IGhhcmRlbih7XG4gIG5hbWU6IFwidmF0VXBncmFkZWRcIixcbiAgdXBncmFkZU1lc3NhZ2U6IE0uc3RyaW5nKCksXG4gIGluY2FybmF0aW9uTnVtYmVyOiBNLm51bWJlcigpXG59KTtcbnZhciBtYWtlVXBncmFkZURpc2Nvbm5lY3Rpb24gPSAodXBncmFkZU1lc3NhZ2UsIHRvSW5jYXJuYXRpb25OdW1iZXIpID0+IGhhcmRlbih7XG4gIG5hbWU6IFwidmF0VXBncmFkZWRcIixcbiAgdXBncmFkZU1lc3NhZ2UsXG4gIGluY2FybmF0aW9uTnVtYmVyOiB0b0luY2FybmF0aW9uTnVtYmVyXG59KTtcbmhhcmRlbihtYWtlVXBncmFkZURpc2Nvbm5lY3Rpb24pO1xudmFyIGlzVXBncmFkZURpc2Nvbm5lY3Rpb24gPSAocmVhc29uKSA9PiByZWFzb24gIT0gbnVsbCAmJiAvL1xuaXNGcm96ZW42KHJlYXNvbikgJiYgbWF0Y2hlcyhyZWFzb24sIFVwZ3JhZGVEaXNjb25uZWN0aW9uU2hhcGUpO1xuaGFyZGVuKGlzVXBncmFkZURpc2Nvbm5lY3Rpb24pO1xudmFyIGlzQWJhbmRvbmVkRXJyb3IgPSAocmVhc29uKSA9PiByZWFzb24gIT0gbnVsbCAmJiAvL1xuaXNGcm96ZW42KHJlYXNvbikgJiYgbWF0Y2hlcyhyZWFzb24sIE0uZXJyb3IoKSkgJiYgLy9cbi8vXG5yZWFzb24ubWVzc2FnZSA9PT0gXCJ2YXQgdGVybWluYXRlZFwiO1xuaGFyZGVuKGlzQWJhbmRvbmVkRXJyb3IpO1xuXG4vL1xudmFyIHNpbmsyID0gKCkgPT4ge1xufTtcbnZhciByZWNvbm5lY3RBc05lZWRlZCA9IGFzeW5jIChnZXR0ZXIsIHNlZWQgPSBbXSkgPT4ge1xuICBsZXQgZGlzY29ubmVjdGlvbjtcbiAgbGV0IGxhc3RWZXJzaW9uID0gLUluZmluaXR5O1xuICBhd2FpdCBudWxsO1xuICBmb3IgKGxldCBpMiA9IDA7IDsgaTIgKz0gMSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHRQID0gaTIgPCBzZWVkLmxlbmd0aCA/IHNlZWRbaTJdIDogZ2V0dGVyKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXN1bHRQO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChpc1VwZ3JhZGVEaXNjb25uZWN0aW9uKGVycikpIHtcbiAgICAgICAgaWYgKCFkaXNjb25uZWN0aW9uKSB7XG4gICAgICAgICAgZGlzY29ubmVjdGlvbiA9IGVycjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IGluY2FybmF0aW9uTnVtYmVyOiB2ZXJzaW9uIH0gPSBlcnI7XG4gICAgICAgIGlmICh2ZXJzaW9uID4gbGFzdFZlcnNpb24pIHtcbiAgICAgICAgICBsYXN0VmVyc2lvbiA9IHZlcnNpb247XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChpc09iamVjdDIoZXJyKSAmJiBkaXNjb25uZWN0aW9uICYmIGRpc2Nvbm5lY3Rpb24gIT09IGVycikge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIG5vdGUoXG4gICAgICAgICAgICBlcnIsXG4gICAgICAgICAgICByZWRhY3RlZGBBdHRlbXB0aW5nIHRvIHJlY292ZXIgZnJvbSBkaXNjb25uZWN0aW9uOiAke2Rpc2Nvbm5lY3Rpb259YFxuICAgICAgICAgICk7XG4gICAgICAgIH0gY2F0Y2ggKF9lcnIpIHtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxufTtcbnZhciBtYWtlRWFjaEl0ZXJhdG9yID0gKHRvcGljLCBuZXh0Q2VsbFApID0+IHtcbiAgY29uc3Qgc2VsZiA9IEZhcihcIkVhY2hJdGVyYXRvclwiLCB7XG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogKCkgPT4gc2VsZixcbiAgICBuZXh0OiAoKSA9PiB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGhlYWQ6IHJlc3VsdFAsXG4gICAgICAgIHB1Ymxpc2hDb3VudDogcHVibGlzaENvdW50UCxcbiAgICAgICAgdGFpbDogdGFpbFBcbiAgICAgIH0gPSBFLmdldChuZXh0Q2VsbFApO1xuICAgICAgY29uc3QgZ2V0U3VjY2Vzc29yID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBwdWJsaXNoQ291bnQgPSBhd2FpdCBwdWJsaXNoQ291bnRQO1xuICAgICAgICBhc3NlcnQudHlwZW9mKHB1Ymxpc2hDb3VudCwgXCJiaWdpbnRcIik7XG4gICAgICAgIGNvbnN0IHN1Y2Nlc3NvciA9IGF3YWl0IEUodG9waWMpLnN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudCk7XG4gICAgICAgIGNvbnN0IG5ld1B1Ymxpc2hDb3VudCA9IHN1Y2Nlc3Nvci5wdWJsaXNoQ291bnQ7XG4gICAgICAgIGlmIChuZXdQdWJsaXNoQ291bnQgIT09IHB1Ymxpc2hDb3VudCArIDFuKSB7XG4gICAgICAgICAgdGhyb3dSZWRhY3RlZGBlYWNoSXRlcmF0b3IgYnJva2VuIGJ5IGdhcCBmcm9tIHB1Ymxpc2hDb3VudCAke3B1Ymxpc2hDb3VudH0gdG8gJHtuZXdQdWJsaXNoQ291bnR9YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3VjY2Vzc29yO1xuICAgICAgfTtcbiAgICAgIG5leHRDZWxsUCA9IHJlY29ubmVjdEFzTmVlZGVkKGdldFN1Y2Nlc3NvciwgW3RhaWxQXSk7XG4gICAgICB2b2lkIEUud2hlbihwdWJsaXNoQ291bnRQLCBzaW5rMiwgc2luazIpO1xuICAgICAgdm9pZCBFLndoZW4obmV4dENlbGxQLCBzaW5rMiwgc2luazIpO1xuICAgICAgcmV0dXJuIHJlc3VsdFA7XG4gICAgfSxcbiAgICBmb3JrOiAoKSA9PiBtYWtlRWFjaEl0ZXJhdG9yKHRvcGljLCBuZXh0Q2VsbFApXG4gIH0pO1xuICByZXR1cm4gc2VsZjtcbn07XG52YXIgc3Vic2NyaWJlRWFjaCA9ICh0b3BpYykgPT4ge1xuICBjb25zdCBpdGVyYWJsZSA9IEZhcihcIkVhY2hJdGVyYWJsZVwiLCB7XG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogKCkgPT4ge1xuICAgICAgY29uc3QgZmlyc3RDZWxsUCA9IHJlY29ubmVjdEFzTmVlZGVkKCgpID0+IEUodG9waWMpLnN1YnNjcmliZUFmdGVyKCkpO1xuICAgICAgcmV0dXJuIG1ha2VFYWNoSXRlcmF0b3IodG9waWMsIGZpcnN0Q2VsbFApO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBpdGVyYWJsZTtcbn07XG5oYXJkZW4oc3Vic2NyaWJlRWFjaCk7XG52YXIgY2xvbmVMYXRlc3RJdGVyYXRvciA9ICh0b3BpYywgbG9jYWxVcGRhdGVDb3VudCwgdGVybWluYWxSZXN1bHQpID0+IHtcbiAgbGV0IG11dGV4ID0gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIGNvbnN0IG1heWJlUmVxdWVzdE5leHRSZXN1bHQgPSBhc3luYyAoKSA9PiB7XG4gICAgaWYgKHRlcm1pbmFsUmVzdWx0KSB7XG4gICAgICByZXR1cm4gdGVybWluYWxSZXN1bHQ7XG4gICAgfVxuICAgIGNvbnN0IHsgdmFsdWUsIHVwZGF0ZUNvdW50IH0gPSBhd2FpdCByZWNvbm5lY3RBc05lZWRlZChcbiAgICAgICgpID0+IEUodG9waWMpLmdldFVwZGF0ZVNpbmNlKGxvY2FsVXBkYXRlQ291bnQpXG4gICAgKTtcbiAgICBsb2NhbFVwZGF0ZUNvdW50ID0gdXBkYXRlQ291bnQ7XG4gICAgaWYgKHVwZGF0ZUNvdW50ID09PSB2b2lkIDApIHtcbiAgICAgIHRlcm1pbmFsUmVzdWx0ID0gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWUgfSk7XG4gICAgICByZXR1cm4gdGVybWluYWxSZXN1bHQ7XG4gICAgfVxuICAgIHJldHVybiBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWUgfSk7XG4gIH07XG4gIGNvbnN0IHNlbGYgPSBGYXIoXCJMYXRlc3RJdGVyYXRvclwiLCB7XG4gICAgZm9yazogKCkgPT4gY2xvbmVMYXRlc3RJdGVyYXRvcih0b3BpYywgbG9jYWxVcGRhdGVDb3VudCwgdGVybWluYWxSZXN1bHQpLFxuICAgIFtTeW1ib2wuYXN5bmNJdGVyYXRvcl06ICgpID0+IHNlbGYsXG4gICAgbmV4dDogYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKHRlcm1pbmFsUmVzdWx0KSB7XG4gICAgICAgIHJldHVybiB0ZXJtaW5hbFJlc3VsdDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG5leHRSZXN1bHQgPSBtdXRleC50aGVuKG1heWJlUmVxdWVzdE5leHRSZXN1bHQpO1xuICAgICAgbXV0ZXggPSBuZXh0UmVzdWx0LnRoZW4oc2luazIsIHNpbmsyKTtcbiAgICAgIHJldHVybiBuZXh0UmVzdWx0O1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBzZWxmO1xufTtcbnZhciBtYWtlTGF0ZXN0SXRlcmF0b3IgPSAodG9waWMpID0+IGNsb25lTGF0ZXN0SXRlcmF0b3IodG9waWMpO1xudmFyIHN1YnNjcmliZUxhdGVzdCA9ICh0b3BpYykgPT4ge1xuICBjb25zdCBpdGVyYWJsZSA9IEZhcihcIkxhdGVzdEl0ZXJhYmxlXCIsIHtcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiAoKSA9PiBtYWtlTGF0ZXN0SXRlcmF0b3IodG9waWMpXG4gIH0pO1xuICByZXR1cm4gaXRlcmFibGU7XG59O1xuaGFyZGVuKHN1YnNjcmliZUxhdGVzdCk7XG5cbi8vXG52YXIgbWFrZU5vdGlmaWVyID0gKHNoYXJhYmxlSW50ZXJuYWxzUCkgPT4ge1xuICBjb25zdCBub3RpZmllciA9IEZhcihcIm5vdGlmaWVyXCIsIHtcbiAgICAuLi5zdWJzY3JpYmVMYXRlc3Qoc2hhcmFibGVJbnRlcm5hbHNQKSxcbiAgICBnZXRVcGRhdGVTaW5jZTogYXN5bmMgKHVwZGF0ZUNvdW50KSA9PiBFKHNoYXJhYmxlSW50ZXJuYWxzUCkuZ2V0VXBkYXRlU2luY2UodXBkYXRlQ291bnQpLFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICBnZXRTaGFyYWJsZU5vdGlmaWVySW50ZXJuYWxzOiBhc3luYyAoKSA9PiBzaGFyYWJsZUludGVybmFsc1AsXG4gICAgLypcblxuXG5cbiAgICAgKi9cbiAgICBnZXRTdG9yZUtleTogKCkgPT4gaGFyZGVuKHsgbm90aWZpZXIgfSlcbiAgfSk7XG4gIHJldHVybiBub3RpZmllcjtcbn07XG52YXIgbWFrZU5vdGlmaWVyRnJvbVN1YnNjcmliZXIgPSAoc3Vic2NyaWJlcikgPT4ge1xuICBjb25zdCBiYXNlTm90aWZpZXIgPSBoYXJkZW4oe1xuICAgIGdldFVwZGF0ZVNpbmNlOiAodXBkYXRlQ291bnQgPSB2b2lkIDApID0+IEUoc3Vic2NyaWJlcikuZ2V0VXBkYXRlU2luY2UodXBkYXRlQ291bnQpXG4gIH0pO1xuICBjb25zdCBub3RpZmllciA9IEZhcihcIm5vdGlmaWVyXCIsIHtcbiAgICAuLi5tYWtlTm90aWZpZXIoYmFzZU5vdGlmaWVyKSxcbiAgICAuLi5iYXNlTm90aWZpZXJcbiAgfSk7XG4gIHJldHVybiBub3RpZmllcjtcbn07XG5oYXJkZW4obWFrZU5vdGlmaWVyRnJvbVN1YnNjcmliZXIpO1xudmFyIG1ha2VOb3RpZmllcktpdCA9ICguLi5pbml0aWFsU3RhdGVBcnIpID0+IHtcbiAgY29uc3QgeyBwdWJsaXNoZXIsIHN1YnNjcmliZXIgfSA9IG1ha2VQdWJsaXNoS2l0KCk7XG4gIGNvbnN0IG5vdGlmaWVyID0gbWFrZU5vdGlmaWVyRnJvbVN1YnNjcmliZXIoc3Vic2NyaWJlcik7XG4gIGNvbnN0IHVwZGF0ZXIgPSBGYXIoXCJ1cGRhdGVyXCIsIHtcbiAgICB1cGRhdGVTdGF0ZTogKHN0YXRlKSA9PiBwdWJsaXNoZXIucHVibGlzaChzdGF0ZSksXG4gICAgZmluaXNoOiAoY29tcGxldGlvbikgPT4gcHVibGlzaGVyLmZpbmlzaChjb21wbGV0aW9uKSxcbiAgICBmYWlsOiAocmVhc29uKSA9PiBwdWJsaXNoZXIuZmFpbChyZWFzb24pXG4gIH0pO1xuICBhc3NlcnQyKGluaXRpYWxTdGF0ZUFyci5sZW5ndGggPD0gMSwgXCJ0b28gbWFueSBhcmd1bWVudHNcIik7XG4gIGlmIChpbml0aWFsU3RhdGVBcnIubGVuZ3RoID09PSAxKSB7XG4gICAgdXBkYXRlci51cGRhdGVTdGF0ZShpbml0aWFsU3RhdGVBcnJbMF0pO1xuICB9XG4gIHJldHVybiBoYXJkZW4oeyBub3RpZmllciwgdXBkYXRlciB9KTtcbn07XG52YXIgbWFrZU5vdGlmaWVyRnJvbUFzeW5jSXRlcmFibGUgPSAoYXN5bmNJdGVyYWJsZVApID0+IHtcbiAgY29uc3QgaXRlcmF0b3JQID0gRShhc3luY0l0ZXJhYmxlUClbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCk7XG4gIGxldCBvcHROZXh0UHJvbWlzZTtcbiAgbGV0IGN1cnJlbnRVcGRhdGVDb3VudCA9IDBuO1xuICBsZXQgY3VycmVudFJlc3BvbnNlO1xuICBsZXQgZmluYWwgPSBmYWxzZTtcbiAgY29uc3QgYmFzZU5vdGlmaWVyID0gRmFyKFwiYmFzZU5vdGlmaWVyXCIsIHtcbiAgICBnZXRVcGRhdGVTaW5jZSh1cGRhdGVDb3VudCA9IC0xbikge1xuICAgICAgaWYgKHVwZGF0ZUNvdW50IDwgY3VycmVudFVwZGF0ZUNvdW50KSB7XG4gICAgICAgIGlmIChjdXJyZW50UmVzcG9uc2UpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGN1cnJlbnRSZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodXBkYXRlQ291bnQgIT09IGN1cnJlbnRVcGRhdGVDb3VudCkge1xuICAgICAgICB0aHJvdyBFcnJvcihcbiAgICAgICAgICBcImdldFVwZGF0ZVNpbmNlIGFyZ3VtZW50IG11c3QgYmUgYSBwcmV2aW91c2x5LWlzc3VlZCB1cGRhdGVDb3VudC5cIlxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKGZpbmFsKSB7XG4gICAgICAgIGFzc2VydDIoY3VycmVudFJlc3BvbnNlICE9PSB2b2lkIDApO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGN1cnJlbnRSZXNwb25zZSk7XG4gICAgICB9XG4gICAgICBpZiAoIW9wdE5leHRQcm9taXNlKSB7XG4gICAgICAgIGNvbnN0IG5leHRJdGVyUmVzdWx0UCA9IEUoaXRlcmF0b3JQKS5uZXh0KCk7XG4gICAgICAgIG9wdE5leHRQcm9taXNlID0gRS53aGVuKFxuICAgICAgICAgIG5leHRJdGVyUmVzdWx0UCxcbiAgICAgICAgICAoeyBkb25lLCB2YWx1ZSB9KSA9PiB7XG4gICAgICAgICAgICBhc3NlcnQyKCFmaW5hbCk7XG4gICAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgICBmaW5hbCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJyZW50VXBkYXRlQ291bnQgKz0gMW47XG4gICAgICAgICAgICBjdXJyZW50UmVzcG9uc2UgPSBoYXJkZW4oe1xuICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgdXBkYXRlQ291bnQ6IGRvbmUgPyB2b2lkIDAgOiBjdXJyZW50VXBkYXRlQ291bnRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgb3B0TmV4dFByb21pc2UgPSB2b2lkIDA7XG4gICAgICAgICAgICByZXR1cm4gY3VycmVudFJlc3BvbnNlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgKF9yZWFzb24pID0+IHtcbiAgICAgICAgICAgIGZpbmFsID0gdHJ1ZTtcbiAgICAgICAgICAgIGN1cnJlbnRSZXNwb25zZSA9IC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgbmV4dEl0ZXJSZXN1bHRQO1xuICAgICAgICAgICAgb3B0TmV4dFByb21pc2UgPSB2b2lkIDA7XG4gICAgICAgICAgICByZXR1cm4gY3VycmVudFJlc3BvbnNlO1xuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvcHROZXh0UHJvbWlzZTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBub3RpZmllciA9IEZhcihcIm5vdGlmaWVyXCIsIHtcbiAgICAvL1xuICAgIC8vXG4gICAgLi4ubWFrZU5vdGlmaWVyKGJhc2VOb3RpZmllciksXG4gICAgLi4uYmFzZU5vdGlmaWVyXG4gIH0pO1xuICByZXR1cm4gbm90aWZpZXI7XG59O1xuaGFyZGVuKG1ha2VOb3RpZmllckZyb21Bc3luY0l0ZXJhYmxlKTtcblxuLy9cbnZhciBtYWtlUGlubmVkSGlzdG9yeVRvcGljID0gKHRvcGljKSA9PiB7XG4gIGNvbnN0IHBpbm5lZFB1Ykxpc3QgPSB0b3BpYy5zdWJzY3JpYmVBZnRlcigpO1xuICByZXR1cm4gRmFyKFwiUGlubmVkSGlzdG9yeVRvcGljXCIsIHtcbiAgICBzdWJzY3JpYmVBZnRlcjogYXN5bmMgKHB1Ymxpc2hDb3VudCA9IC0xbikgPT4ge1xuICAgICAgaWYgKHB1Ymxpc2hDb3VudCA9PT0gLTFuKSB7XG4gICAgICAgIHJldHVybiBwaW5uZWRQdWJMaXN0O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRvcGljLnN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudCk7XG4gICAgfSxcbiAgICBnZXRVcGRhdGVTaW5jZTogYXN5bmMgKHVwZGF0ZUNvdW50ID0gdm9pZCAwKSA9PiB7XG4gICAgICByZXR1cm4gdG9waWMuZ2V0VXBkYXRlU2luY2UodXBkYXRlQ291bnQpO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VQaW5uZWRIaXN0b3J5VG9waWMpO1xuXG4vL1xudmFyIG1ha2VTdWJzY3JpcHRpb24gPSAodG9waWMpID0+IHtcbiAgY29uc3Qgc3Vic2NyaXB0aW9uID0gRmFyKFwiU3Vic2NyaXB0aW9uXCIsIHtcbiAgICAuLi5zdWJzY3JpYmVFYWNoKHRvcGljKSxcbiAgICBzdWJzY3JpYmVBZnRlcjogYXN5bmMgKHB1Ymxpc2hDb3VudCkgPT4gRSh0b3BpYykuc3Vic2NyaWJlQWZ0ZXIocHVibGlzaENvdW50KSxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgZ2V0U2hhcmFibGVTdWJzY3JpcHRpb25JbnRlcm5hbHM6IGFzeW5jICgpID0+IHRvcGljLFxuICAgIGdldFN0b3JlS2V5OiAoKSA9PiBoYXJkZW4oeyBzdWJzY3JpcHRpb24gfSlcbiAgfSk7XG4gIHJldHVybiBzdWJzY3JpcHRpb247XG59O1xuaGFyZGVuKG1ha2VTdWJzY3JpcHRpb24pO1xudmFyIG1ha2VTdWJzY3JpcHRpb25LaXQgPSAoKSA9PiB7XG4gIGNvbnN0IHsgcHVibGlzaGVyLCBzdWJzY3JpYmVyIH0gPSBtYWtlUHVibGlzaEtpdCgpO1xuICBjb25zdCBwaW5uZWRIaXN0b3J5VG9waWMgPSBtYWtlUGlubmVkSGlzdG9yeVRvcGljKHN1YnNjcmliZXIpO1xuICBjb25zdCBzdWJzY3JpcHRpb24gPSBtYWtlU3Vic2NyaXB0aW9uKHBpbm5lZEhpc3RvcnlUb3BpYyk7XG4gIGNvbnN0IHB1YmxpY2F0aW9uID0gRmFyKFwicHVibGljYXRpb25cIiwge1xuICAgIHVwZGF0ZVN0YXRlOiAobm9uRmluYWxWYWx1ZSkgPT4gcHVibGlzaGVyLnB1Ymxpc2gobm9uRmluYWxWYWx1ZSksXG4gICAgZmluaXNoOiAoY29tcGxldGlvbikgPT4gcHVibGlzaGVyLmZpbmlzaChjb21wbGV0aW9uKSxcbiAgICBmYWlsOiAocmVhc29uKSA9PiBwdWJsaXNoZXIuZmFpbChyZWFzb24pXG4gIH0pO1xuICByZXR1cm4gaGFyZGVuKHsgcHVibGljYXRpb24sIHN1YnNjcmlwdGlvbiB9KTtcbn07XG5oYXJkZW4obWFrZVN1YnNjcmlwdGlvbktpdCk7XG5cbi8vXG52YXIgb2JzZXJ2ZUl0ZXJhdG9yID0gKGFzeW5jSXRlcmF0b3JQLCBpdGVyYXRpb25PYnNlcnZlcikgPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKGFjaywgb2JzZXJ2ZXJFcnJvcikgPT4ge1xuICAgIGNvbnN0IHJlY3VyID0gKCkgPT4ge1xuICAgICAgRS53aGVuKFxuICAgICAgICBFKGFzeW5jSXRlcmF0b3JQKS5uZXh0KCksXG4gICAgICAgICh7IHZhbHVlLCBkb25lIH0pID0+IHtcbiAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgaXRlcmF0aW9uT2JzZXJ2ZXIuZmluaXNoICYmIGl0ZXJhdGlvbk9ic2VydmVyLmZpbmlzaCh2YWx1ZSk7XG4gICAgICAgICAgICBhY2sodm9pZCAwKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaXRlcmF0aW9uT2JzZXJ2ZXIudXBkYXRlU3RhdGUgJiYgaXRlcmF0aW9uT2JzZXJ2ZXIudXBkYXRlU3RhdGUodmFsdWUpO1xuICAgICAgICAgICAgcmVjdXIoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIChyZWFzb24pID0+IHtcbiAgICAgICAgICBpdGVyYXRpb25PYnNlcnZlci5mYWlsICYmIGl0ZXJhdGlvbk9ic2VydmVyLmZhaWwocmVhc29uKTtcbiAgICAgICAgICBhY2sodm9pZCAwKTtcbiAgICAgICAgfVxuICAgICAgKS5jYXRjaChvYnNlcnZlckVycm9yKTtcbiAgICB9O1xuICAgIHJlY3VyKCk7XG4gIH0pO1xufTtcbnZhciBvYnNlcnZlSXRlcmF0aW9uID0gKGFzeW5jSXRlcmFibGVQLCBpdGVyYXRpb25PYnNlcnZlcikgPT4ge1xuICBjb25zdCBpdGVyYXRvclAgPSBFKGFzeW5jSXRlcmFibGVQKVtTeW1ib2wuYXN5bmNJdGVyYXRvcl0oKTtcbiAgcmV0dXJuIG9ic2VydmVJdGVyYXRvcihpdGVyYXRvclAsIGl0ZXJhdGlvbk9ic2VydmVyKTtcbn07XG5cbi8vXG52YXIgQnJpZGdlSWQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBCQU5LOiBcImJhbmtcIixcbiAgICBDT1JFOiBcImNvcmVcIixcbiAgICBESUJDOiBcImRpYmNcIixcbiAgICBTVE9SQUdFOiBcInN0b3JhZ2VcIixcbiAgICBQUk9WSVNJT046IFwicHJvdmlzaW9uXCIsXG4gICAgUFJPVklTSU9OX1NNQVJUX1dBTExFVDogXCJwcm92aXNpb25XYWxsZXRcIixcbiAgICBWTE9DQUxDSEFJTjogXCJ2bG9jYWxjaGFpblwiLFxuICAgIFZUUkFOU0ZFUjogXCJ2dHJhbnNmZXJcIixcbiAgICBXQUxMRVQ6IFwid2FsbGV0XCJcbiAgfVxuKTtcbmhhcmRlbihCcmlkZ2VJZCk7XG52YXIgQ29zbW9zSW5pdEtleVRvQnJpZGdlSWQgPSB7XG4gIHZiYW5rUG9ydDogXCJiYW5rXCIsXG4gIHZpYmNQb3J0OiBcImRpYmNcIlxufTtcbmhhcmRlbihDb3Ntb3NJbml0S2V5VG9CcmlkZ2VJZCk7XG52YXIgV2FsbGV0TmFtZSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIGRlcG9zaXRGYWNldDogXCJkZXBvc2l0RmFjZXRcIlxuICB9XG4pO1xuaGFyZGVuKFdhbGxldE5hbWUpO1xudmFyIFZCYW5rQWNjb3VudCA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIHJlc2VydmU6IHtcbiAgICAgIG1vZHVsZTogXCJ2YmFuay9yZXNlcnZlXCIsXG4gICAgICBhZGRyZXNzOiBcImFnb3JpYzFhZTBsbXR6bGdyY25sYTl4amtwYWFycTVkNWRmZXo2M2gzbnVjbFwiXG4gICAgfSxcbiAgICBwcm92aXNpb246IHtcbiAgICAgIG1vZHVsZTogXCJ2YmFuay9wcm92aXNpb25cIixcbiAgICAgIGFkZHJlc3M6IFwiYWdvcmljMW1lZ3p5dGc2NWN5cmd6czZmdnp4Z3JjcXZ3d2w3dWdwdDYyMzQ2XCJcbiAgICB9XG4gIH1cbik7XG5oYXJkZW4oVkJhbmtBY2NvdW50KTtcblxuLy9cbnZhciBkZWJ1Z0luc3RhbmNlID0gMTtcbnZhciBtYWtlVHJhY2VyID0gKG5hbWUsIGVuYWJsZSA9IHRydWUpID0+IHtcbiAgZGVidWdJbnN0YW5jZSArPSAxO1xuICBsZXQgZGVidWdDb3VudCA9IDE7XG4gIGNvbnN0IGtleSA9IGAtLS0tLSAke25hbWV9LiR7ZGVidWdJbnN0YW5jZX0gYDtcbiAgc3dpdGNoIChlbmFibGUpIHtcbiAgICBjYXNlIGZhbHNlOiB7XG4gICAgICBjb25zdCBsb2dEaXNhYmxlZCA9ICguLi5fYXJncykgPT4ge1xuICAgICAgfTtcbiAgICAgIHJldHVybiBsb2dEaXNhYmxlZDtcbiAgICB9XG4gICAgY2FzZSBcInZlcmJvc2VcIjoge1xuICAgICAgY29uc3QgaW5mb1RpY2sgPSAob3B0TG9nLCAuLi5hcmdzKSA9PiB7XG4gICAgICAgIGlmIChvcHRMb2cubG9nKSB7XG4gICAgICAgICAgY29uc29sZS5pbmZvKGtleSwgZGVidWdDb3VudCArPSAxLCAuLi5hcmdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmluZm8oa2V5LCBkZWJ1Z0NvdW50ICs9IDEsIG9wdExvZywgLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gaW5mb1RpY2s7XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIGNvbnN0IGRlYnVnVGljayA9IChvcHRMb2csIC4uLmFyZ3MpID0+IHtcbiAgICAgICAgaWYgKG9wdExvZy5sb2cpIHtcbiAgICAgICAgICBvcHRMb2cubG9nKGtleSwgZGVidWdDb3VudCArPSAxLCAuLi5hcmdzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmluZm8oa2V5LCBkZWJ1Z0NvdW50ICs9IDEsIG9wdExvZywgLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gZGVidWdUaWNrO1xuICAgIH1cbiAgfVxufTtcbmhhcmRlbihtYWtlVHJhY2VyKTtcblxuLy9cbnZhciBOb25OdWxsaXNoID0gKHZhbCwgb3B0RGV0YWlscyA9IGB1bmV4cGVjdGVkICR7cXVvdGUodmFsKX1gKSA9PiB7XG4gIGlmICh2YWwgIT0gbnVsbCkge1xuICAgIHJldHVybiB2YWw7XG4gIH1cbiAgYXNzZXJ0LmZhaWwob3B0RGV0YWlscyk7XG59O1xuaGFyZGVuKE5vbk51bGxpc2gpO1xuXG4vL1xudmFyIHsgZGVmaW5lUHJvcGVydHk6IGRlZmluZVByb3BlcnR5MiB9ID0gT2JqZWN0O1xudmFyIHR5cGVkRW50cmllcyA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICovXG4gIE9iamVjdC5lbnRyaWVzXG4pO1xudmFyIGZyb21UeXBlZEVudHJpZXMgPSAoXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgT2JqZWN0LmZyb21FbnRyaWVzXG4pO1xudmFyIHR5cGVkTWFwID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICBGdW5jdGlvbi5wcm90b3R5cGUuY2FsbC5iaW5kKEFycmF5LnByb3RvdHlwZS5tYXApXG4pO1xudmFyIGxvZ0xldmVscyA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgW1xuICAgIFwiZGVidWdcIixcbiAgICBcImxvZ1wiLFxuICAgIFwiaW5mb1wiLFxuICAgIFwid2FyblwiLFxuICAgIFwiZXJyb3JcIlxuICBdXG4pO1xuT2JqZWN0LmZyZWV6ZShsb2dMZXZlbHMpO1xudmFyIGRlZXBNYXBPYmplY3RJbnRlcm5hbCA9ICh2YWx1ZSwgbmFtZSwgY29udGFpbmVyLCBtYXBwZXIpID0+IHtcbiAgaWYgKGNvbnRhaW5lciAmJiB0eXBlb2YgbmFtZSA9PT0gXCJzdHJpbmdcIikge1xuICAgIGNvbnN0IG1hcHBlZCA9IG1hcHBlcih2YWx1ZSwgbmFtZSwgY29udGFpbmVyKTtcbiAgICBpZiAobWFwcGVkICE9PSB2YWx1ZSkge1xuICAgICAgcmV0dXJuIG1hcHBlZDtcbiAgICB9XG4gIH1cbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJvYmplY3RcIiB8fCAhdmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgbGV0IHdhc01hcHBlZCA9IGZhbHNlO1xuICBjb25zdCB2YWx1ZU9iaiA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHZhbHVlXG4gICk7XG4gIGNvbnN0IG1hcEVudHJ5ID0gKFtpbm5lck5hbWUsIGlubmVyVmFsdWVdKSA9PiB7XG4gICAgY29uc3QgbWFwcGVkSW5uZXJWYWx1ZSA9IGRlZXBNYXBPYmplY3RJbnRlcm5hbChcbiAgICAgIGlubmVyVmFsdWUsXG4gICAgICBpbm5lck5hbWUsXG4gICAgICB2YWx1ZU9iaixcbiAgICAgIG1hcHBlclxuICAgICk7XG4gICAgd2FzTWFwcGVkIHx8PSBtYXBwZWRJbm5lclZhbHVlICE9PSBpbm5lclZhbHVlO1xuICAgIHJldHVybiBbXG4gICAgICBpbm5lck5hbWUsXG4gICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgIG1hcHBlZElubmVyVmFsdWVcbiAgICBdO1xuICB9O1xuICBjb25zdCBtYXBwZWRFbnRyaWVzID0gdHlwZWRFbnRyaWVzKHZhbHVlT2JqKS5tYXAobWFwRW50cnkpO1xuICBpZiAoIXdhc01hcHBlZCkge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBjb25zdCBtYXBwZWRPYmogPSBmcm9tVHlwZWRFbnRyaWVzKG1hcHBlZEVudHJpZXMpO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAqL1xuICAgIG1hcHBlZE9ialxuICApO1xufTtcbnZhciBkZWVwTWFwT2JqZWN0ID0gKG9iaiwgbWFwcGVyKSA9PiAoXG4gIC8qICAgICAgICAgICAgICAqL1xuICBkZWVwTWFwT2JqZWN0SW50ZXJuYWwob2JqLCB2b2lkIDAsIHZvaWQgMCwgbWFwcGVyKVxuKTtcbnZhciBwcm92aWRlTGF6eU1hcCA9IChtYXAsIGtleSwgbWFrZVZhbHVlKSA9PiB7XG4gIGNvbnN0IGZvdW5kID0gbWFwLmdldChrZXkpO1xuICBpZiAoZm91bmQgIT09IHZvaWQgMCB8fCBtYXAuaGFzKGtleSkpIHtcbiAgICByZXR1cm4gKFxuICAgICAgLyogICAgICAgICAgICAqL1xuICAgICAgZm91bmRcbiAgICApO1xuICB9XG4gIGNvbnN0IHZhbHVlID0gbWFrZVZhbHVlKGtleSk7XG4gIG1hcC5zZXQoa2V5LCB2YWx1ZSk7XG4gIHJldHVybiB2YWx1ZTtcbn07XG5cbi8vXG52YXIgZGV0YWNoZWRIZWFwU3RvcmVzID0gRmFyKFwiaGVhcFN0b3Jlc1wiLCB7XG4gIGRldGFjaGVkOiAoKSA9PiBkZXRhY2hlZEhlYXBTdG9yZXMsXG4gIGlzU3RvcmFibGU6IGlzUGFzc2FibGUsXG4gIHNldFN0b3JlOiBtYWtlU2NhbGFyU2V0U3RvcmUsXG4gIG1hcFN0b3JlOiBtYWtlU2NhbGFyTWFwU3RvcmUsXG4gIHdlYWtNYXBTdG9yZTogbWFrZVNjYWxhcldlYWtNYXBTdG9yZSxcbiAgd2Vha1NldFN0b3JlOiBtYWtlU2NhbGFyV2Vha1NldFN0b3JlXG59KTtcbnZhciBtYWtlSGVhcFpvbmUgPSAoYmFzZUxhYmVsID0gXCJoZWFwWm9uZVwiKSA9PiB7XG4gIGNvbnN0IHsgbWFrZU9uY2UsIHdyYXBQcm92aWRlciB9ID0gbWFrZU9uY2VLaXQoYmFzZUxhYmVsLCBkZXRhY2hlZEhlYXBTdG9yZXMpO1xuICBjb25zdCBtYWtlU3ViWm9uZSA9IChsYWJlbCwgX29wdGlvbnMpID0+IG1ha2VIZWFwWm9uZShgJHtiYXNlTGFiZWx9LiR7bGFiZWx9YCk7XG4gIHJldHVybiBGYXIoXCJoZWFwWm9uZVwiLCB7XG4gICAgZXhvOiB3cmFwUHJvdmlkZXIobWFrZUV4bywgYWdvcmljVmF0RGF0YUtleXMuZXhvKSxcbiAgICBleG9DbGFzczogd3JhcFByb3ZpZGVyKGRlZmluZUV4b0NsYXNzLCBhZ29yaWNWYXREYXRhS2V5cy5leG9DbGFzcyksXG4gICAgZXhvQ2xhc3NLaXQ6IHdyYXBQcm92aWRlcihkZWZpbmVFeG9DbGFzc0tpdCwgYWdvcmljVmF0RGF0YUtleXMuZXhvQ2xhc3NLaXQpLFxuICAgIHN1YlpvbmU6IHdyYXBQcm92aWRlcihtYWtlU3ViWm9uZSksXG4gICAgbWFrZU9uY2UsXG4gICAgd2F0Y2hQcm9taXNlOiB3YXRjaFByb21pc2UyLFxuICAgIGRldGFjaGVkOiBkZXRhY2hlZEhlYXBTdG9yZXMuZGV0YWNoZWQsXG4gICAgaXNTdG9yYWJsZTogZGV0YWNoZWRIZWFwU3RvcmVzLmlzU3RvcmFibGUsXG4gICAgbWFwU3RvcmU6IHdyYXBQcm92aWRlcihkZXRhY2hlZEhlYXBTdG9yZXMubWFwU3RvcmUpLFxuICAgIHNldFN0b3JlOiB3cmFwUHJvdmlkZXIoZGV0YWNoZWRIZWFwU3RvcmVzLnNldFN0b3JlKSxcbiAgICB3ZWFrTWFwU3RvcmU6IHdyYXBQcm92aWRlcihkZXRhY2hlZEhlYXBTdG9yZXMud2Vha01hcFN0b3JlKSxcbiAgICB3ZWFrU2V0U3RvcmU6IHdyYXBQcm92aWRlcihkZXRhY2hlZEhlYXBTdG9yZXMud2Vha1NldFN0b3JlKVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUhlYXBab25lKTtcblxuLy9cbnZhciB7IGZyb21FbnRyaWVzOiBmcm9tRW50cmllczkgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IHJhd093bktleXMgfSA9IFJlZmxlY3Q7XG52YXIgb3duS2V5czE5ID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICByYXdPd25LZXlzXG4pO1xudmFyIGlzUHJvcGVydHlLZXkgPSAoa2V5KSA9PiB7XG4gIHN3aXRjaCAodHlwZW9mIGtleSkge1xuICAgIGNhc2UgXCJzdHJpbmdcIjpcbiAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgY2FzZSBcInN5bWJvbFwiOlxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcbnZhciBjYWxsU3luYyA9IChjYWxsYmFjaywgLi4uYXJncykgPT4ge1xuICBjb25zdCB7IHRhcmdldCwgbWV0aG9kTmFtZSwgYm91bmQgfSA9IGNhbGxiYWNrO1xuICBpZiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIHRhcmdldCguLi5ib3VuZCwgLi4uYXJncyk7XG4gIH1cbiAgcmV0dXJuIHRhcmdldFttZXRob2ROYW1lXSguLi5ib3VuZCwgLi4uYXJncyk7XG59O1xuaGFyZGVuKGNhbGxTeW5jKTtcbnZhciBjYWxsRSA9IChjYWxsYmFjaywgLi4uYXJncykgPT4ge1xuICBjb25zdCB7IHRhcmdldCwgbWV0aG9kTmFtZSwgYm91bmQgfSA9IGNhbGxiYWNrO1xuICBpZiAobWV0aG9kTmFtZSA9PT0gdm9pZCAwKSB7XG4gICAgcmV0dXJuIEUodGFyZ2V0KSguLi5ib3VuZCwgLi4uYXJncyk7XG4gIH1cbiAgcmV0dXJuIEUodGFyZ2V0KVttZXRob2ROYW1lXSguLi5ib3VuZCwgLi4uYXJncyk7XG59O1xuaGFyZGVuKGNhbGxFKTtcbnZhciBtYWtlU3luY0Z1bmN0aW9uQ2FsbGJhY2sgPSAodGFyZ2V0LCAuLi5ib3VuZCkgPT4ge1xuICB0eXBlb2YgdGFyZ2V0ID09PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGBzeW5jIGZ1bmN0aW9uIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGEgZnVuY3Rpb246ICR7dGFyZ2V0fWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBib3VuZCwgaXNTeW5jOiB0cnVlIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VTeW5jRnVuY3Rpb25DYWxsYmFjayk7XG52YXIgbWFrZUZ1bmN0aW9uQ2FsbGJhY2sgPSAodGFyZ2V0LCAuLi5ib3VuZCkgPT4ge1xuICBpc09iamVjdDIodGFyZ2V0KSB8fCB0aHJvd1JlZGFjdGVkYGZ1bmN0aW9uIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGEgZnVuY3Rpb24gcHJlc2VuY2U6ICR7dGFyZ2V0fWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBib3VuZCB9KTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VGdW5jdGlvbkNhbGxiYWNrKTtcbnZhciBtYWtlU3luY01ldGhvZENhbGxiYWNrID0gKHRhcmdldCwgbWV0aG9kTmFtZSwgLi4uYm91bmQpID0+IHtcbiAgaXNPYmplY3QyKHRhcmdldCkgfHwgdGhyb3dSZWRhY3RlZGBzeW5jIG1ldGhvZCBjYWxsYmFjayB0YXJnZXQgbXVzdCBiZSBhbiBvYmplY3Q6ICR7dGFyZ2V0fWA7XG4gIHR5cGVvZiBtZXRob2ROYW1lID09PSBcInN0cmluZ1wiIHx8IGlzUGFzc2FibGVTeW1ib2wobWV0aG9kTmFtZSkgfHwgdGhyb3dSZWRhY3RlZGBtZXRob2QgbmFtZSBtdXN0IGJlIGEgc3RyaW5nIG9yIHBhc3NhYmxlIHN5bWJvbDogJHttZXRob2ROYW1lfWA7XG4gIGNvbnN0IGNiID0gaGFyZGVuKHsgdGFyZ2V0LCBtZXRob2ROYW1lLCBib3VuZCwgaXNTeW5jOiB0cnVlIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGNiXG4gICk7XG59O1xuaGFyZGVuKG1ha2VTeW5jTWV0aG9kQ2FsbGJhY2spO1xudmFyIG1ha2VNZXRob2RDYWxsYmFjayA9ICh0YXJnZXQsIG1ldGhvZE5hbWUsIC4uLmJvdW5kKSA9PiB7XG4gIGlzT2JqZWN0Mih0YXJnZXQpIHx8IHRocm93UmVkYWN0ZWRgbWV0aG9kIGNhbGxiYWNrIHRhcmdldCBtdXN0IGJlIGFuIG9iamVjdDogJHt0YXJnZXR9YDtcbiAgdHlwZW9mIG1ldGhvZE5hbWUgPT09IFwic3RyaW5nXCIgfHwgaXNQYXNzYWJsZVN5bWJvbChtZXRob2ROYW1lKSB8fCB0aHJvd1JlZGFjdGVkYG1ldGhvZCBuYW1lIG11c3QgYmUgYSBzdHJpbmcgb3IgcGFzc2FibGUgc3ltYm9sOiAke21ldGhvZE5hbWV9YDtcbiAgY29uc3QgY2IgPSBoYXJkZW4oeyB0YXJnZXQsIG1ldGhvZE5hbWUsIGJvdW5kIH0pO1xuICByZXR1cm4gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgY2JcbiAgKTtcbn07XG5oYXJkZW4obWFrZU1ldGhvZENhbGxiYWNrKTtcbnZhciBpc0NhbGxiYWNrID0gKGNhbGxiYWNrKSA9PiB7XG4gIGlmICghaXNPYmplY3QyKGNhbGxiYWNrKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjb25zdCB7IHRhcmdldCwgbWV0aG9kTmFtZSwgYm91bmQgfSA9IGNhbGxiYWNrO1xuICByZXR1cm4gaXNPYmplY3QyKHRhcmdldCkgJiYgKG1ldGhvZE5hbWUgPT09IHZvaWQgMCB8fCB0eXBlb2YgbWV0aG9kTmFtZSA9PT0gXCJzdHJpbmdcIiB8fCBpc1Bhc3NhYmxlU3ltYm9sKG1ldGhvZE5hbWUpKSAmJiBBcnJheS5pc0FycmF5KGJvdW5kKTtcbn07XG5oYXJkZW4oaXNDYWxsYmFjayk7XG52YXIgcHJlcGFyZUF0dGVudWF0b3IgPSAoem9uZSwgbWV0aG9kTmFtZXMsIHsgaW50ZXJmYWNlR3VhcmQsIHRhZyA9IFwiQXR0ZW51YXRvclwiIH0gPSB7fSkgPT4ge1xuICBjb25zdCBtZXRob2RzID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBmcm9tRW50cmllczkoXG4gICAgICBtZXRob2ROYW1lcy5tYXAoKGtleSkgPT4ge1xuICAgICAgICBpZiAoIWlzUHJvcGVydHlLZXkoa2V5KSkge1xuICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRga2V5ICR7cXVvdGUoa2V5KX0gaXMgbm90IGEgUHJvcGVydHlLZXlgO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG0yID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB7XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgW2tleV0oLi4uYXJncykge1xuICAgICAgICAgICAgICBjb25zdCBjYiA9IHRoaXMuc3RhdGUuY2JzW2tleV07XG4gICAgICAgICAgICAgIGlmICghY2IpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSBtYWtlRXJyb3IoYHVuaW1wbGVtZW50ZWQgJHtxdW90ZSh0YWcpfSBtZXRob2QgJHtxdW90ZShrZXkpfWApO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmlzU3luYykge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoY2IuaXNTeW5jKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxTeW5jKGNiLCAuLi5hcmdzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gY2FsbEUoY2IsIC4uLmFyZ3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1ba2V5XVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgW2tleSwgbTJdXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgIClcbiAgKTtcbiAgY29uc3QgbWFrZUF0dGVudWF0b3IgPSB6b25lLmV4b0NsYXNzKFxuICAgIHRhZyxcbiAgICBpbnRlcmZhY2VHdWFyZCxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgKHtcbiAgICAgIHRhcmdldCA9IG51bGwsXG4gICAgICBpc1N5bmMgPSBmYWxzZSxcbiAgICAgIG92ZXJyaWRlcyA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHt9XG4gICAgICApXG4gICAgfSkgPT4ge1xuICAgICAgY29uc3QgY2JzID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAge31cbiAgICAgICk7XG4gICAgICBjb25zdCByZW1haW5pbmcgPSBuZXcgU2V0KG1ldGhvZE5hbWVzKTtcbiAgICAgIGZvciAoY29uc3Qga2V5IG9mIG93bktleXMxOShvdmVycmlkZXMpKSB7XG4gICAgICAgIHJlbWFpbmluZy5oYXMoa2V5KSB8fCB0aHJvd1JlZGFjdGVkYCR7cXVvdGUodGFnKX0gb3ZlcnJpZGVzWyR7cXVvdGUoa2V5KX1dIG5vdCBhbGxvd2VkIGJ5IG1ldGhvZE5hbWVzYDtcbiAgICAgICAgcmVtYWluaW5nLmRlbGV0ZShrZXkpO1xuICAgICAgICBjb25zdCBjYiA9IG92ZXJyaWRlc1trZXldO1xuICAgICAgICBjYiA9PSBudWxsIHx8IGlzQ2FsbGJhY2soY2IpIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZSh0YWcpfSBvdmVycmlkZXNbJHtxdW90ZShrZXkpfV0gaXMgbm90IGEgY2FsbGJhY2s7IGdvdCAke2NifWA7XG4gICAgICAgIGNic1trZXldID0gY2I7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGtleSBvZiByZW1haW5pbmcpIHtcbiAgICAgICAgaWYgKGlzU3luYykge1xuICAgICAgICAgIGNic1trZXldID0gbWFrZVN5bmNNZXRob2RDYWxsYmFjayh0YXJnZXQsIGtleSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2JzW2tleV0gPSBtYWtlTWV0aG9kQ2FsbGJhY2sodGFyZ2V0LCBrZXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gaGFyZGVuKHsgY2JzLCBpc1N5bmMgfSk7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgbWV0aG9kc1xuICApO1xuICByZXR1cm4gbWFrZUF0dGVudWF0b3I7XG59O1xuaGFyZGVuKHByZXBhcmVBdHRlbnVhdG9yKTtcbnZhciBwcmVwYXJlR3VhcmRlZEF0dGVudWF0b3IgPSAoem9uZSwgaW50ZXJmYWNlR3VhcmQsIG9wdHMgPSB7fSkgPT4ge1xuICBjb25zdCBtZXRob2ROYW1lcyA9IGdldEludGVyZmFjZU1ldGhvZEtleXMoaW50ZXJmYWNlR3VhcmQpO1xuICBjb25zdCBtYWtlQXR0ZW51YXRvciA9IHByZXBhcmVBdHRlbnVhdG9yKHpvbmUsIG1ldGhvZE5hbWVzLCB7XG4gICAgLi4ub3B0cyxcbiAgICBpbnRlcmZhY2VHdWFyZFxuICB9KTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgbWFrZUF0dGVudWF0b3JcbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZUd1YXJkZWRBdHRlbnVhdG9yKTtcblxuLy9cbnZhciBDaGFpblN0b3JhZ2VOb2RlSSA9IE0uaW50ZXJmYWNlKFwiU3RvcmFnZU5vZGVcIiwge1xuICBzZXRWYWx1ZTogTS5jYWxsV2hlbihNLnN0cmluZygpKS5yZXR1cm5zKCksXG4gIGdldFBhdGg6IE0uY2FsbCgpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIGdldFN0b3JlS2V5OiBNLmNhbGxXaGVuKCkucmV0dXJucyhNLnJlY29yZCgpKSxcbiAgbWFrZUNoaWxkTm9kZTogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3BsaXRSZWNvcmQoe30sIHsgc2VxdWVuY2U6IE0uYm9vbGVhbigpIH0sIHt9KSkucmV0dXJucyhNLnJlbW90YWJsZShcIlN0b3JhZ2VOb2RlXCIpKVxufSk7XG52YXIgaXNTdHJlYW1DZWxsID0gKGNlbGwpID0+IGNlbGwgJiYgdHlwZW9mIGNlbGwgPT09IFwib2JqZWN0XCIgJiYgQXJyYXkuaXNBcnJheShjZWxsLnZhbHVlcykgJiYgdHlwZW9mIGNlbGwuYmxvY2tIZWlnaHQgPT09IFwic3RyaW5nXCIgJiYgL14wJHxeWzEtOV1bMC05XSokLy50ZXN0KGNlbGwuYmxvY2tIZWlnaHQpO1xuaGFyZGVuKGlzU3RyZWFtQ2VsbCk7XG52YXIgYXNzZXJ0Q2FwRGF0YSA9IChkYXRhKSA9PiB7XG4gIGFzc2VydC50eXBlb2YoZGF0YSwgXCJvYmplY3RcIik7XG4gIGFzc2VydChkYXRhKTtcbiAgYXNzZXJ0LnR5cGVvZihkYXRhLmJvZHksIFwic3RyaW5nXCIpO1xuICBhc3NlcnQoQXJyYXkuaXNBcnJheShkYXRhLnNsb3RzKSk7XG59O1xuaGFyZGVuKGFzc2VydENhcERhdGEpO1xudmFyIHBhdGhTZWdtZW50UGF0dGVybiA9IC9eW2EtekEtWjAtOV8tXXsxLDEwMH0kLztcbnZhciBhc3NlcnRQYXRoU2VnbWVudCA9IChuYW1lKSA9PiB7XG4gIHBhdGhTZWdtZW50UGF0dGVybi50ZXN0KG5hbWUpIHx8IHRocm93UmVkYWN0ZWRgUGF0aCBzZWdtZW50IG5hbWVzIG11c3QgY29uc2lzdCBvZiAxIHRvIDEwMCBjaGFyYWN0ZXJzIGxpbWl0ZWQgdG8gQVNDSUkgYWxwaGFudW1lcmljcywgdW5kZXJzY29yZXMsIGFuZC9vciBkYXNoZXM6ICR7bmFtZX1gO1xufTtcbmhhcmRlbihhc3NlcnRQYXRoU2VnbWVudCk7XG52YXIgcHJlcGFyZUNoYWluU3RvcmFnZU5vZGUgPSAoem9uZSkgPT4ge1xuICBjb25zdCBtYWtlQ2hhaW5TdG9yYWdlTm9kZSA9IHpvbmUuZXhvQ2xhc3MoXG4gICAgXCJDaGFpblN0b3JhZ2VOb2RlXCIsXG4gICAgQ2hhaW5TdG9yYWdlTm9kZUksXG4gICAgLypcblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICAobWVzc2VuZ2VyLCBwYXRoLCB7IHNlcXVlbmNlID0gZmFsc2UgfSA9IHt9KSA9PiB7XG4gICAgICBhc3NlcnQudHlwZW9mKHBhdGgsIFwic3RyaW5nXCIpO1xuICAgICAgYXNzZXJ0LnR5cGVvZihzZXF1ZW5jZSwgXCJib29sZWFuXCIpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7IHBhdGgsIG1lc3Nlbmdlciwgc2VxdWVuY2UgfSk7XG4gICAgfSxcbiAgICB7XG4gICAgICBnZXRQYXRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5wYXRoO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBhc3luYyBnZXRTdG9yZUtleSgpIHtcbiAgICAgICAgY29uc3QgeyBwYXRoLCBtZXNzZW5nZXIgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIHJldHVybiBjYWxsRShtZXNzZW5nZXIsIHtcbiAgICAgICAgICBtZXRob2Q6IFwiZ2V0U3RvcmVLZXlcIixcbiAgICAgICAgICBhcmdzOiBbcGF0aF1cbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuICAgICAgICovXG4gICAgICBtYWtlQ2hpbGROb2RlKG5hbWUsIGNoaWxkTm9kZU9wdGlvbnMgPSB7fSkge1xuICAgICAgICBjb25zdCB7IHNlcXVlbmNlLCBwYXRoLCBtZXNzZW5nZXIgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGFzc2VydFBhdGhTZWdtZW50KG5hbWUpO1xuICAgICAgICBjb25zdCBtZXJnZWRPcHRpb25zID0geyBzZXF1ZW5jZSwgLi4uY2hpbGROb2RlT3B0aW9ucyB9O1xuICAgICAgICByZXR1cm4gbWFrZUNoYWluU3RvcmFnZU5vZGUoXG4gICAgICAgICAgbWVzc2VuZ2VyLFxuICAgICAgICAgIGAke3BhdGh9LiR7bmFtZX1gLFxuICAgICAgICAgIG1lcmdlZE9wdGlvbnNcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgYXN5bmMgc2V0VmFsdWUodmFsdWUpIHtcbiAgICAgICAgY29uc3QgeyBzZXF1ZW5jZSwgcGF0aCwgbWVzc2VuZ2VyIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICBhc3NlcnQudHlwZW9mKHZhbHVlLCBcInN0cmluZ1wiKTtcbiAgICAgICAgbGV0IGVudHJ5O1xuICAgICAgICBpZiAoIXNlcXVlbmNlICYmICF2YWx1ZSkge1xuICAgICAgICAgIGVudHJ5ID0gW3BhdGhdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVudHJ5ID0gW3BhdGgsIHZhbHVlXTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBjYWxsRShtZXNzZW5nZXIsIHtcbiAgICAgICAgICBtZXRob2Q6IHNlcXVlbmNlID8gXCJhcHBlbmRcIiA6IFwic2V0XCIsXG4gICAgICAgICAgYXJnczogW2VudHJ5XVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIC8vXG4gICAgfVxuICApO1xuICByZXR1cm4gbWFrZUNoYWluU3RvcmFnZU5vZGU7XG59O1xudmFyIG1ha2VIZWFwQ2hhaW5TdG9yYWdlTm9kZSA9IHByZXBhcmVDaGFpblN0b3JhZ2VOb2RlKG1ha2VIZWFwWm9uZSgpKTtcbmZ1bmN0aW9uIG1ha2VDaGFpblN0b3JhZ2VSb290KGhhbmRsZVN0b3JhZ2VNZXNzYWdlLCByb290UGF0aCwgcm9vdE9wdGlvbnMgPSB7fSkge1xuICBjb25zdCBtZXNzZW5nZXIgPSBtYWtlRnVuY3Rpb25DYWxsYmFjayhoYW5kbGVTdG9yYWdlTWVzc2FnZSk7XG4gIGNvbnN0IHJvb3ROb2RlID0gbWFrZUhlYXBDaGFpblN0b3JhZ2VOb2RlKG1lc3Nlbmdlciwgcm9vdFBhdGgsIHJvb3RPcHRpb25zKTtcbiAgcmV0dXJuIHJvb3ROb2RlO1xufVxudmFyIG1ha2VOdWxsU3RvcmFnZU5vZGUgPSAoKSA9PiB7XG4gIHJldHVybiBtYWtlQ2hhaW5TdG9yYWdlUm9vdChcbiAgICBGYXIoXCJOdWxsTWVzc2VuZ2VyXCIsICgpID0+IG51bGwpLFxuICAgIFwibnVsbFwiXG4gICk7XG59O1xuYXN5bmMgZnVuY3Rpb24gbWFrZVN0b3JhZ2VOb2RlQ2hpbGQoc3RvcmFnZU5vZGVSZWYsIGNoaWxkTmFtZSkge1xuICBjb25zdCBleGlzdGluZ1N0b3JhZ2VOb2RlID0gYXdhaXQgc3RvcmFnZU5vZGVSZWY7XG4gIGNvbnN0IHN0b3JhZ2VOb2RlID0gZXhpc3RpbmdTdG9yYWdlTm9kZSB8fCBtYWtlTnVsbFN0b3JhZ2VOb2RlKCk7XG4gIHJldHVybiBFKHN0b3JhZ2VOb2RlKS5tYWtlQ2hpbGROb2RlKGNoaWxkTmFtZSk7XG59XG5oYXJkZW4obWFrZVN0b3JhZ2VOb2RlQ2hpbGQpO1xudmFyIG1ha2VTZXJpYWxpemVUb1N0b3JhZ2UgPSAoc3RvcmFnZU5vZGUsIG1hcnNoYWxsZXIpID0+IHtcbiAgcmV0dXJuIGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgIGNvbnN0IG1hcnNoYWxsZWQgPSBhd2FpdCBFKG1hcnNoYWxsZXIpLnRvQ2FwRGF0YSh2YWx1ZSk7XG4gICAgY29uc3Qgc2VyaWFsaXplZCA9IEpTT04uc3RyaW5naWZ5KG1hcnNoYWxsZWQpO1xuICAgIHJldHVybiBFKHN0b3JhZ2VOb2RlKS5zZXRWYWx1ZShzZXJpYWxpemVkKTtcbiAgfTtcbn07XG5cbi8vXG52YXIgYXNzZXJ0Q2FwRGF0YTIgPSAoZGF0YSkgPT4ge1xuICBhc3NlcnQudHlwZW9mKGRhdGEsIFwib2JqZWN0XCIpO1xuICBhc3NlcnQoZGF0YSk7XG4gIGFzc2VydC50eXBlb2YoZGF0YS5ib2R5LCBcInN0cmluZ1wiKTtcbiAgYXNzZXJ0KEFycmF5LmlzQXJyYXkoZGF0YS5zbG90cykpO1xufTtcbmhhcmRlbihhc3NlcnRDYXBEYXRhMik7XG52YXIgdW5tYXJzaGFsRnJvbVZzdG9yYWdlID0gKGRhdGEsIGtleSwgZnJvbUNhcERhdGEsIGluZGV4KSA9PiB7XG4gIGNvbnN0IHNlcmlhbGl6ZWQgPSBkYXRhLmdldChrZXkpIHx8IHRocm93UmVkYWN0ZWRgbm8gZGF0YSBmb3IgJHtrZXl9YDtcbiAgYXNzZXJ0LnR5cGVvZihzZXJpYWxpemVkLCBcInN0cmluZ1wiKTtcbiAgYXNzZXJ0LnR5cGVvZihpbmRleCwgXCJudW1iZXJcIik7XG4gIGNvbnN0IHN0cmVhbUNlbGwgPSBKU09OLnBhcnNlKHNlcmlhbGl6ZWQpO1xuICBpZiAoIWlzU3RyZWFtQ2VsbChzdHJlYW1DZWxsKSkge1xuICAgIHRocm93IHRocm93UmVkYWN0ZWRgbm90IGEgU3RyZWFtQ2VsbDogJHtzdHJlYW1DZWxsfWA7XG4gIH1cbiAgY29uc3QgeyB2YWx1ZXM6IHZhbHVlczYgfSA9IHN0cmVhbUNlbGw7XG4gIHZhbHVlczYubGVuZ3RoID4gMCB8fCB0aHJvd1JlZGFjdGVkYG5vIFN0cmVhbUNlbGwgdmFsdWVzOiAke3N0cmVhbUNlbGx9YDtcbiAgY29uc3QgbWFyc2hhbGxlZCA9IHZhbHVlczYuYXQoaW5kZXgpO1xuICBhc3NlcnQudHlwZW9mKG1hcnNoYWxsZWQsIFwic3RyaW5nXCIpO1xuICBjb25zdCBjYXBEYXRhID0gaGFyZGVuKEpTT04ucGFyc2UobWFyc2hhbGxlZCkpO1xuICBhc3NlcnRDYXBEYXRhMihjYXBEYXRhKTtcbiAgY29uc3QgdW5tYXJzaGFsbGVkID0gZnJvbUNhcERhdGEoY2FwRGF0YSk7XG4gIHJldHVybiB1bm1hcnNoYWxsZWQ7XG59O1xuaGFyZGVuKHVubWFyc2hhbEZyb21Wc3RvcmFnZSk7XG52YXIgcmVqZWN0T0NhcCA9IChjYXApID0+IHRocm93UmVkYWN0ZWRgJHtjYXB9IGlzIG5vdCBwdXJlIGRhdGFgO1xudmFyIHB1cmVEYXRhTWFyc2hhbGxlciA9IG1ha2VNYXJzaGFsKHJlamVjdE9DYXAsIHJlamVjdE9DYXAsIHtcbiAgc2VyaWFsaXplQm9keUZvcm1hdDogXCJzbWFsbGNhcHNcIlxufSk7XG5oYXJkZW4ocHVyZURhdGFNYXJzaGFsbGVyKTtcblxuLy9cbnZhciB7IGdldFByb3RvdHlwZU9mOiBnZXRQcm90b3R5cGVPZjksIGNyZWF0ZTogY3JlYXRlNCwgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTAsIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM6IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM3IH0gPSBPYmplY3Q7XG52YXIgeyBvd25LZXlzOiBvd25LZXlzMjAsIGFwcGx5OiBhcHBseTYgfSA9IFJlZmxlY3Q7XG52YXIgY29tcGFyZVN0cmluZ2lmaWVkMiA9IChhMiwgYjMpID0+IHtcbiAgaWYgKHR5cGVvZiBhMiA9PT0gdHlwZW9mIGIzKSB7XG4gICAgY29uc3QgbGVmdCA9IFN0cmluZyhhMik7XG4gICAgY29uc3QgcmlnaHQgPSBTdHJpbmcoYjMpO1xuICAgIHJldHVybiBsZWZ0IDwgcmlnaHQgPyAtMSA6IGxlZnQgPiByaWdodCA/IDEgOiAwO1xuICB9XG4gIGlmICh0eXBlb2YgYTIgPT09IFwic3ltYm9sXCIpIHtcbiAgICBhc3NlcnQodHlwZW9mIGIzID09PSBcInN0cmluZ1wiKTtcbiAgICByZXR1cm4gLTE7XG4gIH1cbiAgYXNzZXJ0KHR5cGVvZiBhMiA9PT0gXCJzdHJpbmdcIik7XG4gIGFzc2VydCh0eXBlb2YgYjMgPT09IFwic3ltYm9sXCIpO1xuICByZXR1cm4gMTtcbn07XG52YXIgZ2V0TWV0aG9kTmFtZXMyID0gKHZhbCkgPT4ge1xuICBsZXQgbGF5ZXIgPSB2YWw7XG4gIGNvbnN0IG5hbWVzID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgd2hpbGUgKGxheWVyICE9PSBudWxsICYmIGxheWVyICE9PSBPYmplY3QucHJvdG90eXBlKSB7XG4gICAgY29uc3QgZGVzY3MgPSBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzNyhsYXllcik7XG4gICAgY29uc3Qgb3duTmFtZXMgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgIG93bktleXMyMChkZXNjcylcbiAgICApO1xuICAgIGZvciAoY29uc3QgbmFtZSBvZiBvd25OYW1lcykge1xuICAgICAgaWYgKHR5cGVvZiB2YWxbbmFtZV0gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBuYW1lcy5hZGQobmFtZSk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghaXNPYmplY3QyKHZhbCkpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBsYXllciA9IGdldFByb3RvdHlwZU9mOShsYXllcik7XG4gIH1cbiAgcmV0dXJuIGhhcmRlbihbLi4ubmFtZXNdLnNvcnQoY29tcGFyZVN0cmluZ2lmaWVkMikpO1xufTtcbmhhcmRlbihnZXRNZXRob2ROYW1lczIpO1xudmFyIGJpbmRBbGxNZXRob2RzID0gKG9iaikgPT4gaGFyZGVuKFxuICBjcmVhdGU0KFxuICAgIG9iaixcbiAgICBmcm9tRW50cmllczEwKFxuICAgICAgZ2V0TWV0aG9kTmFtZXMyKG9iaikubWFwKChuYW1lKSA9PiBbXG4gICAgICAgIG5hbWUsXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogKC4uLmFyZ3MpID0+IGFwcGx5NihvYmpbbmFtZV0sIG9iaiwgYXJncyksXG4gICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZVxuICAgICAgICB9XG4gICAgICBdKVxuICAgIClcbiAgKVxuKTtcbmhhcmRlbihiaW5kQWxsTWV0aG9kcyk7XG5cbi8vXG52YXIgSElTVE9HUkFNX01TX0xBVEVOQ1lfQk9VTkRBUklFUyA9IFtcbiAgNSxcbiAgMTAsXG4gIDI1LFxuICA1MCxcbiAgMTAwLFxuICAyNTAsXG4gIDUwMCxcbiAgMWUzLFxuICAyNTAwLFxuICA1ZTMsXG4gIDFlNCxcbiAgSW5maW5pdHlcbl07XG52YXIgSElTVE9HUkFNX1NFQ09ORFNfTEFURU5DWV9CT1VOREFSSUVTID0gSElTVE9HUkFNX01TX0xBVEVOQ1lfQk9VTkRBUklFUy5tYXAoKG1zKSA9PiBtcyAvIDFlMyk7XG52YXIgSElTVE9HUkFNX01FVFJJQ1MgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBzd2luZ3NldF9jcmFua19wcm9jZXNzaW5nX3RpbWU6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlByb2Nlc3NpbmcgdGltZSBwZXIgY3JhbmsgKG1zKVwiLFxuICAgICAgdW5pdDogXCJtc1wiLFxuICAgICAgYm91bmRhcmllczogQXJyYXkub2YoMSwgMTEsIDIxLCAzMSwgNDEsIDUxLCA2MSwgNzEsIDgxLCA5MSwgSW5maW5pdHkpXG4gICAgfSxcbiAgICBzd2luZ3NldF9ibG9ja19wcm9jZXNzaW5nX3NlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlByb2Nlc3NpbmcgdGltZSBwZXIgYmxvY2tcIixcbiAgICAgIHVuaXQ6IFwic1wiLFxuICAgICAgYm91bmRhcmllczogSElTVE9HUkFNX1NFQ09ORFNfTEFURU5DWV9CT1VOREFSSUVTXG4gICAgfSxcbiAgICBzd2luZ3NldF92YXRfc3RhcnR1cDoge1xuICAgICAgZGVzY3JpcHRpb246IFwiVmF0IHN0YXJ0dXAgdGltZSAobXMpXCIsXG4gICAgICB1bml0OiBcIm1zXCIsXG4gICAgICBib3VuZGFyaWVzOiBISVNUT0dSQU1fTVNfTEFURU5DWV9CT1VOREFSSUVTXG4gICAgfSxcbiAgICBzd2luZ3NldF92YXRfZGVsaXZlcnk6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlZhdCBkZWxpdmVyeSB0aW1lIChtcylcIixcbiAgICAgIHVuaXQ6IFwibXNcIixcbiAgICAgIGJvdW5kYXJpZXM6IEhJU1RPR1JBTV9NU19MQVRFTkNZX0JPVU5EQVJJRVNcbiAgICB9LFxuICAgIHN3aW5nc2V0X21ldGVyX3VzYWdlOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJWYXQgbWV0ZXIgdXNhZ2VcIixcbiAgICAgIHVuaXQ6IFwibXNcIixcbiAgICAgIGJvdW5kYXJpZXM6IEhJU1RPR1JBTV9NU19MQVRFTkNZX0JPVU5EQVJJRVNcbiAgICB9XG4gIH1cbik7XG52YXIgYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjID0ge1xuICAvL1xuICAvL1xuICAvL1xuICAvL1xuICB1bml0OiBcInNcIixcbiAgYWR2aWNlOiB7XG4gICAgZXhwbGljaXRCdWNrZXRCb3VuZGFyaWVzOiBbXG4gICAgICAwLjEsXG4gICAgICAwLjIsXG4gICAgICAwLjMsXG4gICAgICAwLjQsXG4gICAgICAwLjUsXG4gICAgICAxLFxuICAgICAgMixcbiAgICAgIDMsXG4gICAgICA0LFxuICAgICAgNSxcbiAgICAgIDYsXG4gICAgICA3LFxuICAgICAgMTAsXG4gICAgICAxNSxcbiAgICAgIDMwXG4gICAgXVxuICB9XG59O1xudmFyIEJMT0NLX0hJU1RPR1JBTV9NRVRSSUNTID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgc3dpbmdzZXRSdW5TZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQZXItYmxvY2sgdGltZSBzcGVudCBleGVjdXRpbmcgU3dpbmdTZXRcIixcbiAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzY1xuICAgIH0sXG4gICAgc3dpbmdzZXRDaGFpblNhdmVTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQZXItYmxvY2sgdGltZSBzcGVudCBwcm9wYWdhdGluZyBTd2luZ1NldCBzdGF0ZSBpbnRvIGNvc21vc1wiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjXG4gICAgfSxcbiAgICBzd2luZ3NldENvbW1pdFNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IGNvbW1pdHRpbmcgU3dpbmdTZXQgc3RhdGUgdG8gaG9zdCBzdG9yYWdlXCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2NcbiAgICB9LFxuICAgIGNvc21vc0NvbW1pdFNlY29uZHM6IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBcIlBlci1ibG9jayB0aW1lIHNwZW50IGNvbW1pdHRpbmcgY29zbW9zIHN0YXRlXCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2NcbiAgICB9LFxuICAgIGZ1bGxDb21taXRTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQZXItYmxvY2sgdGltZSBzcGVudCBjb21taXR0aW5nIHN0YXRlLCBpbmNsdXNpdmUgb2YgQ09NTUlUX0JMT0NLIHByb2Nlc3NpbmcgcGx1cyB0aW1lIHNwZW50IFtvdXRzaWRlIG9mIGNvc21pYy1zd2luZ3NldF0gYmVmb3JlIGFuZCBhZnRlciBpdFwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjXG4gICAgfSxcbiAgICBpbnRlckJsb2NrU2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiVGltZSBzcGVudCBpZGxlIGJldHdlZW4gYmxvY2tzXCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2NcbiAgICB9LFxuICAgIGFmdGVyQ29tbWl0SGFuZ292ZXJTZWNvbmRzOiB7XG4gICAgICBkZXNjcmlwdGlvbjogXCJQZXItYmxvY2sgdGltZSBzcGVudCB3YWl0aW5nIGZvciBwcmV2aW91cy1ibG9jayBhZnRlckNvbW1pdCB3b3JrXCIsXG4gICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2NcbiAgICB9LFxuICAgIGJsb2NrTGFnU2Vjb25kczoge1xuICAgICAgZGVzY3JpcHRpb246IFwiVGhlIGRlbGF5IG9mIGVhY2ggYmxvY2sgZnJvbSBpdHMgZXhwZWN0ZWQgYmVnaW4gdGltZVwiLFxuICAgICAgLi4uYmxvY2tIaXN0b2dyYW1NZXRyaWNEZXNjLFxuICAgICAgLy9cbiAgICAgIGFkdmljZToge1xuICAgICAgICAuLi5ibG9ja0hpc3RvZ3JhbU1ldHJpY0Rlc2MuYWR2aWNlLFxuICAgICAgICBleHBsaWNpdEJ1Y2tldEJvdW5kYXJpZXM6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIFtcbiAgICAgICAgICAgIC4uLmJsb2NrSGlzdG9ncmFtTWV0cmljRGVzYy5hZHZpY2UuZXhwbGljaXRCdWNrZXRCb3VuZGFyaWVzLFxuICAgICAgICAgICAgLi4uWzYwLCAxMjAsIDE4MCwgMjQwLCAzMDAsIDYwMCwgMzYwMF1cbiAgICAgICAgICBdXG4gICAgICAgIClcbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG52YXIgTWV0cmljVHlwZSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIENvdW50ZXI6IFwiY291bnRlclwiLFxuICAgIEdhdWdlOiBcImdhdWdlXCJcbiAgfVxuKTtcbnZhciBLRVJORUxfU1RBVFNfU1VNX01FVFJJQ1MgPSBbXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbHNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2FsbF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFNlbmRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwic2VuZFwiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IG1lc3NhZ2Ugc2VuZCBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxDYWxsTm93XCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcImNhbGxOb3dcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCBzeW5jaHJvbm91cyBkZXZpY2Uga2VybmVsIGNhbGxzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJzeXNjYWxsU3Vic2NyaWJlXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcInN1YnNjcmliZVwiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHByb21pc2Ugc3Vic2NyaXB0aW9uIGtlcm5lbCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwic3lzY2FsbFJlc29sdmVcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwicmVzb2x2ZVwiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHByb21pc2UgcmVzb2x1dGlvbiBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxFeGl0XCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9zeXNjYWxsX3RvdGFsXCIsXG4gICAgc3ViOiB7IGRpbWVuc2lvbjogXCJzeXNjYWxsXCIsIHZhbHVlOiBcImV4aXRcIiB9LFxuICAgIGRlc2NyaXB0aW9uOiBcIlRvdGFsIG51bWJlciBvZiBTd2luZ1NldCB2YXQgZXhpdCBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxWYXRzdG9yZUdldFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJ2YXRzdG9yZUdldFwiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdHN0b3JlIGdldCBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxWYXRzdG9yZVNldFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJ2YXRzdG9yZVNldFwiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdHN0b3JlIHNldCBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxWYXRzdG9yZUdldE5leHRLZXlcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X3N5c2NhbGxfdG90YWxcIixcbiAgICBzdWI6IHsgZGltZW5zaW9uOiBcInN5c2NhbGxcIiwgdmFsdWU6IFwidmF0c3RvcmVHZXROZXh0XCIgfSxcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0c3RvcmUgZ2V0TmV4dEtleSBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxWYXRzdG9yZURlbGV0ZVwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJ2YXRzdG9yZURlbGV0ZVwiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdHN0b3JlIGRlbGV0ZSBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInN5c2NhbGxEcm9wSW1wb3J0c1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfc3lzY2FsbF90b3RhbFwiLFxuICAgIHN1YjogeyBkaW1lbnNpb246IFwic3lzY2FsbFwiLCB2YWx1ZTogXCJkcm9wSW1wb3J0c1wiIH0sXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IGRyb3AgaW1wb3J0cyBrZXJuZWwgY2FsbHNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImRpc3BhdGNoZXNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2Rpc3BhdGNoX3RvdGFsXCIsXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdCBjYWxsc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwiZGlzcGF0Y2hEZWxpdmVyXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9kaXNwYXRjaF9kZWxpdmVyX3RvdGFsXCIsXG4gICAgZGVzY3JpcHRpb246IFwiVG90YWwgbnVtYmVyIG9mIFN3aW5nU2V0IHZhdCBtZXNzYWdlIGRlbGl2ZXJpZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImRpc3BhdGNoTm90aWZ5XCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9kaXNwYXRjaF9ub3RpZnlfdG90YWxcIixcbiAgICBkZXNjcmlwdGlvbjogXCJUb3RhbCBudW1iZXIgb2YgU3dpbmdTZXQgdmF0IHByb21pc2Ugbm90aWZpY2F0aW9uc1wiXG4gIH1cbl07XG52YXIgS0VSTkVMX1NUQVRTX1VQRE9XTl9NRVRSSUNTID0gW1xuICB7XG4gICAga2V5OiBcImtlcm5lbE9iamVjdHNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2tlcm5lbF9vYmplY3RzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiQWN0aXZlIGtlcm5lbCBvYmplY3RzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJrZXJuZWxEZXZpY2VzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9rZXJuZWxfZGV2aWNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIkFjdGl2ZSBrZXJuZWwgZGV2aWNlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwia2VybmVsUHJvbWlzZXNcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2tlcm5lbF9wcm9taXNlc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIkFjdGl2ZSBrZXJuZWwgcHJvbWlzZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImtwVW5yZXNvbHZlZFwiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfdW5yZXNvbHZlZF9rZXJuZWxfcHJvbWlzZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJVbnJlc29sdmVkIGtlcm5lbCBwcm9taXNlc1wiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwia3BGdWxmaWxsZWRcIixcbiAgICBuYW1lOiBcInN3aW5nc2V0X2Z1bGZpbGxlZF9rZXJuZWxfcHJvbWlzZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJGdWxmaWxsZWQga2VybmVsIHByb21pc2VzXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJrcFJlamVjdGVkXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9yZWplY3RlZF9rZXJuZWxfcHJvbWlzZXNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJSZWplY3RlZCBrZXJuZWwgcHJvbWlzZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcInJ1blF1ZXVlTGVuZ3RoXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9ydW5fcXVldWVfbGVuZ3RoXCIsXG4gICAgY29uc2Vuc3VzOiB0cnVlLFxuICAgIGRlc2NyaXB0aW9uOiBcIkxlbmd0aCBvZiB0aGUga2VybmVsIHJ1biBxdWV1ZVwiXG4gIH0sXG4gIHtcbiAgICBrZXk6IFwiYWNjZXB0YW5jZVF1ZXVlTGVuZ3RoXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9hY2NlcHRhbmNlX3F1ZXVlX2xlbmd0aFwiLFxuICAgIGNvbnNlbnN1czogdHJ1ZSxcbiAgICBkZXNjcmlwdGlvbjogXCJMZW5ndGggb2YgdGhlIGtlcm5lbCBhY2NlcHRhbmNlIHF1ZXVlXCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJwcm9taXNlUXVldWVzTGVuZ3RoXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF9wcm9taXNlX3F1ZXVlc19sZW5ndGhcIixcbiAgICBjb25zZW5zdXM6IHRydWUsXG4gICAgZGVzY3JpcHRpb246IFwiQ29tYmluZWQgbGVuZ3RoIG9mIGFsbCBrZXJuZWwgcHJvbWlzZSBxdWV1ZXNcIlxuICB9LFxuICB7XG4gICAga2V5OiBcImNsaXN0RW50cmllc1wiLFxuICAgIG5hbWU6IFwic3dpbmdzZXRfY2xpc3RfZW50cmllc1wiLFxuICAgIGRlc2NyaXB0aW9uOiBcIk51bWJlciBvZiBlbnRyaWVzIGluIHRoZSBrZXJuZWwgYy1saXN0XCJcbiAgfSxcbiAge1xuICAgIGtleTogXCJ2YXRzXCIsXG4gICAgbmFtZTogXCJzd2luZ3NldF92YXRzXCIsXG4gICAgZGVzY3JpcHRpb246IFwiTnVtYmVyIG9mIGFjdGl2ZSB2YXRzXCJcbiAgfVxuXTtcbnZhciB7IENvdW50ZXIsIEdhdWdlIH0gPSBNZXRyaWNUeXBlO1xudmFyIEtFUk5FTF9TVEFUU19NRVRSSUNTID0gaGFyZGVuKFtcbiAgLi4uS0VSTkVMX1NUQVRTX1NVTV9NRVRSSUNTLm1hcCgobTIpID0+ICh7IC4uLm0yLCBtZXRyaWNUeXBlOiBDb3VudGVyIH0pKSxcbiAgLi4uS0VSTkVMX1NUQVRTX1VQRE9XTl9NRVRSSUNTLm1hcCgobTIpID0+ICh7IC4uLm0yLCBtZXRyaWNUeXBlOiBHYXVnZSB9KSlcbl0pO1xudmFyIGtlcm5lbFN0YXRzS2V5cyA9IC8qICAgICAgICAgICAqLyBuZXcgTWFwKCk7XG5mb3IgKGNvbnN0IHsga2V5IH0gb2YgS0VSTkVMX1NUQVRTX01FVFJJQ1MpIHtcbiAga2VybmVsU3RhdHNLZXlzLnNldChrZXksIChrZXJuZWxTdGF0c0tleXMuZ2V0KGtleSkgfHwgMCkgKyAxKTtcbn1cbnZhciBkdXBsaWNhdGVLZXJuZWxTdGF0c0tleXMgPSBbLi4ua2VybmVsU3RhdHNLZXlzLmVudHJpZXMoKV0uZmxhdE1hcChcbiAgKFtrZXksIHZhbHVlXSkgPT4gdmFsdWUgPiAxID8gW2tleV0gOiBbXVxuKTtcbmlmIChkdXBsaWNhdGVLZXJuZWxTdGF0c0tleXMubGVuZ3RoID4gMCkge1xuICBjb25zdCBtc2cgPSBgRHVwbGljYXRlIGtlcm5lbCBzdGF0cyBrZXlzICR7SlNPTi5zdHJpbmdpZnkoZHVwbGljYXRlS2VybmVsU3RhdHNLZXlzKX1gO1xuICB0aHJvdyBFcnJvcihtc2cpO1xufVxuXG4vL1xudmFyIHsgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczogZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yczgsIGNyZWF0ZTogY3JlYXRlNSwgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTEgfSA9IE9iamVjdDtcbnZhciB7IG93bktleXM6IG93bktleXMyMSB9ID0gUmVmbGVjdDtcbnZhciBvYmplY3RNZXRhTWFwID0gKG9yaWdpbmFsLCBtZXRhTWFwRm4sIHByb3RvID0gT2JqZWN0LnByb3RvdHlwZSkgPT4ge1xuICBjb25zdCBkZXNjcyA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM4KG9yaWdpbmFsKTtcbiAgY29uc3Qga2V5czQgPSBvd25LZXlzMjEob3JpZ2luYWwpO1xuICBjb25zdCBkZXNjRW50cmllcyA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAga2V5czQubWFwKChrZXkpID0+IFtrZXksIG1ldGFNYXBGbihkZXNjc1trZXldLCBrZXkpXSkuZmlsdGVyKChbX2tleSwgb3B0RGVzY10pID0+IG9wdERlc2MgIT09IHZvaWQgMClcbiAgKTtcbiAgcmV0dXJuIGhhcmRlbihjcmVhdGU1KHByb3RvLCBmcm9tRW50cmllczExKGRlc2NFbnRyaWVzKSkpO1xufTtcbmhhcmRlbihvYmplY3RNZXRhTWFwKTtcblxuLy9cbnZhciBmcmVlemU4ID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIE9iamVjdC5mcmVlemVcbik7XG52YXIgbWFrZVF1ZXVlID0gKCkgPT4ge1xuICBsZXQgeyBwcm9taXNlOiB0YWlsUHJvbWlzZSwgcmVzb2x2ZTogdGFpbFJlc29sdmUgfSA9IG1ha2VQcm9taXNlS2l0KCk7XG4gIHJldHVybiB7XG4gICAgcHV0KHZhbHVlKSB7XG4gICAgICBjb25zdCB7IHJlc29sdmU6IHJlc29sdmUyLCBwcm9taXNlIH0gPSBtYWtlUHJvbWlzZUtpdCgpO1xuICAgICAgdGFpbFJlc29sdmUoZnJlZXplOCh7IHZhbHVlLCBwcm9taXNlIH0pKTtcbiAgICAgIHRhaWxSZXNvbHZlID0gcmVzb2x2ZTI7XG4gICAgfSxcbiAgICBnZXQoKSB7XG4gICAgICBjb25zdCBwcm9taXNlID0gdGFpbFByb21pc2UudGhlbigobmV4dCkgPT4gbmV4dC52YWx1ZSk7XG4gICAgICB0YWlsUHJvbWlzZSA9IHRhaWxQcm9taXNlLnRoZW4oKG5leHQpID0+IG5leHQucHJvbWlzZSk7XG4gICAgICByZXR1cm4gaGFyZGVuKHByb21pc2UpO1xuICAgIH1cbiAgfTtcbn07XG5oYXJkZW4obWFrZVF1ZXVlKTtcbnZhciBtYWtlU3RyZWFtID0gKGFja3MsIGRhdGEpID0+IHtcbiAgY29uc3Qgc3RyZWFtID0gaGFyZGVuKHtcbiAgICAvKlxuXG4gICAgICovXG4gICAgbmV4dCh2YWx1ZSkge1xuICAgICAgZGF0YS5wdXQoZnJlZXplOCh7IHZhbHVlLCBkb25lOiBmYWxzZSB9KSk7XG4gICAgICByZXR1cm4gYWNrcy5nZXQoKTtcbiAgICB9LFxuICAgIC8qXG5cbiAgICAgKi9cbiAgICByZXR1cm4odmFsdWUpIHtcbiAgICAgIGRhdGEucHV0KGZyZWV6ZTgoeyB2YWx1ZSwgZG9uZTogdHJ1ZSB9KSk7XG4gICAgICByZXR1cm4gYWNrcy5nZXQoKTtcbiAgICB9LFxuICAgIC8qXG5cbiAgICAgKi9cbiAgICB0aHJvdyhlcnJvcikge1xuICAgICAgZGF0YS5wdXQoaGFyZGVuKFByb21pc2UucmVqZWN0KGVycm9yKSkpO1xuICAgICAgcmV0dXJuIGFja3MuZ2V0KCk7XG4gICAgfSxcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgICAgcmV0dXJuIHN0cmVhbTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gc3RyZWFtO1xufTtcbmhhcmRlbihtYWtlU3RyZWFtKTtcbnZhciBtYWtlUGlwZSA9ICgpID0+IHtcbiAgY29uc3QgZGF0YSA9IG1ha2VRdWV1ZSgpO1xuICBjb25zdCBhY2tzID0gbWFrZVF1ZXVlKCk7XG4gIGNvbnN0IHJlYWRlciA9IG1ha2VTdHJlYW0oYWNrcywgZGF0YSk7XG4gIGNvbnN0IHdyaXRlciA9IG1ha2VTdHJlYW0oZGF0YSwgYWNrcyk7XG4gIHJldHVybiBoYXJkZW4oW3dyaXRlciwgcmVhZGVyXSk7XG59O1xuaGFyZGVuKG1ha2VQaXBlKTtcbnZhciBwdW1wID0gYXN5bmMgKHdyaXRlciwgcmVhZGVyLCBwcmltZXIpID0+IHtcbiAgY29uc3QgdGljayA9IChwcm9taXNlKSA9PiBFLndoZW4oXG4gICAgcHJvbWlzZSxcbiAgICAocmVzdWx0KSA9PiB7XG4gICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgcmV0dXJuIHdyaXRlci5yZXR1cm4ocmVzdWx0LnZhbHVlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0b2NrKHdyaXRlci5uZXh0KHJlc3VsdC52YWx1ZSkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgKGVycm9yKSA9PiB7XG4gICAgICByZXR1cm4gd3JpdGVyLnRocm93KGVycm9yKTtcbiAgICB9XG4gICk7XG4gIGNvbnN0IHRvY2sgPSAocHJvbWlzZSkgPT4gRS53aGVuKFxuICAgIHByb21pc2UsXG4gICAgKHJlc3VsdCkgPT4ge1xuICAgICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICAgIHJldHVybiByZWFkZXIucmV0dXJuKHJlc3VsdC52YWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGljayhyZWFkZXIubmV4dChyZXN1bHQudmFsdWUpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIChlcnJvcikgPT4ge1xuICAgICAgcmV0dXJuIHJlYWRlci50aHJvdyhlcnJvcik7XG4gICAgfVxuICApO1xuICBhd2FpdCB0aWNrKHJlYWRlci5uZXh0KHByaW1lcikpO1xuICByZXR1cm4gdm9pZCAwO1xufTtcbmhhcmRlbihwdW1wKTtcbnZhciBwcmltZSA9IChnZW5lcmF0b3IsIHByaW1lcikgPT4ge1xuICBjb25zdCBmaXJzdCA9IGdlbmVyYXRvci5uZXh0KHByaW1lcik7XG4gIGxldCByZXN1bHQ7XG4gIGNvbnN0IHByaW1lZCA9IGhhcmRlbih7XG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGFzeW5jIG5leHQodmFsdWUpIHtcbiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXN1bHQgPSBhd2FpdCBmaXJzdDtcbiAgICAgICAgaWYgKHJlc3VsdC5kb25lKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGdlbmVyYXRvci5uZXh0KHZhbHVlKTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgYXN5bmMgcmV0dXJuKHZhbHVlKSB7XG4gICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHtcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgZmlyc3Q7XG4gICAgICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBnZW5lcmF0b3IucmV0dXJuKHZhbHVlKTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGFzeW5jIHRocm93KGVycm9yKSB7XG4gICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHtcbiAgICAgICAgcmVzdWx0ID0gYXdhaXQgZmlyc3Q7XG4gICAgICAgIGlmIChyZXN1bHQuZG9uZSkge1xuICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gZ2VuZXJhdG9yLnRocm93KGVycm9yKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gcHJpbWVkO1xufTtcbmhhcmRlbihwcmltZSk7XG52YXIgbWFwUmVhZGVyID0gKHJlYWRlciwgdHJhbnNmb3JtKSA9PiB7XG4gIGFzeW5jIGZ1bmN0aW9uKiB0cmFuc2Zvcm1HZW5lcmF0b3IoKSB7XG4gICAgZm9yIGF3YWl0IChjb25zdCB2YWx1ZSBvZiByZWFkZXIpIHtcbiAgICAgIHlpZWxkIHRyYW5zZm9ybSh2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbiAgaGFyZGVuKHRyYW5zZm9ybUdlbmVyYXRvcik7XG4gIHJldHVybiBoYXJkZW4odHJhbnNmb3JtR2VuZXJhdG9yKCkpO1xufTtcbmhhcmRlbihtYXBSZWFkZXIpO1xudmFyIG1hcFdyaXRlciA9ICh3cml0ZXIsIHRyYW5zZm9ybSkgPT4ge1xuICBjb25zdCB0cmFuc2Zvcm1lZFdyaXRlciA9IGhhcmRlbih7XG4gICAgLypcblxuICAgICAqL1xuICAgIGFzeW5jIG5leHQodmFsdWUpIHtcbiAgICAgIHJldHVybiB3cml0ZXIubmV4dCh0cmFuc2Zvcm0odmFsdWUpKTtcbiAgICB9LFxuICAgIC8qXG5cbiAgICAgKi9cbiAgICBhc3luYyB0aHJvdyhlcnJvcikge1xuICAgICAgcmV0dXJuIHdyaXRlci50aHJvdyhlcnJvcik7XG4gICAgfSxcbiAgICAvKlxuXG4gICAgICovXG4gICAgYXN5bmMgcmV0dXJuKHZhbHVlKSB7XG4gICAgICByZXR1cm4gd3JpdGVyLnJldHVybih2YWx1ZSk7XG4gICAgfSxcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCkge1xuICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkV3JpdGVyO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiB0cmFuc2Zvcm1lZFdyaXRlcjtcbn07XG5oYXJkZW4obWFwV3JpdGVyKTtcblxuLy9cbnZhciBtYWtlUHJvbWlzZSA9IChleGVjdXRvcikgPT4gaGFyZGVuKG5ldyBQcm9taXNlKGV4ZWN1dG9yKSk7XG5oYXJkZW4obWFrZVByb21pc2UpO1xudmFyIG1ha2VNYXAgPSAoZW50cmllc09ySXRlcmFibGUpID0+IGhhcmRlbihuZXcgTWFwKGVudHJpZXNPckl0ZXJhYmxlKSk7XG5oYXJkZW4obWFrZU1hcCk7XG52YXIgbWFrZVNldCA9ICh2YWx1ZXM2KSA9PiBoYXJkZW4obmV3IFNldCh2YWx1ZXM2KSk7XG5oYXJkZW4obWFrZVNldCk7XG52YXIgbWFrZVdlYWtNYXAgPSAoZW50cmllczEwKSA9PiBoYXJkZW4obmV3IFdlYWtNYXAoZW50cmllczEwKSk7XG5oYXJkZW4obWFrZVdlYWtNYXApO1xudmFyIG1ha2VXZWFrU2V0ID0gKHZhbHVlczYpID0+IGhhcmRlbihuZXcgV2Vha1NldCh2YWx1ZXM2KSk7XG5oYXJkZW4obWFrZVdlYWtTZXQpO1xuXG4vL1xudmFyIGFzeW5jR2VuZXJhdGUgPSAobmV4dCkgPT4ge1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBbU3ltYm9sLmFzeW5jSXRlcmF0b3JdOiAoKSA9PiB7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgbmV4dDogYXN5bmMgKCkgPT4gaGFyZGVuKG5leHQoKSlcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59O1xuaGFyZGVuKGFzeW5jR2VuZXJhdGUpO1xuXG4vL1xudmFyIGFzeW5jRG9XaGlsZSA9IChib2R5KSA9PiB7XG4gIHJldHVybiBtYWtlUHJvbWlzZSgocmVzb2x2ZTIsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IGxvb3AgPSBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkb0NvbnRpbnVlID0gYXdhaXQgYm9keSgpO1xuICAgICAgaWYgKCFkb0NvbnRpbnVlKSB7XG4gICAgICAgIHJlc29sdmUyKHZvaWQgMCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGxvb3AoKS5jYXRjaChyZWplY3QpO1xuICAgIH07XG4gICAgbG9vcCgpLmNhdGNoKHJlamVjdCk7XG4gIH0pO1xufTtcbmhhcmRlbihhc3luY0RvV2hpbGUpO1xuXG4vL1xudmFyIHsgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTIsIGtleXMsIHZhbHVlczogdmFsdWVzNCB9ID0gT2JqZWN0O1xudmFyIG1ha2VMaW1pdGVkQ29uc29sZSA9IChtYWtlTG9nZ2VyKSA9PiB7XG4gIGNvbnN0IGxpbWl0ZWRDb25zb2xlID0gKFxuICAgIC8qICAgICAgICAgICAgICAqL1xuICAgIGZyb21FbnRyaWVzMTIobG9nTGV2ZWxzLm1hcCgobGV2ZWwpID0+IFtsZXZlbCwgbWFrZUxvZ2dlcihsZXZlbCldKSlcbiAgKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGhhcmRlbihsaW1pdGVkQ29uc29sZSlcbiAgKTtcbn07XG5oYXJkZW4obWFrZUxpbWl0ZWRDb25zb2xlKTtcbnZhciBhc3NlcnRBbGxEZWZpbmVkID0gKG9iaikgPT4ge1xuICBjb25zdCBtaXNzaW5nMiA9IFtdO1xuICBmb3IgKGNvbnN0IFtrZXksIHZhbF0gb2YgT2JqZWN0LmVudHJpZXMob2JqKSkge1xuICAgIGlmICh2YWwgPT09IHZvaWQgMCkge1xuICAgICAgbWlzc2luZzIucHVzaChrZXkpO1xuICAgIH1cbiAgfVxuICBpZiAobWlzc2luZzIubGVuZ3RoID4gMCkge1xuICAgIHRocm93UmVkYWN0ZWRgbWlzc2luZyAke3F1b3RlKG1pc3NpbmcyKX1gO1xuICB9XG59O1xudmFyIG5vdERvbmUgPSBoYXJkZW4oeyBkb25lOiBmYWxzZSwgdmFsdWU6IHZvaWQgMCB9KTtcbnZhciBhbHdheXNEb25lID0gaGFyZGVuKHsgZG9uZTogdHJ1ZSwgdmFsdWU6IHZvaWQgMCB9KTtcbnZhciBmb3JldmVyID0gYXN5bmNHZW5lcmF0ZSgoKSA9PiBub3REb25lKTtcbnZhciB6aXAgPSAoeHMsIHlzKSA9PiBoYXJkZW4oeHMubWFwKCh4LCBpMikgPT4gW3gsIHlzWytpMl1dKSk7XG52YXIgYWxsVmFsdWVzID0gYXN5bmMgKG9iaikgPT4ge1xuICBjb25zdCByZXNvbHZlZCA9IGF3YWl0IFByb21pc2UuYWxsKHZhbHVlczQob2JqKSk7XG4gIHJldHVybiBoYXJkZW4oZnJvbUVudHJpZXMxMih6aXAoa2V5cyhvYmopLCByZXNvbHZlZCkpKTtcbn07XG5cbi8vXG52YXIgU3RvcmFnZU5vZGVTaGFwZSA9IE0ucmVtb3RhYmxlKFwiU3RvcmFnZU5vZGVcIik7XG52YXIgVW5ndWFyZGVkSGVscGVySSA9IE0uaW50ZXJmYWNlKFxuICBcImhlbHBlclwiLFxuICB7fSxcbiAgLy9cbiAgeyBzbG9wcHk6IHRydWUgfVxuKTtcbnZhciBCcmlkZ2VCaWdJbnRTaGFwZSA9IE0ub3IoTS5udW1iZXIoKSwgTS5zdHJpbmcoKSk7XG5cbi8vXG52YXIgZm9yRWFjaFB1YmxpY2F0aW9uUmVjb3JkID0gYXN5bmMgKHN1YnNjcmliZXIsIGNvbnN1bWVWYWx1ZSkgPT4ge1xuICBjb25zdCBpdGVyYXRvciA9IHN1YnNjcmliZUVhY2goc3Vic2NyaWJlcilbU3ltYm9sLmFzeW5jSXRlcmF0b3JdKCk7XG4gIGxldCBmaW5pc2hlZCA9IGZhbHNlO1xuICBhd2FpdCBudWxsO1xuICB3aGlsZSAoIWZpbmlzaGVkKSB7XG4gICAgY29uc3QgeyB2YWx1ZSwgZG9uZSB9ID0gYXdhaXQgaXRlcmF0b3IubmV4dCgpO1xuICAgIGF3YWl0IGNvbnN1bWVWYWx1ZSh2YWx1ZSk7XG4gICAgZmluaXNoZWQgPSAhIWRvbmU7XG4gIH1cbn07XG52YXIgbWFrZVN0b3JlZFN1YnNjcmliZXIgPSAoc3Vic2NyaWJlciwgc3RvcmFnZU5vZGUsIG1hcnNoYWxsZXIpID0+IHtcbiAgYXNzZXJ0QWxsRGVmaW5lZCh7IHN1YnNjcmliZXIsIHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyIH0pO1xuICBjb25zdCBtYXJzaGFsbFRvU3RvcmFnZSA9IG1ha2VTZXJpYWxpemVUb1N0b3JhZ2Uoc3RvcmFnZU5vZGUsIG1hcnNoYWxsZXIpO1xuICBmb3JFYWNoUHVibGljYXRpb25SZWNvcmQoc3Vic2NyaWJlciwgbWFyc2hhbGxUb1N0b3JhZ2UpLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmVycm9yKFwiU3RvcmVkU3Vic2NyaWJlciBmYWlsZWQgdG8gaXRlcmF0ZVwiLCBlcnIpO1xuICB9KTtcbiAgY29uc3QgdW5zZXJpYWxpemVyID0gRmFyKFwidW5zZXJpYWxpemVyXCIsIHtcbiAgICBmcm9tQ2FwRGF0YTogKGRhdGEpID0+IEUobWFyc2hhbGxlcikuZnJvbUNhcERhdGEoZGF0YSksXG4gICAgdW5zZXJpYWxpemU6IChkYXRhKSA9PiBFKG1hcnNoYWxsZXIpLmZyb21DYXBEYXRhKGRhdGEpXG4gIH0pO1xuICBjb25zdCBzdG9yZXN1YiA9IEZhcihcIlN0b3JlZFN1YnNjcmliZXJcIiwge1xuICAgIHN1YnNjcmliZUFmdGVyOiAocHVibGlzaENvdW50KSA9PiBzdWJzY3JpYmVyLnN1YnNjcmliZUFmdGVyKHB1Ymxpc2hDb3VudCksXG4gICAgZ2V0VXBkYXRlU2luY2U6ICh1cGRhdGVDb3VudCkgPT4gc3Vic2NyaWJlci5nZXRVcGRhdGVTaW5jZSh1cGRhdGVDb3VudCksXG4gICAgZ2V0UGF0aDogKCkgPT4gRShzdG9yYWdlTm9kZSkuZ2V0UGF0aCgpLFxuICAgIGdldFN0b3JlS2V5OiAoKSA9PiBFKHN0b3JhZ2VOb2RlKS5nZXRTdG9yZUtleSgpLFxuICAgIGdldFVuc2VyaWFsaXplcjogKCkgPT4gdW5zZXJpYWxpemVyXG4gIH0pO1xuICByZXR1cm4gc3RvcmVzdWI7XG59O1xudmFyIG1ha2VTdG9yZWRTdWJzY3JpcHRpb24gPSAoc3Vic2NyaXB0aW9uLCBzdG9yYWdlTm9kZSwgbWFyc2hhbGxlciA9IG1ha2VNYXJzaGFsKHZvaWQgMCwgdm9pZCAwLCB7XG4gIG1hcnNoYWxTYXZlRXJyb3I6ICgpID0+IHtcbiAgfSxcbiAgc2VyaWFsaXplQm9keUZvcm1hdDogXCJzbWFsbGNhcHNcIlxufSkpID0+IHtcbiAgY29uc3QgdW5zZXJpYWxpemVyID0gRmFyKFwidW5zZXJpYWxpemVyXCIsIHtcbiAgICBmcm9tQ2FwRGF0YTogKGRhdGEpID0+IEUobWFyc2hhbGxlcikuZnJvbUNhcERhdGEoZGF0YSksXG4gICAgdW5zZXJpYWxpemU6IChkYXRhKSA9PiBFKG1hcnNoYWxsZXIpLmZyb21DYXBEYXRhKGRhdGEpXG4gIH0pO1xuICBsZXQgcHVibGlzaEZhaWxlZCA9IGZhbHNlO1xuICBsZXQgcHVibGlzaEV4Y2VwdGlvbjtcbiAgY29uc3QgZmFpbCA9IChlcnIpID0+IHtcbiAgICBwdWJsaXNoRmFpbGVkID0gdHJ1ZTtcbiAgICBwdWJsaXNoRXhjZXB0aW9uID0gZXJyO1xuICB9O1xuICBjb25zdCBwdWJsaXNoVmFsdWUgPSAob2JqKSA9PiB7XG4gICAgYXNzZXJ0KHN0b3JhZ2VOb2RlKTtcbiAgICBpZiAocHVibGlzaEZhaWxlZCkge1xuICAgICAgdGhyb3cgcHVibGlzaEV4Y2VwdGlvbjtcbiAgICB9XG4gICAgRShtYXJzaGFsbGVyKS50b0NhcERhdGEob2JqKS50aGVuKChzZXJpYWxpemVkKSA9PiB7XG4gICAgICBjb25zdCBlbmNvZGVkID0gSlNPTi5zdHJpbmdpZnkoc2VyaWFsaXplZCk7XG4gICAgICByZXR1cm4gRShzdG9yYWdlTm9kZSkuc2V0VmFsdWUoZW5jb2RlZCk7XG4gICAgfSkuY2F0Y2goZmFpbCk7XG4gIH07XG4gIGlmIChzdG9yYWdlTm9kZSkge1xuICAgIG9ic2VydmVJdGVyYXRpb24oc3Vic2NyaXB0aW9uLCB7XG4gICAgICB1cGRhdGVTdGF0ZTogcHVibGlzaFZhbHVlLFxuICAgICAgZmluaXNoOiBwdWJsaXNoVmFsdWVcbiAgICB9KS5jYXRjaChmYWlsKTtcbiAgfVxuICBjb25zdCBzdG9yZXN1YiA9IEZhcihcIlN0b3JlZFN1YnNjcmlwdGlvblwiLCB7XG4gICAgLy9cbiAgICBnZXRTdG9yZUtleTogYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKCFzdG9yYWdlTm9kZSkge1xuICAgICAgICByZXR1cm4gaGFyZGVuKHsgc3Vic2NyaXB0aW9uIH0pO1xuICAgICAgfVxuICAgICAgY29uc3Qgc3RvcmVLZXkgPSBhd2FpdCBFKHN0b3JhZ2VOb2RlKS5nZXRTdG9yZUtleSgpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7IC4uLnN0b3JlS2V5LCBzdWJzY3JpcHRpb24gfSk7XG4gICAgfSxcbiAgICBnZXRVbnNlcmlhbGl6ZXI6ICgpID0+IHVuc2VyaWFsaXplcixcbiAgICBnZXRTaGFyYWJsZVN1YnNjcmlwdGlvbkludGVybmFsczogKCkgPT4gc3Vic2NyaXB0aW9uLmdldFNoYXJhYmxlU3Vic2NyaXB0aW9uSW50ZXJuYWxzKCksXG4gICAgW1N5bWJvbC5hc3luY0l0ZXJhdG9yXTogKCkgPT4gc3Vic2NyaXB0aW9uW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpLFxuICAgIHN1YnNjcmliZUFmdGVyOiAocHVibGlzaENvdW50KSA9PiBzdWJzY3JpcHRpb24uc3Vic2NyaWJlQWZ0ZXIocHVibGlzaENvdW50KVxuICB9KTtcbiAgcmV0dXJuIHN0b3Jlc3ViO1xufTtcbmhhcmRlbihtYWtlU3RvcmVkU3Vic2NyaXB0aW9uKTtcbnZhciBtYWtlU3RvcmVkUHVibGlzaEtpdCA9IChzdG9yYWdlTm9kZSwgbWFyc2hhbGxlcikgPT4ge1xuICBjb25zdCB7IHB1Ymxpc2hlciwgc3Vic2NyaWJlciB9ID0gbWFrZVB1Ymxpc2hLaXQoKTtcbiAgcmV0dXJuIHtcbiAgICBwdWJsaXNoZXIsXG4gICAgLy9cbiAgICBzdWJzY3JpYmVyOiBtYWtlU3RvcmVkU3Vic2NyaWJlcihzdWJzY3JpYmVyLCBzdG9yYWdlTm9kZSwgbWFyc2hhbGxlcilcbiAgfTtcbn07XG5oYXJkZW4obWFrZVN0b3JlZFB1Ymxpc2hLaXQpO1xuXG4vL1xudmFyIG1ha2VUcmFuc2llbnROb3RpZmllcktpdCA9ICgpID0+IHtcbiAgY29uc3QgdHJhbnNpZW50Tm90aWZlcktpdHMgPSBtYWtlU2NhbGFyQmlnV2Vha01hcFN0b3JlKFxuICAgIFwidHJhbnNpZW50Tm90aWZlcktpdHNcIlxuICApO1xuICBjb25zdCBwcm92aWRlTm90aWZpZXJLaXQgPSAoa2V5KSA9PiBwcm92aWRlTGF6eShcbiAgICB0cmFuc2llbnROb3RpZmVyS2l0cyxcbiAgICBrZXksXG4gICAgKCkgPT4gbWFrZU5vdGlmaWVyS2l0KGtleS5nZXRDdXJyZW50QW1vdW50KCkpXG4gICk7XG4gIGNvbnN0IHByb3ZpZGVOb3RpZmllciA9IChrZXkpID0+IHByb3ZpZGVOb3RpZmllcktpdChrZXkpLm5vdGlmaWVyO1xuICBjb25zdCB1cGRhdGUgPSAoa2V5LCBuZXdWYWx1ZSkgPT4ge1xuICAgIGlmICh0cmFuc2llbnROb3RpZmVyS2l0cy5oYXMoa2V5KSkge1xuICAgICAgY29uc3QgeyB1cGRhdGVyIH0gPSB0cmFuc2llbnROb3RpZmVyS2l0cy5nZXQoa2V5KTtcbiAgICAgIHVwZGF0ZXIudXBkYXRlU3RhdGUobmV3VmFsdWUpO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIHsgcHJvdmlkZU5vdGlmaWVyLCB1cGRhdGUgfTtcbn07XG5oYXJkZW4obWFrZVRyYW5zaWVudE5vdGlmaWVyS2l0KTtcblxuLy9cbnZhciBtYWtlQW1vdW50U3RvcmUgPSAoc3RhdGUsIGtleSkgPT4ge1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBnZXRBbW91bnQ6ICgpID0+IHN0YXRlW2tleV0sXG4gICAgaW5jcmVtZW50OiAoZGVsdGEpID0+IHtcbiAgICAgIHN0YXRlW2tleV0gPSBBbW91bnRNYXRoLmFkZChzdGF0ZVtrZXldLCBkZWx0YSk7XG4gICAgfSxcbiAgICBkZWNyZW1lbnQ6IChkZWx0YSkgPT4ge1xuICAgICAgaWYgKEFtb3VudE1hdGguaXNHVEUoc3RhdGVba2V5XSwgZGVsdGEpKSB7XG4gICAgICAgIHN0YXRlW2tleV0gPSBBbW91bnRNYXRoLnN1YnRyYWN0KHN0YXRlW2tleV0sIGRlbHRhKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4obWFrZUFtb3VudFN0b3JlKTtcblxuLy9cbnZhciBFTVBUWV9DT1BZX1NFVCA9IG1ha2VDb3B5U2V0KFtdKTtcbnZhciBwcmVwYXJlUHVyc2VLaW5kID0gKGlzc3VlclpvbmUsIG5hbWUsIGFzc2V0S2luZCwgYnJhbmQsIFB1cnNlSUtpdCwgcHVyc2VNZXRob2RzLCByZWNvdmVyeVNldHNTdGF0ZSwgcGF5bWVudFJlY292ZXJ5U2V0cykgPT4ge1xuICBjb25zdCBhbW91bnRTaGFwZSA9IGJyYW5kLmdldEFtb3VudFNoYXBlKCk7XG4gIGNvbnN0IHsgcHJvdmlkZU5vdGlmaWVyLCB1cGRhdGU6IHVwZGF0ZUJhbGFuY2UgfSA9IG1ha2VUcmFuc2llbnROb3RpZmllcktpdCgpO1xuICBjb25zdCBtYXliZVJlY292ZXJ5U2V0ID0gKHN0YXRlKSA9PiB7XG4gICAgY29uc3QgeyByZWNvdmVyeVNldCB9ID0gc3RhdGU7XG4gICAgaWYgKHJlY292ZXJ5U2V0c1N0YXRlID09PSBcImhhc1JlY292ZXJ5U2V0c1wiKSB7XG4gICAgICByZXR1cm4gcmVjb3ZlcnlTZXQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlY292ZXJ5U2V0c1N0YXRlID09PSBcIm5vUmVjb3ZlcnlTZXRzXCIgfHwgdGhyb3dSZWRhY3RlZGByZWNvdmVyU2V0c1N0YXRlIG11c3QgYmUgbm9SZWNvdmVyeVNldHMgaWYgaXQgaXNuJ3QgaGFzUmVjb3ZlclNldHNgO1xuICAgICAgcGF5bWVudFJlY292ZXJ5U2V0cyAhPT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgcGF5bWVudFJlY292ZXJ5U2V0cyBtdXN0IGFsd2F5cyBiZSBkZWZpbmVkYDtcbiAgICAgIHJlY292ZXJ5U2V0LmdldFNpemUoKSA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYFdpdGggbm9SZWNvdmVyeVNldHMsIHJlY292ZXJ5U2V0IG11c3QgYmUgZW1wdHlgO1xuICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHsgZGVwb3NpdEludGVybmFsLCB3aXRoZHJhd0ludGVybmFsIH0gPSBwdXJzZU1ldGhvZHM7XG4gIGNvbnN0IG1ha2VQdXJzZUtpdCA9IGlzc3VlclpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgYCR7bmFtZX0gUHVyc2VgLFxuICAgIFB1cnNlSUtpdCxcbiAgICAoKSA9PiB7XG4gICAgICBjb25zdCBjdXJyZW50QmFsYW5jZSA9IEFtb3VudE1hdGgubWFrZUVtcHR5KGJyYW5kLCBhc3NldEtpbmQpO1xuICAgICAgY29uc3QgcmVjb3ZlcnlTZXQgPSBpc3N1ZXJab25lLmRldGFjaGVkKCkuc2V0U3RvcmUoXCJyZWNvdmVyeSBzZXRcIik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjdXJyZW50QmFsYW5jZSxcbiAgICAgICAgcmVjb3ZlcnlTZXRcbiAgICAgIH07XG4gICAgfSxcbiAgICB7XG4gICAgICBwdXJzZToge1xuICAgICAgICBkZXBvc2l0KHNyY1BheW1lbnQsIG9wdEFtb3VudFNoYXBlID0gdm9pZCAwKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICBjb25zdCB7IHB1cnNlIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCBiYWxhbmNlU3RvcmUgPSBtYWtlQW1vdW50U3RvcmUoc3RhdGUsIFwiY3VycmVudEJhbGFuY2VcIik7XG4gICAgICAgICAgY29uc3Qgc3JjUGF5bWVudEJhbGFuY2UgPSBkZXBvc2l0SW50ZXJuYWwoXG4gICAgICAgICAgICBiYWxhbmNlU3RvcmUsXG4gICAgICAgICAgICBzcmNQYXltZW50LFxuICAgICAgICAgICAgb3B0QW1vdW50U2hhcGVcbiAgICAgICAgICApO1xuICAgICAgICAgIHVwZGF0ZUJhbGFuY2UocHVyc2UsIGJhbGFuY2VTdG9yZS5nZXRBbW91bnQoKSk7XG4gICAgICAgICAgcmV0dXJuIHNyY1BheW1lbnRCYWxhbmNlO1xuICAgICAgICB9LFxuICAgICAgICB3aXRoZHJhdyhhbW91bnQpIHtcbiAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgIGNvbnN0IHsgcHVyc2UgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IG9wdFJlY292ZXJ5U2V0ID0gbWF5YmVSZWNvdmVyeVNldChzdGF0ZSk7XG4gICAgICAgICAgY29uc3QgYmFsYW5jZVN0b3JlID0gbWFrZUFtb3VudFN0b3JlKHN0YXRlLCBcImN1cnJlbnRCYWxhbmNlXCIpO1xuICAgICAgICAgIGNvbnN0IHBheW1lbnQgPSB3aXRoZHJhd0ludGVybmFsKFxuICAgICAgICAgICAgYmFsYW5jZVN0b3JlLFxuICAgICAgICAgICAgYW1vdW50LFxuICAgICAgICAgICAgb3B0UmVjb3ZlcnlTZXRcbiAgICAgICAgICApO1xuICAgICAgICAgIHVwZGF0ZUJhbGFuY2UocHVyc2UsIGJhbGFuY2VTdG9yZS5nZXRBbW91bnQoKSk7XG4gICAgICAgICAgcmV0dXJuIHBheW1lbnQ7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEN1cnJlbnRBbW91bnQoKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICBjb25zdCBiYWxhbmNlU3RvcmUgPSBtYWtlQW1vdW50U3RvcmUoc3RhdGUsIFwiY3VycmVudEJhbGFuY2VcIik7XG4gICAgICAgICAgcmV0dXJuIGJhbGFuY2VTdG9yZS5nZXRBbW91bnQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0Q3VycmVudEFtb3VudE5vdGlmaWVyKCkge1xuICAgICAgICAgIHJldHVybiBwcm92aWRlTm90aWZpZXIodGhpcy5mYWNldHMucHVyc2UpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRBbGxlZ2VkQnJhbmQoKSB7XG4gICAgICAgICAgcmV0dXJuIGJyYW5kO1xuICAgICAgICB9LFxuICAgICAgICBnZXREZXBvc2l0RmFjZXQoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmFjZXRzLmRlcG9zaXRGYWNldDtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0UmVjb3ZlcnlTZXQoKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICBjb25zdCBvcHRSZWNvdmVyeVNldCA9IG1heWJlUmVjb3ZlcnlTZXQoc3RhdGUpO1xuICAgICAgICAgIGlmIChvcHRSZWNvdmVyeVNldCA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gRU1QVFlfQ09QWV9TRVQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBvcHRSZWNvdmVyeVNldC5zbmFwc2hvdCgpO1xuICAgICAgICB9LFxuICAgICAgICByZWNvdmVyQWxsKCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICBsZXQgYW1vdW50ID0gQW1vdW50TWF0aC5tYWtlRW1wdHkoYnJhbmQsIGFzc2V0S2luZCk7XG4gICAgICAgICAgY29uc3Qgb3B0UmVjb3ZlcnlTZXQgPSBtYXliZVJlY292ZXJ5U2V0KHN0YXRlKTtcbiAgICAgICAgICBpZiAob3B0UmVjb3ZlcnlTZXQgPT09IHZvaWQgMCkge1xuICAgICAgICAgICAgcmV0dXJuIGFtb3VudDtcbiAgICAgICAgICB9XG4gICAgICAgICAgZm9yIChjb25zdCBwYXltZW50IG9mIG9wdFJlY292ZXJ5U2V0LmtleXMoKSkge1xuICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBmYWNldHMucHVyc2UuZGVwb3NpdChwYXltZW50KTtcbiAgICAgICAgICAgIGFtb3VudCA9IEFtb3VudE1hdGguYWRkKGFtb3VudCwgZGVsdGEsIGJyYW5kKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb3B0UmVjb3ZlcnlTZXQuZ2V0U2l6ZSgpID09PSAwIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IFJlbWFpbmluZyB1bnJlY292ZXJlZCBwYXltZW50czogJHtmYWNldHMucHVyc2UuZ2V0UmVjb3ZlcnlTZXQoKX1gO1xuICAgICAgICAgIHJldHVybiBhbW91bnQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkZXBvc2l0RmFjZXQ6IHtcbiAgICAgICAgcmVjZWl2ZSguLi5hcmdzKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmFjZXRzLnB1cnNlLmRlcG9zaXQoLi4uYXJncyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIHN0YXRlU2hhcGU6IHtcbiAgICAgICAgY3VycmVudEJhbGFuY2U6IGFtb3VudFNoYXBlLFxuICAgICAgICByZWNvdmVyeVNldDogTS5yZW1vdGFibGUoXCJyZWNvdmVyeVNldFwiKVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuICgpID0+IG1ha2VQdXJzZUtpdCgpLnB1cnNlO1xufTtcbmhhcmRlbihwcmVwYXJlUHVyc2VLaW5kKTtcblxuLy9cbnZhciBhbW91bnRTaGFwZUZyb21FbGVtZW50U2hhcGUgPSAoYnJhbmQsIGFzc2V0S2luZCwgZWxlbWVudFNoYXBlKSA9PiB7XG4gIGxldCB2YWx1ZVNoYXBlO1xuICBzd2l0Y2ggKGFzc2V0S2luZCkge1xuICAgIGNhc2UgXCJuYXRcIjoge1xuICAgICAgdmFsdWVTaGFwZSA9IE0ubmF0KCk7XG4gICAgICBlbGVtZW50U2hhcGUgPT09IHZvaWQgMCB8fCB0aHJvd1JlZGFjdGVkYEZ1bmdpYmxlIGFzc2V0cyBjYW5ub3QgaGF2ZSBhbiBlbGVtZW50U2hhcGU6ICR7cXVvdGUoZWxlbWVudFNoYXBlKX1gO1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgXCJzZXRcIjoge1xuICAgICAgaWYgKGVsZW1lbnRTaGFwZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHZhbHVlU2hhcGUgPSBNLmFycmF5T2YoTS5rZXkoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5hcnJheU9mKE0uYW5kKE0ua2V5KCksIGVsZW1lbnRTaGFwZSkpO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGNhc2UgXCJjb3B5U2V0XCI6IHtcbiAgICAgIGlmIChlbGVtZW50U2hhcGUgPT09IHZvaWQgMCkge1xuICAgICAgICB2YWx1ZVNoYXBlID0gTS5zZXQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlU2hhcGUgPSBNLnNldE9mKGVsZW1lbnRTaGFwZSk7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgY2FzZSBcImNvcHlCYWdcIjoge1xuICAgICAgaWYgKGVsZW1lbnRTaGFwZSA9PT0gdm9pZCAwKSB7XG4gICAgICAgIHZhbHVlU2hhcGUgPSBNLmJhZygpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWVTaGFwZSA9IE0uYmFnT2YoZWxlbWVudFNoYXBlKTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgYXNzZXQga2luZCAke3F1b3RlKGFzc2V0S2luZCl9YDtcbiAgICB9XG4gIH1cbiAgY29uc3QgYW1vdW50U2hhcGUgPSBoYXJkZW4oe1xuICAgIGJyYW5kLFxuICAgIC8vXG4gICAgdmFsdWU6IHZhbHVlU2hhcGVcbiAgfSk7XG4gIHJldHVybiBhbW91bnRTaGFwZTtcbn07XG52YXIgcHJlcGFyZVBheW1lbnRMZWRnZXIgPSAoaXNzdWVyWm9uZSwgbmFtZSwgYXNzZXRLaW5kLCBkaXNwbGF5SW5mbywgZWxlbWVudFNoYXBlLCByZWNvdmVyeVNldHNTdGF0ZSwgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSA9IHZvaWQgMCkgPT4ge1xuICBjb25zdCBicmFuZCA9IGlzc3VlclpvbmUuZXhvKGAke25hbWV9IGJyYW5kYCwgQnJhbmRJLCB7XG4gICAgaXNNeUlzc3VlcihhbGxlZ2VkSXNzdWVyKSB7XG4gICAgICByZXR1cm4gYWxsZWdlZElzc3VlciA9PT0gaXNzdWVyO1xuICAgIH0sXG4gICAgZ2V0QWxsZWdlZE5hbWUoKSB7XG4gICAgICByZXR1cm4gbmFtZTtcbiAgICB9LFxuICAgIC8vXG4gICAgZ2V0RGlzcGxheUluZm8oKSB7XG4gICAgICByZXR1cm4gZGlzcGxheUluZm87XG4gICAgfSxcbiAgICBnZXRBbW91bnRTaGFwZSgpIHtcbiAgICAgIHJldHVybiBhbW91bnRTaGFwZTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBhbW91bnRTaGFwZSA9IGFtb3VudFNoYXBlRnJvbUVsZW1lbnRTaGFwZShcbiAgICBicmFuZCxcbiAgICBhc3NldEtpbmQsXG4gICAgZWxlbWVudFNoYXBlXG4gICk7XG4gIGNvbnN0IHsgSXNzdWVySSwgTWludEksIFBheW1lbnRJLCBQdXJzZUlLaXQgfSA9IG1ha2VJc3N1ZXJJbnRlcmZhY2VzKFxuICAgIGJyYW5kLFxuICAgIGFzc2V0S2luZCxcbiAgICBhbW91bnRTaGFwZVxuICApO1xuICBjb25zdCBtYWtlUGF5bWVudCA9IHByZXBhcmVQYXltZW50S2luZChpc3N1ZXJab25lLCBuYW1lLCBicmFuZCwgUGF5bWVudEkpO1xuICBjb25zdCBzaHV0ZG93bkxlZGdlcldpdGhGYWlsdXJlID0gKHJlYXNvbikgPT4ge1xuICAgIGlmIChvcHRTaHV0ZG93bldpdGhGYWlsdXJlICE9PSB2b2lkIDApIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIG9wdFNodXRkb3duV2l0aEZhaWx1cmUocmVhc29uKTtcbiAgICAgIH0gY2F0Y2ggKGVyckluU2h1dGRvd24pIHtcbiAgICAgICAgbm90ZShlcnJJblNodXRkb3duLCByZWRhY3RlZGBDYXVzZWQgYnk6ICR7cmVhc29ufWApO1xuICAgICAgICB0aHJvdyBlcnJJblNodXRkb3duO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyByZWFzb247XG4gIH07XG4gIGNvbnN0IHBheW1lbnRMZWRnZXIgPSBpc3N1ZXJab25lLndlYWtNYXBTdG9yZShcInBheW1lbnRMZWRnZXJcIiwge1xuICAgIHZhbHVlU2hhcGU6IGFtb3VudFNoYXBlXG4gIH0pO1xuICBjb25zdCBwYXltZW50UmVjb3ZlcnlTZXRzID0gaXNzdWVyWm9uZS53ZWFrTWFwU3RvcmUoXCJwYXltZW50UmVjb3ZlcnlTZXRzXCIpO1xuICBjb25zdCBpbml0UGF5bWVudCA9IChwYXltZW50LCBhbW91bnQsIG9wdFJlY292ZXJ5U2V0ID0gdm9pZCAwKSA9PiB7XG4gICAgaWYgKHJlY292ZXJ5U2V0c1N0YXRlID09PSBcIm5vUmVjb3ZlcnlTZXRzXCIpIHtcbiAgICAgIG9wdFJlY292ZXJ5U2V0ID09PSB2b2lkIDAgfHwgdGhyb3dSZWRhY3RlZGB3aGVuIHJlY292ZXJTZXRzU3RhdGUgPT09ICdub1JlY292ZXJ5U2V0cycsIG9wdFJlY292ZXJ5U2V0IG11c3QgYmUgZW1wdHlgO1xuICAgIH1cbiAgICBpZiAob3B0UmVjb3ZlcnlTZXQgIT09IHZvaWQgMCAmJiAhQW1vdW50TWF0aC5pc0VtcHR5KGFtb3VudCkpIHtcbiAgICAgIG9wdFJlY292ZXJ5U2V0LmFkZChwYXltZW50KTtcbiAgICAgIHBheW1lbnRSZWNvdmVyeVNldHMuaW5pdChwYXltZW50LCBvcHRSZWNvdmVyeVNldCk7XG4gICAgfVxuICAgIHBheW1lbnRMZWRnZXIuaW5pdChwYXltZW50LCBhbW91bnQpO1xuICB9O1xuICBjb25zdCBkZWxldGVQYXltZW50ID0gKHBheW1lbnQpID0+IHtcbiAgICBwYXltZW50TGVkZ2VyLmRlbGV0ZShwYXltZW50KTtcbiAgICBpZiAocGF5bWVudFJlY292ZXJ5U2V0cy5oYXMocGF5bWVudCkpIHtcbiAgICAgIGNvbnN0IHJlY292ZXJ5U2V0ID0gcGF5bWVudFJlY292ZXJ5U2V0cy5nZXQocGF5bWVudCk7XG4gICAgICBwYXltZW50UmVjb3ZlcnlTZXRzLmRlbGV0ZShwYXltZW50KTtcbiAgICAgIHJlY292ZXJ5U2V0LmRlbGV0ZShwYXltZW50KTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGNvZXJjZSA9IChhbGxlZ2VkQW1vdW50KSA9PiBBbW91bnRNYXRoLmNvZXJjZShicmFuZCwgYWxsZWdlZEFtb3VudCk7XG4gIGNvbnN0IGFzc2VydEFtb3VudENvbnNpc3RlbnQgPSAocGF5bWVudEJhbGFuY2UsIG9wdEFtb3VudFNoYXBlKSA9PiB7XG4gICAgaWYgKG9wdEFtb3VudFNoYXBlICE9PSB2b2lkIDApIHtcbiAgICAgIG11c3RNYXRjaDIocGF5bWVudEJhbGFuY2UsIG9wdEFtb3VudFNoYXBlLCBcImFtb3VudFwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFzc2VydExpdmVQYXltZW50ID0gKHBheW1lbnQpID0+IHtcbiAgICBwYXltZW50TGVkZ2VyLmhhcyhwYXltZW50KSB8fCB0aHJvd1JlZGFjdGVkYCR7cGF5bWVudH0gd2FzIG5vdCBhIGxpdmUgcGF5bWVudCBmb3IgYnJhbmQgJHtxdW90ZShcbiAgICAgIGJyYW5kXG4gICAgKX0uIEl0IGNvdWxkIGJlIGEgdXNlZC11cCBwYXltZW50LCBhIHBheW1lbnQgZm9yIGFub3RoZXIgYnJhbmQsIG9yIGl0IG1pZ2h0IG5vdCBiZSBhIHBheW1lbnQgYXQgYWxsLmA7XG4gIH07XG4gIGNvbnN0IGRlcG9zaXRJbnRlcm5hbCA9IChiYWxhbmNlU3RvcmUsIHNyY1BheW1lbnQsIG9wdEFtb3VudFNoYXBlID0gdm9pZCAwKSA9PiB7XG4gICAgIWlzUHJvbWlzZShzcmNQYXltZW50KSB8fCBhc3NlcnQuZmFpbChcbiAgICAgIGBkZXBvc2l0IGRvZXMgbm90IGFjY2VwdCBwcm9taXNlcyBhcyBmaXJzdCBhcmd1bWVudC4gSW5zdGVhZCBvZiBwYXNzaW5nIHRoZSBwcm9taXNlIChkZXBvc2l0KHBheW1lbnRQcm9taXNlKSksIGNvbnNpZGVyIHVud3JhcHBpbmcgdGhlIHByb21pc2UgZmlyc3Q6IEUud2hlbihwYXltZW50UHJvbWlzZSwgKGFjdHVhbFBheW1lbnQgPT4gZGVwb3NpdChhY3R1YWxQYXltZW50KSlgLFxuICAgICAgVHlwZUVycm9yXG4gICAgKTtcbiAgICBhc3NlcnRMaXZlUGF5bWVudChzcmNQYXltZW50KTtcbiAgICBjb25zdCBzcmNQYXltZW50QmFsYW5jZSA9IHBheW1lbnRMZWRnZXIuZ2V0KHNyY1BheW1lbnQpO1xuICAgIGFzc2VydEFtb3VudENvbnNpc3RlbnQoc3JjUGF5bWVudEJhbGFuY2UsIG9wdEFtb3VudFNoYXBlKTtcbiAgICB0cnkge1xuICAgICAgZGVsZXRlUGF5bWVudChzcmNQYXltZW50KTtcbiAgICAgIGJhbGFuY2VTdG9yZS5pbmNyZW1lbnQoc3JjUGF5bWVudEJhbGFuY2UpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgc2h1dGRvd25MZWRnZXJXaXRoRmFpbHVyZShlcnIpO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICByZXR1cm4gc3JjUGF5bWVudEJhbGFuY2U7XG4gIH07XG4gIGNvbnN0IHdpdGhkcmF3SW50ZXJuYWwgPSAoYmFsYW5jZVN0b3JlLCBhbW91bnQsIHJlY292ZXJ5U2V0ID0gdm9pZCAwKSA9PiB7XG4gICAgYW1vdW50ID0gY29lcmNlKGFtb3VudCk7XG4gICAgY29uc3QgcGF5bWVudCA9IG1ha2VQYXltZW50KCk7XG4gICAgYmFsYW5jZVN0b3JlLmRlY3JlbWVudChhbW91bnQpIHx8IHRocm93UmVkYWN0ZWRgV2l0aGRyYXdhbCBvZiAke2Ftb3VudH0gZmFpbGVkIGJlY2F1c2UgdGhlIHB1cnNlIG9ubHkgY29udGFpbmVkICR7YmFsYW5jZVN0b3JlLmdldEFtb3VudCgpfWA7XG4gICAgdHJ5IHtcbiAgICAgIGluaXRQYXltZW50KHBheW1lbnQsIGFtb3VudCwgcmVjb3ZlcnlTZXQpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgc2h1dGRvd25MZWRnZXJXaXRoRmFpbHVyZShlcnIpO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgICByZXR1cm4gcGF5bWVudDtcbiAgfTtcbiAgY29uc3QgbWFrZUVtcHR5UHVyc2UgPSBwcmVwYXJlUHVyc2VLaW5kKFxuICAgIGlzc3VlclpvbmUsXG4gICAgbmFtZSxcbiAgICBhc3NldEtpbmQsXG4gICAgYnJhbmQsXG4gICAgUHVyc2VJS2l0LFxuICAgIGhhcmRlbih7XG4gICAgICBkZXBvc2l0SW50ZXJuYWwsXG4gICAgICB3aXRoZHJhd0ludGVybmFsXG4gICAgfSksXG4gICAgcmVjb3ZlcnlTZXRzU3RhdGUsXG4gICAgcGF5bWVudFJlY292ZXJ5U2V0c1xuICApO1xuICBjb25zdCBpc3N1ZXIgPSBpc3N1ZXJab25lLmV4byhgJHtuYW1lfSBpc3N1ZXJgLCBJc3N1ZXJJLCB7XG4gICAgZ2V0QnJhbmQoKSB7XG4gICAgICByZXR1cm4gYnJhbmQ7XG4gICAgfSxcbiAgICBnZXRBbGxlZ2VkTmFtZSgpIHtcbiAgICAgIHJldHVybiBuYW1lO1xuICAgIH0sXG4gICAgZ2V0QXNzZXRLaW5kKCkge1xuICAgICAgcmV0dXJuIGFzc2V0S2luZDtcbiAgICB9LFxuICAgIGdldERpc3BsYXlJbmZvKCkge1xuICAgICAgcmV0dXJuIGRpc3BsYXlJbmZvO1xuICAgIH0sXG4gICAgbWFrZUVtcHR5UHVyc2UoKSB7XG4gICAgICByZXR1cm4gbWFrZUVtcHR5UHVyc2UoKTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIGlzTGl2ZShwYXltZW50KSB7XG4gICAgICByZXR1cm4gcGF5bWVudExlZGdlci5oYXMocGF5bWVudCk7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBnZXRBbW91bnRPZihwYXltZW50KSB7XG4gICAgICBhc3NlcnRMaXZlUGF5bWVudChwYXltZW50KTtcbiAgICAgIHJldHVybiBwYXltZW50TGVkZ2VyLmdldChwYXltZW50KTtcbiAgICB9LFxuICAgIC8qXG5cblxuICAgICAqL1xuICAgIGJ1cm4ocGF5bWVudCwgb3B0QW1vdW50U2hhcGUgPSB2b2lkIDApIHtcbiAgICAgIGFzc2VydExpdmVQYXltZW50KHBheW1lbnQpO1xuICAgICAgY29uc3QgcGF5bWVudEJhbGFuY2UgPSBwYXltZW50TGVkZ2VyLmdldChwYXltZW50KTtcbiAgICAgIGFzc2VydEFtb3VudENvbnNpc3RlbnQocGF5bWVudEJhbGFuY2UsIG9wdEFtb3VudFNoYXBlKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGRlbGV0ZVBheW1lbnQocGF5bWVudCk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgc2h1dGRvd25MZWRnZXJXaXRoRmFpbHVyZShlcnIpO1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGF5bWVudEJhbGFuY2U7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgbWludFJlY292ZXJ5UHVyc2UgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgKi9cbiAgICBpc3N1ZXJab25lLm1ha2VPbmNlKFwibWludFJlY292ZXJ5UHVyc2VcIiwgKCkgPT4gbWFrZUVtcHR5UHVyc2UoKSlcbiAgKTtcbiAgY29uc3QgbWludCA9IGlzc3VlclpvbmUuZXhvKGAke25hbWV9IG1pbnRgLCBNaW50SSwge1xuICAgIGdldElzc3VlcigpIHtcbiAgICAgIHJldHVybiBpc3N1ZXI7XG4gICAgfSxcbiAgICBtaW50UGF5bWVudChuZXdBbW91bnQpIHtcbiAgICAgIG5ld0Ftb3VudCA9IGNvZXJjZShuZXdBbW91bnQpO1xuICAgICAgbXVzdE1hdGNoMihuZXdBbW91bnQsIGFtb3VudFNoYXBlLCBcIm1pbnRlZCBhbW91bnRcIik7XG4gICAgICBjb25zdCByYXdQYXltZW50ID0gbWFrZVBheW1lbnQoKTtcbiAgICAgIGluaXRQYXltZW50KHJhd1BheW1lbnQsIG5ld0Ftb3VudCwgdm9pZCAwKTtcbiAgICAgIGNvbnN0IG1pbnRSZWNvdmVyeVB1cnNlQmVmb3JlID0gbWludFJlY292ZXJ5UHVyc2UuZ2V0Q3VycmVudEFtb3VudCgpO1xuICAgICAgbWludFJlY292ZXJ5UHVyc2UuZGVwb3NpdChyYXdQYXltZW50LCBuZXdBbW91bnQpO1xuICAgICAgY29uc3QgcGF5bWVudCA9IG1pbnRSZWNvdmVyeVB1cnNlLndpdGhkcmF3KG5ld0Ftb3VudCk7XG4gICAgICBjb25zdCBtaW50UmVjb3ZlcnlQdXJzZUFmdGVyID0gbWludFJlY292ZXJ5UHVyc2UuZ2V0Q3VycmVudEFtb3VudCgpO1xuICAgICAgYXNzZXJ0KGtleUVRKG1pbnRSZWNvdmVyeVB1cnNlQmVmb3JlLCBtaW50UmVjb3ZlcnlQdXJzZUFmdGVyKSk7XG4gICAgICByZXR1cm4gcGF5bWVudDtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBpc3N1ZXJLaXQgPSBoYXJkZW4oeyBpc3N1ZXIsIG1pbnQsIGJyYW5kLCBtaW50UmVjb3ZlcnlQdXJzZSB9KTtcbiAgcmV0dXJuIGlzc3VlcktpdDtcbn07XG5oYXJkZW4ocHJlcGFyZVBheW1lbnRMZWRnZXIpO1xuXG4vL1xudmFyIHNldHVwSXNzdWVyS2l0ID0gKHsgbmFtZSwgYXNzZXRLaW5kLCBkaXNwbGF5SW5mbywgZWxlbWVudFNoYXBlIH0sIGlzc3VlclpvbmUsIHJlY292ZXJ5U2V0c1N0YXRlLCBvcHRTaHV0ZG93bldpdGhGYWlsdXJlID0gdm9pZCAwKSA9PiB7XG4gIGFzc2VydDIudHlwZW9mKG5hbWUsIFwic3RyaW5nXCIpO1xuICBhc3NlcnRBc3NldEtpbmQoYXNzZXRLaW5kKTtcbiAgY29uc3QgY2xlYW5EaXNwbGF5SW5mbyA9IGNvZXJjZURpc3BsYXlJbmZvKGRpc3BsYXlJbmZvLCBhc3NldEtpbmQpO1xuICBpZiAob3B0U2h1dGRvd25XaXRoRmFpbHVyZSAhPT0gdm9pZCAwKSB7XG4gICAgYXNzZXJ0Mi50eXBlb2Yob3B0U2h1dGRvd25XaXRoRmFpbHVyZSwgXCJmdW5jdGlvblwiKTtcbiAgfVxuICBpZiAoZWxlbWVudFNoYXBlICE9PSB2b2lkIDApIHtcbiAgICBhc3NlcnRQYXR0ZXJuKGVsZW1lbnRTaGFwZSk7XG4gIH1cbiAgY29uc3QgeyBpc3N1ZXIsIG1pbnQsIGJyYW5kLCBtaW50UmVjb3ZlcnlQdXJzZSB9ID0gcHJlcGFyZVBheW1lbnRMZWRnZXIoXG4gICAgaXNzdWVyWm9uZSxcbiAgICBuYW1lLFxuICAgIGFzc2V0S2luZCxcbiAgICBjbGVhbkRpc3BsYXlJbmZvLFxuICAgIGVsZW1lbnRTaGFwZSxcbiAgICByZWNvdmVyeVNldHNTdGF0ZSxcbiAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlXG4gICk7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIGJyYW5kLFxuICAgIGlzc3VlcixcbiAgICBtaW50LFxuICAgIG1pbnRSZWNvdmVyeVB1cnNlLFxuICAgIGRpc3BsYXlJbmZvOiBjbGVhbkRpc3BsYXlJbmZvXG4gIH0pO1xufTtcbmhhcmRlbihzZXR1cElzc3VlcktpdCk7XG52YXIgSU5TVEFOQ0VfS0VZID0gXCJpc3N1ZXJcIjtcbnZhciBSRUNPVkVSWV9TRVRTX1NUQVRFID0gXCJyZWNvdmVyeVNldHNTdGF0ZVwiO1xudmFyIHVwZ3JhZGVJc3N1ZXJLaXQgPSAoaXNzdWVyQmFnZ2FnZSwgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSA9IHZvaWQgMCwgcmVjb3ZlcnlTZXRzT3B0aW9uID0gdm9pZCAwKSA9PiB7XG4gIGNvbnN0IGlzc3VlclJlY29yZCA9IGlzc3VlckJhZ2dhZ2UuZ2V0KElOU1RBTkNFX0tFWSk7XG4gIGNvbnN0IGlzc3VlclpvbmUgPSBtYWtlRHVyYWJsZVpvbmUoaXNzdWVyQmFnZ2FnZSk7XG4gIGNvbnN0IG9sZFJlY292ZXJ5U2V0c1N0YXRlID0gaXNzdWVyQmFnZ2FnZS5oYXMoUkVDT1ZFUllfU0VUU19TVEFURSkgPyBpc3N1ZXJCYWdnYWdlLmdldChSRUNPVkVSWV9TRVRTX1NUQVRFKSA6IFwiaGFzUmVjb3ZlcnlTZXRzXCI7XG4gIGlmIChvbGRSZWNvdmVyeVNldHNTdGF0ZSA9PT0gXCJub1JlY292ZXJ5U2V0c1wiICYmIHJlY292ZXJ5U2V0c09wdGlvbiA9PT0gXCJoYXNSZWNvdmVyeVNldHNcIikge1xuICAgIHRocm93UmVkYWN0ZWRgQ2Fubm90ICh5ZXQ/KSB1cGdyYWRlIGZyb20gJ25vUmVjb3ZlcnlTZXRzJyB0byAnaGFzUmVjb3ZlcnlTZXRzJ2A7XG4gIH1cbiAgY29uc3QgcmVjb3ZlcnlTZXRzU3RhdGUgPSByZWNvdmVyeVNldHNPcHRpb24gfHwgb2xkUmVjb3ZlcnlTZXRzU3RhdGU7XG4gIHJldHVybiBzZXR1cElzc3VlcktpdChcbiAgICBpc3N1ZXJSZWNvcmQsXG4gICAgaXNzdWVyWm9uZSxcbiAgICByZWNvdmVyeVNldHNTdGF0ZSxcbiAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlXG4gICk7XG59O1xuaGFyZGVuKHVwZ3JhZGVJc3N1ZXJLaXQpO1xudmFyIGhhc0lzc3VlciA9IChiYWdnYWdlKSA9PiBiYWdnYWdlLmhhcyhJTlNUQU5DRV9LRVkpO1xudmFyIG1ha2VEdXJhYmxlSXNzdWVyS2l0ID0gKGlzc3VlckJhZ2dhZ2UsIG5hbWUsIGFzc2V0S2luZCA9IEFzc2V0S2luZC5OQVQsIGRpc3BsYXlJbmZvID0gaGFyZGVuKHt9KSwgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSA9IHZvaWQgMCwgeyBlbGVtZW50U2hhcGUgPSB2b2lkIDAsIHJlY292ZXJ5U2V0c09wdGlvbiA9IHZvaWQgMCB9ID0ge30pID0+IHtcbiAgY29uc3QgaXNzdWVyRGF0YSA9IGhhcmRlbih7XG4gICAgbmFtZSxcbiAgICBhc3NldEtpbmQsXG4gICAgZGlzcGxheUluZm8sXG4gICAgZWxlbWVudFNoYXBlXG4gIH0pO1xuICBpc3N1ZXJCYWdnYWdlLmluaXQoSU5TVEFOQ0VfS0VZLCBpc3N1ZXJEYXRhKTtcbiAgY29uc3QgaXNzdWVyWm9uZSA9IG1ha2VEdXJhYmxlWm9uZShpc3N1ZXJCYWdnYWdlKTtcbiAgY29uc3QgcmVjb3ZlcnlTZXRzU3RhdGUgPSByZWNvdmVyeVNldHNPcHRpb24gfHwgXCJoYXNSZWNvdmVyeVNldHNcIjtcbiAgaXNzdWVyQmFnZ2FnZS5pbml0KFJFQ09WRVJZX1NFVFNfU1RBVEUsIHJlY292ZXJ5U2V0c1N0YXRlKTtcbiAgcmV0dXJuIHNldHVwSXNzdWVyS2l0KFxuICAgIGlzc3VlckRhdGEsXG4gICAgaXNzdWVyWm9uZSxcbiAgICByZWNvdmVyeVNldHNTdGF0ZSxcbiAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlXG4gICk7XG59O1xuaGFyZGVuKG1ha2VEdXJhYmxlSXNzdWVyS2l0KTtcbnZhciBwcmVwYXJlSXNzdWVyS2l0ID0gKGlzc3VlckJhZ2dhZ2UsIG5hbWUsIGFzc2V0S2luZCA9IEFzc2V0S2luZC5OQVQsIGRpc3BsYXlJbmZvID0gaGFyZGVuKHt9KSwgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSA9IHZvaWQgMCwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGlmIChoYXNJc3N1ZXIoaXNzdWVyQmFnZ2FnZSkpIHtcbiAgICBjb25zdCB7IGVsZW1lbnRTaGFwZTogXyA9IHZvaWQgMCwgcmVjb3ZlcnlTZXRzT3B0aW9uID0gdm9pZCAwIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IGlzc3VlcktpdCA9IHVwZ3JhZGVJc3N1ZXJLaXQoXG4gICAgICBpc3N1ZXJCYWdnYWdlLFxuICAgICAgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSxcbiAgICAgIHJlY292ZXJ5U2V0c09wdGlvblxuICAgICk7XG4gICAgcmV0dXJuIGlzc3VlcktpdDtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBpc3N1ZXJLaXQgPSBtYWtlRHVyYWJsZUlzc3VlcktpdChcbiAgICAgIGlzc3VlckJhZ2dhZ2UsXG4gICAgICBuYW1lLFxuICAgICAgYXNzZXRLaW5kLFxuICAgICAgZGlzcGxheUluZm8sXG4gICAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gICAgcmV0dXJuIGlzc3VlcktpdDtcbiAgfVxufTtcbmhhcmRlbihwcmVwYXJlSXNzdWVyS2l0KTtcbnZhciBtYWtlSXNzdWVyS2l0ID0gKG5hbWUsIGFzc2V0S2luZCA9IEFzc2V0S2luZC5OQVQsIGRpc3BsYXlJbmZvID0gaGFyZGVuKHt9KSwgb3B0U2h1dGRvd25XaXRoRmFpbHVyZSA9IHZvaWQgMCwgeyBlbGVtZW50U2hhcGUgPSB2b2lkIDAsIHJlY292ZXJ5U2V0c09wdGlvbiA9IHZvaWQgMCB9ID0ge30pID0+IChcbiAgLy9cbiAgbWFrZUR1cmFibGVJc3N1ZXJLaXQoXG4gICAgbWFrZVNjYWxhckJpZ01hcFN0b3JlKFwiZHJvcHBlZCBpc3N1ZXIga2l0XCIsIHsgZHVyYWJsZTogdHJ1ZSB9KSxcbiAgICBuYW1lLFxuICAgIGFzc2V0S2luZCxcbiAgICBkaXNwbGF5SW5mbyxcbiAgICBvcHRTaHV0ZG93bldpdGhGYWlsdXJlLFxuICAgIHsgZWxlbWVudFNoYXBlLCByZWNvdmVyeVNldHNPcHRpb24gfVxuICApXG4pO1xuaGFyZGVuKG1ha2VJc3N1ZXJLaXQpO1xuXG4vL1xudmFyIHNpbmszID0gKCkgPT4ge1xufTtcbmhhcmRlbihzaW5rMyk7XG52YXIgVm93U2hhcGUgPSBNLnRhZ2dlZChcbiAgXCJWb3dcIixcbiAgTS5zcGxpdFJlY29yZCh7XG4gICAgdm93VjA6IE0ucmVtb3RhYmxlKFwiVm93VjBcIilcbiAgfSlcbik7XG52YXIgaXNWb3cgPSAoc3BlY2ltZW4pID0+IGlzUGFzc2FibGUoc3BlY2ltZW4pICYmIG1hdGNoZXMoc3BlY2ltZW4sIFZvd1NoYXBlKTtcbmhhcmRlbihpc1Zvdyk7XG52YXIgZ2V0Vm93UGF5bG9hZCA9IChzcGVjaW1lbikgPT4ge1xuICBpZiAoIWlzVm93KHNwZWNpbWVuKSkge1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbiAgY29uc3Qgdm93ID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAqL1xuICAgIC8qICAgICAgICAgICAgICAgICAgKi9cbiAgICBzcGVjaW1lblxuICApO1xuICByZXR1cm4gdm93LnBheWxvYWQ7XG59O1xuaGFyZGVuKGdldFZvd1BheWxvYWQpO1xudmFyIHRvUGFzc2FibGVDYXAgPSAoaykgPT4ge1xuICBjb25zdCBwYXlsb2FkID0gZ2V0Vm93UGF5bG9hZChrKTtcbiAgaWYgKHBheWxvYWQgPT09IHZvaWQgMCkge1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAga1xuICAgICk7XG4gIH1cbiAgY29uc3QgeyB2b3dWMCB9ID0gcGF5bG9hZDtcbiAgcmV0dXJuIHZvd1YwO1xufTtcbmhhcmRlbih0b1Bhc3NhYmxlQ2FwKTtcbnZhciBtYWtlQXNWb3cgPSAobWFrZVZvd0tpdCkgPT4ge1xuICBjb25zdCBhc1ZvdyA9IChmbikgPT4ge1xuICAgIGxldCByZXN1bHQ7XG4gICAgdHJ5IHtcbiAgICAgIHJlc3VsdCA9IGZuKCk7XG4gICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgIHJlc3VsdCA9IFByb21pc2UucmVqZWN0KGUyKTtcbiAgICB9XG4gICAgaWYgKGlzVm93KHJlc3VsdCkpIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIGNvbnN0IHsgdm93LCByZXNvbHZlciB9ID0gbWFrZVZvd0tpdCgpO1xuICAgIHJlc29sdmVyLnJlc29sdmUocmVzdWx0KTtcbiAgICByZXR1cm4gdm93O1xuICB9O1xuICByZXR1cm4gaGFyZGVuKGFzVm93KTtcbn07XG5oYXJkZW4obWFrZUFzVm93KTtcblxuLy9cbnZhciB7IGRldGFpbHM6IFgzIH0gPSBhc3NlcnQ7XG52YXIgbm9vcCA9ICgpID0+IHtcbn07XG5oYXJkZW4obm9vcCk7XG52YXIgcHJlcGFyZVZvd0tpdCA9ICh6b25lLCB2b3dSZWplY3Rpb25UcmFja2VyKSA9PiB7XG4gIGNvbnN0IHJlc29sdmVyVG9FcGhlbWVyYSA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCByZXNvbHZlclRvTm9uU3RvcmVkVmFsdWUgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgcHJvdmlkZUVwaGVtZXJhID0gKHJlc29sdmVyLCBvcHRpb25zKSA9PiB7XG4gICAgbGV0IGVwaGVtZXJhID0gcmVzb2x2ZXJUb0VwaGVtZXJhLmdldChyZXNvbHZlcik7XG4gICAgaWYgKCFlcGhlbWVyYSkge1xuICAgICAgZXBoZW1lcmEgPSBtYWtlUHJvbWlzZUtpdCgpO1xuICAgICAgZXBoZW1lcmEucHJvbWlzZS5jYXRjaChub29wKTtcbiAgICB9XG4gICAgZXBoZW1lcmEgPSBoYXJkZW4oeyAuLi5lcGhlbWVyYSwgLi4ub3B0aW9ucyB9KTtcbiAgICByZXNvbHZlclRvRXBoZW1lcmEuc2V0KHJlc29sdmVyLCBlcGhlbWVyYSk7XG4gICAgcmV0dXJuIGVwaGVtZXJhO1xuICB9O1xuICBjb25zdCBwcm92aWRlRXBoZW1lcmFGb3JSZXNvbHV0aW9uID0gKHJlc29sdmVyKSA9PiB7XG4gICAgY29uc3QgZXBoZW1lcmEgPSBwcm92aWRlRXBoZW1lcmEocmVzb2x2ZXIpO1xuICAgIGlmIChlcGhlbWVyYS5yZXNvbHZlKSB7XG4gICAgICBjb25zdCB7IHJlc29sdmU6IF8xLCByZWplY3Q6IF8yLCAuLi5yZXN0IH0gPSBlcGhlbWVyYTtcbiAgICAgIHJlc29sdmVyVG9FcGhlbWVyYS5zZXQocmVzb2x2ZXIsIGhhcmRlbihyZXN0KSk7XG4gICAgfVxuICAgIHJldHVybiBlcGhlbWVyYTtcbiAgfTtcbiAgY29uc3QgbWFrZVZvd0ludGVybmFsc0tpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJWb3dJbnRlcm5hbHNLaXRcIixcbiAgICB7XG4gICAgICB2b3dWMDogTS5pbnRlcmZhY2UoXCJWb3dWMFwiLCB7XG4gICAgICAgIHNob3J0ZW46IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpXG4gICAgICB9KSxcbiAgICAgIHJlc29sdmVyOiBNLmludGVyZmFjZShcIlZvd1Jlc29sdmVyXCIsIHtcbiAgICAgICAgcmVzb2x2ZTogTS5jYWxsKCkub3B0aW9uYWwoTS5yYXcoKSkucmV0dXJucygpLFxuICAgICAgICByZWplY3Q6IE0uY2FsbCgpLm9wdGlvbmFsKE0ucmF3KCkpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICB3YXRjaE5leHRTdGVwOiBQcm9taXNlV2F0Y2hlcklcbiAgICB9LFxuICAgICgpID0+ICh7XG4gICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgIHZhbHVlOiB2b2lkIDAsXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgc3RlcFN0YXR1czogbnVsbCxcbiAgICAgIGlzU3RvcmVkVmFsdWU6IGZhbHNlLFxuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgdm93SXNIYW5kbGVkOiBmYWxzZSxcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGV4dHJhOiB2b2lkIDBcbiAgICB9KSxcbiAgICB7XG4gICAgICB2b3dWMDoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBhc3luYyBzaG9ydGVuKCkge1xuICAgICAgICAgIGNvbnN0IHsgc3RlcFN0YXR1cywgaXNTdG9yZWRWYWx1ZSwgdmFsdWUsIHZvd0lzSGFuZGxlZCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IHJlc29sdmVyLCB2b3dWMCB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgc3dpdGNoIChzdGVwU3RhdHVzKSB7XG4gICAgICAgICAgICBjYXNlIFwiZnVsZmlsbGVkXCI6IHtcbiAgICAgICAgICAgICAgaWYgKHZvd0lzSGFuZGxlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLnZvd0lzSGFuZGxlZCA9IHRydWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGlzU3RvcmVkVmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzb2x2ZXJUb05vblN0b3JlZFZhbHVlLmhhcyhyZXNvbHZlcikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZXJUb05vblN0b3JlZFZhbHVlLmdldChyZXNvbHZlcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdGhyb3cgdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXNlIFwicmVqZWN0ZWRcIjoge1xuICAgICAgICAgICAgICBpZiAodm93SXNIYW5kbGVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUudm93SXNIYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB2b3dSZWplY3Rpb25UcmFja2VyPy5oYW5kbGUodm93VjApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNvbnN0IHJlYXNvbiA9IHJlc29sdmVyVG9Ob25TdG9yZWRWYWx1ZS5oYXMocmVzb2x2ZXIpID8gcmVzb2x2ZXJUb05vblN0b3JlZFZhbHVlLmdldChyZXNvbHZlcikgOiB2YWx1ZTtcbiAgICAgICAgICAgICAgdGhyb3cgcmVhc29uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FzZSBudWxsOlxuICAgICAgICAgICAgY2FzZSBcInBlbmRpbmdcIjpcbiAgICAgICAgICAgICAgcmV0dXJuIHByb3ZpZGVFcGhlbWVyYSh0aGlzLmZhY2V0cy5yZXNvbHZlciwge1xuICAgICAgICAgICAgICAgIHBvdGVudGlhbGx5SGFuZGxlZDogdHJ1ZVxuICAgICAgICAgICAgICB9KS5wcm9taXNlO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgdGhyb3cgVHlwZUVycm9yKGB1bmV4cGVjdGVkIHN0ZXBTdGF0dXMgJHtzdGVwU3RhdHVzfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlc29sdmVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIHJlc29sdmUodmFsdWUpIHtcbiAgICAgICAgICBjb25zdCB7IHN0ZXBTdGF0dXMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKHN0ZXBTdGF0dXMgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zdGF0ZS5zdGVwU3RhdHVzID0gXCJwZW5kaW5nXCI7XG4gICAgICAgICAgY29uc3QgeyByZXNvbHZlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgeyByZXNvbHZlOiByZXNvbHZlMiB9ID0gcHJvdmlkZUVwaGVtZXJhRm9yUmVzb2x1dGlvbihyZXNvbHZlcik7XG4gICAgICAgICAgcmVzb2x2ZTIgJiYgcmVzb2x2ZTIodmFsdWUpO1xuICAgICAgICAgIHpvbmUud2F0Y2hQcm9taXNlKFxuICAgICAgICAgICAgSGFuZGxlZFByb21pc2UucmVzb2x2ZSh2YWx1ZSksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy53YXRjaE5leHRTdGVwXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgcmVqZWN0KHJlYXNvbikge1xuICAgICAgICAgIGNvbnN0IHsgc3RlcFN0YXR1cyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoc3RlcFN0YXR1cyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnN0YXRlLnN0ZXBTdGF0dXMgPSBcInJlamVjdGVkXCI7XG4gICAgICAgICAgY29uc3QgeyByZXNvbHZlciwgd2F0Y2hOZXh0U3RlcCB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgeyByZWplY3QgfSA9IHByb3ZpZGVFcGhlbWVyYUZvclJlc29sdXRpb24ocmVzb2x2ZXIpO1xuICAgICAgICAgIHJlamVjdCAmJiByZWplY3QocmVhc29uKTtcbiAgICAgICAgICB3YXRjaE5leHRTdGVwLm9uUmVqZWN0ZWQocmVhc29uKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdhdGNoTmV4dFN0ZXA6IHtcbiAgICAgICAgb25GdWxmaWxsZWQodmFsdWUpIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLnN0ZXBTdGF0dXMgPSBcImZ1bGZpbGxlZFwiO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZTogcmVzb2x2ZTIgfSA9IHByb3ZpZGVFcGhlbWVyYUZvclJlc29sdXRpb24ocmVzb2x2ZXIpO1xuICAgICAgICAgIGhhcmRlbih2YWx1ZSk7XG4gICAgICAgICAgcmVzb2x2ZTIgJiYgcmVzb2x2ZTIodmFsdWUpO1xuICAgICAgICAgIHRoaXMuc3RhdGUuaXNTdG9yZWRWYWx1ZSA9IHpvbmUuaXNTdG9yYWJsZSh2YWx1ZSk7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGUuaXNTdG9yZWRWYWx1ZSkge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXNvbHZlclRvTm9uU3RvcmVkVmFsdWUuc2V0KHJlc29sdmVyLCB2YWx1ZSk7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gYXNzZXJ0LmVycm9yKFxuICAgICAgICAgICAgICBYM2BWb3cgZnVsZmlsbG1lbnQgdmFsdWUgd2FzIG5vdCBzdG9yZWQ6ICR7dmFsdWV9YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5zdGVwU3RhdHVzID0gXCJyZWplY3RlZFwiO1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZXIsIHZvd1YwIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCB7IHJlamVjdCwgcG90ZW50aWFsbHlIYW5kbGVkIH0gPSBwcm92aWRlRXBoZW1lcmFGb3JSZXNvbHV0aW9uKHJlc29sdmVyKTtcbiAgICAgICAgICBoYXJkZW4ocmVhc29uKTtcbiAgICAgICAgICByZWplY3QgJiYgcmVqZWN0KHJlYXNvbik7XG4gICAgICAgICAgaWYgKHRoaXMuc3RhdGUudm93SXNIYW5kbGVkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgaWYgKHBvdGVudGlhbGx5SGFuZGxlZCkge1xuICAgICAgICAgICAgICB0aGlzLnN0YXRlLnZvd0lzSGFuZGxlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB2b3dSZWplY3Rpb25UcmFja2VyPy5yZWplY3Qodm93VjAsIHJlYXNvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuc3RhdGUuaXNTdG9yZWRWYWx1ZSA9IHpvbmUuaXNTdG9yYWJsZShyZWFzb24pO1xuICAgICAgICAgIGlmICh0aGlzLnN0YXRlLmlzU3RvcmVkVmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUudmFsdWUgPSByZWFzb247XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc29sdmVyVG9Ob25TdG9yZWRWYWx1ZS5zZXQocmVzb2x2ZXIsIHJlYXNvbik7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnZhbHVlID0gYXNzZXJ0LmVycm9yKFxuICAgICAgICAgICAgICBYM2BWb3cgcmVqZWN0aW9uIHJlYXNvbiB3YXMgbm90IHN0b3JlZDogJHtyZWFzb259YFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VWb3dLaXQgPSAoKSA9PiB7XG4gICAgY29uc3QgeyByZXNvbHZlciwgdm93VjAgfSA9IG1ha2VWb3dJbnRlcm5hbHNLaXQoKTtcbiAgICBjb25zdCB2b3cgPSBtYWtlVGFnZ2VkKFwiVm93XCIsIGhhcmRlbih7IHZvd1YwIH0pKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgcmVzb2x2ZXIsIHZvdyB9KTtcbiAgfTtcbiAgcmV0dXJuIG1ha2VWb3dLaXQ7XG59O1xuaGFyZGVuKHByZXBhcmVWb3dLaXQpO1xuXG4vL1xudmFyIHsgRmFpbDogRmFpbDUsIGJhcmU6IGJhcmUyLCBkZXRhaWxzOiBYNCB9ID0gYXNzZXJ0O1xudmFyIFZvd1NoYXBlMiA9IE0udGFnZ2VkKFxuICBcIlZvd1wiLFxuICBoYXJkZW4oe1xuICAgIHZvd1YwOiBNLnJlbW90YWJsZShcIlZvd1YwXCIpXG4gIH0pXG4pO1xudmFyIHByZXBhcmVXYXRjaFV0aWxzID0gKHpvbmUsIHsgd2F0Y2gsIHdoZW4sIG1ha2VWb3dLaXQsIGlzUmV0cnlhYmxlUmVhc29uOiBpc1JldHJ5YWJsZVJlYXNvbjIgfSkgPT4ge1xuICBjb25zdCBkZXRhY2hlZCA9IHpvbmUuZGV0YWNoZWQoKTtcbiAgY29uc3QgdXRpbHNUb05vblN0b3JhYmxlUmVzdWx0cyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCBtYWtlV2F0Y2hVdGlsc0tpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJXYXRjaFV0aWxzXCIsXG4gICAge1xuICAgICAgdXRpbHM6IE0uaW50ZXJmYWNlKFwiVXRpbHNcIiwge1xuICAgICAgICBhbGw6IE0uY2FsbChNLmFycmF5T2YoTS5hbnkoKSkpLnJldHVybnMoVm93U2hhcGUyKSxcbiAgICAgICAgYWxsU2V0dGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLmFueSgpKSkucmV0dXJucyhWb3dTaGFwZTIpLFxuICAgICAgICBhc1Byb21pc2U6IE0uY2FsbChNLnJhdygpKS5yZXN0KE0ucmF3KCkpLnJldHVybnMoTS5wcm9taXNlKCkpXG4gICAgICB9KSxcbiAgICAgIHdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5yYXcoKSkucmVzdChNLnJhdygpKS5yZXR1cm5zKE0ucmF3KCkpLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5yYXcoKSkucmVzdChNLnJhdygpKS5yZXR1cm5zKE0ucmF3KCkpXG4gICAgICB9KSxcbiAgICAgIGhlbHBlcjogTS5pbnRlcmZhY2UoXCJIZWxwZXJcIiwge1xuICAgICAgICBjcmVhdGVWb3c6IE0uY2FsbChNLmFycmF5T2YoTS5hbnkoKSksIE0uYm9vbGVhbigpKS5yZXR1cm5zKFZvd1NoYXBlMiksXG4gICAgICAgIHByb2Nlc3NSZXN1bHQ6IE0uY2FsbChNLnJhdygpKS5yZXN0KE0ucmF3KCkpLnJldHVybnMoTS51bmRlZmluZWQoKSlcbiAgICAgIH0pLFxuICAgICAgcmV0cnlSZWplY3Rpb25Qcm9taXNlV2F0Y2hlcjogUHJvbWlzZVdhdGNoZXJJXG4gICAgfSxcbiAgICAoKSA9PiB7XG4gICAgICBjb25zdCBpZFRvVm93U3RhdGUgPSBkZXRhY2hlZC5tYXBTdG9yZShcImlkVG9Wb3dTdGF0ZVwiKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5leHRJZDogMG4sXG4gICAgICAgIGlkVG9Wb3dTdGF0ZVxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIHV0aWxzOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGFsbChzcGVjaW1lbnMpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5mYWNldHMuaGVscGVyLmNyZWF0ZVZvdyhzcGVjaW1lbnMsIGZhbHNlKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYWxsU2V0dGxlZChzcGVjaW1lbnMpIHtcbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5oZWxwZXIuY3JlYXRlVm93KHNwZWNpbWVucywgdHJ1ZSlcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBhc1Byb21pc2Uoc3BlY2ltZW5QLCAuLi53YXRjaGVyQXJncykge1xuICAgICAgICAgIGNvbnN0IHZvdyA9IHdhdGNoKHNwZWNpbWVuUCwgLi4ud2F0Y2hlckFyZ3MpO1xuICAgICAgICAgIGNvbnN0IHByb21pc2UgPSB3aGVuKHZvdyk7XG4gICAgICAgICAgem9uZS53YXRjaFByb21pc2UocHJvbWlzZSwgdGhpcy5mYWNldHMucmV0cnlSZWplY3Rpb25Qcm9taXNlV2F0Y2hlcik7XG4gICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3YXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZCh2YWx1ZSwgY3R4KSB7XG4gICAgICAgICAgdGhpcy5mYWNldHMuaGVscGVyLnByb2Nlc3NSZXN1bHQodmFsdWUsIGN0eCwgXCJmdWxmaWxsZWRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgY3R4KSB7XG4gICAgICAgICAgdGhpcy5mYWNldHMuaGVscGVyLnByb2Nlc3NSZXN1bHQocmVhc29uLCBjdHgsIFwicmVqZWN0ZWRcIik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBoZWxwZXI6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBjcmVhdGVWb3coc3BlY2ltZW5zLCBpc0FsbFNldHRsZWQpIHtcbiAgICAgICAgICBjb25zdCB7IG5leHRJZDogaWQsIGlkVG9Wb3dTdGF0ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCBraXQgPSBtYWtlVm93S2l0KCk7XG4gICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHNwZWNpbWVucy5sZW5ndGg7IGluZGV4ICs9IDEpIHtcbiAgICAgICAgICAgIHdhdGNoKHNwZWNpbWVuc1tpbmRleF0sIHRoaXMuZmFjZXRzLndhdGNoZXIsIHtcbiAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAgIGluZGV4LFxuICAgICAgICAgICAgICBudW1SZXN1bHRzOiBzcGVjaW1lbnMubGVuZ3RoLFxuICAgICAgICAgICAgICBpc0FsbFNldHRsZWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc3BlY2ltZW5zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUubmV4dElkICs9IDFuO1xuICAgICAgICAgICAgaWRUb1Zvd1N0YXRlLmluaXQoXG4gICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICBoYXJkZW4oe1xuICAgICAgICAgICAgICAgIHJlc29sdmVyOiBraXQucmVzb2x2ZXIsXG4gICAgICAgICAgICAgICAgcmVtYWluaW5nOiBzcGVjaW1lbnMubGVuZ3RoLFxuICAgICAgICAgICAgICAgIHJlc3VsdHNNYXA6IGRldGFjaGVkLm1hcFN0b3JlKFwicmVzdWx0c01hcFwiKSxcbiAgICAgICAgICAgICAgICBpc0FsbFNldHRsZWRcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zdCBpZFRvTm9uU3RvcmFibGVSZXN1bHRzID0gcHJvdmlkZUxhenlNYXAoXG4gICAgICAgICAgICAgIHV0aWxzVG9Ob25TdG9yYWJsZVJlc3VsdHMsXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnV0aWxzLFxuICAgICAgICAgICAgICAoKSA9PiAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWRUb05vblN0b3JhYmxlUmVzdWx0cy5zZXQoaWQsIC8qICAgICAgICAgICAqLyBuZXcgTWFwKCkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBraXQucmVzb2x2ZXIucmVzb2x2ZShoYXJkZW4oW10pKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGtpdC52b3c7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHByb2Nlc3NSZXN1bHQocmVzdWx0LCB7IGlkLCBpbmRleCwgbnVtUmVzdWx0cywgaXNBbGxTZXR0bGVkIH0sIHN0YXR1cykge1xuICAgICAgICAgIGNvbnN0IHsgaWRUb1Zvd1N0YXRlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICghaWRUb1Zvd1N0YXRlLmhhcyhpZCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgaWRUb05vblN0b3JhYmxlUmVzdWx0cyA9IHByb3ZpZGVMYXp5TWFwKFxuICAgICAgICAgICAgdXRpbHNUb05vblN0b3JhYmxlUmVzdWx0cyxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnV0aWxzLFxuICAgICAgICAgICAgKCkgPT4gLyogICAgICAgICAgICovIG5ldyBNYXAoKVxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgeyByZW1haW5pbmcsIHJlc3VsdHNNYXAsIHJlc29sdmVyIH0gPSBpZFRvVm93U3RhdGUuZ2V0KGlkKTtcbiAgICAgICAgICBpZiAoIWlzQWxsU2V0dGxlZCAmJiBzdGF0dXMgPT09IFwicmVqZWN0ZWRcIikge1xuICAgICAgICAgICAgaWRUb1Zvd1N0YXRlLmRlbGV0ZShpZCk7XG4gICAgICAgICAgICBpZFRvTm9uU3RvcmFibGVSZXN1bHRzLmRlbGV0ZShpZCk7XG4gICAgICAgICAgICByZXNvbHZlci5yZWplY3QocmVzdWx0KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgcG9zc2libHlXcmFwcGVkUmVzdWx0ID0gaXNBbGxTZXR0bGVkID8gaGFyZGVuKHtcbiAgICAgICAgICAgIHN0YXR1cyxcbiAgICAgICAgICAgIFtzdGF0dXMgPT09IFwiZnVsZmlsbGVkXCIgPyBcInZhbHVlXCIgOiBcInJlYXNvblwiXTogcmVzdWx0XG4gICAgICAgICAgfSkgOiByZXN1bHQ7XG4gICAgICAgICAgY29uc3Qgbm9uU3RvcmFibGVSZXN1bHRzID0gcHJvdmlkZUxhenlNYXAoXG4gICAgICAgICAgICBpZFRvTm9uU3RvcmFibGVSZXN1bHRzLFxuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAoKSA9PiAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoem9uZS5pc1N0b3JhYmxlKHBvc3NpYmx5V3JhcHBlZFJlc3VsdCkpIHtcbiAgICAgICAgICAgIHJlc3VsdHNNYXAuaW5pdChpbmRleCwgcG9zc2libHlXcmFwcGVkUmVzdWx0KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbm9uU3RvcmFibGVSZXN1bHRzLnNldChpbmRleCwgcG9zc2libHlXcmFwcGVkUmVzdWx0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3Qgdm93U3RhdGUgPSBoYXJkZW4oe1xuICAgICAgICAgICAgcmVtYWluaW5nOiByZW1haW5pbmcgLSAxLFxuICAgICAgICAgICAgcmVzdWx0c01hcCxcbiAgICAgICAgICAgIHJlc29sdmVyLFxuICAgICAgICAgICAgaXNBbGxTZXR0bGVkXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKHZvd1N0YXRlLnJlbWFpbmluZyA+IDApIHtcbiAgICAgICAgICAgIGlkVG9Wb3dTdGF0ZS5zZXQoaWQsIHZvd1N0YXRlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWRUb1Zvd1N0YXRlLmRlbGV0ZShpZCk7XG4gICAgICAgICAgaWRUb05vblN0b3JhYmxlUmVzdWx0cy5kZWxldGUoaWQpO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBuZXcgQXJyYXkobnVtUmVzdWx0cyk7XG4gICAgICAgICAgbGV0IG51bUxvc3QgPSAwO1xuICAgICAgICAgIGZvciAobGV0IGkyID0gMDsgaTIgPCBudW1SZXN1bHRzOyBpMiArPSAxKSB7XG4gICAgICAgICAgICBpZiAobm9uU3RvcmFibGVSZXN1bHRzLmhhcyhpMikpIHtcbiAgICAgICAgICAgICAgcmVzdWx0c1tpMl0gPSBub25TdG9yYWJsZVJlc3VsdHMuZ2V0KGkyKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0c01hcC5oYXMoaTIpKSB7XG4gICAgICAgICAgICAgIHJlc3VsdHNbaTJdID0gcmVzdWx0c01hcC5nZXQoaTIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbnVtTG9zdCArPSAxO1xuICAgICAgICAgICAgICByZXN1bHRzW2kyXSA9IGlzQWxsU2V0dGxlZCA/IHsgc3RhdHVzOiBcInJlamVjdGVkXCIsIHJlYXNvbjogXCJVbnN0b3JhYmxlIHJlc3VsdCB3YXMgbG9zdFwiIH0gOiB2b2lkIDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChudW1Mb3N0ID4gMCAmJiAhaXNBbGxTZXR0bGVkKSB7XG4gICAgICAgICAgICByZXNvbHZlci5yZWplY3QoXG4gICAgICAgICAgICAgIGFzc2VydC5lcnJvcihYNGAke251bUxvc3R9IHVuc3RvcmFibGUgcmVzdWx0cyB3ZXJlIGxvc3RgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzb2x2ZXIucmVzb2x2ZShoYXJkZW4ocmVzdWx0cykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJldHJ5UmVqZWN0aW9uUHJvbWlzZVdhdGNoZXI6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoX3Jlc3VsdCkge1xuICAgICAgICB9LFxuICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgZmFpbGVkT3ApIHtcbiAgICAgICAgICBpZiAoaXNSZXRyeWFibGVSZWFzb24yKHJlYXNvbiwgdm9pZCAwKSkge1xuICAgICAgICAgICAgRmFpbDVgUGVuZGluZyAke2JhcmUyKGZhaWxlZE9wKX0gY291bGQgbm90IHJldHJ5OyAke3JlYXNvbn1gO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZVdhdGNoVXRpbCA9ICgpID0+IHtcbiAgICBjb25zdCB7IHV0aWxzIH0gPSBtYWtlV2F0Y2hVdGlsc0tpdCgpO1xuICAgIHJldHVybiBoYXJkZW4odXRpbHMpO1xuICB9O1xuICByZXR1cm4gbWFrZVdhdGNoVXRpbDtcbn07XG5oYXJkZW4ocHJlcGFyZVdhdGNoVXRpbHMpO1xuXG4vL1xudmFyIHsgYXBwbHk6IGFwcGx5NyB9ID0gUmVmbGVjdDtcbnZhciBtYWtlV2F0Y2hOZXh0U3RlcCA9ICh6b25lKSA9PiAoXG4gIC8qXG5cblxuXG5cblxuXG4gICAqL1xuICAoc3BlY2ltZW4sIHByb21pc2VXYXRjaGVyKSA9PiB7XG4gICAgbGV0IHByb21pc2U7XG4gICAgY29uc3QgcGF5bG9hZCA9IGdldFZvd1BheWxvYWQoc3BlY2ltZW4pO1xuICAgIGlmIChwYXlsb2FkKSB7XG4gICAgICBwcm9taXNlID0gRShwYXlsb2FkLnZvd1YwKS5zaG9ydGVuKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHByb21pc2UgPSBFLnJlc29sdmUoc3BlY2ltZW4pO1xuICAgIH1cbiAgICB6b25lLndhdGNoUHJvbWlzZShwcm9taXNlLCBwcm9taXNlV2F0Y2hlcik7XG4gIH1cbik7XG52YXIgc2V0dGxlID0gYXN5bmMgKHJlc29sdmVyLCB3YXRjaGVyLCB3Y2IsIHZhbHVlLCB3YXRjaGVyQXJncyA9IFtdKSA9PiB7XG4gIGF3YWl0IG51bGw7XG4gIHRyeSB7XG4gICAgbGV0IGNoYWluZWRWYWx1ZSA9IHZhbHVlO1xuICAgIGNvbnN0IHcyID0gd2F0Y2hlciAmJiB3YXRjaGVyW3djYl07XG4gICAgaWYgKHcyKSB7XG4gICAgICBjaGFpbmVkVmFsdWUgPSBhcHBseTcodzIsIHdhdGNoZXIsIFt2YWx1ZSwgLi4ud2F0Y2hlckFyZ3NdKTtcbiAgICB9IGVsc2UgaWYgKHdjYiA9PT0gXCJvblJlamVjdGVkXCIpIHtcbiAgICAgIHRocm93IHZhbHVlO1xuICAgIH1cbiAgICBpZiAocmVzb2x2ZXIpIHtcbiAgICAgIHJlc29sdmVyLnJlc29sdmUoY2hhaW5lZFZhbHVlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYXdhaXQgY2hhaW5lZFZhbHVlO1xuICB9IGNhdGNoIChlMikge1xuICAgIGlmIChyZXNvbHZlcikge1xuICAgICAgcmVzb2x2ZXIucmVqZWN0KGUyKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhyb3cgZTI7XG4gIH1cbn07XG52YXIgcHJlcGFyZVByb21pc2VXYXRjaGVyID0gKHpvbmUsIGlzUmV0cnlhYmxlUmVhc29uMiwgd2F0Y2hOZXh0U3RlcCkgPT4ge1xuICBjb25zdCB3YXRjaGVyU2VlblBheWxvYWRzID0gLyogICAgICAgICAgICovIG5ldyBXZWFrTWFwKCk7XG4gIGNvbnN0IGdldFNlZW5QYXlsb2FkcyA9ICh3YXRjaGVyKSA9PiB7XG4gICAgbGV0IHNlZW5QYXlsb2FkcyA9IHdhdGNoZXJTZWVuUGF5bG9hZHMuZ2V0KHdhdGNoZXIpO1xuICAgIGlmICghc2VlblBheWxvYWRzKSB7XG4gICAgICBzZWVuUGF5bG9hZHMgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtTZXQoKTtcbiAgICAgIHdhdGNoZXJTZWVuUGF5bG9hZHMuc2V0KHdhdGNoZXIsIHNlZW5QYXlsb2Fkcyk7XG4gICAgfVxuICAgIHJldHVybiBzZWVuUGF5bG9hZHM7XG4gIH07XG4gIHJldHVybiB6b25lLmV4b0NsYXNzKFxuICAgIFwiUHJvbWlzZVdhdGNoZXJcIixcbiAgICBQcm9taXNlV2F0Y2hlckksXG4gICAgLypcblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICAocmVzb2x2ZXIsIHdhdGNoZXIsIHdhdGNoZXJBcmdzKSA9PiB7XG4gICAgICBjb25zdCBzdGF0ZSA9IHtcbiAgICAgICAgdm93OiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHZvaWQgMFxuICAgICAgICApLFxuICAgICAgICBwcmlvclJldHJ5VmFsdWU6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB2b2lkIDBcbiAgICAgICAgKSxcbiAgICAgICAgcmVzb2x2ZXIsXG4gICAgICAgIHdhdGNoZXIsXG4gICAgICAgIHdhdGNoZXJBcmdzOiBoYXJkZW4od2F0Y2hlckFyZ3MpXG4gICAgICB9O1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHN0YXRlXG4gICAgICApO1xuICAgIH0sXG4gICAge1xuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZCh2YWx1ZSkge1xuICAgICAgICBjb25zdCB7IHdhdGNoZXIsIHdhdGNoZXJBcmdzLCByZXNvbHZlciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFyZXNvbHZlcikge1xuICAgICAgICAgIHRocm93IEVycm9yKFwiVW5leHBlY3RlZCBtdWx0aXBsZSBjYWxscyB0byBQcm9taXNlV2F0Y2hlclwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwYXlsb2FkID0gZ2V0Vm93UGF5bG9hZCh2YWx1ZSk7XG4gICAgICAgIGlmIChwYXlsb2FkKSB7XG4gICAgICAgICAgY29uc3Qgc2VlblBheWxvYWRzID0gZ2V0U2VlblBheWxvYWRzKHRoaXMuc2VsZik7XG4gICAgICAgICAgaWYgKHNlZW5QYXlsb2Fkcy5oYXMocGF5bG9hZC52b3dWMCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGYub25SZWplY3RlZChFcnJvcihcIlZvdyByZXNvbHV0aW9uIGN5Y2xlIGRldGVjdGVkXCIpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc2VlblBheWxvYWRzLmFkZChwYXlsb2FkLnZvd1YwKTtcbiAgICAgICAgICB0aGlzLnN0YXRlLnZvdyA9IHZhbHVlO1xuICAgICAgICAgIHdhdGNoTmV4dFN0ZXAodmFsdWUsIHRoaXMuc2VsZik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHdhdGNoZXJTZWVuUGF5bG9hZHMuZGVsZXRlKHRoaXMuc2VsZik7XG4gICAgICAgIHRoaXMuc3RhdGUucHJpb3JSZXRyeVZhbHVlID0gdm9pZCAwO1xuICAgICAgICB0aGlzLnN0YXRlLndhdGNoZXIgPSB2b2lkIDA7XG4gICAgICAgIHRoaXMuc3RhdGUucmVzb2x2ZXIgPSB2b2lkIDA7XG4gICAgICAgIHZvaWQgc2V0dGxlKHJlc29sdmVyLCB3YXRjaGVyLCBcIm9uRnVsZmlsbGVkXCIsIHZhbHVlLCB3YXRjaGVyQXJncyk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIG9uUmVqZWN0ZWQocmVhc29uKSB7XG4gICAgICAgIGNvbnN0IHsgdm93LCB3YXRjaGVyLCB3YXRjaGVyQXJncywgcmVzb2x2ZXIsIHByaW9yUmV0cnlWYWx1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgaWYgKCFyZXNvbHZlcikge1xuICAgICAgICAgIHRocm93IEVycm9yKFwiVW5leHBlY3RlZCBtdWx0aXBsZSBjYWxscyB0byBQcm9taXNlV2F0Y2hlclwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXRyeVZhbHVlID0gaXNSZXRyeWFibGVSZWFzb24yKHJlYXNvbiwgcHJpb3JSZXRyeVZhbHVlKTtcbiAgICAgICAgaWYgKHJldHJ5VmFsdWUpIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLnByaW9yUmV0cnlWYWx1ZSA9IHJldHJ5VmFsdWU7XG4gICAgICAgICAgaWYgKHZvdykge1xuICAgICAgICAgICAgd2F0Y2hOZXh0U3RlcCh2b3csIHRoaXMuc2VsZik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHdhdGNoZXJTZWVuUGF5bG9hZHMuZGVsZXRlKHRoaXMuc2VsZik7XG4gICAgICAgIHRoaXMuc3RhdGUucHJpb3JSZXRyeVZhbHVlID0gdm9pZCAwO1xuICAgICAgICB0aGlzLnN0YXRlLnJlc29sdmVyID0gdm9pZCAwO1xuICAgICAgICB0aGlzLnN0YXRlLndhdGNoZXIgPSB2b2lkIDA7XG4gICAgICAgIHZvaWQgc2V0dGxlKHJlc29sdmVyLCB3YXRjaGVyLCBcIm9uUmVqZWN0ZWRcIiwgcmVhc29uLCB3YXRjaGVyQXJncyk7XG4gICAgICB9XG4gICAgfVxuICApO1xufTtcbnZhciBwcmVwYXJlV2F0Y2ggPSAoem9uZSwgbWFrZVZvd0tpdCwgaXNSZXRyeWFibGVSZWFzb24yID0gKF9yZWFzb24sIF9sYXN0VmFsdWUpID0+IHZvaWQgMCkgPT4ge1xuICBjb25zdCB3YXRjaE5leHRTdGVwID0gbWFrZVdhdGNoTmV4dFN0ZXAoem9uZSk7XG4gIGNvbnN0IG1ha2VQcm9taXNlV2F0Y2hlciA9IHByZXBhcmVQcm9taXNlV2F0Y2hlcihcbiAgICB6b25lLFxuICAgIGlzUmV0cnlhYmxlUmVhc29uMixcbiAgICB3YXRjaE5leHRTdGVwXG4gICk7XG4gIGNvbnN0IHdhdGNoID0gKHNwZWNpbWVuUCwgd2F0Y2hlciwgLi4ud2F0Y2hlckFyZ3MpID0+IHtcbiAgICBjb25zdCB7IHJlc29sdmVyLCB2b3cgfSA9IG1ha2VWb3dLaXQoKTtcbiAgICBjb25zdCBwcm9taXNlV2F0Y2hlciA9IG1ha2VQcm9taXNlV2F0Y2hlcihyZXNvbHZlciwgd2F0Y2hlciwgd2F0Y2hlckFyZ3MpO1xuICAgIGNvbnN0IHByb21pc2UgPSBFLnJlc29sdmUoc3BlY2ltZW5QKTtcbiAgICB6b25lLndhdGNoUHJvbWlzZShwcm9taXNlLCBwcm9taXNlV2F0Y2hlcik7XG4gICAgcmV0dXJuIHZvdztcbiAgfTtcbiAgaGFyZGVuKHdhdGNoKTtcbiAgcmV0dXJuIHdhdGNoO1xufTtcbmhhcmRlbihwcmVwYXJlV2F0Y2gpO1xuXG4vL1xudmFyIG1ha2VVbmhhbmRsZWRSZWplY3Rpb25DYW5jZWxsZXIgPSAocmVqZWN0ZWQsIHVwZ3JhZGVkUEspID0+IHtcbiAgcmV0dXJuICgpID0+IHtcbiAgICByZWplY3RlZD8uY2F0Y2goc2luazMpO1xuICAgIHVwZ3JhZGVkUEs/LnJlc29sdmUoKTtcbiAgfTtcbn07XG52YXIgcHJlcGFyZVZvd1JlamVjdGlvblRyYWNrZXIgPSAoem9uZSkgPT4ge1xuICBjb25zdCB2b3dUb0NhbmNlbFVuaGFuZGxlZFJlamVjdGlvbiA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha01hcCgpO1xuICBjb25zdCB1cGdyYWRlUmVqZWN0aW9uV2F0Y2hlciA9IHpvbmUuZXhvKFxuICAgIFwiVXBncmFkZVJlamVjdGlvbldhdGNoZXJcIixcbiAgICBNLmludGVyZmFjZShcIlVwZ3JhZGVSZWplY3Rpb25XYXRjaGVyXCIsIHtcbiAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLnJhdygpLCBNLnJhdygpKS5yZXR1cm5zKClcbiAgICB9KSxcbiAgICB7XG4gICAgICBvblJlamVjdGVkKHVwZ3JhZGVSZWFzb24sIGJhc2VSZWFzb24pIHtcbiAgICAgICAgY29uc3QgcmVhc29uID0gYXNzZXJ0LmVycm9yKFxuICAgICAgICAgIHJlZGFjdGVkYFZPV19SRUpFQ1RJT04gJHtiYXNlUmVhc29ufSBub3QgaGFuZGxlZCBiZWZvcmUgdXBncmFkZSAke3VwZ3JhZGVSZWFzb259YFxuICAgICAgICApO1xuICAgICAgICB0aHJvdyByZWFzb247XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCB2b3dSZWplY3Rpb25UcmFja2VyID0gem9uZS5leG8oXG4gICAgXCJWb3dSZWplY3Rpb25UcmFja2VyXCIsXG4gICAgTS5pbnRlcmZhY2UoXCJWb3dSZWplY3Rpb25UcmFja2VyXCIsIHtcbiAgICAgIGhhbmRsZTogTS5jYWxsKE0ucmVtb3RhYmxlKCkpLnJldHVybnMoKSxcbiAgICAgIHJlamVjdDogTS5jYWxsKE0ucmVtb3RhYmxlKCksIE0ucmF3KCkpLnJldHVybnMoKVxuICAgIH0pLFxuICAgIHtcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgaGFuZGxlKHZvd0NhcCkge1xuICAgICAgICBjb25zdCBjYW5jZWwgPSB2b3dUb0NhbmNlbFVuaGFuZGxlZFJlamVjdGlvbi5nZXQodm93Q2FwKTtcbiAgICAgICAgaWYgKCFjYW5jZWwpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICBhc3NlcnQuZXJyb3IoXG4gICAgICAgICAgICAgIHJlZGFjdGVkYE5vdyBoYW5kbGluZyBhIFZPV19SRUpFQ1RJT04gZnJvbSBhIHByaW9yIGluY2FybmF0aW9uIGZvciAke3Zvd0NhcH1gXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdm93VG9DYW5jZWxVbmhhbmRsZWRSZWplY3Rpb24uZGVsZXRlKHZvd0NhcCk7XG4gICAgICAgIGNhbmNlbCgpO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICByZWplY3Qodm93Q2FwLCByZWFzb24pIHtcbiAgICAgICAgaWYgKHZvd1RvQ2FuY2VsVW5oYW5kbGVkUmVqZWN0aW9uLmhhcyh2b3dDYXApKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGhhcmRlbihyZWFzb24pO1xuICAgICAgICBjb25zdCBiYXNlUmVhc29uID0gem9uZS5pc1N0b3JhYmxlKHJlYXNvbikgPyByZWFzb24gOiBhc3NlcnQuZXJyb3IocmVkYWN0ZWRgVm93IHJlamVjdGlvbiByZWFzb24gd2FzIG5vdCBzdG9yZWQ6ICR7cmVhc29ufWApO1xuICAgICAgICBjb25zdCB1cGdyYWRlZFBLID0gbWFrZVByb21pc2VLaXQoKTtcbiAgICAgICAgem9uZS53YXRjaFByb21pc2UoXG4gICAgICAgICAgdXBncmFkZWRQSy5wcm9taXNlLFxuICAgICAgICAgIHVwZ3JhZGVSZWplY3Rpb25XYXRjaGVyLFxuICAgICAgICAgIGJhc2VSZWFzb25cbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgcmVqZWN0ZWQgPSBQcm9taXNlLnJlamVjdChyZWFzb24pO1xuICAgICAgICBjb25zdCBjYW5jZWwgPSBtYWtlVW5oYW5kbGVkUmVqZWN0aW9uQ2FuY2VsbGVyKHJlamVjdGVkLCB1cGdyYWRlZFBLKTtcbiAgICAgICAgdm93VG9DYW5jZWxVbmhhbmRsZWRSZWplY3Rpb24uc2V0KHZvd0NhcCwgY2FuY2VsKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiB2b3dSZWplY3Rpb25UcmFja2VyO1xufTtcblxuLy9cbnZhciB7IGRlZmluZVByb3BlcnRpZXM6IGRlZmluZVByb3BlcnRpZXM0IH0gPSBPYmplY3Q7XG52YXIgUmV0cnlhYmxlRmxvd0lLaXQgPSBoYXJkZW4oe1xuICBmbG93OiBNLmludGVyZmFjZShcIkZsb3dcIiwge1xuICAgIHJlc3RhcnQ6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgICBnZXRPdXRjb21lOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKVxuICB9KSxcbiAgcmVzdWx0V2F0Y2hlcjogUHJvbWlzZVdhdGNoZXJJXG59KTtcbnZhciBBZG1pblJldHJ5YWJsZUZsb3dJID0gTS5pbnRlcmZhY2UoXCJSZXRyeWFibGVGbG93QWRtaW5cIiwge1xuICBnZXRGbG93Rm9yT3V0Y29tZVZvdzogTS5jYWxsKFZvd1NoYXBlKS5yZXR1cm5zKE0ub3B0KE0ucmVtb3RhYmxlKFwiZmxvd1wiKSkpXG59KTtcbnZhciBwcmVwYXJlUmV0cnlhYmxlVG9vbHMgPSAob3V0ZXJab25lLCBvdXRlck9wdGlvbnMpID0+IHtcbiAgY29uc3QgeyBtYWtlVm93S2l0LCBpc1JldHJ5YWJsZVJlYXNvbjogaXNSZXRyeWFibGVSZWFzb24yIH0gPSBvdXRlck9wdGlvbnM7XG4gIGNvbnN0IGFzVm93ID0gbWFrZUFzVm93KG1ha2VWb3dLaXQpO1xuICBjb25zdCBmbG93Rm9yT3V0Y29tZVZvd0tleSA9IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBvdXRlclpvbmUubWFwU3RvcmUoXCJyZXRyeWFibGVGbG93Rm9yT3V0Y29tZVZvd1wiLCB7XG4gICAgICBrZXlTaGFwZTogTS5yZW1vdGFibGUoXCJ0b1Bhc3NhYmxlQ2FwXCIpLFxuICAgICAgdmFsdWVTaGFwZTogTS5yZW1vdGFibGUoXCJmbG93XCIpXG4gICAgICAvL1xuICAgIH0pXG4gICk7XG4gIGNvbnN0IHByZXBhcmVSZXRyeWFibGVGbG93S2l0ID0gKHpvbmUsIHRhZywgcmV0cnlhYmxlRnVuYykgPT4ge1xuICAgIHR5cGVvZiByZXRyeWFibGVGdW5jID09PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGByZXRyeWFibGVGdW5jIG11c3QgYmUgYSBjYWxsYWJsZSBmdW5jdGlvbiAke3JldHJ5YWJsZUZ1bmN9YDtcbiAgICBjb25zdCBpbnRlcm5hbE1ha2VSZXRyeWFibGVGbG93S2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICAgIHRhZyxcbiAgICAgIFJldHJ5YWJsZUZsb3dJS2l0LFxuICAgICAgKGFjdGl2YXRpb25BcmdzKSA9PiB7XG4gICAgICAgIGhhcmRlbihhY3RpdmF0aW9uQXJncyk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWN0aXZhdGlvbkFyZ3MsXG4gICAgICAgICAgLy9cbiAgICAgICAgICBvdXRjb21lS2l0OiBtYWtlVm93S2l0KCksXG4gICAgICAgICAgLy9cbiAgICAgICAgICBsYXN0UmV0cnlSZWFzb246IHZvaWQgMCxcbiAgICAgICAgICBydW5zOiAwbixcbiAgICAgICAgICBpc0RvbmU6IGZhbHNlXG4gICAgICAgICAgLy9cbiAgICAgICAgfTtcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGZsb3c6IHtcbiAgICAgICAgICAvKlxuXG5cbiAgICAgICAgICAgKi9cbiAgICAgICAgICByZXN0YXJ0KCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBhY3RpdmF0aW9uQXJncywgaXNEb25lIH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdywgcmVzdWx0V2F0Y2hlciB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgIWlzRG9uZSB8fCAvL1xuICAgICAgICAgICAgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcmVzdGFydCBhIGRvbmUgcmV0cnlhYmxlIGZsb3cgJHtmbG93fWA7XG4gICAgICAgICAgICBjb25zdCBydW5JZCA9IHN0YXRlLnJ1bnMgKyAxbjtcbiAgICAgICAgICAgIHN0YXRlLnJ1bnMgPSBydW5JZDtcbiAgICAgICAgICAgIGxldCByZXN1bHRQO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgcmVzdWx0UCA9IFByb21pc2UucmVzb2x2ZShyZXRyeWFibGVGdW5jKC4uLmFjdGl2YXRpb25BcmdzKSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgICAgcmVzdWx0UCA9IFByb21pc2UucmVqZWN0KGVycik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvdXRlclpvbmUud2F0Y2hQcm9taXNlKGhhcmRlbihyZXN1bHRQKSwgcmVzdWx0V2F0Y2hlciwgcnVuSWQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0T3V0Y29tZSgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IG91dGNvbWVLaXQgfSA9IHN0YXRlO1xuICAgICAgICAgICAgcmV0dXJuIG91dGNvbWVLaXQudm93O1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcmVzdWx0V2F0Y2hlcjoge1xuICAgICAgICAgIG9uRnVsZmlsbGVkKHZhbHVlLCBydW5JZCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgcnVucywgb3V0Y29tZUtpdCB9ID0gc3RhdGU7XG4gICAgICAgICAgICBpZiAocnVuSWQgIT09IHJ1bnMpIHJldHVybjtcbiAgICAgICAgICAgICFzdGF0ZS5pc0RvbmUgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgcmVzb2x2ZSBhIGRvbmUgcmV0cnlhYmxlIGZsb3cgJHt0aGlzLmZhY2V0cy5mbG93fWA7XG4gICAgICAgICAgICBvdXRjb21lS2l0LnJlc29sdmVyLnJlc29sdmUodmFsdWUpO1xuICAgICAgICAgICAgZmxvd0Zvck91dGNvbWVWb3dLZXkuZGVsZXRlKHRvUGFzc2FibGVDYXAob3V0Y29tZUtpdC52b3cpKTtcbiAgICAgICAgICAgIHN0YXRlLmlzRG9uZSA9IHRydWU7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgcnVuSWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IHJ1bnMsIG91dGNvbWVLaXQgfSA9IHN0YXRlO1xuICAgICAgICAgICAgaWYgKHJ1bklkICE9PSBydW5zKSByZXR1cm47XG4gICAgICAgICAgICAhc3RhdGUuaXNEb25lIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlamVjdCBhIGRvbmUgcmV0cnlhYmxlIGZsb3cgJHt0aGlzLmZhY2V0cy5mbG93fWA7XG4gICAgICAgICAgICBjb25zdCByZXRyeVJlYXNvbiA9IGlzUmV0cnlhYmxlUmVhc29uMihcbiAgICAgICAgICAgICAgcmVhc29uLFxuICAgICAgICAgICAgICBzdGF0ZS5sYXN0UmV0cnlSZWFzb25cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAocmV0cnlSZWFzb24pIHtcbiAgICAgICAgICAgICAgc3RhdGUubGFzdFJldHJ5UmVhc29uID0gcmV0cnlSZWFzb247XG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmZsb3cucmVzdGFydCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgb3V0Y29tZUtpdC5yZXNvbHZlci5yZWplY3QocmVhc29uKTtcbiAgICAgICAgICAgICAgZmxvd0Zvck91dGNvbWVWb3dLZXkuZGVsZXRlKHRvUGFzc2FibGVDYXAob3V0Y29tZUtpdC52b3cpKTtcbiAgICAgICAgICAgICAgc3RhdGUuaXNEb25lID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICAgIGNvbnN0IG1ha2VSZXRyeWFibGVGbG93S2l0ID0gKGFjdGl2YXRpb25BcmdzKSA9PiB7XG4gICAgICBjb25zdCByZXRyeWFibGVLaXQgPSBpbnRlcm5hbE1ha2VSZXRyeWFibGVGbG93S2l0KGFjdGl2YXRpb25BcmdzKTtcbiAgICAgIGNvbnN0IHsgZmxvdyB9ID0gcmV0cnlhYmxlS2l0O1xuICAgICAgY29uc3Qgdm93ID0gZmxvdy5nZXRPdXRjb21lKCk7XG4gICAgICBmbG93Rm9yT3V0Y29tZVZvd0tleS5pbml0KHRvUGFzc2FibGVDYXAodm93KSwgZmxvdyk7XG4gICAgICBmbG93LnJlc3RhcnQoKTtcbiAgICAgIHJldHVybiByZXRyeWFibGVLaXQ7XG4gICAgfTtcbiAgICByZXR1cm4gaGFyZGVuKG1ha2VSZXRyeWFibGVGbG93S2l0KTtcbiAgfTtcbiAgY29uc3QgcmV0cnlhYmxlID0gKHpvbmUsIHRhZywgcmV0cnlhYmxlRnVuYykgPT4ge1xuICAgIGNvbnN0IG1ha2VSZXRyeWFibGVLaXQgPSBwcmVwYXJlUmV0cnlhYmxlRmxvd0tpdCh6b25lLCB0YWcsIHJldHJ5YWJsZUZ1bmMpO1xuICAgIGNvbnN0IHdyYXBwZXJGdW5jTmFtZSA9IGAke3RhZ31fcmV0cnlhYmxlYDtcbiAgICBjb25zdCB3cmFwcGVyRnVuYyA9IHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBbd3JhcHBlckZ1bmNOYW1lXSguLi5hcmdzKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgem9uZS5pc1N0b3JhYmxlKGhhcmRlbihhcmdzKSkgfHwgdGhyb3dSZWRhY3RlZGByZXRyeWFibGUgYXJndW1lbnRzIG11c3QgYmUgc3RvcmFibGUgJHthcmdzfWA7XG4gICAgICAgICAgY29uc3QgeyBmbG93IH0gPSBtYWtlUmV0cnlhYmxlS2l0KGFyZ3MpO1xuICAgICAgICAgIHJldHVybiBmbG93LmdldE91dGNvbWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVt3cmFwcGVyRnVuY05hbWVdO1xuICAgIGRlZmluZVByb3BlcnRpZXM0KHdyYXBwZXJGdW5jLCB7XG4gICAgICBsZW5ndGg6IHsgdmFsdWU6IHJldHJ5YWJsZUZ1bmMubGVuZ3RoIH1cbiAgICB9KTtcbiAgICByZXR1cm4gaGFyZGVuKHdyYXBwZXJGdW5jKTtcbiAgfTtcbiAgY29uc3QgYWRtaW5SZXRyeWFibGVGbG93ID0gb3V0ZXJab25lLmV4byhcbiAgICBcIkFkbWluUmV0cnlhYmxlRmxvd1wiLFxuICAgIEFkbWluUmV0cnlhYmxlRmxvd0ksXG4gICAge1xuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBnZXRGbG93Rm9yT3V0Y29tZVZvdyhvdXRjb21lVm93KSB7XG4gICAgICAgIHJldHVybiBmbG93Rm9yT3V0Y29tZVZvd0tleS5nZXQodG9QYXNzYWJsZUNhcChvdXRjb21lVm93KSk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBwcmVwYXJlUmV0cnlhYmxlRmxvd0tpdCxcbiAgICBhZG1pblJldHJ5YWJsZUZsb3csXG4gICAgcmV0cnlhYmxlXG4gIH0pO1xufTtcbmhhcmRlbihwcmVwYXJlUmV0cnlhYmxlVG9vbHMpO1xuXG4vL1xudmFyIG1ha2VXaGVuID0gKGlzUmV0cnlhYmxlUmVhc29uMiA9IChcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgKCkgPT4gZmFsc2VcbikpID0+IHtcbiAgY29uc3QgdW53cmFwID0gYXN5bmMgKHNwZWNpbWVuUCkgPT4ge1xuICAgIGF3YWl0IG51bGw7XG4gICAgbGV0IHJlc3VsdCA9IGF3YWl0IHNwZWNpbWVuUDtcbiAgICBsZXQgcGF5bG9hZCA9IGdldFZvd1BheWxvYWQocmVzdWx0KTtcbiAgICBsZXQgcHJpb3JSZXRyeVZhbHVlO1xuICAgIGNvbnN0IHNlZW5QYXlsb2FkcyA9IC8qICAgICAgICAgICAqLyBuZXcgV2Vha1NldCgpO1xuICAgIHdoaWxlIChwYXlsb2FkKSB7XG4gICAgICBjb25zdCB7IHZvd1YwIH0gPSBwYXlsb2FkO1xuICAgICAgaWYgKHNlZW5QYXlsb2Fkcy5oYXModm93VjApKSB7XG4gICAgICAgIHRocm93IEVycm9yKFwiVm93IHJlc29sdXRpb24gY3ljbGUgZGV0ZWN0ZWRcIik7XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBFKHZvd1YwKS5zaG9ydGVuKCk7XG4gICAgICAgIHNlZW5QYXlsb2Fkcy5hZGQodm93VjApO1xuICAgICAgICBwcmlvclJldHJ5VmFsdWUgPSB2b2lkIDA7XG4gICAgICAgIHJlc3VsdCA9IHJlcztcbiAgICAgIH0gY2F0Y2ggKGUyKSB7XG4gICAgICAgIGNvbnN0IG5leHRSZXRyeVZhbHVlID0gaXNSZXRyeWFibGVSZWFzb24yKGUyLCBwcmlvclJldHJ5VmFsdWUpO1xuICAgICAgICBpZiAoIW5leHRSZXRyeVZhbHVlKSB7XG4gICAgICAgICAgdGhyb3cgZTI7XG4gICAgICAgIH1cbiAgICAgICAgcHJpb3JSZXRyeVZhbHVlID0gbmV4dFJldHJ5VmFsdWU7XG4gICAgICB9XG4gICAgICBwYXlsb2FkID0gZ2V0Vm93UGF5bG9hZChyZXN1bHQpO1xuICAgIH1cbiAgICBjb25zdCB1bndyYXBwZWQgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICByZXN1bHRcbiAgICApO1xuICAgIHJldHVybiB1bndyYXBwZWQ7XG4gIH07XG4gIGNvbnN0IHdoZW4gPSAoc3BlY2ltZW5QLCBvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgPT4ge1xuICAgIGNvbnN0IHVud3JhcHBlZCA9IHVud3JhcChzcGVjaW1lblApO1xuICAgIGlmIChvbkZ1bGZpbGxlZCA9PSBudWxsICYmIG9uUmVqZWN0ZWQgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdW53cmFwcGVkXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gRS5yZXNvbHZlKHVud3JhcHBlZCkudGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCk7XG4gIH07XG4gIGhhcmRlbih3aGVuKTtcbiAgcmV0dXJuIHdoZW47XG59O1xuaGFyZGVuKG1ha2VXaGVuKTtcblxuLy9cbnZhciBwcmVwYXJlQmFzaWNWb3dUb29scyA9ICh6b25lLCBwb3dlcnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IGlzUmV0cnlhYmxlUmVhc29uOiBpc1JldHJ5YWJsZVJlYXNvbjIgPSAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAoKSA9PiBmYWxzZVxuICApIH0gPSBwb3dlcnM7XG4gIGNvbnN0IHZvd1JlamVjdGlvblRyYWNrZXIgPSBwcmVwYXJlVm93UmVqZWN0aW9uVHJhY2tlcih6b25lKTtcbiAgY29uc3QgbWFrZVZvd0tpdCA9IHByZXBhcmVWb3dLaXQoem9uZSwgdm93UmVqZWN0aW9uVHJhY2tlcik7XG4gIGNvbnN0IHdoZW4gPSBtYWtlV2hlbihpc1JldHJ5YWJsZVJlYXNvbjIpO1xuICBjb25zdCB3YXRjaCA9IHByZXBhcmVXYXRjaCh6b25lLCBtYWtlVm93S2l0LCBpc1JldHJ5YWJsZVJlYXNvbjIpO1xuICBjb25zdCBtYWtlV2F0Y2hVdGlscyA9IHByZXBhcmVXYXRjaFV0aWxzKHpvbmUsIHtcbiAgICB3YXRjaCxcbiAgICB3aGVuLFxuICAgIG1ha2VWb3dLaXQsXG4gICAgaXNSZXRyeWFibGVSZWFzb246IGlzUmV0cnlhYmxlUmVhc29uMlxuICB9KTtcbiAgY29uc3Qgd2F0Y2hVdGlscyA9IG1ha2VXYXRjaFV0aWxzKCk7XG4gIGNvbnN0IGFzVm93ID0gbWFrZUFzVm93KG1ha2VWb3dLaXQpO1xuICBjb25zdCB7IHJldHJ5YWJsZSB9ID0gcHJlcGFyZVJldHJ5YWJsZVRvb2xzKHpvbmUsIHtcbiAgICBtYWtlVm93S2l0LFxuICAgIGlzUmV0cnlhYmxlUmVhc29uOiBpc1JldHJ5YWJsZVJlYXNvbjJcbiAgfSk7XG4gIGNvbnN0IGFsbCA9IChtYXliZVZvd3MpID0+IHdhdGNoVXRpbHMuYWxsKG1heWJlVm93cyk7XG4gIGNvbnN0IGFsbFZvd3MgPSBhbGw7XG4gIGNvbnN0IGFsbFNldHRsZWQgPSAobWF5YmVWb3dzKSA9PiB3YXRjaFV0aWxzLmFsbFNldHRsZWQobWF5YmVWb3dzKTtcbiAgY29uc3QgYXNQcm9taXNlID0gKHNwZWNpbWVuUCwgLi4ud2F0Y2hlckFyZ3MpID0+IHdhdGNoVXRpbHMuYXNQcm9taXNlKHNwZWNpbWVuUCwgLi4ud2F0Y2hlckFyZ3MpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICB3aGVuLFxuICAgIHdhdGNoLFxuICAgIG1ha2VWb3dLaXQsXG4gICAgYWxsLFxuICAgIGFsbFZvd3MsXG4gICAgYWxsU2V0dGxlZCxcbiAgICBhc1ZvdyxcbiAgICBhc1Byb21pc2UsXG4gICAgcmV0cnlhYmxlLFxuICAgIHJldHJpYWJsZTogcmV0cnlhYmxlXG4gICAgLy9cbiAgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVCYXNpY1Zvd1Rvb2xzKTtcblxuLy9cbnZhciBoaWRkZW5QcmlvckVycm9yMjtcbnZhciBoaWRkZW5DdXJyZW50VHVybjIgPSAwO1xudmFyIGhpZGRlbkN1cnJlbnRFdmVudDIgPSAwO1xudmFyIFZFUkJPU0UyID0gZW52aXJvbm1lbnRPcHRpb25zTGlzdEhhcyhcIkRFQlVHXCIsIFwidHJhY2stdHVybnNcIik7XG52YXIgRU5BQkxFRDIgPSBnZXRFbnZpcm9ubWVudE9wdGlvbihcIlRSQUNLX1RVUk5TXCIsIFwiZGlzYWJsZWRcIiwgW1wiZW5hYmxlZFwiXSkgPT09IFwiZW5hYmxlZFwiO1xudmFyIGFkZFJlamVjdGlvbk5vdGUyID0gKGRldGFpbHNOb3RlKSA9PiAocmVhc29uKSA9PiB7XG4gIGlmIChyZWFzb24gaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIG5vdGUocmVhc29uLCBkZXRhaWxzTm90ZSk7XG4gIH1cbiAgaWYgKFZFUkJPU0UyKSB7XG4gICAgY29uc29sZS5sb2coXCJSRUpFQ1RFRCBhdCB0b3Agb2YgZXZlbnQgbG9vcFwiLCByZWFzb24pO1xuICB9XG59O1xudmFyIHdyYXBGdW5jdGlvbjIgPSAoZnVuYywgc2VuZGluZ0Vycm9yKSA9PiAoLi4uYXJncykgPT4ge1xuICBoaWRkZW5QcmlvckVycm9yMiA9IHNlbmRpbmdFcnJvcjtcbiAgaGlkZGVuQ3VycmVudFR1cm4yICs9IDE7XG4gIGhpZGRlbkN1cnJlbnRFdmVudDIgPSAwO1xuICB0cnkge1xuICAgIGxldCByZXN1bHQ7XG4gICAgdHJ5IHtcbiAgICAgIHJlc3VsdCA9IGZ1bmMoLi4uYXJncyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBpZiAoZXJyIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICAgICAgbm90ZShcbiAgICAgICAgICBlcnIsXG4gICAgICAgICAgcmVkYWN0ZWRgVGhyb3duIGZyb206ICR7aGlkZGVuUHJpb3JFcnJvcjJ9OiR7aGlkZGVuQ3VycmVudFR1cm4yfS4ke2hpZGRlbkN1cnJlbnRFdmVudDJ9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgaWYgKFZFUkJPU0UyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiVEhST1dOIHRvIHRvcCBvZiBldmVudCBsb29wXCIsIGVycik7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICAgIGNvbnN0IGRldGFpbHNOb3RlID0gcmVkYWN0ZWRgUmVqZWN0aW9uIGZyb206ICR7aGlkZGVuUHJpb3JFcnJvcjJ9OiR7aGlkZGVuQ3VycmVudFR1cm4yfS4ke2hpZGRlbkN1cnJlbnRFdmVudDJ9YDtcbiAgICBQcm9taXNlLnJlc29sdmUocmVzdWx0KS5jYXRjaChhZGRSZWplY3Rpb25Ob3RlMihkZXRhaWxzTm90ZSkpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH0gZmluYWxseSB7XG4gICAgaGlkZGVuUHJpb3JFcnJvcjIgPSB2b2lkIDA7XG4gIH1cbn07XG52YXIgdHJhY2tUdXJuczIgPSAoZnVuY3MpID0+IHtcbiAgaWYgKCFFTkFCTEVEMiB8fCB0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gXCJ1bmRlZmluZWRcIiB8fCAhZ2xvYmFsVGhpcy5hc3NlcnQpIHtcbiAgICByZXR1cm4gZnVuY3M7XG4gIH1cbiAgaGlkZGVuQ3VycmVudEV2ZW50MiArPSAxO1xuICBjb25zdCBzZW5kaW5nRXJyb3IgPSBFcnJvcihcbiAgICBgRXZlbnQ6ICR7aGlkZGVuQ3VycmVudFR1cm4yfS4ke2hpZGRlbkN1cnJlbnRFdmVudDJ9YFxuICApO1xuICBpZiAoaGlkZGVuUHJpb3JFcnJvcjIgIT09IHZvaWQgMCkge1xuICAgIG5vdGUoc2VuZGluZ0Vycm9yLCByZWRhY3RlZGBDYXVzZWQgYnk6ICR7aGlkZGVuUHJpb3JFcnJvcjJ9YCk7XG4gIH1cbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICovXG4gICAgZnVuY3MubWFwKChmdW5jKSA9PiBmdW5jICYmIHdyYXBGdW5jdGlvbjIoZnVuYywgc2VuZGluZ0Vycm9yKSlcbiAgKTtcbn07XG5cbi8vXG52YXIgeyBoYXNPd246IGhhc093bjMsIGZyZWV6ZTogZnJlZXplOSwgZW50cmllczogZW50cmllczggfSA9IE9iamVjdDtcbnZhciBpc0pTT05SZWNvcmQyID0gKHZhbCkgPT4gdHlwZW9mIHZhbCA9PT0gXCJvYmplY3RcIiAmJiB2YWwgIT09IG51bGwgJiYgIUFycmF5LmlzQXJyYXkodmFsKTtcbnZhciBzaW1wbGlmeVRhZzIgPSAodGFnKSA9PiB7XG4gIGZvciAoY29uc3QgcHJlZml4IG9mIFtcIkFsbGVnZWQ6IFwiLCBcIkRlYnVnTmFtZTogXCJdKSB7XG4gICAgaWYgKHRhZy5zdGFydHNXaXRoKHByZWZpeCkpIHtcbiAgICAgIHJldHVybiB0YWcuc2xpY2UocHJlZml4Lmxlbmd0aCk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0YWc7XG59O1xudmFyIG1ha2VNZXNzYWdlQnJlYWtwb2ludFRlc3RlcjIgPSAob3B0aW9uTmFtZSkgPT4ge1xuICBsZXQgYnJlYWtwb2ludHMgPSBKU09OLnBhcnNlKGdldEVudmlyb25tZW50T3B0aW9uKG9wdGlvbk5hbWUsIFwibnVsbFwiKSk7XG4gIGlmIChicmVha3BvaW50cyA9PT0gbnVsbCkge1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbiAgbGV0IGJyZWFrcG9pbnRzVGFibGU7XG4gIGNvbnN0IGdldEJyZWFrcG9pbnRzID0gKCkgPT4gYnJlYWtwb2ludHM7XG4gIGZyZWV6ZTkoZ2V0QnJlYWtwb2ludHMpO1xuICBjb25zdCBzZXRCcmVha3BvaW50cyA9IChuZXdCcmVha3BvaW50cyA9IGJyZWFrcG9pbnRzKSA9PiB7XG4gICAgaXNKU09OUmVjb3JkMihuZXdCcmVha3BvaW50cykgfHwgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCAke3F1b3RlKG9wdGlvbk5hbWUpfSBvcHRpb24gdG8gYmUgYSBKU09OIGJyZWFrcG9pbnRzIHJlY29yZGA7XG4gICAgY29uc3QgbmV3QnJlYWtwb2ludHNUYWJsZSA9IHsgX19wcm90b19fOiBudWxsIH07XG4gICAgZm9yIChjb25zdCBbdGFnLCBtZXRob2RCUHNdIG9mIGVudHJpZXM4KG5ld0JyZWFrcG9pbnRzKSkge1xuICAgICAgdGFnID09PSBzaW1wbGlmeVRhZzIodGFnKSB8fCB0aHJvd1JlZGFjdGVkYEp1c3QgdXNlIHNpbXBsZSB0YWcgJHtxdW90ZShzaW1wbGlmeVRhZzIodGFnKSl9IHJhdGhlciB0aGFuICR7cXVvdGUodGFnKX1gO1xuICAgICAgaXNKU09OUmVjb3JkMihtZXRob2RCUHMpIHx8IHRocm93UmVkYWN0ZWRgRXhwZWN0ZWQgJHtxdW90ZShvcHRpb25OYW1lKX0gb3B0aW9uJ3MgJHtxdW90ZShcbiAgICAgICAgdGFnXG4gICAgICApfSB0byBiZSBhIEpTT04gbWV0aG9kcyBicmVha3BvaW50cyByZWNvcmRgO1xuICAgICAgZm9yIChjb25zdCBbbWV0aG9kTmFtZSwgY291bnRdIG9mIGVudHJpZXM4KG1ldGhvZEJQcykpIHtcbiAgICAgICAgY291bnQgPT09IFwiKlwiIHx8IHR5cGVvZiBjb3VudCA9PT0gXCJudW1iZXJcIiAmJiBOdW1iZXIuaXNTYWZlSW50ZWdlcihjb3VudCkgJiYgY291bnQgPj0gMCB8fCB0aHJvd1JlZGFjdGVkYEV4cGVjdGVkICR7cXVvdGUob3B0aW9uTmFtZSl9IG9wdGlvbidzICR7cXVvdGUodGFnKX0uJHtxdW90ZShcbiAgICAgICAgICBtZXRob2ROYW1lXG4gICAgICAgICl9IHRvIGJlIFwiKlwiIG9yIGEgbm9uLW5lZ2F0aXZlIGludGVnZXJgO1xuICAgICAgICBjb25zdCBjbGFzc0JQcyA9IGhhc093bjMobmV3QnJlYWtwb2ludHNUYWJsZSwgbWV0aG9kTmFtZSkgPyBuZXdCcmVha3BvaW50c1RhYmxlW21ldGhvZE5hbWVdIDogbmV3QnJlYWtwb2ludHNUYWJsZVttZXRob2ROYW1lXSA9IHtcbiAgICAgICAgICAvL1xuICAgICAgICAgIF9fcHJvdG9fXzogbnVsbFxuICAgICAgICB9O1xuICAgICAgICBjbGFzc0JQc1t0YWddID0gY291bnQ7XG4gICAgICB9XG4gICAgfVxuICAgIGJyZWFrcG9pbnRzID0gbmV3QnJlYWtwb2ludHM7XG4gICAgYnJlYWtwb2ludHNUYWJsZSA9IG5ld0JyZWFrcG9pbnRzVGFibGU7XG4gIH07XG4gIGZyZWV6ZTkoc2V0QnJlYWtwb2ludHMpO1xuICBjb25zdCBzaG91bGRCcmVha3BvaW50ID0gKHJlY2lwaWVudCwgbWV0aG9kTmFtZSkgPT4ge1xuICAgIGlmIChtZXRob2ROYW1lID09PSB2b2lkIDAgfHwgbWV0aG9kTmFtZSA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBjbGFzc0JQcyA9IGJyZWFrcG9pbnRzVGFibGVbbWV0aG9kTmFtZV0gfHwgYnJlYWtwb2ludHNUYWJsZVtcIipcIl07XG4gICAgaWYgKGNsYXNzQlBzID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgbGV0IHRhZyA9IHNpbXBsaWZ5VGFnMihyZWNpcGllbnRbU3ltYm9sLnRvU3RyaW5nVGFnXSk7XG4gICAgbGV0IGNvdW50ID0gY2xhc3NCUHNbdGFnXTtcbiAgICBpZiAoY291bnQgPT09IHZvaWQgMCkge1xuICAgICAgdGFnID0gXCIqXCI7XG4gICAgICBjb3VudCA9IGNsYXNzQlBzW3RhZ107XG4gICAgICBpZiAoY291bnQgPT09IHZvaWQgMCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChjb3VudCA9PT0gXCIqXCIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpZiAoY291bnQgPT09IDApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBhc3NlcnQodHlwZW9mIGNvdW50ID09PSBcIm51bWJlclwiICYmIGNvdW50ID49IDEpO1xuICAgIGNsYXNzQlBzW3RhZ10gPSBjb3VudCAtIDE7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICBmcmVlemU5KHNob3VsZEJyZWFrcG9pbnQpO1xuICBjb25zdCBicmVha3BvaW50VGVzdGVyID0gZnJlZXplOSh7XG4gICAgZ2V0QnJlYWtwb2ludHMsXG4gICAgc2V0QnJlYWtwb2ludHMsXG4gICAgc2hvdWxkQnJlYWtwb2ludFxuICB9KTtcbiAgYnJlYWtwb2ludFRlc3Rlci5zZXRCcmVha3BvaW50cygpO1xuICByZXR1cm4gYnJlYWtwb2ludFRlc3Rlcjtcbn07XG5mcmVlemU5KG1ha2VNZXNzYWdlQnJlYWtwb2ludFRlc3RlcjIpO1xuXG4vL1xudmFyIHsgYXNzaWduOiBhc3NpZ24yLCBjcmVhdGU6IGNyZWF0ZTYgfSA9IE9iamVjdDtcbnZhciBvblNlbmQyID0gbWFrZU1lc3NhZ2VCcmVha3BvaW50VGVzdGVyMihcIkVORE9fU0VORF9CUkVBS1BPSU5UU1wiKTtcbnZhciBiYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyMiA9IHtcbiAgc2V0KF90YXJnZXQsIF9wcm9wLCBfdmFsdWUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIGlzRXh0ZW5zaWJsZShfdGFyZ2V0KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBzZXRQcm90b3R5cGVPZihfdGFyZ2V0LCBfdmFsdWUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIGRlbGV0ZVByb3BlcnR5KF90YXJnZXQsIF9wcm9wKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xudmFyIG1ha2VFUHJveHlIYW5kbGVyMiA9IChyZWNpcGllbnQsIEhhbmRsZWRQcm9taXNlMiwgdW53cmFwKSA9PiBoYXJkZW4oe1xuICAuLi5iYXNlRnJlZXphYmxlUHJveHlIYW5kbGVyMixcbiAgZ2V0OiAoX3RhcmdldCwgcHJvcGVydHlLZXksIHJlY2VpdmVyKSA9PiB7XG4gICAgcmV0dXJuIGhhcmRlbihcbiAgICAgIHtcbiAgICAgICAgLypcblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBbcHJvcGVydHlLZXldKC4uLmFyZ3MpIHtcbiAgICAgICAgICBpZiAodGhpcyAhPT0gcmVjZWl2ZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBIYW5kbGVkUHJvbWlzZTIucmVqZWN0KFxuICAgICAgICAgICAgICBtYWtlRXJyb3IoXG4gICAgICAgICAgICAgICAgcmVkYWN0ZWRgVW5leHBlY3RlZCByZWNlaXZlciBmb3IgXCIke3F1b3RlKHByb3BlcnR5S2V5KX1cIiBtZXRob2Qgb2YgRSgke3F1b3RlKFxuICAgICAgICAgICAgICAgICAgcmVjaXBpZW50XG4gICAgICAgICAgICAgICAgKX0pYFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob25TZW5kMiAmJiBvblNlbmQyLnNob3VsZEJyZWFrcG9pbnQocmVjaXBpZW50LCBwcm9wZXJ0eUtleSkpIHtcbiAgICAgICAgICAgIGRlYnVnZ2VyO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdW53cmFwKFxuICAgICAgICAgICAgSGFuZGxlZFByb21pc2UyLmFwcGx5TWV0aG9kKHVud3JhcChyZWNpcGllbnQpLCBwcm9wZXJ0eUtleSwgYXJncylcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIC8vXG4gICAgICB9W3Byb3BlcnR5S2V5XVxuICAgICk7XG4gIH0sXG4gIGFwcGx5OiAoX3RhcmdldCwgX3RoaXNBcmcsIGFyZ0FycmF5ID0gW10pID0+IHtcbiAgICBpZiAob25TZW5kMiAmJiBvblNlbmQyLnNob3VsZEJyZWFrcG9pbnQocmVjaXBpZW50LCB2b2lkIDApKSB7XG4gICAgICBkZWJ1Z2dlcjtcbiAgICB9XG4gICAgcmV0dXJuIHVud3JhcChIYW5kbGVkUHJvbWlzZTIuYXBwbHlGdW5jdGlvbih1bndyYXAocmVjaXBpZW50KSwgYXJnQXJyYXkpKTtcbiAgfSxcbiAgaGFzOiAoX3RhcmdldCwgX3ApID0+IHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufSk7XG52YXIgbWFrZUVTZW5kT25seVByb3h5SGFuZGxlcjIgPSAocmVjaXBpZW50LCBIYW5kbGVkUHJvbWlzZTIsIHVud3JhcCkgPT4gaGFyZGVuKHtcbiAgLi4uYmFzZUZyZWV6YWJsZVByb3h5SGFuZGxlcjIsXG4gIGdldDogKF90YXJnZXQsIHByb3BlcnR5S2V5LCByZWNlaXZlcikgPT4ge1xuICAgIHJldHVybiBoYXJkZW4oXG4gICAgICB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgW3Byb3BlcnR5S2V5XSguLi5hcmdzKSB7XG4gICAgICAgICAgdGhpcyA9PT0gcmVjZWl2ZXIgfHwgdGhyb3dSZWRhY3RlZGBVbmV4cGVjdGVkIHJlY2VpdmVyIGZvciBcIiR7cXVvdGUoXG4gICAgICAgICAgICBwcm9wZXJ0eUtleVxuICAgICAgICAgICl9XCIgbWV0aG9kIG9mIEUuc2VuZE9ubHkoJHtxdW90ZShyZWNpcGllbnQpfSlgO1xuICAgICAgICAgIGlmIChvblNlbmQyICYmIG9uU2VuZDIuc2hvdWxkQnJlYWtwb2ludChyZWNpcGllbnQsIHByb3BlcnR5S2V5KSkge1xuICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgfVxuICAgICAgICAgIEhhbmRsZWRQcm9taXNlMi5hcHBseU1ldGhvZFNlbmRPbmx5KFxuICAgICAgICAgICAgdW53cmFwKHJlY2lwaWVudCksXG4gICAgICAgICAgICBwcm9wZXJ0eUtleSxcbiAgICAgICAgICAgIGFyZ3NcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgICAgIH1cbiAgICAgICAgLy9cbiAgICAgIH1bcHJvcGVydHlLZXldXG4gICAgKTtcbiAgfSxcbiAgYXBwbHk6IChfdGFyZ2V0LCBfdGhpc0FyZywgYXJnc0FycmF5ID0gW10pID0+IHtcbiAgICBpZiAob25TZW5kMiAmJiBvblNlbmQyLnNob3VsZEJyZWFrcG9pbnQocmVjaXBpZW50LCB2b2lkIDApKSB7XG4gICAgICBkZWJ1Z2dlcjtcbiAgICB9XG4gICAgSGFuZGxlZFByb21pc2UyLmFwcGx5RnVuY3Rpb25TZW5kT25seSh1bndyYXAocmVjaXBpZW50KSwgYXJnc0FycmF5KTtcbiAgICByZXR1cm4gdm9pZCAwO1xuICB9LFxuICBoYXM6IChfdGFyZ2V0LCBfcCkgPT4ge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59KTtcbnZhciBtYWtlRUdldFByb3h5SGFuZGxlcjIgPSAoeCwgSGFuZGxlZFByb21pc2UyLCB1bndyYXApID0+IGhhcmRlbih7XG4gIC4uLmJhc2VGcmVlemFibGVQcm94eUhhbmRsZXIyLFxuICBoYXM6IChfdGFyZ2V0LCBfcHJvcCkgPT4gdHJ1ZSxcbiAgZ2V0OiAoX3RhcmdldCwgcHJvcCkgPT4gSGFuZGxlZFByb21pc2UyLmdldCh1bndyYXAoeCksIHByb3ApXG59KTtcbnZhciByZXNvbHZlID0gKHgpID0+IEhhbmRsZWRQcm9taXNlLnJlc29sdmUoeCk7XG52YXIgbWFrZUUyID0gKEhhbmRsZWRQcm9taXNlMiwgcG93ZXJzID0ge30pID0+IHtcbiAgY29uc3Qge1xuICAgIGFkZGl0aW9uYWwgPSAoXG4gICAgICAvKiAgICAgICAgICAgICovXG4gICAgICB7fVxuICAgICksXG4gICAgdW53cmFwID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICByZXNvbHZlXG4gICAgKVxuICB9ID0gcG93ZXJzO1xuICByZXR1cm4gaGFyZGVuKFxuICAgIGFzc2lnbjIoXG4gICAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgICh4KSA9PiBoYXJkZW4oXG4gICAgICAgIG5ldyBQcm94eSgoKSA9PiB7XG4gICAgICAgIH0sIG1ha2VFUHJveHlIYW5kbGVyMih4LCBIYW5kbGVkUHJvbWlzZTIsIHVud3JhcCkpXG4gICAgICApLFxuICAgICAge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgZ2V0OiAoeCkgPT4gaGFyZGVuKFxuICAgICAgICAgIG5ldyBQcm94eShcbiAgICAgICAgICAgIGNyZWF0ZTYobnVsbCksXG4gICAgICAgICAgICBtYWtlRUdldFByb3h5SGFuZGxlcjIoeCwgSGFuZGxlZFByb21pc2UyLCB1bndyYXApXG4gICAgICAgICAgKVxuICAgICAgICApLFxuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICByZXNvbHZlOiAoeCkgPT4gcmVzb2x2ZSh1bndyYXAoeCkpLFxuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBzZW5kT25seTogKHgpID0+IGhhcmRlbihcbiAgICAgICAgICBuZXcgUHJveHkoXG4gICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbWFrZUVTZW5kT25seVByb3h5SGFuZGxlcjIoeCwgSGFuZGxlZFByb21pc2UyLCB1bndyYXApXG4gICAgICAgICAgKVxuICAgICAgICApLFxuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHdoZW46ICh4LCBvbmZ1bGZpbGxlZCwgb25yZWplY3RlZCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHVud3JhcHBlZCA9IHJlc29sdmUodW53cmFwKHgpKTtcbiAgICAgICAgICBpZiAob25mdWxmaWxsZWQgPT0gbnVsbCAmJiBvbnJlamVjdGVkID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiB1bndyYXBwZWQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB1bndyYXBwZWQudGhlbihcbiAgICAgICAgICAgIC4uLnRyYWNrVHVybnMyKFxuICAgICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICBbb25mdWxmaWxsZWQsIG9ucmVqZWN0ZWRdXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGFkZGl0aW9uYWxcbiAgICApXG4gICk7XG59O1xudmFyIEVfZGVmYXVsdDIgPSBtYWtlRTI7XG5cbi8vXG52YXIgaXNSZXRyeWFibGVSZWFzb24gPSAocmVhc29uLCBwcmlvclJldHJ5VmFsdWUpID0+IHtcbiAgaWYgKGlzVXBncmFkZURpc2Nvbm5lY3Rpb24ocmVhc29uKSAmJiAoIWlzVXBncmFkZURpc2Nvbm5lY3Rpb24ocHJpb3JSZXRyeVZhbHVlKSB8fCByZWFzb24uaW5jYXJuYXRpb25OdW1iZXIgPiBwcmlvclJldHJ5VmFsdWUuaW5jYXJuYXRpb25OdW1iZXIpKSB7XG4gICAgcmV0dXJuIHJlYXNvbjtcbiAgfVxuICBpZiAoaXNBYmFuZG9uZWRFcnJvcihyZWFzb24pICYmICFpc0FiYW5kb25lZEVycm9yKHByaW9yUmV0cnlWYWx1ZSkpIHtcbiAgICByZXR1cm4gcmVhc29uO1xuICB9XG4gIHJldHVybiB2b2lkIDA7XG59O1xudmFyIGRlZmF1bHRQb3dlcnMgPSBoYXJkZW4oe1xuICBpc1JldHJ5YWJsZVJlYXNvblxufSk7XG52YXIgcHJlcGFyZVN3aW5nc2V0Vm93VG9vbHMgPSAoem9uZSwgcG93ZXJzID0ge30pID0+IHByZXBhcmVCYXNpY1Zvd1Rvb2xzKHpvbmUsIHsgLi4uZGVmYXVsdFBvd2VycywgLi4ucG93ZXJzIH0pO1xuaGFyZGVuKHByZXBhcmVTd2luZ3NldFZvd1Rvb2xzKTtcbnZhciBoZWFwVm93VG9vbHMgPSBwcmVwYXJlU3dpbmdzZXRWb3dUb29scyhtYWtlSGVhcFpvbmUoKSk7XG52YXIgaGVhcFZvd0UgPSBFX2RlZmF1bHQyKGdsb2JhbFRoaXMuSGFuZGxlZFByb21pc2UsIHtcbiAgdW53cmFwOiBoZWFwVm93VG9vbHMud2hlbixcbiAgYWRkaXRpb25hbDogeyB3aGVuOiBoZWFwVm93VG9vbHMud2hlbiB9XG59KTtcblxuLy9cbnZhciBPdXRib3VuZENvbm5lY3Rpb25IYW5kbGVySSA9IE0uaW50ZXJmYWNlKFxuICBcIk91dGJvdW5kQ29ubmVjdGlvbkhhbmRsZXJcIixcbiAge1xuICAgIG9uT3BlbjogTS5jYWxsV2hlbihNLmFueSgpLCBNLnN0cmluZygpLCBNLnN0cmluZygpLCBNLmFueSgpKS5yZXR1cm5zKFxuICAgICAgTS5hbnkoKVxuICAgICksXG4gICAgb25DbG9zZTogTS5jYWxsV2hlbihNLmFueSgpLCBNLmFueSgpLCBNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gIH1cbik7XG52YXIgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUgPSB7XG4gIGNoYWluSWQ6IE0uc3RyaW5nKCksXG4gIC8vXG4gIGVuY29kaW5nOiBNLnN0cmluZygpLFxuICB2YWx1ZTogTS5zdHJpbmcoKVxufTtcbmhhcmRlbihDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSk7XG52YXIgQ2FpcDEwUmVjb3JkU2hhcGUgPSB7XG4gIG5hbWVzcGFjZTogTS5zdHJpbmcoKSxcbiAgcmVmZXJlbmNlOiBNLnN0cmluZygpLFxuICBhY2NvdW50QWRkcmVzczogTS5zdHJpbmcoKVxufTtcbmhhcmRlbihDYWlwMTBSZWNvcmRTaGFwZSk7XG52YXIgQWNjb3VudElkQXJnU2hhcGUgPSBNLm9yKE0uc3RyaW5nKCksIENvc21vc0NoYWluQWRkcmVzc1NoYXBlKTtcbnZhciBQcm90bzNTaGFwZSA9IHsgdHlwZVVybDogTS5zdHJpbmcoKSwgdmFsdWU6IE0uc3RyaW5nKCkgfTtcbmhhcmRlbihQcm90bzNTaGFwZSk7XG52YXIgSUJDQ2hhbm5lbElEU2hhcGUgPSBNLnN0cmluZygpO1xudmFyIElCQ0NoYW5uZWxJbmZvU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHtcbiAgcG9ydElkOiBNLnN0cmluZygpLFxuICBjaGFubmVsSWQ6IElCQ0NoYW5uZWxJRFNoYXBlLFxuICBjb3VudGVyUGFydHlQb3J0SWQ6IE0uc3RyaW5nKCksXG4gIGNvdW50ZXJQYXJ0eUNoYW5uZWxJZDogSUJDQ2hhbm5lbElEU2hhcGUsXG4gIG9yZGVyaW5nOiBNLnNjYWxhcigpLFxuICAvL1xuICBzdGF0ZTogTS5zY2FsYXIoKSxcbiAgLy9cbiAgdmVyc2lvbjogTS5zdHJpbmcoKVxufSk7XG52YXIgSUJDQ29ubmVjdGlvbklEU2hhcGUgPSBNLnN0cmluZygpO1xudmFyIElCQ0Nvbm5lY3Rpb25JbmZvU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHtcbiAgaWQ6IElCQ0Nvbm5lY3Rpb25JRFNoYXBlLFxuICBjbGllbnRfaWQ6IE0uc3RyaW5nKCksXG4gIHN0YXRlOiBNLnNjYWxhcigpLFxuICAvL1xuICBjb3VudGVycGFydHk6IHtcbiAgICBjbGllbnRfaWQ6IE0uc3RyaW5nKCksXG4gICAgY29ubmVjdGlvbl9pZDogSUJDQ29ubmVjdGlvbklEU2hhcGVcbiAgfSxcbiAgdHJhbnNmZXJDaGFubmVsOiBJQkNDaGFubmVsSW5mb1NoYXBlXG59KTtcbnZhciBDb3Ntb3NBc3NldEluZm9TaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBiYXNlOiBNLnN0cmluZygpLFxuICBuYW1lOiBNLnN0cmluZygpLFxuICBkaXNwbGF5OiBNLnN0cmluZygpLFxuICBzeW1ib2w6IE0uc3RyaW5nKCksXG4gIGRlbm9tX3VuaXRzOiBNLmFycmF5T2YoXG4gICAgTS5zcGxpdFJlY29yZCh7IGRlbm9tOiBNLnN0cmluZygpLCBleHBvbmVudDogTS5udW1iZXIoKSB9KVxuICApXG59KTtcbnZhciBDaGFpbkluZm9SZXF1aXJlZFNoYXBlID0ge1xuICBuYW1lc3BhY2U6IE0uc3RyaW5nKCksXG4gIHJlZmVyZW5jZTogTS5zdHJpbmcoKVxufTtcbnZhciBDaGFpbkluZm9PcHRpb25hbFNoYXBlID0ge1xuICBjY3RwRGVzdGluYXRpb25Eb21haW46IE0ubnVtYmVyKClcbn07XG52YXIgQmFzZUNoYWluSW5mb1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAgQ2hhaW5JbmZvUmVxdWlyZWRTaGFwZSxcbiAgQ2hhaW5JbmZvT3B0aW9uYWxTaGFwZVxuKTtcbmhhcmRlbihCYXNlQ2hhaW5JbmZvU2hhcGUpO1xudmFyIENvc21vc0NoYWluSW5mb1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge1xuICAgIGNoYWluSWQ6IE0uc3RyaW5nKCksXG4gICAgYmVjaDMyUHJlZml4OiBNLnN0cmluZygpLFxuICAgIC4uLkNoYWluSW5mb1JlcXVpcmVkU2hhcGVcbiAgfSxcbiAge1xuICAgIGNvbm5lY3Rpb25zOiBNLnJlY29yZCgpLFxuICAgIC8vXG4gICAgaWNxRW5hYmxlZDogTS5ib29sZWFuKCksXG4gICAgcGZtRW5hYmxlZDogTS5ib29sZWFuKCksXG4gICAgc3Rha2luZ1Rva2VuczogTS5hcnJheU9mKHsgZGVub206IE0uc3RyaW5nKCkgfSksXG4gICAgLi4uQ2hhaW5JbmZvT3B0aW9uYWxTaGFwZVxuICB9XG4pO1xuaGFyZGVuKENvc21vc0NoYWluSW5mb1NoYXBlKTtcbnZhciBDaGFpbkluZm9TaGFwZSA9IE0ub3IoQ29zbW9zQ2hhaW5JbmZvU2hhcGUsIEJhc2VDaGFpbkluZm9TaGFwZSk7XG5oYXJkZW4oQ2hhaW5JbmZvU2hhcGUpO1xudmFyIERlbm9tU2hhcGUgPSBNLnN0cmluZygpO1xudmFyIENvaW5TaGFwZSA9IHtcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgYW1vdW50OiBNLnN0cmluZygpLFxuICBkZW5vbTogRGVub21TaGFwZVxufTtcbmhhcmRlbihDb2luU2hhcGUpO1xudmFyIERlbm9tSW5mb1NoYXBlID0ge1xuICBjaGFpbjogTS5yZW1vdGFibGUoXCJDaGFpblwiKSxcbiAgYmFzZTogTS5yZW1vdGFibGUoXCJDaGFpblwiKSxcbiAgYnJhbmQ6IE0ub3IoTS5yZW1vdGFibGUoXCJCcmFuZFwiKSwgTS51bmRlZmluZWQoKSksXG4gIGJhc2VEZW5vbTogTS5zdHJpbmcoKVxufTtcbmhhcmRlbihEZW5vbUluZm9TaGFwZSk7XG52YXIgRGVub21EZXRhaWxTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHsgY2hhaW5OYW1lOiBNLnN0cmluZygpLCBiYXNlTmFtZTogTS5zdHJpbmcoKSwgYmFzZURlbm9tOiBNLnN0cmluZygpIH0sXG4gIHsgYnJhbmQ6IEJyYW5kU2hhcGUgfVxuKTtcbmhhcmRlbihEZW5vbURldGFpbFNoYXBlKTtcbnZhciBEZW5vbUFtb3VudFNoYXBlID0geyBkZW5vbTogRGVub21TaGFwZSwgdmFsdWU6IE0ubmF0KCkgfTtcbmhhcmRlbihEZW5vbUFtb3VudFNoYXBlKTtcbnZhciBBbnlOYXRBbW91bnRTaGFwZSA9IHtcbiAgYnJhbmQ6IE0ucmVtb3RhYmxlKFwiQnJhbmRcIiksXG4gIHZhbHVlOiBNLm5hdCgpXG59O1xuaGFyZGVuKEFueU5hdEFtb3VudFNoYXBlKTtcbnZhciBBbW91bnRBcmdTaGFwZSA9IE0ub3IoQW55TmF0QW1vdW50U2hhcGUsIERlbm9tQW1vdW50U2hhcGUpO1xudmFyIERlbGVnYXRpb25TaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICB2YWxpZGF0b3I6IENvc21vc0NoYWluQWRkcmVzc1NoYXBlLFxuICAgIGFtb3VudDogQW1vdW50QXJnU2hhcGVcbiAgfSxcbiAgeyBkZWxlZ2F0b3I6IENvc21vc0NoYWluQWRkcmVzc1NoYXBlIH1cbik7XG52YXIgSUNRTXNnU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7IHBhdGg6IE0uc3RyaW5nKCksIGRhdGE6IE0uc3RyaW5nKCkgfSxcbiAgeyBoZWlnaHQ6IE0uc3RyaW5nKCksIHByb3ZlOiBNLmJvb2xlYW4oKSB9XG4pO1xudmFyIFR5cGVkSnNvblNoYXBlID0gTS5zcGxpdFJlY29yZCh7IFwiQHR5cGVcIjogTS5zdHJpbmcoKSB9KTtcbnZhciBjaGFpbkZhY2FkZU1ldGhvZHMgPSB7XG4gIGdldENoYWluSW5mbzogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIG1ha2VBY2NvdW50OiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKVxufTtcbmhhcmRlbihjaGFpbkZhY2FkZU1ldGhvZHMpO1xudmFyIFRpbWVzdGFtcFByb3RvU2hhcGUgPSB7IHNlY29uZHM6IE0uc3RyaW5nKCksIG5hbm9zOiBNLm51bWJlcigpIH07XG5oYXJkZW4oVGltZXN0YW1wUHJvdG9TaGFwZSk7XG52YXIgVHhCb2R5T3B0c1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge30sXG4gIHtcbiAgICBtZW1vOiBNLnN0cmluZygpLFxuICAgIHRpbWVvdXRIZWlnaHQ6IE0uYmlnaW50KCksXG4gICAgZXh0ZW5zaW9uT3B0aW9uczogTS5hcnJheU9mKE0uYW55KCkpLFxuICAgIG5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9uczogTS5hcnJheU9mKE0uYW55KCkpXG4gIH1cbik7XG52YXIgQW55TmF0QW1vdW50c1JlY29yZCA9IE0uYW5kKFxuICBNLnJlY29yZE9mKE0uc3RyaW5nKCksIEFueU5hdEFtb3VudFNoYXBlKSxcbiAgTS5ub3Qoe30pXG4pO1xudmFyIE9yY2hlc3RyYXRpb25Qb3dlcnNTaGFwZSA9IHtcbiAgYWdvcmljTmFtZXM6IE0ucmVtb3RhYmxlKCksXG4gIGxvY2FsY2hhaW46IE0ucmVtb3RhYmxlKCksXG4gIG9yY2hlc3RyYXRpb25TZXJ2aWNlOiBNLnJlbW90YWJsZSgpLFxuICBzdG9yYWdlTm9kZTogTS5yZW1vdGFibGUoKSxcbiAgdGltZXJTZXJ2aWNlOiBNLnJlbW90YWJsZSgpXG59O1xuaGFyZGVuKE9yY2hlc3RyYXRpb25Qb3dlcnNTaGFwZSk7XG52YXIgRm9yd2FyZEFyZ3NTaGFwZSA9IHtcbiAgcmVjZWl2ZXI6IE0uc3RyaW5nKCksXG4gIHBvcnQ6IFwidHJhbnNmZXJcIixcbiAgY2hhbm5lbDogTS5zdHJpbmcoKSxcbiAgdGltZW91dDogTS5zdHJpbmcoKSxcbiAgcmV0cmllczogTS5udW1iZXIoKVxufTtcbmhhcmRlbihGb3J3YXJkQXJnc1NoYXBlKTtcbnZhciBGb3J3YXJkSW5mb1NoYXBlID0ge1xuICBmb3J3YXJkOiBNLnNwbGl0UmVjb3JkKEZvcndhcmRBcmdzU2hhcGUsIHtcbiAgICAvKlxuXG5cbiAgICAgKi9cbiAgICBuZXh0OiB7XG4gICAgICBmb3J3YXJkOiBGb3J3YXJkQXJnc1NoYXBlXG4gICAgfVxuICB9KVxufTtcbmhhcmRlbihGb3J3YXJkSW5mb1NoYXBlKTtcbnZhciBGb3J3YXJkT3B0c1NoYXBlID0gTS5zcGxpdFJlY29yZChcbiAge30sXG4gIHtcbiAgICB0aW1lb3V0OiBNLnN0cmluZygpLFxuICAgIHJldHJpZXM6IE0ubnVtYmVyKCksXG4gICAgaW50ZXJtZWRpYXRlUmVjaXBpZW50OiBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZVxuICB9LFxuICB7fVxuKTtcbnZhciBJQkNUcmFuc2Zlck9wdGlvbnNTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHt9LFxuICB7XG4gICAgdGltZW91dFRpbWVzdGFtcDogTS5iaWdpbnQoKSxcbiAgICB0aW1lb3V0SGVpZ2h0OiB7XG4gICAgICByZXZpc2lvbkhlaWdodDogTS5iaWdpbnQoKSxcbiAgICAgIHJldmlzaW9uTnVtYmVyOiBNLmJpZ2ludCgpXG4gICAgfSxcbiAgICBtZW1vOiBNLnN0cmluZygpLFxuICAgIGZvcndhcmRPcHRzOiBGb3J3YXJkT3B0c1NoYXBlXG4gIH1cbik7XG5cbi8vXG52YXIgVHhTdGF0dXMgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBPYnNlcnZlZDogXCJPQlNFUlZFRFwiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQWR2YW5jaW5nOiBcIkFEVkFOQ0lOR1wiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBBZHZhbmNlZDogXCJBRFZBTkNFRFwiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQWR2YW5jZUZhaWxlZDogXCJBRFZBTkNFX0ZBSUxFRFwiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBBZHZhbmNlU2tpcHBlZDogXCJBRFZBTkNFX1NLSVBQRURcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgRGlzYnVyc2VkOiBcIkRJU0JVUlNFRFwiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEZvcndhcmRlZDogXCJGT1JXQVJERURcIixcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgRm9yd2FyZEZhaWxlZDogXCJGT1JXQVJEX0ZBSUxFRFwiXG4gIH1cbik7XG5oYXJkZW4oVHhTdGF0dXMpO1xudmFyIFRlcm1pbmFsVHhTdGF0dXMgPSB7XG4gIFtUeFN0YXR1cy5Gb3J3YXJkZWRdOiB0cnVlLFxuICBbVHhTdGF0dXMuRm9yd2FyZEZhaWxlZF06IHRydWUsXG4gIFtUeFN0YXR1cy5EaXNidXJzZWRdOiB0cnVlXG59O1xudmFyIFBlbmRpbmdUeFN0YXR1cyA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIE9ic2VydmVkOiBcIk9CU0VSVkVEXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBBZHZhbmNpbmc6IFwiQURWQU5DSU5HXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBBZHZhbmNlRmFpbGVkOiBcIkFEVkFOQ0VfRkFJTEVEXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEFkdmFuY2VkOiBcIkFEVkFOQ0VEXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEFkdmFuY2VTa2lwcGVkOiBcIkFEVkFOQ0VfU0tJUFBFRFwiXG4gIH1cbik7XG5oYXJkZW4oUGVuZGluZ1R4U3RhdHVzKTtcblxuLy9cbnZhciBtYWtlTmF0QW1vdW50U2hhcGUgPSAoYnJhbmQsIG1pbikgPT4gaGFyZGVuKHsgYnJhbmQsIHZhbHVlOiBtaW4gPyBNLmd0ZShtaW4pIDogTS5uYXQoKSB9KTtcbnZhciBtYWtlUHJvcG9zYWxTaGFwZXMgPSAoeyBQb29sU2hhcmVzLCBVU0RDIH0pID0+IHtcbiAgY29uc3QgZGVwb3NpdCA9IE0uc3BsaXRSZWNvcmQoe1xuICAgIGdpdmU6IHsgVVNEQzogbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDFuKSB9LFxuICAgIHdhbnQ6IHsgUG9vbFNoYXJlOiBtYWtlTmF0QW1vdW50U2hhcGUoUG9vbFNoYXJlcykgfVxuICB9KTtcbiAgY29uc3Qgd2l0aGRyYXcgPSBNLnNwbGl0UmVjb3JkKHtcbiAgICBnaXZlOiB7IFBvb2xTaGFyZTogbWFrZU5hdEFtb3VudFNoYXBlKFBvb2xTaGFyZXMsIDFuKSB9LFxuICAgIHdhbnQ6IHsgVVNEQzogbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDFuKSB9XG4gIH0pO1xuICBjb25zdCB3aXRoZHJhd0ZlZXMgPSBNLnNwbGl0UmVjb3JkKHtcbiAgICB3YW50OiB7IFVTREM6IG1ha2VOYXRBbW91bnRTaGFwZShVU0RDLCAxbikgfVxuICB9KTtcbiAgcmV0dXJuIGhhcmRlbih7IGRlcG9zaXQsIHdpdGhkcmF3LCB3aXRoZHJhd0ZlZXMgfSk7XG59O1xudmFyIEZhc3RVU0RDVGVybXNTaGFwZSA9IGhhcmRlbih7XG4gIHVzZGNEZW5vbTogTS5zdHJpbmcoKVxufSk7XG52YXIgRXZtQWRkcmVzc1NoYXBlID0gTS5zdHJpbmcoe1xuICAvL1xuICBzdHJpbmdMZW5ndGhMaW1pdDogNDJcbn0pO1xuaGFyZGVuKEV2bUFkZHJlc3NTaGFwZSk7XG52YXIgRXZtSGFzaFNoYXBlID0gTS5zdHJpbmcoe1xuICBzdHJpbmdMZW5ndGhMaW1pdDogNjZcbn0pO1xuaGFyZGVuKEV2bUhhc2hTaGFwZSk7XG52YXIgUmlza0Fzc2Vzc21lbnRTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHt9LFxuICB7XG4gICAgcmlza3NJZGVudGlmaWVkOiBNLmFycmF5T2YoTS5zdHJpbmcoKSlcbiAgfVxuKTtcbmhhcmRlbihSaXNrQXNzZXNzbWVudFNoYXBlKTtcbnZhciBDY3RwVHhFdmlkZW5jZVNoYXBlID0ge1xuICBhdXg6IHtcbiAgICBmb3J3YXJkaW5nQ2hhbm5lbDogTS5zdHJpbmcoKSxcbiAgICByZWNpcGllbnRBZGRyZXNzOiBNLnN0cmluZygpXG4gIH0sXG4gIGJsb2NrSGFzaDogRXZtSGFzaFNoYXBlLFxuICBibG9ja051bWJlcjogTS5uYXQoKSxcbiAgYmxvY2tUaW1lc3RhbXA6IE0ubmF0KCksXG4gIGNoYWluSWQ6IE0ubnVtYmVyKCksXG4gIHR4OiB7XG4gICAgYW1vdW50OiBNLm5hdCgpLFxuICAgIGZvcndhcmRpbmdBZGRyZXNzOiBNLnN0cmluZygpLFxuICAgIHNlbmRlcjogRXZtQWRkcmVzc1NoYXBlXG4gIH0sXG4gIHR4SGFzaDogRXZtSGFzaFNoYXBlXG59O1xuaGFyZGVuKENjdHBUeEV2aWRlbmNlU2hhcGUpO1xudmFyIEV2aWRlbmNlV2l0aFJpc2tTaGFwZSA9IHtcbiAgZXZpZGVuY2U6IENjdHBUeEV2aWRlbmNlU2hhcGUsXG4gIHJpc2s6IFJpc2tBc3Nlc3NtZW50U2hhcGVcbn07XG5oYXJkZW4oRXZpZGVuY2VXaXRoUmlza1NoYXBlKTtcbnZhciBQZW5kaW5nVHhTaGFwZSA9IHtcbiAgLi4uQ2N0cFR4RXZpZGVuY2VTaGFwZSxcbiAgc3RhdHVzOiBNLm9yKC4uLk9iamVjdC52YWx1ZXMoUGVuZGluZ1R4U3RhdHVzKSlcbn07XG5oYXJkZW4oUGVuZGluZ1R4U2hhcGUpO1xudmFyIEFkZHJlc3NIb29rU2hhcGUgPSB7XG4gIGJhc2VBZGRyZXNzOiBNLnN0cmluZygpLFxuICBxdWVyeTogeyBFVUQ6IE0uc3RyaW5nKCkgfVxufTtcbmhhcmRlbihBZGRyZXNzSG9va1NoYXBlKTtcbnZhciBOYXRBbW91bnRTaGFwZSA9IHsgYnJhbmQ6IEJyYW5kU2hhcGUsIHZhbHVlOiBNLm5hdCgpIH07XG52YXIgRGVzdGluYXRpb25PdmVycmlkZXNTaGFwZSA9IE0ucmVjb3JkT2YoXG4gIE0uc3RyaW5nKCksXG4gIE0uc3BsaXRSZWNvcmQoXG4gICAge30sXG4gICAge1xuICAgICAgZmxhdDogTmF0QW1vdW50U2hhcGUsXG4gICAgICB2YXJpYWJsZVJhdGU6IFJhdGlvU2hhcGUsXG4gICAgICBjb250cmFjdFJhdGU6IFJhdGlvU2hhcGUsXG4gICAgICByZWxheTogTmF0QW1vdW50U2hhcGVcbiAgICB9XG4gIClcbik7XG52YXIgRmVlQ29uZmlnU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgZmxhdDogTmF0QW1vdW50U2hhcGUsXG4gICAgdmFyaWFibGVSYXRlOiBSYXRpb1NoYXBlLFxuICAgIGNvbnRyYWN0UmF0ZTogUmF0aW9TaGFwZVxuICB9LFxuICB7XG4gICAgcmVsYXk6IE5hdEFtb3VudFNoYXBlLFxuICAgIGRlc3RpbmF0aW9uT3ZlcnJpZGVzOiBEZXN0aW5hdGlvbk92ZXJyaWRlc1NoYXBlXG4gIH0sXG4gIHt9XG4pO1xudmFyIFBvb2xNZXRyaWNzU2hhcGUgPSB7XG4gIGVuY3VtYmVyZWRCYWxhbmNlOiBBbW91bnRTaGFwZSxcbiAgc2hhcmVXb3J0aDogUmF0aW9TaGFwZSxcbiAgdG90YWxDb250cmFjdEZlZXM6IEFtb3VudFNoYXBlLFxuICB0b3RhbFBvb2xGZWVzOiBBbW91bnRTaGFwZSxcbiAgdG90YWxCb3Jyb3dzOiBBbW91bnRTaGFwZSxcbiAgdG90YWxSZXBheXM6IEFtb3VudFNoYXBlXG59O1xuaGFyZGVuKFBvb2xNZXRyaWNzU2hhcGUpO1xudmFyIENoYWluUG9saWN5U2hhcGUgPSB7XG4gIGF0dGVudWF0ZWRDdHRwQnJpZGdlQWRkcmVzc2VzOiBNLnNwbGl0QXJyYXkoXG4gICAgW0V2bUhhc2hTaGFwZV0sXG4gICAgdm9pZCAwLFxuICAgIE0uYXJyYXlPZihFdm1IYXNoU2hhcGUpXG4gICksXG4gIGNjdHBUb2tlbk1lc3NlbmdlckFkZHJlc3M6IEV2bUhhc2hTaGFwZSxcbiAgY29uZmlybWF0aW9uczogTS5udW1iZXIoKSxcbiAgY2hhaW5JZDogTS5udW1iZXIoKSxcbiAgcmF0ZUxpbWl0czoge1xuICAgIHR4OiBNLmJpZ2ludCgpLFxuICAgIGJsb2NrV2luZG93OiBNLmJpZ2ludCgpLFxuICAgIGJsb2NrV2luZG93U2l6ZTogTS5udW1iZXIoKVxuICB9XG59O1xuaGFyZGVuKENoYWluUG9saWN5U2hhcGUpO1xudmFyIEZlZWRQb2xpY3lTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBub2JsZURvbWFpbklkOiBNLm51bWJlcigpLFxuICAgIG5vYmxlQWdvcmljQ2hhbm5lbElkOiBNLnN0cmluZygpLFxuICAgIGNoYWluUG9saWNpZXM6IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgQ2hhaW5Qb2xpY3lTaGFwZSlcbiAgfSxcbiAgeyBldmVudEZpbHRlcjogTS5zdHJpbmcoKSB9XG4pO1xuaGFyZGVuKEZlZWRQb2xpY3lTaGFwZSk7XG52YXIgQ29zbW9zQ2hhaW5JbmZvU2hhcGVWMSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBjaGFpbklkOiBNLnN0cmluZygpXG4gIH0sXG4gIHtcbiAgICBiZWNoMzJQcmVmaXg6IE0uc3RyaW5nKCksXG4gICAgY29ubmVjdGlvbnM6IE0ucmVjb3JkKCksXG4gICAgc3Rha2luZ1Rva2VuczogTS5hcnJheU9mKHsgZGVub206IE0uc3RyaW5nKCkgfSksXG4gICAgLy9cbiAgICBpY3FFbmFibGVkOiBNLmJvb2xlYW4oKSxcbiAgICBwZm1FbmFibGVkOiBNLmJvb2xlYW4oKVxuICB9XG4pO1xudmFyIEZhc3RVU0RDQ29uZmlnU2hhcGUgPSBNLnNwbGl0UmVjb3JkKHtcbiAgdGVybXM6IEZhc3RVU0RDVGVybXNTaGFwZSxcbiAgb3JhY2xlczogTS5yZWNvcmRPZihNLnN0cmluZygpLCBNLnN0cmluZygpKSxcbiAgZmVlQ29uZmlnOiBGZWVDb25maWdTaGFwZSxcbiAgZmVlZFBvbGljeTogRmVlZFBvbGljeVNoYXBlLFxuICBjaGFpbkluZm86IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgQ29zbW9zQ2hhaW5JbmZvU2hhcGVWMSksXG4gIGFzc2V0SW5mbzogTS5hcnJheU9mKFtEZW5vbVNoYXBlLCBEZW5vbURldGFpbFNoYXBlXSlcbn0pO1xuXG4vL1xudmFyIHBhZGRpbmcgPSBcIj1cIjtcbnZhciBhbHBoYWJldDY0ID0gXCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OSsvXCI7XG52YXIgbW9ub2R1NjQgPSB7fTtcbmZvciAobGV0IGkyID0gMDsgaTIgPCBhbHBoYWJldDY0Lmxlbmd0aDsgaTIgKz0gMSkge1xuICBjb25zdCBjMiA9IGFscGhhYmV0NjRbaTJdO1xuICBtb25vZHU2NFtjMl0gPSBpMjtcbn1cblxuLy9cbnZhciBqc0VuY29kZUJhc2U2NCA9IChkYXRhKSA9PiB7XG4gIGxldCBzdHJpbmcgPSBcIlwiO1xuICBsZXQgcmVnaXN0ZXIgPSAwO1xuICBsZXQgcXVhbnR1bSA9IDA7XG4gIGZvciAobGV0IGkyID0gMDsgaTIgPCBkYXRhLmxlbmd0aDsgaTIgKz0gMSkge1xuICAgIGNvbnN0IGIzID0gZGF0YVtpMl07XG4gICAgcmVnaXN0ZXIgPSByZWdpc3RlciA8PCA4IHwgYjM7XG4gICAgcXVhbnR1bSArPSA4O1xuICAgIGlmIChxdWFudHVtID09PSAyNCkge1xuICAgICAgc3RyaW5nICs9IGFscGhhYmV0NjRbcmVnaXN0ZXIgPj4+IDE4ICYgNjNdICsgYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gMTIgJiA2M10gKyBhbHBoYWJldDY0W3JlZ2lzdGVyID4+PiA2ICYgNjNdICsgYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gMCAmIDYzXTtcbiAgICAgIHJlZ2lzdGVyID0gMDtcbiAgICAgIHF1YW50dW0gPSAwO1xuICAgIH1cbiAgfVxuICBzd2l0Y2ggKHF1YW50dW0pIHtcbiAgICBjYXNlIDA6XG4gICAgICBicmVhaztcbiAgICBjYXNlIDg6XG4gICAgICBzdHJpbmcgKz0gYWxwaGFiZXQ2NFtyZWdpc3RlciA+Pj4gMiAmIDYzXSArIGFscGhhYmV0NjRbcmVnaXN0ZXIgPDwgNCAmIDYzXSArIHBhZGRpbmcgKyBwYWRkaW5nO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAxNjpcbiAgICAgIHN0cmluZyArPSBhbHBoYWJldDY0W3JlZ2lzdGVyID4+PiAxMCAmIDYzXSArIGFscGhhYmV0NjRbcmVnaXN0ZXIgPj4+IDQgJiA2M10gKyBhbHBoYWJldDY0W3JlZ2lzdGVyIDw8IDIgJiA2M10gKyBwYWRkaW5nO1xuICAgICAgYnJlYWs7XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IEVycm9yKGBpbnRlcm5hbDogYmFkIHF1YW50dW0gJHtxdWFudHVtfWApO1xuICB9XG4gIHJldHVybiBzdHJpbmc7XG59O1xudmFyIGVuY29kZUJhc2U2NCA9IGdsb2JhbFRoaXMuQmFzZTY0ICE9PSB2b2lkIDAgPyBnbG9iYWxUaGlzLkJhc2U2NC5lbmNvZGUgOiBqc0VuY29kZUJhc2U2NDtcblxuLy9cbnZhciBqc0RlY29kZUJhc2U2NCA9IChzdHJpbmcsIG5hbWUgPSBcIjx1bmtub3duPlwiKSA9PiB7XG4gIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShNYXRoLmNlaWwoc3RyaW5nLmxlbmd0aCAqIDQgLyAzKSk7XG4gIGxldCByZWdpc3RlciA9IDA7XG4gIGxldCBxdWFudHVtID0gMDtcbiAgbGV0IGkyID0gMDtcbiAgbGV0IGogPSAwO1xuICB3aGlsZSAoaTIgPCBzdHJpbmcubGVuZ3RoICYmIHN0cmluZ1tpMl0gIT09IHBhZGRpbmcpIHtcbiAgICBjb25zdCBudW1iZXIgPSBtb25vZHU2NFtzdHJpbmdbaTJdXTtcbiAgICBpZiAobnVtYmVyID09PSB2b2lkIDApIHtcbiAgICAgIHRocm93IEVycm9yKGBJbnZhbGlkIGJhc2U2NCBjaGFyYWN0ZXIgJHtzdHJpbmdbaTJdfSBpbiBzdHJpbmcgJHtuYW1lfWApO1xuICAgIH1cbiAgICByZWdpc3RlciA9IHJlZ2lzdGVyIDw8IDYgfCBudW1iZXI7XG4gICAgcXVhbnR1bSArPSA2O1xuICAgIGlmIChxdWFudHVtID49IDgpIHtcbiAgICAgIHF1YW50dW0gLT0gODtcbiAgICAgIGRhdGFbal0gPSByZWdpc3RlciA+Pj4gcXVhbnR1bTtcbiAgICAgIGogKz0gMTtcbiAgICAgIHJlZ2lzdGVyICY9ICgxIDw8IHF1YW50dW0pIC0gMTtcbiAgICB9XG4gICAgaTIgKz0gMTtcbiAgfVxuICB3aGlsZSAocXVhbnR1bSA+IDApIHtcbiAgICBpZiAoaTIgPT09IHN0cmluZy5sZW5ndGggfHwgc3RyaW5nW2kyXSAhPT0gcGFkZGluZykge1xuICAgICAgdGhyb3cgRXJyb3IoYE1pc3NpbmcgcGFkZGluZyBhdCBvZmZzZXQgJHtpMn0gb2Ygc3RyaW5nICR7bmFtZX1gKTtcbiAgICB9XG4gICAgaTIgKz0gMTtcbiAgICBxdWFudHVtIC09IDI7XG4gIH1cbiAgaWYgKGkyIDwgc3RyaW5nLmxlbmd0aCkge1xuICAgIHRocm93IEVycm9yKFxuICAgICAgYEJhc2U2NCBzdHJpbmcgaGFzIHRyYWlsaW5nIGdhcmJhZ2UgJHtzdHJpbmcuc3Vic3RyKFxuICAgICAgICBpMlxuICAgICAgKX0gaW4gc3RyaW5nICR7bmFtZX1gXG4gICAgKTtcbiAgfVxuICByZXR1cm4gZGF0YS5zdWJhcnJheSgwLCBqKTtcbn07XG52YXIgYWRhcHREZWNvZGVyID0gKG5hdGl2ZURlY29kZUJhc2U2NCkgPT4gKC4uLmFyZ3MpID0+IHtcbiAgY29uc3QgZGVjb2RlZCA9IG5hdGl2ZURlY29kZUJhc2U2NCguLi5hcmdzKTtcbiAgaWYgKGRlY29kZWQgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7XG4gICAgcmV0dXJuIGRlY29kZWQ7XG4gIH1cbiAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGRlY29kZWQpO1xufTtcbnZhciBkZWNvZGVCYXNlNjQgPSBnbG9iYWxUaGlzLkJhc2U2NCAhPT0gdm9pZCAwID8gYWRhcHREZWNvZGVyKGdsb2JhbFRoaXMuQmFzZTY0LmRlY29kZSkgOiBqc0RlY29kZUJhc2U2NDtcblxuLy9cbnZhciBhdG9iID0gKGVuY29kZWREYXRhKSA9PiB7XG4gIGNvbnN0IGJ1ZiA9IGRlY29kZUJhc2U2NChlbmNvZGVkRGF0YSk7XG4gIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKC4uLmJ1Zik7XG59O1xuXG4vL1xudmFyIGNvZXJjZVRvQnl0ZUFycmF5ID0gKGNvbnRlbnRzKSA9PiB7XG4gIGlmICh0eXBlb2YgY29udGVudHMgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gVWludDhBcnJheS5mcm9tKGNvbnRlbnRzLCAoYzIpID0+IHtcbiAgICAgIGNvbnN0IGIzID0gYzIuY2hhckNvZGVBdCgwKTtcbiAgICAgIGIzIDw9IDI1NSB8fCB0aHJvd1JlZGFjdGVkYGNoYXJhY3RlciBjYW5ub3QgYmUgY29lcmNlZCB0byBhbiBvY3RldDogJHtjMn1gO1xuICAgICAgcmV0dXJuIGIzO1xuICAgIH0pO1xuICB9IGVsc2UgaWYgKGNvbnRlbnRzIGluc3RhbmNlb2YgVWludDhBcnJheSkge1xuICAgIHJldHVybiBuZXcgVWludDhBcnJheShcbiAgICAgIGNvbnRlbnRzLmJ1ZmZlcixcbiAgICAgIGNvbnRlbnRzLmJ5dGVPZmZzZXQsXG4gICAgICBjb250ZW50cy5ieXRlTGVuZ3RoXG4gICAgKTtcbiAgfVxuICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoY29udGVudHMpO1xufTtcbmZ1bmN0aW9uIHRvQnl0ZXMoYnl0ZVNvdXJjZSkge1xuICBjb25zdCBidWYgPSBjb2VyY2VUb0J5dGVBcnJheShieXRlU291cmNlKTtcbiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uYnVmKTtcbn1cbmZ1bmN0aW9uIGJhc2U2NFRvQnl0ZXMoc3RyaW5nKSB7XG4gIHJldHVybiB0b0J5dGVzKGRlY29kZUJhc2U2NChzdHJpbmcpKTtcbn1cblxuLy9cbnZhciBTaGFwZTEgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICAvKlxuXG5cbiAgICAgKi9cbiAgICBEYXRhOiBNLnN0cmluZygpLFxuICAgIEJ5dGVzOiBNLnN0cmluZygpLFxuICAgIEVuZHBvaW50OiBNLnN0cmluZygpLFxuICAgIFZvdzogTS50YWdnZWQoXG4gICAgICBcIlZvd1wiLFxuICAgICAgaGFyZGVuKHtcbiAgICAgICAgdm93VjA6IE0ucmVtb3RhYmxlKFwiVm93VjBcIilcbiAgICAgIH0pXG4gICAgKSxcbiAgICBDb25uZWN0aW9uSGFuZGxlcjogTS5yZW1vdGFibGUoXCJDb25uZWN0aW9uSGFuZGxlclwiKSxcbiAgICBDb25uZWN0aW9uOiBNLnJlbW90YWJsZShcIkNvbm5lY3Rpb25cIiksXG4gICAgSW5ib3VuZEF0dGVtcHQ6IE0ucmVtb3RhYmxlKFwiSW5ib3VuZEF0dGVtcHRcIiksXG4gICAgTGlzdGVuZXI6IE0ucmVtb3RhYmxlKFwiTGlzdGVuZXJcIiksXG4gICAgTGlzdGVuSGFuZGxlcjogTS5yZW1vdGFibGUoXCJMaXN0ZW5IYW5kbGVyXCIpLFxuICAgIFBvcnQ6IE0ucmVtb3RhYmxlKFwiUG9ydFwiKSxcbiAgICBQcm90b2NvbEhhbmRsZXI6IE0ucmVtb3RhYmxlKFwiUHJvdG9jb2xIYW5kbGVyXCIpLFxuICAgIFByb3RvY29sSW1wbDogTS5yZW1vdGFibGUoXCJQcm90b2NvbEltcGxcIilcbiAgfVxuKTtcbnZhciBTaGFwZTIgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICAuLi5TaGFwZTEsXG4gICAgVm93JDogKHNoYXBlKSA9PiBNLm9yKHNoYXBlLCBTaGFwZTEuVm93KSxcbiAgICBBdHRlbXB0RGVzY3JpcHRpb246IE0uc3BsaXRSZWNvcmQoXG4gICAgICB7IGhhbmRsZXI6IFNoYXBlMS5Db25uZWN0aW9uSGFuZGxlciB9LFxuICAgICAgeyByZW1vdGVBZGRyZXNzOiBTaGFwZTEuRW5kcG9pbnQsIGxvY2FsQWRkcmVzczogU2hhcGUxLkVuZHBvaW50IH1cbiAgICApLFxuICAgIE9wdHM6IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgTS5hbnkoKSlcbiAgfVxuKTtcbnZhciBTaGFwZSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgaGFyZGVuKHtcbiAgICAuLi5TaGFwZTIsXG4gICAgQ29ubmVjdGlvbkk6IHtcbiAgICAgIGNvbm5lY3Rpb246IE0uaW50ZXJmYWNlKFwiQ29ubmVjdGlvblwiLCB7XG4gICAgICAgIHNlbmQ6IE0uY2FsbFdoZW4oU2hhcGUyLkRhdGEpLm9wdGlvbmFsKFNoYXBlMi5PcHRzKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKFNoYXBlMi5CeXRlcykpLFxuICAgICAgICBjbG9zZTogTS5jYWxsV2hlbigpLnJldHVybnMoU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSkpLFxuICAgICAgICBnZXRMb2NhbEFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoU2hhcGUyLkVuZHBvaW50KSxcbiAgICAgICAgZ2V0UmVtb3RlQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhTaGFwZTIuRW5kcG9pbnQpXG4gICAgICB9KSxcbiAgICAgIG9wZW5Db25uZWN0aW9uQWNrV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJPcGVuQ29ubmVjdGlvbkFja1dhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICByZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyXCIsIHtcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBzaW5rV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJTaW5rV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKClcbiAgICAgIH0pXG4gICAgfSxcbiAgICBJbmJvdW5kQXR0ZW1wdEk6IHtcbiAgICAgIGluYm91bmRBdHRlbXB0OiBNLmludGVyZmFjZShcIkluYm91bmRBdHRlbXB0XCIsIHtcbiAgICAgICAgYWNjZXB0OiBNLmNhbGxXaGVuKFNoYXBlMi5BdHRlbXB0RGVzY3JpcHRpb24pLnJldHVybnMoXG4gICAgICAgICAgU2hhcGUyLlZvdyQoU2hhcGUyLkNvbm5lY3Rpb24pXG4gICAgICAgICksXG4gICAgICAgIGdldExvY2FsQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhTaGFwZTIuRW5kcG9pbnQpLFxuICAgICAgICBnZXRSZW1vdGVBZGRyZXNzOiBNLmNhbGwoKS5yZXR1cm5zKFNoYXBlMi5FbmRwb2ludCksXG4gICAgICAgIGNsb3NlOiBNLmNhbGxXaGVuKCkucmV0dXJucyhTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKSlcbiAgICAgIH0pLFxuICAgICAgaW5ib3VuZEF0dGVtcHRBY2NlcHRXYXRjaGVyOiBNLmludGVyZmFjZShcIkluYm91bmRBdHRlbXB0QWNjZXB0V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJSZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXJcIiwge1xuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHNpbmtXYXRjaGVyOiBNLmludGVyZmFjZShcIlNpbmtXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoKVxuICAgICAgfSlcbiAgICB9LFxuICAgIFBvcnRJOiB7XG4gICAgICBwb3J0OiBNLmludGVyZmFjZShcIlBvcnRcIiwge1xuICAgICAgICBnZXRMb2NhbEFkZHJlc3M6IE0uY2FsbCgpLnJldHVybnMoU2hhcGUyLkVuZHBvaW50KSxcbiAgICAgICAgYWRkTGlzdGVuZXI6IE0uY2FsbFdoZW4oU2hhcGUyLkxpc3RlbmVyKS5yZXR1cm5zKFxuICAgICAgICAgIFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpXG4gICAgICAgICksXG4gICAgICAgIGNvbm5lY3Q6IE0uY2FsbFdoZW4oU2hhcGUyLkVuZHBvaW50KS5vcHRpb25hbChTaGFwZTIuQ29ubmVjdGlvbkhhbmRsZXIpLnJldHVybnMoU2hhcGUyLlZvdyQoU2hhcGUyLkNvbm5lY3Rpb24pKSxcbiAgICAgICAgcmVtb3ZlTGlzdGVuZXI6IE0uY2FsbFdoZW4oU2hhcGUyLkxpc3RlbmVyKS5yZXR1cm5zKFxuICAgICAgICAgIFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpXG4gICAgICAgICksXG4gICAgICAgIHJldm9rZTogTS5jYWxsV2hlbigpLnJldHVybnMoU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSkpXG4gICAgICB9KSxcbiAgICAgIHBvcnRBZGRMaXN0ZW5lcldhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUG9ydEFkZExpc3RlbmVyV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHBvcnRSZW1vdmVMaXN0ZW5lcldhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUG9ydFJlbW92ZUxpc3RlbmVyV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHBvcnRDb25uZWN0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQb3J0Q29ubmVjdFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBwb3J0UmV2b2tlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQb3J0UmV2b2tlV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHBvcnRSZXZva2VDbGVhbnVwV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQb3J0UmV2b2tlQ2xlYW51cFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICByZXRocm93VW5sZXNzTWlzc2luZ1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyXCIsIHtcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgfSksXG4gICAgICBzaW5rV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJTaW5rV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKCksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pXG4gICAgfSxcbiAgICBQcm90b2NvbEhhbmRsZXJJOiB7XG4gICAgICBwcm90b2NvbEhhbmRsZXI6IE0uaW50ZXJmYWNlKFwiUHJvdG9jb2xIYW5kbGVyXCIsIHtcbiAgICAgICAgb25DcmVhdGU6IE0uY2FsbFdoZW4oTS5yZW1vdGFibGUoKSwgU2hhcGUyLlByb3RvY29sSGFuZGxlcikucmV0dXJucyhcbiAgICAgICAgICBTaGFwZTIuVm93JChNLnVuZGVmaW5lZCgpKVxuICAgICAgICApLFxuICAgICAgICBnZW5lcmF0ZVBvcnRJRDogTS5jYWxsV2hlbihcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLlByb3RvY29sSGFuZGxlclxuICAgICAgICApLnJldHVybnMoU2hhcGUyLlZvdyQoTS5zdHJpbmcoKSkpLFxuICAgICAgICBvbkJpbmQ6IE0uY2FsbFdoZW4oXG4gICAgICAgICAgU2hhcGUyLlBvcnQsXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5Qcm90b2NvbEhhbmRsZXJcbiAgICAgICAgKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpKSxcbiAgICAgICAgb25MaXN0ZW46IE0uY2FsbFdoZW4oXG4gICAgICAgICAgU2hhcGUyLlBvcnQsXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5MaXN0ZW5IYW5kbGVyLFxuICAgICAgICAgIFNoYXBlMi5Qcm90b2NvbEhhbmRsZXJcbiAgICAgICAgKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpKSxcbiAgICAgICAgb25MaXN0ZW5SZW1vdmU6IE0uY2FsbFdoZW4oXG4gICAgICAgICAgU2hhcGUyLlBvcnQsXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5MaXN0ZW5IYW5kbGVyLFxuICAgICAgICAgIFNoYXBlMi5Qcm90b2NvbEhhbmRsZXJcbiAgICAgICAgKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKE0udW5kZWZpbmVkKCkpKSxcbiAgICAgICAgb25JbnN0YW50aWF0ZTogTS5jYWxsV2hlbihcbiAgICAgICAgICBTaGFwZTIuUG9ydCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5Qcm90b2NvbEhhbmRsZXJcbiAgICAgICAgKS5yZXR1cm5zKFNoYXBlMi5Wb3ckKFNoYXBlMi5FbmRwb2ludCkpLFxuICAgICAgICBvbkNvbm5lY3Q6IE0uY2FsbFdoZW4oXG4gICAgICAgICAgU2hhcGUyLlBvcnQsXG4gICAgICAgICAgU2hhcGUyLkVuZHBvaW50LFxuICAgICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgICBTaGFwZTIuQ29ubmVjdGlvbkhhbmRsZXIsXG4gICAgICAgICAgU2hhcGUyLlByb3RvY29sSGFuZGxlclxuICAgICAgICApLnJldHVybnMoU2hhcGUyLlZvdyQoU2hhcGUyLkF0dGVtcHREZXNjcmlwdGlvbikpLFxuICAgICAgICBvblJldm9rZTogTS5jYWxsV2hlbihcbiAgICAgICAgICBTaGFwZTIuUG9ydCxcbiAgICAgICAgICBTaGFwZTIuRW5kcG9pbnQsXG4gICAgICAgICAgU2hhcGUyLlByb3RvY29sSGFuZGxlclxuICAgICAgICApLnJldHVybnMoU2hhcGUyLlZvdyQoTS51bmRlZmluZWQoKSkpXG4gICAgICB9KSxcbiAgICAgIHByb3RvY29sSGFuZGxlckFjY2VwdFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUHJvdG9jb2xIYW5kbGVyQWNjZXB0V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmVzdChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHByb3RvY29sSGFuZGxlckluc3RhbnRpYXRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICAgIFwiUHJvdG9jb2xIYW5kbGVySW5zdGFudGlhdGVXYXRjaGVyXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgcHJvdG9jb2xIYW5kbGVyQ29ubmVjdFdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgICBcIlByb3RvY29sSGFuZGxlckNvbm5lY3RXYXRjaGVyXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJlc3QoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgcmV0aHJvd1VubGVzc01pc3NpbmdXYXRjaGVyOiBNLmludGVyZmFjZShcIlJldGhyb3dVbmxlc3NNaXNzaW5nV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpKS5yZXN0KE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pXG4gICAgfSxcbiAgICBQcm90b2NvbEltcGxJOiBNLmludGVyZmFjZShcIlByb3RvY29sSW1wbFwiLCB7XG4gICAgICBiaW5kUG9ydDogTS5jYWxsV2hlbihTaGFwZTIuRW5kcG9pbnQpLnJldHVybnMoU2hhcGUyLlZvdyQoU2hhcGUyLlBvcnQpKSxcbiAgICAgIGluYm91bmQ6IE0uY2FsbFdoZW4oU2hhcGUyLkVuZHBvaW50LCBTaGFwZTIuRW5kcG9pbnQpLnJldHVybnMoXG4gICAgICAgIFNoYXBlMi5Wb3ckKFNoYXBlMi5JbmJvdW5kQXR0ZW1wdClcbiAgICAgICksXG4gICAgICBvdXRib3VuZDogTS5jYWxsV2hlbihcbiAgICAgICAgU2hhcGUyLlBvcnQsXG4gICAgICAgIFNoYXBlMi5FbmRwb2ludCxcbiAgICAgICAgU2hhcGUyLkNvbm5lY3Rpb25IYW5kbGVyXG4gICAgICApLnJldHVybnMoU2hhcGUyLlZvdyQoU2hhcGUyLkNvbm5lY3Rpb24pKVxuICAgIH0pXG4gIH0pXG4pO1xuXG4vL1xudmFyIHNpbms0ID0gKCkgPT4ge1xufTtcbmhhcmRlbihzaW5rNCk7XG52YXIgQ0xPU0VfUkVBU09OX0ZJTkFMSVpFUiA9IFwiY2xvc2VkLWJ5LWZpbmFsaXplclwiO1xudmFyIFJldm9rZVN0YXRlID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgTk9UX1JFVk9LRUQ6IDAsXG4gICAgUkVWT0tJTkc6IDEsXG4gICAgUkVWT0tFRDogMlxuICB9XG4pO1xuaGFyZGVuKFJldm9rZVN0YXRlKTtcbnZhciBwcmVwYXJlRmluYWxpemVyID0gKHpvbmUsIHsgd2F0Y2ggfSkgPT4ge1xuICBjb25zdCBvYmpUb0ZpbmFsaXplckluZm8gPSB6b25lLm1hcFN0b3JlKFwib2JqVG9GaW5hbGl6ZXJJbmZvXCIpO1xuICByZXR1cm4gem9uZS5leG8oXCJOZXR3b3JrRmluYWxpemVyXCIsIHZvaWQgMCwge1xuICAgIGhhcyhvYmopIHtcbiAgICAgIHJldHVybiBvYmpUb0ZpbmFsaXplckluZm8uaGFzKG9iaik7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgaW5pdENvbm5lY3Rpb24oY29ubiwgaGFuZGxlcikge1xuICAgICAgb2JqVG9GaW5hbGl6ZXJJbmZvLmluaXQoY29ubiwgaGFyZGVuKHsgY29ubiwgaGFuZGxlciB9KSk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuICAgICAqL1xuICAgIGluaXRDbG9zZXIoY2xvc2VyKSB7XG4gICAgICBvYmpUb0ZpbmFsaXplckluZm8uaW5pdChjbG9zZXIsIGhhcmRlbih7IGNsb3NlciB9KSk7XG4gICAgfSxcbiAgICBmaW5hbGl6ZShvYmopIHtcbiAgICAgIGlmICghb2JqVG9GaW5hbGl6ZXJJbmZvLmhhcyhvYmopKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRpc3Bvc2VJbmZvID0gb2JqVG9GaW5hbGl6ZXJJbmZvLmdldChvYmopO1xuICAgICAgaWYgKFwiY29ublwiIGluIGRpc3Bvc2VJbmZvKSB7XG4gICAgICAgIGNvbnN0IHsgY29ubiwgaGFuZGxlciB9ID0gZGlzcG9zZUluZm87XG4gICAgICAgIG9ialRvRmluYWxpemVySW5mby5kZWxldGUob2JqKTtcbiAgICAgICAgcmV0dXJuIHdhdGNoKEUoaGFuZGxlcikub25DbG9zZShjb25uLCBDTE9TRV9SRUFTT05fRklOQUxJWkVSLCBoYW5kbGVyKSk7XG4gICAgICB9IGVsc2UgaWYgKFwiY2xvc2VyXCIgaW4gZGlzcG9zZUluZm8pIHtcbiAgICAgICAgY29uc3QgeyBjbG9zZXIgfSA9IGRpc3Bvc2VJbmZvO1xuICAgICAgICBvYmpUb0ZpbmFsaXplckluZm8uZGVsZXRlKG9iaik7XG4gICAgICAgIHJldHVybiB3YXRjaChFKGNsb3NlcikuY2xvc2UoKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICB1bnBpbihvYmopIHtcbiAgICAgIG9ialRvRmluYWxpemVySW5mby5kZWxldGUob2JqKTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihwcmVwYXJlRmluYWxpemVyKTtcblxuLy9cbnZhciBSb3V0ZXJJID0gTS5pbnRlcmZhY2UoXCJSb3V0ZXJcIiwge1xuICBnZXRSb3V0ZXM6IE0uY2FsbChTaGFwZS5FbmRwb2ludCkucmV0dXJucyhNLmFycmF5T2YoW00uc3RyaW5nKCksIE0uYW55KCldKSksXG4gIHJlZ2lzdGVyOiBNLmNhbGwoTS5zdHJpbmcoKSwgTS5hbnkoKSkucmV0dXJucyhNLnVuZGVmaW5lZCgpKSxcbiAgdW5yZWdpc3RlcjogTS5jYWxsKE0uc3RyaW5nKCksIE0uYW55KCkpLnJldHVybnMoTS51bmRlZmluZWQoKSlcbn0pO1xuXG4vL1xudmFyIGltcG9ydF9lbmNvZGluZyA9IF9fdG9FU00ocmVxdWlyZV9idWlsZCgpLCAxKTtcblxuLy9cbmZ1bmN0aW9uIGJhc2UoQUxQSEFCRVQyKSB7XG4gIGlmIChBTFBIQUJFVDIubGVuZ3RoID49IDI1NSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBbHBoYWJldCB0b28gbG9uZ1wiKTtcbiAgfVxuICBjb25zdCBCQVNFX01BUCA9IG5ldyBVaW50OEFycmF5KDI1Nik7XG4gIGZvciAobGV0IGogPSAwOyBqIDwgQkFTRV9NQVAubGVuZ3RoOyBqKyspIHtcbiAgICBCQVNFX01BUFtqXSA9IDI1NTtcbiAgfVxuICBmb3IgKGxldCBpMiA9IDA7IGkyIDwgQUxQSEFCRVQyLmxlbmd0aDsgaTIrKykge1xuICAgIGNvbnN0IHggPSBBTFBIQUJFVDIuY2hhckF0KGkyKTtcbiAgICBjb25zdCB4YyA9IHguY2hhckNvZGVBdCgwKTtcbiAgICBpZiAoQkFTRV9NQVBbeGNdICE9PSAyNTUpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoeCArIFwiIGlzIGFtYmlndW91c1wiKTtcbiAgICB9XG4gICAgQkFTRV9NQVBbeGNdID0gaTI7XG4gIH1cbiAgY29uc3QgQkFTRSA9IEFMUEhBQkVUMi5sZW5ndGg7XG4gIGNvbnN0IExFQURFUiA9IEFMUEhBQkVUMi5jaGFyQXQoMCk7XG4gIGNvbnN0IEZBQ1RPUiA9IE1hdGgubG9nKEJBU0UpIC8gTWF0aC5sb2coMjU2KTtcbiAgY29uc3QgaUZBQ1RPUiA9IE1hdGgubG9nKDI1NikgLyBNYXRoLmxvZyhCQVNFKTtcbiAgZnVuY3Rpb24gZW5jb2RlMihzb3VyY2UpIHtcbiAgICBpZiAoc291cmNlIGluc3RhbmNlb2YgVWludDhBcnJheSkge1xuICAgIH0gZWxzZSBpZiAoQXJyYXlCdWZmZXIuaXNWaWV3KHNvdXJjZSkpIHtcbiAgICAgIHNvdXJjZSA9IG5ldyBVaW50OEFycmF5KHNvdXJjZS5idWZmZXIsIHNvdXJjZS5ieXRlT2Zmc2V0LCBzb3VyY2UuYnl0ZUxlbmd0aCk7XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHNvdXJjZSkpIHtcbiAgICAgIHNvdXJjZSA9IFVpbnQ4QXJyYXkuZnJvbShzb3VyY2UpO1xuICAgIH1cbiAgICBpZiAoIShzb3VyY2UgaW5zdGFuY2VvZiBVaW50OEFycmF5KSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkV4cGVjdGVkIFVpbnQ4QXJyYXlcIik7XG4gICAgfVxuICAgIGlmIChzb3VyY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gICAgbGV0IHplcm9lczIgPSAwO1xuICAgIGxldCBsZW5ndGggPSAwO1xuICAgIGxldCBwYmVnaW4gPSAwO1xuICAgIGNvbnN0IHBlbmQgPSBzb3VyY2UubGVuZ3RoO1xuICAgIHdoaWxlIChwYmVnaW4gIT09IHBlbmQgJiYgc291cmNlW3BiZWdpbl0gPT09IDApIHtcbiAgICAgIHBiZWdpbisrO1xuICAgICAgemVyb2VzMisrO1xuICAgIH1cbiAgICBjb25zdCBzaXplID0gKHBlbmQgLSBwYmVnaW4pICogaUZBQ1RPUiArIDEgPj4+IDA7XG4gICAgY29uc3QgYjU4ID0gbmV3IFVpbnQ4QXJyYXkoc2l6ZSk7XG4gICAgd2hpbGUgKHBiZWdpbiAhPT0gcGVuZCkge1xuICAgICAgbGV0IGNhcnJ5ID0gc291cmNlW3BiZWdpbl07XG4gICAgICBsZXQgaTIgPSAwO1xuICAgICAgZm9yIChsZXQgaXQxID0gc2l6ZSAtIDE7IChjYXJyeSAhPT0gMCB8fCBpMiA8IGxlbmd0aCkgJiYgaXQxICE9PSAtMTsgaXQxLS0sIGkyKyspIHtcbiAgICAgICAgY2FycnkgKz0gMjU2ICogYjU4W2l0MV0gPj4+IDA7XG4gICAgICAgIGI1OFtpdDFdID0gY2FycnkgJSBCQVNFID4+PiAwO1xuICAgICAgICBjYXJyeSA9IGNhcnJ5IC8gQkFTRSA+Pj4gMDtcbiAgICAgIH1cbiAgICAgIGlmIChjYXJyeSAhPT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb24temVybyBjYXJyeVwiKTtcbiAgICAgIH1cbiAgICAgIGxlbmd0aCA9IGkyO1xuICAgICAgcGJlZ2luKys7XG4gICAgfVxuICAgIGxldCBpdDIgPSBzaXplIC0gbGVuZ3RoO1xuICAgIHdoaWxlIChpdDIgIT09IHNpemUgJiYgYjU4W2l0Ml0gPT09IDApIHtcbiAgICAgIGl0MisrO1xuICAgIH1cbiAgICBsZXQgc3RyID0gTEVBREVSLnJlcGVhdCh6ZXJvZXMyKTtcbiAgICBmb3IgKDsgaXQyIDwgc2l6ZTsgKytpdDIpIHtcbiAgICAgIHN0ciArPSBBTFBIQUJFVDIuY2hhckF0KGI1OFtpdDJdKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0cjtcbiAgfVxuICBmdW5jdGlvbiBkZWNvZGVVbnNhZmUoc291cmNlKSB7XG4gICAgaWYgKHR5cGVvZiBzb3VyY2UgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJFeHBlY3RlZCBTdHJpbmdcIik7XG4gICAgfVxuICAgIGlmIChzb3VyY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoKTtcbiAgICB9XG4gICAgbGV0IHBzeiA9IDA7XG4gICAgbGV0IHplcm9lczIgPSAwO1xuICAgIGxldCBsZW5ndGggPSAwO1xuICAgIHdoaWxlIChzb3VyY2VbcHN6XSA9PT0gTEVBREVSKSB7XG4gICAgICB6ZXJvZXMyKys7XG4gICAgICBwc3orKztcbiAgICB9XG4gICAgY29uc3Qgc2l6ZSA9IChzb3VyY2UubGVuZ3RoIC0gcHN6KSAqIEZBQ1RPUiArIDEgPj4+IDA7XG4gICAgY29uc3QgYjI1NiA9IG5ldyBVaW50OEFycmF5KHNpemUpO1xuICAgIHdoaWxlIChwc3ogPCBzb3VyY2UubGVuZ3RoKSB7XG4gICAgICBjb25zdCBjaGFyQ29kZSA9IHNvdXJjZS5jaGFyQ29kZUF0KHBzeik7XG4gICAgICBpZiAoY2hhckNvZGUgPiAyNTUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbGV0IGNhcnJ5ID0gQkFTRV9NQVBbY2hhckNvZGVdO1xuICAgICAgaWYgKGNhcnJ5ID09PSAyNTUpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbGV0IGkyID0gMDtcbiAgICAgIGZvciAobGV0IGl0MyA9IHNpemUgLSAxOyAoY2FycnkgIT09IDAgfHwgaTIgPCBsZW5ndGgpICYmIGl0MyAhPT0gLTE7IGl0My0tLCBpMisrKSB7XG4gICAgICAgIGNhcnJ5ICs9IEJBU0UgKiBiMjU2W2l0M10gPj4+IDA7XG4gICAgICAgIGIyNTZbaXQzXSA9IGNhcnJ5ICUgMjU2ID4+PiAwO1xuICAgICAgICBjYXJyeSA9IGNhcnJ5IC8gMjU2ID4+PiAwO1xuICAgICAgfVxuICAgICAgaWYgKGNhcnJ5ICE9PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vbi16ZXJvIGNhcnJ5XCIpO1xuICAgICAgfVxuICAgICAgbGVuZ3RoID0gaTI7XG4gICAgICBwc3orKztcbiAgICB9XG4gICAgbGV0IGl0NCA9IHNpemUgLSBsZW5ndGg7XG4gICAgd2hpbGUgKGl0NCAhPT0gc2l6ZSAmJiBiMjU2W2l0NF0gPT09IDApIHtcbiAgICAgIGl0NCsrO1xuICAgIH1cbiAgICBjb25zdCB2Y2ggPSBuZXcgVWludDhBcnJheSh6ZXJvZXMyICsgKHNpemUgLSBpdDQpKTtcbiAgICBsZXQgaiA9IHplcm9lczI7XG4gICAgd2hpbGUgKGl0NCAhPT0gc2l6ZSkge1xuICAgICAgdmNoW2orK10gPSBiMjU2W2l0NCsrXTtcbiAgICB9XG4gICAgcmV0dXJuIHZjaDtcbiAgfVxuICBmdW5jdGlvbiBkZWNvZGUzKHN0cmluZykge1xuICAgIGNvbnN0IGJ1ZmZlciA9IGRlY29kZVVuc2FmZShzdHJpbmcpO1xuICAgIGlmIChidWZmZXIpIHtcbiAgICAgIHJldHVybiBidWZmZXI7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihcIk5vbi1iYXNlXCIgKyBCQVNFICsgXCIgY2hhcmFjdGVyXCIpO1xuICB9XG4gIHJldHVybiB7XG4gICAgZW5jb2RlOiBlbmNvZGUyLFxuICAgIGRlY29kZVVuc2FmZSxcbiAgICBkZWNvZGU6IGRlY29kZTNcbiAgfTtcbn1cbnZhciBlc21fZGVmYXVsdCA9IGJhc2U7XG5cbi8vXG52YXIgQUxQSEFCRVQgPSBcIjEyMzQ1Njc4OUFCQ0RFRkdISktMTU5QUVJTVFVWV1hZWmFiY2RlZmdoaWprbW5vcHFyc3R1dnd4eXpcIjtcbnZhciBlc21fZGVmYXVsdDIgPSBlc21fZGVmYXVsdChBTFBIQUJFVCk7XG5cbi8vXG52YXIgbWFrZUlDQUNoYW5uZWxBZGRyZXNzID0gKGhvc3RDb25uZWN0aW9uSWQsIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsIHtcbiAgdmVyc2lvbiA9IFwiaWNzMjctMVwiLFxuICBlbmNvZGluZyA9IFwicHJvdG8zXCIsXG4gIG9yZGVyaW5nID0gXCJvcmRlcmVkXCIsXG4gIHR4VHlwZSA9IFwic2RrX211bHRpX21zZ1wiXG59ID0ge30pID0+IHtcbiAgaG9zdENvbm5lY3Rpb25JZCB8fCB0aHJvd1JlZGFjdGVkYGhvc3RDb25uZWN0aW9uSWQgaXMgcmVxdWlyZWRgO1xuICBjb250cm9sbGVyQ29ubmVjdGlvbklkIHx8IHRocm93UmVkYWN0ZWRgY29udHJvbGxlckNvbm5lY3Rpb25JZCBpcyByZXF1aXJlZGA7XG4gIGNvbnN0IGNvbm5TdHJpbmcgPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgdmVyc2lvbixcbiAgICBjb250cm9sbGVyQ29ubmVjdGlvbklkLFxuICAgIGhvc3RDb25uZWN0aW9uSWQsXG4gICAgYWRkcmVzczogXCJcIixcbiAgICAvL1xuICAgIGVuY29kaW5nLFxuICAgIHR4VHlwZVxuICB9KTtcbiAgcmV0dXJuIGAvaWJjLWhvcC8ke2NvbnRyb2xsZXJDb25uZWN0aW9uSWR9L2liYy1wb3J0L2ljYWhvc3QvJHtvcmRlcmluZ30vJHtjb25uU3RyaW5nfWA7XG59O1xuaGFyZGVuKG1ha2VJQ0FDaGFubmVsQWRkcmVzcyk7XG52YXIgREVGQVVMVF9JQ1FfVkVSU0lPTiA9IFwiaWNxLTFcIjtcbnZhciBtYWtlSUNRQ2hhbm5lbEFkZHJlc3MgPSAoY29udHJvbGxlckNvbm5lY3Rpb25JZCwgdmVyc2lvbiA9IERFRkFVTFRfSUNRX1ZFUlNJT04pID0+IHtcbiAgY29udHJvbGxlckNvbm5lY3Rpb25JZCB8fCB0aHJvd1JlZGFjdGVkYGNvbnRyb2xsZXJDb25uZWN0aW9uSWQgaXMgcmVxdWlyZWRgO1xuICByZXR1cm4gYC9pYmMtaG9wLyR7Y29udHJvbGxlckNvbm5lY3Rpb25JZH0vaWJjLXBvcnQvaWNxaG9zdC91bm9yZGVyZWQvJHt2ZXJzaW9ufWA7XG59O1xuaGFyZGVuKG1ha2VJQ1FDaGFubmVsQWRkcmVzcyk7XG52YXIgZmluZEFkZHJlc3NGaWVsZCA9IChyZW1vdGVBZGRyZXNzU3RyaW5nKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QganNvblN0ciA9IHJlbW90ZUFkZHJlc3NTdHJpbmc/Lm1hdGNoKC97Lio/fS8pPy5bMF07XG4gICAgY29uc3QganNvbk9iaiA9IGpzb25TdHIgPyBKU09OLnBhcnNlKGpzb25TdHIpIDogdm9pZCAwO1xuICAgIGlmICghanNvbk9iaj8uYWRkcmVzcz8ubGVuZ3RoKSByZXR1cm4gdm9pZCAwO1xuICAgIHJldHVybiBqc29uT2JqLmFkZHJlc3M7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHZvaWQgMDtcbiAgfVxufTtcbmhhcmRlbihmaW5kQWRkcmVzc0ZpZWxkKTtcbnZhciBnZXRCZWNoMzJQcmVmaXggPSAoYWRkcmVzcykgPT4ge1xuICBhc3NlcnQoYWRkcmVzcywgXCJhZGRyZXNzIGlzIHJlcXVpcmVkXCIpO1xuICBjb25zdCBzcGxpdCA9IGFkZHJlc3MubGFzdEluZGV4T2YoXCIxXCIpO1xuICBpZiAoc3BsaXQgPT09IC0xKSByZXR1cm4gdGhyb3dSZWRhY3RlZGBObyBzZXBhcmF0b3IgY2hhcmFjdGVyIGZvciAke3F1b3RlKGFkZHJlc3MpfWA7XG4gIGlmIChzcGxpdCA9PT0gMCkgcmV0dXJuIHRocm93UmVkYWN0ZWRgTWlzc2luZyBwcmVmaXggZm9yICR7cXVvdGUoYWRkcmVzcyl9YDtcbiAgcmV0dXJuIGFkZHJlc3Muc2xpY2UoMCwgc3BsaXQpO1xufTtcbnZhciBwYXJzZUFjY291bnRJZEFyZyA9IChpZEFyZykgPT4ge1xuICBpZiAodHlwZW9mIGlkQXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHBhcnNlQWNjb3VudElkKGlkQXJnKTtcbiAgfVxuICByZXR1cm4ge1xuICAgIG5hbWVzcGFjZTogXCJjb3Ntb3NcIixcbiAgICByZWZlcmVuY2U6IGlkQXJnLmNoYWluSWQsXG4gICAgYWNjb3VudEFkZHJlc3M6IGlkQXJnLnZhbHVlXG4gIH07XG59O1xuaGFyZGVuKHBhcnNlQWNjb3VudElkQXJnKTtcbnZhciBwYXJzZUFjY291bnRJZCA9IChhY2NvdW50SWQpID0+IHtcbiAgY29uc3QgcGFydHMgPSBhY2NvdW50SWQuc3BsaXQoXCI6XCIpO1xuICBwYXJ0cy5sZW5ndGggPT09IDMgfHwgdGhyb3dSZWRhY3RlZGBtYWxmb3JtZWQgQ0FJUC0xMCBhY2NvdW50SWQ6ICR7cXVvdGUoYWNjb3VudElkKX1gO1xuICBjb25zdCBbbmFtZXNwYWNlLCByZWZlcmVuY2UsIGFjY291bnRBZGRyZXNzXSA9IHBhcnRzO1xuICByZXR1cm4ge1xuICAgIG5hbWVzcGFjZSxcbiAgICByZWZlcmVuY2UsXG4gICAgYWNjb3VudEFkZHJlc3NcbiAgfTtcbn07XG5oYXJkZW4ocGFyc2VBY2NvdW50SWQpO1xudmFyIGNoYWluT2ZBY2NvdW50ID0gKGFjY291bnRJZEFyZykgPT4ge1xuICBjb25zdCB7IG5hbWVzcGFjZSwgcmVmZXJlbmNlIH0gPSBwYXJzZUFjY291bnRJZEFyZyhhY2NvdW50SWRBcmcpO1xuICByZXR1cm4gYCR7bmFtZXNwYWNlfToke3JlZmVyZW5jZX1gO1xufTtcbnZhciBsZWZ0UGFkRXRoQWRkcmVzc1RvMzJCeXRlcyA9IChyYXdBZGRyZXNzKSA9PiB7XG4gIGNvbnN0IGNsZWFuZWRBZGRyZXNzID0gcmF3QWRkcmVzcy5yZXBsYWNlKC9eMHgvLCBcIlwiKTtcbiAgY29uc3QgemVyb2VzTmVlZGVkID0gNjQgLSBjbGVhbmVkQWRkcmVzcy5sZW5ndGg7XG4gIGNvbnN0IHBhZGRlZEFkZHJlc3MgPSBcIjBcIi5yZXBlYXQoemVyb2VzTmVlZGVkKSArIGNsZWFuZWRBZGRyZXNzO1xuICByZXR1cm4gKDAsIGltcG9ydF9lbmNvZGluZy5mcm9tSGV4KShwYWRkZWRBZGRyZXNzKTtcbn07XG52YXIgc29sYW5hQWRkcmVzc1RvQ2N0cFJlY2lwaWVudCA9IChzb2xhbmFBZGRyZXNzKSA9PiBlc21fZGVmYXVsdDIuZGVjb2RlKHNvbGFuYUFkZHJlc3MpO1xudmFyIGFjY291bnRJZFRvMzJCeXRlcyA9IChhY2NvdW50SWQpID0+IHtcbiAgY29uc3QgeyBuYW1lc3BhY2UsIGFjY291bnRBZGRyZXNzIH0gPSBwYXJzZUFjY291bnRJZChhY2NvdW50SWQpO1xuICBzd2l0Y2ggKG5hbWVzcGFjZSkge1xuICAgIGNhc2UgXCJlaXAxNTVcIjpcbiAgICAgIHJldHVybiBsZWZ0UGFkRXRoQWRkcmVzc1RvMzJCeXRlcyhhY2NvdW50QWRkcmVzcyk7XG4gICAgY2FzZSBcInNvbGFuYVwiOlxuICAgICAgcmV0dXJuIHNvbGFuYUFkZHJlc3NUb0NjdHBSZWNpcGllbnQoYWNjb3VudEFkZHJlc3MpO1xuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYG5hbWVzcGFjZSAke25hbWVzcGFjZX0gbm90IHN1cHBvcnRlZGApO1xuICB9XG59O1xuXG4vL1xuZnVuY3Rpb24gdXRmOExlbmd0aCh0NSkge1xuICBsZXQgcjUgPSAwLCBlMiA9IDA7XG4gIGZvciAobGV0IG8yID0gMDsgbzIgPCB0NS5sZW5ndGg7ICsrbzIpIGUyID0gdDUuY2hhckNvZGVBdChvMiksIGUyIDwgMTI4ID8gcjUgKz0gMSA6IGUyIDwgMjA0OCA/IHI1ICs9IDIgOiA1NTI5NiA9PSAoNjQ1MTIgJiBlMikgJiYgNTYzMjAgPT0gKDY0NTEyICYgdDUuY2hhckNvZGVBdChvMiArIDEpKSA/ICgrK28yLCByNSArPSA0KSA6IHI1ICs9IDM7XG4gIHJldHVybiByNTtcbn1cbmZ1bmN0aW9uIHV0ZjhSZWFkKHQ1LCByNSwgZTIpIHtcbiAgaWYgKGUyIC0gcjUgPCAxKSByZXR1cm4gXCJcIjtcbiAgY29uc3QgbzIgPSBbXTtcbiAgbGV0IG4yLCBmMiA9IFtdLCBoID0gMDtcbiAgZm9yICg7IHI1IDwgZTI7ICkgbjIgPSB0NVtyNSsrXSwgbjIgPCAxMjggPyBvMltoKytdID0gbjIgOiBuMiA+IDE5MSAmJiBuMiA8IDIyNCA/IG8yW2grK10gPSAoMzEgJiBuMikgPDwgNiB8IDYzICYgdDVbcjUrK10gOiBuMiA+IDIzOSAmJiBuMiA8IDM2NSA/IChuMiA9ICgoNyAmIG4yKSA8PCAxOCB8ICg2MyAmIHQ1W3I1KytdKSA8PCAxMiB8ICg2MyAmIHQ1W3I1KytdKSA8PCA2IHwgNjMgJiB0NVtyNSsrXSkgLSA2NTUzNiwgbzJbaCsrXSA9IDU1Mjk2ICsgKG4yID4+IDEwKSwgbzJbaCsrXSA9IDU2MzIwICsgKDEwMjMgJiBuMikpIDogbzJbaCsrXSA9ICgxNSAmIG4yKSA8PCAxMiB8ICg2MyAmIHQ1W3I1KytdKSA8PCA2IHwgNjMgJiB0NVtyNSsrXSwgaCA+IDgxOTEgJiYgKChmMiB8fCAoZjIgPSBbXSkpLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSguLi5vMikpLCBoID0gMCk7XG4gIHJldHVybiBmMiA/IChoICYmIGYyLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZSguLi5vMi5zbGljZSgwLCBoKSkpLCBmMi5qb2luKFwiXCIpKSA6IFN0cmluZy5mcm9tQ2hhckNvZGUoLi4ubzIuc2xpY2UoMCwgaCkpO1xufVxuZnVuY3Rpb24gdXRmOFdyaXRlKHQ1LCByNSwgZTIpIHtcbiAgY29uc3QgbzIgPSBlMjtcbiAgbGV0IG4yLCBmMjtcbiAgZm9yIChsZXQgbzMgPSAwOyBvMyA8IHQ1Lmxlbmd0aDsgKytvMykgbjIgPSB0NS5jaGFyQ29kZUF0KG8zKSwgbjIgPCAxMjggPyByNVtlMisrXSA9IG4yIDogbjIgPCAyMDQ4ID8gKHI1W2UyKytdID0gbjIgPj4gNiB8IDE5MiwgcjVbZTIrK10gPSA2MyAmIG4yIHwgMTI4KSA6IDU1Mjk2ID09ICg2NDUxMiAmIG4yKSAmJiA1NjMyMCA9PSAoNjQ1MTIgJiAoZjIgPSB0NS5jaGFyQ29kZUF0KG8zICsgMSkpKSA/IChuMiA9IDY1NTM2ICsgKCgxMDIzICYgbjIpIDw8IDEwKSArICgxMDIzICYgZjIpLCArK28zLCByNVtlMisrXSA9IG4yID4+IDE4IHwgMjQwLCByNVtlMisrXSA9IG4yID4+IDEyICYgNjMgfCAxMjgsIHI1W2UyKytdID0gbjIgPj4gNiAmIDYzIHwgMTI4LCByNVtlMisrXSA9IDYzICYgbjIgfCAxMjgpIDogKHI1W2UyKytdID0gbjIgPj4gMTIgfCAyMjQsIHI1W2UyKytdID0gbjIgPj4gNiAmIDYzIHwgMTI4LCByNVtlMisrXSA9IDYzICYgbjIgfCAxMjgpO1xuICByZXR1cm4gZTIgLSBvMjtcbn1cblxuLy9cbmZ1bmN0aW9uIHZhcmludDY0cmVhZCgpIHtcbiAgbGV0IHQ1ID0gMCwgcjUgPSAwO1xuICBmb3IgKGxldCBuMyA9IDA7IG4zIDwgMjg7IG4zICs9IDcpIHtcbiAgICBsZXQgbzIgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgICBpZiAodDUgfD0gKDEyNyAmIG8yKSA8PCBuMywgISgxMjggJiBvMikpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCBbdDUsIHI1XTtcbiAgfVxuICBsZXQgbjIgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgaWYgKHQ1IHw9ICgxNSAmIG4yKSA8PCAyOCwgcjUgPSAoMTEyICYgbjIpID4+IDQsICEoMTI4ICYgbjIpKSByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgW3Q1LCByNV07XG4gIGZvciAobGV0IG4zID0gMzsgbjMgPD0gMzE7IG4zICs9IDcpIHtcbiAgICBsZXQgbzIgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXTtcbiAgICBpZiAocjUgfD0gKDEyNyAmIG8yKSA8PCBuMywgISgxMjggJiBvMikpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCBbdDUsIHI1XTtcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoXCJpbnZhbGlkIHZhcmludFwiKTtcbn1cbnZhciB0ID0gNDI5NDk2NzI5NjtcbmZ1bmN0aW9uIGludDY0RnJvbVN0cmluZyhvMikge1xuICBjb25zdCBpMiA9IFwiLVwiID09PSBvMlswXTtcbiAgaTIgJiYgKG8yID0gbzIuc2xpY2UoMSkpO1xuICBjb25zdCBlMiA9IDFlNjtcbiAgbGV0IHMzID0gMCwgdTIgPSAwO1xuICBmdW5jdGlvbiBmMihyNSwgbjIpIHtcbiAgICBjb25zdCBpMyA9IE51bWJlcihvMi5zbGljZShyNSwgbjIpKTtcbiAgICB1MiAqPSBlMiwgczMgPSBzMyAqIGUyICsgaTMsIHMzID49IHQgJiYgKHUyICs9IHMzIC8gdCB8IDAsIHMzICU9IHQpO1xuICB9XG4gIHJldHVybiBmMigtMjQsIC0xOCksIGYyKC0xOCwgLTEyKSwgZjIoLTEyLCAtNiksIGYyKC02KSwgaTIgPyBuKHMzLCB1MikgOiByKHMzLCB1Mik7XG59XG5mdW5jdGlvbiBpbnQ2NFRvU3RyaW5nKHQ1LCBvMikge1xuICBsZXQgaTIgPSByKHQ1LCBvMik7XG4gIGNvbnN0IGUyID0gMjE0NzQ4MzY0OCAmIGkyLmhpO1xuICBlMiAmJiAoaTIgPSBuKGkyLmxvLCBpMi5oaSkpO1xuICBjb25zdCBzMyA9IHVJbnQ2NFRvU3RyaW5nKGkyLmxvLCBpMi5oaSk7XG4gIHJldHVybiBlMiA/IFwiLVwiICsgczMgOiBzMztcbn1cbmZ1bmN0aW9uIHVJbnQ2NFRvU3RyaW5nKHI1LCBuMikge1xuICBpZiAoeyBsbzogcjUsIGhpOiBuMiB9ID0gZnVuY3Rpb24odDUsIHI2KSB7XG4gICAgcmV0dXJuIHsgbG86IHQ1ID4+PiAwLCBoaTogcjYgPj4+IDAgfTtcbiAgfShyNSwgbjIpLCBuMiA8PSAyMDk3MTUxKSByZXR1cm4gU3RyaW5nKHQgKiBuMiArIHI1KTtcbiAgY29uc3QgaTIgPSAxNjc3NzIxNSAmIChyNSA+Pj4gMjQgfCBuMiA8PCA4KSwgZTIgPSBuMiA+PiAxNiAmIDY1NTM1O1xuICBsZXQgczMgPSAoMTY3NzcyMTUgJiByNSkgKyA2Nzc3MjE2ICogaTIgKyA2NzEwNjU2ICogZTIsIHUyID0gaTIgKyA4MTQ3NDk3ICogZTIsIGYyID0gMiAqIGUyO1xuICBjb25zdCBoID0gMWU3O1xuICByZXR1cm4gczMgPj0gaCAmJiAodTIgKz0gTWF0aC5mbG9vcihzMyAvIGgpLCBzMyAlPSBoKSwgdTIgPj0gaCAmJiAoZjIgKz0gTWF0aC5mbG9vcih1MiAvIGgpLCB1MiAlPSBoKSwgZjIudG9TdHJpbmcoKSArIG8odTIpICsgbyhzMyk7XG59XG5mdW5jdGlvbiByKHQ1LCByNSkge1xuICByZXR1cm4geyBsbzogMCB8IHQ1LCBoaTogMCB8IHI1IH07XG59XG5mdW5jdGlvbiBuKHQ1LCBuMikge1xuICByZXR1cm4gbjIgPSB+bjIsIHQ1ID8gdDUgPSAxICsgfnQ1IDogbjIgKz0gMSwgcih0NSwgbjIpO1xufVxudmFyIG8gPSAodDUpID0+IHtcbiAgY29uc3QgcjUgPSBTdHJpbmcodDUpO1xuICByZXR1cm4gXCIwMDAwMDAwXCIuc2xpY2UocjUubGVuZ3RoKSArIHI1O1xufTtcbmZ1bmN0aW9uIHZhcmludDMycmVhZCgpIHtcbiAgbGV0IHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI1ID0gMTI3ICYgdDU7XG4gIGlmICghKDEyOCAmIHQ1KSkgcmV0dXJuIHRoaXMuYXNzZXJ0Qm91bmRzKCksIHI1O1xuICBpZiAodDUgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXSwgcjUgfD0gKDEyNyAmIHQ1KSA8PCA3LCAhKDEyOCAmIHQ1KSkgcmV0dXJuIHRoaXMuYXNzZXJ0Qm91bmRzKCksIHI1O1xuICBpZiAodDUgPSB0aGlzLmJ1Zlt0aGlzLnBvcysrXSwgcjUgfD0gKDEyNyAmIHQ1KSA8PCAxNCwgISgxMjggJiB0NSkpIHJldHVybiB0aGlzLmFzc2VydEJvdW5kcygpLCByNTtcbiAgaWYgKHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI1IHw9ICgxMjcgJiB0NSkgPDwgMjEsICEoMTI4ICYgdDUpKSByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgcjU7XG4gIHQ1ID0gdGhpcy5idWZbdGhpcy5wb3MrK10sIHI1IHw9ICgxNSAmIHQ1KSA8PCAyODtcbiAgZm9yIChsZXQgcjYgPSA1OyAxMjggJiB0NSAmJiByNiA8IDEwOyByNisrKSB0NSA9IHRoaXMuYnVmW3RoaXMucG9zKytdO1xuICBpZiAoMTI4ICYgdDUpIHRocm93IG5ldyBFcnJvcihcImludmFsaWQgdmFyaW50XCIpO1xuICByZXR1cm4gdGhpcy5hc3NlcnRCb3VuZHMoKSwgcjUgPj4+IDA7XG59XG5mdW5jdGlvbiB6ekVuY29kZSh0NSwgcjUpIHtcbiAgbGV0IG4yID0gcjUgPj4gMzE7XG4gIHJldHVybiByNSA9ICgocjUgPDwgMSB8IHQ1ID4+PiAzMSkgXiBuMikgPj4+IDAsIFt0NSA9ICh0NSA8PCAxIF4gbjIpID4+PiAwLCByNV07XG59XG5mdW5jdGlvbiB6ekRlY29kZSh0NSwgcjUpIHtcbiAgbGV0IG4yID0gLSgxICYgdDUpO1xuICByZXR1cm4gW3Q1ID0gKCh0NSA+Pj4gMSB8IHI1IDw8IDMxKSBeIG4yKSA+Pj4gMCwgcjUgPSAocjUgPj4+IDEgXiBuMikgPj4+IDBdO1xufVxuZnVuY3Rpb24gcmVhZFVJbnQzMih0NSwgcjUpIHtcbiAgcmV0dXJuICh0NVtyNV0gfCB0NVtyNSArIDFdIDw8IDggfCB0NVtyNSArIDJdIDw8IDE2KSArIDE2Nzc3MjE2ICogdDVbcjUgKyAzXTtcbn1cbmZ1bmN0aW9uIHJlYWRJbnQzMih0NSwgcjUpIHtcbiAgcmV0dXJuICh0NVtyNV0gfCB0NVtyNSArIDFdIDw8IDggfCB0NVtyNSArIDJdIDw8IDE2KSArICh0NVtyNSArIDNdIDw8IDI0KTtcbn1cbmZ1bmN0aW9uIHdyaXRlVmFyaW50MzIodDUsIHI1LCBuMikge1xuICBmb3IgKDsgdDUgPiAxMjc7ICkgcjVbbjIrK10gPSAxMjcgJiB0NSB8IDEyOCwgdDUgPj4+PSA3O1xuICByNVtuMl0gPSB0NTtcbn1cbmZ1bmN0aW9uIHdyaXRlVmFyaW50NjQodDUsIHI1LCBuMikge1xuICBmb3IgKDsgdDUuaGk7ICkgcjVbbjIrK10gPSAxMjcgJiB0NS5sbyB8IDEyOCwgdDUubG8gPSAodDUubG8gPj4+IDcgfCB0NS5oaSA8PCAyNSkgPj4+IDAsIHQ1LmhpID4+Pj0gNztcbiAgZm9yICg7IHQ1LmxvID4gMTI3OyApIHI1W24yKytdID0gMTI3ICYgdDUubG8gfCAxMjgsIHQ1LmxvID0gdDUubG8gPj4+IDc7XG4gIHI1W24yKytdID0gdDUubG87XG59XG5mdW5jdGlvbiBpbnQ2NExlbmd0aCh0NSwgcjUpIHtcbiAgbGV0IG4yID0gKHQ1ID4+PiAyOCB8IHI1IDw8IDQpID4+PiAwLCBvMiA9IHI1ID4+PiAyNDtcbiAgcmV0dXJuIDAgPT09IG8yID8gMCA9PT0gbjIgPyB0NSA8IDE2Mzg0ID8gdDUgPCAxMjggPyAxIDogMiA6IHQ1IDwgMjA5NzE1MiA/IDMgOiA0IDogbjIgPCAxNjM4NCA/IG4yIDwgMTI4ID8gNSA6IDYgOiBuMiA8IDIwOTcxNTIgPyA3IDogOCA6IG8yIDwgMTI4ID8gOSA6IDEwO1xufVxuZnVuY3Rpb24gd3JpdGVGaXhlZDMyKHQ1LCByNSwgbjIpIHtcbiAgcjVbbjJdID0gMjU1ICYgdDUsIHI1W24yICsgMV0gPSB0NSA+Pj4gOCAmIDI1NSwgcjVbbjIgKyAyXSA9IHQ1ID4+PiAxNiAmIDI1NSwgcjVbbjIgKyAzXSA9IHQ1ID4+PiAyNDtcbn1cbmZ1bmN0aW9uIHdyaXRlQnl0ZSh0NSwgcjUsIG4yKSB7XG4gIHI1W24yXSA9IDI1NSAmIHQ1O1xufVxuXG4vL1xudmFyIFdpcmVUeXBlO1xuIWZ1bmN0aW9uKHQ1KSB7XG4gIHQ1W3Q1LlZhcmludCA9IDBdID0gXCJWYXJpbnRcIiwgdDVbdDUuRml4ZWQ2NCA9IDFdID0gXCJGaXhlZDY0XCIsIHQ1W3Q1LkJ5dGVzID0gMl0gPSBcIkJ5dGVzXCIsIHQ1W3Q1LkZpeGVkMzIgPSA1XSA9IFwiRml4ZWQzMlwiO1xufShXaXJlVHlwZSB8fCAoV2lyZVR5cGUgPSB7fSkpO1xudmFyIEJpbmFyeVJlYWRlciA9IGNsYXNzIHtcbiAgYnVmO1xuICBwb3M7XG4gIHR5cGU7XG4gIGxlbjtcbiAgYXNzZXJ0Qm91bmRzKCkge1xuICAgIGlmICh0aGlzLnBvcyA+IHRoaXMubGVuKSB0aHJvdyBuZXcgUmFuZ2VFcnJvcihcInByZW1hdHVyZSBFT0ZcIik7XG4gIH1cbiAgY29uc3RydWN0b3IodDUpIHtcbiAgICB0aGlzLmJ1ZiA9IHQ1ID8gbmV3IFVpbnQ4QXJyYXkodDUpIDogbmV3IFVpbnQ4QXJyYXkoMCksIHRoaXMucG9zID0gMCwgdGhpcy50eXBlID0gMCwgdGhpcy5sZW4gPSB0aGlzLmJ1Zi5sZW5ndGg7XG4gIH1cbiAgdGFnKCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy51aW50MzIoKSwgaTIgPSB0NSA+Pj4gMywgczMgPSA3ICYgdDU7XG4gICAgaWYgKGkyIDw9IDAgfHwgczMgPCAwIHx8IHMzID4gNSkgdGhyb3cgbmV3IEVycm9yKFwiaWxsZWdhbCB0YWc6IGZpZWxkIG5vIFwiICsgaTIgKyBcIiB3aXJlIHR5cGUgXCIgKyBzMyk7XG4gICAgcmV0dXJuIFtpMiwgczMsIHQ1XTtcbiAgfVxuICBza2lwKHQ1KSB7XG4gICAgaWYgKFwibnVtYmVyXCIgPT0gdHlwZW9mIHQ1KSB7XG4gICAgICBpZiAodGhpcy5wb3MgKyB0NSA+IHRoaXMubGVuKSB0aHJvdyBCKHRoaXMsIHQ1KTtcbiAgICAgIHRoaXMucG9zICs9IHQ1O1xuICAgIH0gZWxzZSBkbyB7XG4gICAgICBpZiAodGhpcy5wb3MgPj0gdGhpcy5sZW4pIHRocm93IEIodGhpcyk7XG4gICAgfSB3aGlsZSAoMTI4ICYgdGhpcy5idWZbdGhpcy5wb3MrK10pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHNraXBUeXBlKHQ1KSB7XG4gICAgc3dpdGNoICh0NSkge1xuICAgICAgY2FzZSBXaXJlVHlwZS5WYXJpbnQ6XG4gICAgICAgIHRoaXMuc2tpcCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgV2lyZVR5cGUuRml4ZWQ2NDpcbiAgICAgICAgdGhpcy5za2lwKDgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgV2lyZVR5cGUuQnl0ZXM6XG4gICAgICAgIHRoaXMuc2tpcCh0aGlzLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGZvciAoOyA0ICE9ICh0NSA9IDcgJiB0aGlzLnVpbnQzMigpKTsgKSB0aGlzLnNraXBUeXBlKHQ1KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFdpcmVUeXBlLkZpeGVkMzI6XG4gICAgICAgIHRoaXMuc2tpcCg0KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBFcnJvcihcImludmFsaWQgd2lyZSB0eXBlIFwiICsgdDUgKyBcIiBhdCBvZmZzZXQgXCIgKyB0aGlzLnBvcyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHVpbnQzMigpIHtcbiAgICByZXR1cm4gdmFyaW50MzJyZWFkLmJpbmQodGhpcykoKTtcbiAgfVxuICBpbnQzMigpIHtcbiAgICByZXR1cm4gMCB8IHRoaXMudWludDMyKCk7XG4gIH1cbiAgc2ludDMyKCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy51aW50MzIoKTtcbiAgICByZXR1cm4gdDUgJSAyID09IDEgPyAodDUgKyAxKSAvIC0yIDogdDUgLyAyO1xuICB9XG4gIGZpeGVkMzIoKSB7XG4gICAgY29uc3QgdDUgPSByZWFkVUludDMyKHRoaXMuYnVmLCB0aGlzLnBvcyk7XG4gICAgcmV0dXJuIHRoaXMucG9zICs9IDQsIHQ1O1xuICB9XG4gIHNmaXhlZDMyKCkge1xuICAgIGNvbnN0IHQ1ID0gcmVhZEludDMyKHRoaXMuYnVmLCB0aGlzLnBvcyk7XG4gICAgcmV0dXJuIHRoaXMucG9zICs9IDQsIHQ1O1xuICB9XG4gIGludDY0KCkge1xuICAgIGNvbnN0IFt0NSwgaTJdID0gdmFyaW50NjRyZWFkLmJpbmQodGhpcykoKTtcbiAgICByZXR1cm4gQmlnSW50KGludDY0VG9TdHJpbmcodDUsIGkyKSk7XG4gIH1cbiAgdWludDY0KCkge1xuICAgIGNvbnN0IFt0NSwgaTJdID0gdmFyaW50NjRyZWFkLmJpbmQodGhpcykoKTtcbiAgICByZXR1cm4gQmlnSW50KHVJbnQ2NFRvU3RyaW5nKHQ1LCBpMikpO1xuICB9XG4gIHNpbnQ2NCgpIHtcbiAgICBsZXQgW3Q1LCBpMl0gPSB2YXJpbnQ2NHJlYWQuYmluZCh0aGlzKSgpO1xuICAgIHJldHVybiBbdDUsIGkyXSA9IHp6RGVjb2RlKHQ1LCBpMiksIEJpZ0ludChpbnQ2NFRvU3RyaW5nKHQ1LCBpMikpO1xuICB9XG4gIGZpeGVkNjQoKSB7XG4gICAgY29uc3QgdDUgPSB0aGlzLnNmaXhlZDMyKCksIGkyID0gdGhpcy5zZml4ZWQzMigpO1xuICAgIHJldHVybiBCaWdJbnQodUludDY0VG9TdHJpbmcodDUsIGkyKSk7XG4gIH1cbiAgc2ZpeGVkNjQoKSB7XG4gICAgY29uc3QgdDUgPSB0aGlzLnNmaXhlZDMyKCksIGkyID0gdGhpcy5zZml4ZWQzMigpO1xuICAgIHJldHVybiBCaWdJbnQoaW50NjRUb1N0cmluZyh0NSwgaTIpKTtcbiAgfVxuICBmbG9hdCgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJmbG9hdCBub3Qgc3VwcG9ydGVkXCIpO1xuICB9XG4gIGRvdWJsZSgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJkb3VibGUgbm90IHN1cHBvcnRlZFwiKTtcbiAgfVxuICBib29sKCkge1xuICAgIGNvbnN0IFt0NSwgaTJdID0gdmFyaW50NjRyZWFkLmJpbmQodGhpcykoKTtcbiAgICByZXR1cm4gMCAhPT0gdDUgfHwgMCAhPT0gaTI7XG4gIH1cbiAgYnl0ZXMoKSB7XG4gICAgY29uc3QgdDUgPSB0aGlzLnVpbnQzMigpLCBpMiA9IHRoaXMucG9zO1xuICAgIHJldHVybiB0aGlzLnBvcyArPSB0NSwgdGhpcy5hc3NlcnRCb3VuZHMoKSwgdGhpcy5idWYuc3ViYXJyYXkoaTIsIGkyICsgdDUpO1xuICB9XG4gIHN0cmluZygpIHtcbiAgICBjb25zdCB0NSA9IHRoaXMuYnl0ZXMoKTtcbiAgICByZXR1cm4gdXRmOFJlYWQodDUsIDAsIHQ1Lmxlbmd0aCk7XG4gIH1cbn07XG52YXIgdyA9IGNsYXNzIHtcbiAgZm47XG4gIGxlbjtcbiAgdmFsO1xuICBuZXh0O1xuICBjb25zdHJ1Y3Rvcih0NSwgaTIsIHMzKSB7XG4gICAgdGhpcy5mbiA9IHQ1LCB0aGlzLmxlbiA9IGkyLCB0aGlzLnZhbCA9IHMzO1xuICB9XG4gIHByb2NlZWQodDUsIGkyKSB7XG4gICAgdGhpcy5mbiAmJiB0aGlzLmZuKHRoaXMudmFsLCB0NSwgaTIpO1xuICB9XG59O1xudmFyIGIgPSBjbGFzcyB7XG4gIGhlYWQ7XG4gIHRhaWw7XG4gIGxlbjtcbiAgbmV4dDtcbiAgY29uc3RydWN0b3IodDUpIHtcbiAgICB0aGlzLmhlYWQgPSB0NS5oZWFkLCB0aGlzLnRhaWwgPSB0NS50YWlsLCB0aGlzLmxlbiA9IHQ1LmxlbiwgdGhpcy5uZXh0ID0gdDUuc3RhdGVzO1xuICB9XG59O1xudmFyIEJpbmFyeVdyaXRlciA9IGNsYXNzIF9CaW5hcnlXcml0ZXIge1xuICBsZW4gPSAwO1xuICBoZWFkO1xuICB0YWlsO1xuICBzdGF0ZXM7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaGVhZCA9IG5ldyB3KG51bGwsIDAsIDApLCB0aGlzLnRhaWwgPSB0aGlzLmhlYWQsIHRoaXMuc3RhdGVzID0gbnVsbDtcbiAgfVxuICBzdGF0aWMgY3JlYXRlKCkge1xuICAgIHJldHVybiBuZXcgX0JpbmFyeVdyaXRlcigpO1xuICB9XG4gIHN0YXRpYyBhbGxvYyh0NSkge1xuICAgIHJldHVybiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBVaW50OEFycmF5ID8gZnVuY3Rpb24odDYsIGkyLCBzMykge1xuICAgICAgY29uc3QgZTIgPSBzMyB8fCA4MTkyLCBuMiA9IGUyID4+PiAxO1xuICAgICAgbGV0IHI1ID0gbnVsbCwgaCA9IGUyO1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKHM0KSB7XG4gICAgICAgIGlmIChzNCA8IDEgfHwgczQgPiBuMikgcmV0dXJuIHQ2KHM0KTtcbiAgICAgICAgaCArIHM0ID4gZTIgJiYgKHI1ID0gdDYoZTIpLCBoID0gMCk7XG4gICAgICAgIGNvbnN0IG8yID0gaTIuY2FsbChyNSwgaCwgaCArPSBzNCk7XG4gICAgICAgIHJldHVybiA3ICYgaCAmJiAoaCA9IDEgKyAoNyB8IGgpKSwgbzI7XG4gICAgICB9O1xuICAgIH0oKHQ2KSA9PiBuZXcgVWludDhBcnJheSh0NiksIFVpbnQ4QXJyYXkucHJvdG90eXBlLnN1YmFycmF5KSh0NSkgOiBuZXcgQXJyYXkodDUpO1xuICB9XG4gIF9wdXNoKHQ1LCBpMiwgczMpIHtcbiAgICByZXR1cm4gdGhpcy50YWlsID0gdGhpcy50YWlsLm5leHQgPSBuZXcgdyh0NSwgaTIsIHMzKSwgdGhpcy5sZW4gKz0gaTIsIHRoaXM7XG4gIH1cbiAgZmluaXNoKCkge1xuICAgIGxldCB0NSA9IHRoaXMuaGVhZC5uZXh0LCBpMiA9IDA7XG4gICAgY29uc3QgczMgPSBfQmluYXJ5V3JpdGVyLmFsbG9jKHRoaXMubGVuKTtcbiAgICBmb3IgKDsgdDU7ICkgdDUucHJvY2VlZChzMywgaTIpLCBpMiArPSB0NS5sZW4sIHQ1ID0gdDUubmV4dDtcbiAgICByZXR1cm4gczM7XG4gIH1cbiAgZm9yaygpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZXMgPSBuZXcgYih0aGlzKSwgdGhpcy5oZWFkID0gdGhpcy50YWlsID0gbmV3IHcobnVsbCwgMCwgMCksIHRoaXMubGVuID0gMCwgdGhpcztcbiAgfVxuICByZXNldCgpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZXMgPyAodGhpcy5oZWFkID0gdGhpcy5zdGF0ZXMuaGVhZCwgdGhpcy50YWlsID0gdGhpcy5zdGF0ZXMudGFpbCwgdGhpcy5sZW4gPSB0aGlzLnN0YXRlcy5sZW4sIHRoaXMuc3RhdGVzID0gdGhpcy5zdGF0ZXMubmV4dCkgOiAodGhpcy5oZWFkID0gdGhpcy50YWlsID0gbmV3IHcobnVsbCwgMCwgMCksIHRoaXMubGVuID0gMCksIHRoaXM7XG4gIH1cbiAgbGRlbGltKCkge1xuICAgIGNvbnN0IHQ1ID0gdGhpcy5oZWFkLCBpMiA9IHRoaXMudGFpbCwgczMgPSB0aGlzLmxlbjtcbiAgICByZXR1cm4gdGhpcy5yZXNldCgpLnVpbnQzMihzMyksIHMzICYmICh0aGlzLnRhaWwubmV4dCA9IHQ1Lm5leHQsIHRoaXMudGFpbCA9IGkyLCB0aGlzLmxlbiArPSBzMyksIHRoaXM7XG4gIH1cbiAgdGFnKHQ1LCBpMikge1xuICAgIHJldHVybiB0aGlzLnVpbnQzMigodDUgPDwgMyB8IGkyKSA+Pj4gMCk7XG4gIH1cbiAgdWludDMyKHQ1KSB7XG4gICAgcmV0dXJuIHRoaXMubGVuICs9ICh0aGlzLnRhaWwgPSB0aGlzLnRhaWwubmV4dCA9IG5ldyB3KHdyaXRlVmFyaW50MzIsICh0NSA+Pj49IDApIDwgMTI4ID8gMSA6IHQ1IDwgMTYzODQgPyAyIDogdDUgPCAyMDk3MTUyID8gMyA6IHQ1IDwgMjY4NDM1NDU2ID8gNCA6IDUsIHQ1KSkubGVuLCB0aGlzO1xuICB9XG4gIGludDMyKHQ1KSB7XG4gICAgcmV0dXJuIHQ1IDwgMCA/IHRoaXMuX3B1c2god3JpdGVWYXJpbnQ2NCwgMTAsIGludDY0RnJvbVN0cmluZyh0NS50b1N0cmluZygpKSkgOiB0aGlzLnVpbnQzMih0NSk7XG4gIH1cbiAgc2ludDMyKHQ1KSB7XG4gICAgcmV0dXJuIHRoaXMudWludDMyKCh0NSA8PCAxIF4gdDUgPj4gMzEpID4+PiAwKTtcbiAgfVxuICBpbnQ2NCh0NSkge1xuICAgIGNvbnN0IHsgbG86IGkyLCBoaTogczMgfSA9IGludDY0RnJvbVN0cmluZyh0NS50b1N0cmluZygpKTtcbiAgICByZXR1cm4gdGhpcy5fcHVzaCh3cml0ZVZhcmludDY0LCBpbnQ2NExlbmd0aChpMiwgczMpLCB7IGxvOiBpMiwgaGk6IHMzIH0pO1xuICB9XG4gIHVpbnQ2NCA9IF9CaW5hcnlXcml0ZXIucHJvdG90eXBlLmludDY0O1xuICBzaW50NjQodDUpIHtcbiAgICBsZXQgeyBsbzogaTIsIGhpOiBzMyB9ID0gaW50NjRGcm9tU3RyaW5nKHQ1LnRvU3RyaW5nKCkpO1xuICAgIHJldHVybiBbaTIsIHMzXSA9IHp6RW5jb2RlKGkyLCBzMyksIHRoaXMuX3B1c2god3JpdGVWYXJpbnQ2NCwgaW50NjRMZW5ndGgoaTIsIHMzKSwgeyBsbzogaTIsIGhpOiBzMyB9KTtcbiAgfVxuICBmaXhlZDY0KHQ1KSB7XG4gICAgY29uc3QgeyBsbzogaTIsIGhpOiBzMyB9ID0gaW50NjRGcm9tU3RyaW5nKHQ1LnRvU3RyaW5nKCkpO1xuICAgIHJldHVybiB0aGlzLl9wdXNoKHdyaXRlRml4ZWQzMiwgNCwgaTIpLl9wdXNoKHdyaXRlRml4ZWQzMiwgNCwgczMpO1xuICB9XG4gIHNmaXhlZDY0ID0gX0JpbmFyeVdyaXRlci5wcm90b3R5cGUuZml4ZWQ2NDtcbiAgYm9vbCh0NSkge1xuICAgIHJldHVybiB0aGlzLl9wdXNoKHdyaXRlQnl0ZSwgMSwgdDUgPyAxIDogMCk7XG4gIH1cbiAgZml4ZWQzMih0NSkge1xuICAgIHJldHVybiB0aGlzLl9wdXNoKHdyaXRlRml4ZWQzMiwgNCwgdDUgPj4+IDApO1xuICB9XG4gIHNmaXhlZDMyID0gX0JpbmFyeVdyaXRlci5wcm90b3R5cGUuZml4ZWQzMjtcbiAgZmxvYXQodDUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJmbG9hdCBub3Qgc3VwcG9ydGVkXCIgKyB0NSk7XG4gIH1cbiAgZG91YmxlKHQ1KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiZG91YmxlIG5vdCBzdXBwb3J0ZWRcIiArIHQ1KTtcbiAgfVxuICBieXRlcyh0NSkge1xuICAgIGNvbnN0IGkyID0gdDUubGVuZ3RoID4+PiAwO1xuICAgIHJldHVybiBpMiA/IHRoaXMudWludDMyKGkyKS5fcHVzaChnLCBpMiwgdDUpIDogdGhpcy5fcHVzaCh3cml0ZUJ5dGUsIDEsIDApO1xuICB9XG4gIHN0cmluZyhpMikge1xuICAgIGNvbnN0IGUyID0gdXRmOExlbmd0aChpMik7XG4gICAgcmV0dXJuIGUyID8gdGhpcy51aW50MzIoZTIpLl9wdXNoKHV0ZjhXcml0ZSwgZTIsIGkyKSA6IHRoaXMuX3B1c2god3JpdGVCeXRlLCAxLCAwKTtcbiAgfVxufTtcbmZ1bmN0aW9uIGcodDUsIGkyLCBzMykge1xuICBpZiAoXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgVWludDhBcnJheSkgaTIuc2V0KHQ1LCBzMyk7XG4gIGVsc2UgZm9yIChsZXQgZTIgPSAwOyBlMiA8IHQ1Lmxlbmd0aDsgKytlMikgaTJbczMgKyBlMl0gPSB0NVtlMl07XG59XG5mdW5jdGlvbiBCKHQ1LCBpMikge1xuICByZXR1cm4gUmFuZ2VFcnJvcihcImluZGV4IG91dCBvZiByYW5nZTogXCIgKyB0NS5wb3MgKyBcIiArIFwiICsgKGkyIHx8IDEpICsgXCIgPiBcIiArIHQ1Lmxlbik7XG59XG5cbi8vXG52YXIgYnl0ZXNGcm9tQmFzZTY0ID0gZGVjb2RlQmFzZTY0O1xudmFyIGJhc2U2NEZyb21CeXRlcyA9IGVuY29kZUJhc2U2NDtcbmZ1bmN0aW9uIGlzU2V0KHQ1KSB7XG4gIHJldHVybiBudWxsICE9IHQ1O1xufVxuZnVuY3Rpb24gdG9UaW1lc3RhbXAodDUpIHtcbiAgdmFyIGUyO1xuICByZXR1cm4geyBzZWNvbmRzOiAoZTIgPSB0NS5nZXRUaW1lKCkgLyAxZTMsIEJpZ0ludChNYXRoLnRydW5jKGUyKSkpLCBuYW5vczogdDUuZ2V0VGltZSgpICUgMWUzICogMWU2IH07XG59XG5mdW5jdGlvbiBmcm9tVGltZXN0YW1wKHQ1KSB7XG4gIGxldCBlMiA9IDFlMyAqIE51bWJlcih0NS5zZWNvbmRzKTtcbiAgcmV0dXJuIGUyICs9IHQ1Lm5hbm9zIC8gMWU2LCBuZXcgRGF0ZShlMik7XG59XG5mdW5jdGlvbiBmcm9tSnNvblRpbWVzdGFtcCh0NSkge1xuICByZXR1cm4gdDUgaW5zdGFuY2VvZiBEYXRlID8gdG9UaW1lc3RhbXAodDUpIDogXCJzdHJpbmdcIiA9PSB0eXBlb2YgdDUgPyB0b1RpbWVzdGFtcChuZXcgRGF0ZSh0NSkpIDogeyBzZWNvbmRzOiBpc1NldCgoZTIgPSB0NSkuc2Vjb25kcykgPyBCaWdJbnQoZTIuc2Vjb25kcy50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbmFub3M6IGlzU2V0KGUyLm5hbm9zKSA/IE51bWJlcihlMi5uYW5vcykgOiAwIH07XG4gIHZhciBlMjtcbn1cbnZhciBEZWNpbWFsID0gY2xhc3MgX0RlY2ltYWwge1xuICBzdGF0aWMgZnJvbVVzZXJJbnB1dCh0NSwgZTIpIHtcbiAgICBfRGVjaW1hbC52ZXJpZnlGcmFjdGlvbmFsRGlnaXRzKGUyKTtcbiAgICBjb25zdCByNSA9IHQ1Lm1hdGNoKC9bXjAtOS5dLyk7XG4gICAgaWYgKHI1KSB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgY2hhcmFjdGVyIGF0IHBvc2l0aW9uICR7cjUuaW5kZXggKyAxfWApO1xuICAgIGxldCBuMiwgaTI7XG4gICAgaWYgKFwiXCIgPT09IHQ1KSBuMiA9IFwiMFwiLCBpMiA9IFwiXCI7XG4gICAgZWxzZSBpZiAoLTEgPT09IHQ1LnNlYXJjaCgvXFwuLykpIG4yID0gdDUsIGkyID0gXCJcIjtcbiAgICBlbHNlIHtcbiAgICAgIGNvbnN0IGUzID0gdDUuc3BsaXQoXCIuXCIpO1xuICAgICAgc3dpdGNoIChlMy5sZW5ndGgpIHtcbiAgICAgICAgY2FzZSAwOlxuICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmV3ZXIgdGhhbiB0d28gZWxlbWVudHMgaW4gc3BsaXQgcmVzdWx0LiBUaGlzIG11c3Qgbm90IGhhcHBlbiBoZXJlLlwiKTtcbiAgICAgICAgY2FzZSAyOlxuICAgICAgICAgIGlmICghZTNbMV0pIHRocm93IG5ldyBFcnJvcihcIkZyYWN0aW9uYWwgcGFydCBtaXNzaW5nXCIpO1xuICAgICAgICAgIG4yID0gZTNbMF0sIGkyID0gZTNbMV0ucmVwbGFjZSgvMCskLywgXCJcIik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTW9yZSB0aGFuIG9uZSBzZXBhcmF0b3IgZm91bmRcIik7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChpMi5sZW5ndGggPiBlMikgdGhyb3cgbmV3IEVycm9yKFwiR290IG1vcmUgZnJhY3Rpb25hbCBkaWdpdHMgdGhhbiBzdXBwb3J0ZWRcIik7XG4gICAgY29uc3QgbzIgPSBgJHtuMn0ke2kyLnBhZEVuZChlMiwgXCIwXCIpfWA7XG4gICAgcmV0dXJuIG5ldyBfRGVjaW1hbChvMiwgZTIpO1xuICB9XG4gIHN0YXRpYyBmcm9tQXRvbWljcyh0NSwgZTIpIHtcbiAgICByZXR1cm4gX0RlY2ltYWwudmVyaWZ5RnJhY3Rpb25hbERpZ2l0cyhlMiksIG5ldyBfRGVjaW1hbCh0NSwgZTIpO1xuICB9XG4gIHN0YXRpYyB2ZXJpZnlGcmFjdGlvbmFsRGlnaXRzKHQ1KSB7XG4gICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKHQ1KSkgdGhyb3cgbmV3IEVycm9yKFwiRnJhY3Rpb25hbCBkaWdpdHMgaXMgbm90IGFuIGludGVnZXJcIik7XG4gICAgaWYgKHQ1IDwgMCkgdGhyb3cgbmV3IEVycm9yKFwiRnJhY3Rpb25hbCBkaWdpdHMgbXVzdCBub3QgYmUgbmVnYXRpdmVcIik7XG4gICAgaWYgKHQ1ID4gMzApIHRocm93IG5ldyBFcnJvcihcIkZyYWN0aW9uYWwgZGlnaXRzIG11c3Qgbm90IGV4Y2VlZCAzMFwiKTtcbiAgfVxuICBnZXQgYXRvbWljcygpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLmF0b21pY3MudG9TdHJpbmcoKTtcbiAgfVxuICBnZXQgZnJhY3Rpb25hbERpZ2l0cygpIHtcbiAgICByZXR1cm4gdGhpcy5kYXRhLmZyYWN0aW9uYWxEaWdpdHM7XG4gIH1cbiAgZGF0YTtcbiAgY29uc3RydWN0b3IodDUsIGUyKSB7XG4gICAgaWYgKCF0NS5tYXRjaCgvXlswLTldKyQvKSkgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBzdHJpbmcgZm9ybWF0LiBPbmx5IG5vbi1uZWdhdGl2ZSBpbnRlZ2VycyBpbiBkZWNpbWFsIHJlcHJlc2VudGF0aW9uIHN1cHBvcnRlZC5cIik7XG4gICAgdGhpcy5kYXRhID0geyBhdG9taWNzOiBCaWdJbnQodDUpLCBmcmFjdGlvbmFsRGlnaXRzOiBlMiB9O1xuICB9XG4gIHRvU3RyaW5nKCkge1xuICAgIGNvbnN0IHQ1ID0gQmlnSW50KDEwKSAqKiBCaWdJbnQodGhpcy5kYXRhLmZyYWN0aW9uYWxEaWdpdHMpLCBlMiA9IHRoaXMuZGF0YS5hdG9taWNzIC8gdDUsIHI1ID0gdGhpcy5kYXRhLmF0b21pY3MgJSB0NTtcbiAgICBpZiAoMG4gPT09IHI1KSByZXR1cm4gZTIudG9TdHJpbmcoKTtcbiAgICB7XG4gICAgICBjb25zdCB0NiA9IHI1LnRvU3RyaW5nKCkucGFkU3RhcnQodGhpcy5kYXRhLmZyYWN0aW9uYWxEaWdpdHMsIFwiMFwiKS5yZXBsYWNlKC8wKyQvLCBcIlwiKTtcbiAgICAgIHJldHVybiBgJHtlMi50b1N0cmluZygpfS4ke3Q2fWA7XG4gICAgfVxuICB9XG59O1xuXG4vL1xuZnVuY3Rpb24gbCgpIHtcbiAgcmV0dXJuIHsgJHR5cGVVcmw6IFwiL2dvb2dsZS5wcm90b2J1Zi5BbnlcIiwgdHlwZVVybDogXCJcIiwgdmFsdWU6IG5ldyBVaW50OEFycmF5KCkgfTtcbn1cbnZhciBBbnkgPSB7IHR5cGVVcmw6IFwiL2dvb2dsZS5wcm90b2J1Zi5BbnlcIiwgZW5jb2RlOiAoZTIsIHI1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIudHlwZVVybCAmJiByNS51aW50MzIoMTApLnN0cmluZyhlMi50eXBlVXJsKSwgMCAhPT0gZTIudmFsdWUubGVuZ3RoICYmIHI1LnVpbnQzMigxOCkuYnl0ZXMoZTIudmFsdWUpLCByNSksIGRlY29kZSh0NSwgcjUpIHtcbiAgY29uc3QgbzIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gcjUgPyBvMi5sZW4gOiBvMi5wb3MgKyByNTtcbiAgY29uc3QgYTIgPSBsKCk7XG4gIGZvciAoOyBvMi5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTIgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUyID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGEyLnR5cGVVcmwgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGEyLnZhbHVlID0gbzIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTIpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyB0eXBlVXJsOiBpc1NldChlMi50eXBlVXJsKSA/IFN0cmluZyhlMi50eXBlVXJsKSA6IFwiXCIsIHZhbHVlOiBpc1NldChlMi52YWx1ZSkgPyBieXRlc0Zyb21CYXNlNjQoZTIudmFsdWUpIDogbmV3IFVpbnQ4QXJyYXkoKSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLnR5cGVVcmwgJiYgKHQ1LnR5cGVVcmwgPSBlMi50eXBlVXJsKSwgdm9pZCAwICE9PSBlMi52YWx1ZSAmJiAodDUudmFsdWUgPSBiYXNlNjRGcm9tQnl0ZXModm9pZCAwICE9PSBlMi52YWx1ZSA/IGUyLnZhbHVlIDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0gbCgpO1xuICByZXR1cm4gdDUudHlwZVVybCA9IGUyLnR5cGVVcmwgPz8gXCJcIiwgdDUudmFsdWUgPSBlMi52YWx1ZSA/PyBuZXcgVWludDhBcnJheSgpLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBBbnkuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBBbnkuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9nb29nbGUucHJvdG9idWYuQW55XCIsIHZhbHVlOiBBbnkuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIFNpZ25Nb2RlO1xuIWZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLlNJR05fTU9ERV9VTlNQRUNJRklFRCA9IDBdID0gXCJTSUdOX01PREVfVU5TUEVDSUZJRURcIiwgZTJbZTIuU0lHTl9NT0RFX0RJUkVDVCA9IDFdID0gXCJTSUdOX01PREVfRElSRUNUXCIsIGUyW2UyLlNJR05fTU9ERV9URVhUVUFMID0gMl0gPSBcIlNJR05fTU9ERV9URVhUVUFMXCIsIGUyW2UyLlNJR05fTU9ERV9ESVJFQ1RfQVVYID0gM10gPSBcIlNJR05fTU9ERV9ESVJFQ1RfQVVYXCIsIGUyW2UyLlNJR05fTU9ERV9MRUdBQ1lfQU1JTk9fSlNPTiA9IDEyN10gPSBcIlNJR05fTU9ERV9MRUdBQ1lfQU1JTk9fSlNPTlwiLCBlMltlMi5TSUdOX01PREVfRUlQXzE5MSA9IDE5MV0gPSBcIlNJR05fTU9ERV9FSVBfMTkxXCIsIGUyW2UyLlVOUkVDT0dOSVpFRCA9IC0xXSA9IFwiVU5SRUNPR05JWkVEXCI7XG59KFNpZ25Nb2RlIHx8IChTaWduTW9kZSA9IHt9KSk7XG5cbi8vXG52YXIgQ29pbiA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhc2UudjFiZXRhMS5Db2luXCIsIGVuY29kZTogKG8yLCBuMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG8yLmRlbm9tICYmIG4yLnVpbnQzMigxMCkuc3RyaW5nKG8yLmRlbm9tKSwgXCJcIiAhPT0gbzIuYW1vdW50ICYmIG4yLnVpbnQzMigxOCkuc3RyaW5nKG8yLmFtb3VudCksIG4yKSwgZGVjb2RlKHQ1LCBuMikge1xuICBjb25zdCBlMiA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IHI1ID0gdm9pZCAwID09PSBuMiA/IGUyLmxlbiA6IGUyLnBvcyArIG4yO1xuICBjb25zdCBzMyA9IHsgZGVub206IFwiXCIsIGFtb3VudDogXCJcIiB9O1xuICBmb3IgKDsgZTIucG9zIDwgcjU7ICkge1xuICAgIGNvbnN0IG8yID0gZTIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzMy5kZW5vbSA9IGUyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgczMuYW1vdW50ID0gZTIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgZTIuc2tpcFR5cGUoNyAmIG8yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHMzO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVub206IGlzU2V0KG8yLmRlbm9tKSA/IFN0cmluZyhvMi5kZW5vbSkgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KG8yLmFtb3VudCkgPyBTdHJpbmcobzIuYW1vdW50KSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZW5vbSAmJiAodDUuZGVub20gPSBvMi5kZW5vbSksIHZvaWQgMCAhPT0gbzIuYW1vdW50ICYmICh0NS5hbW91bnQgPSBvMi5hbW91bnQpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyBkZW5vbTogXCJcIiwgYW1vdW50OiBcIlwiIH07XG4gIHJldHVybiB0NS5kZW5vbSA9IG8yLmRlbm9tID8/IFwiXCIsIHQ1LmFtb3VudCA9IG8yLmFtb3VudCA/PyBcIlwiLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBDb2luLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gQ29pbi5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnYxYmV0YTEuQ29pblwiLCB2YWx1ZTogQ29pbi5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgRGVjQ29pbiA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhc2UudjFiZXRhMS5EZWNDb2luXCIsIGVuY29kZTogKG8yLCBuMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG8yLmRlbm9tICYmIG4yLnVpbnQzMigxMCkuc3RyaW5nKG8yLmRlbm9tKSwgXCJcIiAhPT0gbzIuYW1vdW50ICYmIG4yLnVpbnQzMigxOCkuc3RyaW5nKG8yLmFtb3VudCksIG4yKSwgZGVjb2RlKHQ1LCBuMikge1xuICBjb25zdCBlMiA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IHI1ID0gdm9pZCAwID09PSBuMiA/IGUyLmxlbiA6IGUyLnBvcyArIG4yO1xuICBjb25zdCBzMyA9IHsgZGVub206IFwiXCIsIGFtb3VudDogXCJcIiB9O1xuICBmb3IgKDsgZTIucG9zIDwgcjU7ICkge1xuICAgIGNvbnN0IG8yID0gZTIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBzMy5kZW5vbSA9IGUyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgczMuYW1vdW50ID0gZTIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgZTIuc2tpcFR5cGUoNyAmIG8yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHMzO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVub206IGlzU2V0KG8yLmRlbm9tKSA/IFN0cmluZyhvMi5kZW5vbSkgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KG8yLmFtb3VudCkgPyBTdHJpbmcobzIuYW1vdW50KSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZW5vbSAmJiAodDUuZGVub20gPSBvMi5kZW5vbSksIHZvaWQgMCAhPT0gbzIuYW1vdW50ICYmICh0NS5hbW91bnQgPSBvMi5hbW91bnQpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyBkZW5vbTogXCJcIiwgYW1vdW50OiBcIlwiIH07XG4gIHJldHVybiB0NS5kZW5vbSA9IG8yLmRlbm9tID8/IFwiXCIsIHQ1LmFtb3VudCA9IG8yLmFtb3VudCA/PyBcIlwiLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBEZWNDb2luLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gRGVjQ29pbi5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnYxYmV0YTEuRGVjQ29pblwiLCB2YWx1ZTogRGVjQ29pbi5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG5mdW5jdGlvbiBnMigpIHtcbiAgcmV0dXJuIHsgbWVzc2FnZXM6IFtdLCBtZW1vOiBcIlwiLCB0aW1lb3V0SGVpZ2h0OiBCaWdJbnQoMCksIGV4dGVuc2lvbk9wdGlvbnM6IFtdLCBub25Dcml0aWNhbEV4dGVuc2lvbk9wdGlvbnM6IFtdIH07XG59XG52YXIgVHhCb2R5ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MudHgudjFiZXRhMS5UeEJvZHlcIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IG4yIG9mIGUyLm1lc3NhZ2VzKSBBbnkuZW5jb2RlKG4yLCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIFwiXCIgIT09IGUyLm1lbW8gJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIubWVtbyksIGUyLnRpbWVvdXRIZWlnaHQgIT09IEJpZ0ludCgwKSAmJiB0NS51aW50MzIoMjQpLnVpbnQ2NChlMi50aW1lb3V0SGVpZ2h0KTtcbiAgZm9yIChjb25zdCBuMiBvZiBlMi5leHRlbnNpb25PcHRpb25zKSBBbnkuZW5jb2RlKG4yLCB0NS51aW50MzIoODE4NikuZm9yaygpKS5sZGVsaW0oKTtcbiAgZm9yIChjb25zdCBuMiBvZiBlMi5ub25Dcml0aWNhbEV4dGVuc2lvbk9wdGlvbnMpIEFueS5lbmNvZGUobjIsIHQ1LnVpbnQzMigxNjM3OCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHQ1O1xufSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSB0NSA/IG4yLmxlbiA6IG4yLnBvcyArIHQ1O1xuICBjb25zdCByNSA9IGcyKCk7XG4gIGZvciAoOyBuMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1Lm1lc3NhZ2VzLnB1c2goQW55LmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1Lm1lbW8gPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHI1LnRpbWVvdXRIZWlnaHQgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDEwMjM6XG4gICAgICAgIHI1LmV4dGVuc2lvbk9wdGlvbnMucHVzaChBbnkuZGVjb2RlKG4yLCBuMi51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjA0NzpcbiAgICAgICAgcjUubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zLnB1c2goQW55LmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBtZXNzYWdlczogQXJyYXkuaXNBcnJheShlMj8ubWVzc2FnZXMpID8gZTIubWVzc2FnZXMubWFwKChlMykgPT4gQW55LmZyb21KU09OKGUzKSkgOiBbXSwgbWVtbzogaXNTZXQoZTIubWVtbykgPyBTdHJpbmcoZTIubWVtbykgOiBcIlwiLCB0aW1lb3V0SGVpZ2h0OiBpc1NldChlMi50aW1lb3V0SGVpZ2h0KSA/IEJpZ0ludChlMi50aW1lb3V0SGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBleHRlbnNpb25PcHRpb25zOiBBcnJheS5pc0FycmF5KGUyPy5leHRlbnNpb25PcHRpb25zKSA/IGUyLmV4dGVuc2lvbk9wdGlvbnMubWFwKChlMykgPT4gQW55LmZyb21KU09OKGUzKSkgOiBbXSwgbm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zOiBBcnJheS5pc0FycmF5KGUyPy5ub25Dcml0aWNhbEV4dGVuc2lvbk9wdGlvbnMpID8gZTIubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zLm1hcCgoZTMpID0+IEFueS5mcm9tSlNPTihlMykpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gZTIubWVzc2FnZXMgPyB0NS5tZXNzYWdlcyA9IGUyLm1lc3NhZ2VzLm1hcCgoZTMpID0+IGUzID8gQW55LnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUubWVzc2FnZXMgPSBbXSwgdm9pZCAwICE9PSBlMi5tZW1vICYmICh0NS5tZW1vID0gZTIubWVtbyksIHZvaWQgMCAhPT0gZTIudGltZW91dEhlaWdodCAmJiAodDUudGltZW91dEhlaWdodCA9IChlMi50aW1lb3V0SGVpZ2h0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIGUyLmV4dGVuc2lvbk9wdGlvbnMgPyB0NS5leHRlbnNpb25PcHRpb25zID0gZTIuZXh0ZW5zaW9uT3B0aW9ucy5tYXAoKGUzKSA9PiBlMyA/IEFueS50b0pTT04oZTMpIDogdm9pZCAwKSA6IHQ1LmV4dGVuc2lvbk9wdGlvbnMgPSBbXSwgZTIubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zID8gdDUubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zID0gZTIubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zLm1hcCgoZTMpID0+IGUzID8gQW55LnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUubm9uQ3JpdGljYWxFeHRlbnNpb25PcHRpb25zID0gW10sIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSBnMigpO1xuICByZXR1cm4gdDUubWVzc2FnZXMgPSBlMi5tZXNzYWdlcz8ubWFwKChlMykgPT4gQW55LmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1Lm1lbW8gPSBlMi5tZW1vID8/IFwiXCIsIHQ1LnRpbWVvdXRIZWlnaHQgPSB2b2lkIDAgIT09IGUyLnRpbWVvdXRIZWlnaHQgJiYgbnVsbCAhPT0gZTIudGltZW91dEhlaWdodCA/IEJpZ0ludChlMi50aW1lb3V0SGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCB0NS5leHRlbnNpb25PcHRpb25zID0gZTIuZXh0ZW5zaW9uT3B0aW9ucz8ubWFwKChlMykgPT4gQW55LmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1Lm5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9ucyA9IGUyLm5vbkNyaXRpY2FsRXh0ZW5zaW9uT3B0aW9ucz8ubWFwKChlMykgPT4gQW55LmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IFR4Qm9keS5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFR4Qm9keS5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy50eC52MWJldGExLlR4Qm9keVwiLCB2YWx1ZTogVHhCb2R5LmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbmZ1bmN0aW9uIHMoKSB7XG4gIHJldHVybiB7IHR5cGU6IFwiXCIsIGtleTogbmV3IFVpbnQ4QXJyYXkoKSwgZGF0YTogbmV3IFVpbnQ4QXJyYXkoKSB9O1xufVxudmFyIFByb29mT3AgPSB7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuY3J5cHRvLlByb29mT3BcIiwgZW5jb2RlOiAodDUsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gdDUudHlwZSAmJiBlMi51aW50MzIoMTApLnN0cmluZyh0NS50eXBlKSwgMCAhPT0gdDUua2V5Lmxlbmd0aCAmJiBlMi51aW50MzIoMTgpLmJ5dGVzKHQ1LmtleSksIDAgIT09IHQ1LmRhdGEubGVuZ3RoICYmIGUyLnVpbnQzMigyNikuYnl0ZXModDUuZGF0YSksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCBuMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IHI1ID0gdm9pZCAwID09PSBlMiA/IG4yLmxlbiA6IG4yLnBvcyArIGUyO1xuICBjb25zdCBpMiA9IHMoKTtcbiAgZm9yICg7IG4yLnBvcyA8IHI1OyApIHtcbiAgICBjb25zdCB0NSA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAodDUgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTIudHlwZSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIua2V5ID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGkyLmRhdGEgPSBuMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiB0NSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAodDUpID0+ICh7IHR5cGU6IGlzU2V0KHQ1LnR5cGUpID8gU3RyaW5nKHQ1LnR5cGUpIDogXCJcIiwga2V5OiBpc1NldCh0NS5rZXkpID8gYnl0ZXNGcm9tQmFzZTY0KHQ1LmtleSkgOiBuZXcgVWludDhBcnJheSgpLCBkYXRhOiBpc1NldCh0NS5kYXRhKSA/IGJ5dGVzRnJvbUJhc2U2NCh0NS5kYXRhKSA6IG5ldyBVaW50OEFycmF5KCkgfSksIHRvSlNPTih0NSkge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSB0NS50eXBlICYmIChvMi50eXBlID0gdDUudHlwZSksIHZvaWQgMCAhPT0gdDUua2V5ICYmIChvMi5rZXkgPSBiYXNlNjRGcm9tQnl0ZXModm9pZCAwICE9PSB0NS5rZXkgPyB0NS5rZXkgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gdDUuZGF0YSAmJiAobzIuZGF0YSA9IGJhc2U2NEZyb21CeXRlcyh2b2lkIDAgIT09IHQ1LmRhdGEgPyB0NS5kYXRhIDogbmV3IFVpbnQ4QXJyYXkoKSkpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKHQ1KSB7XG4gIGNvbnN0IG8yID0gcygpO1xuICByZXR1cm4gbzIudHlwZSA9IHQ1LnR5cGUgPz8gXCJcIiwgbzIua2V5ID0gdDUua2V5ID8/IG5ldyBVaW50OEFycmF5KCksIG8yLmRhdGEgPSB0NS5kYXRhID8/IG5ldyBVaW50OEFycmF5KCksIG8yO1xufSwgZnJvbVByb3RvTXNnOiAodDUpID0+IFByb29mT3AuZGVjb2RlKHQ1LnZhbHVlKSwgdG9Qcm90bzogKHQ1KSA9PiBQcm9vZk9wLmVuY29kZSh0NSkuZmluaXNoKCksIHRvUHJvdG9Nc2c6ICh0NSkgPT4gKHsgdHlwZVVybDogXCIvdGVuZGVybWludC5jcnlwdG8uUHJvb2ZPcFwiLCB2YWx1ZTogUHJvb2ZPcC5lbmNvZGUodDUpLmZpbmlzaCgpIH0pIH07XG52YXIgUHJvb2ZPcHMgPSB7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuY3J5cHRvLlByb29mT3BzXCIsIGVuY29kZSh0NSwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBvMiBvZiB0NS5vcHMpIFByb29mT3AuZW5jb2RlKG8yLCBlMi51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiBlMjtcbn0sIGRlY29kZShvMiwgZTIpIHtcbiAgY29uc3QgbjIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCByNSA9IHZvaWQgMCA9PT0gZTIgPyBuMi5sZW4gOiBuMi5wb3MgKyBlMjtcbiAgY29uc3QgaTIgPSB7IG9wczogW10gfTtcbiAgZm9yICg7IG4yLnBvcyA8IHI1OyApIHtcbiAgICBjb25zdCB0NSA9IG4yLnVpbnQzMigpO1xuICAgIGlmICh0NSA+Pj4gMyA9PSAxKSBpMi5vcHMucHVzaChQcm9vZk9wLmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICBlbHNlIG4yLnNraXBUeXBlKDcgJiB0NSk7XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046ICh0NSkgPT4gKHsgb3BzOiBBcnJheS5pc0FycmF5KHQ1Py5vcHMpID8gdDUub3BzLm1hcCgodDYpID0+IFByb29mT3AuZnJvbUpTT04odDYpKSA6IFtdIH0pLCB0b0pTT04odDUpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHQ1Lm9wcyA/IG8yLm9wcyA9IHQ1Lm9wcy5tYXAoKHQ2KSA9PiB0NiA/IFByb29mT3AudG9KU09OKHQ2KSA6IHZvaWQgMCkgOiBvMi5vcHMgPSBbXSwgbzI7XG59LCBmcm9tUGFydGlhbCh0NSkge1xuICBjb25zdCBvMiA9IHsgb3BzOiBbXSB9O1xuICByZXR1cm4gbzIub3BzID0gdDUub3BzPy5tYXAoKHQ2KSA9PiBQcm9vZk9wLmZyb21QYXJ0aWFsKHQ2KSkgfHwgW10sIG8yO1xufSwgZnJvbVByb3RvTXNnOiAodDUpID0+IFByb29mT3BzLmRlY29kZSh0NS52YWx1ZSksIHRvUHJvdG86ICh0NSkgPT4gUHJvb2ZPcHMuZW5jb2RlKHQ1KS5maW5pc2goKSwgdG9Qcm90b01zZzogKHQ1KSA9PiAoeyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmNyeXB0by5Qcm9vZk9wc1wiLCB2YWx1ZTogUHJvb2ZPcHMuZW5jb2RlKHQ1KS5maW5pc2goKSB9KSB9O1xuXG4vL1xuZnVuY3Rpb24gdDIoKSB7XG4gIHJldHVybiB7IHNlY29uZHM6IEJpZ0ludCgwKSwgbmFub3M6IDAgfTtcbn1cbnZhciBUaW1lc3RhbXAgPSB7IHR5cGVVcmw6IFwiL2dvb2dsZS5wcm90b2J1Zi5UaW1lc3RhbXBcIiwgZW5jb2RlOiAobjIsIHMzID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAobjIuc2Vjb25kcyAhPT0gQmlnSW50KDApICYmIHMzLnVpbnQzMig4KS5pbnQ2NChuMi5zZWNvbmRzKSwgMCAhPT0gbjIubmFub3MgJiYgczMudWludDMyKDE2KS5pbnQzMihuMi5uYW5vcyksIHMzKSwgZGVjb2RlKG8yLCBzMykge1xuICBjb25zdCBlMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBzMyA/IGUyLmxlbiA6IGUyLnBvcyArIHMzO1xuICBjb25zdCByNSA9IHQyKCk7XG4gIGZvciAoOyBlMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgbjIgPSBlMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG4yID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LnNlY29uZHMgPSBlMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUubmFub3MgPSBlMi5pbnQzMigpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGUyLnNraXBUeXBlKDcgJiBuMik7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAobjIpID0+ICh7IHNlY29uZHM6IGlzU2V0KG4yLnNlY29uZHMpID8gQmlnSW50KG4yLnNlY29uZHMudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG5hbm9zOiBpc1NldChuMi5uYW5vcykgPyBOdW1iZXIobjIubmFub3MpIDogMCB9KSwgdG9KU09OKG4yKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG4yLnNlY29uZHMgJiYgKG8yLnNlY29uZHMgPSAobjIuc2Vjb25kcyB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IG4yLm5hbm9zICYmIChvMi5uYW5vcyA9IE1hdGgucm91bmQobjIubmFub3MpKSwgbzI7XG59LCBmcm9tUGFydGlhbChuMikge1xuICBjb25zdCBvMiA9IHQyKCk7XG4gIHJldHVybiBvMi5zZWNvbmRzID0gdm9pZCAwICE9PSBuMi5zZWNvbmRzICYmIG51bGwgIT09IG4yLnNlY29uZHMgPyBCaWdJbnQobjIuc2Vjb25kcy50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbzIubmFub3MgPSBuMi5uYW5vcyA/PyAwLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKG4yKSA9PiBUaW1lc3RhbXAuZGVjb2RlKG4yLnZhbHVlKSwgdG9Qcm90bzogKG4yKSA9PiBUaW1lc3RhbXAuZW5jb2RlKG4yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG4yKSA9PiAoeyB0eXBlVXJsOiBcIi9nb29nbGUucHJvdG9idWYuVGltZXN0YW1wXCIsIHZhbHVlOiBUaW1lc3RhbXAuZW5jb2RlKG4yKS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIEJsb2NrSURGbGFnO1xuIWZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLkJMT0NLX0lEX0ZMQUdfVU5LTk9XTiA9IDBdID0gXCJCTE9DS19JRF9GTEFHX1VOS05PV05cIiwgZTJbZTIuQkxPQ0tfSURfRkxBR19BQlNFTlQgPSAxXSA9IFwiQkxPQ0tfSURfRkxBR19BQlNFTlRcIiwgZTJbZTIuQkxPQ0tfSURfRkxBR19DT01NSVQgPSAyXSA9IFwiQkxPQ0tfSURfRkxBR19DT01NSVRcIiwgZTJbZTIuQkxPQ0tfSURfRkxBR19OSUwgPSAzXSA9IFwiQkxPQ0tfSURfRkxBR19OSUxcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0oQmxvY2tJREZsYWcgfHwgKEJsb2NrSURGbGFnID0ge30pKTtcbnZhciBTaWduZWRNc2dUeXBlO1xuIWZ1bmN0aW9uKGUyKSB7XG4gIGUyW2UyLlNJR05FRF9NU0dfVFlQRV9VTktOT1dOID0gMF0gPSBcIlNJR05FRF9NU0dfVFlQRV9VTktOT1dOXCIsIGUyW2UyLlNJR05FRF9NU0dfVFlQRV9QUkVWT1RFID0gMV0gPSBcIlNJR05FRF9NU0dfVFlQRV9QUkVWT1RFXCIsIGUyW2UyLlNJR05FRF9NU0dfVFlQRV9QUkVDT01NSVQgPSAyXSA9IFwiU0lHTkVEX01TR19UWVBFX1BSRUNPTU1JVFwiLCBlMltlMi5TSUdORURfTVNHX1RZUEVfUFJPUE9TQUwgPSAzMl0gPSBcIlNJR05FRF9NU0dfVFlQRV9QUk9QT1NBTFwiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShTaWduZWRNc2dUeXBlIHx8IChTaWduZWRNc2dUeXBlID0ge30pKTtcblxuLy9cbnZhciBDaGVja1R4VHlwZTtcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5ORVcgPSAwXSA9IFwiTkVXXCIsIGUyW2UyLlJFQ0hFQ0sgPSAxXSA9IFwiUkVDSEVDS1wiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShDaGVja1R4VHlwZSB8fCAoQ2hlY2tUeFR5cGUgPSB7fSkpO1xudmFyIEV2aWRlbmNlVHlwZTtcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5VTktOT1dOID0gMF0gPSBcIlVOS05PV05cIiwgZTJbZTIuRFVQTElDQVRFX1ZPVEUgPSAxXSA9IFwiRFVQTElDQVRFX1ZPVEVcIiwgZTJbZTIuTElHSFRfQ0xJRU5UX0FUVEFDSyA9IDJdID0gXCJMSUdIVF9DTElFTlRfQVRUQUNLXCIsIGUyW2UyLlVOUkVDT0dOSVpFRCA9IC0xXSA9IFwiVU5SRUNPR05JWkVEXCI7XG59KEV2aWRlbmNlVHlwZSB8fCAoRXZpZGVuY2VUeXBlID0ge30pKTtcbmZ1bmN0aW9uIHAoKSB7XG4gIHJldHVybiB7IGRhdGE6IG5ldyBVaW50OEFycmF5KCksIHBhdGg6IFwiXCIsIGhlaWdodDogQmlnSW50KDApLCBwcm92ZTogZmFsc2UgfTtcbn1cbnZhciBSZXF1ZXN0UXVlcnkgPSB7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuYWJjaS5SZXF1ZXN0UXVlcnlcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoMCAhPT0gZTIuZGF0YS5sZW5ndGggJiYgdDUudWludDMyKDEwKS5ieXRlcyhlMi5kYXRhKSwgXCJcIiAhPT0gZTIucGF0aCAmJiB0NS51aW50MzIoMTgpLnN0cmluZyhlMi5wYXRoKSwgZTIuaGVpZ2h0ICE9PSBCaWdJbnQoMCkgJiYgdDUudWludDMyKDI0KS5pbnQ2NChlMi5oZWlnaHQpLCB0cnVlID09PSBlMi5wcm92ZSAmJiB0NS51aW50MzIoMzIpLmJvb2woZTIucHJvdmUpLCB0NSksIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbzIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBuMiA9IHZvaWQgMCA9PT0gdDUgPyBvMi5sZW4gOiBvMi5wb3MgKyB0NTtcbiAgY29uc3QgaTIgPSBwKCk7XG4gIGZvciAoOyBvMi5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTMgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRhdGEgPSBvMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIucGF0aCA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgaTIuaGVpZ2h0ID0gbzIuaW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGkyLnByb3ZlID0gbzIuYm9vbCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRhdGE6IGlzU2V0KGUyLmRhdGEpID8gYnl0ZXNGcm9tQmFzZTY0KGUyLmRhdGEpIDogbmV3IFVpbnQ4QXJyYXkoKSwgcGF0aDogaXNTZXQoZTIucGF0aCkgPyBTdHJpbmcoZTIucGF0aCkgOiBcIlwiLCBoZWlnaHQ6IGlzU2V0KGUyLmhlaWdodCkgPyBCaWdJbnQoZTIuaGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBwcm92ZTogISFpc1NldChlMi5wcm92ZSkgJiYgQm9vbGVhbihlMi5wcm92ZSkgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kYXRhICYmICh0NS5kYXRhID0gYmFzZTY0RnJvbUJ5dGVzKHZvaWQgMCAhPT0gZTIuZGF0YSA/IGUyLmRhdGEgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gZTIucGF0aCAmJiAodDUucGF0aCA9IGUyLnBhdGgpLCB2b2lkIDAgIT09IGUyLmhlaWdodCAmJiAodDUuaGVpZ2h0ID0gKGUyLmhlaWdodCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLnByb3ZlICYmICh0NS5wcm92ZSA9IGUyLnByb3ZlKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHAoKTtcbiAgcmV0dXJuIHQ1LmRhdGEgPSBlMi5kYXRhID8/IG5ldyBVaW50OEFycmF5KCksIHQ1LnBhdGggPSBlMi5wYXRoID8/IFwiXCIsIHQ1LmhlaWdodCA9IHZvaWQgMCAhPT0gZTIuaGVpZ2h0ICYmIG51bGwgIT09IGUyLmhlaWdodCA/IEJpZ0ludChlMi5oZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIHQ1LnByb3ZlID0gZTIucHJvdmUgPz8gZmFsc2UsIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFJlcXVlc3RRdWVyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlcXVlc3RRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL3RlbmRlcm1pbnQuYWJjaS5SZXF1ZXN0UXVlcnlcIiwgdmFsdWU6IFJlcXVlc3RRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBtKCkge1xuICByZXR1cm4geyBjb2RlOiAwLCBsb2c6IFwiXCIsIGluZm86IFwiXCIsIGluZGV4OiBCaWdJbnQoMCksIGtleTogbmV3IFVpbnQ4QXJyYXkoKSwgdmFsdWU6IG5ldyBVaW50OEFycmF5KCksIHByb29mT3BzOiB2b2lkIDAsIGhlaWdodDogQmlnSW50KDApLCBjb2Rlc3BhY2U6IFwiXCIgfTtcbn1cbnZhciBSZXNwb25zZVF1ZXJ5ID0geyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmFiY2kuUmVzcG9uc2VRdWVyeVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICgwICE9PSBlMi5jb2RlICYmIG8yLnVpbnQzMig4KS51aW50MzIoZTIuY29kZSksIFwiXCIgIT09IGUyLmxvZyAmJiBvMi51aW50MzIoMjYpLnN0cmluZyhlMi5sb2cpLCBcIlwiICE9PSBlMi5pbmZvICYmIG8yLnVpbnQzMigzNCkuc3RyaW5nKGUyLmluZm8pLCBlMi5pbmRleCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMig0MCkuaW50NjQoZTIuaW5kZXgpLCAwICE9PSBlMi5rZXkubGVuZ3RoICYmIG8yLnVpbnQzMig1MCkuYnl0ZXMoZTIua2V5KSwgMCAhPT0gZTIudmFsdWUubGVuZ3RoICYmIG8yLnVpbnQzMig1OCkuYnl0ZXMoZTIudmFsdWUpLCB2b2lkIDAgIT09IGUyLnByb29mT3BzICYmIFByb29mT3BzLmVuY29kZShlMi5wcm9vZk9wcywgbzIudWludDMyKDY2KS5mb3JrKCkpLmxkZWxpbSgpLCBlMi5oZWlnaHQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoNzIpLmludDY0KGUyLmhlaWdodCksIFwiXCIgIT09IGUyLmNvZGVzcGFjZSAmJiBvMi51aW50MzIoODIpLnN0cmluZyhlMi5jb2Rlc3BhY2UpLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgbjIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gbzIgPyBuMi5sZW4gOiBuMi5wb3MgKyBvMjtcbiAgY29uc3QgYTIgPSBtKCk7XG4gIGZvciAoOyBuMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGEyLmNvZGUgPSBuMi51aW50MzIoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGEyLmxvZyA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgYTIuaW5mbyA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgYTIuaW5kZXggPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNjpcbiAgICAgICAgYTIua2V5ID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDc6XG4gICAgICAgIGEyLnZhbHVlID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDg6XG4gICAgICAgIGEyLnByb29mT3BzID0gUHJvb2ZPcHMuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA5OlxuICAgICAgICBhMi5oZWlnaHQgPSBuMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMTA6XG4gICAgICAgIGEyLmNvZGVzcGFjZSA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGNvZGU6IGlzU2V0KGUyLmNvZGUpID8gTnVtYmVyKGUyLmNvZGUpIDogMCwgbG9nOiBpc1NldChlMi5sb2cpID8gU3RyaW5nKGUyLmxvZykgOiBcIlwiLCBpbmZvOiBpc1NldChlMi5pbmZvKSA/IFN0cmluZyhlMi5pbmZvKSA6IFwiXCIsIGluZGV4OiBpc1NldChlMi5pbmRleCkgPyBCaWdJbnQoZTIuaW5kZXgudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGtleTogaXNTZXQoZTIua2V5KSA/IGJ5dGVzRnJvbUJhc2U2NChlMi5rZXkpIDogbmV3IFVpbnQ4QXJyYXkoKSwgdmFsdWU6IGlzU2V0KGUyLnZhbHVlKSA/IGJ5dGVzRnJvbUJhc2U2NChlMi52YWx1ZSkgOiBuZXcgVWludDhBcnJheSgpLCBwcm9vZk9wczogaXNTZXQoZTIucHJvb2ZPcHMpID8gUHJvb2ZPcHMuZnJvbUpTT04oZTIucHJvb2ZPcHMpIDogdm9pZCAwLCBoZWlnaHQ6IGlzU2V0KGUyLmhlaWdodCkgPyBCaWdJbnQoZTIuaGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBjb2Rlc3BhY2U6IGlzU2V0KGUyLmNvZGVzcGFjZSkgPyBTdHJpbmcoZTIuY29kZXNwYWNlKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5jb2RlICYmIChvMi5jb2RlID0gTWF0aC5yb3VuZChlMi5jb2RlKSksIHZvaWQgMCAhPT0gZTIubG9nICYmIChvMi5sb2cgPSBlMi5sb2cpLCB2b2lkIDAgIT09IGUyLmluZm8gJiYgKG8yLmluZm8gPSBlMi5pbmZvKSwgdm9pZCAwICE9PSBlMi5pbmRleCAmJiAobzIuaW5kZXggPSAoZTIuaW5kZXggfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSBlMi5rZXkgJiYgKG8yLmtleSA9IGJhc2U2NEZyb21CeXRlcyh2b2lkIDAgIT09IGUyLmtleSA/IGUyLmtleSA6IG5ldyBVaW50OEFycmF5KCkpKSwgdm9pZCAwICE9PSBlMi52YWx1ZSAmJiAobzIudmFsdWUgPSBiYXNlNjRGcm9tQnl0ZXModm9pZCAwICE9PSBlMi52YWx1ZSA/IGUyLnZhbHVlIDogbmV3IFVpbnQ4QXJyYXkoKSkpLCB2b2lkIDAgIT09IGUyLnByb29mT3BzICYmIChvMi5wcm9vZk9wcyA9IGUyLnByb29mT3BzID8gUHJvb2ZPcHMudG9KU09OKGUyLnByb29mT3BzKSA6IHZvaWQgMCksIHZvaWQgMCAhPT0gZTIuaGVpZ2h0ICYmIChvMi5oZWlnaHQgPSAoZTIuaGVpZ2h0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuY29kZXNwYWNlICYmIChvMi5jb2Rlc3BhY2UgPSBlMi5jb2Rlc3BhY2UpLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0gbSgpO1xuICByZXR1cm4gbzIuY29kZSA9IGUyLmNvZGUgPz8gMCwgbzIubG9nID0gZTIubG9nID8/IFwiXCIsIG8yLmluZm8gPSBlMi5pbmZvID8/IFwiXCIsIG8yLmluZGV4ID0gdm9pZCAwICE9PSBlMi5pbmRleCAmJiBudWxsICE9PSBlMi5pbmRleCA/IEJpZ0ludChlMi5pbmRleC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbzIua2V5ID0gZTIua2V5ID8/IG5ldyBVaW50OEFycmF5KCksIG8yLnZhbHVlID0gZTIudmFsdWUgPz8gbmV3IFVpbnQ4QXJyYXkoKSwgbzIucHJvb2ZPcHMgPSB2b2lkIDAgIT09IGUyLnByb29mT3BzICYmIG51bGwgIT09IGUyLnByb29mT3BzID8gUHJvb2ZPcHMuZnJvbVBhcnRpYWwoZTIucHJvb2ZPcHMpIDogdm9pZCAwLCBvMi5oZWlnaHQgPSB2b2lkIDAgIT09IGUyLmhlaWdodCAmJiBudWxsICE9PSBlMi5oZWlnaHQgPyBCaWdJbnQoZTIuaGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBvMi5jb2Rlc3BhY2UgPSBlMi5jb2Rlc3BhY2UgPz8gXCJcIiwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUmVzcG9uc2VRdWVyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFJlc3BvbnNlUXVlcnkuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi90ZW5kZXJtaW50LmFiY2kuUmVzcG9uc2VRdWVyeVwiLCB2YWx1ZTogUmVzcG9uc2VRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgQ29zbW9zUXVlcnkgPSB7IHR5cGVVcmw6IFwiL2ljcS52MS5Db3Ntb3NRdWVyeVwiLCBlbmNvZGUobzIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgcjUgb2YgbzIucmVxdWVzdHMpIFJlcXVlc3RRdWVyeS5lbmNvZGUocjUsIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHQ1O1xufSwgZGVjb2RlKG8yLCByNSkge1xuICBjb25zdCBzMyA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSByNSA/IHMzLmxlbiA6IHMzLnBvcyArIHI1O1xuICBjb25zdCBhMiA9IHsgcmVxdWVzdHM6IFtdIH07XG4gIGZvciAoOyBzMy5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgbzMgPSBzMy51aW50MzIoKTtcbiAgICBpZiAobzMgPj4+IDMgPT0gMSkgYTIucmVxdWVzdHMucHVzaChSZXF1ZXN0UXVlcnkuZGVjb2RlKHMzLCBzMy51aW50MzIoKSkpO1xuICAgIGVsc2UgczMuc2tpcFR5cGUoNyAmIG8zKTtcbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyByZXF1ZXN0czogQXJyYXkuaXNBcnJheShvMj8ucmVxdWVzdHMpID8gbzIucmVxdWVzdHMubWFwKChvMykgPT4gUmVxdWVzdFF1ZXJ5LmZyb21KU09OKG8zKSkgOiBbXSB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiBvMi5yZXF1ZXN0cyA/IHQ1LnJlcXVlc3RzID0gbzIucmVxdWVzdHMubWFwKChvMykgPT4gbzMgPyBSZXF1ZXN0UXVlcnkudG9KU09OKG8zKSA6IHZvaWQgMCkgOiB0NS5yZXF1ZXN0cyA9IFtdLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyByZXF1ZXN0czogW10gfTtcbiAgcmV0dXJuIHQ1LnJlcXVlc3RzID0gbzIucmVxdWVzdHM/Lm1hcCgobzMpID0+IFJlcXVlc3RRdWVyeS5mcm9tUGFydGlhbChvMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBDb3Ntb3NRdWVyeS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IENvc21vc1F1ZXJ5LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvaWNxLnYxLkNvc21vc1F1ZXJ5XCIsIHZhbHVlOiBDb3Ntb3NRdWVyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgQ29zbW9zUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2ljcS52MS5Db3Ntb3NSZXNwb25zZVwiLCBlbmNvZGUoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgcjUgb2YgZTIucmVzcG9uc2VzKSBSZXNwb25zZVF1ZXJ5LmVuY29kZShyNSwgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdDU7XG59LCBkZWNvZGUoZTIsIHI1KSB7XG4gIGNvbnN0IHMzID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IHI1ID8gczMubGVuIDogczMucG9zICsgcjU7XG4gIGNvbnN0IGEyID0geyByZXNwb25zZXM6IFtdIH07XG4gIGZvciAoOyBzMy5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgZTMgPSBzMy51aW50MzIoKTtcbiAgICBpZiAoZTMgPj4+IDMgPT0gMSkgYTIucmVzcG9uc2VzLnB1c2goUmVzcG9uc2VRdWVyeS5kZWNvZGUoczMsIHMzLnVpbnQzMigpKSk7XG4gICAgZWxzZSBzMy5za2lwVHlwZSg3ICYgZTMpO1xuICB9XG4gIHJldHVybiBhMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IHJlc3BvbnNlczogQXJyYXkuaXNBcnJheShlMj8ucmVzcG9uc2VzKSA/IGUyLnJlc3BvbnNlcy5tYXAoKGUzKSA9PiBSZXNwb25zZVF1ZXJ5LmZyb21KU09OKGUzKSkgOiBbXSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiBlMi5yZXNwb25zZXMgPyB0NS5yZXNwb25zZXMgPSBlMi5yZXNwb25zZXMubWFwKChlMykgPT4gZTMgPyBSZXNwb25zZVF1ZXJ5LnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUucmVzcG9uc2VzID0gW10sIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSB7IHJlc3BvbnNlczogW10gfTtcbiAgcmV0dXJuIHQ1LnJlc3BvbnNlcyA9IGUyLnJlc3BvbnNlcz8ubWFwKChlMykgPT4gUmVzcG9uc2VRdWVyeS5mcm9tUGFydGlhbChlMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBDb3Ntb3NSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IENvc21vc1Jlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvaWNxLnYxLkNvc21vc1Jlc3BvbnNlXCIsIHZhbHVlOiBDb3Ntb3NSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgVHlwZTtcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5UWVBFX1VOU1BFQ0lGSUVEID0gMF0gPSBcIlRZUEVfVU5TUEVDSUZJRURcIiwgZTJbZTIuVFlQRV9FWEVDVVRFX1RYID0gMV0gPSBcIlRZUEVfRVhFQ1VURV9UWFwiLCBlMltlMi5VTlJFQ09HTklaRUQgPSAtMV0gPSBcIlVOUkVDT0dOSVpFRFwiO1xufShUeXBlIHx8IChUeXBlID0ge30pKTtcblxuLy9cbmZ1bmN0aW9uIG1ha2VUeFBhY2tldChtc2dzLCBvcHRzKSB7XG4gIGNvbnN0IG1lc3NhZ2VzID0gbXNncy5tYXAoQW55LmZyb21KU09OKTtcbiAgY29uc3QgYnl0ZXMgPSBUeEJvZHkuZW5jb2RlKFxuICAgIFR4Qm9keS5mcm9tUGFydGlhbCh7XG4gICAgICBtZXNzYWdlcyxcbiAgICAgIC4uLm9wdHNcbiAgICB9KVxuICApLmZpbmlzaCgpO1xuICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHtcbiAgICAgIHR5cGU6IFR5cGUuVFlQRV9FWEVDVVRFX1RYLFxuICAgICAgZGF0YTogZW5jb2RlQmFzZTY0KGJ5dGVzKSxcbiAgICAgIG1lbW86IFwiXCJcbiAgICB9XG4gICk7XG59XG5oYXJkZW4obWFrZVR4UGFja2V0KTtcbmZ1bmN0aW9uIG1ha2VRdWVyeVBhY2tldChtc2dzKSB7XG4gIGNvbnN0IGJ5dGVzID0gQ29zbW9zUXVlcnkuZW5jb2RlKFxuICAgIENvc21vc1F1ZXJ5LmZyb21QYXJ0aWFsKHtcbiAgICAgIHJlcXVlc3RzOiBtc2dzLm1hcChSZXF1ZXN0UXVlcnkuZnJvbUpTT04pXG4gICAgfSlcbiAgKS5maW5pc2goKTtcbiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAge1xuICAgICAgZGF0YTogZW5jb2RlQmFzZTY0KGJ5dGVzKSxcbiAgICAgIG1lbW86IFwiXCJcbiAgICB9XG4gICk7XG59XG5oYXJkZW4obWFrZVF1ZXJ5UGFja2V0KTtcbmZ1bmN0aW9uIHBhcnNlVHhQYWNrZXQocmVzcG9uc2UpIHtcbiAgY29uc3QgeyByZXN1bHQsIGVycm9yIH0gPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcbiAgaWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDtcbiAgZWxzZSBpZiAoZXJyb3IpIHRocm93IEVycm9yKGVycm9yKTtcbiAgZWxzZSB0aHJvdyB0aHJvd1JlZGFjdGVkYGV4cGVjdGVkIGVpdGhlciByZXN1bHQgb3IgZXJyb3I6ICR7cmVzcG9uc2V9YDtcbn1cbmhhcmRlbihwYXJzZVR4UGFja2V0KTtcbmZ1bmN0aW9uIHBhcnNlUXVlcnlQYWNrZXQocmVzcG9uc2UpIHtcbiAgY29uc3QgcmVzdWx0ID0gcGFyc2VUeFBhY2tldChyZXNwb25zZSk7XG4gIGNvbnN0IHsgZGF0YSB9ID0gSlNPTi5wYXJzZShhdG9iKHJlc3VsdCkpO1xuICBjb25zdCB7IHJlc3BvbnNlcyA9IFtdIH0gPSBDb3Ntb3NSZXNwb25zZS5kZWNvZGUoZGVjb2RlQmFzZTY0KGRhdGEpKTtcbiAgcmV0dXJuIGhhcmRlbihyZXNwb25zZXMubWFwKFJlc3BvbnNlUXVlcnkudG9KU09OKSk7XG59XG5oYXJkZW4ocGFyc2VRdWVyeVBhY2tldCk7XG5cbi8vXG52YXIgdHJhY2UgPSBtYWtlVHJhY2VyKFwiSWNhQWNjb3VudEtpdFwiKTtcbnZhciBVTlBBUlNBQkxFX0NIQUlOX0FERFJFU1MgPSBcIlVOUEFSU0FCTEVfQ0hBSU5fQUREUkVTU1wiO1xudmFyIEljYUFjY291bnRJID0gTS5pbnRlcmZhY2UoXCJJY2FBY2NvdW50XCIsIHtcbiAgZ2V0QWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSksXG4gIGdldExvY2FsQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgZ2V0UmVtb3RlQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgZ2V0UG9ydDogTS5jYWxsKCkucmV0dXJucyhNLnJlbW90YWJsZShcIlBvcnRcIikpLFxuICBleGVjdXRlVHg6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoVm93U2hhcGUpLFxuICBleGVjdXRlRW5jb2RlZFR4OiBNLmNhbGwoTS5hcnJheU9mKFByb3RvM1NoYXBlKSkub3B0aW9uYWwoVHhCb2R5T3B0c1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZGVhY3RpdmF0ZTogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIHJlYWN0aXZhdGU6IE0uY2FsbCgpLnJldHVybnMoVm93U2hhcGUpXG59KTtcbnZhciBwcmVwYXJlSWNhQWNjb3VudEtpdCA9ICh6b25lLCB7IHdhdGNoLCBhc1ZvdyB9KSA9PiB6b25lLmV4b0NsYXNzS2l0KFxuICBcIkljYUFjY291bnRLaXRcIixcbiAge1xuICAgIGFjY291bnQ6IEljYUFjY291bnRJLFxuICAgIGNvbm5lY3Rpb25IYW5kbGVyOiBPdXRib3VuZENvbm5lY3Rpb25IYW5kbGVySSxcbiAgICBwYXJzZVR4UGFja2V0V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJQYXJzZVR4UGFja2V0V2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhNLnN0cmluZygpKVxuICAgIH0pXG4gIH0sXG4gIC8qXG5cblxuXG4gICAqL1xuICAoY2hhaW5JZCwgcG9ydCwgcmVxdWVzdGVkUmVtb3RlQWRkcmVzcykgPT4gKFxuICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAge1xuICAgICAgY2hhaW5JZCxcbiAgICAgIHBvcnQsXG4gICAgICBjb25uZWN0aW9uOiB2b2lkIDAsXG4gICAgICByZXF1ZXN0ZWRSZW1vdGVBZGRyZXNzLFxuICAgICAgcmVtb3RlQWRkcmVzczogdm9pZCAwLFxuICAgICAgY2hhaW5BZGRyZXNzOiB2b2lkIDAsXG4gICAgICBsb2NhbEFkZHJlc3M6IHZvaWQgMCxcbiAgICAgIGlzSW5pdGlhdGluZ0Nsb3NlOiBmYWxzZVxuICAgIH1cbiAgKSxcbiAge1xuICAgIHBhcnNlVHhQYWNrZXRXYXRjaGVyOiB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQoYWNrKSB7XG4gICAgICAgIHJldHVybiBwYXJzZVR4UGFja2V0KGFjayk7XG4gICAgICB9XG4gICAgfSxcbiAgICBhY2NvdW50OiB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGdldEFkZHJlc3MoKSB7XG4gICAgICAgIHJldHVybiBOb25OdWxsaXNoKFxuICAgICAgICAgIHRoaXMuc3RhdGUuY2hhaW5BZGRyZXNzLFxuICAgICAgICAgIFwiSUNBIGNoYW5uZWwgY3JlYXRpb24gYWNrbm93bGVkZ2VtZW50IG5vdCB5ZXQgcmVjZWl2ZWQuXCJcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBnZXRMb2NhbEFkZHJlc3MoKSB7XG4gICAgICAgIHJldHVybiBOb25OdWxsaXNoKFxuICAgICAgICAgIHRoaXMuc3RhdGUubG9jYWxBZGRyZXNzLFxuICAgICAgICAgIFwibG9jYWwgYWRkcmVzcyBub3QgYXZhaWxhYmxlXCJcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBnZXRSZW1vdGVBZGRyZXNzKCkge1xuICAgICAgICByZXR1cm4gTm9uTnVsbGlzaChcbiAgICAgICAgICB0aGlzLnN0YXRlLnJlbW90ZUFkZHJlc3MsXG4gICAgICAgICAgXCJyZW1vdGUgYWRkcmVzcyBub3QgYXZhaWxhYmxlXCJcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBnZXRQb3J0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5wb3J0O1xuICAgICAgfSxcbiAgICAgIGV4ZWN1dGVUeCgpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHRocm93UmVkYWN0ZWRgbm90IHlldCBpbXBsZW1lbnRlZGApO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBleGVjdXRlRW5jb2RlZFR4KG1zZ3MsIG9wdHMpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBjb25zdCB7IGNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKCFjb25uZWN0aW9uKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYEFjY291bnQgbm90IGF2YWlsYWJsZSBvciBkZWFjdGl2YXRlZC5gO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKGNvbm5lY3Rpb24pLnNlbmQobWFrZVR4UGFja2V0KG1zZ3MsIG9wdHMpKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnBhcnNlVHhQYWNrZXRXYXRjaGVyXG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIGRlYWN0aXZhdGUoKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyBjb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICghY29ubmVjdGlvbikgdGhyb3cgdGhyb3dSZWRhY3RlZGBBY2NvdW50IG5vdCBhdmFpbGFibGUgb3IgZGVhY3RpdmF0ZWQuYDtcbiAgICAgICAgICB0aGlzLnN0YXRlLmlzSW5pdGlhdGluZ0Nsb3NlID0gdHJ1ZTtcbiAgICAgICAgICByZXR1cm4gRShjb25uZWN0aW9uKS5jbG9zZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgcmVhY3RpdmF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBjb25zdCB7IGNvbm5lY3Rpb24sIHBvcnQsIHJlcXVlc3RlZFJlbW90ZUFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKGNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgQWNjb3VudCBpcyBhbHJlYWR5IGFjdGl2ZS5gO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKHBvcnQpLmNvbm5lY3QoXG4gICAgICAgICAgICAgIHJlcXVlc3RlZFJlbW90ZUFkZHJlc3MsXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmNvbm5lY3Rpb25IYW5kbGVyXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBjb25uZWN0aW9uSGFuZGxlcjoge1xuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgYXN5bmMgb25PcGVuKGNvbm5lY3Rpb24sIGxvY2FsQWRkciwgcmVtb3RlQWRkcikge1xuICAgICAgICB0cmFjZShgSUNBIENoYW5uZWwgT3BlbmVkIGZvciAke2xvY2FsQWRkcn0gYXQgJHtyZW1vdGVBZGRyfWApO1xuICAgICAgICB0aGlzLnN0YXRlLmNvbm5lY3Rpb24gPSBjb25uZWN0aW9uO1xuICAgICAgICB0aGlzLnN0YXRlLnJlbW90ZUFkZHJlc3MgPSByZW1vdGVBZGRyO1xuICAgICAgICB0aGlzLnN0YXRlLmxvY2FsQWRkcmVzcyA9IGxvY2FsQWRkcjtcbiAgICAgICAgY29uc3QgYWRkcmVzcyA9IGZpbmRBZGRyZXNzRmllbGQocmVtb3RlQWRkcik7XG4gICAgICAgIGlmICghYWRkcmVzcykge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJcXHUyNkEwXFx1RkUwRiBmYWlsZWQgdG8gcGFyc2UgY2hhaW4gYWRkcmVzc1wiLCByZW1vdGVBZGRyKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnN0YXRlLmNoYWluQWRkcmVzcyA9IGhhcmRlbih7XG4gICAgICAgICAgdmFsdWU6IGFkZHJlc3MgfHwgVU5QQVJTQUJMRV9DSEFJTl9BRERSRVNTLFxuICAgICAgICAgIGNoYWluSWQ6IHRoaXMuc3RhdGUuY2hhaW5JZCxcbiAgICAgICAgICBlbmNvZGluZzogXCJiZWNoMzJcIlxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBhc3luYyBvbkNsb3NlKF9jb25uZWN0aW9uLCByZWFzb24pIHtcbiAgICAgICAgdHJhY2UoYElDQSBDaGFubmVsIGNsb3NlZC4gUmVhc29uOiAke3JlYXNvbn1gKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5jb25uZWN0aW9uID0gdm9pZCAwO1xuICAgICAgICB0aGlzLnN0YXRlLmxvY2FsQWRkcmVzcyA9IHZvaWQgMDtcbiAgICAgICAgdGhpcy5zdGF0ZS5yZW1vdGVBZGRyZXNzID0gdm9pZCAwO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5pc0luaXRpYXRpbmdDbG9zZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHRyYWNlKFwiQWNjb3VudCBkZWFjdGl2YXRlZCBieSBob2xkZXIuIFNraXBwaW5nIHJlYWN0aXZhdGlvbi5cIik7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5pc0luaXRpYXRpbmdDbG9zZSA9IGZhbHNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRyYWNlKFwiQWNjb3VudCBjbG9zZWQgdW5leHBlY3RlZGx5LiBBdXRvbWF0aWNhbGx5IHJlYWN0aXZhdGluZy5cIik7XG4gICAgICAgICAgdm9pZCB3YXRjaCh0aGlzLmZhY2V0cy5hY2NvdW50LnJlYWN0aXZhdGUoKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG5cbi8vXG52YXIgdHJhY2UyID0gbWFrZVRyYWNlcihcIk9yY2hlc3RyYXRpb246SUNRQ29ubmVjdGlvblwiKTtcbnZhciBJQ1FDb25uZWN0aW9uSSA9IE0uaW50ZXJmYWNlKFwiSUNRQ29ubmVjdGlvblwiLCB7XG4gIGdldExvY2FsQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgZ2V0UmVtb3RlQWRkcmVzczogTS5jYWxsKCkucmV0dXJucyhNLnN0cmluZygpKSxcbiAgcXVlcnk6IE0uY2FsbChNLmFycmF5T2YoSUNRTXNnU2hhcGUpKS5yZXR1cm5zKFZvd1NoYXBlKVxufSk7XG52YXIgcHJlcGFyZUlDUUNvbm5lY3Rpb25LaXQgPSAoem9uZSwgeyB3YXRjaCwgYXNWb3cgfSkgPT4gem9uZS5leG9DbGFzc0tpdChcbiAgXCJJQ1FDb25uZWN0aW9uS2l0XCIsXG4gIHtcbiAgICBjb25uZWN0aW9uOiBJQ1FDb25uZWN0aW9uSSxcbiAgICBjb25uZWN0aW9uSGFuZGxlcjogT3V0Ym91bmRDb25uZWN0aW9uSGFuZGxlckksXG4gICAgcGFyc2VRdWVyeVBhY2tldFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiUGFyc2VRdWVyeVBhY2tldFdhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnN0cmluZygpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS5hcnJheU9mKE0ucmVjb3JkKCkpKVxuICAgIH0pXG4gIH0sXG4gIC8qICAgICAgICAgICAgICAgICAgICAgKi9cbiAgKHBvcnQpID0+IChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICB7XG4gICAgICBwb3J0LFxuICAgICAgY29ubmVjdGlvbjogdm9pZCAwLFxuICAgICAgcmVtb3RlQWRkcmVzczogdm9pZCAwLFxuICAgICAgbG9jYWxBZGRyZXNzOiB2b2lkIDBcbiAgICB9XG4gICksXG4gIHtcbiAgICBjb25uZWN0aW9uOiB7XG4gICAgICBnZXRMb2NhbEFkZHJlc3MoKSB7XG4gICAgICAgIHJldHVybiBOb25OdWxsaXNoKFxuICAgICAgICAgIHRoaXMuc3RhdGUubG9jYWxBZGRyZXNzLFxuICAgICAgICAgIFwibG9jYWwgYWRkcmVzcyBub3QgYXZhaWxhYmxlXCJcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICBnZXRSZW1vdGVBZGRyZXNzKCkge1xuICAgICAgICByZXR1cm4gTm9uTnVsbGlzaChcbiAgICAgICAgICB0aGlzLnN0YXRlLnJlbW90ZUFkZHJlc3MsXG4gICAgICAgICAgXCJyZW1vdGUgYWRkcmVzcyBub3QgYXZhaWxhYmxlXCJcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHF1ZXJ5KG1zZ3MpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBjb25zdCB7IGNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgaWYgKCFjb25uZWN0aW9uKSB0aHJvdyB0aHJvd1JlZGFjdGVkYGNvbm5lY3Rpb24gbm90IGF2YWlsYWJsZWA7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgRShjb25uZWN0aW9uKS5zZW5kKG1ha2VRdWVyeVBhY2tldChtc2dzKSksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5wYXJzZVF1ZXJ5UGFja2V0V2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgcGFyc2VRdWVyeVBhY2tldFdhdGNoZXI6IHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChhY2spIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlUXVlcnlQYWNrZXQoYWNrKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGNvbm5lY3Rpb25IYW5kbGVyOiB7XG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBhc3luYyBvbk9wZW4oY29ubmVjdGlvbiwgbG9jYWxBZGRyLCByZW1vdGVBZGRyKSB7XG4gICAgICAgIHRyYWNlMihgSUNRIENoYW5uZWwgT3BlbmVkIGZvciAke2xvY2FsQWRkcn0gYXQgJHtyZW1vdGVBZGRyfWApO1xuICAgICAgICB0aGlzLnN0YXRlLmNvbm5lY3Rpb24gPSBjb25uZWN0aW9uO1xuICAgICAgICB0aGlzLnN0YXRlLnJlbW90ZUFkZHJlc3MgPSByZW1vdGVBZGRyO1xuICAgICAgICB0aGlzLnN0YXRlLmxvY2FsQWRkcmVzcyA9IGxvY2FsQWRkcjtcbiAgICAgIH0sXG4gICAgICBhc3luYyBvbkNsb3NlKF9jb25uZWN0aW9uLCByZWFzb24pIHtcbiAgICAgICAgdHJhY2UyKGBJQ1EgQ2hhbm5lbCBjbG9zZWQuIFJlYXNvbjogJHtyZWFzb259YCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4pO1xuXG4vL1xudmFyIHsgVm93JCB9ID0gU2hhcGU7XG52YXIgZ2V0SUNRQ29ubmVjdGlvbktleSA9IChjb250cm9sbGVyQ29ubmVjdGlvbklkLCB2ZXJzaW9uKSA9PiB7XG4gIHJldHVybiBgJHtjb250cm9sbGVyQ29ubmVjdGlvbklkfToke3ZlcnNpb24gfHwgREVGQVVMVF9JQ1FfVkVSU0lPTn1gO1xufTtcbnZhciBwcmVwYXJlQ29zbW9zT3JjaGVzdHJhdGlvblNlcnZpY2VLaXQgPSAoem9uZSwgeyB3YXRjaCwgYXNWb3cgfSwgbWFrZUljYUFjY291bnRLaXQsIG1ha2VJQ1FDb25uZWN0aW9uS2l0KSA9PiB6b25lLmV4b0NsYXNzS2l0KFxuICBcIk9yY2hlc3RyYXRpb25cIixcbiAge1xuICAgIHJlcXVlc3RJQ0FDaGFubmVsV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJSZXF1ZXN0SUNBQ2hhbm5lbFdhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnJlbW90YWJsZShcIlBvcnRcIikpLm9wdGlvbmFsKHsgY2hhaW5JZDogTS5zdHJpbmcoKSwgcmVtb3RlQ29ubkFkZHI6IE0uc3RyaW5nKCkgfSkucmV0dXJucyhWb3ckKFNoYXBlLkNvbm5lY3Rpb24pKVxuICAgIH0pLFxuICAgIHJlcXVlc3RJQ1FDaGFubmVsV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJSZXF1ZXN0SUNRQ2hhbm5lbFdhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnJlbW90YWJsZShcIlBvcnRcIikpLm9wdGlvbmFsKHtcbiAgICAgICAgcmVtb3RlQ29ubkFkZHI6IE0uc3RyaW5nKCksXG4gICAgICAgIGljcUxvb2t1cEtleTogTS5zdHJpbmcoKVxuICAgICAgfSkucmV0dXJucyhWb3ckKFNoYXBlLkNvbm5lY3Rpb24pKVxuICAgIH0pLFxuICAgIGNoYW5uZWxPcGVuV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJDaGFubmVsT3BlbldhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnJlbW90YWJsZShcIkNvbm5lY3Rpb25cIikpLm9wdGlvbmFsKFxuICAgICAgICBNLnNwbGl0UmVjb3JkKFxuICAgICAgICAgIHsgY29ubmVjdGlvbktpdDogTS5yZWNvcmQoKSwgcmV0dXJuRmFjZXQ6IE0uc3RyaW5nKCkgfSxcbiAgICAgICAgICB7IGljcUxvb2t1cEtleTogTS5zdHJpbmcoKSB9XG4gICAgICAgIClcbiAgICAgICkucmV0dXJucyhNLnJlbW90YWJsZShcIkNvbm5lY3Rpb25LaXQgSG9sZGVyIGZhY2V0XCIpKVxuICAgIH0pLFxuICAgIHB1YmxpYzogTS5pbnRlcmZhY2UoXCJDb3Ntb3NJbnRlcmNoYWluU2VydmljZVwiLCB7XG4gICAgICBtYWtlQWNjb3VudDogTS5jYWxsKE0uc3RyaW5nKCksIE0uc3RyaW5nKCksIE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0ucmVjb3JkKCkpLnJldHVybnMoVm93JChNLnJlbW90YWJsZShcIkljYUFjY291bnRLaXRcIikpKSxcbiAgICAgIHByb3ZpZGVJQ1FDb25uZWN0aW9uOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5zdHJpbmcoKSkucmV0dXJucyhWb3ckKE0ucmVtb3RhYmxlKFwiSUNRQ29ubmVjdGlvblwiKSkpXG4gICAgfSlcbiAgfSxcbiAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gIChwb3dlcnMpID0+IHtcbiAgICBtdXN0TWF0Y2gocG93ZXJzPy5wb3J0QWxsb2NhdG9yLCBNLnJlbW90YWJsZShcIlBvcnRBbGxvY2F0b3JcIikpO1xuICAgIGNvbnN0IGljcUNvbm5lY3Rpb25zID0gem9uZS5kZXRhY2hlZCgpLm1hcFN0b3JlKFwiSUNRQ29ubmVjdGlvbnNcIik7XG4gICAgcmV0dXJuIChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAge1xuICAgICAgICBpY3FDb25uZWN0aW9ucyxcbiAgICAgICAgc2hhcmVkSUNRUG9ydDogdm9pZCAwLFxuICAgICAgICByZXNlcnZlZDogdm9pZCAwLFxuICAgICAgICAuLi5wb3dlcnNcbiAgICAgIH1cbiAgICApO1xuICB9LFxuICB7XG4gICAgcmVxdWVzdElDQUNoYW5uZWxXYXRjaGVyOiB7XG4gICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgb25GdWxmaWxsZWQocG9ydCwgeyBjaGFpbklkLCByZW1vdGVDb25uQWRkciB9KSB7XG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb25LaXQgPSBtYWtlSWNhQWNjb3VudEtpdChcbiAgICAgICAgICBjaGFpbklkLFxuICAgICAgICAgIHBvcnQsXG4gICAgICAgICAgcmVtb3RlQ29ubkFkZHJcbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgIEUocG9ydCkuY29ubmVjdChyZW1vdGVDb25uQWRkciwgY29ubmVjdGlvbktpdC5jb25uZWN0aW9uSGFuZGxlciksXG4gICAgICAgICAgdGhpcy5mYWNldHMuY2hhbm5lbE9wZW5XYXRjaGVyLFxuICAgICAgICAgIHsgcmV0dXJuRmFjZXQ6IFwiYWNjb3VudFwiLCBjb25uZWN0aW9uS2l0IH1cbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlcXVlc3RJQ1FDaGFubmVsV2F0Y2hlcjoge1xuICAgICAgLypcblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKHBvcnQsIHsgcmVtb3RlQ29ubkFkZHIsIGljcUxvb2t1cEtleSB9KSB7XG4gICAgICAgIGlmICghdGhpcy5zdGF0ZS5zaGFyZWRJQ1FQb3J0KSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5zaGFyZWRJQ1FQb3J0ID0gcG9ydDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb25uZWN0aW9uS2l0ID0gbWFrZUlDUUNvbm5lY3Rpb25LaXQocG9ydCk7XG4gICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICBFKHBvcnQpLmNvbm5lY3QocmVtb3RlQ29ubkFkZHIsIGNvbm5lY3Rpb25LaXQuY29ubmVjdGlvbkhhbmRsZXIpLFxuICAgICAgICAgIHRoaXMuZmFjZXRzLmNoYW5uZWxPcGVuV2F0Y2hlcixcbiAgICAgICAgICB7XG4gICAgICAgICAgICBjb25uZWN0aW9uS2l0LFxuICAgICAgICAgICAgcmV0dXJuRmFjZXQ6IFwiY29ubmVjdGlvblwiLFxuICAgICAgICAgICAgaWNxTG9va3VwS2V5XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG4gICAgLypcblxuXG5cbiAgICAgKi9cbiAgICBjaGFubmVsT3BlbldhdGNoZXI6IHtcbiAgICAgIC8qXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKF9jb25uZWN0aW9uLCB7IGNvbm5lY3Rpb25LaXQsIHJldHVybkZhY2V0LCBpY3FMb29rdXBLZXkgfSkge1xuICAgICAgICBpZiAoaWNxTG9va3VwS2V5KSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9ucy5pbml0KFxuICAgICAgICAgICAgaWNxTG9va3VwS2V5LFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgY29ubmVjdGlvbktpdFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvbm5lY3Rpb25LaXRbcmV0dXJuRmFjZXRdO1xuICAgICAgfVxuICAgIH0sXG4gICAgcHVibGljOiB7XG4gICAgICAvKlxuXG5cblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgbWFrZUFjY291bnQoY2hhaW5JZCwgaG9zdENvbm5lY3Rpb25JZCwgY29udHJvbGxlckNvbm5lY3Rpb25JZCwgb3B0cykge1xuICAgICAgICBjb25zdCByZW1vdGVDb25uQWRkciA9IG1ha2VJQ0FDaGFubmVsQWRkcmVzcyhcbiAgICAgICAgICBob3N0Q29ubmVjdGlvbklkLFxuICAgICAgICAgIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsXG4gICAgICAgICAgb3B0c1xuICAgICAgICApO1xuICAgICAgICBjb25zdCB7IHBvcnRBbGxvY2F0b3IgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICBFKHBvcnRBbGxvY2F0b3IpLmFsbG9jYXRlSUNBQ29udHJvbGxlclBvcnQoKSxcbiAgICAgICAgICB0aGlzLmZhY2V0cy5yZXF1ZXN0SUNBQ2hhbm5lbFdhdGNoZXIsXG4gICAgICAgICAge1xuICAgICAgICAgICAgY2hhaW5JZCxcbiAgICAgICAgICAgIHJlbW90ZUNvbm5BZGRyXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgcHJvdmlkZUlDUUNvbm5lY3Rpb24oY29udHJvbGxlckNvbm5lY3Rpb25JZCwgdmVyc2lvbikge1xuICAgICAgICBjb25zdCBpY3FMb29rdXBLZXkgPSBnZXRJQ1FDb25uZWN0aW9uS2V5KFxuICAgICAgICAgIGNvbnRyb2xsZXJDb25uZWN0aW9uSWQsXG4gICAgICAgICAgdmVyc2lvblxuICAgICAgICApO1xuICAgICAgICBpZiAodGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9ucy5oYXMoaWNxTG9va3VwS2V5KSkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdyhcbiAgICAgICAgICAgICgpID0+IHRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbnMuZ2V0KGljcUxvb2t1cEtleSkuY29ubmVjdGlvblxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVtb3RlQ29ubkFkZHIgPSBtYWtlSUNRQ2hhbm5lbEFkZHJlc3MoXG4gICAgICAgICAgY29udHJvbGxlckNvbm5lY3Rpb25JZCxcbiAgICAgICAgICB2ZXJzaW9uXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHsgcG9ydEFsbG9jYXRvciwgc2hhcmVkSUNRUG9ydCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgcG9ydE9yUG9ydFZvdyA9IHNoYXJlZElDUVBvcnQgfHwgRShwb3J0QWxsb2NhdG9yKS5hbGxvY2F0ZUlDUUNvbnRyb2xsZXJQb3J0KCk7XG4gICAgICAgIHJldHVybiB3YXRjaChwb3J0T3JQb3J0Vm93LCB0aGlzLmZhY2V0cy5yZXF1ZXN0SUNRQ2hhbm5lbFdhdGNoZXIsIHtcbiAgICAgICAgICByZW1vdGVDb25uQWRkcixcbiAgICAgICAgICBpY3FMb29rdXBLZXlcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICB7XG4gICAgc3RhdGVTaGFwZToge1xuICAgICAgaWNxQ29ubmVjdGlvbnM6IE0ucmVtb3RhYmxlKFwiaWNxQ29ubmVjdGlvbnMgbWFwU3RvcmVcIiksXG4gICAgICBzaGFyZWRJQ1FQb3J0OiBNLm9yKE0ucmVtb3RhYmxlKFwiUG9ydFwiKSwgTS51bmRlZmluZWQoKSksXG4gICAgICBwb3J0QWxsb2NhdG9yOiBNLnJlbW90YWJsZShcIlBvcnRBbGxvY2F0b3JcIiksXG4gICAgICByZXNlcnZlZDogTS5hbnkoKVxuICAgIH1cbiAgfVxuKTtcbnZhciBwcmVwYXJlQ29zbW9zSW50ZXJjaGFpblNlcnZpY2UgPSAoem9uZSwgdm93VG9vbHMpID0+IHtcbiAgY29uc3QgbWFrZUljYUFjY291bnRLaXQgPSBwcmVwYXJlSWNhQWNjb3VudEtpdCh6b25lLCB2b3dUb29scyk7XG4gIGNvbnN0IG1ha2VJQ1FDb25uZWN0aW9uS2l0ID0gcHJlcGFyZUlDUUNvbm5lY3Rpb25LaXQoem9uZSwgdm93VG9vbHMpO1xuICBjb25zdCBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvblNlcnZpY2VLaXQgPSBwcmVwYXJlQ29zbW9zT3JjaGVzdHJhdGlvblNlcnZpY2VLaXQoXG4gICAgem9uZSxcbiAgICB2b3dUb29scyxcbiAgICBtYWtlSWNhQWNjb3VudEtpdCxcbiAgICBtYWtlSUNRQ29ubmVjdGlvbktpdFxuICApO1xuICBjb25zdCBtYWtlQ29zbW9zSW50ZXJjaGFpblNlcnZpY2UgPSBwaWNrRmFjZXQoXG4gICAgbWFrZUNvc21vc09yY2hlc3RyYXRpb25TZXJ2aWNlS2l0LFxuICAgIFwicHVibGljXCJcbiAgKTtcbiAgcmV0dXJuIG1ha2VDb3Ntb3NJbnRlcmNoYWluU2VydmljZTtcbn07XG5oYXJkZW4ocHJlcGFyZUNvc21vc0ludGVyY2hhaW5TZXJ2aWNlKTtcblxuLy9cbnZhciBtYWtlQ29udmVydCA9IChjb252ZXJ0UmVtb3RhYmxlLCBjb252ZXJ0UHJvbWlzZU9yVm93LCBjb252ZXJ0RXJyb3IpID0+IHtcbiAgY29uc3QgY29udmVydFJlY3VyID0gKHNwZWNpbWVuLCBsYWJlbCkgPT4ge1xuICAgIGlmIChsYWJlbCA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gaW5uZXJDb252ZXJ0KHNwZWNpbWVuKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBpbm5lckNvbnZlcnQoc3BlY2ltZW4pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdGhyb3dMYWJlbGVkKGVyciwgbGFiZWwpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgaW5uZXJDb252ZXJ0ID0gKHNwZWNpbWVuKSA9PiB7XG4gICAgaWYgKCFpc09iamVjdDIoc3BlY2ltZW4pKSB7XG4gICAgICByZXR1cm4gc3BlY2ltZW47XG4gICAgfVxuICAgIGNvbnN0IHBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKHNwZWNpbWVuKTtcbiAgICBzd2l0Y2ggKHBhc3NTdHlsZSkge1xuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIHJldHVybiBzcGVjaW1lbi5tYXAoKGVsZW1lbnQsIGkyKSA9PiBjb252ZXJ0UmVjdXIoZWxlbWVudCwgaTIpKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgcmV0dXJuIG9iamVjdE1hcChzcGVjaW1lbiwgKHZhbHVlLCBuYW1lKSA9PiBjb252ZXJ0UmVjdXIodmFsdWUsIG5hbWUpKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICBpZiAoaXNWb3coc3BlY2ltZW4pKSB7XG4gICAgICAgICAgcmV0dXJuIGNvbnZlcnRQcm9taXNlT3JWb3coc3BlY2ltZW4pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHRhZyA9IGdldFRhZyhzcGVjaW1lbik7XG4gICAgICAgIGNvbnN0IHsgcGF5bG9hZCB9ID0gc3BlY2ltZW47XG4gICAgICAgIHJldHVybiBtYWtlVGFnZ2VkKHRhZywgY29udmVydFJlY3VyKHBheWxvYWQsIGAke3RhZ30gcGF5bG9hZGApKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlcnJvclwiOiB7XG4gICAgICAgIHJldHVybiBjb252ZXJ0RXJyb3Ioc3BlY2ltZW4pO1xuICAgICAgfVxuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIHJldHVybiBjb252ZXJ0UmVtb3RhYmxlKHNwZWNpbWVuKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgcmV0dXJuIGNvbnZlcnRQcm9taXNlT3JWb3coc3BlY2ltZW4pO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgcGFzc1N0eWxlICR7cXVvdGUocGFzc1N0eWxlKX1gO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgY29udmVydCA9IChzcGVjaW1lbiwgbGFiZWwgPSB2b2lkIDApID0+IGNvbnZlcnRSZWN1cihoYXJkZW4oc3BlY2ltZW4pLCBsYWJlbCk7XG4gIHJldHVybiBoYXJkZW4oY29udmVydCk7XG59O1xudmFyIG1ha2VDb252ZXJ0S2l0ID0gKGJpamVjdGlvbiwgbWFrZUd1ZXN0Rm9ySG9zdFJlbW90YWJsZSwgbWFrZUd1ZXN0Rm9ySG9zdFZvdykgPT4ge1xuICBjb25zdCBndWVzdFRvSG9zdCA9IG1ha2VDb252ZXJ0KFxuICAgIChnUmVtKSA9PiB7XG4gICAgICBpZiAoYmlqZWN0aW9uLmhhc0d1ZXN0KGdSZW0pKSB7XG4gICAgICAgIHJldHVybiBiaWplY3Rpb24uZ3Vlc3RUb0hvc3QoZ1JlbSk7XG4gICAgICB9XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGNhbm5vdCB5ZXQgc2VuZCBndWVzdCByZW1vdGFibGVzICR7Z1JlbX1gO1xuICAgIH0sXG4gICAgKGdQcm9tKSA9PiB7XG4gICAgICBpZiAoYmlqZWN0aW9uLmhhc0d1ZXN0KGdQcm9tKSkge1xuICAgICAgICByZXR1cm4gYmlqZWN0aW9uLmd1ZXN0VG9Ib3N0KGdQcm9tKTtcbiAgICAgIH1cbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgY2Fubm90IHlldCBzZW5kIGd1ZXN0IHByb21pc2VzICR7Z1Byb219YDtcbiAgICB9LFxuICAgIChnRXJyKSA9PiB7XG4gICAgICBjb25zdCBoRXJyID0gaGFyZGVuKFxuICAgICAgICBtYWtlRXJyb3IoZ0Vyci5tZXNzYWdlLCBnZXRFcnJvckNvbnN0cnVjdG9yKGdFcnIubmFtZSkpXG4gICAgICApO1xuICAgICAgbm90ZShoRXJyLCByZWRhY3RlZGBmcm9tIGd1ZXN0IGVycm9yICR7Z0Vycn1gKTtcbiAgICAgIHJldHVybiBoRXJyO1xuICAgIH1cbiAgKTtcbiAgY29uc3QgaG9zdFRvR3Vlc3QgPSBtYWtlQ29udmVydChcbiAgICAoaFJlbSkgPT4ge1xuICAgICAgaWYgKGJpamVjdGlvbi5oYXNIb3N0KGhSZW0pKSB7XG4gICAgICAgIHJldHVybiBiaWplY3Rpb24uaG9zdFRvR3Vlc3QoaFJlbSk7XG4gICAgICB9XG4gICAgICBjb25zdCBnUmVtID0gbWFrZUd1ZXN0Rm9ySG9zdFJlbW90YWJsZShoUmVtKTtcbiAgICAgIHJldHVybiBiaWplY3Rpb24udW53cmFwSW5pdChnUmVtLCBoUmVtKTtcbiAgICB9LFxuICAgIChoVm93KSA9PiB7XG4gICAgICBpZiAoYmlqZWN0aW9uLmhhc0hvc3QoaFZvdykpIHtcbiAgICAgICAgcmV0dXJuIGJpamVjdGlvbi5ob3N0VG9HdWVzdChoVm93KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGdQID0gbWFrZUd1ZXN0Rm9ySG9zdFZvdyhoVm93KTtcbiAgICAgIHJldHVybiBiaWplY3Rpb24udW53cmFwSW5pdChnUCwgaFZvdyk7XG4gICAgfSxcbiAgICAoaEVycikgPT4ge1xuICAgICAgY29uc3QgZ0VyciA9IGhhcmRlbihcbiAgICAgICAgbWFrZUVycm9yKGhFcnIubWVzc2FnZSwgZ2V0RXJyb3JDb25zdHJ1Y3RvcihoRXJyLm5hbWUpKVxuICAgICAgKTtcbiAgICAgIG5vdGUoZ0VyciwgcmVkYWN0ZWRgZnJvbSBob3N0IGVycm9yICR7aEVycn1gKTtcbiAgICAgIHJldHVybiBnRXJyO1xuICAgIH1cbiAgKTtcbiAgcmV0dXJuIGhhcmRlbih7IGd1ZXN0VG9Ib3N0LCBob3N0VG9HdWVzdCB9KTtcbn07XG5oYXJkZW4obWFrZUNvbnZlcnRLaXQpO1xuXG4vL1xudmFyIHsgaXM6IGlzNSB9ID0gT2JqZWN0O1xudmFyIG1ha2VFcXVhdGUgPSAoYmlqZWN0aW9uKSA9PiB7XG4gIGNvbnN0IGVxdWF0ZSA9IChnMywgaCwgbGFiZWwpID0+IHtcbiAgICBpZiAobGFiZWwgPT09IHZvaWQgMCkge1xuICAgICAgaW5uZXJFcXVhdGUoZzMsIGgpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgaW5uZXJFcXVhdGUoZzMsIGgpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgdGhyb3dMYWJlbGVkKGVyciwgbGFiZWwpO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgaW5uZXJFcXVhdGUgPSAoZzMsIGgpID0+IHtcbiAgICBpZiAoIWlzT2JqZWN0MihnMykpIHtcbiAgICAgIGlzNShnMywgaCkgfHwgLy9cbiAgICAgIHRocm93UmVkYWN0ZWRgdW5lcXVhbCAke2czfSB2cyAke2h9YDtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGJpamVjdGlvbi5oYXNHdWVzdChnMykgJiYgYmlqZWN0aW9uLmd1ZXN0VG9Ib3N0KGczKSA9PT0gaCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBnUGFzc1N0eWxlID0gcGFzc1N0eWxlT2YoZzMpO1xuICAgIGlmIChnUGFzc1N0eWxlID09PSBcInByb21pc2VcIiAmJiBpc1ZvdyhoKSkge1xuICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBndWVzdCBwcm9taXNlcyBub3QgeWV0IHBhc3NhYmxlYDtcbiAgICB9XG4gICAgY29uc3QgaFBhc3NTdHlsZSA9IHBhc3NTdHlsZU9mKGgpO1xuICAgIGdQYXNzU3R5bGUgPT09IGhQYXNzU3R5bGUgfHwgdGhyb3dSZWRhY3RlZGB1bmVxdWFsIHBhc3NTdHlsZXMgJHtxdW90ZShnUGFzc1N0eWxlKX0gdnMgJHtxdW90ZShoUGFzc1N0eWxlKX1gO1xuICAgIHN3aXRjaCAoZ1Bhc3NTdHlsZSkge1xuICAgICAgY2FzZSBcImNvcHlBcnJheVwiOiB7XG4gICAgICAgIGVxdWF0ZShnMy5sZW5ndGgsIGgubGVuZ3RoLCBcImxlbmd0aFwiKTtcbiAgICAgICAgZzMuZm9yRWFjaCgoZ0VsLCBpMikgPT4gZXF1YXRlKGdFbCwgaFtpMl0sIGkyKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJjb3B5UmVjb3JkXCI6IHtcbiAgICAgICAgY29uc3QgZ05hbWVzID0gcmVjb3JkTmFtZXMoZzMpO1xuICAgICAgICBjb25zdCBoTmFtZXMgPSByZWNvcmROYW1lcyhoKTtcbiAgICAgICAgZXF1YXRlKGdOYW1lcywgaE5hbWVzLCBcInByb3BlcnR5TmFtZXNcIik7XG4gICAgICAgIGZvciAoY29uc3QgbmFtZSBvZiBnTmFtZXMpIHtcbiAgICAgICAgICBlcXVhdGUoZzNbbmFtZV0sIGhbbmFtZV0sIG5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0YWdnZWRcIjoge1xuICAgICAgICBlcXVhdGUoZ2V0VGFnKGczKSwgZ2V0VGFnKGgpLCBcInRhZ1wiKTtcbiAgICAgICAgZXF1YXRlKGczLnBheWxvYWQsIGgucGF5bG9hZCwgXCJwYXlsb2FkXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjYXNlIFwiZXJyb3JcIjoge1xuICAgICAgICBlcXVhdGUoZzMubmFtZSwgaC5uYW1lLCBcImVycm9yIG5hbWVcIik7XG4gICAgICAgIG5vdGUoZzMsIHJlZGFjdGVkYHJlcGxheSBvZiBlcnJvciAke2h9YCk7XG4gICAgICAgIG5vdGUoaCwgcmVkYWN0ZWRgcmVwbGF5ZWQgYXMgZXJyb3IgJHtnM31gKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY2FzZSBcInJlbW90YWJsZVwiOiB7XG4gICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgY2Fubm90IHlldCBzZW5kIGd1ZXN0IHJlbW90YWJsZXMgdG8gaG9zdCAke2czfSB2cyAke2h9YDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJwcm9taXNlXCI6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBjYW5ub3QgeWV0IHNlbmQgZ3Vlc3QgcHJvbWlzZXMgdG8gaG9zdCAke2czfSB2cyAke2h9YDtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIHBhc3NTdHlsZSAke3F1b3RlKGdQYXNzU3R5bGUpfWA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICByZXR1cm4gaGFyZGVuKGVxdWF0ZSk7XG59O1xuaGFyZGVuKG1ha2VFcXVhdGUpO1xuXG4vL1xudmFyIHsgZnJvbUVudHJpZXM6IGZyb21FbnRyaWVzMTMsIGRlZmluZVByb3BlcnRpZXM6IGRlZmluZVByb3BlcnRpZXM1LCBhc3NpZ246IGFzc2lnbjMgfSA9IE9iamVjdDtcbnZhciBtYWtlUmVwbGF5TWVtYnJhbmUgPSAoYXJnKSA9PiB7XG4gIGNvbnN0IG5vRHVuZGVyQXJnID0gKFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMoYXJnKS5maWx0ZXIoKFtrXSkgPT4gIWsuc3RhcnRzV2l0aChcIl9fXCIpKSlcbiAgKTtcbiAgcmV0dXJuIG1ha2VSZXBsYXlNZW1icmFuZUZvclRlc3Rpbmcobm9EdW5kZXJBcmcpO1xufTtcbnZhciBtYWtlUmVwbGF5TWVtYnJhbmVGb3JUZXN0aW5nID0gKHtcbiAgbG9nLFxuICBiaWplY3Rpb24sXG4gIHZvd1Rvb2xzLFxuICB3YXRjaFdha2UsXG4gIHBhbmljLFxuICBfX2V2ZW50dWFsU2VuZEZvclRlc3Rpbmdcbn0pID0+IHtcbiAgY29uc3QgeyB3aGVuLCBtYWtlVm93S2l0IH0gPSB2b3dUb29scztcbiAgY29uc3QgZXF1YXRlID0gbWFrZUVxdWF0ZShiaWplY3Rpb24pO1xuICBjb25zdCBndWVzdFByb21pc2VNYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgbGV0IHN0b3BwZWQgPSBmYWxzZTtcbiAgY29uc3QgUGFuaWMgPSAodGVtcGxhdGUsIC4uLmFyZ3MpID0+IHBhbmljKG1ha2VFcnJvcihyZWRhY3RlZCh0ZW1wbGF0ZSwgLi4uYXJncykpKTtcbiAgY29uc3Qgc3RhcnRHZW5lcmF0aW9uID0gKGdlbmVyYXRpb24pID0+IHtcbiAgICBOdW1iZXIuaXNTYWZlSW50ZWdlcihnZW5lcmF0aW9uKSB8fCB0aHJvd1JlZGFjdGVkYGdlbmVyYXRpb24gZXhwZWN0ZWQgaW50ZWdlcjsgZ290ICR7Z2VuZXJhdGlvbn1gO1xuICAgIGdlbmVyYXRpb24gPj0gMCB8fCB0aHJvd1JlZGFjdGVkYGdlbmVyYXRpb24gZXhwZWN0ZWQgbm9uLW5lZ2F0aXZlOyBnb3QgJHtnZW5lcmF0aW9ufWA7XG4gIH07XG4gIGNvbnN0IGRvRnVsZmlsbCA9IChob3N0Vm93LCBob3N0RnVsZmlsbG1lbnQpID0+IHtcbiAgICBjb25zdCBndWVzdFByb21pc2UgPSBob3N0VG9HdWVzdChob3N0Vm93KTtcbiAgICBjb25zdCBzdGF0dXMgPSBndWVzdFByb21pc2VNYXAuZ2V0KGd1ZXN0UHJvbWlzZSk7XG4gICAgaWYgKCFzdGF0dXMgfHwgc3RhdHVzID09PSBcInNldHRsZWRcIikge1xuICAgICAgdGhyb3dSZWRhY3RlZGBkb0Z1bGZpbGwgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIG9uIGEgcmVnaXN0ZXJlZCB1bnJlc29sdmVkIHByb21pc2VgO1xuICAgIH1cbiAgICBjb25zdCBndWVzdEZ1bGZpbGxtZW50ID0gaG9zdFRvR3Vlc3QoaG9zdEZ1bGZpbGxtZW50KTtcbiAgICBzdGF0dXMucmVzb2x2ZShndWVzdEZ1bGZpbGxtZW50KTtcbiAgICBndWVzdFByb21pc2VNYXAuc2V0KGd1ZXN0UHJvbWlzZSwgXCJzZXR0bGVkXCIpO1xuICB9O1xuICBjb25zdCBkb1JlamVjdCA9IChob3N0Vm93LCBob3N0UmVhc29uKSA9PiB7XG4gICAgY29uc3QgZ3Vlc3RQcm9taXNlID0gaG9zdFRvR3Vlc3QoaG9zdFZvdyk7XG4gICAgY29uc3Qgc3RhdHVzID0gZ3Vlc3RQcm9taXNlTWFwLmdldChndWVzdFByb21pc2UpO1xuICAgIGlmICghc3RhdHVzIHx8IHN0YXR1cyA9PT0gXCJzZXR0bGVkXCIpIHtcbiAgICAgIHRocm93UmVkYWN0ZWRgZG9SZWplY3Qgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIG9uIGEgcmVnaXN0ZXJlZCB1bnJlc29sdmVkIHByb21pc2VgO1xuICAgIH1cbiAgICBjb25zdCBndWVzdFJlYXNvbiA9IGhvc3RUb0d1ZXN0KGhvc3RSZWFzb24pO1xuICAgIHN0YXR1cy5yZWplY3QoZ3Vlc3RSZWFzb24pO1xuICAgIGd1ZXN0UHJvbWlzZU1hcC5zZXQoZ3Vlc3RQcm9taXNlLCBcInNldHRsZWRcIik7XG4gIH07XG4gIGNvbnN0IGRvUmV0dXJuID0gKGNhbGxJbmRleCwgaG9zdFJlc3VsdCkgPT4ge1xuICAgIHVubmVzdEludGVycHJldGVyKGNhbGxJbmRleCk7XG4gICAgY29uc3QgZ3Vlc3RSZXN1bHQgPSBob3N0VG9HdWVzdChob3N0UmVzdWx0KTtcbiAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgIGtpbmQ6IFwicmV0dXJuXCIsXG4gICAgICByZXN1bHQ6IGd1ZXN0UmVzdWx0XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IGRvVGhyb3cgPSAoY2FsbEluZGV4LCBob3N0UHJvYmxlbSkgPT4ge1xuICAgIHVubmVzdEludGVycHJldGVyKGNhbGxJbmRleCk7XG4gICAgY29uc3QgZ3Vlc3RQcm9ibGVtID0gaG9zdFRvR3Vlc3QoaG9zdFByb2JsZW0pO1xuICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAga2luZDogXCJ0aHJvd1wiLFxuICAgICAgcHJvYmxlbTogZ3Vlc3RQcm9ibGVtXG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IHBlcmZvcm1DYWxsID0gKGhvc3RUYXJnZXQsIG9wdFZlcmIsIGhvc3RBcmdzLCBjYWxsSW5kZXgpID0+IHtcbiAgICBsZXQgaG9zdFJlc3VsdDtcbiAgICB0cnkge1xuICAgICAgaG9zdFJlc3VsdCA9IG9wdFZlcmIgPyBob3N0VGFyZ2V0W29wdFZlcmJdKC4uLmhvc3RBcmdzKSA6IGhvc3RUYXJnZXQoLi4uaG9zdEFyZ3MpO1xuICAgICAgaG9zdFRvR3Vlc3QoaG9zdFJlc3VsdCwgYGNvbnZlcnRpbmcgJHtvcHRWZXJiIHx8IFwiaG9zdFwifSByZXN1bHRgKTtcbiAgICB9IGNhdGNoIChob3N0UHJvYmxlbSkge1xuICAgICAgcmV0dXJuIGxvZ0RvKG5lc3REaXNwYXRjaCwgaGFyZGVuKFtcImRvVGhyb3dcIiwgY2FsbEluZGV4LCBob3N0UHJvYmxlbV0pKTtcbiAgICB9XG4gICAgcmV0dXJuIGxvZ0RvKG5lc3REaXNwYXRjaCwgaGFyZGVuKFtcImRvUmV0dXJuXCIsIGNhbGxJbmRleCwgaG9zdFJlc3VsdF0pKTtcbiAgfTtcbiAgY29uc3QgZ3Vlc3RDYWxsc0hvc3QgPSAoZ3Vlc3RUYXJnZXQsIG9wdFZlcmIsIGd1ZXN0QXJncywgY2FsbEluZGV4KSA9PiB7XG4gICAgaWYgKHN0b3BwZWQgfHwgIWJpamVjdGlvbi5oYXNHdWVzdChndWVzdFRhcmdldCkpIHtcbiAgICAgIGNvbnN0IGV4dHJhRGlhZ25vc3RpYyA9IGNhbGxTdGFjay5sZW5ndGggPT09IDAgPyBcIlwiIDogKFxuICAgICAgICAvL1xuICAgICAgICBgIHdpdGggbm9uLWVtcHR5IGNhbGxzdGFjayAke3F1b3RlKGNhbGxTdGFjayl9O2BcbiAgICAgICk7XG4gICAgICB0aHJvd1JlZGFjdGVkYENhbGxlZCBmcm9tIGEgcHJldmlvdXMgcnVuOiAke2d1ZXN0VGFyZ2V0fSR7YmFyZU9yUXVvdGUoZXh0cmFEaWFnbm9zdGljKX1gO1xuICAgIH1cbiAgICBsZXQgb3V0Y29tZTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZ3Vlc3RFbnRyeSA9IGhhcmRlbihbXG4gICAgICAgIFwiY2hlY2tDYWxsXCIsXG4gICAgICAgIGd1ZXN0VGFyZ2V0LFxuICAgICAgICBvcHRWZXJiLFxuICAgICAgICBndWVzdEFyZ3MsXG4gICAgICAgIGNhbGxJbmRleFxuICAgICAgXSk7XG4gICAgICBpZiAobG9nLmlzUmVwbGF5aW5nKCkpIHtcbiAgICAgICAgY29uc3QgZW50cnkgPSBsb2cubmV4dEVudHJ5KCk7XG4gICAgICAgIGVxdWF0ZShcbiAgICAgICAgICBndWVzdEVudHJ5LFxuICAgICAgICAgIGVudHJ5LFxuICAgICAgICAgIGByZXBsYXkgJHtjYWxsSW5kZXh9OlxuICAgICAke3F1b3RlKGd1ZXN0RW50cnkpfVxuICB2cyAke3F1b3RlKGVudHJ5KX1cbiAgICBgXG4gICAgICAgICk7XG4gICAgICAgIG91dGNvbWUgPSAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG5lc3RJbnRlcnByZXRlcihjYWxsSW5kZXgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgZW50cnkgPSBndWVzdFRvSG9zdChndWVzdEVudHJ5KTtcbiAgICAgICAgbG9nLnB1c2hFbnRyeShlbnRyeSk7XG4gICAgICAgIGNvbnN0IFtfLCAuLi5hcmdzXSA9IGVudHJ5O1xuICAgICAgICBuZXN0SW50ZXJwcmV0ZXIoY2FsbEluZGV4KTtcbiAgICAgICAgb3V0Y29tZSA9IHBlcmZvcm1DYWxsKC4uLmFyZ3MpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGZhdGFsRXJyb3IpIHtcbiAgICAgIHRocm93IHBhbmljKGZhdGFsRXJyb3IpO1xuICAgIH1cbiAgICBzd2l0Y2ggKG91dGNvbWUua2luZCkge1xuICAgICAgY2FzZSBcInJldHVyblwiOiB7XG4gICAgICAgIHJldHVybiBvdXRjb21lLnJlc3VsdDtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJ0aHJvd1wiOiB7XG4gICAgICAgIHRocm93IG91dGNvbWUucHJvYmxlbTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgUGFuaWNgdW5leHBlY3RlZCBvdXRjb21lIGtpbmQgJHtxdW90ZShvdXRjb21lLmtpbmQpfWA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCBwZXJmb3JtU2VuZE9ubHkgPSAoaG9zdFRhcmdldCwgb3B0VmVyYiwgaG9zdEFyZ3MpID0+IHtcbiAgICB0cnkge1xuICAgICAgb3B0VmVyYiA9PT0gdm9pZCAwID8gaGVhcFZvd0Uuc2VuZE9ubHkoaG9zdFRhcmdldCkoLi4uaG9zdEFyZ3MpIDogaGVhcFZvd0Uuc2VuZE9ubHkoaG9zdFRhcmdldClbb3B0VmVyYl0oLi4uaG9zdEFyZ3MpO1xuICAgIH0gY2F0Y2ggKGhvc3RQcm9ibGVtKSB7XG4gICAgICB0aHJvdyBQYW5pY2BpbnRlcm5hbDogZXZlbnR1YWwgc2VuZE9ubHkgc3luY2hyb25vdXNseSBmYWlsZWQgJHtob3N0UHJvYmxlbX1gO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgcGVyZm9ybVNlbmQgPSAoaG9zdFRhcmdldCwgb3B0VmVyYiwgaG9zdEFyZ3MsIGNhbGxJbmRleCwgaG9zdFJlc3VsdEtpdCwgZ3Vlc3RSZXR1cm5lZFApID0+IHtcbiAgICBjb25zdCB7IHZvdywgcmVzb2x2ZXIgfSA9IGhvc3RSZXN1bHRLaXQ7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGhvc3RQcm9taXNlID0gb3B0VmVyYiA9PT0gdm9pZCAwID8gaGVhcFZvd0UoaG9zdFRhcmdldCkoLi4uaG9zdEFyZ3MpIDogaGVhcFZvd0UoaG9zdFRhcmdldClbb3B0VmVyYl0oLi4uaG9zdEFyZ3MpO1xuICAgICAgcmVzb2x2ZXIucmVzb2x2ZShob3N0UHJvbWlzZSk7XG4gICAgfSBjYXRjaCAoaG9zdFByb2JsZW0pIHtcbiAgICAgIHRocm93IFBhbmljYGludGVybmFsOiBldmVudHVhbCBzZW5kIHN5bmNocm9ub3VzbHkgZmFpbGVkICR7aG9zdFByb2JsZW19YDtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGVudHJ5ID0gaGFyZGVuKFtcImRvUmV0dXJuXCIsIGNhbGxJbmRleCwgdm93XSk7XG4gICAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICAgIGNvbnN0IGd1ZXN0UHJvbWlzZSA9IG1ha2VHdWVzdEZvckhvc3RWb3codm93LCBndWVzdFJldHVybmVkUCk7XG4gICAgICBkb1JldHVybihjYWxsSW5kZXgsIHZvdyk7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAga2luZDogXCJyZXR1cm5cIixcbiAgICAgICAgcmVzdWx0OiBndWVzdFByb21pc2VcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKHByb2JsZW0pIHtcbiAgICAgIHRocm93IHBhbmljKHByb2JsZW0pO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgZ3Vlc3RIYW5kbGVyID0gaGFyZGVuKHtcbiAgICBhcHBseU1ldGhvZFNlbmRPbmx5KGd1ZXN0VGFyZ2V0LCBvcHRWZXJiLCBndWVzdEFyZ3MpIHtcbiAgICAgIF9fZXZlbnR1YWxTZW5kRm9yVGVzdGluZyB8fCBQYW5pY2BndWVzdCBldmVudHVhbCBhcHBseU1ldGhvZFNlbmRPbmx5IG5vdCB5ZXQgc3VwcG9ydGVkOiAke2d1ZXN0VGFyZ2V0fS4ke2JhcmVPclF1b3RlKG9wdFZlcmIpfWA7XG4gICAgICBjb25zdCBjYWxsSW5kZXggPSBsb2cuZ2V0SW5kZXgoKTtcbiAgICAgIGlmIChzdG9wcGVkIHx8ICFiaWplY3Rpb24uaGFzR3Vlc3QoZ3Vlc3RUYXJnZXQpKSB7XG4gICAgICAgIHRocm93UmVkYWN0ZWRgU2VudCBmcm9tIGEgcHJldmlvdXMgcnVuOiAke2d1ZXN0VGFyZ2V0fWA7XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBndWVzdEVudHJ5ID0gaGFyZGVuKFtcbiAgICAgICAgICBcImNoZWNrU2VuZE9ubHlcIixcbiAgICAgICAgICBndWVzdFRhcmdldCxcbiAgICAgICAgICBvcHRWZXJiLFxuICAgICAgICAgIGd1ZXN0QXJncyxcbiAgICAgICAgICBjYWxsSW5kZXhcbiAgICAgICAgXSk7XG4gICAgICAgIGlmIChsb2cuaXNSZXBsYXlpbmcoKSkge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gbG9nLm5leHRFbnRyeSgpO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBlcXVhdGUoZ3Vlc3RFbnRyeSwgZW50cnkpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVxdWF0ZUVycikge1xuICAgICAgICAgICAgdGhyb3dMYWJlbGVkKFxuICAgICAgICAgICAgICBlcXVhdGVFcnIsXG4gICAgICAgICAgICAgIGByZXBsYXkgJHtjYWxsSW5kZXh9OlxuICAgICAke3F1b3RlKGd1ZXN0RW50cnkpfVxuICB2cyAke3F1b3RlKGVudHJ5KX1cbiAgICBgXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBlbnRyeSA9IGd1ZXN0VG9Ib3N0KGd1ZXN0RW50cnkpO1xuICAgICAgICAgIGxvZy5wdXNoRW50cnkoZW50cnkpO1xuICAgICAgICAgIGNvbnN0IFtfb3AsIGhvc3RUYXJnZXQsIF9vcHRWZXJiLCBob3N0QXJncywgX2NhbGxJbmRleF0gPSBlbnRyeTtcbiAgICAgICAgICBwZXJmb3JtU2VuZE9ubHkoaG9zdFRhcmdldCwgb3B0VmVyYiwgaG9zdEFyZ3MpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChmYXRhbEVycm9yKSB7XG4gICAgICAgIHRocm93IHBhbmljKGZhdGFsRXJyb3IpO1xuICAgICAgfVxuICAgIH0sXG4gICAgYXBwbHlNZXRob2QoZ3Vlc3RUYXJnZXQsIG9wdFZlcmIsIGd1ZXN0QXJncywgZ3Vlc3RSZXR1cm5lZFApIHtcbiAgICAgIF9fZXZlbnR1YWxTZW5kRm9yVGVzdGluZyB8fCBQYW5pY2BndWVzdCBldmVudHVhbCBhcHBseU1ldGhvZCBub3QgeWV0IHN1cHBvcnRlZDogJHtndWVzdFRhcmdldH0uJHtiYXJlT3JRdW90ZShvcHRWZXJiKX0gLT4gJHtiYXJlT3JRdW90ZShndWVzdFJldHVybmVkUCl9YDtcbiAgICAgIGNvbnN0IGNhbGxJbmRleCA9IGxvZy5nZXRJbmRleCgpO1xuICAgICAgaWYgKHN0b3BwZWQgfHwgIWJpamVjdGlvbi5oYXNHdWVzdChndWVzdFRhcmdldCkpIHtcbiAgICAgICAgdGhyb3dSZWRhY3RlZGBTZW50IGZyb20gYSBwcmV2aW91cyBydW46ICR7Z3Vlc3RUYXJnZXR9YDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGhvc3RSZXN1bHRLaXQgPSBtYWtlVm93S2l0KCk7XG4gICAgICBjb25zdCBnMyA9IGJpamVjdGlvbi51bndyYXBJbml0KGd1ZXN0UmV0dXJuZWRQLCBob3N0UmVzdWx0S2l0LnZvdyk7XG4gICAgICBnMyA9PT0gZ3Vlc3RSZXR1cm5lZFAgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogZ3Vlc3RSZXR1cm5lZFAgc2hvdWxkIG5vdCB1bndyYXA6ICR7ZzN9IHZzICR7Z3Vlc3RSZXR1cm5lZFB9YDtcbiAgICAgIGxldCBvdXRjb21lO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZ3Vlc3RFbnRyeSA9IGhhcmRlbihbXG4gICAgICAgICAgXCJjaGVja1NlbmRcIixcbiAgICAgICAgICBndWVzdFRhcmdldCxcbiAgICAgICAgICBvcHRWZXJiLFxuICAgICAgICAgIGd1ZXN0QXJncyxcbiAgICAgICAgICBjYWxsSW5kZXhcbiAgICAgICAgXSk7XG4gICAgICAgIGlmIChsb2cuaXNSZXBsYXlpbmcoKSkge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gbG9nLm5leHRFbnRyeSgpO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBlcXVhdGUoZ3Vlc3RFbnRyeSwgZW50cnkpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVxdWF0ZUVycikge1xuICAgICAgICAgICAgdGhyb3dMYWJlbGVkKFxuICAgICAgICAgICAgICBlcXVhdGVFcnIsXG4gICAgICAgICAgICAgIGByZXBsYXkgJHtjYWxsSW5kZXh9OlxuICAgICAke3F1b3RlKGd1ZXN0RW50cnkpfVxuICB2cyAke3F1b3RlKGVudHJ5KX1cbiAgICBgXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBvdXRjb21lID0gLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG5lc3RJbnRlcnByZXRlcihjYWxsSW5kZXgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGVudHJ5ID0gZ3Vlc3RUb0hvc3QoZ3Vlc3RFbnRyeSk7XG4gICAgICAgICAgbG9nLnB1c2hFbnRyeShlbnRyeSk7XG4gICAgICAgICAgY29uc3QgW19vcCwgaG9zdFRhcmdldCwgX29wdFZlcmIsIGhvc3RBcmdzLCBfY2FsbEluZGV4XSA9IGVudHJ5O1xuICAgICAgICAgIG5lc3RJbnRlcnByZXRlcihjYWxsSW5kZXgpO1xuICAgICAgICAgIG91dGNvbWUgPSBwZXJmb3JtU2VuZChcbiAgICAgICAgICAgIGhvc3RUYXJnZXQsXG4gICAgICAgICAgICBvcHRWZXJiLFxuICAgICAgICAgICAgaG9zdEFyZ3MsXG4gICAgICAgICAgICBjYWxsSW5kZXgsXG4gICAgICAgICAgICBob3N0UmVzdWx0S2l0LFxuICAgICAgICAgICAgZ3Vlc3RSZXR1cm5lZFBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChmYXRhbEVycm9yKSB7XG4gICAgICAgIHRocm93IHBhbmljKGZhdGFsRXJyb3IpO1xuICAgICAgfVxuICAgICAgc3dpdGNoIChvdXRjb21lLmtpbmQpIHtcbiAgICAgICAgY2FzZSBcInJldHVyblwiOiB7XG4gICAgICAgICAgcmV0dXJuIG91dGNvbWUucmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgXCJ0aHJvd1wiOiB7XG4gICAgICAgICAgdGhyb3cgb3V0Y29tZS5wcm9ibGVtO1xuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgICB0aHJvdyBQYW5pY2B1bmV4cGVjdGVkIG91dGNvbWUga2luZCAke3F1b3RlKG91dGNvbWUua2luZCl9YDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgYXBwbHlGdW5jdGlvblNlbmRPbmx5KGd1ZXN0VGFyZ2V0LCBndWVzdEFyZ3MpIHtcbiAgICAgIF9fZXZlbnR1YWxTZW5kRm9yVGVzdGluZyB8fCBQYW5pY2BndWVzdCBldmVudHVhbCBhcHBseUZ1bmN0aW9uU2VuZE9ubHkgbm90IHlldCBzdXBwb3J0ZWQ6ICR7Z3Vlc3RUYXJnZXR9YDtcbiAgICAgIHJldHVybiBndWVzdEhhbmRsZXIuYXBwbHlNZXRob2RTZW5kT25seShcbiAgICAgICAgZ3Vlc3RUYXJnZXQsXG4gICAgICAgIHZvaWQgMCxcbiAgICAgICAgZ3Vlc3RBcmdzXG4gICAgICApO1xuICAgIH0sXG4gICAgYXBwbHlGdW5jdGlvbihndWVzdFRhcmdldCwgZ3Vlc3RBcmdzLCBndWVzdFJldHVybmVkUCkge1xuICAgICAgX19ldmVudHVhbFNlbmRGb3JUZXN0aW5nIHx8IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGFwcGx5RnVuY3Rpb24gbm90IHlldCBzdXBwb3J0ZWQ6ICR7Z3Vlc3RUYXJnZXR9IC0+ICR7YmFyZU9yUXVvdGUoZ3Vlc3RSZXR1cm5lZFApfWA7XG4gICAgICByZXR1cm4gZ3Vlc3RIYW5kbGVyLmFwcGx5TWV0aG9kKFxuICAgICAgICBndWVzdFRhcmdldCxcbiAgICAgICAgdm9pZCAwLFxuICAgICAgICBndWVzdEFyZ3MsXG4gICAgICAgIGd1ZXN0UmV0dXJuZWRQXG4gICAgICApO1xuICAgIH0sXG4gICAgZ2V0U2VuZE9ubHkoZ3Vlc3RUYXJnZXQsIHByb3ApIHtcbiAgICAgIHRocm93IFBhbmljYGd1ZXN0IGV2ZW50dWFsIGdldFNlbmRPbmx5IG5vdCB5ZXQgc3VwcG9ydGVkOiAke2d1ZXN0VGFyZ2V0fS4ke2JhcmVPclF1b3RlKHByb3ApfWA7XG4gICAgfSxcbiAgICBnZXQoZ3Vlc3RUYXJnZXQsIHByb3AsIGd1ZXN0UmV0dXJuZWRQKSB7XG4gICAgICB0aHJvdyBQYW5pY2BndWVzdCBldmVudHVhbCBnZXQgbm90IHlldCBzdXBwb3J0ZWQ6ICR7Z3Vlc3RUYXJnZXR9LiR7YmFyZU9yUXVvdGUocHJvcCl9IC0+ICR7YmFyZU9yUXVvdGUoZ3Vlc3RSZXR1cm5lZFApfWA7XG4gICAgfVxuICB9KTtcbiAgY29uc3QgbWFrZUd1ZXN0UHJlc2VuY2UgPSAoaWZhY2UsIG1ldGhvZEVudHJpZXMpID0+IHtcbiAgICBsZXQgZ3Vlc3RQcmVzZW5jZTtcbiAgICB2b2lkIG5ldyBIYW5kbGVkUHJvbWlzZSgoX3JlcywgX3JlaiwgcmVzb2x2ZVdpdGhQcmVzZW5jZSkgPT4ge1xuICAgICAgZ3Vlc3RQcmVzZW5jZSA9IHJlc29sdmVXaXRoUHJlc2VuY2UoZ3Vlc3RIYW5kbGVyKTtcbiAgICB9KTtcbiAgICBpZiAodHlwZW9mIGd1ZXN0UHJlc2VuY2UgIT09IFwib2JqZWN0XCIpIHtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgcHJlc2VuY2UgZXhwZWN0ZWQgdG8gYmUgb2JqZWN0ICR7Z3Vlc3RQcmVzZW5jZX1gO1xuICAgIH1cbiAgICBhc3NpZ24zKGd1ZXN0UHJlc2VuY2UsIGZyb21FbnRyaWVzMTMobWV0aG9kRW50cmllcykpO1xuICAgIGNvbnN0IHJlc3VsdCA9IFJlbW90YWJsZShpZmFjZSwgdm9pZCAwLCBndWVzdFByZXNlbmNlKTtcbiAgICByZXN1bHQgPT09IGd1ZXN0UHJlc2VuY2UgfHwgdGhyb3dSZWRhY3RlZGBSZW1vdGFibGUgZXhwZWN0ZWQgdG8gbWFrZSBwcmVzZW5jZSBpbiBwbGFjZTogJHtndWVzdFByZXNlbmNlfSB2cyAke3Jlc3VsdH1gO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG4gIGNvbnN0IG1ha2VHdWVzdFByb21pc2VLaXQgPSAoKSA9PiB7XG4gICAgbGV0IHJlc29sdmUyO1xuICAgIGxldCByZWplY3Q7XG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBIYW5kbGVkUHJvbWlzZSgocmVzLCByZWosIF9yZXNQcmVzKSA9PiB7XG4gICAgICByZXNvbHZlMiA9IHJlcztcbiAgICAgIHJlamVjdCA9IHJlajtcbiAgICB9LCBndWVzdEhhbmRsZXIpO1xuICAgIHJldHVybiBoYXJkZW4oeyBwcm9taXNlLCByZXNvbHZlOiByZXNvbHZlMiwgcmVqZWN0IH0pO1xuICB9O1xuICBjb25zdCBtYWtlR3Vlc3RGb3JIb3N0UmVtb3RhYmxlID0gKGhSZW0pID0+IHtcbiAgICBsZXQgZ1JlbTtcbiAgICBjb25zdCBtYWtlR3Vlc3RNZXRob2QgPSAob3B0VmVyYiA9IHZvaWQgMCkgPT4ge1xuICAgICAgY29uc3QgZ3Vlc3RNZXRob2QgPSAoLi4uZ3Vlc3RBcmdzKSA9PiB7XG4gICAgICAgIGNvbnN0IGNhbGxJbmRleCA9IGxvZy5nZXRJbmRleCgpO1xuICAgICAgICByZXR1cm4gZ3Vlc3RDYWxsc0hvc3QoZ1JlbSwgb3B0VmVyYiwgZ3Vlc3RBcmdzLCBjYWxsSW5kZXgpO1xuICAgICAgfTtcbiAgICAgIGlmIChvcHRWZXJiKSB7XG4gICAgICAgIGRlZmluZVByb3BlcnRpZXM1KGd1ZXN0TWV0aG9kLCB7XG4gICAgICAgICAgbmFtZTogeyB2YWx1ZTogU3RyaW5nKGhSZW1bb3B0VmVyYl0ubmFtZSB8fCBvcHRWZXJiKSB9LFxuICAgICAgICAgIGxlbmd0aDogeyB2YWx1ZTogTnVtYmVyKGhSZW1bb3B0VmVyYl0ubGVuZ3RoIHx8IDApIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkZWZpbmVQcm9wZXJ0aWVzNShndWVzdE1ldGhvZCwge1xuICAgICAgICAgIG5hbWU6IHsgdmFsdWU6IFN0cmluZyhoUmVtLm5hbWUgfHwgXCJhbm9uXCIpIH0sXG4gICAgICAgICAgbGVuZ3RoOiB7IHZhbHVlOiBOdW1iZXIoaFJlbS5sZW5ndGggfHwgMCkgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBndWVzdE1ldGhvZDtcbiAgICB9O1xuICAgIGNvbnN0IGlmYWNlID0gU3RyaW5nKGdldEludGVyZmFjZU9mKGhSZW0pIHx8IFwicmVtb3RhYmxlXCIpO1xuICAgIGNvbnN0IGd1ZXN0SWZhY2UgPSBgJHtpZmFjZX0gZ3Vlc3Qgd3JhcHBlcmA7XG4gICAgaWYgKHR5cGVvZiBoUmVtID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIGdSZW0gPSBSZW1vdGFibGUoZ3Vlc3RJZmFjZSwgdm9pZCAwLCBtYWtlR3Vlc3RNZXRob2QoKSk7XG4gICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYGhvc3QgZmFyIGZ1bmN0aW9ucyBub3QgeWV0IHBhc3NhYmxlYDtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbWV0aG9kTmFtZXMgPSBnZXRNZXRob2ROYW1lcyhoUmVtKTtcbiAgICAgIGNvbnN0IGd1ZXN0TWV0aG9kcyA9IG1ldGhvZE5hbWVzLm1hcCgobmFtZSkgPT4gW1xuICAgICAgICBuYW1lLFxuICAgICAgICBtYWtlR3Vlc3RNZXRob2QobmFtZSlcbiAgICAgIF0pO1xuICAgICAgZ1JlbSA9IG1ha2VHdWVzdFByZXNlbmNlKGd1ZXN0SWZhY2UsIGd1ZXN0TWV0aG9kcyk7XG4gICAgfVxuICAgIGhSZW0gPSB2b2lkIDA7XG4gICAgcmV0dXJuIGdSZW07XG4gIH07XG4gIGhhcmRlbihtYWtlR3Vlc3RGb3JIb3N0UmVtb3RhYmxlKTtcbiAgY29uc3QgbWFrZUd1ZXN0Rm9ySG9zdFZvdyA9IChoVm93LCBwcm9taXNlS2V5ID0gdm9pZCAwKSA9PiB7XG4gICAgaXNWb3coaFZvdykgfHwgdGhyb3dSZWRhY3RlZGB2b3cgZXhwZWN0ZWQgJHtoVm93fWA7XG4gICAgY29uc3QgeyBwcm9taXNlLCByZXNvbHZlOiByZXNvbHZlMiwgcmVqZWN0IH0gPSBtYWtlR3Vlc3RQcm9taXNlS2l0KCk7XG4gICAgcHJvbWlzZUtleSA/Pz0gcHJvbWlzZTtcbiAgICBndWVzdFByb21pc2VNYXAuc2V0KHByb21pc2VLZXksIGhhcmRlbih7IHJlc29sdmU6IHJlc29sdmUyLCByZWplY3QgfSkpO1xuICAgIHdhdGNoV2FrZShoVm93KTtcbiAgICB2b2lkIHdoZW4oXG4gICAgICBoVm93LFxuICAgICAgYXN5bmMgKGhvc3RGdWxmaWxsbWVudCkgPT4ge1xuICAgICAgICBhd2FpdCBsb2cucHJvbWlzZVJlcGxheURvbmUoKTtcbiAgICAgICAgaWYgKCFzdG9wcGVkICYmIGd1ZXN0UHJvbWlzZU1hcC5nZXQocHJvbWlzZUtleSkgIT09IFwic2V0dGxlZFwiKSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBoYXJkZW4oW1wiZG9GdWxmaWxsXCIsIGhWb3csIGhvc3RGdWxmaWxsbWVudF0pO1xuICAgICAgICAgIGxvZy5wdXNoRW50cnkoZW50cnkpO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpbnRlcnByZXRPbmUodG9wRGlzcGF0Y2gsIGVudHJ5KTtcbiAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBhc3luYyAoaG9zdFJlYXNvbikgPT4ge1xuICAgICAgICBhd2FpdCBsb2cucHJvbWlzZVJlcGxheURvbmUoKTtcbiAgICAgICAgaWYgKCFzdG9wcGVkICYmIGd1ZXN0UHJvbWlzZU1hcC5nZXQocHJvbWlzZUtleSkgIT09IFwic2V0dGxlZFwiKSB7XG4gICAgICAgICAgY29uc3QgZW50cnkgPSBoYXJkZW4oW1wiZG9SZWplY3RcIiwgaFZvdywgaG9zdFJlYXNvbl0pO1xuICAgICAgICAgIGxvZy5wdXNoRW50cnkoZW50cnkpO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpbnRlcnByZXRPbmUodG9wRGlzcGF0Y2gsIGVudHJ5KTtcbiAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICAgIHJldHVybiBwcm9taXNlO1xuICB9O1xuICBoYXJkZW4obWFrZUd1ZXN0Rm9ySG9zdFZvdyk7XG4gIGNvbnN0IHsgZ3Vlc3RUb0hvc3QsIGhvc3RUb0d1ZXN0IH0gPSBtYWtlQ29udmVydEtpdChcbiAgICBiaWplY3Rpb24sXG4gICAgbWFrZUd1ZXN0Rm9ySG9zdFJlbW90YWJsZSxcbiAgICBtYWtlR3Vlc3RGb3JIb3N0Vm93XG4gICk7XG4gIGNvbnN0IHRvcERpc3BhdGNoID0gaGFyZGVuKHtcbiAgICBzdGFydEdlbmVyYXRpb24sXG4gICAgZG9GdWxmaWxsLFxuICAgIGRvUmVqZWN0XG4gICAgLy9cbiAgfSk7XG4gIGNvbnN0IG5lc3REaXNwYXRjaCA9IGhhcmRlbih7XG4gICAgZG9SZXR1cm4sXG4gICAgZG9UaHJvd1xuICAgIC8vXG4gIH0pO1xuICBjb25zdCBpbnRlcnByZXRPbmUgPSAoZGlzcGF0Y2gsIFtvcCwgLi4uYXJnc10pID0+IHtcbiAgICB0cnkge1xuICAgICAgb3AgaW4gZGlzcGF0Y2ggfHwgLy9cbiAgICAgIHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBkaXNwYXRjaCBvcDogJHtxdW90ZShvcCl9YDtcbiAgICAgIHJldHVybiBkaXNwYXRjaFtvcF0oLi4uYXJncyk7XG4gICAgfSBjYXRjaCAocHJvYmxlbSkge1xuICAgICAgdGhyb3cgcGFuaWMocHJvYmxlbSk7XG4gICAgfVxuICB9O1xuICBjb25zdCBsb2dEbyA9IChkaXNwYXRjaCwgZW50cnkpID0+IHtcbiAgICBsb2cucHVzaEVudHJ5KGVudHJ5KTtcbiAgICByZXR1cm4gaW50ZXJwcmV0T25lKGRpc3BhdGNoLCBlbnRyeSk7XG4gIH07XG4gIGNvbnN0IGNhbGxTdGFjayA9IFtdO1xuICBsZXQgdW5uZXN0RmxhZyA9IGZhbHNlO1xuICBjb25zdCBuZXN0SW50ZXJwcmV0ZXIgPSAoY2FsbEluZGV4KSA9PiB7XG4gICAgY2FsbFN0YWNrLnB1c2goY2FsbEluZGV4KTtcbiAgICB3aGlsZSAobG9nLmlzUmVwbGF5aW5nKCkgJiYgIXN0b3BwZWQpIHtcbiAgICAgIGNvbnN0IGVudHJ5ID0gbG9nLm5leHRVbmZpbHRlcmVkRW50cnkoKTtcbiAgICAgIGNvbnN0IG9wdE91dGNvbWUgPSBpbnRlcnByZXRPbmUobmVzdERpc3BhdGNoLCBlbnRyeSk7XG4gICAgICBpZiAodW5uZXN0RmxhZykge1xuICAgICAgICBvcHRPdXRjb21lIHx8IC8vXG4gICAgICAgIHRocm93UmVkYWN0ZWRgb25seSB1bm5lc3Qgd2l0aCBhbiBvdXRjb21lOiAke3F1b3RlKGVudHJ5WzBdKX1gO1xuICAgICAgICB1bm5lc3RGbGFnID0gZmFsc2U7XG4gICAgICAgIHJldHVybiBvcHRPdXRjb21lO1xuICAgICAgfVxuICAgIH1cbiAgICB1bm5lc3RGbGFnID0gZmFsc2U7XG4gIH07XG4gIGNvbnN0IHVubmVzdEludGVycHJldGVyID0gKGNhbGxJbmRleCkgPT4ge1xuICAgICFzdG9wcGVkIHx8IHRocm93UmVkYWN0ZWRgVGhpcyBtZW1icmFuZSBzdG9wcGVkLiBSZXN0YXJ0IHdpdGggbmV3IG1lbWJyYW5lICR7cmVwbGF5TWVtYnJhbmV9YDtcbiAgICBjYWxsU3RhY2subGVuZ3RoID49IDEgfHwgLy9cbiAgICB0aHJvd1JlZGFjdGVkYFVubWF0Y2hlZCB1bm5lc3Q6ICR7cXVvdGUoY2FsbEluZGV4KX1gO1xuICAgIGNvbnN0IGkyID0gY2FsbFN0YWNrLnBvcCgpO1xuICAgIGkyID09PSBjYWxsSW5kZXggfHwgLy9cbiAgICB0aHJvd1JlZGFjdGVkYFVuZXhwZWN0ZWQgdW5uZXN0OiAke3F1b3RlKGNhbGxJbmRleCl9IHZzICR7cXVvdGUoaTIpfWA7XG4gICAgdW5uZXN0RmxhZyA9IHRydWU7XG4gICAgaWYgKGNhbGxTdGFjay5sZW5ndGggPT09IDApIHtcbiAgICAgIHZvaWQgRS53aGVuKHZvaWQgMCwgd2FrZSk7XG4gICAgfVxuICB9O1xuICBjb25zdCB3YWtlID0gKCkgPT4ge1xuICAgIHdoaWxlIChsb2cuaXNSZXBsYXlpbmcoKSAmJiAhc3RvcHBlZCkge1xuICAgICAgY2FsbFN0YWNrLmxlbmd0aCA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYHdha2Ugb25seSB3aXRoIGVtcHR5IGNhbGxTdGFjazogJHtxdW90ZShjYWxsU3RhY2spfWA7XG4gICAgICBjb25zdCBlbnRyeSA9IGxvZy5wZWVrRW50cnkoKTtcbiAgICAgIGNvbnN0IG9wID0gZW50cnlbMF07XG4gICAgICBpZiAoIShvcCBpbiB0b3BEaXNwYXRjaCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdm9pZCBsb2cubmV4dFVuZmlsdGVyZWRFbnRyeSgpO1xuICAgICAgaW50ZXJwcmV0T25lKHRvcERpc3BhdGNoLCBlbnRyeSk7XG4gICAgfVxuICB9O1xuICBjb25zdCBzdG9wID0gKCkgPT4ge1xuICAgIHN0b3BwZWQgPSB0cnVlO1xuICB9O1xuICBjb25zdCByZXBsYXlNZW1icmFuZSA9IEZhcihcInJlcGxheU1lbWJyYW5lXCIsIHtcbiAgICBob3N0VG9HdWVzdCxcbiAgICBndWVzdFRvSG9zdCxcbiAgICB3YWtlLFxuICAgIHN0b3BcbiAgfSk7XG4gIHJldHVybiByZXBsYXlNZW1icmFuZTtcbn07XG5oYXJkZW4obWFrZVJlcGxheU1lbWJyYW5lKTtcblxuLy9cbnZhciBGbG93U3RhdGVTaGFwZSA9IE0ub3IoXG4gIFwiUnVubmluZ1wiLFxuICBcIlNsZWVwaW5nXCIsXG4gIFwiUmVwbGF5aW5nXCIsXG4gIFwiRmFpbGVkXCIsXG4gIFwiRG9uZVwiXG4pO1xudmFyIFByb3BlcnR5S2V5U2hhcGUgPSBNLm9yKE0uc3RyaW5nKCksIE0uc3ltYm9sKCkpO1xudmFyIExvZ0VudHJ5U2hhcGUgPSBNLm9yKFxuICBbXCJzdGFydEdlbmVyYXRpb25cIiwgTS5udW1iZXIoKV0sXG4gIC8vXG4gIFtcImRvRnVsZmlsbFwiLCBWb3dTaGFwZSwgTS5hbnkoKV0sXG4gIFtcImRvUmVqZWN0XCIsIFZvd1NoYXBlLCBNLmFueSgpXSxcbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgLy9cbiAgW1wiZG9SZXR1cm5cIiwgTS5udW1iZXIoKSwgTS5hbnkoKV0sXG4gIFtcImRvVGhyb3dcIiwgTS5udW1iZXIoKSwgTS5hbnkoKV0sXG4gIC8vXG4gIC8vXG4gIC8vXG4gIFtcbiAgICBcImNoZWNrQ2FsbFwiLFxuICAgIE0ucmVtb3RhYmxlKFwiaG9zdCB0YXJnZXRcIiksXG4gICAgTS5vcHQoUHJvcGVydHlLZXlTaGFwZSksXG4gICAgTS5hcnJheU9mKE0uYW55KCkpLFxuICAgIE0ubnVtYmVyKClcbiAgXSxcbiAgW1xuICAgIFwiY2hlY2tTZW5kT25seVwiLFxuICAgIE0ub3IoTS5yZW1vdGFibGUoXCJob3N0IHRhcmdldFwiKSwgVm93U2hhcGUpLFxuICAgIE0ub3B0KFByb3BlcnR5S2V5U2hhcGUpLFxuICAgIE0uYXJyYXlPZihNLmFueSgpKSxcbiAgICBNLm51bWJlcigpXG4gIF0sXG4gIFtcbiAgICBcImNoZWNrU2VuZFwiLFxuICAgIE0ub3IoTS5yZW1vdGFibGUoXCJob3N0IHRhcmdldFwiKSwgVm93U2hhcGUpLFxuICAgIE0ub3B0KFByb3BlcnR5S2V5U2hhcGUpLFxuICAgIE0uYXJyYXlPZihNLmFueSgpKSxcbiAgICBNLm51bWJlcigpXG4gIF1cbiAgLy9cbiAgLy9cbik7XG5cbi8vXG52YXIgbWFrZUVwaGVtZXJhID0gKHJlaW5pdCkgPT4ge1xuICBjb25zdCBtYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgZm9yKHNlbGYpIHtcbiAgICAgIGlmICghbWFwLmhhcyhzZWxmKSkge1xuICAgICAgICBtYXAuc2V0KHNlbGYsIHJlaW5pdChzZWxmKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gKFxuICAgICAgICAvKiAgICAgICAgICAgICovXG4gICAgICAgIG1hcC5nZXQoc2VsZilcbiAgICAgICk7XG4gICAgfSxcbiAgICByZXNldEZvcihzZWxmKSB7XG4gICAgICByZXR1cm4gbWFwLmRlbGV0ZShzZWxmKTtcbiAgICB9XG4gIH0pO1xufTtcbmhhcmRlbihtYWtlRXBoZW1lcmEpO1xuXG4vL1xudmFyIExvZ1N0b3JlSSA9IE0uaW50ZXJmYWNlKFwiTG9nU3RvcmVcIiwge1xuICByZXNldDogTS5jYWxsKCkucmV0dXJucygpLFxuICBkaXNwb3NlOiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gIGdldFVuZmlsdGVyZWRJbmRleDogTS5jYWxsKCkucmV0dXJucyhNLm51bWJlcigpKSxcbiAgZ2V0SW5kZXg6IE0uY2FsbCgpLnJldHVybnMoTS5udW1iZXIoKSksXG4gIGdldExlbmd0aDogTS5jYWxsKCkucmV0dXJucyhNLm51bWJlcigpKSxcbiAgaXNSZXBsYXlpbmc6IE0uY2FsbCgpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICBwZWVrRW50cnk6IE0uY2FsbCgpLnJldHVybnMoTG9nRW50cnlTaGFwZSksXG4gIG5leHRFbnRyeTogTS5jYWxsKCkucmV0dXJucyhMb2dFbnRyeVNoYXBlKSxcbiAgbmV4dFVuZmlsdGVyZWRFbnRyeTogTS5jYWxsKCkucmV0dXJucyhMb2dFbnRyeVNoYXBlKSxcbiAgcHVzaEVudHJ5OiBNLmNhbGwoTG9nRW50cnlTaGFwZSkucmV0dXJucyhNLm51bWJlcigpKSxcbiAgZHVtcFVuZmlsdGVyZWQ6IE0uY2FsbCgpLnJldHVybnMoTS5hcnJheU9mKExvZ0VudHJ5U2hhcGUpKSxcbiAgZHVtcDogTS5jYWxsKCkucmV0dXJucyhNLmFycmF5T2YoTG9nRW50cnlTaGFwZSkpLFxuICBwcm9taXNlUmVwbGF5RG9uZTogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSlcbn0pO1xudmFyIG5leHRHZW5lcmF0aW9uID0gKHpvbmUpID0+IHtcbiAgY29uc3QgbG9nU3RvcmVNZXRhZGF0YSA9IHpvbmUubWFwU3RvcmUoXCJMb2dTdG9yZU1ldGFkYXRhXCIpO1xuICBjb25zdCBnZW5lcmF0aW9uS2V5ID0gXCJnZW5lcmF0aW9uXCI7XG4gIGlmICghbG9nU3RvcmVNZXRhZGF0YS5oYXMoZ2VuZXJhdGlvbktleSkpIHtcbiAgICBjb25zdCBmaXJzdEdlbiA9IDA7XG4gICAgbG9nU3RvcmVNZXRhZGF0YS5pbml0KGdlbmVyYXRpb25LZXksIGZpcnN0R2VuKTtcbiAgICByZXR1cm4gZmlyc3RHZW47XG4gIH1cbiAgY29uc3QgbmV4dEdlbiA9IGxvZ1N0b3JlTWV0YWRhdGEuZ2V0KGdlbmVyYXRpb25LZXkpICsgMTtcbiAgbG9nU3RvcmVNZXRhZGF0YS5zZXQoZ2VuZXJhdGlvbktleSwgbmV4dEdlbik7XG4gIHJldHVybiBuZXh0R2VuO1xufTtcbnZhciBwcmVwYXJlTG9nU3RvcmUgPSAoem9uZSkgPT4ge1xuICBjb25zdCBpbml0aWFsUHVzaCA9IGhhcmRlbihbW1wic3RhcnRHZW5lcmF0aW9uXCIsIG5leHRHZW5lcmF0aW9uKHpvbmUpXV0pO1xuICBjb25zdCBlbnRyeUlzVmlzaWJsZSA9IChlbnRyeSkgPT4gZW50cnlbMF0gIT09IFwic3RhcnRHZW5lcmF0aW9uXCI7XG4gIGNvbnN0IHRtcCA9IG1ha2VFcGhlbWVyYSgobG9nKSA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0ge1xuICAgICAgaW5kZXg6IDAsXG4gICAgICB1bmZpbHRlcmVkSW5kZXg6IDAsXG4gICAgICBpbml0aWFsUHVzaCxcbiAgICAgIHJlcGxheURvbmVLaXQ6IG1ha2VQcm9taXNlS2l0KClcbiAgICB9O1xuICAgIGlmIChsb2cuZ2V0TGVuZ3RoKCkgPT09IDApIHtcbiAgICAgIHJlc3VsdC5yZXBsYXlEb25lS2l0LnJlc29sdmUodm9pZCAwKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSk7XG4gIHJldHVybiB6b25lLmV4b0NsYXNzKFxuICAgIFwiTG9nU3RvcmVcIixcbiAgICBMb2dTdG9yZUksXG4gICAgKCkgPT4ge1xuICAgICAgY29uc3QgbWFwU3RvcmUgPSB6b25lLmRldGFjaGVkKCkubWFwU3RvcmUoXCJsb2dNYXBTdG9yZVwiLCB7XG4gICAgICAgIGtleVNoYXBlOiBNLm51bWJlcigpLFxuICAgICAgICB2YWx1ZVNoYXBlOiBMb2dFbnRyeVNoYXBlXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1hcFN0b3JlXG4gICAgICB9O1xuICAgIH0sXG4gICAge1xuICAgICAgcmVzZXQoKSB7XG4gICAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgdG1wLnJlc2V0Rm9yKHNlbGYpO1xuICAgICAgfSxcbiAgICAgIGRpc3Bvc2UoKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUsIHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbWFwU3RvcmUgfSA9IHN0YXRlO1xuICAgICAgICB0bXAucmVzZXRGb3Ioc2VsZik7XG4gICAgICAgIG1hcFN0b3JlLmNsZWFyKCk7XG4gICAgICB9LFxuICAgICAgZ2V0VW5maWx0ZXJlZEluZGV4KCkge1xuICAgICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGVwaCA9IHRtcC5mb3Ioc2VsZik7XG4gICAgICAgIHJldHVybiBlcGgudW5maWx0ZXJlZEluZGV4O1xuICAgICAgfSxcbiAgICAgIGdldEluZGV4KCkge1xuICAgICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGVwaCA9IHRtcC5mb3Ioc2VsZik7XG4gICAgICAgIHJldHVybiBlcGguaW5kZXg7XG4gICAgICB9LFxuICAgICAgZ2V0TGVuZ3RoKCkge1xuICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IG1hcFN0b3JlIH0gPSBzdGF0ZTtcbiAgICAgICAgcmV0dXJuIG1hcFN0b3JlLmdldFNpemUoKTtcbiAgICAgIH0sXG4gICAgICBpc1JlcGxheWluZygpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSwgc2VsZiB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBtYXBTdG9yZSB9ID0gc3RhdGU7XG4gICAgICAgIGNvbnN0IGVwaCA9IHRtcC5mb3Ioc2VsZik7XG4gICAgICAgIHJldHVybiBlcGgudW5maWx0ZXJlZEluZGV4IDwgbWFwU3RvcmUuZ2V0U2l6ZSgpO1xuICAgICAgfSxcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgcGVla0VudHJ5KCkge1xuICAgICAgICBjb25zdCB7IHN0YXRlLCBzZWxmIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IG1hcFN0b3JlIH0gPSBzdGF0ZTtcbiAgICAgICAgY29uc3QgZXBoID0gdG1wLmZvcihzZWxmKTtcbiAgICAgICAgc2VsZi5pc1JlcGxheWluZygpIHx8IHRocm93UmVkYWN0ZWRgTm8gbG9uZ2VyIHJlcGxheWluZzogJHtxdW90ZShlcGgudW5maWx0ZXJlZEluZGV4KX0gdnMgJHtxdW90ZShcbiAgICAgICAgICBtYXBTdG9yZS5nZXRTaXplKClcbiAgICAgICAgKX1gO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBtYXBTdG9yZS5nZXQoZXBoLnVuZmlsdGVyZWRJbmRleCk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9LFxuICAgICAgLypcblxuICAgICAgICovXG4gICAgICBuZXh0VW5maWx0ZXJlZEVudHJ5KCkge1xuICAgICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGVwaCA9IHRtcC5mb3Ioc2VsZik7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHNlbGYucGVla0VudHJ5KCk7XG4gICAgICAgIGVwaC51bmZpbHRlcmVkSW5kZXggKz0gMTtcbiAgICAgICAgaWYgKGVudHJ5SXNWaXNpYmxlKHJlc3VsdCkpIHtcbiAgICAgICAgICBlcGguaW5kZXggKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXNlbGYuaXNSZXBsYXlpbmcoKSkge1xuICAgICAgICAgIGVwaC5yZXBsYXlEb25lS2l0LnJlc29sdmUodm9pZCAwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSxcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgbmV4dEVudHJ5KCkge1xuICAgICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIGxldCByZXN1bHQgPSBzZWxmLm5leHRVbmZpbHRlcmVkRW50cnkoKTtcbiAgICAgICAgd2hpbGUgKCFlbnRyeUlzVmlzaWJsZShyZXN1bHQpKSB7XG4gICAgICAgICAgc2VsZi5pc1JlcGxheWluZygpIHx8IHRocm93UmVkYWN0ZWRgVW5leHBlY3RlZCBlbnRyeSBhdCBsb2cgdGFpbDogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXN1bHQgPSBzZWxmLm5leHRVbmZpbHRlcmVkRW50cnkoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfSxcbiAgICAgIC8qXG5cbiAgICAgICAqL1xuICAgICAgcHVzaEVudHJ5KGxhdGVzdEVudHJ5KSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUsIHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgbWFwU3RvcmUgfSA9IHN0YXRlO1xuICAgICAgICBjb25zdCBlcGggPSB0bXAuZm9yKHNlbGYpO1xuICAgICAgICAhc2VsZi5pc1JlcGxheWluZygpIHx8IHRocm93UmVkYWN0ZWRgc3RpbGwgcmVwbGF5aW5nOiAke3F1b3RlKGVwaC51bmZpbHRlcmVkSW5kZXgpfSB2cyAke3F1b3RlKG1hcFN0b3JlLmdldFNpemUoKSl9YDtcbiAgICAgICAgY29uc3QgcHVzaE9uZSA9IChlbnRyeSkgPT4ge1xuICAgICAgICAgIGVwaC51bmZpbHRlcmVkSW5kZXggPT09IG1hcFN0b3JlLmdldFNpemUoKSB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiB1bmZpbHRlcmVkSW5kZXggY29uZnVzaW9uICR7cXVvdGUoZXBoLnVuZmlsdGVyZWRJbmRleCl9IHZzICR7cXVvdGUoXG4gICAgICAgICAgICBtYXBTdG9yZS5nZXRTaXplKClcbiAgICAgICAgICApfWA7XG4gICAgICAgICAgbWFwU3RvcmUuaW5pdChlcGgudW5maWx0ZXJlZEluZGV4LCBlbnRyeSk7XG4gICAgICAgICAgZXBoLnVuZmlsdGVyZWRJbmRleCArPSAxO1xuICAgICAgICAgIGlmIChlbnRyeUlzVmlzaWJsZShlbnRyeSkpIHtcbiAgICAgICAgICAgIGVwaC5pbmRleCArPSAxO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlcGgudW5maWx0ZXJlZEluZGV4ID09PSBtYXBTdG9yZS5nZXRTaXplKCkgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogdW5maWx0ZXJlZEluZGV4IGNvbmZ1c2lvbiAke3F1b3RlKGVwaC51bmZpbHRlcmVkSW5kZXgpfSB2cyAke3F1b3RlKFxuICAgICAgICAgICAgbWFwU3RvcmUuZ2V0U2l6ZSgpXG4gICAgICAgICAgKX1gO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoZXBoLmluaXRpYWxQdXNoKSB7XG4gICAgICAgICAgY29uc3QgaW5pdGlhbEVudHJpZXMgPSBlcGguaW5pdGlhbFB1c2g7XG4gICAgICAgICAgZXBoLmluaXRpYWxQdXNoID0gdm9pZCAwO1xuICAgICAgICAgIGZvciAoY29uc3QgaW5pdGlhbEVudHJ5IG9mIGluaXRpYWxFbnRyaWVzKSB7XG4gICAgICAgICAgICBwdXNoT25lKGluaXRpYWxFbnRyeSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHB1c2hPbmUobGF0ZXN0RW50cnkpO1xuICAgICAgICByZXR1cm4gZXBoLnVuZmlsdGVyZWRJbmRleDtcbiAgICAgIH0sXG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIGR1bXBVbmZpbHRlcmVkKCkge1xuICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICBjb25zdCB7IG1hcFN0b3JlIH0gPSBzdGF0ZTtcbiAgICAgICAgY29uc3QgbGVuID0gbWFwU3RvcmUuZ2V0U2l6ZSgpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaTIgPSAwOyBpMiA8IGxlbjsgaTIgKz0gMSkge1xuICAgICAgICAgIHJlc3VsdC5wdXNoKG1hcFN0b3JlLmdldChpMikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBoYXJkZW4ocmVzdWx0KTtcbiAgICAgIH0sXG4gICAgICBkdW1wKCkge1xuICAgICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBoYXJkZW4oc2VsZi5kdW1wVW5maWx0ZXJlZCgpLmZpbHRlcihlbnRyeUlzVmlzaWJsZSkpO1xuICAgICAgfSxcbiAgICAgIHByb21pc2VSZXBsYXlEb25lKCkge1xuICAgICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGVwaCA9IHRtcC5mb3Ioc2VsZik7XG4gICAgICAgIHJldHVybiBlcGgucmVwbGF5RG9uZUtpdC5wcm9taXNlO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbn07XG5cbi8vXG52YXIgQmlqZWN0aW9uSSA9IE0uaW50ZXJmYWNlKFwiQmlqZWN0aW9uXCIsIHtcbiAgcmVzZXQ6IE0uY2FsbCgpLnJldHVybnMoKSxcbiAgdW53cmFwSW5pdDogTS5jYWxsKE0ucmF3KCksIE0uYW55KCkpLnJldHVybnMoTS5yYXcoKSksXG4gIGhhc0d1ZXN0OiBNLmNhbGwoTS5yYXcoKSkucmV0dXJucyhNLmJvb2xlYW4oKSksXG4gIGhhc0hvc3Q6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKE0uYm9vbGVhbigpKSxcbiAgaGFzOiBNLmNhbGwoTS5yYXcoKSwgTS5hbnkoKSkucmV0dXJucyhNLmJvb2xlYW4oKSksXG4gIGd1ZXN0VG9Ib3N0OiBNLmNhbGwoTS5yYXcoKSkucmV0dXJucyhNLmFueSgpKSxcbiAgaG9zdFRvR3Vlc3Q6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKE0ucmF3KCkpXG59KTtcbnZhciB0b0tleSA9IChrKSA9PiAoXG4gIC8vXG4gIGlzUGFzc2FibGUoaykgPyB0b1Bhc3NhYmxlQ2FwKGspIDoga1xuKTtcbnZhciBtYWtlVm93aXNoU3RvcmUgPSAobmFtZSkgPT4ge1xuICBjb25zdCBtYXAgPSAvKiAgICAgICAgICAgKi8gbmV3IE1hcCgpO1xuICByZXR1cm4gRmFyKG5hbWUsIHtcbiAgICBpbml0OiAoaywgdjMpID0+IHtcbiAgICAgIGNvbnN0IGsyID0gdG9LZXkoayk7XG4gICAgICAhbWFwLmhhcyhrMikgfHwgLy9cbiAgICAgIHRocm93UmVkYWN0ZWRgJHtiYXJlT3JRdW90ZShuYW1lKX0ga2V5IGFscmVhZHkgYm91bmQ6ICR7a30gLT4gJHttYXAuZ2V0KGsyKX0gdnMgJHt2M31gO1xuICAgICAgbWFwLnNldChrMiwgdjMpO1xuICAgIH0sXG4gICAgaGFzOiAoaykgPT4gbWFwLmhhcyh0b0tleShrKSksXG4gICAgZ2V0OiAoaykgPT4ge1xuICAgICAgY29uc3QgazIgPSB0b0tleShrKTtcbiAgICAgIG1hcC5oYXMoazIpIHx8IC8vXG4gICAgICB0aHJvd1JlZGFjdGVkYCR7YmFyZU9yUXVvdGUobmFtZSl9IGtleSBub3QgZm91bmQ6ICR7a31gO1xuICAgICAgcmV0dXJuIG1hcC5nZXQoazIpO1xuICAgIH1cbiAgfSk7XG59O1xudmFyIHByZXBhcmVCaWplY3Rpb24gPSAoem9uZSwgdW53cmFwID0gKF9ob3N0V3JhcHBlciwgZ3Vlc3RXcmFwcGVyKSA9PiBndWVzdFdyYXBwZXIpID0+IHtcbiAgY29uc3QgZzJoID0gbWFrZUVwaGVtZXJhKCgpID0+IG1ha2VWb3dpc2hTdG9yZShcImd1ZXN0VG9Ib3N0XCIpKTtcbiAgY29uc3QgaDJnID0gbWFrZUVwaGVtZXJhKCgpID0+IG1ha2VWb3dpc2hTdG9yZShcImhvc3RUb0d1ZXN0XCIpKTtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3MoXCJCaWplY3Rpb25cIiwgQmlqZWN0aW9uSSwgKCkgPT4gKHt9KSwge1xuICAgIHJlc2V0KCkge1xuICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgZzJoLnJlc2V0Rm9yKHNlbGYpO1xuICAgICAgaDJnLnJlc2V0Rm9yKHNlbGYpO1xuICAgIH0sXG4gICAgdW53cmFwSW5pdChnMywgaCkge1xuICAgICAgaGFyZGVuKGczKTtcbiAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgIGNvbnN0IGd1ZXN0VG9Ib3N0ID0gZzJoLmZvcihzZWxmKTtcbiAgICAgIGNvbnN0IGhvc3RUb0d1ZXN0ID0gaDJnLmZvcihzZWxmKTtcbiAgICAgIGNvbnN0IGdVbndyYXBwZWQgPSB1bndyYXAoaCwgZzMpO1xuICAgICAgIWhvc3RUb0d1ZXN0LmhhcyhoKSB8fCB0aHJvd1JlZGFjdGVkYGhvc3RUb0d1ZXN0IGtleSBhbHJlYWR5IGJvdW5kOiAke2h9IC0+ICR7aG9zdFRvR3Vlc3QuZ2V0KGgpfSB2cyAke2dVbndyYXBwZWR9YDtcbiAgICAgIGd1ZXN0VG9Ib3N0LmluaXQoZ1Vud3JhcHBlZCwgaCk7XG4gICAgICBob3N0VG9HdWVzdC5pbml0KGgsIGdVbndyYXBwZWQpO1xuICAgICAgc2VsZi5oYXMoZ1Vud3JhcHBlZCwgaCkgfHwgLy9cbiAgICAgIHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6ICR7ZzN9IDwtPiAke2h9YDtcbiAgICAgIGlmIChnMyAhPT0gZ1Vud3JhcHBlZCkge1xuICAgICAgICAhZ3Vlc3RUb0hvc3QuaGFzKGczKSB8fCAvL1xuICAgICAgICB0aHJvd1JlZGFjdGVkYGhpZGRlbiBndWVzdCB3cmFwcGVyIGFscmVhZHkgYm91bmQgJHtnM31gO1xuICAgICAgICBndWVzdFRvSG9zdC5pbml0KGczLCBoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBnVW53cmFwcGVkO1xuICAgIH0sXG4gICAgaGFzR3Vlc3QoZzMpIHtcbiAgICAgIGhhcmRlbihnMyk7XG4gICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICBjb25zdCBndWVzdFRvSG9zdCA9IGcyaC5mb3Ioc2VsZik7XG4gICAgICByZXR1cm4gZ3Vlc3RUb0hvc3QuaGFzKGczKTtcbiAgICB9LFxuICAgIGhhc0hvc3QoaCkge1xuICAgICAgY29uc3QgeyBzZWxmIH0gPSB0aGlzO1xuICAgICAgY29uc3QgaG9zdFRvR3Vlc3QgPSBoMmcuZm9yKHNlbGYpO1xuICAgICAgcmV0dXJuIGhvc3RUb0d1ZXN0LmhhcyhoKTtcbiAgICB9LFxuICAgIGhhcyhnMywgaCkge1xuICAgICAgaGFyZGVuKGczKTtcbiAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgIGNvbnN0IGd1ZXN0VG9Ib3N0ID0gZzJoLmZvcihzZWxmKTtcbiAgICAgIGNvbnN0IGhvc3RUb0d1ZXN0ID0gaDJnLmZvcihzZWxmKTtcbiAgICAgIGlmIChndWVzdFRvSG9zdC5oYXMoZzMpKSB7XG4gICAgICAgIHRvUGFzc2FibGVDYXAoZ3Vlc3RUb0hvc3QuZ2V0KGczKSkgPT09IHRvUGFzc2FibGVDYXAoaCkgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogZy0+aCAke2czfSAtPiAke2h9IHZzICR7Z3Vlc3RUb0hvc3QuZ2V0KGczKX1gO1xuICAgICAgICBob3N0VG9HdWVzdC5nZXQoaCkgPT09IGczIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWwgaC0+ZzogJHtofSAtPiAke2czfSB2cyAke2hvc3RUb0d1ZXN0LmdldChoKX1gO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICFob3N0VG9HdWVzdC5oYXMoaCkgfHwgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogdW5leHBlY3RlZCBoLT5nICR7aH0gLT4gJHtob3N0VG9HdWVzdC5nZXQoaCl9YDtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0sXG4gICAgZ3Vlc3RUb0hvc3QoZzMpIHtcbiAgICAgIGhhcmRlbihnMyk7XG4gICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXM7XG4gICAgICBjb25zdCBndWVzdFRvSG9zdCA9IGcyaC5mb3Ioc2VsZik7XG4gICAgICByZXR1cm4gZ3Vlc3RUb0hvc3QuZ2V0KGczKTtcbiAgICB9LFxuICAgIGhvc3RUb0d1ZXN0KGgpIHtcbiAgICAgIGNvbnN0IHsgc2VsZiB9ID0gdGhpcztcbiAgICAgIGNvbnN0IGhvc3RUb0d1ZXN0ID0gaDJnLmZvcihzZWxmKTtcbiAgICAgIHJldHVybiBob3N0VG9HdWVzdC5nZXQoaCk7XG4gICAgfVxuICB9KTtcbn07XG5oYXJkZW4ocHJlcGFyZUJpamVjdGlvbik7XG5cbi8vXG52YXIge1xuICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6IGdldE93blByb3BlcnR5RGVzY3JpcHRvcjMsXG4gIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM6IGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM5LFxuICBjcmVhdGU6IGNyZWF0ZTcsXG4gIGZyb21FbnRyaWVzOiBmcm9tRW50cmllczE0LFxuICBlbnRyaWVzOiBlbnRyaWVzOSxcbiAgcHJvdG90eXBlOiBvYmplY3RQcm90b3R5cGU2XG59ID0gT2JqZWN0O1xudmFyIHsgb3duS2V5czogb3duS2V5czIyIH0gPSBSZWZsZWN0O1xudmFyIEZ1bmN0aW9uV3JhcHBlckkgPSBNLmludGVyZmFjZShcIkZ1bmN0aW9uV3JhcHBlclwiLCB7XG4gIGFwcGx5OiBNLmNhbGwoTS5hcnJheSgpKS5yZXR1cm5zKE0uYW55KCkpXG59KTtcbnZhciBTdGF0ZUFjY2Vzc29ySSA9IE0uaW50ZXJmYWNlKFwiU3RhdGVBY2Nlc3NvclwiLCB7XG4gIGdldDogTS5jYWxsKFByb3BlcnR5S2V5U2hhcGUpLnJldHVybnMoTS5hbnkoKSksXG4gIHNldDogTS5jYWxsKFByb3BlcnR5S2V5U2hhcGUsIE0uYW55KCkpLnJldHVybnMoKVxufSk7XG52YXIgVW53cmFwcGVySSA9IE0uaW50ZXJmYWNlKFwiVW53cmFwcGVyXCIsIHtcbiAgdW53cmFwOiBNLmNhbGwoTS5yZW1vdGFibGUoXCJndWVzdFdyYXBwZWRcIikpLnJldHVybnMoTS5yYXcoKSlcbn0pO1xudmFyIGZvcndhcmRpbmdNZXRob2RzID0gKHJlbSkgPT4ge1xuICBjb25zdCBrZXlzNCA9IHJlbVtHRVRfTUVUSE9EX05BTUVTXSgpO1xuICBjb25zdCBtYWtlTWV0aG9kRW50cnkgPSAoa2V5KSA9PiBlbnRyaWVzOSh7XG4gICAgW2tleV0oLi4uYXJncykge1xuICAgICAgcmV0dXJuIHJlbVtrZXldKC4uLmFyZ3MpO1xuICAgIH1cbiAgfSlbMF07XG4gIHJldHVybiBmcm9tRW50cmllczE0KGtleXM0Lm1hcChtYWtlTWV0aG9kRW50cnkpKTtcbn07XG52YXIgcHJlcGFyZUVuZG93bWVudFRvb2xzID0gKG91dGVyWm9uZSwgb3V0ZXJPcHRpb25zID0ge30pID0+IHtcbiAgY29uc3QgeyB2b3dUb29scyA9IHByZXBhcmVTd2luZ3NldFZvd1Rvb2xzKG91dGVyWm9uZSkgfSA9IG91dGVyT3B0aW9ucztcbiAgY29uc3QgeyBtYWtlVm93S2l0IH0gPSB2b3dUb29scztcbiAgY29uc3QgZnVuY3Rpb25VbndyYXBwZXIgPSBvdXRlclpvbmUuZXhvKFwiRnVuY3Rpb25VbndyYXBwZXJcIiwgVW53cmFwcGVySSwge1xuICAgIHVud3JhcChndWVzdFdyYXBwZWQpIHtcbiAgICAgIHJldHVybiBGYXIoXCJVbndyYXBwZWRGdW5jdGlvblwiLCAoLi4uYXJncykgPT4gZ3Vlc3RXcmFwcGVkLmFwcGx5KGFyZ3MpKTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBtYWtlU3RhdGVVbndyYXBwZXIgPSBvdXRlclpvbmUuZXhvQ2xhc3MoXG4gICAgXCJTdGF0ZVVud3JhcHBlclwiLFxuICAgIFVud3JhcHBlckksXG4gICAgKGtleXM0KSA9PiAoeyBrZXlzOiBrZXlzNCB9KSxcbiAgICB7XG4gICAgICB1bndyYXAoZ3Vlc3RXcmFwcGVkKSB7XG4gICAgICAgIGNvbnN0IHsgc3RhdGUgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsga2V5czoga2V5czQgfSA9IHN0YXRlO1xuICAgICAgICByZXR1cm4gaGFyZGVuKFxuICAgICAgICAgIGNyZWF0ZTcoXG4gICAgICAgICAgICBvYmplY3RQcm90b3R5cGU2LFxuICAgICAgICAgICAgZnJvbUVudHJpZXMxNChcbiAgICAgICAgICAgICAga2V5czQuZmxhdE1hcChcbiAgICAgICAgICAgICAgICAoa2V5KSA9PiBlbnRyaWVzOShcbiAgICAgICAgICAgICAgICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnM5KHtcbiAgICAgICAgICAgICAgICAgICAgZ2V0IFtrZXldKCkge1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBndWVzdFdyYXBwZWQuZ2V0KGtleSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHNldCBba2V5XShuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgIGd1ZXN0V3JhcHBlZC5zZXQoa2V5LCBuZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgZW5kb3dtZW50S2luZE9mID0gKGUyKSA9PiB7XG4gICAgaGFyZGVuKGUyKTtcbiAgICBpZiAoaXNQcm9taXNlKGUyKSkge1xuICAgICAgcmV0dXJuIFwicHJvbWlzZVwiO1xuICAgIH0gZWxzZSBpZiAob3V0ZXJab25lLmlzU3RvcmFibGUoZTIpKSB7XG4gICAgICByZXR1cm4gXCJzdG9yYWJsZVwiO1xuICAgIH0gZWxzZSBpZiAoaXNQYXNzYWJsZShlMikgJiYgaXNSZW1vdGFibGUoZTIpKSB7XG4gICAgICByZXR1cm4gXCJmYXJcIjtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBlMiA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICByZXR1cm4gXCJmdW5jdGlvblwiO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGUyID09PSBcIm9iamVjdFwiKSB7XG4gICAgICBpZiAoZTIgPT09IG51bGwpIHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBpbnRlcm5hbDogbnVsbCBpcyBhbHdheXMgc3RvcmFibGVgO1xuICAgICAgfVxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZTIpKSB7XG4gICAgICAgIHJldHVybiBcImFycmF5XCI7XG4gICAgICB9XG4gICAgICBjb25zdCBrZXlzNCA9IG93bktleXMyMihlMik7XG4gICAgICBrZXlzNC5sZW5ndGggPj0gMSB8fCB0aHJvd1JlZGFjdGVkYGVtcHR5IHJlY29yZCBzaG91bGQgYmUgc3RvcmFibGUgJHtlMn1gO1xuICAgICAgY29uc3QgZGVzYyA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldE93blByb3BlcnR5RGVzY3JpcHRvcjMoZTIsIGtleXM0WzBdKVxuICAgICAgKTtcbiAgICAgIGlmIChcInZhbHVlXCIgaW4gZGVzYykge1xuICAgICAgICByZXR1cm4gXCJyZWNvcmRcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIFwiZ2V0XCIgaW4gZGVzYyB8fCB0aHJvd1JlZGFjdGVkYGludGVybmFsOiB1bmV4cGVjdGVkIGRlc2NyaXB0b3IgJHtkZXNjfWA7XG4gICAgICAgIHJldHVybiBcInN0YXRlXCI7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBlbmRvd21lbnQgJHtlMn1gO1xuICAgIH1cbiAgfTtcbiAgaGFyZGVuKGVuZG93bWVudEtpbmRPZik7XG4gIGNvbnN0IHVud3JhcE1hcCA9IG91dGVyWm9uZS53ZWFrTWFwU3RvcmUoXCJ1bndyYXBNYXBcIiwge1xuICAgIGtleVNoYXBlOiBNLnJlbW90YWJsZShcIndyYXBwZWRcIiksXG4gICAgdmFsdWVTaGFwZTogTS5yZW1vdGFibGUoXCJ1bndyYXBwZXJcIilcbiAgfSk7XG4gIGNvbnN0IHVud3JhcE1hcEhhcyA9IChrKSA9PiB7XG4gICAgaWYgKGlzVm93KGspIHx8IGlzUmVtb3RhYmxlKGspKSB7XG4gICAgICByZXR1cm4gdW53cmFwTWFwLmhhcyh0b1Bhc3NhYmxlQ2FwKGspKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgdW53cmFwTWFwR2V0ID0gKGspID0+IHVud3JhcE1hcC5nZXQodG9QYXNzYWJsZUNhcChrKSk7XG4gIGNvbnN0IHVud3JhcE1hcFNldCA9IChrLCB2MykgPT4ge1xuICAgIGNvbnN0IGsyID0gdG9QYXNzYWJsZUNhcChrKTtcbiAgICBpZiAodW53cmFwTWFwSGFzKGspKSB7XG4gICAgICB1bndyYXBNYXAuc2V0KGsyLCB2Myk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHVud3JhcE1hcC5pbml0KGsyLCB2Myk7XG4gICAgfVxuICB9O1xuICBjb25zdCBwcmVwYXJlRW5kb3dtZW50ID0gKHpvbmUsIHRhZywgZTIpID0+IHtcbiAgICBjb25zdCBlS2luZCA9IGVuZG93bWVudEtpbmRPZihlMik7XG4gICAgc3dpdGNoIChlS2luZCkge1xuICAgICAgY2FzZSBcInByb21pc2VcIjoge1xuICAgICAgICBjb25zdCBwMyA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgZTJcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgeyB2b3csIHJlc29sdmVyIH0gPSBtYWtlVm93S2l0KCk7XG4gICAgICAgIHZvaWQgRS53aGVuKFxuICAgICAgICAgIHAzLFxuICAgICAgICAgICh2MykgPT4ge1xuICAgICAgICAgICAgcmVzb2x2ZXIucmVzb2x2ZSh2Myk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAocmVhc29uKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWlzVXBncmFkZURpc2Nvbm5lY3Rpb24ocmVhc29uKSkge1xuICAgICAgICAgICAgICByZXNvbHZlci5yZWplY3QocmVhc29uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB2b3c7XG4gICAgICB9XG4gICAgICBjYXNlIFwic3RvcmFibGVcIjoge1xuICAgICAgICByZXR1cm4gZTI7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZmFyXCI6IHtcbiAgICAgICAgY29uc3QgcjUgPSAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgZTJcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgbWV0aG9kcyA9IGZvcndhcmRpbmdNZXRob2RzKHI1KTtcbiAgICAgICAgcmV0dXJuIHpvbmUuZXhvKFxuICAgICAgICAgIHRhZyxcbiAgICAgICAgICBNLmludGVyZmFjZShcIkZhcldyYXBwZWRcIiwge30sIHsgZGVmYXVsdEd1YXJkczogXCJyYXdcIiB9KSxcbiAgICAgICAgICBtZXRob2RzXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjYXNlIFwiZnVuY3Rpb25cIjoge1xuICAgICAgICBjb25zdCBmMiA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGUyXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHdyYXBwZWQgPSB6b25lLmV4byh0YWcsIEZ1bmN0aW9uV3JhcHBlckksIHtcbiAgICAgICAgICBhcHBseShhcmdzKSB7XG4gICAgICAgICAgICByZXR1cm4gZjIoLi4uYXJncyk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdW53cmFwTWFwU2V0KHdyYXBwZWQsIGZ1bmN0aW9uVW53cmFwcGVyKTtcbiAgICAgICAgcmV0dXJuIHdyYXBwZWQ7XG4gICAgICB9XG4gICAgICBjYXNlIFwiYXJyYXlcIjoge1xuICAgICAgICBjb25zdCBhMiA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBlMlxuICAgICAgICApO1xuICAgICAgICBjb25zdCBzdWJab25lID0gem9uZS5zdWJab25lKHRhZyk7XG4gICAgICAgIHJldHVybiBhMi5tYXAoKHN1YkUsIGkyKSA9PiBwcmVwYXJlRW5kb3dtZW50KHN1YlpvbmUsIGAke2kyfWAsIHN1YkUpKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJyZWNvcmRcIjoge1xuICAgICAgICBjb25zdCByNSA9IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgZTJcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3Qgc3ViWm9uZSA9IHpvbmUuc3ViWm9uZSh0YWcpO1xuICAgICAgICByZXR1cm4gb2JqZWN0TWFwKFxuICAgICAgICAgIHI1LFxuICAgICAgICAgIChzdWJFLCBrKSA9PiBwcmVwYXJlRW5kb3dtZW50KHN1YlpvbmUsIFN0cmluZyhrKSwgc3ViRSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJzdGF0ZVwiOiB7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBlMlxuICAgICAgICApO1xuICAgICAgICBjb25zdCBrZXlzNCA9IGhhcmRlbihvd25LZXlzMjIoc3RhdGUpKTtcbiAgICAgICAgY29uc3Qgd3JhcHBlZCA9IHpvbmUuZXhvKHRhZywgU3RhdGVBY2Nlc3NvckksIHtcbiAgICAgICAgICBnZXQoa2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gc3RhdGVba2V5XTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldChrZXksIG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICBzdGF0ZVtrZXldID0gbmV3VmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3Qgc3RhdGVVbndyYXBwZXIgPSBtYWtlU3RhdGVVbndyYXBwZXIoa2V5czQpO1xuICAgICAgICB1bndyYXBNYXBTZXQod3JhcHBlZCwgc3RhdGVVbndyYXBwZXIpO1xuICAgICAgICByZXR1cm4gd3JhcHBlZDtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGB1bmV4cGVjdGVkIGVuZG93bWVudCAke2UyfWA7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCB1bndyYXAgPSAod3JhcHBlZCwgZ3Vlc3RXcmFwcGVkKSA9PiB7XG4gICAgaWYgKHVud3JhcE1hcEhhcyh3cmFwcGVkKSkge1xuICAgICAgY29uc3QgdW53cmFwcGVyID0gdW53cmFwTWFwR2V0KHdyYXBwZWQpO1xuICAgICAgcmV0dXJuIHVud3JhcHBlci51bndyYXAoZ3Vlc3RXcmFwcGVkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGd1ZXN0V3JhcHBlZDtcbiAgICB9XG4gIH07XG4gIHJldHVybiBoYXJkZW4oeyBwcmVwYXJlRW5kb3dtZW50LCB1bndyYXAgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVFbmRvd21lbnRUb29scyk7XG5cbi8vXG52YXIgeyBkZWZpbmVQcm9wZXJ0aWVzOiBkZWZpbmVQcm9wZXJ0aWVzNiB9ID0gT2JqZWN0O1xudmFyIEFzeW5jRmxvd0lLaXQgPSBoYXJkZW4oe1xuICBmbG93OiBNLmludGVyZmFjZShcIkZsb3dcIiwge1xuICAgIGdldEZsb3dTdGF0ZTogTS5jYWxsKCkucmV0dXJucyhGbG93U3RhdGVTaGFwZSksXG4gICAgcmVzdGFydDogTS5jYWxsKCkub3B0aW9uYWwoTS5ib29sZWFuKCkpLnJldHVybnMoKSxcbiAgICB3YWtlOiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gICAgZ2V0T3V0Y29tZTogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gICAgZHVtcDogTS5jYWxsKCkucmV0dXJucyhNLmFycmF5T2YoTG9nRW50cnlTaGFwZSkpLFxuICAgIGdldE9wdEZhdGFsUHJvYmxlbTogTS5jYWxsKCkucmV0dXJucyhNLm9wdChNLmVycm9yKCkpKVxuICB9KSxcbiAgYWRtaW46IE0uaW50ZXJmYWNlKFwiRmxvd0FkbWluXCIsIHtcbiAgICByZXNldDogTS5jYWxsKCkucmV0dXJucygpLFxuICAgIGNvbXBsZXRlOiBNLmNhbGwoKS5yZXR1cm5zKCksXG4gICAgcGFuaWM6IE0uY2FsbChNLmVycm9yKCkpLnJldHVybnMoTS5ub3QoTS5hbnkoKSkpXG4gICAgLy9cbiAgfSksXG4gIHdha2VXYXRjaGVyOiBQcm9taXNlV2F0Y2hlcklcbn0pO1xudmFyIEFkbWluQXN5bmNGbG93SSA9IE0uaW50ZXJmYWNlKFwiQXN5bmNGbG93QWRtaW5cIiwge1xuICBnZXRGYWlsdXJlczogTS5jYWxsKCkucmV0dXJucyhNLm1hcE9mKE0ucmVtb3RhYmxlKFwiYXN5bmNGbG93XCIpLCBNLmVycm9yKCkpKSxcbiAgd2FrZUFsbDogTS5jYWxsKCkucmV0dXJucygpLFxuICBnZXRGbG93Rm9yT3V0Y29tZVZvdzogTS5jYWxsKFZvd1NoYXBlKS5yZXR1cm5zKE0ub3B0KE0ucmVtb3RhYmxlKFwiZmxvd1wiKSkpXG59KTtcbnZhciBwcmVwYXJlQXN5bmNGbG93VG9vbHMgPSAob3V0ZXJab25lLCBvdXRlck9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgdm93VG9vbHMgPSBwcmVwYXJlU3dpbmdzZXRWb3dUb29scyhvdXRlclpvbmUpLFxuICAgIG1ha2VMb2dTdG9yZSA9IHByZXBhcmVMb2dTdG9yZShvdXRlclpvbmUpLFxuICAgIGVuZG93bWVudFRvb2xzOiB7IHByZXBhcmVFbmRvd21lbnQsIHVud3JhcCB9ID0gcHJlcGFyZUVuZG93bWVudFRvb2xzKFxuICAgICAgb3V0ZXJab25lLFxuICAgICAgeyB2b3dUb29scyB9XG4gICAgKSxcbiAgICBtYWtlQmlqZWN0aW9uID0gcHJlcGFyZUJpamVjdGlvbihvdXRlclpvbmUsIHVud3JhcCksXG4gICAgcGFuaWNIYW5kbGVyID0gKGVycikgPT4ge1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfSA9IG91dGVyT3B0aW9ucztcbiAgY29uc3QgeyB3YXRjaCwgbWFrZVZvd0tpdCB9ID0gdm93VG9vbHM7XG4gIGNvbnN0IGZhaWx1cmVzID0gb3V0ZXJab25lLm1hcFN0b3JlKFwiYXN5bmNGdW5jRmFpbHVyZXNcIiwge1xuICAgIGtleVNoYXBlOiBNLnJlbW90YWJsZShcImZsb3dcIiksXG4gICAgLy9cbiAgICB2YWx1ZVNoYXBlOiBNLmVycm9yKClcbiAgfSk7XG4gIGNvbnN0IGVhZ2VyV2FrZXJzID0gb3V0ZXJab25lLnNldFN0b3JlKGBhc3luY0Z1bmNFYWdlcldha2Vyc2AsIHtcbiAgICBrZXlTaGFwZTogTS5yZW1vdGFibGUoXCJmbG93XCIpXG4gICAgLy9cbiAgfSk7XG4gIGNvbnN0IG1lbWJyYW5lTWFwID0gbWFrZVNjYWxhcldlYWtNYXBTdG9yZShcIm1lbWJyYW5lRm9yXCIsIHtcbiAgICBrZXlTaGFwZTogTS5yZW1vdGFibGUoXCJmbG93XCIpLFxuICAgIHZhbHVlU2hhcGU6IE0ucmVtb3RhYmxlKFwibWVtYnJhbmVcIilcbiAgfSk7XG4gIGNvbnN0IGhhc01lbWJyYW5lID0gKGZsb3cpID0+IG1lbWJyYW5lTWFwLmhhcyhmbG93KTtcbiAgY29uc3QgZ2V0TWVtYnJhbmUgPSAoZmxvdykgPT4gbWVtYnJhbmVNYXAuZ2V0KGZsb3cpO1xuICBjb25zdCBpbml0TWVtYnJhbmUgPSAoZmxvdywgbWVtYnJhbmUpID0+IG1lbWJyYW5lTWFwLmluaXQoZmxvdywgbWVtYnJhbmUpO1xuICBjb25zdCBkZWxldGVNZW1icmFuZSA9IChmbG93KSA9PiBtZW1icmFuZU1hcC5kZWxldGUoZmxvdyk7XG4gIGNvbnN0IGZsb3dGb3JPdXRjb21lVm93S2V5ID0gb3V0ZXJab25lLm1hcFN0b3JlKFwiZmxvd0Zvck91dGNvbWVWb3dcIiwge1xuICAgIGtleVNoYXBlOiBNLnJlbW90YWJsZShcInRvUGFzc2FibGVDYXBcIiksXG4gICAgdmFsdWVTaGFwZTogTS5yZW1vdGFibGUoXCJmbG93XCIpXG4gICAgLy9cbiAgfSk7XG4gIGNvbnN0IHByZXBhcmVBc3luY0Zsb3dLaXQgPSAoem9uZSwgdGFnLCBndWVzdEFzeW5jRnVuYywgb3B0aW9ucyA9IHt9KSA9PiB7XG4gICAgdHlwZW9mIGd1ZXN0QXN5bmNGdW5jID09PSBcImZ1bmN0aW9uXCIgfHwgdGhyb3dSZWRhY3RlZGBndWVzdEFzeW5jRnVuYyBtdXN0IGJlIGEgY2FsbGFibGUgZnVuY3Rpb24gJHtndWVzdEFzeW5jRnVuY31gO1xuICAgIGNvbnN0IHtcbiAgICAgIC8vXG4gICAgICBzdGFydEVhZ2VyID0gdHJ1ZVxuICAgIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IGludGVybmFsTWFrZUFzeW5jRmxvd0tpdCA9IHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgICB0YWcsXG4gICAgICBBc3luY0Zsb3dJS2l0LFxuICAgICAgKGFjdGl2YXRpb25BcmdzKSA9PiB7XG4gICAgICAgIGhhcmRlbihhY3RpdmF0aW9uQXJncyk7XG4gICAgICAgIGNvbnN0IGxvZyA9IG1ha2VMb2dTdG9yZSgpO1xuICAgICAgICBjb25zdCBiaWplY3Rpb24gPSBtYWtlQmlqZWN0aW9uKCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYWN0aXZhdGlvbkFyZ3MsXG4gICAgICAgICAgLy9cbiAgICAgICAgICBsb2csXG4gICAgICAgICAgLy9cbiAgICAgICAgICBiaWplY3Rpb24sXG4gICAgICAgICAgLy9cbiAgICAgICAgICBvdXRjb21lS2l0OiBtYWtlVm93S2l0KCksXG4gICAgICAgICAgLy9cbiAgICAgICAgICBpc0RvbmU6IGZhbHNlXG4gICAgICAgICAgLy9cbiAgICAgICAgfTtcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGZsb3c6IHtcbiAgICAgICAgICAvKlxuXG4gICAgICAgICAgICovXG4gICAgICAgICAgZ2V0Rmxvd1N0YXRlKCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBsb2csIG91dGNvbWVLaXQsIGlzRG9uZSB9ID0gc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3cgfSA9IGZhY2V0cztcbiAgICAgICAgICAgIGlmIChpc0RvbmUpIHtcbiAgICAgICAgICAgICAgIWhhc01lbWJyYW5lKGZsb3cpIHx8IHRocm93UmVkYWN0ZWRgRG9uZSBmbG93IG11c3QgZHJvcCBtZW1icmFuZSAke2Zsb3d9ICR7Z2V0TWVtYnJhbmUoZmxvdyl9YDtcbiAgICAgICAgICAgICAgIWZhaWx1cmVzLmhhcyhmbG93KSB8fCB0aHJvd1JlZGFjdGVkYERvbmUgZmxvdyBtdXN0IG5vdCBiZSBpbiBmYWlsdXJlcyAke2Zsb3d9ICR7ZmFpbHVyZXMuZ2V0KGZsb3cpfWA7XG4gICAgICAgICAgICAgICFlYWdlcldha2Vycy5oYXMoZmxvdykgfHwgdGhyb3dSZWRhY3RlZGBEb25lIGZsb3cgbXVzdCBub3QgYmUgaW4gZWFnZXJXYWtlcnMgJHtmbG93fWA7XG4gICAgICAgICAgICAgICFmbG93Rm9yT3V0Y29tZVZvd0tleS5oYXMob3V0Y29tZUtpdC52b3cpIHx8IHRocm93UmVkYWN0ZWRgRG9uZSBmbG93IG11c3QgZHJvcCBmbG93IGxvb2t1cCBmcm9tIHZvdyAke291dGNvbWVLaXQudm93fWA7XG4gICAgICAgICAgICAgIGxvZy5nZXRJbmRleCgpID09PSAwICYmIGxvZy5nZXRMZW5ndGgoKSA9PT0gMCB8fCB0aHJvd1JlZGFjdGVkYERvbmUgZmxvdyBtdXN0IGVtcHR5IGxvZyAke2Zsb3d9ICR7bG9nfWA7XG4gICAgICAgICAgICAgIHJldHVybiBcIkRvbmVcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmYWlsdXJlcy5oYXMoZmxvdykpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFwiRmFpbGVkXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWhhc01lbWJyYW5lKGZsb3cpKSB7XG4gICAgICAgICAgICAgIGxvZy5nZXRJbmRleCgpID09PSAwIHx8IHRocm93UmVkYWN0ZWRgU2xlZXBpbmcgZmxvdyBtdXN0IHBsYXkgZnJvbSBsb2cgc3RhcnQgJHtmbG93fSAke2xvZy5nZXRJbmRleCgpfWA7XG4gICAgICAgICAgICAgIHJldHVybiBcIlNsZWVwaW5nXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobG9nLmlzUmVwbGF5aW5nKCkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFwiUmVwbGF5aW5nXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gXCJSdW5uaW5nXCI7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAvKlxuXG5cblxuXG4gICAgICAgICAgICovXG4gICAgICAgICAgcmVzdGFydChlYWdlciA9IHN0YXJ0RWFnZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc3RhdGUsIGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgYWN0aXZhdGlvbkFyZ3MsIGxvZywgYmlqZWN0aW9uLCBvdXRjb21lS2l0IH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdywgYWRtaW4sIHdha2VXYXRjaGVyIH0gPSBmYWNldHM7XG4gICAgICAgICAgICBjb25zdCBzdGFydEZsb3dTdGF0ZSA9IGZsb3cuZ2V0Rmxvd1N0YXRlKCk7XG4gICAgICAgICAgICBzdGFydEZsb3dTdGF0ZSAhPT0gXCJEb25lXCIgfHwgLy9cbiAgICAgICAgICAgIHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlc3RhcnQgYSBkb25lIGZsb3cgJHtmbG93fWA7XG4gICAgICAgICAgICBhZG1pbi5yZXNldCgpO1xuICAgICAgICAgICAgaWYgKGVhZ2VyKSB7XG4gICAgICAgICAgICAgIGVhZ2VyV2FrZXJzLmFkZChmbG93KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZWFnZXJXYWtlcnMuaGFzKGZsb3cpKSB7XG4gICAgICAgICAgICAgIGVhZ2VyV2FrZXJzLmRlbGV0ZShmbG93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHdhdGNoV2FrZSA9ICh2b3dpc2gpID0+IHtcbiAgICAgICAgICAgICAgem9uZS5pc1N0b3JhYmxlKHZvd2lzaCkgfHwgdGhyb3dSZWRhY3RlZGB2b3dpc2ggbXVzdCBiZSBzdG9yYWJsZSBpbiB0aGlzIHpvbmUgKHVzdWFsbHksIG11c3QgYmUgZHVyYWJsZSk6ICR7dm93aXNofWA7XG4gICAgICAgICAgICAgIHpvbmUuaXNTdG9yYWJsZSh3YWtlV2F0Y2hlcikgfHwgdGhyb3dSZWRhY3RlZGB3YWtlV2F0Y2hlciBtdXN0IGJlIHN0b3JhYmxlIGluIHRoaXMgem9uZSAodXN1YWxseSwgbXVzdCBiZSBkdXJhYmxlKTogJHt3YWtlV2F0Y2hlcn1gO1xuICAgICAgICAgICAgICB3YXRjaCh2b3dpc2gsIHdha2VXYXRjaGVyKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCBwYW5pYyA9IChlcnIpID0+IGFkbWluLnBhbmljKGVycik7XG4gICAgICAgICAgICBjb25zdCBtZW1icmFuZSA9IG1ha2VSZXBsYXlNZW1icmFuZSh7XG4gICAgICAgICAgICAgIGxvZyxcbiAgICAgICAgICAgICAgYmlqZWN0aW9uLFxuICAgICAgICAgICAgICB2b3dUb29scyxcbiAgICAgICAgICAgICAgd2F0Y2hXYWtlLFxuICAgICAgICAgICAgICBwYW5pY1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpbml0TWVtYnJhbmUoZmxvdywgbWVtYnJhbmUpO1xuICAgICAgICAgICAgY29uc3QgZ3Vlc3RBcmdzID0gbWVtYnJhbmUuaG9zdFRvR3Vlc3QoYWN0aXZhdGlvbkFyZ3MpO1xuICAgICAgICAgICAgY29uc3QgZmxvd1N0YXRlID0gZmxvdy5nZXRGbG93U3RhdGUoKTtcbiAgICAgICAgICAgIGZsb3dTdGF0ZSA9PT0gXCJSdW5uaW5nXCIgfHwgZmxvd1N0YXRlID09PSBcIlJlcGxheWluZ1wiIHx8IHRocm93UmVkYWN0ZWRgUmVzdGFydGVkIGZsb3cgbXVzdCBiZSBSdW5uaW5nIG9yIFJlcGxheWluZyAke2Zsb3d9YDtcbiAgICAgICAgICAgIG1lbWJyYW5lLndha2UoKTtcbiAgICAgICAgICAgIGNvbnN0IGd1ZXN0UmVzdWx0UCA9IChhc3luYyAoKSA9PiAoXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIGd1ZXN0QXN5bmNGdW5jKC4uLmd1ZXN0QXJncylcbiAgICAgICAgICAgICkpKCk7XG4gICAgICAgICAgICBpZiAoZmxvdy5nZXRGbG93U3RhdGUoKSAhPT0gXCJGYWlsZWRcIikge1xuICAgICAgICAgICAgICBjb25zdCBnMyA9IGJpamVjdGlvbi51bndyYXBJbml0KGd1ZXN0UmVzdWx0UCwgb3V0Y29tZUtpdC52b3cpO1xuICAgICAgICAgICAgICBnMyA9PT0gZ3Vlc3RSZXN1bHRQIHx8IHRocm93UmVkYWN0ZWRgaW50ZXJuYWw6IHByb21pc2VzIHNob3VsZCBub3QgYmUgdW53cmFwcGVkICR7ZzN9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZvaWQgRS53aGVuKFxuICAgICAgICAgICAgICBndWVzdFJlc3VsdFAsXG4gICAgICAgICAgICAgIChnRnVsZmlsbG1lbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoYmlqZWN0aW9uLmhhc0d1ZXN0KGd1ZXN0UmVzdWx0UCkpIHtcbiAgICAgICAgICAgICAgICAgICFsb2cuaXNSZXBsYXlpbmcoKSB8fCBwYW5pYyhcbiAgICAgICAgICAgICAgICAgICAgbWFrZUVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgIHJlZGFjdGVkYGd1ZXN0IGZ1bGZpbGxlZCB3aXRoICR7Z0Z1bGZpbGxtZW50fSBiZWZvcmUgZmluaXNoaW5nIHJlcGxheWBcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIG91dGNvbWVLaXQucmVzb2x2ZXIucmVzb2x2ZShcbiAgICAgICAgICAgICAgICAgICAgbWVtYnJhbmUuZ3Vlc3RUb0hvc3QoZ0Z1bGZpbGxtZW50KVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIGFkbWluLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAoZ3Vlc3RSZWFzb24pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoYmlqZWN0aW9uLmhhc0d1ZXN0KGd1ZXN0UmVzdWx0UCkpIHtcbiAgICAgICAgICAgICAgICAgICFsb2cuaXNSZXBsYXlpbmcoKSB8fCBwYW5pYyhcbiAgICAgICAgICAgICAgICAgICAgbWFrZUVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgIHJlZGFjdGVkYGd1ZXN0IHJlamVjdGVkIHdpdGggJHtndWVzdFJlYXNvbn0gYmVmb3JlIGZpbmlzaGluZyByZXBsYXlgXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICBvdXRjb21lS2l0LnJlc29sdmVyLnJlamVjdChtZW1icmFuZS5ndWVzdFRvSG9zdChndWVzdFJlYXNvbikpO1xuICAgICAgICAgICAgICAgICAgYWRtaW4uY29tcGxldGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICkudGhlbihcbiAgICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChmbG93LmdldEZsb3dTdGF0ZSgpID09PSBcIkZhaWxlZFwiKSB7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBmbG93LmdldE9wdEZhdGFsUHJvYmxlbSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgKG1heWJlUGFuaWNSZWFzb24pID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmxvdy5nZXRGbG93U3RhdGUoKSA9PT0gXCJGYWlsZWRcIikge1xuICAgICAgICAgICAgICAgICAgY29uc3QgZXJyMiA9IGZsb3cuZ2V0T3B0RmF0YWxQcm9ibGVtKCk7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBlcnIyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBlcnIgPSBtYWtlRXJyb3IoXG4gICAgICAgICAgICAgICAgICByZWRhY3RlZGBpbnRlcm5hbDogdW5leHBlY3RlZCBlcnJvciBpbiBndWVzdCBjb21wbGV0aW9uIGhhbmRsaW5nICR7bWF5YmVQYW5pY1JlYXNvbn1gXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgcGFuaWMoZXJyKTtcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChfZSkge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKS5jYXRjaChwYW5pY0hhbmRsZXIpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgd2FrZSgpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93IH0gPSBmYWNldHM7XG4gICAgICAgICAgICBjb25zdCBmbG93U3RhdGUgPSBmbG93LmdldEZsb3dTdGF0ZSgpO1xuICAgICAgICAgICAgc3dpdGNoIChmbG93U3RhdGUpIHtcbiAgICAgICAgICAgICAgY2FzZSBcIkRvbmVcIjpcbiAgICAgICAgICAgICAgY2FzZSBcIkZhaWxlZFwiOiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNhc2UgXCJSdW5uaW5nXCI6XG4gICAgICAgICAgICAgIGNhc2UgXCJSZXBsYXlpbmdcIjoge1xuICAgICAgICAgICAgICAgIGdldE1lbWJyYW5lKGZsb3cpLndha2UoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY2FzZSBcIlNsZWVwaW5nXCI6IHtcbiAgICAgICAgICAgICAgICBmbG93LnJlc3RhcnQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgdW5leHBlY3RlZCBmbG93U3RhdGUgJHtxdW90ZShmbG93U3RhdGUpfWA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldE91dGNvbWUoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBvdXRjb21lS2l0IH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIHJldHVybiBvdXRjb21lS2l0LnZvdztcbiAgICAgICAgICB9LFxuICAgICAgICAgIGR1bXAoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBsb2cgfSA9IHN0YXRlO1xuICAgICAgICAgICAgcmV0dXJuIGxvZy5kdW1wKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXRPcHRGYXRhbFByb2JsZW0oKSB7XG4gICAgICAgICAgICBjb25zdCB7IGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgcmV0dXJuIGZhaWx1cmVzLmhhcyhmbG93KSA/IGZhaWx1cmVzLmdldChmbG93KSA6IHZvaWQgMDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGFkbWluOiB7XG4gICAgICAgICAgcmVzZXQoKSB7XG4gICAgICAgICAgICBjb25zdCB7IHN0YXRlLCBmYWNldHMgfSA9IHRoaXM7XG4gICAgICAgICAgICBjb25zdCB7IGJpamVjdGlvbiwgbG9nIH0gPSBzdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHsgZmxvdyB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgIXN0YXRlLmlzRG9uZSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCByZXNldCBhIGRvbmUgZmxvd2A7XG4gICAgICAgICAgICBpZiAoZmFpbHVyZXMuaGFzKGZsb3cpKSB7XG4gICAgICAgICAgICAgIGZhaWx1cmVzLmRlbGV0ZShmbG93KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChoYXNNZW1icmFuZShmbG93KSkge1xuICAgICAgICAgICAgICBnZXRNZW1icmFuZShmbG93KS5zdG9wKCk7XG4gICAgICAgICAgICAgIGRlbGV0ZU1lbWJyYW5lKGZsb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbG9nLnJlc2V0KCk7XG4gICAgICAgICAgICBiaWplY3Rpb24ucmVzZXQoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbXBsZXRlKCkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBsb2cgfSA9IHN0YXRlO1xuICAgICAgICAgICAgY29uc3QgeyBmbG93LCBhZG1pbiB9ID0gZmFjZXRzO1xuICAgICAgICAgICAgYWRtaW4ucmVzZXQoKTtcbiAgICAgICAgICAgIGlmIChlYWdlcldha2Vycy5oYXMoZmxvdykpIHtcbiAgICAgICAgICAgICAgZWFnZXJXYWtlcnMuZGVsZXRlKGZsb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZmxvd0Zvck91dGNvbWVWb3dLZXkuZGVsZXRlKHRvUGFzc2FibGVDYXAoZmxvdy5nZXRPdXRjb21lKCkpKTtcbiAgICAgICAgICAgIHN0YXRlLmlzRG9uZSA9IHRydWU7XG4gICAgICAgICAgICBsb2cuZGlzcG9zZSgpO1xuICAgICAgICAgICAgZmxvdy5nZXRGbG93U3RhdGUoKSA9PT0gXCJEb25lXCIgfHwgdGhyb3dSZWRhY3RlZGBDb21wbGV0ZSBmbG93IG11c3QgYmUgRG9uZSAke2Zsb3d9YDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBhbmljKGZhdGFsUHJvYmxlbSkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0ZSwgZmFjZXRzIH0gPSB0aGlzO1xuICAgICAgICAgICAgY29uc3QgeyBiaWplY3Rpb24sIGxvZyB9ID0gc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IGZsb3cgfSA9IGZhY2V0cztcbiAgICAgICAgICAgIGlmIChmYWlsdXJlcy5oYXMoZmxvdykpIHtcbiAgICAgICAgICAgICAgY29uc3QgcHJldkVyciA9IGZhaWx1cmVzLmdldChmbG93KTtcbiAgICAgICAgICAgICAgbm90ZShcbiAgICAgICAgICAgICAgICBwcmV2RXJyLFxuICAgICAgICAgICAgICAgIHJlZGFjdGVkYGRvdWJseSBmYWlsZWQgc29tZWhvdyB3aXRoICR7ZmF0YWxQcm9ibGVtfWBcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgZmF0YWxQcm9ibGVtID0gcHJldkVycjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGZhaWx1cmVzLmluaXQoZmxvdywgZmF0YWxQcm9ibGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChoYXNNZW1icmFuZShmbG93KSkge1xuICAgICAgICAgICAgICBnZXRNZW1icmFuZShmbG93KS5zdG9wKCk7XG4gICAgICAgICAgICAgIGRlbGV0ZU1lbWJyYW5lKGZsb3cpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbG9nLnJlc2V0KCk7XG4gICAgICAgICAgICBiaWplY3Rpb24ucmVzZXQoKTtcbiAgICAgICAgICAgIGZsb3cuZ2V0Rmxvd1N0YXRlKCkgPT09IFwiRmFpbGVkXCIgfHwgdGhyb3dSZWRhY3RlZGBQYW5pY2tlZCBmbG93IG11c3QgYmUgRmFpbGVkICR7Zmxvd31gO1xuICAgICAgICAgICAgY29uc3QgZXJyID0gbWFrZUVycm9yKFxuICAgICAgICAgICAgICByZWRhY3RlZGBJbiBhIEZhaWxlZCBzdGF0ZTogc2VlIGdldEZhaWx1cmVzKCkgb3IgZ2V0T3B0RmF0YWxQcm9ibGVtKCkgZm9yIG1vcmUgaW5mb3JtYXRpb25gXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgbm90ZShlcnIsIHJlZGFjdGVkYGR1ZSB0byAke2ZhdGFsUHJvYmxlbX1gKTtcbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHdha2VXYXRjaGVyOiB7XG4gICAgICAgICAgb25GdWxmaWxsZWQoX2Z1bGZpbGxtZW50KSB7XG4gICAgICAgICAgICBjb25zdCB7IGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGZhY2V0cy5mbG93Lndha2UoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9uUmVqZWN0ZWQoX2Z1bGZpbGxtZW50KSB7XG4gICAgICAgICAgICBjb25zdCB7IGZhY2V0cyB9ID0gdGhpcztcbiAgICAgICAgICAgIGZhY2V0cy5mbG93Lndha2UoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICAgIGNvbnN0IG1ha2VBc3luY0Zsb3dLaXQgPSAoYWN0aXZhdGlvbkFyZ3MpID0+IHtcbiAgICAgIGNvbnN0IGFzeW5jRmxvd0tpdCA9IGludGVybmFsTWFrZUFzeW5jRmxvd0tpdChhY3RpdmF0aW9uQXJncyk7XG4gICAgICBjb25zdCB7IGZsb3cgfSA9IGFzeW5jRmxvd0tpdDtcbiAgICAgIGNvbnN0IHZvdyA9IGZsb3cuZ2V0T3V0Y29tZSgpO1xuICAgICAgZmxvd0Zvck91dGNvbWVWb3dLZXkuaW5pdCh0b1Bhc3NhYmxlQ2FwKHZvdyksIGZsb3cpO1xuICAgICAgZmxvdy5yZXN0YXJ0KCk7XG4gICAgICByZXR1cm4gYXN5bmNGbG93S2l0O1xuICAgIH07XG4gICAgcmV0dXJuIGhhcmRlbihtYWtlQXN5bmNGbG93S2l0KTtcbiAgfTtcbiAgY29uc3QgYXN5bmNGbG93ID0gKHpvbmUsIHRhZywgZ3Vlc3RGdW5jLCBvcHRpb25zID0gdm9pZCAwKSA9PiB7XG4gICAgY29uc3QgbWFrZUFzeW5jRmxvd0tpdCA9IHByZXBhcmVBc3luY0Zsb3dLaXQoem9uZSwgdGFnLCBndWVzdEZ1bmMsIG9wdGlvbnMpO1xuICAgIGNvbnN0IGhvc3RGdW5jTmFtZSA9IGAke3RhZ31faG9zdEZsb3dgO1xuICAgIGNvbnN0IHdyYXBwZXJGdW5jID0gKFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICovXG4gICAgICB7XG4gICAgICAgIFtob3N0RnVuY05hbWVdKC4uLmFyZ3MpIHtcbiAgICAgICAgICBjb25zdCB7IGZsb3cgfSA9IG1ha2VBc3luY0Zsb3dLaXQoYXJncyk7XG4gICAgICAgICAgcmV0dXJuIGZsb3cuZ2V0T3V0Y29tZSgpO1xuICAgICAgICB9XG4gICAgICB9W2hvc3RGdW5jTmFtZV1cbiAgICApO1xuICAgIGRlZmluZVByb3BlcnRpZXM2KHdyYXBwZXJGdW5jLCB7XG4gICAgICBsZW5ndGg6IHsgdmFsdWU6IGd1ZXN0RnVuYy5sZW5ndGggfVxuICAgIH0pO1xuICAgIHJldHVybiBoYXJkZW4od3JhcHBlckZ1bmMpO1xuICB9O1xuICBjb25zdCBhZG1pbkFzeW5jRmxvdyA9IG91dGVyWm9uZS5leG8oXCJBZG1pbkFzeW5jRmxvd1wiLCBBZG1pbkFzeW5jRmxvd0ksIHtcbiAgICBnZXRGYWlsdXJlcygpIHtcbiAgICAgIHJldHVybiBmYWlsdXJlcy5zbmFwc2hvdCgpO1xuICAgIH0sXG4gICAgd2FrZUFsbCgpIHtcbiAgICAgIGNvbnN0IGZhaWx1cmVzVG9SZXN0YXJ0ID0gWy4uLmZhaWx1cmVzLmtleXMoKV07XG4gICAgICBjb25zdCBmbG93c1RvV2FrZSA9IFsuLi5lYWdlcldha2Vycy5rZXlzKCldO1xuICAgICAgZm9yIChjb25zdCBmbG93IG9mIGZhaWx1cmVzVG9SZXN0YXJ0KSB7XG4gICAgICAgIGZsb3cucmVzdGFydCgpO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBmbG93IG9mIGZsb3dzVG9XYWtlKSB7XG4gICAgICAgIGZsb3cud2FrZSgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZ2V0Rmxvd0Zvck91dGNvbWVWb3cob3V0Y29tZVZvdykge1xuICAgICAgcmV0dXJuIGZsb3dGb3JPdXRjb21lVm93S2V5LmdldCh0b1Bhc3NhYmxlQ2FwKG91dGNvbWVWb3cpKTtcbiAgICB9XG4gIH0pO1xuICBjb25zdCBhbGxXb2tlblAgPSBFLndoZW4obnVsbCwgKCkgPT4gYWRtaW5Bc3luY0Zsb3cud2FrZUFsbCgpKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgcHJlcGFyZUFzeW5jRmxvd0tpdCxcbiAgICBhc3luY0Zsb3csXG4gICAgYWRtaW5Bc3luY0Zsb3csXG4gICAgYWxsV29rZW5QLFxuICAgIHByZXBhcmVFbmRvd21lbnRcbiAgfSk7XG59O1xuaGFyZGVuKHByZXBhcmVBc3luY0Zsb3dUb29scyk7XG5cbi8vXG52YXIgZXZlbnRMb29wSXRlcmF0aW9uID0gYXN5bmMgKCkgPT4gbmV3IFByb21pc2UoKHJlc29sdmUyKSA9PiBzZXRJbW1lZGlhdGUocmVzb2x2ZTIpKTtcbmhhcmRlbihldmVudExvb3BJdGVyYXRpb24pO1xudmFyIHN0cmluZ09yVGFnID0gKHZhbHVlKSA9PiB7XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIFN5bWJvbC50b1N0cmluZ1RhZyBpbiB2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZVtTeW1ib2wudG9TdHJpbmdUYWddO1xuICB9XG4gIHJldHVybiBTdHJpbmcodmFsdWUpO1xufTtcbnZhciBpbnNwZWN0TWFwU3RvcmUgPSAoc3RvcmUpID0+IHtcbiAgY29uc3Qgb2JqID0ge307XG4gIGZvciAoY29uc3Qga2V5IG9mIHN0b3JlLmtleXMoKSkge1xuICAgIGNvbnN0IHZhbHVlID0gc3RvcmUuZ2V0KGtleSk7XG4gICAgY29uc3QgaGFzS2V5cyA9IHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIiAmJiBcImtleXNcIiBpbiB2YWx1ZTtcbiAgICBjb25zdCBpbmRleCA9IHN0cmluZ09yVGFnKGtleSk7XG4gICAgaWYgKGhhc0tleXMgJiYgXCJnZXRcIiBpbiB2YWx1ZSkge1xuICAgICAgb2JqW2luZGV4XSA9IGluc3BlY3RNYXBTdG9yZSh2YWx1ZSk7XG4gICAgfSBlbHNlIGlmIChoYXNLZXlzKSB7XG4gICAgICBvYmpbaW5kZXhdID0gQXJyYXkuZnJvbSh2YWx1ZS5rZXlzKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBvYmpbaW5kZXhdID0gdmFsdWUgaW5zdGFuY2VvZiBPYmplY3QgJiYgU3ltYm9sLnRvU3RyaW5nVGFnIGluIHZhbHVlID8gdmFsdWVbU3ltYm9sLnRvU3RyaW5nVGFnXSA6IHZhbHVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gb2JqO1xufTtcbmhhcmRlbihpbnNwZWN0TWFwU3RvcmUpO1xuXG4vL1xudmFyIG1ha2VGYWtlU3RvcmFnZSA9IChwYXRoLCBwdWJsaWNhdGlvbikgPT4ge1xuICBsZXQgc2V0VmFsdWVDYWxscyA9IDA7XG4gIGNvbnN0IGZ1bGxQYXRoID0gYHB1Ymxpc2guJHtwYXRofWA7XG4gIGNvbnN0IHN0b3JlS2V5ID0gaGFyZGVuKHtcbiAgICBzdG9yZU5hbWU6IFwic3dpbmdzZXRcIixcbiAgICBzdG9yZVN1YmtleTogYHN3aW5nc2V0L2RhdGE6JHtmdWxsUGF0aH1gLFxuICAgIGRhdGFQcmVmaXhCeXRlczogXCJcIlxuICB9KTtcbiAgY29uc3Qgc3RvcmFnZSA9IEZhcihcIlN0b3JhZ2VOb2RlXCIsIHtcbiAgICBnZXRQYXRoOiAoKSA9PiBwYXRoLFxuICAgIGdldFN0b3JlS2V5OiBhc3luYyAoKSA9PiBzdG9yZUtleSxcbiAgICBzZXRWYWx1ZTogYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICBzZXRWYWx1ZUNhbGxzICs9IDE7XG4gICAgICBhc3NlcnQudHlwZW9mKHZhbHVlLCBcInN0cmluZ1wiKTtcbiAgICAgIGlmIChwdWJsaWNhdGlvbikge1xuICAgICAgICBwdWJsaWNhdGlvbi51cGRhdGVTdGF0ZSh2YWx1ZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtYWtlQ2hpbGROb2RlOiAoKSA9PiBzdG9yYWdlLFxuICAgIGNvdW50U2V0VmFsdWVDYWxsczogKCkgPT4gc2V0VmFsdWVDYWxsc1xuICB9KTtcbiAgcmV0dXJuIHN0b3JhZ2U7XG59O1xuaGFyZGVuKG1ha2VGYWtlU3RvcmFnZSk7XG52YXIgbWFrZUZha2VNYXJzaGFsbGVyID0gKCkgPT4gbWFrZU1hcnNoYWwodm9pZCAwLCB2b2lkIDAsIHtcbiAgbWFyc2hhbFNhdmVFcnJvcjogKCkgPT4ge1xuICB9XG59KTtcbmhhcmRlbihtYWtlRmFrZU1hcnNoYWxsZXIpO1xuXG4vL1xudmFyIHByZXBhcmVSZWNvcmRlciA9IChiYWdnYWdlLCBtYXJzaGFsbGVyKSA9PiB7XG4gIGNvbnN0IG1ha2VSZWNvcmRlciA9IHByZXBhcmVFeG9DbGFzcyhcbiAgICBiYWdnYWdlLFxuICAgIFwiUmVjb3JkZXJcIixcbiAgICBNLmludGVyZmFjZShcIlJlY29yZGVyXCIsIHtcbiAgICAgIGdldFN0b3JhZ2VOb2RlOiBNLmNhbGwoKS5yZXR1cm5zKFN0b3JhZ2VOb2RlU2hhcGUpLFxuICAgICAgZ2V0U3RvcmFnZVBhdGg6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKFxuICAgICAgICAvKiAgICAgICAgKi9cbiAgICAgICkpLFxuICAgICAgd3JpdGU6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgIHdyaXRlRmluYWw6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgIH0pLFxuICAgIC8qXG5cblxuXG5cbiAgICAgKi9cbiAgICAocHVibGlzaGVyLCBzdG9yYWdlTm9kZSwgdmFsdWVTaGFwZSA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBNLmFueSgpXG4gICAgKSkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2xvc2VkOiBmYWxzZSxcbiAgICAgICAgcHVibGlzaGVyLFxuICAgICAgICBzdG9yYWdlTm9kZSxcbiAgICAgICAgc3RvcmFnZVBhdGg6IChcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB2b2lkIDBcbiAgICAgICAgKSxcbiAgICAgICAgdmFsdWVTaGFwZVxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGdldFN0b3JhZ2VOb2RlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5zdG9yYWdlTm9kZTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuICAgICAgICovXG4gICAgICBhc3luYyBnZXRTdG9yYWdlUGF0aCgpIHtcbiAgICAgICAgY29uc3QgeyBzdG9yYWdlUGF0aDogaGVsZFBhdGggfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGF3YWl0IG51bGw7XG4gICAgICAgIGlmIChoZWxkUGF0aCAhPT0gdm9pZCAwKSB7XG4gICAgICAgICAgcmV0dXJuIGhlbGRQYXRoO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhdGggPSBhd2FpdCBFKHRoaXMuc3RhdGUuc3RvcmFnZU5vZGUpLmdldFBhdGgoKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5zdG9yYWdlUGF0aCA9IHBhdGg7XG4gICAgICAgIHJldHVybiBwYXRoO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgYXN5bmMgd3JpdGUodmFsdWUpIHtcbiAgICAgICAgY29uc3QgeyBjbG9zZWQsIHB1Ymxpc2hlciwgc3RvcmFnZU5vZGUsIHZhbHVlU2hhcGUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICFjbG9zZWQgfHwgdGhyb3dSZWRhY3RlZGBjYW5ub3Qgd3JpdGUgdG8gY2xvc2VkIHJlY29yZGVyYDtcbiAgICAgICAgbXVzdE1hdGNoMih2YWx1ZSwgdmFsdWVTaGFwZSk7XG4gICAgICAgIGNvbnN0IGVuY29kZWQgPSBhd2FpdCBFKG1hcnNoYWxsZXIpLnRvQ2FwRGF0YSh2YWx1ZSk7XG4gICAgICAgIGNvbnN0IHNlcmlhbGl6ZWQgPSBKU09OLnN0cmluZ2lmeShlbmNvZGVkKTtcbiAgICAgICAgYXdhaXQgRShzdG9yYWdlTm9kZSkuc2V0VmFsdWUoc2VyaWFsaXplZCk7XG4gICAgICAgIHJldHVybiBwdWJsaXNoZXIucHVibGlzaCh2YWx1ZSk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuICAgICAgICovXG4gICAgICBhc3luYyB3cml0ZUZpbmFsKHZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHsgY2xvc2VkLCBwdWJsaXNoZXIsIHN0b3JhZ2VOb2RlLCB2YWx1ZVNoYXBlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAhY2xvc2VkIHx8IHRocm93UmVkYWN0ZWRgY2Fubm90IHdyaXRlIHRvIGNsb3NlZCByZWNvcmRlcmA7XG4gICAgICAgIG11c3RNYXRjaDIodmFsdWUsIHZhbHVlU2hhcGUpO1xuICAgICAgICBjb25zdCBlbmNvZGVkID0gYXdhaXQgRShtYXJzaGFsbGVyKS50b0NhcERhdGEodmFsdWUpO1xuICAgICAgICBjb25zdCBzZXJpYWxpemVkID0gSlNPTi5zdHJpbmdpZnkoZW5jb2RlZCk7XG4gICAgICAgIGF3YWl0IEUoc3RvcmFnZU5vZGUpLnNldFZhbHVlKHNlcmlhbGl6ZWQpO1xuICAgICAgICB0aGlzLnN0YXRlLmNsb3NlZCA9IHRydWU7XG4gICAgICAgIHJldHVybiBwdWJsaXNoZXIuZmluaXNoKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlUmVjb3JkZXI7XG59O1xuaGFyZGVuKHByZXBhcmVSZWNvcmRlcik7XG52YXIgZGVmaW5lUmVjb3JkZXJLaXQgPSAoeyBtYWtlUmVjb3JkZXIsIG1ha2VEdXJhYmxlUHVibGlzaEtpdCB9KSA9PiB7XG4gIGNvbnN0IG1ha2VSZWNvcmRlcktpdCA9IChzdG9yYWdlTm9kZSwgdmFsdWVTaGFwZSkgPT4ge1xuICAgIGNvbnN0IHsgc3Vic2NyaWJlciwgcHVibGlzaGVyIH0gPSBtYWtlRHVyYWJsZVB1Ymxpc2hLaXQoKTtcbiAgICBjb25zdCByZWNvcmRlciA9IG1ha2VSZWNvcmRlcihcbiAgICAgIHB1Ymxpc2hlcixcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBzdG9yYWdlTm9kZSxcbiAgICAgIHZhbHVlU2hhcGVcbiAgICApO1xuICAgIHJldHVybiBoYXJkZW4oeyBzdWJzY3JpYmVyLCByZWNvcmRlciB9KTtcbiAgfTtcbiAgcmV0dXJuIG1ha2VSZWNvcmRlcktpdDtcbn07XG52YXIgZGVmaW5lRVJlY29yZGVyS2l0ID0gKHsgbWFrZVJlY29yZGVyLCBtYWtlRHVyYWJsZVB1Ymxpc2hLaXQgfSkgPT4ge1xuICBjb25zdCBtYWtlRVJlY29yZGVyS2l0ID0gKHN0b3JhZ2VOb2RlUCwgdmFsdWVTaGFwZSkgPT4ge1xuICAgIGNvbnN0IHsgcHVibGlzaGVyLCBzdWJzY3JpYmVyIH0gPSBtYWtlRHVyYWJsZVB1Ymxpc2hLaXQoKTtcbiAgICBjb25zdCByZWNvcmRlclAgPSBFLndoZW4oXG4gICAgICBzdG9yYWdlTm9kZVAsXG4gICAgICAoc3RvcmFnZU5vZGUpID0+IG1ha2VSZWNvcmRlcihcbiAgICAgICAgcHVibGlzaGVyLFxuICAgICAgICAvL1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzdG9yYWdlTm9kZSxcbiAgICAgICAgdmFsdWVTaGFwZVxuICAgICAgKVxuICAgICk7XG4gICAgcmV0dXJuIHsgc3Vic2NyaWJlciwgcmVjb3JkZXJQIH07XG4gIH07XG4gIHJldHVybiBtYWtlRVJlY29yZGVyS2l0O1xufTtcbmhhcmRlbihkZWZpbmVFUmVjb3JkZXJLaXQpO1xudmFyIHByZXBhcmVSZWNvcmRlcktpdE1ha2VycyA9IChiYWdnYWdlLCBtYXJzaGFsbGVyKSA9PiB7XG4gIGNvbnN0IG1ha2VEdXJhYmxlUHVibGlzaEtpdCA9IHByZXBhcmVEdXJhYmxlUHVibGlzaEtpdChcbiAgICBiYWdnYWdlLFxuICAgIFwiRHVyYWJsZSBQdWJsaXNoIEtpdFwiXG4gICk7XG4gIGNvbnN0IG1ha2VSZWNvcmRlciA9IHByZXBhcmVSZWNvcmRlcihiYWdnYWdlLCBtYXJzaGFsbGVyKTtcbiAgY29uc3QgbWFrZVJlY29yZGVyS2l0ID0gZGVmaW5lUmVjb3JkZXJLaXQoe1xuICAgIG1ha2VSZWNvcmRlcixcbiAgICBtYWtlRHVyYWJsZVB1Ymxpc2hLaXRcbiAgfSk7XG4gIGNvbnN0IG1ha2VFUmVjb3JkZXJLaXQgPSBkZWZpbmVFUmVjb3JkZXJLaXQoe1xuICAgIG1ha2VSZWNvcmRlcixcbiAgICBtYWtlRHVyYWJsZVB1Ymxpc2hLaXRcbiAgfSk7XG4gIHJldHVybiB7XG4gICAgbWFrZUR1cmFibGVQdWJsaXNoS2l0LFxuICAgIG1ha2VSZWNvcmRlcixcbiAgICBtYWtlUmVjb3JkZXJLaXQsXG4gICAgbWFrZUVSZWNvcmRlcktpdFxuICB9O1xufTtcbnZhciBSZWNvcmRlcktpdFNoYXBlID0ge1xuICByZWNvcmRlcjogTS5yZW1vdGFibGUoKSxcbiAgc3Vic2NyaWJlcjogTS5yZW1vdGFibGUoKVxufTtcbmhhcmRlbihSZWNvcmRlcktpdFNoYXBlKTtcblxuLy9cbnZhciBjYWlwSWRGcm9tSW5mbyA9IChpbmZvKSA9PiB7XG4gIHJldHVybiBgJHtpbmZvLm5hbWVzcGFjZX06JHtpbmZvLnJlZmVyZW5jZX1gO1xufTtcblxuLy9cbnZhciBQRk1fUkVDRUlWRVIgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIFwicGZtXCJcbik7XG52YXIgSHViTmFtZSA9IChcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAge1xuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICBDaGFpbjogXCJjaGFpblwiLFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIENoYWluQXNzZXRzOiBcImNoYWluQXNzZXRzXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIENoYWluQ29ubmVjdGlvbjogXCJjaGFpbkNvbm5lY3Rpb25cIlxuICB9XG4pO1xuaGFyZGVuKEh1Yk5hbWUpO1xudmFyIENIQUlOX0tFWSA9IEh1Yk5hbWUuQ2hhaW47XG52YXIgQ09OTkVDVElPTlNfS0VZID0gSHViTmFtZS5DaGFpbkNvbm5lY3Rpb247XG52YXIgQVNTRVRTX0tFWSA9IEh1Yk5hbWUuQ2hhaW5Bc3NldHM7XG52YXIgQ0hBSU5fSURfU0VQQVJBVE9SID0gXCJfXCI7XG52YXIgZW5jb2RlQ2hhaW5JZCA9IChjaGFpbklkKSA9PiBjaGFpbklkLnJlcGxhY2VBbGwoXG4gIENIQUlOX0lEX1NFUEFSQVRPUixcbiAgYCR7Q0hBSU5fSURfU0VQQVJBVE9SfSR7Q0hBSU5fSURfU0VQQVJBVE9SfWBcbik7XG52YXIgY29ubmVjdGlvbktleSA9IChjaGFpbklkMSwgY2hhaW5JZDIpID0+IHtcbiAgY29uc3QgY2hhaW5JZDFTYW5pdGl6ZWQgPSBlbmNvZGVDaGFpbklkKGNoYWluSWQxKTtcbiAgY29uc3QgY2hhaW5JZDJTYW5pdGl6ZWQgPSBlbmNvZGVDaGFpbklkKGNoYWluSWQyKTtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgW2NoYWluSWQxU2FuaXRpemVkLCBjaGFpbklkMlNhbml0aXplZF0uc29ydCgpLmpvaW4oQ0hBSU5fSURfU0VQQVJBVE9SKVxuICApO1xufTtcbnZhciByZXZlcnNlQ29ubkluZm8gPSAoY29ubkluZm8pID0+IHtcbiAgY29uc3QgeyB0cmFuc2ZlckNoYW5uZWwgfSA9IGNvbm5JbmZvO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBpZDogY29ubkluZm8uY291bnRlcnBhcnR5LmNvbm5lY3Rpb25faWQsXG4gICAgY2xpZW50X2lkOiBjb25uSW5mby5jb3VudGVycGFydHkuY2xpZW50X2lkLFxuICAgIGNvdW50ZXJwYXJ0eToge1xuICAgICAgY2xpZW50X2lkOiBjb25uSW5mby5jbGllbnRfaWQsXG4gICAgICBjb25uZWN0aW9uX2lkOiBjb25uSW5mby5pZFxuICAgIH0sXG4gICAgc3RhdGU6IGNvbm5JbmZvLnN0YXRlLFxuICAgIHRyYW5zZmVyQ2hhbm5lbDoge1xuICAgICAgLi4udHJhbnNmZXJDaGFubmVsLFxuICAgICAgY2hhbm5lbElkOiB0cmFuc2ZlckNoYW5uZWwuY291bnRlclBhcnR5Q2hhbm5lbElkLFxuICAgICAgY291bnRlclBhcnR5Q2hhbm5lbElkOiB0cmFuc2ZlckNoYW5uZWwuY2hhbm5lbElkLFxuICAgICAgcG9ydElkOiB0cmFuc2ZlckNoYW5uZWwuY291bnRlclBhcnR5UG9ydElkLFxuICAgICAgY291bnRlclBhcnR5UG9ydElkOiB0cmFuc2ZlckNoYW5uZWwucG9ydElkXG4gICAgfVxuICB9KTtcbn07XG52YXIgbm9ybWFsaXplQ29ubmVjdGlvbkluZm8gPSAocHJpbWFyeUNoYWluSWQsIGNvdW50ZXJDaGFpbklkLCBkaXJlY3RlZCkgPT4ge1xuICBjb25zdCBrZXkgPSBjb25uZWN0aW9uS2V5KHByaW1hcnlDaGFpbklkLCBjb3VudGVyQ2hhaW5JZCk7XG4gIGlmIChwcmltYXJ5Q2hhaW5JZCA8IGNvdW50ZXJDaGFpbklkKSB7XG4gICAgcmV0dXJuIFtrZXksIGRpcmVjdGVkXTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gW2tleSwgcmV2ZXJzZUNvbm5JbmZvKGRpcmVjdGVkKV07XG4gIH1cbn07XG52YXIgZGVub3JtYWxpemVDb25uZWN0aW9uSW5mbyA9IChwcmltYXJ5Q2hhaW5JZCwgY291bnRlckNoYWluSWQsIG5vcm1hbGl6ZWQpID0+IHtcbiAgaWYgKHByaW1hcnlDaGFpbklkIDwgY291bnRlckNoYWluSWQpIHtcbiAgICByZXR1cm4gbm9ybWFsaXplZDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmV2ZXJzZUNvbm5JbmZvKG5vcm1hbGl6ZWQpO1xuICB9XG59O1xudmFyIENoYWluSWRBcmdTaGFwZSA9IE0ub3IoXG4gIE0uc3RyaW5nKCksXG4gIE0uc3BsaXRSZWNvcmQoXG4gICAge1xuICAgICAgY2hhaW5JZDogTS5zdHJpbmcoKVxuICAgIH0sXG4gICAgdm9pZCAwLFxuICAgIE0uYW55KClcbiAgKVxuKTtcbnZhciBEZWZhdWx0UGZtVGltZW91dE9wdHMgPSBoYXJkZW4oXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICByZXRyaWVzOiAzLFxuICAgIHRpbWVvdXQ6IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICovXG4gICAgICBcIjEwbVwiXG4gICAgKVxuICB9XG4pO1xudmFyIFRyYW5zZmVyUm91dGVTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBzb3VyY2VQb3J0OiBNLnN0cmluZygpLFxuICAgIHNvdXJjZUNoYW5uZWw6IElCQ0NoYW5uZWxJRFNoYXBlLFxuICAgIHRva2VuOiBDb2luU2hhcGUsXG4gICAgcmVjZWl2ZXI6IE0uc3RyaW5nKClcbiAgfSxcbiAgeyBmb3J3YXJkSW5mbzogRm9yd2FyZEluZm9TaGFwZSB9LFxuICB7fVxuKTtcbnZhciBDaGFpbkh1YkkgPSBNLmludGVyZmFjZShcIkNoYWluSHViXCIsIHtcbiAgcmVnaXN0ZXJDaGFpbjogTS5jYWxsKE0uc3RyaW5nKCksIENoYWluSW5mb1NoYXBlKS5yZXR1cm5zKCksXG4gIHVwZGF0ZUNoYWluOiBNLmNhbGwoTS5zdHJpbmcoKSwgQ2hhaW5JbmZvU2hhcGUpLnJldHVybnMoKSxcbiAgZ2V0Q2hhaW5JbmZvOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldENoYWluSW5mb0J5Q2hhaW5JZDogTS5jYWxsKE0uc3RyaW5nKCkpLnJldHVybnMoQ2hhaW5JbmZvU2hhcGUpLFxuICByZWdpc3RlckNvbm5lY3Rpb246IE0uY2FsbChcbiAgICBNLnN0cmluZygpLFxuICAgIE0uc3RyaW5nKCksXG4gICAgSUJDQ29ubmVjdGlvbkluZm9TaGFwZVxuICApLnJldHVybnMoKSxcbiAgdXBkYXRlQ29ubmVjdGlvbjogTS5jYWxsKFxuICAgIE0uc3RyaW5nKCksXG4gICAgTS5zdHJpbmcoKSxcbiAgICBJQkNDb25uZWN0aW9uSW5mb1NoYXBlXG4gICkucmV0dXJucygpLFxuICBnZXRDb25uZWN0aW9uSW5mbzogTS5jYWxsKENoYWluSWRBcmdTaGFwZSwgQ2hhaW5JZEFyZ1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0Q2hhaW5zQW5kQ29ubmVjdGlvbjogTS5jYWxsKE0uc3RyaW5nKCksIE0uc3RyaW5nKCkpLnJldHVybnMoVm93U2hhcGUpLFxuICByZWdpc3RlckFzc2V0OiBNLmNhbGwoTS5zdHJpbmcoKSwgRGVub21EZXRhaWxTaGFwZSkucmV0dXJucygpLFxuICB1cGRhdGVBc3NldDogTS5jYWxsKE0uc3RyaW5nKCksIERlbm9tRGV0YWlsU2hhcGUpLnJldHVybnMoKSxcbiAgZ2V0QXNzZXQ6IE0uY2FsbChNLnN0cmluZygpLCBNLnN0cmluZygpKS5yZXR1cm5zKFxuICAgIE0ub3IoRGVub21EZXRhaWxTaGFwZSwgTS51bmRlZmluZWQoKSlcbiAgKSxcbiAgZ2V0RGVub206IE0uY2FsbChCcmFuZFNoYXBlKS5yZXR1cm5zKE0ub3IoTS5zdHJpbmcoKSwgTS51bmRlZmluZWQoKSkpLFxuICBjb2VyY2VDb3Ntb3NBZGRyZXNzOiBNLmNhbGwoQWNjb3VudElkQXJnU2hhcGUpLnJldHVybnMoXG4gICAgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGVcbiAgKSxcbiAgcmVzb2x2ZUFjY291bnRJZDogTS5jYWxsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5zdHJpbmcoKSksXG4gIG1ha2VUcmFuc2ZlclJvdXRlOiBNLmNhbGwoQWNjb3VudElkQXJnU2hhcGUsIERlbm9tQW1vdW50U2hhcGUsIE0uc3RyaW5nKCkpLm9wdGlvbmFsKEZvcndhcmRPcHRzU2hhcGUpLnJldHVybnMoTS5vcihNLnVuZGVmaW5lZCgpLCBUcmFuc2ZlclJvdXRlU2hhcGUpKVxufSk7XG52YXIgbWFrZUNoYWluSHViID0gKHpvbmUsIGFnb3JpY05hbWVzLCB2b3dUb29scywgeyBjaGFpbkluZm9WYWx1ZVNoYXBlID0gKFxuICAvKiAgICAgICAgICAgICAgICAgICovXG4gIENoYWluSW5mb1NoYXBlXG4pIH0gPSB7fSkgPT4ge1xuICBjb25zdCBjaGFpbkluZm9zID0gem9uZS5tYXBTdG9yZShcImNoYWluSW5mb3NcIiwge1xuICAgIGtleVNoYXBlOiBNLnN0cmluZygpLFxuICAgIHZhbHVlU2hhcGU6IGNoYWluSW5mb1ZhbHVlU2hhcGVcbiAgfSk7XG4gIGNvbnN0IGNvbm5lY3Rpb25JbmZvcyA9IHpvbmUubWFwU3RvcmUoXCJjb25uZWN0aW9uSW5mb3NcIiwge1xuICAgIGtleVNoYXBlOiBNLnN0cmluZygpLFxuICAgIHZhbHVlU2hhcGU6IElCQ0Nvbm5lY3Rpb25JbmZvU2hhcGVcbiAgfSk7XG4gIGNvbnN0IGRlbm9tRGV0YWlscyA9IHpvbmUubWFwU3RvcmUoXCJkZW5vbVwiLCB7XG4gICAga2V5U2hhcGU6IE0uc3RyaW5nKCksXG4gICAgdmFsdWVTaGFwZTogRGVub21EZXRhaWxTaGFwZVxuICB9KTtcbiAgY29uc3QgYnJhbmREZW5vbXMgPSB6b25lLm1hcFN0b3JlKFwiYnJhbmREZW5vbVwiLCB7XG4gICAga2V5U2hhcGU6IEJyYW5kU2hhcGUsXG4gICAgdmFsdWVTaGFwZTogTS5zdHJpbmcoKVxuICB9KTtcbiAgY29uc3QgYmVjaDMyUHJlZml4VG9DaGFpbk5hbWUgPSB6b25lLm1hcFN0b3JlKFwiYmVjaDMyUHJlZml4VG9DaGFpbk5hbWVcIiwge1xuICAgIGtleVNoYXBlOiBNLnN0cmluZygpLFxuICAgIHZhbHVlU2hhcGU6IE0uc3RyaW5nKClcbiAgfSk7XG4gIGNvbnN0IGNoYWluSWRUb0NoYWluTmFtZSA9IHpvbmUubWFwU3RvcmUoXCJjaGFpbklkVG9DaGFpbk5hbWVcIiwge1xuICAgIGtleVNoYXBlOiBNLnN0cmluZygpLFxuICAgIHZhbHVlU2hhcGU6IE0uc3RyaW5nKClcbiAgfSk7XG4gIGNvbnN0IG1ha2VEZW5vbUtleSA9IChkZW5vbSwgc3JjQ2hhaW5OYW1lKSA9PiBgJHtzcmNDaGFpbk5hbWV9OiR7ZGVub219YDtcbiAgY29uc3QgcmVzb2x2ZUNvc21vc0NoYWluSWQgPSAoYWRkcmVzcykgPT4ge1xuICAgIGNvbnN0IHByZWZpeCA9IGdldEJlY2gzMlByZWZpeChhZGRyZXNzKTtcbiAgICBpZiAoIWJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lLmhhcyhwcmVmaXgpKSB7XG4gICAgICB0aHJvdyBtYWtlRXJyb3IoYENoYWluIGluZm8gbm90IGZvdW5kIGZvciBiZWNoMzJQcmVmaXggJHtxdW90ZShwcmVmaXgpfWApO1xuICAgIH1cbiAgICBjb25zdCBjaGFpbk5hbWUgPSBiZWNoMzJQcmVmaXhUb0NoYWluTmFtZS5nZXQocHJlZml4KTtcbiAgICBjb25zdCB7IGNoYWluSWQgfSA9IChcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgY2hhaW5JbmZvcy5nZXQoY2hhaW5OYW1lKVxuICAgICk7XG4gICAgcmV0dXJuIGNoYWluSWQ7XG4gIH07XG4gIGNvbnN0IGxvb2t1cENoYWluSW5mbyA9IHZvd1Rvb2xzLnJldHJ5YWJsZShcbiAgICB6b25lLFxuICAgIFwibG9va3VwQ2hhaW5JbmZvXCIsXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAvL1xuICAgIGFzeW5jIChjaGFpbk5hbWUpID0+IHtcbiAgICAgIGF3YWl0IG51bGw7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGFpbkluZm8gPSBhd2FpdCBFKGFnb3JpY05hbWVzKS5sb29rdXAoSHViTmFtZS5DaGFpbiwgY2hhaW5OYW1lKTtcbiAgICAgICAgaWYgKCFjaGFpbkluZm9zLmhhcyhjaGFpbk5hbWUpKSB7XG4gICAgICAgICAgY2hhaW5JbmZvcy5pbml0KGNoYWluTmFtZSwgY2hhaW5JbmZvKTtcbiAgICAgICAgICBjaGFpbklkVG9DaGFpbk5hbWUuaW5pdChjYWlwSWRGcm9tSW5mbyhjaGFpbkluZm8pLCBjaGFpbk5hbWUpO1xuICAgICAgICAgIGlmIChjaGFpbkluZm8uYmVjaDMyUHJlZml4KSB7XG4gICAgICAgICAgICBiZWNoMzJQcmVmaXhUb0NoYWluTmFtZS5pbml0KGNoYWluSW5mby5iZWNoMzJQcmVmaXgsIGNoYWluTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGFpbkluZm87XG4gICAgICB9IGNhdGNoIChlMikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwibG9va3VwQ2hhaW5JbmZvXCIsIGNoYWluTmFtZSwgXCJlcnJvclwiLCBlMik7XG4gICAgICAgIHRocm93IG1ha2VFcnJvcihgY2hhaW4gbm90IGZvdW5kOiR7Y2hhaW5OYW1lfWApO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbG9va3VwQ29ubmVjdGlvbkluZm8gPSB2b3dUb29scy5yZXRyeWFibGUoXG4gICAgem9uZSxcbiAgICBcImxvb2t1cENvbm5lY3Rpb25JbmZvXCIsXG4gICAgLypcblxuXG4gICAgICovXG4gICAgLy9cbiAgICBhc3luYyAoY2hhaW5JZDEsIGNoYWluSWQyKSA9PiB7XG4gICAgICBhd2FpdCBudWxsO1xuICAgICAgY29uc3Qga2V5ID0gY29ubmVjdGlvbktleShjaGFpbklkMSwgY2hhaW5JZDIpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29ubmVjdGlvbkluZm8gPSBhd2FpdCBFKGFnb3JpY05hbWVzKS5sb29rdXAoXG4gICAgICAgICAgSHViTmFtZS5DaGFpbkNvbm5lY3Rpb24sXG4gICAgICAgICAga2V5XG4gICAgICAgICk7XG4gICAgICAgIGlmICghY29ubmVjdGlvbkluZm9zLmhhcyhrZXkpKSB7XG4gICAgICAgICAgY29ubmVjdGlvbkluZm9zLmluaXQoa2V5LCBjb25uZWN0aW9uSW5mbyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oY2hhaW5JZDEsIGNoYWluSWQyLCBjb25uZWN0aW9uSW5mbyk7XG4gICAgICB9IGNhdGNoIChlMikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwibG9va3VwQ29ubmVjdGlvbkluZm9cIiwgY2hhaW5JZDEsIGNoYWluSWQyLCBcImVycm9yXCIsIGUyKTtcbiAgICAgICAgdGhyb3cgbWFrZUVycm9yKGBjb25uZWN0aW9uIG5vdCBmb3VuZDogJHtjaGFpbklkMX08LT4ke2NoYWluSWQyfWApO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbG9va3VwQ2hhaW5zQW5kQ29ubmVjdGlvbiA9IHZvd1Rvb2xzLnJldHJ5YWJsZShcbiAgICB6b25lLFxuICAgIFwibG9va3VwQ2hhaW5zQW5kQ29ubmVjdGlvblwiLFxuICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIC8vXG4gICAgYXN5bmMgKHByaW1hcnlOYW1lLCBjb3VudGVyTmFtZSkgPT4ge1xuICAgICAgY29uc3QgW3ByaW1hcnksIGNvdW50ZXJdID0gYXdhaXQgdm93VG9vbHMuYXNQcm9taXNlKFxuICAgICAgICB2b3dUb29scy5hbGxWb3dzKFtcbiAgICAgICAgICBjaGFpbkh1Yi5nZXRDaGFpbkluZm8ocHJpbWFyeU5hbWUpLFxuICAgICAgICAgIGNoYWluSHViLmdldENoYWluSW5mbyhjb3VudGVyTmFtZSlcbiAgICAgICAgXSlcbiAgICAgICk7XG4gICAgICBjb25zdCBjb25uZWN0aW9uSW5mbyA9IHByaW1hcnkubmFtZXNwYWNlID09PSBcImNvc21vc1wiICYmIGNvdW50ZXIubmFtZXNwYWNlID09PSBcImNvc21vc1wiID8gYXdhaXQgdm93VG9vbHMuYXNQcm9taXNlKFxuICAgICAgICBjaGFpbkh1Yi5nZXRDb25uZWN0aW9uSW5mbyhwcmltYXJ5LCBjb3VudGVyKVxuICAgICAgKSA6IHZvaWQgMDtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgW3ByaW1hcnksIGNvdW50ZXIsIGNvbm5lY3Rpb25JbmZvXVxuICAgICAgKTtcbiAgICB9XG4gICk7XG4gIGNvbnN0IGNoYWluSHViID0gem9uZS5leG8oXCJDaGFpbkh1YlwiLCBDaGFpbkh1YkksIHtcbiAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgcmVnaXN0ZXJDaGFpbihuYW1lLCBjaGFpbkluZm8pIHtcbiAgICAgIGNoYWluSW5mb3MuaW5pdChuYW1lLCBjaGFpbkluZm8pO1xuICAgICAgY2hhaW5JZFRvQ2hhaW5OYW1lLmluaXQoY2FpcElkRnJvbUluZm8oY2hhaW5JbmZvKSwgbmFtZSk7XG4gICAgICBpZiAoY2hhaW5JbmZvLm5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIiAmJiBjaGFpbkluZm8uYmVjaDMyUHJlZml4KSB7XG4gICAgICAgIGJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lLmluaXQoY2hhaW5JbmZvLmJlY2gzMlByZWZpeCwgbmFtZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cbiAgICAgKi9cbiAgICB1cGRhdGVDaGFpbihjaGFpbk5hbWUsIGNoYWluSW5mbykge1xuICAgICAgaWYgKCFjaGFpbkluZm9zLmhhcyhjaGFpbk5hbWUpKSB7XG4gICAgICAgIHRocm93IG1ha2VFcnJvcihgQ2hhaW4gJHtxdW90ZShjaGFpbk5hbWUpfSBub3QgcmVnaXN0ZXJlZGApO1xuICAgICAgfVxuICAgICAgY29uc3Qgb2xkSW5mbyA9IGNoYWluSW5mb3MuZ2V0KGNoYWluTmFtZSk7XG4gICAgICBpZiAoY2hhaW5JZFRvQ2hhaW5OYW1lLmhhcyhjYWlwSWRGcm9tSW5mbyhvbGRJbmZvKSkpIHtcbiAgICAgICAgY2hhaW5JZFRvQ2hhaW5OYW1lLmRlbGV0ZShjYWlwSWRGcm9tSW5mbyhvbGRJbmZvKSk7XG4gICAgICB9XG4gICAgICBpZiAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvbGRJbmZvLmJlY2gzMlByZWZpeFxuICAgICAgKSB7XG4gICAgICAgIGJlY2gzMlByZWZpeFRvQ2hhaW5OYW1lLmRlbGV0ZShcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBvbGRJbmZvLmJlY2gzMlByZWZpeFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY2hhaW5JbmZvcy5zZXQoY2hhaW5OYW1lLCBjaGFpbkluZm8pO1xuICAgICAgY2hhaW5JZFRvQ2hhaW5OYW1lLmluaXQoY2FpcElkRnJvbUluZm8oY2hhaW5JbmZvKSwgY2hhaW5OYW1lKTtcbiAgICAgIGlmIChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGNoYWluSW5mby5iZWNoMzJQcmVmaXhcbiAgICAgICkge1xuICAgICAgICBiZWNoMzJQcmVmaXhUb0NoYWluTmFtZS5pbml0KFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIGNoYWluSW5mby5iZWNoMzJQcmVmaXgsXG4gICAgICAgICAgY2hhaW5OYW1lXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKlxuXG5cblxuICAgICAqL1xuICAgIGdldENoYWluSW5mbyhjaGFpbk5hbWUpIHtcbiAgICAgIGNoYWluTmFtZS5pbmNsdWRlcyhcIjpcIikgJiYgdGhyb3dSZWRhY3RlZGAke2NoYWluTmFtZX0gbXVzdCBiZSBhIGJhcmUgY2hhaW4gbmFtZS4gTWF5YmUgdHJ5IGdldENoYWluSW5mb0J5Q2hhaW5JZCgpYDtcbiAgICAgIGlmIChjaGFpbkluZm9zLmhhcyhjaGFpbk5hbWUpKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICB2b3dUb29scy5hc1ZvdyhcbiAgICAgICAgICAgICgpID0+IChcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgY2hhaW5JbmZvcy5nZXQoY2hhaW5OYW1lKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBsb29rdXBDaGFpbkluZm8oY2hhaW5OYW1lKTtcbiAgICB9LFxuICAgIC8qXG5cblxuICAgICAqL1xuICAgIGdldENoYWluSW5mb0J5Q2hhaW5JZChjaGFpbklkKSB7XG4gICAgICBjaGFpbklkVG9DaGFpbk5hbWUuaGFzKGNoYWluSWQpIHx8IHRocm93UmVkYWN0ZWRgQ2hhaW4gbmFtZSBub3QgZm91bmQgZm9yICR7cXVvdGUoY2hhaW5JZCl9YDtcbiAgICAgIGNvbnN0IGNoYWluTmFtZSA9IGNoYWluSWRUb0NoYWluTmFtZS5nZXQoY2hhaW5JZCk7XG4gICAgICBjaGFpbkluZm9zLmhhcyhjaGFpbk5hbWUpIHx8IHRocm93UmVkYWN0ZWRgQ2hhaW4gSW5mbyBub3QgZm91bmQgZm9yICR7cXVvdGUoY2hhaW5JZCl9YDtcbiAgICAgIHJldHVybiBjaGFpbkluZm9zLmdldChjaGFpbk5hbWUpO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG4gICAgICovXG4gICAgcmVnaXN0ZXJDb25uZWN0aW9uKHByaW1hcnlDaGFpbklkLCBjb3VudGVycGFydHlDaGFpbklkLCBjb25uZWN0aW9uSW5mbykge1xuICAgICAgY29uc3QgW2tleSwgbm9ybWFsaXplZF0gPSBub3JtYWxpemVDb25uZWN0aW9uSW5mbyhcbiAgICAgICAgcHJpbWFyeUNoYWluSWQsXG4gICAgICAgIGNvdW50ZXJwYXJ0eUNoYWluSWQsXG4gICAgICAgIGNvbm5lY3Rpb25JbmZvXG4gICAgICApO1xuICAgICAgY29ubmVjdGlvbkluZm9zLmluaXQoa2V5LCBub3JtYWxpemVkKTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgKi9cbiAgICB1cGRhdGVDb25uZWN0aW9uKHByaW1hcnlDaGFpbklkLCBjb3VudGVycGFydHlDaGFpbklkLCBjb25uZWN0aW9uSW5mbykge1xuICAgICAgY29uc3Qga2V5ID0gY29ubmVjdGlvbktleShwcmltYXJ5Q2hhaW5JZCwgY291bnRlcnBhcnR5Q2hhaW5JZCk7XG4gICAgICBpZiAoIWNvbm5lY3Rpb25JbmZvcy5oYXMoa2V5KSkge1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoXG4gICAgICAgICAgYENvbm5lY3Rpb24gJHtxdW90ZShwcmltYXJ5Q2hhaW5JZCl9PC0+JHtxdW90ZShjb3VudGVycGFydHlDaGFpbklkKX0gbm90IHJlZ2lzdGVyZWRgXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjb25zdCBbXywgbm9ybWFsaXplZEluZm9dID0gbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oXG4gICAgICAgIHByaW1hcnlDaGFpbklkLFxuICAgICAgICBjb3VudGVycGFydHlDaGFpbklkLFxuICAgICAgICBjb25uZWN0aW9uSW5mb1xuICAgICAgKTtcbiAgICAgIGNvbm5lY3Rpb25JbmZvcy5zZXQoa2V5LCBub3JtYWxpemVkSW5mbyk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuICAgICAqL1xuICAgIGdldENvbm5lY3Rpb25JbmZvKHByaW1hcnksIGNvdW50ZXIpIHtcbiAgICAgIGNvbnN0IHByaW1hcnlJZCA9IHR5cGVvZiBwcmltYXJ5ID09PSBcInN0cmluZ1wiID8gcHJpbWFyeSA6IHByaW1hcnkuY2hhaW5JZDtcbiAgICAgIGNvbnN0IGNvdW50ZXJJZCA9IHR5cGVvZiBjb3VudGVyID09PSBcInN0cmluZ1wiID8gY291bnRlciA6IGNvdW50ZXIuY2hhaW5JZDtcbiAgICAgIGNvbnN0IGtleSA9IGNvbm5lY3Rpb25LZXkocHJpbWFyeUlkLCBjb3VudGVySWQpO1xuICAgICAgaWYgKGNvbm5lY3Rpb25JbmZvcy5oYXMoa2V5KSkge1xuICAgICAgICByZXR1cm4gdm93VG9vbHMuYXNWb3coXG4gICAgICAgICAgKCkgPT4gZGVub3JtYWxpemVDb25uZWN0aW9uSW5mbyhcbiAgICAgICAgICAgIHByaW1hcnlJZCxcbiAgICAgICAgICAgIGNvdW50ZXJJZCxcbiAgICAgICAgICAgIGNvbm5lY3Rpb25JbmZvcy5nZXQoa2V5KVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBsb29rdXBDb25uZWN0aW9uSW5mbyhwcmltYXJ5SWQsIGNvdW50ZXJJZCk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgZ2V0Q2hhaW5zQW5kQ29ubmVjdGlvbihwcmltYXJ5TmFtZSwgY291bnRlck5hbWUpIHtcbiAgICAgIHJldHVybiBsb29rdXBDaGFpbnNBbmRDb25uZWN0aW9uKHByaW1hcnlOYW1lLCBjb3VudGVyTmFtZSk7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIHJlZ2lzdGVyQXNzZXQoZGVub20sIGRldGFpbCkge1xuICAgICAgY29uc3QgeyBjaGFpbk5hbWUsIGJhc2VOYW1lIH0gPSBkZXRhaWw7XG4gICAgICBjaGFpbkluZm9zLmhhcyhjaGFpbk5hbWUpIHx8IHRocm93UmVkYWN0ZWRgbXVzdCByZWdpc3RlciBjaGFpbiAke3F1b3RlKGNoYWluTmFtZSl9IGZpcnN0YDtcbiAgICAgIGNoYWluSW5mb3MuaGFzKGJhc2VOYW1lKSB8fCB0aHJvd1JlZGFjdGVkYG11c3QgcmVnaXN0ZXIgY2hhaW4gJHtxdW90ZShiYXNlTmFtZSl9IGZpcnN0YDtcbiAgICAgIGNvbnN0IGRlbm9tS2V5ID0gbWFrZURlbm9tS2V5KGRlbm9tLCBkZXRhaWwuY2hhaW5OYW1lKTtcbiAgICAgIGRlbm9tRGV0YWlscy5oYXMoZGVub21LZXkpICYmIHRocm93UmVkYWN0ZWRgYWxyZWFkeSByZWdpc3RlcmVkICR7cXVvdGUoZGVub20pfSBvbiAke3F1b3RlKGNoYWluTmFtZSl9YDtcbiAgICAgIGRlbm9tRGV0YWlscy5pbml0KGRlbm9tS2V5LCBkZXRhaWwpO1xuICAgICAgaWYgKGRldGFpbC5icmFuZCkge1xuICAgICAgICBjaGFpbk5hbWUgPT09IFwiYWdvcmljXCIgfHwgdGhyb3dSZWRhY3RlZGBicmFuZHMgb25seSByZWdpc3RlcmFibGUgZm9yIGFnb3JpYy1oZWxkIGFzc2V0c2A7XG4gICAgICAgIGJyYW5kRGVub21zLmluaXQoZGV0YWlsLmJyYW5kLCBkZW5vbSk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIHVwZGF0ZUFzc2V0KGRlbm9tLCBkZXRhaWwpIHtcbiAgICAgIGNvbnN0IHsgYmFzZU5hbWUsIGJyYW5kLCBjaGFpbk5hbWUgfSA9IGRldGFpbDtcbiAgICAgIGNvbnN0IGRlbm9tS2V5ID0gbWFrZURlbm9tS2V5KGRlbm9tLCBjaGFpbk5hbWUpO1xuICAgICAgaWYgKCFkZW5vbURldGFpbHMuaGFzKGRlbm9tS2V5KSkge1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoYEFzc2V0ICR7cXVvdGUoZGVub20pfSBvbiAke3F1b3RlKGNoYWluTmFtZSl9IG5vdCByZWdpc3RlcmVkYCk7XG4gICAgICB9XG4gICAgICBpZiAoIWNoYWluSW5mb3MuaGFzKGNoYWluTmFtZSkpIHtcbiAgICAgICAgdGhyb3cgbWFrZUVycm9yKGBDaGFpbiAke3F1b3RlKGNoYWluTmFtZSl9IG5vdCByZWdpc3RlcmVkYCk7XG4gICAgICB9XG4gICAgICBpZiAoIWNoYWluSW5mb3MuaGFzKGJhc2VOYW1lKSkge1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoYENoYWluICR7cXVvdGUoYmFzZU5hbWUpfSBub3QgcmVnaXN0ZXJlZGApO1xuICAgICAgfVxuICAgICAgaWYgKGJyYW5kKSB7XG4gICAgICAgIGlmIChjaGFpbk5hbWUgIT09IFwiYWdvcmljXCIpIHtcbiAgICAgICAgICB0aHJvdyBtYWtlRXJyb3IoXCJCcmFuZHMgb25seSByZWdpc3RlcmFibGUgZm9yIGFnb3JpYy1oZWxkIGFzc2V0c1wiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3Qgb2xkRGV0YWlsID0gZGVub21EZXRhaWxzLmdldChkZW5vbUtleSk7XG4gICAgICBpZiAob2xkRGV0YWlsLmJyYW5kKSB7XG4gICAgICAgIGJyYW5kRGVub21zLmRlbGV0ZShvbGREZXRhaWwuYnJhbmQpO1xuICAgICAgfVxuICAgICAgZGVub21EZXRhaWxzLnNldChkZW5vbUtleSwgZGV0YWlsKTtcbiAgICAgIGlmIChicmFuZCkge1xuICAgICAgICBicmFuZERlbm9tcy5pbml0KGJyYW5kLCBkZW5vbSk7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cbiAgICAgKi9cbiAgICBnZXRBc3NldChkZW5vbSwgc3JjQ2hhaW5OYW1lKSB7XG4gICAgICBjb25zdCBkZW5vbUtleSA9IG1ha2VEZW5vbUtleShkZW5vbSwgc3JjQ2hhaW5OYW1lKTtcbiAgICAgIGlmIChkZW5vbURldGFpbHMuaGFzKGRlbm9tS2V5KSkge1xuICAgICAgICByZXR1cm4gZGVub21EZXRhaWxzLmdldChkZW5vbUtleSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdm9pZCAwO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgIGdldERlbm9tKGJyYW5kKSB7XG4gICAgICBpZiAoYnJhbmREZW5vbXMuaGFzKGJyYW5kKSkge1xuICAgICAgICByZXR1cm4gYnJhbmREZW5vbXMuZ2V0KGJyYW5kKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG4gICAgICovXG4gICAgcmVzb2x2ZUFjY291bnRJZChwYXJ0aWFsSWQpIHtcbiAgICAgIGlmIChwYXJ0aWFsSWQuc3BsaXQoXCI6XCIpLmxlbmd0aCA9PT0gMykge1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHBhcnRpYWxJZFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgY29zbW9zQ2hhaW5JZCA9IHJlc29sdmVDb3Ntb3NDaGFpbklkKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHBhcnRpYWxJZFxuICAgICAgKTtcbiAgICAgIHJldHVybiBgY29zbW9zOiR7Y29zbW9zQ2hhaW5JZH06JHtwYXJ0aWFsSWR9YDtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgY29lcmNlQ29zbW9zQWRkcmVzcyhwYXJ0aWFsSWQpIHtcbiAgICAgIGlmICh0eXBlb2YgcGFydGlhbElkICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHJldHVybiBwYXJ0aWFsSWQ7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXJ0cyA9IHBhcnRpYWxJZC5zcGxpdChcIjpcIik7XG4gICAgICBpZiAocGFydHMubGVuZ3RoID09PSAzKSB7XG4gICAgICAgIGFzc2VydC5lcXVhbChwYXJ0c1swXSwgXCJjb3Ntb3NcIik7XG4gICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgIGNoYWluSWQ6IHBhcnRzWzFdLFxuICAgICAgICAgIGVuY29kaW5nOiBcImJlY2gzMlwiLFxuICAgICAgICAgIHZhbHVlOiAoXG4gICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICBwYXJ0c1syXVxuICAgICAgICAgIClcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBhc3NlcnQuZXF1YWwocGFydHMubGVuZ3RoLCAxKTtcbiAgICAgIGNvbnN0IHZhbHVlID0gKFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHBhcnRpYWxJZFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGNvc21vc0NoYWluSWQgPSByZXNvbHZlQ29zbW9zQ2hhaW5JZCh2YWx1ZSk7XG4gICAgICByZXR1cm4gaGFyZGVuKHtcbiAgICAgICAgY2hhaW5JZDogY29zbW9zQ2hhaW5JZCxcbiAgICAgICAgdmFsdWUsXG4gICAgICAgIGVuY29kaW5nOiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICBcImJlY2gzMlwiXG4gICAgICAgIClcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgbWFrZVRyYW5zZmVyUm91dGUoZGVzdGluYXRpb24sIGRlbm9tQW1vdW50LCBzcmNDaGFpbk5hbWUsIGZvcndhcmRPcHRzKSB7XG4gICAgICBjaGFpbkluZm9zLmhhcyhzcmNDaGFpbk5hbWUpIHx8IHRocm93UmVkYWN0ZWRgY2hhaW4gaW5mbyBub3QgZm91bmQgZm9yIGhvbGRpbmcgY2hhaW46ICR7cXVvdGUoc3JjQ2hhaW5OYW1lKX1gO1xuICAgICAgY29uc3QgZGVub21EZXRhaWwgPSBjaGFpbkh1Yi5nZXRBc3NldChkZW5vbUFtb3VudC5kZW5vbSwgc3JjQ2hhaW5OYW1lKTtcbiAgICAgIGRlbm9tRGV0YWlsIHx8IHRocm93UmVkYWN0ZWRgbm8gZGVub20gZGV0YWlsIGZvcjogJHtxdW90ZShkZW5vbUFtb3VudC5kZW5vbSl9IG9uICR7cXVvdGUoc3JjQ2hhaW5OYW1lKX0uIGVuc3VyZSBpdCBpcyByZWdpc3RlcmVkIGluIGNoYWluSHViLmA7XG4gICAgICBjb25zdCB7IGJhc2VOYW1lLCBjaGFpbk5hbWUgfSA9IChcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZGVub21EZXRhaWxcbiAgICAgICk7XG4gICAgICBjaGFpbk5hbWUgPT09IHNyY0NoYWluTmFtZSB8fCB0aHJvd1JlZGFjdGVkYGNhbm5vdCB0cmFuc2ZlciBhc3NldCAke3F1b3RlKGRlbm9tQW1vdW50LmRlbm9tKX0uIGhlbGQgb24gJHtxdW90ZShjaGFpbk5hbWUpfSBub3QgJHtxdW90ZShzcmNDaGFpbk5hbWUpfS5gO1xuICAgICAgY2hhaW5JbmZvcy5oYXMoYmFzZU5hbWUpIHx8IHRocm93UmVkYWN0ZWRgY2hhaW4gaW5mbyBub3QgZm91bmQgZm9yIGlzc3VpbmcgY2hhaW46ICR7cXVvdGUoYmFzZU5hbWUpfWA7XG4gICAgICBjb25zdCBiYXNlQ2hhaW5JbmZvID0gY2hhaW5JbmZvcy5nZXQoYmFzZU5hbWUpO1xuICAgICAgaWYgKGJhc2VDaGFpbkluZm8ubmFtZXNwYWNlICE9PSBcImNvc21vc1wiKVxuICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYE9ubHkgY29zbW9zIHN1cHBvcnRlZDsgZ290ICR7cXVvdGUoYmFzZUNoYWluSW5mby5uYW1lc3BhY2UpfWA7XG4gICAgICBjb25zdCB7IGNoYWluSWQ6IGJhc2VDaGFpbklkLCBwZm1FbmFibGVkIH0gPSBiYXNlQ2hhaW5JbmZvO1xuICAgICAgY29uc3QgaG9sZGluZ0NoYWluSW5mbyA9IGNoYWluSW5mb3MuZ2V0KHNyY0NoYWluTmFtZSk7XG4gICAgICBpZiAoaG9sZGluZ0NoYWluSW5mby5uYW1lc3BhY2UgIT09IFwiY29zbW9zXCIpIHtcbiAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBPbmx5IGNvc21vcyBzdXBwb3J0ZWQ7IGdvdCAke3F1b3RlKGhvbGRpbmdDaGFpbkluZm8ubmFtZXNwYWNlKX1gO1xuICAgICAgfVxuICAgICAgY29uc3QgeyBjaGFpbklkOiBob2xkaW5nQ2hhaW5JZCB9ID0gaG9sZGluZ0NoYWluSW5mbztcbiAgICAgIGNvbnN0IGNvc21vc0Rlc3QgPSBjaGFpbkh1Yi5jb2VyY2VDb3Ntb3NBZGRyZXNzKGRlc3RpbmF0aW9uKTtcbiAgICAgIGlmIChiYXNlQ2hhaW5JZCA9PT0gY29zbW9zRGVzdC5jaGFpbklkIHx8IGJhc2VOYW1lID09PSBzcmNDaGFpbk5hbWUpIHtcbiAgICAgICAgY29uc3QgY29ubktleSA9IGNvbm5lY3Rpb25LZXkoaG9sZGluZ0NoYWluSWQsIGNvc21vc0Rlc3QuY2hhaW5JZCk7XG4gICAgICAgIGNvbm5lY3Rpb25JbmZvcy5oYXMoY29ubktleSkgfHwgdGhyb3dSZWRhY3RlZGBubyBjb25uZWN0aW9uIGluZm8gZm91bmQgZm9yICR7aG9sZGluZ0NoYWluSWR9PC0+JHtjb3Ntb3NEZXN0LmNoYWluSWR9YDtcbiAgICAgICAgY29uc3QgeyB0cmFuc2ZlckNoYW5uZWwgfSA9IGRlbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oXG4gICAgICAgICAgaG9sZGluZ0NoYWluSWQsXG4gICAgICAgICAgLy9cbiAgICAgICAgICBjb3Ntb3NEZXN0LmNoYWluSWQsXG4gICAgICAgICAgLy9cbiAgICAgICAgICBjb25uZWN0aW9uSW5mb3MuZ2V0KGNvbm5LZXkpXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgIHNvdXJjZVBvcnQ6IHRyYW5zZmVyQ2hhbm5lbC5wb3J0SWQsXG4gICAgICAgICAgc291cmNlQ2hhbm5lbDogdHJhbnNmZXJDaGFubmVsLmNoYW5uZWxJZCxcbiAgICAgICAgICB0b2tlbjoge1xuICAgICAgICAgICAgYW1vdW50OiBTdHJpbmcoZGVub21BbW91bnQudmFsdWUpLFxuICAgICAgICAgICAgZGVub206IGRlbm9tQW1vdW50LmRlbm9tXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZWNlaXZlcjogY29zbW9zRGVzdC52YWx1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHBmbUVuYWJsZWQgfHwgdGhyb3dSZWRhY3RlZGBwZm0gbm90IGVuYWJsZWQgb24gaXNzdWluZyBjaGFpbjogJHtxdW90ZShiYXNlTmFtZSl9YDtcbiAgICAgIGNvbnN0IGN1cnJUb0lzc3VlcktleSA9IGNvbm5lY3Rpb25LZXkoaG9sZGluZ0NoYWluSWQsIGJhc2VDaGFpbklkKTtcbiAgICAgIGNvbm5lY3Rpb25JbmZvcy5oYXMoY3VyclRvSXNzdWVyS2V5KSB8fCB0aHJvd1JlZGFjdGVkYG5vIGNvbm5lY3Rpb24gaW5mbyBmb3VuZCBmb3IgJHtob2xkaW5nQ2hhaW5JZH08LT4ke2Jhc2VDaGFpbklkfWA7XG4gICAgICBjb25zdCBpc3N1ZXJUb0Rlc3RLZXkgPSBjb25uZWN0aW9uS2V5KGJhc2VDaGFpbklkLCBjb3Ntb3NEZXN0LmNoYWluSWQpO1xuICAgICAgY29ubmVjdGlvbkluZm9zLmhhcyhpc3N1ZXJUb0Rlc3RLZXkpIHx8IHRocm93UmVkYWN0ZWRgbm8gY29ubmVjdGlvbiBpbmZvIGZvdW5kIGZvciAke2Jhc2VDaGFpbklkfTwtPiR7Y29zbW9zRGVzdC5jaGFpbklkfWA7XG4gICAgICBjb25zdCBjdXJyVG9Jc3N1ZXIgPSBkZW5vcm1hbGl6ZUNvbm5lY3Rpb25JbmZvKFxuICAgICAgICBob2xkaW5nQ2hhaW5JZCxcbiAgICAgICAgYmFzZUNoYWluSWQsXG4gICAgICAgIGNvbm5lY3Rpb25JbmZvcy5nZXQoY3VyclRvSXNzdWVyS2V5KVxuICAgICAgKTtcbiAgICAgIGNvbnN0IGlzc3VlclRvRGVzdCA9IGRlbm9ybWFsaXplQ29ubmVjdGlvbkluZm8oXG4gICAgICAgIGJhc2VDaGFpbklkLFxuICAgICAgICBjb3Ntb3NEZXN0LmNoYWluSWQsXG4gICAgICAgIGNvbm5lY3Rpb25JbmZvcy5nZXQoaXNzdWVyVG9EZXN0S2V5KVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHsgaW50ZXJtZWRpYXRlUmVjaXBpZW50LCAuLi5yZXN0IH0gPSBmb3J3YXJkT3B0cyA/PyB7fTtcbiAgICAgIGNvbnN0IGZvcndhcmRJbmZvID0gaGFyZGVuKHtcbiAgICAgICAgZm9yd2FyZDoge1xuICAgICAgICAgIHJlY2VpdmVyOiBjb3Ntb3NEZXN0LnZhbHVlLFxuICAgICAgICAgIHBvcnQ6IGlzc3VlclRvRGVzdC50cmFuc2ZlckNoYW5uZWwucG9ydElkLFxuICAgICAgICAgIGNoYW5uZWw6IGlzc3VlclRvRGVzdC50cmFuc2ZlckNoYW5uZWwuY2hhbm5lbElkLFxuICAgICAgICAgIC4uLkRlZmF1bHRQZm1UaW1lb3V0T3B0cyxcbiAgICAgICAgICAuLi4vKiAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHJlc3RcbiAgICAgICAgICAvL1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBzb3VyY2VQb3J0OiBjdXJyVG9Jc3N1ZXIudHJhbnNmZXJDaGFubmVsLnBvcnRJZCxcbiAgICAgICAgc291cmNlQ2hhbm5lbDogY3VyclRvSXNzdWVyLnRyYW5zZmVyQ2hhbm5lbC5jaGFubmVsSWQsXG4gICAgICAgIHRva2VuOiB7XG4gICAgICAgICAgYW1vdW50OiBTdHJpbmcoZGVub21BbW91bnQudmFsdWUpLFxuICAgICAgICAgIGRlbm9tOiBkZW5vbUFtb3VudC5kZW5vbVxuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIHJlY2VpdmVyOiBpbnRlcm1lZGlhdGVSZWNpcGllbnQ/LnZhbHVlIHx8IFBGTV9SRUNFSVZFUixcbiAgICAgICAgZm9yd2FyZEluZm9cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBjaGFpbkh1Yjtcbn07XG5cbi8vXG52YXIgdHlwZWRKc29uID0gKGUyLCB0NSkgPT4gKHsgXCJAdHlwZVwiOiBlMiwgLi4udDUgfSk7XG52YXIgdDMgPSAvXlxcLyg/PHNlcnZpY2VOYW1lPlxcdysoPzpcXC5cXHcrKSopXFwuUXVlcnkoPzxtZXRob2ROYW1lPlxcdyspUmVxdWVzdCQvO1xudmFyIHR5cGVVcmxUb0dycGNQYXRoID0gKGUyKSA9PiB7XG4gIGNvbnN0IHI1ID0gZTIubWF0Y2godDMpO1xuICBpZiAoIXI1IHx8ICFyNS5ncm91cHMpIHRocm93IFR5cGVFcnJvcihgSW52YWxpZCB0eXBlVXJsOiAke2UyfS4gTXVzdCBiZSBhIFF1ZXJ5IFJlcXVlc3QuYCk7XG4gIGNvbnN0IHsgc2VydmljZU5hbWU6IG8yLCBtZXRob2ROYW1lOiBzMyB9ID0gcjUuZ3JvdXBzO1xuICByZXR1cm4gYC8ke28yfS5RdWVyeS8ke3MzfWA7XG59O1xudmFyIHRvUmVxdWVzdFF1ZXJ5SnNvbiA9ICh0NSwgcjUgPSB7fSkgPT4gUmVxdWVzdFF1ZXJ5LnRvSlNPTihSZXF1ZXN0UXVlcnkuZnJvbVBhcnRpYWwoeyBwYXRoOiB0eXBlVXJsVG9HcnBjUGF0aCh0NS50eXBlVXJsKSwgZGF0YTogdDUudmFsdWUsIC4uLnI1IH0pKTtcblxuLy9cbmZ1bmN0aW9uIHIyKCkge1xuICByZXR1cm4geyBmcm9tOiBcIlwiLCBhbW91bnQ6IFwiXCIsIGRlc3RpbmF0aW9uRG9tYWluOiAwLCBtaW50UmVjaXBpZW50OiBuZXcgVWludDhBcnJheSgpLCBidXJuVG9rZW46IFwiXCIgfTtcbn1cbnZhciBNc2dEZXBvc2l0Rm9yQnVybiA9IHsgdHlwZVVybDogXCIvY2lyY2xlLmNjdHAudjEuTXNnRGVwb3NpdEZvckJ1cm5cIiwgZW5jb2RlOiAobjIsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbjIuZnJvbSAmJiBlMi51aW50MzIoMTApLnN0cmluZyhuMi5mcm9tKSwgXCJcIiAhPT0gbjIuYW1vdW50ICYmIGUyLnVpbnQzMigxOCkuc3RyaW5nKG4yLmFtb3VudCksIDAgIT09IG4yLmRlc3RpbmF0aW9uRG9tYWluICYmIGUyLnVpbnQzMigyNCkudWludDMyKG4yLmRlc3RpbmF0aW9uRG9tYWluKSwgMCAhPT0gbjIubWludFJlY2lwaWVudC5sZW5ndGggJiYgZTIudWludDMyKDM0KS5ieXRlcyhuMi5taW50UmVjaXBpZW50KSwgXCJcIiAhPT0gbjIuYnVyblRva2VuICYmIGUyLnVpbnQzMig0Mikuc3RyaW5nKG4yLmJ1cm5Ub2tlbiksIGUyKSwgZGVjb2RlKHQ1LCBlMikge1xuICBjb25zdCBvMiA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSBlMiA/IG8yLmxlbiA6IG8yLnBvcyArIGUyO1xuICBjb25zdCBzMyA9IHIyKCk7XG4gIGZvciAoOyBvMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgbjIgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG4yID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHMzLmZyb20gPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHMzLmFtb3VudCA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgczMuZGVzdGluYXRpb25Eb21haW4gPSBvMi51aW50MzIoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIHMzLm1pbnRSZWNpcGllbnQgPSBvMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgczMuYnVyblRva2VuID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIG4yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHMzO1xufSwgZnJvbUpTT046IChuMikgPT4gKHsgZnJvbTogaXNTZXQobjIuZnJvbSkgPyBTdHJpbmcobjIuZnJvbSkgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KG4yLmFtb3VudCkgPyBTdHJpbmcobjIuYW1vdW50KSA6IFwiXCIsIGRlc3RpbmF0aW9uRG9tYWluOiBpc1NldChuMi5kZXN0aW5hdGlvbkRvbWFpbikgPyBOdW1iZXIobjIuZGVzdGluYXRpb25Eb21haW4pIDogMCwgbWludFJlY2lwaWVudDogaXNTZXQobjIubWludFJlY2lwaWVudCkgPyBieXRlc0Zyb21CYXNlNjQobjIubWludFJlY2lwaWVudCkgOiBuZXcgVWludDhBcnJheSgpLCBidXJuVG9rZW46IGlzU2V0KG4yLmJ1cm5Ub2tlbikgPyBTdHJpbmcobjIuYnVyblRva2VuKSA6IFwiXCIgfSksIHRvSlNPTihuMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBuMi5mcm9tICYmICh0NS5mcm9tID0gbjIuZnJvbSksIHZvaWQgMCAhPT0gbjIuYW1vdW50ICYmICh0NS5hbW91bnQgPSBuMi5hbW91bnQpLCB2b2lkIDAgIT09IG4yLmRlc3RpbmF0aW9uRG9tYWluICYmICh0NS5kZXN0aW5hdGlvbkRvbWFpbiA9IE1hdGgucm91bmQobjIuZGVzdGluYXRpb25Eb21haW4pKSwgdm9pZCAwICE9PSBuMi5taW50UmVjaXBpZW50ICYmICh0NS5taW50UmVjaXBpZW50ID0gYmFzZTY0RnJvbUJ5dGVzKHZvaWQgMCAhPT0gbjIubWludFJlY2lwaWVudCA/IG4yLm1pbnRSZWNpcGllbnQgOiBuZXcgVWludDhBcnJheSgpKSksIHZvaWQgMCAhPT0gbjIuYnVyblRva2VuICYmICh0NS5idXJuVG9rZW4gPSBuMi5idXJuVG9rZW4pLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG4yKSB7XG4gIGNvbnN0IHQ1ID0gcjIoKTtcbiAgcmV0dXJuIHQ1LmZyb20gPSBuMi5mcm9tID8/IFwiXCIsIHQ1LmFtb3VudCA9IG4yLmFtb3VudCA/PyBcIlwiLCB0NS5kZXN0aW5hdGlvbkRvbWFpbiA9IG4yLmRlc3RpbmF0aW9uRG9tYWluID8/IDAsIHQ1Lm1pbnRSZWNpcGllbnQgPSBuMi5taW50UmVjaXBpZW50ID8/IG5ldyBVaW50OEFycmF5KCksIHQ1LmJ1cm5Ub2tlbiA9IG4yLmJ1cm5Ub2tlbiA/PyBcIlwiLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG4yKSA9PiBNc2dEZXBvc2l0Rm9yQnVybi5kZWNvZGUobjIudmFsdWUpLCB0b1Byb3RvOiAobjIpID0+IE1zZ0RlcG9zaXRGb3JCdXJuLmVuY29kZShuMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChuMikgPT4gKHsgdHlwZVVybDogXCIvY2lyY2xlLmNjdHAudjEuTXNnRGVwb3NpdEZvckJ1cm5cIiwgdmFsdWU6IE1zZ0RlcG9zaXRGb3JCdXJuLmVuY29kZShuMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIGEoKSB7XG4gIHJldHVybiB7IGZyb206IFwiXCIsIGFtb3VudDogXCJcIiwgZGVzdGluYXRpb25Eb21haW46IDAsIG1pbnRSZWNpcGllbnQ6IG5ldyBVaW50OEFycmF5KCksIGJ1cm5Ub2tlbjogXCJcIiwgZGVzdGluYXRpb25DYWxsZXI6IG5ldyBVaW50OEFycmF5KCkgfTtcbn1cbnZhciBNc2dEZXBvc2l0Rm9yQnVybldpdGhDYWxsZXIgPSB7IHR5cGVVcmw6IFwiL2NpcmNsZS5jY3RwLnYxLk1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlclwiLCBlbmNvZGU6IChuMiwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBuMi5mcm9tICYmIGUyLnVpbnQzMigxMCkuc3RyaW5nKG4yLmZyb20pLCBcIlwiICE9PSBuMi5hbW91bnQgJiYgZTIudWludDMyKDE4KS5zdHJpbmcobjIuYW1vdW50KSwgMCAhPT0gbjIuZGVzdGluYXRpb25Eb21haW4gJiYgZTIudWludDMyKDI0KS51aW50MzIobjIuZGVzdGluYXRpb25Eb21haW4pLCAwICE9PSBuMi5taW50UmVjaXBpZW50Lmxlbmd0aCAmJiBlMi51aW50MzIoMzQpLmJ5dGVzKG4yLm1pbnRSZWNpcGllbnQpLCBcIlwiICE9PSBuMi5idXJuVG9rZW4gJiYgZTIudWludDMyKDQyKS5zdHJpbmcobjIuYnVyblRva2VuKSwgMCAhPT0gbjIuZGVzdGluYXRpb25DYWxsZXIubGVuZ3RoICYmIGUyLnVpbnQzMig1MCkuYnl0ZXMobjIuZGVzdGluYXRpb25DYWxsZXIpLCBlMiksIGRlY29kZSh0NSwgZTIpIHtcbiAgY29uc3QgbzIgPSB0NSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHQ1IDogbmV3IEJpbmFyeVJlYWRlcih0NSk7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gZTIgPyBvMi5sZW4gOiBvMi5wb3MgKyBlMjtcbiAgY29uc3QgcjUgPSBhKCk7XG4gIGZvciAoOyBvMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgbjIgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG4yID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LmZyb20gPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LmFtb3VudCA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgcjUuZGVzdGluYXRpb25Eb21haW4gPSBvMi51aW50MzIoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIHI1Lm1pbnRSZWNpcGllbnQgPSBvMi5ieXRlcygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgcjUuYnVyblRva2VuID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA2OlxuICAgICAgICByNS5kZXN0aW5hdGlvbkNhbGxlciA9IG8yLmJ5dGVzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIG4yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChuMikgPT4gKHsgZnJvbTogaXNTZXQobjIuZnJvbSkgPyBTdHJpbmcobjIuZnJvbSkgOiBcIlwiLCBhbW91bnQ6IGlzU2V0KG4yLmFtb3VudCkgPyBTdHJpbmcobjIuYW1vdW50KSA6IFwiXCIsIGRlc3RpbmF0aW9uRG9tYWluOiBpc1NldChuMi5kZXN0aW5hdGlvbkRvbWFpbikgPyBOdW1iZXIobjIuZGVzdGluYXRpb25Eb21haW4pIDogMCwgbWludFJlY2lwaWVudDogaXNTZXQobjIubWludFJlY2lwaWVudCkgPyBieXRlc0Zyb21CYXNlNjQobjIubWludFJlY2lwaWVudCkgOiBuZXcgVWludDhBcnJheSgpLCBidXJuVG9rZW46IGlzU2V0KG4yLmJ1cm5Ub2tlbikgPyBTdHJpbmcobjIuYnVyblRva2VuKSA6IFwiXCIsIGRlc3RpbmF0aW9uQ2FsbGVyOiBpc1NldChuMi5kZXN0aW5hdGlvbkNhbGxlcikgPyBieXRlc0Zyb21CYXNlNjQobjIuZGVzdGluYXRpb25DYWxsZXIpIDogbmV3IFVpbnQ4QXJyYXkoKSB9KSwgdG9KU09OKG4yKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG4yLmZyb20gJiYgKHQ1LmZyb20gPSBuMi5mcm9tKSwgdm9pZCAwICE9PSBuMi5hbW91bnQgJiYgKHQ1LmFtb3VudCA9IG4yLmFtb3VudCksIHZvaWQgMCAhPT0gbjIuZGVzdGluYXRpb25Eb21haW4gJiYgKHQ1LmRlc3RpbmF0aW9uRG9tYWluID0gTWF0aC5yb3VuZChuMi5kZXN0aW5hdGlvbkRvbWFpbikpLCB2b2lkIDAgIT09IG4yLm1pbnRSZWNpcGllbnQgJiYgKHQ1Lm1pbnRSZWNpcGllbnQgPSBiYXNlNjRGcm9tQnl0ZXModm9pZCAwICE9PSBuMi5taW50UmVjaXBpZW50ID8gbjIubWludFJlY2lwaWVudCA6IG5ldyBVaW50OEFycmF5KCkpKSwgdm9pZCAwICE9PSBuMi5idXJuVG9rZW4gJiYgKHQ1LmJ1cm5Ub2tlbiA9IG4yLmJ1cm5Ub2tlbiksIHZvaWQgMCAhPT0gbjIuZGVzdGluYXRpb25DYWxsZXIgJiYgKHQ1LmRlc3RpbmF0aW9uQ2FsbGVyID0gYmFzZTY0RnJvbUJ5dGVzKHZvaWQgMCAhPT0gbjIuZGVzdGluYXRpb25DYWxsZXIgPyBuMi5kZXN0aW5hdGlvbkNhbGxlciA6IG5ldyBVaW50OEFycmF5KCkpKSwgdDU7XG59LCBmcm9tUGFydGlhbChuMikge1xuICBjb25zdCB0NSA9IGEoKTtcbiAgcmV0dXJuIHQ1LmZyb20gPSBuMi5mcm9tID8/IFwiXCIsIHQ1LmFtb3VudCA9IG4yLmFtb3VudCA/PyBcIlwiLCB0NS5kZXN0aW5hdGlvbkRvbWFpbiA9IG4yLmRlc3RpbmF0aW9uRG9tYWluID8/IDAsIHQ1Lm1pbnRSZWNpcGllbnQgPSBuMi5taW50UmVjaXBpZW50ID8/IG5ldyBVaW50OEFycmF5KCksIHQ1LmJ1cm5Ub2tlbiA9IG4yLmJ1cm5Ub2tlbiA/PyBcIlwiLCB0NS5kZXN0aW5hdGlvbkNhbGxlciA9IG4yLmRlc3RpbmF0aW9uQ2FsbGVyID8/IG5ldyBVaW50OEFycmF5KCksIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAobjIpID0+IE1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlci5kZWNvZGUobjIudmFsdWUpLCB0b1Byb3RvOiAobjIpID0+IE1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlci5lbmNvZGUobjIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobjIpID0+ICh7IHR5cGVVcmw6IFwiL2NpcmNsZS5jY3RwLnYxLk1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlclwiLCB2YWx1ZTogTXNnRGVwb3NpdEZvckJ1cm5XaXRoQ2FsbGVyLmVuY29kZShuMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbmZ1bmN0aW9uIHIzKCkge1xuICByZXR1cm4geyBrZXk6IG5ldyBVaW50OEFycmF5KCksIG9mZnNldDogQmlnSW50KDApLCBsaW1pdDogQmlnSW50KDApLCBjb3VudFRvdGFsOiBmYWxzZSwgcmV2ZXJzZTogZmFsc2UgfTtcbn1cbnZhciBQYWdlUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhc2UucXVlcnkudjFiZXRhMS5QYWdlUmVxdWVzdFwiLCBlbmNvZGU6ICh0NSwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICgwICE9PSB0NS5rZXkubGVuZ3RoICYmIG8yLnVpbnQzMigxMCkuYnl0ZXModDUua2V5KSwgdDUub2Zmc2V0ICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDE2KS51aW50NjQodDUub2Zmc2V0KSwgdDUubGltaXQgIT09IEJpZ0ludCgwKSAmJiBvMi51aW50MzIoMjQpLnVpbnQ2NCh0NS5saW1pdCksIHRydWUgPT09IHQ1LmNvdW50VG90YWwgJiYgbzIudWludDMyKDMyKS5ib29sKHQ1LmNvdW50VG90YWwpLCB0cnVlID09PSB0NS5yZXZlcnNlICYmIG8yLnVpbnQzMig0MCkuYm9vbCh0NS5yZXZlcnNlKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IG4yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IG8yID8gbjIubGVuIDogbjIucG9zICsgbzI7XG4gIGNvbnN0IHMzID0gcjMoKTtcbiAgZm9yICg7IG4yLnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCB0NSA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAodDUgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczMua2V5ID0gbjIuYnl0ZXMoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHMzLm9mZnNldCA9IG4yLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgczMubGltaXQgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIHMzLmNvdW50VG90YWwgPSBuMi5ib29sKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA1OlxuICAgICAgICBzMy5yZXZlcnNlID0gbjIuYm9vbCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiB0NSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBzMztcbn0sIGZyb21KU09OOiAodDUpID0+ICh7IGtleTogaXNTZXQodDUua2V5KSA/IGJ5dGVzRnJvbUJhc2U2NCh0NS5rZXkpIDogbmV3IFVpbnQ4QXJyYXkoKSwgb2Zmc2V0OiBpc1NldCh0NS5vZmZzZXQpID8gQmlnSW50KHQ1Lm9mZnNldC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgbGltaXQ6IGlzU2V0KHQ1LmxpbWl0KSA/IEJpZ0ludCh0NS5saW1pdC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgY291bnRUb3RhbDogISFpc1NldCh0NS5jb3VudFRvdGFsKSAmJiBCb29sZWFuKHQ1LmNvdW50VG90YWwpLCByZXZlcnNlOiAhIWlzU2V0KHQ1LnJldmVyc2UpICYmIEJvb2xlYW4odDUucmV2ZXJzZSkgfSksIHRvSlNPTih0NSkge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSB0NS5rZXkgJiYgKGUyLmtleSA9IGJhc2U2NEZyb21CeXRlcyh2b2lkIDAgIT09IHQ1LmtleSA/IHQ1LmtleSA6IG5ldyBVaW50OEFycmF5KCkpKSwgdm9pZCAwICE9PSB0NS5vZmZzZXQgJiYgKGUyLm9mZnNldCA9ICh0NS5vZmZzZXQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSB0NS5saW1pdCAmJiAoZTIubGltaXQgPSAodDUubGltaXQgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgdm9pZCAwICE9PSB0NS5jb3VudFRvdGFsICYmIChlMi5jb3VudFRvdGFsID0gdDUuY291bnRUb3RhbCksIHZvaWQgMCAhPT0gdDUucmV2ZXJzZSAmJiAoZTIucmV2ZXJzZSA9IHQ1LnJldmVyc2UpLCBlMjtcbn0sIGZyb21QYXJ0aWFsKHQ1KSB7XG4gIGNvbnN0IGUyID0gcjMoKTtcbiAgcmV0dXJuIGUyLmtleSA9IHQ1LmtleSA/PyBuZXcgVWludDhBcnJheSgpLCBlMi5vZmZzZXQgPSB2b2lkIDAgIT09IHQ1Lm9mZnNldCAmJiBudWxsICE9PSB0NS5vZmZzZXQgPyBCaWdJbnQodDUub2Zmc2V0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBlMi5saW1pdCA9IHZvaWQgMCAhPT0gdDUubGltaXQgJiYgbnVsbCAhPT0gdDUubGltaXQgPyBCaWdJbnQodDUubGltaXQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGUyLmNvdW50VG90YWwgPSB0NS5jb3VudFRvdGFsID8/IGZhbHNlLCBlMi5yZXZlcnNlID0gdDUucmV2ZXJzZSA/PyBmYWxzZSwgZTI7XG59LCBmcm9tUHJvdG9Nc2c6ICh0NSkgPT4gUGFnZVJlcXVlc3QuZGVjb2RlKHQ1LnZhbHVlKSwgdG9Qcm90bzogKHQ1KSA9PiBQYWdlUmVxdWVzdC5lbmNvZGUodDUpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAodDUpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnF1ZXJ5LnYxYmV0YTEuUGFnZVJlcXVlc3RcIiwgdmFsdWU6IFBhZ2VSZXF1ZXN0LmVuY29kZSh0NSkuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIHMyKCkge1xuICByZXR1cm4geyBuZXh0S2V5OiBuZXcgVWludDhBcnJheSgpLCB0b3RhbDogQmlnSW50KDApIH07XG59XG52YXIgUGFnZVJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFzZS5xdWVyeS52MWJldGExLlBhZ2VSZXNwb25zZVwiLCBlbmNvZGU6ICh0NSwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICgwICE9PSB0NS5uZXh0S2V5Lmxlbmd0aCAmJiBvMi51aW50MzIoMTApLmJ5dGVzKHQ1Lm5leHRLZXkpLCB0NS50b3RhbCAhPT0gQmlnSW50KDApICYmIG8yLnVpbnQzMigxNikudWludDY0KHQ1LnRvdGFsKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IG4yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IG8yID8gbjIubGVuIDogbjIucG9zICsgbzI7XG4gIGNvbnN0IHI1ID0gczIoKTtcbiAgZm9yICg7IG4yLnBvcyA8IGkyOyApIHtcbiAgICBjb25zdCB0NSA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAodDUgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjUubmV4dEtleSA9IG4yLmJ5dGVzKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNS50b3RhbCA9IG4yLnVpbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiB0NSk7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAodDUpID0+ICh7IG5leHRLZXk6IGlzU2V0KHQ1Lm5leHRLZXkpID8gYnl0ZXNGcm9tQmFzZTY0KHQ1Lm5leHRLZXkpIDogbmV3IFVpbnQ4QXJyYXkoKSwgdG90YWw6IGlzU2V0KHQ1LnRvdGFsKSA/IEJpZ0ludCh0NS50b3RhbC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSB9KSwgdG9KU09OKHQ1KSB7XG4gIGNvbnN0IGUyID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IHQ1Lm5leHRLZXkgJiYgKGUyLm5leHRLZXkgPSBiYXNlNjRGcm9tQnl0ZXModm9pZCAwICE9PSB0NS5uZXh0S2V5ID8gdDUubmV4dEtleSA6IG5ldyBVaW50OEFycmF5KCkpKSwgdm9pZCAwICE9PSB0NS50b3RhbCAmJiAoZTIudG90YWwgPSAodDUudG90YWwgfHwgQmlnSW50KDApKS50b1N0cmluZygpKSwgZTI7XG59LCBmcm9tUGFydGlhbCh0NSkge1xuICBjb25zdCBlMiA9IHMyKCk7XG4gIHJldHVybiBlMi5uZXh0S2V5ID0gdDUubmV4dEtleSA/PyBuZXcgVWludDhBcnJheSgpLCBlMi50b3RhbCA9IHZvaWQgMCAhPT0gdDUudG90YWwgJiYgbnVsbCAhPT0gdDUudG90YWwgPyBCaWdJbnQodDUudG90YWwudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGUyO1xufSwgZnJvbVByb3RvTXNnOiAodDUpID0+IFBhZ2VSZXNwb25zZS5kZWNvZGUodDUudmFsdWUpLCB0b1Byb3RvOiAodDUpID0+IFBhZ2VSZXNwb25zZS5lbmNvZGUodDUpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAodDUpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYXNlLnF1ZXJ5LnYxYmV0YTEuUGFnZVJlc3BvbnNlXCIsIHZhbHVlOiBQYWdlUmVzcG9uc2UuZW5jb2RlKHQ1KS5maW5pc2goKSB9KSB9O1xuXG4vL1xudmFyIFF1ZXJ5QmFsYW5jZVJlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlCYWxhbmNlUmVxdWVzdFwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5hZGRyZXNzICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLmFkZHJlc3MpLCBcIlwiICE9PSBlMi5kZW5vbSAmJiBvMi51aW50MzIoMTgpLnN0cmluZyhlMi5kZW5vbSksIG8yKSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSBvMiA/IG4yLmxlbiA6IG4yLnBvcyArIG8yO1xuICBjb25zdCB0NSA9IHsgYWRkcmVzczogXCJcIiwgZGVub206IFwiXCIgfTtcbiAgZm9yICg7IG4yLnBvcyA8IGEyOyApIHtcbiAgICBjb25zdCBlMyA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgdDUuYWRkcmVzcyA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgdDUuZGVub20gPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdDU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBhZGRyZXNzOiBpc1NldChlMi5hZGRyZXNzKSA/IFN0cmluZyhlMi5hZGRyZXNzKSA6IFwiXCIsIGRlbm9tOiBpc1NldChlMi5kZW5vbSkgPyBTdHJpbmcoZTIuZGVub20pIDogXCJcIiB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmFkZHJlc3MgJiYgKG8yLmFkZHJlc3MgPSBlMi5hZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5kZW5vbSAmJiAobzIuZGVub20gPSBlMi5kZW5vbSksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB7IGFkZHJlc3M6IFwiXCIsIGRlbm9tOiBcIlwiIH07XG4gIHJldHVybiBvMi5hZGRyZXNzID0gZTIuYWRkcmVzcyA/PyBcIlwiLCBvMi5kZW5vbSA9IGUyLmRlbm9tID8/IFwiXCIsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5QmFsYW5jZVJlcXVlc3QuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeUJhbGFuY2VSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUJhbGFuY2VSZXF1ZXN0XCIsIHZhbHVlOiBRdWVyeUJhbGFuY2VSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeUJhbGFuY2VSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUJhbGFuY2VSZXNwb25zZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICh2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgQ29pbi5lbmNvZGUoZTIuYmFsYW5jZSwgbzIudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgYTIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCB0NSA9IHZvaWQgMCA9PT0gbzIgPyBhMi5sZW4gOiBhMi5wb3MgKyBvMjtcbiAgY29uc3QgaTIgPSB7IGJhbGFuY2U6IHZvaWQgMCB9O1xuICBmb3IgKDsgYTIucG9zIDwgdDU7ICkge1xuICAgIGNvbnN0IGUzID0gYTIudWludDMyKCk7XG4gICAgaWYgKGUzID4+PiAzID09IDEpIGkyLmJhbGFuY2UgPSBDb2luLmRlY29kZShhMiwgYTIudWludDMyKCkpO1xuICAgIGVsc2UgYTIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBiYWxhbmNlOiBpc1NldChlMi5iYWxhbmNlKSA/IENvaW4uZnJvbUpTT04oZTIuYmFsYW5jZSkgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCBvMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5iYWxhbmNlICYmIChvMi5iYWxhbmNlID0gZTIuYmFsYW5jZSA/IENvaW4udG9KU09OKGUyLmJhbGFuY2UpIDogdm9pZCAwKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgYmFsYW5jZTogdm9pZCAwIH07XG4gIHJldHVybiBvMi5iYWxhbmNlID0gdm9pZCAwICE9PSBlMi5iYWxhbmNlICYmIG51bGwgIT09IGUyLmJhbGFuY2UgPyBDb2luLmZyb21QYXJ0aWFsKGUyLmJhbGFuY2UpIDogdm9pZCAwLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBRdWVyeUJhbGFuY2VSZXNwb25zZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5QmFsYW5jZVJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUJhbGFuY2VSZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlCYWxhbmNlUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuYmFuay52MWJldGExLlF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0XCIsIGVuY29kZTogKG8yLCBuMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG8yLmFkZHJlc3MgJiYgbjIudWludDMyKDEwKS5zdHJpbmcobzIuYWRkcmVzcyksIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBQYWdlUmVxdWVzdC5lbmNvZGUobzIucGFnaW5hdGlvbiwgbjIudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCBuMiksIGRlY29kZShvMiwgbjIpIHtcbiAgY29uc3QgYTIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCB0NSA9IHZvaWQgMCA9PT0gbjIgPyBhMi5sZW4gOiBhMi5wb3MgKyBuMjtcbiAgY29uc3QgaTIgPSB7IGFkZHJlc3M6IFwiXCIsIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgYTIucG9zIDwgdDU7ICkge1xuICAgIGNvbnN0IG8zID0gYTIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBpMi5hZGRyZXNzID0gYTIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBpMi5wYWdpbmF0aW9uID0gUGFnZVJlcXVlc3QuZGVjb2RlKGEyLCBhMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYTIuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgYWRkcmVzczogaXNTZXQobzIuYWRkcmVzcykgPyBTdHJpbmcobzIuYWRkcmVzcykgOiBcIlwiLCBwYWdpbmF0aW9uOiBpc1NldChvMi5wYWdpbmF0aW9uKSA/IFBhZ2VSZXF1ZXN0LmZyb21KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04obzIpIHtcbiAgY29uc3QgbjIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIuYWRkcmVzcyAmJiAobjIuYWRkcmVzcyA9IG8yLmFkZHJlc3MpLCB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgKG4yLnBhZ2luYXRpb24gPSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QudG9KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgbjI7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCBuMiA9IHsgYWRkcmVzczogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiBuMi5hZGRyZXNzID0gbzIuYWRkcmVzcyA/PyBcIlwiLCBuMi5wYWdpbmF0aW9uID0gdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmIG51bGwgIT09IG8yLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC5mcm9tUGFydGlhbChvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgbjI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3QuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeUFsbEJhbGFuY2VzUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlBbGxCYWxhbmNlc1JlcXVlc3RcIiwgdmFsdWU6IFF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0LmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeUFsbEJhbGFuY2VzUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlXCIsIGVuY29kZShlMiwgYTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgZm9yIChjb25zdCBvMiBvZiBlMi5iYWxhbmNlcykgQ29pbi5lbmNvZGUobzIsIGEyLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiBQYWdlUmVzcG9uc2UuZW5jb2RlKGUyLnBhZ2luYXRpb24sIGEyLnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgYTI7XG59LCBkZWNvZGUoZTIsIGEyKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IGEyID8gdDUubGVuIDogdDUucG9zICsgYTI7XG4gIGNvbnN0IHI1ID0geyBiYWxhbmNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgdDUucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUzID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5iYWxhbmNlcy5wdXNoKENvaW4uZGVjb2RlKHQ1LCB0NS51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUucGFnaW5hdGlvbiA9IFBhZ2VSZXNwb25zZS5kZWNvZGUodDUsIHQ1LnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBiYWxhbmNlczogQXJyYXkuaXNBcnJheShlMj8uYmFsYW5jZXMpID8gZTIuYmFsYW5jZXMubWFwKChlMykgPT4gQ29pbi5mcm9tSlNPTihlMykpIDogW10sIHBhZ2luYXRpb246IGlzU2V0KGUyLnBhZ2luYXRpb24pID8gUGFnZVJlc3BvbnNlLmZyb21KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgYTIgPSB7fTtcbiAgcmV0dXJuIGUyLmJhbGFuY2VzID8gYTIuYmFsYW5jZXMgPSBlMi5iYWxhbmNlcy5tYXAoKGUzKSA9PiBlMyA/IENvaW4udG9KU09OKGUzKSA6IHZvaWQgMCkgOiBhMi5iYWxhbmNlcyA9IFtdLCB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgKGEyLnBhZ2luYXRpb24gPSBlMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLnRvSlNPTihlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCksIGEyO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgYTIgPSB7IGJhbGFuY2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiBhMi5iYWxhbmNlcyA9IGUyLmJhbGFuY2VzPy5tYXAoKGUzKSA9PiBDb2luLmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIGEyLnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS5mcm9tUGFydGlhbChlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCwgYTI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUFsbEJhbGFuY2VzUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5QWxsQmFsYW5jZXNSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgTXNnU2VuZCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmJhbmsudjFiZXRhMS5Nc2dTZW5kXCIsIGVuY29kZShzMywgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpIHtcbiAgXCJcIiAhPT0gczMuZnJvbUFkZHJlc3MgJiYgZTIudWludDMyKDEwKS5zdHJpbmcoczMuZnJvbUFkZHJlc3MpLCBcIlwiICE9PSBzMy50b0FkZHJlc3MgJiYgZTIudWludDMyKDE4KS5zdHJpbmcoczMudG9BZGRyZXNzKTtcbiAgZm9yIChjb25zdCB0NSBvZiBzMy5hbW91bnQpIENvaW4uZW5jb2RlKHQ1LCBlMi51aW50MzIoMjYpLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiBlMjtcbn0sIGRlY29kZShzMywgZTIpIHtcbiAgY29uc3QgbjIgPSBzMyBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHMzIDogbmV3IEJpbmFyeVJlYWRlcihzMyk7XG4gIGxldCByNSA9IHZvaWQgMCA9PT0gZTIgPyBuMi5sZW4gOiBuMi5wb3MgKyBlMjtcbiAgY29uc3QgZCA9IHsgZnJvbUFkZHJlc3M6IFwiXCIsIHRvQWRkcmVzczogXCJcIiwgYW1vdW50OiBbXSB9O1xuICBmb3IgKDsgbjIucG9zIDwgcjU7ICkge1xuICAgIGNvbnN0IHM0ID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChzNCA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBkLmZyb21BZGRyZXNzID0gbjIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBkLnRvQWRkcmVzcyA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgZC5hbW91bnQucHVzaChDb2luLmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgczQpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZDtcbn0sIGZyb21KU09OOiAoczMpID0+ICh7IGZyb21BZGRyZXNzOiBpc1NldChzMy5mcm9tQWRkcmVzcykgPyBTdHJpbmcoczMuZnJvbUFkZHJlc3MpIDogXCJcIiwgdG9BZGRyZXNzOiBpc1NldChzMy50b0FkZHJlc3MpID8gU3RyaW5nKHMzLnRvQWRkcmVzcykgOiBcIlwiLCBhbW91bnQ6IEFycmF5LmlzQXJyYXkoczM/LmFtb3VudCkgPyBzMy5hbW91bnQubWFwKChzNCkgPT4gQ29pbi5mcm9tSlNPTihzNCkpIDogW10gfSksIHRvSlNPTihzMykge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBzMy5mcm9tQWRkcmVzcyAmJiAoZTIuZnJvbUFkZHJlc3MgPSBzMy5mcm9tQWRkcmVzcyksIHZvaWQgMCAhPT0gczMudG9BZGRyZXNzICYmIChlMi50b0FkZHJlc3MgPSBzMy50b0FkZHJlc3MpLCBzMy5hbW91bnQgPyBlMi5hbW91bnQgPSBzMy5hbW91bnQubWFwKChzNCkgPT4gczQgPyBDb2luLnRvSlNPTihzNCkgOiB2b2lkIDApIDogZTIuYW1vdW50ID0gW10sIGUyO1xufSwgZnJvbVBhcnRpYWwoczMpIHtcbiAgY29uc3QgZTIgPSB7IGZyb21BZGRyZXNzOiBcIlwiLCB0b0FkZHJlc3M6IFwiXCIsIGFtb3VudDogW10gfTtcbiAgcmV0dXJuIGUyLmZyb21BZGRyZXNzID0gczMuZnJvbUFkZHJlc3MgPz8gXCJcIiwgZTIudG9BZGRyZXNzID0gczMudG9BZGRyZXNzID8/IFwiXCIsIGUyLmFtb3VudCA9IHMzLmFtb3VudD8ubWFwKChzNCkgPT4gQ29pbi5mcm9tUGFydGlhbChzNCkpIHx8IFtdLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBNc2dTZW5kLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gTXNnU2VuZC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5iYW5rLnYxYmV0YTEuTXNnU2VuZFwiLCB2YWx1ZTogTXNnU2VuZC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLkRlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmRcIiwgZW5jb2RlKHQ1LCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBcIlwiICE9PSB0NS52YWxpZGF0b3JBZGRyZXNzICYmIGUyLnVpbnQzMigxMCkuc3RyaW5nKHQ1LnZhbGlkYXRvckFkZHJlc3MpO1xuICBmb3IgKGNvbnN0IHI1IG9mIHQ1LnJld2FyZCkgRGVjQ29pbi5lbmNvZGUocjUsIGUyLnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIGUyO1xufSwgZGVjb2RlKHQ1LCByNSkge1xuICBjb25zdCBpMiA9IHQ1IGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gdDUgOiBuZXcgQmluYXJ5UmVhZGVyKHQ1KTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSByNSA/IGkyLmxlbiA6IGkyLnBvcyArIHI1O1xuICBjb25zdCBhMiA9IHsgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgcmV3YXJkOiBbXSB9O1xuICBmb3IgKDsgaTIucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IHQ2ID0gaTIudWludDMyKCk7XG4gICAgc3dpdGNoICh0NiA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBhMi52YWxpZGF0b3JBZGRyZXNzID0gaTIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBhMi5yZXdhcmQucHVzaChEZWNDb2luLmRlY29kZShpMiwgaTIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBpMi5za2lwVHlwZSg3ICYgdDYpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKHQ1KSA9PiAoeyB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldCh0NS52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyh0NS52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIsIHJld2FyZDogQXJyYXkuaXNBcnJheSh0NT8ucmV3YXJkKSA/IHQ1LnJld2FyZC5tYXAoKHQ2KSA9PiBEZWNDb2luLmZyb21KU09OKHQ2KSkgOiBbXSB9KSwgdG9KU09OKHQ1KSB7XG4gIGNvbnN0IGUyID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IHQ1LnZhbGlkYXRvckFkZHJlc3MgJiYgKGUyLnZhbGlkYXRvckFkZHJlc3MgPSB0NS52YWxpZGF0b3JBZGRyZXNzKSwgdDUucmV3YXJkID8gZTIucmV3YXJkID0gdDUucmV3YXJkLm1hcCgodDYpID0+IHQ2ID8gRGVjQ29pbi50b0pTT04odDYpIDogdm9pZCAwKSA6IGUyLnJld2FyZCA9IFtdLCBlMjtcbn0sIGZyb21QYXJ0aWFsKHQ1KSB7XG4gIGNvbnN0IGUyID0geyB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiLCByZXdhcmQ6IFtdIH07XG4gIHJldHVybiBlMi52YWxpZGF0b3JBZGRyZXNzID0gdDUudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCBlMi5yZXdhcmQgPSB0NS5yZXdhcmQ/Lm1hcCgodDYpID0+IERlY0NvaW4uZnJvbVBhcnRpYWwodDYpKSB8fCBbXSwgZTI7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZFwiLCB2YWx1ZTogRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1JlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdFwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgczMgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCB0NSA9IHZvaWQgMCA9PT0gbzIgPyBzMy5sZW4gOiBzMy5wb3MgKyBvMjtcbiAgY29uc3QgcjUgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIgfTtcbiAgZm9yICg7IHMzLnBvcyA8IHQ1OyApIHtcbiAgICBjb25zdCBlMyA9IHMzLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjUuZGVsZWdhdG9yQWRkcmVzcyA9IHMzLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUudmFsaWRhdG9yQWRkcmVzcyA9IHMzLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHMzLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcykgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiAobzIuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgKG8yLnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiB9O1xuICByZXR1cm4gbzIuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgbzIudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MgPz8gXCJcIiwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1JlcXVlc3QuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1JlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXNwb25zZVwiLCBlbmNvZGUoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgczMgb2YgZTIucmV3YXJkcykgRGVjQ29pbi5lbmNvZGUoczMsIG8yLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIG8yO1xufSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBzMyA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHQ1ID0gdm9pZCAwID09PSBvMiA/IHMzLmxlbiA6IHMzLnBvcyArIG8yO1xuICBjb25zdCByNSA9IHsgcmV3YXJkczogW10gfTtcbiAgZm9yICg7IHMzLnBvcyA8IHQ1OyApIHtcbiAgICBjb25zdCBlMyA9IHMzLnVpbnQzMigpO1xuICAgIGlmIChlMyA+Pj4gMyA9PSAxKSByNS5yZXdhcmRzLnB1c2goRGVjQ29pbi5kZWNvZGUoczMsIHMzLnVpbnQzMigpKSk7XG4gICAgZWxzZSBzMy5za2lwVHlwZSg3ICYgZTMpO1xuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IHJld2FyZHM6IEFycmF5LmlzQXJyYXkoZTI/LnJld2FyZHMpID8gZTIucmV3YXJkcy5tYXAoKGUzKSA9PiBEZWNDb2luLmZyb21KU09OKGUzKSkgOiBbXSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiBlMi5yZXdhcmRzID8gbzIucmV3YXJkcyA9IGUyLnJld2FyZHMubWFwKChlMykgPT4gZTMgPyBEZWNDb2luLnRvSlNPTihlMykgOiB2b2lkIDApIDogbzIucmV3YXJkcyA9IFtdLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0geyByZXdhcmRzOiBbXSB9O1xuICByZXR1cm4gbzIucmV3YXJkcyA9IGUyLnJld2FyZHM/Lm1hcCgoZTMpID0+IERlY0NvaW4uZnJvbVBhcnRpYWwoZTMpKSB8fCBbXSwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1Jlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1Jlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLlF1ZXJ5RGVsZWdhdGlvblJld2FyZHNSZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0aW9uUmV3YXJkc1Jlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdFwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgczMgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCB0NSA9IHZvaWQgMCA9PT0gbzIgPyBzMy5sZW4gOiBzMy5wb3MgKyBvMjtcbiAgY29uc3QgcjUgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIgfTtcbiAgZm9yICg7IHMzLnBvcyA8IHQ1OyApIHtcbiAgICBjb25zdCBlMyA9IHMzLnVpbnQzMigpO1xuICAgIGlmIChlMyA+Pj4gMyA9PSAxKSByNS5kZWxlZ2F0b3JBZGRyZXNzID0gczMuc3RyaW5nKCk7XG4gICAgZWxzZSBzMy5za2lwVHlwZSg3ICYgZTMpO1xuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiB9O1xuICByZXR1cm4gbzIuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdC5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1JlcXVlc3QuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdC5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5kaXN0cmlidXRpb24udjFiZXRhMS5RdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZVwiLCBlbmNvZGUoZTIsIG8yID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgczMgb2YgZTIucmV3YXJkcykgRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZC5lbmNvZGUoczMsIG8yLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgZm9yIChjb25zdCBzMyBvZiBlMi50b3RhbCkgRGVjQ29pbi5lbmNvZGUoczMsIG8yLnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIG8yO1xufSwgZGVjb2RlKGUyLCBvMikge1xuICBjb25zdCBzMyA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IHQ1ID0gdm9pZCAwID09PSBvMiA/IHMzLmxlbiA6IHMzLnBvcyArIG8yO1xuICBjb25zdCByNSA9IHsgcmV3YXJkczogW10sIHRvdGFsOiBbXSB9O1xuICBmb3IgKDsgczMucG9zIDwgdDU7ICkge1xuICAgIGNvbnN0IGUzID0gczMudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5yZXdhcmRzLnB1c2goRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZC5kZWNvZGUoczMsIHMzLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNS50b3RhbC5wdXNoKERlY0NvaW4uZGVjb2RlKHMzLCBzMy51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHMzLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IHJld2FyZHM6IEFycmF5LmlzQXJyYXkoZTI/LnJld2FyZHMpID8gZTIucmV3YXJkcy5tYXAoKGUzKSA9PiBEZWxlZ2F0aW9uRGVsZWdhdG9yUmV3YXJkLmZyb21KU09OKGUzKSkgOiBbXSwgdG90YWw6IEFycmF5LmlzQXJyYXkoZTI/LnRvdGFsKSA/IGUyLnRvdGFsLm1hcCgoZTMpID0+IERlY0NvaW4uZnJvbUpTT04oZTMpKSA6IFtdIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIGUyLnJld2FyZHMgPyBvMi5yZXdhcmRzID0gZTIucmV3YXJkcy5tYXAoKGUzKSA9PiBlMyA/IERlbGVnYXRpb25EZWxlZ2F0b3JSZXdhcmQudG9KU09OKGUzKSA6IHZvaWQgMCkgOiBvMi5yZXdhcmRzID0gW10sIGUyLnRvdGFsID8gbzIudG90YWwgPSBlMi50b3RhbC5tYXAoKGUzKSA9PiBlMyA/IERlY0NvaW4udG9KU09OKGUzKSA6IHZvaWQgMCkgOiBvMi50b3RhbCA9IFtdLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0geyByZXdhcmRzOiBbXSwgdG90YWw6IFtdIH07XG4gIHJldHVybiBvMi5yZXdhcmRzID0gZTIucmV3YXJkcz8ubWFwKChlMykgPT4gRGVsZWdhdGlvbkRlbGVnYXRvclJld2FyZC5mcm9tUGFydGlhbChlMykpIHx8IFtdLCBvMi50b3RhbCA9IGUyLnRvdGFsPy5tYXAoKGUzKSA9PiBEZWNDb2luLmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1Jlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdGlvblRvdGFsUmV3YXJkc1Jlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcblxuLy9cbnZhciBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZCA9IHsgdHlwZVVybDogXCIvY29zbW9zLmRpc3RyaWJ1dGlvbi52MWJldGExLk1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkXCIsIGVuY29kZTogKG8yLCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG8yLmRlbGVnYXRvckFkZHJlc3MgJiYgZTIudWludDMyKDEwKS5zdHJpbmcobzIuZGVsZWdhdG9yQWRkcmVzcyksIFwiXCIgIT09IG8yLnZhbGlkYXRvckFkZHJlc3MgJiYgZTIudWludDMyKDE4KS5zdHJpbmcobzIudmFsaWRhdG9yQWRkcmVzcyksIGUyKSwgZGVjb2RlKG8yLCBzMykge1xuICBjb25zdCB0NSA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IHI1ID0gdm9pZCAwID09PSBzMyA/IHQ1LmxlbiA6IHQ1LnBvcyArIHMzO1xuICBjb25zdCBkID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiIH07XG4gIGZvciAoOyB0NS5wb3MgPCByNTsgKSB7XG4gICAgY29uc3QgbzMgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG8zID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGQuZGVsZWdhdG9yQWRkcmVzcyA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgZC52YWxpZGF0b3JBZGRyZXNzID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGQ7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChvMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhvMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IGlzU2V0KG8yLnZhbGlkYXRvckFkZHJlc3MpID8gU3RyaW5nKG8yLnZhbGlkYXRvckFkZHJlc3MpIDogXCJcIiB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IGUyID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLmRlbGVnYXRvckFkZHJlc3MgJiYgKGUyLmRlbGVnYXRvckFkZHJlc3MgPSBvMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBvMi52YWxpZGF0b3JBZGRyZXNzICYmIChlMi52YWxpZGF0b3JBZGRyZXNzID0gbzIudmFsaWRhdG9yQWRkcmVzcyksIGUyO1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgZTIgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIgfTtcbiAgcmV0dXJuIGUyLmRlbGVnYXRvckFkZHJlc3MgPSBvMi5kZWxlZ2F0b3JBZGRyZXNzID8/IFwiXCIsIGUyLnZhbGlkYXRvckFkZHJlc3MgPSBvMi52YWxpZGF0b3JBZGRyZXNzID8/IFwiXCIsIGUyO1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmQuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRcIiwgdmFsdWU6IE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbnZhciBNc2dXaXRoZHJhd0RlbGVnYXRvclJld2FyZFJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRSZXNwb25zZVwiLCBlbmNvZGUoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgczMgb2YgZTIuYW1vdW50KSBDb2luLmVuY29kZShzMywgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdDU7XG59LCBkZWNvZGUoczMsIHQ1KSB7XG4gIGNvbnN0IHI1ID0gczMgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBzMyA6IG5ldyBCaW5hcnlSZWFkZXIoczMpO1xuICBsZXQgZCA9IHZvaWQgMCA9PT0gdDUgPyByNS5sZW4gOiByNS5wb3MgKyB0NTtcbiAgY29uc3QgYTIgPSB7IGFtb3VudDogW10gfTtcbiAgZm9yICg7IHI1LnBvcyA8IGQ7ICkge1xuICAgIGNvbnN0IGUyID0gcjUudWludDMyKCk7XG4gICAgaWYgKGUyID4+PiAzID09IDEpIGEyLmFtb3VudC5wdXNoKENvaW4uZGVjb2RlKHI1LCByNS51aW50MzIoKSkpO1xuICAgIGVsc2UgcjUuc2tpcFR5cGUoNyAmIGUyKTtcbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBhbW91bnQ6IEFycmF5LmlzQXJyYXkoZTI/LmFtb3VudCkgPyBlMi5hbW91bnQubWFwKChlMykgPT4gQ29pbi5mcm9tSlNPTihlMykpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCBzMyA9IHt9O1xuICByZXR1cm4gZTIuYW1vdW50ID8gczMuYW1vdW50ID0gZTIuYW1vdW50Lm1hcCgoZTMpID0+IGUzID8gQ29pbi50b0pTT04oZTMpIDogdm9pZCAwKSA6IHMzLmFtb3VudCA9IFtdLCBzMztcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHMzID0geyBhbW91bnQ6IFtdIH07XG4gIHJldHVybiBzMy5hbW91bnQgPSBlMi5hbW91bnQ/Lm1hcCgoZTMpID0+IENvaW4uZnJvbVBhcnRpYWwoZTMpKSB8fCBbXSwgczM7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRSZXNwb25zZS5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3MuZGlzdHJpYnV0aW9uLnYxYmV0YTEuTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRSZXNwb25zZVwiLCB2YWx1ZTogTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRSZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgQm9uZFN0YXR1cztcbiFmdW5jdGlvbihlMikge1xuICBlMltlMi5CT05EX1NUQVRVU19VTlNQRUNJRklFRCA9IDBdID0gXCJCT05EX1NUQVRVU19VTlNQRUNJRklFRFwiLCBlMltlMi5CT05EX1NUQVRVU19VTkJPTkRFRCA9IDFdID0gXCJCT05EX1NUQVRVU19VTkJPTkRFRFwiLCBlMltlMi5CT05EX1NUQVRVU19VTkJPTkRJTkcgPSAyXSA9IFwiQk9ORF9TVEFUVVNfVU5CT05ESU5HXCIsIGUyW2UyLkJPTkRfU1RBVFVTX0JPTkRFRCA9IDNdID0gXCJCT05EX1NUQVRVU19CT05ERURcIiwgZTJbZTIuVU5SRUNPR05JWkVEID0gLTFdID0gXCJVTlJFQ09HTklaRURcIjtcbn0oQm9uZFN0YXR1cyB8fCAoQm9uZFN0YXR1cyA9IHt9KSk7XG52YXIgRGVsZWdhdGlvbiA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5EZWxlZ2F0aW9uXCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgdDUudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcyksIFwiXCIgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcyksIFwiXCIgIT09IGUyLnNoYXJlcyAmJiB0NS51aW50MzIoMjYpLnN0cmluZyhEZWNpbWFsLmZyb21Vc2VySW5wdXQoZTIuc2hhcmVzLCAxOCkuYXRvbWljcyksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBvMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSB0NSA/IG8yLmxlbiA6IG8yLnBvcyArIHQ1O1xuICBjb25zdCBuMiA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgc2hhcmVzOiBcIlwiIH07XG4gIGZvciAoOyBvMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTMgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIG4yLmRlbGVnYXRvckFkZHJlc3MgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIG4yLnZhbGlkYXRvckFkZHJlc3MgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIG4yLnNoYXJlcyA9IERlY2ltYWwuZnJvbUF0b21pY3MobzIuc3RyaW5nKCksIDE4KS50b1N0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBuMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcykgOiBcIlwiLCBzaGFyZXM6IGlzU2V0KGUyLnNoYXJlcykgPyBTdHJpbmcoZTIuc2hhcmVzKSA6IFwiXCIgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmICh0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiAodDUudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnNoYXJlcyAmJiAodDUuc2hhcmVzID0gZTIuc2hhcmVzKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgc2hhcmVzOiBcIlwiIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCB0NS52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCB0NS5zaGFyZXMgPSBlMi5zaGFyZXMgPz8gXCJcIiwgdDU7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gRGVsZWdhdGlvbi5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IERlbGVnYXRpb24uZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLkRlbGVnYXRpb25cIiwgdmFsdWU6IERlbGVnYXRpb24uZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xudmFyIFVuYm9uZGluZ0RlbGVnYXRpb24gPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuVW5ib25kaW5nRGVsZWdhdGlvblwiLCBlbmNvZGUoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgdDUudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcyksIFwiXCIgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIudmFsaWRhdG9yQWRkcmVzcyk7XG4gIGZvciAoY29uc3QgbzIgb2YgZTIuZW50cmllcykgVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LmVuY29kZShvMiwgdDUudWludDMyKDI2KS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdDU7XG59LCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IG4yID0geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBcIlwiLCBlbnRyaWVzOiBbXSB9O1xuICBmb3IgKDsgbzIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBuMi5kZWxlZ2F0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBuMi52YWxpZGF0b3JBZGRyZXNzID0gbzIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBuMi5lbnRyaWVzLnB1c2goVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LmRlY29kZShvMiwgbzIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbjI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpIDogXCJcIiwgZW50cmllczogQXJyYXkuaXNBcnJheShlMj8uZW50cmllcykgPyBlMi5lbnRyaWVzLm1hcCgoZTMpID0+IFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5mcm9tSlNPTihlMykpIDogW10gfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmICh0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yQWRkcmVzcyAmJiAodDUudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MpLCBlMi5lbnRyaWVzID8gdDUuZW50cmllcyA9IGUyLmVudHJpZXMubWFwKChlMykgPT4gZTMgPyBVbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnkudG9KU09OKGUzKSA6IHZvaWQgMCkgOiB0NS5lbnRyaWVzID0gW10sIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIGVudHJpZXM6IFtdIH07XG4gIHJldHVybiB0NS5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCB0NS52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCB0NS5lbnRyaWVzID0gZTIuZW50cmllcz8ubWFwKChlMykgPT4gVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFVuYm9uZGluZ0RlbGVnYXRpb24uZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5VbmJvbmRpbmdEZWxlZ2F0aW9uXCIsIHZhbHVlOiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIHAyKCkge1xuICByZXR1cm4geyBjcmVhdGlvbkhlaWdodDogQmlnSW50KDApLCBjb21wbGV0aW9uVGltZTogVGltZXN0YW1wLmZyb21QYXJ0aWFsKHt9KSwgaW5pdGlhbEJhbGFuY2U6IFwiXCIsIGJhbGFuY2U6IFwiXCIgfTtcbn1cbnZhciBVbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnkgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5XCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKGUyLmNyZWF0aW9uSGVpZ2h0ICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDgpLmludDY0KGUyLmNyZWF0aW9uSGVpZ2h0KSwgdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBUaW1lc3RhbXAuZW5jb2RlKGUyLmNvbXBsZXRpb25UaW1lLCBvMi51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIFwiXCIgIT09IGUyLmluaXRpYWxCYWxhbmNlICYmIG8yLnVpbnQzMigyNikuc3RyaW5nKGUyLmluaXRpYWxCYWxhbmNlKSwgXCJcIiAhPT0gZTIuYmFsYW5jZSAmJiBvMi51aW50MzIoMzQpLnN0cmluZyhlMi5iYWxhbmNlKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IGkyID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IG8yID8gaTIubGVuIDogaTIucG9zICsgbzI7XG4gIGNvbnN0IHI1ID0gcDIoKTtcbiAgZm9yICg7IGkyLnBvcyA8IG4yOyApIHtcbiAgICBjb25zdCBlMyA9IGkyLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcjUuY3JlYXRpb25IZWlnaHQgPSBpMi5pbnQ2NCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUuY29tcGxldGlvblRpbWUgPSBUaW1lc3RhbXAuZGVjb2RlKGkyLCBpMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICByNS5pbml0aWFsQmFsYW5jZSA9IGkyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgcjUuYmFsYW5jZSA9IGkyLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGkyLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiByNTtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGNyZWF0aW9uSGVpZ2h0OiBpc1NldChlMi5jcmVhdGlvbkhlaWdodCkgPyBCaWdJbnQoZTIuY3JlYXRpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIGNvbXBsZXRpb25UaW1lOiBpc1NldChlMi5jb21wbGV0aW9uVGltZSkgPyBmcm9tSnNvblRpbWVzdGFtcChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIGluaXRpYWxCYWxhbmNlOiBpc1NldChlMi5pbml0aWFsQmFsYW5jZSkgPyBTdHJpbmcoZTIuaW5pdGlhbEJhbGFuY2UpIDogXCJcIiwgYmFsYW5jZTogaXNTZXQoZTIuYmFsYW5jZSkgPyBTdHJpbmcoZTIuYmFsYW5jZSkgOiBcIlwiIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgJiYgKHQ1LmNyZWF0aW9uSGVpZ2h0ID0gKGUyLmNyZWF0aW9uSGVpZ2h0IHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuY29tcGxldGlvblRpbWUgJiYgKHQ1LmNvbXBsZXRpb25UaW1lID0gZnJvbVRpbWVzdGFtcChlMi5jb21wbGV0aW9uVGltZSkudG9JU09TdHJpbmcoKSksIHZvaWQgMCAhPT0gZTIuaW5pdGlhbEJhbGFuY2UgJiYgKHQ1LmluaXRpYWxCYWxhbmNlID0gZTIuaW5pdGlhbEJhbGFuY2UpLCB2b2lkIDAgIT09IGUyLmJhbGFuY2UgJiYgKHQ1LmJhbGFuY2UgPSBlMi5iYWxhbmNlKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHAyKCk7XG4gIHJldHVybiBvMi5jcmVhdGlvbkhlaWdodCA9IHZvaWQgMCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgJiYgbnVsbCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgPyBCaWdJbnQoZTIuY3JlYXRpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG8yLmNvbXBsZXRpb25UaW1lID0gdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBudWxsICE9PSBlMi5jb21wbGV0aW9uVGltZSA/IFRpbWVzdGFtcC5mcm9tUGFydGlhbChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIG8yLmluaXRpYWxCYWxhbmNlID0gZTIuaW5pdGlhbEJhbGFuY2UgPz8gXCJcIiwgbzIuYmFsYW5jZSA9IGUyLmJhbGFuY2UgPz8gXCJcIiwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gVW5ib25kaW5nRGVsZWdhdGlvbkVudHJ5LmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5VbmJvbmRpbmdEZWxlZ2F0aW9uRW50cnlcIiwgdmFsdWU6IFVuYm9uZGluZ0RlbGVnYXRpb25FbnRyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiB2KCkge1xuICByZXR1cm4geyBjcmVhdGlvbkhlaWdodDogQmlnSW50KDApLCBjb21wbGV0aW9uVGltZTogVGltZXN0YW1wLmZyb21QYXJ0aWFsKHt9KSwgaW5pdGlhbEJhbGFuY2U6IFwiXCIsIHNoYXJlc0RzdDogXCJcIiB9O1xufVxudmFyIFJlZGVsZWdhdGlvbkVudHJ5ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvbkVudHJ5XCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKGUyLmNyZWF0aW9uSGVpZ2h0ICE9PSBCaWdJbnQoMCkgJiYgbzIudWludDMyKDgpLmludDY0KGUyLmNyZWF0aW9uSGVpZ2h0KSwgdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBUaW1lc3RhbXAuZW5jb2RlKGUyLmNvbXBsZXRpb25UaW1lLCBvMi51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIFwiXCIgIT09IGUyLmluaXRpYWxCYWxhbmNlICYmIG8yLnVpbnQzMigyNikuc3RyaW5nKGUyLmluaXRpYWxCYWxhbmNlKSwgXCJcIiAhPT0gZTIuc2hhcmVzRHN0ICYmIG8yLnVpbnQzMigzNCkuc3RyaW5nKERlY2ltYWwuZnJvbVVzZXJJbnB1dChlMi5zaGFyZXNEc3QsIDE4KS5hdG9taWNzKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IGkyID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IG8yID8gaTIubGVuIDogaTIucG9zICsgbzI7XG4gIGNvbnN0IHI1ID0gdigpO1xuICBmb3IgKDsgaTIucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IGUzID0gaTIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS5jcmVhdGlvbkhlaWdodCA9IGkyLmludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICByNS5jb21wbGV0aW9uVGltZSA9IFRpbWVzdGFtcC5kZWNvZGUoaTIsIGkyLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIHI1LmluaXRpYWxCYWxhbmNlID0gaTIuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA0OlxuICAgICAgICByNS5zaGFyZXNEc3QgPSBEZWNpbWFsLmZyb21BdG9taWNzKGkyLnN0cmluZygpLCAxOCkudG9TdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBpMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBjcmVhdGlvbkhlaWdodDogaXNTZXQoZTIuY3JlYXRpb25IZWlnaHQpID8gQmlnSW50KGUyLmNyZWF0aW9uSGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBjb21wbGV0aW9uVGltZTogaXNTZXQoZTIuY29tcGxldGlvblRpbWUpID8gZnJvbUpzb25UaW1lc3RhbXAoZTIuY29tcGxldGlvblRpbWUpIDogdm9pZCAwLCBpbml0aWFsQmFsYW5jZTogaXNTZXQoZTIuaW5pdGlhbEJhbGFuY2UpID8gU3RyaW5nKGUyLmluaXRpYWxCYWxhbmNlKSA6IFwiXCIsIHNoYXJlc0RzdDogaXNTZXQoZTIuc2hhcmVzRHN0KSA/IFN0cmluZyhlMi5zaGFyZXNEc3QpIDogXCJcIiB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmNyZWF0aW9uSGVpZ2h0ICYmICh0NS5jcmVhdGlvbkhlaWdodCA9IChlMi5jcmVhdGlvbkhlaWdodCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmICh0NS5jb21wbGV0aW9uVGltZSA9IGZyb21UaW1lc3RhbXAoZTIuY29tcGxldGlvblRpbWUpLnRvSVNPU3RyaW5nKCkpLCB2b2lkIDAgIT09IGUyLmluaXRpYWxCYWxhbmNlICYmICh0NS5pbml0aWFsQmFsYW5jZSA9IGUyLmluaXRpYWxCYWxhbmNlKSwgdm9pZCAwICE9PSBlMi5zaGFyZXNEc3QgJiYgKHQ1LnNoYXJlc0RzdCA9IGUyLnNoYXJlc0RzdCksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB2KCk7XG4gIHJldHVybiBvMi5jcmVhdGlvbkhlaWdodCA9IHZvaWQgMCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgJiYgbnVsbCAhPT0gZTIuY3JlYXRpb25IZWlnaHQgPyBCaWdJbnQoZTIuY3JlYXRpb25IZWlnaHQudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIG8yLmNvbXBsZXRpb25UaW1lID0gdm9pZCAwICE9PSBlMi5jb21wbGV0aW9uVGltZSAmJiBudWxsICE9PSBlMi5jb21wbGV0aW9uVGltZSA/IFRpbWVzdGFtcC5mcm9tUGFydGlhbChlMi5jb21wbGV0aW9uVGltZSkgOiB2b2lkIDAsIG8yLmluaXRpYWxCYWxhbmNlID0gZTIuaW5pdGlhbEJhbGFuY2UgPz8gXCJcIiwgbzIuc2hhcmVzRHN0ID0gZTIuc2hhcmVzRHN0ID8/IFwiXCIsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFJlZGVsZWdhdGlvbkVudHJ5LmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUmVkZWxlZ2F0aW9uRW50cnkuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvbkVudHJ5XCIsIHZhbHVlOiBSZWRlbGVnYXRpb25FbnRyeS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG52YXIgUmVkZWxlZ2F0aW9uID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvblwiLCBlbmNvZGUoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIFwiXCIgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgdDUudWludDMyKDEwKS5zdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcyksIFwiXCIgIT09IGUyLnZhbGlkYXRvclNyY0FkZHJlc3MgJiYgdDUudWludDMyKDE4KS5zdHJpbmcoZTIudmFsaWRhdG9yU3JjQWRkcmVzcyksIFwiXCIgIT09IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MgJiYgdDUudWludDMyKDI2KS5zdHJpbmcoZTIudmFsaWRhdG9yRHN0QWRkcmVzcyk7XG4gIGZvciAoY29uc3QgbzIgb2YgZTIuZW50cmllcykgUmVkZWxlZ2F0aW9uRW50cnkuZW5jb2RlKG8yLCB0NS51aW50MzIoMzQpLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB0NTtcbn0sIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbzIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gdDUgPyBvMi5sZW4gOiBvMi5wb3MgKyB0NTtcbiAgY29uc3QgbjIgPSB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvclNyY0FkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckRzdEFkZHJlc3M6IFwiXCIsIGVudHJpZXM6IFtdIH07XG4gIGZvciAoOyBvMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTMgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIG4yLmRlbGVnYXRvckFkZHJlc3MgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIG4yLnZhbGlkYXRvclNyY0FkZHJlc3MgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIG4yLnZhbGlkYXRvckRzdEFkZHJlc3MgPSBvMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIG4yLmVudHJpZXMucHVzaChSZWRlbGVnYXRpb25FbnRyeS5kZWNvZGUobzIsIG8yLnVpbnQzMigpKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG4yO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JTcmNBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JTcmNBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JTcmNBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckRzdEFkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpIDogXCJcIiwgZW50cmllczogQXJyYXkuaXNBcnJheShlMj8uZW50cmllcykgPyBlMi5lbnRyaWVzLm1hcCgoZTMpID0+IFJlZGVsZWdhdGlvbkVudHJ5LmZyb21KU09OKGUzKSkgOiBbXSB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKHQ1LmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzICYmICh0NS52YWxpZGF0b3JTcmNBZGRyZXNzID0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyAmJiAodDUudmFsaWRhdG9yRHN0QWRkcmVzcyA9IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpLCBlMi5lbnRyaWVzID8gdDUuZW50cmllcyA9IGUyLmVudHJpZXMubWFwKChlMykgPT4gZTMgPyBSZWRlbGVnYXRpb25FbnRyeS50b0pTT04oZTMpIDogdm9pZCAwKSA6IHQ1LmVudHJpZXMgPSBbXSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yU3JjQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yRHN0QWRkcmVzczogXCJcIiwgZW50cmllczogW10gfTtcbiAgcmV0dXJuIHQ1LmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzID8/IFwiXCIsIHQ1LnZhbGlkYXRvclNyY0FkZHJlc3MgPSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzID8/IFwiXCIsIHQ1LnZhbGlkYXRvckRzdEFkZHJlc3MgPSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzID8/IFwiXCIsIHQ1LmVudHJpZXMgPSBlMi5lbnRyaWVzPy5tYXAoKGUzKSA9PiBSZWRlbGVnYXRpb25FbnRyeS5mcm9tUGFydGlhbChlMykpIHx8IFtdLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBSZWRlbGVnYXRpb24uZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBSZWRlbGVnYXRpb24uZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvblwiLCB2YWx1ZTogUmVkZWxlZ2F0aW9uLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIGIyKCkge1xuICByZXR1cm4geyBkZWxlZ2F0aW9uOiBEZWxlZ2F0aW9uLmZyb21QYXJ0aWFsKHt9KSwgYmFsYW5jZTogQ29pbi5mcm9tUGFydGlhbCh7fSkgfTtcbn1cbnZhciBEZWxlZ2F0aW9uUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuRGVsZWdhdGlvblJlc3BvbnNlXCIsIGVuY29kZTogKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHZvaWQgMCAhPT0gZTIuZGVsZWdhdGlvbiAmJiBEZWxlZ2F0aW9uLmVuY29kZShlMi5kZWxlZ2F0aW9uLCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCksIHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiBDb2luLmVuY29kZShlMi5iYWxhbmNlLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBvMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGkyID0gdm9pZCAwID09PSB0NSA/IG8yLmxlbiA6IG8yLnBvcyArIHQ1O1xuICBjb25zdCByNSA9IGIyKCk7XG4gIGZvciAoOyBvMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTMgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LmRlbGVnYXRpb24gPSBEZWxlZ2F0aW9uLmRlY29kZShvMiwgbzIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUuYmFsYW5jZSA9IENvaW4uZGVjb2RlKG8yLCBvMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbzIuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdGlvbjogaXNTZXQoZTIuZGVsZWdhdGlvbikgPyBEZWxlZ2F0aW9uLmZyb21KU09OKGUyLmRlbGVnYXRpb24pIDogdm9pZCAwLCBiYWxhbmNlOiBpc1NldChlMi5iYWxhbmNlKSA/IENvaW4uZnJvbUpTT04oZTIuYmFsYW5jZSkgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0aW9uICYmICh0NS5kZWxlZ2F0aW9uID0gZTIuZGVsZWdhdGlvbiA/IERlbGVnYXRpb24udG9KU09OKGUyLmRlbGVnYXRpb24pIDogdm9pZCAwKSwgdm9pZCAwICE9PSBlMi5iYWxhbmNlICYmICh0NS5iYWxhbmNlID0gZTIuYmFsYW5jZSA/IENvaW4udG9KU09OKGUyLmJhbGFuY2UpIDogdm9pZCAwKSwgdDU7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCB0NSA9IGIyKCk7XG4gIHJldHVybiB0NS5kZWxlZ2F0aW9uID0gdm9pZCAwICE9PSBlMi5kZWxlZ2F0aW9uICYmIG51bGwgIT09IGUyLmRlbGVnYXRpb24gPyBEZWxlZ2F0aW9uLmZyb21QYXJ0aWFsKGUyLmRlbGVnYXRpb24pIDogdm9pZCAwLCB0NS5iYWxhbmNlID0gdm9pZCAwICE9PSBlMi5iYWxhbmNlICYmIG51bGwgIT09IGUyLmJhbGFuY2UgPyBDb2luLmZyb21QYXJ0aWFsKGUyLmJhbGFuY2UpIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBEZWxlZ2F0aW9uUmVzcG9uc2UuZGVjb2RlKGUyLnZhbHVlKSwgdG9Qcm90bzogKGUyKSA9PiBEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLkRlbGVnYXRpb25SZXNwb25zZVwiLCB2YWx1ZTogRGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIFMoKSB7XG4gIHJldHVybiB7IHJlZGVsZWdhdGlvbkVudHJ5OiBSZWRlbGVnYXRpb25FbnRyeS5mcm9tUGFydGlhbCh7fSksIGJhbGFuY2U6IFwiXCIgfTtcbn1cbnZhciBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2VcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb25FbnRyeSAmJiBSZWRlbGVnYXRpb25FbnRyeS5lbmNvZGUoZTIucmVkZWxlZ2F0aW9uRW50cnksIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKSwgXCJcIiAhPT0gZTIuYmFsYW5jZSAmJiB0NS51aW50MzIoMzQpLnN0cmluZyhlMi5iYWxhbmNlKSwgdDUpLCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG8yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IHQ1ID8gbzIubGVuIDogbzIucG9zICsgdDU7XG4gIGNvbnN0IG4yID0gUygpO1xuICBmb3IgKDsgbzIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUzID0gbzIudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBuMi5yZWRlbGVnYXRpb25FbnRyeSA9IFJlZGVsZWdhdGlvbkVudHJ5LmRlY29kZShvMiwgbzIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgbjIuYmFsYW5jZSA9IG8yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG8yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBuMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IHJlZGVsZWdhdGlvbkVudHJ5OiBpc1NldChlMi5yZWRlbGVnYXRpb25FbnRyeSkgPyBSZWRlbGVnYXRpb25FbnRyeS5mcm9tSlNPTihlMi5yZWRlbGVnYXRpb25FbnRyeSkgOiB2b2lkIDAsIGJhbGFuY2U6IGlzU2V0KGUyLmJhbGFuY2UpID8gU3RyaW5nKGUyLmJhbGFuY2UpIDogXCJcIiB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLnJlZGVsZWdhdGlvbkVudHJ5ICYmICh0NS5yZWRlbGVnYXRpb25FbnRyeSA9IGUyLnJlZGVsZWdhdGlvbkVudHJ5ID8gUmVkZWxlZ2F0aW9uRW50cnkudG9KU09OKGUyLnJlZGVsZWdhdGlvbkVudHJ5KSA6IHZvaWQgMCksIHZvaWQgMCAhPT0gZTIuYmFsYW5jZSAmJiAodDUuYmFsYW5jZSA9IGUyLmJhbGFuY2UpLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0gUygpO1xuICByZXR1cm4gdDUucmVkZWxlZ2F0aW9uRW50cnkgPSB2b2lkIDAgIT09IGUyLnJlZGVsZWdhdGlvbkVudHJ5ICYmIG51bGwgIT09IGUyLnJlZGVsZWdhdGlvbkVudHJ5ID8gUmVkZWxlZ2F0aW9uRW50cnkuZnJvbVBhcnRpYWwoZTIucmVkZWxlZ2F0aW9uRW50cnkpIDogdm9pZCAwLCB0NS5iYWxhbmNlID0gZTIuYmFsYW5jZSA/PyBcIlwiLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZVwiLCB2YWx1ZTogUmVkZWxlZ2F0aW9uRW50cnlSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBBKCkge1xuICByZXR1cm4geyByZWRlbGVnYXRpb246IFJlZGVsZWdhdGlvbi5mcm9tUGFydGlhbCh7fSksIGVudHJpZXM6IFtdIH07XG59XG52YXIgUmVkZWxlZ2F0aW9uUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUmVkZWxlZ2F0aW9uUmVzcG9uc2VcIiwgZW5jb2RlKGUyLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICB2b2lkIDAgIT09IGUyLnJlZGVsZWdhdGlvbiAmJiBSZWRlbGVnYXRpb24uZW5jb2RlKGUyLnJlZGVsZWdhdGlvbiwgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICBmb3IgKGNvbnN0IG8yIG9mIGUyLmVudHJpZXMpIFJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2UuZW5jb2RlKG8yLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB0NTtcbn0sIGRlY29kZShlMiwgdDUpIHtcbiAgY29uc3QgbzIgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gdDUgPyBvMi5sZW4gOiBvMi5wb3MgKyB0NTtcbiAgY29uc3QgbjIgPSBBKCk7XG4gIGZvciAoOyBvMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTMgPSBvMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIG4yLnJlZGVsZWdhdGlvbiA9IFJlZGVsZWdhdGlvbi5kZWNvZGUobzIsIG8yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIG4yLmVudHJpZXMucHVzaChSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLmRlY29kZShvMiwgbzIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBvMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gbjI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyByZWRlbGVnYXRpb246IGlzU2V0KGUyLnJlZGVsZWdhdGlvbikgPyBSZWRlbGVnYXRpb24uZnJvbUpTT04oZTIucmVkZWxlZ2F0aW9uKSA6IHZvaWQgMCwgZW50cmllczogQXJyYXkuaXNBcnJheShlMj8uZW50cmllcykgPyBlMi5lbnRyaWVzLm1hcCgoZTMpID0+IFJlZGVsZWdhdGlvbkVudHJ5UmVzcG9uc2UuZnJvbUpTT04oZTMpKSA6IFtdIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIucmVkZWxlZ2F0aW9uICYmICh0NS5yZWRlbGVnYXRpb24gPSBlMi5yZWRlbGVnYXRpb24gPyBSZWRlbGVnYXRpb24udG9KU09OKGUyLnJlZGVsZWdhdGlvbikgOiB2b2lkIDApLCBlMi5lbnRyaWVzID8gdDUuZW50cmllcyA9IGUyLmVudHJpZXMubWFwKChlMykgPT4gZTMgPyBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLnRvSlNPTihlMykgOiB2b2lkIDApIDogdDUuZW50cmllcyA9IFtdLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0gQSgpO1xuICByZXR1cm4gdDUucmVkZWxlZ2F0aW9uID0gdm9pZCAwICE9PSBlMi5yZWRlbGVnYXRpb24gJiYgbnVsbCAhPT0gZTIucmVkZWxlZ2F0aW9uID8gUmVkZWxlZ2F0aW9uLmZyb21QYXJ0aWFsKGUyLnJlZGVsZWdhdGlvbikgOiB2b2lkIDAsIHQ1LmVudHJpZXMgPSBlMi5lbnRyaWVzPy5tYXAoKGUzKSA9PiBSZWRlbGVnYXRpb25FbnRyeVJlc3BvbnNlLmZyb21QYXJ0aWFsKGUzKSkgfHwgW10sIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IFJlZGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gUmVkZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlJlZGVsZWdhdGlvblJlc3BvbnNlXCIsIHZhbHVlOiBSZWRlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRpb25SZXF1ZXN0XCIsIGVuY29kZTogKG8yLCBlMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKFwiXCIgIT09IG8yLmRlbGVnYXRvckFkZHIgJiYgZTIudWludDMyKDEwKS5zdHJpbmcobzIuZGVsZWdhdG9yQWRkciksIFwiXCIgIT09IG8yLnZhbGlkYXRvckFkZHIgJiYgZTIudWludDMyKDE4KS5zdHJpbmcobzIudmFsaWRhdG9yQWRkciksIGUyKSwgZGVjb2RlKG8yLCBlMikge1xuICBjb25zdCB0NSA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IG4yID0gdm9pZCAwID09PSBlMiA/IHQ1LmxlbiA6IHQ1LnBvcyArIGUyO1xuICBjb25zdCBhMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgdmFsaWRhdG9yQWRkcjogXCJcIiB9O1xuICBmb3IgKDsgdDUucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IG8zID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBhMi5kZWxlZ2F0b3JBZGRyID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAyOlxuICAgICAgICBhMi52YWxpZGF0b3JBZGRyID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGEyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVsZWdhdG9yQWRkcjogaXNTZXQobzIuZGVsZWdhdG9yQWRkcikgPyBTdHJpbmcobzIuZGVsZWdhdG9yQWRkcikgOiBcIlwiLCB2YWxpZGF0b3JBZGRyOiBpc1NldChvMi52YWxpZGF0b3JBZGRyKSA/IFN0cmluZyhvMi52YWxpZGF0b3JBZGRyKSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZWxlZ2F0b3JBZGRyICYmIChlMi5kZWxlZ2F0b3JBZGRyID0gbzIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gbzIudmFsaWRhdG9yQWRkciAmJiAoZTIudmFsaWRhdG9yQWRkciA9IG8yLnZhbGlkYXRvckFkZHIpLCBlMjtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IGUyID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCB2YWxpZGF0b3JBZGRyOiBcIlwiIH07XG4gIHJldHVybiBlMi5kZWxlZ2F0b3JBZGRyID0gbzIuZGVsZWdhdG9yQWRkciA/PyBcIlwiLCBlMi52YWxpZGF0b3JBZGRyID0gbzIudmFsaWRhdG9yQWRkciA/PyBcIlwiLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeURlbGVnYXRpb25SZXF1ZXN0LmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0aW9uUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2VcIiwgZW5jb2RlOiAobzIsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAodm9pZCAwICE9PSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2UgJiYgRGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShvMi5kZWxlZ2F0aW9uUmVzcG9uc2UsIGUyLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKSwgZTIpLCBkZWNvZGUobzIsIGUyKSB7XG4gIGNvbnN0IHQ1ID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgYTIgPSB2b2lkIDAgPT09IGUyID8gdDUubGVuIDogdDUucG9zICsgZTI7XG4gIGNvbnN0IGkyID0geyBkZWxlZ2F0aW9uUmVzcG9uc2U6IHZvaWQgMCB9O1xuICBmb3IgKDsgdDUucG9zIDwgYTI7ICkge1xuICAgIGNvbnN0IG8zID0gdDUudWludDMyKCk7XG4gICAgaWYgKG8zID4+PiAzID09IDEpIGkyLmRlbGVnYXRpb25SZXNwb25zZSA9IERlbGVnYXRpb25SZXNwb25zZS5kZWNvZGUodDUsIHQ1LnVpbnQzMigpKTtcbiAgICBlbHNlIHQ1LnNraXBUeXBlKDcgJiBvMyk7XG4gIH1cbiAgcmV0dXJuIGkyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgZGVsZWdhdGlvblJlc3BvbnNlOiBpc1NldChvMi5kZWxlZ2F0aW9uUmVzcG9uc2UpID8gRGVsZWdhdGlvblJlc3BvbnNlLmZyb21KU09OKG8yLmRlbGVnYXRpb25SZXNwb25zZSkgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCBlMiA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2UgJiYgKGUyLmRlbGVnYXRpb25SZXNwb25zZSA9IG8yLmRlbGVnYXRpb25SZXNwb25zZSA/IERlbGVnYXRpb25SZXNwb25zZS50b0pTT04obzIuZGVsZWdhdGlvblJlc3BvbnNlKSA6IHZvaWQgMCksIGUyO1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgZTIgPSB7IGRlbGVnYXRpb25SZXNwb25zZTogdm9pZCAwIH07XG4gIHJldHVybiBlMi5kZWxlZ2F0aW9uUmVzcG9uc2UgPSB2b2lkIDAgIT09IG8yLmRlbGVnYXRpb25SZXNwb25zZSAmJiBudWxsICE9PSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2UgPyBEZWxlZ2F0aW9uUmVzcG9uc2UuZnJvbVBhcnRpYWwobzIuZGVsZWdhdGlvblJlc3BvbnNlKSA6IHZvaWQgMCwgZTI7XG59LCBmcm9tUHJvdG9Nc2c6IChvMikgPT4gUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2UuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeURlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2VcIiwgdmFsdWU6IFF1ZXJ5RGVsZWdhdGlvblJlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlcXVlc3RcIiwgZW5jb2RlOiAobzIsIGUyID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gbzIuZGVsZWdhdG9yQWRkciAmJiBlMi51aW50MzIoMTApLnN0cmluZyhvMi5kZWxlZ2F0b3JBZGRyKSwgXCJcIiAhPT0gbzIudmFsaWRhdG9yQWRkciAmJiBlMi51aW50MzIoMTgpLnN0cmluZyhvMi52YWxpZGF0b3JBZGRyKSwgZTIpLCBkZWNvZGUobzIsIGUyKSB7XG4gIGNvbnN0IHQ1ID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IGUyID8gdDUubGVuIDogdDUucG9zICsgZTI7XG4gIGNvbnN0IGEyID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCB2YWxpZGF0b3JBZGRyOiBcIlwiIH07XG4gIGZvciAoOyB0NS5wb3MgPCBuMjsgKSB7XG4gICAgY29uc3QgbzMgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG8zID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGEyLmRlbGVnYXRvckFkZHIgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGEyLnZhbGlkYXRvckFkZHIgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgbzMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYTI7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyBkZWxlZ2F0b3JBZGRyOiBpc1NldChvMi5kZWxlZ2F0b3JBZGRyKSA/IFN0cmluZyhvMi5kZWxlZ2F0b3JBZGRyKSA6IFwiXCIsIHZhbGlkYXRvckFkZHI6IGlzU2V0KG8yLnZhbGlkYXRvckFkZHIpID8gU3RyaW5nKG8yLnZhbGlkYXRvckFkZHIpIDogXCJcIiB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IGUyID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLmRlbGVnYXRvckFkZHIgJiYgKGUyLmRlbGVnYXRvckFkZHIgPSBvMi5kZWxlZ2F0b3JBZGRyKSwgdm9pZCAwICE9PSBvMi52YWxpZGF0b3JBZGRyICYmIChlMi52YWxpZGF0b3JBZGRyID0gbzIudmFsaWRhdG9yQWRkciksIGUyO1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgZTIgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHZhbGlkYXRvckFkZHI6IFwiXCIgfTtcbiAgcmV0dXJuIGUyLmRlbGVnYXRvckFkZHIgPSBvMi5kZWxlZ2F0b3JBZGRyID8/IFwiXCIsIGUyLnZhbGlkYXRvckFkZHIgPSBvMi52YWxpZGF0b3JBZGRyID8/IFwiXCIsIGUyO1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlcXVlc3QuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0LmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0XCIsIHZhbHVlOiBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXF1ZXN0LmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbmZ1bmN0aW9uIGMoKSB7XG4gIHJldHVybiB7IHVuYm9uZDogVW5ib25kaW5nRGVsZWdhdGlvbi5mcm9tUGFydGlhbCh7fSkgfTtcbn1cbnZhciBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZVwiLCBlbmNvZGU6IChvMiwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICh2b2lkIDAgIT09IG8yLnVuYm9uZCAmJiBVbmJvbmRpbmdEZWxlZ2F0aW9uLmVuY29kZShvMi51bmJvbmQsIGUyLnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKSwgZTIpLCBkZWNvZGUobzIsIGUyKSB7XG4gIGNvbnN0IHQ1ID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgbjIgPSB2b2lkIDAgPT09IGUyID8gdDUubGVuIDogdDUucG9zICsgZTI7XG4gIGNvbnN0IGkyID0gYygpO1xuICBmb3IgKDsgdDUucG9zIDwgbjI7ICkge1xuICAgIGNvbnN0IG8zID0gdDUudWludDMyKCk7XG4gICAgaWYgKG8zID4+PiAzID09IDEpIGkyLnVuYm9uZCA9IFVuYm9uZGluZ0RlbGVnYXRpb24uZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgZWxzZSB0NS5za2lwVHlwZSg3ICYgbzMpO1xuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAobzIpID0+ICh7IHVuYm9uZDogaXNTZXQobzIudW5ib25kKSA/IFVuYm9uZGluZ0RlbGVnYXRpb24uZnJvbUpTT04obzIudW5ib25kKSA6IHZvaWQgMCB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IGUyID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLnVuYm9uZCAmJiAoZTIudW5ib25kID0gbzIudW5ib25kID8gVW5ib25kaW5nRGVsZWdhdGlvbi50b0pTT04obzIudW5ib25kKSA6IHZvaWQgMCksIGUyO1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgZTIgPSBjKCk7XG4gIHJldHVybiBlMi51bmJvbmQgPSB2b2lkIDAgIT09IG8yLnVuYm9uZCAmJiBudWxsICE9PSBvMi51bmJvbmQgPyBVbmJvbmRpbmdEZWxlZ2F0aW9uLmZyb21QYXJ0aWFsKG8yLnVuYm9uZCkgOiB2b2lkIDAsIGUyO1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlVbmJvbmRpbmdEZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlc3BvbnNlXCIsIHZhbHVlOiBRdWVyeVVuYm9uZGluZ0RlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3QgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkciAmJiB0NS51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXF1ZXN0LmVuY29kZShlMi5wYWdpbmF0aW9uLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSB0NSA/IG4yLmxlbiA6IG4yLnBvcyArIHQ1O1xuICBjb25zdCBpMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyBuMi5wb3MgPCBhMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRlbGVnYXRvckFkZHIgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkyLnBhZ2luYXRpb24gPSBQYWdlUmVxdWVzdC5kZWNvZGUobjIsIG4yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSA6IFwiXCIsIHBhZ2luYXRpb246IGlzU2V0KGUyLnBhZ2luYXRpb24pID8gUGFnZVJlcXVlc3QuZnJvbUpTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihlMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBlMi5kZWxlZ2F0b3JBZGRyICYmICh0NS5kZWxlZ2F0b3JBZGRyID0gZTIuZGVsZWdhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiAodDUucGFnaW5hdGlvbiA9IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC50b0pTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIHQ1LmRlbGVnYXRvckFkZHIgPSBlMi5kZWxlZ2F0b3JBZGRyID8/IFwiXCIsIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXF1ZXN0LmZyb21QYXJ0aWFsKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVxdWVzdC5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXF1ZXN0LmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xudmFyIFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXNwb25zZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2VcIiwgZW5jb2RlKG8yLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IGUyIG9mIG8yLmRlbGVnYXRpb25SZXNwb25zZXMpIERlbGVnYXRpb25SZXNwb25zZS5lbmNvZGUoZTIsIHQ1LnVpbnQzMigxMCkuZm9yaygpKS5sZGVsaW0oKTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBQYWdlUmVzcG9uc2UuZW5jb2RlKG8yLnBhZ2luYXRpb24sIHQ1LnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgdDU7XG59LCBkZWNvZGUobzIsIHQ1KSB7XG4gIGNvbnN0IGEyID0gbzIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBvMiA6IG5ldyBCaW5hcnlSZWFkZXIobzIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IHQ1ID8gYTIubGVuIDogYTIucG9zICsgdDU7XG4gIGNvbnN0IHI1ID0geyBkZWxlZ2F0aW9uUmVzcG9uc2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyBhMi5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgbzMgPSBhMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG8zID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LmRlbGVnYXRpb25SZXNwb25zZXMucHVzaChEZWxlZ2F0aW9uUmVzcG9uc2UuZGVjb2RlKGEyLCBhMi51aW50MzIoKSkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcjUucGFnaW5hdGlvbiA9IFBhZ2VSZXNwb25zZS5kZWNvZGUoYTIsIGEyLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBhMi5za2lwVHlwZSg3ICYgbzMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcjU7XG59LCBmcm9tSlNPTjogKG8yKSA9PiAoeyBkZWxlZ2F0aW9uUmVzcG9uc2VzOiBBcnJheS5pc0FycmF5KG8yPy5kZWxlZ2F0aW9uUmVzcG9uc2VzKSA/IG8yLmRlbGVnYXRpb25SZXNwb25zZXMubWFwKChvMykgPT4gRGVsZWdhdGlvblJlc3BvbnNlLmZyb21KU09OKG8zKSkgOiBbXSwgcGFnaW5hdGlvbjogaXNTZXQobzIucGFnaW5hdGlvbikgPyBQYWdlUmVzcG9uc2UuZnJvbUpTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gbzIuZGVsZWdhdGlvblJlc3BvbnNlcyA/IHQ1LmRlbGVnYXRpb25SZXNwb25zZXMgPSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcCgobzMpID0+IG8zID8gRGVsZWdhdGlvblJlc3BvbnNlLnRvSlNPTihvMykgOiB2b2lkIDApIDogdDUuZGVsZWdhdGlvblJlc3BvbnNlcyA9IFtdLCB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgKHQ1LnBhZ2luYXRpb24gPSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLnRvSlNPTihvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCksIHQ1O1xufSwgZnJvbVBhcnRpYWwobzIpIHtcbiAgY29uc3QgdDUgPSB7IGRlbGVnYXRpb25SZXNwb25zZXM6IFtdLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIHQ1LmRlbGVnYXRpb25SZXNwb25zZXMgPSBvMi5kZWxlZ2F0aW9uUmVzcG9uc2VzPy5tYXAoKG8zKSA9PiBEZWxlZ2F0aW9uUmVzcG9uc2UuZnJvbVBhcnRpYWwobzMpKSB8fCBbXSwgdDUucGFnaW5hdGlvbiA9IHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBudWxsICE9PSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLmZyb21QYXJ0aWFsKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2UuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0b3JEZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdCA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdFwiLCBlbmNvZGU6IChlMiwgdDUgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyICYmIHQ1LnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHIpLCB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgUGFnZVJlcXVlc3QuZW5jb2RlKGUyLnBhZ2luYXRpb24sIHQ1LnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKSwgdDUpLCBkZWNvZGUoZTIsIHQ1KSB7XG4gIGNvbnN0IG4yID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgYTIgPSB2b2lkIDAgPT09IHQ1ID8gbjIubGVuIDogbjIucG9zICsgdDU7XG4gIGNvbnN0IGkyID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgZm9yICg7IG4yLnBvcyA8IGEyOyApIHtcbiAgICBjb25zdCBlMyA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAoZTMgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgaTIuZGVsZWdhdG9yQWRkciA9IG4yLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgaTIucGFnaW5hdGlvbiA9IFBhZ2VSZXF1ZXN0LmRlY29kZShuMiwgbjIudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIG4yLnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBpMjtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHI6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHIpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHIpIDogXCJcIiwgcGFnaW5hdGlvbjogaXNTZXQoZTIucGFnaW5hdGlvbikgPyBQYWdlUmVxdWVzdC5mcm9tSlNPTihlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHIgJiYgKHQ1LmRlbGVnYXRvckFkZHIgPSBlMi5kZWxlZ2F0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmICh0NS5wYWdpbmF0aW9uID0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXF1ZXN0LnRvSlNPTihlMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCksIHQ1O1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgdDUgPSB7IGRlbGVnYXRvckFkZHI6IFwiXCIsIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICByZXR1cm4gdDUuZGVsZWdhdG9yQWRkciA9IGUyLmRlbGVnYXRvckFkZHIgPz8gXCJcIiwgdDUucGFnaW5hdGlvbiA9IHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiBudWxsICE9PSBlMi5wYWdpbmF0aW9uID8gUGFnZVJlcXVlc3QuZnJvbVBhcnRpYWwoZTIucGFnaW5hdGlvbikgOiB2b2lkIDAsIHQ1O1xufSwgZnJvbVByb3RvTXNnOiAobzIpID0+IFF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXF1ZXN0LmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1JlcXVlc3QuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXF1ZXN0XCIsIHZhbHVlOiBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1Jlc3BvbnNlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXNwb25zZVwiLCBlbmNvZGUobzIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSB7XG4gIGZvciAoY29uc3QgZTIgb2YgbzIudW5ib25kaW5nUmVzcG9uc2VzKSBVbmJvbmRpbmdEZWxlZ2F0aW9uLmVuY29kZShlMiwgdDUudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXNwb25zZS5lbmNvZGUobzIucGFnaW5hdGlvbiwgdDUudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLCB0NTtcbn0sIGRlY29kZShvMiwgdDUpIHtcbiAgY29uc3QgbjIgPSBvMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IG8yIDogbmV3IEJpbmFyeVJlYWRlcihvMik7XG4gIGxldCBpMiA9IHZvaWQgMCA9PT0gdDUgPyBuMi5sZW4gOiBuMi5wb3MgKyB0NTtcbiAgY29uc3QgcjUgPSB7IHVuYm9uZGluZ1Jlc3BvbnNlczogW10sIHBhZ2luYXRpb246IHZvaWQgMCB9O1xuICBmb3IgKDsgbjIucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IG8zID0gbjIudWludDMyKCk7XG4gICAgc3dpdGNoIChvMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICByNS51bmJvbmRpbmdSZXNwb25zZXMucHVzaChVbmJvbmRpbmdEZWxlZ2F0aW9uLmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LnBhZ2luYXRpb24gPSBQYWdlUmVzcG9uc2UuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgdW5ib25kaW5nUmVzcG9uc2VzOiBBcnJheS5pc0FycmF5KG8yPy51bmJvbmRpbmdSZXNwb25zZXMpID8gbzIudW5ib25kaW5nUmVzcG9uc2VzLm1hcCgobzMpID0+IFVuYm9uZGluZ0RlbGVnYXRpb24uZnJvbUpTT04obzMpKSA6IFtdLCBwYWdpbmF0aW9uOiBpc1NldChvMi5wYWdpbmF0aW9uKSA/IFBhZ2VSZXNwb25zZS5mcm9tSlNPTihvMi5wYWdpbmF0aW9uKSA6IHZvaWQgMCB9KSwgdG9KU09OKG8yKSB7XG4gIGNvbnN0IHQ1ID0ge307XG4gIHJldHVybiBvMi51bmJvbmRpbmdSZXNwb25zZXMgPyB0NS51bmJvbmRpbmdSZXNwb25zZXMgPSBvMi51bmJvbmRpbmdSZXNwb25zZXMubWFwKChvMykgPT4gbzMgPyBVbmJvbmRpbmdEZWxlZ2F0aW9uLnRvSlNPTihvMykgOiB2b2lkIDApIDogdDUudW5ib25kaW5nUmVzcG9uc2VzID0gW10sIHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiAodDUucGFnaW5hdGlvbiA9IG8yLnBhZ2luYXRpb24gPyBQYWdlUmVzcG9uc2UudG9KU09OKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwKSwgdDU7XG59LCBmcm9tUGFydGlhbChvMikge1xuICBjb25zdCB0NSA9IHsgdW5ib25kaW5nUmVzcG9uc2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIHJldHVybiB0NS51bmJvbmRpbmdSZXNwb25zZXMgPSBvMi51bmJvbmRpbmdSZXNwb25zZXM/Lm1hcCgobzMpID0+IFVuYm9uZGluZ0RlbGVnYXRpb24uZnJvbVBhcnRpYWwobzMpKSB8fCBbXSwgdDUucGFnaW5hdGlvbiA9IHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBudWxsICE9PSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLmZyb21QYXJ0aWFsKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2UuZGVjb2RlKG8yLnZhbHVlKSwgdG9Qcm90bzogKG8yKSA9PiBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSwgdG9Qcm90b01zZzogKG8yKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5RGVsZWdhdG9yVW5ib25kaW5nRGVsZWdhdGlvbnNSZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlEZWxlZ2F0b3JVbmJvbmRpbmdEZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCkgfSkgfTtcbnZhciBRdWVyeVJlZGVsZWdhdGlvbnNSZXF1ZXN0ID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLlF1ZXJ5UmVkZWxlZ2F0aW9uc1JlcXVlc3RcIiwgZW5jb2RlOiAoZTIsIHQ1ID0gQmluYXJ5V3JpdGVyLmNyZWF0ZSgpKSA9PiAoXCJcIiAhPT0gZTIuZGVsZWdhdG9yQWRkciAmJiB0NS51aW50MzIoMTApLnN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSwgXCJcIiAhPT0gZTIuc3JjVmFsaWRhdG9yQWRkciAmJiB0NS51aW50MzIoMTgpLnN0cmluZyhlMi5zcmNWYWxpZGF0b3JBZGRyKSwgXCJcIiAhPT0gZTIuZHN0VmFsaWRhdG9yQWRkciAmJiB0NS51aW50MzIoMjYpLnN0cmluZyhlMi5kc3RWYWxpZGF0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5wYWdpbmF0aW9uICYmIFBhZ2VSZXF1ZXN0LmVuY29kZShlMi5wYWdpbmF0aW9uLCB0NS51aW50MzIoMzQpLmZvcmsoKSkubGRlbGltKCksIHQ1KSwgZGVjb2RlKGUyLCB0NSkge1xuICBjb25zdCBuMiA9IGUyIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gZTIgOiBuZXcgQmluYXJ5UmVhZGVyKGUyKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSB0NSA/IG4yLmxlbiA6IG4yLnBvcyArIHQ1O1xuICBjb25zdCBpMiA9IHsgZGVsZWdhdG9yQWRkcjogXCJcIiwgc3JjVmFsaWRhdG9yQWRkcjogXCJcIiwgZHN0VmFsaWRhdG9yQWRkcjogXCJcIiwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyBuMi5wb3MgPCBhMjsgKSB7XG4gICAgY29uc3QgZTMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGkyLmRlbGVnYXRvckFkZHIgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGkyLnNyY1ZhbGlkYXRvckFkZHIgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGkyLmRzdFZhbGlkYXRvckFkZHIgPSBuMi5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGkyLnBhZ2luYXRpb24gPSBQYWdlUmVxdWVzdC5kZWNvZGUobjIsIG4yLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBuMi5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gaTI7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyKSA6IFwiXCIsIHNyY1ZhbGlkYXRvckFkZHI6IGlzU2V0KGUyLnNyY1ZhbGlkYXRvckFkZHIpID8gU3RyaW5nKGUyLnNyY1ZhbGlkYXRvckFkZHIpIDogXCJcIiwgZHN0VmFsaWRhdG9yQWRkcjogaXNTZXQoZTIuZHN0VmFsaWRhdG9yQWRkcikgPyBTdHJpbmcoZTIuZHN0VmFsaWRhdG9yQWRkcikgOiBcIlwiLCBwYWdpbmF0aW9uOiBpc1NldChlMi5wYWdpbmF0aW9uKSA/IFBhZ2VSZXF1ZXN0LmZyb21KU09OKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgdDUgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkciAmJiAodDUuZGVsZWdhdG9yQWRkciA9IGUyLmRlbGVnYXRvckFkZHIpLCB2b2lkIDAgIT09IGUyLnNyY1ZhbGlkYXRvckFkZHIgJiYgKHQ1LnNyY1ZhbGlkYXRvckFkZHIgPSBlMi5zcmNWYWxpZGF0b3JBZGRyKSwgdm9pZCAwICE9PSBlMi5kc3RWYWxpZGF0b3JBZGRyICYmICh0NS5kc3RWYWxpZGF0b3JBZGRyID0gZTIuZHN0VmFsaWRhdG9yQWRkciksIHZvaWQgMCAhPT0gZTIucGFnaW5hdGlvbiAmJiAodDUucGFnaW5hdGlvbiA9IGUyLnBhZ2luYXRpb24gPyBQYWdlUmVxdWVzdC50b0pTT04oZTIucGFnaW5hdGlvbikgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IHQ1ID0geyBkZWxlZ2F0b3JBZGRyOiBcIlwiLCBzcmNWYWxpZGF0b3JBZGRyOiBcIlwiLCBkc3RWYWxpZGF0b3JBZGRyOiBcIlwiLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIHQ1LmRlbGVnYXRvckFkZHIgPSBlMi5kZWxlZ2F0b3JBZGRyID8/IFwiXCIsIHQ1LnNyY1ZhbGlkYXRvckFkZHIgPSBlMi5zcmNWYWxpZGF0b3JBZGRyID8/IFwiXCIsIHQ1LmRzdFZhbGlkYXRvckFkZHIgPSBlMi5kc3RWYWxpZGF0b3JBZGRyID8/IFwiXCIsIHQ1LnBhZ2luYXRpb24gPSB2b2lkIDAgIT09IGUyLnBhZ2luYXRpb24gJiYgbnVsbCAhPT0gZTIucGFnaW5hdGlvbiA/IFBhZ2VSZXF1ZXN0LmZyb21QYXJ0aWFsKGUyLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeVJlZGVsZWdhdGlvbnNSZXF1ZXN0LmRlY29kZShvMi52YWx1ZSksIHRvUHJvdG86IChvMikgPT4gUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAobzIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdFwiLCB2YWx1ZTogUXVlcnlSZWRlbGVnYXRpb25zUmVxdWVzdC5lbmNvZGUobzIpLmZpbmlzaCgpIH0pIH07XG52YXIgUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2VcIiwgZW5jb2RlKG8yLCB0NSA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkge1xuICBmb3IgKGNvbnN0IGUyIG9mIG8yLnJlZGVsZWdhdGlvblJlc3BvbnNlcykgUmVkZWxlZ2F0aW9uUmVzcG9uc2UuZW5jb2RlKGUyLCB0NS51aW50MzIoMTApLmZvcmsoKSkubGRlbGltKCk7XG4gIHJldHVybiB2b2lkIDAgIT09IG8yLnBhZ2luYXRpb24gJiYgUGFnZVJlc3BvbnNlLmVuY29kZShvMi5wYWdpbmF0aW9uLCB0NS51aW50MzIoMTgpLmZvcmsoKSkubGRlbGltKCksIHQ1O1xufSwgZGVjb2RlKG8yLCB0NSkge1xuICBjb25zdCBuMiA9IG8yIGluc3RhbmNlb2YgQmluYXJ5UmVhZGVyID8gbzIgOiBuZXcgQmluYXJ5UmVhZGVyKG8yKTtcbiAgbGV0IGEyID0gdm9pZCAwID09PSB0NSA/IG4yLmxlbiA6IG4yLnBvcyArIHQ1O1xuICBjb25zdCByNSA9IHsgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzOiBbXSwgcGFnaW5hdGlvbjogdm9pZCAwIH07XG4gIGZvciAoOyBuMi5wb3MgPCBhMjsgKSB7XG4gICAgY29uc3QgbzMgPSBuMi51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG8zID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHI1LnJlZGVsZWdhdGlvblJlc3BvbnNlcy5wdXNoKFJlZGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShuMiwgbjIudWludDMyKCkpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHI1LnBhZ2luYXRpb24gPSBQYWdlUmVzcG9uc2UuZGVjb2RlKG4yLCBuMi51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIG8zKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHI1O1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzOiBBcnJheS5pc0FycmF5KG8yPy5yZWRlbGVnYXRpb25SZXNwb25zZXMpID8gbzIucmVkZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcCgobzMpID0+IFJlZGVsZWdhdGlvblJlc3BvbnNlLmZyb21KU09OKG8zKSkgOiBbXSwgcGFnaW5hdGlvbjogaXNTZXQobzIucGFnaW5hdGlvbikgPyBQYWdlUmVzcG9uc2UuZnJvbUpTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDAgfSksIHRvSlNPTihvMikge1xuICBjb25zdCB0NSA9IHt9O1xuICByZXR1cm4gbzIucmVkZWxlZ2F0aW9uUmVzcG9uc2VzID8gdDUucmVkZWxlZ2F0aW9uUmVzcG9uc2VzID0gbzIucmVkZWxlZ2F0aW9uUmVzcG9uc2VzLm1hcCgobzMpID0+IG8zID8gUmVkZWxlZ2F0aW9uUmVzcG9uc2UudG9KU09OKG8zKSA6IHZvaWQgMCkgOiB0NS5yZWRlbGVnYXRpb25SZXNwb25zZXMgPSBbXSwgdm9pZCAwICE9PSBvMi5wYWdpbmF0aW9uICYmICh0NS5wYWdpbmF0aW9uID0gbzIucGFnaW5hdGlvbiA/IFBhZ2VSZXNwb25zZS50b0pTT04obzIucGFnaW5hdGlvbikgOiB2b2lkIDApLCB0NTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHQ1ID0geyByZWRlbGVnYXRpb25SZXNwb25zZXM6IFtdLCBwYWdpbmF0aW9uOiB2b2lkIDAgfTtcbiAgcmV0dXJuIHQ1LnJlZGVsZWdhdGlvblJlc3BvbnNlcyA9IG8yLnJlZGVsZWdhdGlvblJlc3BvbnNlcz8ubWFwKChvMykgPT4gUmVkZWxlZ2F0aW9uUmVzcG9uc2UuZnJvbVBhcnRpYWwobzMpKSB8fCBbXSwgdDUucGFnaW5hdGlvbiA9IHZvaWQgMCAhPT0gbzIucGFnaW5hdGlvbiAmJiBudWxsICE9PSBvMi5wYWdpbmF0aW9uID8gUGFnZVJlc3BvbnNlLmZyb21QYXJ0aWFsKG8yLnBhZ2luYXRpb24pIDogdm9pZCAwLCB0NTtcbn0sIGZyb21Qcm90b01zZzogKG8yKSA9PiBRdWVyeVJlZGVsZWdhdGlvbnNSZXNwb25zZS5kZWNvZGUobzIudmFsdWUpLCB0b1Byb3RvOiAobzIpID0+IFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlLmVuY29kZShvMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChvMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5RdWVyeVJlZGVsZWdhdGlvbnNSZXNwb25zZVwiLCB2YWx1ZTogUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2UuZW5jb2RlKG8yKS5maW5pc2goKSB9KSB9O1xuXG4vL1xuZnVuY3Rpb24gdjIoKSB7XG4gIHJldHVybiB7IGRlbGVnYXRvckFkZHJlc3M6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IFwiXCIsIGFtb3VudDogQ29pbi5mcm9tUGFydGlhbCh7fSkgfTtcbn1cbnZhciBNc2dEZWxlZ2F0ZSA9IHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dEZWxlZ2F0ZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBDb2luLmVuY29kZShlMi5hbW91bnQsIG8yLnVpbnQzMigyNikuZm9yaygpKS5sZGVsaW0oKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IG8yID8gdDUubGVuIDogdDUucG9zICsgbzI7XG4gIGNvbnN0IGQgPSB2MigpO1xuICBmb3IgKDsgdDUucG9zIDwgaTI7ICkge1xuICAgIGNvbnN0IGUzID0gdDUudWludDMyKCk7XG4gICAgc3dpdGNoIChlMyA+Pj4gMykge1xuICAgICAgY2FzZSAxOlxuICAgICAgICBkLmRlbGVnYXRvckFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGQudmFsaWRhdG9yQWRkcmVzcyA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgZC5hbW91bnQgPSBDb2luLmRlY29kZSh0NSwgdDUudWludDMyKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHQ1LnNraXBUeXBlKDcgJiBlMyk7XG4gICAgfVxuICB9XG4gIHJldHVybiBkO1xufSwgZnJvbUpTT046IChlMikgPT4gKHsgZGVsZWdhdG9yQWRkcmVzczogaXNTZXQoZTIuZGVsZWdhdG9yQWRkcmVzcykgPyBTdHJpbmcoZTIuZGVsZWdhdG9yQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JBZGRyZXNzKSA6IFwiXCIsIGFtb3VudDogaXNTZXQoZTIuYW1vdW50KSA/IENvaW4uZnJvbUpTT04oZTIuYW1vdW50KSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIChvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIuYW1vdW50ICYmIChvMi5hbW91bnQgPSBlMi5hbW91bnQgPyBDb2luLnRvSlNPTihlMi5hbW91bnQpIDogdm9pZCAwKSwgbzI7XG59LCBmcm9tUGFydGlhbChlMikge1xuICBjb25zdCBvMiA9IHYyKCk7XG4gIHJldHVybiBvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JBZGRyZXNzID0gZTIudmFsaWRhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi5hbW91bnQgPSB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBudWxsICE9PSBlMi5hbW91bnQgPyBDb2luLmZyb21QYXJ0aWFsKGUyLmFtb3VudCkgOiB2b2lkIDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ0RlbGVnYXRlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gTXNnRGVsZWdhdGUuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ0RlbGVnYXRlXCIsIHZhbHVlOiBNc2dEZWxlZ2F0ZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiB1KCkge1xuICByZXR1cm4geyBkZWxlZ2F0b3JBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JTcmNBZGRyZXNzOiBcIlwiLCB2YWxpZGF0b3JEc3RBZGRyZXNzOiBcIlwiLCBhbW91bnQ6IENvaW4uZnJvbVBhcnRpYWwoe30pIH07XG59XG52YXIgTXNnQmVnaW5SZWRlbGVnYXRlID0geyB0eXBlVXJsOiBcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ0JlZ2luUmVkZWxlZ2F0ZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzICYmIG8yLnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvclNyY0FkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JEc3RBZGRyZXNzICYmIG8yLnVpbnQzMigyNikuc3RyaW5nKGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBDb2luLmVuY29kZShlMi5hbW91bnQsIG8yLnVpbnQzMigzNCkuZm9yaygpKS5sZGVsaW0oKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IG8yID8gdDUubGVuIDogdDUucG9zICsgbzI7XG4gIGNvbnN0IGQgPSB1KCk7XG4gIGZvciAoOyB0NS5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTMgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGQuZGVsZWdhdG9yQWRkcmVzcyA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgZC52YWxpZGF0b3JTcmNBZGRyZXNzID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBkLnZhbGlkYXRvckRzdEFkZHJlc3MgPSB0NS5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGQuYW1vdW50ID0gQ29pbi5kZWNvZGUodDUsIHQ1LnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0NS5za2lwVHlwZSg3ICYgZTMpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZDtcbn0sIGZyb21KU09OOiAoZTIpID0+ICh7IGRlbGVnYXRvckFkZHJlc3M6IGlzU2V0KGUyLmRlbGVnYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpIDogXCJcIiwgdmFsaWRhdG9yU3JjQWRkcmVzczogaXNTZXQoZTIudmFsaWRhdG9yU3JjQWRkcmVzcykgPyBTdHJpbmcoZTIudmFsaWRhdG9yU3JjQWRkcmVzcykgOiBcIlwiLCB2YWxpZGF0b3JEc3RBZGRyZXNzOiBpc1NldChlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSA/IFN0cmluZyhlMi52YWxpZGF0b3JEc3RBZGRyZXNzKSA6IFwiXCIsIGFtb3VudDogaXNTZXQoZTIuYW1vdW50KSA/IENvaW4uZnJvbUpTT04oZTIuYW1vdW50KSA6IHZvaWQgMCB9KSwgdG9KU09OKGUyKSB7XG4gIGNvbnN0IG8yID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IGUyLmRlbGVnYXRvckFkZHJlc3MgJiYgKG8yLmRlbGVnYXRvckFkZHJlc3MgPSBlMi5kZWxlZ2F0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi52YWxpZGF0b3JTcmNBZGRyZXNzICYmIChvMi52YWxpZGF0b3JTcmNBZGRyZXNzID0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyksIHZvaWQgMCAhPT0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyAmJiAobzIudmFsaWRhdG9yRHN0QWRkcmVzcyA9IGUyLnZhbGlkYXRvckRzdEFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiAobzIuYW1vdW50ID0gZTIuYW1vdW50ID8gQ29pbi50b0pTT04oZTIuYW1vdW50KSA6IHZvaWQgMCksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSB1KCk7XG4gIHJldHVybiBvMi5kZWxlZ2F0b3JBZGRyZXNzID0gZTIuZGVsZWdhdG9yQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JTcmNBZGRyZXNzID0gZTIudmFsaWRhdG9yU3JjQWRkcmVzcyA/PyBcIlwiLCBvMi52YWxpZGF0b3JEc3RBZGRyZXNzID0gZTIudmFsaWRhdG9yRHN0QWRkcmVzcyA/PyBcIlwiLCBvMi5hbW91bnQgPSB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBudWxsICE9PSBlMi5hbW91bnQgPyBDb2luLmZyb21QYXJ0aWFsKGUyLmFtb3VudCkgOiB2b2lkIDAsIG8yO1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ0JlZ2luUmVkZWxlZ2F0ZS5kZWNvZGUoZTIudmFsdWUpLCB0b1Byb3RvOiAoZTIpID0+IE1zZ0JlZ2luUmVkZWxlZ2F0ZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnQmVnaW5SZWRlbGVnYXRlXCIsIHZhbHVlOiBNc2dCZWdpblJlZGVsZWdhdGUuZW5jb2RlKGUyKS5maW5pc2goKSB9KSB9O1xuZnVuY3Rpb24gZigpIHtcbiAgcmV0dXJuIHsgZGVsZWdhdG9yQWRkcmVzczogXCJcIiwgdmFsaWRhdG9yQWRkcmVzczogXCJcIiwgYW1vdW50OiBDb2luLmZyb21QYXJ0aWFsKHt9KSB9O1xufVxudmFyIE1zZ1VuZGVsZWdhdGUgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnVW5kZWxlZ2F0ZVwiLCBlbmNvZGU6IChlMiwgbzIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBlMi5kZWxlZ2F0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxMCkuc3RyaW5nKGUyLmRlbGVnYXRvckFkZHJlc3MpLCBcIlwiICE9PSBlMi52YWxpZGF0b3JBZGRyZXNzICYmIG8yLnVpbnQzMigxOCkuc3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLmFtb3VudCAmJiBDb2luLmVuY29kZShlMi5hbW91bnQsIG8yLnVpbnQzMigyNikuZm9yaygpKS5sZGVsaW0oKSwgbzIpLCBkZWNvZGUoZTIsIG8yKSB7XG4gIGNvbnN0IHQ1ID0gZTIgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyBlMiA6IG5ldyBCaW5hcnlSZWFkZXIoZTIpO1xuICBsZXQgaTIgPSB2b2lkIDAgPT09IG8yID8gdDUubGVuIDogdDUucG9zICsgbzI7XG4gIGNvbnN0IGQgPSBmKCk7XG4gIGZvciAoOyB0NS5wb3MgPCBpMjsgKSB7XG4gICAgY29uc3QgZTMgPSB0NS51aW50MzIoKTtcbiAgICBzd2l0Y2ggKGUzID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGQuZGVsZWdhdG9yQWRkcmVzcyA9IHQ1LnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgZC52YWxpZGF0b3JBZGRyZXNzID0gdDUuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOlxuICAgICAgICBkLmFtb3VudCA9IENvaW4uZGVjb2RlKHQ1LCB0NS51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdDUuc2tpcFR5cGUoNyAmIGUzKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGQ7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBkZWxlZ2F0b3JBZGRyZXNzOiBpc1NldChlMi5kZWxlZ2F0b3JBZGRyZXNzKSA/IFN0cmluZyhlMi5kZWxlZ2F0b3JBZGRyZXNzKSA6IFwiXCIsIHZhbGlkYXRvckFkZHJlc3M6IGlzU2V0KGUyLnZhbGlkYXRvckFkZHJlc3MpID8gU3RyaW5nKGUyLnZhbGlkYXRvckFkZHJlc3MpIDogXCJcIiwgYW1vdW50OiBpc1NldChlMi5hbW91bnQpID8gQ29pbi5mcm9tSlNPTihlMi5hbW91bnQpIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuZGVsZWdhdG9yQWRkcmVzcyAmJiAobzIuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MpLCB2b2lkIDAgIT09IGUyLnZhbGlkYXRvckFkZHJlc3MgJiYgKG8yLnZhbGlkYXRvckFkZHJlc3MgPSBlMi52YWxpZGF0b3JBZGRyZXNzKSwgdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgKG8yLmFtb3VudCA9IGUyLmFtb3VudCA/IENvaW4udG9KU09OKGUyLmFtb3VudCkgOiB2b2lkIDApLCBvMjtcbn0sIGZyb21QYXJ0aWFsKGUyKSB7XG4gIGNvbnN0IG8yID0gZigpO1xuICByZXR1cm4gbzIuZGVsZWdhdG9yQWRkcmVzcyA9IGUyLmRlbGVnYXRvckFkZHJlc3MgPz8gXCJcIiwgbzIudmFsaWRhdG9yQWRkcmVzcyA9IGUyLnZhbGlkYXRvckFkZHJlc3MgPz8gXCJcIiwgbzIuYW1vdW50ID0gdm9pZCAwICE9PSBlMi5hbW91bnQgJiYgbnVsbCAhPT0gZTIuYW1vdW50ID8gQ29pbi5mcm9tUGFydGlhbChlMi5hbW91bnQpIDogdm9pZCAwLCBvMjtcbn0sIGZyb21Qcm90b01zZzogKGUyKSA9PiBNc2dVbmRlbGVnYXRlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gTXNnVW5kZWxlZ2F0ZS5lbmNvZGUoZTIpLmZpbmlzaCgpLCB0b1Byb3RvTXNnOiAoZTIpID0+ICh7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnVW5kZWxlZ2F0ZVwiLCB2YWx1ZTogTXNnVW5kZWxlZ2F0ZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5mdW5jdGlvbiBBMigpIHtcbiAgcmV0dXJuIHsgY29tcGxldGlvblRpbWU6IFRpbWVzdGFtcC5mcm9tUGFydGlhbCh7fSkgfTtcbn1cbnZhciBNc2dVbmRlbGVnYXRlUmVzcG9uc2UgPSB7IHR5cGVVcmw6IFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnVW5kZWxlZ2F0ZVJlc3BvbnNlXCIsIGVuY29kZTogKGUyLCBvMiA9IEJpbmFyeVdyaXRlci5jcmVhdGUoKSkgPT4gKHZvaWQgMCAhPT0gZTIuY29tcGxldGlvblRpbWUgJiYgVGltZXN0YW1wLmVuY29kZShlMi5jb21wbGV0aW9uVGltZSwgbzIudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpLCBvMiksIGRlY29kZShlMiwgbzIpIHtcbiAgY29uc3QgdDUgPSBlMiBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IGUyIDogbmV3IEJpbmFyeVJlYWRlcihlMik7XG4gIGxldCBzMyA9IHZvaWQgMCA9PT0gbzIgPyB0NS5sZW4gOiB0NS5wb3MgKyBvMjtcbiAgY29uc3QgZCA9IEEyKCk7XG4gIGZvciAoOyB0NS5wb3MgPCBzMzsgKSB7XG4gICAgY29uc3QgZTMgPSB0NS51aW50MzIoKTtcbiAgICBpZiAoZTMgPj4+IDMgPT0gMSkgZC5jb21wbGV0aW9uVGltZSA9IFRpbWVzdGFtcC5kZWNvZGUodDUsIHQ1LnVpbnQzMigpKTtcbiAgICBlbHNlIHQ1LnNraXBUeXBlKDcgJiBlMyk7XG4gIH1cbiAgcmV0dXJuIGQ7XG59LCBmcm9tSlNPTjogKGUyKSA9PiAoeyBjb21wbGV0aW9uVGltZTogaXNTZXQoZTIuY29tcGxldGlvblRpbWUpID8gZnJvbUpzb25UaW1lc3RhbXAoZTIuY29tcGxldGlvblRpbWUpIDogdm9pZCAwIH0pLCB0b0pTT04oZTIpIHtcbiAgY29uc3QgbzIgPSB7fTtcbiAgcmV0dXJuIHZvaWQgMCAhPT0gZTIuY29tcGxldGlvblRpbWUgJiYgKG8yLmNvbXBsZXRpb25UaW1lID0gZnJvbVRpbWVzdGFtcChlMi5jb21wbGV0aW9uVGltZSkudG9JU09TdHJpbmcoKSksIG8yO1xufSwgZnJvbVBhcnRpYWwoZTIpIHtcbiAgY29uc3QgbzIgPSBBMigpO1xuICByZXR1cm4gbzIuY29tcGxldGlvblRpbWUgPSB2b2lkIDAgIT09IGUyLmNvbXBsZXRpb25UaW1lICYmIG51bGwgIT09IGUyLmNvbXBsZXRpb25UaW1lID8gVGltZXN0YW1wLmZyb21QYXJ0aWFsKGUyLmNvbXBsZXRpb25UaW1lKSA6IHZvaWQgMCwgbzI7XG59LCBmcm9tUHJvdG9Nc2c6IChlMikgPT4gTXNnVW5kZWxlZ2F0ZVJlc3BvbnNlLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gTXNnVW5kZWxlZ2F0ZVJlc3BvbnNlLmVuY29kZShlMikuZmluaXNoKCksIHRvUHJvdG9Nc2c6IChlMikgPT4gKHsgdHlwZVVybDogXCIvY29zbW9zLnN0YWtpbmcudjFiZXRhMS5Nc2dVbmRlbGVnYXRlUmVzcG9uc2VcIiwgdmFsdWU6IE1zZ1VuZGVsZWdhdGVSZXNwb25zZS5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG5mdW5jdGlvbiBsMigpIHtcbiAgcmV0dXJuIHsgcmV2aXNpb25OdW1iZXI6IEJpZ0ludCgwKSwgcmV2aXNpb25IZWlnaHQ6IEJpZ0ludCgwKSB9O1xufVxudmFyIEhlaWdodCA9IHsgdHlwZVVybDogXCIvaWJjLmNvcmUuY2xpZW50LnYxLkhlaWdodFwiLCBlbmNvZGU6ICh0NSwgZTIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+ICh0NS5yZXZpc2lvbk51bWJlciAhPT0gQmlnSW50KDApICYmIGUyLnVpbnQzMig4KS51aW50NjQodDUucmV2aXNpb25OdW1iZXIpLCB0NS5yZXZpc2lvbkhlaWdodCAhPT0gQmlnSW50KDApICYmIGUyLnVpbnQzMigxNikudWludDY0KHQ1LnJldmlzaW9uSGVpZ2h0KSwgZTIpLCBkZWNvZGUodDUsIGUyKSB7XG4gIGNvbnN0IG4yID0gdDUgaW5zdGFuY2VvZiBCaW5hcnlSZWFkZXIgPyB0NSA6IG5ldyBCaW5hcnlSZWFkZXIodDUpO1xuICBsZXQgbzIgPSB2b2lkIDAgPT09IGUyID8gbjIubGVuIDogbjIucG9zICsgZTI7XG4gIGNvbnN0IHMzID0gbDIoKTtcbiAgZm9yICg7IG4yLnBvcyA8IG8yOyApIHtcbiAgICBjb25zdCB0NiA9IG4yLnVpbnQzMigpO1xuICAgIHN3aXRjaCAodDYgPj4+IDMpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgczMucmV2aXNpb25OdW1iZXIgPSBuMi51aW50NjQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHMzLnJldmlzaW9uSGVpZ2h0ID0gbjIudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbjIuc2tpcFR5cGUoNyAmIHQ2KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHMzO1xufSwgZnJvbUpTT046ICh0NSkgPT4gKHsgcmV2aXNpb25OdW1iZXI6IGlzU2V0KHQ1LnJldmlzaW9uTnVtYmVyKSA/IEJpZ0ludCh0NS5yZXZpc2lvbk51bWJlci50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgcmV2aXNpb25IZWlnaHQ6IGlzU2V0KHQ1LnJldmlzaW9uSGVpZ2h0KSA/IEJpZ0ludCh0NS5yZXZpc2lvbkhlaWdodC50b1N0cmluZygpKSA6IEJpZ0ludCgwKSB9KSwgdG9KU09OKHQ1KSB7XG4gIGNvbnN0IGUyID0ge307XG4gIHJldHVybiB2b2lkIDAgIT09IHQ1LnJldmlzaW9uTnVtYmVyICYmIChlMi5yZXZpc2lvbk51bWJlciA9ICh0NS5yZXZpc2lvbk51bWJlciB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCB2b2lkIDAgIT09IHQ1LnJldmlzaW9uSGVpZ2h0ICYmIChlMi5yZXZpc2lvbkhlaWdodCA9ICh0NS5yZXZpc2lvbkhlaWdodCB8fCBCaWdJbnQoMCkpLnRvU3RyaW5nKCkpLCBlMjtcbn0sIGZyb21QYXJ0aWFsKHQ1KSB7XG4gIGNvbnN0IGUyID0gbDIoKTtcbiAgcmV0dXJuIGUyLnJldmlzaW9uTnVtYmVyID0gdm9pZCAwICE9PSB0NS5yZXZpc2lvbk51bWJlciAmJiBudWxsICE9PSB0NS5yZXZpc2lvbk51bWJlciA/IEJpZ0ludCh0NS5yZXZpc2lvbk51bWJlci50b1N0cmluZygpKSA6IEJpZ0ludCgwKSwgZTIucmV2aXNpb25IZWlnaHQgPSB2b2lkIDAgIT09IHQ1LnJldmlzaW9uSGVpZ2h0ICYmIG51bGwgIT09IHQ1LnJldmlzaW9uSGVpZ2h0ID8gQmlnSW50KHQ1LnJldmlzaW9uSGVpZ2h0LnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBlMjtcbn0sIGZyb21Qcm90b01zZzogKHQ1KSA9PiBIZWlnaHQuZGVjb2RlKHQ1LnZhbHVlKSwgdG9Qcm90bzogKHQ1KSA9PiBIZWlnaHQuZW5jb2RlKHQ1KS5maW5pc2goKSwgdG9Qcm90b01zZzogKHQ1KSA9PiAoeyB0eXBlVXJsOiBcIi9pYmMuY29yZS5jbGllbnQudjEuSGVpZ2h0XCIsIHZhbHVlOiBIZWlnaHQuZW5jb2RlKHQ1KS5maW5pc2goKSB9KSB9O1xuXG4vL1xuZnVuY3Rpb24gaSgpIHtcbiAgcmV0dXJuIHsgc291cmNlUG9ydDogXCJcIiwgc291cmNlQ2hhbm5lbDogXCJcIiwgdG9rZW46IENvaW4uZnJvbVBhcnRpYWwoe30pLCBzZW5kZXI6IFwiXCIsIHJlY2VpdmVyOiBcIlwiLCB0aW1lb3V0SGVpZ2h0OiBIZWlnaHQuZnJvbVBhcnRpYWwoe30pLCB0aW1lb3V0VGltZXN0YW1wOiBCaWdJbnQoMCksIG1lbW86IFwiXCIgfTtcbn1cbnZhciBNc2dUcmFuc2ZlciA9IHsgdHlwZVVybDogXCIvaWJjLmFwcGxpY2F0aW9ucy50cmFuc2Zlci52MS5Nc2dUcmFuc2ZlclwiLCBlbmNvZGU6IChvMiwgbjIgPSBCaW5hcnlXcml0ZXIuY3JlYXRlKCkpID0+IChcIlwiICE9PSBvMi5zb3VyY2VQb3J0ICYmIG4yLnVpbnQzMigxMCkuc3RyaW5nKG8yLnNvdXJjZVBvcnQpLCBcIlwiICE9PSBvMi5zb3VyY2VDaGFubmVsICYmIG4yLnVpbnQzMigxOCkuc3RyaW5nKG8yLnNvdXJjZUNoYW5uZWwpLCB2b2lkIDAgIT09IG8yLnRva2VuICYmIENvaW4uZW5jb2RlKG8yLnRva2VuLCBuMi51aW50MzIoMjYpLmZvcmsoKSkubGRlbGltKCksIFwiXCIgIT09IG8yLnNlbmRlciAmJiBuMi51aW50MzIoMzQpLnN0cmluZyhvMi5zZW5kZXIpLCBcIlwiICE9PSBvMi5yZWNlaXZlciAmJiBuMi51aW50MzIoNDIpLnN0cmluZyhvMi5yZWNlaXZlciksIHZvaWQgMCAhPT0gbzIudGltZW91dEhlaWdodCAmJiBIZWlnaHQuZW5jb2RlKG8yLnRpbWVvdXRIZWlnaHQsIG4yLnVpbnQzMig1MCkuZm9yaygpKS5sZGVsaW0oKSwgbzIudGltZW91dFRpbWVzdGFtcCAhPT0gQmlnSW50KDApICYmIG4yLnVpbnQzMig1NikudWludDY0KG8yLnRpbWVvdXRUaW1lc3RhbXApLCBcIlwiICE9PSBvMi5tZW1vICYmIG4yLnVpbnQzMig2Nikuc3RyaW5nKG8yLm1lbW8pLCBuMiksIGRlY29kZShyNSwgbjIpIHtcbiAgY29uc3QgczMgPSByNSBpbnN0YW5jZW9mIEJpbmFyeVJlYWRlciA/IHI1IDogbmV3IEJpbmFyeVJlYWRlcihyNSk7XG4gIGxldCBtMiA9IHZvaWQgMCA9PT0gbjIgPyBzMy5sZW4gOiBzMy5wb3MgKyBuMjtcbiAgY29uc3QgYzIgPSBpKCk7XG4gIGZvciAoOyBzMy5wb3MgPCBtMjsgKSB7XG4gICAgY29uc3QgbzIgPSBzMy51aW50MzIoKTtcbiAgICBzd2l0Y2ggKG8yID4+PiAzKSB7XG4gICAgICBjYXNlIDE6XG4gICAgICAgIGMyLnNvdXJjZVBvcnQgPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIGMyLnNvdXJjZUNoYW5uZWwgPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM6XG4gICAgICAgIGMyLnRva2VuID0gQ29pbi5kZWNvZGUoczMsIHMzLnVpbnQzMigpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDQ6XG4gICAgICAgIGMyLnNlbmRlciA9IHMzLnN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgNTpcbiAgICAgICAgYzIucmVjZWl2ZXIgPSBzMy5zdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDY6XG4gICAgICAgIGMyLnRpbWVvdXRIZWlnaHQgPSBIZWlnaHQuZGVjb2RlKHMzLCBzMy51aW50MzIoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA3OlxuICAgICAgICBjMi50aW1lb3V0VGltZXN0YW1wID0gczMudWludDY0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSA4OlxuICAgICAgICBjMi5tZW1vID0gczMuc3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgczMuc2tpcFR5cGUoNyAmIG8yKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGMyO1xufSwgZnJvbUpTT046IChvMikgPT4gKHsgc291cmNlUG9ydDogaXNTZXQobzIuc291cmNlUG9ydCkgPyBTdHJpbmcobzIuc291cmNlUG9ydCkgOiBcIlwiLCBzb3VyY2VDaGFubmVsOiBpc1NldChvMi5zb3VyY2VDaGFubmVsKSA/IFN0cmluZyhvMi5zb3VyY2VDaGFubmVsKSA6IFwiXCIsIHRva2VuOiBpc1NldChvMi50b2tlbikgPyBDb2luLmZyb21KU09OKG8yLnRva2VuKSA6IHZvaWQgMCwgc2VuZGVyOiBpc1NldChvMi5zZW5kZXIpID8gU3RyaW5nKG8yLnNlbmRlcikgOiBcIlwiLCByZWNlaXZlcjogaXNTZXQobzIucmVjZWl2ZXIpID8gU3RyaW5nKG8yLnJlY2VpdmVyKSA6IFwiXCIsIHRpbWVvdXRIZWlnaHQ6IGlzU2V0KG8yLnRpbWVvdXRIZWlnaHQpID8gSGVpZ2h0LmZyb21KU09OKG8yLnRpbWVvdXRIZWlnaHQpIDogdm9pZCAwLCB0aW1lb3V0VGltZXN0YW1wOiBpc1NldChvMi50aW1lb3V0VGltZXN0YW1wKSA/IEJpZ0ludChvMi50aW1lb3V0VGltZXN0YW1wLnRvU3RyaW5nKCkpIDogQmlnSW50KDApLCBtZW1vOiBpc1NldChvMi5tZW1vKSA/IFN0cmluZyhvMi5tZW1vKSA6IFwiXCIgfSksIHRvSlNPTihvMikge1xuICBjb25zdCByNSA9IHt9O1xuICByZXR1cm4gdm9pZCAwICE9PSBvMi5zb3VyY2VQb3J0ICYmIChyNS5zb3VyY2VQb3J0ID0gbzIuc291cmNlUG9ydCksIHZvaWQgMCAhPT0gbzIuc291cmNlQ2hhbm5lbCAmJiAocjUuc291cmNlQ2hhbm5lbCA9IG8yLnNvdXJjZUNoYW5uZWwpLCB2b2lkIDAgIT09IG8yLnRva2VuICYmIChyNS50b2tlbiA9IG8yLnRva2VuID8gQ29pbi50b0pTT04obzIudG9rZW4pIDogdm9pZCAwKSwgdm9pZCAwICE9PSBvMi5zZW5kZXIgJiYgKHI1LnNlbmRlciA9IG8yLnNlbmRlciksIHZvaWQgMCAhPT0gbzIucmVjZWl2ZXIgJiYgKHI1LnJlY2VpdmVyID0gbzIucmVjZWl2ZXIpLCB2b2lkIDAgIT09IG8yLnRpbWVvdXRIZWlnaHQgJiYgKHI1LnRpbWVvdXRIZWlnaHQgPSBvMi50aW1lb3V0SGVpZ2h0ID8gSGVpZ2h0LnRvSlNPTihvMi50aW1lb3V0SGVpZ2h0KSA6IHZvaWQgMCksIHZvaWQgMCAhPT0gbzIudGltZW91dFRpbWVzdGFtcCAmJiAocjUudGltZW91dFRpbWVzdGFtcCA9IChvMi50aW1lb3V0VGltZXN0YW1wIHx8IEJpZ0ludCgwKSkudG9TdHJpbmcoKSksIHZvaWQgMCAhPT0gbzIubWVtbyAmJiAocjUubWVtbyA9IG8yLm1lbW8pLCByNTtcbn0sIGZyb21QYXJ0aWFsKG8yKSB7XG4gIGNvbnN0IHI1ID0gaSgpO1xuICByZXR1cm4gcjUuc291cmNlUG9ydCA9IG8yLnNvdXJjZVBvcnQgPz8gXCJcIiwgcjUuc291cmNlQ2hhbm5lbCA9IG8yLnNvdXJjZUNoYW5uZWwgPz8gXCJcIiwgcjUudG9rZW4gPSB2b2lkIDAgIT09IG8yLnRva2VuICYmIG51bGwgIT09IG8yLnRva2VuID8gQ29pbi5mcm9tUGFydGlhbChvMi50b2tlbikgOiB2b2lkIDAsIHI1LnNlbmRlciA9IG8yLnNlbmRlciA/PyBcIlwiLCByNS5yZWNlaXZlciA9IG8yLnJlY2VpdmVyID8/IFwiXCIsIHI1LnRpbWVvdXRIZWlnaHQgPSB2b2lkIDAgIT09IG8yLnRpbWVvdXRIZWlnaHQgJiYgbnVsbCAhPT0gbzIudGltZW91dEhlaWdodCA/IEhlaWdodC5mcm9tUGFydGlhbChvMi50aW1lb3V0SGVpZ2h0KSA6IHZvaWQgMCwgcjUudGltZW91dFRpbWVzdGFtcCA9IHZvaWQgMCAhPT0gbzIudGltZW91dFRpbWVzdGFtcCAmJiBudWxsICE9PSBvMi50aW1lb3V0VGltZXN0YW1wID8gQmlnSW50KG8yLnRpbWVvdXRUaW1lc3RhbXAudG9TdHJpbmcoKSkgOiBCaWdJbnQoMCksIHI1Lm1lbW8gPSBvMi5tZW1vID8/IFwiXCIsIHI1O1xufSwgZnJvbVByb3RvTXNnOiAoZTIpID0+IE1zZ1RyYW5zZmVyLmRlY29kZShlMi52YWx1ZSksIHRvUHJvdG86IChlMikgPT4gTXNnVHJhbnNmZXIuZW5jb2RlKGUyKS5maW5pc2goKSwgdG9Qcm90b01zZzogKGUyKSA9PiAoeyB0eXBlVXJsOiBcIi9pYmMuYXBwbGljYXRpb25zLnRyYW5zZmVyLnYxLk1zZ1RyYW5zZmVyXCIsIHZhbHVlOiBNc2dUcmFuc2Zlci5lbmNvZGUoZTIpLmZpbmlzaCgpIH0pIH07XG5cbi8vXG52YXIgY29lcmNlRGVub20gPSAoY2hhaW5IdWIsIGRlbm9tQXJnKSA9PiB7XG4gIGlmICh0eXBlb2YgZGVub21BcmcgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gZGVub21Bcmc7XG4gIH1cbiAgY29uc3QgZGVub20gPSBjaGFpbkh1Yi5nZXREZW5vbShkZW5vbUFyZyk7XG4gIGlmICghZGVub20pIHtcbiAgICB0aHJvdyBtYWtlRXJyb3IoYE5vIGRlbm9tIGZvciBicmFuZCAke2Rlbm9tQXJnfWApO1xuICB9XG4gIHJldHVybiBkZW5vbTtcbn07XG52YXIgY29lcmNlRGVub21BbW91bnQgPSAoY2hhaW5IdWIsIGFtb3VudCkgPT4ge1xuICBpZiAoXCJkZW5vbVwiIGluIGFtb3VudCkge1xuICAgIHJldHVybiBhbW91bnQ7XG4gIH1cbiAgY29uc3QgZGVub20gPSBjb2VyY2VEZW5vbShjaGFpbkh1YiwgYW1vdW50LmJyYW5kKTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgZGVub20sXG4gICAgdmFsdWU6IGFtb3VudC52YWx1ZVxuICB9KTtcbn07XG52YXIgY29lcmNlQ29pbiA9IChjaGFpbkh1YiwgYW1vdW50KSA9PiB7XG4gIGNvbnN0IGRlbm9tID0gXCJkZW5vbVwiIGluIGFtb3VudCA/IGFtb3VudC5kZW5vbSA6IGNvZXJjZURlbm9tKGNoYWluSHViLCBhbW91bnQuYnJhbmQpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBkZW5vbSxcbiAgICBhbW91bnQ6IFN0cmluZyhhbW91bnQudmFsdWUpXG4gIH0pO1xufTtcblxuLy9cbnZhciBtYXhDbG9ja1NrZXcgPSAxMG4gKiA2MG47XG52YXIgdHJ5RGVjb2RlUmVzcG9uc2UgPSAoYWNrU3RyLCBmcm9tUHJvdG9Nc2cpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBhbnkgPSBBbnkuZGVjb2RlKGRlY29kZUJhc2U2NChhY2tTdHIpKTtcbiAgICBjb25zdCBwcm90b01zZyA9IEFueS5kZWNvZGUoYW55LnZhbHVlKTtcbiAgICBjb25zdCBtc2cgPSBmcm9tUHJvdG9Nc2cocHJvdG9Nc2cpO1xuICAgIHJldHVybiBtc2c7XG4gIH0gY2F0Y2ggKGNhdXNlKSB7XG4gICAgdGhyb3cgbWFrZUVycm9yKGBiYWQgcmVzcG9uc2U6ICR7YWNrU3RyfWAsIHZvaWQgMCwgeyBjYXVzZSB9KTtcbiAgfVxufTtcbnZhciB0b0Rlbm9tQW1vdW50ID0gKGMyKSA9PiAoeyBkZW5vbTogYzIuZGVub20sIHZhbHVlOiBCaWdJbnQoYzIuYW1vdW50KSB9KTtcbnZhciB0b1RydW5jYXRlZERlbm9tQW1vdW50ID0gKGMyKSA9PiAoe1xuICBkZW5vbTogYzIuZGVub20sXG4gIHZhbHVlOiBCaWdJbnQoYzIuYW1vdW50LnNwbGl0KFwiLlwiKVswXSlcbn0pO1xudmFyIHRvQ29zbW9zVmFsaWRhdG9yQWRkcmVzcyA9IChyNSwgY2hhaW5JZCkgPT4gKHtcbiAgZW5jb2Rpbmc6IFwiYmVjaDMyXCIsXG4gIHZhbHVlOiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIHI1LnZhbGlkYXRvckFkZHJlc3NcbiAgKSxcbiAgY2hhaW5JZFxufSk7XG52YXIgdG9Db3Ntb3NEZWxlZ2F0aW9uUmVzcG9uc2UgPSAoeyBjaGFpbklkIH0sIHI1KSA9PiAoe1xuICBkZWxlZ2F0b3I6IHtcbiAgICBjaGFpbklkLFxuICAgIGVuY29kaW5nOiBcImJlY2gzMlwiLFxuICAgIHZhbHVlOiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICByNS5kZWxlZ2F0aW9uLmRlbGVnYXRvckFkZHJlc3NcbiAgICApXG4gIH0sXG4gIHZhbGlkYXRvcjogdG9Db3Ntb3NWYWxpZGF0b3JBZGRyZXNzKHI1LmRlbGVnYXRpb24sIGNoYWluSWQpLFxuICBhbW91bnQ6IHRvRGVub21BbW91bnQocjUuYmFsYW5jZSlcbn0pO1xuXG4vL1xudmFyIFB1YmxpY1RvcGljU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgc3Vic2NyaWJlcjogU3Vic2NyaWJlclNoYXBlLFxuICAgIHN0b3JhZ2VQYXRoOiBNLm9yKE0ucHJvbWlzZShcbiAgICAgIC8qICAgICAgICAqL1xuICAgICksIE0uc3RyaW5nKCkpXG4gIH0sXG4gIHsgZGVzY3JpcHRpb246IE0uc3RyaW5nKCkgfVxuKTtcbnZhciBUb3BpY3NSZWNvcmRTaGFwZSA9IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgUHVibGljVG9waWNTaGFwZSk7XG52YXIgbWFrZVJlY29yZGVyVG9waWMgPSAoZGVzY3JpcHRpb24sIHJlY29yZGVyS2l0KSA9PiB7XG4gIGNvbnN0IHJlY1AgPSBcInJlY29yZGVyXCIgaW4gcmVjb3JkZXJLaXQgPyByZWNvcmRlcktpdC5yZWNvcmRlciA6IHJlY29yZGVyS2l0LnJlY29yZGVyUDtcbiAgcmV0dXJuIHtcbiAgICBkZXNjcmlwdGlvbixcbiAgICBzdWJzY3JpYmVyOiByZWNvcmRlcktpdC5zdWJzY3JpYmVyLFxuICAgIHN0b3JhZ2VQYXRoOiBFKHJlY1ApLmdldFN0b3JhZ2VQYXRoKClcbiAgfTtcbn07XG5cbi8vXG52YXIgeyBWb3ckOiBWb3ckMiB9ID0gU2hhcGU7XG52YXIgb3JjaGVzdHJhdGlvbkFjY291bnRNZXRob2RzID0ge1xuICBnZXRBZGRyZXNzOiBNLmNhbGwoKS5yZXR1cm5zKENvc21vc0NoYWluQWRkcmVzc1NoYXBlKSxcbiAgZ2V0QmFsYW5jZTogTS5jYWxsKE0ub3IoQnJhbmRTaGFwZSwgTS5zdHJpbmcoKSkpLnJldHVybnMoXG4gICAgVm93JDIoRGVub21BbW91bnRTaGFwZSlcbiAgKSxcbiAgZ2V0QmFsYW5jZXM6IE0uY2FsbCgpLnJldHVybnMoVm93JDIoTS5hcnJheU9mKERlbm9tQW1vdW50U2hhcGUpKSksXG4gIHNlbmQ6IE0uY2FsbChBY2NvdW50SWRBcmdTaGFwZSwgQW1vdW50QXJnU2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICBzZW5kQWxsOiBNLmNhbGwoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsIE0uYXJyYXlPZihBbW91bnRBcmdTaGFwZSkpLnJldHVybnMoXG4gICAgVm93U2hhcGVcbiAgKSxcbiAgdHJhbnNmZXI6IE0uY2FsbChBY2NvdW50SWRBcmdTaGFwZSwgQW1vdW50QXJnU2hhcGUpLm9wdGlvbmFsKElCQ1RyYW5zZmVyT3B0aW9uc1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgdHJhbnNmZXJTdGVwczogTS5jYWxsKEFtb3VudEFyZ1NoYXBlLCBNLmFueSgpKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgYXNDb250aW51aW5nT2ZmZXI6IE0uY2FsbCgpLnJldHVybnMoXG4gICAgVm93JDIoe1xuICAgICAgcHVibGljU3Vic2NyaWJlcnM6IFRvcGljc1JlY29yZFNoYXBlLFxuICAgICAgaW52aXRhdGlvbk1ha2VyczogTS5hbnkoKSxcbiAgICAgIGhvbGRlcjogTS5yZW1vdGFibGUoKVxuICAgIH0pXG4gICksXG4gIGdldFB1YmxpY1RvcGljczogTS5jYWxsKCkucmV0dXJucyhWb3ckMihUb3BpY3NSZWNvcmRTaGFwZSkpXG59O1xuXG4vL1xudmFyIFRpbWVyQnJhbmRTaGFwZSA9IE0ucmVtb3RhYmxlKFwiVGltZXJCcmFuZFwiKTtcbnZhciBUaW1lc3RhbXBWYWx1ZVNoYXBlID0gTS5uYXQoKTtcbnZhciBSZWxhdGl2ZVRpbWVWYWx1ZVNoYXBlID0gTS5uYXQoKTtcbnZhciBUaW1lc3RhbXBSZWNvcmRTaGFwZSA9IHtcbiAgdGltZXJCcmFuZDogVGltZXJCcmFuZFNoYXBlLFxuICBhYnNWYWx1ZTogVGltZXN0YW1wVmFsdWVTaGFwZVxufTtcbmhhcmRlbihUaW1lc3RhbXBSZWNvcmRTaGFwZSk7XG52YXIgUmVsYXRpdmVUaW1lUmVjb3JkU2hhcGUgPSB7XG4gIHRpbWVyQnJhbmQ6IFRpbWVyQnJhbmRTaGFwZSxcbiAgcmVsVmFsdWU6IFJlbGF0aXZlVGltZVZhbHVlU2hhcGVcbn07XG5oYXJkZW4oUmVsYXRpdmVUaW1lUmVjb3JkU2hhcGUpO1xudmFyIFRpbWVzdGFtcFNoYXBlID0gTS5vcihUaW1lc3RhbXBSZWNvcmRTaGFwZSwgVGltZXN0YW1wVmFsdWVTaGFwZSk7XG52YXIgUmVsYXRpdmVUaW1lU2hhcGUgPSBNLm9yKFxuICBSZWxhdGl2ZVRpbWVSZWNvcmRTaGFwZSxcbiAgUmVsYXRpdmVUaW1lVmFsdWVTaGFwZVxuKTtcbnZhciBUaW1lclNlcnZpY2VTaGFwZSA9IE0ucmVtb3RhYmxlKFwiVGltZXJTZXJ2aWNlXCIpO1xuXG4vL1xudmFyIGFncmVlZFRpbWVyQnJhbmQgPSAobGVmdEJyYW5kLCByaWdodEJyYW5kKSA9PiB7XG4gIGlmIChsZWZ0QnJhbmQgPT09IHZvaWQgMCkge1xuICAgIGlmIChyaWdodEJyYW5kID09PSB2b2lkIDApIHtcbiAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByaWdodEJyYW5kO1xuICAgIH1cbiAgfSBlbHNlIGlmIChyaWdodEJyYW5kID09PSB2b2lkIDApIHtcbiAgICByZXR1cm4gbGVmdEJyYW5kO1xuICB9IGVsc2Uge1xuICAgIGxlZnRCcmFuZCA9PT0gcmlnaHRCcmFuZCB8fCB0aHJvd1JlZGFjdGVkYFRpbWVyQnJhbmRzIG11c3QgbWF0Y2g6ICR7cXVvdGUobGVmdEJyYW5kKX0gdnMgJHtxdW90ZShyaWdodEJyYW5kKX1gO1xuICAgIHJldHVybiBsZWZ0QnJhbmQ7XG4gIH1cbn07XG52YXIgc2hhcmVkVGltZXJCcmFuZCA9IChsZWZ0LCByaWdodCkgPT4ge1xuICBjb25zdCBsZWZ0QnJhbmQgPSB0eXBlb2YgbGVmdCA9PT0gXCJiaWdpbnRcIiA/IHZvaWQgMCA6IGxlZnQudGltZXJCcmFuZDtcbiAgY29uc3QgcmlnaHRCcmFuZCA9IHR5cGVvZiByaWdodCA9PT0gXCJiaWdpbnRcIiA/IHZvaWQgMCA6IHJpZ2h0LnRpbWVyQnJhbmQ7XG4gIHJldHVybiBhZ3JlZWRUaW1lckJyYW5kKGxlZnRCcmFuZCwgcmlnaHRCcmFuZCk7XG59O1xudmFyIGFic0xpa2UgPSAobGVmdCwgcmlnaHQsIGFic1ZhbHVlMikgPT4ge1xuICBOYXQoYWJzVmFsdWUyKTtcbiAgY29uc3QgdGltZXJCcmFuZCA9IHNoYXJlZFRpbWVyQnJhbmQobGVmdCwgcmlnaHQpO1xuICBpZiAodGltZXJCcmFuZCkge1xuICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgdGltZXJCcmFuZCxcbiAgICAgIGFic1ZhbHVlOiBhYnNWYWx1ZTJcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYWJzVmFsdWUyO1xuICB9XG59O1xudmFyIHJlbExpa2UgPSAobGVmdCwgcmlnaHQsIHJlbFZhbHVlMikgPT4ge1xuICBOYXQocmVsVmFsdWUyKTtcbiAgY29uc3QgdGltZXJCcmFuZCA9IHNoYXJlZFRpbWVyQnJhbmQobGVmdCwgcmlnaHQpO1xuICBpZiAodGltZXJCcmFuZCkge1xuICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgdGltZXJCcmFuZCxcbiAgICAgIHJlbFZhbHVlOiByZWxWYWx1ZTJcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmVsVmFsdWUyO1xuICB9XG59O1xudmFyIGFic1ZhbHVlID0gKGFicykgPT4ge1xuICBpZiAodHlwZW9mIGFicyA9PT0gXCJiaWdpbnRcIikge1xuICAgIHJldHVybiBOYXQoYWJzKTtcbiAgfVxuICBtdXN0TWF0Y2gyKGFicywgVGltZXN0YW1wUmVjb3JkU2hhcGUsIFwidGltZXN0YW1wXCIpO1xuICByZXR1cm4gTmF0KGFicy5hYnNWYWx1ZSk7XG59O1xudmFyIHJlbFZhbHVlID0gKHJlbCkgPT4ge1xuICBpZiAodHlwZW9mIHJlbCA9PT0gXCJiaWdpbnRcIikge1xuICAgIHJldHVybiBOYXQocmVsKTtcbiAgfVxuICBtdXN0TWF0Y2gyKHJlbCwgUmVsYXRpdmVUaW1lUmVjb3JkU2hhcGUsIFwicmVsYXRpdmVcIik7XG4gIHJldHVybiBOYXQocmVsLnJlbFZhbHVlKTtcbn07XG52YXIgbWFrZVRpbWVzdGFtcFJlY29yZCA9IChhYnMsIHRpbWVyQnJhbmQpID0+IGhhcmRlbih7IGFic1ZhbHVlOiBhYnMsIHRpbWVyQnJhbmQgfSk7XG52YXIgbWFrZVJlbGF0aXZlVGltZVJlY29yZCA9IChyZWwsIHRpbWVyQnJhbmQpID0+IGhhcmRlbih7IHJlbFZhbHVlOiByZWwsIHRpbWVyQnJhbmQgfSk7XG52YXIgY29lcmNlVGltZXN0YW1wUmVjb3JkID0gKHRzLCBicmFuZCkgPT4ge1xuICBicmFuZCB8fCB0aHJvd1JlZGFjdGVkYG11c3QgaGF2ZSBhIGJyYW5kYDtcbiAgaWYgKHR5cGVvZiB0cyA9PT0gXCJudW1iZXJcIikge1xuICAgIHRzID0gTmF0KHRzKTtcbiAgfVxuICBpZiAodHlwZW9mIHRzID09PSBcImJpZ2ludFwiKSB7XG4gICAgcmV0dXJuIG1ha2VUaW1lc3RhbXBSZWNvcmQodHMsIGJyYW5kKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCB7IHRpbWVyQnJhbmQgfSA9IHRzO1xuICAgIG11c3RNYXRjaDIodHMsIFRpbWVzdGFtcFJlY29yZFNoYXBlLCBcInRpbWVzdGFtcFwiKTtcbiAgICBhZ3JlZWRUaW1lckJyYW5kKHRpbWVyQnJhbmQsIGJyYW5kKTtcbiAgICByZXR1cm4gdHM7XG4gIH1cbn07XG52YXIgY29lcmNlUmVsYXRpdmVUaW1lUmVjb3JkID0gKHJ0LCBicmFuZCkgPT4ge1xuICBicmFuZCB8fCB0aHJvd1JlZGFjdGVkYG11c3QgaGF2ZSBhIGJyYW5kYDtcbiAgaWYgKHR5cGVvZiBydCA9PT0gXCJudW1iZXJcIikge1xuICAgIHJ0ID0gTmF0KHJ0KTtcbiAgfVxuICBpZiAodHlwZW9mIHJ0ID09PSBcImJpZ2ludFwiKSB7XG4gICAgcmV0dXJuIG1ha2VSZWxhdGl2ZVRpbWVSZWNvcmQocnQsIGJyYW5kKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCB7IHRpbWVyQnJhbmQgfSA9IHJ0O1xuICAgIG11c3RNYXRjaDIocnQsIFJlbGF0aXZlVGltZVJlY29yZFNoYXBlLCBcInJlbGF0aXZlVGltZVwiKTtcbiAgICBhZ3JlZWRUaW1lckJyYW5kKHRpbWVyQnJhbmQsIGJyYW5kKTtcbiAgICByZXR1cm4gcnQ7XG4gIH1cbn07XG52YXIgYWRkQWJzUmVsID0gKGFicywgcmVsKSA9PiBhYnNMaWtlKGFicywgcmVsLCBhYnNWYWx1ZShhYnMpICsgcmVsVmFsdWUocmVsKSk7XG52YXIgYWRkUmVsUmVsID0gKHJlbDEsIHJlbDIpID0+IHJlbExpa2UocmVsMSwgcmVsMiwgcmVsVmFsdWUocmVsMSkgKyByZWxWYWx1ZShyZWwyKSk7XG52YXIgc3VidHJhY3RBYnNBYnMgPSAoYWJzMSwgYWJzMikgPT4gcmVsTGlrZShhYnMxLCBhYnMyLCBhYnNWYWx1ZShhYnMxKSAtIGFic1ZhbHVlKGFiczIpKTtcbnZhciBjbGFtcGVkU3VidHJhY3RBYnNBYnMgPSAoYWJzMSwgYWJzMikgPT4ge1xuICBjb25zdCB2YWwxID0gYWJzVmFsdWUoYWJzMSk7XG4gIGNvbnN0IHZhbDIgPSBhYnNWYWx1ZShhYnMyKTtcbiAgcmV0dXJuIHJlbExpa2UoYWJzMSwgYWJzMiwgdmFsMSA+IHZhbDIgPyB2YWwxIC0gdmFsMiA6IDBuKTtcbn07XG52YXIgc3VidHJhY3RBYnNSZWwgPSAoYWJzLCByZWwpID0+IGFic0xpa2UoYWJzLCByZWwsIGFic1ZhbHVlKGFicykgLSByZWxWYWx1ZShyZWwpKTtcbnZhciBzdWJ0cmFjdFJlbFJlbCA9IChyZWwxLCByZWwyKSA9PiByZWxMaWtlKHJlbDEsIHJlbDIsIHJlbFZhbHVlKHJlbDEpIC0gcmVsVmFsdWUocmVsMikpO1xudmFyIGlzUmVsWmVybyA9IChyZWwpID0+IHJlbFZhbHVlKHJlbCkgPT09IDBuO1xudmFyIG11bHRpcGx5UmVsTmF0ID0gKHJlbCwgbmF0KSA9PiByZWxMaWtlKHJlbCwgbmF0LCByZWxWYWx1ZShyZWwpICogbmF0KTtcbnZhciBkaXZpZGVSZWxOYXQgPSAocmVsLCBuYXQpID0+IHJlbExpa2UocmVsLCBuYXQsIHJlbFZhbHVlKHJlbCkgLyBuYXQpO1xudmFyIGRpdmlkZVJlbFJlbCA9IChyZWwxLCByZWwyKSA9PiB7XG4gIHNoYXJlZFRpbWVyQnJhbmQocmVsMSwgcmVsMik7XG4gIHJldHVybiByZWxWYWx1ZShyZWwxKSAvIHJlbFZhbHVlKHJlbDIpO1xufTtcbnZhciBtb2RBYnNSZWwgPSAoYWJzLCBzdGVwKSA9PiByZWxMaWtlKGFicywgc3RlcCwgYWJzVmFsdWUoYWJzKSAlIHJlbFZhbHVlKHN0ZXApKTtcbnZhciBtb2RSZWxSZWwgPSAocmVsLCBzdGVwKSA9PiByZWxMaWtlKHJlbCwgc3RlcCwgcmVsVmFsdWUocmVsKSAlIHJlbFZhbHVlKHN0ZXApKTtcbnZhciBjb21wYXJlVmFsdWVzID0gKGxlZnQsIHJpZ2h0LCB2MSwgdjIyKSA9PiB7XG4gIHNoYXJlZFRpbWVyQnJhbmQobGVmdCwgcmlnaHQpO1xuICBpZiAodjEgPCB2MjIpIHtcbiAgICByZXR1cm4gLTE7XG4gIH0gZWxzZSBpZiAodjEgPT09IHYyMikge1xuICAgIHJldHVybiAwO1xuICB9IGVsc2Uge1xuICAgIGFzc2VydCh2MSA+IHYyMik7XG4gICAgcmV0dXJuIDE7XG4gIH1cbn07XG52YXIgVGltZU1hdGggPSBoYXJkZW4oe1xuICBhYnNWYWx1ZSxcbiAgcmVsVmFsdWUsXG4gIGNvZXJjZVRpbWVzdGFtcFJlY29yZCxcbiAgY29lcmNlUmVsYXRpdmVUaW1lUmVjb3JkLFxuICAvL1xuICBhZGRBYnNSZWwsXG4gIC8vXG4gIGFkZFJlbFJlbCxcbiAgc3VidHJhY3RBYnNBYnMsXG4gIGNsYW1wZWRTdWJ0cmFjdEFic0FicyxcbiAgc3VidHJhY3RBYnNSZWwsXG4gIHN1YnRyYWN0UmVsUmVsLFxuICBpc1JlbFplcm8sXG4gIG11bHRpcGx5UmVsTmF0LFxuICBkaXZpZGVSZWxOYXQsXG4gIGRpdmlkZVJlbFJlbCxcbiAgbW9kQWJzUmVsLFxuICBtb2RSZWxSZWwsXG4gIGNvbXBhcmVBYnM6IChhYnMxLCBhYnMyKSA9PiBjb21wYXJlVmFsdWVzKGFiczEsIGFiczIsIGFic1ZhbHVlKGFiczEpLCBhYnNWYWx1ZShhYnMyKSksXG4gIGNvbXBhcmVSZWw6IChyZWwxLCByZWwyKSA9PiBjb21wYXJlVmFsdWVzKHJlbDEsIHJlbDIsIHJlbFZhbHVlKHJlbDEpLCByZWxWYWx1ZShyZWwyKSlcbn0pO1xuXG4vL1xudmFyIFNFQ09ORFNfUEVSX01JTlVURSA9IDYwbjtcbnZhciBOQU5PU0VDT05EU19QRVJfU0VDT05EID0gMTAwMDAwMDAwMG47XG5mdW5jdGlvbiBtYWtlVGltZXN0YW1wSGVscGVyKHRpbWVyKSB7XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIC8qXG5cblxuXG5cblxuXG5cblxuXG4gICAgICovXG4gICAgYXN5bmMgZ2V0VGltZW91dFRpbWVzdGFtcE5TKHJlbGF0aXZlVGltZSkge1xuICAgICAgY29uc3QgY3VycmVudFRpbWUgPSBhd2FpdCBFKHRpbWVyKS5nZXRDdXJyZW50VGltZXN0YW1wKCk7XG4gICAgICBjb25zdCB0aW1lb3V0ID0gcmVsYXRpdmVUaW1lIHx8IFRpbWVNYXRoLmNvZXJjZVJlbGF0aXZlVGltZVJlY29yZChcbiAgICAgICAgU0VDT05EU19QRVJfTUlOVVRFICogNW4sXG4gICAgICAgIGN1cnJlbnRUaW1lLnRpbWVyQnJhbmRcbiAgICAgICk7XG4gICAgICByZXR1cm4gVGltZU1hdGguYWRkQWJzUmVsKGN1cnJlbnRUaW1lLCB0aW1lb3V0KS5hYnNWYWx1ZSAqIE5BTk9TRUNPTkRTX1BFUl9TRUNPTkQ7XG4gICAgfVxuICB9KTtcbn1cblxuLy9cbnZhciB0cmFjZTMgPSBtYWtlVHJhY2VyKFwiQ29zbW9zT3JjaEFjY291bnRcIik7XG52YXIgeyBWb3ckOiBWb3ckMyB9ID0gU2hhcGU7XG52YXIgc3Rha2luZ0FjY291bnRBY3Rpb25zTWV0aG9kcyA9IHtcbiAgZGVsZWdhdGU6IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSwgQW1vdW50QXJnU2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICByZWRlbGVnYXRlOiBNLmNhbGwoXG4gICAgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsXG4gICAgQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUsXG4gICAgQW1vdW50QXJnU2hhcGVcbiAgKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgdW5kZWxlZ2F0ZTogTS5jYWxsKE0uYXJyYXlPZihEZWxlZ2F0aW9uU2hhcGUpKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgd2l0aGRyYXdSZXdhcmQ6IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSkucmV0dXJucyhcbiAgICBWb3ckMyhNLmFycmF5T2YoRGVub21BbW91bnRTaGFwZSkpXG4gICksXG4gIHdpdGhkcmF3UmV3YXJkczogTS5jYWxsKCkucmV0dXJucyhWb3ckMyhNLmFycmF5T2YoRGVub21BbW91bnRTaGFwZSkpKVxufTtcbnZhciBzdGFraW5nQWNjb3VudFF1ZXJpZXNNZXRob2RzID0ge1xuICBnZXREZWxlZ2F0aW9uOiBNLmNhbGwoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICBnZXREZWxlZ2F0aW9uczogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldFVuYm9uZGluZ0RlbGVnYXRpb246IE0uY2FsbChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldFVuYm9uZGluZ0RlbGVnYXRpb25zOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0UmVkZWxlZ2F0aW9uczogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIGdldFJld2FyZDogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgZ2V0UmV3YXJkczogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSlcbn07XG52YXIgbm9ibGVNZXRob2RzID0ge1xuICBkZXBvc2l0Rm9yQnVybjogTS5jYWxsKE0uc3RyaW5nKCksIEFtb3VudEFyZ1NoYXBlKS5vcHRpb25hbChNLnN0cmluZygpKS5yZXR1cm5zKFZvd1NoYXBlKVxufTtcbnZhciBJY2FBY2NvdW50SG9sZGVySSA9IE0uaW50ZXJmYWNlKFwiSWNhQWNjb3VudEhvbGRlclwiLCB7XG4gIC4uLm5vYmxlTWV0aG9kcyxcbiAgLi4ub3JjaGVzdHJhdGlvbkFjY291bnRNZXRob2RzLFxuICAuLi5zdGFraW5nQWNjb3VudEFjdGlvbnNNZXRob2RzLFxuICAuLi5zdGFraW5nQWNjb3VudFF1ZXJpZXNNZXRob2RzLFxuICBkZWFjdGl2YXRlOiBNLmNhbGwoKS5yZXR1cm5zKFZvd1NoYXBlKSxcbiAgcmVhY3RpdmF0ZTogTS5jYWxsKCkucmV0dXJucyhWb3dTaGFwZSksXG4gIGV4ZWN1dGVFbmNvZGVkVHg6IE0uY2FsbChNLmFycmF5T2YoUHJvdG8zU2hhcGUpKS5vcHRpb25hbChUeEJvZHlPcHRzU2hhcGUpLnJldHVybnMoVm93U2hhcGUpXG59KTtcbnZhciBQVUJMSUNfVE9QSUNTID0ge1xuICBhY2NvdW50OiBbXCJTdGFraW5nIEFjY291bnQgaG9sZGVyIHN0YXR1c1wiLCBNLmFueSgpXVxufTtcbnZhciBDb3Ntb3NPcmNoZXN0cmF0aW9uSW52aXRhdGlvbk1ha2Vyc0kgPSBNLmludGVyZmFjZShcbiAgXCJpbnZpdGF0aW9uTWFrZXJzXCIsXG4gIHtcbiAgICBEZWxlZ2F0ZTogTS5jYWxsKENvc21vc0NoYWluQWRkcmVzc1NoYXBlLCBBbW91bnRBcmdTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ucHJvbWlzZSgpXG4gICAgKSxcbiAgICBSZWRlbGVnYXRlOiBNLmNhbGwoXG4gICAgICBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICAgIENvc21vc0NoYWluQWRkcmVzc1NoYXBlLFxuICAgICAgQW1vdW50QXJnU2hhcGVcbiAgICApLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFdpdGhkcmF3UmV3YXJkOiBNLmNhbGwoQ29zbW9zQ2hhaW5BZGRyZXNzU2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFVuZGVsZWdhdGU6IE0uY2FsbChNLmFycmF5T2YoRGVsZWdhdGlvblNoYXBlKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgRGVhY3RpdmF0ZUFjY291bnQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFJlYWN0aXZhdGVBY2NvdW50OiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICBUcmFuc2ZlckFjY291bnQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFNlbmQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFNlbmRBbGw6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIFRyYW5zZmVyOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICB9XG4pO1xuaGFyZGVuKENvc21vc09yY2hlc3RyYXRpb25JbnZpdGF0aW9uTWFrZXJzSSk7XG52YXIgcHJlcGFyZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50S2l0ID0gKHpvbmUsIHtcbiAgY2hhaW5IdWIsXG4gIG1ha2VSZWNvcmRlcktpdCxcbiAgdGltZXJTZXJ2aWNlLFxuICB2b3dUb29sczogeyB3YXRjaCwgYXNWb3csIHdoZW4sIGFsbFZvd3MgfSxcbiAgemNmXG59KSA9PiB7XG4gIGNvbnN0IHRpbWVzdGFtcEhlbHBlciA9IG1ha2VUaW1lc3RhbXBIZWxwZXIodGltZXJTZXJ2aWNlKTtcbiAgY29uc3QgbWFrZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50S2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIkNvc21vcyBPcmNoZXN0cmF0aW9uIEFjY291bnQgSG9sZGVyXCIsXG4gICAge1xuICAgICAgaGVscGVyOiBNLmludGVyZmFjZShcImhlbHBlclwiLCB7XG4gICAgICAgIG93bmVkOiBNLmNhbGwoKS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpLFxuICAgICAgICBnZXRVcGRhdGVyOiBNLmNhbGwoKS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpLFxuICAgICAgICBhbW91bnRUb0NvaW46IE0uY2FsbChBbW91bnRBcmdTaGFwZSkucmV0dXJucyhNLnJlY29yZCgpKVxuICAgICAgfSksXG4gICAgICByZXR1cm5Wb2lkV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZXR1cm5Wb2lkV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpXG4gICAgICB9KSxcbiAgICAgIGJhbGFuY2VRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiYmFsYW5jZVF1ZXJ5V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hcnJheU9mKE0ucmVjb3JkKCkpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS5vcihNLnJlY29yZCgpLCBNLnVuZGVmaW5lZCgpKSlcbiAgICAgIH0pLFxuICAgICAgYWxsQmFsYW5jZXNRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiYWxsQmFsYW5jZXNRdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICB1bmRlbGVnYXRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJ1bmRlbGVnYXRlV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKFZvdyQzKE0ucHJvbWlzZSgpKSlcbiAgICAgIH0pLFxuICAgICAgd2l0aGRyYXdSZXdhcmRXYXRjaGVyOiBNLmludGVyZmFjZShcIndpdGhkcmF3UmV3YXJkV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hcnJheU9mKE0udW5kZWZpbmVkKCkpKS5yZXR1cm5zKE0uYXJyYXlPZihEZW5vbUFtb3VudFNoYXBlKSlcbiAgICAgIH0pLFxuICAgICAgdHJhbnNmZXJXYXRjaGVyOiBNLmludGVyZmFjZShcInRyYW5zZmVyV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoW00ucmVjb3JkKCksIE0ubmF0KCldKS5vcHRpb25hbCh7XG4gICAgICAgICAgZGVzdGluYXRpb246IENvc21vc0NoYWluQWRkcmVzc1NoYXBlLFxuICAgICAgICAgIG9wdHM6IE0ub3IoTS51bmRlZmluZWQoKSwgSUJDVHJhbnNmZXJPcHRpb25zU2hhcGUpLFxuICAgICAgICAgIHRva2VuOiB7XG4gICAgICAgICAgICBkZW5vbTogTS5zdHJpbmcoKSxcbiAgICAgICAgICAgIGFtb3VudDogTS5zdHJpbmcoKVxuICAgICAgICAgIH1cbiAgICAgICAgfSkucmV0dXJucyhWb3ckMyhNLnJlY29yZCgpKSlcbiAgICAgIH0pLFxuICAgICAgZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJkZWxlZ2F0aW9uUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoTS5yZWNvcmQoKSlcbiAgICAgIH0pLFxuICAgICAgZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICB1bmJvbmRpbmdEZWxlZ2F0aW9uUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcbiAgICAgICAgXCJ1bmJvbmRpbmdEZWxlZ2F0aW9uUXVlcnlXYXRjaGVyXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhNLnJlY29yZCgpKVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgdW5ib25kaW5nRGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgICBcInVuYm9uZGluZ0RlbGVnYXRpb25zUXVlcnlXYXRjaGVyXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICAgIE0uYXJyYXlPZihNLnJlY29yZCgpKVxuICAgICAgICAgIClcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHJlZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZWRlbGVnYXRpb25RdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICByZWRlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiBNLmludGVyZmFjZShcInJlZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYXJyYXlPZihNLnJlY29yZCgpKSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoTS5yZWNvcmQoKSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICByZXdhcmRRdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmV3YXJkUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoXG4gICAgICAgICAgTS5hcnJheU9mKE0ucmVjb3JkKCkpXG4gICAgICAgIClcbiAgICAgIH0pLFxuICAgICAgcmV3YXJkc1F1ZXJ5V2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJyZXdhcmRzUXVlcnlXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoTS5yZWNvcmQoKSlcbiAgICAgIH0pLFxuICAgICAgaG9sZGVyOiBJY2FBY2NvdW50SG9sZGVySSxcbiAgICAgIGludml0YXRpb25NYWtlcnM6IENvc21vc09yY2hlc3RyYXRpb25JbnZpdGF0aW9uTWFrZXJzSVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgICh7IGNoYWluQWRkcmVzcywgbG9jYWxBZGRyZXNzLCByZW1vdGVBZGRyZXNzIH0sIGlvKSA9PiB7XG4gICAgICB0cmFjZTMoXCJjb3Ntb3Mgb3JjaCBhY2N0IGluaXRcIiwge1xuICAgICAgICBjaGFpbkFkZHJlc3MsXG4gICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgcmVtb3RlQWRkcmVzc1xuICAgICAgfSk7XG4gICAgICBjb25zdCB7IHN0b3JhZ2VOb2RlIH0gPSBpbztcbiAgICAgIGNvbnN0IHRvcGljS2l0ID0gc3RvcmFnZU5vZGUgPyBtYWtlUmVjb3JkZXJLaXQoc3RvcmFnZU5vZGUsIFBVQkxJQ19UT1BJQ1MuYWNjb3VudFsxXSkgOiB2b2lkIDA7XG4gICAgICBpZiAodG9waWNLaXQpIHtcbiAgICAgICAgdm9pZCBFKHRvcGljS2l0LnJlY29yZGVyKS53cml0ZShcbiAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGxvY2FsQWRkcmVzcyxcbiAgICAgICAgICAgIHJlbW90ZUFkZHJlc3NcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBjb25zdCB7IGFjY291bnQsIGljcUNvbm5lY3Rpb24sIHRpbWVyIH0gPSBpbztcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGFjY291bnQsXG4gICAgICAgIGNoYWluQWRkcmVzcyxcbiAgICAgICAgaWNxQ29ubmVjdGlvbixcbiAgICAgICAgbG9jYWxBZGRyZXNzLFxuICAgICAgICByZW1vdGVBZGRyZXNzLFxuICAgICAgICB0aW1lcixcbiAgICAgICAgdG9waWNLaXRcbiAgICAgIH07XG4gICAgfSxcbiAgICB7XG4gICAgICBoZWxwZXI6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb3duZWQoKSB7XG4gICAgICAgICAgY29uc3QgeyBhY2NvdW50IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICghYWNjb3VudCkge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBVc2luZyBhY2NvdW50IGhvbGRlciBhZnRlciB0cmFuc2ZlcmA7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBhY2NvdW50O1xuICAgICAgICB9LFxuICAgICAgICBnZXRVcGRhdGVyKCkge1xuICAgICAgICAgIGlmICghdGhpcy5zdGF0ZS50b3BpY0tpdCkgdGhyb3cgdGhyb3dSZWRhY3RlZGBubyB0b3BpY0tpdGA7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUudG9waWNLaXQucmVjb3JkZXI7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgYW1vdW50VG9Db2luKGFtb3VudCkge1xuICAgICAgICAgICEoXCJicmFuZFwiIGluIGFtb3VudCkgfHwgdGhyb3dSZWRhY3RlZGAnYW1vdW50VG9Db2luJyBub3Qgd29ya2luZyBmb3IgJHtxdW90ZShhbW91bnQuYnJhbmQpfSB1bnRpbCAjMTA0NDk7IHVzZSAnRGVub21BbW91bnQnIGZvciBub3dgO1xuICAgICAgICAgIHJldHVybiBjb2VyY2VDb2luKGNoYWluSHViLCBhbW91bnQpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYmFsYW5jZVF1ZXJ5V2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGlmICghcmVzdWx0Py5rZXkpIHRocm93IHRocm93UmVkYWN0ZWRgRXJyb3IgcGFyc2luZyByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IGJhbGFuY2UgfSA9IFF1ZXJ5QmFsYW5jZVJlc3BvbnNlLmRlY29kZShcbiAgICAgICAgICAgIGRlY29kZUJhc2U2NChyZXN1bHQua2V5KVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFiYWxhbmNlKSB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgYmFsYW5jZSBrZXk6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih0b0Rlbm9tQW1vdW50KGJhbGFuY2UpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlbGVnYXRpb25RdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGlmICghcmVzdWx0Py5rZXkpIHRocm93IHRocm93UmVkYWN0ZWRgRXJyb3IgcGFyc2luZyByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IGRlbGVnYXRpb25SZXNwb25zZSB9ID0gUXVlcnlEZWxlZ2F0aW9uUmVzcG9uc2UuZGVjb2RlKFxuICAgICAgICAgICAgZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIWRlbGVnYXRpb25SZXNwb25zZSlcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCBkZWxlZ2F0aW9uUmVzcG9uc2Uga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oXG4gICAgICAgICAgICB0b0Nvc21vc0RlbGVnYXRpb25SZXNwb25zZShjaGFpbkFkZHJlc3MsIGRlbGVnYXRpb25SZXNwb25zZSlcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGlmICghcmVzdWx0Py5rZXkpIHRocm93IHRocm93UmVkYWN0ZWRgRXJyb3IgcGFyc2luZyByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IGRlbGVnYXRpb25SZXNwb25zZXMgfSA9IFF1ZXJ5RGVsZWdhdG9yRGVsZWdhdGlvbnNSZXNwb25zZS5kZWNvZGUoZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpKTtcbiAgICAgICAgICBpZiAoIWRlbGVnYXRpb25SZXNwb25zZXMpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgZGVsZWdhdGlvblJlc3BvbnNlcyBrZXk6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbihcbiAgICAgICAgICAgIGRlbGVnYXRpb25SZXNwb25zZXMubWFwKFxuICAgICAgICAgICAgICAocjUpID0+IHRvQ29zbW9zRGVsZWdhdGlvblJlc3BvbnNlKGNoYWluQWRkcmVzcywgcjUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHVuYm9uZGluZ0RlbGVnYXRpb25RdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBpZiAoIXJlc3VsdD8ua2V5KSB0aHJvdyB0aHJvd1JlZGFjdGVkYEVycm9yIHBhcnNpbmcgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyB1bmJvbmQgfSA9IFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlc3BvbnNlLmRlY29kZShcbiAgICAgICAgICAgIGRlY29kZUJhc2U2NChyZXN1bHQua2V5KVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCF1bmJvbmQpIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCB1bmJvbmQga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4odW5ib25kKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHVuYm9uZGluZ0RlbGVnYXRpb25zUXVlcnlXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtyZXN1bHRdKSB7XG4gICAgICAgICAgaWYgKCFyZXN1bHQ/LmtleSkgdGhyb3cgdGhyb3dSZWRhY3RlZGBFcnJvciBwYXJzaW5nIHJlc3VsdCAke3Jlc3VsdH1gO1xuICAgICAgICAgIGNvbnN0IHsgdW5ib25kaW5nUmVzcG9uc2VzIH0gPSBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVzcG9uc2UuZGVjb2RlKFxuICAgICAgICAgICAgZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXVuYm9uZGluZ1Jlc3BvbnNlcylcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCB1bmJvbmRpbmdSZXNwb25zZXMga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4odW5ib25kaW5nUmVzcG9uc2VzKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlZGVsZWdhdGlvblF1ZXJ5V2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGlmICghcmVzdWx0Py5rZXkpIHRocm93IHRocm93UmVkYWN0ZWRgRXJyb3IgcGFyc2luZyByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IHJlZGVsZWdhdGlvblJlc3BvbnNlcyB9ID0gUXVlcnlSZWRlbGVnYXRpb25zUmVzcG9uc2UuZGVjb2RlKFxuICAgICAgICAgICAgZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXJlZGVsZWdhdGlvblJlc3BvbnNlcylcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCByZWRlbGVnYXRpb25SZXNwb25zZXMga2V5OiAke3Jlc3VsdH1gO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4ocmVkZWxlZ2F0aW9uUmVzcG9uc2VzKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlZGVsZWdhdGlvbnNRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBpZiAoIXJlc3VsdD8ua2V5KSB0aHJvdyB0aHJvd1JlZGFjdGVkYEVycm9yIHBhcnNpbmcgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyByZWRlbGVnYXRpb25SZXNwb25zZXMgfSA9IFF1ZXJ5UmVkZWxlZ2F0aW9uc1Jlc3BvbnNlLmRlY29kZShcbiAgICAgICAgICAgIGRlY29kZUJhc2U2NChyZXN1bHQua2V5KVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKCFyZWRlbGVnYXRpb25SZXNwb25zZXMpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgcmVkZWxlZ2F0aW9uUmVzcG9uc2VzIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHJlZGVsZWdhdGlvblJlc3BvbnNlcyk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXdhcmRRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBpZiAoIXJlc3VsdD8ua2V5KSB0aHJvdyB0aHJvd1JlZGFjdGVkYEVycm9yIHBhcnNpbmcgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyByZXdhcmRzIH0gPSBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVzcG9uc2UuZGVjb2RlKFxuICAgICAgICAgICAgZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoIXJld2FyZHMpIHRocm93IHRocm93UmVkYWN0ZWRgUmVzdWx0IGxhY2tlZCByZXdhcmRzIGtleTogJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHJld2FyZHMubWFwKHRvVHJ1bmNhdGVkRGVub21BbW91bnQpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJld2FyZHNRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChbcmVzdWx0XSkge1xuICAgICAgICAgIGlmICghcmVzdWx0Py5rZXkpIHRocm93IHRocm93UmVkYWN0ZWRgRXJyb3IgcGFyc2luZyByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICBjb25zdCB7IHJld2FyZHMsIHRvdGFsIH0gPSBRdWVyeURlbGVnYXRpb25Ub3RhbFJld2FyZHNSZXNwb25zZS5kZWNvZGUoXG4gICAgICAgICAgICBkZWNvZGVCYXNlNjQocmVzdWx0LmtleSlcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghcmV3YXJkcyB8fCAhdG90YWwpXG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFJlc3VsdCBsYWNrZWQgcmV3YXJkcyBvciB0b3RhbCBrZXk6ICR7cmVzdWx0fWA7XG4gICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgICAgICByZXdhcmRzOiByZXdhcmRzLm1hcCgocmV3YXJkKSA9PiAoe1xuICAgICAgICAgICAgICB2YWxpZGF0b3I6IHRvQ29zbW9zVmFsaWRhdG9yQWRkcmVzcyhyZXdhcmQsIGNoYWluQWRkcmVzcy5jaGFpbklkKSxcbiAgICAgICAgICAgICAgcmV3YXJkOiByZXdhcmQucmV3YXJkLm1hcCh0b1RydW5jYXRlZERlbm9tQW1vdW50KVxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgdG90YWw6IHRvdGFsLm1hcCh0b1RydW5jYXRlZERlbm9tQW1vdW50KVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYWxsQmFsYW5jZXNRdWVyeVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3Jlc3VsdF0pIHtcbiAgICAgICAgICBsZXQgcmVzcG9uc2U7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gUXVlcnlBbGxCYWxhbmNlc1Jlc3BvbnNlLmRlY29kZShcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgZGVjb2RlQmFzZTY0KHJlc3VsdC5rZXkpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gY2F0Y2ggKGNhdXNlKSB7XG4gICAgICAgICAgICB0aHJvdyBtYWtlRXJyb3IoXG4gICAgICAgICAgICAgIGBFcnJvciBwYXJzaW5nIFF1ZXJ5QWxsQmFsYW5jZXMgcmVzdWx0ICR7cXVvdGUocmVzdWx0KX1gLFxuICAgICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICAgIHsgY2F1c2UgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgeyBiYWxhbmNlcyB9ID0gcmVzcG9uc2U7XG4gICAgICAgICAgaWYgKCFiYWxhbmNlcykgdGhyb3cgdGhyb3dSZWRhY3RlZGBSZXN1bHQgbGFja2VkIGJhbGFuY2VzIGtleTogJHtxdW90ZShyZXN1bHQpfWA7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbihiYWxhbmNlcy5tYXAoKGNvaW4pID0+IHRvRGVub21BbW91bnQoY29pbikpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHVuZGVsZWdhdGVXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCkge1xuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gdHJ5RGVjb2RlUmVzcG9uc2UoXG4gICAgICAgICAgICByZXN1bHQsXG4gICAgICAgICAgICBNc2dVbmRlbGVnYXRlUmVzcG9uc2UuZnJvbVByb3RvTXNnXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0cmFjZTMoXCJ1bmRlbGVnYXRlIHJlc3BvbnNlXCIsIHJlc3BvbnNlKTtcbiAgICAgICAgICBjb25zdCB7IGNvbXBsZXRpb25UaW1lIH0gPSByZXNwb25zZTtcbiAgICAgICAgICBjb21wbGV0aW9uVGltZSB8fCB0aHJvd1JlZGFjdGVkYE5vIGNvbXBsZXRpb24gdGltZSByZXN1bHQgJHtyZXN1bHR9YDtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgRSh0aGlzLnN0YXRlLnRpbWVyKS53YWtlQXQoY29tcGxldGlvblRpbWUuc2Vjb25kcyArIG1heENsb2NrU2tldylcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgLypcblxuXG4gICAgICAgKi9cbiAgICAgIHJldHVyblZvaWRXYXRjaGVyOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0KSB7XG4gICAgICAgICAgdHJhY2UzKFwiUmVzdWx0XCIsIHJlc3VsdCk7XG4gICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdpdGhkcmF3UmV3YXJkV2F0Y2hlcjoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChyZXN1bHQpIHtcbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IHRyeURlY29kZVJlc3BvbnNlKFxuICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgTXNnV2l0aGRyYXdEZWxlZ2F0b3JSZXdhcmRSZXNwb25zZS5mcm9tUHJvdG9Nc2dcbiAgICAgICAgICApO1xuICAgICAgICAgIHRyYWNlMyhcIndpdGhkcmF3UmV3YXJkIHJlc3BvbnNlXCIsIHJlc3BvbnNlKTtcbiAgICAgICAgICBjb25zdCB7IGFtb3VudDogY29pbnMgfSA9IHJlc3BvbnNlO1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oY29pbnMubWFwKHRvRGVub21BbW91bnQpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRyYW5zZmVyV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3sgdHJhbnNmZXJDaGFubmVsIH0sIHRpbWVvdXRUaW1lc3RhbXBdLCB7IG9wdHMsIHRva2VuOiB0b2tlbjIsIGRlc3RpbmF0aW9uIH0pIHtcbiAgICAgICAgICBjb25zdCByZXN1bHRzID0gRSh0aGlzLmZhY2V0cy5oZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChbXG4gICAgICAgICAgICBBbnkudG9KU09OKFxuICAgICAgICAgICAgICBNc2dUcmFuc2Zlci50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICBzb3VyY2VQb3J0OiB0cmFuc2ZlckNoYW5uZWwucG9ydElkLFxuICAgICAgICAgICAgICAgIHNvdXJjZUNoYW5uZWw6IHRyYW5zZmVyQ2hhbm5lbC5jaGFubmVsSWQsXG4gICAgICAgICAgICAgICAgdG9rZW46IHRva2VuMixcbiAgICAgICAgICAgICAgICBzZW5kZXI6IHRoaXMuc3RhdGUuY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgIHJlY2VpdmVyOiBkZXN0aW5hdGlvbi52YWx1ZSxcbiAgICAgICAgICAgICAgICB0aW1lb3V0SGVpZ2h0OiBvcHRzPy50aW1lb3V0SGVpZ2h0ID8/IHtcbiAgICAgICAgICAgICAgICAgIHJldmlzaW9uSGVpZ2h0OiAwbixcbiAgICAgICAgICAgICAgICAgIHJldmlzaW9uTnVtYmVyOiAwblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGltZW91dFRpbWVzdGFtcCxcbiAgICAgICAgICAgICAgICBtZW1vOiBvcHRzPy5tZW1vID8/IFwiXCJcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICBdKTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaW52aXRhdGlvbk1ha2Vyczoge1xuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIERlbGVnYXRlKHZhbGlkYXRvciwgYW1vdW50KSB7XG4gICAgICAgICAgdHJhY2UzKFwiRGVsZWdhdGVcIiwgdmFsaWRhdG9yLCBhbW91bnQpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5kZWxlZ2F0ZSh2YWxpZGF0b3IsIGFtb3VudCkpO1xuICAgICAgICAgIH0sIFwiRGVsZWdhdGVcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBSZWRlbGVnYXRlKHNyY1ZhbGlkYXRvciwgZHN0VmFsaWRhdG9yLCBhbW91bnQpIHtcbiAgICAgICAgICB0cmFjZTMoXCJSZWRlbGVnYXRlXCIsIHNyY1ZhbGlkYXRvciwgZHN0VmFsaWRhdG9yLCBhbW91bnQpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5ob2xkZXIucmVkZWxlZ2F0ZShzcmNWYWxpZGF0b3IsIGRzdFZhbGlkYXRvciwgYW1vdW50KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCBcIlJlZGVsZWdhdGVcIik7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBXaXRoZHJhd1Jld2FyZCh2YWxpZGF0b3IpIHtcbiAgICAgICAgICB0cmFjZTMoXCJXaXRoZHJhd1Jld2FyZFwiLCB2YWxpZGF0b3IpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci53aXRoZHJhd1Jld2FyZCh2YWxpZGF0b3IpKTtcbiAgICAgICAgICB9LCBcIldpdGhkcmF3UmV3YXJkXCIpO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBVbmRlbGVnYXRlKGRlbGVnYXRpb25zKSB7XG4gICAgICAgICAgdHJhY2UzKFwiVW5kZWxlZ2F0ZVwiLCBkZWxlZ2F0aW9ucyk7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLnVuZGVsZWdhdGUoZGVsZWdhdGlvbnMpKTtcbiAgICAgICAgICB9LCBcIlVuZGVsZWdhdGVcIik7XG4gICAgICAgIH0sXG4gICAgICAgIERlYWN0aXZhdGVBY2NvdW50KCkge1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5kZWFjdGl2YXRlKCkpO1xuICAgICAgICAgIH0sIFwiRGVhY3RpdmF0ZUFjY291bnRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFJlYWN0aXZhdGVBY2NvdW50KCkge1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5yZWFjdGl2YXRlKCkpO1xuICAgICAgICAgIH0sIFwiUmVhY3RpdmF0ZUFjY291bnRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFNlbmQoKSB7XG4gICAgICAgICAgY29uc3Qgb2ZmZXJIYW5kbGVyID0gKHNlYXQsIHsgdG9BY2NvdW50LCBhbW91bnQgfSkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLnNlbmQodG9BY2NvdW50LCBhbW91bnQpKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24ob2ZmZXJIYW5kbGVyLCBcIlNlbmRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFNlbmRBbGwoKSB7XG4gICAgICAgICAgY29uc3Qgb2ZmZXJIYW5kbGVyID0gKHNlYXQsIHsgdG9BY2NvdW50LCBhbW91bnRzIH0pID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5zZW5kQWxsKHRvQWNjb3VudCwgYW1vdW50cykpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihvZmZlckhhbmRsZXIsIFwiU2VuZEFsbFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIFRyYW5zZmVyQWNjb3VudCgpIHtcbiAgICAgICAgICB0aHJvdyBFcnJvcihcIm5vdCB5ZXQgaW1wbGVtZW50ZWRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFRyYW5zZmVyKCkge1xuICAgICAgICAgIGNvbnN0IG9mZmVySGFuZGxlciA9IChzZWF0LCB7IGFtb3VudCwgZGVzdGluYXRpb24sIG9wdHMgfSkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmhvbGRlci50cmFuc2ZlcihkZXN0aW5hdGlvbiwgYW1vdW50LCBvcHRzKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24ob2ZmZXJIYW5kbGVyLCBcIlRyYW5zZmVyXCIpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaG9sZGVyOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYXNDb250aW51aW5nT2ZmZXIoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IG51bGw7XG4gICAgICAgICAgICBjb25zdCB7IGhvbGRlciwgaW52aXRhdGlvbk1ha2VyczogaW0gfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgaW52aXRhdGlvbk1ha2VycyA9IChcbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAvKiAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgIGltXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIGhhcmRlbih7XG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIHB1YmxpY1N1YnNjcmliZXJzOiBhd2FpdCB3aGVuKGhvbGRlci5nZXRQdWJsaWNUb3BpY3MoKSksXG4gICAgICAgICAgICAgIGludml0YXRpb25NYWtlcnNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRQdWJsaWNUb3BpY3MoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IG51bGw7XG4gICAgICAgICAgICBjb25zdCB7IHRvcGljS2l0IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCF0b3BpY0tpdCkgdGhyb3cgdGhyb3dSZWRhY3RlZGBObyB0b3BpY0tpdDsgc3RvcmFnZU5vZGUgbm90IHByb3ZpZGVkYDtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgICBhY2NvdW50OiB7XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFBVQkxJQ19UT1BJQ1MuYWNjb3VudFswXSxcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyOiB0b3BpY0tpdC5zdWJzY3JpYmVyLFxuICAgICAgICAgICAgICAgIHN0b3JhZ2VQYXRoOiBhd2FpdCB0b3BpY0tpdC5yZWNvcmRlci5nZXRTdG9yYWdlUGF0aCgpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0QWRkcmVzcygpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5jaGFpbkFkZHJlc3M7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGRlbGVnYXRlKHZhbGlkYXRvciwgYW1vdW50KSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImRlbGVnYXRlXCIsIHZhbGlkYXRvciwgYW1vdW50KTtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29uc3QgYW1vdW50QXNDb2luID0gaGVscGVyLmFtb3VudFRvQ29pbihhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoW1xuICAgICAgICAgICAgICBBbnkudG9KU09OKFxuICAgICAgICAgICAgICAgIE1zZ0RlbGVnYXRlLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcmVzczogdmFsaWRhdG9yLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnRBc0NvaW5cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgcmVkZWxlZ2F0ZShzcmNWYWxpZGF0b3IsIGRzdFZhbGlkYXRvciwgYW1vdW50KSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcInJlZGVsZWdhdGVcIiwgc3JjVmFsaWRhdG9yLCBkc3RWYWxpZGF0b3IsIGFtb3VudCk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGhlbHBlci5vd25lZCgpKS5leGVjdXRlRW5jb2RlZFR4KFtcbiAgICAgICAgICAgICAgQW55LnRvSlNPTihcbiAgICAgICAgICAgICAgICBNc2dCZWdpblJlZGVsZWdhdGUudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JTcmNBZGRyZXNzOiBzcmNWYWxpZGF0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JEc3RBZGRyZXNzOiBkc3RWYWxpZGF0b3IudmFsdWUsXG4gICAgICAgICAgICAgICAgICBhbW91bnQ6IGhlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICByZXN1bHRzLFxuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgd2l0aGRyYXdSZXdhcmQodmFsaWRhdG9yKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcIndpdGhkcmF3UmV3YXJkXCIsIHZhbGlkYXRvcik7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IG1zZyA9IE1zZ1dpdGhkcmF3RGVsZWdhdG9yUmV3YXJkLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgIHZhbGlkYXRvckFkZHJlc3M6IHZhbGlkYXRvci52YWx1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCBhY2NvdW50ID0gaGVscGVyLm93bmVkKCk7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShhY2NvdW50KS5leGVjdXRlRW5jb2RlZFR4KFtBbnkudG9KU09OKG1zZyldKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy53aXRoZHJhd1Jld2FyZFdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0QmFsYW5jZShkZW5vbSkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5QmFsYW5jZVJlcXVlc3QudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBhZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICBkZW5vbTogY29lcmNlRGVub20oY2hhaW5IdWIsIGRlbm9tKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLmJhbGFuY2VRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEJhbGFuY2VzKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5QWxsQmFsYW5jZXNSZXF1ZXN0LnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgYWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMuYWxsQmFsYW5jZXNRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgc2VuZCh0b0FjY291bnQsIGFtb3VudCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJzZW5kXCIsIHRvQWNjb3VudCwgYW1vdW50KTtcbiAgICAgICAgICAgIGNvbnN0IGNvc21vc0Rlc3QgPSBjaGFpbkh1Yi5jb2VyY2VDb3Ntb3NBZGRyZXNzKHRvQWNjb3VudCk7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGNvc21vc0Rlc3QuY2hhaW5JZCA9PT0gY2hhaW5BZGRyZXNzLmNoYWluSWQgfHwgdGhyb3dSZWRhY3RlZGBiYW5rL3NlbmQgY2Fubm90IHNlbmQgdG8gYSBkaWZmZXJlbnQgY2hhaW4gJHtxdW90ZShjb3Ntb3NEZXN0LmNoYWluSWQpfWA7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUoaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoW1xuICAgICAgICAgICAgICAgIEFueS50b0pTT04oXG4gICAgICAgICAgICAgICAgICBNc2dTZW5kLnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgICBmcm9tQWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICB0b0FkZHJlc3M6IGNvc21vc0Rlc3QudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIGFtb3VudDogW2hlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KV1cbiAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBzZW5kQWxsKHRvQWNjb3VudCwgYW1vdW50cykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJzZW5kQWxsXCIsIHRvQWNjb3VudCwgYW1vdW50cyk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShoZWxwZXIub3duZWQoKSkuZXhlY3V0ZUVuY29kZWRUeChbXG4gICAgICAgICAgICAgICAgQW55LnRvSlNPTihcbiAgICAgICAgICAgICAgICAgIE1zZ1NlbmQudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICAgIGZyb21BZGRyZXNzOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgIHRvQWRkcmVzczogdG9BY2NvdW50LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGFtb3VudHMubWFwKCh4KSA9PiBoZWxwZXIuYW1vdW50VG9Db2luKHgpKVxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB0cmFuc2ZlcihkZXN0aW5hdGlvbiwgYW1vdW50LCBvcHRzKSB7XG4gICAgICAgICAgdHJhY2UzKFwidHJhbnNmZXJcIiwgZGVzdGluYXRpb24sIGFtb3VudCwgb3B0cyk7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvc21vc0Rlc3QgPSBjaGFpbkh1Yi5jb2VyY2VDb3Ntb3NBZGRyZXNzKGRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIGNvbnN0IHsgaGVscGVyIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IHRva2VuMiA9IGhlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KTtcbiAgICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb25JbmZvViA9IHdhdGNoKFxuICAgICAgICAgICAgICBjaGFpbkh1Yi5nZXRDb25uZWN0aW9uSW5mbyhcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXRlLmNoYWluQWRkcmVzcy5jaGFpbklkLFxuICAgICAgICAgICAgICAgIGNvc21vc0Rlc3QuY2hhaW5JZFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgdGltZW91dFRpbWVzdGFtcFZvd09yVmFsdWUgPSBvcHRzPy50aW1lb3V0VGltZXN0YW1wID8/IChvcHRzPy50aW1lb3V0SGVpZ2h0ID8gMG4gOiBFKHRpbWVzdGFtcEhlbHBlcikuZ2V0VGltZW91dFRpbWVzdGFtcE5TKCkpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICBhbGxWb3dzKFtjb25uZWN0aW9uSW5mb1YsIHRpbWVvdXRUaW1lc3RhbXBWb3dPclZhbHVlXSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnRyYW5zZmVyV2F0Y2hlcixcbiAgICAgICAgICAgICAgeyBvcHRzLCB0b2tlbjogdG9rZW4yLCBkZXN0aW5hdGlvbjogY29zbW9zRGVzdCB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdHJhbnNmZXJTdGVwcyhhbW91bnQsIG1zZykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwidHJhbnNmZXJTdGVwcyBnb3RcIiwgYW1vdW50LCBtc2cpO1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB0aHJvd1JlZGFjdGVkYG5vdCB5ZXQgaW1wbGVtZW50ZWRgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHdpdGhkcmF3UmV3YXJkcygpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4gdGhyb3dSZWRhY3RlZGBOb3QgSW1wbGVtZW50ZWQuIFRyeSB1c2luZyB3aXRoZHJhd1Jld2FyZC5gKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICB1bmRlbGVnYXRlKGRlbGVnYXRpb25zKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcInVuZGVsZWdhdGVcIiwgZGVsZWdhdGlvbnMpO1xuICAgICAgICAgICAgY29uc3QgeyBoZWxwZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBkZWxlZ2F0aW9ucy5ldmVyeShcbiAgICAgICAgICAgICAgKGQpID0+IGQuZGVsZWdhdG9yID8gZC5kZWxlZ2F0b3IudmFsdWUgPT09IGNoYWluQWRkcmVzcy52YWx1ZSA6IHRydWVcbiAgICAgICAgICAgICkgfHwgdGhyb3dSZWRhY3RlZGBTb21lIGRlbGVnYXRpb24gcmVjb3JkIGlzIGZvciBhbm90aGVyIGRlbGVnYXRvcmA7XG4gICAgICAgICAgICBjb25zdCB1bmRlbGVnYXRlViA9IHdhdGNoKFxuICAgICAgICAgICAgICBFKGhlbHBlci5vd25lZCgpKS5leGVjdXRlRW5jb2RlZFR4KFxuICAgICAgICAgICAgICAgIGRlbGVnYXRpb25zLm1hcChcbiAgICAgICAgICAgICAgICAgICh7IHZhbGlkYXRvciwgYW1vdW50IH0pID0+IEFueS50b0pTT04oXG4gICAgICAgICAgICAgICAgICAgIE1zZ1VuZGVsZWdhdGUudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcmVzczogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRvckFkZHJlc3M6IHZhbGlkYXRvci52YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IGNvZXJjZUNvaW4oY2hhaW5IdWIsIGFtb3VudClcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnVuZGVsZWdhdGVXYXRjaGVyXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHVuZGVsZWdhdGVWLCB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGRlYWN0aXZhdGUoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHdhdGNoKEUodGhpcy5mYWNldHMuaGVscGVyLm93bmVkKCkpLmRlYWN0aXZhdGUoKSkpO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICByZWFjdGl2YXRlKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB3YXRjaChFKHRoaXMuZmFjZXRzLmhlbHBlci5vd25lZCgpKS5yZWFjdGl2YXRlKCkpKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXREZWxlZ2F0aW9uKHZhbGlkYXRvcikge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJnZXREZWxlZ2F0aW9uXCIsIHZhbGlkYXRvcik7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5RGVsZWdhdGlvblJlcXVlc3QudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyOiB2YWxpZGF0b3IudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy5kZWxlZ2F0aW9uUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0RGVsZWdhdGlvbnMoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImdldERlbGVnYXRpb25zXCIpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeURlbGVnYXRvckRlbGVnYXRpb25zUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHI6IGNoYWluQWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLmRlbGVnYXRpb25zUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRVbmJvbmRpbmdEZWxlZ2F0aW9uKHZhbGlkYXRvcikge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJnZXRVbmJvbmRpbmdEZWxlZ2F0aW9uXCIsIHZhbGlkYXRvcik7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcywgaWNxQ29ubmVjdGlvbiB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGlmICghaWNxQ29ubmVjdGlvbikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYFF1ZXJpZXMgbm90IGF2YWlsYWJsZSBmb3IgY2hhaW4gJHtxdW90ZShjaGFpbkFkZHJlc3MuY2hhaW5JZCl9YDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KFtcbiAgICAgICAgICAgICAgdG9SZXF1ZXN0UXVlcnlKc29uKFxuICAgICAgICAgICAgICAgIFF1ZXJ5VW5ib25kaW5nRGVsZWdhdGlvblJlcXVlc3QudG9Qcm90b01zZyh7XG4gICAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgICAgICB2YWxpZGF0b3JBZGRyOiB2YWxpZGF0b3IudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRzLCB0aGlzLmZhY2V0cy51bmJvbmRpbmdEZWxlZ2F0aW9uUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0VW5ib25kaW5nRGVsZWdhdGlvbnMoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImdldFVuYm9uZGluZ0RlbGVnYXRpb25zXCIpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeURlbGVnYXRvclVuYm9uZGluZ0RlbGVnYXRpb25zUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHI6IGNoYWluQWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLnVuYm9uZGluZ0RlbGVnYXRpb25zUXVlcnlXYXRjaGVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRSZWRlbGVnYXRpb25zKCkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJnZXRSZWRlbGVnYXRpb25zXCIpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeVJlZGVsZWdhdGlvbnNSZXF1ZXN0LnRvUHJvdG9Nc2coe1xuICAgICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcjogY2hhaW5BZGRyZXNzLnZhbHVlLFxuICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgIGRzdFZhbGlkYXRvckFkZHI6IFwiXCIsXG4gICAgICAgICAgICAgICAgICBzcmNWYWxpZGF0b3JBZGRyOiBcIlwiXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2gocmVzdWx0cywgdGhpcy5mYWNldHMucmVkZWxlZ2F0aW9uc1F1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRSZXdhcmQodmFsaWRhdG9yKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlMyhcImdldFJld2FyZFwiLCB2YWxpZGF0b3IpO1xuICAgICAgICAgICAgY29uc3QgeyBjaGFpbkFkZHJlc3MsIGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBpZiAoIWljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5BZGRyZXNzLmNoYWluSWQpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gRShpY3FDb25uZWN0aW9uKS5xdWVyeShbXG4gICAgICAgICAgICAgIHRvUmVxdWVzdFF1ZXJ5SnNvbihcbiAgICAgICAgICAgICAgICBRdWVyeURlbGVnYXRpb25SZXdhcmRzUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIHZhbGlkYXRvckFkZHJlc3M6IHZhbGlkYXRvci52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLnJld2FyZFF1ZXJ5V2F0Y2hlcik7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0UmV3YXJkcygpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgdHJhY2UzKFwiZ2V0UmV3YXJkc1wiKTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2hhaW5BZGRyZXNzLCBpY3FDb25uZWN0aW9uIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCFpY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgUXVlcmllcyBub3QgYXZhaWxhYmxlIGZvciBjaGFpbiAke3F1b3RlKGNoYWluQWRkcmVzcy5jaGFpbklkKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcmVzdWx0cyA9IEUoaWNxQ29ubmVjdGlvbikucXVlcnkoW1xuICAgICAgICAgICAgICB0b1JlcXVlc3RRdWVyeUpzb24oXG4gICAgICAgICAgICAgICAgUXVlcnlEZWxlZ2F0aW9uVG90YWxSZXdhcmRzUmVxdWVzdC50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgIGRlbGVnYXRvckFkZHJlc3M6IGNoYWluQWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHJlc3VsdHMsIHRoaXMuZmFjZXRzLnJld2FyZHNRdWVyeVdhdGNoZXIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBleGVjdXRlRW5jb2RlZFR4KG1zZ3MsIG9wdHMpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coXG4gICAgICAgICAgICAoKSA9PiB3YXRjaChFKHRoaXMuZmFjZXRzLmhlbHBlci5vd25lZCgpKS5leGVjdXRlRW5jb2RlZFR4KG1zZ3MsIG9wdHMpKVxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cbiAgICAgICAgICovXG4gICAgICAgIGRlcG9zaXRGb3JCdXJuKGRlc3RpbmF0aW9uLCBhbW91bnQsIGNhbGxlcikge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTMoXCJkZXBvc2l0Rm9yQnVyblwiLCB7IGRlc3RpbmF0aW9uLCBhbW91bnQgfSk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICBjb25zdCB7IGNoYWluQWRkcmVzcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3RQYXJ0cyA9IHBhcnNlQWNjb3VudElkKGRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIGNvbnN0IGNoYWluSWQgPSBgJHtkZXN0UGFydHMubmFtZXNwYWNlfToke2Rlc3RQYXJ0cy5yZWZlcmVuY2V9YDtcbiAgICAgICAgICAgIGNvbnN0IHsgY2N0cERlc3RpbmF0aW9uRG9tYWluIH0gPSBjaGFpbkh1Yi5nZXRDaGFpbkluZm9CeUNoYWluSWQoY2hhaW5JZCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNjdHBEZXN0aW5hdGlvbkRvbWFpbiAhPT0gXCJudW1iZXJcIikge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYCR7cXVvdGUoY2hhaW5JZCl9IGRvZXMgbm90IGhhdmUgXCJjY3RwRGVzdGluYXRpb25Eb21haW5cIiBzZXQgaW4gQ2hhaW5JbmZvYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGRlcG9zaXRGb3JCdXJuID0ge1xuICAgICAgICAgICAgICBhbW91bnQ6IGhlbHBlci5hbW91bnRUb0NvaW4oYW1vdW50KT8uYW1vdW50LFxuICAgICAgICAgICAgICBmcm9tOiBjaGFpbkFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgIGRlc3RpbmF0aW9uRG9tYWluOiBjY3RwRGVzdGluYXRpb25Eb21haW4sXG4gICAgICAgICAgICAgIG1pbnRSZWNpcGllbnQ6IGFjY291bnRJZFRvMzJCeXRlcyhkZXN0aW5hdGlvbiksXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIGJ1cm5Ub2tlbjogXCJ1dXNkY1wiXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25DYWxsZXIgPSAoKCkgPT4ge1xuICAgICAgICAgICAgICBpZiAoIWNhbGxlcikgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgICAgICAgY29uc3QgY2FsbGVyUGFydHMgPSBwYXJzZUFjY291bnRJZChjYWxsZXIpO1xuICAgICAgICAgICAgICBjYWxsZXJQYXJ0cy5uYW1lc3BhY2UgPT09IGRlc3RQYXJ0cy5uYW1lc3BhY2UgfHwgdGhyb3dSZWRhY3RlZGBjYWxsZXIgJHtxdW90ZShjYWxsZXIpfSBtdXN0IGJlIGluIHNhbWUgbmFtZXNwYWNlIGFzIGRlc3RpbmF0aW9uICR7cXVvdGUoZGVzdGluYXRpb24pfWA7XG4gICAgICAgICAgICAgIHJldHVybiBhY2NvdW50SWRUbzMyQnl0ZXMoY2FsbGVyKTtcbiAgICAgICAgICAgIH0pKCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUoaGVscGVyLm93bmVkKCkpLmV4ZWN1dGVFbmNvZGVkVHgoW1xuICAgICAgICAgICAgICAgIEFueS50b0pTT04oXG4gICAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbkNhbGxlciA/IE1zZ0RlcG9zaXRGb3JCdXJuV2l0aENhbGxlci50b1Byb3RvTXNnKHtcbiAgICAgICAgICAgICAgICAgICAgLi4uZGVwb3NpdEZvckJ1cm4sXG4gICAgICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uQ2FsbGVyXG4gICAgICAgICAgICAgICAgICB9KSA6IE1zZ0RlcG9zaXRGb3JCdXJuLnRvUHJvdG9Nc2coZGVwb3NpdEZvckJ1cm4pXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnRLaXQ7XG59O1xudmFyIHByZXBhcmVDb3Ntb3NPcmNoZXN0cmF0aW9uQWNjb3VudCA9ICh6b25lLCB7IGNoYWluSHViLCBtYWtlUmVjb3JkZXJLaXQsIHRpbWVyU2VydmljZSwgdm93VG9vbHMsIHpjZiB9KSA9PiB7XG4gIGNvbnN0IG1ha2VLaXQgPSBwcmVwYXJlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnRLaXQoem9uZSwge1xuICAgIGNoYWluSHViLFxuICAgIG1ha2VSZWNvcmRlcktpdCxcbiAgICB0aW1lclNlcnZpY2UsXG4gICAgdm93VG9vbHMsXG4gICAgemNmXG4gIH0pO1xuICByZXR1cm4gKC4uLmFyZ3MpID0+IG1ha2VLaXQoLi4uYXJncykuaG9sZGVyO1xufTtcblxuLy9cbnZhciBwcmVwYXJlTG9jYWxDaGFpbkZhY2FkZUtpdCA9ICh6b25lLCB7XG4gIG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0LFxuICBhZ29yaWNOYW1lcyxcbiAgbG9jYWxjaGFpbixcbiAgLy9cbiAgLy9cbiAgc3RvcmFnZU5vZGUsXG4gIHZvd1Rvb2xzOiB7IGFsbFZvd3MsIHdhdGNoLCBhc1ZvdyB9XG59KSA9PiB6b25lLmV4b0NsYXNzS2l0KFxuICBcIkxvY2FsQ2hhaW5GYWNhZGVcIixcbiAge1xuICAgIHB1YmxpYzogTS5pbnRlcmZhY2UoXCJMb2NhbENoYWluRmFjYWRlXCIsIHtcbiAgICAgIC4uLmNoYWluRmFjYWRlTWV0aG9kcyxcbiAgICAgIHF1ZXJ5OiBNLmNhbGwoTS5hcnJheU9mKFR5cGVkSnNvblNoYXBlKSkucmV0dXJucyhWb3dTaGFwZSksXG4gICAgICBnZXRWQmFua0Fzc2V0SW5mbzogTS5jYWxsKCkub3B0aW9uYWwoTS5ib29sZWFuKCkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgfSksXG4gICAgdmJhbmtBc3NldFZhbHVlc1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwidmJhbmtBc3NldFZhbHVlc1dhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLm9wdGlvbmFsKE0uYXJyYXlPZihNLnVuZGVmaW5lZCgpKSkucmV0dXJucyhWb3dTaGFwZSlcbiAgICB9KSxcbiAgICBtYWtlQWNjb3VudFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwibWFrZUFjY291bnRXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoW00ucmVtb3RhYmxlKFwiTENBIEFjY291bnRcIiksIE0uc3RyaW5nKCldKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgfSksXG4gICAgbWFrZUNoaWxkTm9kZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwibWFrZUNoaWxkTm9kZVdhdGNoZXJcIiwge1xuICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLm9yKE0ucmVtb3RhYmxlKCksIE0udW5kZWZpbmVkKCkpKS5vcHRpb25hbCh7IGFjY291bnQ6IE0ucmVtb3RhYmxlKCksIGFkZHJlc3M6IE0uc3RyaW5nKCkgfSkucmV0dXJucyhNLnJlbW90YWJsZSgpKVxuICAgIH0pXG4gIH0sXG4gIC8qXG5cbiAgICovXG4gIChsb2NhbENoYWluSW5mbykgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBsb2NhbENoYWluSW5mbyxcbiAgICAgIHZiYW5rQXNzZXRzOiAoXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHZvaWQgMFxuICAgICAgKVxuICAgIH07XG4gIH0sXG4gIHtcbiAgICBwdWJsaWM6IHtcbiAgICAgIGdldENoYWluSW5mbygpIHtcbiAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuc3RhdGUubG9jYWxDaGFpbkluZm8pO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIG1ha2VBY2NvdW50KCkge1xuICAgICAgICBjb25zdCBsY2FQID0gRShsb2NhbGNoYWluKS5tYWtlQWNjb3VudCgpO1xuICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgLy9cbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vXG4gICAgICAgICAgYWxsVm93cyhbbGNhUCwgaGVhcFZvd0UobGNhUCkuZ2V0QWRkcmVzcygpXSksXG4gICAgICAgICAgdGhpcy5mYWNldHMubWFrZUFjY291bnRXYXRjaGVyXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIHF1ZXJ5KHJlcXVlc3RzKSB7XG4gICAgICAgIHJldHVybiB3YXRjaChFKGxvY2FsY2hhaW4pLnF1ZXJ5TWFueShyZXF1ZXN0cykpO1xuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBnZXRWQmFua0Fzc2V0SW5mbygpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBjb25zdCB7IHZiYW5rQXNzZXRzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICh2YmFua0Fzc2V0cykge1xuICAgICAgICAgICAgcmV0dXJuIHZiYW5rQXNzZXRzO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB2YmFua0Fzc2V0TmFtZUh1YlAgPSBFKGFnb3JpY05hbWVzKS5sb29rdXAoXCJ2YmFua0Fzc2V0XCIpO1xuICAgICAgICAgIGNvbnN0IHZiYW5rQXNzZXRWYWx1ZXNQID0gRSh2YmFua0Fzc2V0TmFtZUh1YlApLnZhbHVlcygpO1xuICAgICAgICAgIGNvbnN0IHsgdmJhbmtBc3NldFZhbHVlc1dhdGNoZXIgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIHJldHVybiB3YXRjaCh2YmFua0Fzc2V0VmFsdWVzUCwgdmJhbmtBc3NldFZhbHVlc1dhdGNoZXIpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHZiYW5rQXNzZXRWYWx1ZXNXYXRjaGVyOiB7XG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKGFzc2V0cykge1xuICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgIHN0YXRlLnZiYW5rQXNzZXRzID0gYXNzZXRzO1xuICAgICAgICAgIHJldHVybiBhc3NldHM7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUFjY291bnRXYXRjaGVyOiB7XG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKFthY2NvdW50LCBhZGRyZXNzXSkge1xuICAgICAgICBjb25zdCBvcHRpb25hbFN0b3JhZ2VOb2RlID0gc3RvcmFnZU5vZGUgPyBFKHN0b3JhZ2VOb2RlKS5tYWtlQ2hpbGROb2RlKGFkZHJlc3MpIDogdm9pZCAwO1xuICAgICAgICByZXR1cm4gd2F0Y2gob3B0aW9uYWxTdG9yYWdlTm9kZSwgdGhpcy5mYWNldHMubWFrZUNoaWxkTm9kZVdhdGNoZXIsIHtcbiAgICAgICAgICBhY2NvdW50LFxuICAgICAgICAgIGFkZHJlc3NcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtYWtlQ2hpbGROb2RlV2F0Y2hlcjoge1xuICAgICAgLypcblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKGNoaWxkTm9kZSwgeyBhY2NvdW50LCBhZGRyZXNzIH0pIHtcbiAgICAgICAgY29uc3QgeyBsb2NhbENoYWluSW5mbyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgY29uc3QgeyBob2xkZXIgfSA9IG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0KHtcbiAgICAgICAgICBhY2NvdW50LFxuICAgICAgICAgIGFkZHJlc3M6IGhhcmRlbih7XG4gICAgICAgICAgICB2YWx1ZTogYWRkcmVzcyxcbiAgICAgICAgICAgIGVuY29kaW5nOiBcImJlY2gzMlwiLFxuICAgICAgICAgICAgY2hhaW5JZDogbG9jYWxDaGFpbkluZm8uY2hhaW5JZFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIC8vXG4gICAgICAgICAgc3RvcmFnZU5vZGU6IGNoaWxkTm9kZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGhvbGRlcjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG5oYXJkZW4ocHJlcGFyZUxvY2FsQ2hhaW5GYWNhZGVLaXQpO1xudmFyIHByZXBhcmVMb2NhbENoYWluRmFjYWRlID0gKHpvbmUsIHBvd2VycykgPT4ge1xuICBjb25zdCBtYWtlTG9jYWxDaGFpbkZhY2FkZUtpdCA9IHByZXBhcmVMb2NhbENoYWluRmFjYWRlS2l0KHpvbmUsIHBvd2Vycyk7XG4gIHJldHVybiBwaWNrRmFjZXQobWFrZUxvY2FsQ2hhaW5GYWNhZGVLaXQsIFwicHVibGljXCIpO1xufTtcbmhhcmRlbihwcmVwYXJlTG9jYWxDaGFpbkZhY2FkZSk7XG5cbi8vXG52YXIgdHJhY2U0ID0gbWFrZVRyYWNlcihcIlBhY2tldFRvb2xzXCIpO1xudmFyIHsgdG9DYXBEYXRhIH0gPSBtYWtlTWFyc2hhbCh2b2lkIDAsIHZvaWQgMCwge1xuICBtYXJzaGFsTmFtZTogXCJKdXN0RW5jb2RlclwiLFxuICBzZXJpYWxpemVCb2R5Rm9ybWF0OiBcImNhcGRhdGFcIlxufSk7XG52YXIganVzdCA9IChvYmopID0+IHtcbiAgY29uc3QgeyBib2R5IH0gPSB0b0NhcERhdGEob2JqKTtcbiAgcmV0dXJuIGRlY29kZVRvSnVzdGluKEpTT04ucGFyc2UoYm9keSksIHRydWUpO1xufTtcbnZhciB7IFZvdyQ6IFZvdyQ0IH0gPSBTaGFwZTtcbnZhciBFVm93JCA9IChzaGFwZSkgPT4gTS5vcihWb3ckNChzaGFwZSksIE0ucHJvbWlzZShcbiAgLyogICAgICAgKi9cbikpO1xudmFyIHNpbms1ID0gKCkgPT4ge1xufTtcbmhhcmRlbihzaW5rNSk7XG52YXIgcHJlcGFyZVBhY2tldFRvb2xzID0gKHpvbmUsIHZvd1Rvb2xzKSA9PiB7XG4gIGNvbnN0IHsgYWxsVm93cywgbWFrZVZvd0tpdCwgd2F0Y2gsIHdoZW4gfSA9IHZvd1Rvb2xzO1xuICBjb25zdCBtYWtlUGFja2V0VG9vbHNLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiUGFja2V0VG9vbHNLaXRcIixcbiAgICB7XG4gICAgICBwdWJsaWM6IE0uaW50ZXJmYWNlKFwiUGFja2V0VG9vbHNcIiwge1xuICAgICAgICBzZW5kVGhlbldhaXRGb3JBY2s6IE0uY2FsbChFVm93JChNLnJlbW90YWJsZShcIlBhY2tldFNlbmRlclwiKSkpLm9wdGlvbmFsKE0uYW55KCkpLnJldHVybnMoRVZvdyQoTS5hbnkoKSkpLFxuICAgICAgICBtYXRjaEZpcnN0UGFja2V0OiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucyhFVm93JChNLmFueSgpKSksXG4gICAgICAgIG1vbml0b3JUcmFuc2ZlcnM6IE0uY2FsbChNLnJlbW90YWJsZShcIlRhcmdldEFwcFwiKSkucmV0dXJucyhcbiAgICAgICAgICBFVm93JChNLmFueSgpKVxuICAgICAgICApXG4gICAgICB9KSxcbiAgICAgIHRhcDogTS5pbnRlcmZhY2UoXCJ0YXBcIiwge1xuICAgICAgICAvL1xuICAgICAgICByZWNlaXZlVXBjYWxsOiBNLmNhbGxXaGVuKE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgbW9uaXRvclJlZ2lzdHJhdGlvbjogTS5pbnRlcmZhY2UoXCJtb25pdG9yUmVnaXN0cmF0aW9uXCIsIHtcbiAgICAgICAgLy9cbiAgICAgICAgdXBkYXRlVGFyZ2V0QXBwOiBNLmNhbGxXaGVuKFxuICAgICAgICAgIE0uYXdhaXQoTS5yZW1vdGFibGUoXCJUYXJnZXRBcHBcIikpXG4gICAgICAgICkucmV0dXJucygpLFxuICAgICAgICAvL1xuICAgICAgICByZXZva2U6IE0uY2FsbFdoZW4oKS5yZXR1cm5zKClcbiAgICAgIH0pLFxuICAgICAgd2F0Y2hQYWNrZXRNYXRjaDogTS5pbnRlcmZhY2UoXCJ3YXRjaFBhY2tldE1hdGNoXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpLCBNLnJlY29yZCgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHdhdGNoUGFja2V0UGF0dGVybjogTS5pbnRlcmZhY2UoXCJ3YXRjaFBhY2tldFBhdHRlcm5cIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCksIE0ucmVjb3JkKCkpLnJldHVybnMoTS5hbnkoKSksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpLCBNLnJlY29yZCgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHdhdGNoRGVjclBlbmRpbmdQYXR0ZXJuczogTS5pbnRlcmZhY2UoXCJ3YXRjaERlY3JQZW5kaW5nUGF0dGVybnNcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoTS5hbnkoKSksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHNlbmRQYWNrZXRXYXRjaGVyOiBNLmludGVyZmFjZShcInNlbmRQYWNrZXRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChcbiAgICAgICAgICBbTS5yZWNvcmQoKSwgTS5yZW1vdGFibGUoXCJQYWNrZXRTZW5kZXJcIildLFxuICAgICAgICAgIE0ucmVjb3JkKClcbiAgICAgICAgKS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KSxcbiAgICAgIHBhY2tldFdhc1NlbnRXYXRjaGVyOiBNLmludGVyZmFjZShcInBhY2tldFdhc1NlbnRXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChcbiAgICAgICAgICB7IGV2ZW50UGF0dGVybjogTS5wYXR0ZXJuKCksIHJlc3VsdFY6IFZvdyQ0KE0uYW55KCkpIH0sXG4gICAgICAgICAgTS5yZWNvcmQoKVxuICAgICAgICApLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgdXRpbHM6IE0uaW50ZXJmYWNlKFwidXRpbHNcIiwge1xuICAgICAgICBzdWJzY3JpYmVUb1RyYW5zZmVyczogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIHVuc3Vic2NyaWJlRnJvbVRyYW5zZmVyczogTS5jYWxsKCkucmV0dXJucyhNLnVuZGVmaW5lZCgpKSxcbiAgICAgICAgaW5jclBlbmRpbmdQYXR0ZXJuczogTS5jYWxsKCkucmV0dXJucyhWb3ckNChNLnVuZGVmaW5lZCgpKSksXG4gICAgICAgIGRlY3JQZW5kaW5nUGF0dGVybnM6IE0uY2FsbCgpLnJldHVybnMoVm93JDQoTS51bmRlZmluZWQoKSkpXG4gICAgICB9KSxcbiAgICAgIHJlamVjdFJlc29sdmVyQW5kUmV0aHJvd1dhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmVqZWN0UmVzb2x2ZXJXYXRjaGVyXCIsIHtcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uYW55KCksIHtcbiAgICAgICAgICByZXNvbHZlcjogTS5yZW1vdGFibGUoXCJyZXNvbHZlclwiKVxuICAgICAgICB9KS5yZXR1cm5zKE0uYW55KCkpXG4gICAgICB9KVxuICAgIH0sXG4gICAgLypcblxuICAgICAqL1xuICAgIChsY2EpID0+IHtcbiAgICAgIGNvbnN0IHJlc29sdmVyVG9QYXR0ZXJuID0gem9uZS5kZXRhY2hlZCgpLm1hcFN0b3JlKFwicmVzb2x2ZXJUb1BhdHRlcm5cIik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsY2EsXG4gICAgICAgIHJlZzogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG51bGxcbiAgICAgICAgKSxcbiAgICAgICAgcmVzb2x2ZXJUb1BhdHRlcm4sXG4gICAgICAgIHVwY2FsbFF1ZXVlOiAoXG4gICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgbnVsbFxuICAgICAgICApLFxuICAgICAgICBwZW5kaW5nOiAwLFxuICAgICAgICBleHRyYTogbnVsbCxcbiAgICAgICAgbW9uaXRvcjogKFxuICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgIG51bGxcbiAgICAgICAgKVxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIHB1YmxpYzoge1xuICAgICAgICAvKlxuXG4gICAgICAgICAqL1xuICAgICAgICAvL1xuICAgICAgICBhc3luYyBtb25pdG9yVHJhbnNmZXJzKG1vbml0b3IpIHtcbiAgICAgICAgICBjb25zdCBtcmVnID0gdGhpcy5mYWNldHMubW9uaXRvclJlZ2lzdHJhdGlvbjtcbiAgICAgICAgICBhd2FpdCBtcmVnLnVwZGF0ZVRhcmdldEFwcChtb25pdG9yKTtcbiAgICAgICAgICByZXR1cm4gbXJlZztcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgbWF0Y2hGaXJzdFBhY2tldChwYXR0ZXJuUCkge1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnV0aWxzLmluY3JQZW5kaW5nUGF0dGVybnMoKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLndhdGNoUGFja2V0TWF0Y2gsXG4gICAgICAgICAgICB7IHBhdHRlcm5QIH1cbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgc2VuZFRoZW5XYWl0Rm9yQWNrKHBhY2tldFNlbmRlciwgb3B0cyA9IHt9KSB7XG4gICAgICAgICAgY29uc3QgcGF0dGVybiA9IG1ha2VWb3dLaXQoKTtcbiAgICAgICAgICBjb25zdCBtYXRjaFYgPSB3YXRjaChcbiAgICAgICAgICAgIGFsbFZvd3MoW1xuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5wdWJsaWMubWF0Y2hGaXJzdFBhY2tldChwYXR0ZXJuLnZvdyksXG4gICAgICAgICAgICAgIHBhY2tldFNlbmRlclxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5zZW5kUGFja2V0V2F0Y2hlcixcbiAgICAgICAgICAgIHsgb3B0cyB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCByZXN1bHRWID0gd2F0Y2gobWF0Y2hWLCB0aGlzLmZhY2V0cy5wYWNrZXRXYXNTZW50V2F0Y2hlciwge1xuICAgICAgICAgICAgb3B0cyxcbiAgICAgICAgICAgIHBhdHRlcm5SZXNvbHZlcjogcGF0dGVybi5yZXNvbHZlclxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiB3YXRjaChyZXN1bHRWLCB0aGlzLmZhY2V0cy5yZWplY3RSZXNvbHZlckFuZFJldGhyb3dXYXRjaGVyLCB7XG4gICAgICAgICAgICByZXNvbHZlcjogcGF0dGVybi5yZXNvbHZlclxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgbW9uaXRvclJlZ2lzdHJhdGlvbjoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIC8vXG4gICAgICAgIGFzeW5jIHVwZGF0ZVRhcmdldEFwcCh0YXApIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLm1vbml0b3IgPSBhd2FpdCB0YXA7XG4gICAgICAgICAgYXdhaXQgdGhpcy5mYWNldHMudXRpbHMuc3Vic2NyaWJlVG9UcmFuc2ZlcnMoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAvL1xuICAgICAgICBhc3luYyByZXZva2UoKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5tb25pdG9yID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRhcDoge1xuICAgICAgICAvL1xuICAgICAgICBhc3luYyByZWNlaXZlVXBjYWxsKG9iaikge1xuICAgICAgICAgIGNvbnN0IHsgbW9uaXRvciwgcmVzb2x2ZXJUb1BhdHRlcm4sIHVwY2FsbFF1ZXVlLCBwZW5kaW5nIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHRyYWNlNChcbiAgICAgICAgICAgIGBUcnlpbmcgJHtyZXNvbHZlclRvUGF0dGVybi5nZXRTaXplKCl9IGN1cnJlbnQgcGF0dGVybnMgYW5kICR7cGVuZGluZ30gcGVuZGluZyBwYXR0ZXJucyBhZ2FpbnN0YCxcbiAgICAgICAgICAgIGp1c3Qob2JqKVxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKG1vbml0b3IpIHtcbiAgICAgICAgICAgIHZvaWQgRShtb25pdG9yKS5yZWNlaXZlVXBjYWxsKG9iaik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAoY29uc3QgW3Jlc29sdmVyLCBwYXR0ZXJuXSBvZiByZXNvbHZlclRvUGF0dGVybi5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGlmIChtYXRjaGVzKG9iaiwgcGF0dGVybikpIHtcbiAgICAgICAgICAgICAgdHJhY2U0KFwiTWF0Y2hlZCBwYXR0ZXJuOlwiLCBqdXN0KHBhdHRlcm4pKTtcbiAgICAgICAgICAgICAgcmVzb2x2ZXIucmVzb2x2ZShvYmopO1xuICAgICAgICAgICAgICByZXNvbHZlclRvUGF0dGVybi5kZWxldGUocmVzb2x2ZXIpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh1cGNhbGxRdWV1ZSkge1xuICAgICAgICAgICAgdHJhY2U0KFwiU3Rhc2hpbmcgb2JqZWN0IGluIHVwY2FsbFF1ZXVlXCIpO1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS51cGNhbGxRdWV1ZSA9IGhhcmRlbih1cGNhbGxRdWV1ZS5jb25jYXQob2JqKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRyYWNlNChcIk5vIG1hdGNoIHlldC5cIik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzZW5kUGFja2V0V2F0Y2hlcjoge1xuICAgICAgICBvbkZ1bGZpbGxlZChbeyBtYXRjaCB9LCBzZW5kZXJdLCBjdHgpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goRShzZW5kZXIpLnNlbmRQYWNrZXQobWF0Y2gsIGN0eC5vcHRzKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBwYWNrZXRXYXNTZW50V2F0Y2hlcjoge1xuICAgICAgICBvbkZ1bGZpbGxlZCh7IGV2ZW50UGF0dGVybiwgcmVzdWx0ViB9LCBjdHgpIHtcbiAgICAgICAgICBjb25zdCB7IHBhdHRlcm5SZXNvbHZlciB9ID0gY3R4O1xuICAgICAgICAgIHBhdHRlcm5SZXNvbHZlci5yZXNvbHZlKGV2ZW50UGF0dGVybik7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdFY7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZWplY3RSZXNvbHZlckFuZFJldGhyb3dXYXRjaGVyOiB7XG4gICAgICAgIG9uUmVqZWN0ZWQocmVqLCB7IHJlc29sdmVyIH0pIHtcbiAgICAgICAgICByZXNvbHZlci5yZWplY3QocmVqKTtcbiAgICAgICAgICB0aHJvdyByZWo7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3YXRjaFBhY2tldE1hdGNoOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKF8sIHsgcGF0dGVyblAgfSkge1xuICAgICAgICAgIGNvbnN0IHsgdm93LCByZXNvbHZlciB9ID0gbWFrZVZvd0tpdCgpO1xuICAgICAgICAgIGNvbnN0IHBhdHRlcm5WID0gd2F0Y2goXG4gICAgICAgICAgICBwYXR0ZXJuUCxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLndhdGNoUGFja2V0UGF0dGVybixcbiAgICAgICAgICAgIGhhcmRlbih7IHJlc29sdmVyIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgICB3YXRjaChwYXR0ZXJuViwgdGhpcy5mYWNldHMud2F0Y2hEZWNyUGVuZGluZ1BhdHRlcm5zKTtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgbWF0Y2g6IHZvdywgcmVzb2x2ZXIgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3YXRjaERlY3JQZW5kaW5nUGF0dGVybnM6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmFjZXRzLnV0aWxzLmRlY3JQZW5kaW5nUGF0dGVybnMoKTtcbiAgICAgICAgfSxcbiAgICAgICAgb25SZWplY3RlZCgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5mYWNldHMudXRpbHMuZGVjclBlbmRpbmdQYXR0ZXJucygpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2F0Y2hQYWNrZXRQYXR0ZXJuOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKHBhdHRlcm4sIHsgcmVzb2x2ZXIgfSkge1xuICAgICAgICAgIGNvbnN0IHsgcmVzb2x2ZXJUb1BhdHRlcm4sIHVwY2FsbFF1ZXVlIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHRyYWNlNChcIndhdGNoUGFja2V0UGF0dGVybiBvbkZ1bGZpbGxlZFwiLCBqdXN0KHBhdHRlcm4pKTtcbiAgICAgICAgICBpZiAoIXVwY2FsbFF1ZXVlKSB7XG4gICAgICAgICAgICB0cmFjZTQoXCJObyB1cGNhbGwgcXVldWUgeWV0LiAgU2F2ZSB0aGUgcGF0dGVybiBmb3IgbGF0ZXIuXCIpO1xuICAgICAgICAgICAgcmVzb2x2ZXJUb1BhdHRlcm4uaW5pdChyZXNvbHZlciwgcGF0dGVybik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGkyID0gdXBjYWxsUXVldWUuZmluZEluZGV4KChvYmopID0+IG1hdGNoZXMob2JqLCBwYXR0ZXJuKSk7XG4gICAgICAgICAgaWYgKGkyIDwgMCkge1xuICAgICAgICAgICAgdHJhY2U0KFwiTm8gbWF0Y2ggeWV0LiBTYXZlIHRoZSBwYXR0ZXJuIGZvciBsYXRlci5cIik7XG4gICAgICAgICAgICByZXNvbHZlclRvUGF0dGVybi5pbml0KHJlc29sdmVyLCBwYXR0ZXJuKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdHJhY2U0KFxuICAgICAgICAgICAgXCJTdWNjZXNzISBSZW1vdmUgdGhlIG1hdGNoZWQgb2JqZWN0IGZyb20gdGhlIHF1ZXVlLlwiLFxuICAgICAgICAgICAganVzdCh1cGNhbGxRdWV1ZVtpMl0pXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXNvbHZlci5yZXNvbHZlKHVwY2FsbFF1ZXVlW2kyXSk7XG4gICAgICAgICAgdGhpcy5zdGF0ZS51cGNhbGxRdWV1ZSA9IGhhcmRlbihcbiAgICAgICAgICAgIHVwY2FsbFF1ZXVlLnNsaWNlKDAsIGkyKS5jb25jYXQodXBjYWxsUXVldWUuc2xpY2UoaTIgKyAxKSlcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgeyByZXNvbHZlciB9KSB7XG4gICAgICAgICAgcmVzb2x2ZXIucmVqZWN0KHJlYXNvbik7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB1dGlsczoge1xuICAgICAgICBpbmNyUGVuZGluZ1BhdHRlcm5zKCkge1xuICAgICAgICAgIGNvbnN0IHsgcGVuZGluZywgcmVnLCB1cGNhbGxRdWV1ZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB0aGlzLnN0YXRlLnBlbmRpbmcgKz0gMTtcbiAgICAgICAgICBpZiAoIXVwY2FsbFF1ZXVlKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnVwY2FsbFF1ZXVlID0gaGFyZGVuKFtdKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHJlZyB8fCBwZW5kaW5nID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHZvaWQgMCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy51dGlscy5zdWJzY3JpYmVUb1RyYW5zZmVycygpKTtcbiAgICAgICAgfSxcbiAgICAgICAgZGVjclBlbmRpbmdQYXR0ZXJucygpIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLnBlbmRpbmcgLT0gMTtcbiAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5wZW5kaW5nID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnN0YXRlLnBlbmRpbmcgPSAwO1xuICAgICAgICAgIHRoaXMuc3RhdGUudXBjYWxsUXVldWUgPSBudWxsO1xuICAgICAgICAgIHJldHVybiB3YXRjaCh0aGlzLmZhY2V0cy51dGlscy51bnN1YnNjcmliZUZyb21UcmFuc2ZlcnMoKSk7XG4gICAgICAgIH0sXG4gICAgICAgIHN1YnNjcmliZVRvVHJhbnNmZXJzKCkge1xuICAgICAgICAgIGNvbnN0IHsgbGNhLCByZWc6IGNhY2hlZFJlZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBpZiAoY2FjaGVkUmVnKSB7XG4gICAgICAgICAgICByZXR1cm4gd2hlbihjYWNoZWRSZWcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB7IHRhcCB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgcmVnID0gd2F0Y2goRShsY2EpLm1vbml0b3JUcmFuc2ZlcnModGFwKSk7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5yZWcgPSByZWc7XG4gICAgICAgICAgcmV0dXJuIHdoZW4ocmVnKTtcbiAgICAgICAgfSxcbiAgICAgICAgdW5zdWJzY3JpYmVGcm9tVHJhbnNmZXJzKCkge1xuICAgICAgICAgIGNvbnN0IHsgcmVnLCBtb25pdG9yIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmICghcmVnIHx8IG1vbml0b3IpIHtcbiAgICAgICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBmaW5pc2goY29udGV4dCkge1xuICAgICAgICB2b2lkIGNvbnRleHQuZmFjZXRzLnV0aWxzLnN1YnNjcmliZVRvVHJhbnNmZXJzKCk7XG4gICAgICB9XG4gICAgfVxuICApO1xuICBjb25zdCBtYWtlUGFja2V0VG9vbHMgPSBwaWNrRmFjZXQobWFrZVBhY2tldFRvb2xzS2l0LCBcInB1YmxpY1wiKTtcbiAgcmV0dXJuIG1ha2VQYWNrZXRUb29scztcbn07XG5oYXJkZW4ocHJlcGFyZVBhY2tldFRvb2xzKTtcblxuLy9cbnZhciBJQ1MyMF9UUkFOU0ZFUl9TVUNDRVNTX1JFU1VMVCA9IFwiQVE9PVwiO1xudmFyIHsgRmFpbDogRmFpbDYsIGJhcmU6IGJhcmUzIH0gPSBhc3NlcnQ7XG52YXIgeyBWb3ckOiBWb3ckNSB9ID0gU2hhcGU7XG52YXIgY3JlYXRlU2VxdWVuY2VQYXR0ZXJuID0gKHNlcXVlbmNlKSA9PiB7XG4gIGNvbnN0IHNlcXVlbmNlUGF0dGVybnMgPSBbXTtcbiAgdHJ5IHtcbiAgICBjb25zdCBiaW50U2VxdWVuY2UgPSBCaWdJbnQoc2VxdWVuY2UpO1xuICAgIGJpbnRTZXF1ZW5jZSA+IDBuICYmIHNlcXVlbmNlUGF0dGVybnMucHVzaChiaW50U2VxdWVuY2UpO1xuICB9IGNhdGNoIChlMikge1xuICB9XG4gIGNvbnN0IG51bVNlcXVlbmNlID0gTnVtYmVyKHNlcXVlbmNlKTtcbiAgbnVtU2VxdWVuY2UgPiAwICYmIE51bWJlci5pc1NhZmVJbnRlZ2VyKG51bVNlcXVlbmNlKSAmJiBzZXF1ZW5jZVBhdHRlcm5zLnB1c2gobnVtU2VxdWVuY2UpO1xuICBjb25zdCBzdHJTZXF1ZW5jZSA9IFN0cmluZyhzZXF1ZW5jZSk7XG4gIHN0clNlcXVlbmNlICYmIHNlcXVlbmNlUGF0dGVybnMucHVzaChzdHJTZXF1ZW5jZSk7XG4gIGlmICghc2VxdWVuY2VQYXR0ZXJucy5maW5kKChzZXEpID0+IHNlcSA9PT0gc2VxdWVuY2UpKSB7XG4gICAgc2VxdWVuY2VQYXR0ZXJucy5wdXNoKHNlcXVlbmNlKTtcbiAgfVxuICBzd2l0Y2ggKHNlcXVlbmNlUGF0dGVybnMubGVuZ3RoKSB7XG4gICAgY2FzZSAwOlxuICAgICAgdGhyb3cgRmFpbDZgc2VxdWVuY2UgJHtzZXF1ZW5jZX0gaXMgbm90IHZhbGlkYDtcbiAgICBjYXNlIDE6XG4gICAgICByZXR1cm4gc2VxdWVuY2VQYXR0ZXJuc1swXTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIE0ub3IoLi4uc2VxdWVuY2VQYXR0ZXJucyk7XG4gIH1cbn07XG5oYXJkZW4oY3JlYXRlU2VxdWVuY2VQYXR0ZXJuKTtcbnZhciBwcmVwYXJlSUJDVHJhbnNmZXJTZW5kZXIgPSAoem9uZSwgeyB3YXRjaCwgbWFrZUlCQ1JlcGx5S2l0IH0pID0+IHtcbiAgY29uc3QgbWFrZUlCQ1RyYW5zZmVyU2VuZGVyS2l0ID0gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIklCQ1RyYW5zZmVyU2VuZGVyS2l0XCIsXG4gICAge1xuICAgICAgcHVibGljOiBNLmludGVyZmFjZShcIklCQ1RyYW5zZmVyU2VuZGVyXCIsIHtcbiAgICAgICAgc2VuZFBhY2tldDogTS5jYWxsKFZvdyQ1KE0uYW55KCkpLCBNLmFueSgpKS5yZXR1cm5zKFZvdyQ1KE0ucmVjb3JkKCkpKVxuICAgICAgfSksXG4gICAgICByZXNwb25zZVdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmVzcG9uc2VXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbTS5yZWNvcmQoKV0sIE0ucmVjb3JkKCkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgdmVyaWZ5VHJhbnNmZXJTdWNjZXNzOiBNLmludGVyZmFjZShcInZlcmlmeVRyYW5zZmVyU3VjY2Vzc1wiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5hbnkoKSkucmV0dXJucygpXG4gICAgICB9KVxuICAgIH0sXG4gICAgLypcblxuXG5cblxuICAgICAqL1xuICAgICh0eEV4ZWN1dG9yLCB0cmFuc2Zlck1zZykgPT4gKHtcbiAgICAgIHR4RXhlY3V0b3IsXG4gICAgICB0cmFuc2Zlck1zZzogaGFyZGVuKHRyYW5zZmVyTXNnKVxuICAgIH0pLFxuICAgIHtcbiAgICAgIHB1YmxpYzoge1xuICAgICAgICBzZW5kUGFja2V0KG1hdGNoLCBvcHRzKSB7XG4gICAgICAgICAgY29uc3QgeyB0eEV4ZWN1dG9yLCB0cmFuc2Zlck1zZyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKHR4RXhlY3V0b3IpLmV4ZWN1dGVUeChbdHJhbnNmZXJNc2ddKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnJlc3BvbnNlV2F0Y2hlcixcbiAgICAgICAgICAgIHsgb3B0cywgbWF0Y2ggfVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXNwb25zZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoW3sgc2VxdWVuY2UgfV0sIGN0eCkge1xuICAgICAgICAgIGNvbnN0IHsgbWF0Y2ggfSA9IGN0eDtcbiAgICAgICAgICBjb25zdCB7IHRyYW5zZmVyTXNnIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGNvbnN0IHJlcGx5UGFja2V0UGF0dGVybiA9IE0uc3BsaXRSZWNvcmQoe1xuICAgICAgICAgICAgc291cmNlX3BvcnQ6IHRyYW5zZmVyTXNnLnNvdXJjZVBvcnQsXG4gICAgICAgICAgICBzb3VyY2VfY2hhbm5lbDogdHJhbnNmZXJNc2cuc291cmNlQ2hhbm5lbCxcbiAgICAgICAgICAgIHNlcXVlbmNlOiBjcmVhdGVTZXF1ZW5jZVBhdHRlcm4oc2VxdWVuY2UpXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3QgeyByZXN1bHRWOiBhY2tEYXRhViwgLi4ucmVzdCB9ID0gbWFrZUlCQ1JlcGx5S2l0KFxuICAgICAgICAgICAgcmVwbHlQYWNrZXRQYXR0ZXJuLFxuICAgICAgICAgICAgbWF0Y2gsXG4gICAgICAgICAgICBjdHhcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdFYgPSB3YXRjaChhY2tEYXRhViwgdGhpcy5mYWNldHMudmVyaWZ5VHJhbnNmZXJTdWNjZXNzKTtcbiAgICAgICAgICByZXR1cm4gaGFyZGVuKHsgcmVzdWx0ViwgLi4ucmVzdCB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHZlcmlmeVRyYW5zZmVyU3VjY2Vzczoge1xuICAgICAgICBvbkZ1bGZpbGxlZChhY2tEYXRhKSB7XG4gICAgICAgICAgbGV0IG9iajtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgb2JqID0gSlNPTi5wYXJzZShhY2tEYXRhKTtcbiAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIEZhaWw2YElDUzIwLTEgdHJhbnNmZXIgYWNrIGRhdGEgaXMgbm90IEpTT046ICR7YWNrRGF0YX1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCB7IHJlc3VsdCwgZXJyb3IgfSA9IG9iajtcbiAgICAgICAgICBlcnJvciA9PT0gdm9pZCAwIHx8IEZhaWw2YElDUzIwLTEgdHJhbnNmZXIgZXJyb3IgJHtlcnJvcn1gO1xuICAgICAgICAgIHJlc3VsdCA/PyBGYWlsNmBNaXNzaW5nIHJlc3VsdCBpbiBJQ1MyMC0xIHRyYW5zZmVyIGFjayAke29ian1gO1xuICAgICAgICAgIHJlc3VsdCA9PT0gSUNTMjBfVFJBTlNGRVJfU1VDQ0VTU19SRVNVTFQgfHwgRmFpbDZgSUNTMjAtMSB0cmFuc2ZlciB1bnN1Y2Nlc3NmdWwgd2l0aCBhY2sgcmVzdWx0ICR7cmVzdWx0fWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIHJldHVybiAoLi4uYXJncykgPT4gbWFrZUlCQ1RyYW5zZmVyU2VuZGVyS2l0KC4uLmFyZ3MpLnB1YmxpYztcbn07XG5oYXJkZW4ocHJlcGFyZUlCQ1RyYW5zZmVyU2VuZGVyKTtcbnZhciBwcmVwYXJlSUJDUmVwbHlLaXQgPSAoem9uZSwgdm93VG9vbHMpID0+IHtcbiAgY29uc3QgeyB3YXRjaCB9ID0gdm93VG9vbHM7XG4gIGNvbnN0IGliY1dhdGNoZXIgPSB6b25lLmV4byhcbiAgICBcImliY1Jlc3VsdFdhdGNoZXJcIixcbiAgICBNLmludGVyZmFjZShcInByb2Nlc3NJQkNXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS5yZWNvcmQoKSwgTS5yZWNvcmQoKSkucmV0dXJucyhWb3ckNShNLnN0cmluZygpKSlcbiAgICB9KSxcbiAgICB7XG4gICAgICBvbkZ1bGZpbGxlZCh7IGV2ZW50LCBhY2tub3dsZWRnZW1lbnQgfSwgeyBvcE5hbWUgPSBcInVua25vd25cIiB9KSB7XG4gICAgICAgIGFzc2VydEFsbERlZmluZWQoeyBldmVudCwgYWNrbm93bGVkZ2VtZW50IH0pO1xuICAgICAgICBzd2l0Y2ggKGV2ZW50KSB7XG4gICAgICAgICAgY2FzZSBcImFja25vd2xlZGdlbWVudFBhY2tldFwiOlxuICAgICAgICAgICAgcmV0dXJuIGJhc2U2NFRvQnl0ZXMoYWNrbm93bGVkZ2VtZW50KTtcbiAgICAgICAgICBjYXNlIFwidGltZW91dFBhY2tldFwiOlxuICAgICAgICAgICAgdGhyb3cgRmFpbDZgJHtiYXJlMyhvcE5hbWUpfSBvcGVyYXRpb24gcmVjZWl2ZWQgdGltZW91dCBwYWNrZXRgO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBGYWlsNmBVbmV4cGVjdGVkIGV2ZW50OiAke2V2ZW50fWA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VJQkNSZXBseUtpdCA9IChyZXBseVBhY2tldFBhdHRlcm4sIG1hdGNoViwgb3B0cykgPT4ge1xuICAgIGNvbnN0IGV2ZW50UGF0dGVybiA9IE0ub3IoXG4gICAgICBNLnNwbGl0UmVjb3JkKHtcbiAgICAgICAgZXZlbnQ6IFwiYWNrbm93bGVkZ2VtZW50UGFja2V0XCIsXG4gICAgICAgIHBhY2tldDogcmVwbHlQYWNrZXRQYXR0ZXJuLFxuICAgICAgICBhY2tub3dsZWRnZW1lbnQ6IE0uc3RyaW5nKClcbiAgICAgIH0pLFxuICAgICAgTS5zcGxpdFJlY29yZCh7XG4gICAgICAgIGV2ZW50OiBcInRpbWVvdXRQYWNrZXRcIixcbiAgICAgICAgcGFja2V0OiByZXBseVBhY2tldFBhdHRlcm5cbiAgICAgIH0pXG4gICAgKTtcbiAgICBjb25zdCByZXN1bHRWID0gd2F0Y2gobWF0Y2hWLCBpYmNXYXRjaGVyLCBvcHRzKTtcbiAgICByZXR1cm4gaGFyZGVuKHsgZXZlbnRQYXR0ZXJuLCByZXN1bHRWIH0pO1xuICB9O1xuICByZXR1cm4gbWFrZUlCQ1JlcGx5S2l0O1xufTtcbmhhcmRlbihwcmVwYXJlSUJDUmVwbHlLaXQpO1xudmFyIHByZXBhcmVJQkNUb29scyA9ICh6b25lLCB2b3dUb29scykgPT4ge1xuICBjb25zdCBtYWtlSUJDUmVwbHlLaXQgPSBwcmVwYXJlSUJDUmVwbHlLaXQoem9uZSwgdm93VG9vbHMpO1xuICBjb25zdCBtYWtlSUJDVHJhbnNmZXJTZW5kZXIgPSBwcmVwYXJlSUJDVHJhbnNmZXJTZW5kZXIoem9uZSwge1xuICAgIG1ha2VJQkNSZXBseUtpdCxcbiAgICAuLi52b3dUb29sc1xuICB9KTtcbiAgcmV0dXJuIGhhcmRlbih7IG1ha2VJQkNUcmFuc2ZlclNlbmRlciwgbWFrZUlCQ1JlcGx5S2l0IH0pO1xufTtcbmhhcmRlbihwcmVwYXJlSUJDVG9vbHMpO1xuXG4vL1xudmFyIHRyYWNlNSA9IG1ha2VUcmFjZXIoXCJMb2NhbE9yY2hBY2NvdW50XCIpO1xudmFyIHsgVm93JDogVm93JDYgfSA9IFNoYXBlO1xudmFyIEVWb3ckMiA9IChzaGFwZSkgPT4gTS5vcihWb3ckNihzaGFwZSksIE0ucHJvbWlzZShcbiAgLyogICAgICAgKi9cbikpO1xudmFyIEhvbGRlckkgPSBNLmludGVyZmFjZShcImhvbGRlclwiLCB7XG4gIC4uLm9yY2hlc3RyYXRpb25BY2NvdW50TWV0aG9kcyxcbiAgZGVsZWdhdGU6IE0uY2FsbChNLnN0cmluZygpLCBBbW91bnRTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIHVuZGVsZWdhdGU6IE0uY2FsbChNLnN0cmluZygpLCBBbW91bnRTaGFwZSkucmV0dXJucyhWb3dTaGFwZSksXG4gIGRlcG9zaXQ6IE0uY2FsbChQYXltZW50U2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICB3aXRoZHJhdzogTS5jYWxsKEFtb3VudFNoYXBlKS5yZXR1cm5zKFZvdyQ2KFBheW1lbnRTaGFwZSkpLFxuICBleGVjdXRlVHg6IE0uY2FsbChNLmFycmF5T2YoTS5yZWNvcmQoKSkpLnJldHVybnMoVm93JDYoTS5yZWNvcmQoKSkpLFxuICBzZW5kVGhlbldhaXRGb3JBY2s6IE0uY2FsbChFVm93JDIoTS5yZW1vdGFibGUoXCJQYWNrZXRTZW5kZXJcIikpKS5vcHRpb25hbChNLmFueSgpKS5yZXR1cm5zKEVWb3ckMihNLnN0cmluZygpKSksXG4gIG1hdGNoRmlyc3RQYWNrZXQ6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKEVWb3ckMihNLmFueSgpKSksXG4gIG1vbml0b3JUcmFuc2ZlcnM6IE0uY2FsbChNLnJlbW90YWJsZShcIlRhcmdldEFwcFwiKSkucmV0dXJucyhFVm93JDIoTS5hbnkoKSkpXG59KTtcbnZhciBQVUJMSUNfVE9QSUNTMiA9IHtcbiAgYWNjb3VudDogW1wiQWNjb3VudCBob2xkZXIgc3RhdHVzXCIsIE0uYW55KCldXG59O1xudmFyIHByZXBhcmVMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0ID0gKHpvbmUsIHtcbiAgbWFrZVJlY29yZGVyS2l0LFxuICB6Y2YsXG4gIHRpbWVyU2VydmljZSxcbiAgdm93VG9vbHMsXG4gIGNoYWluSHViLFxuICBsb2NhbGNoYWluLFxuICB6b2VUb29sc1xufSkgPT4ge1xuICBjb25zdCB7IHdhdGNoLCBhc1Zvdywgd2hlbiB9ID0gdm93VG9vbHM7XG4gIGNvbnN0IHsgbWFrZUlCQ1RyYW5zZmVyU2VuZGVyIH0gPSBwcmVwYXJlSUJDVG9vbHMoXG4gICAgem9uZS5zdWJab25lKFwiaWJjVG9vbHNcIiksXG4gICAgdm93VG9vbHNcbiAgKTtcbiAgY29uc3QgbWFrZVBhY2tldFRvb2xzID0gcHJlcGFyZVBhY2tldFRvb2xzKFxuICAgIHpvbmUuc3ViWm9uZShcInBhY2tldFRvb2xzXCIpLFxuICAgIHZvd1Rvb2xzXG4gICk7XG4gIGNvbnN0IHRpbWVzdGFtcEhlbHBlciA9IG1ha2VUaW1lc3RhbXBIZWxwZXIodGltZXJTZXJ2aWNlKTtcbiAgY29uc3QgbWFrZUxvY2FsT3JjaGVzdHJhdGlvbkFjY291bnRLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiTG9jYWwgT3JjaGVzdHJhdGlvbiBBY2NvdW50IEtpdFwiLFxuICAgIHtcbiAgICAgIGhlbHBlcjogTS5pbnRlcmZhY2UoXCJoZWxwZXJcIiwge1xuICAgICAgICBhbW91bnRUb0NvaW46IE0uY2FsbChBbW91bnRBcmdTaGFwZSkucmV0dXJucyhNLnJlY29yZCgpKVxuICAgICAgfSksXG4gICAgICBob2xkZXI6IEhvbGRlckksXG4gICAgICB1bmRlbGVnYXRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJ1bmRlbGVnYXRlV2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoW1xuICAgICAgICAgIE0uc3BsaXRSZWNvcmQoeyBjb21wbGV0aW9uVGltZTogVGltZXN0YW1wUHJvdG9TaGFwZSB9KVxuICAgICAgICBdKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgICB9KSxcbiAgICAgIHRyYW5zZmVyV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJ0cmFuc2ZlcldhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ubmF0KCkpLm9wdGlvbmFsKHtcbiAgICAgICAgICBvcHRzOiBNLm9yKE0udW5kZWZpbmVkKCksIElCQ1RyYW5zZmVyT3B0aW9uc1NoYXBlKSxcbiAgICAgICAgICByb3V0ZTogVHJhbnNmZXJSb3V0ZVNoYXBlXG4gICAgICAgIH0pLnJldHVybnMoVm93JDYoTS5yZWNvcmQoKSkpXG4gICAgICB9KSxcbiAgICAgIGV4dHJhY3RGaXJzdFJlc3VsdFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwiZXh0cmFjdEZpcnN0UmVzdWx0V2F0Y2hlclwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoW00ucmVjb3JkKCldKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgcmV0dXJuVm9pZFdhdGNoZXI6IE0uaW50ZXJmYWNlKFwicmV0dXJuVm9pZFdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0uYW55KCkpLm9wdGlvbmFsKE0uYW55KCkpLnJldHVybnMoTS51bmRlZmluZWQoKSlcbiAgICAgIH0pLFxuICAgICAgc2VhdEV4aXRlckhhbmRsZXI6IE0uaW50ZXJmYWNlKFwic2VhdEV4aXRlckhhbmRsZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0udW5kZWZpbmVkKCksIE0ucmVtb3RhYmxlKCkpLnJldHVybnMoXG4gICAgICAgICAgTS51bmRlZmluZWQoKVxuICAgICAgICApLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5lcnJvcigpLCBNLnJlbW90YWJsZSgpKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpXG4gICAgICB9KSxcbiAgICAgIGdldEJhbGFuY2VXYXRjaGVyOiBNLmludGVyZmFjZShcImdldEJhbGFuY2VXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChBbW91bnRTaGFwZSwgRGVub21TaGFwZSkucmV0dXJucyhEZW5vbUFtb3VudFNoYXBlKVxuICAgICAgfSksXG4gICAgICBxdWVyeUJhbGFuY2VXYXRjaGVyOiBNLmludGVyZmFjZShcInF1ZXJ5QmFsYW5jZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKFR5cGVkSnNvblNoYXBlKS5yZXR1cm5zKERlbm9tQW1vdW50U2hhcGUpXG4gICAgICB9KSxcbiAgICAgIHF1ZXJ5QmFsYW5jZXNXYXRjaGVyOiBNLmludGVyZmFjZShcInF1ZXJ5QmFsYW5jZXNXYXRjaGVyXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChUeXBlZEpzb25TaGFwZSkucmV0dXJucyhcbiAgICAgICAgICBNLmFycmF5T2YoRGVub21BbW91bnRTaGFwZSlcbiAgICAgICAgKVxuICAgICAgfSksXG4gICAgICBpbnZpdGF0aW9uTWFrZXJzOiBNLmludGVyZmFjZShcImludml0YXRpb25NYWtlcnNcIiwge1xuICAgICAgICBDbG9zZUFjY291bnQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBEZWxlZ2F0ZTogTS5jYWxsKE0uc3RyaW5nKCksIEFtb3VudFNoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgRGVwb3NpdDogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIFNlbmQ6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBTZW5kQWxsOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgVHJhbnNmZXI6IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBVbmRlbGVnYXRlOiBNLmNhbGwoTS5zdHJpbmcoKSwgQW1vdW50U2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgICAgICBXaXRoZHJhdzogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICAgIH0pXG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cbiAgICAgKi9cbiAgICAoeyBhY2NvdW50LCBhZGRyZXNzLCBzdG9yYWdlTm9kZSB9KSA9PiB7XG4gICAgICBjb25zdCB0b3BpY0tpdCA9IHN0b3JhZ2VOb2RlID8gbWFrZVJlY29yZGVyS2l0KHN0b3JhZ2VOb2RlLCBQVUJMSUNfVE9QSUNTMi5hY2NvdW50WzFdKSA6IHZvaWQgMDtcbiAgICAgIGlmICh0b3BpY0tpdCkge1xuICAgICAgICB2b2lkIEUodG9waWNLaXQucmVjb3JkZXIpLndyaXRlKFwiXCIpO1xuICAgICAgfVxuICAgICAgY29uc3QgcGFja2V0VG9vbHMgPSBtYWtlUGFja2V0VG9vbHMoYWNjb3VudCk7XG4gICAgICByZXR1cm4geyBhY2NvdW50LCBhZGRyZXNzLCBwYWNrZXRUb29scywgdG9waWNLaXQgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGhlbHBlcjoge1xuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGFtb3VudFRvQ29pbihhbW91bnQpIHtcbiAgICAgICAgICByZXR1cm4gY29lcmNlQ29pbihjaGFpbkh1YiwgYW1vdW50KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGludml0YXRpb25NYWtlcnM6IHtcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBEZWxlZ2F0ZSh2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KSB7XG4gICAgICAgICAgdHJhY2U1KFwiRGVsZWdhdGVcIiwgdmFsaWRhdG9yQWRkcmVzcywgZXJ0cEFtb3VudCk7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmhvbGRlci5kZWxlZ2F0ZSh2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCBcIkRlbGVnYXRlXCIpO1xuICAgICAgICB9LFxuICAgICAgICBEZXBvc2l0KCkge1xuICAgICAgICAgIHRyYWNlNShcIkRlcG9zaXRcIik7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihcbiAgICAgICAgICAgIChzZWF0KSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHsgZ2l2ZSB9ID0gc2VhdC5nZXRQcm9wb3NhbCgpO1xuICAgICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgICAgem9lVG9vbHMubG9jYWxUcmFuc2ZlcihcbiAgICAgICAgICAgICAgICAgIHNlYXQsXG4gICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5hY2NvdW50LFxuICAgICAgICAgICAgICAgICAgZ2l2ZVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgdGhpcy5mYWNldHMuc2VhdEV4aXRlckhhbmRsZXIsXG4gICAgICAgICAgICAgICAgc2VhdFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwiRGVwb3NpdFwiLFxuICAgICAgICAgICAgdm9pZCAwLFxuICAgICAgICAgICAgTS5zcGxpdFJlY29yZCh7IGdpdmU6IEFueU5hdEFtb3VudHNSZWNvcmQsIHdhbnQ6IHt9IH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBVbmRlbGVnYXRlKHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpIHtcbiAgICAgICAgICB0cmFjZTUoXCJVbmRlbGVnYXRlXCIsIHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oKHNlYXQpID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5ob2xkZXIudW5kZWxlZ2F0ZSh2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCBcIlVuZGVsZWdhdGVcIik7XG4gICAgICAgIH0sXG4gICAgICAgIENsb3NlQWNjb3VudCgpIHtcbiAgICAgICAgICB0aHJvdyBFcnJvcihcIm5vdCB5ZXQgaW1wbGVtZW50ZWRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFNlbmQoKSB7XG4gICAgICAgICAgY29uc3Qgb2ZmZXJIYW5kbGVyID0gKHNlYXQsIHsgdG9BY2NvdW50LCBhbW91bnQgfSkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2godGhpcy5mYWNldHMuaG9sZGVyLnNlbmQodG9BY2NvdW50LCBhbW91bnQpKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24ob2ZmZXJIYW5kbGVyLCBcIlNlbmRcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFNlbmRBbGwoKSB7XG4gICAgICAgICAgY29uc3Qgb2ZmZXJIYW5kbGVyID0gKHNlYXQsIHsgdG9BY2NvdW50LCBhbW91bnRzIH0pID0+IHtcbiAgICAgICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKHRoaXMuZmFjZXRzLmhvbGRlci5zZW5kQWxsKHRvQWNjb3VudCwgYW1vdW50cykpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihvZmZlckhhbmRsZXIsIFwiU2VuZEFsbFwiKTtcbiAgICAgICAgfSxcbiAgICAgICAgVHJhbnNmZXIoKSB7XG4gICAgICAgICAgY29uc3Qgb2ZmZXJIYW5kbGVyID0gKHNlYXQsIHsgYW1vdW50LCBkZXN0aW5hdGlvbiwgb3B0cyB9KSA9PiB7XG4gICAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMuaG9sZGVyLnRyYW5zZmVyKGRlc3RpbmF0aW9uLCBhbW91bnQsIG9wdHMpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihvZmZlckhhbmRsZXIsIFwiVHJhbnNmZXJcIik7XG4gICAgICAgIH0sXG4gICAgICAgIFdpdGhkcmF3KCkge1xuICAgICAgICAgIHRyYWNlNShcIldpdGhkcmF3XCIpO1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oXG4gICAgICAgICAgICAoc2VhdCkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCB7IHdhbnQgfSA9IHNlYXQuZ2V0UHJvcG9zYWwoKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICAgIHpvZVRvb2xzLndpdGhkcmF3VG9TZWF0KFxuICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgIHRoaXMuc3RhdGUuYWNjb3VudCxcbiAgICAgICAgICAgICAgICAgIHNlYXQsXG4gICAgICAgICAgICAgICAgICB3YW50XG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5zZWF0RXhpdGVySGFuZGxlcixcbiAgICAgICAgICAgICAgICBzZWF0XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJXaXRoZHJhd1wiLFxuICAgICAgICAgICAgdm9pZCAwLFxuICAgICAgICAgICAgTS5zcGxpdFJlY29yZCh7IGdpdmU6IHt9LCB3YW50OiBBbnlOYXRBbW91bnRzUmVjb3JkIH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHVuZGVsZWdhdGVXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzcG9uc2UpIHtcbiAgICAgICAgICBjb25zdCB7IGNvbXBsZXRpb25UaW1lIH0gPSByZXNwb25zZVswXTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKHRpbWVyU2VydmljZSkud2FrZUF0KFxuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBCaWdJbnQoY29tcGxldGlvblRpbWUuc2Vjb25kcykgKyBtYXhDbG9ja1NrZXdcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0cmFuc2ZlcldhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZCh0aW1lb3V0VGltZXN0YW1wLCB7IG9wdHMsIHJvdXRlIH0pIHtcbiAgICAgICAgICBjb25zdCB7IGZvcndhcmRJbmZvLCAuLi50cmFuc2ZlckRldGFpbHMgfSA9IHJvdXRlO1xuICAgICAgICAgIGxldCBtZW1vO1xuICAgICAgICAgIGlmIChvcHRzICYmIFwibWVtb1wiIGluIG9wdHMpIHtcbiAgICAgICAgICAgIG1lbW8gPSBvcHRzLm1lbW87XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChmb3J3YXJkSW5mbykge1xuICAgICAgICAgICAgbWVtbyA9IEpTT04uc3RyaW5naWZ5KGZvcndhcmRJbmZvKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgdHJhbnNmZXJNc2cgPSB0eXBlZEpzb24oXG4gICAgICAgICAgICBcIi9pYmMuYXBwbGljYXRpb25zLnRyYW5zZmVyLnYxLk1zZ1RyYW5zZmVyXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIC4uLnRyYW5zZmVyRGV0YWlscyxcbiAgICAgICAgICAgICAgc2VuZGVyOiB0aGlzLnN0YXRlLmFkZHJlc3MudmFsdWUsXG4gICAgICAgICAgICAgIHRpbWVvdXRIZWlnaHQ6IG9wdHM/LnRpbWVvdXRIZWlnaHQgPz8ge1xuICAgICAgICAgICAgICAgIHJldmlzaW9uSGVpZ2h0OiAwbixcbiAgICAgICAgICAgICAgICByZXZpc2lvbk51bWJlcjogMG5cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdGltZW91dFRpbWVzdGFtcCxcbiAgICAgICAgICAgICAgbWVtbzogbWVtbyA/PyBcIlwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCB7IGhvbGRlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3Qgc2VuZGVyID0gbWFrZUlCQ1RyYW5zZmVyU2VuZGVyKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICovXG4gICAgICAgICAgICBob2xkZXIsXG4gICAgICAgICAgICB0cmFuc2Zlck1zZ1xuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGhvbGRlci5zZW5kVGhlbldhaXRGb3JBY2soc2VuZGVyKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBleHRyYWN0Rmlyc3RSZXN1bHRXYXRjaGVyOiB7XG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdHMpIHtcbiAgICAgICAgICByZXN1bHRzLmxlbmd0aCA9PT0gMSB8fCB0aHJvd1JlZGFjdGVkYGV4cGVjdGVkIGV4YWN0bHkgb25lIHJlc3VsdDsgZ290ICR7cmVzdWx0c31gO1xuICAgICAgICAgIHJldHVybiByZXN1bHRzWzBdO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcmV0dXJuVm9pZFdhdGNoZXI6IHtcbiAgICAgICAgb25GdWxmaWxsZWQoKSB7XG4gICAgICAgICAgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBnZXRCYWxhbmNlV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQobmF0QW1vdW50LCBkZW5vbSkge1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oeyBkZW5vbSwgdmFsdWU6IG5hdEFtb3VudC52YWx1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBzZWF0RXhpdGVySGFuZGxlcjoge1xuICAgICAgICAvKlxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKF8sIHNlYXQpIHtcbiAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgc2VhdCkge1xuICAgICAgICAgIHNlYXQuZXhpdChyZWFzb24pO1xuICAgICAgICAgIHRocm93IHJlYXNvbjtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBxdWVyeUJhbGFuY2VXYXRjaGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCkge1xuICAgICAgICAgIGNvbnN0IHsgYmFsYW5jZSB9ID0gcmVzdWx0O1xuICAgICAgICAgIGlmICghYmFsYW5jZSB8fCAhYmFsYW5jZT8uZGVub20pIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgRXhwZWN0ZWQgYmFsYW5jZSAke3F1b3RlKHJlc3VsdCl9O2A7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBoYXJkZW4odG9EZW5vbUFtb3VudChiYWxhbmNlKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgcXVlcnlCYWxhbmNlc1dhdGNoZXI6IHtcbiAgICAgICAgLypcblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCkge1xuICAgICAgICAgIGNvbnN0IHsgYmFsYW5jZXMgfSA9IHJlc3VsdDtcbiAgICAgICAgICBpZiAoIWJhbGFuY2VzIHx8ICFBcnJheS5pc0FycmF5KGJhbGFuY2VzKSkge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBFeHBlY3RlZCBiYWxhbmNlcyAke3F1b3RlKHJlc3VsdCl9O2A7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBoYXJkZW4oYmFsYW5jZXMubWFwKHRvRGVub21BbW91bnQpKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGhvbGRlcjoge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGFzQ29udGludWluZ09mZmVyKCkge1xuICAgICAgICAgIHJldHVybiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBudWxsO1xuICAgICAgICAgICAgY29uc3QgeyBob2xkZXIsIGludml0YXRpb25NYWtlcnM6IGltIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICAgIGNvbnN0IGludml0YXRpb25NYWtlcnMgPSAoXG4gICAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICBpbVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICBwdWJsaWNTdWJzY3JpYmVyczogYXdhaXQgd2hlbihob2xkZXIuZ2V0UHVibGljVG9waWNzKCkpLFxuICAgICAgICAgICAgICBpbnZpdGF0aW9uTWFrZXJzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGdldEJhbGFuY2UoZGVub21BcmcpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgW2JyYW5kLCBkZW5vbV0gPSB0eXBlb2YgZGVub21BcmcgPT09IFwic3RyaW5nXCIgPyBbY2hhaW5IdWIuZ2V0QXNzZXQoZGVub21BcmcsIFwiYWdvcmljXCIpPy5icmFuZCwgZGVub21BcmddIDogW2Rlbm9tQXJnLCBjaGFpbkh1Yi5nZXREZW5vbShkZW5vbUFyZyldO1xuICAgICAgICAgICAgaWYgKCFkZW5vbSkge1xuICAgICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYE5vIGRlbm9tIGZvciBicmFuZDogJHtkZW5vbUFyZ31gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGJyYW5kKSB7XG4gICAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgICBFKHRoaXMuc3RhdGUuYWNjb3VudCkuZ2V0QmFsYW5jZShicmFuZCksXG4gICAgICAgICAgICAgICAgdGhpcy5mYWNldHMuZ2V0QmFsYW5jZVdhdGNoZXIsXG4gICAgICAgICAgICAgICAgZGVub21cbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShsb2NhbGNoYWluKS5xdWVyeShcbiAgICAgICAgICAgICAgICB0eXBlZEpzb24oXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUJhbGFuY2VSZXF1ZXN0XCIsIHtcbiAgICAgICAgICAgICAgICAgIGFkZHJlc3M6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIGRlbm9tXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucXVlcnlCYWxhbmNlV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRCYWxhbmNlcygpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKGxvY2FsY2hhaW4pLnF1ZXJ5KFxuICAgICAgICAgICAgICB0eXBlZEpzb24oXCIvY29zbW9zLmJhbmsudjFiZXRhMS5RdWVyeUFsbEJhbGFuY2VzUmVxdWVzdFwiLCB7XG4gICAgICAgICAgICAgICAgYWRkcmVzczogdGhpcy5zdGF0ZS5hZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMucXVlcnlCYWxhbmNlc1dhdGNoZXJcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRQdWJsaWNUb3BpY3MoKSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IG51bGw7XG4gICAgICAgICAgICBjb25zdCB7IHRvcGljS2l0IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgaWYgKCF0b3BpY0tpdCkgdGhyb3cgdGhyb3dSZWRhY3RlZGBObyB0b3BpY0tpdDsgc3RvcmFnZU5vZGUgbm90IHByb3ZpZGVkYDtcbiAgICAgICAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICAgICAgICBhY2NvdW50OiB7XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFBVQkxJQ19UT1BJQ1MyLmFjY291bnRbMF0sXG4gICAgICAgICAgICAgICAgc3Vic2NyaWJlcjogdG9waWNLaXQuc3Vic2NyaWJlcixcbiAgICAgICAgICAgICAgICBzdG9yYWdlUGF0aDogYXdhaXQgdG9waWNLaXQucmVjb3JkZXIuZ2V0U3RvcmFnZVBhdGgoKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLy9cbiAgICAgICAgLypcblxuXG4gICAgICAgICAqL1xuICAgICAgICBkZWxlZ2F0ZSh2YWxpZGF0b3JBZGRyZXNzLCBlcnRwQW1vdW50KSB7XG4gICAgICAgICAgY29uc3QgeyBhY2NvdW50OiBsY2EgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgYW1vdW50ID0gY29lcmNlQ29pbihjaGFpbkh1YiwgZXJ0cEFtb3VudCk7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgRShsY2EpLmV4ZWN1dGVUeChbXG4gICAgICAgICAgICAgIHR5cGVkSnNvbihcIi9jb3Ntb3Muc3Rha2luZy52MWJldGExLk1zZ0RlbGVnYXRlXCIsIHtcbiAgICAgICAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgICAgICAgdmFsaWRhdG9yQWRkcmVzcyxcbiAgICAgICAgICAgICAgICBkZWxlZ2F0b3JBZGRyZXNzOiB0aGlzLnN0YXRlLmFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMuZXh0cmFjdEZpcnN0UmVzdWx0V2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICB1bmRlbGVnYXRlKHZhbGlkYXRvckFkZHJlc3MsIGVydHBBbW91bnQpIHtcbiAgICAgICAgICBjb25zdCBhbW91bnQgPSBjb2VyY2VDb2luKGNoYWluSHViLCBlcnRwQW1vdW50KTtcbiAgICAgICAgICBjb25zdCB7IGFjY291bnQ6IGxjYSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKGxjYSkuZXhlY3V0ZVR4KFtcbiAgICAgICAgICAgICAgdHlwZWRKc29uKFwiL2Nvc21vcy5zdGFraW5nLnYxYmV0YTEuTXNnVW5kZWxlZ2F0ZVwiLCB7XG4gICAgICAgICAgICAgICAgYW1vdW50LFxuICAgICAgICAgICAgICAgIHZhbGlkYXRvckFkZHJlc3MsXG4gICAgICAgICAgICAgICAgZGVsZWdhdG9yQWRkcmVzczogdGhpcy5zdGF0ZS5hZGRyZXNzLnZhbHVlXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLnVuZGVsZWdhdGVXYXRjaGVyXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIGRlcG9zaXQocGF5bWVudCkge1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIEUodGhpcy5zdGF0ZS5hY2NvdW50KS5kZXBvc2l0KHBheW1lbnQpLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgd2l0aGRyYXcoYW1vdW50KSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUodGhpcy5zdGF0ZS5hY2NvdW50KS53aXRoZHJhdyhhbW91bnQpKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZXhlY3V0ZVR4KG1lc3NhZ2VzKSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUodGhpcy5zdGF0ZS5hY2NvdW50KS5leGVjdXRlVHgobWVzc2FnZXMpKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBnZXRBZGRyZXNzKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmFkZHJlc3M7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBzZW5kKHRvQWNjb3VudCwgYW1vdW50KSB7XG4gICAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICAgIHRyYWNlNShcInNlbmRcIiwgdG9BY2NvdW50LCBhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgY29zbW9zRGVzdCA9IGNoYWluSHViLmNvZXJjZUNvc21vc0FkZHJlc3ModG9BY2NvdW50KTtcbiAgICAgICAgICAgIGNvc21vc0Rlc3QuY2hhaW5JZCA9PT0gdGhpcy5zdGF0ZS5hZGRyZXNzLmNoYWluSWQgfHwgdGhyb3dSZWRhY3RlZGBiYW5rL3NlbmQgY2Fubm90IHNlbmQgdG8gYSBkaWZmZXJlbnQgY2hhaW4gJHtxdW90ZShjb3Ntb3NEZXN0LmNoYWluSWQpfWA7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUodGhpcy5zdGF0ZS5hY2NvdW50KS5leGVjdXRlVHgoW1xuICAgICAgICAgICAgICAgIHR5cGVkSnNvbihcIi9jb3Ntb3MuYmFuay52MWJldGExLk1zZ1NlbmRcIiwge1xuICAgICAgICAgICAgICAgICAgYW1vdW50OiBbaGVscGVyLmFtb3VudFRvQ29pbihhbW91bnQpXSxcbiAgICAgICAgICAgICAgICAgIHRvQWRkcmVzczogY29zbW9zRGVzdC52YWx1ZSxcbiAgICAgICAgICAgICAgICAgIGZyb21BZGRyZXNzOiB0aGlzLnN0YXRlLmFkZHJlc3MudmFsdWVcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMucmV0dXJuVm9pZFdhdGNoZXJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBzZW5kQWxsKHRvQWNjb3VudCwgYW1vdW50cykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTUoXCJzZW5kQWxsXCIsIHRvQWNjb3VudCwgYW1vdW50cyk7XG4gICAgICAgICAgICBjb25zdCB7IGhlbHBlciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICAgIEUodGhpcy5zdGF0ZS5hY2NvdW50KS5leGVjdXRlVHgoW1xuICAgICAgICAgICAgICAgIHR5cGVkSnNvbihcIi9jb3Ntb3MuYmFuay52MWJldGExLk1zZ1NlbmRcIiwge1xuICAgICAgICAgICAgICAgICAgYW1vdW50OiBhbW91bnRzLm1hcCgoYTIpID0+IGhlbHBlci5hbW91bnRUb0NvaW4oYTIpKSxcbiAgICAgICAgICAgICAgICAgIHRvQWRkcmVzczogdG9BY2NvdW50LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgZnJvbUFkZHJlc3M6IHRoaXMuc3RhdGUuYWRkcmVzcy52YWx1ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICB0aGlzLmZhY2V0cy5yZXR1cm5Wb2lkV2F0Y2hlclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgdHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwgb3B0cykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICB0cmFjZTUoXCJUcmFuc2ZlcnJpbmcgZnVuZHMgb3ZlciBJQkNcIik7XG4gICAgICAgICAgICBjb25zdCBkZW5vbUFtb3VudCA9IGNvZXJjZURlbm9tQW1vdW50KGNoYWluSHViLCBhbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgeyBmb3J3YXJkT3B0cywgLi4ucmVzdCB9ID0gb3B0cyA/PyB7fTtcbiAgICAgICAgICAgIGNvbnN0IHJvdXRlID0gY2hhaW5IdWIubWFrZVRyYW5zZmVyUm91dGUoXG4gICAgICAgICAgICAgIGRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICBkZW5vbUFtb3VudCxcbiAgICAgICAgICAgICAgXCJhZ29yaWNcIixcbiAgICAgICAgICAgICAgZm9yd2FyZE9wdHNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICB0cmFjZTUoXCJnb3QgdHJhbnNmZXIgcm91dGVcIiwgcm91dGUpO1xuICAgICAgICAgICAgY29uc3QgdGltZW91dFRpbWVzdGFtcFZvd09yVmFsdWUgPSBvcHRzPy50aW1lb3V0VGltZXN0YW1wID8/IChvcHRzPy50aW1lb3V0SGVpZ2h0ID8gMG4gOiBhc1ZvdygoKSA9PiBFKHRpbWVzdGFtcEhlbHBlcikuZ2V0VGltZW91dFRpbWVzdGFtcE5TKCkpKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdFYgPSB3YXRjaChcbiAgICAgICAgICAgICAgdGltZW91dFRpbWVzdGFtcFZvd09yVmFsdWUsXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnRyYW5zZmVyV2F0Y2hlcixcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIG9wdHM6IHJlc3QsXG4gICAgICAgICAgICAgICAgcm91dGVcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRWO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgdHJhbnNmZXJTdGVwcyhhbW91bnQsIG1zZykge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInRyYW5zZmVyU3RlcHMgZ290XCIsIGFtb3VudCwgbXNnKTtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgbm90IHlldCBpbXBsZW1lbnRlZGA7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIHNlbmRUaGVuV2FpdEZvckFjayhzZW5kZXIsIG9wdHMpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgICBFKHRoaXMuc3RhdGUucGFja2V0VG9vbHMpLnNlbmRUaGVuV2FpdEZvckFjayhzZW5kZXIsIG9wdHMpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG1hdGNoRmlyc3RQYWNrZXQocGF0dGVyblYpIHtcbiAgICAgICAgICByZXR1cm4gd2F0Y2goRSh0aGlzLnN0YXRlLnBhY2tldFRvb2xzKS5tYXRjaEZpcnN0UGFja2V0KHBhdHRlcm5WKSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgIG1vbml0b3JUcmFuc2ZlcnModGFwKSB7XG4gICAgICAgICAgcmV0dXJuIHdhdGNoKEUodGhpcy5zdGF0ZS5wYWNrZXRUb29scykubW9uaXRvclRyYW5zZmVycyh0YXApKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgcmV0dXJuIG1ha2VMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0O1xufTtcblxuLy9cbnZhciB7IFZvdyQ6IFZvdyQ3IH0gPSBTaGFwZTtcbnZhciB0cmFjZTYgPSBtYWtlVHJhY2VyKFwiT3JjaGVzdHJhdG9yXCIpO1xudmFyIE9yY2hlc3RyYXRvckkgPSBNLmludGVyZmFjZShcIk9yY2hlc3RyYXRvclwiLCB7XG4gIGdldENoYWluOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucyhWb3ckNyhNLnJlbW90YWJsZShcIkNoYWluRmFjYWRlXCIpKSksXG4gIGdldERlbm9tSW5mbzogTS5jYWxsKERlbm9tU2hhcGUsIE0uc3RyaW5nKCkpLnJldHVybnMoRGVub21JbmZvU2hhcGUpLFxuICBhc0Ftb3VudDogTS5jYWxsKERlbm9tQW1vdW50U2hhcGUpLnJldHVybnMoQW1vdW50U2hhcGUpXG59KTtcbnZhciBwcmVwYXJlT3JjaGVzdHJhdG9yS2l0ID0gKHpvbmUsIHtcbiAgY2hhaW5IdWIsXG4gIG1ha2VMb2NhbENoYWluRmFjYWRlLFxuICBtYWtlUmVtb3RlQ2hhaW5GYWNhZGUsXG4gIHZvd1Rvb2xzOiB7IHdhdGNoLCBhc1ZvdyB9XG59KSA9PiB7XG4gIGNvbnN0IGNoYWluQnlOYW1lID0gbWFrZVNjYWxhck1hcFN0b3JlKFwiY2hhaW5OYW1lXCIpO1xuICByZXR1cm4gem9uZS5leG9DbGFzc0tpdChcbiAgICBcIk9yY2hlc3RyYXRvclwiLFxuICAgIHtcbiAgICAgIG9yY2hlc3RyYXRvcjogT3JjaGVzdHJhdG9ySSxcbiAgICAgIG1ha2VMb2NhbENoYWluRmFjYWRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJtYWtlTG9jYWxDaGFpbkZhY2FkZVdhdGNoZXJcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVjb3JkKCkpLnJldHVybnMoTS5yZW1vdGFibGUoKSlcbiAgICAgIH0pLFxuICAgICAgbWFrZVJlbW90ZUNoYWluRmFjYWRlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICAgIFwibWFrZVJlbW90ZUNoYWluRmFjYWRlV2F0Y2hlclwiLFxuICAgICAgICB7XG4gICAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLmFueSgpLCBNLnN0cmluZygpKS5vcHRpb25hbChNLmFycmF5T2YoTS51bmRlZmluZWQoKSkpLnJldHVybnMoTS5yZW1vdGFibGUoKSlcbiAgICAgICAgfVxuICAgICAgKVxuICAgIH0sXG4gICAgKCkgPT4ge1xuICAgICAgdHJhY2U2KFwibWFraW5nIGFuIE9yY2hlc3RyYXRvclwiKTtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9LFxuICAgIHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBtYWtlTG9jYWxDaGFpbkZhY2FkZVdhdGNoZXI6IHtcbiAgICAgICAgLypcblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQoYWdvcmljQ2hhaW5JbmZvKSB7XG4gICAgICAgICAgY29uc3QgaXQgPSBtYWtlTG9jYWxDaGFpbkZhY2FkZShhZ29yaWNDaGFpbkluZm8pO1xuICAgICAgICAgIGNoYWluQnlOYW1lLnNldChcImFnb3JpY1wiLCBoYXJkZW4oeyB2YWx1ZTogaXQsIHBlbmRpbmc6IGZhbHNlIH0pKTtcbiAgICAgICAgICByZXR1cm4gaXQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgbWFrZVJlbW90ZUNoYWluRmFjYWRlV2F0Y2hlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKFtfYWdvcmljQ2hhaW5JbmZvLCByZW1vdGVDaGFpbkluZm8sIGNvbm5lY3Rpb25JbmZvXSwgbmFtZSkge1xuICAgICAgICAgIGNvbnN0IGl0ID0gbWFrZVJlbW90ZUNoYWluRmFjYWRlKHJlbW90ZUNoYWluSW5mbywgY29ubmVjdGlvbkluZm8pO1xuICAgICAgICAgIGNoYWluQnlOYW1lLnNldChuYW1lLCBoYXJkZW4oeyB2YWx1ZTogaXQsIHBlbmRpbmc6IGZhbHNlIH0pKTtcbiAgICAgICAgICByZXR1cm4gaXQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBvcmNoZXN0cmF0b3I6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0Q2hhaW4obmFtZSkge1xuICAgICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgICBpZiAoY2hhaW5CeU5hbWUuaGFzKG5hbWUpKSB7XG4gICAgICAgICAgICAgIGNvbnN0IG1heWJlQ2hhaW4gPSBjaGFpbkJ5TmFtZS5nZXQobmFtZSk7XG4gICAgICAgICAgICAgIHJldHVybiBtYXliZUNoYWluLnBlbmRpbmcgPyBtYXliZUNoYWluLnZvdyA6IG1heWJlQ2hhaW4udmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB2b3cgPSBuYW1lID09PSBcImFnb3JpY1wiID8gd2F0Y2goXG4gICAgICAgICAgICAgIGNoYWluSHViLmdldENoYWluSW5mbyhcImFnb3JpY1wiKSxcbiAgICAgICAgICAgICAgdGhpcy5mYWNldHMubWFrZUxvY2FsQ2hhaW5GYWNhZGVXYXRjaGVyXG4gICAgICAgICAgICApIDogd2F0Y2goXG4gICAgICAgICAgICAgIGNoYWluSHViLmdldENoYWluc0FuZENvbm5lY3Rpb24oXCJhZ29yaWNcIiwgbmFtZSksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLm1ha2VSZW1vdGVDaGFpbkZhY2FkZVdhdGNoZXIsXG4gICAgICAgICAgICAgIG5hbWVcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjaGFpbkJ5TmFtZS5pbml0KG5hbWUsIGhhcmRlbih7IHZvdywgcGVuZGluZzogdHJ1ZSB9KSk7XG4gICAgICAgICAgICByZXR1cm4gdm93O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgZ2V0RGVub21JbmZvKGRlbm9tLCBob2xkaW5nQ2hhaW5OYW1lKSB7XG4gICAgICAgICAgY29uc3QgZGVub21EZXRhaWwgPSBjaGFpbkh1Yi5nZXRBc3NldChkZW5vbSwgaG9sZGluZ0NoYWluTmFtZSk7XG4gICAgICAgICAgaWYgKCFkZW5vbURldGFpbCkgdGhyb3cgdGhyb3dSZWRhY3RlZGBObyBkZW5vbSBkZXRhaWwgZm9yICR7cXVvdGUoZGVub20pfWA7XG4gICAgICAgICAgY29uc3QgeyBjaGFpbk5hbWUsIGJhc2VOYW1lLCBiYXNlRGVub20sIGJyYW5kIH0gPSBkZW5vbURldGFpbDtcbiAgICAgICAgICBjaGFpbkJ5TmFtZS5oYXMoY2hhaW5OYW1lKSB8fCB0aHJvd1JlZGFjdGVkYHVzZSBnZXRDaGFpbigke3F1b3RlKGNoYWluTmFtZSl9KSBiZWZvcmUgZ2V0RGVub21JbmZvKCR7cXVvdGUoZGVub20pfSlgO1xuICAgICAgICAgIGNvbnN0IG1heWJlQ2hhaW4gPSBjaGFpbkJ5TmFtZS5nZXQoY2hhaW5OYW1lKTtcbiAgICAgICAgICBpZiAobWF5YmVDaGFpbi5wZW5kaW5nKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYHdhaXQgdW50aWwgZ2V0Q2hhaW4oJHtxdW90ZShjaGFpbk5hbWUpfSkgY29tcGxldGVzIGJlZm9yZSBnZXREZW5vbUluZm8oJHtxdW90ZShkZW5vbSl9KWA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGNoYWluID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgbWF5YmVDaGFpbi52YWx1ZVxuICAgICAgICAgICk7XG4gICAgICAgICAgY2hhaW5CeU5hbWUuaGFzKGJhc2VOYW1lKSB8fCB0aHJvd1JlZGFjdGVkYHVzZSBnZXRDaGFpbigke3F1b3RlKGJhc2VOYW1lKX0pIGJlZm9yZSBnZXREZW5vbUluZm8oJHtxdW90ZShkZW5vbSl9KWA7XG4gICAgICAgICAgY29uc3QgbWF5YmVCYXNlID0gY2hhaW5CeU5hbWUuZ2V0KGJhc2VOYW1lKTtcbiAgICAgICAgICBpZiAobWF5YmVCYXNlLnBlbmRpbmcpIHtcbiAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRgd2FpdCB1bnRpbCBnZXRDaGFpbigke3F1b3RlKGJhc2VOYW1lKX0pIGNvbXBsZXRlcyBiZWZvcmUgZ2V0RGVub21JbmZvKCR7cXVvdGUoZGVub20pfSlgO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBiYXNlMiA9IChcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG1heWJlQmFzZS52YWx1ZVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGhhcmRlbih7IGNoYWluLCBiYXNlOiBiYXNlMiwgYnJhbmQsIGJhc2VEZW5vbSB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYXNBbW91bnQ6ICgpID0+IHRocm93UmVkYWN0ZWRgbm90IHlldCBpbXBsZW1lbnRlZGBcbiAgICAgIH1cbiAgICB9XG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVPcmNoZXN0cmF0b3JLaXQpO1xudmFyIHByZXBhcmVPcmNoZXN0cmF0b3IgPSAoem9uZSwgcG93ZXJzKSA9PiB7XG4gIGNvbnN0IG1ha2VPcmNoZXN0cmF0b3JLaXQgPSBwcmVwYXJlT3JjaGVzdHJhdG9yS2l0KHpvbmUsIHBvd2Vycyk7XG4gIHJldHVybiBwaWNrRmFjZXQobWFrZU9yY2hlc3RyYXRvcktpdCwgXCJvcmNoZXN0cmF0b3JcIik7XG59O1xuXG4vL1xudmFyIHRyYWNlNyA9IG1ha2VUcmFjZXIoXCJSZW1vdGVDaGFpbkZhY2FkZVwiKTtcbnZhciBwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGVLaXQgPSAoem9uZSwge1xuICBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnQsXG4gIG9yY2hlc3RyYXRpb24sXG4gIC8vXG4gIC8vXG4gIHN0b3JhZ2VOb2RlLFxuICB0aW1lcixcbiAgdm93VG9vbHM6IHsgYWxsVm93cywgYXNWb3csIHdhdGNoIH1cbn0pID0+IHpvbmUuZXhvQ2xhc3NLaXQoXG4gIFwiUmVtb3RlQ2hhaW5GYWNhZGVcIixcbiAge1xuICAgIHB1YmxpYzogTS5pbnRlcmZhY2UoXCJSZW1vdGVDaGFpbkZhY2FkZVwiLCB7XG4gICAgICAuLi5jaGFpbkZhY2FkZU1ldGhvZHMsXG4gICAgICBxdWVyeTogTS5jYWxsKE0uYXJyYXlPZihJQ1FNc2dTaGFwZSkpLnJldHVybnMoVm93U2hhcGUpXG4gICAgfSksXG4gICAgbWFrZUlDUUNvbm5lY3Rpb25RdWVyeVdhdGNoZXI6IE0uaW50ZXJmYWNlKFxuICAgICAgXCJtYWtlSUNRQ29ubmVjdGlvblF1ZXJ5V2F0Y2hlclwiLFxuICAgICAge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ucmVtb3RhYmxlKCksIE0uYXJyYXlPZihJQ1FNc2dTaGFwZSkpLnJldHVybnMoXG4gICAgICAgICAgVm93U2hhcGVcbiAgICAgICAgKVxuICAgICAgfVxuICAgICksXG4gICAgbWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlcjogTS5pbnRlcmZhY2UoXG4gICAgICBcIm1ha2VBY2NvdW50QW5kUHJvdmlkZVF1ZXJ5Q29ubldhdGNoZXJcIixcbiAgICAgIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChbXG4gICAgICAgICAgTS5yZW1vdGFibGUoKSxcbiAgICAgICAgICBNLm9yKE0ucmVtb3RhYmxlKCksIE0udW5kZWZpbmVkKCkpXG4gICAgICAgIF0pLnJldHVybnMoVm93U2hhcGUpXG4gICAgICB9XG4gICAgKSxcbiAgICBnZXRBZGRyZXNzZXNXYXRjaGVyOiBNLmludGVyZmFjZShcImdldEFkZHJlc3NXYXRjaGVyXCIsIHtcbiAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoXG4gICAgICAgIFtDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSwgTS5zdHJpbmcoKSwgTS5zdHJpbmcoKV0sXG4gICAgICAgIE0ucmVtb3RhYmxlKClcbiAgICAgICkucmV0dXJucyhWb3dTaGFwZSlcbiAgICB9KSxcbiAgICBtYWtlQ2hpbGROb2RlV2F0Y2hlcjogTS5pbnRlcmZhY2UoXCJtYWtlQ2hpbGROb2RlV2F0Y2hlclwiLCB7XG4gICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0ub3IoTS5yZW1vdGFibGUoKSwgTS51bmRlZmluZWQoKSksIHtcbiAgICAgICAgYWNjb3VudDogTS5yZW1vdGFibGUoKSxcbiAgICAgICAgY2hhaW5BZGRyZXNzOiBDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSxcbiAgICAgICAgbG9jYWxBZGRyZXNzOiBNLnN0cmluZygpLFxuICAgICAgICByZW1vdGVBZGRyZXNzOiBNLnN0cmluZygpXG4gICAgICB9KS5yZXR1cm5zKE0ucmVtb3RhYmxlKCkpXG4gICAgfSlcbiAgfSxcbiAgLypcblxuXG4gICAqL1xuICAocmVtb3RlQ2hhaW5JbmZvLCBjb25uZWN0aW9uSW5mbykgPT4ge1xuICAgIHRyYWNlNyhcIm1ha2luZyBhIFJlbW90ZUNoYWluRmFjYWRlXCIpO1xuICAgIHJldHVybiAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICB7XG4gICAgICAgIHJlbW90ZUNoYWluSW5mbyxcbiAgICAgICAgY29ubmVjdGlvbkluZm8sXG4gICAgICAgIGljcUNvbm5lY3Rpb246IHZvaWQgMFxuICAgICAgfVxuICAgICk7XG4gIH0sXG4gIHtcbiAgICBwdWJsaWM6IHtcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBnZXRDaGFpbkluZm8oKSB7XG4gICAgICAgIHJldHVybiB3YXRjaCh0aGlzLnN0YXRlLnJlbW90ZUNoYWluSW5mbyk7XG4gICAgICB9LFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgbWFrZUFjY291bnQoKSB7XG4gICAgICAgIHJldHVybiBhc1ZvdygoKSA9PiB7XG4gICAgICAgICAgY29uc3QgeyByZW1vdGVDaGFpbkluZm8sIGNvbm5lY3Rpb25JbmZvIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChyZW1vdGVDaGFpbkluZm8ubmFtZXNwYWNlICE9PSBcImNvc21vc1wiKSB7XG4gICAgICAgICAgICB0aHJvdyB0aHJvd1JlZGFjdGVkYG9ubHkgc3VwcG9ydGVkIG9uICdjb3Ntb3MnIGNoYWlucywgbm90ICR7cmVtb3RlQ2hhaW5JbmZvLm5hbWVzcGFjZX1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWNvbm5lY3Rpb25JbmZvKSB0aHJvdyB0aHJvd1JlZGFjdGVkYElCQyBjb25uZWN0aW9uIGluZm8gbm90IGZvdW5kYDtcbiAgICAgICAgICBjb25zdCBpY3FDb25uT3JVbmRlZmluZWRWID0gKFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICByZW1vdGVDaGFpbkluZm8/LmljcUVuYWJsZWQgJiYgIXRoaXMuc3RhdGUuaWNxQ29ubmVjdGlvbiA/IEUob3JjaGVzdHJhdGlvbikucHJvdmlkZUlDUUNvbm5lY3Rpb24oY29ubmVjdGlvbkluZm8uaWQpIDogdm9pZCAwXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCBtYWtlQWNjb3VudFYgPSBFKG9yY2hlc3RyYXRpb24pLm1ha2VBY2NvdW50KFxuICAgICAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICByZW1vdGVDaGFpbkluZm8uY2hhaW5JZCxcbiAgICAgICAgICAgIGNvbm5lY3Rpb25JbmZvLmNvdW50ZXJwYXJ0eS5jb25uZWN0aW9uX2lkLFxuICAgICAgICAgICAgY29ubmVjdGlvbkluZm8uaWRcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgIGFsbFZvd3MoW21ha2VBY2NvdW50ViwgaWNxQ29ubk9yVW5kZWZpbmVkVl0pLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMubWFrZUFjY291bnRBbmRQcm92aWRlUXVlcnlDb25uV2F0Y2hlclxuICAgICAgICAgICk7XG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHF1ZXJ5KG1zZ3MpIHtcbiAgICAgICAgcmV0dXJuIGFzVm93KCgpID0+IHtcbiAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICByZW1vdGVDaGFpbkluZm86IHsgaWNxRW5hYmxlZCwgY2hhaW5JZCB9LFxuICAgICAgICAgICAgY29ubmVjdGlvbkluZm9cbiAgICAgICAgICB9ID0gKFxuICAgICAgICAgICAgLypcblxuXG5cblxuICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuc3RhdGVcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghaWNxRW5hYmxlZCkge1xuICAgICAgICAgICAgdGhyb3cgdGhyb3dSZWRhY3RlZGBRdWVyaWVzIG5vdCBhdmFpbGFibGUgZm9yIGNoYWluICR7cXVvdGUoY2hhaW5JZCl9YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFjb25uZWN0aW9uSW5mbykgdGhyb3cgdGhyb3dSZWRhY3RlZGBJQkMgY29ubmVjdGlvbiBpbmZvIG5vdCBmb3VuZGA7XG4gICAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB3YXRjaChcbiAgICAgICAgICAgICAgRShvcmNoZXN0cmF0aW9uKS5wcm92aWRlSUNRQ29ubmVjdGlvbihjb25uZWN0aW9uSW5mby5pZCksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLm1ha2VJQ1FDb25uZWN0aW9uUXVlcnlXYXRjaGVyLFxuICAgICAgICAgICAgICBtc2dzXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gd2F0Y2goRSh0aGlzLnN0YXRlLmljcUNvbm5lY3Rpb24pLnF1ZXJ5KG1zZ3MpKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtYWtlQWNjb3VudEFuZFByb3ZpZGVRdWVyeUNvbm5XYXRjaGVyOiB7XG4gICAgICAvKlxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKFthY2NvdW50LCBpY3FDb25uZWN0aW9uXSkge1xuICAgICAgICBpZiAoaWNxQ29ubmVjdGlvbiAmJiAhdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uKSB7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5pY3FDb25uZWN0aW9uID0gaWNxQ29ubmVjdGlvbjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gd2F0Y2goXG4gICAgICAgICAgYWxsVm93cyhbXG4gICAgICAgICAgICBFKGFjY291bnQpLmdldEFkZHJlc3MoKSxcbiAgICAgICAgICAgIEUoYWNjb3VudCkuZ2V0TG9jYWxBZGRyZXNzKCksXG4gICAgICAgICAgICBFKGFjY291bnQpLmdldFJlbW90ZUFkZHJlc3MoKVxuICAgICAgICAgIF0pLFxuICAgICAgICAgIHRoaXMuZmFjZXRzLmdldEFkZHJlc3Nlc1dhdGNoZXIsXG4gICAgICAgICAgYWNjb3VudFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFrZUlDUUNvbm5lY3Rpb25RdWVyeVdhdGNoZXI6IHtcbiAgICAgIC8qXG5cblxuXG4gICAgICAgKi9cbiAgICAgIG9uRnVsZmlsbGVkKGljcUNvbm5lY3Rpb24sIG1zZ3MpIHtcbiAgICAgICAgaWYgKCF0aGlzLnN0YXRlLmljcUNvbm5lY3Rpb24pIHtcbiAgICAgICAgICB0aGlzLnN0YXRlLmljcUNvbm5lY3Rpb24gPSBpY3FDb25uZWN0aW9uO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB3YXRjaChFKGljcUNvbm5lY3Rpb24pLnF1ZXJ5KG1zZ3MpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGdldEFkZHJlc3Nlc1dhdGNoZXI6IHtcbiAgICAgIC8qXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChbY2hhaW5BZGRyZXNzLCBsb2NhbEFkZHJlc3MsIHJlbW90ZUFkZHJlc3NdLCBhY2NvdW50KSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbmFsU3RvcmFnZU5vZGUgPSBzdG9yYWdlTm9kZSA/IEUoc3RvcmFnZU5vZGUpLm1ha2VDaGlsZE5vZGUoY2hhaW5BZGRyZXNzLnZhbHVlKSA6IHZvaWQgMDtcbiAgICAgICAgcmV0dXJuIHdhdGNoKG9wdGlvbmFsU3RvcmFnZU5vZGUsIHRoaXMuZmFjZXRzLm1ha2VDaGlsZE5vZGVXYXRjaGVyLCB7XG4gICAgICAgICAgYWNjb3VudCxcbiAgICAgICAgICBjaGFpbkFkZHJlc3MsXG4gICAgICAgICAgbG9jYWxBZGRyZXNzLFxuICAgICAgICAgIHJlbW90ZUFkZHJlc3NcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtYWtlQ2hpbGROb2RlV2F0Y2hlcjoge1xuICAgICAgLypcblxuXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBvbkZ1bGZpbGxlZChjaGlsZE5vZGUsIHsgYWNjb3VudCwgY2hhaW5BZGRyZXNzLCBsb2NhbEFkZHJlc3MsIHJlbW90ZUFkZHJlc3MgfSkge1xuICAgICAgICBjb25zdCB7IGljcUNvbm5lY3Rpb24gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIHJldHVybiBtYWtlQ29zbW9zT3JjaGVzdHJhdGlvbkFjY291bnQoXG4gICAgICAgICAge1xuICAgICAgICAgICAgY2hhaW5BZGRyZXNzLFxuICAgICAgICAgICAgbG9jYWxBZGRyZXNzLFxuICAgICAgICAgICAgcmVtb3RlQWRkcmVzc1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgYWNjb3VudCxcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBzdG9yYWdlTm9kZTogY2hpbGROb2RlLFxuICAgICAgICAgICAgaWNxQ29ubmVjdGlvbixcbiAgICAgICAgICAgIHRpbWVyXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuKTtcbmhhcmRlbihwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGVLaXQpO1xudmFyIHByZXBhcmVSZW1vdGVDaGFpbkZhY2FkZSA9ICh6b25lLCBwb3dlcnMpID0+IHtcbiAgY29uc3QgbWFrZUxvY2FsQ2hhaW5GYWNhZGVLaXQgPSBwcmVwYXJlUmVtb3RlQ2hhaW5GYWNhZGVLaXQoem9uZSwgcG93ZXJzKTtcbiAgcmV0dXJuIHBpY2tGYWNldChtYWtlTG9jYWxDaGFpbkZhY2FkZUtpdCwgXCJwdWJsaWNcIik7XG59O1xuaGFyZGVuKHByZXBhcmVSZW1vdGVDaGFpbkZhY2FkZSk7XG5cbi8vXG52YXIgbWFrZU9yY2hlc3RyYXRpb25GYWNhZGUgPSAoe1xuICB6b25lLFxuICB0aW1lclNlcnZpY2UsXG4gIHpjZixcbiAgb3JjaGVzdHJhdGlvblNlcnZpY2UsXG4gIG1ha2VPcmNoZXN0cmF0b3IsXG4gIHZvd1Rvb2xzLFxuICBhc3luY0Zsb3dUb29sc1xufSkgPT4ge1xuICBhc3NlcnRBbGxEZWZpbmVkKHtcbiAgICB6b25lLFxuICAgIHRpbWVyU2VydmljZSxcbiAgICB6Y2YsXG4gICAgb3JjaGVzdHJhdGlvblNlcnZpY2UsXG4gICAgbWFrZU9yY2hlc3RyYXRvcixcbiAgICB2b3dUb29scyxcbiAgICBhc3luY0Zsb3dUb29sc1xuICB9KTtcbiAgY29uc3QgeyBwcmVwYXJlRW5kb3dtZW50LCBhc3luY0Zsb3cgfSA9IGFzeW5jRmxvd1Rvb2xzO1xuICBjb25zdCBvcmNoZXN0cmF0ZSA9IChkdXJhYmxlTmFtZSwgaG9zdEN0eCwgZ3Vlc3RGbikgPT4ge1xuICAgIGNvbnN0IHN1YlpvbmUgPSB6b25lLnN1YlpvbmUoZHVyYWJsZU5hbWUpO1xuICAgIGNvbnN0IFt3cmFwcGVkQ3R4XSA9IHByZXBhcmVFbmRvd21lbnQoc3ViWm9uZSwgXCJlbmRvd21lbnRzXCIsIFtob3N0Q3R4XSk7XG4gICAgY29uc3QgaG9zdEZuID0gYXN5bmNGbG93KHN1YlpvbmUsIFwiYXN5bmNGbG93XCIsIGd1ZXN0Rm4pO1xuICAgIGRlZXBNYXBPYmplY3QoXG4gICAgICB3cmFwcGVkQ3R4LFxuICAgICAgKHZhbCkgPT4gdmFsID09PSB6Y2YgJiYgYXNzZXJ0LmZhaWwoXCJkbyBub3QgdXNlIHpjZiBpbiBvcmNoZXN0cmF0aW9uIGNvbnRleHQ7IHRyeSB6Y2ZUb29sc1wiKVxuICAgICk7XG4gICAgY29uc3Qgb3JjRm4gPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAoLi4uYXJncykgPT4ge1xuICAgICAgICBjb25zdCBob3N0T3JjID0gbWFrZU9yY2hlc3RyYXRvcigpO1xuICAgICAgICByZXR1cm4gaG9zdEZuKGhvc3RPcmMsIHdyYXBwZWRDdHgsIC4uLmFyZ3MpO1xuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuIGhhcmRlbihvcmNGbik7XG4gIH07XG4gIGNvbnN0IG9yY2hlc3RyYXRlQWxsID0gKGd1ZXN0Rm5zLCBob3N0Q3R4KSA9PiB7XG4gICAgY29uc3QgbWFwcGVkRmxvd3MgPSBuZXcgTWFwKFxuICAgICAgT2JqZWN0LmVudHJpZXMoZ3Vlc3RGbnMpLm1hcCgoW25hbWUsIGd1ZXN0Rm5dKSA9PiBbXG4gICAgICAgIGd1ZXN0Rm4sXG4gICAgICAgICguLi5hcmdzKSA9PiBvcmNGbnNbbmFtZV0oLi4uYXJncylcbiAgICAgIF0pXG4gICAgKTtcbiAgICBjb25zdCBtYXBwZWRDb250ZXh0ID0gZGVlcE1hcE9iamVjdChcbiAgICAgIGhvc3RDdHgsXG4gICAgICAodmFsKSA9PiBtYXBwZWRGbG93cy5nZXQoXG4gICAgICAgIC8qICAgICAgICAgICAgICAqL1xuICAgICAgICB2YWxcbiAgICAgICkgfHwgdmFsXG4gICAgKTtcbiAgICBjb25zdCBvcmNGbnMgPSAoXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoZ3Vlc3RGbnMpLm1hcCgoW25hbWUsIGd1ZXN0Rm5dKSA9PiBbXG4gICAgICAgICAgbmFtZSxcbiAgICAgICAgICBvcmNoZXN0cmF0ZShuYW1lLCBtYXBwZWRDb250ZXh0LCBndWVzdEZuKVxuICAgICAgICBdKVxuICAgICAgKVxuICAgICk7XG4gICAgcmV0dXJuIHsgLi4ub3JjRm5zIH07XG4gIH07XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIG9yY2hlc3RyYXRlLFxuICAgIG9yY2hlc3RyYXRlQWxsXG4gIH0pO1xufTtcbmhhcmRlbihtYWtlT3JjaGVzdHJhdGlvbkZhY2FkZSk7XG5cbi8vXG52YXIgbmF0U2FmZU1hdGggPSBoYXJkZW4oe1xuICAvKiAgICAgICAgICAgICAgICAqL1xuICAvL1xuICBhZGQ6ICh4LCB5KSA9PiBOYXQoeCkgKyBOYXQoeSksXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHN1YnRyYWN0OiAoeCwgeSkgPT4gTmF0KE5hdCh4KSAtIE5hdCh5KSksXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIG11bHRpcGx5OiAoeCwgeSkgPT4gTmF0KHgpICogTmF0KHkpLFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICBmbG9vckRpdmlkZTogKHgsIHkpID0+IE5hdCh4KSAvIE5hdCh5KSxcbiAgLyogICAgICAgICAgICAgICAgKi9cbiAgY2VpbERpdmlkZTogKHgsIHkpID0+IHtcbiAgICB5ID0gTmF0KHkpO1xuICAgIHJldHVybiBOYXQoTmF0KHgpICsgeSAtIDFuKSAvIHk7XG4gIH0sXG4gIC8qXG5cblxuXG5cbiAgICovXG4gIGJhbmtlcnNEaXZpZGU6IChhMiwgYjMpID0+IHtcbiAgICBhMiA9IE5hdChhMik7XG4gICAgYjMgPSBOYXQoYjMpO1xuICAgIGNvbnN0IGRpdiA9IGEyIC8gYjM7XG4gICAgY29uc3QgcmVtID0gYTIgJSBiMztcbiAgICBpZiAocmVtICogMm4gPiBiMykge1xuICAgICAgcmV0dXJuIGRpdiArIDFuO1xuICAgIH0gZWxzZSBpZiAocmVtICogMm4gPT09IGIzKSB7XG4gICAgICBpZiAoZGl2ICUgMm4gPT09IDFuKSByZXR1cm4gZGl2ICsgMW47XG4gICAgfVxuICAgIHJldHVybiBkaXY7XG4gIH0sXG4gIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICBpc0dURTogKHgsIHkpID0+IE5hdCh4KSA+PSBOYXQoeSlcbn0pO1xuXG4vL1xudmFyIHsgc3VidHJhY3QsIGFkZCwgbXVsdGlwbHksIGZsb29yRGl2aWRlIH0gPSBuYXRTYWZlTWF0aDtcblxuLy9cbnZhciBtYWtlU3RhdGVNYWNoaW5lID0gKGluaXRpYWxTdGF0ZSwgYWxsb3dlZFRyYW5zaXRpb25zQXJyYXkpID0+IHtcbiAgbGV0IHN0YXRlID0gaW5pdGlhbFN0YXRlO1xuICBjb25zdCBhbGxvd2VkVHJhbnNpdGlvbnMgPSBuZXcgTWFwKGFsbG93ZWRUcmFuc2l0aW9uc0FycmF5KTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgY2FuVHJhbnNpdGlvblRvOiAobmV4dFN0YXRlKSA9PiBhbGxvd2VkVHJhbnNpdGlvbnMuZ2V0KHN0YXRlKS5pbmNsdWRlcyhuZXh0U3RhdGUpLFxuICAgIHRyYW5zaXRpb25UbzogKG5leHRTdGF0ZSkgPT4ge1xuICAgICAgYXNzZXJ0MihhbGxvd2VkVHJhbnNpdGlvbnMuZ2V0KHN0YXRlKS5pbmNsdWRlcyhuZXh0U3RhdGUpKTtcbiAgICAgIHN0YXRlID0gbmV4dFN0YXRlO1xuICAgIH0sXG4gICAgZ2V0U3RhdHVzOiAoXykgPT4gc3RhdGVcbiAgfSk7XG59O1xuaGFyZGVuKG1ha2VTdGF0ZU1hY2hpbmUpO1xuXG4vL1xudmFyIEtleXdvcmRTaGFwZSA9IE0uc3RyaW5nKCk7XG52YXIgSW52aXRhdGlvbkhhbmRsZVNoYXBlID0gTS5yZW1vdGFibGUoXCJJbnZpdGF0aW9uSGFuZGxlXCIpO1xudmFyIEludml0YXRpb25TaGFwZSA9IE0ucmVtb3RhYmxlKFwiSW52aXRhdGlvblwiKTtcbnZhciBJbnN0YW5jZUhhbmRsZVNoYXBlID0gTS5yZW1vdGFibGUoXCJJbnN0YW5jZUhhbmRsZVwiKTtcbnZhciBJbnN0YWxsYXRpb25TaGFwZSA9IE0ucmVtb3RhYmxlKFwiSW5zdGFsbGF0aW9uXCIpO1xudmFyIFNlYXRTaGFwZSA9IE0ucmVtb3RhYmxlKFwiU2VhdFwiKTtcbnZhciBBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUgPSBNLnJlY29yZE9mKEtleXdvcmRTaGFwZSwgQW1vdW50U2hhcGUpO1xudmFyIEFtb3VudFBhdHRlcm5LZXl3b3JkUmVjb3JkU2hhcGUgPSBNLnJlY29yZE9mKFxuICBLZXl3b3JkU2hhcGUsXG4gIE0ucGF0dGVybigpXG4pO1xudmFyIFBheW1lbnRQS2V5d29yZFJlY29yZFNoYXBlID0gTS5yZWNvcmRPZihcbiAgS2V5d29yZFNoYXBlLFxuICBNLmVyZWYoUGF5bWVudFNoYXBlKVxuKTtcbnZhciBJc3N1ZXJLZXl3b3JkUmVjb3JkU2hhcGUgPSBNLnJlY29yZE9mKEtleXdvcmRTaGFwZSwgSXNzdWVyU2hhcGUpO1xudmFyIElzc3VlclBLZXl3b3JkUmVjb3JkU2hhcGUgPSBNLnJlY29yZE9mKFxuICBLZXl3b3JkU2hhcGUsXG4gIE0uZXJlZihJc3N1ZXJTaGFwZSlcbik7XG52YXIgQnJhbmRLZXl3b3JkUmVjb3JkU2hhcGUgPSBNLnJlY29yZE9mKEtleXdvcmRTaGFwZSwgQnJhbmRTaGFwZSk7XG52YXIgSXNzdWVyUmVjb3JkU2hhcGUgPSBNLnNwbGl0UmVjb3JkKFxuICB7XG4gICAgYnJhbmQ6IEJyYW5kU2hhcGUsXG4gICAgaXNzdWVyOiBJc3N1ZXJTaGFwZSxcbiAgICBhc3NldEtpbmQ6IEFzc2V0S2luZFNoYXBlXG4gIH0sXG4gIHsgZGlzcGxheUluZm86IERpc3BsYXlJbmZvU2hhcGUgfVxuKTtcbnZhciBUZXJtc1NoYXBlID0ge1xuICBpc3N1ZXJzOiBJc3N1ZXJLZXl3b3JkUmVjb3JkU2hhcGUsXG4gIGJyYW5kczogQnJhbmRLZXl3b3JkUmVjb3JkU2hhcGVcbn07XG5oYXJkZW4oVGVybXNTaGFwZSk7XG52YXIgSW5zdGFuY2VSZWNvcmRTaGFwZSA9IHtcbiAgaW5zdGFsbGF0aW9uOiBJbnN0YWxsYXRpb25TaGFwZSxcbiAgaW5zdGFuY2U6IEluc3RhbmNlSGFuZGxlU2hhcGUsXG4gIHRlcm1zOiBNLnNwbGl0UmVjb3JkKFRlcm1zU2hhcGUpXG59O1xuaGFyZGVuKEluc3RhbmNlUmVjb3JkU2hhcGUpO1xudmFyIEhhbmRsZUkgPSBNLmludGVyZmFjZShcIkhhbmRsZVwiLCB7fSk7XG52YXIgbWFrZUhhbmRsZVNoYXBlID0gKG5hbWUpID0+IE0ucmVtb3RhYmxlKGAke25hbWV9SGFuZGxlYCk7XG52YXIgVGltZXJTaGFwZSA9IG1ha2VIYW5kbGVTaGFwZShcInRpbWVyXCIpO1xudmFyIEZ1bGxQcm9wb3NhbFNoYXBlID0ge1xuICB3YW50OiBBbW91bnRQYXR0ZXJuS2V5d29yZFJlY29yZFNoYXBlLFxuICBnaXZlOiBBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUsXG4gIC8vXG4gIC8vXG4gIC8vXG4gIGV4aXQ6IE0uc3BsaXRSZWNvcmQoXG4gICAge30sXG4gICAge1xuICAgICAgb25EZW1hbmQ6IG51bGwsXG4gICAgICB3YWl2ZWQ6IG51bGwsXG4gICAgICBhZnRlckRlYWRsaW5lOiB7XG4gICAgICAgIHRpbWVyOiBNLmVyZWYoVGltZXJTaGFwZSksXG4gICAgICAgIGRlYWRsaW5lOiBUaW1lc3RhbXBTaGFwZVxuICAgICAgfVxuICAgIH0sXG4gICAge31cbiAgKVxufTtcbmhhcmRlbihGdWxsUHJvcG9zYWxTaGFwZSk7XG52YXIgUHJvcG9zYWxTaGFwZSA9IE0uc3BsaXRSZWNvcmQoe30sIEZ1bGxQcm9wb3NhbFNoYXBlLCB7fSk7XG52YXIgRW1wdHlQcm9wb3NhbFNoYXBlID0gTS5zcGxpdFJlY29yZCh7XG4gIGdpdmU6IHt9LFxuICB3YW50OiB7fSxcbiAgZXhpdDogeyBvbkRlbWFuZDogbnVsbCB9XG59KTtcbnZhciBpc09uRGVtYW5kRXhpdFJ1bGUgPSAoZXhpdCkgPT4ge1xuICBjb25zdCBbZXhpdEtleV0gPSBPYmplY3Qua2V5cyhleGl0KTtcbiAgcmV0dXJuIGV4aXRLZXkgPT09IFwib25EZW1hbmRcIjtcbn07XG5oYXJkZW4oaXNPbkRlbWFuZEV4aXRSdWxlKTtcbnZhciBpc1dhaXZlZEV4aXRSdWxlID0gKGV4aXQpID0+IHtcbiAgY29uc3QgW2V4aXRLZXldID0gT2JqZWN0LmtleXMoZXhpdCk7XG4gIHJldHVybiBleGl0S2V5ID09PSBcIndhaXZlZFwiO1xufTtcbmhhcmRlbihpc1dhaXZlZEV4aXRSdWxlKTtcbnZhciBpc0FmdGVyRGVhZGxpbmVFeGl0UnVsZSA9IChleGl0KSA9PiB7XG4gIGNvbnN0IFtleGl0S2V5XSA9IE9iamVjdC5rZXlzKGV4aXQpO1xuICByZXR1cm4gZXhpdEtleSA9PT0gXCJhZnRlckRlYWRsaW5lXCI7XG59O1xuaGFyZGVuKGlzQWZ0ZXJEZWFkbGluZUV4aXRSdWxlKTtcbnZhciBJbnZpdGF0aW9uRWxlbWVudFNoYXBlID0gTS5zcGxpdFJlY29yZCh7XG4gIGRlc2NyaXB0aW9uOiBNLnN0cmluZygpLFxuICBoYW5kbGU6IEludml0YXRpb25IYW5kbGVTaGFwZSxcbiAgaW5zdGFuY2U6IEluc3RhbmNlSGFuZGxlU2hhcGUsXG4gIGluc3RhbGxhdGlvbjogSW5zdGFsbGF0aW9uU2hhcGVcbn0pO1xudmFyIE9mZmVySGFuZGxlckkgPSBNLmludGVyZmFjZShcIk9mZmVySGFuZGxlclwiLCB7XG4gIGhhbmRsZTogTS5jYWxsKFNlYXRTaGFwZSkub3B0aW9uYWwoTS5hbnkoKSkucmV0dXJucyhNLmFueSgpKVxufSk7XG52YXIgU2VhdEhhbmRsZUFsbG9jYXRpb25zU2hhcGUgPSBNLmFycmF5T2Yoe1xuICBzZWF0SGFuZGxlOiBTZWF0U2hhcGUsXG4gIGFsbG9jYXRpb246IEFtb3VudEtleXdvcmRSZWNvcmRTaGFwZVxufSk7XG52YXIgWm9lTWludFNoYXBlID0gTS5yZW1vdGFibGUoXCJab2VNaW50XCIpO1xudmFyIFpvZU1pbnRJID0gTS5pbnRlcmZhY2UoXCJab2VNaW50XCIsIHtcbiAgZ2V0SXNzdWVyUmVjb3JkOiBNLmNhbGwoKS5yZXR1cm5zKElzc3VlclJlY29yZFNoYXBlKSxcbiAgbWludEFuZEVzY3JvdzogTS5jYWxsKEFtb3VudFNoYXBlKS5yZXR1cm5zKCksXG4gIHdpdGhkcmF3QW5kQnVybjogTS5jYWxsKEFtb3VudFNoYXBlKS5yZXR1cm5zKClcbn0pO1xudmFyIEZlZU1pbnRBY2Nlc3NTaGFwZSA9IE0ucmVtb3RhYmxlKFwiRmVlTWludEFjY2Vzc1wiKTtcbnZhciBFeGl0T2JqZWN0SSA9IE0uaW50ZXJmYWNlKFwiRXhpdCBPYmplY3RcIiwge1xuICBleGl0OiBNLmNhbGwoKS5yZXR1cm5zKClcbn0pO1xudmFyIEV4aXRPYmplY3RTaGFwZSA9IE0ucmVtb3RhYmxlKFwiRXhpdE9ialwiKTtcbnZhciBJbnN0YW5jZUFkbWluU2hhcGUgPSBNLnJlbW90YWJsZShcIkluc3RhbmNlQWRtaW5cIik7XG52YXIgSW5zdGFuY2VBZG1pbkkgPSBNLmludGVyZmFjZShcIkluc3RhbmNlQWRtaW5cIiwge1xuICBtYWtlSW52aXRhdGlvbjogTS5jYWxsKEludml0YXRpb25IYW5kbGVTaGFwZSwgTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5yZWNvcmQoKSwgTS5wYXR0ZXJuKCkpLnJldHVybnMoSW52aXRhdGlvblNoYXBlKSxcbiAgc2F2ZUlzc3VlcjogTS5jYWxsV2hlbihNLmF3YWl0KElzc3VlclNoYXBlKSwgS2V5d29yZFNoYXBlKS5yZXR1cm5zKFxuICAgIElzc3VlclJlY29yZFNoYXBlXG4gICksXG4gIG1ha2VOb0VzY3Jvd1NlYXQ6IE0uY2FsbChcbiAgICBBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUsXG4gICAgUHJvcG9zYWxTaGFwZSxcbiAgICBFeGl0T2JqZWN0U2hhcGUsXG4gICAgU2VhdFNoYXBlXG4gICkucmV0dXJucyhTZWF0U2hhcGUpLFxuICBleGl0QWxsU2VhdHM6IE0uY2FsbChNLmFueSgpKS5yZXR1cm5zKCksXG4gIGZhaWxBbGxTZWF0czogTS5jYWxsKE0uYW55KCkpLnJldHVybnMoKSxcbiAgZXhpdFNlYXQ6IE0uY2FsbChTZWF0U2hhcGUsIE0uYW55KCkpLnJldHVybnMoKSxcbiAgZmFpbFNlYXQ6IE0uY2FsbChTZWF0U2hhcGUsIE0uYW55KCkpLnJldHVybnMoKSxcbiAgbWFrZVpvZU1pbnQ6IE0uY2FsbChLZXl3b3JkU2hhcGUpLm9wdGlvbmFsKFxuICAgIEFzc2V0S2luZFNoYXBlLFxuICAgIERpc3BsYXlJbmZvU2hhcGUsXG4gICAgTS5zcGxpdFJlY29yZCh7fSwgeyBlbGVtZW50U2hhcGU6IE0ucGF0dGVybigpIH0pXG4gICkucmV0dXJucyhNLnJlbW90YWJsZShcInpvZU1pbnRcIikpLFxuICByZWdpc3RlckZlZU1pbnQ6IE0uY2FsbChLZXl3b3JkU2hhcGUsIEZlZU1pbnRBY2Nlc3NTaGFwZSkucmV0dXJucyhcbiAgICBNLnJlbW90YWJsZShcImZlZU1pbnRcIilcbiAgKSxcbiAgcmVwbGFjZUFsbG9jYXRpb25zOiBNLmNhbGwoU2VhdEhhbmRsZUFsbG9jYXRpb25zU2hhcGUpLnJldHVybnMoKSxcbiAgc3RvcEFjY2VwdGluZ09mZmVyczogTS5jYWxsKCkucmV0dXJucygpLFxuICBzZXRPZmZlckZpbHRlcjogTS5jYWxsKE0uYXJyYXlPZihNLnN0cmluZygpKSkucmV0dXJucygpLFxuICBnZXRPZmZlckZpbHRlcjogTS5jYWxsKCkucmV0dXJucyhNLmFycmF5T2YoTS5zdHJpbmcoKSkpLFxuICBnZXRFeGl0U3Vic2NyaWJlcjogTS5jYWxsKFNlYXRTaGFwZSkucmV0dXJucyhTdWJzY3JpYmVyU2hhcGUpLFxuICBpc0Jsb2NrZWQ6IE0uY2FsbChNLnN0cmluZygpKS5yZXR1cm5zKE0uYm9vbGVhbigpKSxcbiAgcmVwYWlyQ29udHJhY3RDb21wbGV0aW9uV2F0Y2hlcjogTS5jYWxsKCkucmV0dXJucygpXG59KTtcbnZhciBJbnN0YW5jZVN0b3JhZ2VNYW5hZ2VySUtpdCA9IHtcbiAgaW5zdGFuY2VTdG9yYWdlTWFuYWdlcjogTS5pbnRlcmZhY2UoXCJJbnN0YW5jZVN0b3JhZ2VNYW5hZ2VyXCIsIHtcbiAgICBnZXRUZXJtczogTS5jYWxsKCkucmV0dXJucyhNLnNwbGl0UmVjb3JkKFRlcm1zU2hhcGUpKSxcbiAgICBnZXRJc3N1ZXJzOiBNLmNhbGwoKS5yZXR1cm5zKElzc3VlcktleXdvcmRSZWNvcmRTaGFwZSksXG4gICAgZ2V0QnJhbmRzOiBNLmNhbGwoKS5yZXR1cm5zKEJyYW5kS2V5d29yZFJlY29yZFNoYXBlKSxcbiAgICBnZXRJbnN0YWxsYXRpb246IE0uY2FsbCgpLnJldHVybnMoSW5zdGFsbGF0aW9uU2hhcGUpLFxuICAgIGdldEludml0YXRpb25Jc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUpLFxuICAgIHNhdmVJc3N1ZXI6IE0uY2FsbChJc3N1ZXJTaGFwZSwgS2V5d29yZFNoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICBtYWtlWm9lTWludDogTS5jYWxsKEtleXdvcmRTaGFwZSkub3B0aW9uYWwoXG4gICAgICBBc3NldEtpbmRTaGFwZSxcbiAgICAgIERpc3BsYXlJbmZvU2hhcGUsXG4gICAgICBNLnNwbGl0UmVjb3JkKHt9LCB7IGVsZW1lbnRTaGFwZTogTS5wYXR0ZXJuKCkgfSlcbiAgICApLnJldHVybnMoTS5lcmVmKFpvZU1pbnRTaGFwZSkpLFxuICAgIHJlZ2lzdGVyRmVlTWludDogTS5jYWxsKEtleXdvcmRTaGFwZSwgRmVlTWludEFjY2Vzc1NoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5yZW1vdGFibGUoXCJmZWVNaW50XCIpXG4gICAgKSxcbiAgICBnZXRJbnN0YW5jZVJlY29yZDogTS5jYWxsKCkucmV0dXJucyhJbnN0YW5jZVJlY29yZFNoYXBlKSxcbiAgICBnZXRJc3N1ZXJSZWNvcmRzOiBNLmNhbGwoKS5yZXR1cm5zKE0uYXJyYXlPZihJc3N1ZXJSZWNvcmRTaGFwZSkpLFxuICAgIGdldFdpdGhkcmF3RmFjZXQ6IE0uY2FsbCgpLnJldHVybnMoTS5yZW1vdGFibGUoXCJXaXRoZHJhd0ZhY2V0XCIpKSxcbiAgICBpbml0SW5zdGFuY2VBZG1pbjogTS5jYWxsKFxuICAgICAgSW5zdGFuY2VIYW5kbGVTaGFwZSxcbiAgICAgIE0ucmVtb3RhYmxlKFwiaW5zdGFuY2VBZG1pblwiKVxuICAgICkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgZGVsZXRlSW5zdGFuY2VBZG1pbjogTS5jYWxsKEluc3RhbmNlQWRtaW5TaGFwZSkucmV0dXJucygpLFxuICAgIG1ha2VJbnZpdGF0aW9uOiBNLmNhbGwoSW52aXRhdGlvbkhhbmRsZVNoYXBlLCBNLnN0cmluZygpKS5vcHRpb25hbChNLnJlY29yZCgpLCBNLnBhdHRlcm4oKSkucmV0dXJucyhQYXltZW50U2hhcGUpLFxuICAgIGdldFJvb3Q6IE0uY2FsbCgpLnJldHVybnMoTS5hbnkoKSksXG4gICAgZ2V0QWRtaW5Ob2RlOiBNLmNhbGwoKS5yZXR1cm5zKE0ucmVtb3RhYmxlKFwiYWRtaW5Ob2RlXCIpKVxuICB9KSxcbiAgd2l0aGRyYXdGYWNldDogTS5pbnRlcmZhY2UoXCJXaXRoZHJhd0ZhY2V0XCIsIHtcbiAgICB3aXRoZHJhd1BheW1lbnRzOiBNLmNhbGwoQW1vdW50S2V5d29yZFJlY29yZFNoYXBlKS5yZXR1cm5zKFxuICAgICAgUGF5bWVudFBLZXl3b3JkUmVjb3JkU2hhcGVcbiAgICApXG4gIH0pLFxuICBoZWxwZXJzOiBNLmludGVyZmFjZShcIkluc3RhbmNlU3RvcmFnZU1hbmFnZXIgaGVscGVyXCIsIHtcbiAgICB3cmFwSXNzdWVyS2l0V2l0aFpvZU1pbnQ6IE0uY2FsbChcbiAgICAgIEtleXdvcmRTaGFwZSxcbiAgICAgIElzc3VlcktpdFNoYXBlLFxuICAgICAgTS5yZW1vdGFibGUoXCJhZG1pbk5vZGVcIilcbiAgICApLnJldHVybnMoWm9lTWludFNoYXBlKVxuICB9KVxufTtcbmhhcmRlbihJbnN0YW5jZVN0b3JhZ2VNYW5hZ2VySUtpdCk7XG52YXIgQnVuZGxlQ2FwU2hhcGUgPSBNLnJlbW90YWJsZShcImJ1bmRsZUNhcFwiKTtcbnZhciBCdW5kbGVTaGFwZSA9IE0uYW5kKFxuICBNLnNwbGl0UmVjb3JkKHsgbW9kdWxlRm9ybWF0OiBNLmFueSgpIH0pLFxuICBNLnJlY29yZE9mKE0uc3RyaW5nKCksIE0uc3RyaW5nKHsgc3RyaW5nTGVuZ3RoTGltaXQ6IEluZmluaXR5IH0pKVxuKTtcbnZhciBVbndyYXBwZWRJbnN0YWxsYXRpb25TaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHsgaW5zdGFsbGF0aW9uOiBJbnN0YWxsYXRpb25TaGFwZSB9LFxuICB7XG4gICAgYnVuZGxlOiBNLnJlY29yZE9mKE0uc3RyaW5nKCksIE0uc3RyaW5nKHsgc3RyaW5nTGVuZ3RoTGltaXQ6IEluZmluaXR5IH0pKSxcbiAgICBidW5kbGVDYXA6IEJ1bmRsZUNhcFNoYXBlLFxuICAgIGJ1bmRsZUlEOiBNLnN0cmluZygpXG4gIH0sXG4gIHt9XG4pO1xudmFyIFpvZVN0b3JhZ2VNYW5hZ2VySUtpdCA9IHtcbiAgem9lU2VydmljZURhdGFBY2Nlc3M6IE0uaW50ZXJmYWNlKFwiWm9lU2VydmljZSBkYXRhQWNjZXNzXCIsIHtcbiAgICBnZXRUZXJtczogTS5jYWxsKEluc3RhbmNlSGFuZGxlU2hhcGUpLnJldHVybnMoTS5zcGxpdFJlY29yZChUZXJtc1NoYXBlKSksXG4gICAgZ2V0SXNzdWVyczogTS5jYWxsKEluc3RhbmNlSGFuZGxlU2hhcGUpLnJldHVybnMoSXNzdWVyS2V5d29yZFJlY29yZFNoYXBlKSxcbiAgICBnZXRCcmFuZHM6IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKEJyYW5kS2V5d29yZFJlY29yZFNoYXBlKSxcbiAgICBnZXRJbnN0YWxsYXRpb246IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5lcmVmKE0ucmVtb3RhYmxlKFwiSW5zdGFsbGF0aW9uXCIpKVxuICAgICksXG4gICAgZ2V0SW52aXRhdGlvbklzc3VlcjogTS5jYWxsKCkucmV0dXJucyhJc3N1ZXJTaGFwZSksXG4gICAgZ2V0QnVuZGxlSURGcm9tSW5zdGFsbGF0aW9uOiBNLmNhbGwoSW5zdGFsbGF0aW9uU2hhcGUpLnJldHVybnMoXG4gICAgICBNLmVyZWYoTS5zdHJpbmcoKSlcbiAgICApLFxuICAgIGluc3RhbGxCdW5kbGU6IE0uY2FsbChNLm9yKEluc3RhbmNlSGFuZGxlU2hhcGUsIEJ1bmRsZVNoYXBlKSkub3B0aW9uYWwoTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgaW5zdGFsbEJ1bmRsZUlEOiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgZ2V0UHVibGljRmFjZXQ6IE0uY2FsbChJbnN0YW5jZUhhbmRsZVNoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5lcmVmKE0ucmVtb3RhYmxlKFwiUHVibGljRmFjZXRcIikpXG4gICAgKSxcbiAgICBnZXRPZmZlckZpbHRlcjogTS5jYWxsKEluc3RhbmNlSGFuZGxlU2hhcGUpLnJldHVybnMoTS5hcnJheU9mKE0uc3RyaW5nKCkpKSxcbiAgICBnZXRQcm9wb3NhbFNoYXBlRm9ySW52aXRhdGlvbjogTS5jYWxsKEludml0YXRpb25IYW5kbGVTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ub3B0KE0ucGF0dGVybigpKVxuICAgIClcbiAgfSksXG4gIG1ha2VPZmZlckFjY2VzczogTS5pbnRlcmZhY2UoXCJab2VTdG9yYWdlIG1ha2VPZmZlciBhY2Nlc3NcIiwge1xuICAgIGdldEFzc2V0S2luZEJ5QnJhbmQ6IE0uY2FsbChCcmFuZFNoYXBlKS5yZXR1cm5zKEFzc2V0S2luZFNoYXBlKSxcbiAgICBnZXRJbnN0YW5jZUFkbWluOiBNLmNhbGwoSW5zdGFuY2VIYW5kbGVTaGFwZSkucmV0dXJucyhcbiAgICAgIE0ucmVtb3RhYmxlKFwiaW5zdGFuY2VBZG1pblwiKVxuICAgICksXG4gICAgZ2V0UHJvcG9zYWxTaGFwZUZvckludml0YXRpb246IE0uY2FsbChJbnZpdGF0aW9uSGFuZGxlU2hhcGUpLnJldHVybnMoXG4gICAgICBNLm9wdChNLnBhdHRlcm4oKSlcbiAgICApLFxuICAgIGdldEludml0YXRpb25Jc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUpLFxuICAgIGRlcG9zaXRQYXltZW50czogTS5jYWxsKFByb3Bvc2FsU2hhcGUsIFBheW1lbnRQS2V5d29yZFJlY29yZFNoYXBlKS5yZXR1cm5zKFxuICAgICAgTS5wcm9taXNlKClcbiAgICApXG4gIH0pLFxuICBzdGFydEluc3RhbmNlQWNjZXNzOiBNLmludGVyZmFjZShcIlpvZVN0b3JhZ2Ugc3RhcnRJbnN0YW5jZSBhY2Nlc3NcIiwge1xuICAgIG1ha2Vab2VJbnN0YW5jZVN0b3JhZ2VNYW5hZ2VyOiBNLmNhbGwoXG4gICAgICBJbnN0YWxsYXRpb25TaGFwZSxcbiAgICAgIE0uYW55KCksXG4gICAgICBJc3N1ZXJQS2V5d29yZFJlY29yZFNoYXBlLFxuICAgICAgTS5vcihJbnN0YW5jZUhhbmRsZVNoYXBlLCBCdW5kbGVTaGFwZSksXG4gICAgICBNLm9yKEJ1bmRsZUNhcFNoYXBlLCBCdW5kbGVTaGFwZSksXG4gICAgICBNLnN0cmluZygpXG4gICAgKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICB1bndyYXBJbnN0YWxsYXRpb246IE0uY2FsbFdoZW4oTS5lcmVmKEluc3RhbGxhdGlvblNoYXBlKSkucmV0dXJucyhcbiAgICAgIFVud3JhcHBlZEluc3RhbGxhdGlvblNoYXBlXG4gICAgKVxuICB9KSxcbiAgaW52aXRhdGlvbklzc3VlckFjY2VzczogTS5pbnRlcmZhY2UoXCJab2VTdG9yYWdlIGludml0YXRpb25Jc3N1ZXJcIiwge1xuICAgIGdldEludml0YXRpb25Jc3N1ZXI6IE0uY2FsbCgpLnJldHVybnMoSXNzdWVyU2hhcGUpXG4gIH0pXG59O1xuaGFyZGVuKFpvZVN0b3JhZ2VNYW5hZ2VySUtpdCk7XG52YXIgWm9lU2VydmljZUkgPSBNLmludGVyZmFjZShcIlpvZVNlcnZpY2VcIiwge1xuICBpbnN0YWxsOiBNLmNhbGwoTS5hbnkoKSkub3B0aW9uYWwoTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGluc3RhbGxCdW5kbGVJRDogTS5jYWxsKE0uc3RyaW5nKCkpLm9wdGlvbmFsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBzdGFydEluc3RhbmNlOiBNLmNhbGwoTS5lcmVmKEluc3RhbGxhdGlvblNoYXBlKSkub3B0aW9uYWwoSXNzdWVyUEtleXdvcmRSZWNvcmRTaGFwZSwgTS5yZWNvcmQoKSwgTS5yZWNvcmQoKSwgTS5zdHJpbmcoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIG9mZmVyOiBNLmNhbGwoTS5lcmVmKEludml0YXRpb25TaGFwZSkpLm9wdGlvbmFsKFByb3Bvc2FsU2hhcGUsIFBheW1lbnRQS2V5d29yZFJlY29yZFNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0T2ZmZXJGaWx0ZXI6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBNLmFycmF5T2YoTS5zdHJpbmcoKSlcbiAgKSxcbiAgZ2V0SW52aXRhdGlvbklzc3VlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldEZlZUlzc3VlcjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldEJyYW5kczogTS5jYWxsV2hlbihNLmF3YWl0KEluc3RhbmNlSGFuZGxlU2hhcGUpKS5yZXR1cm5zKFxuICAgIEJyYW5kS2V5d29yZFJlY29yZFNoYXBlXG4gICksXG4gIGdldElzc3VlcnM6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBJc3N1ZXJLZXl3b3JkUmVjb3JkU2hhcGVcbiAgKSxcbiAgZ2V0UHVibGljRmFjZXQ6IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YW5jZUhhbmRsZVNoYXBlKSkucmV0dXJucyhcbiAgICBNLnJlbW90YWJsZShcIlB1YmxpY0ZhY2V0XCIpXG4gICksXG4gIGdldFRlcm1zOiBNLmNhbGxXaGVuKE0uYXdhaXQoSW5zdGFuY2VIYW5kbGVTaGFwZSkpLnJldHVybnMoTS5hbnkoKSksXG4gIGdldEluc3RhbGxhdGlvbkZvckluc3RhbmNlOiBNLmNhbGxXaGVuKE0uYXdhaXQoSW5zdGFuY2VIYW5kbGVTaGFwZSkpLnJldHVybnMoXG4gICAgTS5lcmVmKE0ucmVtb3RhYmxlKFwiSW5zdGFsbGF0aW9uXCIpKVxuICApLFxuICBnZXRCdW5kbGVJREZyb21JbnN0YWxsYXRpb246IE0uY2FsbFdoZW4oTS5hd2FpdChJbnN0YWxsYXRpb25TaGFwZSkpLnJldHVybnMoXG4gICAgTS5lcmVmKE0uc3RyaW5nKCkpXG4gICksXG4gIGdldEluc3RhbGxhdGlvbjogTS5jYWxsKE0uZXJlZihJbnZpdGF0aW9uU2hhcGUpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgZ2V0SW5zdGFuY2U6IE0uY2FsbChNLmVyZWYoSW52aXRhdGlvblNoYXBlKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldENvbmZpZ3VyYXRpb246IE0uY2FsbCgpLnJldHVybnMoe1xuICAgIGZlZUlzc3VlckNvbmZpZzoge1xuICAgICAgbmFtZTogTS5zdHJpbmcoKSxcbiAgICAgIGFzc2V0S2luZDogXCJuYXRcIixcbiAgICAgIGRpc3BsYXlJbmZvOiBEaXNwbGF5SW5mb1NoYXBlXG4gICAgfVxuICB9KSxcbiAgZ2V0SW52aXRhdGlvbkRldGFpbHM6IE0uY2FsbChNLmVyZWYoSW52aXRhdGlvblNoYXBlKSkucmV0dXJucyhNLmFueSgpKSxcbiAgZ2V0UHJvcG9zYWxTaGFwZUZvckludml0YXRpb246IE0uY2FsbChJbnZpdGF0aW9uSGFuZGxlU2hhcGUpLnJldHVybnMoXG4gICAgTS5vcHQoTS5wYXR0ZXJuKCkpXG4gIClcbn0pO1xudmFyIEFkbWluRmFjZXRJID0gTS5pbnRlcmZhY2UoXCJaY2ZBZG1pbkZhY2V0XCIsIHtcbiAgZ2V0VmF0U2h1dGRvd25Qcm9taXNlOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgcmVzdGFydENvbnRyYWN0OiBNLmNhbGwoKS5vcHRpb25hbChNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgdXBncmFkZUNvbnRyYWN0OiBNLmNhbGwoTS5zdHJpbmcoKSkub3B0aW9uYWwoTS5hbnkoKSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIHRlcm1pbmF0ZUNvbnRyYWN0OiBNLmNhbGwoTS5lcnJvcigpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxufSk7XG52YXIgU2VhdERhdGFTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBwcm9wb3NhbDogUHJvcG9zYWxTaGFwZSxcbiAgICBpbml0aWFsQWxsb2NhdGlvbjogQW1vdW50S2V5d29yZFJlY29yZFNoYXBlLFxuICAgIHNlYXRIYW5kbGU6IFNlYXRTaGFwZVxuICB9LFxuICB7XG4gICAgb2ZmZXJBcmdzOiBNLmFueSgpXG4gIH1cbik7XG52YXIgSGFuZGxlT2ZmZXJJID0gTS5pbnRlcmZhY2UoXCJIYW5kbGVPZmZlclwiLCB7XG4gIGhhbmRsZU9mZmVyOiBNLmNhbGwoSW52aXRhdGlvbkhhbmRsZVNoYXBlLCBTZWF0RGF0YVNoYXBlKS5yZXR1cm5zKHtcbiAgICBvZmZlclJlc3VsdFByb21pc2U6IE0ucHJvbWlzZSgpLFxuICAgIGV4aXRPYmo6IEV4aXRPYmplY3RTaGFwZVxuICB9KVxufSk7XG52YXIgUHJpY2VRdW90ZVNoYXBlID0ge1xuICBxdW90ZUFtb3VudDogQW1vdW50U2hhcGUsXG4gIHF1b3RlUGF5bWVudDogTS5lcmVmKFBheW1lbnRTaGFwZSlcbn07XG5oYXJkZW4oUHJpY2VRdW90ZVNoYXBlKTtcblxuLy9cbnZhciBUcmFuc2ZlclBhcnRTaGFwZSA9IE0uc3BsaXRBcnJheShcbiAgaGFyZGVuKFtNLm9wdChTZWF0U2hhcGUpLCBNLm9wdChTZWF0U2hhcGUpLCBNLm9wdChBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUpXSksXG4gIGhhcmRlbihbTS5vcHQoQW1vdW50S2V5d29yZFJlY29yZFNoYXBlKV0pXG4pO1xudmFyIGZyb21Pbmx5ID0gKGZyb21TZWF0LCBmcm9tQW1vdW50cykgPT4gaGFyZGVuKFtmcm9tU2VhdCwgdm9pZCAwLCBmcm9tQW1vdW50c10pO1xudmFyIHRvT25seSA9ICh0b1NlYXQsIHRvQW1vdW50cykgPT4gaGFyZGVuKFt2b2lkIDAsIHRvU2VhdCwgdm9pZCAwLCB0b0Ftb3VudHNdKTtcbnZhciBhdG9taWNUcmFuc2ZlciA9ICh6Y2YsIGZyb21TZWF0ID0gdm9pZCAwLCB0b1NlYXQgPSB2b2lkIDAsIGZyb21BbW91bnRzID0gdm9pZCAwLCB0b0Ftb3VudHMgPSB2b2lkIDApID0+IHpjZi5hdG9taWNSZWFycmFuZ2UoaGFyZGVuKFtbZnJvbVNlYXQsIHRvU2VhdCwgZnJvbUFtb3VudHMsIHRvQW1vdW50c11dKSk7XG5cbi8vXG52YXIgc2F0aXNmaWVzSW50ZXJuYWwgPSAoZ2l2ZU9yV2FudCA9IHt9LCBhbGxvY2F0aW9uKSA9PiB7XG4gIGNvbnN0IGlzR1RFQnlLZXl3b3JkID0gKFtrZXl3b3JkLCByZXF1aXJlZEFtb3VudF0pID0+IHtcbiAgICBpZiAoYWxsb2NhdGlvbltrZXl3b3JkXSA9PT0gdm9pZCAwKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgY29uc3QgYWxsb2NhdGlvbkFtb3VudCA9IGFsbG9jYXRpb25ba2V5d29yZF07XG4gICAgcmV0dXJuIEFtb3VudE1hdGguaXNHVEUoYWxsb2NhdGlvbkFtb3VudCwgcmVxdWlyZWRBbW91bnQpID8gMSA6IDA7XG4gIH07XG4gIHJldHVybiBPYmplY3QuZW50cmllcyhnaXZlT3JXYW50KS5ldmVyeShpc0dURUJ5S2V5d29yZCkgPyAxIDogMDtcbn07XG52YXIgc2F0aXNmaWVzV2FudCA9IChwcm9wb3NhbCwgYWxsb2NhdGlvbikgPT4gc2F0aXNmaWVzSW50ZXJuYWwocHJvcG9zYWwud2FudCwgYWxsb2NhdGlvbik7XG52YXIgc2F0aXNmaWVzR2l2ZSA9IChwcm9wb3NhbCwgYWxsb2NhdGlvbikgPT4gc2F0aXNmaWVzSW50ZXJuYWwocHJvcG9zYWwuZ2l2ZSwgYWxsb2NhdGlvbik7XG5mdW5jdGlvbiBpc09mZmVyU2FmZShwcm9wb3NhbCwgYWxsb2NhdGlvbikge1xuICByZXR1cm4gc2F0aXNmaWVzR2l2ZShwcm9wb3NhbCwgYWxsb2NhdGlvbikgPiAwIHx8IHNhdGlzZmllc1dhbnQocHJvcG9zYWwsIGFsbG9jYXRpb24pID4gMDtcbn1cbmhhcmRlbihpc09mZmVyU2FmZSk7XG5oYXJkZW4oc2F0aXNmaWVzV2FudCk7XG5cbi8vXG52YXIgZGVwb3NpdFRvU2VhdFN1Y2Nlc3NNc2cgPSBgRGVwb3NpdCBhbmQgcmVhbGxvY2F0aW9uIHN1Y2Nlc3NmdWwuYDtcbnZhciBkZXBvc2l0VG9TZWF0ID0gYXN5bmMgKHpjZiwgcmVjaXBpZW50U2VhdCwgYW1vdW50cywgcGF5bWVudHMpID0+IHtcbiAgIXJlY2lwaWVudFNlYXQuaGFzRXhpdGVkKCkgfHwgdGhyb3dSZWRhY3RlZGBUaGUgcmVjaXBpZW50U2VhdCBjYW5ub3QgaGF2ZSBleGl0ZWQuYDtcbiAgY29uc3QgcmVhbGxvY2F0ZUFmdGVyRGVwb3NpdCA9ICh0ZW1wU2VhdCkgPT4ge1xuICAgIGF0b21pY1RyYW5zZmVyKHpjZiwgdGVtcFNlYXQsIHJlY2lwaWVudFNlYXQsIGFtb3VudHMpO1xuICAgIHRlbXBTZWF0LmV4aXQoKTtcbiAgICByZXR1cm4gZGVwb3NpdFRvU2VhdFN1Y2Nlc3NNc2c7XG4gIH07XG4gIGNvbnN0IGludml0YXRpb24gPSB6Y2YubWFrZUludml0YXRpb24oXG4gICAgcmVhbGxvY2F0ZUFmdGVyRGVwb3NpdCxcbiAgICBcInRlbXBvcmFyeSBzZWF0IGZvciBkZXBvc2l0XCJcbiAgKTtcbiAgY29uc3QgcHJvcG9zYWwgPSBoYXJkZW4oeyBnaXZlOiBhbW91bnRzIH0pO1xuICBoYXJkZW4ocGF5bWVudHMpO1xuICBjb25zdCB6b2UgPSB6Y2YuZ2V0Wm9lU2VydmljZSgpO1xuICBjb25zdCB0ZW1wVXNlclNlYXQgPSBFKHpvZSkub2ZmZXIoaW52aXRhdGlvbiwgcHJvcG9zYWwsIHBheW1lbnRzKTtcbiAgcmV0dXJuIEUodGVtcFVzZXJTZWF0KS5nZXRPZmZlclJlc3VsdCgpO1xufTtcblxuLy9cbnZhciB7IG11bHRpcGx5OiBtdWx0aXBseTIsIGZsb29yRGl2aWRlOiBmbG9vckRpdmlkZTIsIGNlaWxEaXZpZGUsIGJhbmtlcnNEaXZpZGUsIGFkZDogYWRkMiwgc3VidHJhY3Q6IHN1YnRyYWN0MiB9ID0gbmF0U2FmZU1hdGg7XG52YXIgUEVSQ0VOVCA9IDEwMG47XG52YXIgcmF0aW9Qcm9wZXJ0eU5hbWVzID0gW1wibnVtZXJhdG9yXCIsIFwiZGVub21pbmF0b3JcIl07XG52YXIgYXNzZXJ0SXNSYXRpbyA9IChyYXRpbykgPT4ge1xuICBhc3NlcnRSZWNvcmQocmF0aW8sIFwicmF0aW9cIik7XG4gIGNvbnN0IGtleXM0ID0gT2JqZWN0LmtleXMocmF0aW8pO1xuICBrZXlzNC5sZW5ndGggPT09IDIgfHwgdGhyb3dSZWRhY3RlZGBSYXRpbyAke3JhdGlvfSBtdXN0IGJlIGEgcmVjb3JkIHdpdGggMiBmaWVsZHMuYDtcbiAgZm9yIChjb25zdCBuYW1lIG9mIGtleXM0KSB7XG4gICAgcmF0aW9Qcm9wZXJ0eU5hbWVzLmluY2x1ZGVzKG5hbWUpIHx8IHRocm93UmVkYWN0ZWRgUGFyYW1ldGVyIG11c3QgYmUgYSBSYXRpbyByZWNvcmQsIGJ1dCAke3JhdGlvfSBoYXMgJHtxdW90ZShuYW1lKX1gO1xuICB9XG4gIGNvbnN0IG51bWVyYXRvclZhbHVlID0gcmF0aW8ubnVtZXJhdG9yLnZhbHVlO1xuICBjb25zdCBkZW5vbWluYXRvclZhbHVlID0gcmF0aW8uZGVub21pbmF0b3IudmFsdWU7XG4gIGlzTmF0KG51bWVyYXRvclZhbHVlKSB8fCB0aHJvd1JlZGFjdGVkYFRoZSBudW1lcmF0b3IgdmFsdWUgbXVzdCBiZSBhIE5hdFZhbHVlLCBub3QgJHtudW1lcmF0b3JWYWx1ZX1gO1xuICBpc05hdChkZW5vbWluYXRvclZhbHVlKSB8fCB0aHJvd1JlZGFjdGVkYFRoZSBkZW5vbWluYXRvciB2YWx1ZSBtdXN0IGJlIGEgTmF0VmFsdWUsIG5vdCAke2Rlbm9taW5hdG9yVmFsdWV9YDtcbn07XG52YXIgbWFrZVJhdGlvID0gKG51bWVyYXRvciwgbnVtZXJhdG9yQnJhbmQsIGRlbm9taW5hdG9yID0gUEVSQ0VOVCwgZGVub21pbmF0b3JCcmFuZCA9IG51bWVyYXRvckJyYW5kKSA9PiB7XG4gIGRlbm9taW5hdG9yID4gMG4gfHwgdGhyb3dSZWRhY3RlZGBObyBpbmZpbml0ZSByYXRpb3MhIERlbm9taW5hdG9yIHdhcyAwICR7cXVvdGUoZGVub21pbmF0b3JCcmFuZCl9YDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgbnVtZXJhdG9yOiBBbW91bnRNYXRoLm1ha2UobnVtZXJhdG9yQnJhbmQsIG51bWVyYXRvciksXG4gICAgZGVub21pbmF0b3I6IEFtb3VudE1hdGgubWFrZShkZW5vbWluYXRvckJyYW5kLCBkZW5vbWluYXRvcilcbiAgfSk7XG59O1xudmFyIG1ha2VSYXRpb0Zyb21BbW91bnRzID0gKG51bWVyYXRvckFtb3VudCwgZGVub21pbmF0b3JBbW91bnQpID0+IHtcbiAgQW1vdW50TWF0aC5jb2VyY2UobnVtZXJhdG9yQW1vdW50LmJyYW5kLCBudW1lcmF0b3JBbW91bnQpO1xuICBBbW91bnRNYXRoLmNvZXJjZShkZW5vbWluYXRvckFtb3VudC5icmFuZCwgZGVub21pbmF0b3JBbW91bnQpO1xuICByZXR1cm4gbWFrZVJhdGlvKFxuICAgIC8vXG4gICAgbnVtZXJhdG9yQW1vdW50LnZhbHVlLFxuICAgIG51bWVyYXRvckFtb3VudC5icmFuZCxcbiAgICBkZW5vbWluYXRvckFtb3VudC52YWx1ZSxcbiAgICBkZW5vbWluYXRvckFtb3VudC5icmFuZFxuICApO1xufTtcbnZhciBtdWx0aXBseUhlbHBlciA9IChhbW91bnQsIHJhdGlvLCBkaXZpZGVPcCkgPT4ge1xuICBBbW91bnRNYXRoLmNvZXJjZShhbW91bnQuYnJhbmQsIGFtb3VudCk7XG4gIGFzc2VydElzUmF0aW8ocmF0aW8pO1xuICBhbW91bnQuYnJhbmQgPT09IHJhdGlvLmRlbm9taW5hdG9yLmJyYW5kIHx8IHRocm93UmVkYWN0ZWRgYW1vdW50J3MgYnJhbmQgJHtxdW90ZShhbW91bnQuYnJhbmQpfSBtdXN0IG1hdGNoIHJhdGlvJ3MgZGVub21pbmF0b3IgJHtxdW90ZShcbiAgICByYXRpby5kZW5vbWluYXRvci5icmFuZFxuICApfWA7XG4gIHJldHVybiAoXG4gICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgIEFtb3VudE1hdGgubWFrZShcbiAgICAgIHJhdGlvLm51bWVyYXRvci5icmFuZCxcbiAgICAgIGRpdmlkZU9wKFxuICAgICAgICBtdWx0aXBseTIoYW1vdW50LnZhbHVlLCByYXRpby5udW1lcmF0b3IudmFsdWUpLFxuICAgICAgICByYXRpby5kZW5vbWluYXRvci52YWx1ZVxuICAgICAgKVxuICAgIClcbiAgKTtcbn07XG52YXIgbXVsdGlwbHlCeSA9IChhbW91bnQsIHJhdGlvKSA9PiB7XG4gIHJldHVybiBtdWx0aXBseUhlbHBlcihhbW91bnQsIHJhdGlvLCBiYW5rZXJzRGl2aWRlKTtcbn07XG52YXIgZGl2aWRlSGVscGVyID0gKGFtb3VudCwgcmF0aW8sIGRpdmlkZU9wKSA9PiB7XG4gIEFtb3VudE1hdGguY29lcmNlKGFtb3VudC5icmFuZCwgYW1vdW50KTtcbiAgYXNzZXJ0SXNSYXRpbyhyYXRpbyk7XG4gIGFtb3VudC5icmFuZCA9PT0gcmF0aW8ubnVtZXJhdG9yLmJyYW5kIHx8IHRocm93UmVkYWN0ZWRgYW1vdW50J3MgYnJhbmQgJHtxdW90ZShhbW91bnQuYnJhbmQpfSBtdXN0IG1hdGNoIHJhdGlvJ3MgbnVtZXJhdG9yICR7cXVvdGUoXG4gICAgcmF0aW8ubnVtZXJhdG9yLmJyYW5kXG4gICl9YDtcbiAgcmV0dXJuIChcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgQW1vdW50TWF0aC5tYWtlKFxuICAgICAgcmF0aW8uZGVub21pbmF0b3IuYnJhbmQsXG4gICAgICBkaXZpZGVPcChcbiAgICAgICAgbXVsdGlwbHkyKGFtb3VudC52YWx1ZSwgcmF0aW8uZGVub21pbmF0b3IudmFsdWUpLFxuICAgICAgICByYXRpby5udW1lcmF0b3IudmFsdWVcbiAgICAgIClcbiAgICApXG4gICk7XG59O1xudmFyIGRpdmlkZUJ5ID0gKGFtb3VudCwgcmF0aW8pID0+IHtcbiAgcmV0dXJuIGRpdmlkZUhlbHBlcihhbW91bnQsIHJhdGlvLCBiYW5rZXJzRGl2aWRlKTtcbn07XG5cbi8vXG52YXIgbWFrZUVwaGVtZXJhUHJvdmlkZXIgPSAoaW5pdCkgPT4ge1xuICBjb25zdCBleHRhbnQgPSAvKiAgICAgICAgICAgKi8gbmV3IFdlYWtNYXAoKTtcbiAgcmV0dXJuIChrZXkpID0+IHtcbiAgICBpZiAoZXh0YW50LmhhcyhrZXkpKSB7XG4gICAgICByZXR1cm4gZXh0YW50LmdldChrZXkpO1xuICAgIH1cbiAgICBjb25zdCBuZXdFcGggPSBpbml0KGtleSk7XG4gICAgZXh0YW50LnNldChrZXksIG5ld0VwaCk7XG4gICAgcmV0dXJuIG5ld0VwaDtcbiAgfTtcbn07XG5oYXJkZW4obWFrZUVwaGVtZXJhUHJvdmlkZXIpO1xudmFyIHByb3ZpZGVFbXB0eVNlYXQgPSAoemNmLCBiYWdnYWdlLCBuYW1lKSA9PiB7XG4gIHJldHVybiBwcm92aWRlKGJhZ2dhZ2UsIG5hbWUsICgpID0+IHpjZi5tYWtlRW1wdHlTZWF0S2l0KCkuemNmU2VhdCk7XG59O1xuaGFyZGVuKHByb3ZpZGVFbXB0eVNlYXQpO1xudmFyIHByb3ZpZGVBbGwgPSAoYmFnZ2FnZSwgdGh1bmtzKSA9PiB7XG4gIGNvbnN0IGtleXM0ID0gT2JqZWN0LmtleXModGh1bmtzKTtcbiAgY29uc3QgaW5CYWdnYWdlID0gYmFnZ2FnZS5oYXMoa2V5czRbMF0pO1xuICBpZiAoaW5CYWdnYWdlKSB7XG4gICAgY29uc3Qgb2JqID0gb2JqZWN0TWFwKFxuICAgICAgdGh1bmtzLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIChfLCBrKSA9PiBiYWdnYWdlLmdldChrKVxuICAgICk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShoYXJkZW4ob2JqKSk7XG4gIH1cbiAgY29uc3Qga2V5ZWRQcm9taXNlcyA9IG9iamVjdE1hcCh0aHVua3MsIChmbikgPT4gZm4oKSk7XG4gIHJldHVybiBhbGxWYWx1ZXMoa2V5ZWRQcm9taXNlcykudGhlbigoa2V5ZWRWYWxzKSA9PiB7XG4gICAgZm9yIChjb25zdCBbaywgdjNdIG9mIE9iamVjdC5lbnRyaWVzKGtleWVkVmFscykpIHtcbiAgICAgIGJhZ2dhZ2UuaW5pdChrLCB2Myk7XG4gICAgfVxuICAgIHJldHVybiBrZXllZFZhbHM7XG4gIH0pO1xufTtcbmhhcmRlbihwcm92aWRlQWxsKTtcbnZhciBwcm92aWRlU2luZ2xldG9uID0gKG1hcFN0b3JlLCBrZXksIG1ha2VWYWx1ZSwgd2l0aFZhbHVlKSA9PiB7XG4gIGNvbnN0IHN0b3JlZCA9IG1hcFN0b3JlLmhhcyhrZXkpID8gdm9pZCAwIDogRS53aGVuKG1ha2VWYWx1ZSgpLCAodjMpID0+IG1hcFN0b3JlLmluaXQoa2V5LCBoYXJkZW4odjMpKSk7XG4gIHJldHVybiBFLndoZW4oc3RvcmVkLCAoKSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBtYXBTdG9yZS5nZXQoa2V5KTtcbiAgICBpZiAod2l0aFZhbHVlKSB7XG4gICAgICB3aXRoVmFsdWUodmFsdWUpO1xuICAgIH1cbiAgICByZXR1cm4gdmFsdWU7XG4gIH0pO1xufTtcblxuLy9cbnZhciBwcmVwYXJlUmV2b2NhYmxlTWFrZXJLaXQgPSAoem9uZSwgdUtpbmROYW1lLCB1TWV0aG9kTmFtZXMsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7XG4gICAgdUludGVyZmFjZU5hbWUgPSB1S2luZE5hbWUsXG4gICAgZXh0cmFNZXRob2RHdWFyZHMgPSB2b2lkIDAsXG4gICAgZXh0cmFNZXRob2RzID0gdm9pZCAwXG4gIH0gPSBvcHRpb25zO1xuICBjb25zdCBSZXZvY2FibGVJS2l0ID0gaGFyZGVuKHtcbiAgICByZXZva2VyOiBNLmludGVyZmFjZShgJHt1SW50ZXJmYWNlTmFtZX1fcmV2b2tlcmAsIHtcbiAgICAgIHJldm9rZTogTS5jYWxsKCkucmV0dXJucyhNLmJvb2xlYW4oKSlcbiAgICB9KSxcbiAgICByZXZvY2FibGU6IE0uaW50ZXJmYWNlKFxuICAgICAgYCR7dUludGVyZmFjZU5hbWV9X3Jldm9jYWJsZWAsXG4gICAgICB7XG4gICAgICAgIC4uLmV4dHJhTWV0aG9kR3VhcmRzXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBkZWZhdWx0R3VhcmRzOiBcInJhd1wiXG4gICAgICB9XG4gICAgKVxuICB9KTtcbiAgY29uc3QgcmV2b2NhYmxlS2luZE5hbWUgPSBgJHt1S2luZE5hbWV9X2NhcmV0YWtlcmA7XG4gIGxldCBhbXBsaWZpZXI7XG4gIGNvbnN0IG1ha2VSZXZvY2FibGVLaXQgPSB6b25lLmV4b0NsYXNzS2l0KFxuICAgIHJldm9jYWJsZUtpbmROYW1lLFxuICAgIFJldm9jYWJsZUlLaXQsXG4gICAgKHVuZGVybHlpbmcpID0+ICh7XG4gICAgICB1bmRlcmx5aW5nXG4gICAgfSksXG4gICAge1xuICAgICAgcmV2b2tlcjoge1xuICAgICAgICByZXZva2UoKSB7XG4gICAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgICBpZiAoc3RhdGUudW5kZXJseWluZyA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHN0YXRlLnVuZGVybHlpbmcgPSB2b2lkIDA7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICByZXZvY2FibGU6IHtcbiAgICAgICAgLi4uZnJvbVVuaXF1ZUVudHJpZXMoXG4gICAgICAgICAgdU1ldGhvZE5hbWVzLm1hcCgobmFtZSkgPT4gW1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgW25hbWVdKC4uLmFyZ3MpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IHVuZGVybHlpbmcgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICAgICAgdW5kZXJseWluZyAhPT0gdm9pZCAwIHx8IHRocm93UmVkYWN0ZWRgJHtxdW90ZShyZXZvY2FibGVLaW5kTmFtZSl9IHJldm9rZWRgO1xuICAgICAgICAgICAgICAgIHJldHVybiB1bmRlcmx5aW5nW25hbWVdKC4uLmFyZ3MpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICB9W25hbWVdXG4gICAgICAgICAgXSlcbiAgICAgICAgKSxcbiAgICAgICAgLi4uZXh0cmFNZXRob2RzXG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBzdGF0ZVNoYXBlOiB7XG4gICAgICAgIHVuZGVybHlpbmc6IE0ub3B0KE0ucmVtb3RhYmxlKFwidW5kZXJseWluZ1wiKSlcbiAgICAgIH0sXG4gICAgICByZWNlaXZlQW1wbGlmaWVyOiAoYW1wKSA9PiB7XG4gICAgICAgIGFtcGxpZmllciA9IGFtcDtcbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VSZXZvY2FibGUgPSAodW5kZXJseWluZykgPT4gKFxuICAgIC8vXG4gICAgbWFrZVJldm9jYWJsZUtpdCh1bmRlcmx5aW5nKS5yZXZvY2FibGVcbiAgKTtcbiAgY29uc3QgcmV2b2tlID0gKHJldm9jYWJsZSkgPT4ge1xuICAgIGNvbnN0IGZhY2V0cyA9IGFtcGxpZmllcihyZXZvY2FibGUpO1xuICAgIGlmIChmYWNldHMgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gZmFjZXRzLnJldm9rZXIucmV2b2tlKCk7XG4gIH07XG4gIHJldHVybiBoYXJkZW4oe1xuICAgIHJldm9rZSxcbiAgICBtYWtlUmV2b2NhYmxlXG4gIH0pO1xufTtcbmhhcmRlbihwcmVwYXJlUmV2b2NhYmxlTWFrZXJLaXQpO1xuXG4vL1xudmFyIFRyYW5zZmVyUHJvcG9zYWxTaGFwZSA9IE0uc3BsaXRSZWNvcmQoe1xuICBnaXZlOiB7fSxcbiAgd2FudDoge30sXG4gIGV4aXQ6IHtcbiAgICBvbkRlbWFuZDogbnVsbFxuICB9XG59KTtcbnZhciBwcmVwYXJlT3duYWJsZSA9ICh6b25lLCBtYWtlSW52aXRhdGlvbiwgdUtpbmROYW1lLCB1TWV0aG9kTmFtZXMsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IHVJbnRlcmZhY2VOYW1lID0gdUtpbmROYW1lIH0gPSBvcHRpb25zO1xuICBjb25zdCB7IHJldm9rZSwgbWFrZVJldm9jYWJsZSB9ID0gcHJlcGFyZVJldm9jYWJsZU1ha2VyS2l0KFxuICAgIHpvbmUsXG4gICAgdUtpbmROYW1lLFxuICAgIHVNZXRob2ROYW1lcyxcbiAgICB7XG4gICAgICB1SW50ZXJmYWNlTmFtZSxcbiAgICAgIGV4dHJhTWV0aG9kR3VhcmRzOiB7XG4gICAgICAgIG1ha2VUcmFuc2Zlckludml0YXRpb246IE0uY2FsbCgpLnJldHVybnMoTS5wcm9taXNlKCkpXG4gICAgICB9LFxuICAgICAgZXh0cmFNZXRob2RzOiB7XG4gICAgICAgIG1ha2VUcmFuc2Zlckludml0YXRpb24oKSB7XG4gICAgICAgICAgY29uc3QgeyB1bmRlcmx5aW5nIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGNvbnN0IHsgcmV2b2NhYmxlIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCBjdXN0b21EZXRhaWxzID0gdW5kZXJseWluZy5nZXRJbnZpdGF0aW9uQ3VzdG9tRGV0YWlscygpO1xuICAgICAgICAgIGNvbnN0IHRyYW5zZmVySGFuZGxlciA9IG1ha2VUcmFuc2ZlckhhbmRsZXIodW5kZXJseWluZyk7XG4gICAgICAgICAgY29uc3QgaW52aXRhdGlvbiA9IG1ha2VJbnZpdGF0aW9uKFxuICAgICAgICAgICAgdHJhbnNmZXJIYW5kbGVyLFxuICAgICAgICAgICAgXCJ0cmFuc2ZlclwiLFxuICAgICAgICAgICAgY3VzdG9tRGV0YWlscyxcbiAgICAgICAgICAgIFRyYW5zZmVyUHJvcG9zYWxTaGFwZVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV2b2tlKHJldm9jYWJsZSk7XG4gICAgICAgICAgcmV0dXJuIGludml0YXRpb247XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VUcmFuc2ZlckhhbmRsZXIgPSB6b25lLmV4b0NsYXNzKFxuICAgIFwiVHJhbnNmZXJIYW5kbGVyXCIsXG4gICAgT2ZmZXJIYW5kbGVySSxcbiAgICAodW5kZXJseWluZykgPT4gKHtcbiAgICAgIHVuZGVybHlpbmdcbiAgICB9KSxcbiAgICB7XG4gICAgICBoYW5kbGUoc2VhdCkge1xuICAgICAgICBjb25zdCB7IHVuZGVybHlpbmcgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgIGNvbnN0IHJldm9jYWJsZSA9IG1ha2VSZXZvY2FibGUodW5kZXJseWluZyk7XG4gICAgICAgIHNlYXQuZXhpdCgpO1xuICAgICAgICByZXR1cm4gcmV2b2NhYmxlO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgY29uc3QgbWFrZU93bmFibGUgPSAodW5kZXJseWluZykgPT4gbWFrZVJldm9jYWJsZSh1bmRlcmx5aW5nKTtcbiAgcmV0dXJuIGhhcmRlbihtYWtlT3duYWJsZSk7XG59O1xuaGFyZGVuKHByZXBhcmVPd25hYmxlKTtcblxuLy9cbnZhciB0cmFjZTggPSBtYWtlVHJhY2VyKFwiUEFcIiwgZmFsc2UpO1xudmFyIEd1YXJkQ2FsbEFtb3VudFR1cGxlID0gTS5jYWxsKEFtb3VudFNoYXBlLCBBbW91bnRTaGFwZSkucmV0dXJucyhcbiAgTS5wcm9taXNlKClcbik7XG52YXIgUHJpY2VBdXRob3JpdHlJID0gTS5pbnRlcmZhY2UoXCJQcmljZUF1dGhvcml0eVwiLCB7XG4gIGdldFF1b3RlSXNzdWVyOiBNLmNhbGwoQnJhbmRTaGFwZSwgQnJhbmRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIGdldFRpbWVyU2VydmljZTogTS5jYWxsKEJyYW5kU2hhcGUsIEJyYW5kU2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBxdW90ZUdpdmVuOiBNLmNhbGwoQW1vdW50U2hhcGUsIEJyYW5kU2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICBxdW90ZVdhbnRlZDogTS5jYWxsKEJyYW5kU2hhcGUsIEFtb3VudFNoYXBlKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgbWFrZVF1b3RlTm90aWZpZXI6IE0uY2FsbChBbW91bnRTaGFwZSwgQnJhbmRTaGFwZSkucmV0dXJucyhNLnByb21pc2UoKSksXG4gIHF1b3RlQXRUaW1lOiBNLmNhbGwoVGltZXN0YW1wU2hhcGUsIEFtb3VudFNoYXBlLCBCcmFuZFNoYXBlKS5yZXR1cm5zKFxuICAgIE0ucHJvbWlzZSgpXG4gICksXG4gIHF1b3RlV2hlbkxUOiBHdWFyZENhbGxBbW91bnRUdXBsZSxcbiAgcXVvdGVXaGVuTFRFOiBHdWFyZENhbGxBbW91bnRUdXBsZSxcbiAgcXVvdGVXaGVuR1RFOiBHdWFyZENhbGxBbW91bnRUdXBsZSxcbiAgcXVvdGVXaGVuR1Q6IEd1YXJkQ2FsbEFtb3VudFR1cGxlLFxuICBtdXRhYmxlUXVvdGVXaGVuTFQ6IEd1YXJkQ2FsbEFtb3VudFR1cGxlLFxuICBtdXRhYmxlUXVvdGVXaGVuTFRFOiBHdWFyZENhbGxBbW91bnRUdXBsZSxcbiAgbXV0YWJsZVF1b3RlV2hlbkdURTogR3VhcmRDYWxsQW1vdW50VHVwbGUsXG4gIG11dGFibGVRdW90ZVdoZW5HVDogR3VhcmRDYWxsQW1vdW50VHVwbGVcbn0pO1xuXG4vL1xudmFyIHVuaXRBbW91bnQgPSBhc3luYyAoYnJhbmQpID0+IHtcbiAgY29uc3QgZGlzcGxheUluZm8gPSBhd2FpdCBFKGJyYW5kKS5nZXREaXNwbGF5SW5mbygpO1xuICBjb25zdCBkZWNpbWFsUGxhY2VzID0gZGlzcGxheUluZm8uZGVjaW1hbFBsYWNlcyA/PyAwO1xuICByZXR1cm4gQW1vdW50TWF0aC5tYWtlKGJyYW5kLCAxMG4gKiogTmF0KGRlY2ltYWxQbGFjZXMpKTtcbn07XG5oYXJkZW4odW5pdEFtb3VudCk7XG5cbi8vXG52YXIgdHJhY2U5ID0gbWFrZVRyYWNlcihcIlpvZVRvb2xzXCIpO1xudmFyIHsgYXNzaWduOiBhc3NpZ240LCBrZXlzOiBrZXlzMiwgdmFsdWVzOiB2YWx1ZXM1IH0gPSBPYmplY3Q7XG52YXIgbWFrZVpvZVRvb2xzID0gKHpjZiwgeyB3aGVuLCBhbGxWb3dzLCBhbGxTZXR0bGVkLCBhc1ZvdyB9KSA9PiB7XG4gIGNvbnN0IGxvY2FsVHJhbnNmZXIgPSAoc3JjU2VhdCwgbG9jYWxBY2NvdW50LCBhbW91bnRzKSA9PiBhc1Zvdyhhc3luYyAoKSA9PiB7XG4gICAgIXNyY1NlYXQuaGFzRXhpdGVkKCkgfHwgdGhyb3dSZWRhY3RlZGBUaGUgc2VhdCBjYW5ub3QgaGF2ZSBleGl0ZWQuYDtcbiAgICBjb25zdCB7IHpjZlNlYXQ6IHRlbXBTZWF0LCB1c2VyU2VhdDogdXNlclNlYXRQIH0gPSB6Y2YubWFrZUVtcHR5U2VhdEtpdCgpO1xuICAgIGNvbnN0IHVzZXJTZWF0ID0gYXdhaXQgdXNlclNlYXRQO1xuICAgIHpjZi5hdG9taWNSZWFycmFuZ2UoaGFyZGVuKFtbc3JjU2VhdCwgdGVtcFNlYXQsIGFtb3VudHNdXSkpO1xuICAgIHRlbXBTZWF0LmV4aXQoKTtcbiAgICBjb25zdCBwYXltZW50cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAga2V5czIoYW1vdW50cykubWFwKChrdykgPT4gRSh1c2VyU2VhdCkuZ2V0UGF5b3V0KGt3KSlcbiAgICApO1xuICAgIGNvbnN0IHNldHRsZURlcG9zaXRzID0gYXdhaXQgd2hlbihcbiAgICAgIGFsbFNldHRsZWQocGF5bWVudHMubWFwKChwbXQpID0+IEUobG9jYWxBY2NvdW50KS5kZXBvc2l0KHBtdCkpKVxuICAgICk7XG4gICAgaWYgKHNldHRsZURlcG9zaXRzLmZpbmQoKHgpID0+IHguc3RhdHVzID09PSBcInJlamVjdGVkXCIpKSB7XG4gICAgICBjb25zdCBhbXRzID0gdmFsdWVzNShhbW91bnRzKTtcbiAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuICAgICAgY29uc3QgcGF5bWVudHNPcldpdGhkcmF3VnMgPSBzZXR0bGVEZXBvc2l0cy5tYXAoKHgsIGkyKSA9PiB7XG4gICAgICAgIGlmICh4LnN0YXR1cyA9PT0gXCJyZWplY3RlZFwiKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goeC5yZWFzb24pO1xuICAgICAgICAgIHJldHVybiBwYXltZW50c1tpMl07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEUobG9jYWxBY2NvdW50KS53aXRoZHJhdyhhbXRzW2kyXSk7XG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHBheW1lbnRzVG9SZXR1cm4gPSBhd2FpdCB3aGVuKGFsbFZvd3MocGF5bWVudHNPcldpdGhkcmF3VnMpKTtcbiAgICAgIGNvbnN0IHBheW1lbnRLd3IgPSBoYXJkZW4oXG4gICAgICAgIGtleXMyKGFtb3VudHMpLnJlZHVjZShcbiAgICAgICAgICAoa3dyLCBrdywgaTIpID0+IGFzc2lnbjQoa3dyLCB7IFtrd106IHBheW1lbnRzVG9SZXR1cm5baTJdIH0pLFxuICAgICAgICAgIHt9XG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICBjb25zdCBkZXBvc2l0UmVzcG9uc2UgPSBhd2FpdCBkZXBvc2l0VG9TZWF0KFxuICAgICAgICB6Y2YsXG4gICAgICAgIHNyY1NlYXQsXG4gICAgICAgIGFtb3VudHMsXG4gICAgICAgIHBheW1lbnRLd3JcbiAgICAgICk7XG4gICAgICB0cmFjZTkoXCJsb2NhbFRyYW5zZmVyIGRlcG9zaXRSZXNwb25zZVwiLCBkZXBvc2l0UmVzcG9uc2UpO1xuICAgICAgdGhyb3cgbWFrZUVycm9yKGBPbmUgb3IgbW9yZSBkZXBvc2l0cyBmYWlsZWQgJHtxdW90ZShlcnJvcnMpfWApO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IHdpdGhkcmF3VG9TZWF0ID0gKGxvY2FsQWNjb3VudCwgZGVzdFNlYXQsIGFtb3VudHMpID0+IGFzVm93KGFzeW5jICgpID0+IHtcbiAgICAhZGVzdFNlYXQuaGFzRXhpdGVkKCkgfHwgdGhyb3dSZWRhY3RlZGBUaGUgc2VhdCBjYW5ub3QgaGF2ZSBleGl0ZWQuYDtcbiAgICBjb25zdCBzZXR0bGVkV2l0aGRyYXdhbHMgPSBhd2FpdCB3aGVuKFxuICAgICAgYWxsU2V0dGxlZCh2YWx1ZXM1KGFtb3VudHMpLm1hcCgoYW10KSA9PiBFKGxvY2FsQWNjb3VudCkud2l0aGRyYXcoYW10KSkpXG4gICAgKTtcbiAgICBpZiAoc2V0dGxlZFdpdGhkcmF3YWxzLmZpbmQoKHgpID0+IHguc3RhdHVzID09PSBcInJlamVjdGVkXCIpKSB7XG4gICAgICBjb25zdCByZXR1cm5QYXltZW50VnMgPSBbXTtcbiAgICAgIGNvbnN0IGVycm9ycyA9IFtdO1xuICAgICAgZm9yIChjb25zdCByZXN1bHQgb2Ygc2V0dGxlZFdpdGhkcmF3YWxzKSB7XG4gICAgICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSBcImZ1bGZpbGxlZFwiKSB7XG4gICAgICAgICAgcmV0dXJuUGF5bWVudFZzLnB1c2goRShsb2NhbEFjY291bnQpLmRlcG9zaXQocmVzdWx0LnZhbHVlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2gocmVzdWx0LnJlYXNvbik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGF3YWl0IHdoZW4oYWxsVm93cyhyZXR1cm5QYXltZW50VnMpKTtcbiAgICAgIHRocm93IG1ha2VFcnJvcihgT25lIG9yIG1vcmUgd2l0aGRyYXdhbHMgZmFpbGVkICR7cXVvdGUoZXJyb3JzKX1gKTtcbiAgICB9XG4gICAgY29uc3QgcGF5bWVudEt3ciA9IGhhcmRlbihcbiAgICAgIGtleXMyKGFtb3VudHMpLnJlZHVjZShcbiAgICAgICAgKGFjYywga3csIGkyKSA9PiBhc3NpZ240KGFjYywge1xuICAgICAgICAgIFtrd106IChcbiAgICAgICAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHNldHRsZWRXaXRoZHJhd2Fsc1tpMl0udmFsdWVcbiAgICAgICAgICApXG4gICAgICAgIH0pLFxuICAgICAgICB7fVxuICAgICAgKVxuICAgICk7XG4gICAgY29uc3QgZGVwb3NpdFJlc3BvbnNlID0gYXdhaXQgZGVwb3NpdFRvU2VhdChcbiAgICAgIHpjZixcbiAgICAgIGRlc3RTZWF0LFxuICAgICAgYW1vdW50cyxcbiAgICAgIHBheW1lbnRLd3JcbiAgICApO1xuICAgIHRyYWNlOShcIndpdGhkcmF3VG9TZWF0IGRlcG9zaXRSZXNwb25zZVwiLCBkZXBvc2l0UmVzcG9uc2UpO1xuICB9KTtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgbG9jYWxUcmFuc2ZlcixcbiAgICB3aXRoZHJhd1RvU2VhdFxuICB9KTtcbn07XG5cbi8vXG52YXIgSGFuZGxlclNoYXBlID0gTS5yZW1vdGFibGUoXCJPZmZlckhhbmRsZXJcIik7XG52YXIgbWFrZVpjZlRvb2xzID0gKHpjZiwgdm93VG9vbHMpID0+IGhhcmRlbih7XG4gIG1ha2VJbnZpdGF0aW9uKG9mZmVySGFuZGxlciwgZGVzY3JpcHRpb24sIGN1c3RvbURldGFpbHMsIHByb3Bvc2FsU2hhcGUpIHtcbiAgICBtdXN0TWF0Y2gob2ZmZXJIYW5kbGVyLCBIYW5kbGVyU2hhcGUpO1xuICAgIHJldHVybiB2b3dUb29scy53YXRjaChcbiAgICAgIHpjZi5tYWtlSW52aXRhdGlvbihcbiAgICAgICAgb2ZmZXJIYW5kbGVyLFxuICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgY3VzdG9tRGV0YWlscyxcbiAgICAgICAgcHJvcG9zYWxTaGFwZVxuICAgICAgKVxuICAgICk7XG4gIH0sXG4gIGF0b21pY1JlYXJyYW5nZSh0cmFuc2ZlcnMpIHtcbiAgICB6Y2YuYXRvbWljUmVhcnJhbmdlKHRyYW5zZmVycyk7XG4gIH0sXG4gIGFzc2VydFVuaXF1ZUtleXdvcmQoa2V5d29yZCkge1xuICAgIHpjZi5hc3NlcnRVbmlxdWVLZXl3b3JkKGtleXdvcmQpO1xuICB9XG59KTtcblxuLy9cbnZhciBwcm92aWRlT3JjaGVzdHJhdGlvbiA9ICh6Y2YsIGJhZ2dhZ2UsIHJlbW90ZVBvd2VycywgbWFyc2hhbGxlciwgb3B0cyA9IHt9KSA9PiB7XG4gIGNvbnN0IHpvbmVzID0gKCgpID0+IHtcbiAgICBjb25zdCB6b25lID0gbWFrZUR1cmFibGVab25lKGJhZ2dhZ2UpO1xuICAgIHJldHVybiB7XG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBhc3luY0Zsb3c6IHpvbmUuc3ViWm9uZShcImFzeW5jRmxvd1wiKSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgIG9yY2hlc3RyYXRpb246IHpvbmUuc3ViWm9uZShcIm9yY2hlc3RyYXRpb25cIiksXG4gICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgY2hhaW5IdWI6IHpvbmUuc3ViWm9uZShcImNoYWluSHViXCIpLFxuICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgdm93czogem9uZS5zdWJab25lKFwidm93c1wiKSxcbiAgICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICBjb250cmFjdDogem9uZS5zdWJab25lKFwiY29udHJhY3RcIilcbiAgICB9O1xuICB9KSgpO1xuICBjb25zdCB7IGFnb3JpY05hbWVzLCB0aW1lclNlcnZpY2UsIGxvY2FsY2hhaW4gfSA9IHJlbW90ZVBvd2VycztcbiAgY29uc3Qgdm93VG9vbHMgPSBwcmVwYXJlU3dpbmdzZXRWb3dUb29scyh6b25lcy52b3dzKTtcbiAgY29uc3QgY2hhaW5IdWIgPSBtYWtlQ2hhaW5IdWIoem9uZXMuY2hhaW5IdWIsIGFnb3JpY05hbWVzLCB2b3dUb29scywge1xuICAgIGNoYWluSW5mb1ZhbHVlU2hhcGU6IG9wdHMuY2hhaW5JbmZvVmFsdWVTaGFwZVxuICB9KTtcbiAgY29uc3Qgem9lVG9vbHMgPSBtYWtlWm9lVG9vbHMoemNmLCB2b3dUb29scyk7XG4gIGNvbnN0IHpjZlRvb2xzID0gbWFrZVpjZlRvb2xzKHpjZiwgdm93VG9vbHMpO1xuICBjb25zdCB7IG1ha2VSZWNvcmRlcktpdCB9ID0gcHJlcGFyZVJlY29yZGVyS2l0TWFrZXJzKGJhZ2dhZ2UsIG1hcnNoYWxsZXIpO1xuICBjb25zdCBtYWtlTG9jYWxPcmNoZXN0cmF0aW9uQWNjb3VudEtpdCA9IHByZXBhcmVMb2NhbE9yY2hlc3RyYXRpb25BY2NvdW50S2l0KFxuICAgIHpvbmVzLm9yY2hlc3RyYXRpb24sXG4gICAge1xuICAgICAgbWFrZVJlY29yZGVyS2l0LFxuICAgICAgemNmLFxuICAgICAgdGltZXJTZXJ2aWNlLFxuICAgICAgdm93VG9vbHMsXG4gICAgICBjaGFpbkh1YixcbiAgICAgIGxvY2FsY2hhaW4sXG4gICAgICB6b2VUb29sc1xuICAgIH1cbiAgKTtcbiAgY29uc3QgYXN5bmNGbG93VG9vbHMgPSBwcmVwYXJlQXN5bmNGbG93VG9vbHMoem9uZXMuYXN5bmNGbG93LCB7XG4gICAgdm93VG9vbHNcbiAgfSk7XG4gIGNvbnN0IG1ha2VDb3Ntb3NPcmNoZXN0cmF0aW9uQWNjb3VudCA9IHByZXBhcmVDb3Ntb3NPcmNoZXN0cmF0aW9uQWNjb3VudChcbiAgICB6b25lcy5vcmNoZXN0cmF0aW9uLFxuICAgIHtcbiAgICAgIGNoYWluSHViLFxuICAgICAgbWFrZVJlY29yZGVyS2l0LFxuICAgICAgdGltZXJTZXJ2aWNlLFxuICAgICAgdm93VG9vbHMsXG4gICAgICB6Y2ZcbiAgICB9XG4gICk7XG4gIGNvbnN0IG1ha2VSZW1vdGVDaGFpbkZhY2FkZSA9IHByZXBhcmVSZW1vdGVDaGFpbkZhY2FkZSh6b25lcy5vcmNoZXN0cmF0aW9uLCB7XG4gICAgbWFrZUNvc21vc09yY2hlc3RyYXRpb25BY2NvdW50LFxuICAgIG9yY2hlc3RyYXRpb246IHJlbW90ZVBvd2Vycy5vcmNoZXN0cmF0aW9uU2VydmljZSxcbiAgICBzdG9yYWdlTm9kZTogcmVtb3RlUG93ZXJzLnN0b3JhZ2VOb2RlLFxuICAgIHRpbWVyOiByZW1vdGVQb3dlcnMudGltZXJTZXJ2aWNlLFxuICAgIHZvd1Rvb2xzXG4gIH0pO1xuICBjb25zdCBtYWtlTG9jYWxDaGFpbkZhY2FkZSA9IHByZXBhcmVMb2NhbENoYWluRmFjYWRlKHpvbmVzLm9yY2hlc3RyYXRpb24sIHtcbiAgICBtYWtlTG9jYWxPcmNoZXN0cmF0aW9uQWNjb3VudEtpdCxcbiAgICBsb2NhbGNoYWluOiByZW1vdGVQb3dlcnMubG9jYWxjaGFpbixcbiAgICAvL1xuICAgIHN0b3JhZ2VOb2RlOiByZW1vdGVQb3dlcnMuc3RvcmFnZU5vZGUsXG4gICAgYWdvcmljTmFtZXMsXG4gICAgb3JjaGVzdHJhdGlvbjogcmVtb3RlUG93ZXJzLm9yY2hlc3RyYXRpb25TZXJ2aWNlLFxuICAgIHRpbWVyOiByZW1vdGVQb3dlcnMudGltZXJTZXJ2aWNlLFxuICAgIHZvd1Rvb2xzXG4gIH0pO1xuICBjb25zdCBtYWtlT3JjaGVzdHJhdG9yID0gcHJlcGFyZU9yY2hlc3RyYXRvcih6b25lcy5vcmNoZXN0cmF0aW9uLCB7XG4gICAgY2hhaW5IdWIsXG4gICAgbWFrZUxvY2FsQ2hhaW5GYWNhZGUsXG4gICAgbWFrZVJlbW90ZUNoYWluRmFjYWRlLFxuICAgIHZvd1Rvb2xzXG4gIH0pO1xuICBjb25zdCBtYWtlT3JjaGVzdHJhdGVLaXQgPSAoem9uZSkgPT4gbWFrZU9yY2hlc3RyYXRpb25GYWNhZGUoe1xuICAgIHpvbmUsXG4gICAgemNmLFxuICAgIG1ha2VPcmNoZXN0cmF0b3IsXG4gICAgYXN5bmNGbG93VG9vbHMsXG4gICAgdm93VG9vbHMsXG4gICAgLi4ucmVtb3RlUG93ZXJzXG4gIH0pO1xuICBjb25zdCBkZWZhdWx0T3JjaGVzdHJhdGVLaXQgPSBtYWtlT3JjaGVzdHJhdGVLaXQoXG4gICAgem9uZXMuY29udHJhY3Quc3ViWm9uZShcIm9yY2hlc3RyYXRpb25cIilcbiAgKTtcbiAgemNmLnNldFRlc3RKaWcoKCkgPT4gKHtcbiAgICBiYWdnYWdlLFxuICAgIGNoYWluSHViXG4gIH0pKTtcbiAgcmV0dXJuIHtcbiAgICAuLi5kZWZhdWx0T3JjaGVzdHJhdGVLaXQsXG4gICAgbWFrZU9yY2hlc3RyYXRlS2l0LFxuICAgIGJhZ2dhZ2UsXG4gICAgY2hhaW5IdWIsXG4gICAgdm93VG9vbHMsXG4gICAgYXN5bmNGbG93VG9vbHMsXG4gICAgemNmVG9vbHMsXG4gICAgem9lVG9vbHMsXG4gICAgem9uZTogem9uZXMuY29udHJhY3RcbiAgfTtcbn07XG5oYXJkZW4ocHJvdmlkZU9yY2hlc3RyYXRpb24pO1xudmFyIHdpdGhPcmNoZXN0cmF0aW9uID0gKGNvbnRyYWN0Rm4sIG9wdHMpID0+IGFzeW5jICh6Y2YsIHByaXZhdGVBcmdzLCBiYWdnYWdlKSA9PiB7XG4gIGNvbnN0IHsgbWFyc2hhbGxlciwgLi4uYWxsT3JjaFBvd2VycyB9ID0gcHJpdmF0ZUFyZ3M7XG4gIGNvbnN0IHsgc3RvcmFnZU5vZGU6IF8sIC4uLnJlcXVpcmVkT3JjaFBvd2VycyB9ID0gYWxsT3JjaFBvd2VycztcbiAgY29uc3QgeyBwdWJsaXNoQWNjb3VudEluZm8sIGNoYWluSW5mb1ZhbHVlU2hhcGUgfSA9IG9wdHMgPz8ge307XG4gIGNvbnN0IHsgem9uZSwgLi4udG9vbHMgfSA9IHByb3ZpZGVPcmNoZXN0cmF0aW9uKFxuICAgIHpjZixcbiAgICBiYWdnYWdlLFxuICAgIHB1Ymxpc2hBY2NvdW50SW5mbyA/IGFsbE9yY2hQb3dlcnMgOiByZXF1aXJlZE9yY2hQb3dlcnMsXG4gICAgbWFyc2hhbGxlcixcbiAgICB7IGNoYWluSW5mb1ZhbHVlU2hhcGUgfVxuICApO1xuICByZXR1cm4gY29udHJhY3RGbih6Y2YsIHByaXZhdGVBcmdzLCB6b25lLCB0b29scyk7XG59O1xuaGFyZGVuKHdpdGhPcmNoZXN0cmF0aW9uKTtcblxuLy9cbnZhciBJY3FFbmFibGVkID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgb21uaWZsaXhodWI6IHRydWUsXG4gICAgb3Ntb3NpczogdHJ1ZVxuICB9XG4pO1xuaGFyZGVuKEljcUVuYWJsZWQpO1xudmFyIFBmbUVuYWJsZWQgPSAoXG4gIC8qICAgICAgICAgICAgICAgICovXG4gIHtcbiAgICBhZ29yaWM6IHRydWUsXG4gICAgY2VsZXN0aWE6IHRydWUsXG4gICAgY29zbW9zaHViOiB0cnVlLFxuICAgIGp1bm86IHRydWUsXG4gICAgbmV1dHJvbjogdHJ1ZSxcbiAgICBub2JsZTogdHJ1ZSxcbiAgICBvbW5pZmxpeGh1YjogdHJ1ZSxcbiAgICBvc21vc2lzOiB0cnVlLFxuICAgIHNlY3JldG5ldHdvcms6IHRydWUsXG4gICAgc3RhcmdhemU6IHRydWUsXG4gICAgc3RyaWRlOiB0cnVlLFxuICAgIHVtZWU6IHRydWVcbiAgfVxuKTtcbmhhcmRlbihQZm1FbmFibGVkKTtcbnZhciBJY2FFbmFibGVkID0gKFxuICAvKiAgICAgICAgICAgICAgICAqL1xuICB7XG4gICAgY2VsZXN0aWE6IHRydWUsXG4gICAgY29zbW9zaHViOiB0cnVlLFxuICAgIGR5ZHg6IHRydWUsXG4gICAganVubzogdHJ1ZSxcbiAgICBuZXV0cm9uOiB0cnVlLFxuICAgIG5vYmxlOiB0cnVlLFxuICAgIG9tbmlmbGl4aHViOiB0cnVlLFxuICAgIG9zbW9zaXM6IHRydWUsXG4gICAgc2VjcmV0bmV0d29yazogdHJ1ZSxcbiAgICBzdGFyZ2F6ZTogdHJ1ZSxcbiAgICBzdHJpZGU6IHRydWUsXG4gICAgdW1lZTogdHJ1ZVxuICB9XG4pO1xuaGFyZGVuKEljYUVuYWJsZWQpO1xuXG4vL1xudmFyIHJlZ2lzdGVyQ2hhaW5zQW5kQXNzZXRzID0gKGNoYWluSHViLCBicmFuZHMsIGNoYWluSW5mbywgYXNzZXRJbmZvKSA9PiB7XG4gIGNvbnNvbGUubG9nKFwiY2hhaW5IdWI6IHJlZ2lzdGVyaW5nIGNoYWluc1wiLCBPYmplY3Qua2V5cyhjaGFpbkluZm8gfHwge30pKTtcbiAgaWYgKCFjaGFpbkluZm8pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgY29ubnMgPSB7fTtcbiAgZm9yIChjb25zdCBbY2hhaW5OYW1lLCBhbGxJbmZvXSBvZiBPYmplY3QuZW50cmllcyhjaGFpbkluZm8pKSB7XG4gICAgaWYgKGFsbEluZm8ubmFtZXNwYWNlID09PSBcImNvc21vc1wiKSB7XG4gICAgICBjb25zdCB7IGNvbm5lY3Rpb25zLCAuLi5pbmZvIH0gPSBhbGxJbmZvO1xuICAgICAgY2hhaW5IdWIucmVnaXN0ZXJDaGFpbihjaGFpbk5hbWUsIGluZm8pO1xuICAgICAgaWYgKGNvbm5lY3Rpb25zKSBjb25uc1tpbmZvLmNoYWluSWRdID0gY29ubmVjdGlvbnM7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNoYWluSHViLnJlZ2lzdGVyQ2hhaW4oY2hhaW5OYW1lLCBhbGxJbmZvKTtcbiAgICB9XG4gIH1cbiAgY29uc3QgcmVnaXN0ZXJlZFBhaXJzID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgZm9yIChjb25zdCBbcENoYWluSWQsIGNvbm5JbmZvc10gb2YgT2JqZWN0LmVudHJpZXMoY29ubnMpKSB7XG4gICAgZm9yIChjb25zdCBbY0NoYWluSWQsIGNvbm5JbmZvXSBvZiBPYmplY3QuZW50cmllcyhjb25uSW5mb3MpKSB7XG4gICAgICBjb25zdCBwYWlyID0gW3BDaGFpbklkLCBjQ2hhaW5JZF0uc29ydCgpLmpvaW4oXCI8LT5cIik7XG4gICAgICBpZiAoIXJlZ2lzdGVyZWRQYWlycy5oYXMocGFpcikpIHtcbiAgICAgICAgY2hhaW5IdWIucmVnaXN0ZXJDb25uZWN0aW9uKHBDaGFpbklkLCBjQ2hhaW5JZCwgY29ubkluZm8pO1xuICAgICAgICByZWdpc3RlcmVkUGFpcnMuYWRkKHBhaXIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBjb25zb2xlLmxvZyhcImNoYWluSHViOiByZWdpc3RlcmVkIGNvbm5lY3Rpb25zXCIsIFsuLi5yZWdpc3RlcmVkUGFpcnNdLnNvcnQoKSk7XG4gIGNvbnNvbGUubG9nKFxuICAgIFwiY2hhaW5IdWI6IHJlZ2lzdGVyaW5nIGFzc2V0c1wiLFxuICAgIGFzc2V0SW5mbz8ubWFwKChbZGVub20sIHsgY2hhaW5OYW1lIH1dKSA9PiBgJHtjaGFpbk5hbWV9OiAke2Rlbm9tfWApXG4gICk7XG4gIGlmICghYXNzZXRJbmZvKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGZvciAoY29uc3QgW2Rlbm9tLCBpbmZvXSBvZiBhc3NldEluZm8pIHtcbiAgICBjb25zdCB7IGJyYW5kS2V5LCAuLi5yZXN0IH0gPSBpbmZvO1xuICAgIGNvbnN0IGluZm9XaXRoQnJhbmQgPSBicmFuZEtleSA/IHsgLi4ucmVzdCwgYnJhbmQ6IGJyYW5kc1ticmFuZEtleV0gfSA6IHJlc3Q7XG4gICAgY2hhaW5IdWIucmVnaXN0ZXJBc3NldChkZW5vbSwgaW5mb1dpdGhCcmFuZCk7XG4gIH1cbn07XG5cbi8vXG52YXIgaW1wb3J0X2JlY2gzMiA9IF9fdG9FU00ocmVxdWlyZV9kaXN0KCksIDEpO1xuXG4vL1xudmFyIGJhc2VfZXhwb3J0cyA9IHt9O1xuX19leHBvcnQoYmFzZV9leHBvcnRzLCB7XG4gIGV4Y2x1ZGU6ICgpID0+IGV4Y2x1ZGUsXG4gIGV4dHJhY3Q6ICgpID0+IGV4dHJhY3QsXG4gIHBhcnNlOiAoKSA9PiBwYXJzZTIsXG4gIHBhcnNlVXJsOiAoKSA9PiBwYXJzZVVybCxcbiAgcGljazogKCkgPT4gcGljayxcbiAgc3RyaW5naWZ5OiAoKSA9PiBzdHJpbmdpZnkyLFxuICBzdHJpbmdpZnlVcmw6ICgpID0+IHN0cmluZ2lmeVVybFxufSk7XG5cbi8vXG52YXIgdG9rZW4gPSBcIiVbYS1mMC05XXsyfVwiO1xudmFyIHNpbmdsZU1hdGNoZXIgPSBuZXcgUmVnRXhwKFwiKFwiICsgdG9rZW4gKyBcIil8KFteJV0rPylcIiwgXCJnaVwiKTtcbnZhciBtdWx0aU1hdGNoZXIgPSBuZXcgUmVnRXhwKFwiKFwiICsgdG9rZW4gKyBcIikrXCIsIFwiZ2lcIik7XG5mdW5jdGlvbiBkZWNvZGVDb21wb25lbnRzKGNvbXBvbmVudHMsIHNwbGl0KSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIFtkZWNvZGVVUklDb21wb25lbnQoY29tcG9uZW50cy5qb2luKFwiXCIpKV07XG4gIH0gY2F0Y2gge1xuICB9XG4gIGlmIChjb21wb25lbnRzLmxlbmd0aCA9PT0gMSkge1xuICAgIHJldHVybiBjb21wb25lbnRzO1xuICB9XG4gIHNwbGl0ID0gc3BsaXQgfHwgMTtcbiAgY29uc3QgbGVmdCA9IGNvbXBvbmVudHMuc2xpY2UoMCwgc3BsaXQpO1xuICBjb25zdCByaWdodCA9IGNvbXBvbmVudHMuc2xpY2Uoc3BsaXQpO1xuICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmNvbmNhdC5jYWxsKFtdLCBkZWNvZGVDb21wb25lbnRzKGxlZnQpLCBkZWNvZGVDb21wb25lbnRzKHJpZ2h0KSk7XG59XG5mdW5jdGlvbiBkZWNvZGUoaW5wdXQpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGlucHV0KTtcbiAgfSBjYXRjaCB7XG4gICAgbGV0IHRva2VucyA9IGlucHV0Lm1hdGNoKHNpbmdsZU1hdGNoZXIpIHx8IFtdO1xuICAgIGZvciAobGV0IGkyID0gMTsgaTIgPCB0b2tlbnMubGVuZ3RoOyBpMisrKSB7XG4gICAgICBpbnB1dCA9IGRlY29kZUNvbXBvbmVudHModG9rZW5zLCBpMikuam9pbihcIlwiKTtcbiAgICAgIHRva2VucyA9IGlucHV0Lm1hdGNoKHNpbmdsZU1hdGNoZXIpIHx8IFtdO1xuICAgIH1cbiAgICByZXR1cm4gaW5wdXQ7XG4gIH1cbn1cbmZ1bmN0aW9uIGN1c3RvbURlY29kZVVSSUNvbXBvbmVudChpbnB1dCkge1xuICBjb25zdCByZXBsYWNlTWFwID0ge1xuICAgIFwiJUZFJUZGXCI6IFwiXFx1RkZGRFxcdUZGRkRcIixcbiAgICBcIiVGRiVGRVwiOiBcIlxcdUZGRkRcXHVGRkZEXCJcbiAgfTtcbiAgbGV0IG1hdGNoID0gbXVsdGlNYXRjaGVyLmV4ZWMoaW5wdXQpO1xuICB3aGlsZSAobWF0Y2gpIHtcbiAgICB0cnkge1xuICAgICAgcmVwbGFjZU1hcFttYXRjaFswXV0gPSBkZWNvZGVVUklDb21wb25lbnQobWF0Y2hbMF0pO1xuICAgIH0gY2F0Y2gge1xuICAgICAgY29uc3QgcmVzdWx0ID0gZGVjb2RlKG1hdGNoWzBdKTtcbiAgICAgIGlmIChyZXN1bHQgIT09IG1hdGNoWzBdKSB7XG4gICAgICAgIHJlcGxhY2VNYXBbbWF0Y2hbMF1dID0gcmVzdWx0O1xuICAgICAgfVxuICAgIH1cbiAgICBtYXRjaCA9IG11bHRpTWF0Y2hlci5leGVjKGlucHV0KTtcbiAgfVxuICByZXBsYWNlTWFwW1wiJUMyXCJdID0gXCJcXHVGRkZEXCI7XG4gIGNvbnN0IGVudHJpZXMxMCA9IE9iamVjdC5rZXlzKHJlcGxhY2VNYXApO1xuICBmb3IgKGNvbnN0IGtleSBvZiBlbnRyaWVzMTApIHtcbiAgICBpbnB1dCA9IGlucHV0LnJlcGxhY2UobmV3IFJlZ0V4cChrZXksIFwiZ1wiKSwgcmVwbGFjZU1hcFtrZXldKTtcbiAgfVxuICByZXR1cm4gaW5wdXQ7XG59XG5mdW5jdGlvbiBkZWNvZGVVcmlDb21wb25lbnQoZW5jb2RlZFVSSSkge1xuICBpZiAodHlwZW9mIGVuY29kZWRVUkkgIT09IFwic3RyaW5nXCIpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRXhwZWN0ZWQgYGVuY29kZWRVUklgIHRvIGJlIG9mIHR5cGUgYHN0cmluZ2AsIGdvdCBgXCIgKyB0eXBlb2YgZW5jb2RlZFVSSSArIFwiYFwiKTtcbiAgfVxuICB0cnkge1xuICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoZW5jb2RlZFVSSSk7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBjdXN0b21EZWNvZGVVUklDb21wb25lbnQoZW5jb2RlZFVSSSk7XG4gIH1cbn1cblxuLy9cbmZ1bmN0aW9uIGluY2x1ZGVLZXlzKG9iamVjdCwgcHJlZGljYXRlKSB7XG4gIGNvbnN0IHJlc3VsdCA9IHt9O1xuICBpZiAoQXJyYXkuaXNBcnJheShwcmVkaWNhdGUpKSB7XG4gICAgZm9yIChjb25zdCBrZXkgb2YgcHJlZGljYXRlKSB7XG4gICAgICBjb25zdCBkZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmplY3QsIGtleSk7XG4gICAgICBpZiAoZGVzY3JpcHRvcj8uZW51bWVyYWJsZSkge1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVzdWx0LCBrZXksIGRlc2NyaXB0b3IpO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKGNvbnN0IGtleSBvZiBSZWZsZWN0Lm93bktleXMob2JqZWN0KSkge1xuICAgICAgY29uc3QgZGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBrZXkpO1xuICAgICAgaWYgKGRlc2NyaXB0b3IuZW51bWVyYWJsZSkge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IG9iamVjdFtrZXldO1xuICAgICAgICBpZiAocHJlZGljYXRlKGtleSwgdmFsdWUsIG9iamVjdCkpIHtcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVzdWx0LCBrZXksIGRlc2NyaXB0b3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8vXG5mdW5jdGlvbiBzcGxpdE9uRmlyc3Qoc3RyaW5nLCBzZXBhcmF0b3IpIHtcbiAgaWYgKCEodHlwZW9mIHN0cmluZyA9PT0gXCJzdHJpbmdcIiAmJiB0eXBlb2Ygc2VwYXJhdG9yID09PSBcInN0cmluZ1wiKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJFeHBlY3RlZCB0aGUgYXJndW1lbnRzIHRvIGJlIG9mIHR5cGUgYHN0cmluZ2BcIik7XG4gIH1cbiAgaWYgKHN0cmluZyA9PT0gXCJcIiB8fCBzZXBhcmF0b3IgPT09IFwiXCIpIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgY29uc3Qgc2VwYXJhdG9ySW5kZXggPSBzdHJpbmcuaW5kZXhPZihzZXBhcmF0b3IpO1xuICBpZiAoc2VwYXJhdG9ySW5kZXggPT09IC0xKSB7XG4gICAgcmV0dXJuIFtdO1xuICB9XG4gIHJldHVybiBbXG4gICAgc3RyaW5nLnNsaWNlKDAsIHNlcGFyYXRvckluZGV4KSxcbiAgICBzdHJpbmcuc2xpY2Uoc2VwYXJhdG9ySW5kZXggKyBzZXBhcmF0b3IubGVuZ3RoKVxuICBdO1xufVxuXG4vL1xudmFyIGlzTnVsbE9yVW5kZWZpbmVkID0gKHZhbHVlKSA9PiB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdm9pZCAwO1xudmFyIHN0cmljdFVyaUVuY29kZSA9IChzdHJpbmcpID0+IGVuY29kZVVSSUNvbXBvbmVudChzdHJpbmcpLnJlcGxhY2VBbGwoL1shJygpKl0vZywgKHgpID0+IGAlJHt4LmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCl9YCk7XG52YXIgZW5jb2RlRnJhZ21lbnRJZGVudGlmaWVyID0gU3ltYm9sKFwiZW5jb2RlRnJhZ21lbnRJZGVudGlmaWVyXCIpO1xuZnVuY3Rpb24gZW5jb2RlckZvckFycmF5Rm9ybWF0KG9wdGlvbnMpIHtcbiAgc3dpdGNoIChvcHRpb25zLmFycmF5Rm9ybWF0KSB7XG4gICAgY2FzZSBcImluZGV4XCI6IHtcbiAgICAgIHJldHVybiAoa2V5KSA9PiAocmVzdWx0LCB2YWx1ZSkgPT4ge1xuICAgICAgICBjb25zdCBpbmRleCA9IHJlc3VsdC5sZW5ndGg7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwIHx8IG9wdGlvbnMuc2tpcE51bGwgJiYgdmFsdWUgPT09IG51bGwgfHwgb3B0aW9ucy5za2lwRW1wdHlTdHJpbmcgJiYgdmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgICBbZW5jb2RlKGtleSwgb3B0aW9ucyksIFwiW1wiLCBpbmRleCwgXCJdXCJdLmpvaW4oXCJcIilcbiAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgLi4ucmVzdWx0LFxuICAgICAgICAgIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgXCJbXCIsIGVuY29kZShpbmRleCwgb3B0aW9ucyksIFwiXT1cIiwgZW5jb2RlKHZhbHVlLCBvcHRpb25zKV0uam9pbihcIlwiKVxuICAgICAgICBdO1xuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBcImJyYWNrZXRcIjoge1xuICAgICAgcmV0dXJuIChrZXkpID0+IChyZXN1bHQsIHZhbHVlKSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwIHx8IG9wdGlvbnMuc2tpcE51bGwgJiYgdmFsdWUgPT09IG51bGwgfHwgb3B0aW9ucy5za2lwRW1wdHlTdHJpbmcgJiYgdmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgICBbZW5jb2RlKGtleSwgb3B0aW9ucyksIFwiW11cIl0uam9pbihcIlwiKVxuICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgW2VuY29kZShrZXksIG9wdGlvbnMpLCBcIltdPVwiLCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKFwiXCIpXG4gICAgICAgIF07XG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiY29sb24tbGlzdC1zZXBhcmF0b3JcIjoge1xuICAgICAgcmV0dXJuIChrZXkpID0+IChyZXN1bHQsIHZhbHVlKSA9PiB7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwIHx8IG9wdGlvbnMuc2tpcE51bGwgJiYgdmFsdWUgPT09IG51bGwgfHwgb3B0aW9ucy5za2lwRW1wdHlTdHJpbmcgJiYgdmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAuLi5yZXN1bHQsXG4gICAgICAgICAgICBbZW5jb2RlKGtleSwgb3B0aW9ucyksIFwiOmxpc3Q9XCJdLmpvaW4oXCJcIilcbiAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgLi4ucmVzdWx0LFxuICAgICAgICAgIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgXCI6bGlzdD1cIiwgZW5jb2RlKHZhbHVlLCBvcHRpb25zKV0uam9pbihcIlwiKVxuICAgICAgICBdO1xuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBcImNvbW1hXCI6XG4gICAgY2FzZSBcInNlcGFyYXRvclwiOlxuICAgIGNhc2UgXCJicmFja2V0LXNlcGFyYXRvclwiOiB7XG4gICAgICBjb25zdCBrZXlWYWx1ZVNlcGFyYXRvciA9IG9wdGlvbnMuYXJyYXlGb3JtYXQgPT09IFwiYnJhY2tldC1zZXBhcmF0b3JcIiA/IFwiW109XCIgOiBcIj1cIjtcbiAgICAgIHJldHVybiAoa2V5KSA9PiAocmVzdWx0LCB2YWx1ZSkgPT4ge1xuICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCB8fCBvcHRpb25zLnNraXBOdWxsICYmIHZhbHVlID09PSBudWxsIHx8IG9wdGlvbnMuc2tpcEVtcHR5U3RyaW5nICYmIHZhbHVlID09PSBcIlwiKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICB2YWx1ZSA9IHZhbHVlID09PSBudWxsID8gXCJcIiA6IHZhbHVlO1xuICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiBbW2VuY29kZShrZXksIG9wdGlvbnMpLCBrZXlWYWx1ZVNlcGFyYXRvciwgZW5jb2RlKHZhbHVlLCBvcHRpb25zKV0uam9pbihcIlwiKV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtbcmVzdWx0LCBlbmNvZGUodmFsdWUsIG9wdGlvbnMpXS5qb2luKG9wdGlvbnMuYXJyYXlGb3JtYXRTZXBhcmF0b3IpXTtcbiAgICAgIH07XG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIHJldHVybiAoa2V5KSA9PiAocmVzdWx0LCB2YWx1ZSkgPT4ge1xuICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCB8fCBvcHRpb25zLnNraXBOdWxsICYmIHZhbHVlID09PSBudWxsIHx8IG9wdGlvbnMuc2tpcEVtcHR5U3RyaW5nICYmIHZhbHVlID09PSBcIlwiKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgLi4ucmVzdWx0LFxuICAgICAgICAgICAgZW5jb2RlKGtleSwgb3B0aW9ucylcbiAgICAgICAgICBdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgLi4ucmVzdWx0LFxuICAgICAgICAgIFtlbmNvZGUoa2V5LCBvcHRpb25zKSwgXCI9XCIsIGVuY29kZSh2YWx1ZSwgb3B0aW9ucyldLmpvaW4oXCJcIilcbiAgICAgICAgXTtcbiAgICAgIH07XG4gICAgfVxuICB9XG59XG5mdW5jdGlvbiBwYXJzZXJGb3JBcnJheUZvcm1hdChvcHRpb25zKSB7XG4gIGxldCByZXN1bHQ7XG4gIHN3aXRjaCAob3B0aW9ucy5hcnJheUZvcm1hdCkge1xuICAgIGNhc2UgXCJpbmRleFwiOiB7XG4gICAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG4gICAgICAgIHJlc3VsdCA9IC9cXFsoXFxkKildJC8uZXhlYyhrZXkpO1xuICAgICAgICBrZXkgPSBrZXkucmVwbGFjZSgvXFxbXFxkKl0kLywgXCJcIik7XG4gICAgICAgIGlmICghcmVzdWx0KSB7XG4gICAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IHZhbHVlO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYWNjdW11bGF0b3Jba2V5XSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIGFjY3VtdWxhdG9yW2tleV1bcmVzdWx0WzFdXSA9IHZhbHVlO1xuICAgICAgfTtcbiAgICB9XG4gICAgY2FzZSBcImJyYWNrZXRcIjoge1xuICAgICAgcmV0dXJuIChrZXksIHZhbHVlLCBhY2N1bXVsYXRvcikgPT4ge1xuICAgICAgICByZXN1bHQgPSAvKFxcW10pJC8uZXhlYyhrZXkpO1xuICAgICAgICBrZXkgPSBrZXkucmVwbGFjZSgvXFxbXSQvLCBcIlwiKTtcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gdmFsdWU7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhY2N1bXVsYXRvcltrZXldID09PSB2b2lkIDApIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gW3ZhbHVlXTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IFsuLi5hY2N1bXVsYXRvcltrZXldLCB2YWx1ZV07XG4gICAgICB9O1xuICAgIH1cbiAgICBjYXNlIFwiY29sb24tbGlzdC1zZXBhcmF0b3JcIjoge1xuICAgICAgcmV0dXJuIChrZXksIHZhbHVlLCBhY2N1bXVsYXRvcikgPT4ge1xuICAgICAgICByZXN1bHQgPSAvKDpsaXN0KSQvLmV4ZWMoa2V5KTtcbiAgICAgICAga2V5ID0ga2V5LnJlcGxhY2UoLzpsaXN0JC8sIFwiXCIpO1xuICAgICAgICBpZiAoIXJlc3VsdCkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFjY3VtdWxhdG9yW2tleV0gPT09IHZvaWQgMCkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSBbdmFsdWVdO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gWy4uLmFjY3VtdWxhdG9yW2tleV0sIHZhbHVlXTtcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgXCJjb21tYVwiOlxuICAgIGNhc2UgXCJzZXBhcmF0b3JcIjoge1xuICAgICAgcmV0dXJuIChrZXksIHZhbHVlLCBhY2N1bXVsYXRvcikgPT4ge1xuICAgICAgICBjb25zdCBpc0FycmF5OSA9IHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiB2YWx1ZS5pbmNsdWRlcyhvcHRpb25zLmFycmF5Rm9ybWF0U2VwYXJhdG9yKTtcbiAgICAgICAgY29uc3QgaXNFbmNvZGVkQXJyYXkgPSB0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgJiYgIWlzQXJyYXk5ICYmIGRlY29kZTIodmFsdWUsIG9wdGlvbnMpLmluY2x1ZGVzKG9wdGlvbnMuYXJyYXlGb3JtYXRTZXBhcmF0b3IpO1xuICAgICAgICB2YWx1ZSA9IGlzRW5jb2RlZEFycmF5ID8gZGVjb2RlMih2YWx1ZSwgb3B0aW9ucykgOiB2YWx1ZTtcbiAgICAgICAgY29uc3QgbmV3VmFsdWUgPSBpc0FycmF5OSB8fCBpc0VuY29kZWRBcnJheSA/IHZhbHVlLnNwbGl0KG9wdGlvbnMuYXJyYXlGb3JtYXRTZXBhcmF0b3IpLm1hcCgoaXRlbSkgPT4gZGVjb2RlMihpdGVtLCBvcHRpb25zKSkgOiB2YWx1ZSA9PT0gbnVsbCA/IHZhbHVlIDogZGVjb2RlMih2YWx1ZSwgb3B0aW9ucyk7XG4gICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSBuZXdWYWx1ZTtcbiAgICAgIH07XG4gICAgfVxuICAgIGNhc2UgXCJicmFja2V0LXNlcGFyYXRvclwiOiB7XG4gICAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG4gICAgICAgIGNvbnN0IGlzQXJyYXk5ID0gLyhcXFtdKSQvLnRlc3Qoa2V5KTtcbiAgICAgICAga2V5ID0ga2V5LnJlcGxhY2UoL1xcW10kLywgXCJcIik7XG4gICAgICAgIGlmICghaXNBcnJheTkpIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gdmFsdWUgPyBkZWNvZGUyKHZhbHVlLCBvcHRpb25zKSA6IHZhbHVlO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhcnJheVZhbHVlID0gdmFsdWUgPT09IG51bGwgPyBbXSA6IGRlY29kZTIodmFsdWUsIG9wdGlvbnMpLnNwbGl0KG9wdGlvbnMuYXJyYXlGb3JtYXRTZXBhcmF0b3IpO1xuICAgICAgICBpZiAoYWNjdW11bGF0b3Jba2V5XSA9PT0gdm9pZCAwKSB7XG4gICAgICAgICAgYWNjdW11bGF0b3Jba2V5XSA9IGFycmF5VmFsdWU7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSBbLi4uYWNjdW11bGF0b3Jba2V5XSwgLi4uYXJyYXlWYWx1ZV07XG4gICAgICB9O1xuICAgIH1cbiAgICBkZWZhdWx0OiB7XG4gICAgICByZXR1cm4gKGtleSwgdmFsdWUsIGFjY3VtdWxhdG9yKSA9PiB7XG4gICAgICAgIGlmIChhY2N1bXVsYXRvcltrZXldID09PSB2b2lkIDApIHtcbiAgICAgICAgICBhY2N1bXVsYXRvcltrZXldID0gdmFsdWU7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGFjY3VtdWxhdG9yW2tleV0gPSBbLi4uW2FjY3VtdWxhdG9yW2tleV1dLmZsYXQoKSwgdmFsdWVdO1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cbmZ1bmN0aW9uIHZhbGlkYXRlQXJyYXlGb3JtYXRTZXBhcmF0b3IodmFsdWUpIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIiB8fCB2YWx1ZS5sZW5ndGggIT09IDEpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiYXJyYXlGb3JtYXRTZXBhcmF0b3IgbXVzdCBiZSBzaW5nbGUgY2hhcmFjdGVyIHN0cmluZ1wiKTtcbiAgfVxufVxuZnVuY3Rpb24gZW5jb2RlKHZhbHVlLCBvcHRpb25zKSB7XG4gIGlmIChvcHRpb25zLmVuY29kZSkge1xuICAgIHJldHVybiBvcHRpb25zLnN0cmljdCA/IHN0cmljdFVyaUVuY29kZSh2YWx1ZSkgOiBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpO1xuICB9XG4gIHJldHVybiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIGRlY29kZTIodmFsdWUsIG9wdGlvbnMpIHtcbiAgaWYgKG9wdGlvbnMuZGVjb2RlKSB7XG4gICAgcmV0dXJuIGRlY29kZVVyaUNvbXBvbmVudCh2YWx1ZSk7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24ga2V5c1NvcnRlcihpbnB1dCkge1xuICBpZiAoQXJyYXkuaXNBcnJheShpbnB1dCkpIHtcbiAgICByZXR1cm4gaW5wdXQuc29ydCgpO1xuICB9XG4gIGlmICh0eXBlb2YgaW5wdXQgPT09IFwib2JqZWN0XCIpIHtcbiAgICByZXR1cm4ga2V5c1NvcnRlcihPYmplY3Qua2V5cyhpbnB1dCkpLnNvcnQoKGEyLCBiMykgPT4gTnVtYmVyKGEyKSAtIE51bWJlcihiMykpLm1hcCgoa2V5KSA9PiBpbnB1dFtrZXldKTtcbiAgfVxuICByZXR1cm4gaW5wdXQ7XG59XG5mdW5jdGlvbiByZW1vdmVIYXNoKGlucHV0KSB7XG4gIGNvbnN0IGhhc2hTdGFydCA9IGlucHV0LmluZGV4T2YoXCIjXCIpO1xuICBpZiAoaGFzaFN0YXJ0ICE9PSAtMSkge1xuICAgIGlucHV0ID0gaW5wdXQuc2xpY2UoMCwgaGFzaFN0YXJ0KTtcbiAgfVxuICByZXR1cm4gaW5wdXQ7XG59XG5mdW5jdGlvbiBnZXRIYXNoKHVybCkge1xuICBsZXQgaGFzaCA9IFwiXCI7XG4gIGNvbnN0IGhhc2hTdGFydCA9IHVybC5pbmRleE9mKFwiI1wiKTtcbiAgaWYgKGhhc2hTdGFydCAhPT0gLTEpIHtcbiAgICBoYXNoID0gdXJsLnNsaWNlKGhhc2hTdGFydCk7XG4gIH1cbiAgcmV0dXJuIGhhc2g7XG59XG5mdW5jdGlvbiBwYXJzZVZhbHVlKHZhbHVlLCBvcHRpb25zLCB0eXBlKSB7XG4gIGlmICh0eXBlID09PSBcInN0cmluZ1wiICYmIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBpZiAodHlwZW9mIHR5cGUgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gdHlwZSh2YWx1ZSk7XG4gIH1cbiAgaWYgKG9wdGlvbnMucGFyc2VCb29sZWFucyAmJiB2YWx1ZSAhPT0gbnVsbCAmJiAodmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gXCJ0cnVlXCIgfHwgdmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gXCJmYWxzZVwiKSkge1xuICAgIHJldHVybiB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSBcInRydWVcIjtcbiAgfVxuICBpZiAodHlwZSA9PT0gXCJudW1iZXJcIiAmJiAhTnVtYmVyLmlzTmFOKE51bWJlcih2YWx1ZSkpICYmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUudHJpbSgpICE9PSBcIlwiKSkge1xuICAgIHJldHVybiBOdW1iZXIodmFsdWUpO1xuICB9XG4gIGlmIChvcHRpb25zLnBhcnNlTnVtYmVycyAmJiAhTnVtYmVyLmlzTmFOKE51bWJlcih2YWx1ZSkpICYmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUudHJpbSgpICE9PSBcIlwiKSkge1xuICAgIHJldHVybiBOdW1iZXIodmFsdWUpO1xuICB9XG4gIHJldHVybiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIGV4dHJhY3QoaW5wdXQpIHtcbiAgaW5wdXQgPSByZW1vdmVIYXNoKGlucHV0KTtcbiAgY29uc3QgcXVlcnlTdGFydCA9IGlucHV0LmluZGV4T2YoXCI/XCIpO1xuICBpZiAocXVlcnlTdGFydCA9PT0gLTEpIHtcbiAgICByZXR1cm4gXCJcIjtcbiAgfVxuICByZXR1cm4gaW5wdXQuc2xpY2UocXVlcnlTdGFydCArIDEpO1xufVxuZnVuY3Rpb24gcGFyc2UyKHF1ZXJ5LCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSB7XG4gICAgZGVjb2RlOiB0cnVlLFxuICAgIHNvcnQ6IHRydWUsXG4gICAgYXJyYXlGb3JtYXQ6IFwibm9uZVwiLFxuICAgIGFycmF5Rm9ybWF0U2VwYXJhdG9yOiBcIixcIixcbiAgICBwYXJzZU51bWJlcnM6IGZhbHNlLFxuICAgIHBhcnNlQm9vbGVhbnM6IGZhbHNlLFxuICAgIHR5cGVzOiAvKiAgICAgICAgICAgKi8gT2JqZWN0LmNyZWF0ZShudWxsKSxcbiAgICAuLi5vcHRpb25zXG4gIH07XG4gIHZhbGlkYXRlQXJyYXlGb3JtYXRTZXBhcmF0b3Iob3B0aW9ucy5hcnJheUZvcm1hdFNlcGFyYXRvcik7XG4gIGNvbnN0IGZvcm1hdHRlciA9IHBhcnNlckZvckFycmF5Rm9ybWF0KG9wdGlvbnMpO1xuICBjb25zdCByZXR1cm5WYWx1ZSA9IC8qICAgICAgICAgICAqLyBPYmplY3QuY3JlYXRlKG51bGwpO1xuICBpZiAodHlwZW9mIHF1ZXJ5ICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHJldHVyblZhbHVlO1xuICB9XG4gIHF1ZXJ5ID0gcXVlcnkudHJpbSgpLnJlcGxhY2UoL15bPyMmXS8sIFwiXCIpO1xuICBpZiAoIXF1ZXJ5KSB7XG4gICAgcmV0dXJuIHJldHVyblZhbHVlO1xuICB9XG4gIGZvciAoY29uc3QgcGFyYW1ldGVyIG9mIHF1ZXJ5LnNwbGl0KFwiJlwiKSkge1xuICAgIGlmIChwYXJhbWV0ZXIgPT09IFwiXCIpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBjb25zdCBwYXJhbWV0ZXJfID0gb3B0aW9ucy5kZWNvZGUgPyBwYXJhbWV0ZXIucmVwbGFjZUFsbChcIitcIiwgXCIgXCIpIDogcGFyYW1ldGVyO1xuICAgIGxldCBba2V5LCB2YWx1ZV0gPSBzcGxpdE9uRmlyc3QocGFyYW1ldGVyXywgXCI9XCIpO1xuICAgIGlmIChrZXkgPT09IHZvaWQgMCkge1xuICAgICAga2V5ID0gcGFyYW1ldGVyXztcbiAgICB9XG4gICAgdmFsdWUgPSB2YWx1ZSA9PT0gdm9pZCAwID8gbnVsbCA6IFtcImNvbW1hXCIsIFwic2VwYXJhdG9yXCIsIFwiYnJhY2tldC1zZXBhcmF0b3JcIl0uaW5jbHVkZXMob3B0aW9ucy5hcnJheUZvcm1hdCkgPyB2YWx1ZSA6IGRlY29kZTIodmFsdWUsIG9wdGlvbnMpO1xuICAgIGZvcm1hdHRlcihkZWNvZGUyKGtleSwgb3B0aW9ucyksIHZhbHVlLCByZXR1cm5WYWx1ZSk7XG4gIH1cbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocmV0dXJuVmFsdWUpKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIiAmJiB2YWx1ZSAhPT0gbnVsbCAmJiBvcHRpb25zLnR5cGVzW2tleV0gIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIGZvciAoY29uc3QgW2tleTIsIHZhbHVlMl0gb2YgT2JqZWN0LmVudHJpZXModmFsdWUpKSB7XG4gICAgICAgIGNvbnN0IHR5cGUgPSBvcHRpb25zLnR5cGVzW2tleV0gPyBvcHRpb25zLnR5cGVzW2tleV0ucmVwbGFjZShcIltdXCIsIFwiXCIpIDogdm9pZCAwO1xuICAgICAgICB2YWx1ZVtrZXkyXSA9IHBhcnNlVmFsdWUodmFsdWUyLCBvcHRpb25zLCB0eXBlKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIiAmJiB2YWx1ZSAhPT0gbnVsbCAmJiBvcHRpb25zLnR5cGVzW2tleV0gPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHJldHVyblZhbHVlW2tleV0gPSBPYmplY3QudmFsdWVzKHZhbHVlKS5qb2luKG9wdGlvbnMuYXJyYXlGb3JtYXRTZXBhcmF0b3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm5WYWx1ZVtrZXldID0gcGFyc2VWYWx1ZSh2YWx1ZSwgb3B0aW9ucywgb3B0aW9ucy50eXBlc1trZXldKTtcbiAgICB9XG4gIH1cbiAgaWYgKG9wdGlvbnMuc29ydCA9PT0gZmFsc2UpIHtcbiAgICByZXR1cm4gcmV0dXJuVmFsdWU7XG4gIH1cbiAgcmV0dXJuIChvcHRpb25zLnNvcnQgPT09IHRydWUgPyBPYmplY3Qua2V5cyhyZXR1cm5WYWx1ZSkuc29ydCgpIDogT2JqZWN0LmtleXMocmV0dXJuVmFsdWUpLnNvcnQob3B0aW9ucy5zb3J0KSkucmVkdWNlKChyZXN1bHQsIGtleSkgPT4ge1xuICAgIGNvbnN0IHZhbHVlID0gcmV0dXJuVmFsdWVba2V5XTtcbiAgICByZXN1bHRba2V5XSA9IEJvb2xlYW4odmFsdWUpICYmIHR5cGVvZiB2YWx1ZSA9PT0gXCJvYmplY3RcIiAmJiAhQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyBrZXlzU29ydGVyKHZhbHVlKSA6IHZhbHVlO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH0sIC8qICAgICAgICAgICAqLyBPYmplY3QuY3JlYXRlKG51bGwpKTtcbn1cbmZ1bmN0aW9uIHN0cmluZ2lmeTIob2JqZWN0LCBvcHRpb25zKSB7XG4gIGlmICghb2JqZWN0KSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cbiAgb3B0aW9ucyA9IHtcbiAgICBlbmNvZGU6IHRydWUsXG4gICAgc3RyaWN0OiB0cnVlLFxuICAgIGFycmF5Rm9ybWF0OiBcIm5vbmVcIixcbiAgICBhcnJheUZvcm1hdFNlcGFyYXRvcjogXCIsXCIsXG4gICAgLi4ub3B0aW9uc1xuICB9O1xuICB2YWxpZGF0ZUFycmF5Rm9ybWF0U2VwYXJhdG9yKG9wdGlvbnMuYXJyYXlGb3JtYXRTZXBhcmF0b3IpO1xuICBjb25zdCBzaG91bGRGaWx0ZXIgPSAoa2V5KSA9PiBvcHRpb25zLnNraXBOdWxsICYmIGlzTnVsbE9yVW5kZWZpbmVkKG9iamVjdFtrZXldKSB8fCBvcHRpb25zLnNraXBFbXB0eVN0cmluZyAmJiBvYmplY3Rba2V5XSA9PT0gXCJcIjtcbiAgY29uc3QgZm9ybWF0dGVyID0gZW5jb2RlckZvckFycmF5Rm9ybWF0KG9wdGlvbnMpO1xuICBjb25zdCBvYmplY3RDb3B5ID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKG9iamVjdCkpIHtcbiAgICBpZiAoIXNob3VsZEZpbHRlcihrZXkpKSB7XG4gICAgICBvYmplY3RDb3B5W2tleV0gPSB2YWx1ZTtcbiAgICB9XG4gIH1cbiAgY29uc3Qga2V5czQgPSBPYmplY3Qua2V5cyhvYmplY3RDb3B5KTtcbiAgaWYgKG9wdGlvbnMuc29ydCAhPT0gZmFsc2UpIHtcbiAgICBrZXlzNC5zb3J0KG9wdGlvbnMuc29ydCk7XG4gIH1cbiAgcmV0dXJuIGtleXM0Lm1hcCgoa2V5KSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBvYmplY3Rba2V5XTtcbiAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkge1xuICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuICAgIGlmICh2YWx1ZSA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIGVuY29kZShrZXksIG9wdGlvbnMpO1xuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDAgJiYgb3B0aW9ucy5hcnJheUZvcm1hdCA9PT0gXCJicmFja2V0LXNlcGFyYXRvclwiKSB7XG4gICAgICAgIHJldHVybiBlbmNvZGUoa2V5LCBvcHRpb25zKSArIFwiW11cIjtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZS5yZWR1Y2UoZm9ybWF0dGVyKGtleSksIFtdKS5qb2luKFwiJlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGVuY29kZShrZXksIG9wdGlvbnMpICsgXCI9XCIgKyBlbmNvZGUodmFsdWUsIG9wdGlvbnMpO1xuICB9KS5maWx0ZXIoKHgpID0+IHgubGVuZ3RoID4gMCkuam9pbihcIiZcIik7XG59XG5mdW5jdGlvbiBwYXJzZVVybCh1cmwsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IHtcbiAgICBkZWNvZGU6IHRydWUsXG4gICAgLi4ub3B0aW9uc1xuICB9O1xuICBsZXQgW3VybF8sIGhhc2hdID0gc3BsaXRPbkZpcnN0KHVybCwgXCIjXCIpO1xuICBpZiAodXJsXyA9PT0gdm9pZCAwKSB7XG4gICAgdXJsXyA9IHVybDtcbiAgfVxuICByZXR1cm4ge1xuICAgIHVybDogdXJsXz8uc3BsaXQoXCI/XCIpPy5bMF0gPz8gXCJcIixcbiAgICBxdWVyeTogcGFyc2UyKGV4dHJhY3QodXJsKSwgb3B0aW9ucyksXG4gICAgLi4uKG9wdGlvbnMmJiBvcHRpb25zLnBhcnNlRnJhZ21lbnRJZGVudGlmaWVyICYmIGhhc2ggPyB7IGZyYWdtZW50SWRlbnRpZmllcjogZGVjb2RlMihoYXNoLCBvcHRpb25zKSB9IDoge30pXG4gIH07XG59XG5mdW5jdGlvbiBzdHJpbmdpZnlVcmwob2JqZWN0LCBvcHRpb25zKSB7XG4gIG9wdGlvbnMgPSB7XG4gICAgZW5jb2RlOiB0cnVlLFxuICAgIHN0cmljdDogdHJ1ZSxcbiAgICBbZW5jb2RlRnJhZ21lbnRJZGVudGlmaWVyXTogdHJ1ZSxcbiAgICAuLi5vcHRpb25zXG4gIH07XG4gIGNvbnN0IHVybCA9IHJlbW92ZUhhc2gob2JqZWN0LnVybCkuc3BsaXQoXCI/XCIpWzBdIHx8IFwiXCI7XG4gIGNvbnN0IHF1ZXJ5RnJvbVVybCA9IGV4dHJhY3Qob2JqZWN0LnVybCk7XG4gIGNvbnN0IHF1ZXJ5ID0ge1xuICAgIC4uLnBhcnNlMihxdWVyeUZyb21VcmwsIHsgc29ydDogZmFsc2UgfSksXG4gICAgLi4ub2JqZWN0LnF1ZXJ5XG4gIH07XG4gIGxldCBxdWVyeVN0cmluZyA9IHN0cmluZ2lmeTIocXVlcnksIG9wdGlvbnMpO1xuICBxdWVyeVN0cmluZyAmJj0gYD8ke3F1ZXJ5U3RyaW5nfWA7XG4gIGxldCBoYXNoID0gZ2V0SGFzaChvYmplY3QudXJsKTtcbiAgaWYgKHR5cGVvZiBvYmplY3QuZnJhZ21lbnRJZGVudGlmaWVyID09PSBcInN0cmluZ1wiKSB7XG4gICAgY29uc3QgdXJsT2JqZWN0Rm9yRnJhZ21lbnRFbmNvZGUgPSBuZXcgVVJMKHVybCk7XG4gICAgdXJsT2JqZWN0Rm9yRnJhZ21lbnRFbmNvZGUuaGFzaCA9IG9iamVjdC5mcmFnbWVudElkZW50aWZpZXI7XG4gICAgaGFzaCA9IG9wdGlvbnNbZW5jb2RlRnJhZ21lbnRJZGVudGlmaWVyXSA/IHVybE9iamVjdEZvckZyYWdtZW50RW5jb2RlLmhhc2ggOiBgIyR7b2JqZWN0LmZyYWdtZW50SWRlbnRpZmllcn1gO1xuICB9XG4gIHJldHVybiBgJHt1cmx9JHtxdWVyeVN0cmluZ30ke2hhc2h9YDtcbn1cbmZ1bmN0aW9uIHBpY2soaW5wdXQsIGZpbHRlciwgb3B0aW9ucykge1xuICBvcHRpb25zID0ge1xuICAgIHBhcnNlRnJhZ21lbnRJZGVudGlmaWVyOiB0cnVlLFxuICAgIFtlbmNvZGVGcmFnbWVudElkZW50aWZpZXJdOiBmYWxzZSxcbiAgICAuLi5vcHRpb25zXG4gIH07XG4gIGNvbnN0IHsgdXJsLCBxdWVyeSwgZnJhZ21lbnRJZGVudGlmaWVyIH0gPSBwYXJzZVVybChpbnB1dCwgb3B0aW9ucyk7XG4gIHJldHVybiBzdHJpbmdpZnlVcmwoe1xuICAgIHVybCxcbiAgICBxdWVyeTogaW5jbHVkZUtleXMocXVlcnksIGZpbHRlciksXG4gICAgZnJhZ21lbnRJZGVudGlmaWVyXG4gIH0sIG9wdGlvbnMpO1xufVxuZnVuY3Rpb24gZXhjbHVkZShpbnB1dCwgZmlsdGVyLCBvcHRpb25zKSB7XG4gIGNvbnN0IGV4Y2x1c2lvbkZpbHRlciA9IEFycmF5LmlzQXJyYXkoZmlsdGVyKSA/IChrZXkpID0+ICFmaWx0ZXIuaW5jbHVkZXMoa2V5KSA6IChrZXksIHZhbHVlKSA9PiAhZmlsdGVyKGtleSwgdmFsdWUpO1xuICByZXR1cm4gcGljayhpbnB1dCwgZXhjbHVzaW9uRmlsdGVyLCBvcHRpb25zKTtcbn1cblxuLy9cbnZhciBxdWVyeV9zdHJpbmdfZGVmYXVsdCA9IGJhc2VfZXhwb3J0cztcblxuLy9cbnZhciByNCA9IGdsb2JhbFRoaXMuaGFyZGVuIHx8IE9iamVjdC5mcmVlemU7XG52YXIgdDQgPSBbMTIwLCAyNDEsIDExMl07XG5yNCh0NCk7XG52YXIgZGVjb2RlQmVjaDMyID0gKG8yLCB0NSA9IDEwMjQpID0+IHtcbiAgY29uc3QgeyBwcmVmaXg6IHMzLCB3b3JkczogbjIgfSA9IGltcG9ydF9iZWNoMzIuYmVjaDMyLmRlY29kZShvMiwgdDUpLCBkID0gaW1wb3J0X2JlY2gzMi5iZWNoMzIuZnJvbVdvcmRzKG4yKSwgYzIgPSBuZXcgVWludDhBcnJheShkKTtcbiAgcmV0dXJuIHI0KHsgcHJlZml4OiBzMywgYnl0ZXM6IGMyIH0pO1xufTtcbnI0KGRlY29kZUJlY2gzMik7XG52YXIgZW5jb2RlQmVjaDMyID0gKG8yLCByNSwgdDUgPSAxMDI0KSA9PiB7XG4gIGNvbnN0IHMzID0gaW1wb3J0X2JlY2gzMi5iZWNoMzIudG9Xb3JkcyhyNSk7XG4gIHJldHVybiBpbXBvcnRfYmVjaDMyLmJlY2gzMi5lbmNvZGUobzIsIHMzLCB0NSk7XG59O1xucjQoZW5jb2RlQmVjaDMyKTtcbnZhciBqb2luSG9va2VkQWRkcmVzcyA9IChlMiwgbzIsIHI1ID0gMTAyNCkgPT4ge1xuICBjb25zdCB7IHByZWZpeDogczMsIGJ5dGVzOiBuMiB9ID0gZGVjb2RlQmVjaDMyKGUyLCByNSksIGQgPSBuMi5sZW5ndGgsIGMyID0gbzIubGVuZ3RoLCBhMiA9IDY1NTM2O1xuICBpZiAoZCA+PSBhMikgdGhyb3cgUmFuZ2VFcnJvcihgQmFzZSBhZGRyZXNzIGxlbmd0aCAweCR7ZC50b1N0cmluZygxNil9IGV4Y2VlZHMgbWF4aW11bSAweCR7YTIudG9TdHJpbmcoMTYpfWApO1xuICBpZiAoIU51bWJlci5pc1NhZmVJbnRlZ2VyKGMyKSB8fCBjMiA8IDApIHRocm93IFJhbmdlRXJyb3IoYEhvb2sgZGF0YSBsZW5ndGggJHtjMn0gaXMgbm90IGEgbm9uLW5lZ2F0aXZlIGludGVnZXJgKTtcbiAgY29uc3QgaTIgPSB0NC5sZW5ndGgsIGggPSBuZXcgVWludDhBcnJheShpMiArIGQgKyBjMiArIDIpO1xuICBoLnNldCh0NCwgMCksIGhbaTIgLSAxXSB8PSAwLCBoLnNldChuMiwgaTIpLCBoLnNldChvMiwgaTIgKyBkKTtcbiAgbGV0IGczID0gZDtcbiAgZm9yIChsZXQgZTMgPSAwOyBlMyA8IDI7IGUzICs9IDEpIGhbaC5sZW5ndGggLSAxIC0gZTNdID0gMjU1ICYgZzMsIGczID4+Pj0gODtcbiAgcmV0dXJuIGVuY29kZUJlY2gzMihzMywgaCwgcjUpO1xufTtcbnI0KGpvaW5Ib29rZWRBZGRyZXNzKTtcbnZhciBlbmNvZGVBZGRyZXNzSG9vayA9IChlMiwgcjUsIHQ1KSA9PiB7XG4gIGNvbnN0IHMzID0gcXVlcnlfc3RyaW5nX2RlZmF1bHQuc3RyaW5naWZ5KHI1KSwgbjIgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoYD8ke3MzfWApO1xuICByZXR1cm4gam9pbkhvb2tlZEFkZHJlc3MoZTIsIG4yLCB0NSk7XG59O1xucjQoZW5jb2RlQWRkcmVzc0hvb2spO1xudmFyIGRlY29kZUFkZHJlc3NIb29rID0gKGUyLCB0NSkgPT4ge1xuICBjb25zdCB7IGJhc2VBZGRyZXNzOiBzMywgaG9va0RhdGE6IG4yIH0gPSBzcGxpdEhvb2tlZEFkZHJlc3MoZTIsIHQ1KSwgZCA9IG5ldyBUZXh0RGVjb2RlcigpLmRlY29kZShuMik7XG4gIGlmIChkICYmICFkLnN0YXJ0c1dpdGgoXCI/XCIpKSB0aHJvdyBFcnJvcihgSG9vayBkYXRhIGRvZXMgbm90IHN0YXJ0IHdpdGggJz8nOiAke2R9YCk7XG4gIGNvbnN0IGMyID0gcXVlcnlfc3RyaW5nX2RlZmF1bHQucGFyc2UoZCksIGEyID0gcjQoeyAuLi5jMiB9KTtcbiAgcmV0dXJuIHI0KHsgYmFzZUFkZHJlc3M6IHMzLCBxdWVyeTogYTIgfSk7XG59O1xucjQoZGVjb2RlQWRkcmVzc0hvb2spO1xudmFyIHNwbGl0SG9va2VkQWRkcmVzcyA9IChlMiwgbzIgPSAxMDI0KSA9PiB7XG4gIGNvbnN0IHsgcHJlZml4OiBzMywgYnl0ZXM6IG4yIH0gPSBkZWNvZGVCZWNoMzIoZTIsIG8yKSwgZCA9IHQ0Lmxlbmd0aDtcbiAgbGV0IGMyID0gMjU1O1xuICBmb3IgKGxldCBvMyA9IDA7IG8zIDwgZDsgbzMgKz0gMSkge1xuICAgIGxldCBzNCA9IG4yW28zXTtcbiAgICBpZiAobzMgPT09IGQgLSAxICYmIChjMiA9IDE1ICYgczQsIHM0ICY9IDI0MCksIHM0ICE9PSB0NFtvM10pIHJldHVybiByNCh7IGJhc2VBZGRyZXNzOiBlMiwgaG9va0RhdGE6IG5ldyBVaW50OEFycmF5KCkgfSk7XG4gIH1cbiAgaWYgKDAgIT09IGMyKSB0aHJvdyBUeXBlRXJyb3IoYFVuc3VwcG9ydGVkIGFkZHJlc3MgaG9vayB2ZXJzaW9uICR7YzJ9YCk7XG4gIGxldCBhMiA9IDA7XG4gIGZvciAobGV0IGUzID0gMTsgZTMgPj0gMDsgZTMgLT0gMSkge1xuICAgIGNvbnN0IG8zID0gbjIuYXQoLWUzIC0gMSk7XG4gICAgaWYgKHZvaWQgMCA9PT0gbzMpIHRocm93IFR5cGVFcnJvcihgQ2Fubm90IGdldCBiYXNlIGFkZHJlc3MgbGVuZ3RoIGZyb20gYnl0ZSAkey1lMyAtIDF9IG9mICR7bjIubGVuZ3RofWApO1xuICAgIGEyIDw8PSA4LCBhMiB8PSBvMztcbiAgfVxuICBjb25zdCBpMiA9IGEyO1xuICBpZiAoaTIgPiBuMi5sZW5ndGggLSAyIC0gZCkgdGhyb3cgVHlwZUVycm9yKGBCYXNlIGFkZHJlc3MgbGVuZ3RoIDB4JHtpMi50b1N0cmluZygxNil9IGlzIGxvbmdlciB0aGFuIHNwZWNpbWVuIGxlbmd0aCAke24yLmxlbmd0aCAtIDIgLSBkfWApO1xuICBjb25zdCBoID0gbjIuc3ViYXJyYXkoZCwgZCArIGkyKSwgZzMgPSBlbmNvZGVCZWNoMzIoczMsIGgsIG8yKSwgbDMgPSBuMi5zdWJhcnJheShkICsgaTIsIC0yKTtcbiAgcmV0dXJuIHI0KHsgYmFzZUFkZHJlc3M6IGczLCBob29rRGF0YTogbDMgfSk7XG59O1xucjQoc3BsaXRIb29rZWRBZGRyZXNzKTtcblxuLy9cbnZhciB7IGFkZDogYWRkMywgaXNHVEU6IGlzR1RFMiwgc3VidHJhY3Q6IHN1YnRyYWN0MywgbWFrZUVtcHR5IH0gPSBBbW91bnRNYXRoO1xudmFyIGdldENvbmZpZ1ZhbHVlID0gKGZlZUNvbmZpZywga2V5LCBkZXN0aW5hdGlvbikgPT4ge1xuICBjb25zdCBjaGFpbklkID0gY2hhaW5PZkFjY291bnQoZGVzdGluYXRpb24pO1xuICBpZiAoZmVlQ29uZmlnLmRlc3RpbmF0aW9uT3ZlcnJpZGVzPy5bY2hhaW5JZF0gJiYgZmVlQ29uZmlnLmRlc3RpbmF0aW9uT3ZlcnJpZGVzW2NoYWluSWRdW2tleV0gIT09IHZvaWQgMCkge1xuICAgIHJldHVybiBmZWVDb25maWcuZGVzdGluYXRpb25PdmVycmlkZXNbY2hhaW5JZF1ba2V5XTtcbiAgfVxuICByZXR1cm4gZmVlQ29uZmlnW2tleV07XG59O1xudmFyIG1ha2VGZWVUb29scyA9IChmZWVDb25maWcpID0+IHtcbiAgbXVzdE1hdGNoKGZlZUNvbmZpZywgRmVlQ29uZmlnU2hhcGUsIFwiTXVzdCBwcm92aWRlIGZlZUNvbmZpZ1wiKTtcbiAgY29uc3QgZW1wdHlBbW91bnQgPSBtYWtlRW1wdHkoZmVlQ29uZmlnLmZsYXQuYnJhbmQpO1xuICBjb25zdCBmZWVUb29scyA9IGhhcmRlbih7XG4gICAgLypcblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIGNhbGN1bGF0ZUJhc2VGZWUocmVxdWVzdGVkLCBkZXN0aW5hdGlvbikge1xuICAgICAgY29uc3QgZmxhdCA9IGdldENvbmZpZ1ZhbHVlKGZlZUNvbmZpZywgXCJmbGF0XCIsIGRlc3RpbmF0aW9uKTtcbiAgICAgIGNvbnN0IHZhcmlhYmxlUmF0ZSA9IGdldENvbmZpZ1ZhbHVlKFxuICAgICAgICBmZWVDb25maWcsXG4gICAgICAgIFwidmFyaWFibGVSYXRlXCIsXG4gICAgICAgIGRlc3RpbmF0aW9uXG4gICAgICApO1xuICAgICAgcmV0dXJuIGFkZDMobXVsdGlwbHlCeShyZXF1ZXN0ZWQsIHZhcmlhYmxlUmF0ZSksIGZsYXQpO1xuICAgIH0sXG4gICAgLypcblxuXG5cblxuXG4gICAgICovXG4gICAgY2FsY3VsYXRlUmVsYXlGZWUoZGVzdGluYXRpb24pIHtcbiAgICAgIGNvbnN0IHJlbGF5ID0gZ2V0Q29uZmlnVmFsdWUoZmVlQ29uZmlnLCBcInJlbGF5XCIsIGRlc3RpbmF0aW9uKTtcbiAgICAgIHJldHVybiByZWxheSB8fCBlbXB0eUFtb3VudDtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuICAgICAqL1xuICAgIGNhbGN1bGF0ZUFkdmFuY2VGZWUocmVxdWVzdGVkLCBkZXN0aW5hdGlvbikge1xuICAgICAgY29uc3QgYmFzZUZlZSA9IGZlZVRvb2xzLmNhbGN1bGF0ZUJhc2VGZWUocmVxdWVzdGVkLCBkZXN0aW5hdGlvbik7XG4gICAgICBjb25zdCByZWxheUZlZSA9IGZlZVRvb2xzLmNhbGN1bGF0ZVJlbGF5RmVlKGRlc3RpbmF0aW9uKTtcbiAgICAgIGNvbnN0IGZlZSA9IGFkZDMoYmFzZUZlZSwgcmVsYXlGZWUpO1xuICAgICAgIWlzR1RFMihmZWUsIHJlcXVlc3RlZCkgfHwgdGhyb3dSZWRhY3RlZGBSZXF1ZXN0IG11c3QgZXhjZWVkIGZlZXMuYDtcbiAgICAgIHJldHVybiBmZWU7XG4gICAgfSxcbiAgICAvKlxuXG5cblxuXG5cbiAgICAgKi9cbiAgICBjYWxjdWxhdGVBZHZhbmNlKHJlcXVlc3RlZCwgZGVzdGluYXRpb24pIHtcbiAgICAgIGNvbnN0IGZlZSA9IGZlZVRvb2xzLmNhbGN1bGF0ZUFkdmFuY2VGZWUocmVxdWVzdGVkLCBkZXN0aW5hdGlvbik7XG4gICAgICByZXR1cm4gc3VidHJhY3QzKHJlcXVlc3RlZCwgZmVlKTtcbiAgICB9LFxuICAgIC8qXG5cblxuXG5cblxuXG5cblxuICAgICAqL1xuICAgIGNhbGN1bGF0ZVNwbGl0KHJlcXVlc3RlZCwgZGVzdGluYXRpb24pIHtcbiAgICAgIGNvbnN0IGJhc2VGZWUgPSBmZWVUb29scy5jYWxjdWxhdGVCYXNlRmVlKHJlcXVlc3RlZCwgZGVzdGluYXRpb24pO1xuICAgICAgY29uc3QgcmVsYXlGZWUgPSBmZWVUb29scy5jYWxjdWxhdGVSZWxheUZlZShkZXN0aW5hdGlvbik7XG4gICAgICBjb25zdCB0b3RhbEZlZSA9IGFkZDMoYmFzZUZlZSwgcmVsYXlGZWUpO1xuICAgICAgIWlzR1RFMih0b3RhbEZlZSwgcmVxdWVzdGVkKSB8fCB0aHJvd1JlZGFjdGVkYFJlcXVlc3QgbXVzdCBleGNlZWQgZmVlcy5gO1xuICAgICAgY29uc3QgY29udHJhY3RSYXRlID0gZ2V0Q29uZmlnVmFsdWUoXG4gICAgICAgIGZlZUNvbmZpZyxcbiAgICAgICAgXCJjb250cmFjdFJhdGVcIixcbiAgICAgICAgZGVzdGluYXRpb25cbiAgICAgICk7XG4gICAgICBjb25zdCBQcmluY2lwYWwgPSBzdWJ0cmFjdDMocmVxdWVzdGVkLCB0b3RhbEZlZSk7XG4gICAgICBjb25zdCBDb250cmFjdEZlZSA9IG11bHRpcGx5QnkoYmFzZUZlZSwgY29udHJhY3RSYXRlKTtcbiAgICAgIGNvbnN0IFBvb2xGZWUgPSBzdWJ0cmFjdDMoYmFzZUZlZSwgQ29udHJhY3RGZWUpO1xuICAgICAgcmV0dXJuIGhhcmRlbih7IFByaW5jaXBhbCwgUG9vbEZlZSwgQ29udHJhY3RGZWUsIFJlbGF5RmVlOiByZWxheUZlZSB9KTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gZmVlVG9vbHM7XG59O1xuXG4vL1xudmFyIG1ha2VTdXBwb3J0c0NjdHAgPSAoY2hhaW5IdWIpID0+IChkZXN0KSA9PiB7XG4gIGNvbnN0IHsgbmFtZXNwYWNlLCByZWZlcmVuY2UgfSA9IHBhcnNlQWNjb3VudElkKGRlc3QpO1xuICBpZiAobmFtZXNwYWNlICE9PSBcImVpcDE1NVwiKSByZXR1cm4gZmFsc2U7XG4gIHRyeSB7XG4gICAgY29uc3QgY2kgPSBjaGFpbkh1Yi5nZXRDaGFpbkluZm9CeUNoYWluSWQoYCR7bmFtZXNwYWNlfToke3JlZmVyZW5jZX1gKTtcbiAgICByZXR1cm4gdHlwZW9mIGNpLmNjdHBEZXN0aW5hdGlvbkRvbWFpbiA9PT0gXCJudW1iZXJcIjtcbiAgfSBjYXRjaCAoZTIpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cbi8vXG52YXIgQWR2YW5jZXJWb3dDdHhTaGFwZSA9IE0uc3BsaXRSZWNvcmQoXG4gIHtcbiAgICBmdWxsQW1vdW50OiBBbnlOYXRBbW91bnRTaGFwZSxcbiAgICBhZHZhbmNlQW1vdW50OiBBbnlOYXRBbW91bnRTaGFwZSxcbiAgICBkZXN0aW5hdGlvbjogTS5zdHJpbmcoKSxcbiAgICAvL1xuICAgIGZvcndhcmRpbmdBZGRyZXNzOiBNLnN0cmluZygpLFxuICAgIHR4SGFzaDogRXZtSGFzaFNoYXBlXG4gIH0sXG4gIHsgdG1wU2VhdDogTS5yZW1vdGFibGUoKSB9XG4pO1xudmFyIEFkdmFuY2VyS2l0SSA9IGhhcmRlbih7XG4gIGFkdmFuY2VyOiBNLmludGVyZmFjZShcIkFkdmFuY2VySVwiLCB7XG4gICAgaGFuZGxlVHJhbnNhY3Rpb25FdmVudDogTS5jYWxsV2hlbihFdmlkZW5jZVdpdGhSaXNrU2hhcGUpLnJldHVybnMoKVxuICB9KSxcbiAgZGVwb3NpdEhhbmRsZXI6IE0uaW50ZXJmYWNlKFwiRGVwb3NpdEhhbmRsZXJJXCIsIHtcbiAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0udW5kZWZpbmVkKCksIEFkdmFuY2VyVm93Q3R4U2hhcGUpLnJldHVybnMoVm93U2hhcGUpLFxuICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIEFkdmFuY2VyVm93Q3R4U2hhcGUpLnJldHVybnMoKVxuICB9KSxcbiAgdHJhbnNmZXJIYW5kbGVyOiBNLmludGVyZmFjZShcIlRyYW5zZmVySGFuZGxlcklcIiwge1xuICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS51bmRlZmluZWQoKSwgQWR2YW5jZXJWb3dDdHhTaGFwZSkucmV0dXJucyhcbiAgICAgIE0udW5kZWZpbmVkKClcbiAgICApLFxuICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIEFkdmFuY2VyVm93Q3R4U2hhcGUpLnJldHVybnMoTS51bmRlZmluZWQoKSlcbiAgfSksXG4gIHdpdGhkcmF3SGFuZGxlcjogTS5pbnRlcmZhY2UoXCJXaXRoZHJhd0hhbmRsZXJJXCIsIHtcbiAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0udW5kZWZpbmVkKCksIHtcbiAgICAgIGFkdmFuY2VBbW91bnQ6IEFueU5hdEFtb3VudFNoYXBlLFxuICAgICAgdG1wUmV0dXJuU2VhdDogTS5yZW1vdGFibGUoKVxuICAgIH0pLnJldHVybnMoTS51bmRlZmluZWQoKSksXG4gICAgb25SZWplY3RlZDogTS5jYWxsKE0uZXJyb3IoKSwge1xuICAgICAgYWR2YW5jZUFtb3VudDogQW55TmF0QW1vdW50U2hhcGUsXG4gICAgICB0bXBSZXR1cm5TZWF0OiBNLnJlbW90YWJsZSgpXG4gICAgfSkucmV0dXJucyhNLnVuZGVmaW5lZCgpKVxuICB9KVxufSk7XG52YXIgc3RhdGVTaGFwZSA9IGhhcmRlbih7XG4gIG5vdGlmaWVyOiBNLnJlbW90YWJsZSgpLFxuICBib3Jyb3dlcjogTS5yZW1vdGFibGUoKSxcbiAgcG9vbEFjY291bnQ6IE0ucmVtb3RhYmxlKCksXG4gIC8qICAgICAgICAgICAgICAqL1xuICBpbnRlcm1lZGlhdGVSZWNpcGllbnQ6IE0ub3B0KENvc21vc0NoYWluQWRkcmVzc1NoYXBlKSxcbiAgc2V0dGxlbWVudEFkZHJlc3M6IE0ub3B0KENvc21vc0NoYWluQWRkcmVzc1NoYXBlKVxufSk7XG52YXIgcHJlcGFyZUFkdmFuY2VyS2l0ID0gKHpvbmUsIHtcbiAgY2hhaW5IdWIsXG4gIGZlZUNvbmZpZyxcbiAgZ2V0Tm9ibGVJQ0EsXG4gIGxvZyA9IG1ha2VUcmFjZXIoXCJBZHZhbmNlclwiLCB0cnVlKSxcbiAgc3RhdHVzTWFuYWdlcixcbiAgdXNkYyxcbiAgdm93VG9vbHM6IHsgYXNWb3csIHdhdGNoLCB3aGVuIH0sXG4gIHpjZixcbiAgem9lVG9vbHM6IHsgbG9jYWxUcmFuc2Zlciwgd2l0aGRyYXdUb1NlYXQgfVxufSkgPT4ge1xuICBhc3NlcnRBbGxEZWZpbmVkKHtcbiAgICBjaGFpbkh1YixcbiAgICBmZWVDb25maWcsXG4gICAgc3RhdHVzTWFuYWdlcixcbiAgICB3YXRjaCxcbiAgICB3aGVuXG4gIH0pO1xuICBjb25zdCBmZWVUb29scyA9IG1ha2VGZWVUb29scyhmZWVDb25maWcpO1xuICBjb25zdCB0b0Ftb3VudCA9ICh2YWx1ZSkgPT4gQW1vdW50TWF0aC5tYWtlKHVzZGMuYnJhbmQsIHZhbHVlKTtcbiAgY29uc3Qgc3VwcG9ydHNDY3RwID0gbWFrZVN1cHBvcnRzQ2N0cChjaGFpbkh1Yik7XG4gIHJldHVybiB6b25lLmV4b0NsYXNzS2l0KFxuICAgIFwiRmFzdCBVU0RDIEFkdmFuY2VyXCIsXG4gICAgQWR2YW5jZXJLaXRJLFxuICAgIChjb25maWcpID0+IGhhcmRlbih7XG4gICAgICAuLi5jb25maWcsXG4gICAgICAvL1xuICAgICAgaW50ZXJtZWRpYXRlUmVjaXBpZW50OiB2b2lkIDBcbiAgICB9KSxcbiAgICB7XG4gICAgICBhZHZhbmNlcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGhhbmRsZVRyYW5zYWN0aW9uRXZlbnQoeyBldmlkZW5jZSwgcmlzayB9KSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmIChzdGF0dXNNYW5hZ2VyLmhhc0JlZW5PYnNlcnZlZChldmlkZW5jZSkpIHtcbiAgICAgICAgICAgICAgbG9nKFwidHhIYXNoIGFscmVhZHkgc2VlbjpcIiwgZXZpZGVuY2UudHhIYXNoKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJpc2sucmlza3NJZGVudGlmaWVkPy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgbG9nKFwicmlza3MgaWRlbnRpZmllZCwgc2tpcHBpbmcgYWR2YW5jZVwiKTtcbiAgICAgICAgICAgICAgc3RhdHVzTWFuYWdlci5za2lwQWR2YW5jZShldmlkZW5jZSwgcmlzay5yaXNrc0lkZW50aWZpZWQpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IHNldHRsZW1lbnRBZGRyZXNzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29uc3QgeyByZWNpcGllbnRBZGRyZXNzIH0gPSBldmlkZW5jZS5hdXg7XG4gICAgICAgICAgICBjb25zdCBkZWNvZGVkID0gZGVjb2RlQWRkcmVzc0hvb2socmVjaXBpZW50QWRkcmVzcyk7XG4gICAgICAgICAgICBtdXN0TWF0Y2gyKGRlY29kZWQsIEFkZHJlc3NIb29rU2hhcGUpO1xuICAgICAgICAgICAgaWYgKGRlY29kZWQuYmFzZUFkZHJlc3MgIT09IHNldHRsZW1lbnRBZGRyZXNzLnZhbHVlKSB7XG4gICAgICAgICAgICAgIHRocm93IHRocm93UmVkYWN0ZWRg4pqg77iPIGJhc2VBZGRyZXNzIG9mIGFkZHJlc3MgaG9vayAke3F1b3RlKGRlY29kZWQuYmFzZUFkZHJlc3MpfSBkb2VzIG5vdCBtYXRjaCB0aGUgZXhwZWN0ZWQgYWRkcmVzcyAke3F1b3RlKHNldHRsZW1lbnRBZGRyZXNzLnZhbHVlKX1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgeyBFVUQgfSA9IGRlY29kZWQucXVlcnk7XG4gICAgICAgICAgICBsb2coYGRlY29kZWQgRVVEOiAke0VVRH1gKTtcbiAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uID0gY2hhaW5IdWIucmVzb2x2ZUFjY291bnRJZChFVUQpO1xuICAgICAgICAgICAgY29uc3QgYWNjb3VudElkID0gcGFyc2VBY2NvdW50SWQoZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgaWYgKCEoYWNjb3VudElkLm5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIiB8fCBzdXBwb3J0c0NjdHAoZGVzdGluYXRpb24pKSkge1xuICAgICAgICAgICAgICBjb25zdCBkZXN0Q2hhaW4gPSBjaGFpbk9mQWNjb3VudChkZXN0aW5hdGlvbik7XG4gICAgICAgICAgICAgIHN0YXR1c01hbmFnZXIuc2tpcEFkdmFuY2UoZXZpZGVuY2UsIFtcbiAgICAgICAgICAgICAgICBgVHJhbnNmZXIgdG8gJHtkZXN0Q2hhaW59IG5vdCBzdXBwb3J0ZWQuYFxuICAgICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGZ1bGxBbW91bnQgPSB0b0Ftb3VudChldmlkZW5jZS50eC5hbW91bnQpO1xuICAgICAgICAgICAgY29uc3QgeyBib3Jyb3dlciwgbm90aWZpZXIsIHBvb2xBY2NvdW50IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgICAgY29uc3QgbWludGVkRWFybHkgPSBub3RpZmllci5jaGVja01pbnRlZEVhcmx5KFxuICAgICAgICAgICAgICBldmlkZW5jZSxcbiAgICAgICAgICAgICAgZGVzdGluYXRpb25cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAobWludGVkRWFybHkpIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IGFkdmFuY2VBbW91bnQgPSBmZWVUb29scy5jYWxjdWxhdGVBZHZhbmNlKFxuICAgICAgICAgICAgICBmdWxsQW1vdW50LFxuICAgICAgICAgICAgICBkZXN0aW5hdGlvblxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGNvbnN0IHsgemNmU2VhdDogdG1wU2VhdCB9ID0gemNmLm1ha2VFbXB0eVNlYXRLaXQoKTtcbiAgICAgICAgICAgIGJvcnJvd2VyLmJvcnJvdyh0bXBTZWF0LCBhZHZhbmNlQW1vdW50KTtcbiAgICAgICAgICAgIHN0YXR1c01hbmFnZXIuYWR2YW5jZShldmlkZW5jZSk7XG4gICAgICAgICAgICBjb25zdCBkZXBvc2l0ViA9IGxvY2FsVHJhbnNmZXIoXG4gICAgICAgICAgICAgIHRtcFNlYXQsXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIHBvb2xBY2NvdW50LFxuICAgICAgICAgICAgICBoYXJkZW4oeyBVU0RDOiBhZHZhbmNlQW1vdW50IH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdm9pZCB3YXRjaChkZXBvc2l0ViwgdGhpcy5mYWNldHMuZGVwb3NpdEhhbmRsZXIsIHtcbiAgICAgICAgICAgICAgYWR2YW5jZUFtb3VudCxcbiAgICAgICAgICAgICAgZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgIGZvcndhcmRpbmdBZGRyZXNzOiBldmlkZW5jZS50eC5mb3J3YXJkaW5nQWRkcmVzcyxcbiAgICAgICAgICAgICAgZnVsbEFtb3VudCxcbiAgICAgICAgICAgICAgdG1wU2VhdCxcbiAgICAgICAgICAgICAgdHhIYXNoOiBldmlkZW5jZS50eEhhc2hcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBsb2coXCJBZHZhbmNlciBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgc3RhdHVzTWFuYWdlci5za2lwQWR2YW5jZShldmlkZW5jZSwgW2Vycm9yLm1lc3NhZ2VdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkZXBvc2l0SGFuZGxlcjoge1xuICAgICAgICAvKlxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25GdWxmaWxsZWQocmVzdWx0LCBjdHgpIHtcbiAgICAgICAgICByZXR1cm4gYXNWb3coYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBwb29sQWNjb3VudCwgc2V0dGxlbWVudEFkZHJlc3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBjb25zdCB7IHRtcFNlYXQsIC4uLnZvd0NvbnRleHQgfSA9IGN0eDtcbiAgICAgICAgICAgIGNvbnN0IHsgZGVzdGluYXRpb24sIGFkdmFuY2VBbW91bnQsIC4uLmRldGFpbCB9ID0gdm93Q29udGV4dDtcbiAgICAgICAgICAgIHRtcFNlYXQuZXhpdCgpO1xuICAgICAgICAgICAgY29uc3QgYW1vdW50ID0gaGFyZGVuKHtcbiAgICAgICAgICAgICAgZGVub206IHVzZGMuZGVub20sXG4gICAgICAgICAgICAgIHZhbHVlOiBhZHZhbmNlQW1vdW50LnZhbHVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IGFjY291bnRJZCA9IHBhcnNlQWNjb3VudElkQXJnKGRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIGF3YWl0IG51bGw7XG4gICAgICAgICAgICBjb25zdCBpbnRlcm1lZGlhcnlBY2NvdW50ID0gZ2V0Tm9ibGVJQ0EoKTtcbiAgICAgICAgICAgIGNvbnN0IGludGVybWVkaWFyeUFkZHJlc3MgPSBpbnRlcm1lZGlhcnlBY2NvdW50LmdldEFkZHJlc3MoKTtcbiAgICAgICAgICAgIGxldCB0cmFuc2Zlck9yU2VuZFY7XG4gICAgICAgICAgICBpZiAoYWNjb3VudElkLm5hbWVzcGFjZSA9PT0gXCJjb3Ntb3NcIiAmJiBhY2NvdW50SWQucmVmZXJlbmNlID09PSBzZXR0bGVtZW50QWRkcmVzcy5jaGFpbklkKSB7XG4gICAgICAgICAgICAgIHRyYW5zZmVyT3JTZW5kViA9IEUocG9vbEFjY291bnQpLnNlbmQoZGVzdGluYXRpb24sIGFtb3VudCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFjY291bnRJZC5uYW1lc3BhY2UgPT09IFwiY29zbW9zXCIpIHtcbiAgICAgICAgICAgICAgdHJhbnNmZXJPclNlbmRWID0gRShwb29sQWNjb3VudCkudHJhbnNmZXIoZGVzdGluYXRpb24sIGFtb3VudCwge1xuICAgICAgICAgICAgICAgIGZvcndhcmRPcHRzOiB7XG4gICAgICAgICAgICAgICAgICBpbnRlcm1lZGlhdGVSZWNpcGllbnQ6IGludGVybWVkaWFyeUFkZHJlc3NcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzdXBwb3J0c0NjdHAoZGVzdGluYXRpb24pKSB7XG4gICAgICAgICAgICAgIGF3YWl0IEUocG9vbEFjY291bnQpLnRyYW5zZmVyKGludGVybWVkaWFyeUFkZHJlc3MsIGFtb3VudCk7XG4gICAgICAgICAgICAgIHRyYW5zZmVyT3JTZW5kViA9IGludGVybWVkaWFyeUFjY291bnQuZGVwb3NpdEZvckJ1cm4oXG4gICAgICAgICAgICAgICAgZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgICAgYW1vdW50XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aHJvd1JlZGFjdGVkYPCfmqggY2FuIG9ubHkgdHJhbnNmZXIgdG8gQWdvcmljIGFkZHJlc3NlcywgdmlhIElCQywgb3IgdmlhIENDVFBgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHdhdGNoKFxuICAgICAgICAgICAgICB0cmFuc2Zlck9yU2VuZFYsXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnRyYW5zZmVySGFuZGxlcixcbiAgICAgICAgICAgICAgdm93Q29udGV4dFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgb25SZWplY3RlZChlcnJvciwge1xuICAgICAgICAgIHRtcFNlYXQsXG4gICAgICAgICAgYWR2YW5jZUFtb3VudCxcbiAgICAgICAgICAuLi5yZXN0Q3R4XG4gICAgICAgIH0pIHtcbiAgICAgICAgICBsb2coXG4gICAgICAgICAgICBcIlxcdTI2QTBcXHVGRTBGIGRlcG9zaXQgdG8gbG9jYWxPcmNoQWNjb3VudCBmYWlsZWQsIGF0dGVtcHRpbmcgdG8gcmV0dXJuIHBheW1lbnQgdG8gTFBcIixcbiAgICAgICAgICAgIGVycm9yXG4gICAgICAgICAgKTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgeyBib3Jyb3dlciwgbm90aWZpZXIgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgICBub3RpZmllci5ub3RpZnlBZHZhbmNpbmdSZXN1bHQocmVzdEN0eCwgZmFsc2UpO1xuICAgICAgICAgICAgYm9ycm93ZXIucmV0dXJuVG9Qb29sKHRtcFNlYXQsIGFkdmFuY2VBbW91bnQpO1xuICAgICAgICAgICAgdG1wU2VhdC5leGl0KCk7XG4gICAgICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgICAgIGxvZyhcIlxcdXsxRjZBOH0gZGVwb3NpdCB0byBsb2NhbE9yY2hBY2NvdW50IGZhaWx1cmUgcmVjb3ZlcnkgZmFpbGVkXCIsIGUyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0cmFuc2ZlckhhbmRsZXI6IHtcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG9uRnVsZmlsbGVkKHJlc3VsdCwgY3R4KSB7XG4gICAgICAgICAgY29uc3QgeyBub3RpZmllciB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IGFkdmFuY2VBbW91bnQsIGRlc3RpbmF0aW9uLCAuLi5kZXRhaWwgfSA9IGN0eDtcbiAgICAgICAgICBsb2coXCJBZHZhbmNlIHN1Y2NlZWRlZFwiLCB7IGFkdmFuY2VBbW91bnQsIGRlc3RpbmF0aW9uIH0pO1xuICAgICAgICAgIG5vdGlmaWVyLm5vdGlmeUFkdmFuY2luZ1Jlc3VsdCh7IGRlc3RpbmF0aW9uLCAuLi5kZXRhaWwgfSwgdHJ1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQoZXJyb3IsIGN0eCkge1xuICAgICAgICAgIGNvbnN0IHsgbm90aWZpZXIsIHBvb2xBY2NvdW50IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGxvZyhcIkFkdmFuY2UgZmFpbGVkXCIsIGVycm9yKTtcbiAgICAgICAgICBjb25zdCB7IGFkdmFuY2VBbW91bnQsIC4uLnJlc3RDdHggfSA9IGN0eDtcbiAgICAgICAgICBub3RpZmllci5ub3RpZnlBZHZhbmNpbmdSZXN1bHQocmVzdEN0eCwgZmFsc2UpO1xuICAgICAgICAgIGNvbnN0IHsgemNmU2VhdDogdG1wUmV0dXJuU2VhdCB9ID0gemNmLm1ha2VFbXB0eVNlYXRLaXQoKTtcbiAgICAgICAgICBjb25zdCB3aXRoZHJhd1YgPSB3aXRoZHJhd1RvU2VhdChcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICBwb29sQWNjb3VudCxcbiAgICAgICAgICAgIHRtcFJldHVyblNlYXQsXG4gICAgICAgICAgICBoYXJkZW4oeyBVU0RDOiBhZHZhbmNlQW1vdW50IH0pXG4gICAgICAgICAgKTtcbiAgICAgICAgICB2b2lkIHdhdGNoKHdpdGhkcmF3ViwgdGhpcy5mYWNldHMud2l0aGRyYXdIYW5kbGVyLCB7XG4gICAgICAgICAgICBhZHZhbmNlQW1vdW50LFxuICAgICAgICAgICAgdG1wUmV0dXJuU2VhdFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2l0aGRyYXdIYW5kbGVyOiB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvbkZ1bGZpbGxlZChyZXN1bHQsIHtcbiAgICAgICAgICBhZHZhbmNlQW1vdW50LFxuICAgICAgICAgIHRtcFJldHVyblNlYXRcbiAgICAgICAgfSkge1xuICAgICAgICAgIGNvbnN0IHsgYm9ycm93ZXIgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGJvcnJvd2VyLnJldHVyblRvUG9vbCh0bXBSZXR1cm5TZWF0LCBhZHZhbmNlQW1vdW50KTtcbiAgICAgICAgICB9IGNhdGNoIChlMikge1xuICAgICAgICAgICAgbG9nKFxuICAgICAgICAgICAgICBgXFx1ezFGNkE4fSByZXR1cm4gJHtxdW90ZShhZHZhbmNlQW1vdW50KX0gdG8gcG9vbCBmYWlsZWQuIGZ1bmRzIHJlbWFpbiBvbiBcInRtcFJldHVyblNlYXRcImAsXG4gICAgICAgICAgICAgIGUyXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG4gICAgICAgICAqL1xuICAgICAgICBvblJlamVjdGVkKGVycm9yLCB7XG4gICAgICAgICAgYWR2YW5jZUFtb3VudCxcbiAgICAgICAgICB0bXBSZXR1cm5TZWF0XG4gICAgICAgIH0pIHtcbiAgICAgICAgICBsb2coXG4gICAgICAgICAgICBgXFx1ezFGNkE4fSB3aXRoZHJhdyAke3F1b3RlKGFkdmFuY2VBbW91bnQpfSBmcm9tIFwicG9vbEFjY291bnRcIiB0byByZXR1cm4gdG8gcG9vbCBmYWlsZWRgLFxuICAgICAgICAgICAgZXJyb3JcbiAgICAgICAgICApO1xuICAgICAgICAgIHRtcFJldHVyblNlYXQuZXhpdCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBzdGF0ZVNoYXBlXG4gICAgfVxuICApO1xufTtcbmhhcmRlbihwcmVwYXJlQWR2YW5jZXJLaXQpO1xudmFyIHByZXBhcmVBZHZhbmNlciA9ICh6b25lLCBjYXBzKSA9PiB7XG4gIGNvbnN0IG1ha2VBZHZhbmNlcktpdCA9IHByZXBhcmVBZHZhbmNlcktpdCh6b25lLCBjYXBzKTtcbiAgcmV0dXJuIHBpY2tGYWNldChtYWtlQWR2YW5jZXJLaXQsIFwiYWR2YW5jZXJcIik7XG59O1xuaGFyZGVuKHByZXBhcmVBZHZhbmNlcik7XG5cbi8vXG52YXIgeyBrZXlzOiBrZXlzMyB9ID0gT2JqZWN0O1xudmFyIHsgYWRkOiBhZGQ0LCBpc0VtcHR5LCBpc0VxdWFsLCBpc0dURTogaXNHVEUzLCBtYWtlLCBtYWtlRW1wdHk6IG1ha2VFbXB0eTIsIHN1YnRyYWN0OiBzdWJ0cmFjdDQgfSA9IEFtb3VudE1hdGg7XG52YXIgbWFrZVBhcml0eSA9IChudW1lcmF0b3JCcmFuZCwgZGVub21pbmF0b3JCcmFuZCkgPT4ge1xuICBjb25zdCBkdXN0ID0gMW47XG4gIHJldHVybiBtYWtlUmF0aW8oZHVzdCwgbnVtZXJhdG9yQnJhbmQsIGR1c3QsIGRlbm9taW5hdG9yQnJhbmQpO1xufTtcbnZhciBkZXBvc2l0Q2FsYyA9IChzaGFyZVdvcnRoLCB7IGdpdmUsIHdhbnQgfSkgPT4ge1xuICBhc3NlcnQoIWlzRW1wdHkoZ2l2ZS5VU0RDKSk7XG4gIGNvbnN0IHsgZGVub21pbmF0b3I6IHNoYXJlc091dHN0YW5kaW5nLCBudW1lcmF0b3I6IHBvb2xCYWxhbmNlIH0gPSBzaGFyZVdvcnRoO1xuICBjb25zdCBmYWlyUG9vbFNoYXJlID0gZGl2aWRlQnkoZ2l2ZS5VU0RDLCBzaGFyZVdvcnRoKTtcbiAgaWYgKHdhbnQ/LlBvb2xTaGFyZSkge1xuICAgIGlzR1RFMyhmYWlyUG9vbFNoYXJlLCB3YW50LlBvb2xTaGFyZSkgfHwgdGhyb3dSZWRhY3RlZGBkZXBvc2l0IGNhbm5vdCBwYXkgb3V0ICR7cXVvdGUod2FudC5Qb29sU2hhcmUpfTsgJHtxdW90ZShnaXZlLlVTREMpfSBvbmx5IGdldHMgJHtxdW90ZShmYWlyUG9vbFNoYXJlKX1gO1xuICB9XG4gIGNvbnN0IG91dHN0YW5kaW5nUG9zdCA9IGFkZDQoc2hhcmVzT3V0c3RhbmRpbmcsIGZhaXJQb29sU2hhcmUpO1xuICBjb25zdCBiYWxhbmNlUG9zdCA9IGFkZDQocG9vbEJhbGFuY2UsIGdpdmUuVVNEQyk7XG4gIGNvbnN0IHdvcnRoUG9zdCA9IG1ha2VSYXRpb0Zyb21BbW91bnRzKGJhbGFuY2VQb3N0LCBvdXRzdGFuZGluZ1Bvc3QpO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBwYXlvdXRzOiB7IFBvb2xTaGFyZTogZmFpclBvb2xTaGFyZSB9LFxuICAgIHNoYXJlV29ydGg6IHdvcnRoUG9zdFxuICB9KTtcbn07XG52YXIgY2hlY2tQb29sQmFsYW5jZSA9IChwb29sQWxsb2MsIHNoYXJlV29ydGgsIGVuY3VtYmVyZWRCYWxhbmNlKSA9PiB7XG4gIGNvbnN0IHsgYnJhbmQ6IHVzZGNCcmFuZCB9ID0gZW5jdW1iZXJlZEJhbGFuY2U7XG4gIGNvbnN0IHVuZW5jdW1iZXJlZEJhbGFuY2UgPSBwb29sQWxsb2MuVVNEQyB8fCBtYWtlRW1wdHkyKHVzZGNCcmFuZCk7XG4gIGNvbnN0IGt3ZHMgPSBrZXlzMyhwb29sQWxsb2MpO1xuICBrd2RzLmxlbmd0aCA9PT0gMCB8fCBrd2RzLmxlbmd0aCA9PT0gMSAmJiBrd2RzWzBdID09PSBcIlVTRENcIiB8fCB0aHJvd1JlZGFjdGVkYHVuZXhwZWN0ZWQgcG9vbCBhbGxvY2F0aW9uczogJHtwb29sQWxsb2N9YDtcbiAgY29uc3QgZHVzdCA9IG1ha2UodXNkY0JyYW5kLCAxbik7XG4gIGNvbnN0IGdyb3NzQmFsYW5jZSA9IGFkZDQoYWRkNCh1bmVuY3VtYmVyZWRCYWxhbmNlLCBkdXN0KSwgZW5jdW1iZXJlZEJhbGFuY2UpO1xuICBpc0VxdWFsKGdyb3NzQmFsYW5jZSwgc2hhcmVXb3J0aC5udW1lcmF0b3IpIHx8IHRocm93UmVkYWN0ZWRg8J+aqCBwb29sIGJhbGFuY2UgJHtxdW90ZSh1bmVuY3VtYmVyZWRCYWxhbmNlKX0gYW5kIGVuY3VtYmVyZWQgYmFsYW5jZSAke3F1b3RlKGVuY3VtYmVyZWRCYWxhbmNlKX0gaW5jb25zaXN0ZW50IHdpdGggc2hhcmVXb3J0aCAke3F1b3RlKHNoYXJlV29ydGgpfWA7XG4gIHJldHVybiBoYXJkZW4oeyB1bmVuY3VtYmVyZWRCYWxhbmNlLCBncm9zc0JhbGFuY2UgfSk7XG59O1xudmFyIHdpdGhkcmF3Q2FsYyA9IChzaGFyZVdvcnRoLCB7IGdpdmUsIHdhbnQgfSwgcG9vbEFsbG9jLCBlbmN1bWJlcmVkQmFsYW5jZSA9IG1ha2VFbXB0eTIoc2hhcmVXb3J0aC5udW1lcmF0b3IuYnJhbmQpKSA9PiB7XG4gIGNvbnN0IHsgdW5lbmN1bWJlcmVkQmFsYW5jZSB9ID0gY2hlY2tQb29sQmFsYW5jZShcbiAgICBwb29sQWxsb2MsXG4gICAgc2hhcmVXb3J0aCxcbiAgICBlbmN1bWJlcmVkQmFsYW5jZVxuICApO1xuICBhc3NlcnQoIWlzRW1wdHkoZ2l2ZS5Qb29sU2hhcmUpKTtcbiAgYXNzZXJ0KCFpc0VtcHR5KHdhbnQuVVNEQykpO1xuICBjb25zdCBwYXlvdXQgPSBtdWx0aXBseUJ5KGdpdmUuUG9vbFNoYXJlLCBzaGFyZVdvcnRoKTtcbiAgaXNHVEUzKHBheW91dCwgd2FudC5VU0RDKSB8fCB0aHJvd1JlZGFjdGVkYGNhbm5vdCB3aXRoZHJhdyAke3F1b3RlKHdhbnQuVVNEQyl9OyAke3F1b3RlKGdpdmUuUG9vbFNoYXJlKX0gb25seSB3b3J0aCAke3F1b3RlKHBheW91dCl9YDtcbiAgY29uc3QgeyBkZW5vbWluYXRvcjogc2hhcmVzT3V0c3RhbmRpbmcsIG51bWVyYXRvcjogcG9vbEJhbGFuY2UgfSA9IHNoYXJlV29ydGg7XG4gICFpc0dURTMod2FudC5VU0RDLCBwb29sQmFsYW5jZSkgfHwgdGhyb3dSZWRhY3RlZGBjYW5ub3Qgd2l0aGRyYXcgJHtxdW90ZSh3YW50LlVTREMpfTsgb25seSAke3F1b3RlKHBvb2xCYWxhbmNlKX0gaW4gcG9vbGA7XG4gIGlzR1RFMyh1bmVuY3VtYmVyZWRCYWxhbmNlLCB3YW50LlVTREMpIHx8IHRocm93UmVkYWN0ZWRgY2Fubm90IHdpdGhkcmF3ICR7cXVvdGUod2FudC5VU0RDKX07ICR7cXVvdGUoZW5jdW1iZXJlZEJhbGFuY2UpfSBpcyBpbiB1c2U7IHN0YW5kIGJ5IGZvciBwb29sIHRvIHJldHVybiB0byAke3F1b3RlKHBvb2xCYWxhbmNlKX1gO1xuICBjb25zdCBiYWxhbmNlUG9zdCA9IHN1YnRyYWN0NChwb29sQmFsYW5jZSwgcGF5b3V0KTtcbiAgY29uc3Qgb3V0c3RhbmRpbmdQb3N0ID0gc3VidHJhY3Q0KHNoYXJlc091dHN0YW5kaW5nLCBnaXZlLlBvb2xTaGFyZSk7XG4gIGNvbnN0IHdvcnRoUG9zdCA9IG1ha2VSYXRpb0Zyb21BbW91bnRzKGJhbGFuY2VQb3N0LCBvdXRzdGFuZGluZ1Bvc3QpO1xuICByZXR1cm4gaGFyZGVuKHsgc2hhcmVXb3J0aDogd29ydGhQb3N0LCBwYXlvdXRzOiB7IFVTREM6IHBheW91dCB9IH0pO1xufTtcbnZhciB3aXRoRmVlcyA9IChzaGFyZVdvcnRoLCBmZWVzKSA9PiB7XG4gIGNvbnN0IGJhbGFuY2VQb3N0ID0gYWRkNChzaGFyZVdvcnRoLm51bWVyYXRvciwgZmVlcyk7XG4gIHJldHVybiBtYWtlUmF0aW9Gcm9tQW1vdW50cyhiYWxhbmNlUG9zdCwgc2hhcmVXb3J0aC5kZW5vbWluYXRvcik7XG59O1xudmFyIGJvcnJvd0NhbGMgPSAocmVxdWVzdGVkLCBwb29sU2VhdEFsbG9jYXRpb24sIGVuY3VtYmVyZWRCYWxhbmNlLCBwb29sU3RhdHMpID0+IHtcbiAgIWlzR1RFMyhyZXF1ZXN0ZWQsIHBvb2xTZWF0QWxsb2NhdGlvbikgfHwgdGhyb3dSZWRhY3RlZGBDYW5ub3QgYm9ycm93LiBSZXF1ZXN0ZWQgJHtxdW90ZShyZXF1ZXN0ZWQpfSBtdXN0IGJlIGxlc3MgdGhhbiBwb29sIGJhbGFuY2UgJHtxdW90ZShwb29sU2VhdEFsbG9jYXRpb24pfS5gO1xuICByZXR1cm4gaGFyZGVuKHtcbiAgICBlbmN1bWJlcmVkQmFsYW5jZTogYWRkNChlbmN1bWJlcmVkQmFsYW5jZSwgcmVxdWVzdGVkKSxcbiAgICBwb29sU3RhdHM6IHtcbiAgICAgIC4uLnBvb2xTdGF0cyxcbiAgICAgIHRvdGFsQm9ycm93czogYWRkNChwb29sU3RhdHMudG90YWxCb3Jyb3dzLCByZXF1ZXN0ZWQpXG4gICAgfVxuICB9KTtcbn07XG52YXIgcmVwYXlDYWxjID0gKHNoYXJlV29ydGgsIHNwbGl0LCBlbmN1bWJlcmVkQmFsYW5jZSwgcG9vbFN0YXRzKSA9PiB7XG4gIGlzR1RFMyhlbmN1bWJlcmVkQmFsYW5jZSwgc3BsaXQuUHJpbmNpcGFsKSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCByZXBheS4gUHJpbmNpcGFsICR7cXVvdGUoc3BsaXQuUHJpbmNpcGFsKX0gZXhjZWVkcyBlbmN1bWJlcmVkQmFsYW5jZSAke3F1b3RlKGVuY3VtYmVyZWRCYWxhbmNlKX0uYDtcbiAgcmV0dXJuIGhhcmRlbih7XG4gICAgc2hhcmVXb3J0aDogd2l0aEZlZXMoc2hhcmVXb3J0aCwgc3BsaXQuUG9vbEZlZSksXG4gICAgZW5jdW1iZXJlZEJhbGFuY2U6IHN1YnRyYWN0NChlbmN1bWJlcmVkQmFsYW5jZSwgc3BsaXQuUHJpbmNpcGFsKSxcbiAgICBwb29sU3RhdHM6IHtcbiAgICAgIC4uLnBvb2xTdGF0cyxcbiAgICAgIHRvdGFsUmVwYXlzOiBhZGQ0KHBvb2xTdGF0cy50b3RhbFJlcGF5cywgc3BsaXQuUHJpbmNpcGFsKSxcbiAgICAgIHRvdGFsUG9vbEZlZXM6IGFkZDQocG9vbFN0YXRzLnRvdGFsUG9vbEZlZXMsIHNwbGl0LlBvb2xGZWUpLFxuICAgICAgdG90YWxDb250cmFjdEZlZXM6IGFkZDQoXG4gICAgICAgIGFkZDQocG9vbFN0YXRzLnRvdGFsQ29udHJhY3RGZWVzLCBzcGxpdC5Db250cmFjdEZlZSksXG4gICAgICAgIHNwbGl0LlJlbGF5RmVlXG4gICAgICApXG4gICAgfVxuICB9KTtcbn07XG5cbi8vXG52YXIgeyBhZGQ6IGFkZDUsIGlzR1RFOiBpc0dURTQsIG1ha2VFbXB0eTogbWFrZUVtcHR5MyB9ID0gQW1vdW50TWF0aDtcbnZhciBzdGF0ZVNoYXBlMiA9IGhhcmRlbih7XG4gIGVuY3VtYmVyZWRCYWxhbmNlOiBBbW91bnRTaGFwZSxcbiAgZmVlU2VhdDogTS5yZW1vdGFibGUoKSxcbiAgcG9vbFN0YXRzOiBNLnJlY29yZCgpLFxuICBwb29sTWV0cmljc1JlY29yZGVyS2l0OiBSZWNvcmRlcktpdFNoYXBlLFxuICBwb29sU2VhdDogTS5yZW1vdGFibGUoKSxcbiAgUG9vbFNoYXJlczogTS5yZW1vdGFibGUoKSxcbiAgcHJvcG9zYWxTaGFwZXM6IHtcbiAgICBkZXBvc2l0OiBNLnBhdHRlcm4oKSxcbiAgICB3aXRoZHJhdzogTS5wYXR0ZXJuKCksXG4gICAgd2l0aGRyYXdGZWVzOiBNLnBhdHRlcm4oKVxuICB9LFxuICBzaGFyZU1pbnQ6IE0ucmVtb3RhYmxlKCksXG4gIHNoYXJlV29ydGg6IFJhdGlvU2hhcGVcbn0pO1xudmFyIHByZXBhcmVMaXF1aWRpdHlQb29sS2l0ID0gKHpvbmUsIHpjZiwgVVNEQywgdG9vbHMpID0+IHtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJMaXF1aWRpdHkgUG9vbFwiLFxuICAgIHtcbiAgICAgIGJvcnJvd2VyOiBNLmludGVyZmFjZShcImJvcnJvd2VyXCIsIHtcbiAgICAgICAgYm9ycm93OiBNLmNhbGwoU2VhdFNoYXBlLCBtYWtlTmF0QW1vdW50U2hhcGUoVVNEQywgMW4pKS5yZXR1cm5zKCksXG4gICAgICAgIHJldHVyblRvUG9vbDogTS5jYWxsKFNlYXRTaGFwZSwgbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDFuKSkucmV0dXJucygpXG4gICAgICB9KSxcbiAgICAgIHJlcGF5ZXI6IE0uaW50ZXJmYWNlKFwicmVwYXllclwiLCB7XG4gICAgICAgIHJlcGF5OiBNLmNhbGwoXG4gICAgICAgICAgVHJhbnNmZXJQYXJ0U2hhcGUsXG4gICAgICAgICAgaGFyZGVuKHtcbiAgICAgICAgICAgIFByaW5jaXBhbDogbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDFuKSxcbiAgICAgICAgICAgIFBvb2xGZWU6IG1ha2VOYXRBbW91bnRTaGFwZShVU0RDLCAwbiksXG4gICAgICAgICAgICBDb250cmFjdEZlZTogbWFrZU5hdEFtb3VudFNoYXBlKFVTREMsIDBuKSxcbiAgICAgICAgICAgIFJlbGF5RmVlOiBtYWtlTmF0QW1vdW50U2hhcGUoVVNEQywgMG4pXG4gICAgICAgICAgfSlcbiAgICAgICAgKS5yZXR1cm5zKClcbiAgICAgIH0pLFxuICAgICAgZXh0ZXJuYWw6IE0uaW50ZXJmYWNlKFwiZXh0ZXJuYWxcIiwge1xuICAgICAgICBwdWJsaXNoUG9vbE1ldHJpY3M6IE0uY2FsbCgpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICBkZXBvc2l0SGFuZGxlcjogTS5pbnRlcmZhY2UoXCJkZXBvc2l0SGFuZGxlclwiLCB7XG4gICAgICAgIGhhbmRsZTogTS5jYWxsKFNlYXRTaGFwZSwgTS5hbnkoKSkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICAgIH0pLFxuICAgICAgd2l0aGRyYXdIYW5kbGVyOiBNLmludGVyZmFjZShcIndpdGhkcmF3SGFuZGxlclwiLCB7XG4gICAgICAgIGhhbmRsZTogTS5jYWxsKFNlYXRTaGFwZSwgTS5hbnkoKSkucmV0dXJucyhNLnByb21pc2UoKSlcbiAgICAgIH0pLFxuICAgICAgd2l0aGRyYXdGZWVzSGFuZGxlcjogTS5pbnRlcmZhY2UoXCJ3aXRoZHJhd0ZlZXNIYW5kbGVyXCIsIHtcbiAgICAgICAgaGFuZGxlOiBNLmNhbGwoU2VhdFNoYXBlLCBNLmFueSgpKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgICAgfSksXG4gICAgICBwdWJsaWM6IE0uaW50ZXJmYWNlKFwicHVibGljXCIsIHtcbiAgICAgICAgbWFrZURlcG9zaXRJbnZpdGF0aW9uOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKSxcbiAgICAgICAgbWFrZVdpdGhkcmF3SW52aXRhdGlvbjogTS5jYWxsKCkucmV0dXJucyhNLnByb21pc2UoKSksXG4gICAgICAgIGdldFB1YmxpY1RvcGljczogTS5jYWxsKCkucmV0dXJucyhUb3BpY3NSZWNvcmRTaGFwZSlcbiAgICAgIH0pLFxuICAgICAgZmVlUmVjaXBpZW50OiBNLmludGVyZmFjZShcImZlZVJlY2lwaWVudFwiLCB7XG4gICAgICAgIGdldENvbnRyYWN0RmVlQmFsYW5jZTogTS5jYWxsKCkucmV0dXJucyhBbW91bnRTaGFwZSksXG4gICAgICAgIG1ha2VXaXRoZHJhd0ZlZXNJbnZpdGF0aW9uOiBNLmNhbGwoKS5yZXR1cm5zKE0ucHJvbWlzZSgpKVxuICAgICAgfSlcbiAgICB9LFxuICAgIChzaGFyZU1pbnQsIG5vZGUpID0+IHtcbiAgICAgIGNvbnN0IHsgYnJhbmQ6IFBvb2xTaGFyZXMgfSA9IHNoYXJlTWludC5nZXRJc3N1ZXJSZWNvcmQoKTtcbiAgICAgIGNvbnN0IHByb3Bvc2FsU2hhcGVzID0gbWFrZVByb3Bvc2FsU2hhcGVzKHsgVVNEQywgUG9vbFNoYXJlcyB9KTtcbiAgICAgIGNvbnN0IHNoYXJlV29ydGggPSBtYWtlUGFyaXR5KFVTREMsIFBvb2xTaGFyZXMpO1xuICAgICAgY29uc3QgeyB6Y2ZTZWF0OiBwb29sU2VhdCB9ID0gemNmLm1ha2VFbXB0eVNlYXRLaXQoKTtcbiAgICAgIGNvbnN0IHsgemNmU2VhdDogZmVlU2VhdCB9ID0gemNmLm1ha2VFbXB0eVNlYXRLaXQoKTtcbiAgICAgIGNvbnN0IHBvb2xNZXRyaWNzUmVjb3JkZXJLaXQgPSB0b29scy5tYWtlUmVjb3JkZXJLaXQoXG4gICAgICAgIG5vZGUsXG4gICAgICAgIFBvb2xNZXRyaWNzU2hhcGVcbiAgICAgICk7XG4gICAgICBjb25zdCBlbmN1bWJlcmVkQmFsYW5jZSA9IG1ha2VFbXB0eTMoVVNEQyk7XG4gICAgICBjb25zdCBwb29sU3RhdHMgPSBoYXJkZW4oe1xuICAgICAgICB0b3RhbEJvcnJvd3M6IG1ha2VFbXB0eTMoVVNEQyksXG4gICAgICAgIHRvdGFsQ29udHJhY3RGZWVzOiBtYWtlRW1wdHkzKFVTREMpLFxuICAgICAgICB0b3RhbFBvb2xGZWVzOiBtYWtlRW1wdHkzKFVTREMpLFxuICAgICAgICB0b3RhbFJlcGF5czogbWFrZUVtcHR5MyhVU0RDKVxuICAgICAgfSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xuICAgICAgICBlbmN1bWJlcmVkQmFsYW5jZSxcbiAgICAgICAgZmVlU2VhdCxcbiAgICAgICAgcG9vbFN0YXRzLFxuICAgICAgICBwb29sTWV0cmljc1JlY29yZGVyS2l0LFxuICAgICAgICBwb29sU2VhdCxcbiAgICAgICAgUG9vbFNoYXJlcyxcbiAgICAgICAgcHJvcG9zYWxTaGFwZXMsXG4gICAgICAgIHNoYXJlTWludCxcbiAgICAgICAgc2hhcmVXb3J0aFxuICAgICAgfTtcbiAgICB9LFxuICAgIHtcbiAgICAgIGJvcnJvd2VyOiB7XG4gICAgICAgIGJvcnJvdyh0b1NlYXQsIGFtb3VudCkge1xuICAgICAgICAgIGNvbnN0IHsgZW5jdW1iZXJlZEJhbGFuY2UsIHBvb2xTZWF0LCBwb29sU3RhdHMgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgcG9zdCA9IGJvcnJvd0NhbGMoXG4gICAgICAgICAgICBhbW91bnQsXG4gICAgICAgICAgICBwb29sU2VhdC5nZXRBbW91bnRBbGxvY2F0ZWQoXCJVU0RDXCIsIFVTREMpLFxuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2UsXG4gICAgICAgICAgICBwb29sU3RhdHNcbiAgICAgICAgICApO1xuICAgICAgICAgIHpjZi5hdG9taWNSZWFycmFuZ2UoaGFyZGVuKFtbcG9vbFNlYXQsIHRvU2VhdCwgeyBVU0RDOiBhbW91bnQgfV1dKSk7XG4gICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLnN0YXRlLCBwb3N0KTtcbiAgICAgICAgICB0aGlzLmZhY2V0cy5leHRlcm5hbC5wdWJsaXNoUG9vbE1ldHJpY3MoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgcmV0dXJuVG9Qb29sKGJvcnJvd1NlYXQsIGFtb3VudCkge1xuICAgICAgICAgIGNvbnN0IHJldHVybkFtb3VudHMgPSBoYXJkZW4oe1xuICAgICAgICAgICAgUHJpbmNpcGFsOiBhbW91bnQsXG4gICAgICAgICAgICBQb29sRmVlOiBtYWtlRW1wdHkzKFVTREMpLFxuICAgICAgICAgICAgQ29udHJhY3RGZWU6IG1ha2VFbXB0eTMoVVNEQyksXG4gICAgICAgICAgICBSZWxheUZlZTogbWFrZUVtcHR5MyhVU0RDKVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnN0IGJvcnJvd1NlYXRBbGxvY2F0aW9uID0gYm9ycm93U2VhdC5nZXRDdXJyZW50QWxsb2NhdGlvbigpO1xuICAgICAgICAgIGlzR1RFNChib3Jyb3dTZWF0QWxsb2NhdGlvbi5VU0RDLCBhbW91bnQpIHx8IHRocm93UmVkYWN0ZWRg4pqg77iPIGJvcnJvd1NlYXRBbGxvY2F0aW9uICR7cXVvdGUoYm9ycm93U2VhdEFsbG9jYXRpb24pfSBsZXNzIHRoYW4gYW1vdW50S1dSICR7cXVvdGUoYW1vdW50KX1gO1xuICAgICAgICAgIGNvbnN0IHRyYW5zZmVyU291cmNlUGFydCA9IGZyb21Pbmx5KGJvcnJvd1NlYXQsIHsgVVNEQzogYW1vdW50IH0pO1xuICAgICAgICAgIHRoaXMuZmFjZXRzLnJlcGF5ZXIucmVwYXkodHJhbnNmZXJTb3VyY2VQYXJ0LCByZXR1cm5BbW91bnRzKTtcbiAgICAgICAgICBib3Jyb3dTZWF0LmV4aXQoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlcGF5ZXI6IHtcbiAgICAgICAgcmVwYXkoc291cmNlVHJhbnNmZXIsIHNwbGl0KSB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2UsXG4gICAgICAgICAgICBmZWVTZWF0LFxuICAgICAgICAgICAgcG9vbFNlYXQsXG4gICAgICAgICAgICBwb29sU3RhdHMsXG4gICAgICAgICAgICBzaGFyZVdvcnRoXG4gICAgICAgICAgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY2hlY2tQb29sQmFsYW5jZShcbiAgICAgICAgICAgIHBvb2xTZWF0LmdldEN1cnJlbnRBbGxvY2F0aW9uKCksXG4gICAgICAgICAgICBzaGFyZVdvcnRoLFxuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2VcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHBvc3QgPSByZXBheUNhbGMoXG4gICAgICAgICAgICBzaGFyZVdvcnRoLFxuICAgICAgICAgICAgc3BsaXQsXG4gICAgICAgICAgICBlbmN1bWJlcmVkQmFsYW5jZSxcbiAgICAgICAgICAgIHBvb2xTdGF0c1xuICAgICAgICAgICk7XG4gICAgICAgICAgemNmLmF0b21pY1JlYXJyYW5nZShcbiAgICAgICAgICAgIGhhcmRlbihbXG4gICAgICAgICAgICAgIHNvdXJjZVRyYW5zZmVyLFxuICAgICAgICAgICAgICB0b09ubHkocG9vbFNlYXQsIHsgVVNEQzogYWRkNShzcGxpdC5Qb29sRmVlLCBzcGxpdC5QcmluY2lwYWwpIH0pLFxuICAgICAgICAgICAgICB0b09ubHkoZmVlU2VhdCwgeyBVU0RDOiBhZGQ1KHNwbGl0LkNvbnRyYWN0RmVlLCBzcGxpdC5SZWxheUZlZSkgfSlcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKTtcbiAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuc3RhdGUsIHBvc3QpO1xuICAgICAgICAgIHRoaXMuZmFjZXRzLmV4dGVybmFsLnB1Ymxpc2hQb29sTWV0cmljcygpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZXh0ZXJuYWw6IHtcbiAgICAgICAgcHVibGlzaFBvb2xNZXRyaWNzKCkge1xuICAgICAgICAgIGNvbnN0IHsgcG9vbFN0YXRzLCBzaGFyZVdvcnRoLCBlbmN1bWJlcmVkQmFsYW5jZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IHJlY29yZGVyIH0gPSB0aGlzLnN0YXRlLnBvb2xNZXRyaWNzUmVjb3JkZXJLaXQ7XG4gICAgICAgICAgdm9pZCByZWNvcmRlci53cml0ZSh7XG4gICAgICAgICAgICBlbmN1bWJlcmVkQmFsYW5jZSxcbiAgICAgICAgICAgIHNoYXJlV29ydGgsXG4gICAgICAgICAgICAuLi5wb29sU3RhdHNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlcG9zaXRIYW5kbGVyOiB7XG4gICAgICAgIGFzeW5jIGhhbmRsZShscCkge1xuICAgICAgICAgIGNvbnN0IHsgc2hhcmVXb3J0aCwgc2hhcmVNaW50LCBwb29sU2VhdCwgZW5jdW1iZXJlZEJhbGFuY2UgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyBleHRlcm5hbCB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgY29uc3QgcHJvcG9zYWwgPSAoXG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgbHAuZ2V0UHJvcG9zYWwoKVxuICAgICAgICAgICk7XG4gICAgICAgICAgY2hlY2tQb29sQmFsYW5jZShcbiAgICAgICAgICAgIHBvb2xTZWF0LmdldEN1cnJlbnRBbGxvY2F0aW9uKCksXG4gICAgICAgICAgICBzaGFyZVdvcnRoLFxuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2VcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHBvc3QgPSBkZXBvc2l0Q2FsYyhzaGFyZVdvcnRoLCBwcm9wb3NhbCk7XG4gICAgICAgICAgY29uc3Qgc2hhcmVQYXlvdXQgPSBzaGFyZU1pbnQubWludEdhaW5zKHBvc3QucGF5b3V0cyk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUuc2hhcmVXb3J0aCA9IHBvc3Quc2hhcmVXb3J0aDtcbiAgICAgICAgICAgIHpjZi5hdG9taWNSZWFycmFuZ2UoXG4gICAgICAgICAgICAgIGhhcmRlbihbXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICBbbHAsIHBvb2xTZWF0LCBwcm9wb3NhbC5naXZlXSxcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIFtzaGFyZVBheW91dCwgbHAsIHBvc3QucGF5b3V0c11cbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBjYXRjaCAoY2F1c2UpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlxcdXsxRjZBOH0gY2Fubm90IGNvbW1pdCBkZXBvc2l0XCIsIHsgY2F1c2UgfSk7XG4gICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIGxwLmV4aXQoKTtcbiAgICAgICAgICAgIHNoYXJlUGF5b3V0LmV4aXQoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZXh0ZXJuYWwucHVibGlzaFBvb2xNZXRyaWNzKCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3aXRoZHJhd0hhbmRsZXI6IHtcbiAgICAgICAgLyogICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgYXN5bmMgaGFuZGxlKGxwKSB7XG4gICAgICAgICAgY29uc3QgeyBzaGFyZVdvcnRoLCBzaGFyZU1pbnQsIHBvb2xTZWF0LCBlbmN1bWJlcmVkQmFsYW5jZSB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBjb25zdCB7IGV4dGVybmFsIH0gPSB0aGlzLmZhY2V0cztcbiAgICAgICAgICBjb25zdCBwcm9wb3NhbCA9IGxwLmdldFByb3Bvc2FsKCk7XG4gICAgICAgICAgY29uc3QgeyB6Y2ZTZWF0OiBidXJuIH0gPSB6Y2YubWFrZUVtcHR5U2VhdEtpdCgpO1xuICAgICAgICAgIGNvbnN0IHBvc3QgPSB3aXRoZHJhd0NhbGMoXG4gICAgICAgICAgICBzaGFyZVdvcnRoLFxuICAgICAgICAgICAgcHJvcG9zYWwsXG4gICAgICAgICAgICBwb29sU2VhdC5nZXRDdXJyZW50QWxsb2NhdGlvbigpLFxuICAgICAgICAgICAgZW5jdW1iZXJlZEJhbGFuY2VcbiAgICAgICAgICApO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnNoYXJlV29ydGggPSBwb3N0LnNoYXJlV29ydGg7XG4gICAgICAgICAgICB6Y2YuYXRvbWljUmVhcnJhbmdlKFxuICAgICAgICAgICAgICBoYXJkZW4oW1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgW2xwLCBidXJuLCBwcm9wb3NhbC5naXZlXSxcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIFtwb29sU2VhdCwgbHAsIHBvc3QucGF5b3V0c11cbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBzaGFyZU1pbnQuYnVybkxvc3Nlcyhwcm9wb3NhbC5naXZlLCBidXJuKTtcbiAgICAgICAgICB9IGNhdGNoIChjYXVzZSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiXFx1ezFGNkE4fSBjYW5ub3QgY29tbWl0IHdpdGhkcmF3XCIsIHsgY2F1c2UgfSk7XG4gICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIGxwLmV4aXQoKTtcbiAgICAgICAgICAgIGJ1cm4uZXhpdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBleHRlcm5hbC5wdWJsaXNoUG9vbE1ldHJpY3MoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHdpdGhkcmF3RmVlc0hhbmRsZXI6IHtcbiAgICAgICAgYXN5bmMgaGFuZGxlKHNlYXQpIHtcbiAgICAgICAgICBjb25zdCB7IGZlZVNlYXQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyB3YW50IH0gPSBzZWF0LmdldFByb3Bvc2FsKCk7XG4gICAgICAgICAgY29uc3QgYXZhaWxhYmxlID0gZmVlU2VhdC5nZXRBbW91bnRBbGxvY2F0ZWQoXCJVU0RDXCIsIHdhbnQuVVNEQy5icmFuZCk7XG4gICAgICAgICAgaXNHVEU0KGF2YWlsYWJsZSwgd2FudC5VU0RDKSB8fCB0aHJvd1JlZGFjdGVkYGNhbm5vdCB3aXRoZHJhdyAke3dhbnQuVVNEQ307IG9ubHkgJHthdmFpbGFibGV9IGF2YWlsYWJsZWA7XG4gICAgICAgICAgemNmLmF0b21pY1JlYXJyYW5nZShoYXJkZW4oW1tmZWVTZWF0LCBzZWF0LCB3YW50XV0pKTtcbiAgICAgICAgICBzZWF0LmV4aXQoKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHB1YmxpYzoge1xuICAgICAgICBtYWtlRGVwb3NpdEludml0YXRpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbihcbiAgICAgICAgICAgIHRoaXMuZmFjZXRzLmRlcG9zaXRIYW5kbGVyLFxuICAgICAgICAgICAgXCJEZXBvc2l0XCIsXG4gICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnByb3Bvc2FsU2hhcGVzLmRlcG9zaXRcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICBtYWtlV2l0aGRyYXdJbnZpdGF0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB6Y2YubWFrZUludml0YXRpb24oXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy53aXRoZHJhd0hhbmRsZXIsXG4gICAgICAgICAgICBcIldpdGhkcmF3XCIsXG4gICAgICAgICAgICB2b2lkIDAsXG4gICAgICAgICAgICB0aGlzLnN0YXRlLnByb3Bvc2FsU2hhcGVzLndpdGhkcmF3XG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0UHVibGljVG9waWNzKCkge1xuICAgICAgICAgIGNvbnN0IHsgcG9vbE1ldHJpY3NSZWNvcmRlcktpdCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcG9vbE1ldHJpY3M6IG1ha2VSZWNvcmRlclRvcGljKFxuICAgICAgICAgICAgICBcInBvb2xNZXRyaWNzXCIsXG4gICAgICAgICAgICAgIHBvb2xNZXRyaWNzUmVjb3JkZXJLaXRcbiAgICAgICAgICAgIClcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZmVlUmVjaXBpZW50OiB7XG4gICAgICAgIGdldENvbnRyYWN0RmVlQmFsYW5jZSgpIHtcbiAgICAgICAgICBjb25zdCB7IGZlZVNlYXQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgcmV0dXJuIGZlZVNlYXQuZ2V0Q3VycmVudEFsbG9jYXRpb24oKS5VU0RDO1xuICAgICAgICB9LFxuICAgICAgICBtYWtlV2l0aGRyYXdGZWVzSW52aXRhdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gemNmLm1ha2VJbnZpdGF0aW9uKFxuICAgICAgICAgICAgdGhpcy5mYWNldHMud2l0aGRyYXdGZWVzSGFuZGxlcixcbiAgICAgICAgICAgIFwiV2l0aGRyYXcgRmVlc1wiLFxuICAgICAgICAgICAgdm9pZCAwLFxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5wcm9wb3NhbFNoYXBlcy53aXRoZHJhd0ZlZXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBmaW5pc2g6ICh7IGZhY2V0czogeyBleHRlcm5hbCB9IH0pID0+IHtcbiAgICAgICAgdm9pZCBleHRlcm5hbC5wdWJsaXNoUG9vbE1ldHJpY3MoKTtcbiAgICAgIH0sXG4gICAgICBzdGF0ZVNoYXBlOiBzdGF0ZVNoYXBlMlxuICAgIH1cbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZUxpcXVpZGl0eVBvb2xLaXQpO1xuXG4vL1xudmFyIGFzTXVsdGlzZXQgPSAobWFwU3RvcmUpID0+IGhhcmRlbih7XG4gIC8qXG5cblxuXG5cbiAgICovXG4gIGFkZDogKGl0ZW0sIGNvdW50ID0gMSkgPT4ge1xuICAgIGNvdW50ID4gMCAmJiBOdW1iZXIuaXNJbnRlZ2VyKGNvdW50KSB8fCB0aHJvd1JlZGFjdGVkYENhbm5vdCBhZGQgYSBub24tcG9zaXRpdmUgaW50ZWdlciBjb3VudCAke2NvdW50fSB0byBiYWdgO1xuICAgIGlmIChtYXBTdG9yZS5oYXMoaXRlbSkpIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRDb3VudCA9IG1hcFN0b3JlLmdldChpdGVtKTtcbiAgICAgIG1hcFN0b3JlLnNldChpdGVtLCBjdXJyZW50Q291bnQgKyBjb3VudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hcFN0b3JlLmluaXQoaXRlbSwgY291bnQpO1xuICAgIH1cbiAgfSxcbiAgLypcblxuXG5cblxuXG5cblxuICAgKi9cbiAgcmVtb3ZlOiAoaXRlbSwgY291bnQgPSAxKSA9PiB7XG4gICAgY291bnQgPiAwICYmIE51bWJlci5pc0ludGVnZXIoY291bnQpIHx8IHRocm93UmVkYWN0ZWRgQ2Fubm90IHJlbW92ZSBhIG5vbi1wb3NpdGl2ZSBpbnRlZ2VyIGNvdW50ICR7Y291bnR9IGZyb20gYmFnYDtcbiAgICBpZiAoIW1hcFN0b3JlLmhhcyhpdGVtKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBjdXJyZW50Q291bnQgPSBtYXBTdG9yZS5nZXQoaXRlbSk7XG4gICAgaWYgKGN1cnJlbnRDb3VudCA8IGNvdW50KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChjdXJyZW50Q291bnQgPT09IGNvdW50KSB7XG4gICAgICBtYXBTdG9yZS5kZWxldGUoaXRlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hcFN0b3JlLnNldChpdGVtLCBjdXJyZW50Q291bnQgLSBjb3VudCk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9LFxuICAvKlxuXG5cblxuXG4gICAqL1xuICBjb3VudDogKGl0ZW0pID0+IHtcbiAgICByZXR1cm4gbWFwU3RvcmUuaGFzKGl0ZW0pID8gbWFwU3RvcmUuZ2V0KGl0ZW0pIDogMDtcbiAgfSxcbiAgLypcblxuXG5cblxuICAgKi9cbiAgaGFzOiAoaXRlbSkgPT4ge1xuICAgIHJldHVybiBtYXBTdG9yZS5oYXMoaXRlbSk7XG4gIH0sXG4gIC8qXG5cblxuXG4gICAqL1xuICBrZXlzOiAoKSA9PiB7XG4gICAgcmV0dXJuIG1hcFN0b3JlLmtleXMoKTtcbiAgfSxcbiAgLypcblxuXG5cbiAgICovXG4gIGVudHJpZXM6ICgpID0+IHtcbiAgICByZXR1cm4gbWFwU3RvcmUuZW50cmllcygpO1xuICB9LFxuICAvKlxuXG5cblxuICAgKi9cbiAgc2l6ZTogKCkgPT4ge1xuICAgIHJldHVybiBtYXBTdG9yZS5nZXRTaXplKCk7XG4gIH0sXG4gIC8qXG5cbiAgICovXG4gIGNsZWFyOiAoKSA9PiB7XG4gICAgbWFwU3RvcmUuY2xlYXIoKTtcbiAgfVxufSk7XG5cbi8vXG52YXIgZGVjb2RlRXZlbnRQYWNrZXQgPSAoeyBkYXRhIH0sIHJlbW90ZURlbm9tKSA9PiB7XG4gIGxldCB0eDtcbiAgdHJ5IHtcbiAgICB0eCA9IEpTT04ucGFyc2UoYXRvYihkYXRhKSk7XG4gIH0gY2F0Y2ggKGUyKSB7XG4gICAgcmV0dXJuIHsgZXJyb3I6IFtcImNvdWxkIG5vdCBwYXJzZSBwYWNrZXQgZGF0YVwiLCBkYXRhXSB9O1xuICB9XG4gIGNvbnN0IG5mYSA9IHR4LnNlbmRlcjtcbiAgaWYgKHR4LmRlbm9tICE9PSByZW1vdGVEZW5vbSkge1xuICAgIGNvbnN0IHsgZGVub206IGFjdHVhbCB9ID0gdHg7XG4gICAgcmV0dXJuIHsgZXJyb3I6IFtcInVuZXhwZWN0ZWQgZGVub21cIiwgeyBhY3R1YWwsIGV4cGVjdGVkOiByZW1vdGVEZW5vbSB9XSB9O1xuICB9XG4gIGxldCBFVUQ7XG4gIHRyeSB7XG4gICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZUFkZHJlc3NIb29rKHR4LnJlY2VpdmVyKTtcbiAgICBtdXN0TWF0Y2gyKGRlY29kZWQsIEFkZHJlc3NIb29rU2hhcGUpO1xuICAgICh7IEVVRCB9ID0gZGVjb2RlZC5xdWVyeSk7XG4gIH0gY2F0Y2ggKGUyKSB7XG4gICAgcmV0dXJuIHsgZXJyb3I6IFtcIm5vIHF1ZXJ5IHBhcmFtc1wiLCB0eC5yZWNlaXZlcl0gfTtcbiAgfVxuICBsZXQgYW1vdW50O1xuICB0cnkge1xuICAgIGFtb3VudCA9IEJpZ0ludCh0eC5hbW91bnQpO1xuICB9IGNhdGNoIChlMikge1xuICAgIHJldHVybiB7IGVycm9yOiBbXCJpbnZhbGlkIGFtb3VudFwiLCB0eC5hbW91bnRdIH07XG4gIH1cbiAgcmV0dXJuIHsgbmZhLCBhbW91bnQsIEVVRCB9O1xufTtcbmhhcmRlbihkZWNvZGVFdmVudFBhY2tldCk7XG52YXIgbWFrZU1pbnRlZEVhcmx5S2V5ID0gKGFkZHIsIGFtb3VudCkgPT4gYHBlbmRpbmdUeDoke0pTT04uc3RyaW5naWZ5KFthZGRyLCBTdHJpbmcoYW1vdW50KV0pfWA7XG52YXIgbWFrZUFkdmFuY2VEZXRhaWxzU2hhcGUgPSAoVVNEQykgPT4gaGFyZGVuKHtcbiAgZGVzdGluYXRpb246IE0uc3RyaW5nKCksXG4gIGZvcndhcmRpbmdBZGRyZXNzOiBNLnN0cmluZygpLFxuICBmdWxsQW1vdW50OiBtYWtlTmF0QW1vdW50U2hhcGUoVVNEQyksXG4gIHR4SGFzaDogRXZtSGFzaFNoYXBlXG59KTtcbnZhciBzdGF0ZVNoYXBlMyA9IGhhcmRlbih7XG4gIHJlcGF5ZXI6IE0ucmVtb3RhYmxlKFwiUmVwYXllclwiKSxcbiAgc2V0dGxlbWVudEFjY291bnQ6IE0ucmVtb3RhYmxlKFwiQWNjb3VudFwiKSxcbiAgcmVnaXN0cmF0aW9uOiBNLm9yKE0udW5kZWZpbmVkKCksIE0ucmVtb3RhYmxlKFwiUmVnaXN0cmF0aW9uXCIpKSxcbiAgc291cmNlQ2hhbm5lbDogTS5zdHJpbmcoKSxcbiAgcmVtb3RlRGVub206IE0uc3RyaW5nKCksXG4gIG1pbnRlZEVhcmx5OiBNLnJlbW90YWJsZShcIm1pbnRlZEVhcmx5XCIpLFxuICAvKiAgICAgICAgICAgICAgKi9cbiAgaW50ZXJtZWRpYXRlUmVjaXBpZW50OiBNLm9wdChDb3Ntb3NDaGFpbkFkZHJlc3NTaGFwZSlcbn0pO1xudmFyIHByZXBhcmVTZXR0bGVyID0gKHpvbmUsIHtcbiAgY3VycmVudENoYWluUmVmZXJlbmNlLFxuICBjaGFpbkh1YixcbiAgZmVlQ29uZmlnLFxuICBnZXROb2JsZUlDQSxcbiAgbG9nID0gbWFrZVRyYWNlcihcIlNldHRsZXJcIiwgdHJ1ZSksXG4gIHN0YXR1c01hbmFnZXIsXG4gIFVTREMsXG4gIHZvd1Rvb2xzLFxuICB3aXRoZHJhd1RvU2VhdCxcbiAgemNmXG59KSA9PiB7XG4gIGFzc2VydEFsbERlZmluZWQoeyBzdGF0dXNNYW5hZ2VyIH0pO1xuICBjb25zdCBzdXBwb3J0c0NjdHAgPSBtYWtlU3VwcG9ydHNDY3RwKGNoYWluSHViKTtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJGYXN0IFVTREMgU2V0dGxlclwiLFxuICAgIHtcbiAgICAgIGNyZWF0b3I6IE0uaW50ZXJmYWNlKFwiU2V0dGxlckNyZWF0b3JJXCIsIHtcbiAgICAgICAgbW9uaXRvck1pbnRpbmdEZXBvc2l0czogTS5jYWxsV2hlbigpLnJldHVybnMoTS5hbnkoKSlcbiAgICAgIH0pLFxuICAgICAgdGFwOiBNLmludGVyZmFjZShcIlNldHRsZXJUYXBJXCIsIHtcbiAgICAgICAgcmVjZWl2ZVVwY2FsbDogTS5jYWxsKE0ucmVjb3JkKCkpLnJldHVybnMoTS5wcm9taXNlKCkpXG4gICAgICB9KSxcbiAgICAgIG5vdGlmaWVyOiBNLmludGVyZmFjZShcIlNldHRsZXJOb3RpZnlJXCIsIHtcbiAgICAgICAgbm90aWZ5QWR2YW5jaW5nUmVzdWx0OiBNLmNhbGwoXG4gICAgICAgICAgbWFrZUFkdmFuY2VEZXRhaWxzU2hhcGUoVVNEQyksXG4gICAgICAgICAgTS5ib29sZWFuKClcbiAgICAgICAgKS5yZXR1cm5zKCksXG4gICAgICAgIGNoZWNrTWludGVkRWFybHk6IE0uY2FsbChDY3RwVHhFdmlkZW5jZVNoYXBlLCBNLnN0cmluZygpKS5yZXR1cm5zKFxuICAgICAgICAgIE0uYm9vbGVhbigpXG4gICAgICAgIClcbiAgICAgIH0pLFxuICAgICAgc2VsZjogTS5pbnRlcmZhY2UoXCJTZXR0bGVyU2VsZklcIiwge1xuICAgICAgICBhZGRNaW50ZWRFYXJseTogTS5jYWxsKE0uc3RyaW5nKCksIE0ubmF0KCkpLnJldHVybnMoKSxcbiAgICAgICAgZGlzYnVyc2U6IE0uY2FsbChFdm1IYXNoU2hhcGUsIE0ubmF0KCksIE0uc3RyaW5nKCkpLnJldHVybnMoXG4gICAgICAgICAgTS5wcm9taXNlKClcbiAgICAgICAgKSxcbiAgICAgICAgZm9yd2FyZDogTS5jYWxsKEV2bUhhc2hTaGFwZSwgTS5uYXQoKSwgTS5zdHJpbmcoKSkucmV0dXJucygpXG4gICAgICB9KSxcbiAgICAgIHRyYW5zZmVySGFuZGxlcjogTS5pbnRlcmZhY2UoXCJTZXR0bGVyVHJhbnNmZXJJXCIsIHtcbiAgICAgICAgb25GdWxmaWxsZWQ6IE0uY2FsbChNLnVuZGVmaW5lZCgpLCBNLnN0cmluZygpKS5yZXR1cm5zKCksXG4gICAgICAgIG9uUmVqZWN0ZWQ6IE0uY2FsbChNLmVycm9yKCksIE0uc3RyaW5nKCkpLnJldHVybnMoKVxuICAgICAgfSksXG4gICAgICBpbnRlcm1lZGlhdGVUcmFuc2ZlckhhbmRsZXI6IE0uaW50ZXJmYWNlKFwiU2V0dGxlckludGVybWVkaWF0ZVRyYW5zZmVySVwiLCB7XG4gICAgICAgIG9uRnVsZmlsbGVkOiBNLmNhbGwoTS51bmRlZmluZWQoKSwgTS5yZWNvcmQoKSkucmV0dXJucygpLFxuICAgICAgICBvblJlamVjdGVkOiBNLmNhbGwoTS5lcnJvcigpLCBNLnJlY29yZCgpKS5yZXR1cm5zKClcbiAgICAgIH0pLFxuICAgICAgZGVwb3NpdEZvckJ1cm5IYW5kbGVyOiBNLmludGVyZmFjZShcIlNldHRsZXJEZXBvc2l0Rm9yQnVybklcIiwge1xuICAgICAgICBvbkZ1bGZpbGxlZDogTS5jYWxsKE0udW5kZWZpbmVkKCksIE0uc3RyaW5nKCkpLnJldHVybnMoKSxcbiAgICAgICAgb25SZWplY3RlZDogTS5jYWxsKE0uZXJyb3IoKSwgTS5zdHJpbmcoKSkucmV0dXJucygpXG4gICAgICB9KVxuICAgIH0sXG4gICAgKGNvbmZpZykgPT4ge1xuICAgICAgbG9nKFwiY29uZmlnXCIsIGNvbmZpZyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5jb25maWcsXG4gICAgICAgIC8vXG4gICAgICAgIGludGVybWVkaWF0ZVJlY2lwaWVudDogdm9pZCAwLFxuICAgICAgICByZWdpc3RyYXRpb246IHZvaWQgMCxcbiAgICAgICAgbWludGVkRWFybHk6IHpvbmUuZGV0YWNoZWQoKS5tYXBTdG9yZShcIm1pbnRlZEVhcmx5XCIpXG4gICAgICB9O1xuICAgIH0sXG4gICAge1xuICAgICAgY3JlYXRvcjoge1xuICAgICAgICBhc3luYyBtb25pdG9yTWludGluZ0RlcG9zaXRzKCkge1xuICAgICAgICAgIGNvbnN0IHsgc2V0dGxlbWVudEFjY291bnQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgcmVnaXN0cmF0aW9uID0gYXdhaXQgdm93VG9vbHMud2hlbihcbiAgICAgICAgICAgIHNldHRsZW1lbnRBY2NvdW50Lm1vbml0b3JUcmFuc2ZlcnModGhpcy5mYWNldHMudGFwKVxuICAgICAgICAgICk7XG4gICAgICAgICAgYXNzZXJ0LnR5cGVvZihyZWdpc3RyYXRpb24sIFwib2JqZWN0XCIpO1xuICAgICAgICAgIHRoaXMuc3RhdGUucmVnaXN0cmF0aW9uID0gcmVnaXN0cmF0aW9uO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGFwOiB7XG4gICAgICAgIGFzeW5jIHJlY2VpdmVVcGNhbGwoZXZlbnQpIHtcbiAgICAgICAgICBsb2coXCJ1cGNhbGwgZXZlbnRcIiwgZXZlbnQucGFja2V0LnNlcXVlbmNlLCBldmVudC5ibG9ja1RpbWUpO1xuICAgICAgICAgIGNvbnN0IHsgc291cmNlQ2hhbm5lbCwgcmVtb3RlRGVub20gfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgeyBwYWNrZXQgfSA9IGV2ZW50O1xuICAgICAgICAgIGlmIChwYWNrZXQuc291cmNlX2NoYW5uZWwgIT09IHNvdXJjZUNoYW5uZWwpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgc291cmNlX2NoYW5uZWw6IGFjdHVhbCB9ID0gcGFja2V0O1xuICAgICAgICAgICAgbG9nKFwidW5leHBlY3RlZCBjaGFubmVsXCIsIHsgYWN0dWFsLCBleHBlY3RlZDogc291cmNlQ2hhbm5lbCB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZUV2ZW50UGFja2V0KGV2ZW50LnBhY2tldCwgcmVtb3RlRGVub20pO1xuICAgICAgICAgIGlmIChcImVycm9yXCIgaW4gZGVjb2RlZCkge1xuICAgICAgICAgICAgbG9nKFwiaW52YWxpZCBldmVudCBwYWNrZXRcIiwgZGVjb2RlZC5lcnJvcik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHsgbmZhLCBhbW91bnQsIEVVRCB9ID0gZGVjb2RlZDtcbiAgICAgICAgICBjb25zdCB7IHNlbGYgfSA9IHRoaXMuZmFjZXRzO1xuICAgICAgICAgIGNvbnN0IGZvdW5kID0gc3RhdHVzTWFuYWdlci5kZXF1ZXVlU3RhdHVzKG5mYSwgYW1vdW50KTtcbiAgICAgICAgICBsb2coXCJkZXF1ZXVlZFwiLCBmb3VuZCwgXCJmb3JcIiwgbmZhLCBhbW91bnQpO1xuICAgICAgICAgIHN3aXRjaCAoZm91bmQ/LnN0YXR1cykge1xuICAgICAgICAgICAgY2FzZSBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZWQ6XG4gICAgICAgICAgICAgIHJldHVybiBzZWxmLmRpc2J1cnNlKGZvdW5kLnR4SGFzaCwgYW1vdW50LCBFVUQpO1xuICAgICAgICAgICAgY2FzZSBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jaW5nOlxuICAgICAgICAgICAgICBsb2coXCJcXHUyNkEwXFx1RkUwRiB0YXA6IG1pbnRlZCB3aGlsZSBhZHZhbmNpbmdcIiwgbmZhLCBhbW91bnQpO1xuICAgICAgICAgICAgICBzZWxmLmFkZE1pbnRlZEVhcmx5KG5mYSwgYW1vdW50KTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgY2FzZSBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZVNraXBwZWQ6XG4gICAgICAgICAgICBjYXNlIFBlbmRpbmdUeFN0YXR1cy5BZHZhbmNlRmFpbGVkOlxuICAgICAgICAgICAgICByZXR1cm4gc2VsZi5mb3J3YXJkKGZvdW5kLnR4SGFzaCwgYW1vdW50LCBFVUQpO1xuICAgICAgICAgICAgY2FzZSB2b2lkIDA6XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICBsb2coXCJcXHUyNkEwXFx1RkUwRiB0YXA6IG1pbnRlZCBiZWZvcmUgb2JzZXJ2ZWRcIiwgbmZhLCBhbW91bnQpO1xuICAgICAgICAgICAgICBzZWxmLmFkZE1pbnRlZEVhcmx5KG5mYSwgYW1vdW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBub3RpZmllcjoge1xuICAgICAgICBub3RpZnlBZHZhbmNpbmdSZXN1bHQoe1xuICAgICAgICAgIHR4SGFzaCxcbiAgICAgICAgICBmb3J3YXJkaW5nQWRkcmVzcyxcbiAgICAgICAgICBmdWxsQW1vdW50LFxuICAgICAgICAgIGRlc3RpbmF0aW9uXG4gICAgICAgIH0sIHN1Y2Nlc3MpIHtcbiAgICAgICAgICBjb25zdCB7IG1pbnRlZEVhcmx5IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGNvbnN0IHsgdmFsdWU6IGZ1bGxWYWx1ZSB9ID0gZnVsbEFtb3VudDtcbiAgICAgICAgICBjb25zdCBrZXkgPSBtYWtlTWludGVkRWFybHlLZXkoZm9yd2FyZGluZ0FkZHJlc3MsIGZ1bGxWYWx1ZSk7XG4gICAgICAgICAgaWYgKG1pbnRlZEVhcmx5LmhhcyhrZXkpKSB7XG4gICAgICAgICAgICBhc011bHRpc2V0KG1pbnRlZEVhcmx5KS5yZW1vdmUoa2V5KTtcbiAgICAgICAgICAgIHN0YXR1c01hbmFnZXIuYWR2YW5jZU91dGNvbWVGb3JNaW50ZWRFYXJseSh0eEhhc2gsIHN1Y2Nlc3MpO1xuICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgdm9pZCB0aGlzLmZhY2V0cy5zZWxmLmRpc2J1cnNlKHR4SGFzaCwgZnVsbFZhbHVlLCBkZXN0aW5hdGlvbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB2b2lkIHRoaXMuZmFjZXRzLnNlbGYuZm9yd2FyZCh0eEhhc2gsIGZ1bGxWYWx1ZSwgZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdGF0dXNNYW5hZ2VyLmFkdmFuY2VPdXRjb21lKGZvcndhcmRpbmdBZGRyZXNzLCBmdWxsVmFsdWUsIHN1Y2Nlc3MpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgLypcblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGNoZWNrTWludGVkRWFybHkoZXZpZGVuY2UsIGRlc3RpbmF0aW9uKSB7XG4gICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgdHg6IHsgZm9yd2FyZGluZ0FkZHJlc3MsIGFtb3VudCB9LFxuICAgICAgICAgICAgdHhIYXNoXG4gICAgICAgICAgfSA9IGV2aWRlbmNlO1xuICAgICAgICAgIGNvbnN0IGtleSA9IG1ha2VNaW50ZWRFYXJseUtleShmb3J3YXJkaW5nQWRkcmVzcywgYW1vdW50KTtcbiAgICAgICAgICBjb25zdCB7IG1pbnRlZEVhcmx5IH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIGlmIChtaW50ZWRFYXJseS5oYXMoa2V5KSkge1xuICAgICAgICAgICAgbG9nKFxuICAgICAgICAgICAgICBcIm1hdGNoZWQgbWludGVkIGVhcmx5IGtleSwgaW5pdGlhdGluZyBmb3J3YXJkXCIsXG4gICAgICAgICAgICAgIGZvcndhcmRpbmdBZGRyZXNzLFxuICAgICAgICAgICAgICBhbW91bnRcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBhc011bHRpc2V0KG1pbnRlZEVhcmx5KS5yZW1vdmUoa2V5KTtcbiAgICAgICAgICAgIHN0YXR1c01hbmFnZXIuYWR2YW5jZU91dGNvbWVGb3JVbmtub3duTWludChldmlkZW5jZSk7XG4gICAgICAgICAgICB2b2lkIHRoaXMuZmFjZXRzLnNlbGYuZm9yd2FyZCh0eEhhc2gsIGFtb3VudCwgZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHNlbGY6IHtcbiAgICAgICAgLypcblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGFkZE1pbnRlZEVhcmx5KGFkZHJlc3MsIGFtb3VudCkge1xuICAgICAgICAgIGNvbnN0IGtleSA9IG1ha2VNaW50ZWRFYXJseUtleShhZGRyZXNzLCBhbW91bnQpO1xuICAgICAgICAgIGNvbnN0IHsgbWludGVkRWFybHkgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgYXNNdWx0aXNldChtaW50ZWRFYXJseSkuYWRkKGtleSk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgYXN5bmMgZGlzYnVyc2UodHhIYXNoLCBmdWxsVmFsdWUsIEVVRCkge1xuICAgICAgICAgIGNvbnN0IHsgcmVwYXllciwgc2V0dGxlbWVudEFjY291bnQgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgY29uc3QgcmVjZWl2ZWQgPSBBbW91bnRNYXRoLm1ha2UoVVNEQywgZnVsbFZhbHVlKTtcbiAgICAgICAgICBjb25zdCB7IHpjZlNlYXQ6IHNldHRsaW5nU2VhdCB9ID0gemNmLm1ha2VFbXB0eVNlYXRLaXQoKTtcbiAgICAgICAgICBjb25zdCB7IGNhbGN1bGF0ZVNwbGl0IH0gPSBtYWtlRmVlVG9vbHMoZmVlQ29uZmlnKTtcbiAgICAgICAgICBjb25zdCBhY2NvdW50SWQgPSBjaGFpbkh1Yi5yZXNvbHZlQWNjb3VudElkKEVVRCk7XG4gICAgICAgICAgY29uc3Qgc3BsaXQgPSBjYWxjdWxhdGVTcGxpdChyZWNlaXZlZCwgYWNjb3VudElkKTtcbiAgICAgICAgICBsb2coXCJkaXNidXJzaW5nXCIsIHNwbGl0KTtcbiAgICAgICAgICBhd2FpdCB2b3dUb29scy53aGVuKFxuICAgICAgICAgICAgd2l0aGRyYXdUb1NlYXQoXG4gICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgIHNldHRsZW1lbnRBY2NvdW50LFxuICAgICAgICAgICAgICBzZXR0bGluZ1NlYXQsXG4gICAgICAgICAgICAgIGhhcmRlbih7IEluOiByZWNlaXZlZCB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgdHJhbnNmZXJQYXJ0ID0gZnJvbU9ubHkoc2V0dGxpbmdTZWF0LCB7IEluOiByZWNlaXZlZCB9KTtcbiAgICAgICAgICByZXBheWVyLnJlcGF5KHRyYW5zZmVyUGFydCwgc3BsaXQpO1xuICAgICAgICAgIHNldHRsaW5nU2VhdC5leGl0KCk7XG4gICAgICAgICAgc3RhdHVzTWFuYWdlci5kaXNidXJzZWQodHhIYXNoLCBzcGxpdCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICAgKi9cbiAgICAgICAgZm9yd2FyZCh0eEhhc2gsIGZ1bGxWYWx1ZSwgRVVEKSB7XG4gICAgICAgICAgY29uc3QgeyBzZXR0bGVtZW50QWNjb3VudCB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICBsb2coXCJmb3J3YXJkaW5nXCIsIGZ1bGxWYWx1ZSwgXCJ0b1wiLCBFVUQsIFwiZm9yXCIsIHR4SGFzaCk7XG4gICAgICAgICAgY29uc3QgZGVzdCA9ICgoKSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICByZXR1cm4gY2hhaW5IdWIucmVzb2x2ZUFjY291bnRJZChFVUQpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZTIpIHtcbiAgICAgICAgICAgICAgbG9nKFwiXFx1MjZBMFxcdUZFMEYgZm9yd2FyZCB0cmFuc2ZlciBmYWlsZWQhXCIsIGUyLCB0eEhhc2gpO1xuICAgICAgICAgICAgICBzdGF0dXNNYW5hZ2VyLmZvcndhcmRlZCh0eEhhc2gsIGZhbHNlKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSkoKTtcbiAgICAgICAgICBpZiAoIWRlc3QpIHJldHVybjtcbiAgICAgICAgICBjb25zdCB7IG5hbWVzcGFjZSwgcmVmZXJlbmNlIH0gPSBwYXJzZUFjY291bnRJZChkZXN0KTtcbiAgICAgICAgICBjb25zdCBhbXQgPSBBbW91bnRNYXRoLm1ha2UoVVNEQywgZnVsbFZhbHVlKTtcbiAgICAgICAgICBjb25zdCBpbnRlcm1lZGlhdGVSZWNpcGllbnQgPSBnZXROb2JsZUlDQSgpLmdldEFkZHJlc3MoKTtcbiAgICAgICAgICBpZiAobmFtZXNwYWNlID09PSBcImNvc21vc1wiKSB7XG4gICAgICAgICAgICBjb25zdCB0cmFuc2Zlck9yU2VuZFYgPSByZWZlcmVuY2UgPT09IGN1cnJlbnRDaGFpblJlZmVyZW5jZSA/IEUoc2V0dGxlbWVudEFjY291bnQpLnNlbmQoZGVzdCwgYW10KSA6IEUoc2V0dGxlbWVudEFjY291bnQpLnRyYW5zZmVyKGRlc3QsIGFtdCwge1xuICAgICAgICAgICAgICBmb3J3YXJkT3B0czogeyBpbnRlcm1lZGlhdGVSZWNpcGllbnQgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2b2lkIHZvd1Rvb2xzLndhdGNoKFxuICAgICAgICAgICAgICB0cmFuc2Zlck9yU2VuZFYsXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLnRyYW5zZmVySGFuZGxlcixcbiAgICAgICAgICAgICAgdHhIYXNoXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSBpZiAoc3VwcG9ydHNDY3RwKGRlc3QpKSB7XG4gICAgICAgICAgICB2b2lkIHZvd1Rvb2xzLndhdGNoKFxuICAgICAgICAgICAgICBFKHNldHRsZW1lbnRBY2NvdW50KS50cmFuc2ZlcihpbnRlcm1lZGlhdGVSZWNpcGllbnQsIGFtdCksXG4gICAgICAgICAgICAgIHRoaXMuZmFjZXRzLmludGVybWVkaWF0ZVRyYW5zZmVySGFuZGxlcixcbiAgICAgICAgICAgICAgeyBhbXQsIGRlc3QsIHR4SGFzaCB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsb2coXG4gICAgICAgICAgICAgIFwiXFx1ezFGNkE4fSBmb3J3YXJkIG5vdCBhdHRlbXB0ZWQhXCIsXG4gICAgICAgICAgICAgIFwidW5zdXBwb3J0ZWQgZGVzdGluYXRpb25cIixcbiAgICAgICAgICAgICAgdHhIYXNoLFxuICAgICAgICAgICAgICBkZXN0XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkZWQodHhIYXNoLCBmYWxzZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdHJhbnNmZXJIYW5kbGVyOiB7XG4gICAgICAgIG9uRnVsZmlsbGVkKF9yZXN1bHQsIHR4SGFzaCkge1xuICAgICAgICAgIHN0YXR1c01hbmFnZXIuZm9yd2FyZGVkKHR4SGFzaCwgdHJ1ZSk7XG4gICAgICAgIH0sXG4gICAgICAgIG9uUmVqZWN0ZWQocmVhc29uLCB0eEhhc2gpIHtcbiAgICAgICAgICBsb2coXCJcXHV7MUY2QTh9IGZvcndhcmQgdHJhbnNmZXIgcmVqZWN0ZWQhXCIsIHJlYXNvbiwgdHhIYXNoKTtcbiAgICAgICAgICBzdGF0dXNNYW5hZ2VyLmZvcndhcmRlZCh0eEhhc2gsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGludGVybWVkaWF0ZVRyYW5zZmVySGFuZGxlcjoge1xuICAgICAgICBvbkZ1bGZpbGxlZChfcmVzdWx0LCB7XG4gICAgICAgICAgYW10LFxuICAgICAgICAgIGRlc3QsXG4gICAgICAgICAgdHhIYXNoXG4gICAgICAgIH0pIHtcbiAgICAgICAgICBjb25zdCBub2JsZUljYSA9IGdldE5vYmxlSUNBKCk7XG4gICAgICAgICAgdm9pZCB2b3dUb29scy53YXRjaChcbiAgICAgICAgICAgIEUobm9ibGVJY2EpLmRlcG9zaXRGb3JCdXJuKGRlc3QsIGFtdCksXG4gICAgICAgICAgICB0aGlzLmZhY2V0cy5kZXBvc2l0Rm9yQnVybkhhbmRsZXIsXG4gICAgICAgICAgICB0eEhhc2hcbiAgICAgICAgICApO1xuICAgICAgICB9LFxuICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgeyB0eEhhc2ggfSkge1xuICAgICAgICAgIGxvZyhcIlxcdXsxRjZBOH0gZm9yd2FyZCBpbnRlcm1lZGlhdGUgdHJhbnNmZXIgcmVqZWN0ZWQhXCIsIHJlYXNvbiwgdHhIYXNoKTtcbiAgICAgICAgICBzdGF0dXNNYW5hZ2VyLmZvcndhcmRlZCh0eEhhc2gsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGRlcG9zaXRGb3JCdXJuSGFuZGxlcjoge1xuICAgICAgICBvbkZ1bGZpbGxlZChfcmVzdWx0LCB0eEhhc2gpIHtcbiAgICAgICAgICBzdGF0dXNNYW5hZ2VyLmZvcndhcmRlZCh0eEhhc2gsIHRydWUpO1xuICAgICAgICB9LFxuICAgICAgICBvblJlamVjdGVkKHJlYXNvbiwgdHhIYXNoKSB7XG4gICAgICAgICAgbG9nKFwiXFx1ezFGNkE4fSBmb3J3YXJkIGRlcG9zaXRGb3JCdXJuIHJlamVjdGVkIVwiLCByZWFzb24sIHR4SGFzaCk7XG4gICAgICAgICAgc3RhdHVzTWFuYWdlci5mb3J3YXJkZWQodHhIYXNoLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIHN0YXRlU2hhcGU6IHN0YXRlU2hhcGUzXG4gICAgfVxuICApO1xufTtcbmhhcmRlbihwcmVwYXJlU2V0dGxlcik7XG5cbi8vXG52YXIgbWFrZVBlbmRpbmdUeEtleSA9IChuZmEsIGFtb3VudCkgPT4gKFxuICAvL1xuICBgcGVuZGluZ1R4OiR7YW1vdW50fToke25mYX1gXG4pO1xudmFyIHBlbmRpbmdUeEtleU9mID0gKGV2aWRlbmNlKSA9PiB7XG4gIGNvbnN0IHsgYW1vdW50LCBmb3J3YXJkaW5nQWRkcmVzcyB9ID0gZXZpZGVuY2UudHg7XG4gIHJldHVybiBtYWtlUGVuZGluZ1R4S2V5KGZvcndhcmRpbmdBZGRyZXNzLCBhbW91bnQpO1xufTtcbnZhciBzdGF0ZVNoYXBlNCA9IGhhcmRlbih7XG4gIHBlbmRpbmdTZXR0bGVUeHM6IE0ucmVtb3RhYmxlKCksXG4gIHNlZW5UeHM6IE0ucmVtb3RhYmxlKCksXG4gIHN0b3JlZENvbXBsZXRlZFR4czogTS5yZW1vdGFibGUoKVxufSk7XG52YXIgcHJlcGFyZVN0YXR1c01hbmFnZXIgPSAoem9uZSwgdHhuc05vZGUsIHsgbWFyc2hhbGxlciwgbG9nID0gbWFrZVRyYWNlcihcIlN0YXR1c01hbmFnZXJcIiwgdHJ1ZSkgfSkgPT4ge1xuICBjb25zdCBwZW5kaW5nU2V0dGxlVHhzID0gem9uZS5tYXBTdG9yZShcbiAgICBcIlBlbmRpbmdTZXR0bGVUeHNcIixcbiAgICB7XG4gICAgICBrZXlTaGFwZTogTS5zdHJpbmcoKSxcbiAgICAgIHZhbHVlU2hhcGU6IE0uYXJyYXlPZihQZW5kaW5nVHhTaGFwZSlcbiAgICB9XG4gICk7XG4gIGNvbnN0IHNlZW5UeHMgPSB6b25lLm1hcFN0b3JlKFwiU2VlblR4c1wiLCB7XG4gICAga2V5U2hhcGU6IE0uc3RyaW5nKCksXG4gICAgdmFsdWVTaGFwZTogTS5uYXQoKVxuICB9KTtcbiAgY29uc3Qgc3RvcmVkQ29tcGxldGVkVHhzID0gem9uZS5zZXRTdG9yZShcbiAgICBcIlN0b3JlZENvbXBsZXRlZFR4c1wiLFxuICAgIHtcbiAgICAgIGtleVNoYXBlOiBNLnN0cmluZygpXG4gICAgfVxuICApO1xuICBjb25zdCBwdWJsaXNoVHhuUmVjb3JkID0gKHR4SWQsIHJlY29yZCkgPT4ge1xuICAgIGNvbnN0IHR4Tm9kZSA9IEUodHhuc05vZGUpLm1ha2VDaGlsZE5vZGUodHhJZCwge1xuICAgICAgc2VxdWVuY2U6IHRydWVcbiAgICAgIC8vXG4gICAgfSk7XG4gICAgaWYgKHJlY29yZC5zdGF0dXMgJiYgVGVybWluYWxUeFN0YXR1c1tyZWNvcmQuc3RhdHVzXSkge1xuICAgICAgc3RvcmVkQ29tcGxldGVkVHhzLmFkZCh0eElkKTtcbiAgICB9XG4gICAgdm9pZCBFLndoZW4oXG4gICAgICBFKG1hcnNoYWxsZXIpLnRvQ2FwRGF0YShyZWNvcmQpLFxuICAgICAgKGNhcERhdGEpID0+IEUodHhOb2RlKS5zZXRWYWx1ZShKU09OLnN0cmluZ2lmeShjYXBEYXRhKSlcbiAgICApO1xuICB9O1xuICBjb25zdCBwdWJsaXNoRXZpZGVuY2UgPSAoaGFzaCwgZXZpZGVuY2UpID0+IHtcbiAgICBwdWJsaXNoVHhuUmVjb3JkKGhhc2gsIGhhcmRlbih7IGV2aWRlbmNlLCBzdGF0dXM6IFR4U3RhdHVzLk9ic2VydmVkIH0pKTtcbiAgfTtcbiAgY29uc3QgaW5pdFBlbmRpbmdUeCA9IChldmlkZW5jZSwgc3RhdHVzLCByaXNrc0lkZW50aWZpZWQpID0+IHtcbiAgICBjb25zdCB7IHR4SGFzaCB9ID0gZXZpZGVuY2U7XG4gICAgaWYgKHNlZW5UeHMuaGFzKHR4SGFzaCkpIHtcbiAgICAgIHRocm93IG1ha2VFcnJvcihgVHJhbnNhY3Rpb24gYWxyZWFkeSBzZWVuOiAke3F1b3RlKHR4SGFzaCl9YCk7XG4gICAgfVxuICAgIHNlZW5UeHMuaW5pdCh0eEhhc2gsIGV2aWRlbmNlLmJsb2NrVGltZXN0YW1wKTtcbiAgICBhcHBlbmRUb1N0b3JlZEFycmF5KFxuICAgICAgcGVuZGluZ1NldHRsZVR4cyxcbiAgICAgIHBlbmRpbmdUeEtleU9mKGV2aWRlbmNlKSxcbiAgICAgIGhhcmRlbih7IC4uLmV2aWRlbmNlLCBzdGF0dXMgfSlcbiAgICApO1xuICAgIHB1Ymxpc2hFdmlkZW5jZSh0eEhhc2gsIGV2aWRlbmNlKTtcbiAgICBpZiAoc3RhdHVzID09PSBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZVNraXBwZWQpIHtcbiAgICAgIHB1Ymxpc2hUeG5SZWNvcmQodHhIYXNoLCBoYXJkZW4oeyBzdGF0dXMsIHJpc2tzSWRlbnRpZmllZCB9KSk7XG4gICAgfSBlbHNlIGlmIChzdGF0dXMgIT09IFBlbmRpbmdUeFN0YXR1cy5PYnNlcnZlZCkge1xuICAgICAgcHVibGlzaFR4blJlY29yZCh0eEhhc2gsIGhhcmRlbih7IHN0YXR1cyB9KSk7XG4gICAgfVxuICB9O1xuICBmdW5jdGlvbiBzZXRQZW5kaW5nVHhTdGF0dXMoeyBuZmEsIGFtb3VudCB9LCBzdGF0dXMpIHtcbiAgICBjb25zdCBrZXkgPSBtYWtlUGVuZGluZ1R4S2V5KG5mYSwgYW1vdW50KTtcbiAgICBwZW5kaW5nU2V0dGxlVHhzLmhhcyhrZXkpIHx8IHRocm93UmVkYWN0ZWRgbm8gYWR2YW5jaW5nIHR4IHdpdGggJHt7IG5mYSwgYW1vdW50IH19YDtcbiAgICBjb25zdCBwZW5kaW5nID0gcGVuZGluZ1NldHRsZVR4cy5nZXQoa2V5KTtcbiAgICBjb25zdCBpeCA9IHBlbmRpbmcuZmluZEluZGV4KCh0eDIpID0+IHR4Mi5zdGF0dXMgPT09IFBlbmRpbmdUeFN0YXR1cy5BZHZhbmNpbmcpO1xuICAgIGl4ID49IDAgfHwgdGhyb3dSZWRhY3RlZGBubyBhZHZhbmNpbmcgdHggd2l0aCAke3sgbmZhLCBhbW91bnQgfX1gO1xuICAgIGNvbnN0IFtwcmVmaXgsIHR4LCBzdWZmaXhdID0gW1xuICAgICAgcGVuZGluZy5zbGljZSgwLCBpeCksXG4gICAgICBwZW5kaW5nW2l4XSxcbiAgICAgIHBlbmRpbmcuc2xpY2UoaXggKyAxKVxuICAgIF07XG4gICAgY29uc3QgdHhwb3N0ID0geyAuLi50eCwgc3RhdHVzIH07XG4gICAgcGVuZGluZ1NldHRsZVR4cy5zZXQoa2V5LCBoYXJkZW4oWy4uLnByZWZpeCwgdHhwb3N0LCAuLi5zdWZmaXhdKSk7XG4gICAgcHVibGlzaFR4blJlY29yZCh0eC50eEhhc2gsIGhhcmRlbih7IHN0YXR1cyB9KSk7XG4gIH1cbiAgcmV0dXJuIHpvbmUuZXhvKFxuICAgIFwiRmFzdCBVU0RDIFN0YXR1cyBNYW5hZ2VyXCIsXG4gICAgTS5pbnRlcmZhY2UoXCJTdGF0dXNNYW5hZ2VySVwiLCB7XG4gICAgICAvL1xuICAgICAgYWR2YW5jZTogTS5jYWxsKENjdHBUeEV2aWRlbmNlU2hhcGUpLnJldHVybnMoKSxcbiAgICAgIGFkdmFuY2VPdXRjb21lOiBNLmNhbGwoTS5zdHJpbmcoKSwgTS5uYXQoKSwgTS5ib29sZWFuKCkpLnJldHVybnMoKSxcbiAgICAgIHNraXBBZHZhbmNlOiBNLmNhbGwoQ2N0cFR4RXZpZGVuY2VTaGFwZSwgTS5hcnJheU9mKE0uc3RyaW5nKCkpKS5yZXR1cm5zKCksXG4gICAgICBhZHZhbmNlT3V0Y29tZUZvck1pbnRlZEVhcmx5OiBNLmNhbGwoRXZtSGFzaFNoYXBlLCBNLmJvb2xlYW4oKSkucmV0dXJucygpLFxuICAgICAgYWR2YW5jZU91dGNvbWVGb3JVbmtub3duTWludDogTS5jYWxsKENjdHBUeEV2aWRlbmNlU2hhcGUpLnJldHVybnMoKSxcbiAgICAgIGhhc0JlZW5PYnNlcnZlZDogTS5jYWxsKENjdHBUeEV2aWRlbmNlU2hhcGUpLnJldHVybnMoTS5ib29sZWFuKCkpLFxuICAgICAgZGVsZXRlQ29tcGxldGVkVHhzOiBNLmNhbGwoKS5yZXR1cm5zKE0udW5kZWZpbmVkKCkpLFxuICAgICAgZGVxdWV1ZVN0YXR1czogTS5jYWxsKE0uc3RyaW5nKCksIE0uYmlnaW50KCkpLnJldHVybnMoXG4gICAgICAgIE0ub3IoXG4gICAgICAgICAge1xuICAgICAgICAgICAgdHhIYXNoOiBFdm1IYXNoU2hhcGUsXG4gICAgICAgICAgICBzdGF0dXM6IE0ub3IoLi4uT2JqZWN0LnZhbHVlcyhQZW5kaW5nVHhTdGF0dXMpKVxuICAgICAgICAgIH0sXG4gICAgICAgICAgTS51bmRlZmluZWQoKVxuICAgICAgICApXG4gICAgICApLFxuICAgICAgZGlzYnVyc2VkOiBNLmNhbGwoRXZtSGFzaFNoYXBlLCBBbW91bnRLZXl3b3JkUmVjb3JkU2hhcGUpLnJldHVybnMoXG4gICAgICAgIE0udW5kZWZpbmVkKClcbiAgICAgICksXG4gICAgICBmb3J3YXJkZWQ6IE0uY2FsbChFdm1IYXNoU2hhcGUsIE0uYm9vbGVhbigpKS5yZXR1cm5zKCksXG4gICAgICBsb29rdXBQZW5kaW5nOiBNLmNhbGwoTS5zdHJpbmcoKSwgTS5iaWdpbnQoKSkucmV0dXJucyhcbiAgICAgICAgTS5hcnJheU9mKFBlbmRpbmdUeFNoYXBlKVxuICAgICAgKVxuICAgIH0pLFxuICAgIHtcbiAgICAgIC8qXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBhZHZhbmNlKGV2aWRlbmNlKSB7XG4gICAgICAgIGluaXRQZW5kaW5nVHgoZXZpZGVuY2UsIFBlbmRpbmdUeFN0YXR1cy5BZHZhbmNpbmcpO1xuICAgICAgfSxcbiAgICAgIC8qXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIHNraXBBZHZhbmNlKGV2aWRlbmNlLCByaXNrc0lkZW50aWZpZWQpIHtcbiAgICAgICAgaW5pdFBlbmRpbmdUeChcbiAgICAgICAgICBldmlkZW5jZSxcbiAgICAgICAgICBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZVNraXBwZWQsXG4gICAgICAgICAgcmlza3NJZGVudGlmaWVkXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgYWR2YW5jZU91dGNvbWUobmZhLCBhbW91bnQsIHN1Y2Nlc3MpIHtcbiAgICAgICAgc2V0UGVuZGluZ1R4U3RhdHVzKFxuICAgICAgICAgIHsgbmZhLCBhbW91bnQgfSxcbiAgICAgICAgICBzdWNjZXNzID8gUGVuZGluZ1R4U3RhdHVzLkFkdmFuY2VkIDogUGVuZGluZ1R4U3RhdHVzLkFkdmFuY2VGYWlsZWRcbiAgICAgICAgKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGFkdmFuY2VPdXRjb21lRm9yTWludGVkRWFybHkodHhIYXNoLCBzdWNjZXNzKSB7XG4gICAgICAgIHB1Ymxpc2hUeG5SZWNvcmQoXG4gICAgICAgICAgdHhIYXNoLFxuICAgICAgICAgIGhhcmRlbih7XG4gICAgICAgICAgICBzdGF0dXM6IHN1Y2Nlc3MgPyBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZWQgOiBQZW5kaW5nVHhTdGF0dXMuQWR2YW5jZUZhaWxlZFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgYWR2YW5jZU91dGNvbWVGb3JVbmtub3duTWludChldmlkZW5jZSkge1xuICAgICAgICBjb25zdCB7IHR4SGFzaCB9ID0gZXZpZGVuY2U7XG4gICAgICAgIGlmIChzZWVuVHhzLmhhcyh0eEhhc2gpKSB7XG4gICAgICAgICAgdGhyb3cgbWFrZUVycm9yKGBUcmFuc2FjdGlvbiBhbHJlYWR5IHNlZW46ICR7cXVvdGUodHhIYXNoKX1gKTtcbiAgICAgICAgfVxuICAgICAgICBzZWVuVHhzLmluaXQodHhIYXNoLCBldmlkZW5jZS5ibG9ja1RpbWVzdGFtcCk7XG4gICAgICAgIHB1Ymxpc2hFdmlkZW5jZSh0eEhhc2gsIGV2aWRlbmNlKTtcbiAgICAgIH0sXG4gICAgICAvKlxuXG5cbiAgICAgICAqL1xuICAgICAgaGFzQmVlbk9ic2VydmVkKGV2aWRlbmNlKSB7XG4gICAgICAgIHJldHVybiBzZWVuVHhzLmhhcyhldmlkZW5jZS50eEhhc2gpO1xuICAgICAgfSxcbiAgICAgIC8vXG4gICAgICBkZWxldGVDb21wbGV0ZWRUeHMoKSB7XG4gICAgICAgIGZvciAoY29uc3QgdHhIYXNoIG9mIHN0b3JlZENvbXBsZXRlZFR4cy52YWx1ZXMoKSkge1xuICAgICAgICAgIGNvbnN0IHR4Tm9kZSA9IEUodHhuc05vZGUpLm1ha2VDaGlsZE5vZGUodHhIYXNoLCB7XG4gICAgICAgICAgICBzZXF1ZW5jZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgICB2b2lkIEUodHhOb2RlKS5zZXRWYWx1ZShcIlwiKS50aGVuKCgpID0+IHN0b3JlZENvbXBsZXRlZFR4cy5kZWxldGUodHhIYXNoKSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICAvKlxuXG5cblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGRlcXVldWVTdGF0dXMobmZhLCBhbW91bnQpIHtcbiAgICAgICAgY29uc3Qga2V5ID0gbWFrZVBlbmRpbmdUeEtleShuZmEsIGFtb3VudCk7XG4gICAgICAgIGlmICghcGVuZGluZ1NldHRsZVR4cy5oYXMoa2V5KSkgcmV0dXJuIHZvaWQgMDtcbiAgICAgICAgY29uc3QgcGVuZGluZyA9IHBlbmRpbmdTZXR0bGVUeHMuZ2V0KGtleSk7XG4gICAgICAgIGlmIChwZW5kaW5nLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiB2b2lkIDA7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgW3sgc3RhdHVzLCB0eEhhc2ggfSwgLi4ucmVtYWluaW5nXSA9IHBlbmRpbmc7XG4gICAgICAgIGlmIChyZW1haW5pbmcubGVuZ3RoKSB7XG4gICAgICAgICAgcGVuZGluZ1NldHRsZVR4cy5zZXQoa2V5LCBoYXJkZW4ocmVtYWluaW5nKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGVuZGluZ1NldHRsZVR4cy5kZWxldGUoa2V5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaGFyZGVuKHsgc3RhdHVzLCB0eEhhc2ggfSk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgZGlzYnVyc2VkKHR4SGFzaCwgc3BsaXQpIHtcbiAgICAgICAgcHVibGlzaFR4blJlY29yZCh0eEhhc2gsIGhhcmRlbih7IHNwbGl0LCBzdGF0dXM6IFR4U3RhdHVzLkRpc2J1cnNlZCB9KSk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cbiAgICAgICAqL1xuICAgICAgZm9yd2FyZGVkKHR4SGFzaCwgc3VjY2Vzcykge1xuICAgICAgICBwdWJsaXNoVHhuUmVjb3JkKFxuICAgICAgICAgIHR4SGFzaCxcbiAgICAgICAgICBoYXJkZW4oe1xuICAgICAgICAgICAgc3RhdHVzOiBzdWNjZXNzID8gVHhTdGF0dXMuRm9yd2FyZGVkIDogVHhTdGF0dXMuRm9yd2FyZEZhaWxlZFxuICAgICAgICAgIH0pXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgICAgLypcblxuXG5cblxuXG4gICAgICAgKi9cbiAgICAgIGxvb2t1cFBlbmRpbmcobmZhLCBhbW91bnQpIHtcbiAgICAgICAgY29uc3Qga2V5ID0gbWFrZVBlbmRpbmdUeEtleShuZmEsIGFtb3VudCk7XG4gICAgICAgIGlmICghcGVuZGluZ1NldHRsZVR4cy5oYXMoa2V5KSkge1xuICAgICAgICAgIHJldHVybiBoYXJkZW4oW10pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwZW5kaW5nU2V0dGxlVHhzLmdldChrZXkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgeyBzdGF0ZVNoYXBlOiBzdGF0ZVNoYXBlNCB9XG4gICk7XG59O1xuaGFyZGVuKHByZXBhcmVTdGF0dXNNYW5hZ2VyKTtcblxuLy9cbnZhciBJTlZJVEFUSU9OX01BS0VSU19ERVNDID0gXCJvcmFjbGUgb3BlcmF0b3IgaW52aXRhdGlvblwiO1xudmFyIE9wZXJhdG9yS2l0SSA9IHtcbiAgYWRtaW46IE0uaW50ZXJmYWNlKFwiQWRtaW5cIiwge1xuICAgIGRpc2FibGU6IE0uY2FsbCgpLnJldHVybnMoKVxuICB9KSxcbiAgaW52aXRhdGlvbk1ha2VyczogTS5pbnRlcmZhY2UoXCJJbnZpdGF0aW9uTWFrZXJzXCIsIHtcbiAgICBTdWJtaXRFdmlkZW5jZTogTS5jYWxsKENjdHBUeEV2aWRlbmNlU2hhcGUpLm9wdGlvbmFsKFJpc2tBc3Nlc3NtZW50U2hhcGUpLnJldHVybnMoTS5wcm9taXNlKCkpXG4gIH0pLFxuICBvcGVyYXRvcjogTS5pbnRlcmZhY2UoXCJPcGVyYXRvclwiLCB7XG4gICAgc3VibWl0RXZpZGVuY2U6IE0uY2FsbChDY3RwVHhFdmlkZW5jZVNoYXBlKS5vcHRpb25hbChSaXNrQXNzZXNzbWVudFNoYXBlKS5yZXR1cm5zKCksXG4gICAgZ2V0U3RhdHVzOiBNLmNhbGwoKS5yZXR1cm5zKE0ucmVjb3JkKCkpXG4gIH0pXG59O1xuXG4vL1xudmFyIHRyYWNlMTAgPSBtYWtlVHJhY2VyKFwiWm9lVXRpbHNcIik7XG52YXIgZGVmaW5lSW5lcnRJbnZpdGF0aW9uID0gKHpjZiwgZGVzY3JpcHRpb24pID0+IHtcbiAgcmV0dXJuICgpID0+IHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgIHRyYWNlMTAoYFxcdTIxMzlcXHVGRTBGIEFuIG9mZmVyIHdhcyBtYWRlIG9uIGFuIGluZXJ0IGludml0YXRpb24gZm9yICR7ZGVzY3JpcHRpb259YCk7XG4gICAgc2VhdC5leGl0KCk7XG4gICAgcmV0dXJuIFwiaW5lcnQ7IG5vdGhpbmcgc2hvdWxkIGJlIGV4cGVjdGVkIGZyb20gdGhpcyBvZmZlclwiO1xuICB9LCBkZXNjcmlwdGlvbik7XG59O1xuXG4vL1xudmFyIHRyYWNlMTEgPSBtYWtlVHJhY2VyKFwiVHhPcGVyYXRvclwiKTtcbnZhciBwcmVwYXJlT3BlcmF0b3JLaXQgPSAoem9uZSwgc3RhdGljUG93ZXJzKSA9PiB6b25lLmV4b0NsYXNzS2l0KFxuICBcIk9wZXJhdG9yIEtpdFwiLFxuICBPcGVyYXRvcktpdEksXG4gIC8qXG5cblxuICAgKi9cbiAgKG9wZXJhdG9ySWQsIHBvd2VycykgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBvcGVyYXRvcklkLFxuICAgICAgcG93ZXJzLFxuICAgICAgZGlzYWJsZWQ6IGZhbHNlXG4gICAgfTtcbiAgfSxcbiAge1xuICAgIGFkbWluOiB7XG4gICAgICBkaXNhYmxlKCkge1xuICAgICAgICB0cmFjZTExKGBvcGVyYXRvciAke3RoaXMuc3RhdGUub3BlcmF0b3JJZH0gZGlzYWJsZWRgKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfSxcbiAgICAvKlxuXG5cbiAgICAgKi9cbiAgICBpbnZpdGF0aW9uTWFrZXJzOiB7XG4gICAgICAvKlxuXG5cblxuXG5cblxuXG5cblxuICAgICAgICovXG4gICAgICBhc3luYyBTdWJtaXRFdmlkZW5jZShldmlkZW5jZSwgcmlza0Fzc2Vzc21lbnQpIHtcbiAgICAgICAgY29uc3QgeyBvcGVyYXRvciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgIG9wZXJhdG9yLnN1Ym1pdEV2aWRlbmNlKGV2aWRlbmNlLCByaXNrQXNzZXNzbWVudCk7XG4gICAgICAgIHJldHVybiBzdGF0aWNQb3dlcnMubWFrZUluZXJ0SW52aXRhdGlvbigpO1xuICAgICAgfVxuICAgIH0sXG4gICAgb3BlcmF0b3I6IHtcbiAgICAgIC8qXG5cblxuXG5cbiAgICAgICAqL1xuICAgICAgc3VibWl0RXZpZGVuY2UoZXZpZGVuY2UsIHJpc2tBc3Nlc3NtZW50ID0ge30pIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgIXN0YXRlLmRpc2FibGVkIHx8IHRocm93UmVkYWN0ZWRgc3VibWl0RXZpZGVuY2UgZm9yIGRpc2FibGVkIG9wZXJhdG9yYDtcbiAgICAgICAgc3RhdGUucG93ZXJzLmF0dGVzdChldmlkZW5jZSwgcmlza0Fzc2Vzc21lbnQsIHN0YXRlLm9wZXJhdG9ySWQpO1xuICAgICAgfSxcbiAgICAgIGdldFN0YXR1cygpIHtcbiAgICAgICAgY29uc3QgeyBzdGF0ZSB9ID0gdGhpcztcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvcGVyYXRvcklkOiBzdGF0ZS5vcGVyYXRvcklkLFxuICAgICAgICAgIGRpc2FibGVkOiBzdGF0ZS5kaXNhYmxlZFxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgfVxuKTtcblxuLy9cbnZhciB0cmFjZTEyID0gbWFrZVRyYWNlcihcIlR4RmVlZFwiLCB0cnVlKTtcbnZhciBUcmFuc2FjdGlvbkZlZWRLaXRJID0gaGFyZGVuKHtcbiAgb3BlcmF0b3JQb3dlcnM6IE0uaW50ZXJmYWNlKFwiVHJhbnNhY3Rpb24gRmVlZCBBZG1pblwiLCB7XG4gICAgYXR0ZXN0OiBNLmNhbGwoXG4gICAgICBDY3RwVHhFdmlkZW5jZVNoYXBlLFxuICAgICAgUmlza0Fzc2Vzc21lbnRTaGFwZSxcbiAgICAgIE0uc3RyaW5nKClcbiAgICApLnJldHVybnMoKVxuICB9KSxcbiAgY3JlYXRvcjogTS5pbnRlcmZhY2UoXCJUcmFuc2FjdGlvbiBGZWVkIENyZWF0b3JcIiwge1xuICAgIGluaXRPcGVyYXRvcjogTS5jYWxsKE0uc3RyaW5nKCkpLnJldHVybnMoe1xuICAgICAgaW52aXRhdGlvbk1ha2VyczogTS5yZW1vdGFibGUoKSxcbiAgICAgIG9wZXJhdG9yOiBNLnJlbW90YWJsZSgpXG4gICAgfSksXG4gICAgbWFrZU9wZXJhdG9ySW52aXRhdGlvbjogTS5jYWxsKE0uc3RyaW5nKCkpLnJldHVybnMoTS5wcm9taXNlKCkpLFxuICAgIHJlbW92ZU9wZXJhdG9yOiBNLmNhbGwoTS5zdHJpbmcoKSkucmV0dXJucygpXG4gIH0pLFxuICBwdWJsaWM6IE0uaW50ZXJmYWNlKFwiVHJhbnNhY3Rpb24gRmVlZCBQdWJsaWNcIiwge1xuICAgIGdldEV2aWRlbmNlU3Vic2NyaWJlcjogTS5jYWxsKCkucmV0dXJucyhNLnJlbW90YWJsZSgpKVxuICB9KVxufSk7XG52YXIgYWxsUmlza3NJZGVudGlmaWVkID0gKHJpc2tTdG9yZXMsIHR4SGFzaCkgPT4ge1xuICBjb25zdCBzZXRPZlJpc2tzID0gLyogICAgICAgICAgICovIG5ldyBTZXQoKTtcbiAgZm9yIChjb25zdCBzdG9yZSBvZiByaXNrU3RvcmVzKSB7XG4gICAgY29uc3QgbmV4dCA9IHN0b3JlLmdldCh0eEhhc2gpO1xuICAgIGZvciAoY29uc3QgcmlzayBvZiBuZXh0LnJpc2tzSWRlbnRpZmllZCA/PyBbXSkge1xuICAgICAgc2V0T2ZSaXNrcy5hZGQocmlzayk7XG4gICAgfVxuICB9XG4gIHJldHVybiBbLi4uc2V0T2ZSaXNrcy52YWx1ZXMoKV0uc29ydCgpO1xufTtcbnZhciBzdGF0ZVNoYXBlNSA9IHtcbiAgb3BlcmF0b3JzOiBNLnJlbW90YWJsZSgpLFxuICBwZW5kaW5nOiBNLnJlbW90YWJsZSgpLFxuICByaXNrczogTS5yZW1vdGFibGUoKVxufTtcbmhhcmRlbihzdGF0ZVNoYXBlNSk7XG52YXIgcHJlcGFyZVRyYW5zYWN0aW9uRmVlZEtpdCA9ICh6b25lLCB6Y2YpID0+IHtcbiAgY29uc3Qga2luZHMgPSB6b25lLm1hcFN0b3JlKFwiS2luZHNcIik7XG4gIGNvbnN0IG1ha2VEdXJhYmxlUHVibGlzaEtpdCA9IHByZXBhcmVEdXJhYmxlUHVibGlzaEtpdChcbiAgICBraW5kcyxcbiAgICBcIlRyYW5zYWN0aW9uIEZlZWRcIlxuICApO1xuICBjb25zdCB7IHB1Ymxpc2hlciwgc3Vic2NyaWJlciB9ID0gbWFrZUR1cmFibGVQdWJsaXNoS2l0KCk7XG4gIGNvbnN0IG1ha2VJbmVydEludml0YXRpb24gPSBkZWZpbmVJbmVydEludml0YXRpb24oemNmLCBcInN1Ym1pdHRpbmcgZXZpZGVuY2VcIik7XG4gIGNvbnN0IG1ha2VPcGVyYXRvcktpdCA9IHByZXBhcmVPcGVyYXRvcktpdCh6b25lLCB7XG4gICAgbWFrZUluZXJ0SW52aXRhdGlvblxuICB9KTtcbiAgcmV0dXJuIHpvbmUuZXhvQ2xhc3NLaXQoXG4gICAgXCJGYXN0IFVTREMgRmVlZFwiLFxuICAgIFRyYW5zYWN0aW9uRmVlZEtpdEksXG4gICAgKCkgPT4ge1xuICAgICAgY29uc3Qgb3BlcmF0b3JzID0gem9uZS5tYXBTdG9yZShcIm9wZXJhdG9yc1wiKTtcbiAgICAgIGNvbnN0IHBlbmRpbmcgPSB6b25lLm1hcFN0b3JlKFxuICAgICAgICBcInBlbmRpbmdcIlxuICAgICAgKTtcbiAgICAgIGNvbnN0IHJpc2tzID0gem9uZS5tYXBTdG9yZShcbiAgICAgICAgXCJyaXNrc1wiXG4gICAgICApO1xuICAgICAgcmV0dXJuIHsgb3BlcmF0b3JzLCBwZW5kaW5nLCByaXNrcyB9O1xuICAgIH0sXG4gICAge1xuICAgICAgY3JlYXRvcjoge1xuICAgICAgICAvKlxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIG1ha2VPcGVyYXRvckludml0YXRpb24ob3BlcmF0b3JJZCkge1xuICAgICAgICAgIGNvbnN0IHsgY3JlYXRvciB9ID0gdGhpcy5mYWNldHM7XG4gICAgICAgICAgdHJhY2UxMihcIm1ha2VPcGVyYXRvckludml0YXRpb25cIiwgb3BlcmF0b3JJZCk7XG4gICAgICAgICAgcmV0dXJuIHpjZi5tYWtlSW52aXRhdGlvbigoc2VhdCkgPT4ge1xuICAgICAgICAgICAgc2VhdC5leGl0KCk7XG4gICAgICAgICAgICByZXR1cm4gY3JlYXRvci5pbml0T3BlcmF0b3Iob3BlcmF0b3JJZCk7XG4gICAgICAgICAgfSwgSU5WSVRBVElPTl9NQUtFUlNfREVTQyk7XG4gICAgICAgIH0sXG4gICAgICAgIGluaXRPcGVyYXRvcihvcGVyYXRvcklkKSB7XG4gICAgICAgICAgY29uc3QgeyBvcGVyYXRvcnMsIHBlbmRpbmcsIHJpc2tzIH0gPSB0aGlzLnN0YXRlO1xuICAgICAgICAgIHRyYWNlMTIoXCJpbml0T3BlcmF0b3JcIiwgb3BlcmF0b3JJZCk7XG4gICAgICAgICAgY29uc3Qgb3BlcmF0b3JLaXQgPSBtYWtlT3BlcmF0b3JLaXQoXG4gICAgICAgICAgICBvcGVyYXRvcklkLFxuICAgICAgICAgICAgdGhpcy5mYWNldHMub3BlcmF0b3JQb3dlcnNcbiAgICAgICAgICApO1xuICAgICAgICAgIG9wZXJhdG9ycy5pbml0KG9wZXJhdG9ySWQsIG9wZXJhdG9yS2l0KTtcbiAgICAgICAgICBwZW5kaW5nLmluaXQoXG4gICAgICAgICAgICBvcGVyYXRvcklkLFxuICAgICAgICAgICAgem9uZS5kZXRhY2hlZCgpLm1hcFN0b3JlKFwicGVuZGluZyBldmlkZW5jZVwiKVxuICAgICAgICAgICk7XG4gICAgICAgICAgcmlza3MuaW5pdChvcGVyYXRvcklkLCB6b25lLmRldGFjaGVkKCkubWFwU3RvcmUoXCJyaXNrIGFzc2Vzc21lbnRzXCIpKTtcbiAgICAgICAgICBjb25zdCB7IGludml0YXRpb25NYWtlcnMsIG9wZXJhdG9yIH0gPSBvcGVyYXRvcktpdDtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaW52aXRhdGlvbk1ha2VycyxcbiAgICAgICAgICAgIG9wZXJhdG9yXG4gICAgICAgICAgfTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVtb3ZlT3BlcmF0b3Iob3BlcmF0b3JJZCkge1xuICAgICAgICAgIGNvbnN0IHsgb3BlcmF0b3JzLCBwZW5kaW5nLCByaXNrcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICAgICAgICB0cmFjZTEyKFwicmVtb3ZlT3BlcmF0b3JcIiwgb3BlcmF0b3JJZCk7XG4gICAgICAgICAgY29uc3Qgb3BlcmF0b3JLaXQgPSBvcGVyYXRvcnMuZ2V0KG9wZXJhdG9ySWQpO1xuICAgICAgICAgIG9wZXJhdG9yS2l0LmFkbWluLmRpc2FibGUoKTtcbiAgICAgICAgICBvcGVyYXRvcnMuZGVsZXRlKG9wZXJhdG9ySWQpO1xuICAgICAgICAgIHBlbmRpbmcuZGVsZXRlKG9wZXJhdG9ySWQpO1xuICAgICAgICAgIHJpc2tzLmRlbGV0ZShvcGVyYXRvcklkKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG9wZXJhdG9yUG93ZXJzOiB7XG4gICAgICAgIC8qXG5cblxuXG5cblxuXG5cbiAgICAgICAgICovXG4gICAgICAgIGF0dGVzdChldmlkZW5jZSwgcmlza0Fzc2Vzc21lbnQsIG9wZXJhdG9ySWQpIHtcbiAgICAgICAgICBjb25zdCB7IG9wZXJhdG9ycywgcGVuZGluZywgcmlza3MgfSA9IHRoaXMuc3RhdGU7XG4gICAgICAgICAgdHJhY2UxMihcImF0dGVzdFwiLCBvcGVyYXRvcklkLCBldmlkZW5jZSk7XG4gICAgICAgICAgY29uc3QgeyB0eEhhc2ggfSA9IGV2aWRlbmNlO1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIGNvbnN0IHBlbmRpbmdTdG9yZSA9IHBlbmRpbmcuZ2V0KG9wZXJhdG9ySWQpO1xuICAgICAgICAgICAgaWYgKHBlbmRpbmdTdG9yZS5oYXModHhIYXNoKSkge1xuICAgICAgICAgICAgICB0cmFjZTEyKGBvcGVyYXRvciAke29wZXJhdG9ySWR9IGFscmVhZHkgcmVwb3J0ZWQgJHt0eEhhc2h9YCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBwZW5kaW5nU3RvcmUuaW5pdCh0eEhhc2gsIGV2aWRlbmNlKTtcbiAgICAgICAgICAgICAgY29uc3Qgcmlza1N0b3JlID0gcmlza3MuZ2V0KG9wZXJhdG9ySWQpO1xuICAgICAgICAgICAgICByaXNrU3RvcmUuaW5pdCh0eEhhc2gsIHJpc2tBc3Nlc3NtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgZm91bmQgPSBbLi4ucGVuZGluZy52YWx1ZXMoKV0uZmlsdGVyKFxuICAgICAgICAgICAgKHN0b3JlKSA9PiBzdG9yZS5oYXModHhIYXNoKVxuICAgICAgICAgICk7XG4gICAgICAgICAge1xuICAgICAgICAgICAgbGV0IGxhc3RFdmlkZW5jZTtcbiAgICAgICAgICAgIGZvciAoY29uc3Qgc3RvcmUgb2YgZm91bmQpIHtcbiAgICAgICAgICAgICAgY29uc3QgbmV4dCA9IHN0b3JlLmdldCh0eEhhc2gpO1xuICAgICAgICAgICAgICBpZiAobGFzdEV2aWRlbmNlICYmICFrZXlFUShsYXN0RXZpZGVuY2UsIG5leHQpKSB7XG4gICAgICAgICAgICAgICAgdHJhY2UxMihcbiAgICAgICAgICAgICAgICAgIFwiXFx1ezFGNkE4fSBjb25mbGljdGluZyBldmlkZW5jZSBmb3JcIixcbiAgICAgICAgICAgICAgICAgIHR4SGFzaCxcbiAgICAgICAgICAgICAgICAgIFwiOlwiLFxuICAgICAgICAgICAgICAgICAgbGFzdEV2aWRlbmNlLFxuICAgICAgICAgICAgICAgICAgXCIhPVwiLFxuICAgICAgICAgICAgICAgICAgbmV4dFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgdGhyb3dSZWRhY3RlZGBjb25mbGljdGluZyBldmlkZW5jZSBmb3IgJHtxdW90ZSh0eEhhc2gpfWA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgbGFzdEV2aWRlbmNlID0gbmV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgbWluQXR0ZXN0YXRpb25zID0gTWF0aC5jZWlsKG9wZXJhdG9ycy5nZXRTaXplKCkgLyAyKTtcbiAgICAgICAgICB0cmFjZTEyKFxuICAgICAgICAgICAgXCJ0cmFuc2FjdGlvblwiLFxuICAgICAgICAgICAgdHhIYXNoLFxuICAgICAgICAgICAgXCJoYXNcIixcbiAgICAgICAgICAgIGZvdW5kLmxlbmd0aCxcbiAgICAgICAgICAgIFwib2ZcIixcbiAgICAgICAgICAgIG1pbkF0dGVzdGF0aW9ucyxcbiAgICAgICAgICAgIFwibmVjZXNzYXJ5IGF0dGVzdGF0aW9uc1wiXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAoZm91bmQubGVuZ3RoIDwgbWluQXR0ZXN0YXRpb25zKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHJpc2tTdG9yZXMgPSBbLi4ucmlza3MudmFsdWVzKCldLmZpbHRlcihcbiAgICAgICAgICAgIChzdG9yZSkgPT4gc3RvcmUuaGFzKHR4SGFzaClcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChmb3VuZC5sZW5ndGggPT09IG1pbkF0dGVzdGF0aW9ucykge1xuICAgICAgICAgICAgY29uc3Qgcmlza3NJZGVudGlmaWVkID0gYWxsUmlza3NJZGVudGlmaWVkKHJpc2tTdG9yZXMsIHR4SGFzaCk7XG4gICAgICAgICAgICB0cmFjZTEyKFwicHVibGlzaGluZyBldmlkZW5jZVwiLCBldmlkZW5jZSwgcmlza3NJZGVudGlmaWVkKTtcbiAgICAgICAgICAgIHB1Ymxpc2hlci5wdWJsaXNoKHtcbiAgICAgICAgICAgICAgZXZpZGVuY2UsXG4gICAgICAgICAgICAgIHJpc2s6IHsgcmlza3NJZGVudGlmaWVkIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZm91bmQubGVuZ3RoID09PSBwZW5kaW5nLmdldFNpemUoKSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBzdG9yZSBvZiBmb3VuZCkge1xuICAgICAgICAgICAgICBzdG9yZS5kZWxldGUodHhIYXNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoY29uc3Qgc3RvcmUgb2Ygcmlza1N0b3Jlcykge1xuICAgICAgICAgICAgICBzdG9yZS5kZWxldGUodHhIYXNoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBwdWJsaWM6IHtcbiAgICAgICAgZ2V0RXZpZGVuY2VTdWJzY3JpYmVyOiAoKSA9PiBzdWJzY3JpYmVyXG4gICAgICB9XG4gICAgfSxcbiAgICB7IHN0YXRlU2hhcGU6IHN0YXRlU2hhcGU1IH1cbiAgKTtcbn07XG5oYXJkZW4ocHJlcGFyZVRyYW5zYWN0aW9uRmVlZEtpdCk7XG5cbi8vXG52YXIgZmFzdF91c2RjX2Zsb3dzX2V4cG9ydHMgPSB7fTtcbl9fZXhwb3J0KGZhc3RfdXNkY19mbG93c19leHBvcnRzLCB7XG4gIG1ha2VMb2NhbEFjY291bnQ6ICgpID0+IG1ha2VMb2NhbEFjY291bnQsXG4gIG1ha2VOb2JsZUFjY291bnQ6ICgpID0+IG1ha2VOb2JsZUFjY291bnRcbn0pO1xudmFyIG1ha2VMb2NhbEFjY291bnQgPSBhc3luYyAob3JjaCkgPT4ge1xuICBjb25zdCBhZ29yaWNDaGFpbiA9IGF3YWl0IG9yY2guZ2V0Q2hhaW4oXCJhZ29yaWNcIik7XG4gIHJldHVybiBhZ29yaWNDaGFpbi5tYWtlQWNjb3VudCgpO1xufTtcbmhhcmRlbihtYWtlTG9jYWxBY2NvdW50KTtcbnZhciBtYWtlTm9ibGVBY2NvdW50ID0gYXN5bmMgKG9yY2gpID0+IHtcbiAgY29uc3Qgbm9ibGVDaGFpbiA9IGF3YWl0IG9yY2guZ2V0Q2hhaW4oXCJub2JsZVwiKTtcbiAgcmV0dXJuIG5vYmxlQ2hhaW4ubWFrZUFjY291bnQoKTtcbn07XG5oYXJkZW4obWFrZU5vYmxlQWNjb3VudCk7XG5cbi8vXG52YXIgdHJhY2UxMyA9IG1ha2VUcmFjZXIoXCJGYXN0VXNkY1wiKTtcbnZhciBUWE5TX05PREUgPSBcInR4bnNcIjtcbnZhciBGRUVfTk9ERSA9IFwiZmVlQ29uZmlnXCI7XG52YXIgQUREUkVTU0VTX0JBR0dBR0VfS0VZID0gXCJhZGRyZXNzZXNcIjtcbnZhciBOT0JMRV9JQ0FfQkFHR0FHRV9LRVkgPSBcIm5vYmxlSUNBXCI7XG52YXIgJGPNj19tZXRhPXtcbiAgY3VzdG9tVGVybXNTaGFwZTogRmFzdFVTRENUZXJtc1NoYXBlLFxuICBwcml2YXRlQXJnc1NoYXBlOiB7XG4gICAgLy9cbiAgICAuLi5PcmNoZXN0cmF0aW9uUG93ZXJzU2hhcGUsXG4gICAgYXNzZXRJbmZvOiBNLmFycmF5T2YoW0Rlbm9tU2hhcGUsIERlbm9tRGV0YWlsU2hhcGVdKSxcbiAgICBjaGFpbkluZm86IE0ucmVjb3JkT2YoTS5zdHJpbmcoKSwgQ29zbW9zQ2hhaW5JbmZvU2hhcGVWMSksXG4gICAgZmVlQ29uZmlnOiBGZWVDb25maWdTaGFwZSxcbiAgICBtYXJzaGFsbGVyOiBNLnJlbW90YWJsZSgpLFxuICAgIHBvb2xNZXRyaWNzTm9kZTogTS5yZW1vdGFibGUoKVxuICB9XG59O21ldGE9JGPNj19tZXRhO1xuaGFyZGVuKG1ldGEpO1xudmFyIHB1Ymxpc2hGZWVDb25maWcgPSAobm9kZSwgbWFyc2hhbGxlciwgZmVlQ29uZmlnKSA9PiB7XG4gIGNvbnN0IGZlZU5vZGUgPSBFKG5vZGUpLm1ha2VDaGlsZE5vZGUoRkVFX05PREUpO1xuICB2b2lkIEUud2hlbihcbiAgICBFKG1hcnNoYWxsZXIpLnRvQ2FwRGF0YShmZWVDb25maWcpLFxuICAgICh2YWx1ZSkgPT4gRShmZWVOb2RlKS5zZXRWYWx1ZShKU09OLnN0cmluZ2lmeSh2YWx1ZSkpXG4gICk7XG59O1xudmFyIHB1Ymxpc2hBZGRyZXNzZXMgPSAoY29udHJhY3ROb2RlLCBhZGRyZXNzZXMpID0+IHtcbiAgcmV0dXJuIEUoY29udHJhY3ROb2RlKS5zZXRWYWx1ZShKU09OLnN0cmluZ2lmeShhZGRyZXNzZXMpKTtcbn07XG52YXIgJGPNj19jb250cmFjdD1hc3luYyh6Y2YscHJpdmF0ZUFyZ3MsIHpvbmUsIHRvb2xzKSA9PiB7XG4gIGFzc2VydCh0b29scywgXCJubyB0b29sc1wiKTtcbiAgY29uc3QgdGVybXMgPSB6Y2YuZ2V0VGVybXMoKTtcbiAgYXNzZXJ0KFwiVVNEQ1wiIGluIHRlcm1zLmJyYW5kcywgXCJubyBVU0RDIGJyYW5kXCIpO1xuICBhc3NlcnQoXCJ1c2RjRGVub21cIiBpbiB0ZXJtcywgXCJubyB1c2RjRGVub21cIik7XG4gIGNvbnN0IHsgZmVlQ29uZmlnLCBtYXJzaGFsbGVyLCBzdG9yYWdlTm9kZSB9ID0gcHJpdmF0ZUFyZ3M7XG4gIGNvbnN0IHsgbWFrZVJlY29yZGVyS2l0IH0gPSBwcmVwYXJlUmVjb3JkZXJLaXRNYWtlcnMoXG4gICAgem9uZS5tYXBTdG9yZShcInZzdG9yYWdlXCIpLFxuICAgIG1hcnNoYWxsZXJcbiAgKTtcbiAgY29uc3Qgc3RhdHVzTWFuYWdlciA9IHByZXBhcmVTdGF0dXNNYW5hZ2VyKFxuICAgIHpvbmUsXG4gICAgRShzdG9yYWdlTm9kZSkubWFrZUNoaWxkTm9kZShUWE5TX05PREUpLFxuICAgIHsgbWFyc2hhbGxlciB9XG4gICk7XG4gIGNvbnN0IHsgVVNEQyB9ID0gdGVybXMuYnJhbmRzO1xuICBjb25zdCB7IHdpdGhkcmF3VG9TZWF0IH0gPSB0b29scy56b2VUb29scztcbiAgY29uc3QgeyBiYWdnYWdlLCBjaGFpbkh1Yiwgb3JjaGVzdHJhdGVBbGwsIHZvd1Rvb2xzIH0gPSB0b29scztcbiAgY29uc3QgZ2V0Tm9ibGVJQ0EgPSAoKSA9PiBiYWdnYWdlLmdldChOT0JMRV9JQ0FfQkFHR0FHRV9LRVkpO1xuICBjb25zdCBtYWtlU2V0dGxlciA9IHByZXBhcmVTZXR0bGVyKHpvbmUsIHtcbiAgICBzdGF0dXNNYW5hZ2VyLFxuICAgIFVTREMsXG4gICAgd2l0aGRyYXdUb1NlYXQsXG4gICAgZmVlQ29uZmlnLFxuICAgIGdldE5vYmxlSUNBLFxuICAgIHZvd1Rvb2xzOiB0b29scy52b3dUb29scyxcbiAgICB6Y2YsXG4gICAgY2hhaW5IdWIsXG4gICAgY3VycmVudENoYWluUmVmZXJlbmNlOiBwcml2YXRlQXJncy5jaGFpbkluZm8uYWdvcmljLmNoYWluSWRcbiAgfSk7XG4gIGNvbnN0IHpvZVRvb2xzID0gbWFrZVpvZVRvb2xzKHpjZiwgdm93VG9vbHMpO1xuICBjb25zdCBtYWtlQWR2YW5jZXIgPSBwcmVwYXJlQWR2YW5jZXIoem9uZSwge1xuICAgIGNoYWluSHViLFxuICAgIGZlZUNvbmZpZyxcbiAgICBnZXROb2JsZUlDQSxcbiAgICB1c2RjOiBoYXJkZW4oe1xuICAgICAgYnJhbmQ6IHRlcm1zLmJyYW5kcy5VU0RDLFxuICAgICAgZGVub206IHRlcm1zLnVzZGNEZW5vbVxuICAgIH0pLFxuICAgIHN0YXR1c01hbmFnZXIsXG4gICAgdm93VG9vbHMsXG4gICAgemNmLFxuICAgIHpvZVRvb2xzXG4gIH0pO1xuICBjb25zdCBtYWtlRmVlZEtpdCA9IHByZXBhcmVUcmFuc2FjdGlvbkZlZWRLaXQoem9uZSwgemNmKTtcbiAgY29uc3QgbWFrZUxpcXVpZGl0eVBvb2xLaXQgPSBwcmVwYXJlTGlxdWlkaXR5UG9vbEtpdChcbiAgICB6b25lLFxuICAgIHpjZixcbiAgICB0ZXJtcy5icmFuZHMuVVNEQyxcbiAgICB7IG1ha2VSZWNvcmRlcktpdCB9XG4gICk7XG4gIGNvbnN0IHsgbWFrZUxvY2FsQWNjb3VudDogbWFrZUxvY2FsQWNjb3VudDIsIG1ha2VOb2JsZUFjY291bnQ6IG1ha2VOb2JsZUFjY291bnQyIH0gPSBvcmNoZXN0cmF0ZUFsbChmYXN0X3VzZGNfZmxvd3NfZXhwb3J0cywge30pO1xuICBjb25zdCBjcmVhdG9yRmFjZXQgPSB6b25lLmV4byhcIkZhc3QgVVNEQyBDcmVhdG9yXCIsIHZvaWQgMCwge1xuICAgIGFzeW5jIG1ha2VPcGVyYXRvckludml0YXRpb24ob3BlcmF0b3JJZCkge1xuICAgICAgcmV0dXJuIGZlZWRLaXQuY3JlYXRvci5tYWtlT3BlcmF0b3JJbnZpdGF0aW9uKG9wZXJhdG9ySWQpO1xuICAgIH0sXG4gICAgcmVtb3ZlT3BlcmF0b3Iob3BlcmF0b3JJZCkge1xuICAgICAgcmV0dXJuIGZlZWRLaXQuY3JlYXRvci5yZW1vdmVPcGVyYXRvcihvcGVyYXRvcklkKTtcbiAgICB9LFxuICAgIGFzeW5jIGdldENvbnRyYWN0RmVlQmFsYW5jZSgpIHtcbiAgICAgIHJldHVybiBwb29sS2l0LmZlZVJlY2lwaWVudC5nZXRDb250cmFjdEZlZUJhbGFuY2UoKTtcbiAgICB9LFxuICAgIGFzeW5jIG1ha2VXaXRoZHJhd0ZlZXNJbnZpdGF0aW9uKCkge1xuICAgICAgcmV0dXJuIHBvb2xLaXQuZmVlUmVjaXBpZW50Lm1ha2VXaXRoZHJhd0ZlZXNJbnZpdGF0aW9uKCk7XG4gICAgfSxcbiAgICBhc3luYyBjb25uZWN0VG9Ob2JsZShhZ29yaWNDaGFpbklkLCBub2JsZUNoYWluSWQsIGFnb3JpY1RvTm9ibGUpIHtcbiAgICAgIGNvbnN0IHNob3VsZFVwZGF0ZSA9IGFnb3JpY0NoYWluSWQgJiYgbm9ibGVDaGFpbklkICYmIGFnb3JpY1RvTm9ibGU7XG4gICAgICBpZiAoc2hvdWxkVXBkYXRlKSB7XG4gICAgICAgIHRyYWNlMTMoXCJjb25uZWN0VG9Ob2JsZVwiLCBhZ29yaWNDaGFpbklkLCBub2JsZUNoYWluSWQsIGFnb3JpY1RvTm9ibGUpO1xuICAgICAgICBjaGFpbkh1Yi51cGRhdGVDb25uZWN0aW9uKGFnb3JpY0NoYWluSWQsIG5vYmxlQ2hhaW5JZCwgYWdvcmljVG9Ob2JsZSk7XG4gICAgICB9XG4gICAgICBjb25zdCBub2JsZUlDQUxhYmVsID0gYE5vYmxlSUNBLSR7KHNob3VsZFVwZGF0ZSA/IGFnb3JpY1RvTm9ibGUgOiBhZ1RvTm9ibGUpLmNvdW50ZXJwYXJ0eS5jb25uZWN0aW9uX2lkfWA7XG4gICAgICB0cmFjZTEzKFwiTm9ibGVJQ0FcIiwgbm9ibGVJQ0FMYWJlbCk7XG4gICAgICBjb25zdCBub2JsZUFjY291bnRWID0gem9uZS5tYWtlT25jZShcbiAgICAgICAgbm9ibGVJQ0FMYWJlbCxcbiAgICAgICAgKCkgPT4gbWFrZU5vYmxlQWNjb3VudDIoKVxuICAgICAgKTtcbiAgICAgIHJldHVybiB2b3dUb29scy53aGVuKG5vYmxlQWNjb3VudFYsIChub2JsZUFjY291bnQpID0+IHtcbiAgICAgICAgdHJhY2UxMyhcIm5vYmxlQWNjb3VudFwiLCBub2JsZUFjY291bnQpO1xuICAgICAgICBpZiAoYmFnZ2FnZS5oYXMoTk9CTEVfSUNBX0JBR0dBR0VfS0VZKSkge1xuICAgICAgICAgIHRyYWNlMTMoXG4gICAgICAgICAgICBcIk5vYmxlIElDQSBhbHJlYWR5IHNldCBpbiBiYWdnYWdlLiBFcXVhbD9cIixcbiAgICAgICAgICAgIGJhZ2dhZ2UuZ2V0KE5PQkxFX0lDQV9CQUdHQUdFX0tFWSkgPT09IG5vYmxlQWNjb3VudFxuICAgICAgICAgICk7XG4gICAgICAgICAgYmFnZ2FnZS5zZXQoTk9CTEVfSUNBX0JBR0dBR0VfS0VZLCBub2JsZUFjY291bnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJhZ2dhZ2UuaW5pdChOT0JMRV9JQ0FfQkFHR0FHRV9LRVksIG5vYmxlQWNjb3VudCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vYmxlQWNjb3VudC5nZXRBZGRyZXNzKCk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGFzeW5jIHB1Ymxpc2hBZGRyZXNzZXMoKSB7XG4gICAgICAhYmFnZ2FnZS5oYXMoQUREUkVTU0VTX0JBR0dBR0VfS0VZKSB8fCB0aHJvd1JlZGFjdGVkYEFkZHJlc3NlcyBhbHJlYWR5IHB1Ymxpc2hlZGA7XG4gICAgICBjb25zdCBbcG9vbEFjY291bnRBZGRyZXNzXSA9IGF3YWl0IHZvd1Rvb2xzLndoZW4oXG4gICAgICAgIHZvd1Rvb2xzLmFsbChbRShwb29sQWNjb3VudCkuZ2V0QWRkcmVzcygpXSlcbiAgICAgICk7XG4gICAgICBjb25zdCBhZGRyZXNzZXMgPSBoYXJkZW4oe1xuICAgICAgICBwb29sQWNjb3VudDogcG9vbEFjY291bnRBZGRyZXNzLnZhbHVlLFxuICAgICAgICBzZXR0bGVtZW50QWNjb3VudDogc2V0dGxlbWVudEFkZHJlc3MudmFsdWVcbiAgICAgIH0pO1xuICAgICAgYmFnZ2FnZS5pbml0KEFERFJFU1NFU19CQUdHQUdFX0tFWSwgYWRkcmVzc2VzKTtcbiAgICAgIGF3YWl0IHB1Ymxpc2hBZGRyZXNzZXMoc3RvcmFnZU5vZGUsIGFkZHJlc3Nlcyk7XG4gICAgICByZXR1cm4gYWRkcmVzc2VzO1xuICAgIH0sXG4gICAgZGVsZXRlQ29tcGxldGVkVHhzKCkge1xuICAgICAgcmV0dXJuIHN0YXR1c01hbmFnZXIuZGVsZXRlQ29tcGxldGVkVHhzKCk7XG4gICAgfSxcbiAgICAvKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi9cbiAgICB1cGRhdGVDaGFpbihjaGFpbk5hbWUsIGNoYWluSW5mbykge1xuICAgICAgcmV0dXJuIGNoYWluSHViLnVwZGF0ZUNoYWluKGNoYWluTmFtZSwgY2hhaW5JbmZvKTtcbiAgICB9LFxuICAgIC8qICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXG4gICAgcmVnaXN0ZXJDaGFpbihjaGFpbk5hbWUsIGNoYWluSW5mbykge1xuICAgICAgcmV0dXJuIGNoYWluSHViLnJlZ2lzdGVyQ2hhaW4oY2hhaW5OYW1lLCBjaGFpbkluZm8pO1xuICAgIH1cbiAgfSk7XG4gIGNvbnN0IHB1YmxpY0ZhY2V0ID0gem9uZS5leG8oXCJGYXN0IFVTREMgUHVibGljXCIsIHZvaWQgMCwge1xuICAgIG1ha2VEZXBvc2l0SW52aXRhdGlvbigpIHtcbiAgICAgIHJldHVybiBwb29sS2l0LnB1YmxpYy5tYWtlRGVwb3NpdEludml0YXRpb24oKTtcbiAgICB9LFxuICAgIG1ha2VXaXRoZHJhd0ludml0YXRpb24oKSB7XG4gICAgICByZXR1cm4gcG9vbEtpdC5wdWJsaWMubWFrZVdpdGhkcmF3SW52aXRhdGlvbigpO1xuICAgIH0sXG4gICAgZ2V0UHVibGljVG9waWNzKCkge1xuICAgICAgcmV0dXJuIHBvb2xLaXQucHVibGljLmdldFB1YmxpY1RvcGljcygpO1xuICAgIH0sXG4gICAgZ2V0U3RhdGljSW5mbygpIHtcbiAgICAgIGJhZ2dhZ2UuaGFzKEFERFJFU1NFU19CQUdHQUdFX0tFWSkgfHwgdGhyb3dSZWRhY3RlZGBubyBhZGRyZXNzZXMuIGNyZWF0b3IgbXVzdCAncHVibGlzaEFkZHJlc3NlcycgZmlyc3RgO1xuICAgICAgY29uc3QgYWRkcmVzc2VzID0gYmFnZ2FnZS5nZXQoQUREUkVTU0VTX0JBR0dBR0VfS0VZKTtcbiAgICAgIHJldHVybiBoYXJkZW4oe1xuICAgICAgICBbQUREUkVTU0VTX0JBR0dBR0VfS0VZXTogYWRkcmVzc2VzXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICBwdWJsaXNoRmVlQ29uZmlnKHN0b3JhZ2VOb2RlLCBtYXJzaGFsbGVyLCBmZWVDb25maWcpO1xuICBjb25zdCBzaGFyZU1pbnQgPSBhd2FpdCBwcm92aWRlU2luZ2xldG9uKFxuICAgIHpvbmUubWFwU3RvcmUoXCJtaW50XCIpLFxuICAgIFwiUG9vbFNoYXJlXCIsXG4gICAgKCkgPT4gemNmLm1ha2VaQ0ZNaW50KFwiUG9vbFNoYXJlc1wiLCBBc3NldEtpbmQuTkFULCB7XG4gICAgICBkZWNpbWFsUGxhY2VzOiA2XG4gICAgfSlcbiAgKTtcbiAgY29uc3QgcG9vbEtpdCA9IHpvbmUubWFrZU9uY2UoXG4gICAgXCJMaXF1aWRpdHkgUG9vbCBraXRcIixcbiAgICAoKSA9PiBtYWtlTGlxdWlkaXR5UG9vbEtpdChzaGFyZU1pbnQsIHByaXZhdGVBcmdzLnBvb2xNZXRyaWNzTm9kZSlcbiAgKTtcbiAgY29uc3QgZmlyc3RJbmNhcm5hdGlvbktleSA9IFwiZmlyc3RJbmNhcm5hdGlvbktleVwiO1xuICBpZiAoIWJhZ2dhZ2UuaGFzKGZpcnN0SW5jYXJuYXRpb25LZXkpKSB7XG4gICAgYmFnZ2FnZS5pbml0KGZpcnN0SW5jYXJuYXRpb25LZXksIHRydWUpO1xuICAgIHJlZ2lzdGVyQ2hhaW5zQW5kQXNzZXRzKFxuICAgICAgY2hhaW5IdWIsXG4gICAgICB0ZXJtcy5icmFuZHMsXG4gICAgICBwcml2YXRlQXJncy5jaGFpbkluZm8sXG4gICAgICBwcml2YXRlQXJncy5hc3NldEluZm9cbiAgICApO1xuICB9XG4gIGNvbnN0IGZlZWRLaXQgPSB6b25lLm1ha2VPbmNlKFwiRmVlZCBLaXRcIiwgKCkgPT4gbWFrZUZlZWRLaXQoKSk7XG4gIGNvbnN0IHBvb2xBY2NvdW50ViA9IHpvbmUubWFrZU9uY2UoXCJQb29sQWNjb3VudFwiLCAoKSA9PiBtYWtlTG9jYWxBY2NvdW50MigpKTtcbiAgY29uc3Qgc2V0dGxlQWNjb3VudFYgPSB6b25lLm1ha2VPbmNlKFxuICAgIFwiU2V0dGxlQWNjb3VudFwiLFxuICAgICgpID0+IG1ha2VMb2NhbEFjY291bnQyKClcbiAgKTtcbiAgY29uc3QgW3Bvb2xBY2NvdW50LCBzZXR0bGVtZW50QWNjb3VudF0gPSBhd2FpdCB2b3dUb29scy53aGVuKFxuICAgIHZvd1Rvb2xzLmFsbChbcG9vbEFjY291bnRWLCBzZXR0bGVBY2NvdW50Vl0pXG4gICk7XG4gIHRyYWNlMTMoXCJzZXR0bGVtZW50QWNjb3VudFwiLCBzZXR0bGVtZW50QWNjb3VudCk7XG4gIHRyYWNlMTMoXCJwb29sQWNjb3VudFwiLCBwb29sQWNjb3VudCk7XG4gIGNvbnN0IHNldHRsZW1lbnRBZGRyZXNzID0gYXdhaXQgRShzZXR0bGVtZW50QWNjb3VudCkuZ2V0QWRkcmVzcygpO1xuICB0cmFjZTEzKFwic2V0dGxlbWVudEFkZHJlc3NcIiwgc2V0dGxlbWVudEFkZHJlc3MpO1xuICBjb25zdCBbX2Fnb3JpYywgX25vYmxlLCBhZ1RvTm9ibGVdID0gYXdhaXQgdm93VG9vbHMud2hlbihcbiAgICBjaGFpbkh1Yi5nZXRDaGFpbnNBbmRDb25uZWN0aW9uKFwiYWdvcmljXCIsIFwibm9ibGVcIilcbiAgKTtcbiAgY29uc3Qgc2V0dGxlcktpdCA9IHpvbmUubWFrZU9uY2UoXG4gICAgXCJzZXR0bGVyS2l0XCIsXG4gICAgKCkgPT4gbWFrZVNldHRsZXIoe1xuICAgICAgcmVwYXllcjogcG9vbEtpdC5yZXBheWVyLFxuICAgICAgc291cmNlQ2hhbm5lbDogYWdUb05vYmxlLnRyYW5zZmVyQ2hhbm5lbC5jb3VudGVyUGFydHlDaGFubmVsSWQsXG4gICAgICByZW1vdGVEZW5vbTogXCJ1dXNkY1wiLFxuICAgICAgc2V0dGxlbWVudEFjY291bnRcbiAgICB9KVxuICApO1xuICBjb25zdCBhZHZhbmNlciA9IG1ha2VBZHZhbmNlcih7XG4gICAgYm9ycm93ZXI6IHBvb2xLaXQuYm9ycm93ZXIsXG4gICAgbm90aWZpZXI6IHNldHRsZXJLaXQubm90aWZpZXIsXG4gICAgcG9vbEFjY291bnQsXG4gICAgc2V0dGxlbWVudEFkZHJlc3NcbiAgfSk7XG4gIHZvaWQgb2JzZXJ2ZUl0ZXJhdGlvbihzdWJzY3JpYmVFYWNoKGZlZWRLaXQucHVibGljLmdldEV2aWRlbmNlU3Vic2NyaWJlcigpKSwge1xuICAgIHVwZGF0ZVN0YXRlKGV2aWRlbmNlV2l0aFJpc2spIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZvaWQgYWR2YW5jZXIuaGFuZGxlVHJhbnNhY3Rpb25FdmVudChldmlkZW5jZVdpdGhSaXNrKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICB0cmFjZTEzKFwiXFx1ezFGNkE4fSBFcnJvciBoYW5kbGluZyB0cmFuc2FjdGlvbiBldmVudFwiLCBlcnIpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIGF3YWl0IHNldHRsZXJLaXQuY3JlYXRvci5tb25pdG9yTWludGluZ0RlcG9zaXRzKCk7XG4gIHJldHVybiBoYXJkZW4oeyBjcmVhdG9yRmFjZXQsIHB1YmxpY0ZhY2V0IH0pO1xufTtjb250cmFjdD0kY82PX2NvbnRyYWN0O1xuaGFyZGVuKGNvbnRyYWN0KTtcbnZhciAkY82PX3N0YXJ0PXdpdGhPcmNoZXN0cmF0aW9uKGNvbnRyYWN0LHtcbiAgY2hhaW5JbmZvVmFsdWVTaGFwZTogQ29zbW9zQ2hhaW5JbmZvU2hhcGVWMVxufSk7c3RhcnQ9JGPNj19zdGFydDtcbmhhcmRlbihzdGFydCk7XG59KSgpXG4iLCJfX2xpdmVFeHBvcnRNYXBfXyI6eyJtZXRhIjpbIm1ldGEiLHRydWVdLCJjb250cmFjdCI6WyJjb250cmFjdCIsdHJ1ZV0sInN0YXJ0IjpbInN0YXJ0Iix0cnVlXX0sIl9fcmVleHBvcnRNYXBfXyI6e30sIl9fZml4ZWRFeHBvcnRNYXBfXyI6e30sIl9fbmVlZHNJbXBvcnRfXyI6ZmFsc2UsIl9fbmVlZHNJbXBvcnRNZXRhX18iOmZhbHNlfVBLAQIeAwoAAAAAAAAAAACGA31gtgIAALYCAAAUAAAAAAAAAAAAAACkgQAAAABjb21wYXJ0bWVudC1tYXAuanNvblBLAQIeAwoAAAAAAAAAAADawq+o6MMMAOjDDABCAAAAAAAAAAAAAACkgegCAABAYWdsb2NhbC9mYXN0LXVzZGMtZGVwbG95LXYwLjEuMC9kaXN0L2Zhc3QtdXNkYy5jb250cmFjdC5idW5kbGUuanNQSwUGAAAAAAIAAgCyAAAAMMcMAAAA",
  "endoZipBase64Sha512": "4aec8008a91363b191284190aa53aefeb5b20fdad2054495bdc3341a61090fe222754219086c14f1296aff5ec8e4f70c914a9e9547c9206f417b075139615836"
}